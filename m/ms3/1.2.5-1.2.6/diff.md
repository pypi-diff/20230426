# Comparing `tmp/ms3-1.2.5.tar.gz` & `tmp/ms3-1.2.6.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "ms3-1.2.5.tar", last modified: Thu Mar 23 18:13:59 2023, max compression
+gzip compressed data, was "ms3-1.2.6.tar", last modified: Wed Apr 26 16:49:09 2023, max compression
```

## Comparing `ms3-1.2.5.tar` & `ms3-1.2.6.tar`

### file list

```diff
@@ -1,317 +1,317 @@
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.204312 ms3-1.2.5/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      586 2020-05-03 17:52:04.000000 ms3-1.2.5/.coveragerc
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.890978 ms3-1.2.5/.github/
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.900978 ms3-1.2.5/.github/ISSUE_TEMPLATE/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      752 2023-03-18 08:04:35.000000 ms3-1.2.5/.github/ISSUE_TEMPLATE/bug_report.md
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      599 2023-03-18 08:04:35.000000 ms3-1.2.5/.github/ISSUE_TEMPLATE/feature_request.md
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.900978 ms3-1.2.5/.github/workflows/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      669 2023-01-28 14:33:36.000000 ms3-1.2.5/.github/workflows/draft-pdf.yml
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      541 2023-03-23 18:04:33.000000 ms3-1.2.5/.gitignore
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       90 2020-07-06 00:26:02.000000 ms3-1.2.5/AUTHORS.rst
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    22697 2023-03-23 18:04:33.000000 ms3-1.2.5/CHANGELOG.rst
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    34500 2020-05-07 11:55:51.000000 ms3-1.2.5/LICENSE.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4564 2023-03-23 18:13:59.204312 ms3-1.2.5/PKG-INFO
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4026 2023-03-21 14:17:58.000000 ms3-1.2.5/README.rst
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2094 2022-12-15 11:35:36.000000 ms3-1.2.5/codemeta.json
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.907644 ms3-1.2.5/docs/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)        0 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/.nojekyll
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7593 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/Makefile
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      201 2023-01-28 14:33:36.000000 ms3-1.2.5/docs/README.md
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.910978 ms3-1.2.5/docs/_intersphinx/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      646 2021-10-20 14:43:53.000000 ms3-1.2.5/docs/_intersphinx/bs4_objects.inv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1799 2021-10-20 14:43:53.000000 ms3-1.2.5/docs/_intersphinx/bs4_objects.txt
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.910978 ms3-1.2.5/docs/_static/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       18 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/_static/.gitignore
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       41 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/authors.rst
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.910978 ms3-1.2.5/docs/build/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      230 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.buildinfo
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.930978 ms3-1.2.5/docs/build/.doctrees/
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.930978 ms3-1.2.5/docs/build/.doctrees/api/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2579 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/api/modules.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   619252 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/api/ms3.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3406 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/authors.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6354 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/changelog.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001) 10423401 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/environment.pickle
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14745 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/index.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7547 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/install.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4679 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/intro.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    96686 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/license.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    35413 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/manual.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4590 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.doctrees/quick.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)        0 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/.nojekyll
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.954311 ms3-1.2.5/docs/build/doctrees/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4366 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/README.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3594 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/authors.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   154262 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/changelog.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001) 13487965 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/environment.pickle
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    35248 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/index.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7812 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/install.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    97335 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/license.doctree
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.974311 ms3-1.2.5/docs/build/doctrees/manual/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001) 14283956 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/manual/index.doctree
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.060978 ms3-1.2.5/docs/build/doctrees/old_src/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    79212 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/old_src/quick_old.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    78946 2023-03-23 18:04:33.000000 ms3-1.2.5/docs/build/doctrees/quick.doctree
--rw-r--r--   0 hentsche  (1001) hentsche  (1001) 17416423 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/doctrees/reference.doctree
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.070978 ms3-1.2.5/docs/build/html/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      230 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/.buildinfo
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)        0 2023-03-18 10:45:36.000000 ms3-1.2.5/docs/build/html/.nojekyll
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    15846 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/README.html
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.070978 ms3-1.2.5/docs/build/html/_modules/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    15440 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/index.html
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.090978 ms3-1.2.5/docs/build/html/_modules/ms3/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   121982 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/annotations.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   562760 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/bs4_parser.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   585871 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/corpus.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   119721 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/expand_dcml.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   299877 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/parse.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   337630 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/piece.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   326103 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/score.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   264338 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/transformations.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   930043 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/utils.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   139939 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/ms3/view.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    63215 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_modules/re.html
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.094312 ms3-1.2.5/docs/build/html/_sources/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      201 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_sources/README.md.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       41 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/html/_sources/authors.rst.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       43 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/html/_sources/changelog.rst.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1356 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_sources/index.rst.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1256 2023-01-28 14:33:36.000000 ms3-1.2.5/docs/build/html/_sources/install.rst.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       67 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/build/html/_sources/license.rst.txt
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.094312 ms3-1.2.5/docs/build/html/_sources/manual/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    76626 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_sources/manual/index.md.txt
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.094312 ms3-1.2.5/docs/build/html/_sources/old_src/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    17232 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_sources/old_src/quick_old.rst.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2619 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_sources/quick.md.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7126 2023-03-21 14:17:58.000000 ms3-1.2.5/docs/build/html/_sources/reference.rst.txt
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.100978 ms3-1.2.5/docs/build/html/_static/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4418 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/_sphinx_javascript_frameworks_compat.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14621 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/basic.css
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4472 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/doctools.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      439 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/documentation_options.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      286 2023-01-21 10:04:25.000000 ms3-1.2.5/docs/build/html/_static/file.png
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   288580 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/jquery-3.6.0.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    89501 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/jquery.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3019 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/jupyter-sphinx.css
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4758 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/language_data.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       90 2023-01-21 10:04:25.000000 ms3-1.2.5/docs/build/html/_static/minus.png
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    39364 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       90 2023-01-21 10:04:25.000000 ms3-1.2.5/docs/build/html/_static/plus.png
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14668 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/pygments.css
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.100978 ms3-1.2.5/docs/build/html/_static/scripts/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    86398 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/scripts/bootstrap.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     5229 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/scripts/pydata-sphinx-theme.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    18215 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/searchtools.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4712 2023-01-21 10:04:25.000000 ms3-1.2.5/docs/build/html/_static/sphinx_highlight.js
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.100978 ms3-1.2.5/docs/build/html/_static/styles/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   144661 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/styles/bootstrap.css
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    58614 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/styles/pydata-sphinx-theme.css
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      106 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/styles/theme.css
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    68420 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/underscore-1.13.1.js
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    19530 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/underscore.js
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.894311 ms3-1.2.5/docs/build/html/_static/vendor/
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.894311 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.100978 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7427 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/LICENSE.txt
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.104312 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/css/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   101709 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/css/all.min.css
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.104312 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   181264 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.ttf
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   105112 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    60236 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.ttf
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    24028 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   389948 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.ttf
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   154840 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    10084 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-v4compatibility.ttf
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4776 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-v4compatibility.woff2
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1845 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/_static/webpack-macros.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    16465 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/authors.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    69269 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/changelog.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    79722 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/genindex.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    31724 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/index.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    19975 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/install.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    53099 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/license.html
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.104312 ms3-1.2.5/docs/build/html/manual/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   338361 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/manual/index.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7352 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/objects.inv
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.104312 ms3-1.2.5/docs/build/html/old_src/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    60388 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/old_src/quick_old.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    17021 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/py-modindex.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    47347 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/quick.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)  1763633 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/reference.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    15656 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/search.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   130526 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/html/searchindex.js
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.104312 ms3-1.2.5/docs/build/jupyter_execute/
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.104312 ms3-1.2.5/docs/build/jupyter_execute/manual/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   346220 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/jupyter_execute/manual/index.ipynb
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    49220 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/build/jupyter_execute/quick.ipynb
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       43 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/changelog.rst
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      135 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/columns.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    10588 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/conf.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   137117 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/cujus.mscx
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.110978 ms3-1.2.5/docs/examples/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      134 2023-01-02 20:31:46.000000 ms3-1.2.5/docs/examples/access_score_info.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       47 2021-10-16 12:40:03.000000 ms3-1.2.5/docs/examples/parse_directory.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       64 2023-01-02 20:31:46.000000 ms3-1.2.5/docs/examples/parse_directory_mscx.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       58 2023-01-02 20:31:46.000000 ms3-1.2.5/docs/examples/parse_directory_xml.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      199 2023-01-02 20:31:46.000000 ms3-1.2.5/docs/examples/parse_key.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      173 2023-01-02 20:31:46.000000 ms3-1.2.5/docs/examples/parse_other_directory.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      120 2023-01-02 20:31:46.000000 ms3-1.2.5/docs/examples/parse_single_score.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       71 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/index.html
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1356 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/index.rst
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1256 2023-01-28 14:33:36.000000 ms3-1.2.5/docs/install.rst
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       67 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/license.rst
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.110978 ms3-1.2.5/docs/manual/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      715 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/manual/corpus_after
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      174 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/manual/corpus_before
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    76626 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/manual/index.md
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      488 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/manual/out
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     9940 2021-10-20 14:43:53.000000 ms3-1.2.5/docs/ms3_architecture.drawio
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   218314 2021-10-20 14:43:53.000000 ms3-1.2.5/docs/ms3_architecture.png
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    96827 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/o_quam.mscx
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.110978 ms3-1.2.5/docs/old_src/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    15949 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/old_src/quick_old.md
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    17232 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/old_src/quick_old.rst
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   163542 2020-11-02 16:20:48.000000 ms3-1.2.5/docs/quae.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2619 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/quick.md
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7126 2023-03-21 14:17:58.000000 ms3-1.2.5/docs/reference.rst
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       86 2023-03-23 18:04:34.000000 ms3-1.2.5/docs/requirements.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   115684 2021-10-20 14:43:53.000000 ms3-1.2.5/docs/stabat.mscx
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.117645 ms3-1.2.5/new_tests/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7378 2023-03-22 16:48:01.000000 ms3-1.2.5/new_tests/conftest.py
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:58.894311 ms3-1.2.5/new_tests/inferred_labels/
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.117645 ms3-1.2.5/new_tests/inferred_labels/sweelinck_keyboard/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    19047 2022-12-15 11:35:36.000000 ms3-1.2.5/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   332296 2022-12-15 11:35:36.000000 ms3-1.2.5/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica_results.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   317949 2022-12-15 11:35:36.000000 ms3-1.2.5/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica_results_midi.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      466 2023-01-02 20:31:46.000000 ms3-1.2.5/new_tests/parse_script.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1526 2023-01-02 20:31:46.000000 ms3-1.2.5/new_tests/test_cli.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      403 2023-01-02 20:31:46.000000 ms3-1.2.5/new_tests/test_docs_examples.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    12424 2023-01-02 20:31:46.000000 ms3-1.2.5/new_tests/test_extract.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6352 2023-01-02 20:31:46.000000 ms3-1.2.5/new_tests/test_parse.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3744 2023-01-02 20:31:46.000000 ms3-1.2.5/new_tests/test_score.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      823 2023-01-17 21:52:55.000000 ms3-1.2.5/new_tests/test_transformations.py
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.154312 ms3-1.2.5/old_tests/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   388689 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/05_symph_fant_events.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      959 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/05_symph_fant_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   100539 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/05_symph_fant_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   488895 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/76CASM34A33UM_events.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7268 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/76CASM34A33UM_labels.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2636 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/76CASM34A33UM_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   155973 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/76CASM34A33UM_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4361 2023-01-02 20:31:46.000000 ms3-1.2.5/old_tests/ALL_WARNINGS
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   256806 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/BWV_0815_events.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6833 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/BWV_0815_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   136433 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/BWV_0815_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    16417 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/D973deutscher01_events.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      697 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/D973deutscher01_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     8271 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/D973deutscher01_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)  1490215 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/Did03M-Son_regina-1762-Sarti_events.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7264 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/Did03M-Son_regina-1762-Sarti_labels.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3305 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/Did03M-Son_regina-1762-Sarti_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   317634 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/Did03M-Son_regina-1762-Sarti_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      330 2023-01-02 20:31:46.000000 ms3-1.2.5/old_tests/IGNORED_WARNINGS
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   431522 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/K281-3_events.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14480 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/K281-3_labels.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4560 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/K281-3_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    96112 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/K281-3_notes.tsv
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.177646 ms3-1.2.5/old_tests/MS3/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)  1041665 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/MS3/05_symph_fant.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)  1034028 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/MS3/76CASM34A33UM.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   787637 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/MS3/BWV_0815.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    54002 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/MS3/D973deutscher01.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   701525 2023-03-23 18:04:34.000000 ms3-1.2.5/old_tests/MS3/Did03M-Son_regina-1762-Sarti.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   807371 2023-03-23 18:04:34.000000 ms3-1.2.5/old_tests/MS3/K281-3.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   259369 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/MS3/stabat_03_coloured.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      624 2023-03-23 18:04:34.000000 ms3-1.2.5/old_tests/README.md
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      224 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/conftest.py
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.177646 ms3-1.2.5/old_tests/harmonies/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2524 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/harmonies/76CASM34A33UM.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     9855 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/harmonies/Did03M-Son_regina-1762-Sarti.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    21459 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/harmonies/K281-3.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3905 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/harmonies/stabat_03_coloured.tsv
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.180979 ms3-1.2.5/old_tests/measures/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      889 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/measures/05_symph_fant.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2524 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/measures/76CASM34A33UM.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6504 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/measures/BWV_0815.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      684 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/measures/D973deutscher01.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2706 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/measures/Did03M-Son_regina-1762-Sarti.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4411 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/measures/K281-3.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      790 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/measures/stabat_03_coloured.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     5885 2023-03-23 18:04:34.000000 ms3-1.2.5/old_tests/metadata.tsv
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.187646 ms3-1.2.5/old_tests/notes/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    74055 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/notes/05_symph_fant.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   112389 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/notes/76CASM34A33UM.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   102317 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/notes/BWV_0815.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6173 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/notes/D973deutscher01.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   230316 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/notes/Did03M-Son_regina-1762-Sarti.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    70952 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/notes/K281-3.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    25080 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/notes/stabat_03_coloured.tsv
--rwxr-xr-x   0 hentsche  (1001) hentsche  (1001)       45 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/parse_original.sh
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      750 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/paths1.json
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      844 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/paths2.json
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.187646 ms3-1.2.5/old_tests/repeat_dummies/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6909 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/repeat_dummies/repeats0.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6493 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/repeat_dummies/repeats1.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7376 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/repeat_dummies/repeats2.mscx
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   135170 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/stabat_03_coloured_events.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4822 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/stabat_03_coloured_labels.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      790 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/stabat_03_coloured_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    25080 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/stabat_03_coloured_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2207 2023-02-18 19:40:30.000000 ms3-1.2.5/old_tests/test_parse.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      712 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_repeats.py
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.194312 ms3-1.2.5/old_tests/test_results/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      921 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/05_symph_fant_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    98388 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/05_symph_fant_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7089 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/76CASM34A33UM_labels.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2536 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/76CASM34A33UM_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   152525 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/76CASM34A33UM_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6833 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/BWV_0815_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   136433 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/BWV_0815_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      697 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/D973deutscher01_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     8271 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/D973deutscher01_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7264 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/Did03M-Son_regina-1762-Sarti_labels.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3305 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/Did03M-Son_regina-1762-Sarti_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   317634 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/Did03M-Son_regina-1762-Sarti_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14099 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/K281-3_labels.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4391 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/K281-3_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    94030 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/K281-3_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4731 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/stabat_03_coloured_labels.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      758 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/stabat_03_coloured_measures.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    24478 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_results/stabat_03_coloured_notes.tsv
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4777 2022-12-15 11:35:36.000000 ms3-1.2.5/old_tests/test_score.py
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.194312 ms3-1.2.5/paper/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    17950 2023-03-21 14:17:58.000000 ms3-1.2.5/paper/paper.bib
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4605 2023-03-21 14:17:58.000000 ms3-1.2.5/paper/paper.md
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   200690 2023-01-28 14:33:36.000000 ms3-1.2.5/paper/paper.pdf
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1345 2023-03-23 18:13:59.204312 ms3-1.2.5/setup.cfg
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      567 2020-05-03 17:52:04.000000 ms3-1.2.5/setup.py
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.197646 ms3-1.2.5/src/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)        0 2020-11-02 16:27:59.000000 ms3-1.2.5/src/__init__.py
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.200979 ms3-1.2.5/src/ms3/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1006 2023-02-18 19:40:30.000000 ms3-1.2.5/src/ms3/__init__.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2402 2023-02-18 19:40:30.000000 ms3-1.2.5/src/ms3/_typing.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    24943 2023-01-12 10:36:52.000000 ms3-1.2.5/src/ms3/annotations.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    41608 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/bs4_measures.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   129766 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/bs4_parser.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    40435 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/cli.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   151734 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/corpus.py
--rwxr-xr-x   0 hentsche  (1001) hentsche  (1001)    26692 2023-01-02 20:31:46.000000 ms3-1.2.5/src/ms3/expand_dcml.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     8416 2023-01-02 20:31:46.000000 ms3-1.2.5/src/ms3/ferocious_names.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    18415 2023-03-18 08:04:35.000000 ms3-1.2.5/src/ms3/logger.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    12701 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/operations.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    82935 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/parse.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    82901 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/piece.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    97681 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/score.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    67393 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/transformations.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)   216403 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/utils.py
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)    29851 2023-03-23 18:04:34.000000 ms3-1.2.5/src/ms3/view.py
-drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-03-23 18:13:59.204312 ms3-1.2.5/src/ms3.egg-info/
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4564 2023-03-23 18:13:58.000000 ms3-1.2.5/src/ms3.egg-info/PKG-INFO
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)     9420 2023-03-23 18:13:58.000000 ms3-1.2.5/src/ms3.egg-info/SOURCES.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)        1 2023-03-23 18:13:58.000000 ms3-1.2.5/src/ms3.egg-info/dependency_links.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)       36 2023-03-23 18:13:58.000000 ms3-1.2.5/src/ms3.egg-info/entry_points.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)        1 2020-05-03 17:52:26.000000 ms3-1.2.5/src/ms3.egg-info/not-zip-safe
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      102 2023-03-23 18:13:58.000000 ms3-1.2.5/src/ms3.egg-info/requires.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)        4 2023-03-23 18:13:58.000000 ms3-1.2.5/src/ms3.egg-info/top_level.txt
--rw-r--r--   0 hentsche  (1001) hentsche  (1001)      318 2020-05-03 17:52:04.000000 ms3-1.2.5/tox.ini
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.755867 ms3-1.2.6/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      586 2020-05-03 17:52:04.000000 ms3-1.2.6/.coveragerc
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.532530 ms3-1.2.6/.github/
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.542530 ms3-1.2.6/.github/ISSUE_TEMPLATE/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      752 2023-03-18 08:04:35.000000 ms3-1.2.6/.github/ISSUE_TEMPLATE/bug_report.md
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      599 2023-03-18 08:04:35.000000 ms3-1.2.6/.github/ISSUE_TEMPLATE/feature_request.md
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.542530 ms3-1.2.6/.github/workflows/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      669 2023-01-28 14:33:36.000000 ms3-1.2.6/.github/workflows/draft-pdf.yml
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      541 2023-03-23 18:04:33.000000 ms3-1.2.6/.gitignore
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       90 2020-07-06 00:26:02.000000 ms3-1.2.6/AUTHORS.rst
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    23034 2023-04-26 16:46:43.000000 ms3-1.2.6/CHANGELOG.rst
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    34500 2020-05-07 11:55:51.000000 ms3-1.2.6/LICENSE.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4564 2023-04-26 16:49:09.755867 ms3-1.2.6/PKG-INFO
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4026 2023-03-21 14:17:58.000000 ms3-1.2.6/README.rst
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2094 2022-12-15 11:35:36.000000 ms3-1.2.6/codemeta.json
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.552531 ms3-1.2.6/docs/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)        0 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/.nojekyll
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7593 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/Makefile
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      201 2023-01-28 14:33:36.000000 ms3-1.2.6/docs/README.md
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.555864 ms3-1.2.6/docs/_intersphinx/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      646 2021-10-20 14:43:53.000000 ms3-1.2.6/docs/_intersphinx/bs4_objects.inv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1799 2021-10-20 14:43:53.000000 ms3-1.2.6/docs/_intersphinx/bs4_objects.txt
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.555864 ms3-1.2.6/docs/_static/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       18 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/_static/.gitignore
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       41 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/authors.rst
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.555864 ms3-1.2.6/docs/build/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      230 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.buildinfo
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.579198 ms3-1.2.6/docs/build/.doctrees/
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.579198 ms3-1.2.6/docs/build/.doctrees/api/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2579 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/api/modules.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   619252 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/api/ms3.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3406 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/authors.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6354 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/changelog.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001) 10423401 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/environment.pickle
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14745 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/index.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7547 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/install.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4679 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/intro.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    96686 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/license.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    35413 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/manual.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4590 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.doctrees/quick.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)        0 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/.nojekyll
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.605865 ms3-1.2.6/docs/build/doctrees/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4366 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/README.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3594 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/authors.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   154262 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/changelog.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001) 13487965 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/environment.pickle
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    35248 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/index.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7812 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/install.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    97335 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/license.doctree
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.629198 ms3-1.2.6/docs/build/doctrees/manual/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001) 14283956 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/manual/index.doctree
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.649199 ms3-1.2.6/docs/build/doctrees/old_src/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    79212 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/old_src/quick_old.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    78946 2023-03-23 18:04:33.000000 ms3-1.2.6/docs/build/doctrees/quick.doctree
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001) 17416423 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/doctrees/reference.doctree
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.655866 ms3-1.2.6/docs/build/html/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      230 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/.buildinfo
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)        0 2023-03-18 10:45:36.000000 ms3-1.2.6/docs/build/html/.nojekyll
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    15846 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/README.html
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.659199 ms3-1.2.6/docs/build/html/_modules/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    15440 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/index.html
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.669199 ms3-1.2.6/docs/build/html/_modules/ms3/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   121982 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/annotations.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   562760 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/bs4_parser.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   585871 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/corpus.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   119721 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/expand_dcml.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   299877 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/parse.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   337630 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/piece.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   326103 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/score.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   264338 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/transformations.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   930043 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/utils.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   139939 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/ms3/view.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    63215 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_modules/re.html
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.672532 ms3-1.2.6/docs/build/html/_sources/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      201 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_sources/README.md.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       41 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/html/_sources/authors.rst.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       43 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/html/_sources/changelog.rst.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1356 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_sources/index.rst.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1256 2023-01-28 14:33:36.000000 ms3-1.2.6/docs/build/html/_sources/install.rst.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       67 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/build/html/_sources/license.rst.txt
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.672532 ms3-1.2.6/docs/build/html/_sources/manual/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    76626 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_sources/manual/index.md.txt
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.672532 ms3-1.2.6/docs/build/html/_sources/old_src/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    17232 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_sources/old_src/quick_old.rst.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2619 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_sources/quick.md.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7126 2023-03-21 14:17:58.000000 ms3-1.2.6/docs/build/html/_sources/reference.rst.txt
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.675866 ms3-1.2.6/docs/build/html/_static/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4418 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/_sphinx_javascript_frameworks_compat.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14621 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/basic.css
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4472 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/doctools.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      439 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/documentation_options.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      286 2023-01-21 10:04:25.000000 ms3-1.2.6/docs/build/html/_static/file.png
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   288580 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/jquery-3.6.0.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    89501 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/jquery.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3019 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/jupyter-sphinx.css
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4758 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/language_data.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       90 2023-01-21 10:04:25.000000 ms3-1.2.6/docs/build/html/_static/minus.png
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    39364 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       90 2023-01-21 10:04:25.000000 ms3-1.2.6/docs/build/html/_static/plus.png
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14668 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/pygments.css
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.679199 ms3-1.2.6/docs/build/html/_static/scripts/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    86398 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/scripts/bootstrap.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     5229 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/scripts/pydata-sphinx-theme.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    18215 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/searchtools.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4712 2023-01-21 10:04:25.000000 ms3-1.2.6/docs/build/html/_static/sphinx_highlight.js
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.679199 ms3-1.2.6/docs/build/html/_static/styles/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   144661 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/styles/bootstrap.css
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    58614 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/styles/pydata-sphinx-theme.css
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      106 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/styles/theme.css
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    68420 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/underscore-1.13.1.js
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    19530 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/underscore.js
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.535864 ms3-1.2.6/docs/build/html/_static/vendor/
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.535864 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.679199 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7427 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/LICENSE.txt
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.679199 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/css/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   101709 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/css/all.min.css
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.682533 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   181264 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.ttf
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   105112 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    60236 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.ttf
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    24028 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   389948 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.ttf
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   154840 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    10084 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-v4compatibility.ttf
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4776 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-v4compatibility.woff2
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1845 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/_static/webpack-macros.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    16465 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/authors.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    69269 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/changelog.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    79722 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/genindex.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    31724 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/index.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    19975 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/install.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    53099 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/license.html
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.682533 ms3-1.2.6/docs/build/html/manual/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   338361 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/manual/index.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7352 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/objects.inv
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.685866 ms3-1.2.6/docs/build/html/old_src/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    60388 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/old_src/quick_old.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    17021 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/py-modindex.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    47347 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/quick.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)  1763633 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/reference.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    15656 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/search.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   130526 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/html/searchindex.js
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.685866 ms3-1.2.6/docs/build/jupyter_execute/
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.685866 ms3-1.2.6/docs/build/jupyter_execute/manual/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   346220 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/jupyter_execute/manual/index.ipynb
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    49220 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/build/jupyter_execute/quick.ipynb
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       43 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/changelog.rst
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      135 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/columns.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    10588 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/conf.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   137117 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/cujus.mscx
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.689199 ms3-1.2.6/docs/examples/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      134 2023-01-02 20:31:46.000000 ms3-1.2.6/docs/examples/access_score_info.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       47 2021-10-16 12:40:03.000000 ms3-1.2.6/docs/examples/parse_directory.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       64 2023-01-02 20:31:46.000000 ms3-1.2.6/docs/examples/parse_directory_mscx.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       58 2023-01-02 20:31:46.000000 ms3-1.2.6/docs/examples/parse_directory_xml.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      199 2023-01-02 20:31:46.000000 ms3-1.2.6/docs/examples/parse_key.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      173 2023-01-02 20:31:46.000000 ms3-1.2.6/docs/examples/parse_other_directory.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      120 2023-01-02 20:31:46.000000 ms3-1.2.6/docs/examples/parse_single_score.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       71 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/index.html
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1356 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/index.rst
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1256 2023-01-28 14:33:36.000000 ms3-1.2.6/docs/install.rst
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       67 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/license.rst
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.689199 ms3-1.2.6/docs/manual/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      715 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/manual/corpus_after
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      174 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/manual/corpus_before
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    76626 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/manual/index.md
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      488 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/manual/out
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     9940 2021-10-20 14:43:53.000000 ms3-1.2.6/docs/ms3_architecture.drawio
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   218314 2021-10-20 14:43:53.000000 ms3-1.2.6/docs/ms3_architecture.png
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    96827 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/o_quam.mscx
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.689199 ms3-1.2.6/docs/old_src/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    15949 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/old_src/quick_old.md
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    17232 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/old_src/quick_old.rst
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   163542 2020-11-02 16:20:48.000000 ms3-1.2.6/docs/quae.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2619 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/quick.md
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7126 2023-03-21 14:17:58.000000 ms3-1.2.6/docs/reference.rst
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       86 2023-03-23 18:04:34.000000 ms3-1.2.6/docs/requirements.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   115684 2021-10-20 14:43:53.000000 ms3-1.2.6/docs/stabat.mscx
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.692533 ms3-1.2.6/new_tests/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7378 2023-04-26 16:41:43.000000 ms3-1.2.6/new_tests/conftest.py
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.535864 ms3-1.2.6/new_tests/inferred_labels/
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.692533 ms3-1.2.6/new_tests/inferred_labels/sweelinck_keyboard/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    19047 2022-12-15 11:35:36.000000 ms3-1.2.6/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   332296 2022-12-15 11:35:36.000000 ms3-1.2.6/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica_results.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   317949 2022-12-15 11:35:36.000000 ms3-1.2.6/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica_results_midi.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      466 2023-01-02 20:31:46.000000 ms3-1.2.6/new_tests/parse_script.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1526 2023-04-26 16:40:54.000000 ms3-1.2.6/new_tests/test_cli.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      403 2023-01-02 20:31:46.000000 ms3-1.2.6/new_tests/test_docs_examples.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    12424 2023-01-02 20:31:46.000000 ms3-1.2.6/new_tests/test_extract.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6352 2023-01-02 20:31:46.000000 ms3-1.2.6/new_tests/test_parse.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3744 2023-01-02 20:31:46.000000 ms3-1.2.6/new_tests/test_score.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      823 2023-01-17 21:52:55.000000 ms3-1.2.6/new_tests/test_transformations.py
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.722533 ms3-1.2.6/old_tests/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   388689 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/05_symph_fant_events.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      959 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/05_symph_fant_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   100539 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/05_symph_fant_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   488895 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/76CASM34A33UM_events.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7268 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/76CASM34A33UM_labels.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2636 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/76CASM34A33UM_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   155973 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/76CASM34A33UM_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4361 2023-01-02 20:31:46.000000 ms3-1.2.6/old_tests/ALL_WARNINGS
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   256806 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/BWV_0815_events.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6833 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/BWV_0815_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   136433 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/BWV_0815_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    16417 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/D973deutscher01_events.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      697 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/D973deutscher01_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     8271 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/D973deutscher01_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)  1490215 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/Did03M-Son_regina-1762-Sarti_events.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7264 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/Did03M-Son_regina-1762-Sarti_labels.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3305 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/Did03M-Son_regina-1762-Sarti_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   317634 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/Did03M-Son_regina-1762-Sarti_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      330 2023-01-02 20:31:46.000000 ms3-1.2.6/old_tests/IGNORED_WARNINGS
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   431522 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/K281-3_events.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14480 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/K281-3_labels.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4560 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/K281-3_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    96112 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/K281-3_notes.tsv
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.729200 ms3-1.2.6/old_tests/MS3/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)  1041665 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/MS3/05_symph_fant.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)  1034028 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/MS3/76CASM34A33UM.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   787637 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/MS3/BWV_0815.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    54002 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/MS3/D973deutscher01.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   701525 2023-03-23 18:04:34.000000 ms3-1.2.6/old_tests/MS3/Did03M-Son_regina-1762-Sarti.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   807371 2023-03-23 18:04:34.000000 ms3-1.2.6/old_tests/MS3/K281-3.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   259369 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/MS3/stabat_03_coloured.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      624 2023-03-23 18:04:34.000000 ms3-1.2.6/old_tests/README.md
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      224 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/conftest.py
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.732533 ms3-1.2.6/old_tests/harmonies/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2524 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/harmonies/76CASM34A33UM.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     9855 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/harmonies/Did03M-Son_regina-1762-Sarti.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    21459 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/harmonies/K281-3.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3905 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/harmonies/stabat_03_coloured.tsv
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.732533 ms3-1.2.6/old_tests/measures/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      889 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/measures/05_symph_fant.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2524 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/measures/76CASM34A33UM.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6504 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/measures/BWV_0815.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      684 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/measures/D973deutscher01.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2706 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/measures/Did03M-Son_regina-1762-Sarti.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4411 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/measures/K281-3.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      790 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/measures/stabat_03_coloured.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     5885 2023-03-23 18:04:34.000000 ms3-1.2.6/old_tests/metadata.tsv
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.739200 ms3-1.2.6/old_tests/notes/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    74055 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/notes/05_symph_fant.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   112389 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/notes/76CASM34A33UM.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   102317 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/notes/BWV_0815.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6173 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/notes/D973deutscher01.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   230316 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/notes/Did03M-Son_regina-1762-Sarti.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    70952 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/notes/K281-3.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    25080 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/notes/stabat_03_coloured.tsv
+-rwxr-xr-x   0 hentsche  (1001) hentsche  (1001)       45 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/parse_original.sh
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      750 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/paths1.json
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      844 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/paths2.json
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.739200 ms3-1.2.6/old_tests/repeat_dummies/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6909 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/repeat_dummies/repeats0.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6493 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/repeat_dummies/repeats1.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7376 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/repeat_dummies/repeats2.mscx
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   135170 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/stabat_03_coloured_events.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4822 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/stabat_03_coloured_labels.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      790 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/stabat_03_coloured_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    25080 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/stabat_03_coloured_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2207 2023-02-18 19:40:30.000000 ms3-1.2.6/old_tests/test_parse.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      712 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_repeats.py
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.745867 ms3-1.2.6/old_tests/test_results/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      921 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/05_symph_fant_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    98388 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/05_symph_fant_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7089 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/76CASM34A33UM_labels.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2536 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/76CASM34A33UM_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   152525 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/76CASM34A33UM_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     6833 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/BWV_0815_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   136433 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/BWV_0815_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      697 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/D973deutscher01_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     8271 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/D973deutscher01_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     7264 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/Did03M-Son_regina-1762-Sarti_labels.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     3305 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/Did03M-Son_regina-1762-Sarti_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   317634 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/Did03M-Son_regina-1762-Sarti_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    14099 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/K281-3_labels.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4391 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/K281-3_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    94030 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/K281-3_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4731 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/stabat_03_coloured_labels.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      758 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/stabat_03_coloured_measures.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    24478 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_results/stabat_03_coloured_notes.tsv
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4777 2022-12-15 11:35:36.000000 ms3-1.2.6/old_tests/test_score.py
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.745867 ms3-1.2.6/paper/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    17950 2023-03-21 14:17:58.000000 ms3-1.2.6/paper/paper.bib
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4605 2023-03-21 14:17:58.000000 ms3-1.2.6/paper/paper.md
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   200690 2023-01-28 14:33:36.000000 ms3-1.2.6/paper/paper.pdf
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1364 2023-04-26 16:49:09.755867 ms3-1.2.6/setup.cfg
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      567 2020-05-03 17:52:04.000000 ms3-1.2.6/setup.py
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.749200 ms3-1.2.6/src/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)        0 2020-11-02 16:27:59.000000 ms3-1.2.6/src/__init__.py
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.752534 ms3-1.2.6/src/ms3/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     1006 2023-02-18 19:40:30.000000 ms3-1.2.6/src/ms3/__init__.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     2402 2023-02-18 19:40:30.000000 ms3-1.2.6/src/ms3/_typing.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    24943 2023-01-12 10:36:52.000000 ms3-1.2.6/src/ms3/annotations.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    41608 2023-03-23 18:04:34.000000 ms3-1.2.6/src/ms3/bs4_measures.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   130482 2023-04-26 16:41:43.000000 ms3-1.2.6/src/ms3/bs4_parser.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    41131 2023-04-26 16:41:43.000000 ms3-1.2.6/src/ms3/cli.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   151734 2023-04-19 06:50:23.000000 ms3-1.2.6/src/ms3/corpus.py
+-rwxr-xr-x   0 hentsche  (1001) hentsche  (1001)    26692 2023-01-02 20:31:46.000000 ms3-1.2.6/src/ms3/expand_dcml.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     8416 2023-01-02 20:31:46.000000 ms3-1.2.6/src/ms3/ferocious_names.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    18415 2023-03-18 08:04:35.000000 ms3-1.2.6/src/ms3/logger.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    15667 2023-04-26 16:41:43.000000 ms3-1.2.6/src/ms3/operations.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    83765 2023-04-26 16:41:43.000000 ms3-1.2.6/src/ms3/parse.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    82901 2023-03-23 18:04:34.000000 ms3-1.2.6/src/ms3/piece.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    97681 2023-03-23 18:04:34.000000 ms3-1.2.6/src/ms3/score.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    67393 2023-03-23 18:04:34.000000 ms3-1.2.6/src/ms3/transformations.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)   219691 2023-04-26 16:41:43.000000 ms3-1.2.6/src/ms3/utils.py
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)    29853 2023-04-26 16:41:43.000000 ms3-1.2.6/src/ms3/view.py
+drwxr-xr-x   0 hentsche  (1001) hentsche  (1001)        0 2023-04-26 16:49:09.755867 ms3-1.2.6/src/ms3.egg-info/
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     4564 2023-04-26 16:49:09.000000 ms3-1.2.6/src/ms3.egg-info/PKG-INFO
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)     9420 2023-04-26 16:49:09.000000 ms3-1.2.6/src/ms3.egg-info/SOURCES.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)        1 2023-04-26 16:49:09.000000 ms3-1.2.6/src/ms3.egg-info/dependency_links.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)       36 2023-04-26 16:49:09.000000 ms3-1.2.6/src/ms3.egg-info/entry_points.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)        1 2020-05-03 17:52:26.000000 ms3-1.2.6/src/ms3.egg-info/not-zip-safe
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      120 2023-04-26 16:49:09.000000 ms3-1.2.6/src/ms3.egg-info/requires.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)        4 2023-04-26 16:49:09.000000 ms3-1.2.6/src/ms3.egg-info/top_level.txt
+-rw-r--r--   0 hentsche  (1001) hentsche  (1001)      318 2020-05-03 17:52:04.000000 ms3-1.2.6/tox.ini
```

### Comparing `ms3-1.2.5/.coveragerc` & `ms3-1.2.6/.coveragerc`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/.github/ISSUE_TEMPLATE/bug_report.md` & `ms3-1.2.6/.github/ISSUE_TEMPLATE/bug_report.md`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/.github/ISSUE_TEMPLATE/feature_request.md` & `ms3-1.2.6/.github/ISSUE_TEMPLATE/feature_request.md`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/.github/workflows/draft-pdf.yml` & `ms3-1.2.6/.github/workflows/draft-pdf.yml`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/.gitignore` & `ms3-1.2.6/.gitignore`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/CHANGELOG.rst` & `ms3-1.2.6/CHANGELOG.rst`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,20 @@
 =========
 Changelog
 =========
 
+Version 1.2.6
+=============
+
+
+* changes the behaviour of the ``ms3 review`` command
+  * after coloring out-of-label notes, issue one warning per dubious label
+  * rather than one `warnings.log` file per corpus, create one `<fname>.warnings` file per piece in the `reviewed` folder
+* makes ``ms3 empty`` work under the new CLI (d8f661a)
+
 Version 1.2.5
 =============
 
 * :obj:`~ms3.Corpus` and :obj:`~ms3.Piece` come with the new method ``count_pieces()``
 * ``ms3 transform -D`` to concatenate only metadata works
 * ``View.fnames_with_incomplete_facets = False`` enforces selected facets if some have been excluded
```

### Comparing `ms3-1.2.5/LICENSE.txt` & `ms3-1.2.6/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/PKG-INFO` & `ms3-1.2.6/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ms3
-Version: 1.2.5
+Version: 1.2.6
 Summary: A parser for annotated MuseScore 3 files.
 Home-page: https://github.com/johentsch/ms3
 Author: Johannes Hentschel
 Author-email: johannes.hentschel@epfl.ch
 License: gpl3
 Project-URL: Documentation, https://johentsch.github.io/ms3/
 Platform: any
```

### Comparing `ms3-1.2.5/README.rst` & `ms3-1.2.6/README.rst`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/codemeta.json` & `ms3-1.2.6/codemeta.json`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/Makefile` & `ms3-1.2.6/docs/Makefile`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/_intersphinx/bs4_objects.inv` & `ms3-1.2.6/docs/_intersphinx/bs4_objects.inv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/_intersphinx/bs4_objects.txt` & `ms3-1.2.6/docs/_intersphinx/bs4_objects.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/api/modules.doctree` & `ms3-1.2.6/docs/build/.doctrees/api/modules.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/api/ms3.doctree` & `ms3-1.2.6/docs/build/.doctrees/api/ms3.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/authors.doctree` & `ms3-1.2.6/docs/build/.doctrees/authors.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/changelog.doctree` & `ms3-1.2.6/docs/build/.doctrees/changelog.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/environment.pickle` & `ms3-1.2.6/docs/build/.doctrees/environment.pickle`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/index.doctree` & `ms3-1.2.6/docs/build/.doctrees/index.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/install.doctree` & `ms3-1.2.6/docs/build/.doctrees/install.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/intro.doctree` & `ms3-1.2.6/docs/build/.doctrees/intro.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/license.doctree` & `ms3-1.2.6/docs/build/.doctrees/license.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/manual.doctree` & `ms3-1.2.6/docs/build/.doctrees/manual.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/.doctrees/quick.doctree` & `ms3-1.2.6/docs/build/.doctrees/quick.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/README.doctree` & `ms3-1.2.6/docs/build/doctrees/README.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/authors.doctree` & `ms3-1.2.6/docs/build/doctrees/authors.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/changelog.doctree` & `ms3-1.2.6/docs/build/doctrees/changelog.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/environment.pickle` & `ms3-1.2.6/docs/build/doctrees/environment.pickle`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/index.doctree` & `ms3-1.2.6/docs/build/doctrees/index.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/install.doctree` & `ms3-1.2.6/docs/build/doctrees/install.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/license.doctree` & `ms3-1.2.6/docs/build/doctrees/license.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/manual/index.doctree` & `ms3-1.2.6/docs/build/doctrees/manual/index.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/old_src/quick_old.doctree` & `ms3-1.2.6/docs/build/doctrees/old_src/quick_old.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/quick.doctree` & `ms3-1.2.6/docs/build/doctrees/quick.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/doctrees/reference.doctree` & `ms3-1.2.6/docs/build/doctrees/reference.doctree`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/README.html` & `ms3-1.2.6/docs/build/html/README.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/index.html` & `ms3-1.2.6/docs/build/html/_modules/index.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/annotations.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/annotations.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/bs4_parser.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/bs4_parser.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/corpus.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/corpus.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/expand_dcml.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/expand_dcml.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/parse.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/parse.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/piece.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/piece.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/score.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/score.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/transformations.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/transformations.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/utils.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/utils.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/ms3/view.html` & `ms3-1.2.6/docs/build/html/_modules/ms3/view.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_modules/re.html` & `ms3-1.2.6/docs/build/html/_modules/re.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_sources/index.rst.txt` & `ms3-1.2.6/docs/build/html/_sources/index.rst.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_sources/install.rst.txt` & `ms3-1.2.6/docs/build/html/_sources/install.rst.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_sources/manual/index.md.txt` & `ms3-1.2.6/docs/build/html/_sources/manual/index.md.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_sources/old_src/quick_old.rst.txt` & `ms3-1.2.6/docs/build/html/_sources/old_src/quick_old.rst.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_sources/quick.md.txt` & `ms3-1.2.6/docs/build/html/_sources/quick.md.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_sources/reference.rst.txt` & `ms3-1.2.6/docs/build/html/_sources/reference.rst.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/_sphinx_javascript_frameworks_compat.js` & `ms3-1.2.6/docs/build/html/_static/_sphinx_javascript_frameworks_compat.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/basic.css` & `ms3-1.2.6/docs/build/html/_static/basic.css`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/doctools.js` & `ms3-1.2.6/docs/build/html/_static/doctools.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/jquery-3.6.0.js` & `ms3-1.2.6/docs/build/html/_static/jquery-3.6.0.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/jquery.js` & `ms3-1.2.6/docs/build/html/_static/jquery.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/jupyter-sphinx.css` & `ms3-1.2.6/docs/build/html/_static/jupyter-sphinx.css`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/language_data.js` & `ms3-1.2.6/docs/build/html/_static/language_data.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css` & `ms3-1.2.6/docs/build/html/_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/pygments.css` & `ms3-1.2.6/docs/build/html/_static/pygments.css`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/scripts/bootstrap.js` & `ms3-1.2.6/docs/build/html/_static/scripts/bootstrap.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/scripts/pydata-sphinx-theme.js` & `ms3-1.2.6/docs/build/html/_static/scripts/pydata-sphinx-theme.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/searchtools.js` & `ms3-1.2.6/docs/build/html/_static/searchtools.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/sphinx_highlight.js` & `ms3-1.2.6/docs/build/html/_static/sphinx_highlight.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/styles/bootstrap.css` & `ms3-1.2.6/docs/build/html/_static/styles/bootstrap.css`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/styles/pydata-sphinx-theme.css` & `ms3-1.2.6/docs/build/html/_static/styles/pydata-sphinx-theme.css`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/underscore-1.13.1.js` & `ms3-1.2.6/docs/build/html/_static/underscore-1.13.1.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/underscore.js` & `ms3-1.2.6/docs/build/html/_static/underscore.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/LICENSE.txt` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/css/all.min.css` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/css/all.min.css`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.ttf` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.ttf`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.ttf` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.ttf`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.ttf` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.ttf`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-v4compatibility.ttf` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-v4compatibility.ttf`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-v4compatibility.woff2` & `ms3-1.2.6/docs/build/html/_static/vendor/fontawesome/6.1.2/webfonts/fa-v4compatibility.woff2`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/_static/webpack-macros.html` & `ms3-1.2.6/docs/build/html/_static/webpack-macros.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/authors.html` & `ms3-1.2.6/docs/build/html/authors.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/changelog.html` & `ms3-1.2.6/docs/build/html/changelog.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/genindex.html` & `ms3-1.2.6/docs/build/html/genindex.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/index.html` & `ms3-1.2.6/docs/build/html/index.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/install.html` & `ms3-1.2.6/docs/build/html/install.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/license.html` & `ms3-1.2.6/docs/build/html/license.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/manual/index.html` & `ms3-1.2.6/docs/build/html/manual/index.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/objects.inv` & `ms3-1.2.6/docs/build/html/objects.inv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/old_src/quick_old.html` & `ms3-1.2.6/docs/build/html/old_src/quick_old.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/py-modindex.html` & `ms3-1.2.6/docs/build/html/py-modindex.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/quick.html` & `ms3-1.2.6/docs/build/html/quick.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/reference.html` & `ms3-1.2.6/docs/build/html/reference.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/search.html` & `ms3-1.2.6/docs/build/html/search.html`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/html/searchindex.js` & `ms3-1.2.6/docs/build/html/searchindex.js`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/jupyter_execute/manual/index.ipynb` & `ms3-1.2.6/docs/build/jupyter_execute/manual/index.ipynb`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/build/jupyter_execute/quick.ipynb` & `ms3-1.2.6/docs/build/jupyter_execute/quick.ipynb`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/conf.py` & `ms3-1.2.6/docs/conf.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/cujus.mscx` & `ms3-1.2.6/docs/cujus.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/index.rst` & `ms3-1.2.6/docs/index.rst`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/install.rst` & `ms3-1.2.6/docs/install.rst`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/manual/corpus_after` & `ms3-1.2.6/docs/manual/corpus_after`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/manual/index.md` & `ms3-1.2.6/docs/manual/index.md`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/ms3_architecture.drawio` & `ms3-1.2.6/docs/ms3_architecture.drawio`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/ms3_architecture.png` & `ms3-1.2.6/docs/ms3_architecture.png`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/o_quam.mscx` & `ms3-1.2.6/docs/o_quam.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/old_src/quick_old.md` & `ms3-1.2.6/docs/old_src/quick_old.md`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/old_src/quick_old.rst` & `ms3-1.2.6/docs/old_src/quick_old.rst`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/quae.mscx` & `ms3-1.2.6/docs/quae.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/quick.md` & `ms3-1.2.6/docs/quick.md`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/reference.rst` & `ms3-1.2.6/docs/reference.rst`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/docs/stabat.mscx` & `ms3-1.2.6/docs/stabat.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/new_tests/conftest.py` & `ms3-1.2.6/new_tests/conftest.py`

 * *Files 1% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 
 from ms3 import Parse, Score
 from ms3.logger import get_logger
 from ms3.utils import scan_directory, capture_parse_logs, ignored_warnings2dict
 
 
 CORPUS_DIR = "~"        # Directory holding your clone of DCMLab/unittest_metacorpus
-TEST_COMMIT = "51e4cb5" # commit of DCMLab/unittest_metacorpus for which the tests should pass
+TEST_COMMIT = "e0eec43" # commit of DCMLab/unittest_metacorpus for which the tests should pass
 MS3_DIR = os.path.abspath(os.path.join(os.path.realpath(__file__), '..', '..'))
 DOCS_DIR = os.path.join(MS3_DIR, 'docs')
 DOCS_EXAMPLES_DIR = os.path.join(DOCS_DIR, 'examples')
 
 @pytest.fixture(scope="session")
 def directory():
     """Compose the path for the test corpus."""
```

### Comparing `ms3-1.2.5/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica.tsv` & `ms3-1.2.6/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica_results.tsv` & `ms3-1.2.6/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica_results.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica_results_midi.tsv` & `ms3-1.2.6/new_tests/inferred_labels/sweelinck_keyboard/SwWV258_fantasia_cromatica_results_midi.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/new_tests/test_cli.py` & `ms3-1.2.6/new_tests/test_cli.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/new_tests/test_extract.py` & `ms3-1.2.6/new_tests/test_extract.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/new_tests/test_parse.py` & `ms3-1.2.6/new_tests/test_parse.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/new_tests/test_score.py` & `ms3-1.2.6/new_tests/test_score.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/new_tests/test_transformations.py` & `ms3-1.2.6/new_tests/test_transformations.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/05_symph_fant_events.tsv` & `ms3-1.2.6/old_tests/05_symph_fant_events.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/05_symph_fant_measures.tsv` & `ms3-1.2.6/old_tests/05_symph_fant_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/05_symph_fant_notes.tsv` & `ms3-1.2.6/old_tests/05_symph_fant_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/76CASM34A33UM_events.tsv` & `ms3-1.2.6/old_tests/76CASM34A33UM_events.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/76CASM34A33UM_labels.tsv` & `ms3-1.2.6/old_tests/76CASM34A33UM_labels.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/76CASM34A33UM_measures.tsv` & `ms3-1.2.6/old_tests/76CASM34A33UM_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/76CASM34A33UM_notes.tsv` & `ms3-1.2.6/old_tests/76CASM34A33UM_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/ALL_WARNINGS` & `ms3-1.2.6/old_tests/ALL_WARNINGS`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/BWV_0815_events.tsv` & `ms3-1.2.6/old_tests/BWV_0815_events.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/BWV_0815_measures.tsv` & `ms3-1.2.6/old_tests/BWV_0815_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/BWV_0815_notes.tsv` & `ms3-1.2.6/old_tests/BWV_0815_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/D973deutscher01_events.tsv` & `ms3-1.2.6/old_tests/D973deutscher01_events.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/D973deutscher01_measures.tsv` & `ms3-1.2.6/old_tests/D973deutscher01_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/D973deutscher01_notes.tsv` & `ms3-1.2.6/old_tests/D973deutscher01_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/Did03M-Son_regina-1762-Sarti_events.tsv` & `ms3-1.2.6/old_tests/Did03M-Son_regina-1762-Sarti_events.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/Did03M-Son_regina-1762-Sarti_labels.tsv` & `ms3-1.2.6/old_tests/Did03M-Son_regina-1762-Sarti_labels.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/Did03M-Son_regina-1762-Sarti_measures.tsv` & `ms3-1.2.6/old_tests/Did03M-Son_regina-1762-Sarti_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/Did03M-Son_regina-1762-Sarti_notes.tsv` & `ms3-1.2.6/old_tests/Did03M-Son_regina-1762-Sarti_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/K281-3_events.tsv` & `ms3-1.2.6/old_tests/K281-3_events.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/K281-3_labels.tsv` & `ms3-1.2.6/old_tests/K281-3_labels.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/K281-3_measures.tsv` & `ms3-1.2.6/old_tests/K281-3_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/K281-3_notes.tsv` & `ms3-1.2.6/old_tests/K281-3_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/MS3/05_symph_fant.mscx` & `ms3-1.2.6/old_tests/MS3/05_symph_fant.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/MS3/76CASM34A33UM.mscx` & `ms3-1.2.6/old_tests/MS3/76CASM34A33UM.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/MS3/BWV_0815.mscx` & `ms3-1.2.6/old_tests/MS3/BWV_0815.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/MS3/D973deutscher01.mscx` & `ms3-1.2.6/old_tests/MS3/D973deutscher01.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/MS3/Did03M-Son_regina-1762-Sarti.mscx` & `ms3-1.2.6/old_tests/MS3/Did03M-Son_regina-1762-Sarti.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/MS3/K281-3.mscx` & `ms3-1.2.6/old_tests/MS3/K281-3.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/MS3/stabat_03_coloured.mscx` & `ms3-1.2.6/old_tests/MS3/stabat_03_coloured.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/README.md` & `ms3-1.2.6/old_tests/README.md`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/harmonies/76CASM34A33UM.tsv` & `ms3-1.2.6/old_tests/harmonies/76CASM34A33UM.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/harmonies/Did03M-Son_regina-1762-Sarti.tsv` & `ms3-1.2.6/old_tests/harmonies/Did03M-Son_regina-1762-Sarti.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/harmonies/K281-3.tsv` & `ms3-1.2.6/old_tests/harmonies/K281-3.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/harmonies/stabat_03_coloured.tsv` & `ms3-1.2.6/old_tests/harmonies/stabat_03_coloured.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/measures/05_symph_fant.tsv` & `ms3-1.2.6/old_tests/measures/05_symph_fant.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/measures/76CASM34A33UM.tsv` & `ms3-1.2.6/old_tests/measures/76CASM34A33UM.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/measures/BWV_0815.tsv` & `ms3-1.2.6/old_tests/measures/BWV_0815.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/measures/D973deutscher01.tsv` & `ms3-1.2.6/old_tests/measures/D973deutscher01.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/measures/Did03M-Son_regina-1762-Sarti.tsv` & `ms3-1.2.6/old_tests/measures/Did03M-Son_regina-1762-Sarti.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/measures/K281-3.tsv` & `ms3-1.2.6/old_tests/measures/K281-3.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/measures/stabat_03_coloured.tsv` & `ms3-1.2.6/old_tests/measures/stabat_03_coloured.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/metadata.tsv` & `ms3-1.2.6/old_tests/metadata.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/notes/05_symph_fant.tsv` & `ms3-1.2.6/old_tests/notes/05_symph_fant.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/notes/76CASM34A33UM.tsv` & `ms3-1.2.6/old_tests/notes/76CASM34A33UM.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/notes/BWV_0815.tsv` & `ms3-1.2.6/old_tests/notes/BWV_0815.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/notes/D973deutscher01.tsv` & `ms3-1.2.6/old_tests/notes/D973deutscher01.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/notes/Did03M-Son_regina-1762-Sarti.tsv` & `ms3-1.2.6/old_tests/notes/Did03M-Son_regina-1762-Sarti.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/notes/K281-3.tsv` & `ms3-1.2.6/old_tests/notes/K281-3.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/notes/stabat_03_coloured.tsv` & `ms3-1.2.6/old_tests/notes/stabat_03_coloured.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/paths1.json` & `ms3-1.2.6/old_tests/paths1.json`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/paths2.json` & `ms3-1.2.6/old_tests/paths2.json`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/repeat_dummies/repeats0.mscx` & `ms3-1.2.6/old_tests/repeat_dummies/repeats0.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/repeat_dummies/repeats1.mscx` & `ms3-1.2.6/old_tests/repeat_dummies/repeats1.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/repeat_dummies/repeats2.mscx` & `ms3-1.2.6/old_tests/repeat_dummies/repeats2.mscx`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/stabat_03_coloured_events.tsv` & `ms3-1.2.6/old_tests/stabat_03_coloured_events.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/stabat_03_coloured_labels.tsv` & `ms3-1.2.6/old_tests/stabat_03_coloured_labels.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/stabat_03_coloured_measures.tsv` & `ms3-1.2.6/old_tests/stabat_03_coloured_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/stabat_03_coloured_notes.tsv` & `ms3-1.2.6/old_tests/stabat_03_coloured_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_parse.py` & `ms3-1.2.6/old_tests/test_parse.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_repeats.py` & `ms3-1.2.6/old_tests/test_repeats.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/05_symph_fant_measures.tsv` & `ms3-1.2.6/old_tests/test_results/05_symph_fant_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/05_symph_fant_notes.tsv` & `ms3-1.2.6/old_tests/test_results/05_symph_fant_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/76CASM34A33UM_labels.tsv` & `ms3-1.2.6/old_tests/test_results/76CASM34A33UM_labels.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/76CASM34A33UM_measures.tsv` & `ms3-1.2.6/old_tests/test_results/76CASM34A33UM_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/76CASM34A33UM_notes.tsv` & `ms3-1.2.6/old_tests/test_results/76CASM34A33UM_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/BWV_0815_measures.tsv` & `ms3-1.2.6/old_tests/test_results/BWV_0815_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/BWV_0815_notes.tsv` & `ms3-1.2.6/old_tests/test_results/BWV_0815_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/D973deutscher01_measures.tsv` & `ms3-1.2.6/old_tests/test_results/D973deutscher01_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/D973deutscher01_notes.tsv` & `ms3-1.2.6/old_tests/test_results/D973deutscher01_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/Did03M-Son_regina-1762-Sarti_labels.tsv` & `ms3-1.2.6/old_tests/test_results/Did03M-Son_regina-1762-Sarti_labels.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/Did03M-Son_regina-1762-Sarti_measures.tsv` & `ms3-1.2.6/old_tests/test_results/Did03M-Son_regina-1762-Sarti_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/Did03M-Son_regina-1762-Sarti_notes.tsv` & `ms3-1.2.6/old_tests/test_results/Did03M-Son_regina-1762-Sarti_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/K281-3_labels.tsv` & `ms3-1.2.6/old_tests/test_results/K281-3_labels.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/K281-3_measures.tsv` & `ms3-1.2.6/old_tests/test_results/K281-3_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/K281-3_notes.tsv` & `ms3-1.2.6/old_tests/test_results/K281-3_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/stabat_03_coloured_labels.tsv` & `ms3-1.2.6/old_tests/test_results/stabat_03_coloured_labels.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/stabat_03_coloured_measures.tsv` & `ms3-1.2.6/old_tests/test_results/stabat_03_coloured_measures.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_results/stabat_03_coloured_notes.tsv` & `ms3-1.2.6/old_tests/test_results/stabat_03_coloured_notes.tsv`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/old_tests/test_score.py` & `ms3-1.2.6/old_tests/test_score.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/paper/paper.bib` & `ms3-1.2.6/paper/paper.bib`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/paper/paper.md` & `ms3-1.2.6/paper/paper.md`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/paper/paper.pdf` & `ms3-1.2.6/paper/paper.pdf`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/setup.cfg` & `ms3-1.2.6/setup.cfg`

 * *Files 6% similar despite different names*

```diff
@@ -17,15 +17,15 @@
 [options]
 zip_safe = False
 packages = find:
 include_package_data = True
 package_dir = 
 	=src
 setup_requires = pyscaffold>=3.2a0,<3.3a0
-install_requires = beautifulsoup4; lxml; pandas; pathos; webcolors; tqdm; pytablewriter; GitPython
+install_requires = beautifulsoup4; lxml; pandas; pathos; webcolors; tqdm; pytablewriter; GitPython; typing_extensions
 python_requires = >=3.10
 
 [options.packages.find]
 where = src
 exclude = 
 	tests
```

### Comparing `ms3-1.2.5/setup.py` & `ms3-1.2.6/setup.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/__init__.py` & `ms3-1.2.6/src/ms3/__init__.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/_typing.py` & `ms3-1.2.6/src/ms3/_typing.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/annotations.py` & `ms3-1.2.6/src/ms3/annotations.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/bs4_measures.py` & `ms3-1.2.6/src/ms3/bs4_measures.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/bs4_parser.py` & `ms3-1.2.6/src/ms3/bs4_parser.py`

 * *Files 1% similar despite different names*

```diff
@@ -2084,40 +2084,48 @@
     keys = ('title_text', 'subtitle_text', 'composer_text', 'lyricist_text', 'part_name_text') # == utils.MUSESCORE_HEADER_FIELDS
     key2style = dict(zip(keys, styles))
     style2key = dict(zip(styles, keys))
 
     def __init__(self, soup: bs4.BeautifulSoup, **logger_cfg):
         super().__init__('Prelims', logger_cfg)
         self.soup = soup
-        first_measure = soup.find('Measure')
-        try:
-            self.vbox = next(sib for sib in first_measure.previous_siblings if sib.name == 'VBox')
-        except StopIteration:
+        part = soup.find('Part')
+        first_staff = part.find_next_sibling('Staff')
+        vbox_nodes = first_staff.find_all('VBox')
+        if len(vbox_nodes) == 0:
             self.vbox = self.soup.new_tag('VBox')
-            self.logger.debug('Inserted <VBox> before first <Measure> tag.')
+            first_staff.insert(0, self.vbox)
+            self.logger.debug('Inserted <VBox> at the beginning of the first staff.')
+        else:
+            self.vbox = vbox_nodes[0]
+            if len(vbox_nodes) > 1:
+                self.logger.warning(f"First staff starts off with more than one VBox. Picked the first one.")
+
 
 
 
     @property
     def text_tags(self) -> Dict[str, bs4.Tag]:
+        """Returns a {key->tag} dict reflecting the <Text> tags currently present in the first <VBox>."""
         tag_dict = {}
         for text_tag in self.vbox.find_all('Text'):
             style = text_tag.find('style')
             if style is not None:
                 identifier = str(style.string)
                 if identifier in self.style2key:
                     key = self.style2key[identifier]
                     tag_dict[key] = text_tag
                 else:
                     self.logger.info(f"Score contains a non-default text field '{identifier}' in the header that "
                                      f"can only be amended or removed manually.")
         return tag_dict
 
     @property
-    def fields(self):
+    def fields(self) -> Dict[str, str]:
+        """Returns a {key->value} dict reflecting the currently set <text> values."""
         result = {}
         for key, tag in self.text_tags.items():
             value, _ = tag2text(tag)
             result[key] = value
         return result
 
     def __getitem__(self, key) -> Optional[str]:
@@ -2138,28 +2146,32 @@
             return
         clean_tag = self.soup.new_tag('Text')
         style_tag = self.soup.new_tag('style')
         style_tag.string = self.key2style[key]
         clean_tag.append(style_tag)
         text_tag = self.soup.new_tag('text')
         # turn the new value into child nodes of an HTML <p> tag (in case it contains HTML markup)
-        value_as_paragraph = bs4.BeautifulSoup(new_value, 'lxml').find('p')
-        if value_as_paragraph is not None:
-            text_contents = value_as_paragraph.contents
-            for tag in text_contents:
-                text_tag.append(copy(tag))
+        new_value_as_html_body = bs4.BeautifulSoup(new_value, 'lxml').find('body')
+        new_value_as_p_tag = new_value_as_html_body.find('p')
+        if new_value_as_p_tag is None:
+            # if the created HTML contains a <p> tag, the new value (with tags or without) has been wrapped
+            iter_contents = new_value_as_html_body.contents
+        else:
+            iter_contents = new_value_as_p_tag.contents
+        for tag_or_string in iter_contents:
+            text_tag.append(copy(tag_or_string))
         clean_tag.append(text_tag)
         text_tags = self.text_tags
         if existing_value is None:
             following_key_index = self.keys.index(key) + 1
             try:
                 following_present_key = next(k for k in self.keys[following_key_index:] if k in text_tags)
                 following_tag = text_tags[following_present_key]
                 following_tag.insert_before(clean_tag)
-                self.logger.info(f"Inserted {key} before existing {following_key_index}.")
+                self.logger.info(f"Inserted {key} before existing {self.keys[following_key_index]}.")
             except StopIteration:
                 self.vbox.append(clean_tag)
                 self.logger.info(f"Appended {key} as last tag of the VBox (after {text_tags.keys()}).")
         else:
             existing_tag = text_tags[key]
             existing_tag.replace_with(clean_tag)
             self.logger.info(f"Replaced {key} '{existing_value}' with '{new_value}'.")
```

### Comparing `ms3-1.2.5/src/ms3/cli.py` & `ms3-1.2.6/src/ms3/cli.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,22 +1,21 @@
 #!/usr/bin/env python
 # -*- coding: utf-8 -*-
 """
 Command line interface for ms3.
 """
 
 import argparse, os
-from datetime import datetime
+import re
+from collections import defaultdict
 from typing import Optional
 
-import pandas as pd
-
-from ms3 import Parse
+from ms3 import Parse, make_coloring_reports_and_warnings
 from ms3.operations import extract, check, compare, update, store_scores, insert_labels_into_score
-from ms3.utils import convert_folder, resolve_dir, write_tsv, MS3_VERSION
+from ms3.utils import convert_folder, resolve_dir, write_tsv, MS3_VERSION, compute_path_from_file, capture_parse_logs
 from ms3.logger import get_logger, inspect_loggers
 
 __author__ = "johentsch"
 __copyright__ = "cole Polytechnique Fdrale de Lausanne"
 __license__ = "gpl3"
 
 def gather_extract_params(args):
@@ -141,28 +140,25 @@
                    suffix=args.suffix,
                    recursive=not args.nonrecursive,
                    ms=ms,
                    overwrite=args.safe,
                    parallel=not args.iterative,
                    logger=update_logger)
 
-def empty(args):
-    logger_cfg = {
-        'level': args.level,
-        'path': args.log,
-    }
-    p = Parse(args.dir, recursive=not args.nonrecursive, file_re=args.regex, exclude_re=args.exclude, file_paths=args.file, **logger_cfg)
-    p.parse_scores(parallel=False)
-    p.detach_labels()
-    p.logger.info(f"Overview of the removed labels:\n{p.count_annotation_layers(which='detached').to_string()}")
-    ids = [id for id, score in p._parsed_mscx.items() if score.mscx.changed]
-    if args.out is not None:
-        p.store_scores(ids=ids, root_dir=args.out, overwrite=True)
+def empty(args, parse_obj: Optional[Parse] = None):
+    if parse_obj is None:
+        p = make_parse_obj(args, parse_scores=True)
     else:
-        p.store_scores(ids=ids, overwrite=True)
+        p = parse_obj
+    p.detach_labels()
+    p.store_parsed_scores(only_changed=True,
+                          root_dir=args.out,
+                          suffix=args.suffix,
+                          overwrite=True,
+                          )
 
 
 def extract_cmd(args, parse_obj: Optional[Parse] = None):
     if parse_obj is None:
         p = make_parse_obj(args, parse_scores=True)
     else:
         p = parse_obj
@@ -289,87 +285,91 @@
     if not os.path.isdir(d):
         d = resolve_dir(os.path.join(os.getcwd(), d))
         if not os.path.isdir(d):
             raise argparse.ArgumentTypeError(d + ' needs to be an existing directory')
     return resolve_dir(d)
 
 
-
-
 def review_cmd(args,
                parse_obj: Optional[Parse] = None,
                ) -> None:
     """This command combines the functionalities check-extract-compare and additionally colors non-chord tones."""
     logger = get_logger('ms3.review', level=args.level)
     if parse_obj is None:
         p = make_parse_obj(args)
     else:
         p = parse_obj
+    accumulated_warnings = []
 
-    # create file for warnings
-    out_dir = '.' if args.out is None else args.out
-    warnings_file = os.path.join(out_dir, 'warnings.log')
-    header = f"Warnings encountered during the last execution of ms3 review (v{MS3_VERSION})"
-    header = f"{header}\n{'=' * len(header)}\n\n"
-    with open(warnings_file, 'w', encoding='utf-8') as f:
-        f.write(header)
-
-    # call ms3 check
+    # call ms3 check, collecting all warnings issued while parsing
     if args.ignore_scores + args.ignore_labels < 2:
         what = '' if args.ignore_scores else 'SCORES'
         if args.ignore_labels:
             what += 'LABELS' if what == '' else 'AND LABELS'
         print(f"CHECKING {what}...")
-        test_passes = check(p,
-                            ignore_labels=args.ignore_labels,
-                            ignore_scores=args.ignore_scores,
-                            assertion=False,
-                            parallel=False,
-                            warnings_file=warnings_file)
+        with capture_parse_logs(p.logger) as captured_warnings:
+            test_passes = check(p,
+                                ignore_labels=args.ignore_labels,
+                                ignore_scores=args.ignore_scores,
+                                assertion=False,
+                                parallel=False)
+            accumulated_warnings.extend(captured_warnings.content_list)
         p.parse_tsv()
     else:
+        test_passes = True
         p.parse(parallel=False)
     if p.n_parsed_scores == 0:
         msg = "NO SCORES PARSED, NOTHING TO DO."
         if not args.all:
             msg += "\nI was disregarding all files whose file names are not listed in the column 'fname' of a 'metadata.tsv' file. " \
                    "Add -a if you want me to include all scores."
         print(msg)
-        os.remove(warnings_file)
         return
 
     # call ms3 extract
     params = gather_extract_params(args)
     if len(params) > 0:
         print("EXTRACTING FACETS...")
         extract_cmd(args, p)
 
     # color out-of-label tones
     print("COLORING OUT-OF-LABEL TONES...")
-    review_reports = p.color_non_chord_tones()
-    if len(review_reports) > 0:
-        dataframes, keys = [], []
-        for (corpus_name, fname), tuples in review_reports.items():
-            for file, df in tuples:
-                dataframes.append(df)
-                keys.append((corpus_name, file.rel_path))
-                report_path = os.path.join(file.corpus_path, 'reviewed', file.fname + '_reviewed.tsv')
-                write_tsv(df, report_path)
-        report = pd.concat(dataframes, keys=keys)
-        warning_selection = (report.count_ratio > args.threshold) & report.chord_tones.notna()
-        if warning_selection.sum() > 0:
-            test_passes = False
-            filtered_report = report[warning_selection].droplevel(-1)
-            pretty_report = filtered_report.to_string(columns=['mc', 'mn', 'mc_onset', 'label', 'chord_tones', 'added_tones', 'n_colored', 'n_untouched', 'count_ratio'])
-            logger.warning(pretty_report,
-                           extra={'message_id': (19,)})
-            with open(warnings_file, 'a', encoding='utf-8') as f:
-                f.write(f"Chord labels where the ratio of colored notes vs. all notes in a segment lies above {args.threshold}:\n")
-                f.write(pretty_report + "\n")
-            logger.info(f"Added the {warning_selection.sum()} labels to {warnings_file}.")
+    with capture_parse_logs(p.logger) as captured_warnings:
+        test_passes = test_passes and make_coloring_reports_and_warnings(p, out_dir=args.out, threshold=args.threshold)
+        accumulated_warnings.extend(captured_warnings.content_list)
+
+    # attribute warnings to pieces based on logger names
+    logger2pieceID = {corpus.logger_names[fname]: (c, fname) for c, corpus in p.corpus_objects.items() for fname in corpus.keys()}
+    piece2warnings = defaultdict(list)
+    for warning in accumulated_warnings:
+        try:
+            match = next(logger_name for component in warning.split() if (logger_name := re.match(r"ms3\.Parse\.(?P<corpus>\S+)\.(?P<fname>\S+)$", component)))
+        except StopIteration:
+            logger.warning(f"This warning contains no valid logger name, skipping: {warning}")
+            continue
+        pieceID = logger2pieceID[match.group(0)]
+        piece2warnings[pieceID].append(warning)
+
+
+    # write all warnings to piece-specific warnings files and remove existing files where no warnings were captured
+    for pieceID, score_files in p.get_files('scores', unparsed=False, flat=True, include_empty=False).items():
+        file = score_files[0]
+        warnings_path = compute_path_from_file(file, root_dir=args.out, folder='reviewed')
+        warnings_file = os.path.join(warnings_path, file.fname + file.suffix + '.warnings')
+        if len((warnings := piece2warnings[pieceID])) > 0:
+            header = f"Warnings encountered during the last execution of ms3 review (v{MS3_VERSION})"
+            header = f"{header}\n{'=' * len(header)}\n\n"
+            os.makedirs(warnings_path, exist_ok=True)
+            with open(warnings_file, 'w', encoding='utf-8') as f:
+                f.write(header)
+                f.write('\n'.join(warnings))
+            logger.info(f"Written warnings to {warnings_file}.")
+        elif os.path.isfile(warnings_file):
+            logger.info(f"Problems seem to be solved, removing {warnings_file}")
+            os.remove(warnings_file)
 
     # call ms3 compare
     if args.compare is not None:
         revision = None if args.compare == '' else args.compare
         commit_str = '' if revision is None else f" @ {revision}"
         expanded = 'EXPANDED ' if args.use == 'expanded' else ''
         print(f"COMPARING CURRENT {expanded}LABELS WITH PREVIOUS ONES FROM THE TSV FILES{commit_str}...")
@@ -383,23 +383,26 @@
         logger.debug(f"{n_changed} files changed labels during comparison, {n_unchanged} didn't.")
     corpus2paths = store_scores(p,
                                 root_dir=args.out,
                                 simulate=args.test)
     changed = sum(map(len, corpus2paths.values()))
     logger.info(f"Operation resulted in {changed} review file{'s' if changed != 1 else ''}.")
     if test_passes:
-        logger.info(f"Parsed scores passed all tests. Removed {warnings_file}")
-        os.remove(warnings_file)
+        logger.info(f"Parsed scores passed all tests.")
     else:
-        msg = f"Not all tests have passed. Please check the relevant warnings in {warnings_file}"
+        msg = f"Not all tests have passed. Please check the relevant warnings in the generated .warnings files."
         if args.fail:
             assert test_passes, msg
         else:
             logger.info(msg)
-
+    out_dir = '.' if args.out is None else args.out
+    warnings_file = os.path.join(out_dir, 'warnings.log')
+    if os.path.isfile(warnings_file):
+        logger.info(f"Removing deprecated warnings file: {warnings_file}")
+        os.remove(warnings_file)
 
 
 
 def make_parse_obj(args, parse_scores=False, parse_tsv=False, facets=None):
     labels_cfg = {}
     if hasattr(args, 'positioning'):
         labels_cfg['positioning'] = args.positioning
@@ -625,14 +628,16 @@
                                          help="Remove harmony annotations and store the MuseScore files without them.",
                                          parents=[parse_args])
     # TODO: staff parameter needs to accept one to several integers including negative
     # empty_parser.add_argument('-s', '--staff',
     #                            help="Remove labels from selected staves only. 1=upper staff; -1=lowest staff (default)")
     # empty_parser.add_argument('--type', default=1,
     #                            help="Only remove particular types of harmony labels.")
+    empty_parser.add_argument('-s', '--suffix', metavar='SUFFIX', default='_clean',
+                            help='Suffix of the new scores with removed labels. Defaults to _clean.')
     empty_parser.set_defaults(func=empty)
 
     extract_parser = subparsers.add_parser('extract',
                                            help="Extract selected information from MuseScore files and store it in TSV files.",
                                            parents=[extract_args, parse_args])
     extract_parser.set_defaults(func=extract_cmd)
```

### Comparing `ms3-1.2.5/src/ms3/corpus.py` & `ms3-1.2.6/src/ms3/corpus.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/expand_dcml.py` & `ms3-1.2.6/src/ms3/expand_dcml.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/ferocious_names.txt` & `ms3-1.2.6/src/ms3/ferocious_names.txt`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/logger.py` & `ms3-1.2.6/src/ms3/logger.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/operations.py` & `ms3-1.2.6/src/ms3/operations.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,12 +1,13 @@
+import os
 from typing import Literal, Optional, Tuple, Dict, List, Union
 
 from ms3 import Parse, Corpus
 from ms3._typing import AnnotationsFacet
-from ms3.utils import capture_parse_logs, LATEST_MUSESCORE_VERSION, pretty_dict, check_argument_against_literal_type
+from ms3.utils import capture_parse_logs, LATEST_MUSESCORE_VERSION, pretty_dict, check_argument_against_literal_type, compute_path_from_file, write_tsv, fifths2sd, scale_degree2name
 from ms3.logger import get_logger, temporarily_suppress_warnings, function_logger
 
 def insert_labels_into_score(ms3_object: Union[Parse, Corpus],
                              facet: AnnotationsFacet,
                              ask_for_input: bool = True,
                              replace: bool = True,
                              staff: int = None,
@@ -99,16 +100,15 @@
 
 
 
 def check(parse_obj: Parse,
           ignore_labels: bool = False,
           ignore_scores: bool = False,
           assertion: bool = False,
-          parallel: bool = True,
-          warnings_file: Optional[str] = None) -> bool:
+          parallel: bool = True) -> bool:
     assert ignore_labels + ignore_scores < 2, "Activate either ignore_labels or ignore_scores, not both."
     all_warnings = []
     check_logger = get_logger("ms3.check", level=parse_obj.logger.getEffectiveLevel())
     if not ignore_scores:
         with capture_parse_logs(parse_obj.logger) as captured_warnings:
             parse_obj.parse_scores(parallel=parallel, only_new=False)
             warnings = captured_warnings.content_list
@@ -123,18 +123,14 @@
             expanded = parse_obj.get_dataframes(expanded=True)
             warnings = captured_warnings.content_list
         if len(expanded) == 0:
             parse_obj.logger.info(f"No DCML labels to check.")
         elif len(warnings) > 0:
             all_warnings.extend(warnings)
             check_logger.warning("Warnings detected while checking DCML labels (see above).")
-    if warnings_file is not None and len(all_warnings) > 0:
-        with open(warnings_file, 'a', encoding='utf-8') as f:
-            f.writelines(w + '\n' for w in all_warnings)
-        parse_obj.logger.info(f"Added captured warnings to {warnings_file}")
     if assertion:
         assert len(all_warnings) == 0, "Encountered warnings, check failed."
     if len(all_warnings) == 0:
         if ignore_labels:
             msg = 'All checked scores alright.'
         elif ignore_scores:
             msg = 'All checked labels alright.'
@@ -241,7 +237,55 @@
                                                           voice=voice,
                                                           harmony_layer=harmony_layer,
                                                           above=above,
                                                           safe=safe)
         corpus.logger.info(f"Labels updated in {len(scores_with_updated_labels)}")
         file_paths = corpus.store_parsed_scores(overwrite=overwrite, only_changed=True)
         return file_paths
+
+
+def make_coloring_reports_and_warnings(parse_obj: Parse,
+                                       out_dir: Optional[str] = None,
+                                       threshold: float = 0.6) -> bool:
+    """Performs the note coloring, stores the reports as TSV files in the reviewed folder, and logs warnings about
+    those chord label segments where the ratio of out-of-label chords is greater than the given threshold.
+
+
+    Args:
+        parse_obj:
+            Parse object with parsed scores containing labels. Coloring will be performed in the XML structure in the
+            memory and scores have to be written to disk to see the result.
+        out_dir: By default, reports are written to <CORPUS_PATH>/reviewed unless another path is specified here.
+        threshold: Above which ratio of out-of-label tones a warning is to be issued.
+
+    Returns:
+        False if at least one label went beyond the threshold, True otherwise.
+    """
+    review_reports = parse_obj.color_non_chord_tones()
+    test_passes = True
+    for (corpus_name, fname), file_df_pairs in review_reports.items():
+        piece_logger = get_logger(parse_obj[corpus_name].logger_names[fname])
+        is_first = True
+        for file, report in file_df_pairs:
+            report_path = compute_path_from_file(file, root_dir=out_dir, folder='reviewed')
+            os.makedirs(report_path, exist_ok=True)
+            report_file = os.path.join(report_path, file.fname + '_reviewed.tsv')
+            if not is_first and os.path.isfile(report_file):
+                get_logger('ms3.review').warning(f"This coloring report has been overwritten because several scores have the same fname:\n{report_file}")
+            write_tsv(report, report_file)
+            is_first = False
+            warning_selection = (report.count_ratio > threshold) & report.chord_tones.notna()
+            if warning_selection.sum() > 0:
+                test_passes = False
+            else:
+                continue
+            for t in report[warning_selection].itertuples():
+                if len(t.added_tones) > 0:
+                    added = f" plus the added {(fifths2sd(t.added_tones, t.localkey_is_minor))} [{scale_degree2name(t.added_tones, t.localkey, t.globalkey)}]"
+                else:
+                    added = ""
+                msg = f"""The label '{t.label}' in m. {t.mn}, onset {t.mn_onset} (MC {t.mc}, onset {t.mc_onset}) seems not to correspond well to the score (which does not necessarily mean it is wrong).
+In the context of {t.globalkey}.{t.localkey}, it expresses the scale degrees {(fifths2sd(t.chord_tones, t.localkey_is_minor))} [{scale_degree2name(t.chord_tones, t.localkey, t.globalkey)}]{added}.
+The corresponding score segment has {t.n_untouched} within-label and {t.n_colored} out-of-label note onsets, a ratio of {t.count_ratio} > {threshold} (the current, arbitrary, threshold).
+If it turns out the label is correct, please add the header of this warning to the IGNORED_WARNINGS, ideally followed by a free-text comment in subsequent lines starting with a space or tab."""
+                piece_logger.warning(msg, extra={'message_id': (19, t.mc, str(t.mc_onset), t.label)})
+    return test_passes
```

### Comparing `ms3-1.2.5/src/ms3/parse.py` & `ms3-1.2.6/src/ms3/parse.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 import re
-from typing import Literal, Collection, Generator, Tuple, Union, Dict, Optional, List, Iterator
+from typing import Literal, Collection, Generator, Tuple, Union, Dict, Optional, List, Iterator, overload
 
 import sys, os
 from collections import Counter, defaultdict
 
 import pandas as pd
 
 from .corpus import Corpus
@@ -698,15 +698,34 @@
                                            choose=choose,
                                            unfold=unfold,
                                            interval_index=interval_index,
                                            flat=flat,
                                            include_empty=include_empty,
                                            concatenate=concatenate,
                                            )
-
+    @overload
+    def get_files(self, facets: FacetArguments = None,
+                  view_name: Optional[str] = None,
+                  parsed: bool = True,
+                  unparsed: bool = True,
+                  choose: Literal['all', 'auto', 'ask'] = 'all',
+                  flat: bool = False,
+                  include_empty=False,
+                  ) -> Dict[CorpusFnameTuple, FileDict]:
+        ...
+    @overload
+    def get_files(self, facets: FacetArguments = None,
+                  view_name: Optional[str] = None,
+                  parsed: bool = True,
+                  unparsed: bool = True,
+                  choose: Literal['all', 'auto', 'ask'] = 'all',
+                  flat: bool = True,
+                  include_empty=False,
+                  ) -> Dict[CorpusFnameTuple, FileList]:
+        ...
     def get_files(self, facets: FacetArguments = None,
                   view_name: Optional[str] = None,
                   parsed: bool = True,
                   unparsed: bool = True,
                   choose: Literal['all', 'auto', 'ask'] = 'all',
                   flat: bool = False,
                   include_empty=False,
```

### Comparing `ms3-1.2.5/src/ms3/piece.py` & `ms3-1.2.6/src/ms3/piece.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/score.py` & `ms3-1.2.6/src/ms3/score.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/transformations.py` & `ms3-1.2.6/src/ms3/transformations.py`

 * *Files identical despite different names*

### Comparing `ms3-1.2.5/src/ms3/utils.py` & `ms3-1.2.6/src/ms3/utils.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13526 +1,13731 @@
-00000000: 696d 706f 7274 2064 6174 6163 6c61 7373  import dataclass
-00000010: 6573 0a69 6d70 6f72 7420 696f 0a69 6d70  es.import io.imp
-00000020: 6f72 7420 6a73 6f6e 0a69 6d70 6f72 7420  ort json.import 
-00000030: 6c6f 6767 696e 670a 696d 706f 7274 206f  logging.import o
-00000040: 732c 7379 732c 2070 6c61 7466 6f72 6d2c  s,sys, platform,
-00000050: 2072 652c 2073 6875 7469 6c2c 2073 7562   re, shutil, sub
-00000060: 7072 6f63 6573 730a 696d 706f 7274 2077  process.import w
-00000070: 6172 6e69 6e67 730a 6672 6f6d 2063 6f6c  arnings.from col
-00000080: 6c65 6374 696f 6e73 2069 6d70 6f72 7420  lections import 
-00000090: 6465 6661 756c 7464 6963 742c 206e 616d  defaultdict, nam
-000000a0: 6564 7475 706c 652c 2043 6f75 6e74 6572  edtuple, Counter
-000000b0: 0a66 726f 6d20 636f 6e74 6578 746c 6962  .from contextlib
-000000c0: 2069 6d70 6f72 7420 636f 6e74 6578 746d   import contextm
-000000d0: 616e 6167 6572 0a66 726f 6d20 6461 7461  anager.from data
-000000e0: 636c 6173 7365 7320 696d 706f 7274 2064  classes import d
-000000f0: 6174 6163 6c61 7373 0a66 726f 6d20 6461  ataclass.from da
-00000100: 7465 7469 6d65 2069 6d70 6f72 7420 6461  tetime import da
-00000110: 7465 7469 6d65 0a66 726f 6d20 6672 6163  tetime.from frac
-00000120: 7469 6f6e 7320 696d 706f 7274 2046 7261  tions import Fra
-00000130: 6374 696f 6e20 6173 2066 7261 630a 6672  ction as frac.fr
-00000140: 6f6d 2066 756e 6374 6f6f 6c73 2069 6d70  om functools imp
-00000150: 6f72 7420 7265 6475 6365 2c20 6c72 755f  ort reduce, lru_
-00000160: 6361 6368 650a 6672 6f6d 2069 6e73 7065  cache.from inspe
-00000170: 6374 2069 6d70 6f72 7420 6765 7466 756c  ct import getful
-00000180: 6c61 7267 7370 6563 2c20 7374 6163 6b0a  largspec, stack.
-00000190: 6672 6f6d 2069 7465 7274 6f6f 6c73 2069  from itertools i
-000001a0: 6d70 6f72 7420 6368 6169 6e2c 2072 6570  mport chain, rep
-000001b0: 6561 742c 2074 616b 6577 6869 6c65 0a66  eat, takewhile.f
-000001c0: 726f 6d20 7368 7574 696c 2069 6d70 6f72  rom shutil impor
-000001d0: 7420 7768 6963 680a 6672 6f6d 2074 656d  t which.from tem
-000001e0: 7066 696c 6520 696d 706f 7274 204e 616d  pfile import Nam
-000001f0: 6564 5465 6d70 6f72 6172 7946 696c 6520  edTemporaryFile 
-00000200: 6173 2054 656d 700a 6672 6f6d 2074 7970  as Temp.from typ
-00000210: 696e 6720 696d 706f 7274 2043 6f6c 6c65  ing import Colle
-00000220: 6374 696f 6e2c 2055 6e69 6f6e 2c20 4469  ction, Union, Di
-00000230: 6374 2c20 5475 706c 652c 204c 6973 742c  ct, Tuple, List,
-00000240: 2049 7465 7261 626c 652c 204c 6974 6572   Iterable, Liter
-00000250: 616c 2c20 4f70 7469 6f6e 616c 2c20 5479  al, Optional, Ty
-00000260: 7065 5661 722c 2041 6e79 2c20 6f76 6572  peVar, Any, over
-00000270: 6c6f 6164 2c20 4361 6c6c 6162 6c65 2c20  load, Callable, 
-00000280: 4974 6572 6174 6f72 0a66 726f 6d20 7a69  Iterator.from zi
-00000290: 7066 696c 6520 696d 706f 7274 205a 6970  pfile import Zip
-000002a0: 4669 6c65 2061 7320 5a69 700a 0a69 6d70  File as Zip..imp
-000002b0: 6f72 7420 6769 740a 696d 706f 7274 2070  ort git.import p
-000002c0: 616e 6461 7320 6173 2070 640a 696d 706f  andas as pd.impo
-000002d0: 7274 206e 756d 7079 2061 7320 6e70 0a69  rt numpy as np.i
-000002e0: 6d70 6f72 7420 7765 6263 6f6c 6f72 730a  mport webcolors.
-000002f0: 6672 6f6d 2067 6974 6462 2e65 7863 2069  from gitdb.exc i
-00000300: 6d70 6f72 7420 4261 644e 616d 650a 6672  mport BadName.fr
-00000310: 6f6d 206e 756d 7079 2e74 7970 696e 6720  om numpy.typing 
-00000320: 696d 706f 7274 204e 4441 7272 6179 0a66  import NDArray.f
-00000330: 726f 6d20 7061 6e64 6173 2e5f 7479 7069  rom pandas._typi
-00000340: 6e67 2069 6d70 6f72 7420 4474 7970 650a  ng import Dtype.
-00000350: 6672 6f6d 2070 616e 6461 732e 6572 726f  from pandas.erro
-00000360: 7273 2069 6d70 6f72 7420 456d 7074 7944  rs import EmptyD
-00000370: 6174 6145 7272 6f72 0a66 726f 6d20 7061  ataError.from pa
-00000380: 7468 6f73 2069 6d70 6f72 7420 6d75 6c74  thos import mult
-00000390: 6970 726f 6365 7373 696e 670a 6672 6f6d  iprocessing.from
-000003a0: 2074 7164 6d20 696d 706f 7274 2074 7164   tqdm import tqd
-000003b0: 6d0a 6672 6f6d 2070 7974 6162 6c65 7772  m.from pytablewr
-000003c0: 6974 6572 2069 6d70 6f72 7420 4d61 726b  iter import Mark
-000003d0: 646f 776e 5461 626c 6557 7269 7465 720a  downTableWriter.
-000003e0: 0a66 726f 6d20 2e6c 6f67 6765 7220 696d  .from .logger im
-000003f0: 706f 7274 2066 756e 6374 696f 6e5f 6c6f  port function_lo
-00000400: 6767 6572 2c20 7570 6461 7465 5f63 6667  gger, update_cfg
-00000410: 2c20 4c6f 6743 6170 7475 7265 720a 6672  , LogCapturer.fr
-00000420: 6f6d 202e 5f74 7970 696e 6720 696d 706f  om ._typing impo
-00000430: 7274 2046 696c 6544 6963 742c 2046 6163  rt FileDict, Fac
-00000440: 6574 2c20 5669 6577 4469 6374 2c20 4669  et, ViewDict, Fi
-00000450: 6c65 4461 7461 6672 616d 6554 7570 6c65  leDataframeTuple
-00000460: 4d61 7962 650a 0a4d 5333 5f56 4552 5349  Maybe..MS3_VERSI
-00000470: 4f4e 203d 2027 312e 322e 3527 0a4c 4154  ON = '1.2.5'.LAT
-00000480: 4553 545f 4d55 5345 5343 4f52 455f 5645  EST_MUSESCORE_VE
-00000490: 5253 494f 4e20 3d20 2733 2e36 2e32 270a  RSION = '3.6.2'.
-000004a0: 434f 4d50 5554 4544 5f4d 4554 4144 4154  COMPUTED_METADAT
-000004b0: 415f 434f 4c55 4d4e 5320 3d20 5b27 5469  A_COLUMNS = ['Ti
-000004c0: 6d65 5369 6727 2c20 274b 6579 5369 6727  meSig', 'KeySig'
-000004d0: 2c20 276c 6173 745f 6d63 272c 2027 6c61  , 'last_mc', 'la
-000004e0: 7374 5f6d 6e27 2c20 276c 656e 6774 685f  st_mn', 'length_
-000004f0: 7162 272c 2027 6c61 7374 5f6d 635f 756e  qb', 'last_mc_un
-00000500: 666f 6c64 6564 272c 2027 6c61 7374 5f6d  folded', 'last_m
-00000510: 6e5f 756e 666f 6c64 6564 272c 2027 6c65  n_unfolded', 'le
-00000520: 6e67 7468 5f71 625f 756e 666f 6c64 6564  ngth_qb_unfolded
-00000530: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00000540: 2020 2020 2020 2020 2020 2020 2776 6f6c              'vol
-00000550: 7461 5f6d 6373 272c 2027 616c 6c5f 6e6f  ta_mcs', 'all_no
-00000560: 7465 735f 7162 272c 2027 6e5f 6f6e 7365  tes_qb', 'n_onse
-00000570: 7473 272c 2027 6e5f 6f6e 7365 745f 706f  ts', 'n_onset_po
-00000580: 7369 7469 6f6e 7327 2c0a 2020 2020 2020  sitions',.      
-00000590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000005a0: 2020 2027 6775 6974 6172 5f63 686f 7264     'guitar_chord
-000005b0: 5f63 6f75 6e74 272c 2027 666f 726d 5f6c  _count', 'form_l
-000005c0: 6162 656c 5f63 6f75 6e74 272c 2027 6c61  abel_count', 'la
-000005d0: 6265 6c5f 636f 756e 7427 2c20 2761 6e6e  bel_count', 'ann
-000005e0: 6f74 6174 6564 5f6b 6579 272c 205d 0a22  otated_key', ]."
-000005f0: 2222 4175 746f 6d61 7469 6361 6c6c 7920  ""Automatically 
-00000600: 636f 6d70 7574 6564 2063 6f6c 756d 6e73  computed columns
-00000610: 2222 220a 0a44 434d 4c5f 4d45 5441 4441  """..DCML_METADA
-00000620: 5441 5f43 4f4c 554d 4e53 203d 205b 2768  TA_COLUMNS = ['h
-00000630: 6172 6d6f 6e79 5f76 6572 7369 6f6e 272c  armony_version',
-00000640: 2027 616e 6e6f 7461 746f 7273 272c 2027   'annotators', '
-00000650: 7265 7669 6577 6572 7327 2c20 2773 636f  reviewers', 'sco
-00000660: 7265 5f69 6e74 6567 7269 7479 272c 2027  re_integrity', '
-00000670: 636f 6d70 6f73 6564 5f73 7461 7274 272c  composed_start',
-00000680: 2027 636f 6d70 6f73 6564 5f65 6e64 272c   'composed_end',
-00000690: 2027 636f 6d70 6f73 6564 5f73 6f75 7263   'composed_sourc
-000006a0: 6527 5d0a 2222 2241 7262 6974 7261 7279  e']."""Arbitrary
-000006b0: 2063 6f6c 756d 6e20 6e61 6d65 7320 7573   column names us
-000006c0: 6564 2069 6e20 7468 6520 4443 4d4c 2063  ed in the DCML c
-000006d0: 6f72 7075 7320 696e 6974 6961 7469 7665  orpus initiative
-000006e0: 2222 220a 0a0a 4d55 5345 5343 4f52 455f  """...MUSESCORE_
-000006f0: 4d45 5441 4441 5441 5f46 4945 4c44 5320  METADATA_FIELDS 
-00000700: 3d20 5b27 636f 6d70 6f73 6572 272c 2027  = ['composer', '
-00000710: 776f 726b 5469 746c 6527 2c20 276d 6f76  workTitle', 'mov
-00000720: 656d 656e 744e 756d 6265 7227 2c20 276d  ementNumber', 'm
-00000730: 6f76 656d 656e 7454 6974 6c65 272c 0a20  ovementTitle',. 
-00000740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000750: 2020 2020 2020 2020 2777 6f72 6b4e 756d          'workNum
-00000760: 6265 7227 2c20 2770 6f65 7427 2c20 276c  ber', 'poet', 'l
-00000770: 7972 6963 6973 7427 2c20 2761 7272 616e  yricist', 'arran
-00000780: 6765 7227 2c20 2763 6f70 7972 6967 6874  ger', 'copyright
-00000790: 272c 2027 6372 6561 7469 6f6e 4461 7465  ', 'creationDate
-000007a0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-000007b0: 2020 2020 2020 2020 2020 2020 276d 7363              'msc
-000007c0: 5665 7273 696f 6e27 2c20 2770 6c61 7466  Version', 'platf
-000007d0: 6f72 6d27 2c20 2773 6f75 7263 6527 2c20  orm', 'source', 
-000007e0: 2774 7261 6e73 6c61 746f 7227 2c5d 0a22  'translator',]."
-000007f0: 2222 4465 6661 756c 7420 6669 656c 6473  ""Default fields
-00000800: 2061 7661 696c 6162 6c65 2069 6e20 7468   available in th
-00000810: 6520 4669 6c65 202d 3e20 5363 6f72 6520  e File -> Score 
-00000820: 5072 6f70 6572 7469 6573 2e2e 2e20 6d65  Properties... me
-00000830: 6e75 2e22 2222 0a0a 5645 5253 494f 4e5f  nu."""..VERSION_
-00000840: 434f 4c55 4d4e 5320 3d20 5b27 6d75 7365  COLUMNS = ['muse
-00000850: 7363 6f72 6527 2c20 276d 7333 5f76 6572  score', 'ms3_ver
-00000860: 7369 6f6e 272c 5d0a 2222 2253 6f66 7477  sion',]."""Softw
-00000870: 6172 6520 7665 7273 696f 6e73 2222 220a  are versions""".
-00000880: 0a49 4e53 5452 554d 454e 545f 5245 4c41  .INSTRUMENT_RELA
-00000890: 5445 445f 434f 4c55 4d4e 5320 3d20 5b27  TED_COLUMNS = ['
-000008a0: 6861 735f 6472 756d 7365 7427 2c20 2761  has_drumset', 'a
-000008b0: 6d62 6974 7573 275d 0a0a 4d55 5345 5343  mbitus']..MUSESC
-000008c0: 4f52 455f 4845 4144 4552 5f46 4945 4c44  ORE_HEADER_FIELD
-000008d0: 5320 3d20 5b27 7469 746c 655f 7465 7874  S = ['title_text
-000008e0: 272c 2027 7375 6274 6974 6c65 5f74 6578  ', 'subtitle_tex
-000008f0: 7427 2c20 276c 7972 6963 6973 745f 7465  t', 'lyricist_te
-00000900: 7874 272c 2027 636f 6d70 6f73 6572 5f74  xt', 'composer_t
-00000910: 6578 7427 2c20 2770 6172 745f 6e61 6d65  ext', 'part_name
-00000920: 5f74 6578 7427 2c5d 0a22 2222 4465 6661  _text',]."""Defa
-00000930: 756c 7420 7465 7874 2066 6965 6c64 7320  ult text fields 
-00000940: 696e 204d 7573 6553 636f 7265 2222 220a  in MuseScore""".
-00000950: 0a4f 5448 4552 5f43 4f4c 554d 4e53 203d  .OTHER_COLUMNS =
-00000960: 205b 2773 7562 6469 7265 6374 6f72 7927   ['subdirectory'
-00000970: 2c20 2772 656c 5f70 6174 6827 2c5d 0a0a  , 'rel_path',]..
-00000980: 4c45 4741 4359 5f43 4f4c 554d 4e53 203d  LEGACY_COLUMNS =
-00000990: 205b 2766 6e61 6d65 7327 2c20 2772 656c   ['fnames', 'rel
-000009a0: 5f70 6174 6873 272c 2027 6d64 3527 2c5d  _paths', 'md5',]
-000009b0: 0a0a 4155 544f 4d41 5449 435f 434f 4c55  ..AUTOMATIC_COLU
-000009c0: 4d4e 5320 3d20 434f 4d50 5554 4544 5f4d  MNS = COMPUTED_M
-000009d0: 4554 4144 4154 415f 434f 4c55 4d4e 5320  ETADATA_COLUMNS 
-000009e0: 2b20 5645 5253 494f 4e5f 434f 4c55 4d4e  + VERSION_COLUMN
-000009f0: 5320 2b20 494e 5354 5255 4d45 4e54 5f52  S + INSTRUMENT_R
-00000a00: 454c 4154 4544 5f43 4f4c 554d 4e53 202b  ELATED_COLUMNS +
-00000a10: 204f 5448 4552 5f43 4f4c 554d 4e53 0a22   OTHER_COLUMNS."
-00000a20: 2222 5468 6973 2063 6f6d 6269 6e61 7469  ""This combinati
-00000a30: 6f6e 206f 6620 636f 6c75 6d6e 206e 616d  on of column nam
-00000a40: 6573 2069 7320 6578 636c 7564 6564 2077  es is excluded w
-00000a50: 6865 6e20 7570 6461 7469 6e67 206d 6574  hen updating met
-00000a60: 6164 6174 6120 6669 656c 6473 2069 6e20  adata fields in 
-00000a70: 4d75 7365 5363 6f72 6520 6669 6c65 7320  MuseScore files 
-00000a80: 7669 6120 6d73 3320 6d65 7461 6461 7461  via ms3 metadata
-00000a90: 2e22 2222 0a0a 4d45 5441 4441 5441 5f43  ."""..METADATA_C
-00000aa0: 4f4c 554d 4e5f 4f52 4445 5220 3d20 5b27  OLUMN_ORDER = ['
-00000ab0: 666e 616d 6527 5d20 2b20 434f 4d50 5554  fname'] + COMPUT
-00000ac0: 4544 5f4d 4554 4144 4154 415f 434f 4c55  ED_METADATA_COLU
-00000ad0: 4d4e 5320 2b20 4443 4d4c 5f4d 4554 4144  MNS + DCML_METAD
-00000ae0: 4154 415f 434f 4c55 4d4e 5320 2b20 4d55  ATA_COLUMNS + MU
-00000af0: 5345 5343 4f52 455f 4d45 5441 4441 5441  SESCORE_METADATA
-00000b00: 5f46 4945 4c44 5320 2b20 4d55 5345 5343  _FIELDS + MUSESC
-00000b10: 4f52 455f 4845 4144 4552 5f46 4945 4c44  ORE_HEADER_FIELD
-00000b20: 5320 2b20 5645 5253 494f 4e5f 434f 4c55  S + VERSION_COLU
-00000b30: 4d4e 5320 2b20 4f54 4845 525f 434f 4c55  MNS + OTHER_COLU
-00000b40: 4d4e 5320 2b20 494e 5354 5255 4d45 4e54  MNS + INSTRUMENT
-00000b50: 5f52 454c 4154 4544 5f43 4f4c 554d 4e53  _RELATED_COLUMNS
-00000b60: 0a22 2222 5468 6520 6465 6661 756c 7420  ."""The default 
-00000b70: 6f72 6465 7220 696e 2077 6869 6368 2063  order in which c
-00000b80: 6f6c 756d 6e73 206f 6620 6d65 7461 6461  olumns of metada
-00000b90: 7461 2e74 7376 2066 696c 6573 2061 7265  ta.tsv files are
-00000ba0: 2074 6f20 6265 2073 6f72 7465 642e 2222   to be sorted.""
-00000bb0: 220a 0a53 434f 5245 5f45 5854 454e 5349  "..SCORE_EXTENSI
-00000bc0: 4f4e 5320 3d20 2827 2e6d 7363 7827 2c20  ONS = ('.mscx', 
-00000bd0: 272e 6d73 637a 272c 2027 2e63 6170 272c  '.mscz', '.cap',
-00000be0: 2027 2e63 6170 7827 2c20 272e 6d69 6469   '.capx', '.midi
-00000bf0: 272c 2027 2e6d 6964 272c 2027 2e6d 7573  ', '.mid', '.mus
-00000c00: 6963 786d 6c27 2c20 272e 6d78 6c27 2c20  icxml', '.mxl', 
-00000c10: 272e 786d 6c27 290a 0a53 5441 4e44 4152  '.xml')..STANDAR
-00000c20: 445f 434f 4c55 4d4e 5f4f 5244 4552 203d  D_COLUMN_ORDER =
-00000c30: 205b 0a20 2020 2027 6d63 272c 2027 6d63   [.    'mc', 'mc
-00000c40: 5f70 6c61 7974 6872 6f75 6768 272c 2027  _playthrough', '
-00000c50: 6d6e 272c 2027 6d6e 5f70 6c61 7974 6872  mn', 'mn_playthr
-00000c60: 6f75 6768 272c 2027 7175 6172 7465 7262  ough', 'quarterb
-00000c70: 6561 7473 272c 2027 6d63 5f6f 6e73 6574  eats', 'mc_onset
-00000c80: 272c 2027 6d6e 5f6f 6e73 6574 272c 2027  ', 'mn_onset', '
-00000c90: 6265 6174 272c 0a20 2020 2027 6576 656e  beat',.    'even
-00000ca0: 7427 2c20 2774 696d 6573 6967 272c 2027  t', 'timesig', '
-00000cb0: 7374 6166 6627 2c20 2776 6f69 6365 272c  staff', 'voice',
-00000cc0: 2027 6475 7261 7469 6f6e 272c 2027 7469   'duration', 'ti
-00000cd0: 6564 272c 0a20 2020 2027 6772 6163 656e  ed',.    'gracen
-00000ce0: 6f74 6527 2c20 276e 6f6d 696e 616c 5f64  ote', 'nominal_d
-00000cf0: 7572 6174 696f 6e27 2c20 2773 6361 6c61  uration', 'scala
-00000d00: 7227 2c20 2774 7063 272c 2027 6d69 6469  r', 'tpc', 'midi
-00000d10: 272c 2027 766f 6c74 6127 2c20 2763 686f  ', 'volta', 'cho
-00000d20: 7264 5f69 6427 5d0a 0a53 5441 4e44 4152  rd_id']..STANDAR
-00000d30: 445f 4e41 4d45 5320 3d20 5b27 6e6f 7465  D_NAMES = ['note
-00000d40: 735f 616e 645f 7265 7374 7327 2c20 2772  s_and_rests', 'r
-00000d50: 6573 7473 272c 2027 6e6f 7465 7327 2c20  ests', 'notes', 
-00000d60: 276d 6561 7375 7265 7327 2c20 2765 7665  'measures', 'eve
-00000d70: 6e74 7327 2c20 276c 6162 656c 7327 2c20  nts', 'labels', 
-00000d80: 2763 686f 7264 7327 2c20 2765 7870 616e  'chords', 'expan
-00000d90: 6465 6427 2c0a 2020 2020 2020 2020 2020  ded',.          
-00000da0: 2020 2020 2020 2020 2768 6172 6d6f 6e69          'harmoni
-00000db0: 6573 272c 2027 6361 6465 6e63 6573 272c  es', 'cadences',
-00000dc0: 2027 666f 726d 5f6c 6162 656c 7327 2c20   'form_labels', 
-00000dd0: 274d 5333 272c 2027 7363 6f72 6573 275d  'MS3', 'scores']
-00000de0: 0a22 2222 3a6f 626a 3a60 6c69 7374 600a  .""":obj:`list`.
-00000df0: 496e 6469 6361 746f 7273 2066 6f72 2063  Indicators for c
-00000e00: 6f72 706f 7261 3a20 4966 2061 2066 6f6c  orpora: If a fol
-00000e10: 6465 7220 636f 6e74 6169 6e73 2061 6e79  der contains any
-00000e20: 2066 696c 6520 6f72 2066 6f6c 6465 7220   file or folder 
-00000e30: 6265 6769 6e6e 696e 6720 6f72 2065 6e64  beginning or end
-00000e40: 696e 6720 6f6e 2061 6e79 206f 6620 7468  ing on any of th
-00000e50: 6573 6520 6e61 6d65 732c 2069 7420 6973  ese names, it is
-00000e60: 200a 636f 6e73 6964 6572 6564 2074 6f20   .considered to 
-00000e70: 6265 2061 2063 6f72 7075 7320 6279 2074  be a corpus by t
-00000e80: 6865 2066 756e 6374 696f 6e20 3a70 793a  he function :py:
-00000e90: 6675 6e63 3a60 6974 6572 6174 655f 636f  func:`iterate_co
-00000ea0: 7270 6f72 6160 2e0a 2222 220a 0a53 5441  rpora`.."""..STA
-00000eb0: 4e44 4152 445f 4e41 4d45 535f 4f52 5f47  NDARD_NAMES_OR_G
-00000ec0: 4954 203d 2053 5441 4e44 4152 445f 4e41  IT = STANDARD_NA
-00000ed0: 4d45 5320 2b20 5b22 2e67 6974 225d 0a0a  MES + [".git"]..
-00000ee0: 0a44 434d 4c5f 5245 4745 5820 3d20 7265  .DCML_REGEX = re
-00000ef0: 2e63 6f6d 7069 6c65 2872 2222 220a 5e28  .compile(r""".^(
-00000f00: 5c2e 3f0a 2020 2020 2828 3f50 3c67 6c6f  \.?.    ((?P<glo
-00000f10: 6261 6c6b 6579 3e5b 612d 6741 2d47 5d28  balkey>[a-gA-G](
-00000f20: 622a 7c5c 232a 2929 5c2e 293f 0a20 2020  b*|\#*))\.)?.   
-00000f30: 2028 283f 503c 6c6f 6361 6c6b 6579 3e28   ((?P<localkey>(
-00000f40: 2862 2a7c 5c23 2a29 2856 4949 7c56 497c  (b*|\#*)(VII|VI|
-00000f50: 567c 4956 7c49 4949 7c49 497c 497c 7669  V|IV|III|II|I|vi
-00000f60: 697c 7669 7c76 7c69 767c 6969 697c 6969  i|vi|v|iv|iii|ii
-00000f70: 7c69 292f 3f29 2b29 5c2e 293f 0a20 2020  |i)/?)+)\.)?.   
-00000f80: 2028 283f 503c 7065 6461 6c3e 2828 622a   ((?P<pedal>((b*
-00000f90: 7c5c 232a 2928 5649 497c 5649 7c56 7c49  |\#*)(VII|VI|V|I
-00000fa0: 567c 4949 497c 4949 7c49 7c76 6969 7c76  V|III|II|I|vii|v
-00000fb0: 697c 767c 6976 7c69 6969 7c69 697c 6929  i|v|iv|iii|ii|i)
-00000fc0: 2f3f 292b 295c 5b29 3f0a 2020 2020 283f  /?)+)\[)?.    (?
-00000fd0: 503c 6368 6f72 643e 0a20 2020 2020 2020  P<chord>.       
-00000fe0: 2028 3f50 3c6e 756d 6572 616c 3e28 622a   (?P<numeral>(b*
-00000ff0: 7c5c 232a 2928 5649 497c 5649 7c56 7c49  |\#*)(VII|VI|V|I
-00001000: 567c 4949 497c 4949 7c49 7c76 6969 7c76  V|III|II|I|vii|v
-00001010: 697c 767c 6976 7c69 6969 7c69 697c 697c  i|v|iv|iii|ii|i|
-00001020: 4765 727c 4974 7c46 727c 406e 6f6e 6529  Ger|It|Fr|@none)
-00001030: 290a 2020 2020 2020 2020 283f 503c 666f  ).        (?P<fo
-00001040: 726d 3e28 257c 6f7c 5c2b 7c4d 7c5c 2b4d  rm>(%|o|\+|M|\+M
-00001050: 2929 3f0a 2020 2020 2020 2020 283f 503c  ))?.        (?P<
-00001060: 6669 6762 6173 733e 2837 7c36 357c 3433  figbass>(7|65|43
-00001070: 7c34 327c 327c 3634 7c36 2929 3f0a 2020  |42|2|64|6))?.  
-00001080: 2020 2020 2020 285c 2828 3f50 3c63 6861        (\((?P<cha
-00001090: 6e67 6573 3e28 285c 2b7c 2d7c 5c5e 7c76  nges>((\+|-|\^|v
-000010a0: 293f 2862 2a7c 5c23 2a29 5c64 292b 295c  )?(b*|\#*)\d)+)\
-000010b0: 2929 3f0a 2020 2020 2020 2020 282f 283f  ))?.        (/(?
-000010c0: 503c 7265 6c61 7469 7665 726f 6f74 3e28  P<relativeroot>(
-000010d0: 2862 2a7c 5c23 2a29 2856 4949 7c56 497c  (b*|\#*)(VII|VI|
-000010e0: 567c 4956 7c49 4949 7c49 497c 497c 7669  V|IV|III|II|I|vi
-000010f0: 697c 7669 7c76 7c69 767c 6969 697c 6969  i|vi|v|iv|iii|ii
-00001100: 7c69 292f 3f29 2a29 293f 0a20 2020 2029  |i)/?)*))?.    )
-00001110: 0a20 2020 2028 3f50 3c70 6564 616c 656e  .    (?P<pedalen
-00001120: 643e 5c5d 293f 0a29 3f0a 285c 7c28 3f50  d>\])?.)?.(\|(?P
-00001130: 3c63 6164 656e 6365 3e28 2848 437c 5041  <cadence>((HC|PA
-00001140: 437c 4941 437c 4443 7c45 437c 5043 2928  C|IAC|DC|EC|PC)(
-00001150: 5c2e 2e2b 3f29 3f29 2929 3f0a 283f 503c  \..+?)?)))?.(?P<
-00001160: 7068 7261 7365 656e 643e 285c 5c5c 5c7c  phraseend>(\\\\|
-00001170: 5c7d 5c7b 7c5c 7b7c 5c7d 2929 3f24 0a20  \}\{|\{|\}))?$. 
-00001180: 2020 2020 2020 2020 2020 2022 2222 2c20             """, 
-00001190: 7265 2e56 4552 424f 5345 290a 2222 223a  re.VERBOSE).""":
-000011a0: 6f62 6a3a 6073 7472 600a 436f 6e73 7461  obj:`str`.Consta
-000011b0: 6e74 2077 6974 6820 6120 7265 6775 6c61  nt with a regula
-000011c0: 7220 6578 7072 6573 7369 6f6e 2074 6861  r expression tha
-000011d0: 7420 7265 636f 676e 697a 6573 206c 6162  t recognizes lab
-000011e0: 656c 7320 636f 6e66 6f72 6d69 6e67 2074  els conforming t
-000011f0: 6f20 7468 6520 4443 4d4c 2068 6172 6d6f  o the DCML harmo
-00001200: 6e79 2061 6e6e 6f74 6174 696f 6e20 7374  ny annotation st
-00001210: 616e 6461 7264 2065 7863 6c75 6469 6e67  andard excluding
-00001220: 2074 686f 7365 0a63 6f6e 7369 7374 696e   those.consistin
-00001230: 6720 6f66 2074 776f 2061 6c74 6572 6e61  g of two alterna
-00001240: 7469 7665 732e 0a22 2222 0a0a 4443 4d4c  tives.."""..DCML
-00001250: 5f44 4f55 424c 455f 5245 4745 5820 3d20  _DOUBLE_REGEX = 
-00001260: 7265 2e63 6f6d 7069 6c65 2872 2222 220a  re.compile(r""".
-00001270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001290: 5e28 3f50 3c66 6972 7374 3e0a 2020 2020  ^(?P<first>.    
-000012a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012b0: 2020 2020 2020 2020 2020 2020 2020 285c                (\
-000012c0: 2e3f 0a20 2020 2020 2020 2020 2020 2020  .?.             
-000012d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012e0: 2020 2020 2020 2028 283f 503c 676c 6f62         ((?P<glob
-000012f0: 616c 6b65 793e 5b61 2d67 412d 475d 2862  alkey>[a-gA-G](b
-00001300: 2a7c 5c23 2a29 295c 2e29 3f0a 2020 2020  *|\#*))\.)?.    
-00001310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001330: 2828 3f50 3c6c 6f63 616c 6b65 793e 2828  ((?P<localkey>((
-00001340: 622a 7c5c 232a 2928 5649 497c 5649 7c56  b*|\#*)(VII|VI|V
-00001350: 7c49 567c 4949 497c 4949 7c49 7c76 6969  |IV|III|II|I|vii
-00001360: 7c76 697c 767c 6976 7c69 6969 7c69 697c  |vi|v|iv|iii|ii|
-00001370: 6929 2f3f 292b 295c 2e29 3f0a 2020 2020  i)/?)+)\.)?.    
-00001380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000013a0: 2828 3f50 3c70 6564 616c 3e28 2862 2a7c  ((?P<pedal>((b*|
-000013b0: 5c23 2a29 2856 4949 7c56 497c 567c 4956  \#*)(VII|VI|V|IV
-000013c0: 7c49 4949 7c49 497c 497c 7669 697c 7669  |III|II|I|vii|vi
-000013d0: 7c76 7c69 767c 6969 697c 6969 7c69 292f  |v|iv|iii|ii|i)/
-000013e0: 3f29 2b29 5c5b 293f 0a20 2020 2020 2020  ?)+)\[)?.       
-000013f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001400: 2020 2020 2020 2020 2020 2020 2028 3f50               (?P
-00001410: 3c63 686f 7264 3e0a 2020 2020 2020 2020  <chord>.        
-00001420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001440: 283f 503c 6e75 6d65 7261 6c3e 2862 2a7c  (?P<numeral>(b*|
-00001450: 5c23 2a29 2856 4949 7c56 497c 567c 4956  \#*)(VII|VI|V|IV
-00001460: 7c49 4949 7c49 497c 497c 7669 697c 7669  |III|II|I|vii|vi
-00001470: 7c76 7c69 767c 6969 697c 6969 7c69 7c47  |v|iv|iii|ii|i|G
-00001480: 6572 7c49 747c 4672 7c40 6e6f 6e65 2929  er|It|Fr|@none))
-00001490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000014a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014b0: 2020 2020 2020 2020 2028 3f50 3c66 6f72           (?P<for
-000014c0: 6d3e 2825 7c6f 7c5c 2b7c 4d7c 5c2b 4d29  m>(%|o|\+|M|\+M)
-000014d0: 293f 0a20 2020 2020 2020 2020 2020 2020  )?.             
-000014e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014f0: 2020 2020 2020 2020 2020 2028 3f50 3c66             (?P<f
-00001500: 6967 6261 7373 3e28 377c 3635 7c34 337c  igbass>(7|65|43|
-00001510: 3432 7c32 7c36 347c 3629 293f 0a20 2020  42|2|64|6))?.   
-00001520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001540: 2020 2020 2028 5c28 283f 503c 6368 616e       (\((?P<chan
-00001550: 6765 733e 2828 5c2b 7c2d 7c5c 5e7c 7629  ges>((\+|-|\^|v)
-00001560: 3f28 622a 7c5c 232a 295c 6429 2b29 5c29  ?(b*|\#*)\d)+)\)
-00001570: 293f 0a20 2020 2020 2020 2020 2020 2020  )?.             
-00001580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001590: 2020 2020 2020 2020 2020 2028 2f28 3f50             (/(?P
-000015a0: 3c72 656c 6174 6976 6572 6f6f 743e 2828  <relativeroot>((
-000015b0: 622a 7c5c 232a 2928 5649 497c 5649 7c56  b*|\#*)(VII|VI|V
-000015c0: 7c49 567c 4949 497c 4949 7c49 7c76 6969  |IV|III|II|I|vii
-000015d0: 7c76 697c 767c 6976 7c69 6969 7c69 697c  |vi|v|iv|iii|ii|
-000015e0: 6929 2f3f 292a 2929 3f0a 2020 2020 2020  i)/?)*))?.      
-000015f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001600: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00000000: 696d 706f 7274 2069 6f0a 696d 706f 7274  import io.import
+00000010: 206a 736f 6e0a 696d 706f 7274 206c 6f67   json.import log
+00000020: 6769 6e67 0a69 6d70 6f72 7420 6f73 2c73  ging.import os,s
+00000030: 7973 2c20 706c 6174 666f 726d 2c20 7265  ys, platform, re
+00000040: 2c20 7368 7574 696c 2c20 7375 6270 726f  , shutil, subpro
+00000050: 6365 7373 0a69 6d70 6f72 7420 7761 726e  cess.import warn
+00000060: 696e 6773 0a66 726f 6d20 636f 6c6c 6563  ings.from collec
+00000070: 7469 6f6e 7320 696d 706f 7274 2064 6566  tions import def
+00000080: 6175 6c74 6469 6374 2c20 6e61 6d65 6474  aultdict, namedt
+00000090: 7570 6c65 2c20 436f 756e 7465 720a 6672  uple, Counter.fr
+000000a0: 6f6d 2063 6f6e 7465 7874 6c69 6220 696d  om contextlib im
+000000b0: 706f 7274 2063 6f6e 7465 7874 6d61 6e61  port contextmana
+000000c0: 6765 720a 6672 6f6d 2064 6174 6163 6c61  ger.from datacla
+000000d0: 7373 6573 2069 6d70 6f72 7420 6461 7461  sses import data
+000000e0: 636c 6173 732c 2072 6570 6c61 6365 0a66  class, replace.f
+000000f0: 726f 6d20 6461 7465 7469 6d65 2069 6d70  rom datetime imp
+00000100: 6f72 7420 6461 7465 7469 6d65 0a66 726f  ort datetime.fro
+00000110: 6d20 6672 6163 7469 6f6e 7320 696d 706f  m fractions impo
+00000120: 7274 2046 7261 6374 696f 6e20 6173 2066  rt Fraction as f
+00000130: 7261 630a 6672 6f6d 2066 756e 6374 6f6f  rac.from functoo
+00000140: 6c73 2069 6d70 6f72 7420 7265 6475 6365  ls import reduce
+00000150: 2c20 6c72 755f 6361 6368 650a 6672 6f6d  , lru_cache.from
+00000160: 2069 6e73 7065 6374 2069 6d70 6f72 7420   inspect import 
+00000170: 6765 7466 756c 6c61 7267 7370 6563 2c20  getfullargspec, 
+00000180: 7374 6163 6b0a 6672 6f6d 2069 7465 7274  stack.from itert
+00000190: 6f6f 6c73 2069 6d70 6f72 7420 6368 6169  ools import chai
+000001a0: 6e2c 2072 6570 6561 742c 2074 616b 6577  n, repeat, takew
+000001b0: 6869 6c65 0a66 726f 6d20 7368 7574 696c  hile.from shutil
+000001c0: 2069 6d70 6f72 7420 7768 6963 680a 6672   import which.fr
+000001d0: 6f6d 2074 656d 7066 696c 6520 696d 706f  om tempfile impo
+000001e0: 7274 204e 616d 6564 5465 6d70 6f72 6172  rt NamedTemporar
+000001f0: 7946 696c 6520 6173 2054 656d 700a 6672  yFile as Temp.fr
+00000200: 6f6d 2074 7970 696e 6720 696d 706f 7274  om typing import
+00000210: 2043 6f6c 6c65 6374 696f 6e2c 2055 6e69   Collection, Uni
+00000220: 6f6e 2c20 4469 6374 2c20 5475 706c 652c  on, Dict, Tuple,
+00000230: 204c 6973 742c 2049 7465 7261 626c 652c   List, Iterable,
+00000240: 204c 6974 6572 616c 2c20 4f70 7469 6f6e   Literal, Option
+00000250: 616c 2c20 5479 7065 5661 722c 2041 6e79  al, TypeVar, Any
+00000260: 2c20 6f76 6572 6c6f 6164 2c20 4361 6c6c  , overload, Call
+00000270: 6162 6c65 2c20 4974 6572 6174 6f72 0a66  able, Iterator.f
+00000280: 726f 6d20 7a69 7066 696c 6520 696d 706f  rom zipfile impo
+00000290: 7274 205a 6970 4669 6c65 2061 7320 5a69  rt ZipFile as Zi
+000002a0: 700a 0a69 6d70 6f72 7420 6769 740a 696d  p..import git.im
+000002b0: 706f 7274 2070 616e 6461 7320 6173 2070  port pandas as p
+000002c0: 640a 696d 706f 7274 206e 756d 7079 2061  d.import numpy a
+000002d0: 7320 6e70 0a69 6d70 6f72 7420 7765 6263  s np.import webc
+000002e0: 6f6c 6f72 730a 6672 6f6d 2067 6974 6462  olors.from gitdb
+000002f0: 2e65 7863 2069 6d70 6f72 7420 4261 644e  .exc import BadN
+00000300: 616d 650a 6672 6f6d 206e 756d 7079 2e74  ame.from numpy.t
+00000310: 7970 696e 6720 696d 706f 7274 204e 4441  yping import NDA
+00000320: 7272 6179 0a66 726f 6d20 7061 6e64 6173  rray.from pandas
+00000330: 2e5f 7479 7069 6e67 2069 6d70 6f72 7420  ._typing import 
+00000340: 4474 7970 650a 6672 6f6d 2070 616e 6461  Dtype.from panda
+00000350: 732e 6572 726f 7273 2069 6d70 6f72 7420  s.errors import 
+00000360: 456d 7074 7944 6174 6145 7272 6f72 0a66  EmptyDataError.f
+00000370: 726f 6d20 7061 7468 6f73 2069 6d70 6f72  rom pathos impor
+00000380: 7420 6d75 6c74 6970 726f 6365 7373 696e  t multiprocessin
+00000390: 670a 6672 6f6d 2074 7164 6d20 696d 706f  g.from tqdm impo
+000003a0: 7274 2074 7164 6d0a 6672 6f6d 2070 7974  rt tqdm.from pyt
+000003b0: 6162 6c65 7772 6974 6572 2069 6d70 6f72  ablewriter impor
+000003c0: 7420 4d61 726b 646f 776e 5461 626c 6557  t MarkdownTableW
+000003d0: 7269 7465 720a 6672 6f6d 2074 7970 696e  riter.from typin
+000003e0: 675f 6578 7465 6e73 696f 6e73 2069 6d70  g_extensions imp
+000003f0: 6f72 7420 5365 6c66 0a0a 6672 6f6d 202e  ort Self..from .
+00000400: 6c6f 6767 6572 2069 6d70 6f72 7420 6675  logger import fu
+00000410: 6e63 7469 6f6e 5f6c 6f67 6765 722c 2075  nction_logger, u
+00000420: 7064 6174 655f 6366 672c 204c 6f67 4361  pdate_cfg, LogCa
+00000430: 7074 7572 6572 0a66 726f 6d20 2e5f 7479  pturer.from ._ty
+00000440: 7069 6e67 2069 6d70 6f72 7420 4669 6c65  ping import File
+00000450: 4469 6374 2c20 4661 6365 742c 2056 6965  Dict, Facet, Vie
+00000460: 7744 6963 742c 2046 696c 6544 6174 6166  wDict, FileDataf
+00000470: 7261 6d65 5475 706c 654d 6179 6265 0a0a  rameTupleMaybe..
+00000480: 4d53 335f 5645 5253 494f 4e20 3d20 2731  MS3_VERSION = '1
+00000490: 2e32 2e36 270a 4c41 5445 5354 5f4d 5553  .2.6'.LATEST_MUS
+000004a0: 4553 434f 5245 5f56 4552 5349 4f4e 203d  ESCORE_VERSION =
+000004b0: 2027 332e 362e 3227 0a43 4f4d 5055 5445   '3.6.2'.COMPUTE
+000004c0: 445f 4d45 5441 4441 5441 5f43 4f4c 554d  D_METADATA_COLUM
+000004d0: 4e53 203d 205b 2754 696d 6553 6967 272c  NS = ['TimeSig',
+000004e0: 2027 4b65 7953 6967 272c 2027 6c61 7374   'KeySig', 'last
+000004f0: 5f6d 6327 2c20 276c 6173 745f 6d6e 272c  _mc', 'last_mn',
+00000500: 2027 6c65 6e67 7468 5f71 6227 2c20 276c   'length_qb', 'l
+00000510: 6173 745f 6d63 5f75 6e66 6f6c 6465 6427  ast_mc_unfolded'
+00000520: 2c20 276c 6173 745f 6d6e 5f75 6e66 6f6c  , 'last_mn_unfol
+00000530: 6465 6427 2c20 276c 656e 6774 685f 7162  ded', 'length_qb
+00000540: 5f75 6e66 6f6c 6465 6427 2c0a 2020 2020  _unfolded',.    
+00000550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000560: 2020 2020 2027 766f 6c74 615f 6d63 7327       'volta_mcs'
+00000570: 2c20 2761 6c6c 5f6e 6f74 6573 5f71 6227  , 'all_notes_qb'
+00000580: 2c20 276e 5f6f 6e73 6574 7327 2c20 276e  , 'n_onsets', 'n
+00000590: 5f6f 6e73 6574 5f70 6f73 6974 696f 6e73  _onset_positions
+000005a0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+000005b0: 2020 2020 2020 2020 2020 2020 2767 7569              'gui
+000005c0: 7461 725f 6368 6f72 645f 636f 756e 7427  tar_chord_count'
+000005d0: 2c20 2766 6f72 6d5f 6c61 6265 6c5f 636f  , 'form_label_co
+000005e0: 756e 7427 2c20 276c 6162 656c 5f63 6f75  unt', 'label_cou
+000005f0: 6e74 272c 2027 616e 6e6f 7461 7465 645f  nt', 'annotated_
+00000600: 6b65 7927 2c20 5d0a 2222 2241 7574 6f6d  key', ]."""Autom
+00000610: 6174 6963 616c 6c79 2063 6f6d 7075 7465  atically compute
+00000620: 6420 636f 6c75 6d6e 7322 2222 0a0a 4443  d columns"""..DC
+00000630: 4d4c 5f4d 4554 4144 4154 415f 434f 4c55  ML_METADATA_COLU
+00000640: 4d4e 5320 3d20 5b27 6861 726d 6f6e 795f  MNS = ['harmony_
+00000650: 7665 7273 696f 6e27 2c20 2761 6e6e 6f74  version', 'annot
+00000660: 6174 6f72 7327 2c20 2772 6576 6965 7765  ators', 'reviewe
+00000670: 7273 272c 2027 7363 6f72 655f 696e 7465  rs', 'score_inte
+00000680: 6772 6974 7927 2c20 2763 6f6d 706f 7365  grity', 'compose
+00000690: 645f 7374 6172 7427 2c20 2763 6f6d 706f  d_start', 'compo
+000006a0: 7365 645f 656e 6427 2c20 2763 6f6d 706f  sed_end', 'compo
+000006b0: 7365 645f 736f 7572 6365 275d 0a22 2222  sed_source']."""
+000006c0: 4172 6269 7472 6172 7920 636f 6c75 6d6e  Arbitrary column
+000006d0: 206e 616d 6573 2075 7365 6420 696e 2074   names used in t
+000006e0: 6865 2044 434d 4c20 636f 7270 7573 2069  he DCML corpus i
+000006f0: 6e69 7469 6174 6976 6522 2222 0a0a 0a4d  nitiative"""...M
+00000700: 5553 4553 434f 5245 5f4d 4554 4144 4154  USESCORE_METADAT
+00000710: 415f 4649 454c 4453 203d 205b 2763 6f6d  A_FIELDS = ['com
+00000720: 706f 7365 7227 2c20 2777 6f72 6b54 6974  poser', 'workTit
+00000730: 6c65 272c 2027 6d6f 7665 6d65 6e74 4e75  le', 'movementNu
+00000740: 6d62 6572 272c 2027 6d6f 7665 6d65 6e74  mber', 'movement
+00000750: 5469 746c 6527 2c0a 2020 2020 2020 2020  Title',.        
+00000760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000770: 2027 776f 726b 4e75 6d62 6572 272c 2027   'workNumber', '
+00000780: 706f 6574 272c 2027 6c79 7269 6369 7374  poet', 'lyricist
+00000790: 272c 2027 6172 7261 6e67 6572 272c 2027  ', 'arranger', '
+000007a0: 636f 7079 7269 6768 7427 2c20 2763 7265  copyright', 'cre
+000007b0: 6174 696f 6e44 6174 6527 2c0a 2020 2020  ationDate',.    
+000007c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000007d0: 2020 2020 2027 6d73 6356 6572 7369 6f6e       'mscVersion
+000007e0: 272c 2027 706c 6174 666f 726d 272c 2027  ', 'platform', '
+000007f0: 736f 7572 6365 272c 2027 7472 616e 736c  source', 'transl
+00000800: 6174 6f72 272c 5d0a 2222 2244 6566 6175  ator',]."""Defau
+00000810: 6c74 2066 6965 6c64 7320 6176 6169 6c61  lt fields availa
+00000820: 626c 6520 696e 2074 6865 2046 696c 6520  ble in the File 
+00000830: 2d3e 2053 636f 7265 2050 726f 7065 7274  -> Score Propert
+00000840: 6965 732e 2e2e 206d 656e 752e 2222 220a  ies... menu.""".
+00000850: 0a56 4552 5349 4f4e 5f43 4f4c 554d 4e53  .VERSION_COLUMNS
+00000860: 203d 205b 276d 7573 6573 636f 7265 272c   = ['musescore',
+00000870: 2027 6d73 335f 7665 7273 696f 6e27 2c5d   'ms3_version',]
+00000880: 0a22 2222 536f 6674 7761 7265 2076 6572  ."""Software ver
+00000890: 7369 6f6e 7322 2222 0a0a 494e 5354 5255  sions"""..INSTRU
+000008a0: 4d45 4e54 5f52 454c 4154 4544 5f43 4f4c  MENT_RELATED_COL
+000008b0: 554d 4e53 203d 205b 2768 6173 5f64 7275  UMNS = ['has_dru
+000008c0: 6d73 6574 272c 2027 616d 6269 7475 7327  mset', 'ambitus'
+000008d0: 5d0a 0a4d 5553 4553 434f 5245 5f48 4541  ]..MUSESCORE_HEA
+000008e0: 4445 525f 4649 454c 4453 203d 205b 2774  DER_FIELDS = ['t
+000008f0: 6974 6c65 5f74 6578 7427 2c20 2773 7562  itle_text', 'sub
+00000900: 7469 746c 655f 7465 7874 272c 2027 6c79  title_text', 'ly
+00000910: 7269 6369 7374 5f74 6578 7427 2c20 2763  ricist_text', 'c
+00000920: 6f6d 706f 7365 725f 7465 7874 272c 2027  omposer_text', '
+00000930: 7061 7274 5f6e 616d 655f 7465 7874 272c  part_name_text',
+00000940: 5d0a 2222 2244 6566 6175 6c74 2074 6578  ]."""Default tex
+00000950: 7420 6669 656c 6473 2069 6e20 4d75 7365  t fields in Muse
+00000960: 5363 6f72 6522 2222 0a0a 4f54 4845 525f  Score"""..OTHER_
+00000970: 434f 4c55 4d4e 5320 3d20 5b27 7375 6264  COLUMNS = ['subd
+00000980: 6972 6563 746f 7279 272c 2027 7265 6c5f  irectory', 'rel_
+00000990: 7061 7468 272c 5d0a 0a4c 4547 4143 595f  path',]..LEGACY_
+000009a0: 434f 4c55 4d4e 5320 3d20 5b27 666e 616d  COLUMNS = ['fnam
+000009b0: 6573 272c 2027 7265 6c5f 7061 7468 7327  es', 'rel_paths'
+000009c0: 2c20 276d 6435 272c 5d0a 0a41 5554 4f4d  , 'md5',]..AUTOM
+000009d0: 4154 4943 5f43 4f4c 554d 4e53 203d 2043  ATIC_COLUMNS = C
+000009e0: 4f4d 5055 5445 445f 4d45 5441 4441 5441  OMPUTED_METADATA
+000009f0: 5f43 4f4c 554d 4e53 202b 2056 4552 5349  _COLUMNS + VERSI
+00000a00: 4f4e 5f43 4f4c 554d 4e53 202b 2049 4e53  ON_COLUMNS + INS
+00000a10: 5452 554d 454e 545f 5245 4c41 5445 445f  TRUMENT_RELATED_
+00000a20: 434f 4c55 4d4e 5320 2b20 4f54 4845 525f  COLUMNS + OTHER_
+00000a30: 434f 4c55 4d4e 530a 2222 2254 6869 7320  COLUMNS."""This 
+00000a40: 636f 6d62 696e 6174 696f 6e20 6f66 2063  combination of c
+00000a50: 6f6c 756d 6e20 6e61 6d65 7320 6973 2065  olumn names is e
+00000a60: 7863 6c75 6465 6420 7768 656e 2075 7064  xcluded when upd
+00000a70: 6174 696e 6720 6d65 7461 6461 7461 2066  ating metadata f
+00000a80: 6965 6c64 7320 696e 204d 7573 6553 636f  ields in MuseSco
+00000a90: 7265 2066 696c 6573 2076 6961 206d 7333  re files via ms3
+00000aa0: 206d 6574 6164 6174 612e 2222 220a 0a4d   metadata."""..M
+00000ab0: 4554 4144 4154 415f 434f 4c55 4d4e 5f4f  ETADATA_COLUMN_O
+00000ac0: 5244 4552 203d 205b 2766 6e61 6d65 275d  RDER = ['fname']
+00000ad0: 202b 2043 4f4d 5055 5445 445f 4d45 5441   + COMPUTED_META
+00000ae0: 4441 5441 5f43 4f4c 554d 4e53 202b 2044  DATA_COLUMNS + D
+00000af0: 434d 4c5f 4d45 5441 4441 5441 5f43 4f4c  CML_METADATA_COL
+00000b00: 554d 4e53 202b 204d 5553 4553 434f 5245  UMNS + MUSESCORE
+00000b10: 5f4d 4554 4144 4154 415f 4649 454c 4453  _METADATA_FIELDS
+00000b20: 202b 204d 5553 4553 434f 5245 5f48 4541   + MUSESCORE_HEA
+00000b30: 4445 525f 4649 454c 4453 202b 2056 4552  DER_FIELDS + VER
+00000b40: 5349 4f4e 5f43 4f4c 554d 4e53 202b 204f  SION_COLUMNS + O
+00000b50: 5448 4552 5f43 4f4c 554d 4e53 202b 2049  THER_COLUMNS + I
+00000b60: 4e53 5452 554d 454e 545f 5245 4c41 5445  NSTRUMENT_RELATE
+00000b70: 445f 434f 4c55 4d4e 530a 2222 2254 6865  D_COLUMNS."""The
+00000b80: 2064 6566 6175 6c74 206f 7264 6572 2069   default order i
+00000b90: 6e20 7768 6963 6820 636f 6c75 6d6e 7320  n which columns 
+00000ba0: 6f66 206d 6574 6164 6174 612e 7473 7620  of metadata.tsv 
+00000bb0: 6669 6c65 7320 6172 6520 746f 2062 6520  files are to be 
+00000bc0: 736f 7274 6564 2e22 2222 0a0a 5343 4f52  sorted."""..SCOR
+00000bd0: 455f 4558 5445 4e53 494f 4e53 203d 2028  E_EXTENSIONS = (
+00000be0: 272e 6d73 6378 272c 2027 2e6d 7363 7a27  '.mscx', '.mscz'
+00000bf0: 2c20 272e 6361 7027 2c20 272e 6361 7078  , '.cap', '.capx
+00000c00: 272c 2027 2e6d 6964 6927 2c20 272e 6d69  ', '.midi', '.mi
+00000c10: 6427 2c20 272e 6d75 7369 6378 6d6c 272c  d', '.musicxml',
+00000c20: 2027 2e6d 786c 272c 2027 2e78 6d6c 2729   '.mxl', '.xml')
+00000c30: 0a0a 5354 414e 4441 5244 5f43 4f4c 554d  ..STANDARD_COLUM
+00000c40: 4e5f 4f52 4445 5220 3d20 5b0a 2020 2020  N_ORDER = [.    
+00000c50: 276d 6327 2c20 276d 635f 706c 6179 7468  'mc', 'mc_playth
+00000c60: 726f 7567 6827 2c20 276d 6e27 2c20 276d  rough', 'mn', 'm
+00000c70: 6e5f 706c 6179 7468 726f 7567 6827 2c20  n_playthrough', 
+00000c80: 2771 7561 7274 6572 6265 6174 7327 2c20  'quarterbeats', 
+00000c90: 276d 635f 6f6e 7365 7427 2c20 276d 6e5f  'mc_onset', 'mn_
+00000ca0: 6f6e 7365 7427 2c20 2762 6561 7427 2c0a  onset', 'beat',.
+00000cb0: 2020 2020 2765 7665 6e74 272c 2027 7469      'event', 'ti
+00000cc0: 6d65 7369 6727 2c20 2773 7461 6666 272c  mesig', 'staff',
+00000cd0: 2027 766f 6963 6527 2c20 2764 7572 6174   'voice', 'durat
+00000ce0: 696f 6e27 2c20 2774 6965 6427 2c0a 2020  ion', 'tied',.  
+00000cf0: 2020 2767 7261 6365 6e6f 7465 272c 2027    'gracenote', '
+00000d00: 6e6f 6d69 6e61 6c5f 6475 7261 7469 6f6e  nominal_duration
+00000d10: 272c 2027 7363 616c 6172 272c 2027 7470  ', 'scalar', 'tp
+00000d20: 6327 2c20 276d 6964 6927 2c20 2776 6f6c  c', 'midi', 'vol
+00000d30: 7461 272c 2027 6368 6f72 645f 6964 275d  ta', 'chord_id']
+00000d40: 0a0a 5354 414e 4441 5244 5f4e 414d 4553  ..STANDARD_NAMES
+00000d50: 203d 205b 276e 6f74 6573 5f61 6e64 5f72   = ['notes_and_r
+00000d60: 6573 7473 272c 2027 7265 7374 7327 2c20  ests', 'rests', 
+00000d70: 276e 6f74 6573 272c 2027 6d65 6173 7572  'notes', 'measur
+00000d80: 6573 272c 2027 6576 656e 7473 272c 2027  es', 'events', '
+00000d90: 6c61 6265 6c73 272c 2027 6368 6f72 6473  labels', 'chords
+00000da0: 272c 2027 6578 7061 6e64 6564 272c 0a20  ', 'expanded',. 
+00000db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000dc0: 2027 6861 726d 6f6e 6965 7327 2c20 2763   'harmonies', 'c
+00000dd0: 6164 656e 6365 7327 2c20 2766 6f72 6d5f  adences', 'form_
+00000de0: 6c61 6265 6c73 272c 2027 4d53 3327 2c20  labels', 'MS3', 
+00000df0: 2773 636f 7265 7327 5d0a 2222 223a 6f62  'scores'].""":ob
+00000e00: 6a3a 606c 6973 7460 0a49 6e64 6963 6174  j:`list`.Indicat
+00000e10: 6f72 7320 666f 7220 636f 7270 6f72 613a  ors for corpora:
+00000e20: 2049 6620 6120 666f 6c64 6572 2063 6f6e   If a folder con
+00000e30: 7461 696e 7320 616e 7920 6669 6c65 206f  tains any file o
+00000e40: 7220 666f 6c64 6572 2062 6567 696e 6e69  r folder beginni
+00000e50: 6e67 206f 7220 656e 6469 6e67 206f 6e20  ng or ending on 
+00000e60: 616e 7920 6f66 2074 6865 7365 206e 616d  any of these nam
+00000e70: 6573 2c20 6974 2069 7320 0a63 6f6e 7369  es, it is .consi
+00000e80: 6465 7265 6420 746f 2062 6520 6120 636f  dered to be a co
+00000e90: 7270 7573 2062 7920 7468 6520 6675 6e63  rpus by the func
+00000ea0: 7469 6f6e 203a 7079 3a66 756e 633a 6069  tion :py:func:`i
+00000eb0: 7465 7261 7465 5f63 6f72 706f 7261 602e  terate_corpora`.
+00000ec0: 0a22 2222 0a0a 5354 414e 4441 5244 5f4e  ."""..STANDARD_N
+00000ed0: 414d 4553 5f4f 525f 4749 5420 3d20 5354  AMES_OR_GIT = ST
+00000ee0: 414e 4441 5244 5f4e 414d 4553 202b 205b  ANDARD_NAMES + [
+00000ef0: 222e 6769 7422 5d0a 0a0a 4443 4d4c 5f52  ".git"]...DCML_R
+00000f00: 4547 4558 203d 2072 652e 636f 6d70 696c  EGEX = re.compil
+00000f10: 6528 7222 2222 0a5e 285c 2e3f 0a20 2020  e(r""".^(\.?.   
+00000f20: 2028 283f 503c 676c 6f62 616c 6b65 793e   ((?P<globalkey>
+00000f30: 5b61 2d67 412d 475d 2862 2a7c 5c23 2a29  [a-gA-G](b*|\#*)
+00000f40: 295c 2e29 3f0a 2020 2020 2828 3f50 3c6c  )\.)?.    ((?P<l
+00000f50: 6f63 616c 6b65 793e 2828 622a 7c5c 232a  ocalkey>((b*|\#*
+00000f60: 2928 5649 497c 5649 7c56 7c49 567c 4949  )(VII|VI|V|IV|II
+00000f70: 497c 4949 7c49 7c76 6969 7c76 697c 767c  I|II|I|vii|vi|v|
+00000f80: 6976 7c69 6969 7c69 697c 6929 2f3f 292b  iv|iii|ii|i)/?)+
+00000f90: 295c 2e29 3f0a 2020 2020 2828 3f50 3c70  )\.)?.    ((?P<p
+00000fa0: 6564 616c 3e28 2862 2a7c 5c23 2a29 2856  edal>((b*|\#*)(V
+00000fb0: 4949 7c56 497c 567c 4956 7c49 4949 7c49  II|VI|V|IV|III|I
+00000fc0: 497c 497c 7669 697c 7669 7c76 7c69 767c  I|I|vii|vi|v|iv|
+00000fd0: 6969 697c 6969 7c69 292f 3f29 2b29 5c5b  iii|ii|i)/?)+)\[
+00000fe0: 293f 0a20 2020 2028 3f50 3c63 686f 7264  )?.    (?P<chord
+00000ff0: 3e0a 2020 2020 2020 2020 283f 503c 6e75  >.        (?P<nu
+00001000: 6d65 7261 6c3e 2862 2a7c 5c23 2a29 2856  meral>(b*|\#*)(V
+00001010: 4949 7c56 497c 567c 4956 7c49 4949 7c49  II|VI|V|IV|III|I
+00001020: 497c 497c 7669 697c 7669 7c76 7c69 767c  I|I|vii|vi|v|iv|
+00001030: 6969 697c 6969 7c69 7c47 6572 7c49 747c  iii|ii|i|Ger|It|
+00001040: 4672 7c40 6e6f 6e65 2929 0a20 2020 2020  Fr|@none)).     
+00001050: 2020 2028 3f50 3c66 6f72 6d3e 2825 7c6f     (?P<form>(%|o
+00001060: 7c5c 2b7c 4d7c 5c2b 4d29 293f 0a20 2020  |\+|M|\+M))?.   
+00001070: 2020 2020 2028 3f50 3c66 6967 6261 7373       (?P<figbass
+00001080: 3e28 377c 3635 7c34 337c 3432 7c32 7c36  >(7|65|43|42|2|6
+00001090: 347c 3629 293f 0a20 2020 2020 2020 2028  4|6))?.        (
+000010a0: 5c28 283f 503c 6368 616e 6765 733e 2828  \((?P<changes>((
+000010b0: 5c2b 7c2d 7c5c 5e7c 7629 3f28 622a 7c5c  \+|-|\^|v)?(b*|\
+000010c0: 232a 295c 6429 2b29 5c29 293f 0a20 2020  #*)\d)+)\))?.   
+000010d0: 2020 2020 2028 2f28 3f50 3c72 656c 6174       (/(?P<relat
+000010e0: 6976 6572 6f6f 743e 2828 622a 7c5c 232a  iveroot>((b*|\#*
+000010f0: 2928 5649 497c 5649 7c56 7c49 567c 4949  )(VII|VI|V|IV|II
+00001100: 497c 4949 7c49 7c76 6969 7c76 697c 767c  I|II|I|vii|vi|v|
+00001110: 6976 7c69 6969 7c69 697c 6929 2f3f 292a  iv|iii|ii|i)/?)*
+00001120: 2929 3f0a 2020 2020 290a 2020 2020 283f  ))?.    ).    (?
+00001130: 503c 7065 6461 6c65 6e64 3e5c 5d29 3f0a  P<pedalend>\])?.
+00001140: 293f 0a28 5c7c 283f 503c 6361 6465 6e63  )?.(\|(?P<cadenc
+00001150: 653e 2828 4843 7c50 4143 7c49 4143 7c44  e>((HC|PAC|IAC|D
+00001160: 437c 4543 7c50 4329 285c 2e2e 2b3f 293f  C|EC|PC)(\..+?)?
+00001170: 2929 293f 0a28 3f50 3c70 6872 6173 6565  )))?.(?P<phrasee
+00001180: 6e64 3e28 5c5c 5c5c 7c5c 7d5c 7b7c 5c7b  nd>(\\\\|\}\{|\{
+00001190: 7c5c 7d29 293f 240a 2020 2020 2020 2020  |\}))?$.        
+000011a0: 2020 2020 2222 222c 2072 652e 5645 5242      """, re.VERB
+000011b0: 4f53 4529 0a22 2222 3a6f 626a 3a60 7374  OSE).""":obj:`st
+000011c0: 7260 0a43 6f6e 7374 616e 7420 7769 7468  r`.Constant with
+000011d0: 2061 2072 6567 756c 6172 2065 7870 7265   a regular expre
+000011e0: 7373 696f 6e20 7468 6174 2072 6563 6f67  ssion that recog
+000011f0: 6e69 7a65 7320 6c61 6265 6c73 2063 6f6e  nizes labels con
+00001200: 666f 726d 696e 6720 746f 2074 6865 2044  forming to the D
+00001210: 434d 4c20 6861 726d 6f6e 7920 616e 6e6f  CML harmony anno
+00001220: 7461 7469 6f6e 2073 7461 6e64 6172 6420  tation standard 
+00001230: 6578 636c 7564 696e 6720 7468 6f73 650a  excluding those.
+00001240: 636f 6e73 6973 7469 6e67 206f 6620 7477  consisting of tw
+00001250: 6f20 616c 7465 726e 6174 6976 6573 2e0a  o alternatives..
+00001260: 2222 220a 0a44 434d 4c5f 444f 5542 4c45  """..DCML_DOUBLE
+00001270: 5f52 4547 4558 203d 2072 652e 636f 6d70  _REGEX = re.comp
+00001280: 696c 6528 7222 2222 0a20 2020 2020 2020  ile(r""".       
+00001290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000012a0: 2020 2020 2020 2020 205e 283f 503c 6669           ^(?P<fi
+000012b0: 7273 743e 0a20 2020 2020 2020 2020 2020  rst>.           
+000012c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000012d0: 2020 2020 2020 2028 5c2e 3f0a 2020 2020         (\.?.    
+000012e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000012f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001300: 2828 3f50 3c67 6c6f 6261 6c6b 6579 3e5b  ((?P<globalkey>[
+00001310: 612d 6741 2d47 5d28 622a 7c5c 232a 2929  a-gA-G](b*|\#*))
+00001320: 5c2e 293f 0a20 2020 2020 2020 2020 2020  \.)?.           
+00001330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001340: 2020 2020 2020 2020 2028 283f 503c 6c6f           ((?P<lo
+00001350: 6361 6c6b 6579 3e28 2862 2a7c 5c23 2a29  calkey>((b*|\#*)
+00001360: 2856 4949 7c56 497c 567c 4956 7c49 4949  (VII|VI|V|IV|III
+00001370: 7c49 497c 497c 7669 697c 7669 7c76 7c69  |II|I|vii|vi|v|i
+00001380: 767c 6969 697c 6969 7c69 292f 3f29 2b29  v|iii|ii|i)/?)+)
+00001390: 5c2e 293f 0a20 2020 2020 2020 2020 2020  \.)?.           
+000013a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000013b0: 2020 2020 2020 2020 2028 283f 503c 7065           ((?P<pe
+000013c0: 6461 6c3e 2828 622a 7c5c 232a 2928 5649  dal>((b*|\#*)(VI
+000013d0: 497c 5649 7c56 7c49 567c 4949 497c 4949  I|VI|V|IV|III|II
+000013e0: 7c49 7c76 6969 7c76 697c 767c 6976 7c69  |I|vii|vi|v|iv|i
+000013f0: 6969 7c69 697c 6929 2f3f 292b 295c 5b29  ii|ii|i)/?)+)\[)
+00001400: 3f0a 2020 2020 2020 2020 2020 2020 2020  ?.              
+00001410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001420: 2020 2020 2020 283f 503c 6368 6f72 643e        (?P<chord>
+00001430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001450: 2020 2020 2020 2020 2028 3f50 3c6e 756d           (?P<num
+00001460: 6572 616c 3e28 622a 7c5c 232a 2928 5649  eral>(b*|\#*)(VI
+00001470: 497c 5649 7c56 7c49 567c 4949 497c 4949  I|VI|V|IV|III|II
+00001480: 7c49 7c76 6969 7c76 697c 767c 6976 7c69  |I|vii|vi|v|iv|i
+00001490: 6969 7c69 697c 697c 4765 727c 4974 7c46  ii|ii|i|Ger|It|F
+000014a0: 727c 406e 6f6e 6529 290a 2020 2020 2020  r|@none)).      
+000014b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014d0: 2020 283f 503c 666f 726d 3e28 257c 6f7c    (?P<form>(%|o|
+000014e0: 5c2b 7c4d 7c5c 2b4d 2929 3f0a 2020 2020  \+|M|\+M))?.    
+000014f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001510: 2020 2020 283f 503c 6669 6762 6173 733e      (?P<figbass>
+00001520: 2837 7c36 357c 3433 7c34 327c 327c 3634  (7|65|43|42|2|64
+00001530: 7c36 2929 3f0a 2020 2020 2020 2020 2020  |6))?.          
+00001540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001550: 2020 2020 2020 2020 2020 2020 2020 285c                (\
+00001560: 2828 3f50 3c63 6861 6e67 6573 3e28 285c  ((?P<changes>((\
+00001570: 2b7c 2d7c 5c5e 7c76 293f 2862 2a7c 5c23  +|-|\^|v)?(b*|\#
+00001580: 2a29 5c64 292b 295c 2929 3f0a 2020 2020  *)\d)+)\))?.    
+00001590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000015a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000015b0: 2020 2020 282f 283f 503c 7265 6c61 7469      (/(?P<relati
+000015c0: 7665 726f 6f74 3e28 2862 2a7c 5c23 2a29  veroot>((b*|\#*)
+000015d0: 2856 4949 7c56 497c 567c 4956 7c49 4949  (VII|VI|V|IV|III
+000015e0: 7c49 497c 497c 7669 697c 7669 7c76 7c69  |II|I|vii|vi|v|i
+000015f0: 767c 6969 697c 6969 7c69 292f 3f29 2a29  v|iii|ii|i)/?)*)
+00001600: 293f 0a20 2020 2020 2020 2020 2020 2020  )?.             
 00001610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001630: 2020 2020 283f 503c 7065 6461 6c65 6e64      (?P<pedalend
-00001640: 3e5c 5d29 3f0a 2020 2020 2020 2020 2020  >\])?.          
-00001650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001660: 2020 2020 2020 2020 293f 0a20 2020 2020          )?.     
+00001620: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00001630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001640: 2020 2020 2020 2020 2020 2020 2028 3f50               (?P
+00001650: 3c70 6564 616c 656e 643e 5c5d 293f 0a20  <pedalend>\])?. 
+00001660: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00001670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001680: 2020 2020 2020 2020 2020 2020 2028 5c7c               (\|
-00001690: 283f 503c 6361 6465 6e63 653e 2828 4843  (?P<cadence>((HC
-000016a0: 7c50 4143 7c49 4143 7c44 437c 4543 7c50  |PAC|IAC|DC|EC|P
-000016b0: 4329 285c 2e2e 2b3f 293f 2929 293f 0a20  C)(\..+?)?)))?. 
-000016c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016e0: 2028 3f50 3c70 6872 6173 6565 6e64 3e28   (?P<phraseend>(
-000016f0: 5c5c 5c5c 7c5c 7d5c 7b7c 5c7b 7c5c 7d29  \\\\|\}\{|\{|\})
-00001700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001720: 2020 2029 3f0a 2020 2020 2020 2020 2020     )?.          
-00001730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001740: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00001680: 2029 3f0a 2020 2020 2020 2020 2020 2020   )?.            
+00001690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016a0: 2020 2020 2020 285c 7c28 3f50 3c63 6164        (\|(?P<cad
+000016b0: 656e 6365 3e28 2848 437c 5041 437c 4941  ence>((HC|PAC|IA
+000016c0: 437c 4443 7c45 437c 5043 2928 5c2e 2e2b  C|DC|EC|PC)(\..+
+000016d0: 3f29 3f29 2929 3f0a 2020 2020 2020 2020  ?)?)))?.        
+000016e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016f0: 2020 2020 2020 2020 2020 283f 503c 7068            (?P<ph
+00001700: 7261 7365 656e 643e 285c 5c5c 5c7c 5c7d  raseend>(\\\\|\}
+00001710: 5c7b 7c5c 7b7c 5c7d 290a 2020 2020 2020  \{|\{|\}).      
+00001720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001730: 2020 2020 2020 2020 2020 2020 293f 0a20              )?. 
+00001740: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00001750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001760: 2020 2020 2020 2020 2020 282d 0a20 2020            (-.   
+00001760: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
 00001770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001780: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00001790: 3f50 3c73 6563 6f6e 643e 0a20 2020 2020  ?P<second>.     
-000017a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000017b0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000017c0: 283f 503c 676c 6f62 616c 6b65 7932 3e5b  (?P<globalkey2>[
-000017d0: 612d 6741 2d47 5d28 622a 7c5c 232a 2929  a-gA-G](b*|\#*))
-000017e0: 5c2e 293f 0a20 2020 2020 2020 2020 2020  \.)?.           
-000017f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001800: 2020 2020 2020 2020 2028 283f 503c 6c6f           ((?P<lo
-00001810: 6361 6c6b 6579 323e 2828 622a 7c5c 232a  calkey2>((b*|\#*
-00001820: 2928 5649 497c 5649 7c56 7c49 567c 4949  )(VII|VI|V|IV|II
-00001830: 497c 4949 7c49 7c76 6969 7c76 697c 767c  I|II|I|vii|vi|v|
-00001840: 6976 7c69 6969 7c69 697c 6929 2f3f 292b  iv|iii|ii|i)/?)+
-00001850: 295c 2e29 3f0a 2020 2020 2020 2020 2020  )\.)?.          
-00001860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001870: 2020 2020 2020 2020 2020 2828 3f50 3c70            ((?P<p
-00001880: 6564 616c 323e 2828 622a 7c5c 232a 2928  edal2>((b*|\#*)(
-00001890: 5649 497c 5649 7c56 7c49 567c 4949 497c  VII|VI|V|IV|III|
-000018a0: 4949 7c49 7c76 6969 7c76 697c 767c 6976  II|I|vii|vi|v|iv
-000018b0: 7c69 6969 7c69 697c 6929 2f3f 292b 295c  |iii|ii|i)/?)+)\
-000018c0: 5b29 3f0a 2020 2020 2020 2020 2020 2020  [)?.            
-000018d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000018e0: 2020 2020 2020 2020 283f 503c 6368 6f72          (?P<chor
-000018f0: 6432 3e0a 2020 2020 2020 2020 2020 2020  d2>.            
-00001900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001910: 2020 2020 2020 2020 2020 2020 283f 503c              (?P<
-00001920: 6e75 6d65 7261 6c32 3e28 622a 7c5c 232a  numeral2>(b*|\#*
-00001930: 2928 5649 497c 5649 7c56 7c49 567c 4949  )(VII|VI|V|IV|II
-00001940: 497c 4949 7c49 7c76 6969 7c76 697c 767c  I|II|I|vii|vi|v|
-00001950: 6976 7c69 6969 7c69 697c 697c 4765 727c  iv|iii|ii|i|Ger|
-00001960: 4974 7c46 727c 406e 6f6e 6529 290a 2020  It|Fr|@none)).  
-00001970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001990: 2020 2020 2020 283f 503c 666f 726d 323e        (?P<form2>
-000019a0: 2825 7c6f 7c5c 2b7c 4d7c 5c2b 4d29 293f  (%|o|\+|M|\+M))?
-000019b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000019c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000019d0: 2020 2020 2020 2020 2028 3f50 3c66 6967           (?P<fig
-000019e0: 6261 7373 323e 2837 7c36 357c 3433 7c34  bass2>(7|65|43|4
-000019f0: 327c 327c 3634 7c36 2929 3f0a 2020 2020  2|2|64|6))?.    
-00001a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001a20: 2020 2020 285c 2828 3f50 3c63 6861 6e67      (\((?P<chang
-00001a30: 6573 323e 2828 5c2b 7c2d 7c5c 5e7c 7629  es2>((\+|-|\^|v)
-00001a40: 3f28 622a 7c5c 232a 295c 6429 2b29 5c29  ?(b*|\#*)\d)+)\)
-00001a50: 293f 0a20 2020 2020 2020 2020 2020 2020  )?.             
-00001a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001a70: 2020 2020 2020 2020 2020 2028 2f28 3f50             (/(?P
-00001a80: 3c72 656c 6174 6976 6572 6f6f 7432 3e28  <relativeroot2>(
-00001a90: 2862 2a7c 5c23 2a29 2856 4949 7c56 497c  (b*|\#*)(VII|VI|
-00001aa0: 567c 4956 7c49 4949 7c49 497c 497c 7669  V|IV|III|II|I|vi
-00001ab0: 697c 7669 7c76 7c69 767c 6969 697c 6969  i|vi|v|iv|iii|ii
-00001ac0: 7c69 292f 3f29 2a29 293f 0a20 2020 2020  |i)/?)*))?.     
-00001ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ae0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00001af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001b10: 2020 2020 2028 3f50 3c70 6564 616c 656e       (?P<pedalen
-00001b20: 6432 3e5c 5d29 3f0a 2020 2020 2020 2020  d2>\])?.        
-00001b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001b40: 2020 2020 2020 2020 2020 293f 0a20 2020            )?.   
+00001780: 2020 2028 2d0a 2020 2020 2020 2020 2020     (-.          
+00001790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000017a0: 2020 2020 2020 2020 283f 503c 7365 636f          (?P<seco
+000017b0: 6e64 3e0a 2020 2020 2020 2020 2020 2020  nd>.            
+000017c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000017d0: 2020 2020 2020 2020 2828 3f50 3c67 6c6f          ((?P<glo
+000017e0: 6261 6c6b 6579 323e 5b61 2d67 412d 475d  balkey2>[a-gA-G]
+000017f0: 2862 2a7c 5c23 2a29 295c 2e29 3f0a 2020  (b*|\#*))\.)?.  
+00001800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001820: 2020 2828 3f50 3c6c 6f63 616c 6b65 7932    ((?P<localkey2
+00001830: 3e28 2862 2a7c 5c23 2a29 2856 4949 7c56  >((b*|\#*)(VII|V
+00001840: 497c 567c 4956 7c49 4949 7c49 497c 497c  I|V|IV|III|II|I|
+00001850: 7669 697c 7669 7c76 7c69 767c 6969 697c  vii|vi|v|iv|iii|
+00001860: 6969 7c69 292f 3f29 2b29 5c2e 293f 0a20  ii|i)/?)+)\.)?. 
+00001870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001890: 2020 2028 283f 503c 7065 6461 6c32 3e28     ((?P<pedal2>(
+000018a0: 2862 2a7c 5c23 2a29 2856 4949 7c56 497c  (b*|\#*)(VII|VI|
+000018b0: 567c 4956 7c49 4949 7c49 497c 497c 7669  V|IV|III|II|I|vi
+000018c0: 697c 7669 7c76 7c69 767c 6969 697c 6969  i|vi|v|iv|iii|ii
+000018d0: 7c69 292f 3f29 2b29 5c5b 293f 0a20 2020  |i)/?)+)\[)?.   
+000018e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000018f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001900: 2028 3f50 3c63 686f 7264 323e 0a20 2020   (?P<chord2>.   
+00001910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001930: 2020 2020 2028 3f50 3c6e 756d 6572 616c       (?P<numeral
+00001940: 323e 2862 2a7c 5c23 2a29 2856 4949 7c56  2>(b*|\#*)(VII|V
+00001950: 497c 567c 4956 7c49 4949 7c49 497c 497c  I|V|IV|III|II|I|
+00001960: 7669 697c 7669 7c76 7c69 767c 6969 697c  vii|vi|v|iv|iii|
+00001970: 6969 7c69 7c47 6572 7c49 747c 4672 7c40  ii|i|Ger|It|Fr|@
+00001980: 6e6f 6e65 2929 0a20 2020 2020 2020 2020  none)).         
+00001990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019a0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000019b0: 3f50 3c66 6f72 6d32 3e28 257c 6f7c 5c2b  ?P<form2>(%|o|\+
+000019c0: 7c4d 7c5c 2b4d 2929 3f0a 2020 2020 2020  |M|\+M))?.      
+000019d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019f0: 2020 283f 503c 6669 6762 6173 7332 3e28    (?P<figbass2>(
+00001a00: 377c 3635 7c34 337c 3432 7c32 7c36 347c  7|65|43|42|2|64|
+00001a10: 3629 293f 0a20 2020 2020 2020 2020 2020  6))?.           
+00001a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001a30: 2020 2020 2020 2020 2020 2020 2028 5c28               (\(
+00001a40: 283f 503c 6368 616e 6765 7332 3e28 285c  (?P<changes2>((\
+00001a50: 2b7c 2d7c 5c5e 7c76 293f 2862 2a7c 5c23  +|-|\^|v)?(b*|\#
+00001a60: 2a29 5c64 292b 295c 2929 3f0a 2020 2020  *)\d)+)\))?.    
+00001a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001a90: 2020 2020 282f 283f 503c 7265 6c61 7469      (/(?P<relati
+00001aa0: 7665 726f 6f74 323e 2828 622a 7c5c 232a  veroot2>((b*|\#*
+00001ab0: 2928 5649 497c 5649 7c56 7c49 567c 4949  )(VII|VI|V|IV|II
+00001ac0: 497c 4949 7c49 7c76 6969 7c76 697c 767c  I|II|I|vii|vi|v|
+00001ad0: 6976 7c69 6969 7c69 697c 6929 2f3f 292a  iv|iii|ii|i)/?)*
+00001ae0: 2929 3f0a 2020 2020 2020 2020 2020 2020  ))?.            
+00001af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00001b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b20: 2020 2020 2020 2020 2020 2020 2020 283f                (?
+00001b30: 503c 7065 6461 6c65 6e64 323e 5c5d 293f  P<pedalend2>\])?
+00001b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00001b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001b60: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00001b70: 5c7c 283f 503c 6361 6465 6e63 6532 3e28  \|(?P<cadence2>(
-00001b80: 2848 437c 5041 437c 4941 437c 4443 7c45  (HC|PAC|IAC|DC|E
-00001b90: 437c 5043 2928 5c2e 2e2b 3f29 3f29 2929  C|PC)(\..+?)?)))
-00001ba0: 3f0a 2020 2020 2020 2020 2020 2020 2020  ?.              
-00001bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001bc0: 2020 2020 283f 503c 7068 7261 7365 656e      (?P<phraseen
-00001bd0: 6432 3e28 5c5c 5c5c 7c5c 7d5c 7b7c 5c7b  d2>(\\\\|\}\{|\{
-00001be0: 7c5c 7d29 0a20 2020 2020 2020 2020 2020  |\}).           
-00001bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c00: 2020 2020 2020 2029 3f0a 2020 2020 2020         )?.      
+00001b60: 2020 2029 3f0a 2020 2020 2020 2020 2020     )?.          
+00001b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b80: 2020 2020 2020 2020 285c 7c28 3f50 3c63          (\|(?P<c
+00001b90: 6164 656e 6365 323e 2828 4843 7c50 4143  adence2>((HC|PAC
+00001ba0: 7c49 4143 7c44 437c 4543 7c50 4329 285c  |IAC|DC|EC|PC)(\
+00001bb0: 2e2e 2b3f 293f 2929 293f 0a20 2020 2020  ..+?)?)))?.     
+00001bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001bd0: 2020 2020 2020 2020 2020 2020 2028 3f50               (?P
+00001be0: 3c70 6872 6173 6565 6e64 323e 285c 5c5c  <phraseend2>(\\\
+00001bf0: 5c7c 5c7d 5c7b 7c5c 7b7c 5c7d 290a 2020  \|\}\{|\{|\}).  
+00001c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00001c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c20: 2020 2020 2020 2020 2020 2029 3f0a 2020             )?.  
+00001c20: 293f 0a20 2020 2020 2020 2020 2020 2020  )?.             
 00001c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c40: 2020 2020 2020 2020 2020 2020 2020 240a                $.
+00001c40: 2020 2020 293f 0a20 2020 2020 2020 2020      )?.         
 00001c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c70: 2222 222c 0a20 2020 2020 2020 2020 2020  """,.           
-00001c80: 2020 2020 2020 2020 2020 2020 2072 652e               re.
-00001c90: 5645 5242 4f53 4529 0a22 2222 3a6f 626a  VERBOSE).""":obj
-00001ca0: 3a60 7374 7260 0a43 6f6e 7374 616e 7420  :`str`.Constant 
-00001cb0: 7769 7468 2061 2072 6567 756c 6172 2065  with a regular e
-00001cc0: 7870 7265 7373 696f 6e20 7468 6174 2072  xpression that r
-00001cd0: 6563 6f67 6e69 7a65 7320 636f 6d70 6c65  ecognizes comple
-00001ce0: 7465 206c 6162 656c 7320 636f 6e66 6f72  te labels confor
-00001cf0: 6d69 6e67 2074 6f20 7468 6520 4443 4d4c  ming to the DCML
-00001d00: 2068 6172 6d6f 6e79 2061 6e6e 6f74 6174   harmony annotat
-00001d10: 696f 6e20 7374 616e 6461 7264 200a 696e  ion standard .in
-00001d20: 636c 7564 696e 6720 7468 6f73 6520 636f  cluding those co
-00001d30: 6e73 6973 7469 6e67 206f 6620 7477 6f20  nsisting of two 
-00001d40: 616c 7465 726e 6174 6976 6573 2c20 7769  alternatives, wi
-00001d50: 7468 6f75 7420 6861 7669 6e67 2074 6f20  thout having to 
-00001d60: 7370 6c69 7420 7468 656d 2e20 4974 2069  split them. It i
-00001d70: 7320 7369 6d70 6c79 2061 2064 6f75 626c  s simply a doubl
-00001d80: 6564 2076 6572 7369 6f6e 206f 6620 4443  ed version of DC
-00001d90: 4d4c 5f52 4547 4558 2e0a 2222 220a 0a46  ML_REGEX.."""..F
-00001da0: 4f52 4d5f 4445 5445 4354 494f 4e5f 5245  ORM_DETECTION_RE
-00001db0: 4745 5820 3d20 7222 5e5c 647b 312c 327d  GEX = r"^\d{1,2}
-00001dc0: 2e2a 3f3a 220a 2222 223a 6f62 6a3a 6073  .*?:".""":obj:`s
-00001dd0: 7472 600a 466f 6c6c 6f77 696e 6720 476f  tr`.Following Go
-00001de0: 7468 616d 2026 2049 7265 6c61 6e64 2028  tham & Ireland (
-00001df0: 4049 534d 4952 2032 3020 2832 3031 3929  @ISMIR 20 (2019)
-00001e00: 3a20 2254 616b 696e 6720 466f 726d 3a20  : "Taking Form: 
-00001e10: 4120 5265 7072 6573 656e 7461 7469 6f6e  A Representation
-00001e20: 2053 7461 6e64 6172 642c 2043 6f6e 7665   Standard, Conve
-00001e30: 7273 696f 6e20 436f 6465 2c20 616e 6420  rsion Code, and 
-00001e40: 4578 616d 706c 6520 436f 7270 7573 2066  Example Corpus f
-00001e50: 6f72 2052 6563 6f72 6469 6e67 2c20 5669  or Recording, Vi
-00001e60: 7375 616c 697a 696e 672c 2061 6e64 2053  sualizing, and S
-00001e70: 7475 6479 696e 6720 416e 616c 7973 6573  tudying Analyses
-00001e80: 206f 6620 4d75 7369 6361 6c20 466f 726d   of Musical Form
-00001e90: 2229 2c0a 6465 7465 6374 7320 666f 726d  "),.detects form
-00001ea0: 206c 6162 656c 7320 6173 2074 686f 7365   labels as those
-00001eb0: 2073 7472 696e 6773 2074 6861 7420 7374   strings that st
-00001ec0: 6172 7420 7769 7468 2069 6e64 6963 6174  art with indicat
-00001ed0: 696e 6720 6120 6869 6572 6172 6368 6963  ing a hierarchic
-00001ee0: 616c 206c 6576 656c 2028 6f6e 6520 6f72  al level (one or
-00001ef0: 2074 776f 2064 6967 6974 7329 2066 6f6c   two digits) fol
-00001f00: 6c6f 7765 6420 6279 2061 2063 6f6c 6f6e  lowed by a colon
-00001f10: 2e0a 4279 2065 7874 656e 7369 6f6e 2028  ..By extension (
-00001f20: 4c6c 6f72 656e 7320 6574 2061 6c2e 2c20  Llorens et al., 
-00001f30: 666f 7274 6863 6f6d 696e 6729 2c20 616c  forthcoming), al
-00001f40: 6c6f 7773 206f 6e65 206f 7220 6d6f 7265  lows one or more
-00001f50: 2027 6927 2063 6861 7261 6374 6572 7320   'i' characters 
-00001f60: 6f72 2061 6e79 206f 7468 6572 2061 6c70  or any other alp
-00001f70: 6861 6265 7420 6368 6172 6163 7465 7220  habet character 
-00001f80: 746f 2066 7572 7468 6572 2073 7065 6369  to further speci
-00001f90: 6679 2074 6865 206c 6576 656c 2e0a 2222  fy the level..""
-00001fa0: 220a 464f 524d 5f4c 4556 454c 5f52 4547  ".FORM_LEVEL_REG
-00001fb0: 4558 203d 2072 225e 283f 503c 6c65 7665  EX = r"^(?P<leve
-00001fc0: 6c3e 5c64 7b31 2c32 7d29 3f28 3f50 3c66  l>\d{1,2})?(?P<f
-00001fd0: 6f72 6d5f 7472 6565 3e5b 612d 685d 293f  orm_tree>[a-h])?
-00001fe0: 283f 503c 7265 6164 696e 673e 5b69 7678  (?P<reading>[ivx
-00001ff0: 5d2b 293f 3a3f 2422 2023 2028 3f50 3c74  ]+)?:?$" # (?P<t
-00002000: 6f6b 656e 3e28 3f3a 5c44 7c5c 642b 283f  oken>(?:\D|\d+(?
-00002010: 2128 3f3a 247c 692b 7c5c 7729 3f5b 5c26  !(?:$|i+|\w)?[\&
-00002020: 3d3a 5d29 292b 2922 0a46 4f52 4d5f 4c45  =:]))+)".FORM_LE
-00002030: 5645 4c5f 464f 524d 4154 203d 2072 225c  VEL_FORMAT = r"\
-00002040: 647b 312c 327d 5b61 2d68 5d3f 5b69 7678  d{1,2}[a-h]?[ivx
-00002050: 5d2a 283f 3a5c 265c 647b 302c 327d 5b61  ]*(?:\&\d{0,2}[a
-00002060: 2d68 5d3f 5b69 7678 5d2a 292a 220a 464f  -h]?[ivx]*)*".FO
-00002070: 524d 5f4c 4556 454c 5f53 504c 4954 5f52  RM_LEVEL_SPLIT_R
-00002080: 4547 4558 203d 2046 4f52 4d5f 4c45 5645  EGEX = FORM_LEVE
-00002090: 4c5f 464f 524d 4154 202b 2027 3a27 0a46  L_FORMAT + ':'.F
-000020a0: 4f52 4d5f 4c45 5645 4c5f 4341 5054 5552  ORM_LEVEL_CAPTUR
-000020b0: 455f 5245 4745 5820 3d20 6622 283f 503c  E_REGEX = f"(?P<
-000020c0: 6c65 7665 6c73 3e7b 464f 524d 5f4c 4556  levels>{FORM_LEV
-000020d0: 454c 5f46 4f52 4d41 547d 293a 220a 464f  EL_FORMAT}):".FO
-000020e0: 524d 5f54 4f4b 454e 5f41 4242 5245 5649  RM_TOKEN_ABBREVI
-000020f0: 4154 494f 4e53 203d 207b 0a20 2773 273a  ATIONS = {. 's':
-00002100: 2027 7361 747a 272c 0a20 2778 273a 2027   'satz',. 'x': '
-00002110: 756e 6974 272c 0a20 2761 6827 3a20 2761  unit',. 'ah': 'a
-00002120: 6e68 616e 6727 2c0a 2027 6269 273a 2027  nhang',. 'bi': '
-00002130: 6261 7369 6320 6964 6561 272c 0a20 2762  basic idea',. 'b
-00002140: 7227 3a20 2762 7269 6467 6527 2c0a 2027  r': 'bridge',. '
-00002150: 6369 273a 2027 636f 6e74 7261 7374 696e  ci': 'contrastin
-00002160: 6720 6964 6561 272c 0a20 2763 7227 3a20  g idea',. 'cr': 
-00002170: 2763 7275 7827 2c0a 2027 6567 273a 2027  'crux',. 'eg': '
-00002180: 6569 6e67 616e 6727 2c0a 2027 6870 273a  eingang',. 'hp':
-00002190: 2027 6861 7570 7470 6572 696f 6465 272c   'hauptperiode',
-000021a0: 0a20 2768 7327 3a20 2768 6175 7074 7361  . 'hs': 'hauptsa
-000021b0: 747a 272c 0a20 2769 7027 3a20 2769 6e74  tz',. 'ip': 'int
-000021c0: 6572 706f 6c61 7469 6f6e 272c 0a20 276c  erpolation',. 'l
-000021d0: 6927 3a20 276c 6561 642d 696e 272c 0a20  i': 'lead-in',. 
-000021e0: 2770 6327 3a20 2770 7265 2d63 6f72 6527  'pc': 'pre-core'
-000021f0: 2c0a 2027 7064 273a 2027 7065 7269 6f64  ,. 'pd': 'period
-00002200: 272c 0a20 2773 6927 3a20 2773 6563 6f6e  ',. 'si': 'secon
-00002210: 6461 7279 2069 6465 6127 2c0a 2027 7469  dary idea',. 'ti
-00002220: 273a 2027 7468 656d 6174 6963 2069 6e74  ': 'thematic int
-00002230: 726f 6475 6374 696f 6e27 2c0a 2027 7472  roduction',. 'tr
-00002240: 273a 2027 7472 616e 7369 7469 6f6e 272c  ': 'transition',
-00002250: 0a20 2731 7374 273a 2027 6669 7273 7420  . '1st': 'first 
-00002260: 7468 656d 6527 2c0a 2027 326e 6427 3a20  theme',. '2nd': 
-00002270: 2773 6563 6f6e 6420 7468 656d 6527 2c0a  'second theme',.
-00002280: 2027 3372 6427 3a20 2774 6869 7264 2074   '3rd': 'third t
-00002290: 6865 6d65 272c 0a20 2761 6e73 273a 2027  heme',. 'ans': '
-000022a0: 616e 7377 6572 272c 0a20 2761 6e74 273a  answer',. 'ant':
-000022b0: 2027 616e 7465 6365 6465 6e74 272c 0a20   'antecedent',. 
-000022c0: 2761 7465 273a 2027 6166 7465 722d 7468  'ate': 'after-th
-000022d0: 652d 656e 6427 2c0a 2027 6265 6727 3a20  e-end',. 'beg': 
-000022e0: 2762 6567 696e 6e69 6e67 272c 0a20 2762  'beginning',. 'b
-000022f0: 7462 273a 2027 6265 666f 7265 2d74 6865  tb': 'before-the
-00002300: 2d62 6567 696e 6e69 6e67 272c 0a20 2763  -beginning',. 'c
-00002310: 6164 273a 2027 6361 6465 6e74 6961 6c20  ad': 'cadential 
-00002320: 6964 6561 272c 0a20 2763 6269 273a 2027  idea',. 'cbi': '
-00002330: 636f 6d70 6f75 6e64 2062 6173 6963 2069  compound basic i
-00002340: 6465 6127 2c0a 2027 6368 7227 3a20 2763  dea',. 'chr': 'c
-00002350: 686f 7275 7327 2c0a 2027 636c 7327 3a20  horus',. 'cls': 
-00002360: 2763 6c6f 7369 6e67 2074 6865 6d65 272c  'closing theme',
-00002370: 0a20 2764 6576 273a 2027 6465 7665 6c6f  . 'dev': 'develo
-00002380: 706d 656e 7420 7365 6374 696f 6e27 2c0a  pment section',.
-00002390: 2027 6570 6927 3a20 2765 7069 736f 6465   'epi': 'episode
-000023a0: 272c 0a20 2765 7870 273a 2027 6578 706f  ',. 'exp': 'expo
-000023b0: 7369 7469 6f6e 272c 0a20 276c 6971 273a  sition',. 'liq':
-000023c0: 2027 6c69 7175 6964 6174 696f 6e27 2c0a   'liquidation',.
-000023d0: 2027 6d69 6427 3a20 276d 6964 646c 6527   'mid': 'middle'
-000023e0: 2c0a 2027 6d6f 6427 3a20 276d 6f64 656c  ,. 'mod': 'model
-000023f0: 272c 0a20 276d 7674 273a 2027 6d6f 7665  ',. 'mvt': 'move
-00002400: 6d65 6e74 272c 0a20 2772 6563 273a 2027  ment',. 'rec': '
-00002410: 7265 6361 7069 7475 6c61 7469 6f6e 272c  recapitulation',
-00002420: 0a20 2772 6570 273a 2027 7265 7065 7469  . 'rep': 'repeti
-00002430: 7469 6f6e 272c 0a20 2772 6974 273a 2027  tion',. 'rit': '
-00002440: 7269 746f 726e 656c 6c6f 272c 0a20 2772  ritornello',. 'r
-00002450: 7472 273a 2027 7265 7472 616e 7369 7469  tr': 'retransiti
-00002460: 6f6e 272c 0a20 2773 6571 273a 2027 7365  on',. 'seq': 'se
-00002470: 7175 656e 6365 272c 0a20 2773 7562 273a  quence',. 'sub':
-00002480: 2027 7375 626a 6563 7427 2c0a 2027 7468   'subject',. 'th
-00002490: 3027 3a20 2774 6865 6d65 3027 2c0a 2027  0': 'theme0',. '
-000024a0: 7661 7227 3a20 2776 6172 6961 7469 6f6e  var': 'variation
-000024b0: 272c 0a20 2776 6572 273a 2027 7665 7273  ',. 'ver': 'vers
-000024c0: 6527 2c0a 2027 6364 7a61 273a 2027 6361  e',. 'cdza': 'ca
-000024d0: 6465 6e7a 6127 2c0a 2027 636f 6461 273a  denza',. 'coda':
-000024e0: 2027 636f 6461 272c 0a20 2763 6f6e 7327   'coda',. 'cons'
-000024f0: 3a20 2763 6f6e 7365 7175 656e 7427 2c0a  : 'consequent',.
-00002500: 2027 636f 6e74 273a 2027 636f 6e74 696e   'cont': 'contin
-00002510: 7561 7469 6f6e 272c 0a20 2763 7474 6127  uation',. 'ctta'
-00002520: 3a20 2763 6f64 6574 7461 272c 0a20 2764  : 'codetta',. 'd
-00002530: 6570 6927 3a20 2764 6973 706c 6179 2065  epi': 'display e
-00002540: 7069 736f 6465 272c 0a20 2764 6973 7327  pisode',. 'diss'
-00002550: 3a20 2764 6973 736f 6c75 7469 6f6e 272c  : 'dissolution',
-00002560: 0a20 2765 7870 6127 3a20 2765 7870 616e  . 'expa': 'expan
-00002570: 7369 6f6e 272c 0a20 2766 7261 6727 3a20  sion',. 'frag': 
-00002580: 2766 7261 676d 656e 7461 7469 6f6e 272c  'fragmentation',
-00002590: 0a20 2770 6361 6427 3a20 2770 6f73 7463  . 'pcad': 'postc
-000025a0: 6164 656e 7469 616c 272c 0a20 2770 7265  adential',. 'pre
-000025b0: 7327 3a20 2770 7265 7365 6e74 6174 696f  s': 'presentatio
-000025c0: 6e27 2c0a 2027 7363 686c 273a 2027 7363  n',. 'schl': 'sc
-000025d0: 686c 7573 7373 6174 7a27 2c0a 2027 7365  hlusssatz',. 'se
-000025e0: 6e74 273a 2027 7365 6e74 656e 6365 272c  nt': 'sentence',
-000025f0: 0a20 2769 6e74 726f 273a 2027 696e 7472  . 'intro': 'intr
-00002600: 6f64 7563 7469 6f6e 272c 0a20 2770 7263  oduction',. 'prc
-00002610: 6872 273a 2027 7072 652d 6368 6f72 7573  hr': 'pre-chorus
-00002620: 272c 0a20 2770 7463 6872 273a 2027 706f  ',. 'ptchr': 'po
-00002630: 7374 2d63 686f 7275 7327 0a7d 0a0a 0a4d  st-chorus'.}...M
-00002640: 5333 5f48 544d 4c20 3d20 7b27 2330 3035  S3_HTML = {'#005
-00002650: 3530 3027 3a20 276d 7333 5f64 6172 6b67  500': 'ms3_darkg
-00002660: 7265 656e 272c 0a20 2020 2020 2020 2020  reen',.         
-00002670: 2020 2027 2361 6130 3030 3027 3a20 276d     '#aa0000': 'm
-00002680: 7333 5f64 6172 6b72 6564 272c 0a20 2020  s3_darkred',.   
-00002690: 2020 2020 2020 2020 2027 2361 6135 3530           '#aa550
-000026a0: 3027 3a20 276d 7333 5f73 6965 6e6e 6127  0': 'ms3_sienna'
-000026b0: 2c0a 2020 2020 2020 2020 2020 2020 2723  ,.            '#
-000026c0: 3030 6161 3030 273a 2027 6d73 335f 6772  00aa00': 'ms3_gr
-000026d0: 6565 6e27 2c0a 2020 2020 2020 2020 2020  een',.          
-000026e0: 2020 2723 6161 6161 3030 273a 2027 6d73    '#aaaa00': 'ms
-000026f0: 335f 6461 726b 676f 6c64 656e 726f 6427  3_darkgoldenrod'
-00002700: 2c0a 2020 2020 2020 2020 2020 2020 2723  ,.            '#
-00002710: 6161 6666 3030 273a 2027 6d73 335f 6368  aaff00': 'ms3_ch
-00002720: 6172 7472 6575 7365 272c 0a20 2020 2020  artreuse',.     
-00002730: 2020 2020 2020 2027 2330 3030 3037 6627         '#00007f'
-00002740: 3a20 276d 7333 5f6e 6176 7927 2c0a 2020  : 'ms3_navy',.  
-00002750: 2020 2020 2020 2020 2020 2723 6161 3030            '#aa00
-00002760: 3766 273a 2027 6d73 335f 6461 726b 6d61  7f': 'ms3_darkma
-00002770: 6765 6e74 6127 2c0a 2020 2020 2020 2020  genta',.        
-00002780: 2020 2020 2723 3030 3535 3766 273a 2027      '#00557f': '
-00002790: 6d73 335f 7465 616c 272c 0a20 2020 2020  ms3_teal',.     
-000027a0: 2020 2020 2020 2027 2361 6135 3537 6627         '#aa557f'
-000027b0: 3a20 276d 7333 5f69 6e64 6961 6e72 6564  : 'ms3_indianred
-000027c0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-000027d0: 2330 3061 6137 6627 3a20 276d 7333 5f64  #00aa7f': 'ms3_d
-000027e0: 6172 6b63 7961 6e27 2c0a 2020 2020 2020  arkcyan',.      
-000027f0: 2020 2020 2020 2723 6161 6161 3766 273a        '#aaaa7f':
-00002800: 2027 6d73 335f 6461 726b 6772 6179 272c   'ms3_darkgray',
-00002810: 0a20 2020 2020 2020 2020 2020 2027 2361  .            '#a
-00002820: 6166 6637 6627 3a20 276d 7333 5f70 616c  aff7f': 'ms3_pal
-00002830: 6567 7265 656e 272c 0a20 2020 2020 2020  egreen',.       
-00002840: 2020 2020 2027 2361 6130 3066 6627 3a20       '#aa00ff': 
-00002850: 276d 7333 5f64 6172 6b76 696f 6c65 7427  'ms3_darkviolet'
-00002860: 2c0a 2020 2020 2020 2020 2020 2020 2723  ,.            '#
-00002870: 3030 3535 6666 273a 2027 6d73 335f 646f  0055ff': 'ms3_do
-00002880: 6467 6572 626c 7565 272c 0a20 2020 2020  dgerblue',.     
-00002890: 2020 2020 2020 2027 2361 6135 3566 6627         '#aa55ff'
-000028a0: 3a20 276d 7333 5f6d 6564 6975 6d6f 7263  : 'ms3_mediumorc
-000028b0: 6869 6427 2c0a 2020 2020 2020 2020 2020  hid',.          
-000028c0: 2020 2723 3030 6161 6666 273a 2027 6d73    '#00aaff': 'ms
-000028d0: 335f 6465 6570 736b 7962 6c75 6527 2c0a  3_deepskyblue',.
-000028e0: 2020 2020 2020 2020 2020 2020 2723 6161              '#aa
-000028f0: 6161 6666 273a 2027 6d73 335f 6c69 6768  aaff': 'ms3_ligh
-00002900: 7473 7465 656c 626c 7565 272c 0a20 2020  tsteelblue',.   
-00002910: 2020 2020 2020 2020 2027 2361 6166 6666           '#aafff
-00002920: 6627 3a20 276d 7333 5f70 616c 6574 7572  f': 'ms3_paletur
-00002930: 7175 6f69 7365 272c 0a20 2020 2020 2020  quoise',.       
-00002940: 2020 2020 2027 2335 3530 3030 3027 3a20       '#550000': 
-00002950: 276d 7333 5f6d 6172 6f6f 6e27 2c0a 2020  'ms3_maroon',.  
-00002960: 2020 2020 2020 2020 2020 2723 3535 3535            '#5555
-00002970: 3030 273a 2027 6d73 335f 6461 726b 6f6c  00': 'ms3_darkol
-00002980: 6976 6567 7265 656e 272c 0a20 2020 2020  ivegreen',.     
-00002990: 2020 2020 2020 2027 2366 6635 3530 3027         '#ff5500'
-000029a0: 3a20 276d 7333 5f6f 7261 6e67 6572 6564  : 'ms3_orangered
-000029b0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-000029c0: 2335 3561 6130 3027 3a20 276d 7333 5f6f  #55aa00': 'ms3_o
-000029d0: 6c69 7665 272c 0a20 2020 2020 2020 2020  live',.         
-000029e0: 2020 2027 2366 6661 6130 3027 3a20 276d     '#ffaa00': 'm
-000029f0: 7333 5f6f 7261 6e67 6527 2c0a 2020 2020  s3_orange',.    
-00002a00: 2020 2020 2020 2020 2723 3535 6666 3030          '#55ff00
-00002a10: 273a 2027 6d73 335f 6c61 776e 6772 6565  ': 'ms3_lawngree
-00002a20: 6e27 2c0a 2020 2020 2020 2020 2020 2020  n',.            
-00002a30: 2723 3535 3030 3766 273a 2027 6d73 335f  '#55007f': 'ms3_
-00002a40: 696e 6469 676f 272c 0a20 2020 2020 2020  indigo',.       
-00002a50: 2020 2020 2027 2366 6630 3037 6627 3a20       '#ff007f': 
-00002a60: 276d 7333 5f64 6565 7070 696e 6b27 2c0a  'ms3_deeppink',.
-00002a70: 2020 2020 2020 2020 2020 2020 2723 3535              '#55
-00002a80: 3535 3766 273a 2027 6d73 335f 6461 726b  557f': 'ms3_dark
-00002a90: 736c 6174 6562 6c75 6527 2c0a 2020 2020  slateblue',.    
-00002aa0: 2020 2020 2020 2020 2723 6666 3535 3766          '#ff557f
-00002ab0: 273a 2027 6d73 335f 6c69 6768 7463 6f72  ': 'ms3_lightcor
-00002ac0: 616c 272c 0a20 2020 2020 2020 2020 2020  al',.           
-00002ad0: 2027 2335 3561 6137 6627 3a20 276d 7333   '#55aa7f': 'ms3
-00002ae0: 5f6d 6564 6975 6d73 6561 6772 6565 6e27  _mediumseagreen'
-00002af0: 2c0a 2020 2020 2020 2020 2020 2020 2723  ,.            '#
-00002b00: 6666 6161 3766 273a 2027 6d73 335f 6c69  ffaa7f': 'ms3_li
-00002b10: 6768 7473 616c 6d6f 6e27 2c0a 2020 2020  ghtsalmon',.    
-00002b20: 2020 2020 2020 2020 2723 3535 6666 3766          '#55ff7f
-00002b30: 273a 2027 6d73 335f 6c69 6768 7467 7265  ': 'ms3_lightgre
-00002b40: 656e 272c 0a20 2020 2020 2020 2020 2020  en',.           
-00002b50: 2027 2366 6666 6637 6627 3a20 276d 7333   '#ffff7f': 'ms3
-00002b60: 5f6b 6861 6b69 272c 0a20 2020 2020 2020  _khaki',.       
-00002b70: 2020 2020 2027 2335 3530 3066 6627 3a20       '#5500ff': 
-00002b80: 276d 7333 5f62 6c75 6527 2c0a 2020 2020  'ms3_blue',.    
-00002b90: 2020 2020 2020 2020 2723 3535 3535 6666          '#5555ff
-00002ba0: 273a 2027 6d73 335f 726f 7961 6c62 6c75  ': 'ms3_royalblu
-00002bb0: 6527 2c0a 2020 2020 2020 2020 2020 2020  e',.            
-00002bc0: 2723 6666 3535 6666 273a 2027 6d73 335f  '#ff55ff': 'ms3_
-00002bd0: 7669 6f6c 6574 272c 0a20 2020 2020 2020  violet',.       
-00002be0: 2020 2020 2027 2335 3561 6166 6627 3a20       '#55aaff': 
-00002bf0: 276d 7333 5f63 6f72 6e66 6c6f 7765 7262  'ms3_cornflowerb
-00002c00: 6c75 6527 2c0a 2020 2020 2020 2020 2020  lue',.          
-00002c10: 2020 2723 6666 6161 6666 273a 2027 6d73    '#ffaaff': 'ms
-00002c20: 335f 6c69 6768 7470 696e 6b27 2c0a 2020  3_lightpink',.  
-00002c30: 2020 2020 2020 2020 2020 2723 3535 6666            '#55ff
-00002c40: 6666 273a 2027 6d73 335f 6171 7561 6d61  ff': 'ms3_aquama
-00002c50: 7269 6e65 277d 0a0a 4d53 335f 5247 4220  rine'}..MS3_RGB 
-00002c60: 3d20 7b28 302c 2038 352c 2030 293a 2027  = {(0, 85, 0): '
-00002c70: 6d73 335f 6461 726b 6772 6565 6e27 2c0a  ms3_darkgreen',.
-00002c80: 2020 2020 2020 2020 2020 2028 3137 302c             (170,
-00002c90: 2030 2c20 3029 3a20 276d 7333 5f64 6172   0, 0): 'ms3_dar
-00002ca0: 6b72 6564 272c 0a20 2020 2020 2020 2020  kred',.         
-00002cb0: 2020 2831 3730 2c20 3835 2c20 3029 3a20    (170, 85, 0): 
-00002cc0: 276d 7333 5f73 6965 6e6e 6127 2c0a 2020  'ms3_sienna',.  
-00002cd0: 2020 2020 2020 2020 2028 302c 2031 3730           (0, 170
-00002ce0: 2c20 3029 3a20 276d 7333 5f67 7265 656e  , 0): 'ms3_green
-00002cf0: 272c 0a20 2020 2020 2020 2020 2020 2831  ',.           (1
-00002d00: 3730 2c20 3137 302c 2030 293a 2027 6d73  70, 170, 0): 'ms
-00002d10: 335f 6461 726b 676f 6c64 656e 726f 6427  3_darkgoldenrod'
-00002d20: 2c0a 2020 2020 2020 2020 2020 2028 3137  ,.           (17
-00002d30: 302c 2032 3535 2c20 3029 3a20 276d 7333  0, 255, 0): 'ms3
-00002d40: 5f63 6861 7274 7265 7573 6527 2c0a 2020  _chartreuse',.  
-00002d50: 2020 2020 2020 2020 2028 302c 2030 2c20           (0, 0, 
-00002d60: 3132 3729 3a20 276d 7333 5f6e 6176 7927  127): 'ms3_navy'
-00002d70: 2c0a 2020 2020 2020 2020 2020 2028 3137  ,.           (17
-00002d80: 302c 2030 2c20 3132 3729 3a20 276d 7333  0, 0, 127): 'ms3
-00002d90: 5f64 6172 6b6d 6167 656e 7461 272c 0a20  _darkmagenta',. 
-00002da0: 2020 2020 2020 2020 2020 2830 2c20 3835            (0, 85
-00002db0: 2c20 3132 3729 3a20 276d 7333 5f74 6561  , 127): 'ms3_tea
-00002dc0: 6c27 2c0a 2020 2020 2020 2020 2020 2028  l',.           (
-00002dd0: 3137 302c 2038 352c 2031 3237 293a 2027  170, 85, 127): '
-00002de0: 6d73 335f 696e 6469 616e 7265 6427 2c0a  ms3_indianred',.
-00002df0: 2020 2020 2020 2020 2020 2028 302c 2031             (0, 1
-00002e00: 3730 2c20 3132 3729 3a20 276d 7333 5f64  70, 127): 'ms3_d
-00002e10: 6172 6b63 7961 6e27 2c0a 2020 2020 2020  arkcyan',.      
-00002e20: 2020 2020 2028 3137 302c 2031 3730 2c20       (170, 170, 
-00002e30: 3132 3729 3a20 276d 7333 5f64 6172 6b67  127): 'ms3_darkg
-00002e40: 7261 7927 2c0a 2020 2020 2020 2020 2020  ray',.          
-00002e50: 2028 3137 302c 2032 3535 2c20 3132 3729   (170, 255, 127)
-00002e60: 3a20 276d 7333 5f70 616c 6567 7265 656e  : 'ms3_palegreen
-00002e70: 272c 0a20 2020 2020 2020 2020 2020 2831  ',.           (1
-00002e80: 3730 2c20 302c 2032 3535 293a 2027 6d73  70, 0, 255): 'ms
-00002e90: 335f 6461 726b 7669 6f6c 6574 272c 0a20  3_darkviolet',. 
-00002ea0: 2020 2020 2020 2020 2020 2830 2c20 3835            (0, 85
-00002eb0: 2c20 3235 3529 3a20 276d 7333 5f64 6f64  , 255): 'ms3_dod
-00002ec0: 6765 7262 6c75 6527 2c0a 2020 2020 2020  gerblue',.      
-00002ed0: 2020 2020 2028 3137 302c 2038 352c 2032       (170, 85, 2
-00002ee0: 3535 293a 2027 6d73 335f 6d65 6469 756d  55): 'ms3_medium
-00002ef0: 6f72 6368 6964 272c 0a20 2020 2020 2020  orchid',.       
-00002f00: 2020 2020 2830 2c20 3137 302c 2032 3535      (0, 170, 255
-00002f10: 293a 2027 6d73 335f 6465 6570 736b 7962  ): 'ms3_deepskyb
-00002f20: 6c75 6527 2c0a 2020 2020 2020 2020 2020  lue',.          
-00002f30: 2028 3137 302c 2031 3730 2c20 3235 3529   (170, 170, 255)
-00002f40: 3a20 276d 7333 5f6c 6967 6874 7374 6565  : 'ms3_lightstee
-00002f50: 6c62 6c75 6527 2c0a 2020 2020 2020 2020  lblue',.        
-00002f60: 2020 2028 3137 302c 2032 3535 2c20 3235     (170, 255, 25
-00002f70: 3529 3a20 276d 7333 5f70 616c 6574 7572  5): 'ms3_paletur
-00002f80: 7175 6f69 7365 272c 0a20 2020 2020 2020  quoise',.       
-00002f90: 2020 2020 2838 352c 2030 2c20 3029 3a20      (85, 0, 0): 
-00002fa0: 276d 7333 5f6d 6172 6f6f 6e27 2c0a 2020  'ms3_maroon',.  
-00002fb0: 2020 2020 2020 2020 2028 3835 2c20 3835           (85, 85
-00002fc0: 2c20 3029 3a20 276d 7333 5f64 6172 6b6f  , 0): 'ms3_darko
-00002fd0: 6c69 7665 6772 6565 6e27 2c0a 2020 2020  livegreen',.    
-00002fe0: 2020 2020 2020 2028 3235 352c 2038 352c         (255, 85,
-00002ff0: 2030 293a 2027 6d73 335f 6f72 616e 6765   0): 'ms3_orange
-00003000: 7265 6427 2c0a 2020 2020 2020 2020 2020  red',.          
-00003010: 2028 3835 2c20 3137 302c 2030 293a 2027   (85, 170, 0): '
-00003020: 6d73 335f 6f6c 6976 6527 2c0a 2020 2020  ms3_olive',.    
-00003030: 2020 2020 2020 2028 3235 352c 2031 3730         (255, 170
-00003040: 2c20 3029 3a20 276d 7333 5f6f 7261 6e67  , 0): 'ms3_orang
-00003050: 6527 2c0a 2020 2020 2020 2020 2020 2028  e',.           (
-00003060: 3835 2c20 3235 352c 2030 293a 2027 6d73  85, 255, 0): 'ms
-00003070: 335f 6c61 776e 6772 6565 6e27 2c0a 2020  3_lawngreen',.  
-00003080: 2020 2020 2020 2020 2028 3835 2c20 302c           (85, 0,
-00003090: 2031 3237 293a 2027 6d73 335f 696e 6469   127): 'ms3_indi
-000030a0: 676f 272c 0a20 2020 2020 2020 2020 2020  go',.           
-000030b0: 2832 3535 2c20 302c 2031 3237 293a 2027  (255, 0, 127): '
-000030c0: 6d73 335f 6465 6570 7069 6e6b 272c 0a20  ms3_deeppink',. 
-000030d0: 2020 2020 2020 2020 2020 2838 352c 2038            (85, 8
-000030e0: 352c 2031 3237 293a 2027 6d73 335f 6461  5, 127): 'ms3_da
-000030f0: 726b 736c 6174 6562 6c75 6527 2c0a 2020  rkslateblue',.  
-00003100: 2020 2020 2020 2020 2028 3235 352c 2038           (255, 8
-00003110: 352c 2031 3237 293a 2027 6d73 335f 6c69  5, 127): 'ms3_li
-00003120: 6768 7463 6f72 616c 272c 0a20 2020 2020  ghtcoral',.     
-00003130: 2020 2020 2020 2838 352c 2031 3730 2c20        (85, 170, 
-00003140: 3132 3729 3a20 276d 7333 5f6d 6564 6975  127): 'ms3_mediu
-00003150: 6d73 6561 6772 6565 6e27 2c0a 2020 2020  mseagreen',.    
-00003160: 2020 2020 2020 2028 3235 352c 2031 3730         (255, 170
-00003170: 2c20 3132 3729 3a20 276d 7333 5f6c 6967  , 127): 'ms3_lig
-00003180: 6874 7361 6c6d 6f6e 272c 0a20 2020 2020  htsalmon',.     
-00003190: 2020 2020 2020 2838 352c 2032 3535 2c20        (85, 255, 
-000031a0: 3132 3729 3a20 276d 7333 5f6c 6967 6874  127): 'ms3_light
-000031b0: 6772 6565 6e27 2c0a 2020 2020 2020 2020  green',.        
-000031c0: 2020 2028 3235 352c 2032 3535 2c20 3132     (255, 255, 12
-000031d0: 3729 3a20 276d 7333 5f6b 6861 6b69 272c  7): 'ms3_khaki',
-000031e0: 0a20 2020 2020 2020 2020 2020 2838 352c  .           (85,
-000031f0: 2030 2c20 3235 3529 3a20 276d 7333 5f62   0, 255): 'ms3_b
-00003200: 6c75 6527 2c0a 2020 2020 2020 2020 2020  lue',.          
-00003210: 2028 3835 2c20 3835 2c20 3235 3529 3a20   (85, 85, 255): 
-00003220: 276d 7333 5f72 6f79 616c 626c 7565 272c  'ms3_royalblue',
-00003230: 0a20 2020 2020 2020 2020 2020 2832 3535  .           (255
-00003240: 2c20 3835 2c20 3235 3529 3a20 276d 7333  , 85, 255): 'ms3
-00003250: 5f76 696f 6c65 7427 2c0a 2020 2020 2020  _violet',.      
-00003260: 2020 2020 2028 3835 2c20 3137 302c 2032       (85, 170, 2
-00003270: 3535 293a 2027 6d73 335f 636f 726e 666c  55): 'ms3_cornfl
-00003280: 6f77 6572 626c 7565 272c 0a20 2020 2020  owerblue',.     
-00003290: 2020 2020 2020 2832 3535 2c20 3137 302c        (255, 170,
-000032a0: 2032 3535 293a 2027 6d73 335f 6c69 6768   255): 'ms3_ligh
-000032b0: 7470 696e 6b27 2c0a 2020 2020 2020 2020  tpink',.        
-000032c0: 2020 2028 3835 2c20 3235 352c 2032 3535     (85, 255, 255
-000032d0: 293a 2027 6d73 335f 6171 7561 6d61 7269  ): 'ms3_aquamari
-000032e0: 6e65 277d 0a0a 4d53 335f 434f 4c4f 5253  ne'}..MS3_COLORS
-000032f0: 203d 206c 6973 7428 4d53 335f 4854 4d4c   = list(MS3_HTML
-00003300: 2e76 616c 7565 7328 2929 0a43 5353 324d  .values()).CSS2M
-00003310: 5333 203d 207b 635b 343a 5d3a 2063 2066  S3 = {c[4:]: c f
-00003320: 6f72 2063 2069 6e20 4d53 335f 434f 4c4f  or c in MS3_COLO
-00003330: 5253 7d0a 4353 535f 434f 4c4f 5253 203d  RS}.CSS_COLORS =
-00003340: 206c 6973 7428 7765 6263 6f6c 6f72 732e   list(webcolors.
-00003350: 4353 5333 5f4e 414d 4553 5f54 4f5f 4845  CSS3_NAMES_TO_HE
-00003360: 582e 6b65 7973 2829 290a 434f 4c4f 5253  X.keys()).COLORS
-00003370: 203d 2073 756d 285b 5b63 2c20 4353 5332   = sum([[c, CSS2
-00003380: 4d53 335b 635d 5d20 6966 2063 2069 6e20  MS3[c]] if c in 
-00003390: 4353 5332 4d53 3320 656c 7365 205b 635d  CSS2MS3 else [c]
-000033a0: 2066 6f72 2063 2069 6e20 4353 535f 434f   for c in CSS_CO
-000033b0: 4c4f 5253 5d2c 205b 5d29 0a72 6762 6120  LORS], []).rgba 
-000033c0: 3d20 6e61 6d65 6474 7570 6c65 2827 5247  = namedtuple('RG
-000033d0: 4241 272c 205b 2772 272c 2027 6727 2c20  BA', ['r', 'g', 
-000033e0: 2762 272c 2027 6127 5d29 0a0a 0a63 6c61  'b', 'a'])...cla
-000033f0: 7373 206d 6170 5f64 6963 7428 6469 6374  ss map_dict(dict
-00003400: 293a 0a20 2020 2022 2222 5375 6368 2061  ):.    """Such a
-00003410: 2064 6963 7469 6f6e 6172 7920 6361 6e20   dictionary can 
-00003420: 6265 206d 6170 7065 6420 746f 2061 2053  be mapped to a S
-00003430: 6572 6965 7320 746f 2072 6570 6c61 6365  eries to replace
-00003440: 2069 7473 2076 616c 7565 7320 6275 7420   its values but 
-00003450: 6c65 6176 696e 6720 7468 6520 7661 6c75  leaving the valu
-00003460: 6573 2061 6273 656e 7420 6672 6f6d 2074  es absent from t
-00003470: 6865 2064 6963 7420 6b65 7973 2069 6e74  he dict keys int
-00003480: 6163 742e 2222 220a 2020 2020 6465 6620  act.""".    def 
-00003490: 5f5f 6d69 7373 696e 675f 5f28 7365 6c66  __missing__(self
-000034a0: 2c20 6b65 7929 3a0a 2020 2020 2020 2020  , key):.        
-000034b0: 7265 7475 726e 206b 6579 0a0a 0a64 6566  return key...def
-000034c0: 2061 7373 6572 745f 616c 6c5f 6c69 6e65   assert_all_line
-000034d0: 735f 6571 7561 6c28 6265 666f 7265 2c20  s_equal(before, 
-000034e0: 6166 7465 722c 206f 7269 6769 6e61 6c2c  after, original,
-000034f0: 2074 6d70 5f66 696c 6529 3a0a 2020 2020   tmp_file):.    
-00003500: 2222 2220 436f 6d70 6172 6573 2074 776f  """ Compares two
-00003510: 206d 756c 7469 6c69 6e65 2073 7472 696e   multiline strin
-00003520: 6773 2074 6f20 7465 7374 2065 7175 616c  gs to test equal
-00003530: 6974 792e 2222 220a 2020 2020 6469 6666  ity.""".    diff
-00003540: 203d 205b 2869 2c20 6265 662c 2061 6674   = [(i, bef, aft
-00003550: 2920 666f 7220 692c 2028 6265 662c 2061  ) for i, (bef, a
-00003560: 6674 2920 696e 2065 6e75 6d65 7261 7465  ft) in enumerate
-00003570: 287a 6970 2862 6566 6f72 652e 7370 6c69  (zip(before.spli
-00003580: 746c 696e 6573 2829 2c20 6166 7465 722e  tlines(), after.
-00003590: 7370 6c69 746c 696e 6573 2829 292c 2031  splitlines()), 1
-000035a0: 2920 6966 2062 6566 2021 3d20 6166 745d  ) if bef != aft]
-000035b0: 0a20 2020 2069 6620 6c65 6e28 6469 6666  .    if len(diff
-000035c0: 2920 3e20 303a 0a20 2020 2020 2020 206c  ) > 0:.        l
-000035d0: 696e 655f 6e2c 206c 6566 742c 205f 203d  ine_n, left, _ =
-000035e0: 207a 6970 282a 6469 6666 290a 2020 2020   zip(*diff).    
-000035f0: 2020 2020 6c6e 203d 206c 656e 2873 7472      ln = len(str
-00003600: 286d 6178 286c 696e 655f 6e29 2929 2023  (max(line_n))) #
-00003610: 206c 656e 6774 6820 6f66 2074 6865 206c   length of the l
-00003620: 6f6e 6765 7374 206c 696e 6520 6e75 6d62  ongest line numb
-00003630: 6572 0a20 2020 2020 2020 206c 6566 745f  er.        left_
-00003640: 636f 6c20 3d20 6d61 7828 6c65 6e28 7329  col = max(len(s)
-00003650: 2066 6f72 2073 2069 6e20 6c65 6674 2920   for s in left) 
-00003660: 2320 6c65 6e67 7468 206f 6620 7468 6520  # length of the 
-00003670: 6c6f 6e67 6573 7420 6c69 6e65 0a20 2020  longest line.   
-00003680: 2020 2020 2066 6f6c 6465 722c 2066 696c       folder, fil
-00003690: 6520 3d20 6f73 2e70 6174 682e 7370 6c69  e = os.path.spli
-000036a0: 7428 6f72 6967 696e 616c 290a 2020 2020  t(original).    
-000036b0: 2020 2020 746d 705f 7065 7273 6973 7420      tmp_persist 
-000036c0: 3d20 6f73 2e70 6174 682e 6a6f 696e 2866  = os.path.join(f
-000036d0: 6f6c 6465 722c 2027 2e2e 272c 2066 696c  older, '..', fil
-000036e0: 6529 0a20 2020 2020 2020 2073 6875 7469  e).        shuti
-000036f0: 6c2e 636f 7079 2874 6d70 5f66 696c 652e  l.copy(tmp_file.
-00003700: 6e61 6d65 2c20 746d 705f 7065 7273 6973  name, tmp_persis
-00003710: 7429 0a20 2020 2020 2020 2064 6966 6620  t).        diff 
-00003720: 3d20 5b28 2727 2c20 6f72 6967 696e 616c  = [('', original
-00003730: 2c20 746d 705f 7065 7273 6973 7429 5d20  , tmp_persist)] 
-00003740: 2b20 6469 6666 0a20 2020 2061 7373 6572  + diff.    asser
-00003750: 7420 6c65 6e28 6469 6666 2920 3d3d 2030  t len(diff) == 0
-00003760: 2c20 275c 6e27 202b 2027 5c6e 272e 6a6f  , '\n' + '\n'.jo
-00003770: 696e 280a 2020 2020 2020 2020 6622 7b61  in(.        f"{a
-00003780: 3a7b 6c6e 7d7d 2020 7b62 3a7b 6c65 6674  :{ln}}  {b:{left
-00003790: 5f63 6f6c 7d7d 2020 2020 7b63 7d22 2066  _col}}    {c}" f
-000037a0: 6f72 2061 2c20 622c 2063 2069 6e20 6469  or a, b, c in di
-000037b0: 6666 290a 0a0a 6465 6620 6173 7365 7274  ff)...def assert
-000037c0: 5f64 6673 5f65 7175 616c 286f 6c64 2c20  _dfs_equal(old, 
-000037d0: 6e65 772c 2065 7863 6c75 6465 3d5b 5d29  new, exclude=[])
-000037e0: 3a0a 2020 2020 2222 2220 436f 6d70 6172  :.    """ Compar
-000037f0: 6573 2074 6865 2063 6f6d 6d6f 6e20 636f  es the common co
-00003800: 6c75 6d6e 7320 6f66 2074 776f 2044 6174  lumns of two Dat
-00003810: 6146 7261 6d65 7320 746f 2074 6573 7420  aFrames to test 
-00003820: 6571 7561 6c69 7479 2e20 5573 6573 3a20  equality. Uses: 
-00003830: 6e61 6e5f 6571 2829 2222 220a 2020 2020  nan_eq()""".    
-00003840: 6f6c 645f 6c2c 206e 6577 5f6c 203d 206c  old_l, new_l = l
-00003850: 656e 286f 6c64 292c 206c 656e 286e 6577  en(old), len(new
-00003860: 290a 2020 2020 6772 6561 7465 725f 6c65  ).    greater_le
-00003870: 6e67 7468 203d 206d 6178 286f 6c64 5f6c  ngth = max(old_l
-00003880: 2c20 6e65 775f 6c29 0a20 2020 2069 6620  , new_l).    if 
-00003890: 6f6c 645f 6c20 213d 206e 6577 5f6c 3a0a  old_l != new_l:.
-000038a0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-000038b0: 4f6c 6420 6c65 6e67 7468 3a20 7b6f 6c64  Old length: {old
-000038c0: 5f6c 7d2c 206e 6577 206c 656e 6774 683a  _l}, new length:
-000038d0: 207b 6e65 775f 6c7d 2229 0a20 2020 2020   {new_l}").     
-000038e0: 2020 206f 6c64 5f69 735f 7368 6f72 7465     old_is_shorte
-000038f0: 7220 3d20 6e65 775f 6c20 3d3d 2067 7265  r = new_l == gre
-00003900: 6174 6572 5f6c 656e 6774 680a 2020 2020  ater_length.    
-00003910: 2020 2020 7368 6f72 7465 7220 3d20 6f6c      shorter = ol
-00003920: 6420 6966 206f 6c64 5f69 735f 7368 6f72  d if old_is_shor
-00003930: 7465 7220 656c 7365 206e 6577 0a20 2020  ter else new.   
-00003940: 2020 2020 206d 6973 7369 6e67 5f72 6f77       missing_row
-00003950: 7320 3d20 6162 7328 6f6c 645f 6c20 2d20  s = abs(old_l - 
-00003960: 6e65 775f 6c29 0a20 2020 2020 2020 2073  new_l).        s
-00003970: 686f 7274 6572 5f63 6f6c 7320 3d20 7368  horter_cols = sh
-00003980: 6f72 7465 722e 636f 6c75 6d6e 730a 2020  orter.columns.  
-00003990: 2020 2020 2020 7061 7463 6820 3d20 7064        patch = pd
-000039a0: 2e44 6174 6146 7261 6d65 285b 5b27 6d69  .DataFrame([['mi
-000039b0: 7373 696e 6720 726f 7727 5d20 2a20 6c65  ssing row'] * le
-000039c0: 6e28 7368 6f72 7465 725f 636f 6c73 295d  n(shorter_cols)]
-000039d0: 202a 206d 6973 7369 6e67 5f72 6f77 732c   * missing_rows,
-000039e0: 2063 6f6c 756d 6e73 3d73 686f 7274 6572   columns=shorter
-000039f0: 5f63 6f6c 7329 0a20 2020 2020 2020 2073  _cols).        s
-00003a00: 686f 7274 6572 203d 2070 642e 636f 6e63  horter = pd.conc
-00003a10: 6174 285b 7368 6f72 7465 722c 2070 6174  at([shorter, pat
-00003a20: 6368 5d2c 2069 676e 6f72 655f 696e 6465  ch], ignore_inde
-00003a30: 783d 5472 7565 290a 2020 2020 2020 2020  x=True).        
-00003a40: 6966 206f 6c64 5f69 735f 7368 6f72 7465  if old_is_shorte
-00003a50: 723a 0a20 2020 2020 2020 2020 2020 206f  r:.            o
-00003a60: 6c64 203d 2073 686f 7274 6572 0a20 2020  ld = shorter.   
-00003a70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00003a80: 2020 2020 2020 206e 6577 203d 2073 686f         new = sho
-00003a90: 7274 6572 0a20 2020 2023 206f 6c64 2e69  rter.    # old.i
-00003aa0: 6e64 6578 2e72 656e 616d 6528 276f 6c64  ndex.rename('old
-00003ab0: 5f69 7827 2c20 696e 706c 6163 653d 5472  _ix', inplace=Tr
-00003ac0: 7565 290a 2020 2020 2320 6e65 772e 696e  ue).    # new.in
-00003ad0: 6465 782e 7265 6e61 6d65 2827 6e65 775f  dex.rename('new_
-00003ae0: 6978 272c 2069 6e70 6c61 6365 3d54 7275  ix', inplace=Tru
-00003af0: 6529 0a20 2020 2063 6f6c 7320 3d20 5b63  e).    cols = [c
-00003b00: 6f6c 2066 6f72 2063 6f6c 2069 6e20 7365  ol for col in se
-00003b10: 7428 6f6c 642e 636f 6c75 6d6e 7329 2e69  t(old.columns).i
-00003b20: 6e74 6572 7365 6374 696f 6e28 7365 7428  ntersection(set(
-00003b30: 6e65 772e 636f 6c75 6d6e 7329 2920 6966  new.columns)) if
-00003b40: 2063 6f6c 206e 6f74 2069 6e20 6578 636c   col not in excl
-00003b50: 7564 655d 0a20 2020 2064 6966 6620 3d20  ude].    diff = 
-00003b60: 5b28 692c 206a 2c20 7e6e 616e 5f65 7128  [(i, j, ~nan_eq(
-00003b70: 6f2c 206e 2929 2066 6f72 2028 2869 2c20  o, n)) for ((i, 
-00003b80: 6f29 2c20 286a 2c20 6e29 2920 696e 207a  o), (j, n)) in z
-00003b90: 6970 286f 6c64 5b63 6f6c 735d 2e69 7465  ip(old[cols].ite
-00003ba0: 7272 6f77 7328 292c 206e 6577 5b63 6f6c  rrows(), new[col
-00003bb0: 735d 2e69 7465 7272 6f77 7328 2929 5d0a  s].iterrows())].
-00003bc0: 2020 2020 6f6c 645f 626f 6f6c 203d 2070      old_bool = p
-00003bd0: 642e 4461 7461 4672 616d 652e 6672 6f6d  d.DataFrame.from
-00003be0: 5f64 6963 7428 7b69 783a 2062 6f6f 6c5f  _dict({ix: bool_
-00003bf0: 7365 7269 6573 2066 6f72 2069 782c 205f  series for ix, _
-00003c00: 2c20 626f 6f6c 5f73 6572 6965 7320 696e  , bool_series in
-00003c10: 2064 6966 667d 2c20 6f72 6965 6e74 3d27   diff}, orient='
-00003c20: 696e 6465 7827 290a 2020 2020 6e65 775f  index').    new_
-00003c30: 626f 6f6c 203d 2070 642e 4461 7461 4672  bool = pd.DataFr
-00003c40: 616d 652e 6672 6f6d 5f64 6963 7428 7b69  ame.from_dict({i
-00003c50: 783a 2062 6f6f 6c5f 7365 7269 6573 2066  x: bool_series f
-00003c60: 6f72 205f 2c20 6978 2c20 626f 6f6c 5f73  or _, ix, bool_s
-00003c70: 6572 6965 7320 696e 2064 6966 667d 2c20  eries in diff}, 
-00003c80: 6f72 6965 6e74 3d27 696e 6465 7827 290a  orient='index').
-00003c90: 2020 2020 6469 6666 735f 7065 725f 636f      diffs_per_co
-00003ca0: 6c20 3d20 6f6c 645f 626f 6f6c 2e73 756d  l = old_bool.sum
-00003cb0: 2861 7869 733d 3029 0a0a 2020 2020 6465  (axis=0)..    de
-00003cc0: 6620 7368 6f77 5f64 6966 6628 293a 0a20  f show_diff():. 
-00003cd0: 2020 2020 2020 2063 6f6d 705f 7374 7220         comp_str 
-00003ce0: 3d20 5b5d 0a20 2020 2020 2020 2069 6620  = [].        if 
-00003cf0: 276d 6327 2069 6e20 6f6c 642e 636f 6c75  'mc' in old.colu
-00003d00: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
-00003d10: 2070 6f73 6974 696f 6e5f 636f 6c20 3d20   position_col = 
-00003d20: 276d 6327 0a20 2020 2020 2020 2065 6c69  'mc'.        eli
-00003d30: 6620 276c 6173 745f 6d63 2720 696e 206f  f 'last_mc' in o
-00003d40: 6c64 2e63 6f6c 756d 6e73 3a0a 2020 2020  ld.columns:.    
-00003d50: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
-00003d60: 5f63 6f6c 203d 2027 6c61 7374 5f6d 6327  _col = 'last_mc'
-00003d70: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00003d80: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
-00003d90: 696f 6e5f 636f 6c20 3d20 4e6f 6e65 0a20  ion_col = None. 
-00003da0: 2020 2020 2020 2066 6f72 2063 6f6c 2c20         for col, 
-00003db0: 6e5f 6469 6666 7320 696e 2064 6966 6673  n_diffs in diffs
-00003dc0: 5f70 6572 5f63 6f6c 2e69 7465 6d73 2829  _per_col.items()
-00003dd0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00003de0: 206e 5f64 6966 6673 203e 2030 3a0a 2020   n_diffs > 0:.  
-00003df0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00003e00: 2070 6f73 6974 696f 6e5f 636f 6c20 6973   position_col is
-00003e10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00003e20: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00003e30: 6e73 203d 2063 6f6c 0a20 2020 2020 2020  ns = col.       
-00003e40: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00003e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e60: 2020 2063 6f6c 756d 6e73 203d 205b 706f     columns = [po
-00003e70: 7369 7469 6f6e 5f63 6f6c 2c20 636f 6c5d  sition_col, col]
-00003e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003e90: 2063 6f6d 7061 7269 736f 6e20 3d20 7064   comparison = pd
-00003ea0: 2e63 6f6e 6361 7428 5b6f 6c64 2e6c 6f63  .concat([old.loc
-00003eb0: 5b6f 6c64 5f62 6f6f 6c5b 636f 6c5d 2c20  [old_bool[col], 
-00003ec0: 636f 6c75 6d6e 735d 2e72 6573 6574 5f69  columns].reset_i
-00003ed0: 6e64 6578 2864 726f 703d 5472 7565 292e  ndex(drop=True).
-00003ee0: 696c 6f63 5b3a 3230 5d2c 0a20 2020 2020  iloc[:20],.     
-00003ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f10: 2020 206e 6577 2e6c 6f63 5b6e 6577 5f62     new.loc[new_b
-00003f20: 6f6f 6c5b 636f 6c5d 2c20 636f 6c75 6d6e  ool[col], column
-00003f30: 735d 2e69 6c6f 635b 3a32 305d 2e72 6573  s].iloc[:20].res
-00003f40: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
-00003f50: 7565 295d 2c0a 2020 2020 2020 2020 2020  ue)],.          
-00003f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f70: 2020 2020 2020 2020 2020 2020 2061 7869               axi
-00003f80: 733d 312c 0a20 2020 2020 2020 2020 2020  s=1,.           
-00003f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003fa0: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
-00003fb0: 3d5b 276f 6c64 272c 2027 6e65 7727 5d29  =['old', 'new'])
-00003fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003fd0: 2063 6f6d 705f 7374 722e 6170 7065 6e64   comp_str.append
-00003fe0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00003ff0: 2020 2020 2020 6622 7b6e 5f64 6966 6673        f"{n_diffs
-00004000: 7d2f 7b67 7265 6174 6572 5f6c 656e 6774  }/{greater_lengt
-00004010: 687d 2028 7b6e 5f64 6966 6673 202f 2067  h} ({n_diffs / g
-00004020: 7265 6174 6572 5f6c 656e 6774 6820 2a20  reater_length * 
-00004030: 3130 303a 2e32 667d 2025 2920 726f 7773  100:.2f} %) rows
-00004040: 2061 7265 2064 6966 6665 7265 6e74 2066   are different f
-00004050: 6f72 207b 636f 6c7d 7b27 2028 7368 6f77  or {col}{' (show
-00004060: 696e 6720 6669 7273 7420 3230 2927 2069  ing first 20)' i
-00004070: 6620 6e5f 6469 6666 7320 3e20 3230 2065  f n_diffs > 20 e
-00004080: 6c73 6520 2727 7d3a 5c6e 7b63 6f6d 7061  lse ''}:\n{compa
-00004090: 7269 736f 6e7d 5c6e 2229 0a20 2020 2020  rison}\n").     
-000040a0: 2020 2072 6574 7572 6e20 275c 6e27 2e6a     return '\n'.j
-000040b0: 6f69 6e28 636f 6d70 5f73 7472 290a 0a20  oin(comp_str).. 
-000040c0: 2020 2061 7373 6572 7420 6469 6666 735f     assert diffs_
-000040d0: 7065 725f 636f 6c2e 7375 6d28 2920 3d3d  per_col.sum() ==
-000040e0: 2030 2c20 7368 6f77 5f64 6966 6628 290a   0, show_diff().
-000040f0: 0a0a 0a64 6566 2061 6d62 6974 7573 326f  ...def ambitus2o
-00004100: 6e65 6c69 6e65 7228 616d 6269 7475 7329  neliner(ambitus)
-00004110: 3a0a 2020 2020 2222 2220 5475 726e 7320  :.    """ Turns 
-00004120: 6120 6060 6d65 7461 6461 7461 5b27 7061  a ``metadata['pa
-00004130: 7274 7327 5d5b 7374 6166 665f 6964 5d60  rts'][staff_id]`
-00004140: 6020 6469 6374 696f 6e61 7279 2069 6e74  ` dictionary int
-00004150: 6f20 6120 7374 7269 6e67 2e22 2222 0a20  o a string.""". 
-00004160: 2020 2069 6620 276d 696e 5f6d 6964 6927     if 'min_midi'
-00004170: 2069 6e20 616d 6269 7475 733a 0a20 2020   in ambitus:.   
-00004180: 2020 2020 2072 6574 7572 6e20 6622 7b61       return f"{a
-00004190: 6d62 6974 7573 5b27 6d69 6e5f 6d69 6469  mbitus['min_midi
-000041a0: 275d 7d2d 7b61 6d62 6974 7573 5b27 6d61  ']}-{ambitus['ma
-000041b0: 785f 6d69 6469 275d 7d20 287b 616d 6269  x_midi']} ({ambi
-000041c0: 7475 735b 276d 696e 5f6e 616d 6527 5d7d  tus['min_name']}
-000041d0: 2d7b 616d 6269 7475 735b 276d 6178 5f6e  -{ambitus['max_n
-000041e0: 616d 6527 5d7d 2922 0a20 2020 2069 6620  ame']})".    if 
-000041f0: 276d 6178 5f6d 6964 6927 2069 6e20 616d  'max_midi' in am
-00004200: 6269 7475 733a 0a20 2020 2020 2020 2072  bitus:.        r
-00004210: 6574 7572 6e20 6622 7b61 6d62 6974 7573  eturn f"{ambitus
-00004220: 5b27 6d61 785f 6d69 6469 275d 7d2d 7b61  ['max_midi']}-{a
-00004230: 6d62 6974 7573 5b27 6d61 785f 6d69 6469  mbitus['max_midi
-00004240: 275d 7d20 287b 616d 6269 7475 735b 276d  ']} ({ambitus['m
-00004250: 6178 5f6e 616d 6527 5d7d 2d7b 616d 6269  ax_name']}-{ambi
-00004260: 7475 735b 276d 6178 5f6e 616d 6527 5d7d  tus['max_name']}
-00004270: 2922 0a20 2020 2072 6574 7572 6e20 2727  )".    return ''
-00004280: 0a0a 0a0a 6465 6620 6368 616e 6765 7332  ....def changes2
-00004290: 6c69 7374 2863 6861 6e67 6573 2c20 736f  list(changes, so
-000042a0: 7274 3d54 7275 6529 3a0a 2020 2020 2222  rt=True):.    ""
-000042b0: 2220 5370 6c69 7473 2061 2073 7472 696e  " Splits a strin
-000042c0: 6720 6f66 2063 6861 6e67 6573 2069 6e74  g of changes int
-000042d0: 6f20 6120 6c69 7374 206f 6620 342d 7475  o a list of 4-tu
-000042e0: 706c 6573 2e0a 0a20 2020 2045 7861 6d70  ples...    Examp
-000042f0: 6c65 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  le.    -------. 
-00004300: 2020 203e 3e3e 2063 6861 6e67 6573 326c     >>> changes2l
-00004310: 6973 7428 272b 2337 6235 2729 0a20 2020  ist('+#7b5').   
-00004320: 205b 2827 2b23 3727 2c20 272b 272c 2027   [('+#7', '+', '
-00004330: 2327 2c20 2737 2729 2c0a 2020 2020 2028  #', '7'),.     (
-00004340: 2762 3527 2c20 2027 272c 2020 2762 272c  'b5',  '',  'b',
-00004350: 2027 3527 295d 0a20 2020 2022 2222 0a20   '5')].    """. 
-00004360: 2020 2072 6573 203d 205b 7420 666f 7220     res = [t for 
-00004370: 7420 696e 2072 652e 6669 6e64 616c 6c28  t in re.findall(
-00004380: 7222 2828 5c2b 7c2d 7c5c 5e7c 7629 3f28  r"((\+|-|\^|v)?(
-00004390: 232b 7c62 2b29 3f28 315c 647c 5c64 2929  #+|b+)?(1\d|\d))
-000043a0: 222c 2063 6861 6e67 6573 295d 0a20 2020  ", changes)].   
-000043b0: 2072 6574 7572 6e20 736f 7274 6564 2872   return sorted(r
-000043c0: 6573 2c20 6b65 793d 6c61 6d62 6461 2078  es, key=lambda x
-000043d0: 3a20 696e 7428 785b 335d 292c 2072 6576  : int(x[3]), rev
-000043e0: 6572 7365 3d54 7275 6529 2069 6620 736f  erse=True) if so
-000043f0: 7274 2065 6c73 6520 7265 730a 0a0a 0a64  rt else res....d
-00004400: 6566 2063 6861 6e67 6573 3274 7063 2863  ef changes2tpc(c
-00004410: 6861 6e67 6573 2c20 6e75 6d65 7261 6c2c  hanges, numeral,
-00004420: 206d 696e 6f72 3d46 616c 7365 2c20 726f   minor=False, ro
-00004430: 6f74 5f61 6c74 6572 6174 696f 6e73 3d46  ot_alterations=F
-00004440: 616c 7365 293a 0a20 2020 2022 2222 0a20  alse):.    """. 
-00004450: 2020 2047 6976 656e 2061 206e 756d 6572     Given a numer
-00004460: 616c 2061 6e64 2063 6861 6e67 6573 2c20  al and changes, 
-00004470: 636f 6d70 7574 6573 2074 6865 2069 6e74  computes the int
-00004480: 6572 7661 6c73 2074 6861 7420 7468 6520  ervals that the 
-00004490: 6368 616e 6765 7320 7265 7072 6573 656e  changes represen
-000044a0: 742e 0a20 2020 2043 6861 6e67 6573 2064  t..    Changes d
-000044b0: 6f20 6e6f 7420 6578 7072 6573 7320 6162  o not express ab
-000044c0: 736f 6c75 7465 2069 6e74 6572 7661 6c73  solute intervals
-000044d0: 2062 7574 2069 6e73 7465 6164 2064 6570   but instead dep
-000044e0: 656e 6420 6f6e 2074 6865 206e 756d 6572  end on the numer
-000044f0: 616c 2061 6e64 2074 6865 206d 6f64 652e  al and the mode.
-00004500: 0a0a 2020 2020 5573 6573 3a20 7370 6c69  ..    Uses: spli
-00004510: 745f 7363 616c 655f 6465 6772 6565 2829  t_scale_degree()
-00004520: 2c20 6368 616e 6765 7332 6c69 7374 2829  , changes2list()
-00004530: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-00004540: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-00004550: 2020 2020 6368 616e 6765 7320 3a20 3a6f      changes : :o
-00004560: 626a 3a60 7374 7260 0a20 2020 2020 2020  bj:`str`.       
-00004570: 2041 2073 7472 696e 6720 6f66 2063 6861   A string of cha
-00004580: 6e67 6573 2066 6f6c 6c6f 7769 6e67 2074  nges following t
-00004590: 6865 2044 434d 4c20 6861 726d 6f6e 7920  he DCML harmony 
-000045a0: 7374 616e 6461 7264 2e0a 2020 2020 6e75  standard..    nu
-000045b0: 6d65 7261 6c20 3a20 3a6f 626a 3a60 7374  meral : :obj:`st
-000045c0: 7260 0a20 2020 2020 2020 2052 6f6d 616e  r`.        Roman
-000045d0: 206e 756d 6572 616c 2e20 4966 2069 7420   numeral. If it 
-000045e0: 6973 2070 7265 6365 6465 6420 6279 2061  is preceded by a
-000045f0: 6363 6964 656e 7461 6c73 2c20 6974 2064  ccidentals, it d
-00004600: 6570 656e 6473 206f 6e20 7468 6520 7061  epends on the pa
-00004610: 7261 6d65 7465 720a 2020 2020 2020 2020  rameter.        
-00004620: 6072 6f6f 745f 616c 7465 7261 7469 6f6e  `root_alteration
-00004630: 7360 2077 6865 7468 6572 2074 6865 7365  s` whether these
-00004640: 2061 7265 2074 616b 656e 2069 6e74 6f20   are taken into 
-00004650: 6163 636f 756e 742e 0a20 2020 206d 696e  account..    min
-00004660: 6f72 203a 203a 6f62 6a3a 6062 6f6f 6c60  or : :obj:`bool`
-00004670: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00004680: 2020 2053 6574 2074 6f20 7472 7565 2069     Set to true i
-00004690: 6620 7468 6520 606e 756d 6572 616c 6020  f the `numeral` 
-000046a0: 6f63 6375 7273 2069 6e20 6120 6d69 6e6f  occurs in a mino
-000046b0: 7220 636f 6e74 6578 742e 0a20 2020 2072  r context..    r
-000046c0: 6f6f 745f 616c 7465 7261 7469 6f6e 7320  oot_alterations 
-000046d0: 3a20 3a6f 626a 3a60 626f 6f6c 602c 206f  : :obj:`bool`, o
-000046e0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-000046f0: 5365 7420 746f 2054 7275 6520 6966 2061  Set to True if a
-00004700: 6363 6964 656e 7461 6c73 206f 6620 7468  ccidentals of th
-00004710: 6520 726f 6f74 2073 686f 756c 6420 6368  e root should ch
-00004720: 616e 6765 2074 6865 2072 6573 756c 742e  ange the result.
-00004730: 0a20 2020 2022 2222 0a20 2020 2072 6f6f  .    """.    roo
-00004740: 745f 616c 7465 7261 7469 6f6e 2c20 6e75  t_alteration, nu
-00004750: 6d5f 6465 6772 6565 203d 2073 706c 6974  m_degree = split
-00004760: 5f73 6361 6c65 5f64 6567 7265 6528 6e75  _scale_degree(nu
-00004770: 6d65 7261 6c2c 2063 6f75 6e74 3d54 7275  meral, count=Tru
-00004780: 652c 206c 6f67 6765 723d 6c6f 6767 6572  e, logger=logger
-00004790: 290a 2020 2020 2320 6275 696c 6420 322d  ).    # build 2-
-000047a0: 6f63 7461 7665 2064 6961 746f 6e69 6320  octave diatonic 
-000047b0: 7363 616c 6520 6f6e 2043 206d 616a 6f72  scale on C major
-000047c0: 2f6d 696e 6f72 0a20 2020 2072 6f6f 7420  /minor.    root 
-000047d0: 3d20 5b27 4927 2c20 2749 4927 2c20 2749  = ['I', 'II', 'I
-000047e0: 4949 272c 2027 4956 272c 2027 5627 2c20  II', 'IV', 'V', 
-000047f0: 2756 4927 2c20 2756 4949 275d 2e69 6e64  'VI', 'VII'].ind
-00004800: 6578 286e 756d 5f64 6567 7265 652e 7570  ex(num_degree.up
-00004810: 7065 7228 2929 0a20 2020 2074 7063 7320  per()).    tpcs 
-00004820: 3d20 3220 2a20 5b69 2066 6f72 2069 2069  = 2 * [i for i i
-00004830: 6e20 2830 2c20 322c 202d 332c 202d 312c  n (0, 2, -3, -1,
-00004840: 2031 2c20 2d34 2c20 2d32 295d 2069 6620   1, -4, -2)] if 
-00004850: 6d69 6e6f 7220 656c 7365 2032 202a 205b  minor else 2 * [
-00004860: 6920 666f 7220 6920 696e 2028 302c 2032  i for i in (0, 2
-00004870: 2c20 342c 202d 312c 2031 2c20 332c 2035  , 4, -1, 1, 3, 5
-00004880: 295d 0a20 2020 2074 7063 7320 3d20 7470  )].    tpcs = tp
-00004890: 6373 5b72 6f6f 743a 5d20 2b20 7470 6373  cs[root:] + tpcs
-000048a0: 5b3a 726f 6f74 5d20 2023 2073 7461 7274  [:root]  # start
-000048b0: 696e 6720 7468 6520 7363 616c 6520 6672  ing the scale fr
-000048c0: 6f6d 2063 686f 7264 2072 6f6f 740a 2020  om chord root.  
-000048d0: 2020 726f 6f74 203d 2074 7063 735b 305d    root = tpcs[0]
-000048e0: 0a20 2020 2069 6620 726f 6f74 5f61 6c74  .    if root_alt
-000048f0: 6572 6174 696f 6e73 3a0a 2020 2020 2020  erations:.      
-00004900: 2020 726f 6f74 202b 3d20 3720 2a20 726f    root += 7 * ro
-00004910: 6f74 5f61 6c74 6572 6174 696f 6e0a 2020  ot_alteration.  
-00004920: 2020 2020 2020 7470 6373 5b30 5d20 3d20        tpcs[0] = 
-00004930: 726f 6f74 0a0a 2020 2020 616c 7473 203d  root..    alts =
-00004940: 2063 6861 6e67 6573 326c 6973 7428 6368   changes2list(ch
-00004950: 616e 6765 732c 2073 6f72 743d 4661 6c73  anges, sort=Fals
-00004960: 6529 0a20 2020 2061 6363 3274 7063 203d  e).    acc2tpc =
-00004970: 206c 616d 6264 6120 6163 6369 6465 6e74   lambda accident
-00004980: 616c 733a 2037 202a 2028 6163 6369 6465  als: 7 * (accide
-00004990: 6e74 616c 732e 636f 756e 7428 2723 2729  ntals.count('#')
-000049a0: 202d 2061 6363 6964 656e 7461 6c73 2e63   - accidentals.c
-000049b0: 6f75 6e74 2827 6227 2929 0a20 2020 2072  ount('b')).    r
-000049c0: 6574 7572 6e20 5b28 6675 6c6c 2c20 6164  eturn [(full, ad
-000049d0: 6465 642c 2061 6363 2c20 6368 6f72 645f  ded, acc, chord_
-000049e0: 696e 7465 7276 616c 2c0a 2020 2020 2020  interval,.      
-000049f0: 2020 2020 2020 2028 7470 6373 5b69 6e74         (tpcs[int
-00004a00: 2863 686f 7264 5f69 6e74 6572 7661 6c29  (chord_interval)
-00004a10: 202d 2031 5d20 2b20 6163 6332 7470 6328   - 1] + acc2tpc(
-00004a20: 6163 6329 202d 2072 6f6f 7429 2069 6620  acc) - root) if 
-00004a30: 6e6f 7420 6368 6f72 645f 696e 7465 7276  not chord_interv
-00004a40: 616c 2069 6e20 5b27 3327 2c20 2735 275d  al in ['3', '5']
-00004a50: 2065 6c73 6520 4e6f 6e65 2920 666f 720a   else None) for.
-00004a60: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
-00004a70: 2c20 6164 6465 642c 2061 6363 2c20 6368  , added, acc, ch
-00004a80: 6f72 645f 696e 7465 7276 616c 2069 6e20  ord_interval in 
-00004a90: 616c 7473 5d0a 0a0a 0a64 6566 2063 6865  alts]....def che
-00004aa0: 636b 5f6c 6162 656c 7328 6466 2c20 7265  ck_labels(df, re
-00004ab0: 6765 782c 2063 6f6c 756d 6e3d 276c 6162  gex, column='lab
-00004ac0: 656c 272c 2073 706c 6974 5f72 6567 6578  el', split_regex
-00004ad0: 3d4e 6f6e 652c 2072 6574 7572 6e5f 636f  =None, return_co
-00004ae0: 6c73 3d5b 276d 6327 2c20 276d 635f 6f6e  ls=['mc', 'mc_on
-00004af0: 7365 7427 2c20 2773 7461 6666 272c 2027  set', 'staff', '
-00004b00: 766f 6963 6527 5d29 3a0a 2020 2020 2222  voice']):.    ""
-00004b10: 2220 2043 6865 636b 7320 7468 6520 6c61  "  Checks the la
-00004b20: 6265 6c73 2069 6e20 6060 636f 6c75 6d6e  bels in ``column
-00004b30: 6060 2061 6761 696e 7374 2060 6072 6567  `` against ``reg
-00004b40: 6578 6060 2061 6e64 2072 6574 7572 6e73  ex`` and returns
-00004b50: 2074 686f 7365 2074 6861 7420 646f 6e27   those that don'
-00004b60: 7420 6d61 7463 682e 0a0a 2020 2020 5061  t match...    Pa
-00004b70: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-00004b80: 2d2d 2d2d 2d2d 2d0a 2020 2020 6466 203a  -------.    df :
-00004b90: 203a 6f62 6a3a 6070 616e 6461 732e 4461   :obj:`pandas.Da
-00004ba0: 7461 4672 616d 6560 0a20 2020 2020 2020  taFrame`.       
-00004bb0: 2044 6174 6146 7261 6d65 2063 6f6e 7461   DataFrame conta
-00004bc0: 696e 696e 6720 6120 636f 6c75 6d6e 2077  ining a column w
-00004bd0: 6974 6820 6c61 6265 6c73 2e0a 2020 2020  ith labels..    
-00004be0: 7265 6765 7820 3a20 3a6f 626a 3a60 7374  regex : :obj:`st
-00004bf0: 7260 0a20 2020 2020 2020 2052 6567 756c  r`.        Regul
-00004c00: 6172 2065 7870 7265 7373 696f 6e20 7468  ar expression th
-00004c10: 6174 2069 6e63 6f72 7265 6374 206c 6162  at incorrect lab
-00004c20: 656c 7320 646f 6e27 7420 6d61 7463 682e  els don't match.
-00004c30: 0a20 2020 2063 6f6c 756d 6e20 3a20 3a6f  .    column : :o
-00004c40: 626a 3a60 7374 7260 2c20 6f70 7469 6f6e  bj:`str`, option
-00004c50: 616c 0a20 2020 2020 2020 2043 6f6c 756d  al.        Colum
-00004c60: 6e20 6e61 6d65 2077 6865 7265 2074 6865  n name where the
-00004c70: 206c 6162 656c 7320 6172 652e 2044 6566   labels are. Def
-00004c80: 6175 6c74 7320 746f 2027 6c61 6265 6c27  aults to 'label'
-00004c90: 0a20 2020 2073 706c 6974 5f72 6567 6578  .    split_regex
-00004ca0: 203a 203a 6f62 6a3a 6073 7472 602c 206f   : :obj:`str`, o
-00004cb0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00004cc0: 4966 2079 6f75 2070 6173 7320 6120 7265  If you pass a re
-00004cd0: 6775 6c61 7220 6578 7072 6573 7369 6f6e  gular expression
-00004ce0: 2028 6f72 2073 696d 706c 6520 7374 7269   (or simple stri
-00004cf0: 6e67 292c 2069 7420 7769 6c6c 2062 6520  ng), it will be 
-00004d00: 7573 6564 2074 6f20 7370 6c69 7420 7468  used to split th
-00004d10: 6520 6c61 6265 6c73 2062 6566 6f72 6520  e labels before 
-00004d20: 6368 6563 6b69 6e67 2074 6865 0a20 2020  checking the.   
-00004d30: 2020 2020 2072 6573 756c 7469 6e67 2063       resulting c
-00004d40: 6f6c 756d 6e20 7365 7061 7261 7465 6c79  olumn separately
-00004d50: 2e20 496e 7374 6561 642c 2070 6173 7320  . Instead, pass 
-00004d60: 5472 7565 2074 6f20 7573 6520 7468 6520  True to use the 
-00004d70: 6465 6661 756c 7420 2861 2027 2d27 2074  default (a '-' t
-00004d80: 6861 7420 646f 6573 206e 6f74 2070 7265  hat does not pre
-00004d90: 6365 6465 2061 2073 6361 6c65 2064 6567  cede a scale deg
-00004da0: 7265 6529 2e0a 2020 2020 7265 7475 726e  ree)..    return
-00004db0: 5f63 6f6c 7320 3a20 3a6f 626a 3a60 6c69  _cols : :obj:`li
-00004dc0: 7374 602c 206f 7074 696f 6e61 6c0a 2020  st`, optional.  
-00004dd0: 2020 2020 2020 5061 7373 2061 206c 6973        Pass a lis
-00004de0: 7420 6f66 2074 6865 2044 6174 6146 7261  t of the DataFra
-00004df0: 6d65 2063 6f6c 756d 6e73 2074 6861 7420  me columns that 
-00004e00: 796f 7520 7761 6e74 2074 6f20 6265 2064  you want to be d
-00004e10: 6973 706c 6179 6564 2066 6f72 2074 6865  isplayed for the
-00004e20: 2077 726f 6e67 206c 6162 656c 732e 0a0a   wrong labels...
-00004e30: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00004e40: 2d2d 2d2d 2d2d 2d0a 2020 2020 6466 203a  -------.    df :
-00004e50: 203a 6f62 6a3a 6070 616e 6461 732e 4461   :obj:`pandas.Da
-00004e60: 7461 4672 616d 6560 0a20 2020 2020 2020  taFrame`.       
-00004e70: 2044 6174 6146 7261 6d65 2077 6974 6820   DataFrame with 
-00004e80: 7772 6f6e 6720 6c61 6265 6c73 2e0a 0a20  wrong labels... 
-00004e90: 2020 2022 2222 0a20 2020 2069 6620 7370     """.    if sp
-00004ea0: 6c69 745f 7265 6765 7820 6973 206e 6f74  lit_regex is not
-00004eb0: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
-00004ec0: 6620 7370 6c69 745f 7265 6765 7820 3d3d  f split_regex ==
-00004ed0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
-00004ee0: 2020 2063 6865 636b 5f74 6869 7320 3d20     check_this = 
-00004ef0: 7370 6c69 745f 616c 7465 726e 6174 6976  split_alternativ
-00004f00: 6573 2864 662c 2063 6f6c 756d 6e3d 636f  es(df, column=co
-00004f10: 6c75 6d6e 2c20 616c 7465 726e 6174 6976  lumn, alternativ
-00004f20: 6573 5f6f 6e6c 793d 5472 7565 290a 2020  es_only=True).  
-00004f30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00004f40: 2020 2020 2020 2020 6368 6563 6b5f 7468          check_th
-00004f50: 6973 203d 2073 706c 6974 5f61 6c74 6572  is = split_alter
-00004f60: 6e61 7469 7665 7328 6466 2c20 636f 6c75  natives(df, colu
-00004f70: 6d6e 3d63 6f6c 756d 6e2c 2072 6567 6578  mn=column, regex
-00004f80: 3d73 706c 6974 5f72 6567 6578 2c20 6d61  =split_regex, ma
-00004f90: 783d 3130 3030 2c20 616c 7465 726e 6174  x=1000, alternat
-00004fa0: 6976 6573 5f6f 6e6c 793d 5472 7565 290a  ives_only=True).
-00004fb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00004fc0: 2020 6368 6563 6b5f 7468 6973 203d 2064    check_this = d
-00004fd0: 665b 5b63 6f6c 756d 6e5d 5d0a 2020 2020  f[[column]].    
-00004fe0: 6966 2072 6567 6578 2e5f 5f63 6c61 7373  if regex.__class
-00004ff0: 5f5f 2021 3d20 7265 2e63 6f6d 7069 6c65  __ != re.compile
-00005000: 2827 2729 2e5f 5f63 6c61 7373 5f5f 3a0a  ('').__class__:.
-00005010: 2020 2020 2020 2020 7265 6765 7820 3d20          regex = 
-00005020: 7265 2e63 6f6d 7069 6c65 2872 6567 6578  re.compile(regex
-00005030: 2c20 7265 2e56 4552 424f 5345 290a 2020  , re.VERBOSE).  
-00005040: 2020 6e6f 745f 6d61 7463 6865 6420 3d20    not_matched = 
-00005050: 6368 6563 6b5f 7468 6973 2e61 7070 6c79  check_this.apply
-00005060: 286c 616d 6264 6120 633a 207e 632e 7374  (lambda c: ~c.st
-00005070: 722e 6d61 7463 6828 7265 6765 7829 2e66  r.match(regex).f
-00005080: 696c 6c6e 6128 5472 7565 2929 0a20 2020  illna(True)).   
-00005090: 2063 6f6c 7320 3d20 5b63 2066 6f72 2063   cols = [c for c
-000050a0: 2069 6e20 7265 7475 726e 5f63 6f6c 7320   in return_cols 
-000050b0: 6966 2063 2069 6e20 6466 2e63 6f6c 756d  if c in df.colum
-000050c0: 6e73 5d0a 2020 2020 7365 6c65 6374 5f77  ns].    select_w
-000050d0: 726f 6e67 203d 206e 6f74 5f6d 6174 6368  rong = not_match
-000050e0: 6564 2e61 6e79 2861 7869 733d 3129 0a20  ed.any(axis=1). 
-000050f0: 2020 2072 6573 203d 2063 6865 636b 5f74     res = check_t
-00005100: 6869 732e 7768 6572 6528 6e6f 745f 6d61  his.where(not_ma
-00005110: 7463 6865 642c 206f 7468 6572 3d27 2e27  tched, other='.'
-00005120: 295b 7365 6c65 6374 5f77 726f 6e67 5d0a  )[select_wrong].
-00005130: 2020 2020 7265 7320 3d20 7265 732e 6170      res = res.ap
-00005140: 706c 7928 6c61 6d62 6461 2063 3a20 632e  ply(lambda c: c.
-00005150: 7374 722e 7265 706c 6163 6528 275e 2f24  str.replace('^/$
-00005160: 272c 2027 656d 7074 795f 6861 726d 6f6e  ', 'empty_harmon
-00005170: 7927 2c20 7265 6765 783d 5472 7565 2929  y', regex=True))
-00005180: 0a20 2020 2072 6574 7572 6e20 7064 2e63  .    return pd.c
-00005190: 6f6e 6361 7428 5b64 662e 6c6f 635b 7365  oncat([df.loc[se
-000051a0: 6c65 6374 5f77 726f 6e67 2c20 636f 6c73  lect_wrong, cols
-000051b0: 5d2c 2072 6573 5d2c 2061 7869 733d 3129  ], res], axis=1)
-000051c0: 0a0a 0a0a 0a0a 6465 6620 636f 6c6f 7232  ......def color2
-000051d0: 7267 6261 2863 293a 0a20 2020 2022 2222  rgba(c):.    """
-000051e0: 2050 6173 7320 6120 5247 4220 6f72 2052   Pass a RGB or R
-000051f0: 4742 4120 7475 706c 652c 2048 544d 4c20  GBA tuple, HTML 
-00005200: 636f 6c6f 7220 6f72 206e 616d 6520 746f  color or name to
-00005210: 2063 6f6e 7665 7274 2069 7420 746f 2052   convert it to R
-00005220: 4742 4120 2222 220a 2020 2020 6966 2069  GBA """.    if i
-00005230: 7369 6e73 7461 6e63 6528 632c 2074 7570  sinstance(c, tup
-00005240: 6c65 293a 0a20 2020 2020 2020 2069 6620  le):.        if 
-00005250: 6c65 6e28 6329 203e 2033 3a0a 2020 2020  len(c) > 3:.    
-00005260: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00005270: 6762 6128 2a63 5b3a 345d 290a 2020 2020  gba(*c[:4]).    
-00005280: 2020 2020 6966 206c 656e 2863 2920 3d3d      if len(c) ==
-00005290: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
-000052a0: 7265 7475 726e 2072 6762 6128 2a28 6320  return rgba(*(c 
-000052b0: 2b20 2832 3535 2c29 2929 0a20 2020 2020  + (255,))).     
-000052c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000052d0: 2020 2020 2072 6574 7572 6e20 7267 6261       return rgba
-000052e0: 282a 6329 0a20 2020 2069 6620 635b 305d  (*c).    if c[0]
-000052f0: 203d 3d20 2723 273a 0a20 2020 2020 2020   == '#':.       
-00005300: 2072 6574 7572 6e20 6874 6d6c 5f63 6f6c   return html_col
-00005310: 6f72 3272 6762 6128 6329 0a20 2020 2072  or2rgba(c).    r
-00005320: 6574 7572 6e20 636f 6c6f 725f 6e61 6d65  eturn color_name
-00005330: 3272 6762 6128 6329 0a0a 0a0a 6465 6620  2rgba(c)....def 
-00005340: 636f 6c6f 725f 6e61 6d65 3266 6f72 6d61  color_name2forma
-00005350: 7428 6e2c 2066 6f72 6d61 743d 2772 6762  t(n, format='rgb
-00005360: 2729 3a0a 2020 2020 2222 2220 436f 6e76  '):.    """ Conv
-00005370: 6572 7473 2061 2073 696e 676c 6520 4353  erts a single CS
-00005380: 5333 206e 616d 6520 696e 746f 206f 6e65  S3 name into one
-00005390: 206f 6620 2748 544d 4c27 2c20 2772 6762   of 'HTML', 'rgb
-000053a0: 272c 206f 7220 2772 6762 6127 2222 220a  ', or 'rgba'""".
-000053b0: 2020 2020 6966 2070 642e 6973 6e75 6c6c      if pd.isnull
-000053c0: 286e 293a 0a20 2020 2020 2020 2072 6574  (n):.        ret
-000053d0: 7572 6e20 6e0a 2020 2020 6966 206e 2069  urn n.    if n i
-000053e0: 6e20 7765 6263 6f6c 6f72 732e 4353 5333  n webcolors.CSS3
-000053f0: 5f4e 414d 4553 5f54 4f5f 4845 583a 0a20  _NAMES_TO_HEX:. 
-00005400: 2020 2020 2020 2068 746d 6c20 3d20 7765         html = we
-00005410: 6263 6f6c 6f72 732e 6e61 6d65 5f74 6f5f  bcolors.name_to_
-00005420: 6865 7828 6e29 0a20 2020 2065 6c69 6620  hex(n).    elif 
-00005430: 6e20 696e 204d 5333 5f48 544d 4c2e 7661  n in MS3_HTML.va
-00005440: 6c75 6573 2829 3a0a 2020 2020 2020 2020  lues():.        
-00005450: 6874 6d6c 203d 206e 6578 7428 6b20 666f  html = next(k fo
-00005460: 7220 6b2c 2076 2069 6e20 4d53 335f 4854  r k, v in MS3_HT
-00005470: 4d4c 2e69 7465 6d73 2829 2069 6620 7620  ML.items() if v 
-00005480: 3d3d 206e 290a 2020 2020 656c 6966 206e  == n).    elif n
-00005490: 5b30 5d20 3d3d 2027 2327 3a0a 2020 2020  [0] == '#':.    
-000054a0: 2020 2020 6874 6d6c 203d 206e 0a20 2020      html = n.   
-000054b0: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
-000054c0: 6574 7572 6e20 6e0a 2020 2020 6966 2066  eturn n.    if f
-000054d0: 6f72 6d61 7420 3d3d 2027 6874 6d6c 273a  ormat == 'html':
-000054e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000054f0: 6874 6d6c 0a20 2020 2069 6620 666f 726d  html.    if form
-00005500: 6174 203d 3d20 2772 6762 273a 0a20 2020  at == 'rgb':.   
-00005510: 2020 2020 2072 6574 7572 6e20 7765 6263       return webc
-00005520: 6f6c 6f72 732e 6865 785f 746f 5f72 6762  olors.hex_to_rgb
-00005530: 2868 746d 6c29 0a20 2020 2069 6620 666f  (html).    if fo
-00005540: 726d 6174 203d 3d20 2772 6762 6127 3a0a  rmat == 'rgba':.
-00005550: 2020 2020 2020 2020 7267 6220 3d20 7765          rgb = we
-00005560: 6263 6f6c 6f72 732e 6865 785f 746f 5f72  bcolors.hex_to_r
-00005570: 6762 2868 746d 6c29 0a20 2020 2020 2020  gb(html).       
-00005580: 2072 6574 7572 6e20 7267 6261 282a 2872   return rgba(*(r
-00005590: 6762 202b 2028 3235 352c 2929 290a 2020  gb + (255,))).  
-000055a0: 2020 7265 7475 726e 2068 746d 6c0a 0a0a    return html...
-000055b0: 6465 6620 636f 6c6f 725f 6e61 6d65 3268  def color_name2h
-000055c0: 746d 6c28 6e29 3a0a 2020 2020 2222 2220  tml(n):.    """ 
-000055d0: 436f 6e76 6572 7473 2061 2073 696e 676c  Converts a singl
-000055e0: 6520 4353 5333 206e 616d 6520 696e 746f  e CSS3 name into
-000055f0: 2048 544d 4c22 2222 0a20 2020 2072 6574   HTML""".    ret
-00005600: 7572 6e20 636f 6c6f 725f 6e61 6d65 3266  urn color_name2f
-00005610: 6f72 6d61 7428 6e2c 2066 6f72 6d61 743d  ormat(n, format=
-00005620: 2768 746d 6c27 290a 0a0a 6465 6620 636f  'html')...def co
-00005630: 6c6f 725f 6e61 6d65 3272 6762 286e 293a  lor_name2rgb(n):
-00005640: 0a20 2020 2022 2222 2043 6f6e 7665 7274  .    """ Convert
-00005650: 7320 6120 7369 6e67 6c65 2043 5353 3320  s a single CSS3 
-00005660: 6e61 6d65 2069 6e74 6f20 5247 4222 2222  name into RGB"""
-00005670: 0a20 2020 2072 6574 7572 6e20 636f 6c6f  .    return colo
-00005680: 725f 6e61 6d65 3266 6f72 6d61 7428 6e2c  r_name2format(n,
-00005690: 2066 6f72 6d61 743d 2772 6762 2729 0a0a   format='rgb')..
-000056a0: 0a64 6566 2063 6f6c 6f72 5f6e 616d 6532  .def color_name2
-000056b0: 7267 6261 286e 293a 0a20 2020 2022 2222  rgba(n):.    """
-000056c0: 2043 6f6e 7665 7274 7320 6120 7369 6e67   Converts a sing
-000056d0: 6c65 2043 5353 3320 6e61 6d65 2069 6e74  le CSS3 name int
-000056e0: 6f20 5247 4241 2222 220a 2020 2020 7265  o RGBA""".    re
-000056f0: 7475 726e 2063 6f6c 6f72 5f6e 616d 6532  turn color_name2
-00005700: 666f 726d 6174 286e 2c20 666f 726d 6174  format(n, format
-00005710: 3d27 7267 6261 2729 0a0a 4066 756e 6374  ='rgba')..@funct
-00005720: 696f 6e5f 6c6f 6767 6572 0a64 6566 2063  ion_logger.def c
-00005730: 6f6c 6f72 5f70 6172 616d 7332 7267 6261  olor_params2rgba
-00005740: 2863 6f6c 6f72 5f6e 616d 653d 4e6f 6e65  (color_name=None
-00005750: 2c20 636f 6c6f 725f 6874 6d6c 3d4e 6f6e  , color_html=Non
-00005760: 652c 2063 6f6c 6f72 5f72 3d4e 6f6e 652c  e, color_r=None,
-00005770: 2063 6f6c 6f72 5f67 3d4e 6f6e 652c 2063   color_g=None, c
-00005780: 6f6c 6f72 5f62 3d4e 6f6e 652c 2063 6f6c  olor_b=None, col
-00005790: 6f72 5f61 3d4e 6f6e 6529 3a0a 2020 2020  or_a=None):.    
-000057a0: 2222 2220 466f 7220 6675 6e63 7469 6f6e  """ For function
-000057b0: 7320 7768 6572 6520 7468 6520 636f 6c6f  s where the colo
-000057c0: 7220 6361 6e20 6265 2073 7065 6369 6669  r can be specifi
-000057d0: 6564 2069 6e20 666f 7572 2064 6966 6665  ed in four diffe
-000057e0: 7265 6e74 2077 6179 7320 2848 544d 4c20  rent ways (HTML 
-000057f0: 7374 7269 6e67 2c20 4353 5320 6e61 6d65  string, CSS name
-00005800: 2c0a 2020 2020 5247 422c 206f 7220 5247  ,.    RGB, or RG
-00005810: 4241 292c 2063 6f6e 7665 7274 2074 6865  BA), convert the
-00005820: 2067 6976 656e 2070 6172 616d 6574 6572   given parameter
-00005830: 7320 746f 2052 4742 412e 0a0a 2020 2020  s to RGBA...    
-00005840: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-00005850: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 636f  ---------.    co
-00005860: 6c6f 725f 6e61 6d65 203a 203a 6f62 6a3a  lor_name : :obj:
-00005870: 6073 7472 602c 206f 7074 696f 6e61 6c0a  `str`, optional.
-00005880: 2020 2020 2020 2020 4173 2061 206e 616d          As a nam
-00005890: 6520 796f 7520 6361 6e20 7573 6520 4353  e you can use CS
-000058a0: 5320 636f 6c6f 7273 206f 7220 4d75 7365  S colors or Muse
-000058b0: 5363 6f72 6520 636f 6c6f 7273 2028 7365  Score colors (se
-000058c0: 6520 3a70 793a 6174 7472 3a60 2e4d 5333  e :py:attr:`.MS3
-000058d0: 5f43 4f4c 4f52 5360 292e 0a20 2020 2063  _COLORS`)..    c
-000058e0: 6f6c 6f72 5f68 746d 6c20 3a20 3a6f 626a  olor_html : :obj
-000058f0: 3a60 7374 7260 2c20 6f70 7469 6f6e 616c  :`str`, optional
-00005900: 0a20 2020 2020 2020 2041 6e20 4854 4d4c  .        An HTML
-00005910: 2063 6f6c 6f72 206e 6565 6473 2074 6f20   color needs to 
-00005920: 6265 2073 7472 696e 6720 6f66 206c 656e  be string of len
-00005930: 6774 6820 362e 0a20 2020 2063 6f6c 6f72  gth 6..    color
-00005940: 5f72 203a 203a 6f62 6a3a 6069 6e74 602c  _r : :obj:`int`,
-00005950: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00005960: 2020 4966 2079 6f75 2073 7065 6369 6679    If you specify
-00005970: 2074 6865 2063 6f6c 6f72 2061 7320 5247   the color as RG
-00005980: 4228 4129 2c20 796f 7520 616c 736f 206e  B(A), you also n
-00005990: 6565 6420 746f 2073 7065 6369 6679 2063  eed to specify c
-000059a0: 6f6c 6f72 5f67 2061 6e64 2063 6f6c 6f72  olor_g and color
-000059b0: 5f62 2e0a 2020 2020 636f 6c6f 725f 6720  _b..    color_g 
-000059c0: 3a20 3a6f 626a 3a60 696e 7460 2c20 6f70  : :obj:`int`, op
-000059d0: 7469 6f6e 616c 0a20 2020 2020 2020 2049  tional.        I
-000059e0: 6620 796f 7520 7370 6563 6966 7920 7468  f you specify th
-000059f0: 6520 636f 6c6f 7220 6173 2052 4742 2841  e color as RGB(A
-00005a00: 292c 2079 6f75 2061 6c73 6f20 6e65 6564  ), you also need
-00005a10: 2074 6f20 7370 6563 6966 7920 636f 6c6f   to specify colo
-00005a20: 725f 7220 616e 6420 636f 6c6f 725f 622e  r_r and color_b.
-00005a30: 0a20 2020 2063 6f6c 6f72 5f62 203a 203a  .    color_b : :
-00005a40: 6f62 6a3a 6069 6e74 602c 206f 7074 696f  obj:`int`, optio
-00005a50: 6e61 6c0a 2020 2020 2020 2020 4966 2079  nal.        If y
-00005a60: 6f75 2073 7065 6369 6679 2074 6865 2063  ou specify the c
-00005a70: 6f6c 6f72 2061 7320 5247 4228 4129 2c20  olor as RGB(A), 
-00005a80: 796f 7520 616c 736f 206e 6565 6420 746f  you also need to
-00005a90: 2073 7065 6369 6679 2063 6f6c 6f72 5f72   specify color_r
-00005aa0: 2061 6e64 2063 6f6c 6f72 5f67 2e0a 2020   and color_g..  
-00005ab0: 2020 636f 6c6f 725f 6120 3a20 3a6f 626a    color_a : :obj
-00005ac0: 3a60 696e 7460 2c20 6f70 7469 6f6e 616c  :`int`, optional
-00005ad0: 0a20 2020 2020 2020 2049 6620 796f 7520  .        If you 
-00005ae0: 6861 7665 2073 7065 6369 6669 6564 2061  have specified a
-00005af0: 6e20 5247 4220 636f 6c6f 722c 2074 6865  n RGB color, the
-00005b00: 2061 6c70 6861 2076 616c 7565 2064 6566   alpha value def
-00005b10: 6175 6c74 7320 746f 2032 3535 2075 6e6c  aults to 255 unl
-00005b20: 6573 7320 7370 6563 6966 6965 6420 6f74  ess specified ot
-00005b30: 6865 7277 6973 652e 0a0a 2020 2020 5265  herwise...    Re
-00005b40: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-00005b50: 2d0a 2020 2020 3a6f 626a 3a60 7267 6261  -.    :obj:`rgba
-00005b60: 600a 2020 2020 2020 2020 3a6f 626a 3a60  `.        :obj:`
-00005b70: 6e61 6d65 6474 7570 6c65 6020 7769 7468  namedtuple` with
-00005b80: 2066 6f75 7220 696e 7465 6765 7273 2e0a   four integers..
-00005b90: 2020 2020 2222 220a 2020 2020 6966 2061      """.    if a
-00005ba0: 6c6c 2870 642e 6973 6e75 6c6c 2870 6172  ll(pd.isnull(par
-00005bb0: 616d 2920 666f 7220 7061 7261 6d20 696e  am) for param in
-00005bc0: 205b 636f 6c6f 725f 6e61 6d65 2c20 636f   [color_name, co
-00005bd0: 6c6f 725f 6874 6d6c 2c20 636f 6c6f 725f  lor_html, color_
-00005be0: 722c 2063 6f6c 6f72 5f67 2c20 636f 6c6f  r, color_g, colo
-00005bf0: 725f 622c 2063 6f6c 6f72 5f61 5d29 3a0a  r_b, color_a]):.
-00005c00: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-00005c10: 6562 7567 2866 224e 6f6e 6520 6f66 2074  ebug(f"None of t
-00005c20: 6865 2070 6172 616d 6574 6572 7320 6861  he parameters ha
-00005c30: 7665 2062 6565 6e20 7370 6563 6966 6965  ve been specifie
-00005c40: 642e 2052 6574 7572 6e69 6e67 204e 6f6e  d. Returning Non
-00005c50: 652e 2229 0a20 2020 2020 2020 2072 6574  e.").        ret
-00005c60: 7572 6e20 4e6f 6e65 0a20 2020 2072 6573  urn None.    res
-00005c70: 203d 204e 6f6e 650a 2020 2020 6966 206e   = None.    if n
-00005c80: 6f74 2070 642e 6973 6e75 6c6c 2863 6f6c  ot pd.isnull(col
-00005c90: 6f72 5f72 293a 0a20 2020 2020 2020 2069  or_r):.        i
-00005ca0: 6620 7064 2e69 736e 756c 6c28 636f 6c6f  f pd.isnull(colo
-00005cb0: 725f 6129 3a0a 2020 2020 2020 2020 2020  r_a):.          
-00005cc0: 2020 636f 6c6f 725f 6120 3d20 3235 350a    color_a = 255.
-00005cd0: 2020 2020 2020 2020 6966 2070 642e 6973          if pd.is
-00005ce0: 6e75 6c6c 2863 6f6c 6f72 5f67 2920 6f72  null(color_g) or
-00005cf0: 2070 642e 6973 6e75 6c6c 2863 6f6c 6f72   pd.isnull(color
-00005d00: 5f62 293a 0a20 2020 2020 2020 2020 2020  _b):.           
-00005d10: 2069 6620 7064 2e69 736e 756c 6c28 636f   if pd.isnull(co
-00005d20: 6c6f 725f 6e61 6d65 2920 616e 6420 7064  lor_name) and pd
-00005d30: 2e69 736e 756c 6c28 636f 6c6f 725f 6874  .isnull(color_ht
-00005d40: 6d6c 293a 0a20 2020 2020 2020 2020 2020  ml):.           
-00005d50: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
-00005d60: 696e 6728 6622 4e6f 7420 6120 7661 6c69  ing(f"Not a vali
-00005d70: 6420 5247 4220 636f 6c6f 723a 207b 2863  d RGB color: {(c
-00005d80: 6f6c 6f72 5f72 2c20 636f 6c6f 725f 672c  olor_r, color_g,
-00005d90: 2063 6f6c 6f72 5f62 297d 2229 0a20 2020   color_b)}").   
-00005da0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00005db0: 2020 2020 2020 2072 6573 203d 2028 636f         res = (co
-00005dc0: 6c6f 725f 722c 2063 6f6c 6f72 5f67 2c20  lor_r, color_g, 
-00005dd0: 636f 6c6f 725f 622c 2063 6f6c 6f72 5f61  color_b, color_a
-00005de0: 290a 2020 2020 6966 2072 6573 2069 7320  ).    if res is 
-00005df0: 4e6f 6e65 2061 6e64 206e 6f74 2070 642e  None and not pd.
-00005e00: 6973 6e75 6c6c 2863 6f6c 6f72 5f68 746d  isnull(color_htm
-00005e10: 6c29 3a0a 2020 2020 2020 2020 7265 7320  l):.        res 
-00005e20: 3d20 636f 6c6f 7232 7267 6261 2863 6f6c  = color2rgba(col
-00005e30: 6f72 5f68 746d 6c29 0a20 2020 2069 6620  or_html).    if 
-00005e40: 7265 7320 6973 204e 6f6e 6520 616e 6420  res is None and 
-00005e50: 6e6f 7420 7064 2e69 736e 756c 6c28 636f  not pd.isnull(co
-00005e60: 6c6f 725f 6e61 6d65 293a 0a20 2020 2020  lor_name):.     
-00005e70: 2020 2072 6573 203d 2063 6f6c 6f72 3272     res = color2r
-00005e80: 6762 6128 636f 6c6f 725f 6e61 6d65 290a  gba(color_name).
-00005e90: 2020 2020 7265 7475 726e 2072 6762 6128      return rgba(
-00005ea0: 2a72 6573 290a 0a0a 6465 6620 616c 6c6e  *res)...def alln
-00005eb0: 616d 6573 6571 7561 6c28 6e61 6d65 293a  amesequal(name):
-00005ec0: 0a20 2020 2072 6574 7572 6e20 616c 6c28  .    return all(
-00005ed0: 6e20 3d3d 206e 616d 655b 305d 2066 6f72  n == name[0] for
-00005ee0: 206e 2069 6e20 6e61 6d65 5b31 3a5d 290a   n in name[1:]).
-00005ef0: 0a64 6566 2063 6f6d 6d6f 6e70 7265 6669  .def commonprefi
-00005f00: 7828 7061 7468 732c 2073 6570 3d27 2f27  x(paths, sep='/'
-00005f10: 293a 0a20 2020 2022 2222 2052 6574 7572  ):.    """ Retur
-00005f20: 6e73 2063 6f6d 6d6f 6e20 7072 6566 6978  ns common prefix
-00005f30: 206f 6620 6120 6c69 7374 206f 6620 7061   of a list of pa
-00005f40: 7468 732e 0a20 2020 2055 7365 733a 2061  ths..    Uses: a
-00005f50: 6c6c 6e61 6d65 7365 7175 616c 2829 2c20  llnamesequal(), 
-00005f60: 6974 6572 746f 6f6c 732e 7461 6b65 7768  itertools.takewh
-00005f70: 696c 6528 2922 2222 0a20 2020 2062 7964  ile()""".    byd
-00005f80: 6972 6563 746f 7279 6c65 7665 6c73 203d  irectorylevels =
-00005f90: 207a 6970 282a 5b70 2e73 706c 6974 2873   zip(*[p.split(s
-00005fa0: 6570 2920 666f 7220 7020 696e 2070 6174  ep) for p in pat
-00005fb0: 6873 5d29 0a20 2020 2072 6574 7572 6e20  hs]).    return 
-00005fc0: 7365 702e 6a6f 696e 2878 5b30 5d20 666f  sep.join(x[0] fo
-00005fd0: 7220 7820 696e 2074 616b 6577 6869 6c65  r x in takewhile
-00005fe0: 2861 6c6c 6e61 6d65 7365 7175 616c 2c20  (allnamesequal, 
-00005ff0: 6279 6469 7265 6374 6f72 796c 6576 656c  bydirectorylevel
-00006000: 7329 290a 0a0a 6465 6620 636f 6d70 7574  s))...def comput
-00006010: 655f 6d6e 286d 6561 7375 7265 733a 2070  e_mn(measures: p
-00006020: 642e 4461 7461 4672 616d 6529 202d 3e20  d.DataFrame) -> 
-00006030: 7064 2e53 6572 6965 733a 0a20 2020 2022  pd.Series:.    "
-00006040: 2222 2043 6f6d 7075 7465 206d 6561 7375  "" Compute measu
-00006050: 7265 206e 756d 6265 7220 696e 7465 6765  re number intege
-00006060: 7273 2066 726f 6d20 6120 6d65 6173 7572  rs from a measur
-00006070: 6573 2074 6162 6c65 2e0a 0a0a 2020 2020  es table....    
-00006080: 4172 6773 3a0a 2020 2020 2020 6d65 6173  Args:.      meas
-00006090: 7572 6573 3a20 4d65 6173 7572 6573 2074  ures: Measures t
-000060a0: 6162 6c65 2077 6974 6820 636f 6c75 6d6e  able with column
-000060b0: 7320 5b27 6d63 272c 2027 646f 6e74 5f63  s ['mc', 'dont_c
-000060c0: 6f75 6e74 272c 2027 6e75 6d62 6572 696e  ount', 'numberin
-000060d0: 675f 6f66 6673 6574 275d 2e0a 0a20 2020  g_offset']...   
-000060e0: 2052 6574 7572 6e73 3a0a 0a20 2020 2022   Returns:..    "
-000060f0: 2222 0a20 2020 2065 7863 6c75 6465 6420  "".    excluded 
-00006100: 3d20 6d65 6173 7572 6573 5b27 646f 6e74  = measures['dont
-00006110: 5f63 6f75 6e74 275d 2e66 696c 6c6e 6128  _count'].fillna(
-00006120: 3029 2e61 7374 7970 6528 626f 6f6c 290a  0).astype(bool).
-00006130: 2020 2020 6f66 6673 6574 203d 206d 6561      offset = mea
-00006140: 7375 7265 735b 276e 756d 6265 7269 6e67  sures['numbering
-00006150: 5f6f 6666 7365 7427 5d0a 2020 2020 6d6e  _offset'].    mn
-00006160: 203d 2028 7e65 7863 6c75 6465 6429 2e63   = (~excluded).c
-00006170: 756d 7375 6d28 290a 2020 2020 6966 206f  umsum().    if o
-00006180: 6666 7365 742e 6e6f 746e 6128 292e 616e  ffset.notna().an
-00006190: 7928 293a 0a20 2020 2020 2020 206f 6666  y():.        off
-000061a0: 7365 7420 3d20 6f66 6673 6574 2e66 696c  set = offset.fil
-000061b0: 6c6e 6128 3029 2e61 7374 7970 6528 696e  lna(0).astype(in
-000061c0: 7429 2e63 756d 7375 6d28 290a 2020 2020  t).cumsum().    
-000061d0: 2020 2020 6d6e 202b 3d20 6f66 6673 6574      mn += offset
-000061e0: 0a20 2020 2072 6574 7572 6e20 6d6e 2e72  .    return mn.r
-000061f0: 656e 616d 6528 276d 6e27 290a 0a40 6675  ename('mn')..@fu
-00006200: 6e63 7469 6f6e 5f6c 6f67 6765 720a 6465  nction_logger.de
-00006210: 6620 636f 6d70 7574 655f 6d6e 5f70 6c61  f compute_mn_pla
-00006220: 7974 6872 6f75 6768 286d 6561 7375 7265  ythrough(measure
-00006230: 733a 2070 642e 4461 7461 4672 616d 6529  s: pd.DataFrame)
-00006240: 202d 3e20 7064 2e53 6572 6965 733a 0a20   -> pd.Series:. 
-00006250: 2020 2022 2222 2043 6f6d 7075 7465 206d     """ Compute m
-00006260: 6561 7375 7265 206e 756d 6265 7220 7374  easure number st
-00006270: 7269 6e67 7320 6672 6f6d 2061 6e20 756e  rings from an un
-00006280: 666f 6c64 6564 206d 6561 7375 7265 7320  folded measures 
-00006290: 7461 626c 652c 2073 7563 6820 7468 6174  table, such that
-000062a0: 2074 6865 2066 6972 7374 206f 6363 7572   the first occur
-000062b0: 7265 6e63 6520 6f66 2061 206d 6561 7375  rence of a measu
-000062c0: 7265 0a20 2020 206e 756d 6265 7220 656e  re.    number en
-000062d0: 6473 206f 6e20 2761 272c 2074 6865 2073  ds on 'a', the s
-000062e0: 6563 6f6e 6420 6f6e 6520 6f6e 2027 6227  econd one on 'b'
-000062f0: 2065 7463 2e0a 0a20 2020 2054 6865 2066   etc...    The f
-00006300: 756e 6374 696f 6e20 7265 7175 6972 6573  unction requires
-00006310: 2074 6865 2063 6f6c 756d 6e20 2764 6f6e   the column 'don
-00006320: 745f 636f 756e 7427 2069 6e20 6f72 6465  t_count' in orde
-00006330: 7220 746f 2063 6f72 7265 6374 6c79 206e  r to correctly n
-00006340: 756d 6265 7220 7468 6520 7265 7475 726e  umber the return
-00006350: 206f 6620 6120 636f 6d70 6c65 7469 6e67   of a completing
-00006360: 204d 4320 6166 7465 7220 616e 0a20 2020   MC after an.   
-00006370: 2069 6e63 6f6d 706c 6574 6520 4d43 2077   incomplete MC w
-00006380: 6974 6820 2265 6e64 7265 7065 6174 2220  ith "endrepeat" 
-00006390: 7369 676e 2e20 466f 7220 6578 616d 706c  sign. For exampl
-000063a0: 652c 2069 6620 6120 7265 7065 6174 6564  e, if a repeated
-000063b0: 2073 6563 7469 6f6e 2062 6567 696e 7320   section begins 
-000063c0: 7769 7468 2061 6e20 7570 6265 6174 2074  with an upbeat t
-000063d0: 6861 7420 6174 2066 6972 7374 0a20 2020  hat at first.   
-000063e0: 2063 6f6d 706c 6574 6573 204d 4e20 3136   completes MN 16
-000063f0: 2069 7420 7769 6c6c 2068 6176 6520 6d6e   it will have mn
-00006400: 5f70 6c61 7974 6872 6f75 6768 2027 3136  _playthrough '16
-00006410: 6127 2074 6865 2066 6972 7374 2074 696d  a' the first tim
-00006420: 6520 616e 6420 2733 3261 2720 7468 6520  e and '32a' the 
-00006430: 7365 636f 6e64 2074 696d 6520 2861 7373  second time (ass
-00006440: 756d 696e 6720 6974 2063 6f6d 706c 6574  uming it complet
-00006450: 6573 0a20 2020 2074 6865 2069 6e63 6f6d  es.    the incom
-00006460: 706c 6574 6520 4d4e 2033 3229 2e0a 0a20  plete MN 32)... 
-00006470: 2020 2041 7267 733a 0a20 2020 2020 206d     Args:.      m
-00006480: 6561 7375 7265 733a 204d 6561 7375 7265  easures: Measure
-00006490: 7320 7461 626c 6520 7769 7468 2063 6f6c  s table with col
-000064a0: 756d 6e73 205b 276d 6327 2c20 276d 6e27  umns ['mc', 'mn'
-000064b0: 2c20 2764 6f6e 745f 636f 756e 7427 5d0a  , 'dont_count'].
-000064c0: 0a20 2020 2052 6574 7572 6e73 3a0a 2020  .    Returns:.  
-000064d0: 2020 2020 276d 6e5f 706c 6179 7468 726f      'mn_playthro
-000064e0: 7567 6827 2053 6572 6965 7320 6f66 2064  ugh' Series of d
-000064f0: 6973 616d 6269 6775 6174 6564 206d 6561  isambiguated mea
-00006500: 7375 7265 206e 756d 6265 7220 7374 7269  sure number stri
-00006510: 6e67 732e 2049 6620 6e6f 206d 6561 7375  ngs. If no measu
-00006520: 7265 2072 6570 6561 7473 2c20 7468 6520  re repeats, the 
-00006530: 7265 7375 6c74 2077 696c 6c20 6265 0a20  result will be. 
-00006540: 2020 2020 2065 7175 6976 616c 656e 7420       equivalent 
-00006550: 746f 2063 6f6e 7665 7274 696e 6720 636f  to converting co
-00006560: 6c75 6d6e 2027 6d6e 2720 746f 2073 7472  lumn 'mn' to str
-00006570: 696e 6773 2061 6e64 2061 7070 656e 6469  ings and appendi
-00006580: 6e67 2027 6127 2074 6f20 616c 6c20 6f66  ng 'a' to all of
-00006590: 2074 6865 6d2e 0a20 2020 2022 2222 0a20   them..    """. 
-000065a0: 2020 2070 7265 7669 6f75 735f 6f63 6375     previous_occu
-000065b0: 7272 656e 6365 7320 3d20 6465 6661 756c  rrences = defaul
-000065c0: 7464 6963 7428 6c61 6d62 6461 3a20 3029  tdict(lambda: 0)
-000065d0: 0a0a 2020 2020 6465 6620 6765 745f 6d6e  ..    def get_mn
-000065e0: 5f70 6c61 7974 6872 6f75 6768 286d 6e29  _playthrough(mn)
-000065f0: 3a0a 2020 2020 2020 2020 7265 7065 6174  :.        repeat
-00006600: 5f63 6861 7220 3d20 6368 7228 7072 6576  _char = chr(prev
-00006610: 696f 7573 5f6f 6363 7572 7265 6e63 6573  ious_occurrences
-00006620: 5b6d 6e5d 202b 2039 3629 0a20 2020 2020  [mn] + 96).     
-00006630: 2020 2072 6574 7572 6e20 6622 7b6d 6e7d     return f"{mn}
-00006640: 7b72 6570 6561 745f 6368 6172 7d22 0a0a  {repeat_char}"..
-00006650: 2020 2020 6d6e 5f70 6c61 7974 6872 6f75      mn_playthrou
-00006660: 6768 5f63 6f6c 756d 6e20 3d20 5b5d 0a20  gh_column = []. 
-00006670: 2020 2070 7265 7669 6f75 735f 6d63 2c20     previous_mc, 
-00006680: 7072 6576 696f 7573 5f6d 6e20 3d20 302c  previous_mn = 0,
-00006690: 202d 310a 2020 2020 666f 7220 6d63 2c20   -1.    for mc, 
-000066a0: 6d6e 2c20 646f 6e74 5f63 6f75 6e74 2069  mn, dont_count i
-000066b0: 6e20 6d65 6173 7572 6573 5b5b 276d 6327  n measures[['mc'
-000066c0: 2c20 276d 6e27 2c20 2764 6f6e 745f 636f  , 'mn', 'dont_co
-000066d0: 756e 7427 5d5d 2e69 7465 7274 7570 6c65  unt']].itertuple
-000066e0: 7328 6e61 6d65 3d4e 6f6e 652c 2069 6e64  s(name=None, ind
-000066f0: 6578 3d46 616c 7365 293a 0a20 2020 2020  ex=False):.     
-00006700: 2020 2069 6620 6d6e 2021 3d20 7072 6576     if mn != prev
-00006710: 696f 7573 5f6d 6e3a 0a20 2020 2020 2020  ious_mn:.       
-00006720: 2020 2020 2070 7265 7669 6f75 735f 6f63       previous_oc
-00006730: 6375 7272 656e 6365 735b 6d6e 5d20 2b3d  currences[mn] +=
-00006740: 2031 0a20 2020 2020 2020 2069 6620 6d63   1.        if mc
-00006750: 203c 2070 7265 7669 6f75 735f 6d63 2061   < previous_mc a
-00006760: 6e64 206e 6f74 2070 642e 6973 6e75 6c6c  nd not pd.isnull
-00006770: 2864 6f6e 745f 636f 756e 7429 3a0a 2020  (dont_count):.  
-00006780: 2020 2020 2020 2020 2020 2320 616e 2065            # an e
-00006790: 6172 6c69 6572 204d 4320 636f 6d70 6c65  arlier MC comple
-000067a0: 7465 7320 6120 6c61 7465 7220 6f6e 6520  tes a later one 
-000067b0: 6166 7465 7220 6120 7265 7065 6174 0a20  after a repeat. 
-000067c0: 2020 2020 2020 2020 2020 206d 6e5f 706c             mn_pl
-000067d0: 6179 7468 726f 7567 6820 3d20 6765 745f  aythrough = get_
-000067e0: 6d6e 5f70 6c61 7974 6872 6f75 6768 2870  mn_playthrough(p
-000067f0: 7265 7669 6f75 735f 6d6e 290a 2020 2020  revious_mn).    
-00006800: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-00006810: 6562 7567 2866 224d 4e20 7b6d 6e7d 203c  ebug(f"MN {mn} <
-00006820: 2070 7265 7669 6f75 7320 4d4e 207b 7072   previous MN {pr
-00006830: 6576 696f 7573 5f6d 6e7d 3b20 6275 7420  evious_mn}; but 
-00006840: 7369 6e63 6520 4d43 207b 6d63 7d20 6973  since MC {mc} is
-00006850: 2065 7863 6c75 6465 6420 6672 6f6d 2062   excluded from b
-00006860: 6172 636f 756e 742c 2022 0a20 2020 2020  arcount, ".     
-00006870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006880: 2020 2020 6622 7468 6520 7265 7065 7469      f"the repeti
-00006890: 7469 6f6e 2068 6173 206d 6e5f 706c 6179  tion has mn_play
-000068a0: 7468 726f 7567 6820 7b6d 6e5f 706c 6179  through {mn_play
-000068b0: 7468 726f 7567 687d 2e22 290a 2020 2020  through}.").    
-000068c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000068d0: 2020 2020 2020 6d6e 5f70 6c61 7974 6872        mn_playthr
-000068e0: 6f75 6768 203d 2067 6574 5f6d 6e5f 706c  ough = get_mn_pl
-000068f0: 6179 7468 726f 7567 6828 6d6e 290a 2020  aythrough(mn).  
-00006900: 2020 2020 2020 6d6e 5f70 6c61 7974 6872        mn_playthr
-00006910: 6f75 6768 5f63 6f6c 756d 6e2e 6170 7065  ough_column.appe
-00006920: 6e64 286d 6e5f 706c 6179 7468 726f 7567  nd(mn_playthroug
-00006930: 6829 0a20 2020 2020 2020 2070 7265 7669  h).        previ
-00006940: 6f75 735f 6d6e 203d 206d 6e0a 2020 2020  ous_mn = mn.    
-00006950: 2020 2020 7072 6576 696f 7573 5f6d 6320      previous_mc 
-00006960: 3d20 6d63 0a20 2020 2072 6574 7572 6e20  = mc.    return 
-00006970: 7064 2e53 6572 6965 7328 6d6e 5f70 6c61  pd.Series(mn_pla
-00006980: 7974 6872 6f75 6768 5f63 6f6c 756d 6e2c  ythrough_column,
-00006990: 2069 6e64 6578 3d6d 6561 7375 7265 732e   index=measures.
-000069a0: 696e 6465 782c 206e 616d 653d 276d 6e5f  index, name='mn_
-000069b0: 706c 6179 7468 726f 7567 6827 290a 0a40  playthrough')..@
-000069c0: 6c72 755f 6361 6368 6528 290a 6465 6620  lru_cache().def 
-000069d0: 6765 745f 6d61 6a6f 725f 7665 7273 696f  get_major_versio
-000069e0: 6e5f 6f66 5f6d 7573 6573 636f 7265 5f65  n_of_musescore_e
-000069f0: 7865 6375 7461 626c 6528 6d73 2920 2d3e  xecutable(ms) ->
-00006a00: 204f 7074 696f 6e61 6c5b 696e 745d 3a0a   Optional[int]:.
-00006a10: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00006a20: 2072 6573 756c 7420 3d20 7375 6270 726f   result = subpro
-00006a30: 6365 7373 2e72 756e 285b 6d73 2c20 222d  cess.run([ms, "-
-00006a40: 7622 5d2c 2063 6170 7475 7265 5f6f 7574  v"], capture_out
-00006a50: 7075 743d 5472 7565 2c20 7465 7874 3d54  put=True, text=T
-00006a60: 7275 6529 0a20 2020 2020 2020 2076 6572  rue).        ver
-00006a70: 7369 6f6e 203d 2072 6573 756c 742e 7374  sion = result.st
-00006a80: 646f 7574 0a20 2020 2020 2020 2069 6620  dout.        if 
-00006a90: 7665 7273 696f 6e2e 7374 6172 7473 7769  version.startswi
-00006aa0: 7468 2827 4d75 7365 5363 6f72 6527 293a  th('MuseScore'):
-00006ab0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00006ac0: 7572 6e20 696e 7428 7665 7273 696f 6e5b  urn int(version[
-00006ad0: 395d 290a 2020 2020 2020 2020 7265 7475  9]).        retu
-00006ae0: 726e 0a20 2020 2065 7863 6570 7420 4578  rn.    except Ex
-00006af0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00006b00: 2072 6574 7572 6e0a 0a0a 4066 756e 6374   return...@funct
-00006b10: 696f 6e5f 6c6f 6767 6572 0a64 6566 2063  ion_logger.def c
-00006b20: 6f6e 7665 7274 286f 6c64 2c20 6e65 772c  onvert(old, new,
-00006b30: 204d 533d 276d 7363 6f72 6527 293a 0a20   MS='mscore'):. 
-00006b40: 2020 2076 6572 7369 6f6e 203d 2067 6574     version = get
-00006b50: 5f6d 616a 6f72 5f76 6572 7369 6f6e 5f6f  _major_version_o
-00006b60: 665f 6d75 7365 7363 6f72 655f 6578 6563  f_musescore_exec
-00006b70: 7574 6162 6c65 284d 5329 0a20 2020 2069  utable(MS).    i
-00006b80: 6620 7665 7273 696f 6e20 3d3d 2034 3a0a  f version == 4:.
-00006b90: 2020 2020 2020 2020 636f 6e76 6572 745f          convert_
-00006ba0: 746f 5f6d 7334 286f 6c64 3d6f 6c64 2c20  to_ms4(old=old, 
-00006bb0: 6e65 773d 6e65 772c 204d 533d 4d53 2c20  new=new, MS=MS, 
-00006bc0: 6c6f 6767 6572 3d6c 6f67 6765 7229 0a20  logger=logger). 
-00006bd0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-00006be0: 2020 7072 6f63 6573 7320 3d20 5b4d 532c    process = [MS,
-00006bf0: 2022 2d66 6f22 2c20 6e65 772c 206f 6c64   "-fo", new, old
-00006c00: 5d20 235b 4d53 2c20 272d 2d61 7070 696d  ] #[MS, '--appim
-00006c10: 6167 652d 6578 7472 6163 742d 616e 642d  age-extract-and-
-00006c20: 7275 6e27 2c20 222d 666f 222c 206e 6577  run', "-fo", new
-00006c30: 2c20 6f6c 645d 2069 6620 4d53 2e65 6e64  , old] if MS.end
-00006c40: 7377 6974 6828 272e 4170 7049 6d61 6765  swith('.AppImage
-00006c50: 2729 2065 6c73 6520 5b4d 532c 2022 2d66  ') else [MS, "-f
-00006c60: 6f22 2c20 6e65 772c 206f 6c64 5d0a 2020  o", new, old].  
-00006c70: 2020 6966 2073 7562 7072 6f63 6573 732e    if subprocess.
-00006c80: 7275 6e28 7072 6f63 6573 732c 2063 6170  run(process, cap
-00006c90: 7475 7265 5f6f 7574 7075 743d 5472 7565  ture_output=True
-00006ca0: 2c20 7465 7874 3d54 7275 6529 3a0a 2020  , text=True):.  
-00006cb0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-00006cc0: 6f28 6622 436f 6e76 6572 7465 6420 7b6f  o(f"Converted {o
-00006cd0: 6c64 7d20 746f 207b 6e65 777d 2229 0a20  ld} to {new}"). 
-00006ce0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006cf0: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-00006d00: 2245 7272 6f72 2077 6869 6c65 2063 6f6e  "Error while con
-00006d10: 7665 7274 696e 6720 2220 2b20 6f6c 6429  verting " + old)
-00006d20: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
-00006d30: 6572 0a64 6566 2063 6f6e 7665 7274 5f74  er.def convert_t
-00006d40: 6f5f 6d73 3428 6f6c 642c 206e 6577 2c20  o_ms4(old, new, 
-00006d50: 4d53 3d27 6d73 636f 7265 2729 3a0a 2020  MS='mscore'):.  
-00006d60: 2020 7665 7273 696f 6e20 3d20 6765 745f    version = get_
-00006d70: 6d61 6a6f 725f 7665 7273 696f 6e5f 6f66  major_version_of
-00006d80: 5f6d 7573 6573 636f 7265 5f65 7865 6375  _musescore_execu
-00006d90: 7461 626c 6528 4d53 290a 2020 2020 6966  table(MS).    if
-00006da0: 206e 6f74 2028 7665 7273 696f 6e20 6973   not (version is
-00006db0: 204e 6f6e 6520 6f72 2076 6572 7369 6f6e   None or version
-00006dc0: 203d 3d20 3429 3a0a 2020 2020 2020 2020   == 4):.        
-00006dd0: 6966 2076 6572 7369 6f6e 2069 7320 4e6f  if version is No
-00006de0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00006df0: 6d73 6720 3d20 6622 7b4d 537d 2069 7320  msg = f"{MS} is 
-00006e00: 6e6f 7420 4d75 7365 5363 6f72 6520 342e  not MuseScore 4.
-00006e10: 782e 782e 220a 2020 2020 2020 2020 656c  x.x.".        el
-00006e20: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00006e30: 6d73 6720 3d20 6622 7b4d 537d 2069 7320  msg = f"{MS} is 
-00006e40: 4d75 7365 5363 6f72 6520 7b76 6572 7369  MuseScore {versi
-00006e50: 6f6e 7d2c 206e 6f74 2034 2e20 5472 7920  on}, not 4. Try 
-00006e60: 636f 6e76 6572 7428 292e 220a 2020 2020  convert().".    
-00006e70: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
-00006e80: 6545 7272 6f72 286d 7367 290a 2020 2020  eError(msg).    
-00006e90: 6f6c 645f 7061 7468 2c20 6f6c 645f 6669  old_path, old_fi
-00006ea0: 6c65 203d 206f 732e 7061 7468 2e73 706c  le = os.path.spl
-00006eb0: 6974 286f 6c64 290a 2020 2020 6f6c 645f  it(old).    old_
-00006ec0: 666e 616d 652c 206f 6c64 5f65 7874 203d  fname, old_ext =
-00006ed0: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-00006ee0: 7428 6f6c 645f 6669 6c65 290a 2020 2020  t(old_file).    
-00006ef0: 6966 206f 6c64 5f65 7874 2e6c 6f77 6572  if old_ext.lower
-00006f00: 2829 206e 6f74 2069 6e20 5343 4f52 455f  () not in SCORE_
-00006f10: 4558 5445 4e53 494f 4e53 3a0a 2020 2020  EXTENSIONS:.    
-00006f20: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
-00006f30: 6e67 2866 2253 6f75 7263 6520 6669 6c65  ng(f"Source file
-00006f40: 2027 7b6f 6c64 7d27 2064 6f65 736e 2774   '{old}' doesn't
-00006f50: 2068 6176 6520 6f6e 6520 6f66 2074 6865   have one of the
-00006f60: 2066 6f6c 6c6f 7769 6e67 2065 7874 656e   following exten
-00006f70: 7369 6f6e 7320 616e 6420 6973 2073 6b69  sions and is ski
-00006f80: 7070 6564 3a20 7b53 434f 5245 5f45 5854  pped: {SCORE_EXT
-00006f90: 454e 5349 4f4e 537d 2e22 290a 2020 2020  ENSIONS}.").    
-00006fa0: 2020 2020 7265 7475 726e 0a20 2020 2069      return.    i
-00006fb0: 6620 6f73 2e70 6174 682e 6973 6469 7228  f os.path.isdir(
-00006fc0: 6e65 7729 3a0a 2020 2020 2020 2020 7461  new):.        ta
-00006fd0: 7267 6574 5f66 6f6c 6465 7220 3d20 6e65  rget_folder = ne
-00006fe0: 770a 2020 2020 2020 2020 7461 7267 6574  w.        target
-00006ff0: 5f66 696c 6520 3d20 6f6c 645f 6669 6c65  _file = old_file
-00007000: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00007010: 2020 2074 6172 6765 745f 666f 6c64 6572     target_folder
-00007020: 2c20 7461 7267 6574 5f66 696c 6520 3d20  , target_file = 
-00007030: 6f73 2e70 6174 682e 7370 6c69 7428 6e65  os.path.split(ne
-00007040: 7729 0a20 2020 2074 6172 6765 745f 666e  w).    target_fn
-00007050: 616d 652c 2074 6172 6765 745f 6578 7420  ame, target_ext 
-00007060: 3d20 6f73 2e70 6174 682e 7370 6c69 7465  = os.path.splite
-00007070: 7874 2874 6172 6765 745f 6669 6c65 290a  xt(target_file).
-00007080: 2020 2020 746d 705f 6e65 6564 6564 203d      tmp_needed =
-00007090: 2074 6172 6765 745f 6578 7420 696e 2028   target_ext in (
-000070a0: 272e 6d73 6378 272c 2027 2e6d 7363 7a27  '.mscx', '.mscz'
-000070b0: 290a 2020 2020 6966 2074 6d70 5f6e 6565  ).    if tmp_nee
-000070c0: 6465 643a 0a20 2020 2020 2020 2074 6d70  ded:.        tmp
-000070d0: 5f64 6972 203d 206f 732e 7061 7468 2e6a  _dir = os.path.j
-000070e0: 6f69 6e28 7461 7267 6574 5f66 6f6c 6465  oin(target_folde
-000070f0: 722c 2027 2e6d 7333 5f74 6d70 5f27 202b  r, '.ms3_tmp_' +
-00007100: 206f 6c64 5f66 696c 6529 0a20 2020 2020   old_file).     
-00007110: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00007120: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
-00007130: 746d 705f 6469 722c 2065 7869 7374 5f6f  tmp_dir, exist_o
-00007140: 6b3d 4661 6c73 6529 0a20 2020 2020 2020  k=False).       
-00007150: 2065 7863 6570 7420 4669 6c65 4578 6973   except FileExis
-00007160: 7473 4572 726f 723a 0a20 2020 2020 2020  tsError:.       
-00007170: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
-00007180: 696e 6728 6622 5468 6520 7465 6d70 6f72  ing(f"The tempor
-00007190: 6172 7920 6469 7265 6374 6f72 7920 7b74  ary directory {t
-000071a0: 6d70 5f64 6972 7d20 6578 6973 7473 2061  mp_dir} exists a
-000071b0: 6c72 6561 6479 2061 6e64 2077 6f75 6c64  lready and would
-000071c0: 2062 6520 6f76 6572 7772 6974 7465 6e2e   be overwritten.
-000071d0: 2044 656c 6574 6520 6974 2066 6972 7374   Delete it first
-000071e0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-000071f0: 7265 7475 726e 0a20 2020 2020 2020 2074  return.        t
-00007200: 6d70 5f6d 7363 7820 3d20 6f73 2e70 6174  mp_mscx = os.pat
-00007210: 682e 6a6f 696e 2874 6d70 5f64 6972 2c20  h.join(tmp_dir, 
-00007220: 7461 7267 6574 5f66 6e61 6d65 202b 2027  target_fname + '
-00007230: 2e6d 7363 7827 290a 2020 2020 2020 2020  .mscx').        
-00007240: 6e65 7720 3d20 746d 705f 6d73 6378 0a20  new = tmp_mscx. 
-00007250: 2020 2070 726f 6365 7373 203d 205b 4d53     process = [MS
-00007260: 2c20 222d 666f 222c 206e 6577 2c20 6f6c  , "-fo", new, ol
-00007270: 645d 0a20 2020 2072 6573 756c 7420 3d20  d].    result = 
-00007280: 7375 6270 726f 6365 7373 2e72 756e 2870  subprocess.run(p
-00007290: 726f 6365 7373 2c20 6361 7074 7572 655f  rocess, capture_
-000072a0: 6f75 7470 7574 3d54 7275 652c 2074 6578  output=True, tex
-000072b0: 743d 5472 7565 290a 2020 2020 6966 2072  t=True).    if r
-000072c0: 6573 756c 742e 7265 7475 726e 636f 6465  esult.returncode
-000072d0: 203d 3d20 303a 0a20 2020 2020 2020 2069   == 0:.        i
-000072e0: 6620 746d 705f 6e65 6564 6564 3a0a 2020  f tmp_needed:.  
-000072f0: 2020 2020 2020 2020 2020 7461 7267 6574            target
-00007300: 5f70 6174 685f 7769 7468 6f75 745f 6578  _path_without_ex
-00007310: 7465 6e73 696f 6e20 3d20 6f73 2e70 6174  tension = os.pat
-00007320: 682e 6a6f 696e 2874 6172 6765 745f 666f  h.join(target_fo
-00007330: 6c64 6572 2c20 7461 7267 6574 5f66 6e61  lder, target_fna
-00007340: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00007350: 6966 206e 6f74 206f 732e 7061 7468 2e69  if not os.path.i
-00007360: 7364 6972 2874 6d70 5f64 6972 293a 0a20  sdir(tmp_dir):. 
-00007370: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00007380: 6f67 6765 722e 7761 726e 696e 6728 6622  ogger.warning(f"
-00007390: 5465 6d70 6f72 6172 7920 6469 7265 6374  Temporary direct
-000073a0: 6f72 7920 277b 746d 705f 6469 727d 2720  ory '{tmp_dir}' 
-000073b0: 6469 6420 6e6f 7420 6578 6973 7420 6166  did not exist af
-000073c0: 7465 7220 636f 6e76 6572 7369 6f6e 2e22  ter conversion."
-000073d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000073e0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-000073f0: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-00007400: 6174 682e 6973 6669 6c65 2874 6d70 5f6d  ath.isfile(tmp_m
-00007410: 7363 7829 3a0a 2020 2020 2020 2020 2020  scx):.          
-00007420: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
-00007430: 6e69 6e67 2866 2243 6f6e 7665 7273 696f  ning(f"Conversio
-00007440: 6e20 6f66 2027 7b6f 6c64 7d27 2064 6964  n of '{old}' did
-00007450: 206e 6f74 2079 6965 6c64 2061 2063 6f6d   not yield a com
-00007460: 706c 6574 6520 756e 636f 6d70 7265 7373  plete uncompress
-00007470: 6564 204d 7573 6553 636f 7265 2066 6f6c  ed MuseScore fol
-00007480: 6465 722c 2061 6e20 2e6d 7363 7820 6669  der, an .mscx fi
-00007490: 6c65 2077 6173 206d 6973 7369 6e67 2e22  le was missing."
-000074a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000074b0: 2020 7368 7574 696c 2e72 6d74 7265 6528    shutil.rmtree(
-000074c0: 746d 705f 6469 7229 0a20 2020 2020 2020  tmp_dir).       
-000074d0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-000074e0: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-000074f0: 6172 6765 745f 6578 7420 3d3d 2027 2e6d  arget_ext == '.m
-00007500: 7363 7a27 3a0a 2020 2020 2020 2020 2020  scz':.          
-00007510: 2020 2020 2020 7a69 705f 6669 6c65 5f70        zip_file_p
-00007520: 6174 6820 3d20 7368 7574 696c 2e6d 616b  ath = shutil.mak
-00007530: 655f 6172 6368 6976 6528 7461 7267 6574  e_archive(target
-00007540: 5f70 6174 685f 7769 7468 6f75 745f 6578  _path_without_ex
-00007550: 7465 6e73 696f 6e2c 2027 7a69 7027 2c20  tension, 'zip', 
-00007560: 746d 705f 6469 7229 0a20 2020 2020 2020  tmp_dir).       
-00007570: 2020 2020 2020 2020 206e 6577 203d 2074           new = t
-00007580: 6172 6765 745f 7061 7468 5f77 6974 686f  arget_path_witho
-00007590: 7574 5f65 7874 656e 7369 6f6e 202b 2027  ut_extension + '
-000075a0: 2e6d 7363 7a27 0a20 2020 2020 2020 2020  .mscz'.         
-000075b0: 2020 2020 2020 2073 6875 7469 6c2e 6d6f         shutil.mo
-000075c0: 7665 287a 6970 5f66 696c 655f 7061 7468  ve(zip_file_path
-000075d0: 2c20 6e65 7729 0a20 2020 2020 2020 2020  , new).         
-000075e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000075f0: 2020 2020 2020 2020 206e 6577 203d 2074           new = t
-00007600: 6172 6765 745f 7061 7468 5f77 6974 686f  arget_path_witho
-00007610: 7574 5f65 7874 656e 7369 6f6e 202b 2027  ut_extension + '
-00007620: 2e6d 7363 7827 0a20 2020 2020 2020 2020  .mscx'.         
-00007630: 2020 2020 2020 2073 6875 7469 6c2e 6d6f         shutil.mo
-00007640: 7665 2874 6d70 5f6d 7363 782c 206e 6577  ve(tmp_mscx, new
-00007650: 290a 2020 2020 2020 2020 2020 2020 7368  ).            sh
-00007660: 7574 696c 2e72 6d74 7265 6528 746d 705f  util.rmtree(tmp_
-00007670: 6469 7229 0a20 2020 2020 2020 206c 6f67  dir).        log
-00007680: 6765 722e 696e 666f 2866 2253 7563 6365  ger.info(f"Succe
-00007690: 7373 6675 6c6c 7920 636f 6e76 6572 7465  ssfully converte
-000076a0: 6420 7b6f 6c64 7d20 3d3e 207b 6e65 777d  d {old} => {new}
-000076b0: 2229 0a20 2020 2065 6c73 653a 0a20 2020  ").    else:.   
-000076c0: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
-000076d0: 7228 6622 436f 6e76 6572 7369 6f6e 2074  r(f"Conversion t
-000076e0: 6f20 4d75 7365 5363 6f72 6520 3420 6661  o MuseScore 4 fa
-000076f0: 696c 6564 3a5c 6e7b 7265 7375 6c74 2e73  iled:\n{result.s
-00007700: 7464 6572 727d 2229 0a20 2020 2020 2020  tderr}").       
-00007710: 2069 6620 746d 705f 6e65 6564 6564 2061   if tmp_needed a
-00007720: 6e64 206f 732e 7061 7468 2e69 7364 6972  nd os.path.isdir
-00007730: 2874 6d70 5f64 6972 293a 0a20 2020 2020  (tmp_dir):.     
-00007740: 2020 2020 2020 2073 6875 7469 6c2e 726d         shutil.rm
-00007750: 7472 6565 2874 6d70 5f64 6972 290a 0a0a  tree(tmp_dir)...
-00007760: 0a0a 0a0a 0a64 6566 205f 636f 6e76 6572  .....def _conver
-00007770: 745f 6b77 6172 6773 286b 7761 7267 7329  t_kwargs(kwargs)
-00007780: 3a0a 2020 2020 2222 2241 7578 696c 6961  :.    """Auxilia
-00007790: 7279 2066 756e 6374 696f 6e20 616c 6c6f  ry function allo
-000077a0: 7769 6e67 2074 6f20 7573 6520 506f 6f6c  wing to use Pool
-000077b0: 2e73 7461 726d 6170 2829 2077 6974 6820  .starmap() with 
-000077c0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-000077d0: 7320 286e 6565 6465 6420 696e 206f 7264  s (needed in ord
-000077e0: 6572 2074 6f0a 2020 2020 7061 7373 2074  er to.    pass t
-000077f0: 6865 206c 6f67 6765 7220 6172 6775 6d65  he logger argume
-00007800: 6e74 2077 6869 6368 2069 7320 6e6f 7420  nt which is not 
-00007810: 7061 7274 206f 6620 7468 6520 7369 676e  part of the sign
-00007820: 6174 7572 6520 6f66 2063 6f6e 7665 7274  ature of convert
-00007830: 2829 2029 2e22 2222 0a20 2020 2072 6574  () ).""".    ret
-00007840: 7572 6e20 636f 6e76 6572 7428 2a2a 6b77  urn convert(**kw
-00007850: 6172 6773 290a 0a40 6675 6e63 7469 6f6e  args)..@function
-00007860: 5f6c 6f67 6765 720a 6465 6620 636f 6e76  _logger.def conv
-00007870: 6572 745f 666f 6c64 6572 2864 6972 6563  ert_folder(direc
-00007880: 746f 7279 3d4e 6f6e 652c 2066 696c 655f  tory=None, file_
-00007890: 7061 7468 733d 4e6f 6e65 2c20 7461 7267  paths=None, targ
-000078a0: 6574 5f64 6972 3d4e 6f6e 652c 2065 7874  et_dir=None, ext
-000078b0: 656e 7369 6f6e 733d 5b5d 2c20 7461 7267  ensions=[], targ
-000078c0: 6574 5f65 7874 656e 7369 6f6e 3d27 6d73  et_extension='ms
-000078d0: 6378 272c 2072 6567 6578 3d27 2e2a 272c  cx', regex='.*',
-000078e0: 2073 7566 6669 783d 4e6f 6e65 2c20 7265   suffix=None, re
-000078f0: 6375 7273 6976 653d 5472 7565 2c0a 2020  cursive=True,.  
-00007900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007910: 206d 733d 276d 7363 6f72 6527 2c20 6f76   ms='mscore', ov
-00007920: 6572 7772 6974 653d 4661 6c73 652c 2070  erwrite=False, p
-00007930: 6172 616c 6c65 6c3d 4661 6c73 6529 3a0a  arallel=False):.
-00007940: 2020 2020 2222 2220 436f 6e76 6572 7420      """ Convert 
-00007950: 616c 6c20 6669 6c65 7320 696e 2060 6469  all files in `di
-00007960: 7260 2074 6861 7420 6861 7665 206f 6e65  r` that have one
-00007970: 206f 6620 7468 6520 6065 7874 656e 7369   of the `extensi
-00007980: 6f6e 7360 2074 6f20 2e6d 7363 7820 666f  ons` to .mscx fo
-00007990: 726d 6174 2075 7369 6e67 2074 6865 2065  rmat using the e
-000079a0: 7865 6375 7461 626c 6520 604d 5360 2e0a  xecutable `MS`..
-000079b0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-000079c0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000079d0: 2020 2064 6972 6563 746f 7279 203a 203a     directory : :
-000079e0: 6f62 6a3a 6073 7472 600a 2020 2020 2020  obj:`str`.      
-000079f0: 2020 4469 7265 6374 6f72 7920 696e 2077    Directory in w
-00007a00: 6869 6368 2074 6f20 6c6f 6f6b 2066 6f72  hich to look for
-00007a10: 2066 696c 6573 2074 6f20 636f 6e76 6572   files to conver
-00007a20: 742e 0a20 2020 2066 696c 655f 7061 7468  t..    file_path
-00007a30: 7320 3a20 3a6f 626a 3a60 6c69 7374 6020  s : :obj:`list` 
-00007a40: 6f66 2060 6469 7260 0a20 2020 2020 2020  of `dir`.       
-00007a50: 204c 6973 7420 6f66 2066 696c 6520 7061   List of file pa
-00007a60: 7468 7320 746f 2063 6f6e 7665 7274 2e20  ths to convert. 
-00007a70: 5468 6573 6520 6172 6520 6e6f 7420 6669  These are not fi
-00007a80: 6c74 6572 6564 2062 7920 616e 7920 6d65  ltered by any me
-00007a90: 616e 732e 0a20 2020 2074 6172 6765 745f  ans..    target_
-00007aa0: 6469 7220 3a20 3a6f 626a 3a60 7374 7260  dir : :obj:`str`
-00007ab0: 0a20 2020 2020 2020 2044 6972 6563 746f  .        Directo
-00007ac0: 7279 2077 6865 7265 2074 6f20 7374 6f72  ry where to stor
-00007ad0: 6520 636f 6e76 6572 7465 6420 6669 6c65  e converted file
-00007ae0: 732e 2044 6566 6175 6c74 7320 746f 2060  s. Defaults to `
-00007af0: 6064 6972 6563 746f 7279 6060 0a20 2020  `directory``.   
-00007b00: 2065 7874 656e 7369 6f6e 7320 3a20 6c69   extensions : li
-00007b10: 7374 2c20 6f70 7469 6f6e 616c 0a20 2020  st, optional.   
-00007b20: 2020 2020 2049 6620 796f 7520 7761 6e74       If you want
-00007b30: 2074 6f20 636f 6e76 6572 7420 6f6e 6c79   to convert only
-00007b40: 2063 6572 7461 696e 2066 6f72 6d61 7473   certain formats
-00007b50: 2c20 6769 7665 2074 686f 7365 2c20 652e  , give those, e.
-00007b60: 672e 205b 276d 7363 7a27 2c20 2778 6d6c  g. ['mscz', 'xml
-00007b70: 275d 0a20 2020 2072 6563 7572 7369 7665  '].    recursive
-00007b80: 203a 2062 6f6f 6c2c 206f 7074 696f 6e61   : bool, optiona
-00007b90: 6c0a 2020 2020 2020 2020 5375 6264 6972  l.        Subdir
-00007ba0: 6563 746f 7269 6573 2061 7320 7765 6c6c  ectories as well
-00007bb0: 2e0a 2020 2020 4d53 203a 2073 7472 2c20  ..    MS : str, 
-00007bc0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00007bd0: 2047 6976 6520 7468 6520 7061 7468 2074   Give the path t
-00007be0: 6f20 7468 6520 4d75 7365 5363 6f72 6520  o the MuseScore 
-00007bf0: 6578 6563 7574 6162 6c65 206f 6e20 796f  executable on yo
-00007c00: 7572 2073 7973 7465 6d2e 204e 6565 6420  ur system. Need 
-00007c10: 6f6e 6c79 2069 660a 2020 2020 2020 2020  only if.        
-00007c20: 7468 6520 636f 6d6d 616e 6420 276d 7363  the command 'msc
-00007c30: 6f72 6527 2064 6f65 7320 6e6f 7420 6578  ore' does not ex
-00007c40: 6563 7574 6520 4d75 7365 5363 6f72 6520  ecute MuseScore 
-00007c50: 6f6e 2079 6f75 7220 7379 7374 656d 2e0a  on your system..
-00007c60: 2020 2020 2222 220a 2020 2020 4d53 203d      """.    MS =
-00007c70: 2067 6574 5f6d 7573 6573 636f 7265 286d   get_musescore(m
-00007c80: 732c 206c 6f67 6765 723d 6c6f 6767 6572  s, logger=logger
-00007c90: 290a 2020 2020 6173 7365 7274 204d 5320  ).    assert MS 
-00007ca0: 6973 206e 6f74 204e 6f6e 652c 2066 224d  is not None, f"M
-00007cb0: 7573 6553 636f 7265 206e 6f74 2066 6f75  useScore not fou
-00007cc0: 6e64 3a20 7b6d 737d 220a 2020 2020 6173  nd: {ms}".    as
-00007cd0: 7365 7274 2061 6e79 2861 7267 2069 7320  sert any(arg is 
-00007ce0: 6e6f 7420 4e6f 6e65 2066 6f72 2061 7267  not None for arg
-00007cf0: 2069 6e20 2864 6972 6563 746f 7279 2c20   in (directory, 
-00007d00: 6669 6c65 5f70 6174 6873 2929 2c20 2250  file_paths)), "P
-00007d10: 6173 7320 6174 206c 6561 7374 2061 2064  ass at least a d
-00007d20: 6972 6563 746f 7279 206f 7220 6f6e 6520  irectory or one 
-00007d30: 7061 7468 2e22 0a20 2020 2069 6620 6973  path.".    if is
-00007d40: 696e 7374 616e 6365 2866 696c 655f 7061  instance(file_pa
-00007d50: 7468 732c 2073 7472 293a 0a20 2020 2020  ths, str):.     
-00007d60: 2020 2066 696c 655f 7061 7468 7320 3d20     file_paths = 
-00007d70: 5b66 696c 655f 7061 7468 735d 0a20 2020  [file_paths].   
-00007d80: 2069 6620 7461 7267 6574 5f65 7874 656e   if target_exten
-00007d90: 7369 6f6e 5b30 5d20 3d3d 2027 2e27 3a0a  sion[0] == '.':.
-00007da0: 2020 2020 2020 2020 7461 7267 6574 5f65          target_e
-00007db0: 7874 656e 7369 6f6e 203d 2074 6172 6765  xtension = targe
-00007dc0: 745f 6578 7465 6e73 696f 6e5b 313a 5d0a  t_extension[1:].
-00007dd0: 2020 2020 636f 6e76 6572 7369 6f6e 5f70      conversion_p
-00007de0: 6172 616d 7320 3d20 5b5d 0a20 2020 2023  arams = [].    #
-00007df0: 6c6f 6767 6572 2e69 6e66 6f28 6622 5472  logger.info(f"Tr
-00007e00: 6176 6572 7369 6e67 207b 6469 727d 207b  aversing {dir} {
-00007e10: 2727 2069 6620 7265 6375 7273 6976 6520  '' if recursive 
-00007e20: 656c 7365 2027 6e6f 6e2d 277d 7265 6375  else 'non-'}recu
-00007e30: 7273 6976 656c 792e 2e2e 2229 0a20 2020  rsively...").   
-00007e40: 2069 6620 6c65 6e28 6578 7465 6e73 696f   if len(extensio
-00007e50: 6e73 2920 3e20 303a 0a20 2020 2020 2020  ns) > 0:.       
-00007e60: 2065 7863 6c75 6465 5f72 6520 3d20 6622   exclude_re = f"
-00007e70: 5e28 3f3a 283f 2128 7b27 7c27 2e6a 6f69  ^(?:(?!({'|'.joi
-00007e80: 6e28 6578 7465 6e73 696f 6e73 297d 2929  n(extensions)}))
-00007e90: 2e29 2a24 220a 2020 2020 656c 7365 3a0a  .)*$".    else:.
-00007ea0: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
-00007eb0: 7265 203d 2027 270a 2020 2020 6966 2074  re = ''.    if t
-00007ec0: 6172 6765 745f 6469 7220 6973 204e 6f6e  arget_dir is Non
-00007ed0: 653a 0a20 2020 2020 2020 2074 6172 6765  e:.        targe
-00007ee0: 745f 6469 7220 3d20 6469 7265 6374 6f72  t_dir = director
-00007ef0: 790a 2020 2020 6e65 775f 6469 7273 203d  y.    new_dirs =
-00007f00: 207b 7d0a 2020 2020 7375 6264 6972 5f66   {}.    subdir_f
-00007f10: 696c 655f 7475 706c 6573 203d 2069 7465  ile_tuples = ite
-00007f20: 7228 5b5d 290a 2020 2020 6966 2064 6972  r([]).    if dir
-00007f30: 6563 746f 7279 2069 7320 6e6f 7420 4e6f  ectory is not No
-00007f40: 6e65 3a0a 2020 2020 2020 2020 7375 6264  ne:.        subd
-00007f50: 6972 5f66 696c 655f 7475 706c 6573 203d  ir_file_tuples =
-00007f60: 2063 6861 696e 2873 7562 6469 725f 6669   chain(subdir_fi
-00007f70: 6c65 5f74 7570 6c65 732c 0a20 2020 2020  le_tuples,.     
-00007f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f90: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-00007fa0: 616e 5f64 6972 6563 746f 7279 2864 6972  an_directory(dir
-00007fb0: 6563 746f 7279 2c20 6669 6c65 5f72 653d  ectory, file_re=
-00007fc0: 7265 6765 782c 2065 7863 6c75 6465 5f72  regex, exclude_r
-00007fd0: 653d 6578 636c 7564 655f 7265 2c20 7265  e=exclude_re, re
-00007fe0: 6375 7273 6976 653d 7265 6375 7273 6976  cursive=recursiv
-00007ff0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00008000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001c60: 2020 2020 2020 2024 0a20 2020 2020 2020         $.       
+00001c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001c80: 2020 2020 2020 2020 2022 2222 2c0a 2020           """,.  
+00001c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001ca0: 2020 2020 2020 7265 2e56 4552 424f 5345        re.VERBOSE
+00001cb0: 290a 2222 223a 6f62 6a3a 6073 7472 600a  ).""":obj:`str`.
+00001cc0: 436f 6e73 7461 6e74 2077 6974 6820 6120  Constant with a 
+00001cd0: 7265 6775 6c61 7220 6578 7072 6573 7369  regular expressi
+00001ce0: 6f6e 2074 6861 7420 7265 636f 676e 697a  on that recogniz
+00001cf0: 6573 2063 6f6d 706c 6574 6520 6c61 6265  es complete labe
+00001d00: 6c73 2063 6f6e 666f 726d 696e 6720 746f  ls conforming to
+00001d10: 2074 6865 2044 434d 4c20 6861 726d 6f6e   the DCML harmon
+00001d20: 7920 616e 6e6f 7461 7469 6f6e 2073 7461  y annotation sta
+00001d30: 6e64 6172 6420 0a69 6e63 6c75 6469 6e67  ndard .including
+00001d40: 2074 686f 7365 2063 6f6e 7369 7374 696e   those consistin
+00001d50: 6720 6f66 2074 776f 2061 6c74 6572 6e61  g of two alterna
+00001d60: 7469 7665 732c 2077 6974 686f 7574 2068  tives, without h
+00001d70: 6176 696e 6720 746f 2073 706c 6974 2074  aving to split t
+00001d80: 6865 6d2e 2049 7420 6973 2073 696d 706c  hem. It is simpl
+00001d90: 7920 6120 646f 7562 6c65 6420 7665 7273  y a doubled vers
+00001da0: 696f 6e20 6f66 2044 434d 4c5f 5245 4745  ion of DCML_REGE
+00001db0: 582e 0a22 2222 0a0a 464f 524d 5f44 4554  X.."""..FORM_DET
+00001dc0: 4543 5449 4f4e 5f52 4547 4558 203d 2072  ECTION_REGEX = r
+00001dd0: 225e 5c64 7b31 2c32 7d2e 2a3f 3a22 0a22  "^\d{1,2}.*?:"."
+00001de0: 2222 3a6f 626a 3a60 7374 7260 0a46 6f6c  "":obj:`str`.Fol
+00001df0: 6c6f 7769 6e67 2047 6f74 6861 6d20 2620  lowing Gotham & 
+00001e00: 4972 656c 616e 6420 2840 4953 4d49 5220  Ireland (@ISMIR 
+00001e10: 3230 2028 3230 3139 293a 2022 5461 6b69  20 (2019): "Taki
+00001e20: 6e67 2046 6f72 6d3a 2041 2052 6570 7265  ng Form: A Repre
+00001e30: 7365 6e74 6174 696f 6e20 5374 616e 6461  sentation Standa
+00001e40: 7264 2c20 436f 6e76 6572 7369 6f6e 2043  rd, Conversion C
+00001e50: 6f64 652c 2061 6e64 2045 7861 6d70 6c65  ode, and Example
+00001e60: 2043 6f72 7075 7320 666f 7220 5265 636f   Corpus for Reco
+00001e70: 7264 696e 672c 2056 6973 7561 6c69 7a69  rding, Visualizi
+00001e80: 6e67 2c20 616e 6420 5374 7564 7969 6e67  ng, and Studying
+00001e90: 2041 6e61 6c79 7365 7320 6f66 204d 7573   Analyses of Mus
+00001ea0: 6963 616c 2046 6f72 6d22 292c 0a64 6574  ical Form"),.det
+00001eb0: 6563 7473 2066 6f72 6d20 6c61 6265 6c73  ects form labels
+00001ec0: 2061 7320 7468 6f73 6520 7374 7269 6e67   as those string
+00001ed0: 7320 7468 6174 2073 7461 7274 2077 6974  s that start wit
+00001ee0: 6820 696e 6469 6361 7469 6e67 2061 2068  h indicating a h
+00001ef0: 6965 7261 7263 6869 6361 6c20 6c65 7665  ierarchical leve
+00001f00: 6c20 286f 6e65 206f 7220 7477 6f20 6469  l (one or two di
+00001f10: 6769 7473 2920 666f 6c6c 6f77 6564 2062  gits) followed b
+00001f20: 7920 6120 636f 6c6f 6e2e 0a42 7920 6578  y a colon..By ex
+00001f30: 7465 6e73 696f 6e20 284c 6c6f 7265 6e73  tension (Llorens
+00001f40: 2065 7420 616c 2e2c 2066 6f72 7468 636f   et al., forthco
+00001f50: 6d69 6e67 292c 2061 6c6c 6f77 7320 6f6e  ming), allows on
+00001f60: 6520 6f72 206d 6f72 6520 2769 2720 6368  e or more 'i' ch
+00001f70: 6172 6163 7465 7273 206f 7220 616e 7920  aracters or any 
+00001f80: 6f74 6865 7220 616c 7068 6162 6574 2063  other alphabet c
+00001f90: 6861 7261 6374 6572 2074 6f20 6675 7274  haracter to furt
+00001fa0: 6865 7220 7370 6563 6966 7920 7468 6520  her specify the 
+00001fb0: 6c65 7665 6c2e 0a22 2222 0a46 4f52 4d5f  level..""".FORM_
+00001fc0: 4c45 5645 4c5f 5245 4745 5820 3d20 7222  LEVEL_REGEX = r"
+00001fd0: 5e28 3f50 3c6c 6576 656c 3e5c 647b 312c  ^(?P<level>\d{1,
+00001fe0: 327d 293f 283f 503c 666f 726d 5f74 7265  2})?(?P<form_tre
+00001ff0: 653e 5b61 2d68 5d29 3f28 3f50 3c72 6561  e>[a-h])?(?P<rea
+00002000: 6469 6e67 3e5b 6976 785d 2b29 3f3a 3f24  ding>[ivx]+)?:?$
+00002010: 2220 2320 283f 503c 746f 6b65 6e3e 283f  " # (?P<token>(?
+00002020: 3a5c 447c 5c64 2b28 3f21 283f 3a24 7c69  :\D|\d+(?!(?:$|i
+00002030: 2b7c 5c77 293f 5b5c 263d 3a5d 2929 2b29  +|\w)?[\&=:]))+)
+00002040: 220a 464f 524d 5f4c 4556 454c 5f46 4f52  ".FORM_LEVEL_FOR
+00002050: 4d41 5420 3d20 7222 5c64 7b31 2c32 7d5b  MAT = r"\d{1,2}[
+00002060: 612d 685d 3f5b 6976 785d 2a28 3f3a 5c26  a-h]?[ivx]*(?:\&
+00002070: 5c64 7b30 2c32 7d5b 612d 685d 3f5b 6976  \d{0,2}[a-h]?[iv
+00002080: 785d 2a29 2a22 0a46 4f52 4d5f 4c45 5645  x]*)*".FORM_LEVE
+00002090: 4c5f 5350 4c49 545f 5245 4745 5820 3d20  L_SPLIT_REGEX = 
+000020a0: 464f 524d 5f4c 4556 454c 5f46 4f52 4d41  FORM_LEVEL_FORMA
+000020b0: 5420 2b20 273a 270a 464f 524d 5f4c 4556  T + ':'.FORM_LEV
+000020c0: 454c 5f43 4150 5455 5245 5f52 4547 4558  EL_CAPTURE_REGEX
+000020d0: 203d 2066 2228 3f50 3c6c 6576 656c 733e   = f"(?P<levels>
+000020e0: 7b46 4f52 4d5f 4c45 5645 4c5f 464f 524d  {FORM_LEVEL_FORM
+000020f0: 4154 7d29 3a22 0a46 4f52 4d5f 544f 4b45  AT}):".FORM_TOKE
+00002100: 4e5f 4142 4252 4556 4941 5449 4f4e 5320  N_ABBREVIATIONS 
+00002110: 3d20 7b0a 2027 7327 3a20 2773 6174 7a27  = {. 's': 'satz'
+00002120: 2c0a 2027 7827 3a20 2775 6e69 7427 2c0a  ,. 'x': 'unit',.
+00002130: 2027 6168 273a 2027 616e 6861 6e67 272c   'ah': 'anhang',
+00002140: 0a20 2762 6927 3a20 2762 6173 6963 2069  . 'bi': 'basic i
+00002150: 6465 6127 2c0a 2027 6272 273a 2027 6272  dea',. 'br': 'br
+00002160: 6964 6765 272c 0a20 2763 6927 3a20 2763  idge',. 'ci': 'c
+00002170: 6f6e 7472 6173 7469 6e67 2069 6465 6127  ontrasting idea'
+00002180: 2c0a 2027 6372 273a 2027 6372 7578 272c  ,. 'cr': 'crux',
+00002190: 0a20 2765 6727 3a20 2765 696e 6761 6e67  . 'eg': 'eingang
+000021a0: 272c 0a20 2768 7027 3a20 2768 6175 7074  ',. 'hp': 'haupt
+000021b0: 7065 7269 6f64 6527 2c0a 2027 6873 273a  periode',. 'hs':
+000021c0: 2027 6861 7570 7473 6174 7a27 2c0a 2027   'hauptsatz',. '
+000021d0: 6970 273a 2027 696e 7465 7270 6f6c 6174  ip': 'interpolat
+000021e0: 696f 6e27 2c0a 2027 6c69 273a 2027 6c65  ion',. 'li': 'le
+000021f0: 6164 2d69 6e27 2c0a 2027 7063 273a 2027  ad-in',. 'pc': '
+00002200: 7072 652d 636f 7265 272c 0a20 2770 6427  pre-core',. 'pd'
+00002210: 3a20 2770 6572 696f 6427 2c0a 2027 7369  : 'period',. 'si
+00002220: 273a 2027 7365 636f 6e64 6172 7920 6964  ': 'secondary id
+00002230: 6561 272c 0a20 2774 6927 3a20 2774 6865  ea',. 'ti': 'the
+00002240: 6d61 7469 6320 696e 7472 6f64 7563 7469  matic introducti
+00002250: 6f6e 272c 0a20 2774 7227 3a20 2774 7261  on',. 'tr': 'tra
+00002260: 6e73 6974 696f 6e27 2c0a 2027 3173 7427  nsition',. '1st'
+00002270: 3a20 2766 6972 7374 2074 6865 6d65 272c  : 'first theme',
+00002280: 0a20 2732 6e64 273a 2027 7365 636f 6e64  . '2nd': 'second
+00002290: 2074 6865 6d65 272c 0a20 2733 7264 273a   theme',. '3rd':
+000022a0: 2027 7468 6972 6420 7468 656d 6527 2c0a   'third theme',.
+000022b0: 2027 616e 7327 3a20 2761 6e73 7765 7227   'ans': 'answer'
+000022c0: 2c0a 2027 616e 7427 3a20 2761 6e74 6563  ,. 'ant': 'antec
+000022d0: 6564 656e 7427 2c0a 2027 6174 6527 3a20  edent',. 'ate': 
+000022e0: 2761 6674 6572 2d74 6865 2d65 6e64 272c  'after-the-end',
+000022f0: 0a20 2762 6567 273a 2027 6265 6769 6e6e  . 'beg': 'beginn
+00002300: 696e 6727 2c0a 2027 6274 6227 3a20 2762  ing',. 'btb': 'b
+00002310: 6566 6f72 652d 7468 652d 6265 6769 6e6e  efore-the-beginn
+00002320: 696e 6727 2c0a 2027 6361 6427 3a20 2763  ing',. 'cad': 'c
+00002330: 6164 656e 7469 616c 2069 6465 6127 2c0a  adential idea',.
+00002340: 2027 6362 6927 3a20 2763 6f6d 706f 756e   'cbi': 'compoun
+00002350: 6420 6261 7369 6320 6964 6561 272c 0a20  d basic idea',. 
+00002360: 2763 6872 273a 2027 6368 6f72 7573 272c  'chr': 'chorus',
+00002370: 0a20 2763 6c73 273a 2027 636c 6f73 696e  . 'cls': 'closin
+00002380: 6720 7468 656d 6527 2c0a 2027 6465 7627  g theme',. 'dev'
+00002390: 3a20 2764 6576 656c 6f70 6d65 6e74 2073  : 'development s
+000023a0: 6563 7469 6f6e 272c 0a20 2765 7069 273a  ection',. 'epi':
+000023b0: 2027 6570 6973 6f64 6527 2c0a 2027 6578   'episode',. 'ex
+000023c0: 7027 3a20 2765 7870 6f73 6974 696f 6e27  p': 'exposition'
+000023d0: 2c0a 2027 6c69 7127 3a20 276c 6971 7569  ,. 'liq': 'liqui
+000023e0: 6461 7469 6f6e 272c 0a20 276d 6964 273a  dation',. 'mid':
+000023f0: 2027 6d69 6464 6c65 272c 0a20 276d 6f64   'middle',. 'mod
+00002400: 273a 2027 6d6f 6465 6c27 2c0a 2027 6d76  ': 'model',. 'mv
+00002410: 7427 3a20 276d 6f76 656d 656e 7427 2c0a  t': 'movement',.
+00002420: 2027 7265 6327 3a20 2772 6563 6170 6974   'rec': 'recapit
+00002430: 756c 6174 696f 6e27 2c0a 2027 7265 7027  ulation',. 'rep'
+00002440: 3a20 2772 6570 6574 6974 696f 6e27 2c0a  : 'repetition',.
+00002450: 2027 7269 7427 3a20 2772 6974 6f72 6e65   'rit': 'ritorne
+00002460: 6c6c 6f27 2c0a 2027 7274 7227 3a20 2772  llo',. 'rtr': 'r
+00002470: 6574 7261 6e73 6974 696f 6e27 2c0a 2027  etransition',. '
+00002480: 7365 7127 3a20 2773 6571 7565 6e63 6527  seq': 'sequence'
+00002490: 2c0a 2027 7375 6227 3a20 2773 7562 6a65  ,. 'sub': 'subje
+000024a0: 6374 272c 0a20 2774 6830 273a 2027 7468  ct',. 'th0': 'th
+000024b0: 656d 6530 272c 0a20 2776 6172 273a 2027  eme0',. 'var': '
+000024c0: 7661 7269 6174 696f 6e27 2c0a 2027 7665  variation',. 've
+000024d0: 7227 3a20 2776 6572 7365 272c 0a20 2763  r': 'verse',. 'c
+000024e0: 647a 6127 3a20 2763 6164 656e 7a61 272c  dza': 'cadenza',
+000024f0: 0a20 2763 6f64 6127 3a20 2763 6f64 6127  . 'coda': 'coda'
+00002500: 2c0a 2027 636f 6e73 273a 2027 636f 6e73  ,. 'cons': 'cons
+00002510: 6571 7565 6e74 272c 0a20 2763 6f6e 7427  equent',. 'cont'
+00002520: 3a20 2763 6f6e 7469 6e75 6174 696f 6e27  : 'continuation'
+00002530: 2c0a 2027 6374 7461 273a 2027 636f 6465  ,. 'ctta': 'code
+00002540: 7474 6127 2c0a 2027 6465 7069 273a 2027  tta',. 'depi': '
+00002550: 6469 7370 6c61 7920 6570 6973 6f64 6527  display episode'
+00002560: 2c0a 2027 6469 7373 273a 2027 6469 7373  ,. 'diss': 'diss
+00002570: 6f6c 7574 696f 6e27 2c0a 2027 6578 7061  olution',. 'expa
+00002580: 273a 2027 6578 7061 6e73 696f 6e27 2c0a  ': 'expansion',.
+00002590: 2027 6672 6167 273a 2027 6672 6167 6d65   'frag': 'fragme
+000025a0: 6e74 6174 696f 6e27 2c0a 2027 7063 6164  ntation',. 'pcad
+000025b0: 273a 2027 706f 7374 6361 6465 6e74 6961  ': 'postcadentia
+000025c0: 6c27 2c0a 2027 7072 6573 273a 2027 7072  l',. 'pres': 'pr
+000025d0: 6573 656e 7461 7469 6f6e 272c 0a20 2773  esentation',. 's
+000025e0: 6368 6c27 3a20 2773 6368 6c75 7373 7361  chl': 'schlusssa
+000025f0: 747a 272c 0a20 2773 656e 7427 3a20 2773  tz',. 'sent': 's
+00002600: 656e 7465 6e63 6527 2c0a 2027 696e 7472  entence',. 'intr
+00002610: 6f27 3a20 2769 6e74 726f 6475 6374 696f  o': 'introductio
+00002620: 6e27 2c0a 2027 7072 6368 7227 3a20 2770  n',. 'prchr': 'p
+00002630: 7265 2d63 686f 7275 7327 2c0a 2027 7074  re-chorus',. 'pt
+00002640: 6368 7227 3a20 2770 6f73 742d 6368 6f72  chr': 'post-chor
+00002650: 7573 270a 7d0a 0a0a 4d53 335f 4854 4d4c  us'.}...MS3_HTML
+00002660: 203d 207b 2723 3030 3535 3030 273a 2027   = {'#005500': '
+00002670: 6d73 335f 6461 726b 6772 6565 6e27 2c0a  ms3_darkgreen',.
+00002680: 2020 2020 2020 2020 2020 2020 2723 6161              '#aa
+00002690: 3030 3030 273a 2027 6d73 335f 6461 726b  0000': 'ms3_dark
+000026a0: 7265 6427 2c0a 2020 2020 2020 2020 2020  red',.          
+000026b0: 2020 2723 6161 3535 3030 273a 2027 6d73    '#aa5500': 'ms
+000026c0: 335f 7369 656e 6e61 272c 0a20 2020 2020  3_sienna',.     
+000026d0: 2020 2020 2020 2027 2330 3061 6130 3027         '#00aa00'
+000026e0: 3a20 276d 7333 5f67 7265 656e 272c 0a20  : 'ms3_green',. 
+000026f0: 2020 2020 2020 2020 2020 2027 2361 6161             '#aaa
+00002700: 6130 3027 3a20 276d 7333 5f64 6172 6b67  a00': 'ms3_darkg
+00002710: 6f6c 6465 6e72 6f64 272c 0a20 2020 2020  oldenrod',.     
+00002720: 2020 2020 2020 2027 2361 6166 6630 3027         '#aaff00'
+00002730: 3a20 276d 7333 5f63 6861 7274 7265 7573  : 'ms3_chartreus
+00002740: 6527 2c0a 2020 2020 2020 2020 2020 2020  e',.            
+00002750: 2723 3030 3030 3766 273a 2027 6d73 335f  '#00007f': 'ms3_
+00002760: 6e61 7679 272c 0a20 2020 2020 2020 2020  navy',.         
+00002770: 2020 2027 2361 6130 3037 6627 3a20 276d     '#aa007f': 'm
+00002780: 7333 5f64 6172 6b6d 6167 656e 7461 272c  s3_darkmagenta',
+00002790: 0a20 2020 2020 2020 2020 2020 2027 2330  .            '#0
+000027a0: 3035 3537 6627 3a20 276d 7333 5f74 6561  0557f': 'ms3_tea
+000027b0: 6c27 2c0a 2020 2020 2020 2020 2020 2020  l',.            
+000027c0: 2723 6161 3535 3766 273a 2027 6d73 335f  '#aa557f': 'ms3_
+000027d0: 696e 6469 616e 7265 6427 2c0a 2020 2020  indianred',.    
+000027e0: 2020 2020 2020 2020 2723 3030 6161 3766          '#00aa7f
+000027f0: 273a 2027 6d73 335f 6461 726b 6379 616e  ': 'ms3_darkcyan
+00002800: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
+00002810: 2361 6161 6137 6627 3a20 276d 7333 5f64  #aaaa7f': 'ms3_d
+00002820: 6172 6b67 7261 7927 2c0a 2020 2020 2020  arkgray',.      
+00002830: 2020 2020 2020 2723 6161 6666 3766 273a        '#aaff7f':
+00002840: 2027 6d73 335f 7061 6c65 6772 6565 6e27   'ms3_palegreen'
+00002850: 2c0a 2020 2020 2020 2020 2020 2020 2723  ,.            '#
+00002860: 6161 3030 6666 273a 2027 6d73 335f 6461  aa00ff': 'ms3_da
+00002870: 726b 7669 6f6c 6574 272c 0a20 2020 2020  rkviolet',.     
+00002880: 2020 2020 2020 2027 2330 3035 3566 6627         '#0055ff'
+00002890: 3a20 276d 7333 5f64 6f64 6765 7262 6c75  : 'ms3_dodgerblu
+000028a0: 6527 2c0a 2020 2020 2020 2020 2020 2020  e',.            
+000028b0: 2723 6161 3535 6666 273a 2027 6d73 335f  '#aa55ff': 'ms3_
+000028c0: 6d65 6469 756d 6f72 6368 6964 272c 0a20  mediumorchid',. 
+000028d0: 2020 2020 2020 2020 2020 2027 2330 3061             '#00a
+000028e0: 6166 6627 3a20 276d 7333 5f64 6565 7073  aff': 'ms3_deeps
+000028f0: 6b79 626c 7565 272c 0a20 2020 2020 2020  kyblue',.       
+00002900: 2020 2020 2027 2361 6161 6166 6627 3a20       '#aaaaff': 
+00002910: 276d 7333 5f6c 6967 6874 7374 6565 6c62  'ms3_lightsteelb
+00002920: 6c75 6527 2c0a 2020 2020 2020 2020 2020  lue',.          
+00002930: 2020 2723 6161 6666 6666 273a 2027 6d73    '#aaffff': 'ms
+00002940: 335f 7061 6c65 7475 7271 756f 6973 6527  3_paleturquoise'
+00002950: 2c0a 2020 2020 2020 2020 2020 2020 2723  ,.            '#
+00002960: 3535 3030 3030 273a 2027 6d73 335f 6d61  550000': 'ms3_ma
+00002970: 726f 6f6e 272c 0a20 2020 2020 2020 2020  roon',.         
+00002980: 2020 2027 2335 3535 3530 3027 3a20 276d     '#555500': 'm
+00002990: 7333 5f64 6172 6b6f 6c69 7665 6772 6565  s3_darkolivegree
+000029a0: 6e27 2c0a 2020 2020 2020 2020 2020 2020  n',.            
+000029b0: 2723 6666 3535 3030 273a 2027 6d73 335f  '#ff5500': 'ms3_
+000029c0: 6f72 616e 6765 7265 6427 2c0a 2020 2020  orangered',.    
+000029d0: 2020 2020 2020 2020 2723 3535 6161 3030          '#55aa00
+000029e0: 273a 2027 6d73 335f 6f6c 6976 6527 2c0a  ': 'ms3_olive',.
+000029f0: 2020 2020 2020 2020 2020 2020 2723 6666              '#ff
+00002a00: 6161 3030 273a 2027 6d73 335f 6f72 616e  aa00': 'ms3_oran
+00002a10: 6765 272c 0a20 2020 2020 2020 2020 2020  ge',.           
+00002a20: 2027 2335 3566 6630 3027 3a20 276d 7333   '#55ff00': 'ms3
+00002a30: 5f6c 6177 6e67 7265 656e 272c 0a20 2020  _lawngreen',.   
+00002a40: 2020 2020 2020 2020 2027 2335 3530 3037           '#55007
+00002a50: 6627 3a20 276d 7333 5f69 6e64 6967 6f27  f': 'ms3_indigo'
+00002a60: 2c0a 2020 2020 2020 2020 2020 2020 2723  ,.            '#
+00002a70: 6666 3030 3766 273a 2027 6d73 335f 6465  ff007f': 'ms3_de
+00002a80: 6570 7069 6e6b 272c 0a20 2020 2020 2020  eppink',.       
+00002a90: 2020 2020 2027 2335 3535 3537 6627 3a20       '#55557f': 
+00002aa0: 276d 7333 5f64 6172 6b73 6c61 7465 626c  'ms3_darkslatebl
+00002ab0: 7565 272c 0a20 2020 2020 2020 2020 2020  ue',.           
+00002ac0: 2027 2366 6635 3537 6627 3a20 276d 7333   '#ff557f': 'ms3
+00002ad0: 5f6c 6967 6874 636f 7261 6c27 2c0a 2020  _lightcoral',.  
+00002ae0: 2020 2020 2020 2020 2020 2723 3535 6161            '#55aa
+00002af0: 3766 273a 2027 6d73 335f 6d65 6469 756d  7f': 'ms3_medium
+00002b00: 7365 6167 7265 656e 272c 0a20 2020 2020  seagreen',.     
+00002b10: 2020 2020 2020 2027 2366 6661 6137 6627         '#ffaa7f'
+00002b20: 3a20 276d 7333 5f6c 6967 6874 7361 6c6d  : 'ms3_lightsalm
+00002b30: 6f6e 272c 0a20 2020 2020 2020 2020 2020  on',.           
+00002b40: 2027 2335 3566 6637 6627 3a20 276d 7333   '#55ff7f': 'ms3
+00002b50: 5f6c 6967 6874 6772 6565 6e27 2c0a 2020  _lightgreen',.  
+00002b60: 2020 2020 2020 2020 2020 2723 6666 6666            '#ffff
+00002b70: 3766 273a 2027 6d73 335f 6b68 616b 6927  7f': 'ms3_khaki'
+00002b80: 2c0a 2020 2020 2020 2020 2020 2020 2723  ,.            '#
+00002b90: 3535 3030 6666 273a 2027 6d73 335f 626c  5500ff': 'ms3_bl
+00002ba0: 7565 272c 0a20 2020 2020 2020 2020 2020  ue',.           
+00002bb0: 2027 2335 3535 3566 6627 3a20 276d 7333   '#5555ff': 'ms3
+00002bc0: 5f72 6f79 616c 626c 7565 272c 0a20 2020  _royalblue',.   
+00002bd0: 2020 2020 2020 2020 2027 2366 6635 3566           '#ff55f
+00002be0: 6627 3a20 276d 7333 5f76 696f 6c65 7427  f': 'ms3_violet'
+00002bf0: 2c0a 2020 2020 2020 2020 2020 2020 2723  ,.            '#
+00002c00: 3535 6161 6666 273a 2027 6d73 335f 636f  55aaff': 'ms3_co
+00002c10: 726e 666c 6f77 6572 626c 7565 272c 0a20  rnflowerblue',. 
+00002c20: 2020 2020 2020 2020 2020 2027 2366 6661             '#ffa
+00002c30: 6166 6627 3a20 276d 7333 5f6c 6967 6874  aff': 'ms3_light
+00002c40: 7069 6e6b 272c 0a20 2020 2020 2020 2020  pink',.         
+00002c50: 2020 2027 2335 3566 6666 6627 3a20 276d     '#55ffff': 'm
+00002c60: 7333 5f61 7175 616d 6172 696e 6527 7d0a  s3_aquamarine'}.
+00002c70: 0a4d 5333 5f52 4742 203d 207b 2830 2c20  .MS3_RGB = {(0, 
+00002c80: 3835 2c20 3029 3a20 276d 7333 5f64 6172  85, 0): 'ms3_dar
+00002c90: 6b67 7265 656e 272c 0a20 2020 2020 2020  kgreen',.       
+00002ca0: 2020 2020 2831 3730 2c20 302c 2030 293a      (170, 0, 0):
+00002cb0: 2027 6d73 335f 6461 726b 7265 6427 2c0a   'ms3_darkred',.
+00002cc0: 2020 2020 2020 2020 2020 2028 3137 302c             (170,
+00002cd0: 2038 352c 2030 293a 2027 6d73 335f 7369   85, 0): 'ms3_si
+00002ce0: 656e 6e61 272c 0a20 2020 2020 2020 2020  enna',.         
+00002cf0: 2020 2830 2c20 3137 302c 2030 293a 2027    (0, 170, 0): '
+00002d00: 6d73 335f 6772 6565 6e27 2c0a 2020 2020  ms3_green',.    
+00002d10: 2020 2020 2020 2028 3137 302c 2031 3730         (170, 170
+00002d20: 2c20 3029 3a20 276d 7333 5f64 6172 6b67  , 0): 'ms3_darkg
+00002d30: 6f6c 6465 6e72 6f64 272c 0a20 2020 2020  oldenrod',.     
+00002d40: 2020 2020 2020 2831 3730 2c20 3235 352c        (170, 255,
+00002d50: 2030 293a 2027 6d73 335f 6368 6172 7472   0): 'ms3_chartr
+00002d60: 6575 7365 272c 0a20 2020 2020 2020 2020  euse',.         
+00002d70: 2020 2830 2c20 302c 2031 3237 293a 2027    (0, 0, 127): '
+00002d80: 6d73 335f 6e61 7679 272c 0a20 2020 2020  ms3_navy',.     
+00002d90: 2020 2020 2020 2831 3730 2c20 302c 2031        (170, 0, 1
+00002da0: 3237 293a 2027 6d73 335f 6461 726b 6d61  27): 'ms3_darkma
+00002db0: 6765 6e74 6127 2c0a 2020 2020 2020 2020  genta',.        
+00002dc0: 2020 2028 302c 2038 352c 2031 3237 293a     (0, 85, 127):
+00002dd0: 2027 6d73 335f 7465 616c 272c 0a20 2020   'ms3_teal',.   
+00002de0: 2020 2020 2020 2020 2831 3730 2c20 3835          (170, 85
+00002df0: 2c20 3132 3729 3a20 276d 7333 5f69 6e64  , 127): 'ms3_ind
+00002e00: 6961 6e72 6564 272c 0a20 2020 2020 2020  ianred',.       
+00002e10: 2020 2020 2830 2c20 3137 302c 2031 3237      (0, 170, 127
+00002e20: 293a 2027 6d73 335f 6461 726b 6379 616e  ): 'ms3_darkcyan
+00002e30: 272c 0a20 2020 2020 2020 2020 2020 2831  ',.           (1
+00002e40: 3730 2c20 3137 302c 2031 3237 293a 2027  70, 170, 127): '
+00002e50: 6d73 335f 6461 726b 6772 6179 272c 0a20  ms3_darkgray',. 
+00002e60: 2020 2020 2020 2020 2020 2831 3730 2c20            (170, 
+00002e70: 3235 352c 2031 3237 293a 2027 6d73 335f  255, 127): 'ms3_
+00002e80: 7061 6c65 6772 6565 6e27 2c0a 2020 2020  palegreen',.    
+00002e90: 2020 2020 2020 2028 3137 302c 2030 2c20         (170, 0, 
+00002ea0: 3235 3529 3a20 276d 7333 5f64 6172 6b76  255): 'ms3_darkv
+00002eb0: 696f 6c65 7427 2c0a 2020 2020 2020 2020  iolet',.        
+00002ec0: 2020 2028 302c 2038 352c 2032 3535 293a     (0, 85, 255):
+00002ed0: 2027 6d73 335f 646f 6467 6572 626c 7565   'ms3_dodgerblue
+00002ee0: 272c 0a20 2020 2020 2020 2020 2020 2831  ',.           (1
+00002ef0: 3730 2c20 3835 2c20 3235 3529 3a20 276d  70, 85, 255): 'm
+00002f00: 7333 5f6d 6564 6975 6d6f 7263 6869 6427  s3_mediumorchid'
+00002f10: 2c0a 2020 2020 2020 2020 2020 2028 302c  ,.           (0,
+00002f20: 2031 3730 2c20 3235 3529 3a20 276d 7333   170, 255): 'ms3
+00002f30: 5f64 6565 7073 6b79 626c 7565 272c 0a20  _deepskyblue',. 
+00002f40: 2020 2020 2020 2020 2020 2831 3730 2c20            (170, 
+00002f50: 3137 302c 2032 3535 293a 2027 6d73 335f  170, 255): 'ms3_
+00002f60: 6c69 6768 7473 7465 656c 626c 7565 272c  lightsteelblue',
+00002f70: 0a20 2020 2020 2020 2020 2020 2831 3730  .           (170
+00002f80: 2c20 3235 352c 2032 3535 293a 2027 6d73  , 255, 255): 'ms
+00002f90: 335f 7061 6c65 7475 7271 756f 6973 6527  3_paleturquoise'
+00002fa0: 2c0a 2020 2020 2020 2020 2020 2028 3835  ,.           (85
+00002fb0: 2c20 302c 2030 293a 2027 6d73 335f 6d61  , 0, 0): 'ms3_ma
+00002fc0: 726f 6f6e 272c 0a20 2020 2020 2020 2020  roon',.         
+00002fd0: 2020 2838 352c 2038 352c 2030 293a 2027    (85, 85, 0): '
+00002fe0: 6d73 335f 6461 726b 6f6c 6976 6567 7265  ms3_darkolivegre
+00002ff0: 656e 272c 0a20 2020 2020 2020 2020 2020  en',.           
+00003000: 2832 3535 2c20 3835 2c20 3029 3a20 276d  (255, 85, 0): 'm
+00003010: 7333 5f6f 7261 6e67 6572 6564 272c 0a20  s3_orangered',. 
+00003020: 2020 2020 2020 2020 2020 2838 352c 2031            (85, 1
+00003030: 3730 2c20 3029 3a20 276d 7333 5f6f 6c69  70, 0): 'ms3_oli
+00003040: 7665 272c 0a20 2020 2020 2020 2020 2020  ve',.           
+00003050: 2832 3535 2c20 3137 302c 2030 293a 2027  (255, 170, 0): '
+00003060: 6d73 335f 6f72 616e 6765 272c 0a20 2020  ms3_orange',.   
+00003070: 2020 2020 2020 2020 2838 352c 2032 3535          (85, 255
+00003080: 2c20 3029 3a20 276d 7333 5f6c 6177 6e67  , 0): 'ms3_lawng
+00003090: 7265 656e 272c 0a20 2020 2020 2020 2020  reen',.         
+000030a0: 2020 2838 352c 2030 2c20 3132 3729 3a20    (85, 0, 127): 
+000030b0: 276d 7333 5f69 6e64 6967 6f27 2c0a 2020  'ms3_indigo',.  
+000030c0: 2020 2020 2020 2020 2028 3235 352c 2030           (255, 0
+000030d0: 2c20 3132 3729 3a20 276d 7333 5f64 6565  , 127): 'ms3_dee
+000030e0: 7070 696e 6b27 2c0a 2020 2020 2020 2020  ppink',.        
+000030f0: 2020 2028 3835 2c20 3835 2c20 3132 3729     (85, 85, 127)
+00003100: 3a20 276d 7333 5f64 6172 6b73 6c61 7465  : 'ms3_darkslate
+00003110: 626c 7565 272c 0a20 2020 2020 2020 2020  blue',.         
+00003120: 2020 2832 3535 2c20 3835 2c20 3132 3729    (255, 85, 127)
+00003130: 3a20 276d 7333 5f6c 6967 6874 636f 7261  : 'ms3_lightcora
+00003140: 6c27 2c0a 2020 2020 2020 2020 2020 2028  l',.           (
+00003150: 3835 2c20 3137 302c 2031 3237 293a 2027  85, 170, 127): '
+00003160: 6d73 335f 6d65 6469 756d 7365 6167 7265  ms3_mediumseagre
+00003170: 656e 272c 0a20 2020 2020 2020 2020 2020  en',.           
+00003180: 2832 3535 2c20 3137 302c 2031 3237 293a  (255, 170, 127):
+00003190: 2027 6d73 335f 6c69 6768 7473 616c 6d6f   'ms3_lightsalmo
+000031a0: 6e27 2c0a 2020 2020 2020 2020 2020 2028  n',.           (
+000031b0: 3835 2c20 3235 352c 2031 3237 293a 2027  85, 255, 127): '
+000031c0: 6d73 335f 6c69 6768 7467 7265 656e 272c  ms3_lightgreen',
+000031d0: 0a20 2020 2020 2020 2020 2020 2832 3535  .           (255
+000031e0: 2c20 3235 352c 2031 3237 293a 2027 6d73  , 255, 127): 'ms
+000031f0: 335f 6b68 616b 6927 2c0a 2020 2020 2020  3_khaki',.      
+00003200: 2020 2020 2028 3835 2c20 302c 2032 3535       (85, 0, 255
+00003210: 293a 2027 6d73 335f 626c 7565 272c 0a20  ): 'ms3_blue',. 
+00003220: 2020 2020 2020 2020 2020 2838 352c 2038            (85, 8
+00003230: 352c 2032 3535 293a 2027 6d73 335f 726f  5, 255): 'ms3_ro
+00003240: 7961 6c62 6c75 6527 2c0a 2020 2020 2020  yalblue',.      
+00003250: 2020 2020 2028 3235 352c 2038 352c 2032       (255, 85, 2
+00003260: 3535 293a 2027 6d73 335f 7669 6f6c 6574  55): 'ms3_violet
+00003270: 272c 0a20 2020 2020 2020 2020 2020 2838  ',.           (8
+00003280: 352c 2031 3730 2c20 3235 3529 3a20 276d  5, 170, 255): 'm
+00003290: 7333 5f63 6f72 6e66 6c6f 7765 7262 6c75  s3_cornflowerblu
+000032a0: 6527 2c0a 2020 2020 2020 2020 2020 2028  e',.           (
+000032b0: 3235 352c 2031 3730 2c20 3235 3529 3a20  255, 170, 255): 
+000032c0: 276d 7333 5f6c 6967 6874 7069 6e6b 272c  'ms3_lightpink',
+000032d0: 0a20 2020 2020 2020 2020 2020 2838 352c  .           (85,
+000032e0: 2032 3535 2c20 3235 3529 3a20 276d 7333   255, 255): 'ms3
+000032f0: 5f61 7175 616d 6172 696e 6527 7d0a 0a4d  _aquamarine'}..M
+00003300: 5333 5f43 4f4c 4f52 5320 3d20 6c69 7374  S3_COLORS = list
+00003310: 284d 5333 5f48 544d 4c2e 7661 6c75 6573  (MS3_HTML.values
+00003320: 2829 290a 4353 5332 4d53 3320 3d20 7b63  ()).CSS2MS3 = {c
+00003330: 5b34 3a5d 3a20 6320 666f 7220 6320 696e  [4:]: c for c in
+00003340: 204d 5333 5f43 4f4c 4f52 537d 0a43 5353   MS3_COLORS}.CSS
+00003350: 5f43 4f4c 4f52 5320 3d20 6c69 7374 2877  _COLORS = list(w
+00003360: 6562 636f 6c6f 7273 2e43 5353 335f 4e41  ebcolors.CSS3_NA
+00003370: 4d45 535f 544f 5f48 4558 2e6b 6579 7328  MES_TO_HEX.keys(
+00003380: 2929 0a43 4f4c 4f52 5320 3d20 7375 6d28  )).COLORS = sum(
+00003390: 5b5b 632c 2043 5353 324d 5333 5b63 5d5d  [[c, CSS2MS3[c]]
+000033a0: 2069 6620 6320 696e 2043 5353 324d 5333   if c in CSS2MS3
+000033b0: 2065 6c73 6520 5b63 5d20 666f 7220 6320   else [c] for c 
+000033c0: 696e 2043 5353 5f43 4f4c 4f52 535d 2c20  in CSS_COLORS], 
+000033d0: 5b5d 290a 7267 6261 203d 206e 616d 6564  []).rgba = named
+000033e0: 7475 706c 6528 2752 4742 4127 2c20 5b27  tuple('RGBA', ['
+000033f0: 7227 2c20 2767 272c 2027 6227 2c20 2761  r', 'g', 'b', 'a
+00003400: 275d 290a 0a0a 636c 6173 7320 6d61 705f  '])...class map_
+00003410: 6469 6374 2864 6963 7429 3a0a 2020 2020  dict(dict):.    
+00003420: 2222 2253 7563 6820 6120 6469 6374 696f  """Such a dictio
+00003430: 6e61 7279 2063 616e 2062 6520 6d61 7070  nary can be mapp
+00003440: 6564 2074 6f20 6120 5365 7269 6573 2074  ed to a Series t
+00003450: 6f20 7265 706c 6163 6520 6974 7320 7661  o replace its va
+00003460: 6c75 6573 2062 7574 206c 6561 7669 6e67  lues but leaving
+00003470: 2074 6865 2076 616c 7565 7320 6162 7365   the values abse
+00003480: 6e74 2066 726f 6d20 7468 6520 6469 6374  nt from the dict
+00003490: 206b 6579 7320 696e 7461 6374 2e22 2222   keys intact."""
+000034a0: 0a20 2020 2064 6566 205f 5f6d 6973 7369  .    def __missi
+000034b0: 6e67 5f5f 2873 656c 662c 206b 6579 293a  ng__(self, key):
+000034c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000034d0: 6b65 790a 0a0a 6465 6620 6173 7365 7274  key...def assert
+000034e0: 5f61 6c6c 5f6c 696e 6573 5f65 7175 616c  _all_lines_equal
+000034f0: 2862 6566 6f72 652c 2061 6674 6572 2c20  (before, after, 
+00003500: 6f72 6967 696e 616c 2c20 746d 705f 6669  original, tmp_fi
+00003510: 6c65 293a 0a20 2020 2022 2222 2043 6f6d  le):.    """ Com
+00003520: 7061 7265 7320 7477 6f20 6d75 6c74 696c  pares two multil
+00003530: 696e 6520 7374 7269 6e67 7320 746f 2074  ine strings to t
+00003540: 6573 7420 6571 7561 6c69 7479 2e22 2222  est equality."""
+00003550: 0a20 2020 2064 6966 6620 3d20 5b28 692c  .    diff = [(i,
+00003560: 2062 6566 2c20 6166 7429 2066 6f72 2069   bef, aft) for i
+00003570: 2c20 2862 6566 2c20 6166 7429 2069 6e20  , (bef, aft) in 
+00003580: 656e 756d 6572 6174 6528 7a69 7028 6265  enumerate(zip(be
+00003590: 666f 7265 2e73 706c 6974 6c69 6e65 7328  fore.splitlines(
+000035a0: 292c 2061 6674 6572 2e73 706c 6974 6c69  ), after.splitli
+000035b0: 6e65 7328 2929 2c20 3129 2069 6620 6265  nes()), 1) if be
+000035c0: 6620 213d 2061 6674 5d0a 2020 2020 6966  f != aft].    if
+000035d0: 206c 656e 2864 6966 6629 203e 2030 3a0a   len(diff) > 0:.
+000035e0: 2020 2020 2020 2020 6c69 6e65 5f6e 2c20          line_n, 
+000035f0: 6c65 6674 2c20 5f20 3d20 7a69 7028 2a64  left, _ = zip(*d
+00003600: 6966 6629 0a20 2020 2020 2020 206c 6e20  iff).        ln 
+00003610: 3d20 6c65 6e28 7374 7228 6d61 7828 6c69  = len(str(max(li
+00003620: 6e65 5f6e 2929 2920 2320 6c65 6e67 7468  ne_n))) # length
+00003630: 206f 6620 7468 6520 6c6f 6e67 6573 7420   of the longest 
+00003640: 6c69 6e65 206e 756d 6265 720a 2020 2020  line number.    
+00003650: 2020 2020 6c65 6674 5f63 6f6c 203d 206d      left_col = m
+00003660: 6178 286c 656e 2873 2920 666f 7220 7320  ax(len(s) for s 
+00003670: 696e 206c 6566 7429 2023 206c 656e 6774  in left) # lengt
+00003680: 6820 6f66 2074 6865 206c 6f6e 6765 7374  h of the longest
+00003690: 206c 696e 650a 2020 2020 2020 2020 666f   line.        fo
+000036a0: 6c64 6572 2c20 6669 6c65 203d 206f 732e  lder, file = os.
+000036b0: 7061 7468 2e73 706c 6974 286f 7269 6769  path.split(origi
+000036c0: 6e61 6c29 0a20 2020 2020 2020 2074 6d70  nal).        tmp
+000036d0: 5f70 6572 7369 7374 203d 206f 732e 7061  _persist = os.pa
+000036e0: 7468 2e6a 6f69 6e28 666f 6c64 6572 2c20  th.join(folder, 
+000036f0: 272e 2e27 2c20 6669 6c65 290a 2020 2020  '..', file).    
+00003700: 2020 2020 7368 7574 696c 2e63 6f70 7928      shutil.copy(
+00003710: 746d 705f 6669 6c65 2e6e 616d 652c 2074  tmp_file.name, t
+00003720: 6d70 5f70 6572 7369 7374 290a 2020 2020  mp_persist).    
+00003730: 2020 2020 6469 6666 203d 205b 2827 272c      diff = [('',
+00003740: 206f 7269 6769 6e61 6c2c 2074 6d70 5f70   original, tmp_p
+00003750: 6572 7369 7374 295d 202b 2064 6966 660a  ersist)] + diff.
+00003760: 2020 2020 6173 7365 7274 206c 656e 2864      assert len(d
+00003770: 6966 6629 203d 3d20 302c 2027 5c6e 2720  iff) == 0, '\n' 
+00003780: 2b20 275c 6e27 2e6a 6f69 6e28 0a20 2020  + '\n'.join(.   
+00003790: 2020 2020 2066 227b 613a 7b6c 6e7d 7d20       f"{a:{ln}} 
+000037a0: 207b 623a 7b6c 6566 745f 636f 6c7d 7d20   {b:{left_col}} 
+000037b0: 2020 207b 637d 2220 666f 7220 612c 2062     {c}" for a, b
+000037c0: 2c20 6320 696e 2064 6966 6629 0a0a 0a64  , c in diff)...d
+000037d0: 6566 2061 7373 6572 745f 6466 735f 6571  ef assert_dfs_eq
+000037e0: 7561 6c28 6f6c 642c 206e 6577 2c20 6578  ual(old, new, ex
+000037f0: 636c 7564 653d 5b5d 293a 0a20 2020 2022  clude=[]):.    "
+00003800: 2222 2043 6f6d 7061 7265 7320 7468 6520  "" Compares the 
+00003810: 636f 6d6d 6f6e 2063 6f6c 756d 6e73 206f  common columns o
+00003820: 6620 7477 6f20 4461 7461 4672 616d 6573  f two DataFrames
+00003830: 2074 6f20 7465 7374 2065 7175 616c 6974   to test equalit
+00003840: 792e 2055 7365 733a 206e 616e 5f65 7128  y. Uses: nan_eq(
+00003850: 2922 2222 0a20 2020 206f 6c64 5f6c 2c20  )""".    old_l, 
+00003860: 6e65 775f 6c20 3d20 6c65 6e28 6f6c 6429  new_l = len(old)
+00003870: 2c20 6c65 6e28 6e65 7729 0a20 2020 2067  , len(new).    g
+00003880: 7265 6174 6572 5f6c 656e 6774 6820 3d20  reater_length = 
+00003890: 6d61 7828 6f6c 645f 6c2c 206e 6577 5f6c  max(old_l, new_l
+000038a0: 290a 2020 2020 6966 206f 6c64 5f6c 2021  ).    if old_l !
+000038b0: 3d20 6e65 775f 6c3a 0a20 2020 2020 2020  = new_l:.       
+000038c0: 2070 7269 6e74 2866 224f 6c64 206c 656e   print(f"Old len
+000038d0: 6774 683a 207b 6f6c 645f 6c7d 2c20 6e65  gth: {old_l}, ne
+000038e0: 7720 6c65 6e67 7468 3a20 7b6e 6577 5f6c  w length: {new_l
+000038f0: 7d22 290a 2020 2020 2020 2020 6f6c 645f  }").        old_
+00003900: 6973 5f73 686f 7274 6572 203d 206e 6577  is_shorter = new
+00003910: 5f6c 203d 3d20 6772 6561 7465 725f 6c65  _l == greater_le
+00003920: 6e67 7468 0a20 2020 2020 2020 2073 686f  ngth.        sho
+00003930: 7274 6572 203d 206f 6c64 2069 6620 6f6c  rter = old if ol
+00003940: 645f 6973 5f73 686f 7274 6572 2065 6c73  d_is_shorter els
+00003950: 6520 6e65 770a 2020 2020 2020 2020 6d69  e new.        mi
+00003960: 7373 696e 675f 726f 7773 203d 2061 6273  ssing_rows = abs
+00003970: 286f 6c64 5f6c 202d 206e 6577 5f6c 290a  (old_l - new_l).
+00003980: 2020 2020 2020 2020 7368 6f72 7465 725f          shorter_
+00003990: 636f 6c73 203d 2073 686f 7274 6572 2e63  cols = shorter.c
+000039a0: 6f6c 756d 6e73 0a20 2020 2020 2020 2070  olumns.        p
+000039b0: 6174 6368 203d 2070 642e 4461 7461 4672  atch = pd.DataFr
+000039c0: 616d 6528 5b5b 276d 6973 7369 6e67 2072  ame([['missing r
+000039d0: 6f77 275d 202a 206c 656e 2873 686f 7274  ow'] * len(short
+000039e0: 6572 5f63 6f6c 7329 5d20 2a20 6d69 7373  er_cols)] * miss
+000039f0: 696e 675f 726f 7773 2c20 636f 6c75 6d6e  ing_rows, column
+00003a00: 733d 7368 6f72 7465 725f 636f 6c73 290a  s=shorter_cols).
+00003a10: 2020 2020 2020 2020 7368 6f72 7465 7220          shorter 
+00003a20: 3d20 7064 2e63 6f6e 6361 7428 5b73 686f  = pd.concat([sho
+00003a30: 7274 6572 2c20 7061 7463 685d 2c20 6967  rter, patch], ig
+00003a40: 6e6f 7265 5f69 6e64 6578 3d54 7275 6529  nore_index=True)
+00003a50: 0a20 2020 2020 2020 2069 6620 6f6c 645f  .        if old_
+00003a60: 6973 5f73 686f 7274 6572 3a0a 2020 2020  is_shorter:.    
+00003a70: 2020 2020 2020 2020 6f6c 6420 3d20 7368          old = sh
+00003a80: 6f72 7465 720a 2020 2020 2020 2020 656c  orter.        el
+00003a90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00003aa0: 6e65 7720 3d20 7368 6f72 7465 720a 2020  new = shorter.  
+00003ab0: 2020 2320 6f6c 642e 696e 6465 782e 7265    # old.index.re
+00003ac0: 6e61 6d65 2827 6f6c 645f 6978 272c 2069  name('old_ix', i
+00003ad0: 6e70 6c61 6365 3d54 7275 6529 0a20 2020  nplace=True).   
+00003ae0: 2023 206e 6577 2e69 6e64 6578 2e72 656e   # new.index.ren
+00003af0: 616d 6528 276e 6577 5f69 7827 2c20 696e  ame('new_ix', in
+00003b00: 706c 6163 653d 5472 7565 290a 2020 2020  place=True).    
+00003b10: 636f 6c73 203d 205b 636f 6c20 666f 7220  cols = [col for 
+00003b20: 636f 6c20 696e 2073 6574 286f 6c64 2e63  col in set(old.c
+00003b30: 6f6c 756d 6e73 292e 696e 7465 7273 6563  olumns).intersec
+00003b40: 7469 6f6e 2873 6574 286e 6577 2e63 6f6c  tion(set(new.col
+00003b50: 756d 6e73 2929 2069 6620 636f 6c20 6e6f  umns)) if col no
+00003b60: 7420 696e 2065 7863 6c75 6465 5d0a 2020  t in exclude].  
+00003b70: 2020 6469 6666 203d 205b 2869 2c20 6a2c    diff = [(i, j,
+00003b80: 207e 6e61 6e5f 6571 286f 2c20 6e29 2920   ~nan_eq(o, n)) 
+00003b90: 666f 7220 2828 692c 206f 292c 2028 6a2c  for ((i, o), (j,
+00003ba0: 206e 2929 2069 6e20 7a69 7028 6f6c 645b   n)) in zip(old[
+00003bb0: 636f 6c73 5d2e 6974 6572 726f 7773 2829  cols].iterrows()
+00003bc0: 2c20 6e65 775b 636f 6c73 5d2e 6974 6572  , new[cols].iter
+00003bd0: 726f 7773 2829 295d 0a20 2020 206f 6c64  rows())].    old
+00003be0: 5f62 6f6f 6c20 3d20 7064 2e44 6174 6146  _bool = pd.DataF
+00003bf0: 7261 6d65 2e66 726f 6d5f 6469 6374 287b  rame.from_dict({
+00003c00: 6978 3a20 626f 6f6c 5f73 6572 6965 7320  ix: bool_series 
+00003c10: 666f 7220 6978 2c20 5f2c 2062 6f6f 6c5f  for ix, _, bool_
+00003c20: 7365 7269 6573 2069 6e20 6469 6666 7d2c  series in diff},
+00003c30: 206f 7269 656e 743d 2769 6e64 6578 2729   orient='index')
+00003c40: 0a20 2020 206e 6577 5f62 6f6f 6c20 3d20  .    new_bool = 
+00003c50: 7064 2e44 6174 6146 7261 6d65 2e66 726f  pd.DataFrame.fro
+00003c60: 6d5f 6469 6374 287b 6978 3a20 626f 6f6c  m_dict({ix: bool
+00003c70: 5f73 6572 6965 7320 666f 7220 5f2c 2069  _series for _, i
+00003c80: 782c 2062 6f6f 6c5f 7365 7269 6573 2069  x, bool_series i
+00003c90: 6e20 6469 6666 7d2c 206f 7269 656e 743d  n diff}, orient=
+00003ca0: 2769 6e64 6578 2729 0a20 2020 2064 6966  'index').    dif
+00003cb0: 6673 5f70 6572 5f63 6f6c 203d 206f 6c64  fs_per_col = old
+00003cc0: 5f62 6f6f 6c2e 7375 6d28 6178 6973 3d30  _bool.sum(axis=0
+00003cd0: 290a 0a20 2020 2064 6566 2073 686f 775f  )..    def show_
+00003ce0: 6469 6666 2829 3a0a 2020 2020 2020 2020  diff():.        
+00003cf0: 636f 6d70 5f73 7472 203d 205b 5d0a 2020  comp_str = [].  
+00003d00: 2020 2020 2020 6966 2027 6d63 2720 696e        if 'mc' in
+00003d10: 206f 6c64 2e63 6f6c 756d 6e73 3a0a 2020   old.columns:.  
+00003d20: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00003d30: 6f6e 5f63 6f6c 203d 2027 6d63 270a 2020  on_col = 'mc'.  
+00003d40: 2020 2020 2020 656c 6966 2027 6c61 7374        elif 'last
+00003d50: 5f6d 6327 2069 6e20 6f6c 642e 636f 6c75  _mc' in old.colu
+00003d60: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
+00003d70: 2070 6f73 6974 696f 6e5f 636f 6c20 3d20   position_col = 
+00003d80: 276c 6173 745f 6d63 270a 2020 2020 2020  'last_mc'.      
+00003d90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00003da0: 2020 2020 706f 7369 7469 6f6e 5f63 6f6c      position_col
+00003db0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00003dc0: 666f 7220 636f 6c2c 206e 5f64 6966 6673  for col, n_diffs
+00003dd0: 2069 6e20 6469 6666 735f 7065 725f 636f   in diffs_per_co
+00003de0: 6c2e 6974 656d 7328 293a 0a20 2020 2020  l.items():.     
+00003df0: 2020 2020 2020 2069 6620 6e5f 6469 6666         if n_diff
+00003e00: 7320 3e20 303a 0a20 2020 2020 2020 2020  s > 0:.         
+00003e10: 2020 2020 2020 2069 6620 706f 7369 7469         if positi
+00003e20: 6f6e 5f63 6f6c 2069 7320 4e6f 6e65 3a0a  on_col is None:.
+00003e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e40: 2020 2020 636f 6c75 6d6e 7320 3d20 636f      columns = co
+00003e50: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00003e60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00003e70: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00003e80: 6d6e 7320 3d20 5b70 6f73 6974 696f 6e5f  mns = [position_
+00003e90: 636f 6c2c 2063 6f6c 5d0a 2020 2020 2020  col, col].      
+00003ea0: 2020 2020 2020 2020 2020 636f 6d70 6172            compar
+00003eb0: 6973 6f6e 203d 2070 642e 636f 6e63 6174  ison = pd.concat
+00003ec0: 285b 6f6c 642e 6c6f 635b 6f6c 645f 626f  ([old.loc[old_bo
+00003ed0: 6f6c 5b63 6f6c 5d2c 2063 6f6c 756d 6e73  ol[col], columns
+00003ee0: 5d2e 7265 7365 745f 696e 6465 7828 6472  ].reset_index(dr
+00003ef0: 6f70 3d54 7275 6529 2e69 6c6f 635b 3a32  op=True).iloc[:2
+00003f00: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
+00003f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f20: 2020 2020 2020 2020 2020 2020 6e65 772e              new.
+00003f30: 6c6f 635b 6e65 775f 626f 6f6c 5b63 6f6c  loc[new_bool[col
+00003f40: 5d2c 2063 6f6c 756d 6e73 5d2e 696c 6f63  ], columns].iloc
+00003f50: 5b3a 3230 5d2e 7265 7365 745f 696e 6465  [:20].reset_inde
+00003f60: 7828 6472 6f70 3d54 7275 6529 5d2c 0a20  x(drop=True)],. 
+00003f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f90: 2020 2020 2020 6178 6973 3d31 2c0a 2020        axis=1,.  
+00003fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003fc0: 2020 2020 206b 6579 733d 5b27 6f6c 6427       keys=['old'
+00003fd0: 2c20 276e 6577 275d 290a 2020 2020 2020  , 'new']).      
+00003fe0: 2020 2020 2020 2020 2020 636f 6d70 5f73            comp_s
+00003ff0: 7472 2e61 7070 656e 6428 0a20 2020 2020  tr.append(.     
+00004000: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00004010: 227b 6e5f 6469 6666 737d 2f7b 6772 6561  "{n_diffs}/{grea
+00004020: 7465 725f 6c65 6e67 7468 7d20 287b 6e5f  ter_length} ({n_
+00004030: 6469 6666 7320 2f20 6772 6561 7465 725f  diffs / greater_
+00004040: 6c65 6e67 7468 202a 2031 3030 3a2e 3266  length * 100:.2f
+00004050: 7d20 2529 2072 6f77 7320 6172 6520 6469  } %) rows are di
+00004060: 6666 6572 656e 7420 666f 7220 7b63 6f6c  fferent for {col
+00004070: 7d7b 2720 2873 686f 7769 6e67 2066 6972  }{' (showing fir
+00004080: 7374 2032 3029 2720 6966 206e 5f64 6966  st 20)' if n_dif
+00004090: 6673 203e 2032 3020 656c 7365 2027 277d  fs > 20 else ''}
+000040a0: 3a5c 6e7b 636f 6d70 6172 6973 6f6e 7d5c  :\n{comparison}\
+000040b0: 6e22 290a 2020 2020 2020 2020 7265 7475  n").        retu
+000040c0: 726e 2027 5c6e 272e 6a6f 696e 2863 6f6d  rn '\n'.join(com
+000040d0: 705f 7374 7229 0a0a 2020 2020 6173 7365  p_str)..    asse
+000040e0: 7274 2064 6966 6673 5f70 6572 5f63 6f6c  rt diffs_per_col
+000040f0: 2e73 756d 2829 203d 3d20 302c 2073 686f  .sum() == 0, sho
+00004100: 775f 6469 6666 2829 0a0a 0a0a 6465 6620  w_diff()....def 
+00004110: 616d 6269 7475 7332 6f6e 656c 696e 6572  ambitus2oneliner
+00004120: 2861 6d62 6974 7573 293a 0a20 2020 2022  (ambitus):.    "
+00004130: 2222 2054 7572 6e73 2061 2060 606d 6574  "" Turns a ``met
+00004140: 6164 6174 615b 2770 6172 7473 275d 5b73  adata['parts'][s
+00004150: 7461 6666 5f69 645d 6060 2064 6963 7469  taff_id]`` dicti
+00004160: 6f6e 6172 7920 696e 746f 2061 2073 7472  onary into a str
+00004170: 696e 672e 2222 220a 2020 2020 6966 2027  ing.""".    if '
+00004180: 6d69 6e5f 6d69 6469 2720 696e 2061 6d62  min_midi' in amb
+00004190: 6974 7573 3a0a 2020 2020 2020 2020 7265  itus:.        re
+000041a0: 7475 726e 2066 227b 616d 6269 7475 735b  turn f"{ambitus[
+000041b0: 276d 696e 5f6d 6964 6927 5d7d 2d7b 616d  'min_midi']}-{am
+000041c0: 6269 7475 735b 276d 6178 5f6d 6964 6927  bitus['max_midi'
+000041d0: 5d7d 2028 7b61 6d62 6974 7573 5b27 6d69  ]} ({ambitus['mi
+000041e0: 6e5f 6e61 6d65 275d 7d2d 7b61 6d62 6974  n_name']}-{ambit
+000041f0: 7573 5b27 6d61 785f 6e61 6d65 275d 7d29  us['max_name']})
+00004200: 220a 2020 2020 6966 2027 6d61 785f 6d69  ".    if 'max_mi
+00004210: 6469 2720 696e 2061 6d62 6974 7573 3a0a  di' in ambitus:.
+00004220: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00004230: 227b 616d 6269 7475 735b 276d 6178 5f6d  "{ambitus['max_m
+00004240: 6964 6927 5d7d 2d7b 616d 6269 7475 735b  idi']}-{ambitus[
+00004250: 276d 6178 5f6d 6964 6927 5d7d 2028 7b61  'max_midi']} ({a
+00004260: 6d62 6974 7573 5b27 6d61 785f 6e61 6d65  mbitus['max_name
+00004270: 275d 7d2d 7b61 6d62 6974 7573 5b27 6d61  ']}-{ambitus['ma
+00004280: 785f 6e61 6d65 275d 7d29 220a 2020 2020  x_name']})".    
+00004290: 7265 7475 726e 2027 270a 0a0a 0a64 6566  return ''....def
+000042a0: 2063 6861 6e67 6573 326c 6973 7428 6368   changes2list(ch
+000042b0: 616e 6765 732c 2073 6f72 743d 5472 7565  anges, sort=True
+000042c0: 293a 0a20 2020 2022 2222 2053 706c 6974  ):.    """ Split
+000042d0: 7320 6120 7374 7269 6e67 206f 6620 6368  s a string of ch
+000042e0: 616e 6765 7320 696e 746f 2061 206c 6973  anges into a lis
+000042f0: 7420 6f66 2034 2d74 7570 6c65 732e 0a0a  t of 4-tuples...
+00004300: 2020 2020 4578 616d 706c 650a 2020 2020      Example.    
+00004310: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+00004320: 6368 616e 6765 7332 6c69 7374 2827 2b23  changes2list('+#
+00004330: 3762 3527 290a 2020 2020 5b28 272b 2337  7b5').    [('+#7
+00004340: 272c 2027 2b27 2c20 2723 272c 2027 3727  ', '+', '#', '7'
+00004350: 292c 0a20 2020 2020 2827 6235 272c 2020  ),.     ('b5',  
+00004360: 2727 2c20 2027 6227 2c20 2735 2729 5d0a  '',  'b', '5')].
+00004370: 2020 2020 2222 220a 2020 2020 7265 7320      """.    res 
+00004380: 3d20 5b74 2066 6f72 2074 2069 6e20 7265  = [t for t in re
+00004390: 2e66 696e 6461 6c6c 2872 2228 285c 2b7c  .findall(r"((\+|
+000043a0: 2d7c 5c5e 7c76 293f 2823 2b7c 622b 293f  -|\^|v)?(#+|b+)?
+000043b0: 2831 5c64 7c5c 6429 2922 2c20 6368 616e  (1\d|\d))", chan
+000043c0: 6765 7329 5d0a 2020 2020 7265 7475 726e  ges)].    return
+000043d0: 2073 6f72 7465 6428 7265 732c 206b 6579   sorted(res, key
+000043e0: 3d6c 616d 6264 6120 783a 2069 6e74 2878  =lambda x: int(x
+000043f0: 5b33 5d29 2c20 7265 7665 7273 653d 5472  [3]), reverse=Tr
+00004400: 7565 2920 6966 2073 6f72 7420 656c 7365  ue) if sort else
+00004410: 2072 6573 0a0a 0a0a 6465 6620 6368 616e   res....def chan
+00004420: 6765 7332 7470 6328 6368 616e 6765 732c  ges2tpc(changes,
+00004430: 206e 756d 6572 616c 2c20 6d69 6e6f 723d   numeral, minor=
+00004440: 4661 6c73 652c 2072 6f6f 745f 616c 7465  False, root_alte
+00004450: 7261 7469 6f6e 733d 4661 6c73 6529 3a0a  rations=False):.
+00004460: 2020 2020 2222 220a 2020 2020 4769 7665      """.    Give
+00004470: 6e20 6120 6e75 6d65 7261 6c20 616e 6420  n a numeral and 
+00004480: 6368 616e 6765 732c 2063 6f6d 7075 7465  changes, compute
+00004490: 7320 7468 6520 696e 7465 7276 616c 7320  s the intervals 
+000044a0: 7468 6174 2074 6865 2063 6861 6e67 6573  that the changes
+000044b0: 2072 6570 7265 7365 6e74 2e0a 2020 2020   represent..    
+000044c0: 4368 616e 6765 7320 646f 206e 6f74 2065  Changes do not e
+000044d0: 7870 7265 7373 2061 6273 6f6c 7574 6520  xpress absolute 
+000044e0: 696e 7465 7276 616c 7320 6275 7420 696e  intervals but in
+000044f0: 7374 6561 6420 6465 7065 6e64 206f 6e20  stead depend on 
+00004500: 7468 6520 6e75 6d65 7261 6c20 616e 6420  the numeral and 
+00004510: 7468 6520 6d6f 6465 2e0a 0a20 2020 2055  the mode...    U
+00004520: 7365 733a 2073 706c 6974 5f73 6361 6c65  ses: split_scale
+00004530: 5f64 6567 7265 6528 292c 2063 6861 6e67  _degree(), chang
+00004540: 6573 326c 6973 7428 290a 0a20 2020 2050  es2list()..    P
+00004550: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00004560: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2063 6861  --------.    cha
+00004570: 6e67 6573 203a 203a 6f62 6a3a 6073 7472  nges : :obj:`str
+00004580: 600a 2020 2020 2020 2020 4120 7374 7269  `.        A stri
+00004590: 6e67 206f 6620 6368 616e 6765 7320 666f  ng of changes fo
+000045a0: 6c6c 6f77 696e 6720 7468 6520 4443 4d4c  llowing the DCML
+000045b0: 2068 6172 6d6f 6e79 2073 7461 6e64 6172   harmony standar
+000045c0: 642e 0a20 2020 206e 756d 6572 616c 203a  d..    numeral :
+000045d0: 203a 6f62 6a3a 6073 7472 600a 2020 2020   :obj:`str`.    
+000045e0: 2020 2020 526f 6d61 6e20 6e75 6d65 7261      Roman numera
+000045f0: 6c2e 2049 6620 6974 2069 7320 7072 6563  l. If it is prec
+00004600: 6564 6564 2062 7920 6163 6369 6465 6e74  eded by accident
+00004610: 616c 732c 2069 7420 6465 7065 6e64 7320  als, it depends 
+00004620: 6f6e 2074 6865 2070 6172 616d 6574 6572  on the parameter
+00004630: 0a20 2020 2020 2020 2060 726f 6f74 5f61  .        `root_a
+00004640: 6c74 6572 6174 696f 6e73 6020 7768 6574  lterations` whet
+00004650: 6865 7220 7468 6573 6520 6172 6520 7461  her these are ta
+00004660: 6b65 6e20 696e 746f 2061 6363 6f75 6e74  ken into account
+00004670: 2e0a 2020 2020 6d69 6e6f 7220 3a20 3a6f  ..    minor : :o
+00004680: 626a 3a60 626f 6f6c 602c 206f 7074 696f  bj:`bool`, optio
+00004690: 6e61 6c0a 2020 2020 2020 2020 5365 7420  nal.        Set 
+000046a0: 746f 2074 7275 6520 6966 2074 6865 2060  to true if the `
+000046b0: 6e75 6d65 7261 6c60 206f 6363 7572 7320  numeral` occurs 
+000046c0: 696e 2061 206d 696e 6f72 2063 6f6e 7465  in a minor conte
+000046d0: 7874 2e0a 2020 2020 726f 6f74 5f61 6c74  xt..    root_alt
+000046e0: 6572 6174 696f 6e73 203a 203a 6f62 6a3a  erations : :obj:
+000046f0: 6062 6f6f 6c60 2c20 6f70 7469 6f6e 616c  `bool`, optional
+00004700: 0a20 2020 2020 2020 2053 6574 2074 6f20  .        Set to 
+00004710: 5472 7565 2069 6620 6163 6369 6465 6e74  True if accident
+00004720: 616c 7320 6f66 2074 6865 2072 6f6f 7420  als of the root 
+00004730: 7368 6f75 6c64 2063 6861 6e67 6520 7468  should change th
+00004740: 6520 7265 7375 6c74 2e0a 2020 2020 2222  e result..    ""
+00004750: 220a 2020 2020 726f 6f74 5f61 6c74 6572  ".    root_alter
+00004760: 6174 696f 6e2c 206e 756d 5f64 6567 7265  ation, num_degre
+00004770: 6520 3d20 7370 6c69 745f 7363 616c 655f  e = split_scale_
+00004780: 6465 6772 6565 286e 756d 6572 616c 2c20  degree(numeral, 
+00004790: 636f 756e 743d 5472 7565 2c20 6c6f 6767  count=True, logg
+000047a0: 6572 3d6c 6f67 6765 7229 0a20 2020 2023  er=logger).    #
+000047b0: 2062 7569 6c64 2032 2d6f 6374 6176 6520   build 2-octave 
+000047c0: 6469 6174 6f6e 6963 2073 6361 6c65 206f  diatonic scale o
+000047d0: 6e20 4320 6d61 6a6f 722f 6d69 6e6f 720a  n C major/minor.
+000047e0: 2020 2020 726f 6f74 203d 205b 2749 272c      root = ['I',
+000047f0: 2027 4949 272c 2027 4949 4927 2c20 2749   'II', 'III', 'I
+00004800: 5627 2c20 2756 272c 2027 5649 272c 2027  V', 'V', 'VI', '
+00004810: 5649 4927 5d2e 696e 6465 7828 6e75 6d5f  VII'].index(num_
+00004820: 6465 6772 6565 2e75 7070 6572 2829 290a  degree.upper()).
+00004830: 2020 2020 7470 6373 203d 2032 202a 205b      tpcs = 2 * [
+00004840: 6920 666f 7220 6920 696e 2028 302c 2032  i for i in (0, 2
+00004850: 2c20 2d33 2c20 2d31 2c20 312c 202d 342c  , -3, -1, 1, -4,
+00004860: 202d 3229 5d20 6966 206d 696e 6f72 2065   -2)] if minor e
+00004870: 6c73 6520 3220 2a20 5b69 2066 6f72 2069  lse 2 * [i for i
+00004880: 2069 6e20 2830 2c20 322c 2034 2c20 2d31   in (0, 2, 4, -1
+00004890: 2c20 312c 2033 2c20 3529 5d0a 2020 2020  , 1, 3, 5)].    
+000048a0: 7470 6373 203d 2074 7063 735b 726f 6f74  tpcs = tpcs[root
+000048b0: 3a5d 202b 2074 7063 735b 3a72 6f6f 745d  :] + tpcs[:root]
+000048c0: 2020 2320 7374 6172 7469 6e67 2074 6865    # starting the
+000048d0: 2073 6361 6c65 2066 726f 6d20 6368 6f72   scale from chor
+000048e0: 6420 726f 6f74 0a20 2020 2072 6f6f 7420  d root.    root 
+000048f0: 3d20 7470 6373 5b30 5d0a 2020 2020 6966  = tpcs[0].    if
+00004900: 2072 6f6f 745f 616c 7465 7261 7469 6f6e   root_alteration
+00004910: 733a 0a20 2020 2020 2020 2072 6f6f 7420  s:.        root 
+00004920: 2b3d 2037 202a 2072 6f6f 745f 616c 7465  += 7 * root_alte
+00004930: 7261 7469 6f6e 0a20 2020 2020 2020 2074  ration.        t
+00004940: 7063 735b 305d 203d 2072 6f6f 740a 0a20  pcs[0] = root.. 
+00004950: 2020 2061 6c74 7320 3d20 6368 616e 6765     alts = change
+00004960: 7332 6c69 7374 2863 6861 6e67 6573 2c20  s2list(changes, 
+00004970: 736f 7274 3d46 616c 7365 290a 2020 2020  sort=False).    
+00004980: 6163 6332 7470 6320 3d20 6c61 6d62 6461  acc2tpc = lambda
+00004990: 2061 6363 6964 656e 7461 6c73 3a20 3720   accidentals: 7 
+000049a0: 2a20 2861 6363 6964 656e 7461 6c73 2e63  * (accidentals.c
+000049b0: 6f75 6e74 2827 2327 2920 2d20 6163 6369  ount('#') - acci
+000049c0: 6465 6e74 616c 732e 636f 756e 7428 2762  dentals.count('b
+000049d0: 2729 290a 2020 2020 7265 7475 726e 205b  ')).    return [
+000049e0: 2866 756c 6c2c 2061 6464 6564 2c20 6163  (full, added, ac
+000049f0: 632c 2063 686f 7264 5f69 6e74 6572 7661  c, chord_interva
+00004a00: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+00004a10: 2874 7063 735b 696e 7428 6368 6f72 645f  (tpcs[int(chord_
+00004a20: 696e 7465 7276 616c 2920 2d20 315d 202b  interval) - 1] +
+00004a30: 2061 6363 3274 7063 2861 6363 2920 2d20   acc2tpc(acc) - 
+00004a40: 726f 6f74 2920 6966 206e 6f74 2063 686f  root) if not cho
+00004a50: 7264 5f69 6e74 6572 7661 6c20 696e 205b  rd_interval in [
+00004a60: 2733 272c 2027 3527 5d20 656c 7365 204e  '3', '5'] else N
+00004a70: 6f6e 6529 2066 6f72 0a20 2020 2020 2020  one) for.       
+00004a80: 2020 2020 2066 756c 6c2c 2061 6464 6564       full, added
+00004a90: 2c20 6163 632c 2063 686f 7264 5f69 6e74  , acc, chord_int
+00004aa0: 6572 7661 6c20 696e 2061 6c74 735d 0a0a  erval in alts]..
+00004ab0: 0a0a 6465 6620 6368 6563 6b5f 6c61 6265  ..def check_labe
+00004ac0: 6c73 2864 662c 2072 6567 6578 2c20 636f  ls(df, regex, co
+00004ad0: 6c75 6d6e 3d27 6c61 6265 6c27 2c20 7370  lumn='label', sp
+00004ae0: 6c69 745f 7265 6765 783d 4e6f 6e65 2c20  lit_regex=None, 
+00004af0: 7265 7475 726e 5f63 6f6c 733d 5b27 6d63  return_cols=['mc
+00004b00: 272c 2027 6d63 5f6f 6e73 6574 272c 2027  ', 'mc_onset', '
+00004b10: 7374 6166 6627 2c20 2776 6f69 6365 275d  staff', 'voice']
+00004b20: 293a 0a20 2020 2022 2222 2020 4368 6563  ):.    """  Chec
+00004b30: 6b73 2074 6865 206c 6162 656c 7320 696e  ks the labels in
+00004b40: 2060 6063 6f6c 756d 6e60 6020 6167 6169   ``column`` agai
+00004b50: 6e73 7420 6060 7265 6765 7860 6020 616e  nst ``regex`` an
+00004b60: 6420 7265 7475 726e 7320 7468 6f73 6520  d returns those 
+00004b70: 7468 6174 2064 6f6e 2774 206d 6174 6368  that don't match
+00004b80: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+00004b90: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00004ba0: 0a20 2020 2064 6620 3a20 3a6f 626a 3a60  .    df : :obj:`
+00004bb0: 7061 6e64 6173 2e44 6174 6146 7261 6d65  pandas.DataFrame
+00004bc0: 600a 2020 2020 2020 2020 4461 7461 4672  `.        DataFr
+00004bd0: 616d 6520 636f 6e74 6169 6e69 6e67 2061  ame containing a
+00004be0: 2063 6f6c 756d 6e20 7769 7468 206c 6162   column with lab
+00004bf0: 656c 732e 0a20 2020 2072 6567 6578 203a  els..    regex :
+00004c00: 203a 6f62 6a3a 6073 7472 600a 2020 2020   :obj:`str`.    
+00004c10: 2020 2020 5265 6775 6c61 7220 6578 7072      Regular expr
+00004c20: 6573 7369 6f6e 2074 6861 7420 696e 636f  ession that inco
+00004c30: 7272 6563 7420 6c61 6265 6c73 2064 6f6e  rrect labels don
+00004c40: 2774 206d 6174 6368 2e0a 2020 2020 636f  't match..    co
+00004c50: 6c75 6d6e 203a 203a 6f62 6a3a 6073 7472  lumn : :obj:`str
+00004c60: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
+00004c70: 2020 2020 436f 6c75 6d6e 206e 616d 6520      Column name 
+00004c80: 7768 6572 6520 7468 6520 6c61 6265 6c73  where the labels
+00004c90: 2061 7265 2e20 4465 6661 756c 7473 2074   are. Defaults t
+00004ca0: 6f20 276c 6162 656c 270a 2020 2020 7370  o 'label'.    sp
+00004cb0: 6c69 745f 7265 6765 7820 3a20 3a6f 626a  lit_regex : :obj
+00004cc0: 3a60 7374 7260 2c20 6f70 7469 6f6e 616c  :`str`, optional
+00004cd0: 0a20 2020 2020 2020 2049 6620 796f 7520  .        If you 
+00004ce0: 7061 7373 2061 2072 6567 756c 6172 2065  pass a regular e
+00004cf0: 7870 7265 7373 696f 6e20 286f 7220 7369  xpression (or si
+00004d00: 6d70 6c65 2073 7472 696e 6729 2c20 6974  mple string), it
+00004d10: 2077 696c 6c20 6265 2075 7365 6420 746f   will be used to
+00004d20: 2073 706c 6974 2074 6865 206c 6162 656c   split the label
+00004d30: 7320 6265 666f 7265 2063 6865 636b 696e  s before checkin
+00004d40: 6720 7468 650a 2020 2020 2020 2020 7265  g the.        re
+00004d50: 7375 6c74 696e 6720 636f 6c75 6d6e 2073  sulting column s
+00004d60: 6570 6172 6174 656c 792e 2049 6e73 7465  eparately. Inste
+00004d70: 6164 2c20 7061 7373 2054 7275 6520 746f  ad, pass True to
+00004d80: 2075 7365 2074 6865 2064 6566 6175 6c74   use the default
+00004d90: 2028 6120 272d 2720 7468 6174 2064 6f65   (a '-' that doe
+00004da0: 7320 6e6f 7420 7072 6563 6564 6520 6120  s not precede a 
+00004db0: 7363 616c 6520 6465 6772 6565 292e 0a20  scale degree).. 
+00004dc0: 2020 2072 6574 7572 6e5f 636f 6c73 203a     return_cols :
+00004dd0: 203a 6f62 6a3a 606c 6973 7460 2c20 6f70   :obj:`list`, op
+00004de0: 7469 6f6e 616c 0a20 2020 2020 2020 2050  tional.        P
+00004df0: 6173 7320 6120 6c69 7374 206f 6620 7468  ass a list of th
+00004e00: 6520 4461 7461 4672 616d 6520 636f 6c75  e DataFrame colu
+00004e10: 6d6e 7320 7468 6174 2079 6f75 2077 616e  mns that you wan
+00004e20: 7420 746f 2062 6520 6469 7370 6c61 7965  t to be displaye
+00004e30: 6420 666f 7220 7468 6520 7772 6f6e 6720  d for the wrong 
+00004e40: 6c61 6265 6c73 2e0a 0a20 2020 2052 6574  labels...    Ret
+00004e50: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+00004e60: 0a20 2020 2064 6620 3a20 3a6f 626a 3a60  .    df : :obj:`
+00004e70: 7061 6e64 6173 2e44 6174 6146 7261 6d65  pandas.DataFrame
+00004e80: 600a 2020 2020 2020 2020 4461 7461 4672  `.        DataFr
+00004e90: 616d 6520 7769 7468 2077 726f 6e67 206c  ame with wrong l
+00004ea0: 6162 656c 732e 0a0a 2020 2020 2222 220a  abels...    """.
+00004eb0: 2020 2020 6966 2073 706c 6974 5f72 6567      if split_reg
+00004ec0: 6578 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ex is not None:.
+00004ed0: 2020 2020 2020 2020 6966 2073 706c 6974          if split
+00004ee0: 5f72 6567 6578 203d 3d20 5472 7565 3a0a  _regex == True:.
+00004ef0: 2020 2020 2020 2020 2020 2020 6368 6563              chec
+00004f00: 6b5f 7468 6973 203d 2073 706c 6974 5f61  k_this = split_a
+00004f10: 6c74 6572 6e61 7469 7665 7328 6466 2c20  lternatives(df, 
+00004f20: 636f 6c75 6d6e 3d63 6f6c 756d 6e2c 2061  column=column, a
+00004f30: 6c74 6572 6e61 7469 7665 735f 6f6e 6c79  lternatives_only
+00004f40: 3d54 7275 6529 0a20 2020 2020 2020 2065  =True).        e
+00004f50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00004f60: 2063 6865 636b 5f74 6869 7320 3d20 7370   check_this = sp
+00004f70: 6c69 745f 616c 7465 726e 6174 6976 6573  lit_alternatives
+00004f80: 2864 662c 2063 6f6c 756d 6e3d 636f 6c75  (df, column=colu
+00004f90: 6d6e 2c20 7265 6765 783d 7370 6c69 745f  mn, regex=split_
+00004fa0: 7265 6765 782c 206d 6178 3d31 3030 302c  regex, max=1000,
+00004fb0: 2061 6c74 6572 6e61 7469 7665 735f 6f6e   alternatives_on
+00004fc0: 6c79 3d54 7275 6529 0a20 2020 2065 6c73  ly=True).    els
+00004fd0: 653a 0a20 2020 2020 2020 2063 6865 636b  e:.        check
+00004fe0: 5f74 6869 7320 3d20 6466 5b5b 636f 6c75  _this = df[[colu
+00004ff0: 6d6e 5d5d 0a20 2020 2069 6620 7265 6765  mn]].    if rege
+00005000: 782e 5f5f 636c 6173 735f 5f20 213d 2072  x.__class__ != r
+00005010: 652e 636f 6d70 696c 6528 2727 292e 5f5f  e.compile('').__
+00005020: 636c 6173 735f 5f3a 0a20 2020 2020 2020  class__:.       
+00005030: 2072 6567 6578 203d 2072 652e 636f 6d70   regex = re.comp
+00005040: 696c 6528 7265 6765 782c 2072 652e 5645  ile(regex, re.VE
+00005050: 5242 4f53 4529 0a20 2020 206e 6f74 5f6d  RBOSE).    not_m
+00005060: 6174 6368 6564 203d 2063 6865 636b 5f74  atched = check_t
+00005070: 6869 732e 6170 706c 7928 6c61 6d62 6461  his.apply(lambda
+00005080: 2063 3a20 7e63 2e73 7472 2e6d 6174 6368   c: ~c.str.match
+00005090: 2872 6567 6578 292e 6669 6c6c 6e61 2854  (regex).fillna(T
+000050a0: 7275 6529 290a 2020 2020 636f 6c73 203d  rue)).    cols =
+000050b0: 205b 6320 666f 7220 6320 696e 2072 6574   [c for c in ret
+000050c0: 7572 6e5f 636f 6c73 2069 6620 6320 696e  urn_cols if c in
+000050d0: 2064 662e 636f 6c75 6d6e 735d 0a20 2020   df.columns].   
+000050e0: 2073 656c 6563 745f 7772 6f6e 6720 3d20   select_wrong = 
+000050f0: 6e6f 745f 6d61 7463 6865 642e 616e 7928  not_matched.any(
+00005100: 6178 6973 3d31 290a 2020 2020 7265 7320  axis=1).    res 
+00005110: 3d20 6368 6563 6b5f 7468 6973 2e77 6865  = check_this.whe
+00005120: 7265 286e 6f74 5f6d 6174 6368 6564 2c20  re(not_matched, 
+00005130: 6f74 6865 723d 272e 2729 5b73 656c 6563  other='.')[selec
+00005140: 745f 7772 6f6e 675d 0a20 2020 2072 6573  t_wrong].    res
+00005150: 203d 2072 6573 2e61 7070 6c79 286c 616d   = res.apply(lam
+00005160: 6264 6120 633a 2063 2e73 7472 2e72 6570  bda c: c.str.rep
+00005170: 6c61 6365 2827 5e2f 2427 2c20 2765 6d70  lace('^/$', 'emp
+00005180: 7479 5f68 6172 6d6f 6e79 272c 2072 6567  ty_harmony', reg
+00005190: 6578 3d54 7275 6529 290a 2020 2020 7265  ex=True)).    re
+000051a0: 7475 726e 2070 642e 636f 6e63 6174 285b  turn pd.concat([
+000051b0: 6466 2e6c 6f63 5b73 656c 6563 745f 7772  df.loc[select_wr
+000051c0: 6f6e 672c 2063 6f6c 735d 2c20 7265 735d  ong, cols], res]
+000051d0: 2c20 6178 6973 3d31 290a 0a0a 0a0a 0a64  , axis=1)......d
+000051e0: 6566 2063 6f6c 6f72 3272 6762 6128 6329  ef color2rgba(c)
+000051f0: 3a0a 2020 2020 2222 2220 5061 7373 2061  :.    """ Pass a
+00005200: 2052 4742 206f 7220 5247 4241 2074 7570   RGB or RGBA tup
+00005210: 6c65 2c20 4854 4d4c 2063 6f6c 6f72 206f  le, HTML color o
+00005220: 7220 6e61 6d65 2074 6f20 636f 6e76 6572  r name to conver
+00005230: 7420 6974 2074 6f20 5247 4241 2022 2222  t it to RGBA """
+00005240: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+00005250: 6365 2863 2c20 7475 706c 6529 3a0a 2020  ce(c, tuple):.  
+00005260: 2020 2020 2020 6966 206c 656e 2863 2920        if len(c) 
+00005270: 3e20 333a 0a20 2020 2020 2020 2020 2020  > 3:.           
+00005280: 2072 6574 7572 6e20 7267 6261 282a 635b   return rgba(*c[
+00005290: 3a34 5d29 0a20 2020 2020 2020 2069 6620  :4]).        if 
+000052a0: 6c65 6e28 6329 203d 3d20 333a 0a20 2020  len(c) == 3:.   
+000052b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000052c0: 7267 6261 282a 2863 202b 2028 3235 352c  rgba(*(c + (255,
+000052d0: 2929 290a 2020 2020 2020 2020 656c 7365  ))).        else
+000052e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000052f0: 7475 726e 2072 6762 6128 2a63 290a 2020  turn rgba(*c).  
+00005300: 2020 6966 2063 5b30 5d20 3d3d 2027 2327    if c[0] == '#'
+00005310: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00005320: 2068 746d 6c5f 636f 6c6f 7232 7267 6261   html_color2rgba
+00005330: 2863 290a 2020 2020 7265 7475 726e 2063  (c).    return c
+00005340: 6f6c 6f72 5f6e 616d 6532 7267 6261 2863  olor_name2rgba(c
+00005350: 290a 0a0a 0a64 6566 2063 6f6c 6f72 5f6e  )....def color_n
+00005360: 616d 6532 666f 726d 6174 286e 2c20 666f  ame2format(n, fo
+00005370: 726d 6174 3d27 7267 6227 293a 0a20 2020  rmat='rgb'):.   
+00005380: 2022 2222 2043 6f6e 7665 7274 7320 6120   """ Converts a 
+00005390: 7369 6e67 6c65 2043 5353 3320 6e61 6d65  single CSS3 name
+000053a0: 2069 6e74 6f20 6f6e 6520 6f66 2027 4854   into one of 'HT
+000053b0: 4d4c 272c 2027 7267 6227 2c20 6f72 2027  ML', 'rgb', or '
+000053c0: 7267 6261 2722 2222 0a20 2020 2069 6620  rgba'""".    if 
+000053d0: 7064 2e69 736e 756c 6c28 6e29 3a0a 2020  pd.isnull(n):.  
+000053e0: 2020 2020 2020 7265 7475 726e 206e 0a20        return n. 
+000053f0: 2020 2069 6620 6e20 696e 2077 6562 636f     if n in webco
+00005400: 6c6f 7273 2e43 5353 335f 4e41 4d45 535f  lors.CSS3_NAMES_
+00005410: 544f 5f48 4558 3a0a 2020 2020 2020 2020  TO_HEX:.        
+00005420: 6874 6d6c 203d 2077 6562 636f 6c6f 7273  html = webcolors
+00005430: 2e6e 616d 655f 746f 5f68 6578 286e 290a  .name_to_hex(n).
+00005440: 2020 2020 656c 6966 206e 2069 6e20 4d53      elif n in MS
+00005450: 335f 4854 4d4c 2e76 616c 7565 7328 293a  3_HTML.values():
+00005460: 0a20 2020 2020 2020 2068 746d 6c20 3d20  .        html = 
+00005470: 6e65 7874 286b 2066 6f72 206b 2c20 7620  next(k for k, v 
+00005480: 696e 204d 5333 5f48 544d 4c2e 6974 656d  in MS3_HTML.item
+00005490: 7328 2920 6966 2076 203d 3d20 6e29 0a20  s() if v == n). 
+000054a0: 2020 2065 6c69 6620 6e5b 305d 203d 3d20     elif n[0] == 
+000054b0: 2723 273a 0a20 2020 2020 2020 2068 746d  '#':.        htm
+000054c0: 6c20 3d20 6e0a 2020 2020 656c 7365 3a0a  l = n.    else:.
+000054d0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+000054e0: 0a20 2020 2069 6620 666f 726d 6174 203d  .    if format =
+000054f0: 3d20 2768 746d 6c27 3a0a 2020 2020 2020  = 'html':.      
+00005500: 2020 7265 7475 726e 2068 746d 6c0a 2020    return html.  
+00005510: 2020 6966 2066 6f72 6d61 7420 3d3d 2027    if format == '
+00005520: 7267 6227 3a0a 2020 2020 2020 2020 7265  rgb':.        re
+00005530: 7475 726e 2077 6562 636f 6c6f 7273 2e68  turn webcolors.h
+00005540: 6578 5f74 6f5f 7267 6228 6874 6d6c 290a  ex_to_rgb(html).
+00005550: 2020 2020 6966 2066 6f72 6d61 7420 3d3d      if format ==
+00005560: 2027 7267 6261 273a 0a20 2020 2020 2020   'rgba':.       
+00005570: 2072 6762 203d 2077 6562 636f 6c6f 7273   rgb = webcolors
+00005580: 2e68 6578 5f74 6f5f 7267 6228 6874 6d6c  .hex_to_rgb(html
+00005590: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000055a0: 2072 6762 6128 2a28 7267 6220 2b20 2832   rgba(*(rgb + (2
+000055b0: 3535 2c29 2929 0a20 2020 2072 6574 7572  55,))).    retur
+000055c0: 6e20 6874 6d6c 0a0a 0a64 6566 2063 6f6c  n html...def col
+000055d0: 6f72 5f6e 616d 6532 6874 6d6c 286e 293a  or_name2html(n):
+000055e0: 0a20 2020 2022 2222 2043 6f6e 7665 7274  .    """ Convert
+000055f0: 7320 6120 7369 6e67 6c65 2043 5353 3320  s a single CSS3 
+00005600: 6e61 6d65 2069 6e74 6f20 4854 4d4c 2222  name into HTML""
+00005610: 220a 2020 2020 7265 7475 726e 2063 6f6c  ".    return col
+00005620: 6f72 5f6e 616d 6532 666f 726d 6174 286e  or_name2format(n
+00005630: 2c20 666f 726d 6174 3d27 6874 6d6c 2729  , format='html')
+00005640: 0a0a 0a64 6566 2063 6f6c 6f72 5f6e 616d  ...def color_nam
+00005650: 6532 7267 6228 6e29 3a0a 2020 2020 2222  e2rgb(n):.    ""
+00005660: 2220 436f 6e76 6572 7473 2061 2073 696e  " Converts a sin
+00005670: 676c 6520 4353 5333 206e 616d 6520 696e  gle CSS3 name in
+00005680: 746f 2052 4742 2222 220a 2020 2020 7265  to RGB""".    re
+00005690: 7475 726e 2063 6f6c 6f72 5f6e 616d 6532  turn color_name2
+000056a0: 666f 726d 6174 286e 2c20 666f 726d 6174  format(n, format
+000056b0: 3d27 7267 6227 290a 0a0a 6465 6620 636f  ='rgb')...def co
+000056c0: 6c6f 725f 6e61 6d65 3272 6762 6128 6e29  lor_name2rgba(n)
+000056d0: 3a0a 2020 2020 2222 2220 436f 6e76 6572  :.    """ Conver
+000056e0: 7473 2061 2073 696e 676c 6520 4353 5333  ts a single CSS3
+000056f0: 206e 616d 6520 696e 746f 2052 4742 4122   name into RGBA"
+00005700: 2222 0a20 2020 2072 6574 7572 6e20 636f  "".    return co
+00005710: 6c6f 725f 6e61 6d65 3266 6f72 6d61 7428  lor_name2format(
+00005720: 6e2c 2066 6f72 6d61 743d 2772 6762 6127  n, format='rgba'
+00005730: 290a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  )..@function_log
+00005740: 6765 720a 6465 6620 636f 6c6f 725f 7061  ger.def color_pa
+00005750: 7261 6d73 3272 6762 6128 636f 6c6f 725f  rams2rgba(color_
+00005760: 6e61 6d65 3d4e 6f6e 652c 2063 6f6c 6f72  name=None, color
+00005770: 5f68 746d 6c3d 4e6f 6e65 2c20 636f 6c6f  _html=None, colo
+00005780: 725f 723d 4e6f 6e65 2c20 636f 6c6f 725f  r_r=None, color_
+00005790: 673d 4e6f 6e65 2c20 636f 6c6f 725f 623d  g=None, color_b=
+000057a0: 4e6f 6e65 2c20 636f 6c6f 725f 613d 4e6f  None, color_a=No
+000057b0: 6e65 293a 0a20 2020 2022 2222 2046 6f72  ne):.    """ For
+000057c0: 2066 756e 6374 696f 6e73 2077 6865 7265   functions where
+000057d0: 2074 6865 2063 6f6c 6f72 2063 616e 2062   the color can b
+000057e0: 6520 7370 6563 6966 6965 6420 696e 2066  e specified in f
+000057f0: 6f75 7220 6469 6666 6572 656e 7420 7761  our different wa
+00005800: 7973 2028 4854 4d4c 2073 7472 696e 672c  ys (HTML string,
+00005810: 2043 5353 206e 616d 652c 0a20 2020 2052   CSS name,.    R
+00005820: 4742 2c20 6f72 2052 4742 4129 2c20 636f  GB, or RGBA), co
+00005830: 6e76 6572 7420 7468 6520 6769 7665 6e20  nvert the given 
+00005840: 7061 7261 6d65 7465 7273 2074 6f20 5247  parameters to RG
+00005850: 4241 2e0a 0a20 2020 2050 6172 616d 6574  BA...    Paramet
+00005860: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00005870: 2d2d 0a20 2020 2063 6f6c 6f72 5f6e 616d  --.    color_nam
+00005880: 6520 3a20 3a6f 626a 3a60 7374 7260 2c20  e : :obj:`str`, 
+00005890: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+000058a0: 2041 7320 6120 6e61 6d65 2079 6f75 2063   As a name you c
+000058b0: 616e 2075 7365 2043 5353 2063 6f6c 6f72  an use CSS color
+000058c0: 7320 6f72 204d 7573 6553 636f 7265 2063  s or MuseScore c
+000058d0: 6f6c 6f72 7320 2873 6565 203a 7079 3a61  olors (see :py:a
+000058e0: 7474 723a 602e 4d53 335f 434f 4c4f 5253  ttr:`.MS3_COLORS
+000058f0: 6029 2e0a 2020 2020 636f 6c6f 725f 6874  `)..    color_ht
+00005900: 6d6c 203a 203a 6f62 6a3a 6073 7472 602c  ml : :obj:`str`,
+00005910: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00005920: 2020 416e 2048 544d 4c20 636f 6c6f 7220    An HTML color 
+00005930: 6e65 6564 7320 746f 2062 6520 7374 7269  needs to be stri
+00005940: 6e67 206f 6620 6c65 6e67 7468 2036 2e0a  ng of length 6..
+00005950: 2020 2020 636f 6c6f 725f 7220 3a20 3a6f      color_r : :o
+00005960: 626a 3a60 696e 7460 2c20 6f70 7469 6f6e  bj:`int`, option
+00005970: 616c 0a20 2020 2020 2020 2049 6620 796f  al.        If yo
+00005980: 7520 7370 6563 6966 7920 7468 6520 636f  u specify the co
+00005990: 6c6f 7220 6173 2052 4742 2841 292c 2079  lor as RGB(A), y
+000059a0: 6f75 2061 6c73 6f20 6e65 6564 2074 6f20  ou also need to 
+000059b0: 7370 6563 6966 7920 636f 6c6f 725f 6720  specify color_g 
+000059c0: 616e 6420 636f 6c6f 725f 622e 0a20 2020  and color_b..   
+000059d0: 2063 6f6c 6f72 5f67 203a 203a 6f62 6a3a   color_g : :obj:
+000059e0: 6069 6e74 602c 206f 7074 696f 6e61 6c0a  `int`, optional.
+000059f0: 2020 2020 2020 2020 4966 2079 6f75 2073          If you s
+00005a00: 7065 6369 6679 2074 6865 2063 6f6c 6f72  pecify the color
+00005a10: 2061 7320 5247 4228 4129 2c20 796f 7520   as RGB(A), you 
+00005a20: 616c 736f 206e 6565 6420 746f 2073 7065  also need to spe
+00005a30: 6369 6679 2063 6f6c 6f72 5f72 2061 6e64  cify color_r and
+00005a40: 2063 6f6c 6f72 5f62 2e0a 2020 2020 636f   color_b..    co
+00005a50: 6c6f 725f 6220 3a20 3a6f 626a 3a60 696e  lor_b : :obj:`in
+00005a60: 7460 2c20 6f70 7469 6f6e 616c 0a20 2020  t`, optional.   
+00005a70: 2020 2020 2049 6620 796f 7520 7370 6563       If you spec
+00005a80: 6966 7920 7468 6520 636f 6c6f 7220 6173  ify the color as
+00005a90: 2052 4742 2841 292c 2079 6f75 2061 6c73   RGB(A), you als
+00005aa0: 6f20 6e65 6564 2074 6f20 7370 6563 6966  o need to specif
+00005ab0: 7920 636f 6c6f 725f 7220 616e 6420 636f  y color_r and co
+00005ac0: 6c6f 725f 672e 0a20 2020 2063 6f6c 6f72  lor_g..    color
+00005ad0: 5f61 203a 203a 6f62 6a3a 6069 6e74 602c  _a : :obj:`int`,
+00005ae0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00005af0: 2020 4966 2079 6f75 2068 6176 6520 7370    If you have sp
+00005b00: 6563 6966 6965 6420 616e 2052 4742 2063  ecified an RGB c
+00005b10: 6f6c 6f72 2c20 7468 6520 616c 7068 6120  olor, the alpha 
+00005b20: 7661 6c75 6520 6465 6661 756c 7473 2074  value defaults t
+00005b30: 6f20 3235 3520 756e 6c65 7373 2073 7065  o 255 unless spe
+00005b40: 6369 6669 6564 206f 7468 6572 7769 7365  cified otherwise
+00005b50: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+00005b60: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 203a     -------.    :
+00005b70: 6f62 6a3a 6072 6762 6160 0a20 2020 2020  obj:`rgba`.     
+00005b80: 2020 203a 6f62 6a3a 606e 616d 6564 7475     :obj:`namedtu
+00005b90: 706c 6560 2077 6974 6820 666f 7572 2069  ple` with four i
+00005ba0: 6e74 6567 6572 732e 0a20 2020 2022 2222  ntegers..    """
+00005bb0: 0a20 2020 2069 6620 616c 6c28 7064 2e69  .    if all(pd.i
+00005bc0: 736e 756c 6c28 7061 7261 6d29 2066 6f72  snull(param) for
+00005bd0: 2070 6172 616d 2069 6e20 5b63 6f6c 6f72   param in [color
+00005be0: 5f6e 616d 652c 2063 6f6c 6f72 5f68 746d  _name, color_htm
+00005bf0: 6c2c 2063 6f6c 6f72 5f72 2c20 636f 6c6f  l, color_r, colo
+00005c00: 725f 672c 2063 6f6c 6f72 5f62 2c20 636f  r_g, color_b, co
+00005c10: 6c6f 725f 615d 293a 0a20 2020 2020 2020  lor_a]):.       
+00005c20: 206c 6f67 6765 722e 6465 6275 6728 6622   logger.debug(f"
+00005c30: 4e6f 6e65 206f 6620 7468 6520 7061 7261  None of the para
+00005c40: 6d65 7465 7273 2068 6176 6520 6265 656e  meters have been
+00005c50: 2073 7065 6369 6669 6564 2e20 5265 7475   specified. Retu
+00005c60: 726e 696e 6720 4e6f 6e65 2e22 290a 2020  rning None.").  
+00005c70: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00005c80: 650a 2020 2020 7265 7320 3d20 4e6f 6e65  e.    res = None
+00005c90: 0a20 2020 2069 6620 6e6f 7420 7064 2e69  .    if not pd.i
+00005ca0: 736e 756c 6c28 636f 6c6f 725f 7229 3a0a  snull(color_r):.
+00005cb0: 2020 2020 2020 2020 6966 2070 642e 6973          if pd.is
+00005cc0: 6e75 6c6c 2863 6f6c 6f72 5f61 293a 0a20  null(color_a):. 
+00005cd0: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+00005ce0: 5f61 203d 2032 3535 0a20 2020 2020 2020  _a = 255.       
+00005cf0: 2069 6620 7064 2e69 736e 756c 6c28 636f   if pd.isnull(co
+00005d00: 6c6f 725f 6729 206f 7220 7064 2e69 736e  lor_g) or pd.isn
+00005d10: 756c 6c28 636f 6c6f 725f 6229 3a0a 2020  ull(color_b):.  
+00005d20: 2020 2020 2020 2020 2020 6966 2070 642e            if pd.
+00005d30: 6973 6e75 6c6c 2863 6f6c 6f72 5f6e 616d  isnull(color_nam
+00005d40: 6529 2061 6e64 2070 642e 6973 6e75 6c6c  e) and pd.isnull
+00005d50: 2863 6f6c 6f72 5f68 746d 6c29 3a0a 2020  (color_html):.  
+00005d60: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00005d70: 6767 6572 2e77 6172 6e69 6e67 2866 224e  gger.warning(f"N
+00005d80: 6f74 2061 2076 616c 6964 2052 4742 2063  ot a valid RGB c
+00005d90: 6f6c 6f72 3a20 7b28 636f 6c6f 725f 722c  olor: {(color_r,
+00005da0: 2063 6f6c 6f72 5f67 2c20 636f 6c6f 725f   color_g, color_
+00005db0: 6229 7d22 290a 2020 2020 2020 2020 656c  b)}").        el
+00005dc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00005dd0: 7265 7320 3d20 2863 6f6c 6f72 5f72 2c20  res = (color_r, 
+00005de0: 636f 6c6f 725f 672c 2063 6f6c 6f72 5f62  color_g, color_b
+00005df0: 2c20 636f 6c6f 725f 6129 0a20 2020 2069  , color_a).    i
+00005e00: 6620 7265 7320 6973 204e 6f6e 6520 616e  f res is None an
+00005e10: 6420 6e6f 7420 7064 2e69 736e 756c 6c28  d not pd.isnull(
+00005e20: 636f 6c6f 725f 6874 6d6c 293a 0a20 2020  color_html):.   
+00005e30: 2020 2020 2072 6573 203d 2063 6f6c 6f72       res = color
+00005e40: 3272 6762 6128 636f 6c6f 725f 6874 6d6c  2rgba(color_html
+00005e50: 290a 2020 2020 6966 2072 6573 2069 7320  ).    if res is 
+00005e60: 4e6f 6e65 2061 6e64 206e 6f74 2070 642e  None and not pd.
+00005e70: 6973 6e75 6c6c 2863 6f6c 6f72 5f6e 616d  isnull(color_nam
+00005e80: 6529 3a0a 2020 2020 2020 2020 7265 7320  e):.        res 
+00005e90: 3d20 636f 6c6f 7232 7267 6261 2863 6f6c  = color2rgba(col
+00005ea0: 6f72 5f6e 616d 6529 0a20 2020 2072 6574  or_name).    ret
+00005eb0: 7572 6e20 7267 6261 282a 7265 7329 0a0a  urn rgba(*res)..
+00005ec0: 0a64 6566 2061 6c6c 6e61 6d65 7365 7175  .def allnamesequ
+00005ed0: 616c 286e 616d 6529 3a0a 2020 2020 7265  al(name):.    re
+00005ee0: 7475 726e 2061 6c6c 286e 203d 3d20 6e61  turn all(n == na
+00005ef0: 6d65 5b30 5d20 666f 7220 6e20 696e 206e  me[0] for n in n
+00005f00: 616d 655b 313a 5d29 0a0a 6465 6620 636f  ame[1:])..def co
+00005f10: 6d6d 6f6e 7072 6566 6978 2870 6174 6873  mmonprefix(paths
+00005f20: 2c20 7365 703d 272f 2729 3a0a 2020 2020  , sep='/'):.    
+00005f30: 2222 2220 5265 7475 726e 7320 636f 6d6d  """ Returns comm
+00005f40: 6f6e 2070 7265 6669 7820 6f66 2061 206c  on prefix of a l
+00005f50: 6973 7420 6f66 2070 6174 6873 2e0a 2020  ist of paths..  
+00005f60: 2020 5573 6573 3a20 616c 6c6e 616d 6573    Uses: allnames
+00005f70: 6571 7561 6c28 292c 2069 7465 7274 6f6f  equal(), itertoo
+00005f80: 6c73 2e74 616b 6577 6869 6c65 2829 2222  ls.takewhile()""
+00005f90: 220a 2020 2020 6279 6469 7265 6374 6f72  ".    bydirector
+00005fa0: 796c 6576 656c 7320 3d20 7a69 7028 2a5b  ylevels = zip(*[
+00005fb0: 702e 7370 6c69 7428 7365 7029 2066 6f72  p.split(sep) for
+00005fc0: 2070 2069 6e20 7061 7468 735d 290a 2020   p in paths]).  
+00005fd0: 2020 7265 7475 726e 2073 6570 2e6a 6f69    return sep.joi
+00005fe0: 6e28 785b 305d 2066 6f72 2078 2069 6e20  n(x[0] for x in 
+00005ff0: 7461 6b65 7768 696c 6528 616c 6c6e 616d  takewhile(allnam
+00006000: 6573 6571 7561 6c2c 2062 7964 6972 6563  esequal, bydirec
+00006010: 746f 7279 6c65 7665 6c73 2929 0a0a 0a64  torylevels))...d
+00006020: 6566 2063 6f6d 7075 7465 5f6d 6e28 6d65  ef compute_mn(me
+00006030: 6173 7572 6573 3a20 7064 2e44 6174 6146  asures: pd.DataF
+00006040: 7261 6d65 2920 2d3e 2070 642e 5365 7269  rame) -> pd.Seri
+00006050: 6573 3a0a 2020 2020 2222 2220 436f 6d70  es:.    """ Comp
+00006060: 7574 6520 6d65 6173 7572 6520 6e75 6d62  ute measure numb
+00006070: 6572 2069 6e74 6567 6572 7320 6672 6f6d  er integers from
+00006080: 2061 206d 6561 7375 7265 7320 7461 626c   a measures tabl
+00006090: 652e 0a0a 0a20 2020 2041 7267 733a 0a20  e....    Args:. 
+000060a0: 2020 2020 206d 6561 7375 7265 733a 204d       measures: M
+000060b0: 6561 7375 7265 7320 7461 626c 6520 7769  easures table wi
+000060c0: 7468 2063 6f6c 756d 6e73 205b 276d 6327  th columns ['mc'
+000060d0: 2c20 2764 6f6e 745f 636f 756e 7427 2c20  , 'dont_count', 
+000060e0: 276e 756d 6265 7269 6e67 5f6f 6666 7365  'numbering_offse
+000060f0: 7427 5d2e 0a0a 2020 2020 5265 7475 726e  t']...    Return
+00006100: 733a 0a0a 2020 2020 2222 220a 2020 2020  s:..    """.    
+00006110: 6578 636c 7564 6564 203d 206d 6561 7375  excluded = measu
+00006120: 7265 735b 2764 6f6e 745f 636f 756e 7427  res['dont_count'
+00006130: 5d2e 6669 6c6c 6e61 2830 292e 6173 7479  ].fillna(0).asty
+00006140: 7065 2862 6f6f 6c29 0a20 2020 206f 6666  pe(bool).    off
+00006150: 7365 7420 3d20 6d65 6173 7572 6573 5b27  set = measures['
+00006160: 6e75 6d62 6572 696e 675f 6f66 6673 6574  numbering_offset
+00006170: 275d 0a20 2020 206d 6e20 3d20 287e 6578  '].    mn = (~ex
+00006180: 636c 7564 6564 292e 6375 6d73 756d 2829  cluded).cumsum()
+00006190: 0a20 2020 2069 6620 6f66 6673 6574 2e6e  .    if offset.n
+000061a0: 6f74 6e61 2829 2e61 6e79 2829 3a0a 2020  otna().any():.  
+000061b0: 2020 2020 2020 6f66 6673 6574 203d 206f        offset = o
+000061c0: 6666 7365 742e 6669 6c6c 6e61 2830 292e  ffset.fillna(0).
+000061d0: 6173 7479 7065 2869 6e74 292e 6375 6d73  astype(int).cums
+000061e0: 756d 2829 0a20 2020 2020 2020 206d 6e20  um().        mn 
+000061f0: 2b3d 206f 6666 7365 740a 2020 2020 7265  += offset.    re
+00006200: 7475 726e 206d 6e2e 7265 6e61 6d65 2827  turn mn.rename('
+00006210: 6d6e 2729 0a0a 4066 756e 6374 696f 6e5f  mn')..@function_
+00006220: 6c6f 6767 6572 0a64 6566 2063 6f6d 7075  logger.def compu
+00006230: 7465 5f6d 6e5f 706c 6179 7468 726f 7567  te_mn_playthroug
+00006240: 6828 6d65 6173 7572 6573 3a20 7064 2e44  h(measures: pd.D
+00006250: 6174 6146 7261 6d65 2920 2d3e 2070 642e  ataFrame) -> pd.
+00006260: 5365 7269 6573 3a0a 2020 2020 2222 2220  Series:.    """ 
+00006270: 436f 6d70 7574 6520 6d65 6173 7572 6520  Compute measure 
+00006280: 6e75 6d62 6572 2073 7472 696e 6773 2066  number strings f
+00006290: 726f 6d20 616e 2075 6e66 6f6c 6465 6420  rom an unfolded 
+000062a0: 6d65 6173 7572 6573 2074 6162 6c65 2c20  measures table, 
+000062b0: 7375 6368 2074 6861 7420 7468 6520 6669  such that the fi
+000062c0: 7273 7420 6f63 6375 7272 656e 6365 206f  rst occurrence o
+000062d0: 6620 6120 6d65 6173 7572 650a 2020 2020  f a measure.    
+000062e0: 6e75 6d62 6572 2065 6e64 7320 6f6e 2027  number ends on '
+000062f0: 6127 2c20 7468 6520 7365 636f 6e64 206f  a', the second o
+00006300: 6e65 206f 6e20 2762 2720 6574 632e 0a0a  ne on 'b' etc...
+00006310: 2020 2020 5468 6520 6675 6e63 7469 6f6e      The function
+00006320: 2072 6571 7569 7265 7320 7468 6520 636f   requires the co
+00006330: 6c75 6d6e 2027 646f 6e74 5f63 6f75 6e74  lumn 'dont_count
+00006340: 2720 696e 206f 7264 6572 2074 6f20 636f  ' in order to co
+00006350: 7272 6563 746c 7920 6e75 6d62 6572 2074  rrectly number t
+00006360: 6865 2072 6574 7572 6e20 6f66 2061 2063  he return of a c
+00006370: 6f6d 706c 6574 696e 6720 4d43 2061 6674  ompleting MC aft
+00006380: 6572 2061 6e0a 2020 2020 696e 636f 6d70  er an.    incomp
+00006390: 6c65 7465 204d 4320 7769 7468 2022 656e  lete MC with "en
+000063a0: 6472 6570 6561 7422 2073 6967 6e2e 2046  drepeat" sign. F
+000063b0: 6f72 2065 7861 6d70 6c65 2c20 6966 2061  or example, if a
+000063c0: 2072 6570 6561 7465 6420 7365 6374 696f   repeated sectio
+000063d0: 6e20 6265 6769 6e73 2077 6974 6820 616e  n begins with an
+000063e0: 2075 7062 6561 7420 7468 6174 2061 7420   upbeat that at 
+000063f0: 6669 7273 740a 2020 2020 636f 6d70 6c65  first.    comple
+00006400: 7465 7320 4d4e 2031 3620 6974 2077 696c  tes MN 16 it wil
+00006410: 6c20 6861 7665 206d 6e5f 706c 6179 7468  l have mn_playth
+00006420: 726f 7567 6820 2731 3661 2720 7468 6520  rough '16a' the 
+00006430: 6669 7273 7420 7469 6d65 2061 6e64 2027  first time and '
+00006440: 3332 6127 2074 6865 2073 6563 6f6e 6420  32a' the second 
+00006450: 7469 6d65 2028 6173 7375 6d69 6e67 2069  time (assuming i
+00006460: 7420 636f 6d70 6c65 7465 730a 2020 2020  t completes.    
+00006470: 7468 6520 696e 636f 6d70 6c65 7465 204d  the incomplete M
+00006480: 4e20 3332 292e 0a0a 2020 2020 4172 6773  N 32)...    Args
+00006490: 3a0a 2020 2020 2020 6d65 6173 7572 6573  :.      measures
+000064a0: 3a20 4d65 6173 7572 6573 2074 6162 6c65  : Measures table
+000064b0: 2077 6974 6820 636f 6c75 6d6e 7320 5b27   with columns ['
+000064c0: 6d63 272c 2027 6d6e 272c 2027 646f 6e74  mc', 'mn', 'dont
+000064d0: 5f63 6f75 6e74 275d 0a0a 2020 2020 5265  _count']..    Re
+000064e0: 7475 726e 733a 0a20 2020 2020 2027 6d6e  turns:.      'mn
+000064f0: 5f70 6c61 7974 6872 6f75 6768 2720 5365  _playthrough' Se
+00006500: 7269 6573 206f 6620 6469 7361 6d62 6967  ries of disambig
+00006510: 7561 7465 6420 6d65 6173 7572 6520 6e75  uated measure nu
+00006520: 6d62 6572 2073 7472 696e 6773 2e20 4966  mber strings. If
+00006530: 206e 6f20 6d65 6173 7572 6520 7265 7065   no measure repe
+00006540: 6174 732c 2074 6865 2072 6573 756c 7420  ats, the result 
+00006550: 7769 6c6c 2062 650a 2020 2020 2020 6571  will be.      eq
+00006560: 7569 7661 6c65 6e74 2074 6f20 636f 6e76  uivalent to conv
+00006570: 6572 7469 6e67 2063 6f6c 756d 6e20 276d  erting column 'm
+00006580: 6e27 2074 6f20 7374 7269 6e67 7320 616e  n' to strings an
+00006590: 6420 6170 7065 6e64 696e 6720 2761 2720  d appending 'a' 
+000065a0: 746f 2061 6c6c 206f 6620 7468 656d 2e0a  to all of them..
+000065b0: 2020 2020 2222 220a 2020 2020 7072 6576      """.    prev
+000065c0: 696f 7573 5f6f 6363 7572 7265 6e63 6573  ious_occurrences
+000065d0: 203d 2064 6566 6175 6c74 6469 6374 286c   = defaultdict(l
+000065e0: 616d 6264 613a 2030 290a 0a20 2020 2064  ambda: 0)..    d
+000065f0: 6566 2067 6574 5f6d 6e5f 706c 6179 7468  ef get_mn_playth
+00006600: 726f 7567 6828 6d6e 293a 0a20 2020 2020  rough(mn):.     
+00006610: 2020 2072 6570 6561 745f 6368 6172 203d     repeat_char =
+00006620: 2063 6872 2870 7265 7669 6f75 735f 6f63   chr(previous_oc
+00006630: 6375 7272 656e 6365 735b 6d6e 5d20 2b20  currences[mn] + 
+00006640: 3936 290a 2020 2020 2020 2020 7265 7475  96).        retu
+00006650: 726e 2066 227b 6d6e 7d7b 7265 7065 6174  rn f"{mn}{repeat
+00006660: 5f63 6861 727d 220a 0a20 2020 206d 6e5f  _char}"..    mn_
+00006670: 706c 6179 7468 726f 7567 685f 636f 6c75  playthrough_colu
+00006680: 6d6e 203d 205b 5d0a 2020 2020 7072 6576  mn = [].    prev
+00006690: 696f 7573 5f6d 632c 2070 7265 7669 6f75  ious_mc, previou
+000066a0: 735f 6d6e 203d 2030 2c20 2d31 0a20 2020  s_mn = 0, -1.   
+000066b0: 2066 6f72 206d 632c 206d 6e2c 2064 6f6e   for mc, mn, don
+000066c0: 745f 636f 756e 7420 696e 206d 6561 7375  t_count in measu
+000066d0: 7265 735b 5b27 6d63 272c 2027 6d6e 272c  res[['mc', 'mn',
+000066e0: 2027 646f 6e74 5f63 6f75 6e74 275d 5d2e   'dont_count']].
+000066f0: 6974 6572 7475 706c 6573 286e 616d 653d  itertuples(name=
+00006700: 4e6f 6e65 2c20 696e 6465 783d 4661 6c73  None, index=Fals
+00006710: 6529 3a0a 2020 2020 2020 2020 6966 206d  e):.        if m
+00006720: 6e20 213d 2070 7265 7669 6f75 735f 6d6e  n != previous_mn
+00006730: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00006740: 6576 696f 7573 5f6f 6363 7572 7265 6e63  evious_occurrenc
+00006750: 6573 5b6d 6e5d 202b 3d20 310a 2020 2020  es[mn] += 1.    
+00006760: 2020 2020 6966 206d 6320 3c20 7072 6576      if mc < prev
+00006770: 696f 7573 5f6d 6320 616e 6420 6e6f 7420  ious_mc and not 
+00006780: 7064 2e69 736e 756c 6c28 646f 6e74 5f63  pd.isnull(dont_c
+00006790: 6f75 6e74 293a 0a20 2020 2020 2020 2020  ount):.         
+000067a0: 2020 2023 2061 6e20 6561 726c 6965 7220     # an earlier 
+000067b0: 4d43 2063 6f6d 706c 6574 6573 2061 206c  MC completes a l
+000067c0: 6174 6572 206f 6e65 2061 6674 6572 2061  ater one after a
+000067d0: 2072 6570 6561 740a 2020 2020 2020 2020   repeat.        
+000067e0: 2020 2020 6d6e 5f70 6c61 7974 6872 6f75      mn_playthrou
+000067f0: 6768 203d 2067 6574 5f6d 6e5f 706c 6179  gh = get_mn_play
+00006800: 7468 726f 7567 6828 7072 6576 696f 7573  through(previous
+00006810: 5f6d 6e29 0a20 2020 2020 2020 2020 2020  _mn).           
+00006820: 206c 6f67 6765 722e 6465 6275 6728 6622   logger.debug(f"
+00006830: 4d4e 207b 6d6e 7d20 3c20 7072 6576 696f  MN {mn} < previo
+00006840: 7573 204d 4e20 7b70 7265 7669 6f75 735f  us MN {previous_
+00006850: 6d6e 7d3b 2062 7574 2073 696e 6365 204d  mn}; but since M
+00006860: 4320 7b6d 637d 2069 7320 6578 636c 7564  C {mc} is exclud
+00006870: 6564 2066 726f 6d20 6261 7263 6f75 6e74  ed from barcount
+00006880: 2c20 220a 2020 2020 2020 2020 2020 2020  , ".            
+00006890: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
+000068a0: 6865 2072 6570 6574 6974 696f 6e20 6861  he repetition ha
+000068b0: 7320 6d6e 5f70 6c61 7974 6872 6f75 6768  s mn_playthrough
+000068c0: 207b 6d6e 5f70 6c61 7974 6872 6f75 6768   {mn_playthrough
+000068d0: 7d2e 2229 0a20 2020 2020 2020 2065 6c73  }.").        els
+000068e0: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+000068f0: 6e5f 706c 6179 7468 726f 7567 6820 3d20  n_playthrough = 
+00006900: 6765 745f 6d6e 5f70 6c61 7974 6872 6f75  get_mn_playthrou
+00006910: 6768 286d 6e29 0a20 2020 2020 2020 206d  gh(mn).        m
+00006920: 6e5f 706c 6179 7468 726f 7567 685f 636f  n_playthrough_co
+00006930: 6c75 6d6e 2e61 7070 656e 6428 6d6e 5f70  lumn.append(mn_p
+00006940: 6c61 7974 6872 6f75 6768 290a 2020 2020  laythrough).    
+00006950: 2020 2020 7072 6576 696f 7573 5f6d 6e20      previous_mn 
+00006960: 3d20 6d6e 0a20 2020 2020 2020 2070 7265  = mn.        pre
+00006970: 7669 6f75 735f 6d63 203d 206d 630a 2020  vious_mc = mc.  
+00006980: 2020 7265 7475 726e 2070 642e 5365 7269    return pd.Seri
+00006990: 6573 286d 6e5f 706c 6179 7468 726f 7567  es(mn_playthroug
+000069a0: 685f 636f 6c75 6d6e 2c20 696e 6465 783d  h_column, index=
+000069b0: 6d65 6173 7572 6573 2e69 6e64 6578 2c20  measures.index, 
+000069c0: 6e61 6d65 3d27 6d6e 5f70 6c61 7974 6872  name='mn_playthr
+000069d0: 6f75 6768 2729 0a0a 406c 7275 5f63 6163  ough')..@lru_cac
+000069e0: 6865 2829 0a64 6566 2067 6574 5f6d 616a  he().def get_maj
+000069f0: 6f72 5f76 6572 7369 6f6e 5f6f 665f 6d75  or_version_of_mu
+00006a00: 7365 7363 6f72 655f 6578 6563 7574 6162  sescore_executab
+00006a10: 6c65 286d 7329 202d 3e20 4f70 7469 6f6e  le(ms) -> Option
+00006a20: 616c 5b69 6e74 5d3a 0a20 2020 2074 7279  al[int]:.    try
+00006a30: 3a0a 2020 2020 2020 2020 7265 7375 6c74  :.        result
+00006a40: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
+00006a50: 6e28 5b6d 732c 2022 2d76 225d 2c20 6361  n([ms, "-v"], ca
+00006a60: 7074 7572 655f 6f75 7470 7574 3d54 7275  pture_output=Tru
+00006a70: 652c 2074 6578 743d 5472 7565 290a 2020  e, text=True).  
+00006a80: 2020 2020 2020 7665 7273 696f 6e20 3d20        version = 
+00006a90: 7265 7375 6c74 2e73 7464 6f75 740a 2020  result.stdout.  
+00006aa0: 2020 2020 2020 6966 2076 6572 7369 6f6e        if version
+00006ab0: 2e73 7461 7274 7377 6974 6828 274d 7573  .startswith('Mus
+00006ac0: 6553 636f 7265 2729 3a0a 2020 2020 2020  eScore'):.      
+00006ad0: 2020 2020 2020 7265 7475 726e 2069 6e74        return int
+00006ae0: 2876 6572 7369 6f6e 5b39 5d29 0a20 2020  (version[9]).   
+00006af0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00006b00: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00006b10: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00006b20: 0a0a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  ...@function_log
+00006b30: 6765 720a 6465 6620 636f 6e76 6572 7428  ger.def convert(
+00006b40: 6f6c 642c 206e 6577 2c20 4d53 3d27 6d73  old, new, MS='ms
+00006b50: 636f 7265 2729 3a0a 2020 2020 7665 7273  core'):.    vers
+00006b60: 696f 6e20 3d20 6765 745f 6d61 6a6f 725f  ion = get_major_
+00006b70: 7665 7273 696f 6e5f 6f66 5f6d 7573 6573  version_of_muses
+00006b80: 636f 7265 5f65 7865 6375 7461 626c 6528  core_executable(
+00006b90: 4d53 290a 2020 2020 6966 2076 6572 7369  MS).    if versi
+00006ba0: 6f6e 203d 3d20 343a 0a20 2020 2020 2020  on == 4:.       
+00006bb0: 2063 6f6e 7665 7274 5f74 6f5f 6d73 3428   convert_to_ms4(
+00006bc0: 6f6c 643d 6f6c 642c 206e 6577 3d6e 6577  old=old, new=new
+00006bd0: 2c20 4d53 3d4d 532c 206c 6f67 6765 723d  , MS=MS, logger=
+00006be0: 6c6f 6767 6572 290a 2020 2020 2020 2020  logger).        
+00006bf0: 7265 7475 726e 0a20 2020 2070 726f 6365  return.    proce
+00006c00: 7373 203d 205b 4d53 2c20 222d 666f 222c  ss = [MS, "-fo",
+00006c10: 206e 6577 2c20 6f6c 645d 2023 5b4d 532c   new, old] #[MS,
+00006c20: 2027 2d2d 6170 7069 6d61 6765 2d65 7874   '--appimage-ext
+00006c30: 7261 6374 2d61 6e64 2d72 756e 272c 2022  ract-and-run', "
+00006c40: 2d66 6f22 2c20 6e65 772c 206f 6c64 5d20  -fo", new, old] 
+00006c50: 6966 204d 532e 656e 6473 7769 7468 2827  if MS.endswith('
+00006c60: 2e41 7070 496d 6167 6527 2920 656c 7365  .AppImage') else
+00006c70: 205b 4d53 2c20 222d 666f 222c 206e 6577   [MS, "-fo", new
+00006c80: 2c20 6f6c 645d 0a20 2020 2069 6620 7375  , old].    if su
+00006c90: 6270 726f 6365 7373 2e72 756e 2870 726f  bprocess.run(pro
+00006ca0: 6365 7373 2c20 6361 7074 7572 655f 6f75  cess, capture_ou
+00006cb0: 7470 7574 3d54 7275 652c 2074 6578 743d  tput=True, text=
+00006cc0: 5472 7565 293a 0a20 2020 2020 2020 206c  True):.        l
+00006cd0: 6f67 6765 722e 696e 666f 2866 2243 6f6e  ogger.info(f"Con
+00006ce0: 7665 7274 6564 207b 6f6c 647d 2074 6f20  verted {old} to 
+00006cf0: 7b6e 6577 7d22 290a 2020 2020 656c 7365  {new}").    else
+00006d00: 3a0a 2020 2020 2020 2020 6c6f 6767 6572  :.        logger
+00006d10: 2e77 6172 6e69 6e67 2822 4572 726f 7220  .warning("Error 
+00006d20: 7768 696c 6520 636f 6e76 6572 7469 6e67  while converting
+00006d30: 2022 202b 206f 6c64 290a 0a40 6675 6e63   " + old)..@func
+00006d40: 7469 6f6e 5f6c 6f67 6765 720a 6465 6620  tion_logger.def 
+00006d50: 636f 6e76 6572 745f 746f 5f6d 7334 286f  convert_to_ms4(o
+00006d60: 6c64 2c20 6e65 772c 204d 533d 276d 7363  ld, new, MS='msc
+00006d70: 6f72 6527 293a 0a20 2020 2076 6572 7369  ore'):.    versi
+00006d80: 6f6e 203d 2067 6574 5f6d 616a 6f72 5f76  on = get_major_v
+00006d90: 6572 7369 6f6e 5f6f 665f 6d75 7365 7363  ersion_of_musesc
+00006da0: 6f72 655f 6578 6563 7574 6162 6c65 284d  ore_executable(M
+00006db0: 5329 0a20 2020 2069 6620 6e6f 7420 2876  S).    if not (v
+00006dc0: 6572 7369 6f6e 2069 7320 4e6f 6e65 206f  ersion is None o
+00006dd0: 7220 7665 7273 696f 6e20 3d3d 2034 293a  r version == 4):
+00006de0: 0a20 2020 2020 2020 2069 6620 7665 7273  .        if vers
+00006df0: 696f 6e20 6973 204e 6f6e 653a 0a20 2020  ion is None:.   
+00006e00: 2020 2020 2020 2020 206d 7367 203d 2066           msg = f
+00006e10: 227b 4d53 7d20 6973 206e 6f74 204d 7573  "{MS} is not Mus
+00006e20: 6553 636f 7265 2034 2e78 2e78 2e22 0a20  eScore 4.x.x.". 
+00006e30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00006e40: 2020 2020 2020 2020 206d 7367 203d 2066           msg = f
+00006e50: 227b 4d53 7d20 6973 204d 7573 6553 636f  "{MS} is MuseSco
+00006e60: 7265 207b 7665 7273 696f 6e7d 2c20 6e6f  re {version}, no
+00006e70: 7420 342e 2054 7279 2063 6f6e 7665 7274  t 4. Try convert
+00006e80: 2829 2e22 0a20 2020 2020 2020 2072 6169  ().".        rai
+00006e90: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
+00006ea0: 6d73 6729 0a20 2020 206f 6c64 5f70 6174  msg).    old_pat
+00006eb0: 682c 206f 6c64 5f66 696c 6520 3d20 6f73  h, old_file = os
+00006ec0: 2e70 6174 682e 7370 6c69 7428 6f6c 6429  .path.split(old)
+00006ed0: 0a20 2020 206f 6c64 5f66 6e61 6d65 2c20  .    old_fname, 
+00006ee0: 6f6c 645f 6578 7420 3d20 6f73 2e70 6174  old_ext = os.pat
+00006ef0: 682e 7370 6c69 7465 7874 286f 6c64 5f66  h.splitext(old_f
+00006f00: 696c 6529 0a20 2020 2069 6620 6f6c 645f  ile).    if old_
+00006f10: 6578 742e 6c6f 7765 7228 2920 6e6f 7420  ext.lower() not 
+00006f20: 696e 2053 434f 5245 5f45 5854 454e 5349  in SCORE_EXTENSI
+00006f30: 4f4e 533a 0a20 2020 2020 2020 206c 6f67  ONS:.        log
+00006f40: 6765 722e 7761 726e 696e 6728 6622 536f  ger.warning(f"So
+00006f50: 7572 6365 2066 696c 6520 277b 6f6c 647d  urce file '{old}
+00006f60: 2720 646f 6573 6e27 7420 6861 7665 206f  ' doesn't have o
+00006f70: 6e65 206f 6620 7468 6520 666f 6c6c 6f77  ne of the follow
+00006f80: 696e 6720 6578 7465 6e73 696f 6e73 2061  ing extensions a
+00006f90: 6e64 2069 7320 736b 6970 7065 643a 207b  nd is skipped: {
+00006fa0: 5343 4f52 455f 4558 5445 4e53 494f 4e53  SCORE_EXTENSIONS
+00006fb0: 7d2e 2229 0a20 2020 2020 2020 2072 6574  }.").        ret
+00006fc0: 7572 6e0a 2020 2020 6966 206f 732e 7061  urn.    if os.pa
+00006fd0: 7468 2e69 7364 6972 286e 6577 293a 0a20  th.isdir(new):. 
+00006fe0: 2020 2020 2020 2074 6172 6765 745f 666f         target_fo
+00006ff0: 6c64 6572 203d 206e 6577 0a20 2020 2020  lder = new.     
+00007000: 2020 2074 6172 6765 745f 6669 6c65 203d     target_file =
+00007010: 206f 6c64 5f66 696c 650a 2020 2020 656c   old_file.    el
+00007020: 7365 3a0a 2020 2020 2020 2020 7461 7267  se:.        targ
+00007030: 6574 5f66 6f6c 6465 722c 2074 6172 6765  et_folder, targe
+00007040: 745f 6669 6c65 203d 206f 732e 7061 7468  t_file = os.path
+00007050: 2e73 706c 6974 286e 6577 290a 2020 2020  .split(new).    
+00007060: 7461 7267 6574 5f66 6e61 6d65 2c20 7461  target_fname, ta
+00007070: 7267 6574 5f65 7874 203d 206f 732e 7061  rget_ext = os.pa
+00007080: 7468 2e73 706c 6974 6578 7428 7461 7267  th.splitext(targ
+00007090: 6574 5f66 696c 6529 0a20 2020 2074 6d70  et_file).    tmp
+000070a0: 5f6e 6565 6465 6420 3d20 7461 7267 6574  _needed = target
+000070b0: 5f65 7874 2069 6e20 2827 2e6d 7363 7827  _ext in ('.mscx'
+000070c0: 2c20 272e 6d73 637a 2729 0a20 2020 2069  , '.mscz').    i
+000070d0: 6620 746d 705f 6e65 6564 6564 3a0a 2020  f tmp_needed:.  
+000070e0: 2020 2020 2020 746d 705f 6469 7220 3d20        tmp_dir = 
+000070f0: 6f73 2e70 6174 682e 6a6f 696e 2874 6172  os.path.join(tar
+00007100: 6765 745f 666f 6c64 6572 2c20 272e 6d73  get_folder, '.ms
+00007110: 335f 746d 705f 2720 2b20 6f6c 645f 6669  3_tmp_' + old_fi
+00007120: 6c65 290a 2020 2020 2020 2020 7472 793a  le).        try:
+00007130: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+00007140: 6d61 6b65 6469 7273 2874 6d70 5f64 6972  makedirs(tmp_dir
+00007150: 2c20 6578 6973 745f 6f6b 3d46 616c 7365  , exist_ok=False
+00007160: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00007170: 2046 696c 6545 7869 7374 7345 7272 6f72   FileExistsError
+00007180: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00007190: 6767 6572 2e77 6172 6e69 6e67 2866 2254  gger.warning(f"T
+000071a0: 6865 2074 656d 706f 7261 7279 2064 6972  he temporary dir
+000071b0: 6563 746f 7279 207b 746d 705f 6469 727d  ectory {tmp_dir}
+000071c0: 2065 7869 7374 7320 616c 7265 6164 7920   exists already 
+000071d0: 616e 6420 776f 756c 6420 6265 206f 7665  and would be ove
+000071e0: 7277 7269 7474 656e 2e20 4465 6c65 7465  rwritten. Delete
+000071f0: 2069 7420 6669 7273 742e 2229 0a20 2020   it first.").   
+00007200: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00007210: 2020 2020 2020 2020 746d 705f 6d73 6378          tmp_mscx
+00007220: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+00007230: 746d 705f 6469 722c 2074 6172 6765 745f  tmp_dir, target_
+00007240: 666e 616d 6520 2b20 272e 6d73 6378 2729  fname + '.mscx')
+00007250: 0a20 2020 2020 2020 206e 6577 203d 2074  .        new = t
+00007260: 6d70 5f6d 7363 780a 2020 2020 7072 6f63  mp_mscx.    proc
+00007270: 6573 7320 3d20 5b4d 532c 2022 2d66 6f22  ess = [MS, "-fo"
+00007280: 2c20 6e65 772c 206f 6c64 5d0a 2020 2020  , new, old].    
+00007290: 7265 7375 6c74 203d 2073 7562 7072 6f63  result = subproc
+000072a0: 6573 732e 7275 6e28 7072 6f63 6573 732c  ess.run(process,
+000072b0: 2063 6170 7475 7265 5f6f 7574 7075 743d   capture_output=
+000072c0: 5472 7565 2c20 7465 7874 3d54 7275 6529  True, text=True)
+000072d0: 0a20 2020 2069 6620 7265 7375 6c74 2e72  .    if result.r
+000072e0: 6574 7572 6e63 6f64 6520 3d3d 2030 3a0a  eturncode == 0:.
+000072f0: 2020 2020 2020 2020 6966 2074 6d70 5f6e          if tmp_n
+00007300: 6565 6465 643a 0a20 2020 2020 2020 2020  eeded:.         
+00007310: 2020 2074 6172 6765 745f 7061 7468 5f77     target_path_w
+00007320: 6974 686f 7574 5f65 7874 656e 7369 6f6e  ithout_extension
+00007330: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+00007340: 7461 7267 6574 5f66 6f6c 6465 722c 2074  target_folder, t
+00007350: 6172 6765 745f 666e 616d 6529 0a20 2020  arget_fname).   
+00007360: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00007370: 6f73 2e70 6174 682e 6973 6469 7228 746d  os.path.isdir(tm
+00007380: 705f 6469 7229 3a0a 2020 2020 2020 2020  p_dir):.        
+00007390: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+000073a0: 6172 6e69 6e67 2866 2254 656d 706f 7261  arning(f"Tempora
+000073b0: 7279 2064 6972 6563 746f 7279 2027 7b74  ry directory '{t
+000073c0: 6d70 5f64 6972 7d27 2064 6964 206e 6f74  mp_dir}' did not
+000073d0: 2065 7869 7374 2061 6674 6572 2063 6f6e   exist after con
+000073e0: 7665 7273 696f 6e2e 2229 0a20 2020 2020  version.").     
+000073f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00007400: 6e0a 2020 2020 2020 2020 2020 2020 6966  n.            if
+00007410: 206e 6f74 206f 732e 7061 7468 2e69 7366   not os.path.isf
+00007420: 696c 6528 746d 705f 6d73 6378 293a 0a20  ile(tmp_mscx):. 
+00007430: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00007440: 6f67 6765 722e 7761 726e 696e 6728 6622  ogger.warning(f"
+00007450: 436f 6e76 6572 7369 6f6e 206f 6620 277b  Conversion of '{
+00007460: 6f6c 647d 2720 6469 6420 6e6f 7420 7969  old}' did not yi
+00007470: 656c 6420 6120 636f 6d70 6c65 7465 2075  eld a complete u
+00007480: 6e63 6f6d 7072 6573 7365 6420 4d75 7365  ncompressed Muse
+00007490: 5363 6f72 6520 666f 6c64 6572 2c20 616e  Score folder, an
+000074a0: 202e 6d73 6378 2066 696c 6520 7761 7320   .mscx file was 
+000074b0: 6d69 7373 696e 672e 2229 0a20 2020 2020  missing.").     
+000074c0: 2020 2020 2020 2020 2020 2073 6875 7469             shuti
+000074d0: 6c2e 726d 7472 6565 2874 6d70 5f64 6972  l.rmtree(tmp_dir
+000074e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000074f0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+00007500: 2020 2020 2069 6620 7461 7267 6574 5f65       if target_e
+00007510: 7874 203d 3d20 272e 6d73 637a 273a 0a20  xt == '.mscz':. 
+00007520: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+00007530: 6970 5f66 696c 655f 7061 7468 203d 2073  ip_file_path = s
+00007540: 6875 7469 6c2e 6d61 6b65 5f61 7263 6869  hutil.make_archi
+00007550: 7665 2874 6172 6765 745f 7061 7468 5f77  ve(target_path_w
+00007560: 6974 686f 7574 5f65 7874 656e 7369 6f6e  ithout_extension
+00007570: 2c20 277a 6970 272c 2074 6d70 5f64 6972  , 'zip', tmp_dir
+00007580: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00007590: 2020 6e65 7720 3d20 7461 7267 6574 5f70    new = target_p
+000075a0: 6174 685f 7769 7468 6f75 745f 6578 7465  ath_without_exte
+000075b0: 6e73 696f 6e20 2b20 272e 6d73 637a 270a  nsion + '.mscz'.
+000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075d0: 7368 7574 696c 2e6d 6f76 6528 7a69 705f  shutil.move(zip_
+000075e0: 6669 6c65 5f70 6174 682c 206e 6577 290a  file_path, new).
+000075f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00007600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007610: 2020 6e65 7720 3d20 7461 7267 6574 5f70    new = target_p
+00007620: 6174 685f 7769 7468 6f75 745f 6578 7465  ath_without_exte
+00007630: 6e73 696f 6e20 2b20 272e 6d73 6378 270a  nsion + '.mscx'.
+00007640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007650: 7368 7574 696c 2e6d 6f76 6528 746d 705f  shutil.move(tmp_
+00007660: 6d73 6378 2c20 6e65 7729 0a20 2020 2020  mscx, new).     
+00007670: 2020 2020 2020 2073 6875 7469 6c2e 726d         shutil.rm
+00007680: 7472 6565 2874 6d70 5f64 6972 290a 2020  tree(tmp_dir).  
+00007690: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+000076a0: 6f28 6622 5375 6363 6573 7366 756c 6c79  o(f"Successfully
+000076b0: 2063 6f6e 7665 7274 6564 207b 6f6c 647d   converted {old}
+000076c0: 203d 3e20 7b6e 6577 7d22 290a 2020 2020   => {new}").    
+000076d0: 656c 7365 3a0a 2020 2020 2020 2020 6c6f  else:.        lo
+000076e0: 6767 6572 2e65 7272 6f72 2866 2243 6f6e  gger.error(f"Con
+000076f0: 7665 7273 696f 6e20 746f 204d 7573 6553  version to MuseS
+00007700: 636f 7265 2034 2066 6169 6c65 643a 5c6e  core 4 failed:\n
+00007710: 7b72 6573 756c 742e 7374 6465 7272 7d22  {result.stderr}"
+00007720: 290a 2020 2020 2020 2020 6966 2074 6d70  ).        if tmp
+00007730: 5f6e 6565 6465 6420 616e 6420 6f73 2e70  _needed and os.p
+00007740: 6174 682e 6973 6469 7228 746d 705f 6469  ath.isdir(tmp_di
+00007750: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00007760: 7368 7574 696c 2e72 6d74 7265 6528 746d  shutil.rmtree(tm
+00007770: 705f 6469 7229 0a0a 0a0a 0a0a 0a0a 6465  p_dir)........de
+00007780: 6620 5f63 6f6e 7665 7274 5f6b 7761 7267  f _convert_kwarg
+00007790: 7328 6b77 6172 6773 293a 0a20 2020 2022  s(kwargs):.    "
+000077a0: 2222 4175 7869 6c69 6172 7920 6675 6e63  ""Auxiliary func
+000077b0: 7469 6f6e 2061 6c6c 6f77 696e 6720 746f  tion allowing to
+000077c0: 2075 7365 2050 6f6f 6c2e 7374 6172 6d61   use Pool.starma
+000077d0: 7028 2920 7769 7468 206b 6579 776f 7264  p() with keyword
+000077e0: 2061 7267 756d 656e 7473 2028 6e65 6564   arguments (need
+000077f0: 6564 2069 6e20 6f72 6465 7220 746f 0a20  ed in order to. 
+00007800: 2020 2070 6173 7320 7468 6520 6c6f 6767     pass the logg
+00007810: 6572 2061 7267 756d 656e 7420 7768 6963  er argument whic
+00007820: 6820 6973 206e 6f74 2070 6172 7420 6f66  h is not part of
+00007830: 2074 6865 2073 6967 6e61 7475 7265 206f   the signature o
+00007840: 6620 636f 6e76 6572 7428 2920 292e 2222  f convert() ).""
+00007850: 220a 2020 2020 7265 7475 726e 2063 6f6e  ".    return con
+00007860: 7665 7274 282a 2a6b 7761 7267 7329 0a0a  vert(**kwargs)..
+00007870: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
+00007880: 0a64 6566 2063 6f6e 7665 7274 5f66 6f6c  .def convert_fol
+00007890: 6465 7228 6469 7265 6374 6f72 793d 4e6f  der(directory=No
+000078a0: 6e65 2c20 6669 6c65 5f70 6174 6873 3d4e  ne, file_paths=N
+000078b0: 6f6e 652c 2074 6172 6765 745f 6469 723d  one, target_dir=
+000078c0: 4e6f 6e65 2c20 6578 7465 6e73 696f 6e73  None, extensions
+000078d0: 3d5b 5d2c 2074 6172 6765 745f 6578 7465  =[], target_exte
+000078e0: 6e73 696f 6e3d 276d 7363 7827 2c20 7265  nsion='mscx', re
+000078f0: 6765 783d 272e 2a27 2c20 7375 6666 6978  gex='.*', suffix
+00007900: 3d4e 6f6e 652c 2072 6563 7572 7369 7665  =None, recursive
+00007910: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+00007920: 2020 2020 2020 2020 2020 6d73 3d27 6d73            ms='ms
+00007930: 636f 7265 272c 206f 7665 7277 7269 7465  core', overwrite
+00007940: 3d46 616c 7365 2c20 7061 7261 6c6c 656c  =False, parallel
+00007950: 3d46 616c 7365 293a 0a20 2020 2022 2222  =False):.    """
+00007960: 2043 6f6e 7665 7274 2061 6c6c 2066 696c   Convert all fil
+00007970: 6573 2069 6e20 6064 6972 6020 7468 6174  es in `dir` that
+00007980: 2068 6176 6520 6f6e 6520 6f66 2074 6865   have one of the
+00007990: 2060 6578 7465 6e73 696f 6e73 6020 746f   `extensions` to
+000079a0: 202e 6d73 6378 2066 6f72 6d61 7420 7573   .mscx format us
+000079b0: 696e 6720 7468 6520 6578 6563 7574 6162  ing the executab
+000079c0: 6c65 2060 4d53 602e 0a0a 2020 2020 5061  le `MS`...    Pa
+000079d0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+000079e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6469 7265  -------.    dire
+000079f0: 6374 6f72 7920 3a20 3a6f 626a 3a60 7374  ctory : :obj:`st
+00007a00: 7260 0a20 2020 2020 2020 2044 6972 6563  r`.        Direc
+00007a10: 746f 7279 2069 6e20 7768 6963 6820 746f  tory in which to
+00007a20: 206c 6f6f 6b20 666f 7220 6669 6c65 7320   look for files 
+00007a30: 746f 2063 6f6e 7665 7274 2e0a 2020 2020  to convert..    
+00007a40: 6669 6c65 5f70 6174 6873 203a 203a 6f62  file_paths : :ob
+00007a50: 6a3a 606c 6973 7460 206f 6620 6064 6972  j:`list` of `dir
+00007a60: 600a 2020 2020 2020 2020 4c69 7374 206f  `.        List o
+00007a70: 6620 6669 6c65 2070 6174 6873 2074 6f20  f file paths to 
+00007a80: 636f 6e76 6572 742e 2054 6865 7365 2061  convert. These a
+00007a90: 7265 206e 6f74 2066 696c 7465 7265 6420  re not filtered 
+00007aa0: 6279 2061 6e79 206d 6561 6e73 2e0a 2020  by any means..  
+00007ab0: 2020 7461 7267 6574 5f64 6972 203a 203a    target_dir : :
+00007ac0: 6f62 6a3a 6073 7472 600a 2020 2020 2020  obj:`str`.      
+00007ad0: 2020 4469 7265 6374 6f72 7920 7768 6572    Directory wher
+00007ae0: 6520 746f 2073 746f 7265 2063 6f6e 7665  e to store conve
+00007af0: 7274 6564 2066 696c 6573 2e20 4465 6661  rted files. Defa
+00007b00: 756c 7473 2074 6f20 6060 6469 7265 6374  ults to ``direct
+00007b10: 6f72 7960 600a 2020 2020 6578 7465 6e73  ory``.    extens
+00007b20: 696f 6e73 203a 206c 6973 742c 206f 7074  ions : list, opt
+00007b30: 696f 6e61 6c0a 2020 2020 2020 2020 4966  ional.        If
+00007b40: 2079 6f75 2077 616e 7420 746f 2063 6f6e   you want to con
+00007b50: 7665 7274 206f 6e6c 7920 6365 7274 6169  vert only certai
+00007b60: 6e20 666f 726d 6174 732c 2067 6976 6520  n formats, give 
+00007b70: 7468 6f73 652c 2065 2e67 2e20 5b27 6d73  those, e.g. ['ms
+00007b80: 637a 272c 2027 786d 6c27 5d0a 2020 2020  cz', 'xml'].    
+00007b90: 7265 6375 7273 6976 6520 3a20 626f 6f6c  recursive : bool
+00007ba0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00007bb0: 2020 2053 7562 6469 7265 6374 6f72 6965     Subdirectorie
+00007bc0: 7320 6173 2077 656c 6c2e 0a20 2020 204d  s as well..    M
+00007bd0: 5320 3a20 7374 722c 206f 7074 696f 6e61  S : str, optiona
+00007be0: 6c0a 2020 2020 2020 2020 4769 7665 2074  l.        Give t
+00007bf0: 6865 2070 6174 6820 746f 2074 6865 204d  he path to the M
+00007c00: 7573 6553 636f 7265 2065 7865 6375 7461  useScore executa
+00007c10: 626c 6520 6f6e 2079 6f75 7220 7379 7374  ble on your syst
+00007c20: 656d 2e20 4e65 6564 206f 6e6c 7920 6966  em. Need only if
+00007c30: 0a20 2020 2020 2020 2074 6865 2063 6f6d  .        the com
+00007c40: 6d61 6e64 2027 6d73 636f 7265 2720 646f  mand 'mscore' do
+00007c50: 6573 206e 6f74 2065 7865 6375 7465 204d  es not execute M
+00007c60: 7573 6553 636f 7265 206f 6e20 796f 7572  useScore on your
+00007c70: 2073 7973 7465 6d2e 0a20 2020 2022 2222   system..    """
+00007c80: 0a20 2020 204d 5320 3d20 6765 745f 6d75  .    MS = get_mu
+00007c90: 7365 7363 6f72 6528 6d73 2c20 6c6f 6767  sescore(ms, logg
+00007ca0: 6572 3d6c 6f67 6765 7229 0a20 2020 2061  er=logger).    a
+00007cb0: 7373 6572 7420 4d53 2069 7320 6e6f 7420  ssert MS is not 
+00007cc0: 4e6f 6e65 2c20 6622 4d75 7365 5363 6f72  None, f"MuseScor
+00007cd0: 6520 6e6f 7420 666f 756e 643a 207b 6d73  e not found: {ms
+00007ce0: 7d22 0a20 2020 2061 7373 6572 7420 616e  }".    assert an
+00007cf0: 7928 6172 6720 6973 206e 6f74 204e 6f6e  y(arg is not Non
+00007d00: 6520 666f 7220 6172 6720 696e 2028 6469  e for arg in (di
+00007d10: 7265 6374 6f72 792c 2066 696c 655f 7061  rectory, file_pa
+00007d20: 7468 7329 292c 2022 5061 7373 2061 7420  ths)), "Pass at 
+00007d30: 6c65 6173 7420 6120 6469 7265 6374 6f72  least a director
+00007d40: 7920 6f72 206f 6e65 2070 6174 682e 220a  y or one path.".
+00007d50: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00007d60: 6528 6669 6c65 5f70 6174 6873 2c20 7374  e(file_paths, st
+00007d70: 7229 3a0a 2020 2020 2020 2020 6669 6c65  r):.        file
+00007d80: 5f70 6174 6873 203d 205b 6669 6c65 5f70  _paths = [file_p
+00007d90: 6174 6873 5d0a 2020 2020 6966 2074 6172  aths].    if tar
+00007da0: 6765 745f 6578 7465 6e73 696f 6e5b 305d  get_extension[0]
+00007db0: 203d 3d20 272e 273a 0a20 2020 2020 2020   == '.':.       
+00007dc0: 2074 6172 6765 745f 6578 7465 6e73 696f   target_extensio
+00007dd0: 6e20 3d20 7461 7267 6574 5f65 7874 656e  n = target_exten
+00007de0: 7369 6f6e 5b31 3a5d 0a20 2020 2063 6f6e  sion[1:].    con
+00007df0: 7665 7273 696f 6e5f 7061 7261 6d73 203d  version_params =
+00007e00: 205b 5d0a 2020 2020 236c 6f67 6765 722e   [].    #logger.
+00007e10: 696e 666f 2866 2254 7261 7665 7273 696e  info(f"Traversin
+00007e20: 6720 7b64 6972 7d20 7b27 2720 6966 2072  g {dir} {'' if r
+00007e30: 6563 7572 7369 7665 2065 6c73 6520 276e  ecursive else 'n
+00007e40: 6f6e 2d27 7d72 6563 7572 7369 7665 6c79  on-'}recursively
+00007e50: 2e2e 2e22 290a 2020 2020 6966 206c 656e  ...").    if len
+00007e60: 2865 7874 656e 7369 6f6e 7329 203e 2030  (extensions) > 0
+00007e70: 3a0a 2020 2020 2020 2020 6578 636c 7564  :.        exclud
+00007e80: 655f 7265 203d 2066 225e 283f 3a28 3f21  e_re = f"^(?:(?!
+00007e90: 287b 277c 272e 6a6f 696e 2865 7874 656e  ({'|'.join(exten
+00007ea0: 7369 6f6e 7329 7d29 292e 292a 2422 0a20  sions)})).)*$". 
+00007eb0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00007ec0: 2065 7863 6c75 6465 5f72 6520 3d20 2727   exclude_re = ''
+00007ed0: 0a20 2020 2069 6620 7461 7267 6574 5f64  .    if target_d
+00007ee0: 6972 2069 7320 4e6f 6e65 3a0a 2020 2020  ir is None:.    
+00007ef0: 2020 2020 7461 7267 6574 5f64 6972 203d      target_dir =
+00007f00: 2064 6972 6563 746f 7279 0a20 2020 206e   directory.    n
+00007f10: 6577 5f64 6972 7320 3d20 7b7d 0a20 2020  ew_dirs = {}.   
+00007f20: 2073 7562 6469 725f 6669 6c65 5f74 7570   subdir_file_tup
+00007f30: 6c65 7320 3d20 6974 6572 285b 5d29 0a20  les = iter([]). 
+00007f40: 2020 2069 6620 6469 7265 6374 6f72 7920     if directory 
+00007f50: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00007f60: 2020 2020 2073 7562 6469 725f 6669 6c65       subdir_file
+00007f70: 5f74 7570 6c65 7320 3d20 6368 6169 6e28  _tuples = chain(
+00007f80: 7375 6264 6972 5f66 696c 655f 7475 706c  subdir_file_tupl
+00007f90: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+00007fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007fb0: 2020 2020 2020 2073 6361 6e5f 6469 7265         scan_dire
+00007fc0: 6374 6f72 7928 6469 7265 6374 6f72 792c  ctory(directory,
+00007fd0: 2066 696c 655f 7265 3d72 6567 6578 2c20   file_re=regex, 
+00007fe0: 6578 636c 7564 655f 7265 3d65 7863 6c75  exclude_re=exclu
+00007ff0: 6465 5f72 652c 2072 6563 7572 7369 7665  de_re, recursive
+00008000: 3d72 6563 7572 7369 7665 2c0a 2020 2020  =recursive,.    
 00008010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008020: 2020 2020 2073 7562 6469 7273 3d54 7275       subdirs=Tru
-00008030: 652c 2065 7863 6c75 6465 5f66 696c 6573  e, exclude_files
-00008040: 5f6f 6e6c 793d 5472 7565 2c20 6c6f 6767  _only=True, logg
-00008050: 6572 3d6c 6f67 6765 7229 290a 2020 2020  er=logger)).    
-00008060: 6966 2066 696c 655f 7061 7468 7320 6973  if file_paths is
-00008070: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00008080: 2020 2073 7562 6469 725f 6669 6c65 5f74     subdir_file_t
-00008090: 7570 6c65 7320 3d20 6368 6169 6e28 7375  uples = chain(su
-000080a0: 6264 6972 5f66 696c 655f 7475 706c 6573  bdir_file_tuples
-000080b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000080c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080d0: 2020 2020 2028 6f73 2e70 6174 682e 7370       (os.path.sp
-000080e0: 6c69 7428 7265 736f 6c76 655f 6469 7228  lit(resolve_dir(
-000080f0: 7061 7468 2929 2066 6f72 2070 6174 6820  path)) for path 
-00008100: 696e 2066 696c 655f 7061 7468 7329 290a  in file_paths)).
-00008110: 2020 2020 666f 7220 7375 6264 6972 2c20      for subdir, 
-00008120: 6669 6c65 2069 6e20 7375 6264 6972 5f66  file in subdir_f
-00008130: 696c 655f 7475 706c 6573 3a0a 2020 2020  ile_tuples:.    
-00008140: 2020 2020 6966 2073 7562 6469 7220 696e      if subdir in
-00008150: 206e 6577 5f64 6972 733a 0a20 2020 2020   new_dirs:.     
-00008160: 2020 2020 2020 206e 6577 5f73 7562 6469         new_subdi
-00008170: 7220 3d20 6e65 775f 6469 7273 5b73 7562  r = new_dirs[sub
-00008180: 6469 725d 0a20 2020 2020 2020 2065 6c73  dir].        els
-00008190: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-000081a0: 6620 7461 7267 6574 5f64 6972 2069 7320  f target_dir is 
-000081b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000081c0: 2020 2020 2020 6e65 775f 7375 6264 6972        new_subdir
-000081d0: 203d 2073 7562 6469 720a 2020 2020 2020   = subdir.      
-000081e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000081f0: 2020 2020 2020 2020 2020 2020 6f6c 645f              old_
-00008200: 7375 6264 6972 203d 206f 732e 7061 7468  subdir = os.path
-00008210: 2e72 656c 7061 7468 2873 7562 6469 722c  .relpath(subdir,
-00008220: 2064 6972 6563 746f 7279 290a 2020 2020   directory).    
-00008230: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00008240: 7375 6264 6972 203d 206f 732e 7061 7468  subdir = os.path
-00008250: 2e6a 6f69 6e28 7461 7267 6574 5f64 6972  .join(target_dir
-00008260: 2c20 6f6c 645f 7375 6264 6972 2920 6966  , old_subdir) if
-00008270: 206f 6c64 5f73 7562 6469 7220 213d 2027   old_subdir != '
-00008280: 2e27 2065 6c73 6520 7461 7267 6574 5f64  .' else target_d
-00008290: 6972 0a20 2020 2020 2020 2020 2020 206f  ir.            o
-000082a0: 732e 6d61 6b65 6469 7273 286e 6577 5f73  s.makedirs(new_s
-000082b0: 7562 6469 722c 2065 7869 7374 5f6f 6b3d  ubdir, exist_ok=
-000082c0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-000082d0: 2020 6e65 775f 6469 7273 5b73 7562 6469    new_dirs[subdi
-000082e0: 725d 203d 206e 6577 5f73 7562 6469 720a  r] = new_subdir.
-000082f0: 2020 2020 2020 2020 6e61 6d65 2c20 5f20          name, _ 
-00008300: 3d20 6f73 2e70 6174 682e 7370 6c69 7465  = os.path.splite
-00008310: 7874 2866 696c 6529 0a20 2020 2020 2020  xt(file).       
-00008320: 2069 6620 7375 6666 6978 2069 7320 6e6f   if suffix is no
-00008330: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00008340: 2020 2020 666e 616d 6520 3d20 6622 7b6e      fname = f"{n
-00008350: 616d 657d 7b73 7566 6669 787d 2e7b 7461  ame}{suffix}.{ta
-00008360: 7267 6574 5f65 7874 656e 7369 6f6e 7d22  rget_extension}"
-00008370: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00008380: 2020 2020 2020 2020 2020 2066 6e61 6d65             fname
-00008390: 203d 2066 227b 6e61 6d65 7d2e 7b74 6172   = f"{name}.{tar
-000083a0: 6765 745f 6578 7465 6e73 696f 6e7d 220a  get_extension}".
-000083b0: 2020 2020 2020 2020 6f6c 6420 3d20 6f73          old = os
-000083c0: 2e70 6174 682e 6a6f 696e 2873 7562 6469  .path.join(subdi
-000083d0: 722c 2066 696c 6529 0a20 2020 2020 2020  r, file).       
-000083e0: 206e 6577 203d 206f 732e 7061 7468 2e6a   new = os.path.j
-000083f0: 6f69 6e28 6e65 775f 7375 6264 6972 2c20  oin(new_subdir, 
-00008400: 666e 616d 6529 0a20 2020 2020 2020 2069  fname).        i
-00008410: 6620 6f76 6572 7772 6974 6520 6f72 206e  f overwrite or n
-00008420: 6f74 206f 732e 7061 7468 2e69 7366 696c  ot os.path.isfil
-00008430: 6528 6e65 7729 3a0a 2020 2020 2020 2020  e(new):.        
-00008440: 2020 2020 636f 6e76 6572 7369 6f6e 5f70      conversion_p
-00008450: 6172 616d 732e 6170 7065 6e64 285b 6469  arams.append([di
-00008460: 6374 286f 6c64 3d6f 6c64 2c20 6e65 773d  ct(old=old, new=
-00008470: 6e65 772c 204d 533d 4d53 2c20 6c6f 6767  new, MS=MS, logg
-00008480: 6572 3d6c 6f67 6765 7229 5d29 0a20 2020  er=logger)]).   
-00008490: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000084a0: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
-000084b0: 6275 6728 6e65 772c 2027 6578 6973 7473  bug(new, 'exists
-000084c0: 2061 6c72 6561 6479 2e20 5061 7373 202d   already. Pass -
-000084d0: 6f20 746f 206f 7665 7277 7269 7465 2e27  o to overwrite.'
-000084e0: 290a 0a20 2020 2069 6620 6c65 6e28 636f  )..    if len(co
-000084f0: 6e76 6572 7369 6f6e 5f70 6172 616d 7329  nversion_params)
-00008500: 203d 3d20 303a 0a20 2020 2020 2020 206c   == 0:.        l
-00008510: 6f67 6765 722e 696e 666f 2866 224e 6f20  ogger.info(f"No 
-00008520: 6669 6c65 7320 746f 2063 6f6e 7665 7274  files to convert
-00008530: 2e22 290a 0a0a 2020 2020 6966 2070 6172  .")...    if par
-00008540: 616c 6c65 6c3a 0a20 2020 2020 2020 2070  allel:.        p
-00008550: 6f6f 6c20 3d20 6d75 6c74 6970 726f 6365  ool = multiproce
-00008560: 7373 696e 672e 506f 6f6c 286d 756c 7469  ssing.Pool(multi
-00008570: 7072 6f63 6573 7369 6e67 2e63 7075 5f63  processing.cpu_c
-00008580: 6f75 6e74 2829 290a 2020 2020 2020 2020  ount()).        
-00008590: 706f 6f6c 2e73 7461 726d 6170 285f 636f  pool.starmap(_co
-000085a0: 6e76 6572 745f 6b77 6172 6773 2c20 636f  nvert_kwargs, co
-000085b0: 6e76 6572 7369 6f6e 5f70 6172 616d 7329  nversion_params)
-000085c0: 0a20 2020 2020 2020 2070 6f6f 6c2e 636c  .        pool.cl
-000085d0: 6f73 6528 290a 2020 2020 2020 2020 706f  ose().        po
-000085e0: 6f6c 2e6a 6f69 6e28 290a 2020 2020 656c  ol.join().    el
-000085f0: 7365 3a0a 2020 2020 2020 2020 666f 7220  se:.        for 
-00008600: 6f6c 642c 206e 6577 2c20 4d53 2069 6e20  old, new, MS in 
-00008610: 636f 6e76 6572 7369 6f6e 5f70 6172 616d  conversion_param
-00008620: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-00008630: 6f6e 7665 7274 286f 6c64 3d6f 6c64 2c20  onvert(old=old, 
-00008640: 6e65 773d 6e65 772c 204d 533d 4d53 2c20  new=new, MS=MS, 
-00008650: 6c6f 6767 6572 3d6c 6f67 6765 7229 0a0a  logger=logger)..
-00008660: 0a40 6675 6e63 7469 6f6e 5f6c 6f67 6765  .@function_logge
-00008670: 720a 6465 6620 6465 636f 6465 5f68 6172  r.def decode_har
-00008680: 6d6f 6e69 6573 2864 662c 206c 6162 656c  monies(df, label
-00008690: 5f63 6f6c 3d27 6c61 6265 6c27 2c20 6b65  _col='label', ke
-000086a0: 6570 5f6c 6179 6572 3d54 7275 652c 2072  ep_layer=True, r
-000086b0: 6574 7572 6e5f 7365 7269 6573 3d46 616c  eturn_series=Fal
-000086c0: 7365 2c20 616c 745f 636f 6c73 3d27 616c  se, alt_cols='al
-000086d0: 745f 6c61 6265 6c27 2c20 616c 745f 7365  t_label', alt_se
-000086e0: 7061 7261 746f 723d 272d 2729 3a0a 2020  parator='-'):.  
-000086f0: 2020 2222 224d 7573 6553 636f 7265 2073    """MuseScore s
-00008700: 746f 7265 7320 7479 7065 7320 3220 284e  tores types 2 (N
-00008710: 6173 6876 696c 6c65 2920 616e 6420 3320  ashville) and 3 
-00008720: 2861 6273 6f6c 7574 6520 6368 6f72 6473  (absolute chords
-00008730: 2920 696e 2073 6576 6572 616c 2063 6f6c  ) in several col
-00008740: 756d 6e73 2e20 5468 6973 2066 756e 6374  umns. This funct
-00008750: 696f 6e20 7265 7475 726e 7320 6120 636f  ion returns a co
-00008760: 7079 206f 660a 2020 2020 7468 6520 4461  py of.    the Da
-00008770: 7461 4672 616d 6520 6060 416e 6e6f 7461  taFrame ``Annota
-00008780: 7469 6f6e 732e 6466 6060 2077 6865 7265  tions.df`` where
-00008790: 2074 6865 206c 6162 656c 2063 6f6c 756d   the label colum
-000087a0: 6e20 636f 6e74 6169 6e73 2074 6865 2073  n contains the s
-000087b0: 7472 696e 6773 2063 6f72 7265 7370 6f6e  trings correspon
-000087c0: 6469 6e67 2074 6f20 7468 6573 6520 636f  ding to these co
-000087d0: 6c75 6d6e 732e 0a0a 2020 2020 5061 7261  lumns...    Para
-000087e0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-000087f0: 2d2d 2d2d 2d0a 2020 2020 6466 203a 203a  -----.    df : :
-00008800: 6f62 6a3a 6070 616e 6461 732e 4461 7461  obj:`pandas.Data
-00008810: 4672 616d 6560 0a20 2020 2020 2020 2044  Frame`.        D
-00008820: 6174 6146 7261 6d65 2077 6974 6820 656e  ataFrame with en
-00008830: 636f 6465 6420 6861 726d 6f6e 7920 6c61  coded harmony la
-00008840: 6265 6c73 2061 7320 7374 6f72 6564 2069  bels as stored i
-00008850: 6e20 616e 203a 6f62 6a3a 6041 6e6e 6f74  n an :obj:`Annot
-00008860: 6174 696f 6e73 6020 6f62 6a65 6374 2e0a  ations` object..
-00008870: 2020 2020 6c61 6265 6c5f 636f 6c20 3a20      label_col : 
-00008880: 3a6f 626a 3a60 7374 7260 2c20 6f70 7469  :obj:`str`, opti
-00008890: 6f6e 616c 0a20 2020 2020 2020 2043 6f6c  onal.        Col
-000088a0: 756d 6e20 6e61 6d65 2077 6865 7265 2074  umn name where t
-000088b0: 6865 206d 6169 6e20 636f 6d70 6f6e 656e  he main componen
-000088c0: 7473 2028 3c6e 616d 653e 2074 6167 2920  ts (<name> tag) 
-000088d0: 6172 6520 7374 6f72 6564 2c20 6465 6661  are stored, defa
-000088e0: 756c 7473 2074 6f20 276c 6162 656c 270a  ults to 'label'.
-000088f0: 2020 2020 6b65 6570 5f6c 6179 6572 203a      keep_layer :
-00008900: 203a 6f62 6a3a 6062 6f6f 6c60 2c20 6f70   :obj:`bool`, op
-00008910: 7469 6f6e 616c 0a20 2020 2020 2020 2044  tional.        D
-00008920: 6566 6175 6c74 7320 746f 2054 7275 652c  efaults to True,
-00008930: 2072 6574 6169 6e69 6e67 2074 6865 2027   retaining the '
-00008940: 6861 726d 6f6e 795f 6c61 7965 7227 2063  harmony_layer' c
-00008950: 6f6c 756d 6e20 7769 7468 206f 7269 6769  olumn with origi
-00008960: 6e61 6c20 6c61 7965 7273 2e0a 2020 2020  nal layers..    
-00008970: 7265 7475 726e 5f73 6572 6965 7320 3a20  return_series : 
-00008980: 3a6f 626a 3a60 626f 6f6c 602c 206f 7074  :obj:`bool`, opt
-00008990: 696f 6e61 6c0a 2020 2020 2020 2020 4966  ional.        If
-000089a0: 2073 6574 2074 6f20 5472 7565 2c20 6f6e   set to True, on
-000089b0: 6c79 2074 6865 2064 6563 6f64 6564 206c  ly the decoded l
-000089c0: 6162 656c 7320 636f 6c75 6d6e 2069 7320  abels column is 
-000089d0: 7265 7475 726e 6564 2061 7320 6120 5365  returned as a Se
-000089e0: 7269 6573 2072 6174 6865 7220 7468 616e  ries rather than
-000089f0: 2061 2063 6f70 7920 6f66 2060 6064 6660   a copy of ``df`
-00008a00: 602e 0a20 2020 2061 6c74 5f63 6f6c 7320  `..    alt_cols 
-00008a10: 3a20 3a6f 626a 3a60 7374 7260 206f 7220  : :obj:`str` or 
-00008a20: 3a6f 626a 3a60 6c69 7374 602c 206f 7074  :obj:`list`, opt
-00008a30: 696f 6e61 6c0a 2020 2020 2020 2020 436f  ional.        Co
-00008a40: 6c75 6d6e 2873 2920 7769 7468 2061 6c74  lumn(s) with alt
-00008a50: 6572 6e61 7469 7665 206c 6162 656c 7320  ernative labels 
-00008a60: 7468 6174 2061 7265 206a 6f69 6e65 6420  that are joined 
-00008a70: 7769 7468 2074 6865 206c 6162 656c 2063  with the label c
-00008a80: 6f6c 756d 6e73 2075 7369 6e67 2060 6061  olumns using ``a
-00008a90: 6c74 5f73 6570 6172 6174 6f72 6060 2e20  lt_separator``. 
-00008aa0: 4465 6661 756c 7473 2074 6f0a 2020 2020  Defaults to.    
-00008ab0: 2020 2020 2761 6c74 5f6c 6162 656c 272e      'alt_label'.
-00008ac0: 2053 7570 7072 6573 7320 6279 2070 6173   Suppress by pas
-00008ad0: 7369 6e67 204e 6f6e 652e 0a20 2020 2061  sing None..    a
-00008ae0: 6c74 5f73 6570 6172 6174 6f72 3a20 3a6f  lt_separator: :o
-00008af0: 626a 3a60 7374 7260 2c20 6f70 7469 6f6e  bj:`str`, option
-00008b00: 616c 0a20 2020 2020 2020 2053 6570 6172  al.        Separ
-00008b10: 6174 6f72 2066 6f72 206a 6f69 6e69 6e67  ator for joining
-00008b20: 2060 6061 6c74 5f63 6f6c 7360 602e 0a0a   ``alt_cols``...
-00008b30: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00008b40: 2d2d 2d2d 2d2d 2d0a 2020 2020 3a6f 626a  -------.    :obj
-00008b50: 3a60 7061 6e64 6173 2e44 6174 6146 7261  :`pandas.DataFra
-00008b60: 6d65 6020 6f72 203a 6f62 6a3a 6070 616e  me` or :obj:`pan
-00008b70: 6461 732e 5365 7269 6573 600a 2020 2020  das.Series`.    
-00008b80: 2020 2020 4465 636f 6465 6420 6861 726d      Decoded harm
-00008b90: 6f6e 7920 6c61 6265 6c73 2e0a 2020 2020  ony labels..    
-00008ba0: 2222 220a 2020 2020 6466 203d 2064 662e  """.    df = df.
-00008bb0: 636f 7079 2829 0a20 2020 2064 726f 705f  copy().    drop_
-00008bc0: 636f 6c73 2c20 636f 6d70 6f73 655f 6c61  cols, compose_la
-00008bd0: 6265 6c20 3d20 5b5d 2c20 5b5d 0a20 2020  bel = [], [].   
-00008be0: 2069 6620 276e 6173 6876 696c 6c65 2720   if 'nashville' 
-00008bf0: 696e 2064 662e 636f 6c75 6d6e 733a 0a20  in df.columns:. 
-00008c00: 2020 2020 2020 2073 656c 203d 2064 662e         sel = df.
-00008c10: 6e61 7368 7669 6c6c 652e 6e6f 746e 6128  nashville.notna(
-00008c20: 290a 2020 2020 2020 2020 6466 2e6c 6f63  ).        df.loc
-00008c30: 5b73 656c 2c20 6c61 6265 6c5f 636f 6c5d  [sel, label_col]
-00008c40: 203d 2064 662e 6c6f 635b 7365 6c2c 2027   = df.loc[sel, '
-00008c50: 6e61 7368 7669 6c6c 6527 5d2e 6173 7479  nashville'].asty
-00008c60: 7065 2873 7472 2920 2b20 6466 2e6c 6f63  pe(str) + df.loc
-00008c70: 5b73 656c 2c20 6c61 6265 6c5f 636f 6c5d  [sel, label_col]
-00008c80: 2e72 6570 6c61 6365 2827 2f27 2c20 2727  .replace('/', ''
-00008c90: 290a 2020 2020 2020 2020 6472 6f70 5f63  ).        drop_c
-00008ca0: 6f6c 732e 6170 7065 6e64 2827 6e61 7368  ols.append('nash
-00008cb0: 7669 6c6c 6527 290a 2020 2020 6966 2027  ville').    if '
-00008cc0: 6c65 6674 5061 7265 6e27 2069 6e20 6466  leftParen' in df
-00008cd0: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
-00008ce0: 2020 6466 2e6c 6566 7450 6172 656e 2e72    df.leftParen.r
-00008cf0: 6570 6c61 6365 2827 2f27 2c20 2728 272c  eplace('/', '(',
-00008d00: 2069 6e70 6c61 6365 3d54 7275 6529 0a20   inplace=True). 
-00008d10: 2020 2020 2020 2063 6f6d 706f 7365 5f6c         compose_l
-00008d20: 6162 656c 2e61 7070 656e 6428 276c 6566  abel.append('lef
-00008d30: 7450 6172 656e 2729 0a20 2020 2020 2020  tParen').       
-00008d40: 2064 726f 705f 636f 6c73 2e61 7070 656e   drop_cols.appen
-00008d50: 6428 276c 6566 7450 6172 656e 2729 0a20  d('leftParen'). 
-00008d60: 2020 2069 6620 2761 6273 6f6c 7574 655f     if 'absolute_
-00008d70: 726f 6f74 2720 696e 2064 662e 636f 6c75  root' in df.colu
-00008d80: 6d6e 7320 616e 6420 6466 2e61 6273 6f6c  mns and df.absol
-00008d90: 7574 655f 726f 6f74 2e6e 6f74 6e61 2829  ute_root.notna()
-00008da0: 2e61 6e79 2829 3a0a 2020 2020 2020 2020  .any():.        
-00008db0: 7365 6c20 3d20 6466 2e61 6273 6f6c 7574  sel = df.absolut
-00008dc0: 655f 726f 6f74 2e6e 6f74 6e61 2829 0a20  e_root.notna(). 
-00008dd0: 2020 2020 2020 2072 6f6f 745f 6173 5f6e         root_as_n
-00008de0: 6f74 655f 6e61 6d65 203d 2066 6966 7468  ote_name = fifth
-00008df0: 7332 6e61 6d65 2864 662e 6c6f 635b 7365  s2name(df.loc[se
-00008e00: 6c2c 2027 6162 736f 6c75 7465 5f72 6f6f  l, 'absolute_roo
-00008e10: 7427 5d2e 746f 5f6c 6973 7428 292c 206d  t'].to_list(), m
-00008e20: 733d 5472 7565 2c20 6c6f 6767 6572 3d6c  s=True, logger=l
-00008e30: 6f67 6765 7229 0a20 2020 2020 2020 2064  ogger).        d
-00008e40: 662e 6162 736f 6c75 7465 5f72 6f6f 7420  f.absolute_root 
-00008e50: 3d20 6466 2e61 6273 6f6c 7574 655f 726f  = df.absolute_ro
-00008e60: 6f74 2e61 7374 7970 6528 2773 7472 696e  ot.astype('strin
-00008e70: 6727 290a 2020 2020 2020 2020 6466 2e6c  g').        df.l
-00008e80: 6f63 5b73 656c 2c20 2761 6273 6f6c 7574  oc[sel, 'absolut
-00008e90: 655f 726f 6f74 275d 203d 2072 6f6f 745f  e_root'] = root_
-00008ea0: 6173 5f6e 6f74 655f 6e61 6d65 0a20 2020  as_note_name.   
-00008eb0: 2020 2020 2063 6f6d 706f 7365 5f6c 6162       compose_lab
-00008ec0: 656c 2e61 7070 656e 6428 2761 6273 6f6c  el.append('absol
-00008ed0: 7574 655f 726f 6f74 2729 0a20 2020 2020  ute_root').     
-00008ee0: 2020 2064 726f 705f 636f 6c73 2e61 7070     drop_cols.app
-00008ef0: 656e 6428 2761 6273 6f6c 7574 655f 726f  end('absolute_ro
-00008f00: 6f74 2729 0a20 2020 2020 2020 2069 6620  ot').        if 
-00008f10: 2772 6f6f 7443 6173 6527 2069 6e20 6466  'rootCase' in df
-00008f20: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
-00008f30: 2020 2020 2020 7365 6c20 3d20 6466 2e72        sel = df.r
-00008f40: 6f6f 7443 6173 652e 6e6f 746e 6128 290a  ootCase.notna().
-00008f50: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00008f60: 2077 6172 6e69 6e67 732e 6361 7463 685f   warnings.catch_
-00008f70: 7761 726e 696e 6773 2829 3a0a 2020 2020  warnings():.    
-00008f80: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
-00008f90: 7474 696e 6720 7661 6c75 6573 2069 6e2d  tting values in-
-00008fa0: 706c 6163 6520 6973 2066 696e 652c 2069  place is fine, i
-00008fb0: 676e 6f72 6520 7468 6520 7761 726e 696e  gnore the warnin
-00008fc0: 6720 696e 2050 616e 6461 7320 3e3d 2031  g in Pandas >= 1
-00008fd0: 2e35 2e30 0a20 2020 2020 2020 2020 2020  .5.0.           
-00008fe0: 2020 2020 2023 2054 6869 7320 6361 6e20       # This can 
-00008ff0: 6265 2072 656d 6f76 6564 2c20 6966 2050  be removed, if P
-00009000: 616e 6461 7320 312e 352e 3020 646f 6573  andas 1.5.0 does
-00009010: 206e 6f74 206e 6565 6420 746f 2062 6520   not need to be 
-00009020: 7375 7070 6f72 7465 6420 616e 7920 6c6f  supported any lo
-00009030: 6e67 6572 2e0a 2020 2020 2020 2020 2020  nger..          
-00009040: 2020 2020 2020 2320 5365 6520 616c 736f        # See also
-00009050: 3a20 6874 7470 733a 2f2f 7374 6163 6b6f  : https://stacko
-00009060: 7665 7266 6c6f 772e 636f 6d2f 712f 3734  verflow.com/q/74
-00009070: 3035 3733 3637 2f38 3539 3539 310a 2020  057367/859591.  
-00009080: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-00009090: 726e 696e 6773 2e66 696c 7465 7277 6172  rnings.filterwar
-000090a0: 6e69 6e67 7328 0a20 2020 2020 2020 2020  nings(.         
-000090b0: 2020 2020 2020 2020 2020 2022 6967 6e6f             "igno
-000090c0: 7265 222c 0a20 2020 2020 2020 2020 2020  re",.           
-000090d0: 2020 2020 2020 2020 2063 6174 6567 6f72           categor
-000090e0: 793d 4675 7475 7265 5761 726e 696e 672c  y=FutureWarning,
-000090f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009100: 2020 2020 206d 6573 7361 6765 3d28 0a20       message=(. 
-00009110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009120: 2020 2020 2020 2022 2e2a 7769 6c6c 2061         ".*will a
-00009130: 7474 656d 7074 2074 6f20 7365 7420 7468  ttempt to set th
-00009140: 6520 7661 6c75 6573 2069 6e70 6c61 6365  e values inplace
-00009150: 2069 6e73 7465 6164 206f 6620 616c 7761   instead of alwa
-00009160: 7973 2073 6574 7469 6e67 2061 206e 6577  ys setting a new
-00009170: 2061 7272 6179 2e20 220a 2020 2020 2020   array. ".      
-00009180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009190: 2020 2254 6f20 7265 7461 696e 2074 6865    "To retain the
-000091a0: 206f 6c64 2062 6568 6176 696f 722c 2075   old behavior, u
-000091b0: 7365 2065 6974 6865 722e 2a22 0a20 2020  se either.*".   
-000091c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091d0: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-000091e0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000091f0: 2020 2020 2020 6466 2e6c 6f63 5b73 656c        df.loc[sel
-00009200: 2c20 2761 6273 6f6c 7574 655f 726f 6f74  , 'absolute_root
-00009210: 275d 203d 2064 662e 6c6f 635b 7365 6c2c  '] = df.loc[sel,
-00009220: 2027 6162 736f 6c75 7465 5f72 6f6f 7427   'absolute_root'
-00009230: 5d2e 7374 722e 6c6f 7765 7228 290a 2020  ].str.lower().  
-00009240: 2020 2020 2020 2020 2020 6472 6f70 5f63            drop_c
-00009250: 6f6c 732e 6170 7065 6e64 2827 726f 6f74  ols.append('root
-00009260: 4361 7365 2729 0a20 2020 2069 6620 6c61  Case').    if la
-00009270: 6265 6c5f 636f 6c20 696e 2064 662e 636f  bel_col in df.co
-00009280: 6c75 6d6e 733a 0a20 2020 2020 2020 2063  lumns:.        c
-00009290: 6f6d 706f 7365 5f6c 6162 656c 2e61 7070  ompose_label.app
-000092a0: 656e 6428 6c61 6265 6c5f 636f 6c29 0a20  end(label_col). 
-000092b0: 2020 2069 6620 2761 6273 6f6c 7574 655f     if 'absolute_
-000092c0: 6261 7365 2720 696e 2064 662e 636f 6c75  base' in df.colu
-000092d0: 6d6e 7320 616e 6420 6466 2e61 6273 6f6c  mns and df.absol
-000092e0: 7574 655f 6261 7365 2e6e 6f74 6e61 2829  ute_base.notna()
-000092f0: 2e61 6e79 2829 3a0a 2020 2020 2020 2020  .any():.        
-00009300: 7365 6c20 3d20 6466 2e61 6273 6f6c 7574  sel = df.absolut
-00009310: 655f 6261 7365 2e6e 6f74 6e61 2829 0a20  e_base.notna(). 
-00009320: 2020 2020 2020 2062 6173 655f 6173 5f6e         base_as_n
-00009330: 6f74 655f 6e61 6d65 203d 2066 6966 7468  ote_name = fifth
-00009340: 7332 6e61 6d65 2864 662e 6c6f 635b 7365  s2name(df.loc[se
-00009350: 6c2c 2027 6162 736f 6c75 7465 5f62 6173  l, 'absolute_bas
-00009360: 6527 5d2e 746f 5f6c 6973 7428 292c 206d  e'].to_list(), m
-00009370: 733d 5472 7565 2c20 6c6f 6767 6572 3d6c  s=True, logger=l
-00009380: 6f67 6765 7229 0a20 2020 2020 2020 2064  ogger).        d
-00009390: 662e 6162 736f 6c75 7465 5f62 6173 6520  f.absolute_base 
-000093a0: 3d20 6466 2e61 6273 6f6c 7574 655f 6261  = df.absolute_ba
-000093b0: 7365 2e61 7374 7970 6528 2773 7472 696e  se.astype('strin
-000093c0: 6727 290a 2020 2020 2020 2020 6466 2e6c  g').        df.l
-000093d0: 6f63 5b73 656c 2c20 2761 6273 6f6c 7574  oc[sel, 'absolut
-000093e0: 655f 6261 7365 275d 203d 2062 6173 655f  e_base'] = base_
-000093f0: 6173 5f6e 6f74 655f 6e61 6d65 0a20 2020  as_note_name.   
-00009400: 2020 2020 2064 662e 6162 736f 6c75 7465       df.absolute
-00009410: 5f62 6173 6520 3d20 272f 2720 2b20 6466  _base = '/' + df
-00009420: 2e61 6273 6f6c 7574 655f 6261 7365 0a20  .absolute_base. 
-00009430: 2020 2020 2020 2063 6f6d 706f 7365 5f6c         compose_l
-00009440: 6162 656c 2e61 7070 656e 6428 2761 6273  abel.append('abs
-00009450: 6f6c 7574 655f 6261 7365 2729 0a20 2020  olute_base').   
-00009460: 2020 2020 2064 726f 705f 636f 6c73 2e61       drop_cols.a
-00009470: 7070 656e 6428 2761 6273 6f6c 7574 655f  ppend('absolute_
-00009480: 6261 7365 2729 0a20 2020 2069 6620 2772  base').    if 'r
-00009490: 6967 6874 5061 7265 6e27 2069 6e20 6466  ightParen' in df
-000094a0: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
-000094b0: 2020 6466 2e72 6967 6874 5061 7265 6e2e    df.rightParen.
-000094c0: 7265 706c 6163 6528 272f 272c 2027 2927  replace('/', ')'
-000094d0: 2c20 696e 706c 6163 653d 5472 7565 290a  , inplace=True).
-000094e0: 2020 2020 2020 2020 636f 6d70 6f73 655f          compose_
-000094f0: 6c61 6265 6c2e 6170 7065 6e64 2827 7269  label.append('ri
-00009500: 6768 7450 6172 656e 2729 0a20 2020 2020  ghtParen').     
-00009510: 2020 2064 726f 705f 636f 6c73 2e61 7070     drop_cols.app
-00009520: 656e 6428 2772 6967 6874 5061 7265 6e27  end('rightParen'
-00009530: 290a 2020 2020 6e65 775f 6c61 6265 6c5f  ).    new_label_
-00009540: 636f 6c20 3d20 6466 5b63 6f6d 706f 7365  col = df[compose
-00009550: 5f6c 6162 656c 5d2e 6669 6c6c 6e61 2827  _label].fillna('
-00009560: 2729 2e73 756d 2861 7869 733d 3129 2e61  ').sum(axis=1).a
-00009570: 7374 7970 6528 7374 7229 0a20 2020 206e  stype(str).    n
-00009580: 6577 5f6c 6162 656c 5f63 6f6c 203d 206e  ew_label_col = n
-00009590: 6577 5f6c 6162 656c 5f63 6f6c 2e73 7472  ew_label_col.str
-000095a0: 2e72 6570 6c61 6365 2827 5e2f 2427 2c20  .replace('^/$', 
-000095b0: 2765 6d70 7479 5f68 6172 6d6f 6e79 272c  'empty_harmony',
-000095c0: 2072 6567 6578 3d54 7275 6529 2e72 6570   regex=True).rep
-000095d0: 6c61 6365 2827 272c 2070 642e 4e41 290a  lace('', pd.NA).
-000095e0: 0a20 2020 2069 6620 616c 745f 636f 6c73  .    if alt_cols
-000095f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00009600: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00009610: 6e63 6528 616c 745f 636f 6c73 2c20 7374  nce(alt_cols, st
-00009620: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00009630: 616c 745f 636f 6c73 203d 205b 616c 745f  alt_cols = [alt_
-00009640: 636f 6c73 5d0a 2020 2020 2020 2020 7072  cols].        pr
-00009650: 6573 656e 7420 3d20 5b63 2066 6f72 2063  esent = [c for c
-00009660: 2069 6e20 616c 745f 636f 6c73 2069 6620   in alt_cols if 
-00009670: 6320 696e 2064 662e 636f 6c75 6d6e 735d  c in df.columns]
-00009680: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00009690: 7072 6573 656e 7429 203e 2030 3a0a 2020  present) > 0:.  
-000096a0: 2020 2020 2020 2020 2020 616c 745f 6a6f            alt_jo
-000096b0: 696e 6564 203d 2070 642e 5365 7269 6573  ined = pd.Series
-000096c0: 2827 272c 2069 6e64 6578 3d6e 6577 5f6c  ('', index=new_l
-000096d0: 6162 656c 5f63 6f6c 2e69 6e64 6578 290a  abel_col.index).
-000096e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000096f0: 6320 696e 2070 7265 7365 6e74 3a0a 2020  c in present:.  
-00009700: 2020 2020 2020 2020 2020 2020 2020 616c                al
-00009710: 745f 6a6f 696e 6564 202b 3d20 2861 6c74  t_joined += (alt
-00009720: 5f73 6570 6172 6174 6f72 202b 2064 665b  _separator + df[
-00009730: 635d 292e 6669 6c6c 6e61 2827 2729 0a20  c]).fillna(''). 
-00009740: 2020 2020 2020 2020 2020 206e 6577 5f6c             new_l
-00009750: 6162 656c 5f63 6f6c 202b 3d20 616c 745f  abel_col += alt_
-00009760: 6a6f 696e 6564 0a0a 2020 2020 6966 2072  joined..    if r
-00009770: 6574 7572 6e5f 7365 7269 6573 3a0a 2020  eturn_series:.  
-00009780: 2020 2020 2020 7265 7475 726e 206e 6577        return new
-00009790: 5f6c 6162 656c 5f63 6f6c 0a0a 2020 2020  _label_col..    
-000097a0: 6966 2027 6861 726d 6f6e 795f 6c61 7965  if 'harmony_laye
-000097b0: 7227 2069 6e20 6466 2e63 6f6c 756d 6e73  r' in df.columns
-000097c0: 2061 6e64 206e 6f74 206b 6565 705f 6c61   and not keep_la
-000097d0: 7965 723a 0a20 2020 2020 2020 2064 726f  yer:.        dro
-000097e0: 705f 636f 6c73 2e61 7070 656e 6428 2768  p_cols.append('h
-000097f0: 6172 6d6f 6e79 5f6c 6179 6572 2729 0a20  armony_layer'). 
-00009800: 2020 2064 665b 6c61 6265 6c5f 636f 6c5d     df[label_col]
-00009810: 203d 206e 6577 5f6c 6162 656c 5f63 6f6c   = new_label_col
-00009820: 0a20 2020 2064 662e 6472 6f70 2863 6f6c  .    df.drop(col
-00009830: 756d 6e73 3d64 726f 705f 636f 6c73 2c20  umns=drop_cols, 
-00009840: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
-00009850: 2020 7265 7475 726e 2064 660a 0a0a 6465    return df...de
-00009860: 6620 6466 326d 6428 6466 3a20 7064 2e44  f df2md(df: pd.D
-00009870: 6174 6146 7261 6d65 2c20 6e61 6d65 3a20  ataFrame, name: 
-00009880: 7374 7220 3d20 224f 7665 7276 6965 7722  str = "Overview"
-00009890: 2920 2d3e 204d 6172 6b64 6f77 6e54 6162  ) -> MarkdownTab
-000098a0: 6c65 5772 6974 6572 3a0a 2020 2020 2222  leWriter:.    ""
-000098b0: 2220 5475 726e 7320 6120 4461 7461 4672  " Turns a DataFr
-000098c0: 616d 6520 696e 746f 2061 204d 6172 6b44  ame into a MarkD
-000098d0: 6f77 6e20 7461 626c 652e 2054 6865 2072  own table. The r
-000098e0: 6574 7572 6e65 6420 7772 6974 6572 2063  eturned writer c
-000098f0: 616e 2062 6520 636f 6e76 6572 7465 6420  an be converted 
-00009900: 696e 746f 2061 2073 7472 696e 672e 0a20  into a string.. 
-00009910: 2020 2022 2222 0a20 2020 2077 7269 7465     """.    write
-00009920: 7220 3d20 4d61 726b 646f 776e 5461 626c  r = MarkdownTabl
-00009930: 6557 7269 7465 7228 290a 2020 2020 7772  eWriter().    wr
-00009940: 6974 6572 2e74 6162 6c65 5f6e 616d 6520  iter.table_name 
-00009950: 3d20 6e61 6d65 0a20 2020 2077 7269 7465  = name.    write
-00009960: 722e 6865 6164 6572 5f6c 6973 7420 3d20  r.header_list = 
-00009970: 6c69 7374 2864 662e 636f 6c75 6d6e 732e  list(df.columns.
-00009980: 7661 6c75 6573 290a 2020 2020 7772 6974  values).    writ
-00009990: 6572 2e76 616c 7565 5f6d 6174 7269 7820  er.value_matrix 
-000099a0: 3d20 6466 2e76 616c 7565 732e 746f 6c69  = df.values.toli
-000099b0: 7374 2829 0a20 2020 2072 6574 7572 6e20  st().    return 
-000099c0: 7772 6974 6572 0a0a 0a64 6566 2064 6963  writer...def dic
-000099d0: 7432 6f6e 656c 696e 6572 2864 293a 0a20  t2oneliner(d):. 
-000099e0: 2020 2022 2222 2054 7572 6e73 2061 2064     """ Turns a d
-000099f0: 6963 7469 6f6e 6172 7920 696e 746f 2061  ictionary into a
-00009a00: 2073 696e 676c 652d 6c69 6e65 2073 7472   single-line str
-00009a10: 696e 6720 7769 7468 6f75 7420 6272 6163  ing without brac
-00009a20: 6b65 7473 2e22 2222 0a20 2020 2072 6574  kets.""".    ret
-00009a30: 7572 6e20 272c 2027 2e6a 6f69 6e28 6622  urn ', '.join(f"
-00009a40: 7b6b 7d3a 207b 767d 2220 666f 7220 6b2c  {k}: {v}" for k,
-00009a50: 2076 2069 6e20 642e 6974 656d 7328 2929   v in d.items())
-00009a60: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
-00009a70: 6572 0a64 6566 2072 6573 6f6c 7665 5f66  er.def resolve_f
-00009a80: 6f72 6d5f 6162 6272 6576 6961 7469 6f6e  orm_abbreviation
-00009a90: 7328 746f 6b65 6e3a 2073 7472 2c0a 2020  s(token: str,.  
-00009aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ab0: 2020 2020 2020 2020 2020 2020 2061 6262               abb
-00009ac0: 7265 7669 6174 696f 6e73 3a20 6469 6374  reviations: dict
-00009ad0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009af0: 206d 633a 204f 7074 696f 6e61 6c5b 556e   mc: Optional[Un
-00009b00: 696f 6e5b 696e 742c 2073 7472 5d5d 203d  ion[int, str]] =
-00009b10: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00009b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b30: 2020 2020 2020 6661 6c6c 6261 636b 5f74        fallback_t
-00009b40: 6f5f 6c6f 7765 7263 6173 653a 2062 6f6f  o_lowercase: boo
-00009b50: 6c20 3d20 5472 7565 2920 2d3e 2073 7472  l = True) -> str
-00009b60: 3a0a 2020 2020 2222 2220 4368 6563 6b73  :.    """ Checks
-00009b70: 2066 6f72 2065 6163 6820 636f 6e73 6563   for each consec
-00009b80: 7574 6976 6520 7375 6273 7472 696e 6720  utive substring 
-00009b90: 6f66 2074 6865 2074 6f6b 656e 2069 6620  of the token if 
-00009ba0: 6974 206d 6174 6368 6573 206f 6e65 206f  it matches one o
-00009bb0: 6620 7468 6520 6769 7665 6e20 6162 6272  f the given abbr
-00009bc0: 6576 6961 7469 6f6e 7320 616e 6420 7265  eviations and re
-00009bd0: 706c 6163 6573 0a20 2020 2069 7420 7769  places.    it wi
-00009be0: 7468 2074 6865 2063 6f72 7265 7370 6f6e  th the correspon
-00009bf0: 6469 6e67 206c 6f6e 6720 6e61 6d65 2e20  ding long name. 
-00009c00: 5472 6169 6c69 6e67 206e 756d 6265 7273  Trailing numbers
-00009c10: 2061 7265 2073 6570 6172 6174 6564 2062   are separated b
-00009c20: 7920 6120 7370 6163 6520 696e 2074 6869  y a space in thi
-00009c30: 7320 6361 7365 2e0a 2020 2020 0a20 2020  s case..    .   
-00009c40: 2041 7267 733a 0a20 2020 2020 2074 6f6b   Args:.      tok
-00009c50: 656e 3a20 496e 6469 7669 6475 616c 2074  en: Individual t
-00009c60: 6f6b 656e 2061 6674 6572 2073 706c 6974  oken after split
-00009c70: 7469 6e67 2061 6c74 6572 6e61 7469 7665  ting alternative
-00009c80: 2072 6561 6469 6e67 732e 0a20 2020 2020   readings..     
-00009c90: 2061 6262 7265 7669 6174 696f 6e73 3a20   abbreviations: 
-00009ca0: 7b61 6262 7265 7669 6174 696f 6e20 2d3e  {abbreviation ->
-00009cb0: 206c 6f6e 6720 6e61 6d65 7d20 6469 6374   long name} dict
-00009cc0: 2066 6f72 2073 7472 696e 6720 7265 706c   for string repl
-00009cd0: 6163 656d 656e 742e 0a20 2020 2020 2066  acement..      f
-00009ce0: 616c 6c62 6163 6b5f 746f 5f6c 6f77 6572  allback_to_lower
-00009cf0: 6361 7365 3a20 4279 2064 6566 6175 6c74  case: By default
-00009d00: 2c20 7468 6520 7375 6273 7472 696e 6773  , the substrings
-00009d10: 2061 7265 2063 6865 636b 6564 2061 6761   are checked aga
-00009d20: 696e 7374 2074 6865 2064 6963 7469 6f6e  inst the diction
-00009d30: 6172 7920 6b65 7973 2061 6e64 2c20 6966  ary keys and, if
-00009d40: 2075 6e73 7563 6365 7373 6675 6c2c 0a20   unsuccessful,. 
-00009d50: 2020 2020 2020 2020 2061 6761 696e 2069           again i
-00009d60: 6e20 6c6f 7765 7263 6173 652e 2050 6173  n lowercase. Pas
-00009d70: 7320 4661 6c73 6520 746f 2075 7365 206f  s False to use o
-00009d80: 6e6c 7920 7468 6520 6f72 6967 696e 616c  nly the original
-00009d90: 2073 7472 696e 672e 0a0a 2020 2020 5265   string...    Re
-00009da0: 7475 726e 733a 0a0a 2020 2020 2222 220a  turns:..    """.
-00009db0: 2020 2020 6d63 5f73 7472 696e 6720 3d20      mc_string = 
-00009dc0: 2727 2069 6620 6d63 2069 7320 4e6f 6e65  '' if mc is None
-00009dd0: 2065 6c73 6520 6622 4d43 207b 6d63 7d3a   else f"MC {mc}:
-00009de0: 2022 0a20 2020 2069 6620 272c 2720 696e   ".    if ',' in
-00009df0: 2074 6f6b 656e 3a0a 2020 2020 2020 2020   token:.        
-00009e00: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
-00009e10: 227b 6d63 5f73 7472 696e 677d 277b 746f  "{mc_string}'{to
-00009e20: 6b65 6e7d 2720 636f 6e74 6169 6e73 2061  ken}' contains a
-00009e30: 2063 6f6d 6d61 2c20 7768 6963 6820 6d69   comma, which mi
-00009e40: 6768 7420 7265 7375 6c74 2066 726f 6d20  ght result from 
-00009e50: 6120 7379 6e74 6178 2065 7272 6f72 2e22  a syntax error."
-00009e60: 290a 2020 2020 7375 625f 636f 6d70 6f6e  ).    sub_compon
-00009e70: 656e 745f 7265 6765 7820 3d20 7222 5c57  ent_regex = r"\W
-00009e80: 2b22 0a20 2020 2065 6e64 735f 6f6e 5f6e  +".    ends_on_n
-00009e90: 756d 6265 7273 5f72 6567 6578 203d 2072  umbers_regex = r
-00009ea0: 225c 642b 2422 0a20 2020 2072 6573 6f6c  "\d+$".    resol
-00009eb0: 7665 645f 7375 6273 7472 696e 6773 203d  ved_substrings =
-00009ec0: 205b 5d0a 2020 2020 666f 7220 6f72 6967   [].    for orig
-00009ed0: 696e 616c 5f73 7562 7374 7269 6e67 2069  inal_substring i
-00009ee0: 6e20 7265 2e73 706c 6974 2873 7562 5f63  n re.split(sub_c
-00009ef0: 6f6d 706f 6e65 6e74 5f72 6567 6578 2c20  omponent_regex, 
-00009f00: 746f 6b65 6e29 3a0a 2020 2020 2020 2020  token):.        
-00009f10: 7472 6169 6c69 6e67 5f6e 756d 6265 7273  trailing_numbers
-00009f20: 5f6d 6174 6368 203d 2072 652e 7365 6172  _match = re.sear
-00009f30: 6368 2865 6e64 735f 6f6e 5f6e 756d 6265  ch(ends_on_numbe
-00009f40: 7273 5f72 6567 6578 2c20 6f72 6967 696e  rs_regex, origin
-00009f50: 616c 5f73 7562 7374 7269 6e67 290a 2020  al_substring).  
-00009f60: 2020 2020 2020 6966 2074 7261 696c 696e        if trailin
-00009f70: 675f 6e75 6d62 6572 735f 6d61 7463 6820  g_numbers_match 
-00009f80: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00009f90: 2020 2020 2074 7261 696c 696e 675f 6e75       trailing_nu
-00009fa0: 6d62 6572 7320 3d20 2727 0a20 2020 2020  mbers = ''.     
-00009fb0: 2020 2020 2020 2073 7562 7374 7269 6e67         substring
-00009fc0: 203d 206f 7269 6769 6e61 6c5f 7375 6273   = original_subs
-00009fd0: 7472 696e 670a 2020 2020 2020 2020 656c  tring.        el
-00009fe0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00009ff0: 7472 6169 6c69 6e67 5f6e 756d 6265 7273  trailing_numbers
-0000a000: 5f70 6f73 6974 696f 6e20 3d20 7472 6169  _position = trai
-0000a010: 6c69 6e67 5f6e 756d 6265 7273 5f6d 6174  ling_numbers_mat
-0000a020: 6368 2e73 7461 7274 2829 0a20 2020 2020  ch.start().     
-0000a030: 2020 2020 2020 2069 6620 7472 6169 6c69         if traili
-0000a040: 6e67 5f6e 756d 6265 7273 5f70 6f73 6974  ng_numbers_posit
-0000a050: 696f 6e20 3d3d 2030 3a0a 2020 2020 2020  ion == 0:.      
-0000a060: 2020 2020 2020 2020 2020 2320 746f 6b65            # toke
-0000a070: 6e20 6973 206a 7573 7420 6120 6e75 6d62  n is just a numb
-0000a080: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-0000a090: 2020 2072 6573 6f6c 7665 645f 7375 6273     resolved_subs
-0000a0a0: 7472 696e 6773 2e61 7070 656e 6428 6f72  trings.append(or
-0000a0b0: 6967 696e 616c 5f73 7562 7374 7269 6e67  iginal_substring
-0000a0c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000a0d0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0000a0e0: 2020 2020 2020 2074 7261 696c 696e 675f         trailing_
-0000a0f0: 6e75 6d62 6572 7320 3d20 2220 2220 2b20  numbers = " " + 
+00008020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008030: 2020 2020 2020 2020 2020 2020 2020 7375                su
+00008040: 6264 6972 733d 5472 7565 2c20 6578 636c  bdirs=True, excl
+00008050: 7564 655f 6669 6c65 735f 6f6e 6c79 3d54  ude_files_only=T
+00008060: 7275 652c 206c 6f67 6765 723d 6c6f 6767  rue, logger=logg
+00008070: 6572 2929 0a20 2020 2069 6620 6669 6c65  er)).    if file
+00008080: 5f70 6174 6873 2069 7320 6e6f 7420 4e6f  _paths is not No
+00008090: 6e65 3a0a 2020 2020 2020 2020 7375 6264  ne:.        subd
+000080a0: 6972 5f66 696c 655f 7475 706c 6573 203d  ir_file_tuples =
+000080b0: 2063 6861 696e 2873 7562 6469 725f 6669   chain(subdir_fi
+000080c0: 6c65 5f74 7570 6c65 732c 0a20 2020 2020  le_tuples,.     
+000080d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000080e0: 2020 2020 2020 2020 2020 2020 2020 286f                (o
+000080f0: 732e 7061 7468 2e73 706c 6974 2872 6573  s.path.split(res
+00008100: 6f6c 7665 5f64 6972 2870 6174 6829 2920  olve_dir(path)) 
+00008110: 666f 7220 7061 7468 2069 6e20 6669 6c65  for path in file
+00008120: 5f70 6174 6873 2929 0a20 2020 2066 6f72  _paths)).    for
+00008130: 2073 7562 6469 722c 2066 696c 6520 696e   subdir, file in
+00008140: 2073 7562 6469 725f 6669 6c65 5f74 7570   subdir_file_tup
+00008150: 6c65 733a 0a20 2020 2020 2020 2069 6620  les:.        if 
+00008160: 7375 6264 6972 2069 6e20 6e65 775f 6469  subdir in new_di
+00008170: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00008180: 6e65 775f 7375 6264 6972 203d 206e 6577  new_subdir = new
+00008190: 5f64 6972 735b 7375 6264 6972 5d0a 2020  _dirs[subdir].  
+000081a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000081b0: 2020 2020 2020 2020 6966 2074 6172 6765          if targe
+000081c0: 745f 6469 7220 6973 204e 6f6e 653a 0a20  t_dir is None:. 
+000081d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000081e0: 6577 5f73 7562 6469 7220 3d20 7375 6264  ew_subdir = subd
+000081f0: 6972 0a20 2020 2020 2020 2020 2020 2065  ir.            e
+00008200: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00008210: 2020 2020 206f 6c64 5f73 7562 6469 7220       old_subdir 
+00008220: 3d20 6f73 2e70 6174 682e 7265 6c70 6174  = os.path.relpat
+00008230: 6828 7375 6264 6972 2c20 6469 7265 6374  h(subdir, direct
+00008240: 6f72 7929 0a20 2020 2020 2020 2020 2020  ory).           
+00008250: 2020 2020 206e 6577 5f73 7562 6469 7220       new_subdir 
+00008260: 3d20 6f73 2e70 6174 682e 6a6f 696e 2874  = os.path.join(t
+00008270: 6172 6765 745f 6469 722c 206f 6c64 5f73  arget_dir, old_s
+00008280: 7562 6469 7229 2069 6620 6f6c 645f 7375  ubdir) if old_su
+00008290: 6264 6972 2021 3d20 272e 2720 656c 7365  bdir != '.' else
+000082a0: 2074 6172 6765 745f 6469 720a 2020 2020   target_dir.    
+000082b0: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
+000082c0: 6972 7328 6e65 775f 7375 6264 6972 2c20  irs(new_subdir, 
+000082d0: 6578 6973 745f 6f6b 3d54 7275 6529 0a20  exist_ok=True). 
+000082e0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+000082f0: 6972 735b 7375 6264 6972 5d20 3d20 6e65  irs[subdir] = ne
+00008300: 775f 7375 6264 6972 0a20 2020 2020 2020  w_subdir.       
+00008310: 206e 616d 652c 205f 203d 206f 732e 7061   name, _ = os.pa
+00008320: 7468 2e73 706c 6974 6578 7428 6669 6c65  th.splitext(file
+00008330: 290a 2020 2020 2020 2020 6966 2073 7566  ).        if suf
+00008340: 6669 7820 6973 206e 6f74 204e 6f6e 653a  fix is not None:
+00008350: 0a20 2020 2020 2020 2020 2020 2066 6e61  .            fna
+00008360: 6d65 203d 2066 227b 6e61 6d65 7d7b 7375  me = f"{name}{su
+00008370: 6666 6978 7d2e 7b74 6172 6765 745f 6578  ffix}.{target_ex
+00008380: 7465 6e73 696f 6e7d 220a 2020 2020 2020  tension}".      
+00008390: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000083a0: 2020 2020 666e 616d 6520 3d20 6622 7b6e      fname = f"{n
+000083b0: 616d 657d 2e7b 7461 7267 6574 5f65 7874  ame}.{target_ext
+000083c0: 656e 7369 6f6e 7d22 0a20 2020 2020 2020  ension}".       
+000083d0: 206f 6c64 203d 206f 732e 7061 7468 2e6a   old = os.path.j
+000083e0: 6f69 6e28 7375 6264 6972 2c20 6669 6c65  oin(subdir, file
+000083f0: 290a 2020 2020 2020 2020 6e65 7720 3d20  ).        new = 
+00008400: 6f73 2e70 6174 682e 6a6f 696e 286e 6577  os.path.join(new
+00008410: 5f73 7562 6469 722c 2066 6e61 6d65 290a  _subdir, fname).
+00008420: 2020 2020 2020 2020 6966 206f 7665 7277          if overw
+00008430: 7269 7465 206f 7220 6e6f 7420 6f73 2e70  rite or not os.p
+00008440: 6174 682e 6973 6669 6c65 286e 6577 293a  ath.isfile(new):
+00008450: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00008460: 7665 7273 696f 6e5f 7061 7261 6d73 2e61  version_params.a
+00008470: 7070 656e 6428 5b64 6963 7428 6f6c 643d  ppend([dict(old=
+00008480: 6f6c 642c 206e 6577 3d6e 6577 2c20 4d53  old, new=new, MS
+00008490: 3d4d 532c 206c 6f67 6765 723d 6c6f 6767  =MS, logger=logg
+000084a0: 6572 295d 290a 2020 2020 2020 2020 656c  er)]).        el
+000084b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000084c0: 6c6f 6767 6572 2e64 6562 7567 286e 6577  logger.debug(new
+000084d0: 2c20 2765 7869 7374 7320 616c 7265 6164  , 'exists alread
+000084e0: 792e 2050 6173 7320 2d6f 2074 6f20 6f76  y. Pass -o to ov
+000084f0: 6572 7772 6974 652e 2729 0a0a 2020 2020  erwrite.')..    
+00008500: 6966 206c 656e 2863 6f6e 7665 7273 696f  if len(conversio
+00008510: 6e5f 7061 7261 6d73 2920 3d3d 2030 3a0a  n_params) == 0:.
+00008520: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
+00008530: 6e66 6f28 6622 4e6f 2066 696c 6573 2074  nfo(f"No files t
+00008540: 6f20 636f 6e76 6572 742e 2229 0a0a 0a20  o convert.")... 
+00008550: 2020 2069 6620 7061 7261 6c6c 656c 3a0a     if parallel:.
+00008560: 2020 2020 2020 2020 706f 6f6c 203d 206d          pool = m
+00008570: 756c 7469 7072 6f63 6573 7369 6e67 2e50  ultiprocessing.P
+00008580: 6f6f 6c28 6d75 6c74 6970 726f 6365 7373  ool(multiprocess
+00008590: 696e 672e 6370 755f 636f 756e 7428 2929  ing.cpu_count())
+000085a0: 0a20 2020 2020 2020 2070 6f6f 6c2e 7374  .        pool.st
+000085b0: 6172 6d61 7028 5f63 6f6e 7665 7274 5f6b  armap(_convert_k
+000085c0: 7761 7267 732c 2063 6f6e 7665 7273 696f  wargs, conversio
+000085d0: 6e5f 7061 7261 6d73 290a 2020 2020 2020  n_params).      
+000085e0: 2020 706f 6f6c 2e63 6c6f 7365 2829 0a20    pool.close(). 
+000085f0: 2020 2020 2020 2070 6f6f 6c2e 6a6f 696e         pool.join
+00008600: 2829 0a20 2020 2065 6c73 653a 0a20 2020  ().    else:.   
+00008610: 2020 2020 2066 6f72 206f 6c64 2c20 6e65       for old, ne
+00008620: 772c 204d 5320 696e 2063 6f6e 7665 7273  w, MS in convers
+00008630: 696f 6e5f 7061 7261 6d73 3a0a 2020 2020  ion_params:.    
+00008640: 2020 2020 2020 2020 636f 6e76 6572 7428          convert(
+00008650: 6f6c 643d 6f6c 642c 206e 6577 3d6e 6577  old=old, new=new
+00008660: 2c20 4d53 3d4d 532c 206c 6f67 6765 723d  , MS=MS, logger=
+00008670: 6c6f 6767 6572 290a 0a0a 4066 756e 6374  logger)...@funct
+00008680: 696f 6e5f 6c6f 6767 6572 0a64 6566 2064  ion_logger.def d
+00008690: 6563 6f64 655f 6861 726d 6f6e 6965 7328  ecode_harmonies(
+000086a0: 6466 2c20 6c61 6265 6c5f 636f 6c3d 276c  df, label_col='l
+000086b0: 6162 656c 272c 206b 6565 705f 6c61 7965  abel', keep_laye
+000086c0: 723d 5472 7565 2c20 7265 7475 726e 5f73  r=True, return_s
+000086d0: 6572 6965 733d 4661 6c73 652c 2061 6c74  eries=False, alt
+000086e0: 5f63 6f6c 733d 2761 6c74 5f6c 6162 656c  _cols='alt_label
+000086f0: 272c 2061 6c74 5f73 6570 6172 6174 6f72  ', alt_separator
+00008700: 3d27 2d27 293a 0a20 2020 2022 2222 4d75  ='-'):.    """Mu
+00008710: 7365 5363 6f72 6520 7374 6f72 6573 2074  seScore stores t
+00008720: 7970 6573 2032 2028 4e61 7368 7669 6c6c  ypes 2 (Nashvill
+00008730: 6529 2061 6e64 2033 2028 6162 736f 6c75  e) and 3 (absolu
+00008740: 7465 2063 686f 7264 7329 2069 6e20 7365  te chords) in se
+00008750: 7665 7261 6c20 636f 6c75 6d6e 732e 2054  veral columns. T
+00008760: 6869 7320 6675 6e63 7469 6f6e 2072 6574  his function ret
+00008770: 7572 6e73 2061 2063 6f70 7920 6f66 0a20  urns a copy of. 
+00008780: 2020 2074 6865 2044 6174 6146 7261 6d65     the DataFrame
+00008790: 2060 6041 6e6e 6f74 6174 696f 6e73 2e64   ``Annotations.d
+000087a0: 6660 6020 7768 6572 6520 7468 6520 6c61  f`` where the la
+000087b0: 6265 6c20 636f 6c75 6d6e 2063 6f6e 7461  bel column conta
+000087c0: 696e 7320 7468 6520 7374 7269 6e67 7320  ins the strings 
+000087d0: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
+000087e0: 2074 6865 7365 2063 6f6c 756d 6e73 2e0a   these columns..
+000087f0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+00008800: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00008810: 2020 2064 6620 3a20 3a6f 626a 3a60 7061     df : :obj:`pa
+00008820: 6e64 6173 2e44 6174 6146 7261 6d65 600a  ndas.DataFrame`.
+00008830: 2020 2020 2020 2020 4461 7461 4672 616d          DataFram
+00008840: 6520 7769 7468 2065 6e63 6f64 6564 2068  e with encoded h
+00008850: 6172 6d6f 6e79 206c 6162 656c 7320 6173  armony labels as
+00008860: 2073 746f 7265 6420 696e 2061 6e20 3a6f   stored in an :o
+00008870: 626a 3a60 416e 6e6f 7461 7469 6f6e 7360  bj:`Annotations`
+00008880: 206f 626a 6563 742e 0a20 2020 206c 6162   object..    lab
+00008890: 656c 5f63 6f6c 203a 203a 6f62 6a3a 6073  el_col : :obj:`s
+000088a0: 7472 602c 206f 7074 696f 6e61 6c0a 2020  tr`, optional.  
+000088b0: 2020 2020 2020 436f 6c75 6d6e 206e 616d        Column nam
+000088c0: 6520 7768 6572 6520 7468 6520 6d61 696e  e where the main
+000088d0: 2063 6f6d 706f 6e65 6e74 7320 283c 6e61   components (<na
+000088e0: 6d65 3e20 7461 6729 2061 7265 2073 746f  me> tag) are sto
+000088f0: 7265 642c 2064 6566 6175 6c74 7320 746f  red, defaults to
+00008900: 2027 6c61 6265 6c27 0a20 2020 206b 6565   'label'.    kee
+00008910: 705f 6c61 7965 7220 3a20 3a6f 626a 3a60  p_layer : :obj:`
+00008920: 626f 6f6c 602c 206f 7074 696f 6e61 6c0a  bool`, optional.
+00008930: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
+00008940: 2074 6f20 5472 7565 2c20 7265 7461 696e   to True, retain
+00008950: 696e 6720 7468 6520 2768 6172 6d6f 6e79  ing the 'harmony
+00008960: 5f6c 6179 6572 2720 636f 6c75 6d6e 2077  _layer' column w
+00008970: 6974 6820 6f72 6967 696e 616c 206c 6179  ith original lay
+00008980: 6572 732e 0a20 2020 2072 6574 7572 6e5f  ers..    return_
+00008990: 7365 7269 6573 203a 203a 6f62 6a3a 6062  series : :obj:`b
+000089a0: 6f6f 6c60 2c20 6f70 7469 6f6e 616c 0a20  ool`, optional. 
+000089b0: 2020 2020 2020 2049 6620 7365 7420 746f         If set to
+000089c0: 2054 7275 652c 206f 6e6c 7920 7468 6520   True, only the 
+000089d0: 6465 636f 6465 6420 6c61 6265 6c73 2063  decoded labels c
+000089e0: 6f6c 756d 6e20 6973 2072 6574 7572 6e65  olumn is returne
+000089f0: 6420 6173 2061 2053 6572 6965 7320 7261  d as a Series ra
+00008a00: 7468 6572 2074 6861 6e20 6120 636f 7079  ther than a copy
+00008a10: 206f 6620 6060 6466 6060 2e0a 2020 2020   of ``df``..    
+00008a20: 616c 745f 636f 6c73 203a 203a 6f62 6a3a  alt_cols : :obj:
+00008a30: 6073 7472 6020 6f72 203a 6f62 6a3a 606c  `str` or :obj:`l
+00008a40: 6973 7460 2c20 6f70 7469 6f6e 616c 0a20  ist`, optional. 
+00008a50: 2020 2020 2020 2043 6f6c 756d 6e28 7329         Column(s)
+00008a60: 2077 6974 6820 616c 7465 726e 6174 6976   with alternativ
+00008a70: 6520 6c61 6265 6c73 2074 6861 7420 6172  e labels that ar
+00008a80: 6520 6a6f 696e 6564 2077 6974 6820 7468  e joined with th
+00008a90: 6520 6c61 6265 6c20 636f 6c75 6d6e 7320  e label columns 
+00008aa0: 7573 696e 6720 6060 616c 745f 7365 7061  using ``alt_sepa
+00008ab0: 7261 746f 7260 602e 2044 6566 6175 6c74  rator``. Default
+00008ac0: 7320 746f 0a20 2020 2020 2020 2027 616c  s to.        'al
+00008ad0: 745f 6c61 6265 6c27 2e20 5375 7070 7265  t_label'. Suppre
+00008ae0: 7373 2062 7920 7061 7373 696e 6720 4e6f  ss by passing No
+00008af0: 6e65 2e0a 2020 2020 616c 745f 7365 7061  ne..    alt_sepa
+00008b00: 7261 746f 723a 203a 6f62 6a3a 6073 7472  rator: :obj:`str
+00008b10: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
+00008b20: 2020 2020 5365 7061 7261 746f 7220 666f      Separator fo
+00008b30: 7220 6a6f 696e 696e 6720 6060 616c 745f  r joining ``alt_
+00008b40: 636f 6c73 6060 2e0a 0a20 2020 2052 6574  cols``...    Ret
+00008b50: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+00008b60: 0a20 2020 203a 6f62 6a3a 6070 616e 6461  .    :obj:`panda
+00008b70: 732e 4461 7461 4672 616d 6560 206f 7220  s.DataFrame` or 
+00008b80: 3a6f 626a 3a60 7061 6e64 6173 2e53 6572  :obj:`pandas.Ser
+00008b90: 6965 7360 0a20 2020 2020 2020 2044 6563  ies`.        Dec
+00008ba0: 6f64 6564 2068 6172 6d6f 6e79 206c 6162  oded harmony lab
+00008bb0: 656c 732e 0a20 2020 2022 2222 0a20 2020  els..    """.   
+00008bc0: 2064 6620 3d20 6466 2e63 6f70 7928 290a   df = df.copy().
+00008bd0: 2020 2020 6472 6f70 5f63 6f6c 732c 2063      drop_cols, c
+00008be0: 6f6d 706f 7365 5f6c 6162 656c 203d 205b  ompose_label = [
+00008bf0: 5d2c 205b 5d0a 2020 2020 6966 2027 6e61  ], [].    if 'na
+00008c00: 7368 7669 6c6c 6527 2069 6e20 6466 2e63  shville' in df.c
+00008c10: 6f6c 756d 6e73 3a0a 2020 2020 2020 2020  olumns:.        
+00008c20: 7365 6c20 3d20 6466 2e6e 6173 6876 696c  sel = df.nashvil
+00008c30: 6c65 2e6e 6f74 6e61 2829 0a20 2020 2020  le.notna().     
+00008c40: 2020 2064 662e 6c6f 635b 7365 6c2c 206c     df.loc[sel, l
+00008c50: 6162 656c 5f63 6f6c 5d20 3d20 6466 2e6c  abel_col] = df.l
+00008c60: 6f63 5b73 656c 2c20 276e 6173 6876 696c  oc[sel, 'nashvil
+00008c70: 6c65 275d 2e61 7374 7970 6528 7374 7229  le'].astype(str)
+00008c80: 202b 2064 662e 6c6f 635b 7365 6c2c 206c   + df.loc[sel, l
+00008c90: 6162 656c 5f63 6f6c 5d2e 7265 706c 6163  abel_col].replac
+00008ca0: 6528 272f 272c 2027 2729 0a20 2020 2020  e('/', '').     
+00008cb0: 2020 2064 726f 705f 636f 6c73 2e61 7070     drop_cols.app
+00008cc0: 656e 6428 276e 6173 6876 696c 6c65 2729  end('nashville')
+00008cd0: 0a20 2020 2069 6620 276c 6566 7450 6172  .    if 'leftPar
+00008ce0: 656e 2720 696e 2064 662e 636f 6c75 6d6e  en' in df.column
+00008cf0: 733a 0a20 2020 2020 2020 2064 662e 6c65  s:.        df.le
+00008d00: 6674 5061 7265 6e2e 7265 706c 6163 6528  ftParen.replace(
+00008d10: 272f 272c 2027 2827 2c20 696e 706c 6163  '/', '(', inplac
+00008d20: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+00008d30: 636f 6d70 6f73 655f 6c61 6265 6c2e 6170  compose_label.ap
+00008d40: 7065 6e64 2827 6c65 6674 5061 7265 6e27  pend('leftParen'
+00008d50: 290a 2020 2020 2020 2020 6472 6f70 5f63  ).        drop_c
+00008d60: 6f6c 732e 6170 7065 6e64 2827 6c65 6674  ols.append('left
+00008d70: 5061 7265 6e27 290a 2020 2020 6966 2027  Paren').    if '
+00008d80: 6162 736f 6c75 7465 5f72 6f6f 7427 2069  absolute_root' i
+00008d90: 6e20 6466 2e63 6f6c 756d 6e73 2061 6e64  n df.columns and
+00008da0: 2064 662e 6162 736f 6c75 7465 5f72 6f6f   df.absolute_roo
+00008db0: 742e 6e6f 746e 6128 292e 616e 7928 293a  t.notna().any():
+00008dc0: 0a20 2020 2020 2020 2073 656c 203d 2064  .        sel = d
+00008dd0: 662e 6162 736f 6c75 7465 5f72 6f6f 742e  f.absolute_root.
+00008de0: 6e6f 746e 6128 290a 2020 2020 2020 2020  notna().        
+00008df0: 726f 6f74 5f61 735f 6e6f 7465 5f6e 616d  root_as_note_nam
+00008e00: 6520 3d20 6669 6674 6873 326e 616d 6528  e = fifths2name(
+00008e10: 6466 2e6c 6f63 5b73 656c 2c20 2761 6273  df.loc[sel, 'abs
+00008e20: 6f6c 7574 655f 726f 6f74 275d 2e74 6f5f  olute_root'].to_
+00008e30: 6c69 7374 2829 2c20 6d73 3d54 7275 652c  list(), ms=True,
+00008e40: 206c 6f67 6765 723d 6c6f 6767 6572 290a   logger=logger).
+00008e50: 2020 2020 2020 2020 6466 2e61 6273 6f6c          df.absol
+00008e60: 7574 655f 726f 6f74 203d 2064 662e 6162  ute_root = df.ab
+00008e70: 736f 6c75 7465 5f72 6f6f 742e 6173 7479  solute_root.asty
+00008e80: 7065 2827 7374 7269 6e67 2729 0a20 2020  pe('string').   
+00008e90: 2020 2020 2064 662e 6c6f 635b 7365 6c2c       df.loc[sel,
+00008ea0: 2027 6162 736f 6c75 7465 5f72 6f6f 7427   'absolute_root'
+00008eb0: 5d20 3d20 726f 6f74 5f61 735f 6e6f 7465  ] = root_as_note
+00008ec0: 5f6e 616d 650a 2020 2020 2020 2020 636f  _name.        co
+00008ed0: 6d70 6f73 655f 6c61 6265 6c2e 6170 7065  mpose_label.appe
+00008ee0: 6e64 2827 6162 736f 6c75 7465 5f72 6f6f  nd('absolute_roo
+00008ef0: 7427 290a 2020 2020 2020 2020 6472 6f70  t').        drop
+00008f00: 5f63 6f6c 732e 6170 7065 6e64 2827 6162  _cols.append('ab
+00008f10: 736f 6c75 7465 5f72 6f6f 7427 290a 2020  solute_root').  
+00008f20: 2020 2020 2020 6966 2027 726f 6f74 4361        if 'rootCa
+00008f30: 7365 2720 696e 2064 662e 636f 6c75 6d6e  se' in df.column
+00008f40: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
+00008f50: 656c 203d 2064 662e 726f 6f74 4361 7365  el = df.rootCase
+00008f60: 2e6e 6f74 6e61 2829 0a20 2020 2020 2020  .notna().       
+00008f70: 2020 2020 2077 6974 6820 7761 726e 696e       with warnin
+00008f80: 6773 2e63 6174 6368 5f77 6172 6e69 6e67  gs.catch_warning
+00008f90: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00008fa0: 2020 2020 2023 2053 6574 7469 6e67 2076       # Setting v
+00008fb0: 616c 7565 7320 696e 2d70 6c61 6365 2069  alues in-place i
+00008fc0: 7320 6669 6e65 2c20 6967 6e6f 7265 2074  s fine, ignore t
+00008fd0: 6865 2077 6172 6e69 6e67 2069 6e20 5061  he warning in Pa
+00008fe0: 6e64 6173 203e 3d20 312e 352e 300a 2020  ndas >= 1.5.0.  
+00008ff0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00009000: 5468 6973 2063 616e 2062 6520 7265 6d6f  This can be remo
+00009010: 7665 642c 2069 6620 5061 6e64 6173 2031  ved, if Pandas 1
+00009020: 2e35 2e30 2064 6f65 7320 6e6f 7420 6e65  .5.0 does not ne
+00009030: 6564 2074 6f20 6265 2073 7570 706f 7274  ed to be support
+00009040: 6564 2061 6e79 206c 6f6e 6765 722e 0a20  ed any longer.. 
+00009050: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009060: 2053 6565 2061 6c73 6f3a 2068 7474 7073   See also: https
+00009070: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
+00009080: 2e63 6f6d 2f71 2f37 3430 3537 3336 372f  .com/q/74057367/
+00009090: 3835 3935 3931 0a20 2020 2020 2020 2020  859591.         
+000090a0: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+000090b0: 6669 6c74 6572 7761 726e 696e 6773 280a  filterwarnings(.
+000090c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090d0: 2020 2020 2269 676e 6f72 6522 2c0a 2020      "ignore",.  
+000090e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090f0: 2020 6361 7465 676f 7279 3d46 7574 7572    category=Futur
+00009100: 6557 6172 6e69 6e67 2c0a 2020 2020 2020  eWarning,.      
+00009110: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00009120: 7373 6167 653d 280a 2020 2020 2020 2020  ssage=(.        
+00009130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009140: 222e 2a77 696c 6c20 6174 7465 6d70 7420  ".*will attempt 
+00009150: 746f 2073 6574 2074 6865 2076 616c 7565  to set the value
+00009160: 7320 696e 706c 6163 6520 696e 7374 6561  s inplace instea
+00009170: 6420 6f66 2061 6c77 6179 7320 7365 7474  d of always sett
+00009180: 696e 6720 6120 6e65 7720 6172 7261 792e  ing a new array.
+00009190: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000091a0: 2020 2020 2020 2020 2020 2022 546f 2072             "To r
+000091b0: 6574 6169 6e20 7468 6520 6f6c 6420 6265  etain the old be
+000091c0: 6861 7669 6f72 2c20 7573 6520 6569 7468  havior, use eith
+000091d0: 6572 2e2a 220a 2020 2020 2020 2020 2020  er.*".          
+000091e0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+000091f0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00009200: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00009210: 662e 6c6f 635b 7365 6c2c 2027 6162 736f  f.loc[sel, 'abso
+00009220: 6c75 7465 5f72 6f6f 7427 5d20 3d20 6466  lute_root'] = df
+00009230: 2e6c 6f63 5b73 656c 2c20 2761 6273 6f6c  .loc[sel, 'absol
+00009240: 7574 655f 726f 6f74 275d 2e73 7472 2e6c  ute_root'].str.l
+00009250: 6f77 6572 2829 0a20 2020 2020 2020 2020  ower().         
+00009260: 2020 2064 726f 705f 636f 6c73 2e61 7070     drop_cols.app
+00009270: 656e 6428 2772 6f6f 7443 6173 6527 290a  end('rootCase').
+00009280: 2020 2020 6966 206c 6162 656c 5f63 6f6c      if label_col
+00009290: 2069 6e20 6466 2e63 6f6c 756d 6e73 3a0a   in df.columns:.
+000092a0: 2020 2020 2020 2020 636f 6d70 6f73 655f          compose_
+000092b0: 6c61 6265 6c2e 6170 7065 6e64 286c 6162  label.append(lab
+000092c0: 656c 5f63 6f6c 290a 2020 2020 6966 2027  el_col).    if '
+000092d0: 6162 736f 6c75 7465 5f62 6173 6527 2069  absolute_base' i
+000092e0: 6e20 6466 2e63 6f6c 756d 6e73 2061 6e64  n df.columns and
+000092f0: 2064 662e 6162 736f 6c75 7465 5f62 6173   df.absolute_bas
+00009300: 652e 6e6f 746e 6128 292e 616e 7928 293a  e.notna().any():
+00009310: 0a20 2020 2020 2020 2073 656c 203d 2064  .        sel = d
+00009320: 662e 6162 736f 6c75 7465 5f62 6173 652e  f.absolute_base.
+00009330: 6e6f 746e 6128 290a 2020 2020 2020 2020  notna().        
+00009340: 6261 7365 5f61 735f 6e6f 7465 5f6e 616d  base_as_note_nam
+00009350: 6520 3d20 6669 6674 6873 326e 616d 6528  e = fifths2name(
+00009360: 6466 2e6c 6f63 5b73 656c 2c20 2761 6273  df.loc[sel, 'abs
+00009370: 6f6c 7574 655f 6261 7365 275d 2e74 6f5f  olute_base'].to_
+00009380: 6c69 7374 2829 2c20 6d73 3d54 7275 652c  list(), ms=True,
+00009390: 206c 6f67 6765 723d 6c6f 6767 6572 290a   logger=logger).
+000093a0: 2020 2020 2020 2020 6466 2e61 6273 6f6c          df.absol
+000093b0: 7574 655f 6261 7365 203d 2064 662e 6162  ute_base = df.ab
+000093c0: 736f 6c75 7465 5f62 6173 652e 6173 7479  solute_base.asty
+000093d0: 7065 2827 7374 7269 6e67 2729 0a20 2020  pe('string').   
+000093e0: 2020 2020 2064 662e 6c6f 635b 7365 6c2c       df.loc[sel,
+000093f0: 2027 6162 736f 6c75 7465 5f62 6173 6527   'absolute_base'
+00009400: 5d20 3d20 6261 7365 5f61 735f 6e6f 7465  ] = base_as_note
+00009410: 5f6e 616d 650a 2020 2020 2020 2020 6466  _name.        df
+00009420: 2e61 6273 6f6c 7574 655f 6261 7365 203d  .absolute_base =
+00009430: 2027 2f27 202b 2064 662e 6162 736f 6c75   '/' + df.absolu
+00009440: 7465 5f62 6173 650a 2020 2020 2020 2020  te_base.        
+00009450: 636f 6d70 6f73 655f 6c61 6265 6c2e 6170  compose_label.ap
+00009460: 7065 6e64 2827 6162 736f 6c75 7465 5f62  pend('absolute_b
+00009470: 6173 6527 290a 2020 2020 2020 2020 6472  ase').        dr
+00009480: 6f70 5f63 6f6c 732e 6170 7065 6e64 2827  op_cols.append('
+00009490: 6162 736f 6c75 7465 5f62 6173 6527 290a  absolute_base').
+000094a0: 2020 2020 6966 2027 7269 6768 7450 6172      if 'rightPar
+000094b0: 656e 2720 696e 2064 662e 636f 6c75 6d6e  en' in df.column
+000094c0: 733a 0a20 2020 2020 2020 2064 662e 7269  s:.        df.ri
+000094d0: 6768 7450 6172 656e 2e72 6570 6c61 6365  ghtParen.replace
+000094e0: 2827 2f27 2c20 2729 272c 2069 6e70 6c61  ('/', ')', inpla
+000094f0: 6365 3d54 7275 6529 0a20 2020 2020 2020  ce=True).       
+00009500: 2063 6f6d 706f 7365 5f6c 6162 656c 2e61   compose_label.a
+00009510: 7070 656e 6428 2772 6967 6874 5061 7265  ppend('rightPare
+00009520: 6e27 290a 2020 2020 2020 2020 6472 6f70  n').        drop
+00009530: 5f63 6f6c 732e 6170 7065 6e64 2827 7269  _cols.append('ri
+00009540: 6768 7450 6172 656e 2729 0a20 2020 206e  ghtParen').    n
+00009550: 6577 5f6c 6162 656c 5f63 6f6c 203d 2064  ew_label_col = d
+00009560: 665b 636f 6d70 6f73 655f 6c61 6265 6c5d  f[compose_label]
+00009570: 2e66 696c 6c6e 6128 2727 292e 7375 6d28  .fillna('').sum(
+00009580: 6178 6973 3d31 292e 6173 7479 7065 2873  axis=1).astype(s
+00009590: 7472 290a 2020 2020 6e65 775f 6c61 6265  tr).    new_labe
+000095a0: 6c5f 636f 6c20 3d20 6e65 775f 6c61 6265  l_col = new_labe
+000095b0: 6c5f 636f 6c2e 7374 722e 7265 706c 6163  l_col.str.replac
+000095c0: 6528 275e 2f24 272c 2027 656d 7074 795f  e('^/$', 'empty_
+000095d0: 6861 726d 6f6e 7927 2c20 7265 6765 783d  harmony', regex=
+000095e0: 5472 7565 292e 7265 706c 6163 6528 2727  True).replace(''
+000095f0: 2c20 7064 2e4e 4129 0a0a 2020 2020 6966  , pd.NA)..    if
+00009600: 2061 6c74 5f63 6f6c 7320 6973 206e 6f74   alt_cols is not
+00009610: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
+00009620: 6620 6973 696e 7374 616e 6365 2861 6c74  f isinstance(alt
+00009630: 5f63 6f6c 732c 2073 7472 293a 0a20 2020  _cols, str):.   
+00009640: 2020 2020 2020 2020 2061 6c74 5f63 6f6c           alt_col
+00009650: 7320 3d20 5b61 6c74 5f63 6f6c 735d 0a20  s = [alt_cols]. 
+00009660: 2020 2020 2020 2070 7265 7365 6e74 203d         present =
+00009670: 205b 6320 666f 7220 6320 696e 2061 6c74   [c for c in alt
+00009680: 5f63 6f6c 7320 6966 2063 2069 6e20 6466  _cols if c in df
+00009690: 2e63 6f6c 756d 6e73 5d0a 2020 2020 2020  .columns].      
+000096a0: 2020 6966 206c 656e 2870 7265 7365 6e74    if len(present
+000096b0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+000096c0: 2020 2061 6c74 5f6a 6f69 6e65 6420 3d20     alt_joined = 
+000096d0: 7064 2e53 6572 6965 7328 2727 2c20 696e  pd.Series('', in
+000096e0: 6465 783d 6e65 775f 6c61 6265 6c5f 636f  dex=new_label_co
+000096f0: 6c2e 696e 6465 7829 0a20 2020 2020 2020  l.index).       
+00009700: 2020 2020 2066 6f72 2063 2069 6e20 7072       for c in pr
+00009710: 6573 656e 743a 0a20 2020 2020 2020 2020  esent:.         
+00009720: 2020 2020 2020 2061 6c74 5f6a 6f69 6e65         alt_joine
+00009730: 6420 2b3d 2028 616c 745f 7365 7061 7261  d += (alt_separa
+00009740: 746f 7220 2b20 6466 5b63 5d29 2e66 696c  tor + df[c]).fil
+00009750: 6c6e 6128 2727 290a 2020 2020 2020 2020  lna('').        
+00009760: 2020 2020 6e65 775f 6c61 6265 6c5f 636f      new_label_co
+00009770: 6c20 2b3d 2061 6c74 5f6a 6f69 6e65 640a  l += alt_joined.
+00009780: 0a20 2020 2069 6620 7265 7475 726e 5f73  .    if return_s
+00009790: 6572 6965 733a 0a20 2020 2020 2020 2072  eries:.        r
+000097a0: 6574 7572 6e20 6e65 775f 6c61 6265 6c5f  eturn new_label_
+000097b0: 636f 6c0a 0a20 2020 2069 6620 2768 6172  col..    if 'har
+000097c0: 6d6f 6e79 5f6c 6179 6572 2720 696e 2064  mony_layer' in d
+000097d0: 662e 636f 6c75 6d6e 7320 616e 6420 6e6f  f.columns and no
+000097e0: 7420 6b65 6570 5f6c 6179 6572 3a0a 2020  t keep_layer:.  
+000097f0: 2020 2020 2020 6472 6f70 5f63 6f6c 732e        drop_cols.
+00009800: 6170 7065 6e64 2827 6861 726d 6f6e 795f  append('harmony_
+00009810: 6c61 7965 7227 290a 2020 2020 6466 5b6c  layer').    df[l
+00009820: 6162 656c 5f63 6f6c 5d20 3d20 6e65 775f  abel_col] = new_
+00009830: 6c61 6265 6c5f 636f 6c0a 2020 2020 6466  label_col.    df
+00009840: 2e64 726f 7028 636f 6c75 6d6e 733d 6472  .drop(columns=dr
+00009850: 6f70 5f63 6f6c 732c 2069 6e70 6c61 6365  op_cols, inplace
+00009860: 3d54 7275 6529 0a20 2020 2072 6574 7572  =True).    retur
+00009870: 6e20 6466 0a0a 0a64 6566 2064 6632 6d64  n df...def df2md
+00009880: 2864 663a 2070 642e 4461 7461 4672 616d  (df: pd.DataFram
+00009890: 652c 206e 616d 653a 2073 7472 203d 2022  e, name: str = "
+000098a0: 4f76 6572 7669 6577 2229 202d 3e20 4d61  Overview") -> Ma
+000098b0: 726b 646f 776e 5461 626c 6557 7269 7465  rkdownTableWrite
+000098c0: 723a 0a20 2020 2022 2222 2054 7572 6e73  r:.    """ Turns
+000098d0: 2061 2044 6174 6146 7261 6d65 2069 6e74   a DataFrame int
+000098e0: 6f20 6120 4d61 726b 446f 776e 2074 6162  o a MarkDown tab
+000098f0: 6c65 2e20 5468 6520 7265 7475 726e 6564  le. The returned
+00009900: 2077 7269 7465 7220 6361 6e20 6265 2063   writer can be c
+00009910: 6f6e 7665 7274 6564 2069 6e74 6f20 6120  onverted into a 
+00009920: 7374 7269 6e67 2e0a 2020 2020 2222 220a  string..    """.
+00009930: 2020 2020 7772 6974 6572 203d 204d 6172      writer = Mar
+00009940: 6b64 6f77 6e54 6162 6c65 5772 6974 6572  kdownTableWriter
+00009950: 2829 0a20 2020 2077 7269 7465 722e 7461  ().    writer.ta
+00009960: 626c 655f 6e61 6d65 203d 206e 616d 650a  ble_name = name.
+00009970: 2020 2020 7772 6974 6572 2e68 6561 6465      writer.heade
+00009980: 725f 6c69 7374 203d 206c 6973 7428 6466  r_list = list(df
+00009990: 2e63 6f6c 756d 6e73 2e76 616c 7565 7329  .columns.values)
+000099a0: 0a20 2020 2077 7269 7465 722e 7661 6c75  .    writer.valu
+000099b0: 655f 6d61 7472 6978 203d 2064 662e 7661  e_matrix = df.va
+000099c0: 6c75 6573 2e74 6f6c 6973 7428 290a 2020  lues.tolist().  
+000099d0: 2020 7265 7475 726e 2077 7269 7465 720a    return writer.
+000099e0: 0a0a 6465 6620 6469 6374 326f 6e65 6c69  ..def dict2oneli
+000099f0: 6e65 7228 6429 3a0a 2020 2020 2222 2220  ner(d):.    """ 
+00009a00: 5475 726e 7320 6120 6469 6374 696f 6e61  Turns a dictiona
+00009a10: 7279 2069 6e74 6f20 6120 7369 6e67 6c65  ry into a single
+00009a20: 2d6c 696e 6520 7374 7269 6e67 2077 6974  -line string wit
+00009a30: 686f 7574 2062 7261 636b 6574 732e 2222  hout brackets.""
+00009a40: 220a 2020 2020 7265 7475 726e 2027 2c20  ".    return ', 
+00009a50: 272e 6a6f 696e 2866 227b 6b7d 3a20 7b76  '.join(f"{k}: {v
+00009a60: 7d22 2066 6f72 206b 2c20 7620 696e 2064  }" for k, v in d
+00009a70: 2e69 7465 6d73 2829 290a 0a40 6675 6e63  .items())..@func
+00009a80: 7469 6f6e 5f6c 6f67 6765 720a 6465 6620  tion_logger.def 
+00009a90: 7265 736f 6c76 655f 666f 726d 5f61 6262  resolve_form_abb
+00009aa0: 7265 7669 6174 696f 6e73 2874 6f6b 656e  reviations(token
+00009ab0: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
+00009ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ad0: 2020 2020 2020 6162 6272 6576 6961 7469        abbreviati
+00009ae0: 6f6e 733a 2064 6963 742c 0a20 2020 2020  ons: dict,.     
+00009af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b00: 2020 2020 2020 2020 2020 6d63 3a20 4f70            mc: Op
+00009b10: 7469 6f6e 616c 5b55 6e69 6f6e 5b69 6e74  tional[Union[int
+00009b20: 2c20 7374 725d 5d20 3d20 4e6f 6e65 2c0a  , str]] = None,.
+00009b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00009b50: 616c 6c62 6163 6b5f 746f 5f6c 6f77 6572  allback_to_lower
+00009b60: 6361 7365 3a20 626f 6f6c 203d 2054 7275  case: bool = Tru
+00009b70: 6529 202d 3e20 7374 723a 0a20 2020 2022  e) -> str:.    "
+00009b80: 2222 2043 6865 636b 7320 666f 7220 6561  "" Checks for ea
+00009b90: 6368 2063 6f6e 7365 6375 7469 7665 2073  ch consecutive s
+00009ba0: 7562 7374 7269 6e67 206f 6620 7468 6520  ubstring of the 
+00009bb0: 746f 6b65 6e20 6966 2069 7420 6d61 7463  token if it matc
+00009bc0: 6865 7320 6f6e 6520 6f66 2074 6865 2067  hes one of the g
+00009bd0: 6976 656e 2061 6262 7265 7669 6174 696f  iven abbreviatio
+00009be0: 6e73 2061 6e64 2072 6570 6c61 6365 730a  ns and replaces.
+00009bf0: 2020 2020 6974 2077 6974 6820 7468 6520      it with the 
+00009c00: 636f 7272 6573 706f 6e64 696e 6720 6c6f  corresponding lo
+00009c10: 6e67 206e 616d 652e 2054 7261 696c 696e  ng name. Trailin
+00009c20: 6720 6e75 6d62 6572 7320 6172 6520 7365  g numbers are se
+00009c30: 7061 7261 7465 6420 6279 2061 2073 7061  parated by a spa
+00009c40: 6365 2069 6e20 7468 6973 2063 6173 652e  ce in this case.
+00009c50: 0a20 2020 200a 2020 2020 4172 6773 3a0a  .    .    Args:.
+00009c60: 2020 2020 2020 746f 6b65 6e3a 2049 6e64        token: Ind
+00009c70: 6976 6964 7561 6c20 746f 6b65 6e20 6166  ividual token af
+00009c80: 7465 7220 7370 6c69 7474 696e 6720 616c  ter splitting al
+00009c90: 7465 726e 6174 6976 6520 7265 6164 696e  ternative readin
+00009ca0: 6773 2e0a 2020 2020 2020 6162 6272 6576  gs..      abbrev
+00009cb0: 6961 7469 6f6e 733a 207b 6162 6272 6576  iations: {abbrev
+00009cc0: 6961 7469 6f6e 202d 3e20 6c6f 6e67 206e  iation -> long n
+00009cd0: 616d 657d 2064 6963 7420 666f 7220 7374  ame} dict for st
+00009ce0: 7269 6e67 2072 6570 6c61 6365 6d65 6e74  ring replacement
+00009cf0: 2e0a 2020 2020 2020 6661 6c6c 6261 636b  ..      fallback
+00009d00: 5f74 6f5f 6c6f 7765 7263 6173 653a 2042  _to_lowercase: B
+00009d10: 7920 6465 6661 756c 742c 2074 6865 2073  y default, the s
+00009d20: 7562 7374 7269 6e67 7320 6172 6520 6368  ubstrings are ch
+00009d30: 6563 6b65 6420 6167 6169 6e73 7420 7468  ecked against th
+00009d40: 6520 6469 6374 696f 6e61 7279 206b 6579  e dictionary key
+00009d50: 7320 616e 642c 2069 6620 756e 7375 6363  s and, if unsucc
+00009d60: 6573 7366 756c 2c0a 2020 2020 2020 2020  essful,.        
+00009d70: 2020 6167 6169 6e20 696e 206c 6f77 6572    again in lower
+00009d80: 6361 7365 2e20 5061 7373 2046 616c 7365  case. Pass False
+00009d90: 2074 6f20 7573 6520 6f6e 6c79 2074 6865   to use only the
+00009da0: 206f 7269 6769 6e61 6c20 7374 7269 6e67   original string
+00009db0: 2e0a 0a20 2020 2052 6574 7572 6e73 3a0a  ...    Returns:.
+00009dc0: 0a20 2020 2022 2222 0a20 2020 206d 635f  .    """.    mc_
+00009dd0: 7374 7269 6e67 203d 2027 2720 6966 206d  string = '' if m
+00009de0: 6320 6973 204e 6f6e 6520 656c 7365 2066  c is None else f
+00009df0: 224d 4320 7b6d 637d 3a20 220a 2020 2020  "MC {mc}: ".    
+00009e00: 6966 2027 2c27 2069 6e20 746f 6b65 6e3a  if ',' in token:
+00009e10: 0a20 2020 2020 2020 206c 6f67 6765 722e  .        logger.
+00009e20: 7761 726e 696e 6728 6622 7b6d 635f 7374  warning(f"{mc_st
+00009e30: 7269 6e67 7d27 7b74 6f6b 656e 7d27 2063  ring}'{token}' c
+00009e40: 6f6e 7461 696e 7320 6120 636f 6d6d 612c  ontains a comma,
+00009e50: 2077 6869 6368 206d 6967 6874 2072 6573   which might res
+00009e60: 756c 7420 6672 6f6d 2061 2073 796e 7461  ult from a synta
+00009e70: 7820 6572 726f 722e 2229 0a20 2020 2073  x error.").    s
+00009e80: 7562 5f63 6f6d 706f 6e65 6e74 5f72 6567  ub_component_reg
+00009e90: 6578 203d 2072 225c 572b 220a 2020 2020  ex = r"\W+".    
+00009ea0: 656e 6473 5f6f 6e5f 6e75 6d62 6572 735f  ends_on_numbers_
+00009eb0: 7265 6765 7820 3d20 7222 5c64 2b24 220a  regex = r"\d+$".
+00009ec0: 2020 2020 7265 736f 6c76 6564 5f73 7562      resolved_sub
+00009ed0: 7374 7269 6e67 7320 3d20 5b5d 0a20 2020  strings = [].   
+00009ee0: 2066 6f72 206f 7269 6769 6e61 6c5f 7375   for original_su
+00009ef0: 6273 7472 696e 6720 696e 2072 652e 7370  bstring in re.sp
+00009f00: 6c69 7428 7375 625f 636f 6d70 6f6e 656e  lit(sub_componen
+00009f10: 745f 7265 6765 782c 2074 6f6b 656e 293a  t_regex, token):
+00009f20: 0a20 2020 2020 2020 2074 7261 696c 696e  .        trailin
+00009f30: 675f 6e75 6d62 6572 735f 6d61 7463 6820  g_numbers_match 
+00009f40: 3d20 7265 2e73 6561 7263 6828 656e 6473  = re.search(ends
+00009f50: 5f6f 6e5f 6e75 6d62 6572 735f 7265 6765  _on_numbers_rege
+00009f60: 782c 206f 7269 6769 6e61 6c5f 7375 6273  x, original_subs
+00009f70: 7472 696e 6729 0a20 2020 2020 2020 2069  tring).        i
+00009f80: 6620 7472 6169 6c69 6e67 5f6e 756d 6265  f trailing_numbe
+00009f90: 7273 5f6d 6174 6368 2069 7320 4e6f 6e65  rs_match is None
+00009fa0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+00009fb0: 6169 6c69 6e67 5f6e 756d 6265 7273 203d  ailing_numbers =
+00009fc0: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
+00009fd0: 7375 6273 7472 696e 6720 3d20 6f72 6967  substring = orig
+00009fe0: 696e 616c 5f73 7562 7374 7269 6e67 0a20  inal_substring. 
+00009ff0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000a000: 2020 2020 2020 2020 2074 7261 696c 696e           trailin
+0000a010: 675f 6e75 6d62 6572 735f 706f 7369 7469  g_numbers_positi
+0000a020: 6f6e 203d 2074 7261 696c 696e 675f 6e75  on = trailing_nu
+0000a030: 6d62 6572 735f 6d61 7463 682e 7374 6172  mbers_match.star
+0000a040: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0000a050: 6966 2074 7261 696c 696e 675f 6e75 6d62  if trailing_numb
+0000a060: 6572 735f 706f 7369 7469 6f6e 203d 3d20  ers_position == 
+0000a070: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0000a080: 2020 2023 2074 6f6b 656e 2069 7320 6a75     # token is ju
+0000a090: 7374 2061 206e 756d 6265 720a 2020 2020  st a number.    
+0000a0a0: 2020 2020 2020 2020 2020 2020 7265 736f              reso
+0000a0b0: 6c76 6564 5f73 7562 7374 7269 6e67 732e  lved_substrings.
+0000a0c0: 6170 7065 6e64 286f 7269 6769 6e61 6c5f  append(original_
+0000a0d0: 7375 6273 7472 696e 6729 0a20 2020 2020  substring).     
+0000a0e0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0000a0f0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
 0000a100: 7472 6169 6c69 6e67 5f6e 756d 6265 7273  trailing_numbers
-0000a110: 5f6d 6174 6368 2e67 726f 7570 2829 0a20  _match.group(). 
-0000a120: 2020 2020 2020 2020 2020 2073 7562 7374             subst
-0000a130: 7269 6e67 203d 206f 7269 6769 6e61 6c5f  ring = original_
-0000a140: 7375 6273 7472 696e 675b 3a74 7261 696c  substring[:trail
-0000a150: 696e 675f 6e75 6d62 6572 735f 706f 7369  ing_numbers_posi
-0000a160: 7469 6f6e 5d0a 2020 2020 2020 2020 6c6f  tion].        lo
-0000a170: 7765 7263 6173 6520 3d20 7375 6273 7472  wercase = substr
-0000a180: 696e 672e 6c6f 7765 7228 290a 2020 2020  ing.lower().    
-0000a190: 2020 2020 6368 6563 6b5f 6c6f 7765 7220      check_lower 
-0000a1a0: 3d20 6661 6c6c 6261 636b 5f74 6f5f 6c6f  = fallback_to_lo
-0000a1b0: 7765 7263 6173 6520 616e 6420 286c 6f77  wercase and (low
-0000a1c0: 6572 6361 7365 2021 3d20 7375 6273 7472  ercase != substr
-0000a1d0: 696e 6729 0a20 2020 2020 2020 2069 6620  ing).        if 
-0000a1e0: 7375 6273 7472 696e 6720 696e 2061 6262  substring in abb
-0000a1f0: 7265 7669 6174 696f 6e73 3a0a 2020 2020  reviations:.    
-0000a200: 2020 2020 2020 2020 7265 736f 6c76 6564          resolved
-0000a210: 203d 2061 6262 7265 7669 6174 696f 6e73   = abbreviations
-0000a220: 5b73 7562 7374 7269 6e67 5d20 2b20 7472  [substring] + tr
-0000a230: 6169 6c69 6e67 5f6e 756d 6265 7273 0a20  ailing_numbers. 
-0000a240: 2020 2020 2020 2065 6c69 6620 6368 6563         elif chec
-0000a250: 6b5f 6c6f 7765 7220 616e 6420 6c6f 7765  k_lower and lowe
-0000a260: 7263 6173 6520 696e 2061 6262 7265 7669  rcase in abbrevi
-0000a270: 6174 696f 6e73 3a0a 2020 2020 2020 2020  ations:.        
-0000a280: 2020 2020 7265 736f 6c76 6564 203d 2061      resolved = a
-0000a290: 6262 7265 7669 6174 696f 6e73 5b6c 6f77  bbreviations[low
-0000a2a0: 6572 6361 7365 5d20 2b20 7472 6169 6c69  ercase] + traili
-0000a2b0: 6e67 5f6e 756d 6265 7273 0a20 2020 2020  ng_numbers.     
-0000a2c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000a2d0: 2020 2020 2072 6573 6f6c 7665 6420 3d20       resolved = 
-0000a2e0: 6f72 6967 696e 616c 5f73 7562 7374 7269  original_substri
-0000a2f0: 6e67 0a20 2020 2020 2020 2072 6573 6f6c  ng.        resol
-0000a300: 7665 645f 7375 6273 7472 696e 6773 2e61  ved_substrings.a
-0000a310: 7070 656e 6428 7265 736f 6c76 6564 290a  ppend(resolved).
-0000a320: 2020 2020 7265 7475 726e 2027 272e 6a6f      return ''.jo
-0000a330: 696e 2873 7562 7374 7269 6e67 202b 2073  in(substring + s
-0000a340: 6570 6172 6174 6f72 2066 6f72 2073 7562  eparator for sub
-0000a350: 7374 7269 6e67 2c20 7365 7061 7261 746f  string, separato
-0000a360: 7220 696e 207a 6970 2872 6573 6f6c 7665  r in zip(resolve
-0000a370: 645f 7375 6273 7472 696e 6773 2c0a 2020  d_substrings,.  
-0000a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a110: 203d 2022 2022 202b 2074 7261 696c 696e   = " " + trailin
+0000a120: 675f 6e75 6d62 6572 735f 6d61 7463 682e  g_numbers_match.
+0000a130: 6772 6f75 7028 290a 2020 2020 2020 2020  group().        
+0000a140: 2020 2020 7375 6273 7472 696e 6720 3d20      substring = 
+0000a150: 6f72 6967 696e 616c 5f73 7562 7374 7269  original_substri
+0000a160: 6e67 5b3a 7472 6169 6c69 6e67 5f6e 756d  ng[:trailing_num
+0000a170: 6265 7273 5f70 6f73 6974 696f 6e5d 0a20  bers_position]. 
+0000a180: 2020 2020 2020 206c 6f77 6572 6361 7365         lowercase
+0000a190: 203d 2073 7562 7374 7269 6e67 2e6c 6f77   = substring.low
+0000a1a0: 6572 2829 0a20 2020 2020 2020 2063 6865  er().        che
+0000a1b0: 636b 5f6c 6f77 6572 203d 2066 616c 6c62  ck_lower = fallb
+0000a1c0: 6163 6b5f 746f 5f6c 6f77 6572 6361 7365  ack_to_lowercase
+0000a1d0: 2061 6e64 2028 6c6f 7765 7263 6173 6520   and (lowercase 
+0000a1e0: 213d 2073 7562 7374 7269 6e67 290a 2020  != substring).  
+0000a1f0: 2020 2020 2020 6966 2073 7562 7374 7269        if substri
+0000a200: 6e67 2069 6e20 6162 6272 6576 6961 7469  ng in abbreviati
+0000a210: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
+0000a220: 2072 6573 6f6c 7665 6420 3d20 6162 6272   resolved = abbr
+0000a230: 6576 6961 7469 6f6e 735b 7375 6273 7472  eviations[substr
+0000a240: 696e 675d 202b 2074 7261 696c 696e 675f  ing] + trailing_
+0000a250: 6e75 6d62 6572 730a 2020 2020 2020 2020  numbers.        
+0000a260: 656c 6966 2063 6865 636b 5f6c 6f77 6572  elif check_lower
+0000a270: 2061 6e64 206c 6f77 6572 6361 7365 2069   and lowercase i
+0000a280: 6e20 6162 6272 6576 6961 7469 6f6e 733a  n abbreviations:
+0000a290: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000a2a0: 6f6c 7665 6420 3d20 6162 6272 6576 6961  olved = abbrevia
+0000a2b0: 7469 6f6e 735b 6c6f 7765 7263 6173 655d  tions[lowercase]
+0000a2c0: 202b 2074 7261 696c 696e 675f 6e75 6d62   + trailing_numb
+0000a2d0: 6572 730a 2020 2020 2020 2020 656c 7365  ers.        else
+0000a2e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000a2f0: 736f 6c76 6564 203d 206f 7269 6769 6e61  solved = origina
+0000a300: 6c5f 7375 6273 7472 696e 670a 2020 2020  l_substring.    
+0000a310: 2020 2020 7265 736f 6c76 6564 5f73 7562      resolved_sub
+0000a320: 7374 7269 6e67 732e 6170 7065 6e64 2872  strings.append(r
+0000a330: 6573 6f6c 7665 6429 0a20 2020 2072 6574  esolved).    ret
+0000a340: 7572 6e20 2727 2e6a 6f69 6e28 7375 6273  urn ''.join(subs
+0000a350: 7472 696e 6720 2b20 7365 7061 7261 746f  tring + separato
+0000a360: 7220 666f 7220 7375 6273 7472 696e 672c  r for substring,
+0000a370: 2073 6570 6172 6174 6f72 2069 6e20 7a69   separator in zi
+0000a380: 7028 7265 736f 6c76 6564 5f73 7562 7374  p(resolved_subst
+0000a390: 7269 6e67 732c 0a20 2020 2020 2020 2020  rings,.         
 0000a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3c0: 2020 2020 2072 652e 6669 6e64 616c 6c28       re.findall(
-0000a3d0: 7375 625f 636f 6d70 6f6e 656e 745f 7265  sub_component_re
-0000a3e0: 6765 782c 2074 6f6b 656e 2920 2b20 5b27  gex, token) + ['
-0000a3f0: 275d 2929 0a0a 0a0a 4066 756e 6374 696f  ']))....@functio
-0000a400: 6e5f 6c6f 6767 6572 0a64 6566 2064 6973  n_logger.def dis
-0000a410: 7472 6962 7574 655f 746f 6b65 6e73 5f6f  tribute_tokens_o
-0000a420: 7665 725f 6c65 7665 6c73 286c 6576 656c  ver_levels(level
-0000a430: 733a 2043 6f6c 6c65 6374 696f 6e5b 7374  s: Collection[st
-0000a440: 725d 2c0a 2020 2020 2020 2020 2020 2020  r],.            
-0000a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a460: 2020 2020 2020 746f 6b65 6e73 3a20 436f        tokens: Co
-0000a470: 6c6c 6563 7469 6f6e 5b73 7472 5d2c 0a20  llection[str],. 
-0000a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4a0: 206d 633a 204f 7074 696f 6e61 6c5b 556e   mc: Optional[Un
-0000a4b0: 696f 6e5b 696e 742c 2073 7472 5d5d 203d  ion[int, str]] =
-0000a4c0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4e0: 2020 2020 2020 2020 2061 6262 7265 7669           abbrevi
-0000a4f0: 6174 696f 6e73 3a20 6469 6374 203d 207b  ations: dict = {
-0000a500: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-0000a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a520: 2020 2020 2029 202d 3e20 4469 6374 5b54       ) -> Dict[T
-0000a530: 7570 6c65 5b73 7472 2c20 7374 725d 2c20  uple[str, str], 
-0000a540: 7374 725d 3a0a 2020 2020 2222 2254 616b  str]:.    """Tak
-0000a550: 6573 2074 6865 2072 6567 6578 206d 6174  es the regex mat
-0000a560: 6368 6573 206f 6620 6f6e 6520 6c61 6265  ches of one labe
-0000a570: 6c20 616e 6420 7475 726e 7320 7468 656d  l and turns them
-0000a580: 2069 6e74 6f20 6173 206d 616e 7920 7b6c   into as many {l
-0000a590: 6179 6572 202d 3e20 746f 6b65 6e7d 2070  ayer -> token} p
-0000a5a0: 6169 7273 2061 7320 7468 6520 6c61 6265  airs as the labe
-0000a5b0: 6c20 636f 6e74 6169 6e73 0a20 2020 2074  l contains.    t
-0000a5c0: 6f6b 656e 732e 0a0a 2020 2020 4172 6773  okens...    Args
-0000a5d0: 3a0a 2020 2020 2020 6c65 7665 6c73 3a20  :.      levels: 
-0000a5e0: 436f 6c6c 6563 7469 6f6e 206f 6620 7374  Collection of st
-0000a5f0: 7269 6e67 7320 696e 6469 6361 7469 6e67  rings indicating
-0000a600: 2061 6e61 6c79 7469 6361 6c20 6c61 7965   analytical laye
-0000a610: 7273 2e0a 2020 2020 2020 746f 6b65 6e73  rs..      tokens
-0000a620: 3a20 436f 6c6c 6563 7469 6f6e 206f 6620  : Collection of 
-0000a630: 746f 6b65 6e73 2063 6f6d 696e 6720 616c  tokens coming al
-0000a640: 6f6e 672c 2073 616d 6520 7369 7a65 2061  ong, same size a
-0000a650: 7320 6c65 7665 6c73 2e0a 2020 2020 2020  s levels..      
-0000a660: 6d63 3a20 5061 7373 2074 6865 206c 6162  mc: Pass the lab
-0000a670: 656c 2773 206c 6162 656c 2773 204d 4320  el's label's MC 
-0000a680: 746f 2064 6973 706c 6179 2069 7420 696e  to display it in
-0000a690: 2065 7272 6f72 206d 6573 7361 6765 732e   error messages.
-0000a6a0: 0a20 2020 2020 2061 6262 7265 7669 6174  .      abbreviat
-0000a6b0: 696f 6e73 3a20 7b61 6262 7265 7661 7469  ions: {abbrevati
-0000a6c0: 6f6e 202d 3e20 6c6f 6e67 206e 616d 657d  on -> long name}
-0000a6d0: 206d 6170 7069 6e67 2061 6262 7265 7669   mapping abbrevi
-0000a6e0: 6174 696f 6e73 2074 6f20 7768 6174 2074  ations to what t
-0000a6f0: 6865 7920 6172 6520 746f 2062 6520 7265  hey are to be re
-0000a700: 706c 6163 6564 2077 6974 680a 0a20 2020  placed with..   
-0000a710: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
-0000a720: 4120 7b28 666f 726d 5f74 7265 652c 206c  A {(form_tree, l
-0000a730: 6576 656c 2920 2d3e 2074 6f6b 656e 7d20  evel) -> token} 
-0000a740: 6469 6374 2077 6865 7265 2066 6f72 6d5f  dict where form_
-0000a750: 7472 6565 2069 7320 6569 7468 6572 2027  tree is either '
-0000a760: 2720 6f72 2061 206c 6574 7465 7220 6265  ' or a letter be
-0000a770: 7477 6565 6e20 612d 6820 6964 656e 7469  tween a-h identi
-0000a780: 6679 696e 6720 6f6e 6520 6f66 0a20 2020  fying one of.   
-0000a790: 2020 2073 6576 6572 616c 2074 7265 6573     several trees
-0000a7a0: 2061 6e6e 6f74 6174 6564 2069 6e20 7061   annotated in pa
-0000a7b0: 7261 6c6c 656c 2e0a 2020 2020 2222 220a  rallel..    """.
-0000a7c0: 2020 2020 636f 6c75 6d6e 3276 616c 7565      column2value
-0000a7d0: 203d 207b 7d0a 2020 2020 7265 6164 696e   = {}.    readin
-0000a7e0: 675f 7265 6765 7820 3d20 7222 5e28 283f  g_regex = r"^((?
-0000a7f0: 3a5b 6976 785d 2b5c 263f 292b 293a 220a  :[ivx]+\&?)+):".
-0000a800: 2020 2020 6d63 5f73 7472 696e 6720 3d20      mc_string = 
-0000a810: 2727 2069 6620 6d63 2069 7320 4e6f 6e65  '' if mc is None
-0000a820: 2065 6c73 6520 6622 4d43 207b 6d63 7d3a   else f"MC {mc}:
-0000a830: 2022 0a20 2020 2066 6f72 206c 6576 656c   ".    for level
-0000a840: 5f73 7472 2c20 746f 6b65 6e5f 7374 7220  _str, token_str 
-0000a850: 696e 207a 6970 286c 6576 656c 732c 2074  in zip(levels, t
-0000a860: 6f6b 656e 7329 3a0a 2020 2020 2020 2020  okens):.        
-0000a870: 7370 6c69 745f 6c65 7665 6c5f 696e 666f  split_level_info
-0000a880: 203d 2070 642e 5365 7269 6573 286c 6576   = pd.Series(lev
-0000a890: 656c 5f73 7472 2e73 706c 6974 2827 2627  el_str.split('&'
-0000a8a0: 2929 0a20 2020 2020 2020 2023 2074 7572  )).        # tur
-0000a8b0: 6e20 6c61 7965 7220 696e 6469 6361 7469  n layer indicati
-0000a8c0: 6f6e 7320 696e 746f 2061 2044 6174 6146  ons into a DataF
-0000a8d0: 7261 6d65 2077 6974 6820 7468 6520 636f  rame with the co
-0000a8e0: 6c75 6d6e 7320 5b27 6c65 7665 6c27 2c20  lumns ['level', 
-0000a8f0: 2766 6f72 6d5f 7472 6565 272c 2061 6e64  'form_tree', and
-0000a900: 2027 7265 6164 696e 6727 5d0a 2020 2020   'reading'].    
-0000a910: 2020 2020 616e 616c 7974 6963 616c 5f6c      analytical_l
-0000a920: 6179 6572 7320 3d20 7370 6c69 745f 6c65  ayers = split_le
-0000a930: 7665 6c5f 696e 666f 2e73 7472 2e65 7874  vel_info.str.ext
-0000a940: 7261 6374 2846 4f52 4d5f 4c45 5645 4c5f  ract(FORM_LEVEL_
-0000a950: 5245 4745 5829 0a20 2020 2020 2020 206c  REGEX).        l
-0000a960: 6576 656c 735f 696e 636c 7564 655f 7265  evels_include_re
-0000a970: 6164 696e 6720 3d20 616e 616c 7974 6963  ading = analytic
-0000a980: 616c 5f6c 6179 6572 732e 7265 6164 696e  al_layers.readin
-0000a990: 672e 6e6f 746e 6128 292e 616e 7928 290a  g.notna().any().
-0000a9a0: 2020 2020 2020 2020 2320 7265 6164 696e          # readin
-0000a9b0: 6720 696e 6469 6361 7469 6f6e 7320 6265  g indications be
-0000a9c0: 636f 6d65 2070 6172 7420 6f66 2074 6865  come part of the
-0000a9d0: 2074 6f6b 656e 2061 6e64 2065 6163 6820   token and each 
-0000a9e0: 7769 6c6c 2062 6520 666f 6c6c 6f77 6564  will be followed
-0000a9f0: 2062 7920 6120 636f 6c6f 6e0a 2020 2020   by a colon.    
-0000aa00: 2020 2020 616e 616c 7974 6963 616c 5f6c      analytical_l
-0000aa10: 6179 6572 732e 7265 6164 696e 6720 3d20  ayers.reading = 
-0000aa20: 2861 6e61 6c79 7469 6361 6c5f 6c61 7965  (analytical_laye
-0000aa30: 7273 2e72 6561 6469 6e67 202b 2027 3a20  rs.reading + ': 
-0000aa40: 2729 2e66 696c 6c6e 6128 2727 290a 2020  ').fillna('').  
-0000aa50: 2020 2020 2020 2320 7072 6f70 6167 6174        # propagat
-0000aa60: 6520 696e 666f 726d 6174 696f 6e20 7468  e information th
-0000aa70: 6174 2068 6173 2062 6565 6e20 6f6d 6974  at has been omit
-0000aa80: 7465 6420 696e 2074 6865 2073 6563 6f6e  ted in the secon
-0000aa90: 6420 616e 6420 666f 6c6c 6f77 696e 6720  d and following 
-0000aaa0: 696e 6469 6361 7469 6f6e 732c 0a20 2020  indications,.   
-0000aab0: 2020 2020 2023 2065 2e67 2e20 3261 2662       # e.g. 2a&b
-0000aac0: 202d 3e20 5b32 613a 2c20 3262 3a5d 3b20   -> [2a:, 2b:]; 
-0000aad0: 3161 6969 2669 6969 202d 3e20 5b31 6169  1aii&iii -> [1ai
-0000aae0: 693a 2c20 3161 6969 693a 5d3b 2031 6169  i:, 1aiii:]; 1ai
-0000aaf0: 2662 202d 3e20 5b31 6169 3a2c 2031 625d  &b -> [1ai:, 1b]
-0000ab00: 2028 692e 652e 2c20 7265 6164 696e 6773   (i.e., readings
-0000ab10: 2061 7265 206e 6f74 2070 726f 7061 6761   are not propaga
-0000ab20: 7465 6429 0a20 2020 2020 2020 2061 6e61  ted).        ana
-0000ab30: 6c79 7469 6361 6c5f 6c61 7965 7273 203d  lytical_layers =
-0000ab40: 2061 6e61 6c79 7469 6361 6c5f 6c61 7965   analytical_laye
-0000ab50: 7273 2e66 696c 6c6e 6128 6d65 7468 6f64  rs.fillna(method
-0000ab60: 3d27 6666 696c 6c27 290a 2020 2020 2020  ='ffill').      
-0000ab70: 2020 616e 616c 7974 6963 616c 5f6c 6179    analytical_lay
-0000ab80: 6572 732e 666f 726d 5f74 7265 6520 3d20  ers.form_tree = 
-0000ab90: 616e 616c 7974 6963 616c 5f6c 6179 6572  analytical_layer
-0000aba0: 732e 666f 726d 5f74 7265 652e 6669 6c6c  s.form_tree.fill
-0000abb0: 6e61 2827 2729 0a20 2020 2020 2020 2023  na('').        #
-0000abc0: 2073 706c 6974 2074 6f6b 656e 2069 6e74   split token int
-0000abd0: 6f20 616c 7465 726e 6174 6976 6520 636f  o alternative co
-0000abe0: 6d70 6f6e 656e 7473 2c20 7265 706c 6163  mponents, replac
-0000abf0: 6520 7370 6563 6961 6c20 7769 7468 206e  e special with n
-0000ac00: 6f72 6d61 6c20 7768 6974 652d 7370 6163  ormal white-spac
-0000ac10: 6520 6368 6172 6163 7465 7273 2c20 616e  e characters, an
-0000ac20: 6420 7374 7269 7020 6561 6368 0a20 2020  d strip each.   
-0000ac30: 2020 2020 2023 2063 6f6d 706f 6e65 6e74       # component
-0000ac40: 2066 726f 6d20 7768 6974 6520 7370 6163   from white spac
-0000ac50: 6520 616e 6420 7365 7061 7261 7469 6e67  e and separating
-0000ac60: 2063 6f6d 6d61 730a 2020 2020 2020 2020   commas.        
-0000ac70: 746f 6b65 6e5f 616c 7465 726e 6174 6976  token_alternativ
-0000ac80: 6573 203d 205b 7265 2e73 7562 2872 275c  es = [re.sub(r'\
-0000ac90: 732b 272c 2020 2720 272c 2074 292e 7374  s+',  ' ', t).st
-0000aca0: 7269 7028 2720 5c6e 2c27 2920 666f 7220  rip(' \n,') for 
-0000acb0: 7420 696e 2074 6f6b 656e 5f73 7472 2e73  t in token_str.s
-0000acc0: 706c 6974 2827 202d 2027 295d 0a20 2020  plit(' - ')].   
-0000acd0: 2020 2020 2074 6f6b 656e 5f61 6c74 6572       token_alter
-0000ace0: 6e61 7469 7665 7320 3d20 5b74 2066 6f72  natives = [t for
-0000acf0: 2074 2069 6e20 746f 6b65 6e5f 616c 7465   t in token_alte
-0000ad00: 726e 6174 6976 6573 2069 6620 7420 213d  rnatives if t !=
-0000ad10: 2027 275d 0a20 2020 2020 2020 2069 6620   ''].        if 
-0000ad20: 6c65 6e28 6162 6272 6576 6961 7469 6f6e  len(abbreviation
-0000ad30: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
-0000ad40: 2020 2020 746f 6b65 6e5f 616c 7465 726e      token_altern
-0000ad50: 6174 6976 6573 203d 205b 7265 736f 6c76  atives = [resolv
-0000ad60: 655f 666f 726d 5f61 6262 7265 7669 6174  e_form_abbreviat
-0000ad70: 696f 6e73 2874 6f6b 656e 2c20 6162 6272  ions(token, abbr
-0000ad80: 6576 6961 7469 6f6e 732c 206d 633d 6d63  eviations, mc=mc
-0000ad90: 2c20 6c6f 6767 6572 3d6c 6f67 6765 7229  , logger=logger)
-0000ada0: 2066 6f72 2074 6f6b 656e 2069 6e20 746f   for token in to
-0000adb0: 6b65 6e5f 616c 7465 726e 6174 6976 6573  ken_alternatives
-0000adc0: 5d0a 2020 2020 2020 2020 6966 206c 656e  ].        if len
-0000add0: 2874 6f6b 656e 5f61 6c74 6572 6e61 7469  (token_alternati
-0000ade0: 7665 7329 203d 3d20 313a 0a20 2020 2020  ves) == 1:.     
-0000adf0: 2020 2020 2020 2069 6620 6c65 7665 6c73         if levels
-0000ae00: 5f69 6e63 6c75 6465 5f72 6561 6469 6e67  _include_reading
-0000ae10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ae20: 2020 616e 616c 7974 6963 616c 5f6c 6179    analytical_lay
-0000ae30: 6572 732e 7265 6164 696e 6720 2b3d 2074  ers.reading += t
-0000ae40: 6f6b 656e 5f61 6c74 6572 6e61 7469 7665  oken_alternative
-0000ae50: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
-0000ae60: 2020 2020 206c 6162 656c 203d 2027 270a       label = ''.
-0000ae70: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000ae80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ae90: 2020 6c61 6265 6c20 3d20 746f 6b65 6e5f    label = token_
-0000aea0: 616c 7465 726e 6174 6976 6573 5b30 5d0a  alternatives[0].
-0000aeb0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000aec0: 2020 2020 2020 2020 2020 2320 7468 6973            # this
-0000aed0: 2073 6563 7469 6f6e 2064 6561 6c73 2077   section deals w
-0000aee0: 6974 6820 6361 7365 7320 7768 6572 6520  ith cases where 
-0000aef0: 616c 7465 726e 6174 6976 6520 7265 6164  alternative read
-0000af00: 696e 6773 2061 7265 206f 7220 6172 6520  ings are or are 
-0000af10: 6e6f 7420 6964 656e 7469 6669 6564 2062  not identified b
-0000af20: 7920 526f 6d61 6e20 6e75 6d62 6572 732c  y Roman numbers,
-0000af30: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
-0000af40: 6e64 2064 6561 6c73 2077 6974 6820 7468  nd deals with th
-0000af50: 6520 6769 7665 6e20 526f 6d61 6e20 6e75  e given Roman nu
-0000af60: 6d62 6572 7320 6465 7065 6e64 696e 6720  mbers depending 
-0000af70: 6f6e 2077 6865 7468 6572 2074 6865 2061  on whether the a
-0000af80: 6e61 6c79 7469 6361 6c20 6c61 7965 7273  nalytical layers
-0000af90: 2069 6e63 6c75 6465 2073 6f6d 6520 6173   include some as
-0000afa0: 2077 656c 6c0a 2020 2020 2020 2020 2020   well.          
-0000afb0: 2020 746f 6b65 6e5f 696e 636c 7564 6573    token_includes
-0000afc0: 5f72 6561 6469 6e67 203d 2061 6e79 2872  _reading = any(r
-0000afd0: 652e 6d61 7463 6828 7265 6164 696e 675f  e.match(reading_
-0000afe0: 7265 6765 782c 2074 2920 6973 206e 6f74  regex, t) is not
-0000aff0: 204e 6f6e 6520 666f 7220 7420 696e 2074   None for t in t
-0000b000: 6f6b 656e 5f61 6c74 6572 6e61 7469 7665  oken_alternative
-0000b010: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
-0000b020: 6620 746f 6b65 6e5f 696e 636c 7564 6573  f token_includes
-0000b030: 5f72 6561 6469 6e67 3a0a 2020 2020 2020  _reading:.      
-0000b040: 2020 2020 2020 2020 2020 7265 6164 696e            readin
-0000b050: 675f 696e 666f 203d 205b 7265 2e6d 6174  g_info = [re.mat
-0000b060: 6368 2872 6561 6469 6e67 5f72 6567 6578  ch(reading_regex
-0000b070: 2c20 7429 2066 6f72 2074 2069 6e20 746f  , t) for t in to
-0000b080: 6b65 6e5f 616c 7465 726e 6174 6976 6573  ken_alternatives
-0000b090: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000b0a0: 2020 7265 6164 696e 6732 746f 6b65 6e20    reading2token 
-0000b0b0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
-0000b0c0: 2020 2020 2066 6f72 2072 6561 6469 6e67       for reading
-0000b0d0: 735f 7374 722c 2074 6f6b 656e 5f63 6f6d  s_str, token_com
-0000b0e0: 706f 6e65 6e74 2069 6e20 7a69 7028 7265  ponent in zip(re
-0000b0f0: 6164 696e 675f 696e 666f 5b31 3a5d 2c20  ading_info[1:], 
-0000b100: 746f 6b65 6e5f 616c 7465 726e 6174 6976  token_alternativ
-0000b110: 6573 5b31 3a5d 293a 0a20 2020 2020 2020  es[1:]):.       
-0000b120: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000b130: 7265 6164 696e 6773 5f73 7472 2069 7320  readings_str is 
-0000b140: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000b150: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000b160: 6164 696e 6720 3d20 2727 0a20 2020 2020  ading = ''.     
-0000b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b180: 2020 2072 6561 6469 6e67 3274 6f6b 656e     reading2token
-0000b190: 5b72 6561 6469 6e67 5d20 3d20 746f 6b65  [reading] = toke
-0000b1a0: 6e5f 636f 6d70 6f6e 656e 740a 2020 2020  n_component.    
-0000b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000b1d0: 2020 2020 2020 2020 2020 2020 2020 746f                to
-0000b1e0: 6b65 6e5f 636f 6d70 6f6e 656e 7420 3d20  ken_component = 
-0000b1f0: 746f 6b65 6e5f 636f 6d70 6f6e 656e 745b  token_component[
-0000b200: 7265 6164 696e 6773 5f73 7472 2e65 6e64  readings_str.end
-0000b210: 2829 3a5d 2e73 7472 6970 2827 2027 290a  ():].strip(' ').
-0000b220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b230: 2020 2020 2020 2020 666f 7220 726f 6d61          for roma
-0000b240: 6e20 696e 2072 6561 6469 6e67 735f 7374  n in readings_st
-0000b250: 722e 6772 6f75 7028 3129 2e73 706c 6974  r.group(1).split
-0000b260: 2827 2627 293a 0a20 2020 2020 2020 2020  ('&'):.         
-0000b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b280: 2020 2072 6561 6469 6e67 203d 2066 227b     reading = f"{
-0000b290: 726f 6d61 6e7d 3a20 220a 2020 2020 2020  roman}: ".      
-0000b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2b0: 2020 2020 2020 6966 206c 6576 656c 735f        if levels_
-0000b2c0: 696e 636c 7564 655f 7265 6164 696e 6720  include_reading 
-0000b2d0: 616e 6420 7265 6164 696e 6720 696e 2061  and reading in a
-0000b2e0: 6e61 6c79 7469 6361 6c5f 6c61 7965 7273  nalytical_layers
-0000b2f0: 2e72 6561 6469 6e67 2e76 616c 7565 733a  .reading.values:
-0000b300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b320: 2063 6f6c 756d 6e5f 656d 7074 7920 3d20   column_empty = 
-0000b330: 2861 6e61 6c79 7469 6361 6c5f 6c61 7965  (analytical_laye
-0000b340: 7273 203d 3d20 2727 292e 616c 6c28 290a  rs == '').all().
-0000b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b370: 7368 6f77 5f6c 6179 6572 7320 3d20 616e  show_layers = an
-0000b380: 616c 7974 6963 616c 5f6c 6179 6572 732e  alytical_layers.
-0000b390: 6c6f 635b 3a2c 207e 636f 6c75 6d6e 5f65  loc[:, ~column_e
-0000b3a0: 6d70 7479 5d0a 2020 2020 2020 2020 2020  mpty].          
-0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3c0: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
-0000b3d0: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
-0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3f0: 2020 2020 2020 2020 2020 6622 7b6d 635f            f"{mc_
-0000b400: 7374 7269 6e67 7d41 6c74 6572 6e61 7469  string}Alternati
-0000b410: 7665 2072 6561 6469 6e67 2069 6e20 277b  ve reading in '{
-0000b420: 746f 6b65 6e5f 7374 727d 2720 7370 6563  token_str}' spec
-0000b430: 6966 6965 7320 526f 6d61 6e20 277b 7265  ifies Roman '{re
-0000b440: 6164 696e 677d 2720 7768 6963 6820 636f  ading}' which co
-0000b450: 6e66 6c69 6374 7320 7769 7468 206f 6e65  nflicts with one
-0000b460: 2073 7065 6369 6669 6564 2069 6e20 7468   specified in th
-0000b470: 6520 6c65 7665 6c3a 5c6e 7b73 686f 775f  e level:\n{show_
-0000b480: 6c61 7965 7273 7d22 290a 2020 2020 2020  layers}").      
-0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4a0: 2020 2020 2020 7265 6164 696e 6732 746f        reading2to
-0000b4b0: 6b65 6e5b 7265 6164 696e 675d 203d 2074  ken[reading] = t
-0000b4c0: 6f6b 656e 5f63 6f6d 706f 6e65 6e74 0a20  oken_component. 
-0000b4d0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000b4e0: 6162 656c 203d 2027 202d 2027 2e6a 6f69  abel = ' - '.joi
-0000b4f0: 6e28 7265 6164 696e 6720 2b20 746b 6e20  n(reading + tkn 
-0000b500: 666f 7220 7265 6164 696e 672c 2074 6b6e  for reading, tkn
-0000b510: 2069 6e20 7265 6164 696e 6732 746f 6b65   in reading2toke
-0000b520: 6e2e 6974 656d 7328 2929 0a20 2020 2020  n.items()).     
-0000b530: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0000b540: 7665 6c73 5f69 6e63 6c75 6465 5f72 6561  vels_include_rea
-0000b550: 6469 6e67 3a0a 2020 2020 2020 2020 2020  ding:.          
-0000b560: 2020 2020 2020 2020 2020 6966 2072 6561            if rea
-0000b570: 6469 6e67 5f69 6e66 6f5b 305d 2069 7320  ding_info[0] is 
-0000b580: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5a0: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
-0000b5b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000b5c0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000b5d0: 7b6d 635f 7374 7269 6e67 7d27 7b74 6f6b  {mc_string}'{tok
-0000b5e0: 656e 5f73 7472 7d27 3a20 5468 6520 6669  en_str}': The fi
-0000b5f0: 7273 7420 7265 6164 696e 6720 277b 7265  rst reading '{re
-0000b600: 6164 696e 675f 696e 666f 5b30 5d2e 6772  ading_info[0].gr
-0000b610: 6f75 7028 297d 2720 7370 6563 6966 6965  oup()}' specifie
-0000b620: 7320 526f 6d61 6e20 6e75 6d62 6572 2069  s Roman number i
-0000b630: 6e20 6164 6469 7469 6f6e 2074 6f20 7468  n addition to th
-0000b640: 6f73 6520 7370 6563 6966 6965 6420 696e  ose specified in
-0000b650: 2074 6865 206c 6576 656c 3a5c 6e7b 616e   the level:\n{an
-0000b660: 616c 7974 6963 616c 5f6c 6179 6572 737d  alytical_layers}
-0000b670: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000b680: 2020 2020 2020 2061 6e61 6c79 7469 6361         analytica
-0000b690: 6c5f 6c61 7965 7273 2e72 6561 6469 6e67  l_layers.reading
-0000b6a0: 202b 3d20 746f 6b65 6e5f 616c 7465 726e   += token_altern
-0000b6b0: 6174 6976 6573 5b30 5d0a 2020 2020 2020  atives[0].      
-0000b6c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6e0: 2020 2020 6c61 6265 6c20 3d20 746f 6b65      label = toke
-0000b6f0: 6e5f 616c 7465 726e 6174 6976 6573 5b30  n_alternatives[0
-0000b700: 5d20 2b20 2720 2d20 2720 2b20 6c61 6265  ] + ' - ' + labe
-0000b710: 6c0a 2020 2020 2020 2020 2020 2020 656c  l.            el
-0000b720: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000b730: 2020 2020 2320 746f 6b65 6e20 646f 6573      # token does
-0000b740: 206e 6f74 2069 6e63 6c75 6465 2061 6e79   not include any
-0000b750: 2052 6f6d 616e 206e 756d 6265 7273 2061   Roman numbers a
-0000b760: 6e64 2069 7320 7573 6564 2061 7320 6973  nd is used as is
-0000b770: 2066 6f72 2061 6c6c 206c 6179 6572 730a   for all layers.
-0000b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b790: 616e 616c 7974 6963 616c 5f6c 6179 6572  analytical_layer
-0000b7a0: 732e 7265 6164 696e 6720 2b3d 2027 202d  s.reading += ' -
-0000b7b0: 2027 2e6a 6f69 6e28 7420 666f 7220 7420   '.join(t for t 
-0000b7c0: 696e 2074 6f6b 656e 5f61 6c74 6572 6e61  in token_alterna
-0000b7d0: 7469 7665 7329 0a20 2020 2020 2020 2020  tives).         
-0000b7e0: 2020 2020 2020 206c 6162 656c 203d 2027         label = '
-0000b7f0: 270a 0a20 2020 2020 2020 2066 6f72 2028  '..        for (
-0000b800: 666f 726d 5f74 7265 652c 206c 6576 656c  form_tree, level
-0000b810: 292c 2064 6620 696e 2061 6e61 6c79 7469  ), df in analyti
-0000b820: 6361 6c5f 6c61 7965 7273 2e67 726f 7570  cal_layers.group
-0000b830: 6279 285b 2766 6f72 6d5f 7472 6565 272c  by(['form_tree',
-0000b840: 2027 6c65 7665 6c27 5d2c 2064 726f 706e   'level'], dropn
-0000b850: 613d 4661 6c73 6529 3a0a 2020 2020 2020  a=False):.      
-0000b860: 2020 2020 2020 6b65 7920 3d20 2866 6f72        key = (for
-0000b870: 6d5f 7472 6565 2c20 6c65 7665 6c29 2020  m_tree, level)  
-0000b880: 2320 666f 726d 5f74 7265 6520 6265 636f  # form_tree beco
-0000b890: 6d65 7320 6669 7273 7420 6c65 7665 6c20  mes first level 
-0000b8a0: 6f66 2074 6865 2063 6f6c 756d 6e73 2720  of the columns' 
-0000b8b0: 4d75 6c74 6949 6e64 6578 2c20 652e 672e  MultiIndex, e.g.
-0000b8c0: 2027 6127 2061 6e64 2027 6227 0a20 2020   'a' and 'b'.   
-0000b8d0: 2020 2020 2020 2020 2069 6620 2864 662e           if (df.
-0000b8e0: 7265 6164 696e 6720 3d3d 2027 2729 2e61  reading == '').a
-0000b8f0: 6c6c 2829 3a0a 2020 2020 2020 2020 2020  ll():.          
-0000b900: 2020 2020 2020 7661 6c75 6520 3d20 6c61        value = la
-0000b910: 6265 6c0a 2020 2020 2020 2020 2020 2020  bel.            
-0000b920: 2020 2020 6966 206c 656e 2864 6629 203e      if len(df) >
-0000b930: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-0000b940: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-0000b950: 6172 6e69 6e67 2866 227b 6d63 5f73 7472  arning(f"{mc_str
-0000b960: 696e 677d 4475 706c 6963 6174 696f 6e20  ing}Duplication 
-0000b970: 6f66 206c 6576 656c 2077 6974 686f 7574  of level without
-0000b980: 2073 7065 6369 6679 696e 6720 7365 7061   specifying sepa
-0000b990: 7261 7465 2072 6561 6469 6e67 733a 5c6e  rate readings:\n
-0000b9a0: 7b64 667d 2229 0a20 2020 2020 2020 2020  {df}").         
-0000b9b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000b9c0: 2020 2020 2020 2020 2076 616c 7565 203d           value =
-0000b9d0: 2027 202d 2027 2e6a 6f69 6e28 7265 6164   ' - '.join(read
-0000b9e0: 696e 6720 666f 7220 7265 6164 696e 6720  ing for reading 
-0000b9f0: 696e 2064 662e 7265 6164 696e 672e 746f  in df.reading.to
-0000ba00: 5f6c 6973 7428 2929 0a20 2020 2020 2020  _list()).       
-0000ba10: 2020 2020 2020 2020 2069 6620 6c61 6265           if labe
-0000ba20: 6c20 213d 2027 273a 0a20 2020 2020 2020  l != '':.       
-0000ba30: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0000ba40: 7565 202b 3d20 2720 2d20 2720 2b20 6c61  ue += ' - ' + la
-0000ba50: 6265 6c0a 2020 2020 2020 2020 2020 2020  bel.            
-0000ba60: 6966 206b 6579 2069 6e20 636f 6c75 6d6e  if key in column
-0000ba70: 3276 616c 7565 3a0a 2020 2020 2020 2020  2value:.        
-0000ba80: 2020 2020 2020 2020 636f 6c75 6d6e 3276          column2v
-0000ba90: 616c 7565 5b6b 6579 5d20 2b3d 2027 202d  alue[key] += ' -
-0000baa0: 2027 202b 2076 616c 7565 0a20 2020 2020   ' + value.     
-0000bab0: 2020 2020 2020 2020 2020 2023 206c 6f67             # log
-0000bac0: 6765 722e 7761 726e 696e 6728 6622 7b6d  ger.warning(f"{m
-0000bad0: 635f 7374 7269 6e67 7d54 6865 2074 6f6b  c_string}The tok
-0000bae0: 656e 2027 7b63 6f6c 756d 6e32 7661 6c75  en '{column2valu
-0000baf0: 655b 6b65 795d 7d27 2066 6f72 206c 6576  e[key]}' for lev
-0000bb00: 656c 207b 6b65 797d 2077 6173 206f 7665  el {key} was ove
-0000bb10: 7277 7269 7474 656e 2077 6974 6820 277b  rwritten with '{
-0000bb20: 7661 6c75 657d 273a 5c6e 6c65 7665 6c73  value}':\nlevels
-0000bb30: 3a20 7b6c 6576 656c 5f73 7472 7d2c 2074  : {level_str}, t
-0000bb40: 6f6b 656e 3a20 7b74 6f6b 656e 7d22 290a  oken: {token}").
-0000bb50: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000bb60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000bb70: 2020 636f 6c75 6d6e 3276 616c 7565 5b6b    column2value[k
-0000bb80: 6579 5d20 3d20 7661 6c75 650a 2020 2020  ey] = value.    
-0000bb90: 7265 7475 726e 2063 6f6c 756d 6e32 7661  return column2va
-0000bba0: 6c75 650a 0a40 6675 6e63 7469 6f6e 5f6c  lue..@function_l
-0000bbb0: 6f67 6765 720a 6465 6620 6578 7061 6e64  ogger.def expand
-0000bbc0: 5f73 696e 676c 655f 666f 726d 5f6c 6162  _single_form_lab
-0000bbd0: 656c 286c 6162 656c 3a20 7374 722c 2064  el(label: str, d
-0000bbe0: 6566 6175 6c74 5f61 6262 7265 7669 6174  efault_abbreviat
-0000bbf0: 696f 6e73 3d54 7275 652c 202a 2a6b 7761  ions=True, **kwa
-0000bc00: 7267 7329 202d 3e20 4469 6374 5b54 7570  rgs) -> Dict[Tup
-0000bc10: 6c65 5b73 7472 2c20 7374 725d 2c20 7374  le[str, str], st
-0000bc20: 725d 3a0a 2020 2020 2222 2220 5370 6c69  r]:.    """ Spli
-0000bc30: 7473 2061 2066 6f72 6d20 6c61 6265 6c20  ts a form label 
-0000bc40: 616e 6420 6170 706c 6965 7320 6469 7374  and applies dist
-0000bc50: 7269 6275 7465 5f74 6f6b 656e 735f 6f76  ribute_tokens_ov
-0000bc60: 6572 5f6c 6576 656c 7328 290a 0a20 2020  er_levels()..   
-0000bc70: 2041 7267 733a 0a20 2020 2020 206c 6162   Args:.      lab
-0000bc80: 656c 3a20 436f 6d70 6c65 7465 2066 6f72  el: Complete for
-0000bc90: 6d20 6c61 6265 6c20 696e 636c 7564 696e  m label includin
-0000bca0: 6720 696e 6469 6361 7469 6f6e 7320 6f66  g indications of
-0000bcb0: 2061 6e61 6c79 7469 6361 6c20 6c61 7965   analytical laye
-0000bcc0: 7228 7329 2e0a 2020 2020 2020 6465 6661  r(s)..      defa
-0000bcd0: 756c 745f 6162 6272 6576 6961 7469 6f6e  ult_abbreviation
-0000bce0: 733a 2042 7920 6465 6661 756c 742c 2065  s: By default, e
-0000bcf0: 6163 6820 746f 6b65 6e20 636f 6d70 6f6e  ach token compon
-0000bd00: 656e 7420 6973 2063 6865 636b 6564 2061  ent is checked a
-0000bd10: 6761 696e 7374 2061 206d 6170 7069 6e67  gainst a mapping
-0000bd20: 2066 726f 6d20 6162 6272 6576 6961 7469   from abbreviati
-0000bd30: 6f6e 7320 746f 0a20 2020 2020 2020 2020  ons to.         
-0000bd40: 206c 6f6e 6720 6e61 6d65 732e 2050 6173   long names. Pas
-0000bd50: 7320 4661 6c73 6520 746f 2070 7265 7665  s False to preve
-0000bd60: 6e74 2074 6861 742e 0a20 2020 2020 202a  nt that..      *
-0000bd70: 2a6b 7761 7267 733a 2041 6262 7265 7669  *kwargs: Abbrevi
-0000bd80: 6174 696f 6e3d 276c 6f6e 6720 6e61 6d65  ation='long name
-0000bd90: 2720 6d61 7070 696e 6773 2074 6f20 7265  ' mappings to re
-0000bda0: 736f 6c76 6520 696e 6469 7669 6475 616c  solve individual
-0000bdb0: 2061 6262 7265 7669 6174 696f 6e73 0a0a   abbreviations..
-0000bdc0: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
-0000bdd0: 2020 2041 2044 6174 6146 7261 6d65 2077     A DataFrame w
-0000bde0: 6974 6820 6f6e 6520 636f 6c75 6d6e 2061  ith one column a
-0000bdf0: 6464 6564 2070 6572 2068 6965 7261 7263  dded per hierarc
-0000be00: 6869 6361 6c20 6c61 7965 7220 6f66 2061  hical layer of a
-0000be10: 6e61 6c79 7369 732c 2073 7461 7274 696e  nalysis, startin
-0000be20: 6720 6672 6f6d 206c 6576 656c 2030 2e0a  g from level 0..
-0000be30: 2020 2020 2222 220a 2020 2020 6578 7472      """.    extr
-0000be40: 6163 7465 645f 6c65 7665 6c73 203d 2072  acted_levels = r
-0000be50: 652e 6669 6e64 616c 6c28 464f 524d 5f4c  e.findall(FORM_L
-0000be60: 4556 454c 5f43 4150 5455 5245 5f52 4547  EVEL_CAPTURE_REG
-0000be70: 4558 2c20 6c61 6265 6c29 0a20 2020 2065  EX, label).    e
-0000be80: 7874 7261 6374 6564 5f74 6f6b 656e 7320  xtracted_tokens 
-0000be90: 3d20 7265 2e73 706c 6974 2846 4f52 4d5f  = re.split(FORM_
-0000bea0: 4c45 5645 4c5f 5350 4c49 545f 5245 4745  LEVEL_SPLIT_REGE
-0000beb0: 582c 206c 6162 656c 295b 313a 5d0a 2020  X, label)[1:].  
-0000bec0: 2020 6162 6272 6576 6961 7469 6f6e 7320    abbreviations 
-0000bed0: 3d20 464f 524d 5f54 4f4b 454e 5f41 4242  = FORM_TOKEN_ABB
-0000bee0: 5245 5649 4154 494f 4e53 2069 6620 6465  REVIATIONS if de
-0000bef0: 6661 756c 745f 6162 6272 6576 6961 7469  fault_abbreviati
-0000bf00: 6f6e 7320 656c 7365 207b 7d0a 2020 2020  ons else {}.    
-0000bf10: 6162 6272 6576 6961 7469 6f6e 732e 7570  abbreviations.up
-0000bf20: 6461 7465 286b 7761 7267 7329 0a20 2020  date(kwargs).   
-0000bf30: 2072 6574 7572 6e20 6469 7374 7269 6275   return distribu
-0000bf40: 7465 5f74 6f6b 656e 735f 6f76 6572 5f6c  te_tokens_over_l
-0000bf50: 6576 656c 7328 6578 7472 6163 7465 645f  evels(extracted_
-0000bf60: 6c65 7665 6c73 2c20 6578 7472 6163 7465  levels, extracte
-0000bf70: 645f 746f 6b65 6e73 2c20 6162 6272 6576  d_tokens, abbrev
-0000bf80: 6961 7469 6f6e 733d 6162 6272 6576 6961  iations=abbrevia
-0000bf90: 7469 6f6e 7329 0a0a 0a40 6675 6e63 7469  tions)...@functi
-0000bfa0: 6f6e 5f6c 6f67 6765 720a 6465 6620 6578  on_logger.def ex
-0000bfb0: 7061 6e64 5f66 6f72 6d5f 6c61 6265 6c73  pand_form_labels
-0000bfc0: 2866 6c3a 2070 642e 4461 7461 4672 616d  (fl: pd.DataFram
-0000bfd0: 652c 2066 696c 6c5f 6d6e 5f75 6e74 696c  e, fill_mn_until
-0000bfe0: 3a20 696e 7420 3d20 4e6f 6e65 2c20 6465  : int = None, de
-0000bff0: 6661 756c 745f 6162 6272 6576 6961 7469  fault_abbreviati
-0000c000: 6f6e 733d 5472 7565 2c20 2a2a 6b77 6172  ons=True, **kwar
-0000c010: 6773 2920 2d3e 2070 642e 4461 7461 4672  gs) -> pd.DataFr
-0000c020: 616d 653a 0a20 2020 2022 2222 2045 7870  ame:.    """ Exp
-0000c030: 616e 6473 2066 6f72 6d20 6c61 6265 6c73  ands form labels
-0000c040: 2069 6e74 6f20 6120 6869 6572 6172 6368   into a hierarch
-0000c050: 6963 616c 2076 6965 7720 6f66 206c 6576  ical view of lev
-0000c060: 656c 7320 696e 2061 2074 6162 6c65 2e0a  els in a table..
-0000c070: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
-0000c080: 2066 6c3a 2041 2044 6174 6146 7261 6d65   fl: A DataFrame
-0000c090: 2063 6f6e 7461 696e 696e 6720 7261 7720   containing raw 
-0000c0a0: 666f 726d 206c 6162 656c 7320 6173 2072  form labels as r
-0000c0b0: 6574 7269 6576 6564 2066 726f 6d20 3a6d  etrieved from :m
-0000c0c0: 6574 683a 606d 7333 2e53 636f 7265 2e6d  eth:`ms3.Score.m
-0000c0d0: 7363 782e 666f 726d 5f6c 6162 656c 7328  scx.form_labels(
-0000c0e0: 2960 2e0a 2020 2020 2020 6669 6c6c 5f6d  )`..      fill_m
-0000c0f0: 6e5f 756e 7469 6c3a 2050 6173 7320 7468  n_until: Pass th
-0000c100: 6520 6c61 7374 206d 6561 7375 7265 206e  e last measure n
-0000c110: 756d 6265 7220 6966 2079 6f75 2077 616e  umber if you wan
-0000c120: 7420 6576 6572 7920 6d65 6173 7572 6520  t every measure 
-0000c130: 6f66 2074 6865 2070 6965 6365 2068 6176  of the piece hav
-0000c140: 6520 6120 726f 7720 696e 2074 6865 2074  e a row in the t
-0000c150: 7265 6520 7669 6577 2c0a 2020 2020 2020  ree view,.      
-0000c160: 2020 2020 6576 656e 2069 6620 6974 2064      even if it d
-0000c170: 6f65 736e 2774 2063 6f6d 6520 7769 7468  oesn't come with
-0000c180: 2061 2066 6f72 6d20 6c61 6265 6c2e 2054   a form label. T
-0000c190: 6869 7320 6d61 7920 6265 2064 6573 6972  his may be desir
-0000c1a0: 6564 2066 6f72 2069 6e63 7265 6173 6564  ed for increased
-0000c1b0: 2069 6e74 7569 7469 6f6e 206f 6620 7072   intuition of pr
-0000c1c0: 6f70 6f72 7469 6f6e 732c 0a20 2020 2020  oportions,.     
-0000c1d0: 2020 2020 2072 6174 6865 7220 7468 616e       rather than
-0000c1e0: 2073 6565 696e 6720 616c 6c20 666f 726d   seeing all form
-0000c1f0: 206c 6162 656c 7320 7269 6768 7420 6265   labels right be
-0000c200: 6c6f 7720 6561 6368 206f 7468 6572 2e20  low each other. 
-0000c210: 496e 206f 7264 6572 2074 6f20 6164 6420  In order to add 
-0000c220: 7468 6520 656d 7074 7920 726f 7773 2c20  the empty rows, 
-0000c230: 6576 656e 2077 6974 686f 7574 0a20 2020  even without.   
-0000c240: 2020 2020 2020 206b 6e6f 7769 6e67 2074         knowing t
-0000c250: 6865 206e 756d 6265 7220 6f66 206d 6561  he number of mea
-0000c260: 7375 7265 732c 2070 6173 7320 2d31 2e0a  sures, pass -1..
-0000c270: 2020 2020 2020 6465 6661 756c 745f 6162        default_ab
-0000c280: 6272 6576 6961 7469 6f6e 733a 2042 7920  breviations: By 
-0000c290: 6465 6661 756c 742c 2065 6163 6820 746f  default, each to
-0000c2a0: 6b65 6e20 636f 6d70 6f6e 656e 7420 6973  ken component is
-0000c2b0: 2063 6865 636b 6564 2061 6761 696e 7374   checked against
-0000c2c0: 2061 206d 6170 7069 6e67 2066 726f 6d20   a mapping from 
-0000c2d0: 6162 6272 6576 6961 7469 6f6e 7320 746f  abbreviations to
-0000c2e0: 0a20 2020 2020 2020 2020 206c 6f6e 6720  .          long 
-0000c2f0: 6e61 6d65 732e 2050 6173 7320 4661 6c73  names. Pass Fals
-0000c300: 6520 746f 2070 7265 7665 6e74 2074 6861  e to prevent tha
-0000c310: 742e 0a20 2020 2020 202a 2a6b 7761 7267  t..      **kwarg
-0000c320: 733a 2041 6262 7265 7669 6174 696f 6e3d  s: Abbreviation=
-0000c330: 276c 6f6e 6720 6e61 6d65 2720 6d61 7070  'long name' mapp
-0000c340: 696e 6773 2074 6f20 7265 736f 6c76 6520  ings to resolve 
-0000c350: 696e 6469 7669 6475 616c 2061 6262 7265  individual abbre
-0000c360: 7669 6174 696f 6e73 0a0a 2020 2020 5265  viations..    Re
-0000c370: 7475 726e 733a 0a20 2020 2020 2041 2044  turns:.      A D
-0000c380: 6174 6146 7261 6d65 2077 6974 6820 6f6e  ataFrame with on
-0000c390: 6520 636f 6c75 6d6e 2061 6464 6564 2070  e column added p
-0000c3a0: 6572 2068 6965 7261 7263 6869 6361 6c20  er hierarchical 
-0000c3b0: 6c61 7965 7220 6f66 2061 6e61 6c79 7369  layer of analysi
-0000c3c0: 732c 2073 7461 7274 696e 6720 6672 6f6d  s, starting from
-0000c3d0: 206c 6576 656c 2030 2e0a 2020 2020 2222   level 0..    ""
-0000c3e0: 220a 2020 2020 666f 726d 5f6c 6162 656c  ".    form_label
-0000c3f0: 7320 3d20 666c 2e66 6f72 6d5f 6c61 6265  s = fl.form_labe
-0000c400: 6c2e 7374 722e 7265 706c 6163 6528 2226  l.str.replace("&
-0000c410: 616d 703b 222c 2022 2622 2c20 7265 6765  amp;", "&", rege
-0000c420: 783d 4661 6c73 6529 2e73 7472 2e72 6570  x=False).str.rep
-0000c430: 6c61 6365 2872 225c 7322 2c20 2220 222c  lace(r"\s", " ",
-0000c440: 2072 6567 6578 3d54 7275 6529 0a20 2020   regex=True).   
-0000c450: 2065 7874 7261 6374 6564 5f6c 6576 656c   extracted_level
-0000c460: 7320 3d20 666f 726d 5f6c 6162 656c 732e  s = form_labels.
-0000c470: 7374 722e 6578 7472 6163 7461 6c6c 2846  str.extractall(F
-0000c480: 4f52 4d5f 4c45 5645 4c5f 4341 5054 5552  ORM_LEVEL_CAPTUR
-0000c490: 455f 5245 4745 5829 0a20 2020 2065 7874  E_REGEX).    ext
-0000c4a0: 7261 6374 6564 5f6c 6576 656c 7320 3d20  racted_levels = 
-0000c4b0: 6578 7472 6163 7465 645f 6c65 7665 6c73  extracted_levels
-0000c4c0: 2e75 6e73 7461 636b 2829 2e72 6569 6e64  .unstack().reind
-0000c4d0: 6578 2866 6c2e 696e 6465 7829 0a20 2020  ex(fl.index).   
-0000c4e0: 2065 7874 7261 6374 6564 5f74 6f6b 656e   extracted_token
-0000c4f0: 7320 3d20 666f 726d 5f6c 6162 656c 732e  s = form_labels.
-0000c500: 7374 722e 7370 6c69 7428 464f 524d 5f4c  str.split(FORM_L
-0000c510: 4556 454c 5f53 504c 4954 5f52 4547 4558  EVEL_SPLIT_REGEX
-0000c520: 2c20 6578 7061 6e64 3d54 7275 6529 0a20  , expand=True). 
-0000c530: 2020 2023 2043 4845 434b 533a 0a20 2020     # CHECKS:.   
-0000c540: 2023 2065 7874 7261 6374 6564 5f74 6f6b   # extracted_tok
-0000c550: 656e 732e 6170 706c 7928 6c61 6d62 6461  ens.apply(lambda
-0000c560: 2053 3a20 532e 7374 722e 636f 6e74 6169   S: S.str.contai
-0000c570: 6e73 2872 2728 3f3c 215b 6978 765d 293a  ns(r'(?<![ixv]):
-0000c580: 2729 2e66 696c 6c6e 6128 4661 6c73 6529  ').fillna(False)
-0000c590: 292e 616e 7928 6178 6973 3d31 290a 2020  ).any(axis=1).  
-0000c5a0: 2020 2320 6578 7472 6163 7465 645f 746f    # extracted_to
-0000c5b0: 6b65 6e73 5b65 7874 7261 6374 6564 5f74  kens[extracted_t
-0000c5c0: 6f6b 656e 735b 305d 2021 3d20 2727 5d0a  okens[0] != ''].
-0000c5d0: 2020 2020 2320 666c 5b66 6c2e 666f 726d      # fl[fl.form
-0000c5e0: 5f6c 6162 656c 2e73 7472 2e63 6f6e 7461  _label.str.conta
-0000c5f0: 696e 7328 273a 2627 295d 0a20 2020 2065  ins(':&')].    e
-0000c600: 7874 7261 6374 6564 5f74 6f6b 656e 7320  xtracted_tokens 
-0000c610: 3d20 6578 7472 6163 7465 645f 746f 6b65  = extracted_toke
-0000c620: 6e73 2e64 726f 7028 636f 6c75 6d6e 733d  ns.drop(columns=
-0000c630: 3029 0a20 2020 2061 7373 6572 7420 2865  0).    assert (e
-0000c640: 7874 7261 6374 6564 5f74 6f6b 656e 732e  xtracted_tokens.
-0000c650: 696e 6465 7820 3d3d 2065 7874 7261 6374  index == extract
-0000c660: 6564 5f6c 6576 656c 732e 696e 6465 7829  ed_levels.index)
-0000c670: 2e61 6c6c 2829 2c20 2249 6e64 6963 6573  .all(), "Indices
-0000c680: 206e 6565 6420 746f 2062 6520 6964 656e   need to be iden
-0000c690: 7469 6361 6c20 6166 7465 7220 7265 6765  tical after rege
-0000c6a0: 7820 6578 7472 6163 7469 6f6e 2e22 0a20  x extraction.". 
-0000c6b0: 2020 2072 6573 756c 745f 6469 6374 203d     result_dict =
-0000c6c0: 207b 7d0a 2020 2020 6162 6272 6576 6961   {}.    abbrevia
-0000c6d0: 7469 6f6e 7320 3d20 464f 524d 5f54 4f4b  tions = FORM_TOK
-0000c6e0: 454e 5f41 4242 5245 5649 4154 494f 4e53  EN_ABBREVIATIONS
-0000c6f0: 2069 6620 6465 6661 756c 745f 6162 6272   if default_abbr
-0000c700: 6576 6961 7469 6f6e 7320 656c 7365 207b  eviations else {
-0000c710: 7d0a 2020 2020 6162 6272 6576 6961 7469  }.    abbreviati
-0000c720: 6f6e 732e 7570 6461 7465 286b 7761 7267  ons.update(kwarg
-0000c730: 7329 0a20 2020 2066 6f72 206d 632c 2028  s).    for mc, (
-0000c740: 692c 206c 766c 7329 2c20 285f 2c20 746b  i, lvls), (_, tk
-0000c750: 6e73 2920 696e 207a 6970 2866 6c2e 6d63  ns) in zip(fl.mc
-0000c760: 2c20 6578 7472 6163 7465 645f 6c65 7665  , extracted_leve
-0000c770: 6c73 2e69 7465 7272 6f77 7328 292c 2065  ls.iterrows(), e
-0000c780: 7874 7261 6374 6564 5f74 6f6b 656e 732e  xtracted_tokens.
-0000c790: 6974 6572 726f 7773 2829 293a 0a20 2020  iterrows()):.   
-0000c7a0: 2020 2020 206c 6576 656c 5f73 656c 6563       level_selec
-0000c7b0: 742c 2074 6f6b 656e 5f73 656c 6563 7420  t, token_select 
-0000c7c0: 3d20 6c76 6c73 2e6e 6f74 6e61 2829 2c20  = lvls.notna(), 
-0000c7d0: 746b 6e73 2e6e 6f74 6e61 2829 0a20 2020  tkns.notna().   
-0000c7e0: 2020 2020 2070 7265 7365 6e74 5f6c 6576       present_lev
-0000c7f0: 656c 732c 2070 7265 7365 6e74 5f74 6f6b  els, present_tok
-0000c800: 656e 7320 3d20 6c76 6c73 5b6c 6576 656c  ens = lvls[level
-0000c810: 5f73 656c 6563 745d 2c20 746b 6e73 5b74  _select], tkns[t
-0000c820: 6f6b 656e 5f73 656c 6563 745d 0a20 2020  oken_select].   
-0000c830: 2020 2020 2061 7373 6572 7420 6c65 7665       assert leve
-0000c840: 6c5f 7365 6c65 6374 2e73 756d 2829 203d  l_select.sum() =
-0000c850: 3d20 746f 6b65 6e5f 7365 6c65 6374 2e73  = token_select.s
-0000c860: 756d 2829 2c20 6622 4d43 207b 6d63 7d3a  um(), f"MC {mc}:
-0000c870: 207b 6c65 7665 6c5f 7365 6c65 6374 2e73   {level_select.s
-0000c880: 756d 2829 7d20 6c65 7665 6c73 5c6e 7b70  um()} levels\n{p
-0000c890: 7265 7365 6e74 5f6c 6576 656c 737d 5c6e  resent_levels}\n
-0000c8a0: 6275 7420 7b74 6f6b 656e 5f73 656c 6563  but {token_selec
-0000c8b0: 742e 7375 6d28 297d 2074 6f6b 656e 733a  t.sum()} tokens:
-0000c8c0: 5c6e 7b70 7265 7365 6e74 5f74 6f6b 656e  \n{present_token
-0000c8d0: 737d 220a 2020 2020 2020 2020 7265 7375  s}".        resu
-0000c8e0: 6c74 5f64 6963 745b 695d 203d 2064 6973  lt_dict[i] = dis
-0000c8f0: 7472 6962 7574 655f 746f 6b65 6e73 5f6f  tribute_tokens_o
-0000c900: 7665 725f 6c65 7665 6c73 2870 7265 7365  ver_levels(prese
-0000c910: 6e74 5f6c 6576 656c 732c 2070 7265 7365  nt_levels, prese
-0000c920: 6e74 5f74 6f6b 656e 732c 206d 633d 6d63  nt_tokens, mc=mc
-0000c930: 2c20 6162 6272 6576 6961 7469 6f6e 733d  , abbreviations=
-0000c940: 6162 6272 6576 6961 7469 6f6e 732c 206c  abbreviations, l
-0000c950: 6f67 6765 723d 6c6f 6767 6572 290a 2020  ogger=logger).  
-0000c960: 2020 7265 7320 3d20 7064 2e44 6174 6146    res = pd.DataF
-0000c970: 7261 6d65 2e66 726f 6d5f 6469 6374 2872  rame.from_dict(r
-0000c980: 6573 756c 745f 6469 6374 2c20 6f72 6965  esult_dict, orie
-0000c990: 6e74 3d27 696e 6465 7827 290a 2020 2020  nt='index').    
-0000c9a0: 7265 732e 636f 6c75 6d6e 7320 3d20 7064  res.columns = pd
-0000c9b0: 2e4d 756c 7469 496e 6465 782e 6672 6f6d  .MultiIndex.from
-0000c9c0: 5f74 7570 6c65 7328 7265 732e 636f 6c75  _tuples(res.colu
-0000c9d0: 6d6e 7329 0a20 2020 2066 6f72 6d5f 7479  mns).    form_ty
-0000c9e0: 7065 7320 3d20 7265 732e 636f 6c75 6d6e  pes = res.column
-0000c9f0: 732e 6c65 7665 6c73 5b30 5d0a 2020 2020  s.levels[0].    
-0000ca00: 6966 206c 656e 2866 6f72 6d5f 7479 7065  if len(form_type
-0000ca10: 7329 203e 2031 3a0a 2020 2020 2020 2020  s) > 1:.        
-0000ca20: 2320 636f 6c75 6d6e 7320 7769 6c6c 2062  # columns will b
-0000ca30: 6520 4d75 6c74 6949 6e64 6578 0a20 2020  e MultiIndex.   
-0000ca40: 2020 2020 2069 6620 2727 2069 6e20 666f       if '' in fo
-0000ca50: 726d 5f74 7970 6573 3a0a 2020 2020 2020  rm_types:.      
-0000ca60: 2020 2020 2020 2320 7468 6572 6520 6172        # there ar
-0000ca70: 6520 6c61 6265 6c73 2070 6572 7461 696e  e labels pertain
-0000ca80: 696e 6720 746f 2061 6c6c 2066 6f72 6d5f  ing to all form_
-0000ca90: 7479 7065 730a 2020 2020 2020 2020 2020  types.          
-0000caa0: 2020 666f 726d 7320 3d20 5b66 2066 6f72    forms = [f for
-0000cab0: 2066 2069 6e20 666f 726d 5f74 7970 6573   f in form_types
-0000cac0: 2069 6620 6620 213d 2027 275d 0a20 2020   if f != ''].   
-0000cad0: 2020 2020 2020 2020 2070 6572 7461 696e           pertain
-0000cae0: 696e 675f 746f 5f61 6c6c 203d 2072 6573  ing_to_all = res
-0000caf0: 2e6c 6f63 5b3a 2c20 2727 5d0a 2020 2020  .loc[:, ''].    
-0000cb00: 2020 2020 2020 2020 6469 7374 7269 6275          distribu
-0000cb10: 7465 645f 746f 5f61 6c6c 203d 2070 642e  ted_to_all = pd.
-0000cb20: 636f 6e63 6174 285b 7065 7274 6169 6e69  concat([pertaini
-0000cb30: 6e67 5f74 6f5f 616c 6c5d 202a 206c 656e  ng_to_all] * len
-0000cb40: 2866 6f72 6d73 292c 206b 6579 733d 666f  (forms), keys=fo
-0000cb50: 726d 732c 2061 7869 733d 3129 0a20 2020  rms, axis=1).   
-0000cb60: 2020 2020 2020 2020 206c 6576 656c 5f65           level_e
-0000cb70: 7869 7374 7320 3d20 6469 7374 7269 6275  xists = distribu
-0000cb80: 7465 645f 746f 5f61 6c6c 2e63 6f6c 756d  ted_to_all.colum
-0000cb90: 6e73 2e69 7369 6e28 7265 732e 636f 6c75  ns.isin(res.colu
-0000cba0: 6d6e 7329 0a20 2020 2020 2020 2020 2020  mns).           
-0000cbb0: 2065 7869 7374 696e 675f 6c65 7665 6c5f   existing_level_
-0000cbc0: 6e61 6d65 7320 3d20 6469 7374 7269 6275  names = distribu
-0000cbd0: 7465 645f 746f 5f61 6c6c 2e63 6f6c 756d  ted_to_all.colum
-0000cbe0: 6e73 5b6c 6576 656c 5f65 7869 7374 735d  ns[level_exists]
-0000cbf0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0000cc00: 203d 2070 642e 636f 6e63 6174 285b 7265   = pd.concat([re
-0000cc10: 732e 6c6f 635b 3a2c 2066 6f72 6d73 5d2c  s.loc[:, forms],
-0000cc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cc30: 2020 2020 2020 2020 2020 2020 2020 6469                di
-0000cc40: 7374 7269 6275 7465 645f 746f 5f61 6c6c  stributed_to_all
-0000cc50: 2e6c 6f63 5b3a 2c20 7e6c 6576 656c 5f65  .loc[:, ~level_e
-0000cc60: 7869 7374 735d 5d2c 0a20 2020 2020 2020  xists]],.       
-0000cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc80: 2020 2020 2061 7869 733d 3129 0a20 2020       axis=1).   
-0000cc90: 2020 2020 2020 2020 2070 6f74 656e 7469           potenti
-0000cca0: 616c 6c79 5f70 7265 6578 6973 7465 6e74  ally_preexistent
-0000ccb0: 203d 2064 6973 7472 6962 7574 6564 5f74   = distributed_t
-0000ccc0: 6f5f 616c 6c2e 6c6f 635b 3a2c 206c 6576  o_all.loc[:, lev
-0000ccd0: 656c 5f65 7869 7374 735d 0a20 2020 2020  el_exists].     
-0000cce0: 2020 2020 2020 2063 6865 636b 5f64 6f75         check_dou
-0000ccf0: 626c 655f 6174 7472 6962 7574 696f 6e20  ble_attribution 
-0000cd00: 3d20 7265 735b 6578 6973 7469 6e67 5f6c  = res[existing_l
-0000cd10: 6576 656c 5f6e 616d 6573 5d2e 6e6f 746e  evel_names].notn
-0000cd20: 6128 2920 2620 706f 7465 6e74 6961 6c6c  a() & potentiall
-0000cd30: 795f 7072 6565 7869 7374 656e 742e 6e6f  y_preexistent.no
-0000cd40: 746e 6128 290a 2020 2020 2020 2020 2020  tna().          
-0000cd50: 2020 6966 2063 6865 636b 5f64 6f75 626c    if check_doubl
-0000cd60: 655f 6174 7472 6962 7574 696f 6e2e 616e  e_attribution.an
-0000cd70: 7928 292e 616e 7928 293a 0a20 2020 2020  y().any():.     
-0000cd80: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0000cd90: 722e 7761 726e 696e 6728 0a20 2020 2020  r.warning(.     
-0000cda0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000cdb0: 4469 6420 6e6f 7420 6469 7374 7269 6275  Did not distribu
-0000cdc0: 7465 206c 6576 656c 7320 746f 2061 6c6c  te levels to all
-0000cdd0: 2066 6f72 6d20 7479 7065 7320 6265 6361   form types beca
-0000cde0: 7573 6520 736f 6d65 2068 6164 2061 6c72  use some had alr
-0000cdf0: 6561 6479 2062 6565 6e20 696e 6469 7669  eady been indivi
-0000ce00: 6475 616c 6c79 2073 7065 6369 6669 6564  dually specified
-0000ce10: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0000ce20: 7265 732e 6c6f 635b 3a2c 2065 7869 7374  res.loc[:, exist
-0000ce30: 696e 675f 6c65 7665 6c5f 6e61 6d65 735d  ing_level_names]
-0000ce40: 203d 2072 6573 5b65 7869 7374 696e 675f   = res[existing_
-0000ce50: 6c65 7665 6c5f 6e61 6d65 735d 2e66 696c  level_names].fil
-0000ce60: 6c6e 6128 706f 7465 6e74 6961 6c6c 795f  lna(potentially_
-0000ce70: 7072 6565 7869 7374 656e 7429 0a20 2020  preexistent).   
-0000ce80: 2020 2020 2066 6c5f 6d75 6c74 6969 6e64       fl_multiind
-0000ce90: 6578 203d 2070 642e 636f 6e63 6174 285b  ex = pd.concat([
-0000cea0: 666c 5d2c 206b 6579 733d 5b27 275d 2c20  fl], keys=[''], 
-0000ceb0: 6178 6973 3d31 290a 2020 2020 2020 2020  axis=1).        
-0000cec0: 7265 7320 3d20 7064 2e63 6f6e 6361 7428  res = pd.concat(
-0000ced0: 5b66 6c5f 6d75 6c74 6969 6e64 6578 2c20  [fl_multiindex, 
-0000cee0: 7265 732e 736f 7274 5f69 6e64 6578 2861  res.sort_index(a
-0000cef0: 7869 733d 3129 5d2c 2061 7869 733d 3129  xis=1)], axis=1)
-0000cf00: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-0000cf10: 2020 2069 6620 666f 726d 5f74 7970 6573     if form_types
-0000cf20: 5b30 5d20 3d3d 2027 273a 0a20 2020 2020  [0] == '':.     
-0000cf30: 2020 2020 2020 2072 6573 203d 2070 642e         res = pd.
-0000cf40: 636f 6e63 6174 285b 666c 2c20 7265 732e  concat([fl, res.
-0000cf50: 6472 6f70 6c65 7665 6c28 302c 2061 7869  droplevel(0, axi
-0000cf60: 733d 3129 2e73 6f72 745f 696e 6465 7828  s=1).sort_index(
-0000cf70: 6178 6973 3d31 295d 2c20 6178 6973 3d31  axis=1)], axis=1
-0000cf80: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000cf90: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-0000cfa0: 3d20 7064 2e63 6f6e 6361 7428 5b66 6c2c  = pd.concat([fl,
-0000cfb0: 2072 6573 2e73 6f72 745f 696e 6465 7828   res.sort_index(
-0000cfc0: 6178 6973 3d31 295d 2c20 6178 6973 3d31  axis=1)], axis=1
-0000cfd0: 290a 2020 2020 2020 2020 2020 2020 6c6f  ).            lo
-0000cfe0: 6767 6572 2e69 6e66 6f28 6622 5379 6e74  gger.info(f"Synt
-0000cff0: 6178 2066 6f72 2073 6576 6572 616c 2066  ax for several f
-0000d000: 6f72 6d20 7479 7065 7320 7573 6564 2066  orm types used f
-0000d010: 6f72 2061 2073 696e 676c 6520 6f6e 653a  or a single one:
-0000d020: 2027 7b66 6f72 6d5f 7479 7065 735b 305d   '{form_types[0]
-0000d030: 7d27 2229 0a0a 2020 2020 6966 2066 696c  }'")..    if fil
-0000d040: 6c5f 6d6e 5f75 6e74 696c 2069 7320 6e6f  l_mn_until is no
-0000d050: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000d060: 6966 206c 656e 2866 6f72 6d5f 7479 7065  if len(form_type
-0000d070: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
-0000d080: 2020 2020 206d 6e5f 636f 6c2c 206d 6e5f       mn_col, mn_
-0000d090: 6f6e 7365 7420 3d20 276d 6e27 2c20 276d  onset = 'mn', 'm
-0000d0a0: 6e5f 6f6e 7365 7427 0a20 2020 2020 2020  n_onset'.       
-0000d0b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000d0c0: 2020 206d 6e5f 636f 6c2c 206d 6e5f 6f6e     mn_col, mn_on
-0000d0d0: 7365 7420 3d20 2827 272c 2027 6d6e 2729  set = ('', 'mn')
-0000d0e0: 2c20 2827 272c 2027 6d6e 5f6f 6e73 6574  , ('', 'mn_onset
-0000d0f0: 2729 0a20 2020 2020 2020 2066 6972 7374  ').        first
-0000d100: 5f6d 6e20 3d20 666c 2e6d 6e2e 6d69 6e28  _mn = fl.mn.min(
-0000d110: 290a 2020 2020 2020 2020 6c61 7374 5f6d  ).        last_m
-0000d120: 6e20 3d20 6669 6c6c 5f6d 6e5f 756e 7469  n = fill_mn_unti
-0000d130: 6c20 6966 2066 696c 6c5f 6d6e 5f75 6e74  l if fill_mn_unt
-0000d140: 696c 203e 202d 3120 656c 7365 2066 6c2e  il > -1 else fl.
-0000d150: 6d6e 2e6d 6178 2829 0a20 2020 2020 2020  mn.max().       
-0000d160: 2061 6c6c 5f6d 6e73 203d 2073 6574 2872   all_mns = set(r
-0000d170: 616e 6765 2866 6972 7374 5f6d 6e2c 206c  ange(first_mn, l
-0000d180: 6173 745f 6d6e 202b 2031 2929 0a20 2020  ast_mn + 1)).   
-0000d190: 2020 2020 206d 6973 7369 6e67 203d 2061       missing = a
-0000d1a0: 6c6c 5f6d 6e73 2e64 6966 6665 7265 6e63  ll_mns.differenc
-0000d1b0: 6528 7365 7428 7265 735b 6d6e 5f63 6f6c  e(set(res[mn_col
-0000d1c0: 5d29 290a 2020 2020 2020 2020 6d69 7373  ])).        miss
-0000d1d0: 696e 675f 6d6e 203d 2070 642e 4461 7461  ing_mn = pd.Data
-0000d1e0: 4672 616d 6528 7b6d 6e5f 636f 6c3a 206c  Frame({mn_col: l
-0000d1f0: 6973 7428 6d69 7373 696e 6729 7d29 2e72  ist(missing)}).r
-0000d200: 6569 6e64 6578 2872 6573 2e63 6f6c 756d  eindex(res.colum
-0000d210: 6e73 2c20 6178 6973 3d31 290a 2020 2020  ns, axis=1).    
-0000d220: 2020 2020 7265 7320 3d20 7064 2e63 6f6e      res = pd.con
-0000d230: 6361 7428 5b72 6573 2c20 6d69 7373 696e  cat([res, missin
-0000d240: 675f 6d6e 5d2c 2069 676e 6f72 655f 696e  g_mn], ignore_in
-0000d250: 6465 783d 5472 7565 292e 736f 7274 5f76  dex=True).sort_v
-0000d260: 616c 7565 7328 5b6d 6e5f 636f 6c2c 206d  alues([mn_col, m
-0000d270: 6e5f 6f6e 7365 745d 292e 7265 7365 745f  n_onset]).reset_
-0000d280: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
-0000d290: 0a20 2020 2072 6574 7572 6e20 7265 730a  .    return res.
-0000d2a0: 0a40 6f76 6572 6c6f 6164 0a64 6566 2061  .@overload.def a
-0000d2b0: 6464 5f63 6f6c 6c65 6374 696f 6e73 286c  dd_collections(l
-0000d2c0: 6566 743a 2070 642e 5365 7269 6573 2c20  eft: pd.Series, 
-0000d2d0: 7269 6768 743a 2043 6f6c 6c65 6374 696f  right: Collectio
-0000d2e0: 6e2c 2064 7479 7065 3a20 4474 7970 6529  n, dtype: Dtype)
-0000d2f0: 202d 3e20 7064 2e53 6572 6965 733a 0a20   -> pd.Series:. 
-0000d300: 2020 202e 2e2e 0a40 6f76 6572 6c6f 6164     ....@overload
-0000d310: 0a64 6566 2061 6464 5f63 6f6c 6c65 6374  .def add_collect
-0000d320: 696f 6e73 286c 6566 743a 204e 4441 7272  ions(left: NDArr
-0000d330: 6179 2c20 7269 6768 743a 2043 6f6c 6c65  ay, right: Colle
-0000d340: 6374 696f 6e2c 2064 7479 7065 3a20 4474  ction, dtype: Dt
-0000d350: 7970 6529 202d 3e20 4e44 4172 7261 793a  ype) -> NDArray:
-0000d360: 0a20 2020 202e 2e2e 0a40 6f76 6572 6c6f  .    ....@overlo
-0000d370: 6164 0a64 6566 2061 6464 5f63 6f6c 6c65  ad.def add_colle
-0000d380: 6374 696f 6e73 286c 6566 743a 206c 6973  ctions(left: lis
-0000d390: 742c 2072 6967 6874 3a20 436f 6c6c 6563  t, right: Collec
-0000d3a0: 7469 6f6e 2c20 6474 7970 653a 2044 7479  tion, dtype: Dty
-0000d3b0: 7065 2920 2d3e 206c 6973 743a 0a20 2020  pe) -> list:.   
-0000d3c0: 202e 2e2e 0a40 6f76 6572 6c6f 6164 0a64   ....@overload.d
-0000d3d0: 6566 2061 6464 5f63 6f6c 6c65 6374 696f  ef add_collectio
-0000d3e0: 6e73 286c 6566 743a 2074 7570 6c65 2c20  ns(left: tuple, 
-0000d3f0: 7269 6768 743a 2043 6f6c 6c65 6374 696f  right: Collectio
-0000d400: 6e2c 2064 7479 7065 3a20 4474 7970 6529  n, dtype: Dtype)
-0000d410: 202d 3e20 7475 706c 653a 0a20 2020 202e   -> tuple:.    .
-0000d420: 2e2e 0a64 6566 2061 6464 5f63 6f6c 6c65  ...def add_colle
-0000d430: 6374 696f 6e73 286c 6566 743a 2055 6e69  ctions(left: Uni
-0000d440: 6f6e 5b70 642e 5365 7269 6573 2c20 4e44  on[pd.Series, ND
-0000d450: 4172 7261 792c 206c 6973 742c 2074 7570  Array, list, tup
-0000d460: 6c65 5d2c 0a20 2020 2020 2020 2020 2020  le],.           
-0000d470: 2020 2020 2020 2020 2072 6967 6874 3a20           right: 
-0000d480: 436f 6c6c 6563 7469 6f6e 2c0a 2020 2020  Collection,.    
-0000d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4a0: 6474 7970 653a 2044 7479 7065 203d 2027  dtype: Dtype = '
-0000d4b0: 7374 7269 6e67 2729 202d 3e20 556e 696f  string') -> Unio
-0000d4c0: 6e5b 7064 2e53 6572 6965 732c 204e 4441  n[pd.Series, NDA
-0000d4d0: 7272 6179 2c20 6c69 7374 2c20 7475 706c  rray, list, tupl
-0000d4e0: 655d 3a0a 2020 2020 2222 225a 6970 2d61  e]:.    """Zip-a
-0000d4f0: 6464 7320 746f 6765 7468 6572 2074 6865  dds together the
-0000d500: 2073 7472 696e 6773 2028 6279 2064 6566   strings (by def
-0000d510: 6175 6c74 2920 636f 6e74 6169 6e65 6420  ault) contained 
-0000d520: 696e 2074 776f 2063 6f6c 6c65 6374 696f  in two collectio
-0000d530: 6e73 2072 6567 6172 646c 6573 7320 6f66  ns regardless of
-0000d540: 2074 6865 6972 2074 7970 6573 2028 7468   their types (th
-0000d550: 696e 6b20 6f66 2061 6464 696e 670a 2020  ink of adding.  
-0000d560: 2020 7477 6f20 636f 6c75 6d6e 7320 746f    two columns to
-0000d570: 6765 7468 6572 2065 6c65 6d65 6e74 2d77  gether element-w
-0000d580: 6973 6529 2e20 5061 7373 2061 6e6f 7468  ise). Pass anoth
-0000d590: 6572 2060 6064 7479 7065 6060 2069 6620  er ``dtype`` if 
-0000d5a0: 796f 7520 7761 6e74 2074 6865 2076 616c  you want the val
-0000d5b0: 7565 7320 746f 2062 6520 636f 6e76 6572  ues to be conver
-0000d5c0: 7465 6420 746f 2061 6e6f 7468 6572 0a20  ted to another. 
-0000d5d0: 2020 2064 6174 6174 7970 6520 6265 666f     datatype befo
-0000d5e0: 7265 2061 6464 696e 6720 7468 656d 2074  re adding them t
-0000d5f0: 6f67 6574 6865 722e 0a20 2020 2022 2222  ogether..    """
-0000d600: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-0000d610: 6365 286c 6566 742c 2070 642e 5365 7269  ce(left, pd.Seri
-0000d620: 6573 2920 616e 6420 6973 696e 7374 616e  es) and isinstan
-0000d630: 6365 2872 6967 6874 2c20 7064 2e53 6572  ce(right, pd.Ser
-0000d640: 6965 7329 3a0a 2020 2020 2020 2020 6c65  ies):.        le
-0000d650: 6674 2e61 7374 7970 6528 6474 7970 6529  ft.astype(dtype)
-0000d660: 202b 2072 6967 6874 2e61 7374 7970 6528   + right.astype(
-0000d670: 6474 7970 6529 0a20 2020 2072 6573 756c  dtype).    resul
-0000d680: 745f 7365 7269 6573 203d 2070 642e 5365  t_series = pd.Se
-0000d690: 7269 6573 286c 6566 742c 2064 7479 7065  ries(left, dtype
-0000d6a0: 3d64 7479 7065 2920 2b20 7064 2e53 6572  =dtype) + pd.Ser
-0000d6b0: 6965 7328 7269 6768 742c 2064 7479 7065  ies(right, dtype
-0000d6c0: 3d64 7479 7065 290a 2020 2020 7472 793a  =dtype).    try:
-0000d6d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000d6e0: 6c65 6674 2e5f 5f63 6c61 7373 5f5f 2872  left.__class__(r
-0000d6f0: 6573 756c 745f 7365 7269 6573 2e74 6f5f  esult_series.to_
-0000d700: 6c69 7374 2829 290a 2020 2020 6578 6365  list()).    exce
-0000d710: 7074 2028 5479 7065 4572 726f 722c 2056  pt (TypeError, V
-0000d720: 616c 7565 4572 726f 7229 3a0a 2020 2020  alueError):.    
-0000d730: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0000d740: 745f 7365 7269 6573 2e76 616c 7565 730a  t_series.values.
-0000d750: 0a40 6f76 6572 6c6f 6164 0a64 6566 2063  .@overload.def c
-0000d760: 6173 7432 636f 6c6c 6563 7469 6f6e 2863  ast2collection(c
-0000d770: 6f6c 6c3a 2070 642e 5365 7269 6573 2c20  oll: pd.Series, 
-0000d780: 6675 6e63 3a20 4361 6c6c 6162 6c65 2c20  func: Callable, 
-0000d790: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0000d7a0: 202d 3e20 7064 2e53 6572 6965 733a 0a20   -> pd.Series:. 
-0000d7b0: 2020 202e 2e2e 0a40 6f76 6572 6c6f 6164     ....@overload
-0000d7c0: 0a64 6566 2063 6173 7432 636f 6c6c 6563  .def cast2collec
-0000d7d0: 7469 6f6e 2863 6f6c 6c3a 204e 4441 7272  tion(coll: NDArr
-0000d7e0: 6179 2c20 6675 6e63 3a20 4361 6c6c 6162  ay, func: Callab
-0000d7f0: 6c65 2c20 2a61 7267 732c 202a 2a6b 7761  le, *args, **kwa
-0000d800: 7267 7329 202d 3e20 4e44 4172 7261 793a  rgs) -> NDArray:
-0000d810: 0a20 2020 202e 2e2e 0a40 6f76 6572 6c6f  .    ....@overlo
-0000d820: 6164 0a64 6566 2063 6173 7432 636f 6c6c  ad.def cast2coll
-0000d830: 6563 7469 6f6e 2863 6f6c 6c3a 206c 6973  ection(coll: lis
-0000d840: 742c 2066 756e 633a 2043 616c 6c61 626c  t, func: Callabl
-0000d850: 652c 202a 6172 6773 2c20 2a2a 6b77 6172  e, *args, **kwar
-0000d860: 6773 2920 2d3e 206c 6973 743a 0a20 2020  gs) -> list:.   
-0000d870: 202e 2e2e 0a40 6f76 6572 6c6f 6164 0a64   ....@overload.d
-0000d880: 6566 2063 6173 7432 636f 6c6c 6563 7469  ef cast2collecti
-0000d890: 6f6e 2863 6f6c 6c3a 2074 7570 6c65 2c20  on(coll: tuple, 
-0000d8a0: 6675 6e63 3a20 4361 6c6c 6162 6c65 2c20  func: Callable, 
-0000d8b0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0000d8c0: 202d 3e20 7475 706c 653a 0a20 2020 202e   -> tuple:.    .
-0000d8d0: 2e2e 0a64 6566 2063 6173 7432 636f 6c6c  ...def cast2coll
-0000d8e0: 6563 7469 6f6e 2863 6f6c 6c3a 2055 6e69  ection(coll: Uni
-0000d8f0: 6f6e 5b70 642e 5365 7269 6573 2c20 4e44  on[pd.Series, ND
-0000d900: 4172 7261 792c 206c 6973 742c 2074 7570  Array, list, tup
-0000d910: 6c65 5d2c 2066 756e 633a 2043 616c 6c61  le], func: Calla
-0000d920: 626c 652c 202a 6172 6773 2c20 2a2a 6b77  ble, *args, **kw
-0000d930: 6172 6773 2920 2d3e 2055 6e69 6f6e 5b70  args) -> Union[p
-0000d940: 642e 5365 7269 6573 2c20 4e44 4172 7261  d.Series, NDArra
-0000d950: 792c 206c 6973 742c 2074 7570 6c65 5d3a  y, list, tuple]:
-0000d960: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-0000d970: 6365 2863 6f6c 6c2c 2070 642e 5365 7269  ce(coll, pd.Seri
-0000d980: 6573 293a 0a20 2020 2020 2020 2072 6574  es):.        ret
-0000d990: 7572 6e20 7472 616e 7366 6f72 6d28 636f  urn transform(co
-0000d9a0: 6c6c 2c20 6675 6e63 2c20 2a61 7267 732c  ll, func, *args,
-0000d9b0: 202a 2a6b 7761 7267 7329 0a20 2020 2077   **kwargs).    w
-0000d9c0: 6974 6820 7761 726e 696e 6773 2e63 6174  ith warnings.cat
-0000d9d0: 6368 5f77 6172 6e69 6e67 7328 293a 0a20  ch_warnings():. 
-0000d9e0: 2020 2020 2020 2023 2070 616e 6461 7320         # pandas 
-0000d9f0: 6465 7665 6c6f 7065 7273 2064 6f69 6e67  developers doing
-0000da00: 2074 6865 6972 206d 6f73 7420 616e 6e6f   their most anno
-0000da10: 7969 6e67 2074 6869 6e67 203e 3a28 0a20  ying thing >:(. 
-0000da20: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
-0000da30: 6669 6c74 6572 7761 726e 696e 6773 280a  filterwarnings(.
-0000da40: 2020 2020 2020 2020 2020 2020 2269 676e              "ign
-0000da50: 6f72 6522 2c0a 2020 2020 2020 2020 2020  ore",.          
-0000da60: 2020 6361 7465 676f 7279 3d46 7574 7572    category=Futur
-0000da70: 6557 6172 6e69 6e67 2c0a 2020 2020 2020  eWarning,.      
-0000da80: 2020 2020 2020 6d65 7373 6167 653d 280a        message=(.
-0000da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000daa0: 222e 2a54 6865 2064 6566 6175 6c74 2064  ".*The default d
-0000dab0: 7479 7065 2066 6f72 2065 6d70 7479 2053  type for empty S
-0000dac0: 6572 6965 732e 2a22 0a20 2020 2020 2020  eries.*".       
-0000dad0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-0000dae0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-0000daf0: 5f73 6572 6965 7320 3d20 6675 6e63 2870  _series = func(p
-0000db00: 642e 5365 7269 6573 2863 6f6c 6c29 2c20  d.Series(coll), 
-0000db10: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0000db20: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-0000db30: 2020 7265 7475 726e 2063 6f6c 6c2e 5f5f    return coll.__
-0000db40: 636c 6173 735f 5f28 7265 7375 6c74 5f73  class__(result_s
-0000db50: 6572 6965 732e 746f 5f6c 6973 7428 2929  eries.to_list())
-0000db60: 0a20 2020 2065 7863 6570 7420 5479 7065  .    except Type
-0000db70: 4572 726f 723a 0a20 2020 2020 2020 2072  Error:.        r
-0000db80: 6574 7572 6e20 7265 7375 6c74 5f73 6572  eturn result_ser
-0000db90: 6965 732e 7661 6c75 6573 0a0a 0a0a 406f  ies.values....@o
-0000dba0: 7665 726c 6f61 640a 6465 6620 6669 6674  verload.def fift
-0000dbb0: 6873 3261 6363 2866 6966 7468 733a 2069  hs2acc(fifths: i
-0000dbc0: 6e74 2920 2d3e 2073 7472 3a0a 2020 2020  nt) -> str:.    
-0000dbd0: 2e2e 2e0a 406f 7665 726c 6f61 640a 6465  ....@overload.de
-0000dbe0: 6620 6669 6674 6873 3261 6363 2866 6966  f fifths2acc(fif
-0000dbf0: 7468 733a 2070 642e 5365 7269 6573 2920  ths: pd.Series) 
-0000dc00: 2d3e 2070 642e 5365 7269 6573 3a0a 2020  -> pd.Series:.  
-0000dc10: 2020 2e2e 2e0a 406f 7665 726c 6f61 640a    ....@overload.
-0000dc20: 6465 6620 6669 6674 6873 3261 6363 2866  def fifths2acc(f
-0000dc30: 6966 7468 733a 204e 4441 7272 6179 5b69  ifths: NDArray[i
-0000dc40: 6e74 5d29 202d 3e20 4e44 4172 7261 795b  nt]) -> NDArray[
-0000dc50: 7374 725d 3a0a 2020 2020 2e2e 2e0a 406f  str]:.    ....@o
-0000dc60: 7665 726c 6f61 640a 6465 6620 6669 6674  verload.def fift
-0000dc70: 6873 3261 6363 2866 6966 7468 733a 204c  hs2acc(fifths: L
-0000dc80: 6973 745b 696e 745d 2920 2d3e 204c 6973  ist[int]) -> Lis
-0000dc90: 745b 7374 725d 3a0a 2020 2020 2e2e 2e0a  t[str]:.    ....
-0000dca0: 406f 7665 726c 6f61 640a 6465 6620 6669  @overload.def fi
-0000dcb0: 6674 6873 3261 6363 2866 6966 7468 733a  fths2acc(fifths:
-0000dcc0: 2054 7570 6c65 5b69 6e74 5d29 202d 3e20   Tuple[int]) -> 
-0000dcd0: 5475 706c 655b 7374 725d 3a0a 2020 2020  Tuple[str]:.    
-0000dce0: 2e2e 2e0a 6465 6620 6669 6674 6873 3261  ....def fifths2a
-0000dcf0: 6363 2866 6966 7468 733a 2055 6e69 6f6e  cc(fifths: Union
-0000dd00: 5b69 6e74 2c20 7064 2e53 6572 6965 732c  [int, pd.Series,
-0000dd10: 204e 4441 7272 6179 5b69 6e74 5d2c 204c   NDArray[int], L
-0000dd20: 6973 745b 696e 745d 2c20 5475 706c 655b  ist[int], Tuple[
-0000dd30: 696e 745d 5d29 202d 3e20 556e 696f 6e5b  int]]) -> Union[
-0000dd40: 7374 722c 2070 642e 5365 7269 6573 2c20  str, pd.Series, 
-0000dd50: 4e44 4172 7261 795b 7374 725d 2c20 4c69  NDArray[str], Li
-0000dd60: 7374 5b73 7472 5d2c 2054 7570 6c65 5b73  st[str], Tuple[s
-0000dd70: 7472 5d5d 3a0a 2020 2020 2222 2220 5265  tr]]:.    """ Re
-0000dd80: 7475 726e 7320 6163 6369 6465 6e74 616c  turns accidental
-0000dd90: 7320 666f 7220 6120 7374 6163 6b20 6f66  s for a stack of
-0000dda0: 2066 6966 7468 7320 7468 6174 2063 616e   fifths that can
-0000ddb0: 2062 6520 636f 6d62 696e 6564 2077 6974   be combined wit
-0000ddc0: 6820 610a 2020 2020 2020 2020 6261 7369  h a.        basi
-0000ddd0: 6320 7265 7072 6573 656e 7461 7469 6f6e  c representation
-0000dde0: 206f 6620 7468 6520 7365 7665 6e20 7374   of the seven st
-0000ddf0: 6570 732e 2222 220a 2020 2020 7472 793a  eps.""".    try:
-0000de00: 0a20 2020 2020 2020 2066 6966 7468 7320  .        fifths 
-0000de10: 3d20 696e 7428 666c 6f61 7428 6669 6674  = int(float(fift
-0000de20: 6873 2929 0a20 2020 2065 7863 6570 7420  hs)).    except 
-0000de30: 5479 7065 4572 726f 723a 0a20 2020 2020  TypeError:.     
-0000de40: 2020 2072 6574 7572 6e20 6361 7374 3263     return cast2c
-0000de50: 6f6c 6c65 6374 696f 6e28 636f 6c6c 3d66  ollection(coll=f
-0000de60: 6966 7468 732c 2066 756e 633d 6669 6674  ifths, func=fift
-0000de70: 6873 3261 6363 290a 2020 2020 6163 6320  hs2acc).    acc 
-0000de80: 3d20 2866 6966 7468 7320 2b20 3129 202f  = (fifths + 1) /
-0000de90: 2f20 370a 2020 2020 7265 7475 726e 2061  / 7.    return a
-0000dea0: 6273 2861 6363 2920 2a20 2762 2720 6966  bs(acc) * 'b' if
-0000deb0: 2061 6363 203c 2030 2065 6c73 6520 6163   acc < 0 else ac
-0000dec0: 6320 2a20 2723 270a 0a0a 4066 756e 6374  c * '#'...@funct
-0000ded0: 696f 6e5f 6c6f 6767 6572 0a64 6566 2066  ion_logger.def f
-0000dee0: 6966 7468 7332 6976 2866 6966 7468 733a  ifths2iv(fifths:
-0000def0: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
-0000df00: 2020 2073 6d61 6c6c 6573 743a 2062 6f6f     smallest: boo
-0000df10: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-0000df20: 2020 2020 2020 2020 7065 7266 6563 743a          perfect:
-0000df30: 2073 7472 203d 2027 5027 2c0a 2020 2020   str = 'P',.    
-0000df40: 2020 2020 2020 2020 206d 616a 6f72 3a20           major: 
-0000df50: 7374 7220 3d20 274d 272c 0a20 2020 2020  str = 'M',.     
-0000df60: 2020 2020 2020 2020 6d69 6e6f 723a 2073          minor: s
-0000df70: 7472 203d 2027 6d27 2c0a 2020 2020 2020  tr = 'm',.      
-0000df80: 2020 2020 2020 2061 7567 6d65 6e74 6564         augmented
-0000df90: 3a20 7374 7220 3d20 2761 272c 0a20 2020  : str = 'a',.   
-0000dfa0: 2020 2020 2020 2020 2020 6469 6d69 6e69            dimini
-0000dfb0: 7368 6564 3a20 7374 7220 3d20 2764 2729  shed: str = 'd')
-0000dfc0: 202d 3e20 7374 723a 0a20 2020 2022 2222   -> str:.    """
-0000dfd0: 2052 6574 7572 6e20 696e 7465 7276 616c   Return interval
-0000dfe0: 206e 616d 6520 6f66 2061 2073 7461 636b   name of a stack
-0000dff0: 206f 6620 6669 6674 6873 2073 7563 6820   of fifths such 
-0000e000: 7468 6174 2030 203d 2027 5031 272c 202d  that 0 = 'P1', -
-0000e010: 3120 3d20 2750 3427 2c20 2d32 203d 2027  1 = 'P4', -2 = '
-0000e020: 6d37 272c 2034 203d 2027 4d33 2720 6574  m7', 4 = 'M3' et
-0000e030: 632e 2049 6620 796f 7520 7061 7373 0a20  c. If you pass. 
-0000e040: 2020 2060 6073 6d61 6c6c 6573 743d 5472     ``smallest=Tr
-0000e050: 7565 6060 2c20 696e 7465 7276 616c 7320  ue``, intervals 
-0000e060: 6f66 2061 2066 6966 7468 206f 7220 6772  of a fifth or gr
-0000e070: 6561 7465 7220 7769 6c6c 2062 6520 696e  eater will be in
-0000e080: 7665 7274 6564 2028 652e 672e 2027 6d36  verted (e.g. 'm6
-0000e090: 2720 3d3e 2027 2d4d 3327 2061 6e64 2027  ' => '-M3' and '
-0000e0a0: 4435 2720 3d3e 2027 2d41 3427 292e 0a0a  D5' => '-A4')...
-0000e0b0: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
-0000e0c0: 2066 6966 7468 733a 204e 756d 6265 7220   fifths: Number 
-0000e0d0: 6f66 2066 6966 7468 7320 7265 7072 6573  of fifths repres
-0000e0e0: 656e 7469 6e67 2074 6865 2069 6e76 6572  enting the inver
-0000e0f0: 616c 0a20 2020 2020 2073 6d61 6c6c 6573  al.      smalles
-0000e100: 743a 2050 6173 7320 5472 7565 2069 6620  t: Pass True if 
-0000e110: 796f 7520 7761 6e74 2074 6f20 7772 6170  you want to wrap
-0000e120: 2069 6e74 6572 7661 6c73 206f 6620 6120   intervals of a 
-0000e130: 6669 6674 6873 2061 6e64 206c 6172 6765  fifths and large
-0000e140: 7220 746f 2074 6865 2064 6f77 6e77 6172  r to the downwar
-0000e150: 6420 636f 756e 7465 7270 6172 742e 0a20  d counterpart.. 
-0000e160: 2020 2020 2070 6572 6665 6374 3a20 5374       perfect: St
-0000e170: 7269 6e67 2072 6570 7265 7365 6e74 696e  ring representin
-0000e180: 6720 7468 6520 7065 7266 6563 7420 696e  g the perfect in
-0000e190: 7465 7276 616c 2071 7561 6c69 7479 2c20  terval quality, 
-0000e1a0: 6465 6661 756c 7473 2074 6f20 2750 272e  defaults to 'P'.
-0000e1b0: 0a20 2020 2020 206d 616a 6f72 3a20 5374  .      major: St
-0000e1c0: 7269 6e67 2072 6570 7265 7365 6e74 696e  ring representin
-0000e1d0: 6720 7468 6520 6d61 6a6f 7220 696e 7465  g the major inte
-0000e1e0: 7276 616c 2071 7561 6c69 7479 2c20 6465  rval quality, de
-0000e1f0: 6661 756c 7473 2074 6f20 274d 272e 0a20  faults to 'M'.. 
-0000e200: 2020 2020 206d 696e 6f72 3a20 5374 7269       minor: Stri
-0000e210: 6e67 2072 6570 7265 7365 6e74 696e 6720  ng representing 
-0000e220: 7468 6520 6d69 6e6f 7220 696e 7465 7276  the minor interv
-0000e230: 616c 2071 7561 6c69 7479 2c20 6465 6661  al quality, defa
-0000e240: 756c 7473 2074 6f20 276d 272e 0a20 2020  ults to 'm'..   
-0000e250: 2020 2061 7567 6d65 6e74 6564 3a20 5374     augmented: St
-0000e260: 7269 6e67 2072 6570 7265 7365 6e74 696e  ring representin
-0000e270: 6720 7468 6520 6175 676d 656e 7465 6420  g the augmented 
-0000e280: 696e 7465 7276 616c 2071 7561 6c69 7479  interval quality
-0000e290: 2c20 6465 6661 756c 7473 2074 6f20 2761  , defaults to 'a
-0000e2a0: 272e 0a20 2020 2020 2064 696d 696e 6973  '..      diminis
-0000e2b0: 6865 643a 2053 7472 696e 6720 7265 7072  hed: String repr
-0000e2c0: 6573 656e 7469 6e67 2074 6865 2064 696d  esenting the dim
-0000e2d0: 696e 6973 6865 6420 696e 7465 7276 616c  inished interval
-0000e2e0: 2071 7561 6c69 7479 2c20 6465 6661 756c   quality, defaul
-0000e2f0: 7473 2074 6f20 2764 272e 0a0a 2020 2020  ts to 'd'...    
-0000e300: 5265 7475 726e 733a 0a20 2020 2020 204e  Returns:.      N
-0000e310: 616d 6520 6f66 2074 6865 2069 6e74 6572  ame of the inter
-0000e320: 7661 6c20 6173 2061 2073 7472 696e 672e  val as a string.
-0000e330: 0a20 2020 2022 2222 0a20 2020 2066 6966  .    """.    fif
-0000e340: 7468 735f 706c 7573 5f6f 6e65 203d 2066  ths_plus_one = f
-0000e350: 6966 7468 7320 2b20 3120 2023 206d 616b  ifths + 1  # mak
-0000e360: 696e 6720 3020 3d20 666f 7572 7468 2c20  ing 0 = fourth, 
-0000e370: 3120 3d20 756e 6973 6f6e 2c20 3220 3d20  1 = unison, 2 = 
-0000e380: 6669 6674 6820 6574 632e 0a20 2020 2069  fifth etc..    i
-0000e390: 6e74 5f6e 756d 203d 205b 2234 222c 2022  nt_num = ["4", "
-0000e3a0: 3122 2c20 2235 222c 2022 3222 2c20 2236  1", "5", "2", "6
-0000e3b0: 222c 2022 3322 2c20 2237 225d 5b66 6966  ", "3", "7"][fif
-0000e3c0: 7468 735f 706c 7573 5f6f 6e65 2025 2037  ths_plus_one % 7
-0000e3d0: 5d0a 2020 2020 7368 6172 705f 7769 7365  ].    sharp_wise
-0000e3e0: 5f71 7561 6c69 7479 203d 2061 7567 6d65  _quality = augme
-0000e3f0: 6e74 6564 0a20 2020 2066 6c61 745f 7769  nted.    flat_wi
-0000e400: 7365 5f71 7561 6c69 7479 203d 2064 696d  se_quality = dim
-0000e410: 696e 6973 6865 640a 2020 2020 7175 616c  inished.    qual
-0000e420: 6974 6965 7320 3d20 286d 696e 6f72 2c20  ities = (minor, 
-0000e430: 6d69 6e6f 722c 206d 696e 6f72 2c20 6d69  minor, minor, mi
-0000e440: 6e6f 722c 2070 6572 6665 6374 2c20 7065  nor, perfect, pe
-0000e450: 7266 6563 742c 2070 6572 6665 6374 2c20  rfect, perfect, 
-0000e460: 6d61 6a6f 722c 206d 616a 6f72 2c20 6d61  major, major, ma
-0000e470: 6a6f 722c 206d 616a 6f72 290a 2020 2020  jor, major).    
-0000e480: 7175 616c 6974 7920 3d20 2222 0a20 2020  quality = "".   
-0000e490: 2069 6620 736d 616c 6c65 7374 2061 6e64   if smallest and
-0000e4a0: 2069 6e74 2869 6e74 5f6e 756d 2920 3e20   int(int_num) > 
-0000e4b0: 343a 0a20 2020 2020 2020 2069 6e74 5f6e  4:.        int_n
-0000e4c0: 756d 203d 2073 7472 2839 202d 2069 6e74  um = str(9 - int
-0000e4d0: 2869 6e74 5f6e 756d 2929 0a20 2020 2020  (int_num)).     
-0000e4e0: 2020 2073 6861 7270 5f77 6973 655f 7175     sharp_wise_qu
-0000e4f0: 616c 6974 792c 2066 6c61 745f 7769 7365  ality, flat_wise
-0000e500: 5f71 7561 6c69 7479 203d 2066 6c61 745f  _quality = flat_
-0000e510: 7769 7365 5f71 7561 6c69 7479 2c20 7368  wise_quality, sh
-0000e520: 6172 705f 7769 7365 5f71 7561 6c69 7479  arp_wise_quality
-0000e530: 0a20 2020 2020 2020 2071 7561 6c69 7469  .        qualiti
-0000e540: 6573 203d 2074 7570 6c65 2872 6576 6572  es = tuple(rever
-0000e550: 7365 6428 7175 616c 6974 6965 7329 290a  sed(qualities)).
-0000e560: 2020 2020 2020 2020 7175 616c 6974 7920          quality 
-0000e570: 3d20 222d 220a 2020 2020 6966 202d 3520  = "-".    if -5 
-0000e580: 3c3d 2066 6966 7468 7320 3c3d 2035 3a0a  <= fifths <= 5:.
-0000e590: 2020 2020 2020 2020 7175 616c 6974 7920          quality 
-0000e5a0: 2b3d 2071 7561 6c69 7469 6573 5b66 6966  += qualities[fif
-0000e5b0: 7468 7320 2b20 355d 0a20 2020 2065 6c69  ths + 5].    eli
-0000e5c0: 6620 6669 6674 6873 203e 2035 3a0a 2020  f fifths > 5:.  
-0000e5d0: 2020 2020 2020 7175 616c 6974 7920 2b3d        quality +=
-0000e5e0: 2073 6861 7270 5f77 6973 655f 7175 616c   sharp_wise_qual
-0000e5f0: 6974 7920 2a20 2866 6966 7468 735f 706c  ity * (fifths_pl
-0000e600: 7573 5f6f 6e65 202f 2f20 3729 0a20 2020  us_one // 7).   
-0000e610: 2065 6c73 653a 0a20 2020 2020 2020 2071   else:.        q
-0000e620: 7561 6c69 7479 202b 3d20 666c 6174 5f77  uality += flat_w
-0000e630: 6973 655f 7175 616c 6974 7920 2a20 2828  ise_quality * ((
-0000e640: 2d66 6966 7468 7320 2b20 3129 202f 2f20  -fifths + 1) // 
-0000e650: 3729 0a20 2020 2072 6574 7572 6e20 7175  7).    return qu
-0000e660: 616c 6974 7920 2b20 696e 745f 6e75 6d0a  ality + int_num.
-0000e670: 0a40 6f76 6572 6c6f 6164 0a64 6566 2074  .@overload.def t
-0000e680: 7063 326e 616d 6528 7470 633a 2069 6e74  pc2name(tpc: int
-0000e690: 2c20 6d73 3a20 626f 6f6c 203d 2046 616c  , ms: bool = Fal
-0000e6a0: 7365 2c20 6d69 6e6f 723a 2062 6f6f 6c20  se, minor: bool 
-0000e6b0: 3d20 4661 6c73 6529 202d 3e20 4f70 7469  = False) -> Opti
-0000e6c0: 6f6e 616c 5b73 7472 5d3a 0a20 2020 202e  onal[str]:.    .
-0000e6d0: 2e2e 0a40 6f76 6572 6c6f 6164 0a64 6566  ...@overload.def
-0000e6e0: 2074 7063 326e 616d 6528 7470 633a 2070   tpc2name(tpc: p
-0000e6f0: 642e 5365 7269 6573 2c20 6d73 3a20 626f  d.Series, ms: bo
-0000e700: 6f6c 203d 2046 616c 7365 2c20 6d69 6e6f  ol = False, mino
-0000e710: 723a 2062 6f6f 6c20 3d20 4661 6c73 6529  r: bool = False)
-0000e720: 202d 3e20 4f70 7469 6f6e 616c 5b70 642e   -> Optional[pd.
-0000e730: 5365 7269 6573 5d3a 0a20 2020 202e 2e2e  Series]:.    ...
-0000e740: 0a40 6f76 6572 6c6f 6164 0a64 6566 2074  .@overload.def t
-0000e750: 7063 326e 616d 6528 7470 633a 204e 4441  pc2name(tpc: NDA
-0000e760: 7272 6179 5b69 6e74 5d2c 206d 733a 2062  rray[int], ms: b
-0000e770: 6f6f 6c20 3d20 4661 6c73 652c 206d 696e  ool = False, min
-0000e780: 6f72 3a20 626f 6f6c 203d 2046 616c 7365  or: bool = False
-0000e790: 2920 2d3e 204f 7074 696f 6e61 6c5b 4e44  ) -> Optional[ND
-0000e7a0: 4172 7261 795b 7374 725d 5d3a 0a20 2020  Array[str]]:.   
-0000e7b0: 202e 2e2e 0a40 6f76 6572 6c6f 6164 0a64   ....@overload.d
-0000e7c0: 6566 2074 7063 326e 616d 6528 7470 633a  ef tpc2name(tpc:
-0000e7d0: 204c 6973 745b 696e 745d 2c20 6d73 3a20   List[int], ms: 
-0000e7e0: 626f 6f6c 203d 2046 616c 7365 2c20 6d69  bool = False, mi
-0000e7f0: 6e6f 723a 2062 6f6f 6c20 3d20 4661 6c73  nor: bool = Fals
-0000e800: 6529 202d 3e20 4f70 7469 6f6e 616c 5b4c  e) -> Optional[L
-0000e810: 6973 745b 7374 725d 5d3a 0a20 2020 202e  ist[str]]:.    .
-0000e820: 2e2e 0a40 6f76 6572 6c6f 6164 0a64 6566  ...@overload.def
-0000e830: 2074 7063 326e 616d 6528 7470 633a 2020   tpc2name(tpc:  
-0000e840: 5475 706c 655b 696e 745d 2c20 6d73 3a20  Tuple[int], ms: 
-0000e850: 626f 6f6c 203d 2046 616c 7365 2c20 6d69  bool = False, mi
-0000e860: 6e6f 723a 2062 6f6f 6c20 3d20 4661 6c73  nor: bool = Fals
-0000e870: 6529 202d 3e20 4f70 7469 6f6e 616c 5b54  e) -> Optional[T
-0000e880: 7570 6c65 5b73 7472 5d5d 3a0a 2020 2020  uple[str]]:.    
-0000e890: 2e2e 2e0a 6465 6620 7470 6332 6e61 6d65  ....def tpc2name
-0000e8a0: 2874 7063 3a20 556e 696f 6e5b 696e 742c  (tpc: Union[int,
-0000e8b0: 2070 642e 5365 7269 6573 2c20 4e44 4172   pd.Series, NDAr
-0000e8c0: 7261 795b 696e 745d 2c20 4c69 7374 5b69  ray[int], List[i
-0000e8d0: 6e74 5d2c 2054 7570 6c65 5b69 6e74 5d5d  nt], Tuple[int]]
-0000e8e0: 2c0a 2020 2020 2020 2020 2020 2020 206d  ,.             m
-0000e8f0: 733a 2062 6f6f 6c20 3d20 4661 6c73 652c  s: bool = False,
-0000e900: 0a20 2020 2020 2020 2020 2020 2020 6d69  .             mi
-0000e910: 6e6f 723a 2062 6f6f 6c20 3d20 4661 6c73  nor: bool = Fals
-0000e920: 6529 202d 3e20 4f70 7469 6f6e 616c 5b55  e) -> Optional[U
-0000e930: 6e69 6f6e 5b73 7472 2c20 7064 2e53 6572  nion[str, pd.Ser
-0000e940: 6965 732c 204e 4441 7272 6179 5b73 7472  ies, NDArray[str
-0000e950: 5d2c 204c 6973 745b 7374 725d 2c20 5475  ], List[str], Tu
-0000e960: 706c 655b 7374 725d 5d5d 3a0a 2020 2020  ple[str]]]:.    
-0000e970: 2222 2220 5475 726e 2061 2074 6f6e 616c  """ Turn a tonal
-0000e980: 2070 6974 6368 2063 6c61 7373 2028 5450   pitch class (TP
-0000e990: 4329 2069 6e74 6f20 6120 6e61 6d65 206f  C) into a name o
-0000e9a0: 7220 7065 7266 6f72 6d20 7468 6520 6f70  r perform the op
-0000e9b0: 6572 6174 696f 6e20 6f6e 2061 2063 6f6c  eration on a col
-0000e9c0: 6c65 6374 696f 6e20 6f66 2069 6e74 6567  lection of integ
-0000e9d0: 6572 732e 0a0a 2020 2020 4172 6773 3a0a  ers...    Args:.
-0000e9e0: 2020 2020 2020 7470 633a 2054 6f6e 616c        tpc: Tonal
-0000e9f0: 2070 6974 6368 2063 6c61 7373 2865 7329   pitch class(es)
-0000ea00: 2074 6f20 7475 726e 2069 6e74 6f20 6120   to turn into a 
-0000ea10: 6e6f 7465 206e 616d 652e 0a20 2020 2020  note name..     
-0000ea20: 206d 733a 2050 6173 7320 5472 7565 2069   ms: Pass True i
-0000ea30: 6620 6060 7470 6360 6020 6973 2061 204d  f ``tpc`` is a M
-0000ea40: 7573 6553 636f 7265 2054 5043 2c20 692e  useScore TPC, i.
-0000ea50: 652e 2043 203d 2031 340a 2020 2020 2020  e. C = 14.      
-0000ea60: 6d69 6e6f 723a 2050 6173 7320 5472 7565  minor: Pass True
-0000ea70: 2069 6620 7468 6520 7374 7269 6e67 2069   if the string i
-0000ea80: 7320 746f 2062 6520 7265 7475 726e 6564  s to be returned
-0000ea90: 2061 7320 6c6f 7765 7263 6173 652e 0a0a   as lowercase...
-0000eaa0: 2020 2020 5265 7475 726e 733a 0a0a 2020      Returns:..  
-0000eab0: 2020 2222 220a 2020 2020 7472 793a 0a20    """.    try:. 
-0000eac0: 2020 2020 2020 2069 6620 7064 2e69 736e         if pd.isn
-0000ead0: 756c 6c28 7470 6329 3a0a 2020 2020 2020  ull(tpc):.      
-0000eae0: 2020 2020 2020 7265 7475 726e 2074 7063        return tpc
-0000eaf0: 0a20 2020 2065 7863 6570 7420 5661 6c75  .    except Valu
-0000eb00: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-0000eb10: 7061 7373 0a20 2020 2069 6620 6973 696e  pass.    if isin
-0000eb20: 7374 616e 6365 2874 7063 2c20 7064 2e53  stance(tpc, pd.S
-0000eb30: 6572 6965 7329 3a0a 2020 2020 2020 2020  eries):.        
-0000eb40: 7265 7475 726e 2063 6173 7432 636f 6c6c  return cast2coll
-0000eb50: 6563 7469 6f6e 2863 6f6c 6c3d 7470 632c  ection(coll=tpc,
-0000eb60: 2066 756e 633d 7470 6332 6e61 6d65 2c20   func=tpc2name, 
-0000eb70: 6d73 3d6d 732c 206d 696e 6f72 3d6d 696e  ms=ms, minor=min
-0000eb80: 6f72 290a 2020 2020 7472 793a 0a20 2020  or).    try:.   
-0000eb90: 2020 2020 2074 7063 203d 2069 6e74 2866       tpc = int(f
-0000eba0: 6c6f 6174 2874 7063 2929 0a20 2020 2065  loat(tpc)).    e
-0000ebb0: 7863 6570 7420 5479 7065 4572 726f 723a  xcept TypeError:
-0000ebc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000ebd0: 6361 7374 3263 6f6c 6c65 6374 696f 6e28  cast2collection(
-0000ebe0: 636f 6c6c 3d74 7063 2c20 6675 6e63 3d74  coll=tpc, func=t
-0000ebf0: 7063 326e 616d 652c 206d 733d 6d73 2c20  pc2name, ms=ms, 
-0000ec00: 6d69 6e6f 723d 6d69 6e6f 7229 0a20 2020  minor=minor).   
-0000ec10: 206e 6f74 655f 6e61 6d65 7320 3d20 2827   note_names = ('
-0000ec20: 6627 2c20 2763 272c 2027 6727 2c20 2764  f', 'c', 'g', 'd
-0000ec30: 272c 2027 6127 2c20 2765 272c 2027 6227  ', 'a', 'e', 'b'
-0000ec40: 2920 6966 206d 696e 6f72 2065 6c73 6520  ) if minor else 
-0000ec50: 2827 4627 2c20 2743 272c 2027 4727 2c20  ('F', 'C', 'G', 
-0000ec60: 2744 272c 2027 4127 2c20 2745 272c 2027  'D', 'A', 'E', '
-0000ec70: 4227 290a 2020 2020 6966 206d 733a 0a20  B').    if ms:. 
-0000ec80: 2020 2020 2020 2074 7063 203d 2074 7063         tpc = tpc
-0000ec90: 202d 2031 340a 2020 2020 6163 632c 2069   - 14.    acc, i
-0000eca0: 7820 3d20 6469 766d 6f64 2874 7063 202b  x = divmod(tpc +
-0000ecb0: 2031 2c20 3729 0a20 2020 2061 6363 5f73   1, 7).    acc_s
-0000ecc0: 7472 203d 2061 6273 2861 6363 2920 2a20  tr = abs(acc) * 
-0000ecd0: 2762 2720 6966 2061 6363 203c 2030 2065  'b' if acc < 0 e
-0000ece0: 6c73 6520 6163 6320 2a20 2723 270a 2020  lse acc * '#'.  
-0000ecf0: 2020 7265 7475 726e 2066 227b 6e6f 7465    return f"{note
-0000ed00: 5f6e 616d 6573 5b69 785d 7d7b 6163 635f  _names[ix]}{acc_
-0000ed10: 7374 727d 220a 0a40 6f76 6572 6c6f 6164  str}"..@overload
-0000ed20: 0a64 6566 2066 6966 7468 7332 6e61 6d65  .def fifths2name
-0000ed30: 2866 6966 7468 733a 2069 6e74 2c20 6d69  (fifths: int, mi
-0000ed40: 6469 3a20 4f70 7469 6f6e 616c 5b69 6e74  di: Optional[int
-0000ed50: 5d2c 206d 733a 2062 6f6f 6c2c 206d 696e  ], ms: bool, min
-0000ed60: 6f72 3a20 626f 6f6c 2920 2d3e 204f 7074  or: bool) -> Opt
-0000ed70: 696f 6e61 6c5b 7374 725d 3a0a 2020 2020  ional[str]:.    
-0000ed80: 2e2e 2e0a 406f 7665 726c 6f61 640a 6465  ....@overload.de
-0000ed90: 6620 6669 6674 6873 326e 616d 6528 6669  f fifths2name(fi
-0000eda0: 6674 6873 3a20 7064 2e53 6572 6965 732c  fths: pd.Series,
-0000edb0: 206d 6964 693a 204f 7074 696f 6e61 6c5b   midi: Optional[
-0000edc0: 7064 2e53 6572 6965 735d 2c20 6d73 3a20  pd.Series], ms: 
-0000edd0: 626f 6f6c 2c20 6d69 6e6f 723a 2062 6f6f  bool, minor: boo
-0000ede0: 6c29 202d 3e20 4f70 7469 6f6e 616c 5b70  l) -> Optional[p
-0000edf0: 642e 5365 7269 6573 5d3a 0a20 2020 202e  d.Series]:.    .
-0000ee00: 2e2e 0a40 6f76 6572 6c6f 6164 0a64 6566  ...@overload.def
-0000ee10: 2066 6966 7468 7332 6e61 6d65 2866 6966   fifths2name(fif
-0000ee20: 7468 733a 204e 4441 7272 6179 5b69 6e74  ths: NDArray[int
-0000ee30: 5d2c 206d 6964 693a 204f 7074 696f 6e61  ], midi: Optiona
-0000ee40: 6c5b 4e44 4172 7261 795b 696e 745d 5d2c  l[NDArray[int]],
-0000ee50: 206d 733a 2062 6f6f 6c2c 206d 696e 6f72   ms: bool, minor
-0000ee60: 3a20 626f 6f6c 2920 2d3e 204f 7074 696f  : bool) -> Optio
-0000ee70: 6e61 6c5b 4e44 4172 7261 795b 7374 725d  nal[NDArray[str]
-0000ee80: 5d3a 0a20 2020 202e 2e2e 0a40 6f76 6572  ]:.    ....@over
-0000ee90: 6c6f 6164 0a64 6566 2066 6966 7468 7332  load.def fifths2
-0000eea0: 6e61 6d65 2866 6966 7468 733a 204c 6973  name(fifths: Lis
-0000eeb0: 745b 696e 745d 2c20 6d69 6469 3a20 4f70  t[int], midi: Op
-0000eec0: 7469 6f6e 616c 5b4c 6973 745b 696e 745d  tional[List[int]
-0000eed0: 5d2c 206d 733a 2062 6f6f 6c2c 206d 696e  ], ms: bool, min
-0000eee0: 6f72 3a20 626f 6f6c 2920 2d3e 204f 7074  or: bool) -> Opt
-0000eef0: 696f 6e61 6c5b 4c69 7374 5b73 7472 5d5d  ional[List[str]]
-0000ef00: 3a0a 2020 2020 2e2e 2e0a 406f 7665 726c  :.    ....@overl
-0000ef10: 6f61 640a 6465 6620 6669 6674 6873 326e  oad.def fifths2n
-0000ef20: 616d 6528 6669 6674 6873 3a20 5475 706c  ame(fifths: Tupl
-0000ef30: 655b 696e 745d 2c20 6d69 6469 3a20 4f70  e[int], midi: Op
-0000ef40: 7469 6f6e 616c 5b54 7570 6c65 5b69 6e74  tional[Tuple[int
-0000ef50: 5d5d 2c20 6d73 3a20 626f 6f6c 2c20 6d69  ]], ms: bool, mi
-0000ef60: 6e6f 723a 2062 6f6f 6c29 202d 3e20 4f70  nor: bool) -> Op
-0000ef70: 7469 6f6e 616c 5b54 7570 6c65 5b73 7472  tional[Tuple[str
-0000ef80: 5d5d 3a0a 2020 2020 2e2e 2e0a 4066 756e  ]]:.    ....@fun
-0000ef90: 6374 696f 6e5f 6c6f 6767 6572 0a64 6566  ction_logger.def
-0000efa0: 2066 6966 7468 7332 6e61 6d65 2866 6966   fifths2name(fif
-0000efb0: 7468 733a 2055 6e69 6f6e 5b69 6e74 2c20  ths: Union[int, 
-0000efc0: 7064 2e53 6572 6965 732c 204e 4441 7272  pd.Series, NDArr
-0000efd0: 6179 5b69 6e74 5d2c 204c 6973 745b 696e  ay[int], List[in
-0000efe0: 745d 2c20 5475 706c 655b 696e 745d 5d2c  t], Tuple[int]],
-0000eff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f000: 206d 6964 693a 204f 7074 696f 6e61 6c5b   midi: Optional[
-0000f010: 556e 696f 6e5b 696e 742c 2070 642e 5365  Union[int, pd.Se
-0000f020: 7269 6573 2c20 4e44 4172 7261 795b 696e  ries, NDArray[in
-0000f030: 745d 2c20 4c69 7374 5b69 6e74 5d2c 2054  t], List[int], T
-0000f040: 7570 6c65 5b69 6e74 5d5d 5d20 3d20 4e6f  uple[int]]] = No
-0000f050: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-0000f060: 2020 2020 6d73 3a20 626f 6f6c 203d 2046      ms: bool = F
-0000f070: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-0000f080: 2020 2020 2020 6d69 6e6f 723a 2062 6f6f        minor: boo
-0000f090: 6c20 3d20 4661 6c73 6529 202d 3e20 4f70  l = False) -> Op
-0000f0a0: 7469 6f6e 616c 5b55 6e69 6f6e 5b73 7472  tional[Union[str
-0000f0b0: 2c20 7064 2e53 6572 6965 732c 204e 4441  , pd.Series, NDA
-0000f0c0: 7272 6179 5b73 7472 5d2c 204c 6973 745b  rray[str], List[
-0000f0d0: 7374 725d 2c20 5475 706c 655b 7374 725d  str], Tuple[str]
-0000f0e0: 5d5d 3a0a 2020 2020 2222 2252 6574 7572  ]]:.    """Retur
-0000f0f0: 6e20 6e6f 7465 206e 616d 6520 6f66 2061  n note name of a
-0000f100: 2073 7461 636b 206f 6620 6669 6674 6873   stack of fifths
-0000f110: 2073 7563 6820 7468 6174 0a20 2020 2020   such that.     
-0000f120: 2020 3020 3d20 432c 202d 3120 3d20 462c    0 = C, -1 = F,
-0000f130: 202d 3220 3d20 4262 2c20 3120 3d20 4720   -2 = Bb, 1 = G 
-0000f140: 6574 632e 2054 6869 7320 6973 2061 2077  etc. This is a w
-0000f150: 7261 7070 6572 206f 6620 3a66 756e 633a  rapper of :func:
-0000f160: 6074 7063 326e 616d 6560 2c20 7468 6174  `tpc2name`, that
-0000f170: 2061 6464 6974 696f 6e61 6c6c 7920 6163   additionally ac
-0000f180: 6365 7074 7320 7468 6520 6172 6775 6d65  cepts the argume
-0000f190: 6e74 0a20 2020 2020 2020 6060 6d69 6469  nt.       ``midi
-0000f1a0: 6060 2077 6869 6368 2061 6c6c 6f77 7320  `` which allows 
-0000f1b0: 666f 7220 6164 6469 6e67 206f 6374 6176  for adding octav
-0000f1c0: 6520 696e 666f 726d 6174 696f 6e2e 0a0a  e information...
-0000f1d0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-0000f1e0: 6669 6674 6873 3a20 546f 6e61 6c20 7069  fifths: Tonal pi
-0000f1f0: 7463 6820 636c 6173 7328 6573 2920 746f  tch class(es) to
-0000f200: 2074 7572 6e20 696e 746f 2061 206e 6f74   turn into a not
-0000f210: 6520 6e61 6d65 2e0a 2020 2020 2020 6d69  e name..      mi
-0000f220: 6469 3a20 496e 206f 7264 6572 2074 6f20  di: In order to 
-0000f230: 696e 636c 7564 6520 7468 6520 6f63 7461  include the octa
-0000f240: 7665 2069 6e74 6f20 7468 6520 6e6f 7465  ve into the note
-0000f250: 206e 616d 652c 2070 6173 7320 7468 6520   name, pass the 
-0000f260: 636f 7272 6573 706f 6e64 696e 6720 4d49  corresponding MI
-0000f270: 4449 2070 6974 6368 2865 7329 2e0a 2020  DI pitch(es)..  
-0000f280: 2020 2020 6d73 3a20 5061 7373 2054 7275      ms: Pass Tru
-0000f290: 6520 6966 2060 6066 6966 7468 7360 6020  e if ``fifths`` 
-0000f2a0: 6973 2061 204d 7573 6553 636f 7265 2054  is a MuseScore T
-0000f2b0: 5043 2c20 692e 652e 2043 203d 2031 340a  PC, i.e. C = 14.
-0000f2c0: 2020 2020 2020 6d69 6e6f 723a 2050 6173        minor: Pas
-0000f2d0: 7320 5472 7565 2069 6620 7468 6520 7374  s True if the st
-0000f2e0: 7269 6e67 2069 7320 746f 2062 6520 7265  ring is to be re
-0000f2f0: 7475 726e 6564 2061 7320 6c6f 7765 7263  turned as lowerc
-0000f300: 6173 652e 0a20 2020 2022 2222 0a20 2020  ase..    """.   
-0000f310: 2074 7279 3a0a 2020 2020 2020 2020 6966   try:.        if
-0000f320: 2070 642e 6973 6e75 6c6c 2866 6966 7468   pd.isnull(fifth
-0000f330: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000f340: 7265 7475 726e 2066 6966 7468 730a 2020  return fifths.  
-0000f350: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
-0000f360: 726f 723a 0a20 2020 2020 2020 2070 6173  ror:.        pas
-0000f370: 730a 2020 2020 7472 793a 0a20 2020 2020  s.    try:.     
-0000f380: 2020 2066 6966 7468 7320 3d20 696e 7428     fifths = int(
-0000f390: 666c 6f61 7428 6669 6674 6873 2929 0a20  float(fifths)). 
-0000f3a0: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
-0000f3b0: 726f 723a 0a20 2020 2020 2020 206e 616d  ror:.        nam
-0000f3c0: 6573 203d 2074 7063 326e 616d 6528 6669  es = tpc2name(fi
-0000f3d0: 6674 6873 2c20 6d73 3d6d 732c 206d 696e  fths, ms=ms, min
-0000f3e0: 6f72 3d6d 696e 6f72 290a 2020 2020 2020  or=minor).      
-0000f3f0: 2020 6966 206d 6964 6920 6973 204e 6f6e    if midi is Non
-0000f400: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000f410: 6574 7572 6e20 6e61 6d65 730a 2020 2020  eturn names.    
-0000f420: 2020 2020 6f63 7461 7665 7320 3d20 6d69      octaves = mi
-0000f430: 6469 326f 6374 6176 6528 6d69 6469 2c20  di2octave(midi, 
-0000f440: 6669 6674 6873 290a 2020 2020 2020 2020  fifths).        
-0000f450: 7265 7475 726e 2061 6464 5f63 6f6c 6c65  return add_colle
-0000f460: 6374 696f 6e73 286e 616d 6573 2c20 6f63  ctions(names, oc
-0000f470: 7461 7665 732c 2064 7479 7065 3d27 7374  taves, dtype='st
-0000f480: 7269 6e67 2729 0a20 2020 206e 616d 6520  ring').    name 
-0000f490: 3d20 7470 6332 6e61 6d65 2866 6966 7468  = tpc2name(fifth
-0000f4a0: 732c 206d 733d 6d73 2c20 6d69 6e6f 723d  s, ms=ms, minor=
-0000f4b0: 6d69 6e6f 7229 0a20 2020 2069 6620 6d69  minor).    if mi
-0000f4c0: 6469 2069 7320 4e6f 6e65 3a0a 2020 2020  di is None:.    
-0000f4d0: 2020 2020 7265 7475 726e 206e 616d 650a      return name.
-0000f4e0: 2020 2020 6f63 7461 7665 203d 206d 6964      octave = mid
-0000f4f0: 6932 6f63 7461 7665 286d 6964 692c 2066  i2octave(midi, f
-0000f500: 6966 7468 7329 0a20 2020 2072 6574 7572  ifths).    retur
-0000f510: 6e20 6622 7b6e 616d 657d 7b6f 6374 6176  n f"{name}{octav
-0000f520: 657d 220a 0a0a 0a64 6566 2066 6966 7468  e}"....def fifth
-0000f530: 7332 7063 2866 6966 7468 7329 3a0a 2020  s2pc(fifths):.  
-0000f540: 2020 2222 2220 5475 726e 2061 2073 7461    """ Turn a sta
-0000f550: 636b 206f 6620 6669 6674 6873 2069 6e74  ck of fifths int
-0000f560: 6f20 6120 6368 726f 6d61 7469 6320 7069  o a chromatic pi
-0000f570: 7463 6820 636c 6173 732e 0a20 2020 2020  tch class..     
-0000f580: 2020 2055 7365 733a 206d 6170 3265 6c65     Uses: map2ele
-0000f590: 6d65 6e74 7328 290a 2020 2020 2222 220a  ments().    """.
-0000f5a0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000f5b0: 2066 6966 7468 7320 3d20 696e 7428 666c   fifths = int(fl
-0000f5c0: 6f61 7428 6669 6674 6873 2929 0a20 2020  oat(fifths)).   
-0000f5d0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0000f5e0: 6e3a 0a20 2020 2020 2020 2069 6620 6973  n:.        if is
-0000f5f0: 696e 7374 616e 6365 2866 6966 7468 732c  instance(fifths,
-0000f600: 2049 7465 7261 626c 6529 3a0a 2020 2020   Iterable):.    
-0000f610: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0000f620: 6170 3265 6c65 6d65 6e74 7328 6669 6674  ap2elements(fift
-0000f630: 6873 2c20 6669 6674 6873 3270 6329 0a20  hs, fifths2pc). 
-0000f640: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-0000f650: 6674 6873 0a0a 2020 2020 7265 7475 726e  fths..    return
-0000f660: 2069 6e74 2837 202a 2066 6966 7468 7320   int(7 * fifths 
-0000f670: 2520 3132 290a 0a0a 0a64 6566 2066 6966  % 12)....def fif
-0000f680: 7468 7332 726e 2866 6966 7468 732c 206d  ths2rn(fifths, m
-0000f690: 696e 6f72 3d46 616c 7365 2c20 6175 746f  inor=False, auto
-0000f6a0: 5f6b 6579 3d46 616c 7365 293a 0a20 2020  _key=False):.   
-0000f6b0: 2022 2222 5265 7475 726e 2052 6f6d 616e   """Return Roman
-0000f6c0: 206e 756d 6572 616c 206f 6620 6120 7374   numeral of a st
-0000f6d0: 6163 6b20 6f66 2066 6966 7468 7320 7375  ack of fifths su
-0000f6e0: 6368 2074 6861 740a 2020 2020 2020 2030  ch that.       0
-0000f6f0: 203d 2049 2c20 2d31 203d 2049 562c 2031   = I, -1 = IV, 1
-0000f700: 203d 2056 2c20 2d32 203d 2062 5649 4920   = V, -2 = bVII 
-0000f710: 696e 206d 616a 6f72 2c20 5649 4920 696e  in major, VII in
-0000f720: 206d 696e 6f72 2c20 6574 632e 0a20 2020   minor, etc..   
-0000f730: 2020 2020 5573 6573 3a20 6d61 7032 656c      Uses: map2el
-0000f740: 656d 656e 7473 2829 2c20 6973 5f6d 696e  ements(), is_min
-0000f750: 6f72 5f6d 6f64 6528 290a 0a20 2020 2050  or_mode()..    P
-0000f760: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-0000f770: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061 7574  --------.    aut
-0000f780: 6f5f 6b65 7920 3a20 3a6f 626a 3a60 626f  o_key : :obj:`bo
-0000f790: 6f6c 602c 206f 7074 696f 6e61 6c0a 2020  ol`, optional.  
-0000f7a0: 2020 2020 2020 4279 2064 6566 6175 6c74        By default
-0000f7b0: 2c20 7468 6520 7265 7475 726e 6564 2052  , the returned R
-0000f7c0: 6f6d 616e 206e 756d 6572 616c 7320 6172  oman numerals ar
-0000f7d0: 6520 7570 7065 7263 6173 652e 2050 6173  e uppercase. Pas
-0000f7e0: 7320 5472 7565 2074 6f20 7061 7373 2075  s True to pass u
-0000f7f0: 7070 6572 2d0a 2020 2020 2020 2020 6f72  pper-.        or
-0000f800: 206c 6f77 6572 6361 7365 2061 6363 6f72   lowercase accor
-0000f810: 6469 6e67 2074 6f20 7468 6520 706f 7369  ding to the posi
-0000f820: 7469 6f6e 2069 6e20 7468 6520 7363 616c  tion in the scal
-0000f830: 652e 0a20 2020 2022 2222 0a20 2020 2069  e..    """.    i
-0000f840: 6620 6973 696e 7374 616e 6365 2866 6966  f isinstance(fif
-0000f850: 7468 732c 2049 7465 7261 626c 6529 3a0a  ths, Iterable):.
-0000f860: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0000f870: 6170 3265 6c65 6d65 6e74 7328 6669 6674  ap2elements(fift
-0000f880: 6873 2c20 6669 6674 6873 3272 6e2c 206d  hs, fifths2rn, m
-0000f890: 696e 6f72 3d6d 696e 6f72 290a 2020 2020  inor=minor).    
-0000f8a0: 6966 2070 642e 6973 6e75 6c6c 2866 6966  if pd.isnull(fif
-0000f8b0: 7468 7329 3a0a 2020 2020 2020 2020 7265  ths):.        re
-0000f8c0: 7475 726e 2066 6966 7468 730a 2020 2020  turn fifths.    
-0000f8d0: 726e 203d 205b 2756 4927 2c20 2749 4949  rn = ['VI', 'III
-0000f8e0: 272c 2027 5649 4927 2c20 2749 5627 2c20  ', 'VII', 'IV', 
-0000f8f0: 2749 272c 2027 5627 2c20 2749 4927 5d20  'I', 'V', 'II'] 
-0000f900: 6966 206d 696e 6f72 2065 6c73 6520 5b27  if minor else ['
-0000f910: 4956 272c 2027 4927 2c20 2756 272c 2027  IV', 'I', 'V', '
-0000f920: 4949 272c 2027 5649 272c 2027 4949 4927  II', 'VI', 'III'
-0000f930: 2c20 2756 4949 275d 0a20 2020 2073 656c  , 'VII'].    sel
-0000f940: 203d 2066 6966 7468 7320 2b20 3320 6966   = fifths + 3 if
-0000f950: 206d 696e 6f72 2065 6c73 6520 6669 6674   minor else fift
-0000f960: 6873 0a20 2020 2072 6573 203d 205f 6669  hs.    res = _fi
-0000f970: 6674 6873 3273 7472 2873 656c 2c20 726e  fths2str(sel, rn
-0000f980: 290a 2020 2020 6966 2061 7574 6f5f 6b65  ).    if auto_ke
-0000f990: 7920 616e 6420 6973 5f6d 696e 6f72 5f6d  y and is_minor_m
-0000f9a0: 6f64 6528 6669 6674 6873 2c20 6d69 6e6f  ode(fifths, mino
-0000f9b0: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
-0000f9c0: 726e 2072 6573 2e6c 6f77 6572 2829 0a20  rn res.lower(). 
-0000f9d0: 2020 2072 6574 7572 6e20 7265 730a 0a0a     return res...
-0000f9e0: 0a64 6566 2066 6966 7468 7332 7364 2866  .def fifths2sd(f
-0000f9f0: 6966 7468 732c 206d 696e 6f72 3d46 616c  ifths, minor=Fal
-0000fa00: 7365 293a 0a20 2020 2022 2222 5265 7475  se):.    """Retu
-0000fa10: 726e 2073 6361 6c65 2064 6567 7265 6520  rn scale degree 
-0000fa20: 6f66 2061 2073 7461 636b 206f 6620 6669  of a stack of fi
-0000fa30: 6674 6873 2073 7563 6820 7468 6174 0a20  fths such that. 
-0000fa40: 2020 2020 2020 3020 3d20 2731 272c 202d        0 = '1', -
-0000fa50: 3120 3d20 2734 272c 202d 3220 3d20 2762  1 = '4', -2 = 'b
-0000fa60: 3727 2069 6e20 6d61 6a6f 722c 2027 3727  7' in major, '7'
-0000fa70: 2069 6e20 6d69 6e6f 7220 6574 632e 0a20   in minor etc.. 
-0000fa80: 2020 2020 2020 5573 6573 3a20 6d61 7032        Uses: map2
-0000fa90: 656c 656d 656e 7473 2829 2c20 6669 6674  elements(), fift
-0000faa0: 6873 3273 7472 2829 0a20 2020 2022 2222  hs2str().    """
-0000fab0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-0000fac0: 6365 2866 6966 7468 732c 2049 7465 7261  ce(fifths, Itera
-0000fad0: 626c 6529 3a0a 2020 2020 2020 2020 7265  ble):.        re
-0000fae0: 7475 726e 206d 6170 3265 6c65 6d65 6e74  turn map2element
-0000faf0: 7328 6669 6674 6873 2c20 6669 6674 6873  s(fifths, fifths
-0000fb00: 3273 642c 206d 696e 6f72 3d6d 696e 6f72  2sd, minor=minor
-0000fb10: 290a 2020 2020 6966 2070 642e 6973 6e75  ).    if pd.isnu
-0000fb20: 6c6c 2866 6966 7468 7329 3a0a 2020 2020  ll(fifths):.    
-0000fb30: 2020 2020 7265 7475 726e 2066 6966 7468      return fifth
-0000fb40: 730a 2020 2020 7364 203d 205b 2736 272c  s.    sd = ['6',
-0000fb50: 2027 3327 2c20 2737 272c 2027 3427 2c20   '3', '7', '4', 
-0000fb60: 2731 272c 2027 3527 2c20 2732 275d 2069  '1', '5', '2'] i
-0000fb70: 6620 6d69 6e6f 7220 656c 7365 205b 2734  f minor else ['4
-0000fb80: 272c 2027 3127 2c20 2735 272c 2027 3227  ', '1', '5', '2'
-0000fb90: 2c20 2736 272c 2027 3327 2c20 2737 275d  , '6', '3', '7']
-0000fba0: 0a20 2020 2069 6620 6d69 6e6f 723a 0a20  .    if minor:. 
-0000fbb0: 2020 2020 2020 2066 6966 7468 7320 2b3d         fifths +=
-0000fbc0: 2033 0a20 2020 2072 6574 7572 6e20 5f66   3.    return _f
-0000fbd0: 6966 7468 7332 7374 7228 6669 6674 6873  ifths2str(fifths
-0000fbe0: 2c20 7364 290a 0a0a 0a64 6566 205f 6669  , sd)....def _fi
-0000fbf0: 6674 6873 3273 7472 2866 6966 7468 733a  fths2str(fifths:
-0000fc00: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
-0000fc10: 2020 2020 2020 7374 6570 733a 2043 6f6c        steps: Col
-0000fc20: 6c65 6374 696f 6e5b 7374 725d 2c0a 2020  lection[str],.  
-0000fc30: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0000fc40: 7665 7274 6564 3a20 626f 6f6c 203d 2046  verted: bool = F
-0000fc50: 616c 7365 2920 2d3e 2073 7472 3a0a 2020  alse) -> str:.  
-0000fc60: 2020 2222 2220 426f 696c 6572 2070 6c61    """ Boiler pla
-0000fc70: 7465 2075 7365 6420 6279 2066 6966 7468  te used by fifth
-0000fc80: 7332 2d66 756e 6374 696f 6e73 2e0a 0a20  s2-functions... 
-0000fc90: 2020 2041 7267 733a 0a20 2020 2020 2066     Args:.      f
-0000fca0: 6966 7468 733a 2053 7461 636b 206f 6620  ifths: Stack of 
-0000fcb0: 6669 6674 6873 0a20 2020 2020 2073 7465  fifths.      ste
-0000fcc0: 7073 3a20 436f 6c6c 6563 7469 6f6e 206f  ps: Collection o
-0000fcd0: 6620 7365 7665 6e20 6e61 6d65 732c 2073  f seven names, s
-0000fce0: 6361 6c65 2064 6567 7265 6573 2c20 696e  cale degrees, in
-0000fcf0: 7465 7276 616c 732c 2065 7463 2e0a 2020  tervals, etc..  
-0000fd00: 2020 2020 696e 7665 7274 6564 3a20 4279      inverted: By
-0000fd10: 2064 6566 6175 6c74 2c20 7265 7475 726e   default, return
-0000fd20: 2061 6363 6964 656e 7461 6c20 2b20 7374   accidental + st
-0000fd30: 6570 2e20 5061 7373 2054 7275 6520 746f  ep. Pass True to
-0000fd40: 2067 6574 2073 7465 7020 2b20 6163 6369   get step + acci
-0000fd50: 6465 6e74 616c 2069 6e73 7465 6164 2e0a  dental instead..
-0000fd60: 0a20 2020 2052 6574 7572 6e73 3a0a 2020  .    Returns:.  
-0000fd70: 2020 2020 4163 6369 6465 6e74 616c 7320      Accidentals 
-0000fd80: 2b20 7374 6570 2066 726f 6d20 6060 7374  + step from ``st
-0000fd90: 6570 7360 6020 6f72 2c20 6966 2069 6e76  eps`` or, if inv
-0000fda0: 6572 7465 642c 2073 7465 7020 2b20 6163  erted, step + ac
-0000fdb0: 6369 6465 6e74 616c 732e 0a20 2020 2022  cidentals..    "
-0000fdc0: 2222 0a20 2020 2061 6363 203d 2066 6966  "".    acc = fif
-0000fdd0: 7468 7332 6163 6328 6669 6674 6873 290a  ths2acc(fifths).
-0000fde0: 2020 2020 6669 6674 6873 202b 3d20 310a      fifths += 1.
-0000fdf0: 2020 2020 6966 2069 6e76 6572 7465 643a      if inverted:
-0000fe00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000fe10: 7374 6570 735b 6669 6674 6873 2025 2037  steps[fifths % 7
-0000fe20: 5d20 2b20 6163 630a 2020 2020 7265 7475  ] + acc.    retu
-0000fe30: 726e 2061 6363 202b 2073 7465 7073 5b66  rn acc + steps[f
-0000fe40: 6966 7468 7320 2520 375d 0a0a 0a64 6566  ifths % 7]...def
-0000fe50: 2067 6574 5f6d 735f 7665 7273 696f 6e28   get_ms_version(
-0000fe60: 6d73 6378 5f66 696c 6529 3a0a 2020 2020  mscx_file):.    
-0000fe70: 7769 7468 206f 7065 6e28 6d73 6378 5f66  with open(mscx_f
-0000fe80: 696c 652c 2065 6e63 6f64 696e 673d 2775  ile, encoding='u
-0000fe90: 7466 2d38 2729 2061 7320 6669 6c65 3a0a  tf-8') as file:.
-0000fea0: 2020 2020 2020 2020 666f 7220 692c 206c          for i, l
-0000feb0: 2069 6e20 656e 756d 6572 6174 6528 6669   in enumerate(fi
-0000fec0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-0000fed0: 2069 6620 6920 3c20 323a 0a20 2020 2020   if i < 2:.     
-0000fee0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-0000fef0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000ff00: 203d 3d20 323a 0a20 2020 2020 2020 2020   == 2:.         
-0000ff10: 2020 2020 2020 206d 203d 2072 652e 7365         m = re.se
-0000ff20: 6172 6368 2872 223c 7072 6f67 7261 6d56  arch(r"<programV
-0000ff30: 6572 7369 6f6e 3e28 2e2a 3f29 3c2f 7072  ersion>(.*?)</pr
-0000ff40: 6f67 7261 6d56 6572 7369 6f6e 3e22 2c20  ogramVersion>", 
-0000ff50: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-0000ff60: 2020 2069 6620 6d20 6973 204e 6f6e 653a     if m is None:
-0000ff70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ff80: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0000ff90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ffa0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000ffb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000ffc0: 6e20 6d2e 6772 6f75 7028 3129 0a0a 0a40  n m.group(1)...@
-0000ffd0: 6675 6e63 7469 6f6e 5f6c 6f67 6765 720a  function_logger.
-0000ffe0: 6465 6620 6765 745f 6d75 7365 7363 6f72  def get_musescor
-0000fff0: 6528 4d53 3a20 556e 696f 6e5b 7374 722c  e(MS: Union[str,
-00010000: 204c 6974 6572 616c 5b27 6175 746f 272c   Literal['auto',
-00010010: 2027 7769 6e27 2c20 276d 6163 275d 5d20   'win', 'mac']] 
-00010020: 3d20 2761 7574 6f27 2920 2d3e 204f 7074  = 'auto') -> Opt
-00010030: 696f 6e61 6c5b 7374 725d 3a0a 2020 2020  ional[str]:.    
-00010040: 2222 2254 6573 7473 2077 6865 7468 6572  """Tests whether
-00010050: 2061 204d 7573 6553 636f 7265 2065 7865   a MuseScore exe
-00010060: 6375 7461 626c 6520 6361 6e20 6265 2066  cutable can be f
-00010070: 6f75 6e64 206f 6e20 7468 6520 7379 7374  ound on the syst
-00010080: 656d 2e0a 2020 2020 5573 6573 3a20 7465  em..    Uses: te
-00010090: 7374 5f62 696e 6172 7928 290a 0a0a 2020  st_binary()...  
-000100a0: 2020 4172 6773 3a0a 2020 2020 2020 4d53    Args:.      MS
-000100b0: 3a20 4120 7061 7468 2074 6f20 7468 6520  : A path to the 
-000100c0: 6578 6563 7574 6162 6c65 2c20 696e 7374  executable, inst
-000100d0: 616c 6c65 6420 636f 6d6d 616e 642c 206f  alled command, o
-000100e0: 7220 6f6e 6520 6f66 2074 6865 206b 6579  r one of the key
-000100f0: 776f 7264 7320 7b27 6175 746f 272c 2027  words {'auto', '
-00010100: 7769 6e27 2c20 276d 6163 277d 0a0a 2020  win', 'mac'}..  
-00010110: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-00010120: 2050 6174 6820 746f 2074 6865 2065 7865   Path to the exe
-00010130: 6375 7461 626c 6520 6966 2066 6f75 6e64  cutable if found
-00010140: 206f 7220 4e6f 6e65 2e0a 2020 2020 2222   or None..    ""
-00010150: 220a 2020 2020 6966 204d 5320 6973 204e  ".    if MS is N
-00010160: 6f6e 653a 0a20 2020 2020 2020 2072 6574  one:.        ret
-00010170: 7572 6e20 4d53 0a20 2020 2069 6620 4d53  urn MS.    if MS
-00010180: 203d 3d20 2761 7574 6f27 3a0a 2020 2020   == 'auto':.    
-00010190: 2020 2020 6d61 7070 696e 6720 3d20 7b0a      mapping = {.
-000101a0: 2020 2020 2020 2020 2020 2020 2757 696e              'Win
-000101b0: 646f 7773 273a 2027 7769 6e27 2c0a 2020  dows': 'win',.  
-000101c0: 2020 2020 2020 2020 2020 2744 6172 7769            'Darwi
-000101d0: 6e27 3a20 276d 6163 272c 0a20 2020 2020  n': 'mac',.     
-000101e0: 2020 2020 2020 2027 4c69 6e75 7827 3a20         'Linux': 
-000101f0: 276d 7363 6f72 6527 0a20 2020 2020 2020  'mscore'.       
-00010200: 207d 0a20 2020 2020 2020 2073 7973 7465   }.        syste
-00010210: 6d20 3d20 706c 6174 666f 726d 2e73 7973  m = platform.sys
-00010220: 7465 6d28 290a 2020 2020 2020 2020 7472  tem().        tr
-00010230: 793a 0a20 2020 2020 2020 2020 2020 204d  y:.            M
-00010240: 5320 3d20 6d61 7070 696e 675b 7379 7374  S = mapping[syst
-00010250: 656d 5d0a 2020 2020 2020 2020 6578 6365  em].        exce
-00010260: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-00010270: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00010280: 2e77 6172 6e69 6e67 2866 2253 7973 7465  .warning(f"Syste
-00010290: 6d20 636f 756c 6420 6e6f 7420 6265 2069  m could not be i
-000102a0: 6e66 6572 7265 643a 207b 7379 7374 656d  nferred: {system
-000102b0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-000102c0: 4d53 203d 2027 6d73 636f 7265 270a 2020  MS = 'mscore'.  
-000102d0: 2020 6966 204d 5320 3d3d 2027 7769 6e27    if MS == 'win'
-000102e0: 3a0a 2020 2020 2020 2020 7072 6f67 7261  :.        progra
-000102f0: 6d5f 6669 6c65 7320 3d20 6f73 2e65 6e76  m_files = os.env
-00010300: 6972 6f6e 5b27 5052 4f47 5241 4d46 494c  iron['PROGRAMFIL
-00010310: 4553 275d 0a20 2020 2020 2020 204d 5320  ES'].        MS 
-00010320: 3d20 6f73 2e70 6174 682e 6a6f 696e 2870  = os.path.join(p
-00010330: 726f 6772 616d 5f66 696c 6573 2c20 7222  rogram_files, r"
-00010340: 4d75 7365 5363 6f72 6520 335c 6269 6e5c  MuseScore 3\bin\
-00010350: 4d75 7365 5363 6f72 6533 2e65 7865 2229  MuseScore3.exe")
-00010360: 0a20 2020 2065 6c69 6620 4d53 203d 3d20  .    elif MS == 
-00010370: 276d 6163 273a 0a20 2020 2020 2020 204d  'mac':.        M
-00010380: 5320 3d20 222f 4170 706c 6963 6174 696f  S = "/Applicatio
-00010390: 6e73 2f4d 7573 6553 636f 7265 2033 2e61  ns/MuseScore 3.a
-000103a0: 7070 2f43 6f6e 7465 6e74 732f 4d61 634f  pp/Contents/MacO
-000103b0: 532f 6d73 636f 7265 220a 2020 2020 7265  S/mscore".    re
-000103c0: 7475 726e 2074 6573 745f 6269 6e61 7279  turn test_binary
-000103d0: 284d 532c 206c 6f67 6765 723d 6c6f 6767  (MS, logger=logg
-000103e0: 6572 290a 0a0a 6465 6620 6765 745f 7061  er)...def get_pa
-000103f0: 7468 5f63 6f6d 706f 6e65 6e74 2870 6174  th_component(pat
-00010400: 682c 2061 6674 6572 293a 0a20 2020 2022  h, after):.    "
-00010410: 2222 5265 7475 726e 7320 6f6e 6c79 2074  ""Returns only t
-00010420: 6865 2070 6174 6827 7320 7375 6266 6f6c  he path's subfol
-00010430: 6465 7273 2062 656c 6f77 2060 6061 6674  ders below ``aft
-00010440: 6572 6060 2e20 4966 2060 6061 6674 6572  er``. If ``after
-00010450: 6060 2069 7320 7468 6520 6c61 7374 0a20  `` is the last. 
-00010460: 2020 2063 6f6d 706f 6e65 6e74 2c20 272e     component, '.
-00010470: 2720 6973 2072 6574 7572 6e65 642e 2222  ' is returned.""
-00010480: 220a 2020 2020 6469 7231 2c20 6261 7365  ".    dir1, base
-00010490: 3120 3d20 6f73 2e70 6174 682e 7370 6c69  1 = os.path.spli
-000104a0: 7428 7061 7468 290a 2020 2020 6966 2064  t(path).    if d
-000104b0: 6972 3120 696e 2028 2727 2c20 272e 272c  ir1 in ('', '.',
-000104c0: 2027 2f27 2c20 277e 2729 3a0a 2020 2020   '/', '~'):.    
-000104d0: 2020 2020 6966 2062 6173 6531 203d 3d20      if base1 == 
-000104e0: 6166 7465 723a 0a20 2020 2020 2020 2020  after:.         
-000104f0: 2020 2072 6574 7572 6e20 272e 270a 2020     return '.'.  
-00010500: 2020 2020 2020 7265 7475 726e 2070 6174        return pat
-00010510: 680a 2020 2020 6469 7232 2c20 6261 7365  h.    dir2, base
-00010520: 3220 3d20 6f73 2e70 6174 682e 7370 6c69  2 = os.path.spli
-00010530: 7428 6469 7231 290a 2020 2020 6966 2062  t(dir1).    if b
-00010540: 6173 6532 203d 3d20 6166 7465 723a 0a20  ase2 == after:. 
-00010550: 2020 2020 2020 2072 6574 7572 6e20 6261         return ba
-00010560: 7365 310a 2020 2020 6869 6768 6572 5f6c  se1.    higher_l
-00010570: 6576 656c 7320 3d20 6765 745f 7061 7468  evels = get_path
-00010580: 5f63 6f6d 706f 6e65 6e74 2864 6972 312c  _component(dir1,
-00010590: 2061 6674 6572 3d61 6674 6572 290a 2020   after=after).  
-000105a0: 2020 7265 7475 726e 206f 732e 7061 7468    return os.path
-000105b0: 2e6a 6f69 6e28 6869 6768 6572 5f6c 6576  .join(higher_lev
-000105c0: 656c 732c 2062 6173 6531 290a 0a0a 2320  els, base1)...# 
-000105d0: 6465 6620 6765 745f 7175 6172 7465 7262  def get_quarterb
-000105e0: 6561 7473 5f6c 656e 6774 6828 6d65 6173  eats_length(meas
-000105f0: 7572 6573 3a20 7064 2e44 6174 6146 7261  ures: pd.DataFra
-00010600: 6d65 2c20 6465 6369 6d61 6c73 3a20 696e  me, decimals: in
-00010610: 7420 3d20 3229 202d 3e20 5475 706c 655b  t = 2) -> Tuple[
-00010620: 666c 6f61 742c 204f 7074 696f 6e61 6c5b  float, Optional[
-00010630: 666c 6f61 745d 5d3a 0a23 2020 2020 2022  float]]:.#     "
-00010640: 2222 2052 6574 7572 6e73 2074 6865 2073  "" Returns the s
-00010650: 796d 626f 6c69 6320 6c65 6e67 7468 2061  ymbolic length a
-00010660: 6e64 2075 6e66 6f6c 6465 6420 7379 6d62  nd unfolded symb
-00010670: 6f6c 6963 206c 656e 6774 6820 6f66 2061  olic length of a
-00010680: 2070 6965 6365 2069 6e20 7175 6172 7465   piece in quarte
-00010690: 7220 6e6f 7465 732e 0a23 0a23 2020 2020  r notes..#.#    
-000106a0: 2050 6172 616d 6574 6572 730a 2320 2020   Parameters.#   
-000106b0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a23 2020    ----------.#  
-000106c0: 2020 206d 6561 7375 7265 7320 3a20 3a6f     measures : :o
-000106d0: 626a 3a60 7061 6e64 6173 2e44 6174 6146  bj:`pandas.DataF
-000106e0: 7261 6d65 600a 230a 2320 2020 2020 5265  rame`.#.#     Re
-000106f0: 7475 726e 730a 2320 2020 2020 2d2d 2d2d  turns.#     ----
-00010700: 2d2d 2d0a 2320 2020 2020 666c 6f61 742c  ---.#     float,
-00010710: 2066 6c6f 6174 0a23 2020 2020 2020 2020   float.#        
-00010720: 204c 656e 6774 6820 616e 6420 756e 666f   Length and unfo
-00010730: 6c64 6564 206c 656e 6774 682c 2062 6f74  lded length, bot
-00010740: 6820 6d65 6173 7572 6573 6420 696e 2071  h measuresd in q
-00010750: 7561 7274 6572 206e 6f74 6573 2e0a 2320  uarter notes..# 
-00010760: 2020 2020 2222 220a 2320 2020 2020 6d63      """.#     mc
-00010770: 5f64 7572 6174 696f 6e73 203d 206d 6561  _durations = mea
-00010780: 7375 7265 732e 7365 745f 696e 6465 7828  sures.set_index(
-00010790: 276d 6327 292e 6163 745f 6475 7220 2a20  'mc').act_dur * 
-000107a0: 342e 0a23 2020 2020 206c 656e 6774 685f  4..#     length_
-000107b0: 7162 203d 2072 6f75 6e64 286d 635f 6475  qb = round(mc_du
-000107c0: 7261 7469 6f6e 732e 7375 6d28 292c 2064  rations.sum(), d
-000107d0: 6563 696d 616c 7329 0a23 2020 2020 2074  ecimals).#     t
-000107e0: 7279 3a0a 2320 2020 2020 2020 2020 706c  ry:.#         pl
-000107f0: 6179 7468 726f 7567 6832 6d63 203d 206d  aythrough2mc = m
-00010800: 616b 655f 706c 6179 7468 726f 7567 6832  ake_playthrough2
-00010810: 6d63 286d 6561 7375 7265 732c 206c 6f67  mc(measures, log
-00010820: 6765 723d 6c6f 6767 6572 290a 2320 2020  ger=logger).#   
-00010830: 2020 2020 2020 6966 206c 656e 2870 6c61        if len(pla
-00010840: 7974 6872 6f75 6768 326d 6329 203d 3d20  ythrough2mc) == 
-00010850: 303a 0a23 2020 2020 2020 2020 2020 2020  0:.#            
-00010860: 206c 656e 6774 685f 7162 5f75 6e66 6f6c   length_qb_unfol
-00010870: 6465 6420 3d20 4e6f 6e65 0a23 2020 2020  ded = None.#    
-00010880: 2020 2020 2065 6c73 653a 0a23 2020 2020       else:.#    
-00010890: 2020 2020 2020 2020 206c 656e 6774 685f           length_
-000108a0: 7162 5f75 6e66 6f6c 6465 6420 3d20 726f  qb_unfolded = ro
-000108b0: 756e 6428 6d63 5f64 7572 6174 696f 6e73  und(mc_durations
-000108c0: 2e6c 6f63 5b70 6c61 7974 6872 6f75 6768  .loc[playthrough
-000108d0: 326d 632e 7661 6c75 6573 5d2e 7375 6d28  2mc.values].sum(
-000108e0: 292c 2064 6563 696d 616c 7329 0a23 2020  ), decimals).#  
-000108f0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00010900: 696f 6e3a 0a23 2020 2020 2020 2020 206c  ion:.#         l
-00010910: 656e 6774 685f 7162 5f75 6e66 6f6c 6465  ength_qb_unfolde
-00010920: 6420 3d20 4e6f 6e65 0a23 2020 2020 2072  d = None.#     r
-00010930: 6574 7572 6e20 6c65 6e67 7468 5f71 622c  eturn length_qb,
-00010940: 206c 656e 6774 685f 7162 5f75 6e66 6f6c   length_qb_unfol
-00010950: 6465 640a 0a0a 6465 6620 6772 6f75 705f  ded...def group_
-00010960: 6964 5f74 7570 6c65 7328 6c29 3a0a 2020  id_tuples(l):.  
-00010970: 2020 2222 2220 5475 726e 7320 6120 6c69    """ Turns a li
-00010980: 7374 206f 6620 286b 6579 2c20 6978 2920  st of (key, ix) 
-00010990: 696e 746f 2061 207b 6b65 793a 205b 6978  into a {key: [ix
-000109a0: 5d7d 0a0a 2020 2020 2222 220a 2020 2020  ]}..    """.    
-000109b0: 6420 3d20 6465 6661 756c 7464 6963 7428  d = defaultdict(
-000109c0: 6c69 7374 290a 2020 2020 666f 7220 6b2c  list).    for k,
-000109d0: 2069 2069 6e20 6c3a 0a20 2020 2020 2020   i in l:.       
-000109e0: 2069 6620 6b20 6973 206e 6f74 204e 6f6e   if k is not Non
-000109f0: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
-00010a00: 5b6b 5d2e 6170 7065 6e64 2869 290a 2020  [k].append(i).  
-00010a10: 2020 7265 7475 726e 2064 6963 7428 6429    return dict(d)
-00010a20: 0a0a 0a64 6566 2068 746d 6c32 666f 726d  ...def html2form
-00010a30: 6174 2864 662c 2066 6f72 6d61 743d 276e  at(df, format='n
-00010a40: 616d 6527 2c20 6874 6d6c 5f63 6f6c 3d27  ame', html_col='
-00010a50: 636f 6c6f 725f 6874 6d6c 2729 3a0a 2020  color_html'):.  
-00010a60: 2020 2222 2220 436f 6e76 6572 7473 2074    """ Converts t
-00010a70: 6865 2048 544d 4c20 636f 6c75 6d6e 206f  he HTML column o
-00010a80: 6620 6120 4461 7461 4672 616d 6520 696e  f a DataFrame in
-00010a90: 746f 2027 6e61 6d65 272c 2027 7267 6220  to 'name', 'rgb 
-00010aa0: 2c20 6f72 2027 7267 6261 272e 2022 2222  , or 'rgba'. """
-00010ab0: 0a20 2020 2069 6620 666f 726d 6174 203d  .    if format =
-00010ac0: 3d20 276e 616d 6527 3a0a 2020 2020 2020  = 'name':.      
-00010ad0: 2020 7265 7475 726e 2064 665b 6874 6d6c    return df[html
-00010ae0: 5f63 6f6c 5d2e 6d61 7028 636f 6c6f 725f  _col].map(color_
-00010af0: 6e61 6d65 3268 746d 6c29 0a20 2020 2069  name2html).    i
-00010b00: 6620 666f 726d 6174 203d 3d20 2772 6762  f format == 'rgb
-00010b10: 273a 0a20 2020 2020 2020 2072 6574 7572  ':.        retur
-00010b20: 6e20 6466 5b68 746d 6c5f 636f 6c5d 2e6d  n df[html_col].m
-00010b30: 6170 2863 6f6c 6f72 5f6e 616d 6532 7267  ap(color_name2rg
-00010b40: 6229 0a20 2020 2069 6620 666f 726d 6174  b).    if format
-00010b50: 203d 3d20 2772 6762 6127 3a0a 2020 2020   == 'rgba':.    
-00010b60: 2020 2020 7265 7475 726e 2064 665b 6874      return df[ht
-00010b70: 6d6c 5f63 6f6c 5d2e 6d61 7028 636f 6c6f  ml_col].map(colo
-00010b80: 725f 6e61 6d65 3272 6762 6129 0a0a 0a64  r_name2rgba)...d
-00010b90: 6566 2068 746d 6c5f 636f 6c6f 7232 666f  ef html_color2fo
-00010ba0: 726d 6174 2868 2c20 666f 726d 6174 3d27  rmat(h, format='
-00010bb0: 6e61 6d65 2729 3a0a 2020 2020 2222 2220  name'):.    """ 
-00010bc0: 436f 6e76 6572 7473 2061 2073 696e 676c  Converts a singl
-00010bd0: 6520 4854 4d4c 2063 6f6c 6f72 2069 6e74  e HTML color int
-00010be0: 6f20 276e 616d 6527 2c20 2772 6762 272c  o 'name', 'rgb',
-00010bf0: 206f 7220 2027 7267 6261 272e 2222 220a   or  'rgba'.""".
-00010c00: 2020 2020 6966 2070 642e 6973 6e75 6c6c      if pd.isnull
-00010c10: 2868 293a 0a20 2020 2020 2020 2072 6574  (h):.        ret
-00010c20: 7572 6e20 680a 2020 2020 6966 2066 6f72  urn h.    if for
-00010c30: 6d61 7420 3d3d 2027 6e61 6d65 273a 0a20  mat == 'name':. 
-00010c40: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00010c50: 2020 2020 2020 2020 7265 7475 726e 2077          return w
-00010c60: 6562 636f 6c6f 7273 2e68 6578 5f74 6f5f  ebcolors.hex_to_
-00010c70: 6e61 6d65 2868 290a 2020 2020 2020 2020  name(h).        
-00010c80: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00010c90: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-00010ca0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00010cb0: 2020 2072 6574 7572 6e20 4d53 335f 4854     return MS3_HT
-00010cc0: 4d4c 5b68 5d0a 2020 2020 2020 2020 2020  ML[h].          
-00010cd0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00010ce0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00010cf0: 2020 2020 7265 7475 726e 2068 0a20 2020      return h.   
-00010d00: 2069 6620 666f 726d 6174 203d 3d20 2772   if format == 'r
-00010d10: 6762 273a 0a20 2020 2020 2020 2072 6574  gb':.        ret
-00010d20: 7572 6e20 7765 6263 6f6c 6f72 732e 6865  urn webcolors.he
-00010d30: 785f 746f 5f72 6762 2868 290a 2020 2020  x_to_rgb(h).    
-00010d40: 6966 2066 6f72 6d61 7420 3d3d 2027 7267  if format == 'rg
-00010d50: 6261 273a 0a20 2020 2020 2020 2072 6762  ba':.        rgb
-00010d60: 203d 2077 6562 636f 6c6f 7273 2e68 6578   = webcolors.hex
-00010d70: 5f74 6f5f 7267 6228 6829 0a20 2020 2020  _to_rgb(h).     
-00010d80: 2020 2072 6574 7572 6e20 7267 6261 282a     return rgba(*
-00010d90: 2872 6762 202b 2028 3235 352c 2929 290a  (rgb + (255,))).
-00010da0: 0a0a 6465 6620 6874 6d6c 5f63 6f6c 6f72  ..def html_color
-00010db0: 326e 616d 6528 6829 3a0a 2020 2020 2222  2name(h):.    ""
-00010dc0: 2220 436f 6e76 6572 7473 2061 2048 544d  " Converts a HTM
-00010dd0: 4c20 636f 6c6f 7220 696e 746f 2069 7473  L color into its
-00010de0: 2043 5353 3320 6e61 6d65 206f 7220 6974   CSS3 name or it
-00010df0: 7365 6c66 2069 6620 7468 6572 6520 6973  self if there is
-00010e00: 206e 6f6e 652e 2222 220a 2020 2020 7265   none.""".    re
-00010e10: 7475 726e 2068 746d 6c5f 636f 6c6f 7232  turn html_color2
-00010e20: 666f 726d 6174 2868 2c20 276e 616d 6527  format(h, 'name'
-00010e30: 290a 0a0a 6465 6620 6874 6d6c 5f63 6f6c  )...def html_col
-00010e40: 6f72 3272 6762 2868 293a 0a20 2020 2022  or2rgb(h):.    "
-00010e50: 2222 2043 6f6e 7665 7274 7320 6120 4854  "" Converts a HT
-00010e60: 4d4c 2063 6f6c 6f72 2069 6e74 6f20 5247  ML color into RG
-00010e70: 422e 2222 220a 2020 2020 7265 7475 726e  B.""".    return
-00010e80: 2068 746d 6c5f 636f 6c6f 7232 666f 726d   html_color2form
-00010e90: 6174 2868 2c20 2772 6762 2729 0a0a 0a64  at(h, 'rgb')...d
-00010ea0: 6566 2068 746d 6c5f 636f 6c6f 7232 7267  ef html_color2rg
-00010eb0: 6261 2868 293a 0a20 2020 2022 2222 2043  ba(h):.    """ C
-00010ec0: 6f6e 7665 7274 7320 6120 4854 4d4c 2063  onverts a HTML c
-00010ed0: 6f6c 6f72 2069 6e74 6f20 5247 4241 2e22  olor into RGBA."
-00010ee0: 2222 0a20 2020 2072 6574 7572 6e20 6874  "".    return ht
-00010ef0: 6d6c 5f63 6f6c 6f72 3266 6f72 6d61 7428  ml_color2format(
-00010f00: 682c 2027 7267 6261 2729 0a0a 0a64 6566  h, 'rgba')...def
-00010f10: 2069 6e74 6572 7661 6c5f 6f76 6572 6c61   interval_overla
-00010f20: 7028 612c 2062 2c20 636c 6f73 6564 3d4e  p(a, b, closed=N
-00010f30: 6f6e 6529 3a0a 2020 2020 2222 2220 5265  one):.    """ Re
-00010f40: 7475 726e 7320 7468 6520 6f76 6572 6c61  turns the overla
-00010f50: 7020 6f66 2074 776f 2070 642e 496e 7465  p of two pd.Inte
-00010f60: 7276 616c 7320 6173 2061 206e 6577 2070  rvals as a new p
-00010f70: 642e 496e 7465 7276 616c 2e0a 0a20 2020  d.Interval...   
-00010f80: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00010f90: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061  ----------.    a
-00010fa0: 2c20 6220 3a20 3a6f 626a 3a60 7061 6e64  , b : :obj:`pand
-00010fb0: 6173 2e49 6e74 6572 7661 6c60 0a20 2020  as.Interval`.   
-00010fc0: 2020 2020 2049 6e74 6572 7661 6c73 2066       Intervals f
-00010fd0: 6f72 2077 6869 6368 2074 6f20 636f 6d70  or which to comp
-00010fe0: 7574 6520 7468 6520 6f76 6572 6c61 702e  ute the overlap.
-00010ff0: 0a20 2020 2063 6c6f 7365 6420 3a20 7b27  .    closed : {'
-00011000: 6c65 6674 272c 2027 7269 6768 7427 2c20  left', 'right', 
-00011010: 2762 6f74 6827 2c20 276e 6569 7468 6572  'both', 'neither
-00011020: 277d 2c20 6f70 7469 6f6e 616c 0a20 2020  '}, optional.   
-00011030: 2020 2020 2049 6620 6e6f 2076 616c 7565       If no value
-00011040: 2069 7320 7061 7373 6564 2c20 7468 6520   is passed, the 
-00011050: 636c 6f73 7572 6520 6f66 2074 6865 2072  closure of the r
-00011060: 6574 7572 6e65 6420 696e 7465 7276 616c  eturned interval
-00011070: 2069 7320 696e 6665 7272 6564 2066 726f   is inferred fro
-00011080: 6d20 6060 6160 6020 616e 6420 6060 6260  m ``a`` and ``b`
-00011090: 602e 0a0a 2020 2020 5265 7475 726e 730a  `...    Returns.
-000110a0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-000110b0: 3a6f 626a 3a60 7061 6e64 6173 2e49 6e74  :obj:`pandas.Int
-000110c0: 6572 7661 6c60 0a20 2020 2022 2222 0a20  erval`.    """. 
-000110d0: 2020 2069 6620 6e6f 7420 612e 6f76 6572     if not a.over
-000110e0: 6c61 7073 2862 293a 0a20 2020 2020 2020  laps(b):.       
-000110f0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-00011100: 2069 6620 622e 6c65 6674 203c 2061 2e6c   if b.left < a.l
-00011110: 6566 743a 0a20 2020 2020 2020 2023 206d  eft:.        # m
-00011120: 616b 696e 6720 6120 7468 6520 6c65 6674  aking a the left
-00011130: 6d6f 7374 2069 6e74 6572 7661 6c0a 2020  most interval.  
-00011140: 2020 2020 2020 612c 2062 203d 2062 2c20        a, b = b, 
-00011150: 610a 2020 2020 6966 2063 6c6f 7365 6420  a.    if closed 
-00011160: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00011170: 2069 6620 612e 7269 6768 7420 3c20 622e   if a.right < b.
-00011180: 7269 6768 743a 0a20 2020 2020 2020 2020  right:.         
-00011190: 2020 2072 6967 6874 203d 2061 2e72 6967     right = a.rig
-000111a0: 6874 0a20 2020 2020 2020 2020 2020 2072  ht.            r
-000111b0: 6967 6874 5f63 6c6f 7365 6420 3d20 612e  ight_closed = a.
-000111c0: 636c 6f73 6564 2069 6e20 2827 7269 6768  closed in ('righ
-000111d0: 7427 2c20 2762 6f74 6827 290a 2020 2020  t', 'both').    
-000111e0: 2020 2020 2020 2020 6f74 6865 725f 6976          other_iv
-000111f0: 203d 2062 0a20 2020 2020 2020 2065 6c73   = b.        els
-00011200: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00011210: 6967 6874 203d 2062 2e72 6967 6874 0a20  ight = b.right. 
-00011220: 2020 2020 2020 2020 2020 2072 6967 6874             right
-00011230: 5f63 6c6f 7365 6420 3d20 622e 636c 6f73  _closed = b.clos
-00011240: 6564 2069 6e20 2827 7269 6768 7427 2c20  ed in ('right', 
-00011250: 2762 6f74 6827 290a 2020 2020 2020 2020  'both').        
-00011260: 2020 2020 6f74 6865 725f 6976 203d 2061      other_iv = a
-00011270: 0a20 2020 2020 2020 2069 6620 7269 6768  .        if righ
-00011280: 745f 636c 6f73 6564 2061 6e64 2072 6967  t_closed and rig
-00011290: 6874 203d 3d20 6f74 6865 725f 6976 2e72  ht == other_iv.r
-000112a0: 6967 6874 2061 6e64 206f 7468 6572 5f69  ight and other_i
-000112b0: 762e 636c 6f73 6564 206e 6f74 2069 6e20  v.closed not in 
-000112c0: 2827 7269 6768 7427 2c20 2762 6f74 6827  ('right', 'both'
-000112d0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-000112e0: 6967 6874 5f63 6c6f 7365 6420 3d20 4661  ight_closed = Fa
-000112f0: 6c73 650a 2020 2020 2020 2020 6c65 6674  lse.        left
-00011300: 5f63 6c6f 7365 6420 3d20 622e 636c 6f73  _closed = b.clos
-00011310: 6564 2069 6e20 2827 6c65 6674 272c 2027  ed in ('left', '
-00011320: 626f 7468 2729 0a20 2020 2020 2020 2069  both').        i
-00011330: 6620 6c65 6674 5f63 6c6f 7365 6420 616e  f left_closed an
-00011340: 6420 612e 6c65 6674 203d 3d20 622e 6c65  d a.left == b.le
-00011350: 6674 2061 6e64 2061 2e63 6c6f 7365 6420  ft and a.closed 
-00011360: 6e6f 7420 696e 2028 276c 6566 7427 2c20  not in ('left', 
-00011370: 2762 6f74 6827 293a 0a20 2020 2020 2020  'both'):.       
-00011380: 2020 2020 206c 6566 745f 636c 6f73 6564       left_closed
-00011390: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
-000113a0: 2020 6966 206c 6566 745f 636c 6f73 6564    if left_closed
-000113b0: 2061 6e64 2072 6967 6874 5f63 6c6f 7365   and right_close
-000113c0: 643a 0a20 2020 2020 2020 2020 2020 2063  d:.            c
-000113d0: 6c6f 7365 6420 3d20 2762 6f74 6827 0a20  losed = 'both'. 
-000113e0: 2020 2020 2020 2065 6c69 6620 6c65 6674         elif left
-000113f0: 5f63 6c6f 7365 643a 0a20 2020 2020 2020  _closed:.       
-00011400: 2020 2020 2063 6c6f 7365 6420 3d20 276c       closed = 'l
-00011410: 6566 7427 0a20 2020 2020 2020 2065 6c69  eft'.        eli
-00011420: 6620 7269 6768 745f 636c 6f73 6564 3a0a  f right_closed:.
-00011430: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
-00011440: 6564 203d 2027 7269 6768 7427 0a20 2020  ed = 'right'.   
-00011450: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00011460: 2020 2020 2020 2063 6c6f 7365 6420 3d20         closed = 
-00011470: 276e 6569 7468 6572 270a 2020 2020 656c  'neither'.    el
-00011480: 7365 3a0a 2020 2020 2020 2020 7269 6768  se:.        righ
-00011490: 7420 3d20 612e 7269 6768 7420 6966 2061  t = a.right if a
-000114a0: 2e72 6967 6874 203c 2062 2e72 6967 6874  .right < b.right
-000114b0: 2065 6c73 6520 622e 7269 6768 740a 2020   else b.right.  
-000114c0: 2020 7265 7475 726e 2070 642e 496e 7465    return pd.Inte
-000114d0: 7276 616c 2862 2e6c 6566 742c 2072 6967  rval(b.left, rig
-000114e0: 6874 2c20 636c 6f73 6564 3d63 6c6f 7365  ht, closed=close
-000114f0: 6429 0a0a 0a64 6566 2069 6e74 6572 7661  d)...def interva
-00011500: 6c5f 6f76 6572 6c61 705f 7369 7a65 2861  l_overlap_size(a
-00011510: 2c20 622c 2064 6563 696d 616c 733d 3329  , b, decimals=3)
-00011520: 3a0a 2020 2020 2222 2252 6574 7572 6e73  :.    """Returns
-00011530: 2074 6865 2073 697a 6520 6f66 2074 6865   the size of the
-00011540: 206f 7665 726c 6170 206f 6620 7477 6f20   overlap of two 
-00011550: 7064 2e49 6e74 6572 7661 6c73 2e22 2222  pd.Intervals."""
-00011560: 0a20 2020 2069 6620 6e6f 7420 612e 6f76  .    if not a.ov
-00011570: 6572 6c61 7073 2862 293a 0a20 2020 2020  erlaps(b):.     
-00011580: 2020 2072 6574 7572 6e20 302e 300a 2020     return 0.0.  
-00011590: 2020 6966 2062 2e6c 6566 7420 3c20 612e    if b.left < a.
-000115a0: 6c65 6674 3a0a 2020 2020 2020 2020 2320  left:.        # 
-000115b0: 6d61 6b69 6e67 2061 2074 6865 206c 6566  making a the lef
-000115c0: 746d 6f73 7420 696e 7465 7276 616c 0a20  tmost interval. 
-000115d0: 2020 2020 2020 2061 2c20 6220 3d20 622c         a, b = b,
-000115e0: 2061 0a20 2020 2072 6967 6874 203d 2061   a.    right = a
-000115f0: 2e72 6967 6874 2069 6620 612e 7269 6768  .right if a.righ
-00011600: 7420 3c20 622e 7269 6768 7420 656c 7365  t < b.right else
-00011610: 2062 2e72 6967 6874 0a20 2020 2072 6573   b.right.    res
-00011620: 756c 7420 3d20 7269 6768 7420 2d20 622e  ult = right - b.
-00011630: 6c65 6674 0a20 2020 2072 6574 7572 6e20  left.    return 
-00011640: 726f 756e 6428 7265 7375 6c74 2c20 6465  round(result, de
-00011650: 6369 6d61 6c73 290a 0a40 6675 6e63 7469  cimals)..@functi
-00011660: 6f6e 5f6c 6f67 6765 720a 6465 6620 6973  on_logger.def is
-00011670: 5f61 6e79 5f72 6f77 5f65 7175 616c 2864  _any_row_equal(d
-00011680: 6631 2c20 6466 3229 3a0a 2020 2020 2222  f1, df2):.    ""
-00011690: 2220 5265 7475 726e 7320 5472 7565 2069  " Returns True i
-000116a0: 6620 616e 7920 7477 6f20 726f 7773 206f  f any two rows o
-000116b0: 6620 7468 6520 7477 6f20 4461 7461 4672  f the two DataFr
-000116c0: 616d 6573 2063 6f6e 7461 696e 2074 6865  ames contain the
-000116d0: 2073 616d 6520 7661 6c75 6520 7475 706c   same value tupl
-000116e0: 6573 2e20 2222 220a 2020 2020 6173 7365  es. """.    asse
-000116f0: 7274 206c 656e 2864 6631 2e63 6f6c 756d  rt len(df1.colum
-00011700: 6e73 2920 3d3d 206c 656e 2864 6632 2e63  ns) == len(df2.c
-00011710: 6f6c 756d 6e73 292c 2022 5061 7373 2074  olumns), "Pass t
-00011720: 6865 2073 616d 6520 6e75 6d62 6572 206f  he same number o
-00011730: 6620 636f 6c75 6d6e 7320 666f 7220 626f  f columns for bo
-00011740: 7468 2044 6174 6146 7261 6d65 7322 0a20  th DataFrames". 
-00011750: 2020 2076 3120 3d20 7365 7428 6466 312e     v1 = set(df1.
-00011760: 6974 6572 7475 706c 6573 2869 6e64 6578  itertuples(index
-00011770: 3d46 616c 7365 2c20 6e61 6d65 3d4e 6f6e  =False, name=Non
-00011780: 6529 290a 2020 2020 7632 203d 2073 6574  e)).    v2 = set
-00011790: 2864 6632 2e69 7465 7274 7570 6c65 7328  (df2.itertuples(
-000117a0: 696e 6465 783d 4661 6c73 652c 206e 616d  index=False, nam
-000117b0: 653d 4e6f 6e65 2929 0a20 2020 2072 6574  e=None)).    ret
-000117c0: 7572 6e20 7631 2e69 6e74 6572 7365 6374  urn v1.intersect
-000117d0: 696f 6e28 7632 290a 0a0a 6465 6620 6973  ion(v2)...def is
-000117e0: 5f6d 696e 6f72 5f6d 6f64 6528 6669 6674  _minor_mode(fift
-000117f0: 6873 2c20 6d69 6e6f 723d 4661 6c73 6529  hs, minor=False)
-00011800: 3a0a 2020 2020 2222 2220 5265 7475 726e  :.    """ Return
-00011810: 7320 5472 7565 2069 6620 7468 6520 7363  s True if the sc
-00011820: 616c 6520 6465 6772 6565 2060 6669 6674  ale degree `fift
-00011830: 6873 6020 6e61 7475 7261 6c6c 7920 6861  hs` naturally ha
-00011840: 7320 6120 6d69 6e6f 7220 7468 6972 6420  s a minor third 
-00011850: 696e 2074 6865 2073 6361 6c65 2e0a 2020  in the scale..  
-00011860: 2020 2222 220a 2020 2020 7468 6972 6473    """.    thirds
-00011870: 203d 205b 2d34 2c20 2d33 2c20 2d32 2c20   = [-4, -3, -2, 
-00011880: 2d31 2c20 302c 2031 2c20 325d 2069 6620  -1, 0, 1, 2] if 
-00011890: 6d69 6e6f 7220 656c 7365 205b 332c 2034  minor else [3, 4
-000118a0: 2c20 352c 202d 312c 2030 2c20 312c 2032  , 5, -1, 0, 1, 2
-000118b0: 5d0a 2020 2020 7468 6972 6420 3d20 7468  ].    third = th
-000118c0: 6972 6473 5b28 6669 6674 6873 202b 2031  irds[(fifths + 1
-000118d0: 2920 2520 375d 202d 2066 6966 7468 730a  ) % 7] - fifths.
-000118e0: 2020 2020 7265 7475 726e 2074 6869 7264      return third
-000118f0: 203d 3d20 2d33 0a0a 0a64 6566 2069 7465   == -3...def ite
-00011900: 725f 6e65 7374 6564 286e 6573 7465 6429  r_nested(nested)
-00011910: 3a0a 2020 2020 2222 2249 7465 7261 7465  :.    """Iterate
-00011920: 2074 6872 6f75 6768 2061 6e79 206e 6573   through any nes
-00011930: 7465 6420 7374 7275 6374 7572 6520 6f66  ted structure of
-00011940: 206c 6973 7473 2061 6e64 2074 7570 6c65   lists and tuple
-00011950: 7320 6672 6f6d 206c 6566 7420 746f 2072  s from left to r
-00011960: 6967 6874 2e22 2222 0a20 2020 2066 6f72  ight.""".    for
-00011970: 2065 6c65 6d20 696e 206e 6573 7465 643a   elem in nested:
-00011980: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00011990: 7374 616e 6365 2865 6c65 6d2c 206c 6973  stance(elem, lis
-000119a0: 7429 206f 7220 6973 696e 7374 616e 6365  t) or isinstance
-000119b0: 2865 6c65 6d2c 2074 7570 6c65 293a 0a20  (elem, tuple):. 
-000119c0: 2020 2020 2020 2020 2020 2066 6f72 206c             for l
-000119d0: 6f77 6572 2069 6e20 6974 6572 5f6e 6573  ower in iter_nes
-000119e0: 7465 6428 656c 656d 293a 0a20 2020 2020  ted(elem):.     
-000119f0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-00011a00: 206c 6f77 6572 0a20 2020 2020 2020 2065   lower.        e
-00011a10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00011a20: 2079 6965 6c64 2065 6c65 6d0a 0a0a 6465   yield elem...de
-00011a30: 6620 6974 6572 5f73 656c 6563 7469 6f6e  f iter_selection
-00011a40: 2863 6f6c 6c65 6374 696f 2c20 7365 6c65  (collectio, sele
-00011a50: 6374 6f72 3d4e 6f6e 652c 206f 7070 6f73  ctor=None, oppos
-00011a60: 6974 653d 4661 6c73 6529 3a0a 2020 2020  ite=False):.    
-00011a70: 2222 2220 5265 7475 726e 7320 6120 6765  """ Returns a ge
-00011a80: 6e65 7261 746f 7220 6f66 2060 6063 6f6c  nerator of ``col
-00011a90: 6c65 6374 696f 6060 2e20 6060 7365 6c65  lectio``. ``sele
-00011aa0: 6374 6f72 6060 2063 616e 2062 6520 6120  ctor`` can be a 
-00011ab0: 636f 6c6c 6563 7469 6f6e 206f 6620 696e  collection of in
-00011ac0: 6465 7820 6e75 6d62 6572 7320 746f 2073  dex numbers to s
-00011ad0: 656c 6563 7420 6f72 2075 6e73 656c 6563  elect or unselec
-00011ae0: 740a 2020 2020 656c 656d 656e 7473 202d  t.    elements -
-00011af0: 2d20 6465 7065 6e64 696e 6720 6f6e 2060  - depending on `
-00011b00: 606f 7070 6f73 6974 6560 6020 2222 220a  `opposite`` """.
-00011b10: 2020 2020 6966 2073 656c 6563 746f 7220      if selector 
-00011b20: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00011b30: 2066 6f72 2065 2069 6e20 636f 6c6c 6563   for e in collec
-00011b40: 7469 6f3a 0a20 2020 2020 2020 2020 2020  tio:.           
-00011b50: 2079 6965 6c64 2065 0a20 2020 2069 6620   yield e.    if 
-00011b60: 6f70 706f 7369 7465 3a0a 2020 2020 2020  opposite:.      
-00011b70: 2020 666f 7220 692c 2065 2069 6e20 656e    for i, e in en
-00011b80: 756d 6572 6174 6528 636f 6c6c 6563 7469  umerate(collecti
-00011b90: 6f29 3a0a 2020 2020 2020 2020 2020 2020  o):.            
-00011ba0: 6966 2069 206e 6f74 2069 6e20 7365 6c65  if i not in sele
-00011bb0: 6374 6f72 3a0a 2020 2020 2020 2020 2020  ctor:.          
-00011bc0: 2020 2020 2020 7969 656c 6420 650a 2020        yield e.  
-00011bd0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00011be0: 666f 7220 692c 2065 2069 6e20 656e 756d  for i, e in enum
-00011bf0: 6572 6174 6528 636f 6c6c 6563 7469 6f29  erate(collectio)
-00011c00: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00011c10: 2069 2069 6e20 7365 6c65 6374 6f72 3a0a   i in selector:.
-00011c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c30: 7969 656c 6420 650a 0a0a 6465 6620 6974  yield e...def it
-00011c40: 6572 6162 6c65 3273 7472 2869 7465 7261  erable2str(itera
-00011c50: 626c 6529 3a0a 2020 2020 7472 793a 0a20  ble):.    try:. 
-00011c60: 2020 2020 2020 2072 6574 7572 6e20 272c         return ',
-00011c70: 2027 2e6a 6f69 6e28 7374 7228 7329 2066   '.join(str(s) f
-00011c80: 6f72 2073 2069 6e20 6974 6572 6162 6c65  or s in iterable
-00011c90: 290a 2020 2020 6578 6365 7074 2045 7863  ).    except Exc
-00011ca0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00011cb0: 7265 7475 726e 2069 7465 7261 626c 650a  return iterable.
-00011cc0: 0a0a 6465 6620 636f 6e74 6169 6e73 5f6d  ..def contains_m
-00011cd0: 6574 6164 6174 6128 7061 7468 293a 0a20  etadata(path):. 
-00011ce0: 2020 2066 6f72 205f 2c20 5f2c 2066 696c     for _, _, fil
-00011cf0: 6573 2069 6e20 6f73 2e77 616c 6b28 7061  es in os.walk(pa
-00011d00: 7468 293a 0a20 2020 2020 2020 2072 6574  th):.        ret
-00011d10: 7572 6e20 616e 7928 6620 3d3d 2027 6d65  urn any(f == 'me
-00011d20: 7461 6461 7461 2e74 7376 2720 666f 7220  tadata.tsv' for 
-00011d30: 6620 696e 2066 696c 6573 290a 0a64 6566  f in files)..def
-00011d40: 2066 6972 7374 5f6c 6576 656c 5f73 7562   first_level_sub
-00011d50: 6469 7273 2870 6174 6829 3a0a 2020 2020  dirs(path):.    
-00011d60: 2222 2252 6574 7572 6e73 2074 6865 2064  """Returns the d
-00011d70: 6972 6563 746f 7279 206e 616d 6573 2063  irectory names c
-00011d80: 6f6e 7461 696e 6564 2069 6e20 7061 7468  ontained in path
-00011d90: 2e22 2222 0a20 2020 2066 6f72 205f 2c20  .""".    for _, 
-00011da0: 7375 6264 6972 732c 205f 2069 6e20 6f73  subdirs, _ in os
-00011db0: 2e77 616c 6b28 7061 7468 293a 0a20 2020  .walk(path):.   
-00011dc0: 2020 2020 2072 6574 7572 6e20 7375 6264       return subd
-00011dd0: 6972 730a 0a64 6566 2066 6972 7374 5f6c  irs..def first_l
-00011de0: 6576 656c 5f66 696c 6573 5f61 6e64 5f73  evel_files_and_s
-00011df0: 7562 6469 7273 2870 6174 6829 3a0a 2020  ubdirs(path):.  
-00011e00: 2020 2222 2252 6574 7572 6e73 2074 6865    """Returns the
-00011e10: 2064 6972 6563 746f 7279 206e 616d 6573   directory names
-00011e20: 2061 6e64 2066 696c 656e 616d 6573 2063   and filenames c
-00011e30: 6f6e 7461 696e 6564 2069 6e20 7061 7468  ontained in path
-00011e40: 2e22 2222 0a20 2020 2066 6f72 205f 2c20  .""".    for _, 
-00011e50: 7375 6264 6972 732c 2066 696c 6573 2069  subdirs, files i
-00011e60: 6e20 6f73 2e77 616c 6b28 7061 7468 293a  n os.walk(path):
-00011e70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011e80: 7375 6264 6972 732c 2066 696c 6573 0a0a  subdirs, files..
-00011e90: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
-00011ea0: 0a64 6566 2063 6f6e 7461 696e 735f 636f  .def contains_co
-00011eb0: 7270 7573 5f69 6e64 6963 6174 6f72 2870  rpus_indicator(p
-00011ec0: 6174 6829 3a0a 2020 2020 666f 7220 7375  ath):.    for su
-00011ed0: 6264 6972 2069 6e20 6669 7273 745f 6c65  bdir in first_le
-00011ee0: 7665 6c5f 7375 6264 6972 7328 7061 7468  vel_subdirs(path
-00011ef0: 293a 0a20 2020 2020 2020 2069 6620 7375  ):.        if su
-00011f00: 6264 6972 2069 6e20 5354 414e 4441 5244  bdir in STANDARD
-00011f10: 5f4e 414d 4553 5f4f 525f 4749 543a 0a20  _NAMES_OR_GIT:. 
-00011f20: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00011f30: 722e 6465 6275 6728 6622 7b70 6174 687d  r.debug(f"{path}
-00011f40: 2063 6f6e 7461 696e 7320 6120 7375 6264   contains a subd
-00011f50: 6972 6563 746f 7279 2063 616c 6c65 6420  irectory called 
-00011f60: 7b73 7562 6469 727d 2061 6e64 2069 7320  {subdir} and is 
-00011f70: 6173 7375 6d65 6420 746f 2062 6520 6120  assumed to be a 
-00011f80: 636f 7270 7573 2e22 290a 2020 2020 2020  corpus.").      
-00011f90: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00011fa0: 650a 2020 2020 7265 7475 726e 2046 616c  e.    return Fal
-00011fb0: 7365 0a0a 0a40 6675 6e63 7469 6f6e 5f6c  se...@function_l
-00011fc0: 6f67 6765 720a 6465 6620 6765 745f 6669  ogger.def get_fi
-00011fd0: 7273 745f 6c65 7665 6c5f 636f 7270 6f72  rst_level_corpor
-00011fe0: 6128 7061 7468 3a20 7374 7229 202d 3e20  a(path: str) -> 
-00011ff0: 4c69 7374 5b73 7472 5d3a 0a20 2020 2022  List[str]:.    "
-00012000: 2222 4368 6563 6b73 2074 6865 2066 6972  ""Checks the fir
-00012010: 7374 2d6c 6576 656c 2073 7562 6469 7265  st-level subdire
-00012020: 6374 6f72 6965 7320 6f66 2070 6174 6820  ctories of path 
-00012030: 666f 7220 696e 6469 6361 746f 7273 206f  for indicators o
-00012040: 6620 6265 696e 6720 6120 636f 7270 7573  f being a corpus
-00012050: 2e20 4966 206f 6e65 206f 6620 7468 656d  . If one of them
-00012060: 2073 686f 7773 2061 6e0a 2020 2020 696e   shows an.    in
-00012070: 6469 6361 746f 7220 2870 7265 7365 6e63  dicator (presenc
-00012080: 6520 6f66 2061 2027 6d65 7461 6461 7461  e of a 'metadata
-00012090: 2e74 7376 2720 6669 6c65 2c20 6f72 206f  .tsv' file, or o
-000120a0: 6620 6120 272e 6769 7427 2066 6f6c 6465  f a '.git' folde
-000120b0: 7220 6f72 2061 6e79 206f 6620 7468 6520  r or any of the 
-000120c0: 6465 6661 756c 7420 666f 6c64 6572 206e  default folder n
-000120d0: 616d 6573 292c 2072 6574 7572 6e73 0a20  ames), returns. 
-000120e0: 2020 2061 206c 6973 7420 6f66 2061 6c6c     a list of all
-000120f0: 2073 7562 6469 7265 6374 6f72 6965 732e   subdirectories.
-00012100: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-00012110: 7061 7468 2069 7320 4e6f 6e65 206f 7220  path is None or 
-00012120: 6e6f 7420 6f73 2e70 6174 682e 6973 6469  not os.path.isdi
-00012130: 7228 7061 7468 293a 0a20 2020 2020 2020  r(path):.       
-00012140: 206c 6f67 6765 722e 696e 666f 2866 227b   logger.info(f"{
-00012150: 7061 7468 7d20 6973 206e 6f74 2061 6e20  path} is not an 
-00012160: 6578 6973 7469 6e67 2064 6972 6563 746f  existing directo
-00012170: 7279 2e22 290a 2020 2020 2020 2020 7265  ry.").        re
-00012180: 7475 726e 0a20 2020 2073 7562 7061 7468  turn.    subpath
-00012190: 7320 3d20 5b6f 732e 7061 7468 2e6a 6f69  s = [os.path.joi
-000121a0: 6e28 7061 7468 2c20 7375 6264 6972 2920  n(path, subdir) 
-000121b0: 666f 7220 7375 6264 6972 2069 6e20 6669  for subdir in fi
-000121c0: 7273 745f 6c65 7665 6c5f 7375 6264 6972  rst_level_subdir
-000121d0: 7328 7061 7468 2920 6966 2073 7562 6469  s(path) if subdi
-000121e0: 725b 305d 2021 3d20 272e 275d 0a20 2020  r[0] != '.'].   
-000121f0: 2066 6f72 2073 7562 7061 7468 2069 6e20   for subpath in 
-00012200: 7375 6270 6174 6873 3a0a 2020 2020 2020  subpaths:.      
-00012210: 2020 6966 2063 6f6e 7461 696e 735f 6d65    if contains_me
-00012220: 7461 6461 7461 2873 7562 7061 7468 293a  tadata(subpath):
-00012230: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00012240: 6765 722e 6465 6275 6728 6622 7b73 7562  ger.debug(f"{sub
-00012250: 7061 7468 7d20 7265 636f 676e 697a 6564  path} recognized
-00012260: 2061 7320 636f 7270 7573 2064 6972 6563   as corpus direc
-00012270: 746f 7279 2062 6563 6175 7365 2069 7420  tory because it 
-00012280: 636f 6e74 6169 6e73 206d 6574 6164 6174  contains metadat
-00012290: 612e 2229 0a20 2020 2020 2020 2020 2020  a.").           
-000122a0: 2072 6574 7572 6e20 7375 6270 6174 6873   return subpaths
-000122b0: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-000122c0: 6169 6e73 5f63 6f72 7075 735f 696e 6469  ains_corpus_indi
-000122d0: 6361 746f 7228 7375 6270 6174 682c 206c  cator(subpath, l
-000122e0: 6f67 6765 723d 6c6f 6767 6572 293a 0a20  ogger=logger):. 
-000122f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00012300: 6e20 7375 6270 6174 6873 0a20 2020 2072  n subpaths.    r
-00012310: 6574 7572 6e20 5b5d 0a0a 0a0a 4066 756e  eturn []....@fun
-00012320: 6374 696f 6e5f 6c6f 6767 6572 0a64 6566  ction_logger.def
-00012330: 206a 6f69 6e5f 7473 7673 2864 6673 2c20   join_tsvs(dfs, 
-00012340: 736f 7274 5f63 6f6c 733d 4661 6c73 6529  sort_cols=False)
-00012350: 3a0a 2020 2020 2222 2220 5065 7266 6f72  :.    """ Perfor
-00012360: 6d73 206f 7574 6572 206a 6f69 6e20 6f6e  ms outer join on
-00012370: 2074 6865 2070 6173 7365 6420 4461 7461   the passed Data
-00012380: 4672 616d 6573 2062 6173 6564 206f 6e20  Frames based on 
-00012390: 276d 6327 2061 6e64 2027 6d63 5f6f 6e73  'mc' and 'mc_ons
-000123a0: 6574 272c 2069 6620 616e 792e 0a20 2020  et', if any..   
-000123b0: 2055 7365 733a 2066 756e 6374 6f6f 6c73   Uses: functools
-000123c0: 2e72 6564 7563 6528 292c 2073 6f72 745f  .reduce(), sort_
-000123d0: 636f 6c73 2829 2c20 736f 7274 5f6e 6f74  cols(), sort_not
-000123e0: 655f 6c69 7374 7328 290a 0a20 2020 2050  e_lists()..    P
-000123f0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00012400: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064 6673  --------.    dfs
-00012410: 203a 203a 6f62 6a3a 6043 6f6c 6c65 6374   : :obj:`Collect
-00012420: 696f 6e60 0a20 2020 2020 2020 2043 6f6c  ion`.        Col
-00012430: 6c65 6374 696f 6e20 6f66 2044 6174 6146  lection of DataF
-00012440: 7261 6d65 7320 746f 206a 6f69 6e2e 0a20  rames to join.. 
-00012450: 2020 2073 6f72 745f 636f 6c73 203a 203a     sort_cols : :
-00012460: 6f62 6a3a 6062 6f6f 6c60 2c20 6f70 7469  obj:`bool`, opti
-00012470: 6f6e 616c 0a20 2020 2020 2020 2049 6620  onal.        If 
-00012480: 796f 7520 7061 7373 2054 7275 652c 2074  you pass True, t
-00012490: 6865 2063 6f6c 756d 6e73 2061 6674 6572  he columns after
-000124a0: 2074 686f 7365 2064 6566 696e 6564 2069   those defined i
-000124b0: 6e20 3a70 793a 6174 7472 3a60 5354 414e  n :py:attr:`STAN
-000124c0: 4441 5244 5f43 4f4c 554d 4e5f 4f52 4445  DARD_COLUMN_ORDE
-000124d0: 5260 0a20 2020 2020 2020 2077 696c 6c20  R`.        will 
-000124e0: 6265 2073 6f72 7465 6420 616c 7068 6162  be sorted alphab
-000124f0: 6574 6963 616c 6c79 2e0a 0a20 2020 2052  etically...    R
-00012500: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-00012510: 2d2d 0a0a 2020 2020 2222 220a 2020 2020  --..    """.    
-00012520: 6966 206c 656e 2864 6673 2920 3d3d 2031  if len(dfs) == 1
-00012530: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00012540: 2064 6673 5b30 5d0a 2020 2020 7a65 726f   dfs[0].    zero
-00012550: 2c20 6f6e 652c 2074 776f 203d 205b 5d2c  , one, two = [],
-00012560: 205b 5d2c 205b 5d0a 2020 2020 666f 7220   [], [].    for 
-00012570: 6466 2069 6e20 6466 733a 0a20 2020 2020  df in dfs:.     
-00012580: 2020 2069 6620 276d 6327 2069 6e20 6466     if 'mc' in df
-00012590: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
-000125a0: 2020 2020 2020 6966 2027 6d63 5f6f 6e73        if 'mc_ons
-000125b0: 6574 2720 696e 2064 662e 636f 6c75 6d6e  et' in df.column
-000125c0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000125d0: 2020 2074 776f 2e61 7070 656e 6428 6466     two.append(df
-000125e0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-000125f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00012600: 2020 2020 6f6e 652e 6170 7065 6e64 2864      one.append(d
-00012610: 6629 0a20 2020 2020 2020 2065 6c73 653a  f).        else:
-00012620: 0a20 2020 2020 2020 2020 2020 207a 6572  .            zer
-00012630: 6f2e 6170 7065 6e64 2864 6629 0a20 2020  o.append(df).   
-00012640: 206a 6f69 6e5f 6f72 6465 7220 3d20 7477   join_order = tw
-00012650: 6f20 2b20 6f6e 650a 2020 2020 6966 206c  o + one.    if l
-00012660: 656e 287a 6572 6f29 203e 2030 3a0a 2020  en(zero) > 0:.  
-00012670: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-00012680: 6f28 6622 7b6c 656e 287a 6572 6f29 7d20  o(f"{len(zero)} 
-00012690: 4461 7461 4672 616d 6573 2063 6f6e 7461  DataFrames conta
-000126a0: 696e 206e 6f6e 6520 6f66 2074 6865 2063  in none of the c
-000126b0: 6f6c 756d 6e73 2027 6d63 2720 616e 6420  olumns 'mc' and 
-000126c0: 276d 635f 6f6e 7365 7427 2e22 290a 0a20  'mc_onset'.").. 
-000126d0: 2020 2070 6f73 5f63 6f6c 7320 3d20 5b27     pos_cols = ['
-000126e0: 6d63 272c 2027 6d63 5f6f 6e73 6574 275d  mc', 'mc_onset']
-000126f0: 0a0a 2020 2020 6465 6620 6a6f 696e 5f74  ..    def join_t
-00012700: 7376 2861 2c20 6229 3a0a 2020 2020 2020  sv(a, b):.      
-00012710: 2020 6a6f 696e 5f63 6f6c 7320 3d20 5b63    join_cols = [c
-00012720: 2066 6f72 2063 2069 6e20 706f 735f 636f   for c in pos_co
-00012730: 6c73 2069 6620 6320 696e 2061 2e63 6f6c  ls if c in a.col
-00012740: 756d 6e73 2061 6e64 2063 2069 6e20 622e  umns and c in b.
-00012750: 636f 6c75 6d6e 735d 0a20 2020 2020 2020  columns].       
-00012760: 2072 6573 203d 2070 642e 6d65 7267 6528   res = pd.merge(
-00012770: 612c 2062 2c20 686f 773d 276f 7574 6572  a, b, how='outer
-00012780: 272c 206f 6e3d 6a6f 696e 5f63 6f6c 732c  ', on=join_cols,
-00012790: 2073 7566 6669 7865 733d 2827 272c 2027   suffixes=('', '
-000127a0: 5f79 2729 292e 7265 7365 745f 696e 6465  _y')).reset_inde
-000127b0: 7828 6472 6f70 3d54 7275 6529 0a20 2020  x(drop=True).   
-000127c0: 2020 2020 2064 7570 6c69 6361 7465 7320       duplicates 
-000127d0: 3d20 5b63 6f6c 2066 6f72 2063 6f6c 2069  = [col for col i
-000127e0: 6e20 7265 732e 636f 6c75 6d6e 7320 6966  n res.columns if
-000127f0: 2063 6f6c 2e65 6e64 7377 6974 6828 275f   col.endswith('_
-00012800: 7927 295d 0a20 2020 2020 2020 2066 6f72  y')].        for
-00012810: 2064 2069 6e20 6475 706c 6963 6174 6573   d in duplicates
-00012820: 3a0a 2020 2020 2020 2020 2020 2020 6c65  :.            le
-00012830: 6674 203d 2064 5b3a 2d32 5d0a 2020 2020  ft = d[:-2].    
-00012840: 2020 2020 2020 2020 6966 2072 6573 5b6c          if res[l
-00012850: 6566 745d 2e69 736e 6128 292e 616e 7928  eft].isna().any(
-00012860: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00012870: 2020 2072 6573 5b6c 6566 745d 2e66 696c     res[left].fil
-00012880: 6c6e 6128 7265 735b 645d 2c20 696e 706c  lna(res[d], inpl
-00012890: 6163 653d 5472 7565 290a 2020 2020 2020  ace=True).      
-000128a0: 2020 7265 7475 726e 2072 6573 2e64 726f    return res.dro
-000128b0: 7028 636f 6c75 6d6e 733d 6475 706c 6963  p(columns=duplic
-000128c0: 6174 6573 290a 0a20 2020 2072 6573 203d  ates)..    res =
-000128d0: 2072 6564 7563 6528 6a6f 696e 5f74 7376   reduce(join_tsv
-000128e0: 2c20 6a6f 696e 5f6f 7264 6572 290a 2020  , join_order).  
-000128f0: 2020 6966 2027 6d69 6469 2720 696e 2072    if 'midi' in r
-00012900: 6573 2e63 6f6c 756d 6e73 3a0a 2020 2020  es.columns:.    
-00012910: 2020 2020 7265 7320 3d20 736f 7274 5f6e      res = sort_n
-00012920: 6f74 655f 6c69 7374 2872 6573 290a 2020  ote_list(res).  
-00012930: 2020 656c 6966 206c 656e 2874 776f 2920    elif len(two) 
-00012940: 3e20 303a 0a20 2020 2020 2020 2072 6573  > 0:.        res
-00012950: 203d 2072 6573 2e73 6f72 745f 7661 6c75   = res.sort_valu
-00012960: 6573 2870 6f73 5f63 6f6c 7329 0a20 2020  es(pos_cols).   
-00012970: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
-00012980: 6573 203d 2072 6573 2e73 6f72 745f 7661  es = res.sort_va
-00012990: 6c75 6573 2827 6d63 2729 0a20 2020 2072  lues('mc').    r
-000129a0: 6574 7572 6e20 636f 6c75 6d6e 5f6f 7264  eturn column_ord
-000129b0: 6572 2872 6573 2c20 736f 7274 3d73 6f72  er(res, sort=sor
-000129c0: 745f 636f 6c73 292e 7265 7365 745f 696e  t_cols).reset_in
-000129d0: 6465 7828 6472 6f70 3d54 7275 6529 0a0a  dex(drop=True)..
-000129e0: 0a64 6566 2073 7472 3269 6e74 7475 706c  .def str2inttupl
-000129f0: 6528 6c3a 2073 7472 2c20 7374 7269 6374  e(l: str, strict
-00012a00: 3a20 626f 6f6c 203d 2054 7275 6529 202d  : bool = True) -
-00012a10: 3e20 5475 706c 655b 696e 745d 3a0a 2020  > Tuple[int]:.  
-00012a20: 2020 6c20 3d20 6c2e 7374 7269 7028 2728    l = l.strip('(
-00012a30: 292c 2729 0a20 2020 2069 6620 6c20 3d3d  ),').    if l ==
-00012a40: 2027 273a 0a20 2020 2020 2020 2072 6574   '':.        ret
-00012a50: 7572 6e20 7475 706c 6528 290a 2020 2020  urn tuple().    
-00012a60: 7265 7320 3d20 5b5d 0a20 2020 2066 6f72  res = [].    for
-00012a70: 2073 2069 6e20 6c2e 7370 6c69 7428 272c   s in l.split(',
-00012a80: 2027 293a 0a20 2020 2020 2020 2074 7279   '):.        try
-00012a90: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00012aa0: 732e 6170 7065 6e64 2869 6e74 2873 2929  s.append(int(s))
-00012ab0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00012ac0: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
-00012ad0: 2020 2020 2020 2020 6966 2073 7472 6963          if stric
-00012ae0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00012af0: 2020 2070 7269 6e74 2866 2253 7472 696e     print(f"Strin
-00012b00: 6720 7661 6c75 6520 277b 737d 2720 636f  g value '{s}' co
-00012b10: 756c 6420 6e6f 7420 6265 2063 6f6e 7665  uld not be conve
-00012b20: 7274 6564 2074 6f20 616e 2069 6e74 6567  rted to an integ
-00012b30: 6572 2c20 277b 6c7d 2720 6e6f 7420 746f  er, '{l}' not to
-00012b40: 2061 6e20 696e 7465 6765 7220 7475 706c   an integer tupl
-00012b50: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
-00012b60: 2020 2020 2072 6169 7365 0a20 2020 2020       raise.     
-00012b70: 2020 2020 2020 2069 6620 735b 305d 203d         if s[0] =
-00012b80: 3d20 735b 2d31 5d20 616e 6420 735b 305d  = s[-1] and s[0]
-00012b90: 2069 6e20 2822 5c22 222c 2022 5c27 2229   in ("\"", "\'")
-00012ba0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012bb0: 2020 7320 3d20 735b 313a 2d31 5d0a 2020    s = s[1:-1].  
-00012bc0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00012bd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00012be0: 6573 2e61 7070 656e 6428 696e 7428 7329  es.append(int(s)
-00012bf0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-00012c00: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
-00012c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012c20: 2072 6573 2e61 7070 656e 6428 7329 0a20   res.append(s). 
-00012c30: 2020 2072 6574 7572 6e20 7475 706c 6528     return tuple(
-00012c40: 7265 7329 0a0a 0a64 6566 2069 6e74 3262  res)...def int2b
-00012c50: 6f6f 6c28 733a 2073 7472 2920 2d3e 2055  ool(s: str) -> U
-00012c60: 6e69 6f6e 5b62 6f6f 6c2c 2073 7472 5d3a  nion[bool, str]:
-00012c70: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00012c80: 2020 7265 7475 726e 2062 6f6f 6c28 696e    return bool(in
-00012c90: 7428 7329 290a 2020 2020 6578 6365 7074  t(s)).    except
-00012ca0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-00012cb0: 2020 2020 7265 7475 726e 2073 0a0a 0a64      return s...d
-00012cc0: 6566 2073 6166 655f 6672 6163 2873 3a20  ef safe_frac(s: 
-00012cd0: 7374 7229 202d 3e20 556e 696f 6e5b 6672  str) -> Union[fr
-00012ce0: 6163 2c20 7374 725d 3a0a 2020 2020 7472  ac, str]:.    tr
-00012cf0: 793a 0a20 2020 2020 2020 2072 6574 7572  y:.        retur
-00012d00: 6e20 6672 6163 2873 290a 2020 2020 6578  n frac(s).    ex
-00012d10: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-00012d20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00012d30: 0a0a 6465 6620 7361 6665 5f69 6e74 2873  ..def safe_int(s
-00012d40: 2920 2d3e 2055 6e69 6f6e 5b69 6e74 2c20  ) -> Union[int, 
-00012d50: 7374 725d 3a0a 2020 2020 7472 793a 0a20  str]:.    try:. 
-00012d60: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
-00012d70: 7428 666c 6f61 7428 7329 290a 2020 2020  t(float(s)).    
-00012d80: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00012d90: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00012da0: 2073 0a0a 6465 6620 7061 7273 655f 696e   s..def parse_in
-00012db0: 7465 7276 616c 5f69 6e64 6578 5f63 6f6c  terval_index_col
-00012dc0: 756d 6e28 6466 2c20 636f 6c75 6d6e 3d4e  umn(df, column=N
-00012dd0: 6f6e 652c 2063 6c6f 7365 643d 276c 6566  one, closed='lef
-00012de0: 7427 293a 0a20 2020 2022 2222 2054 7572  t'):.    """ Tur
-00012df0: 6e73 2061 2063 6f6c 756d 6e20 6f66 2073  ns a column of s
-00012e00: 7472 696e 6773 2069 6e20 7468 6520 666f  trings in the fo
-00012e10: 726d 2027 5b30 2e30 2c20 312e 3129 2720  rm '[0.0, 1.1)' 
-00012e20: 696e 746f 2061 203a 6f62 6a3a 6070 616e  into a :obj:`pan
-00012e30: 6461 732e 496e 7465 7276 616c 496e 6465  das.IntervalInde
-00012e40: 7860 2e0a 0a20 2020 2050 6172 616d 6574  x`...    Paramet
-00012e50: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-00012e60: 2d2d 0a20 2020 2064 6620 3a20 3a6f 626a  --.    df : :obj
-00012e70: 3a60 7061 6e64 6173 2e44 6174 6146 7261  :`pandas.DataFra
-00012e80: 6d65 600a 2020 2020 636f 6c75 6d6e 203a  me`.    column :
-00012e90: 203a 6f62 6a3a 6073 7472 602c 206f 7074   :obj:`str`, opt
-00012ea0: 696f 6e61 6c0a 2020 2020 2020 2020 4e61  ional.        Na
-00012eb0: 6d65 206f 6620 7468 6520 636f 6c75 6d6e  me of the column
-00012ec0: 2063 6f6e 7461 696e 696e 6720 7374 7269   containing stri
-00012ed0: 6e67 732e 2049 6620 6e6f 7420 7370 6563  ngs. If not spec
-00012ee0: 6966 6965 642c 2075 7365 2074 6865 2069  ified, use the i
-00012ef0: 6e64 6578 2e0a 2020 2020 636c 6f73 6564  ndex..    closed
-00012f00: 203a 203a 6f62 6a3a 6073 7472 602c 206f   : :obj:`str`, o
-00012f10: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00012f20: 4f6e 2077 686f 7420 7369 6465 2074 6865  On whot side the
-00012f30: 2069 6e74 6572 7661 6c73 2073 686f 756c   intervals shoul
-00012f40: 6420 6265 2063 6c6f 7365 642e 2044 6566  d be closed. Def
-00012f50: 6175 6c74 7320 746f 2027 6c65 6674 272e  aults to 'left'.
-00012f60: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-00012f70: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 3a6f    -------.    :o
-00012f80: 626a 3a60 7061 6e64 6173 2e49 6e74 6572  bj:`pandas.Inter
-00012f90: 7661 6c49 6e64 6578 600a 2020 2020 2222  valIndex`.    ""
-00012fa0: 220a 2020 2020 6976 5f72 6567 6578 203d  ".    iv_regex =
-00012fb0: 2072 225b 5c5b 5c28 5d28 5b30 2d39 5d2a   r"[\[\(]([0-9]*
-00012fc0: 5c2e 5b30 2d39 5d2b 292c 2028 5b30 2d39  \.[0-9]+), ([0-9
-00012fd0: 5d2a 5c2e 5b30 2d39 5d2b 295b 5c29 5c5d  ]*\.[0-9]+)[\)\]
-00012fe0: 5d22 0a20 2020 2069 6620 636f 6c75 6d6e  ]".    if column
-00012ff0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00013000: 2020 6976 5f73 7472 696e 6773 203d 2064    iv_strings = d
-00013010: 662e 696e 6465 780a 2020 2020 656c 7365  f.index.    else
-00013020: 3a0a 2020 2020 2020 2020 6976 5f73 7472  :.        iv_str
-00013030: 696e 6773 203d 2064 665b 636f 6c75 6d6e  ings = df[column
-00013040: 5d0a 2020 2020 7661 6c75 6573 203d 2069  ].    values = i
-00013050: 765f 7374 7269 6e67 732e 7374 722e 6578  v_strings.str.ex
-00013060: 7472 6163 7428 6976 5f72 6567 6578 292e  tract(iv_regex).
-00013070: 6173 7479 7065 2866 6c6f 6174 290a 2020  astype(float).  
-00013080: 2020 6969 7820 3d20 7064 2e49 6e74 6572    iix = pd.Inter
-00013090: 7661 6c49 6e64 6578 2e66 726f 6d5f 6172  valIndex.from_ar
-000130a0: 7261 7973 2876 616c 7565 735b 305d 2c20  rays(values[0], 
-000130b0: 7661 6c75 6573 5b31 5d2c 2063 6c6f 7365  values[1], close
-000130c0: 643d 636c 6f73 6564 290a 2020 2020 7265  d=closed).    re
-000130d0: 7475 726e 2069 6978 0a0a 0a54 5356 5f43  turn iix...TSV_C
-000130e0: 4f4c 554d 4e5f 434f 4e56 4552 5445 5253  OLUMN_CONVERTERS
-000130f0: 203d 207b 0a20 2020 2027 6164 6465 645f   = {.    'added_
-00013100: 746f 6e65 7327 3a20 7374 7232 696e 7474  tones': str2intt
-00013110: 7570 6c65 2c0a 2020 2020 2761 6374 5f64  uple,.    'act_d
-00013120: 7572 273a 2073 6166 655f 6672 6163 2c0a  ur': safe_frac,.
-00013130: 2020 2020 2763 6f6d 706f 7365 645f 656e      'composed_en
-00013140: 6427 3a20 7361 6665 5f69 6e74 2c0a 2020  d': safe_int,.  
-00013150: 2020 2763 6f6d 706f 7365 645f 7374 6172    'composed_star
-00013160: 7427 3a20 7361 6665 5f69 6e74 2c0a 2020  t': safe_int,.  
-00013170: 2020 2763 686f 7264 5f74 6f6e 6573 273a    'chord_tones':
-00013180: 2073 7472 3269 6e74 7475 706c 652c 0a20   str2inttuple,. 
-00013190: 2020 2027 676c 6f62 616c 6b65 795f 6973     'globalkey_is
-000131a0: 5f6d 696e 6f72 273a 2069 6e74 3262 6f6f  _minor': int2boo
-000131b0: 6c2c 0a20 2020 2027 6c6f 6361 6c6b 6579  l,.    'localkey
-000131c0: 5f69 735f 6d69 6e6f 7227 3a20 696e 7432  _is_minor': int2
-000131d0: 626f 6f6c 2c0a 2020 2020 276d 635f 6f66  bool,.    'mc_of
-000131e0: 6673 6574 273a 2073 6166 655f 6672 6163  fset': safe_frac
-000131f0: 2c0a 2020 2020 276d 635f 6f6e 7365 7427  ,.    'mc_onset'
-00013200: 3a20 7361 6665 5f66 7261 632c 0a20 2020  : safe_frac,.   
-00013210: 2027 6d6e 5f6f 6e73 6574 273a 2073 6166   'mn_onset': saf
-00013220: 655f 6672 6163 2c0a 2020 2020 276d 6f76  e_frac,.    'mov
-00013230: 656d 656e 744e 756d 6265 7227 3a20 7361  ementNumber': sa
-00013240: 6665 5f69 6e74 2c0a 2020 2020 276e 6578  fe_int,.    'nex
-00013250: 7427 3a20 7374 7232 696e 7474 7570 6c65  t': str2inttuple
-00013260: 2c0a 2020 2020 276e 6f6d 696e 616c 5f64  ,.    'nominal_d
-00013270: 7572 6174 696f 6e27 3a20 7361 6665 5f66  uration': safe_f
-00013280: 7261 632c 0a20 2020 2027 7175 6172 7465  rac,.    'quarte
-00013290: 7262 6561 7473 273a 2073 6166 655f 6672  rbeats': safe_fr
-000132a0: 6163 2c0a 2020 2020 2771 7561 7274 6572  ac,.    'quarter
-000132b0: 6265 6174 735f 616c 6c5f 656e 6469 6e67  beats_all_ending
-000132c0: 7327 3a20 7361 6665 5f66 7261 632c 0a20  s': safe_frac,. 
-000132d0: 2020 2027 6f6e 7365 7427 3a20 7361 6665     'onset': safe
-000132e0: 5f66 7261 632c 0a20 2020 2027 6475 7261  _frac,.    'dura
-000132f0: 7469 6f6e 273a 2073 6166 655f 6672 6163  tion': safe_frac
-00013300: 2c0a 2020 2020 2773 6361 6c61 7227 3a20  ,.    'scalar': 
-00013310: 7361 6665 5f66 7261 632c 207d 0a0a 5453  safe_frac, }..TS
-00013320: 565f 4454 5950 4553 203d 207b 0a20 2020  V_DTYPES = {.   
-00013330: 2027 6162 736f 6c75 7465 5f62 6173 6527   'absolute_base'
-00013340: 3a20 2749 6e74 3634 272c 0a20 2020 2027  : 'Int64',.    '
-00013350: 6162 736f 6c75 7465 5f72 6f6f 7427 3a20  absolute_root': 
-00013360: 2749 6e74 3634 272c 0a20 2020 2027 616c  'Int64',.    'al
-00013370: 745f 6c61 6265 6c27 3a20 7374 722c 0a20  t_label': str,. 
-00013380: 2020 2027 6261 726c 696e 6527 3a20 7374     'barline': st
-00013390: 722c 0a20 2020 2027 6261 7365 273a 2027  r,.    'base': '
-000133a0: 496e 7436 3427 2c0a 2020 2020 2762 6173  Int64',.    'bas
-000133b0: 735f 6e6f 7465 273a 2027 496e 7436 3427  s_note': 'Int64'
-000133c0: 2c0a 2020 2020 2762 7265 616b 7327 3a20  ,.    'breaks': 
-000133d0: 2773 7472 696e 6727 2c0a 2020 2020 2763  'string',.    'c
-000133e0: 6164 656e 6365 273a 2073 7472 2c0a 2020  adence': str,.  
-000133f0: 2020 2763 6164 656e 6365 735f 6964 273a    'cadences_id':
-00013400: 2027 496e 7436 3427 2c0a 2020 2020 2763   'Int64',.    'c
-00013410: 6861 6e67 6573 273a 2073 7472 2c0a 2020  hanges': str,.  
-00013420: 2020 2763 686f 7264 273a 2073 7472 2c0a    'chord': str,.
-00013430: 2020 2020 2763 686f 7264 5f69 6427 3a20      'chord_id': 
-00013440: 2749 6e74 3634 272c 0a20 2020 2027 6368  'Int64',.    'ch
-00013450: 6f72 645f 7479 7065 273a 2073 7472 2c0a  ord_type': str,.
-00013460: 2020 2020 2763 6f6c 6f72 5f6e 616d 6527      'color_name'
-00013470: 3a20 7374 722c 0a20 2020 2027 636f 6c6f  : str,.    'colo
-00013480: 725f 6874 6d6c 273a 2073 7472 2c0a 2020  r_html': str,.  
-00013490: 2020 2763 6f6c 6f72 5f72 273a 2027 496e    'color_r': 'In
-000134a0: 7436 3427 2c0a 2020 2020 2763 6f6c 6f72  t64',.    'color
-000134b0: 5f67 273a 2027 496e 7436 3427 2c0a 2020  _g': 'Int64',.  
-000134c0: 2020 2763 6f6c 6f72 5f62 273a 2027 496e    'color_b': 'In
-000134d0: 7436 3427 2c0a 2020 2020 2763 6f6c 6f72  t64',.    'color
-000134e0: 5f61 273a 2027 496e 7436 3427 2c0a 2020  _a': 'Int64',.  
-000134f0: 2020 2764 6f6e 745f 636f 756e 7427 3a20    'dont_count': 
-00013500: 2749 6e74 3634 272c 0a20 2020 2027 6475  'Int64',.    'du
-00013510: 7261 7469 6f6e 5f71 6227 3a20 666c 6f61  ration_qb': floa
-00013520: 742c 0a20 2020 2027 6578 7061 6e64 6564  t,.    'expanded
-00013530: 5f69 6427 3a20 2749 6e74 3634 272c 0a20  _id': 'Int64',. 
-00013540: 2020 2027 6669 6762 6173 7327 3a20 7374     'figbass': st
-00013550: 722c 0a20 2020 2027 666f 726d 273a 2073  r,.    'form': s
-00013560: 7472 2c0a 2020 2020 2767 6c6f 6261 6c6b  tr,.    'globalk
-00013570: 6579 273a 2073 7472 2c0a 2020 2020 2767  ey': str,.    'g
-00013580: 7261 6365 6e6f 7465 273a 2073 7472 2c0a  racenote': str,.
-00013590: 2020 2020 2768 6172 6d6f 6e69 6573 5f69      'harmonies_i
-000135a0: 6427 3a20 2749 6e74 3634 272c 0a20 2020  d': 'Int64',.   
-000135b0: 2027 6861 726d 6f6e 795f 6c61 7965 7227   'harmony_layer'
-000135c0: 3a20 7374 722c 0a20 2020 2027 6b65 7973  : str,.    'keys
-000135d0: 6967 273a 2027 496e 7436 3427 2c0a 2020  ig': 'Int64',.  
-000135e0: 2020 276c 6162 656c 273a 2073 7472 2c0a    'label': str,.
-000135f0: 2020 2020 276c 6162 656c 5f74 7970 6527      'label_type'
-00013600: 3a20 7374 722c 0a20 2020 2027 6c65 6674  : str,.    'left
-00013610: 5061 7265 6e27 3a20 7374 722c 0a20 2020  Paren': str,.   
-00013620: 2027 6c6f 6361 6c6b 6579 273a 2073 7472   'localkey': str
-00013630: 2c0a 2020 2020 276d 6172 6b65 7227 3a20  ,.    'marker': 
-00013640: 7374 722c 0a20 2020 2027 6d63 273a 2027  str,.    'mc': '
-00013650: 496e 7436 3427 2c0a 2020 2020 276d 635f  Int64',.    'mc_
-00013660: 706c 6179 7468 726f 7567 6827 3a20 2749  playthrough': 'I
-00013670: 6e74 3634 272c 0a20 2020 2027 6d69 6469  nt64',.    'midi
-00013680: 273a 2027 496e 7436 3427 2c0a 2020 2020  ': 'Int64',.    
-00013690: 276d 6e27 3a20 7374 722c 0a20 2020 2027  'mn': str,.    '
-000136a0: 6e61 6d65 273a 2073 7472 2c0a 2020 2020  name': str,.    
-000136b0: 276f 6666 7365 743a 7827 3a20 7374 722c  'offset:x': str,
-000136c0: 0a20 2020 2027 6f66 6673 6574 5f78 273a  .    'offset_x':
-000136d0: 2073 7472 2c0a 2020 2020 276f 6666 7365   str,.    'offse
-000136e0: 743a 7927 3a20 7374 722c 0a20 2020 2027  t:y': str,.    '
-000136f0: 6f66 6673 6574 5f79 273a 2073 7472 2c0a  offset_y': str,.
-00013700: 2020 2020 276e 6173 6876 696c 6c65 273a      'nashville':
-00013710: 2027 496e 7436 3427 2c0a 2020 2020 276e   'Int64',.    'n
-00013720: 6f74 6573 5f69 6427 3a20 2749 6e74 3634  otes_id': 'Int64
-00013730: 272c 0a20 2020 2027 6e75 6d62 6572 696e  ',.    'numberin
-00013740: 675f 6f66 6673 6574 273a 2027 496e 7436  g_offset': 'Int6
-00013750: 3427 2c0a 2020 2020 276e 756d 6572 616c  4',.    'numeral
-00013760: 273a 2073 7472 2c0a 2020 2020 276f 6374  ': str,.    'oct
-00013770: 6176 6527 3a20 2749 6e74 3634 272c 0a20  ave': 'Int64',. 
-00013780: 2020 2027 7065 6461 6c27 3a20 7374 722c     'pedal': str,
-00013790: 0a20 2020 2027 706c 6179 7468 726f 7567  .    'playthroug
-000137a0: 6827 3a20 2749 6e74 3634 272c 0a20 2020  h': 'Int64',.   
-000137b0: 2027 7068 7261 7365 656e 6427 3a20 7374   'phraseend': st
-000137c0: 722c 0a20 2020 2027 7265 6765 785f 6d61  r,.    'regex_ma
-000137d0: 7463 6827 3a20 7374 722c 0a20 2020 2027  tch': str,.    '
-000137e0: 7265 6c61 7469 7665 726f 6f74 273a 2073  relativeroot': s
-000137f0: 7472 2c0a 2020 2020 2772 6570 6561 7473  tr,.    'repeats
-00013800: 273a 2073 7472 2c0a 2020 2020 2772 6967  ': str,.    'rig
-00013810: 6874 5061 7265 6e27 3a20 7374 722c 0a20  htParen': str,. 
-00013820: 2020 2027 726f 6f74 273a 2027 496e 7436     'root': 'Int6
-00013830: 3427 2c0a 2020 2020 2772 6f6f 7443 6173  4',.    'rootCas
-00013840: 6527 3a20 2749 6e74 3634 272c 0a20 2020  e': 'Int64',.   
-00013850: 2027 736c 7572 273a 2073 7472 2c0a 2020   'slur': str,.  
-00013860: 2020 2773 7065 6369 616c 273a 2073 7472    'special': str
-00013870: 2c0a 2020 2020 2773 7461 6666 273a 2027  ,.    'staff': '
-00013880: 496e 7436 3427 2c0a 2020 2020 2774 6965  Int64',.    'tie
-00013890: 6427 3a20 2749 6e74 3634 272c 0a20 2020  d': 'Int64',.   
-000138a0: 2027 7469 6d65 7369 6727 3a20 7374 722c   'timesig': str,
-000138b0: 0a20 2020 2027 7470 6327 3a20 2749 6e74  .    'tpc': 'Int
-000138c0: 3634 272c 0a20 2020 2027 766f 6963 6527  64',.    'voice'
-000138d0: 3a20 2749 6e74 3634 272c 0a20 2020 2027  : 'Int64',.    '
-000138e0: 766f 6963 6573 273a 2027 496e 7436 3427  voices': 'Int64'
-000138f0: 2c0a 2020 2020 2776 6f6c 7461 273a 2027  ,.    'volta': '
-00013900: 496e 7436 3427 2c0a 2020 2020 2776 6f6c  Int64',.    'vol
-00013910: 7461 5f6d 6373 273a 206f 626a 6563 742c  ta_mcs': object,
-00013920: 0a7d 0a0a 6465 6620 6c6f 6164 5f74 7376  .}..def load_tsv
-00013930: 2870 6174 682c 0a20 2020 2020 2020 2020  (path,.         
-00013940: 2020 2020 696e 6465 785f 636f 6c3d 4e6f      index_col=No
-00013950: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00013960: 2073 6570 3d27 5c74 272c 0a20 2020 2020   sep='\t',.     
-00013970: 2020 2020 2020 2020 636f 6e76 6572 7465          converte
-00013980: 7273 3d7b 7d2c 0a20 2020 2020 2020 2020  rs={},.         
-00013990: 2020 2020 6474 7970 653d 7b7d 2c0a 2020      dtype={},.  
-000139a0: 2020 2020 2020 2020 2020 2073 7472 696e             strin
-000139b0: 6774 7970 653d 4661 6c73 652c 0a20 2020  gtype=False,.   
-000139c0: 2020 2020 2020 2020 2020 2a2a 6b77 6172            **kwar
-000139d0: 6773 2920 2d3e 204f 7074 696f 6e61 6c5b  gs) -> Optional[
-000139e0: 7064 2e44 6174 6146 7261 6d65 5d3a 0a20  pd.DataFrame]:. 
-000139f0: 2020 2022 2222 204c 6f61 6473 2074 6865     """ Loads the
-00013a00: 2054 5356 2066 696c 6520 6070 6174 6860   TSV file `path`
-00013a10: 2077 6869 6c65 2061 7070 6c79 696e 6720   while applying 
-00013a20: 636f 7272 6563 7420 7479 7065 2063 6f6e  correct type con
-00013a30: 7665 7273 696f 6e20 616e 6420 7061 7273  version and pars
-00013a40: 696e 6720 7475 706c 6573 2e0a 0a20 2020  ing tuples...   
-00013a50: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00013a60: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2070  ----------.    p
-00013a70: 6174 6820 3a20 3a6f 626a 3a60 7374 7260  ath : :obj:`str`
-00013a80: 0a20 2020 2020 2020 2050 6174 6820 746f  .        Path to
-00013a90: 2061 2054 5356 2066 696c 6520 6173 206f   a TSV file as o
-00013aa0: 7574 7075 7420 6279 2066 6f72 6d61 745f  utput by format_
-00013ab0: 6461 7461 2829 2e0a 2020 2020 696e 6465  data()..    inde
-00013ac0: 785f 636f 6c20 3a20 3a6f 626a 3a60 6c69  x_col : :obj:`li
-00013ad0: 7374 602c 206f 7074 696f 6e61 6c0a 2020  st`, optional.  
-00013ae0: 2020 2020 2020 4279 2064 6566 6175 6c74        By default
-00013af0: 2c20 7468 6520 6669 7273 7420 7477 6f20  , the first two 
-00013b00: 636f 6c75 6d6e 7320 6172 6520 6c6f 6164  columns are load
-00013b10: 6564 2061 7320 4d75 6c74 6949 6e64 6578  ed as MultiIndex
-00013b20: 2e0a 2020 2020 2020 2020 5468 6520 6669  ..        The fi
-00013b30: 7273 7420 6c65 7665 6c20 6469 7374 696e  rst level distin
-00013b40: 6775 6973 6865 7320 7069 6563 6573 2061  guishes pieces a
-00013b50: 6e64 2074 6865 2073 6563 6f6e 6420 6c65  nd the second le
-00013b60: 7665 6c20 7468 6520 656c 656d 656e 7473  vel the elements
-00013b70: 2077 6974 6869 6e2e 0a20 2020 2063 6f6e   within..    con
-00013b80: 7665 7274 6572 732c 2064 7479 7065 203a  verters, dtype :
-00013b90: 203a 6f62 6a3a 6064 6963 7460 2c20 6f70   :obj:`dict`, op
-00013ba0: 7469 6f6e 616c 0a20 2020 2020 2020 2045  tional.        E
-00013bb0: 6e68 616e 6365 7320 6f72 206f 7665 7277  nhances or overw
-00013bc0: 7269 7465 7320 7468 6520 6d61 7070 696e  rites the mappin
-00013bd0: 6720 6672 6f6d 2063 6f6c 756d 6e20 6e61  g from column na
-00013be0: 6d65 7320 746f 2074 7970 6573 2069 6e63  mes to types inc
-00013bf0: 6c75 6465 6420 7468 6520 636f 6e73 7461  luded the consta
-00013c00: 6e74 732e 0a20 2020 2073 7472 696e 6774  nts..    stringt
-00013c10: 7970 6520 3a20 3a6f 626a 3a60 626f 6f6c  ype : :obj:`bool
-00013c20: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
-00013c30: 2020 2020 4966 2079 6f75 2772 6520 7573      If you're us
-00013c40: 696e 6720 7061 6e64 6173 203e 3d20 312e  ing pandas >= 1.
-00013c50: 302e 3020 796f 7520 6d69 6768 7420 7761  0.0 you might wa
-00013c60: 6e74 2074 6f20 7365 7420 7468 6973 2074  nt to set this t
-00013c70: 6f20 5472 7565 2069 6e20 6f72 6465 720a  o True in order.
-00013c80: 2020 2020 2020 2020 746f 2062 6520 7573          to be us
-00013c90: 696e 6720 7468 6520 6e65 7720 6073 7472  ing the new `str
-00013ca0: 696e 6760 2064 6174 6174 7970 6520 7468  ing` datatype th
-00013cb0: 6174 2069 6e63 6c75 6465 7320 7468 6520  at includes the 
-00013cc0: 6e65 7720 6e75 6c6c 2074 7970 6520 6070  new null type `p
-00013cd0: 642e 4e41 602e 0a20 2020 2022 2222 0a0a  d.NA`..    """..
-00013ce0: 2020 2020 676c 6f62 616c 2054 5356 5f43      global TSV_C
-00013cf0: 4f4c 554d 4e5f 434f 4e56 4552 5445 5253  OLUMN_CONVERTERS
-00013d00: 2c20 5453 565f 4454 5950 4553 0a0a 2020  , TSV_DTYPES..  
-00013d10: 2020 6966 2063 6f6e 7665 7274 6572 7320    if converters 
-00013d20: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00013d30: 2063 6f6e 7620 3d20 4e6f 6e65 0a20 2020   conv = None.   
-00013d40: 2065 6c73 653a 0a20 2020 2020 2020 2063   else:.        c
-00013d50: 6f6e 7620 3d20 6469 6374 2854 5356 5f43  onv = dict(TSV_C
-00013d60: 4f4c 554d 4e5f 434f 4e56 4552 5445 5253  OLUMN_CONVERTERS
-00013d70: 290a 2020 2020 2020 2020 636f 6e76 2e75  ).        conv.u
-00013d80: 7064 6174 6528 636f 6e76 6572 7465 7273  pdate(converters
-00013d90: 290a 0a20 2020 2069 6620 6474 7970 6520  )..    if dtype 
-00013da0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00013db0: 2074 7970 6573 203d 204e 6f6e 650a 2020   types = None.  
-00013dc0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00013dd0: 6528 6474 7970 652c 2073 7472 293a 0a20  e(dtype, str):. 
-00013de0: 2020 2020 2020 2074 7970 6573 203d 2064         types = d
-00013df0: 7479 7065 0a20 2020 2065 6c73 653a 0a20  type.    else:. 
-00013e00: 2020 2020 2020 2074 7970 6573 203d 2064         types = d
-00013e10: 6963 7428 5453 565f 4454 5950 4553 290a  ict(TSV_DTYPES).
-00013e20: 2020 2020 2020 2020 7479 7065 732e 7570          types.up
-00013e30: 6461 7465 2864 7479 7065 290a 0a20 2020  date(dtype)..   
-00013e40: 2069 6620 7374 7269 6e67 7479 7065 3a0a   if stringtype:.
-00013e50: 2020 2020 2020 2020 7479 7065 7320 3d20          types = 
-00013e60: 7b63 6f6c 3a20 2773 7472 696e 6727 2069  {col: 'string' i
-00013e70: 6620 7479 7020 3d3d 2073 7472 2065 6c73  f typ == str els
-00013e80: 6520 7479 7020 666f 7220 636f 6c2c 2074  e typ for col, t
-00013e90: 7970 2069 6e20 7479 7065 732e 6974 656d  yp in types.item
-00013ea0: 7328 297d 0a20 2020 2074 7279 3a0a 2020  s()}.    try:.  
-00013eb0: 2020 2020 2020 6466 203d 2070 642e 7265        df = pd.re
-00013ec0: 6164 5f63 7376 2870 6174 682c 2073 6570  ad_csv(path, sep
-00013ed0: 3d73 6570 2c20 696e 6465 785f 636f 6c3d  =sep, index_col=
-00013ee0: 696e 6465 785f 636f 6c2c 0a20 2020 2020  index_col,.     
-00013ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f00: 2020 2020 2020 6474 7970 653d 7479 7065        dtype=type
-00013f10: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00013f20: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00013f30: 6e76 6572 7465 7273 3d63 6f6e 762c 202a  nverters=conv, *
-00013f40: 2a6b 7761 7267 7329 0a20 2020 2065 7863  *kwargs).    exc
-00013f50: 6570 7420 456d 7074 7944 6174 6145 7272  ept EmptyDataErr
-00013f60: 6f72 3a0a 2020 2020 2020 2020 7265 7475  or:.        retu
-00013f70: 726e 0a20 2020 2069 6620 276d 6e27 2069  rn.    if 'mn' i
-00013f80: 6e20 6466 3a0a 2020 2020 2020 2020 6d6e  n df:.        mn
-00013f90: 5f76 6f6c 7461 203d 206d 6e32 696e 7428  _volta = mn2int(
-00013fa0: 6466 2e6d 6e29 0a20 2020 2020 2020 2064  df.mn).        d
-00013fb0: 662e 6d6e 203d 206d 6e5f 766f 6c74 612e  f.mn = mn_volta.
-00013fc0: 6d6e 0a20 2020 2020 2020 2069 6620 6d6e  mn.        if mn
-00013fd0: 5f76 6f6c 7461 2e76 6f6c 7461 2e6e 6f74  _volta.volta.not
-00013fe0: 6e61 2829 2e61 6e79 2829 3a0a 2020 2020  na().any():.    
-00013ff0: 2020 2020 2020 2020 6966 2027 766f 6c74          if 'volt
-00014000: 6127 206e 6f74 2069 6e20 6466 2e63 6f6c  a' not in df.col
-00014010: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-00014020: 2020 2020 2020 6466 5b27 766f 6c74 6127        df['volta'
-00014030: 5d20 3d20 7064 2e53 6572 6965 7328 7064  ] = pd.Series(pd
-00014040: 2e4e 412c 2069 6e64 6578 3d64 662e 696e  .NA, index=df.in
-00014050: 6465 7829 2e61 7374 7970 6528 2749 6e74  dex).astype('Int
-00014060: 3634 2729 0a20 2020 2020 2020 2020 2020  64').           
-00014070: 2064 662e 766f 6c74 612e 6669 6c6c 6e61   df.volta.fillna
-00014080: 286d 6e5f 766f 6c74 612e 766f 6c74 612c  (mn_volta.volta,
-00014090: 2069 6e70 6c61 6365 3d54 7275 6529 0a20   inplace=True). 
-000140a0: 2020 2069 6620 2769 6e74 6572 7661 6c27     if 'interval'
-000140b0: 2069 6e20 6466 3a0a 2020 2020 2020 2020   in df:.        
-000140c0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-000140d0: 2069 765f 696e 6465 7820 3d20 7061 7273   iv_index = pars
-000140e0: 655f 696e 7465 7276 616c 5f69 6e64 6578  e_interval_index
-000140f0: 5f63 6f6c 756d 6e28 6466 2c20 2769 6e74  _column(df, 'int
-00014100: 6572 7661 6c27 290a 2020 2020 2020 2020  erval').        
-00014110: 2020 2020 6466 2e69 6e64 6578 203d 2069      df.index = i
-00014120: 765f 696e 6465 780a 2020 2020 2020 2020  v_index.        
-00014130: 2020 2020 6466 203d 2064 662e 6472 6f70      df = df.drop
-00014140: 2863 6f6c 756d 6e73 3d27 696e 7465 7276  (columns='interv
-00014150: 616c 2729 0a20 2020 2020 2020 2065 7863  al').        exc
-00014160: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00014170: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00014180: 2020 2020 7265 7475 726e 2064 660a 0a0a      return df...
-00014190: 406c 7275 5f63 6163 6865 2829 0a64 6566  @lru_cache().def
-000141a0: 2074 7376 5f63 6f6c 756d 6e32 6461 7461   tsv_column2data
-000141b0: 7479 7065 2829 3a0a 2020 2020 6d61 7070  type():.    mapp
-000141c0: 696e 6720 3d20 6465 6661 756c 7464 6963  ing = defaultdic
-000141d0: 7428 6c61 6d62 6461 3a20 2773 7472 696e  t(lambda: 'strin
-000141e0: 6727 290a 2020 2020 6d61 7070 696e 672e  g').    mapping.
-000141f0: 7570 6461 7465 287b 0a20 2020 2020 2020  update({.       
-00014200: 2027 496e 7436 3427 3a20 2769 6e74 6567   'Int64': 'integ
-00014210: 6572 272c 0a20 2020 2020 2020 2073 7472  er',.        str
-00014220: 3a20 2773 7472 696e 6727 2c0a 2020 2020  : 'string',.    
-00014230: 2020 2020 2773 7472 696e 6727 3a20 2773      'string': 's
-00014240: 7472 696e 6727 2c0a 2020 2020 2020 2020  tring',.        
-00014250: 666c 6f61 743a 2027 666c 6f61 7427 2c0a  float: 'float',.
-00014260: 2020 2020 2020 2020 696e 743a 2027 696e          int: 'in
-00014270: 7465 6765 7227 2c0a 2020 2020 2020 2020  teger',.        
-00014280: 696e 7432 626f 6f6c 3a20 2762 6f6f 6c65  int2bool: 'boole
-00014290: 616e 272c 0a20 2020 2020 2020 2073 6166  an',.        saf
-000142a0: 655f 6672 6163 3a20 7b22 6261 7365 223a  e_frac: {"base":
-000142b0: 2022 7374 7269 6e67 222c 2022 666f 726d   "string", "form
-000142c0: 6174 223a 2072 222d 3f5c 642b 283f 3a5c  at": r"-?\d+(?:\
-000142d0: 2f5c 642b 293f 227d 2c0a 2020 2020 2020  /\d+)?"},.      
-000142e0: 2020 7361 6665 5f69 6e74 3a20 2769 6e74    safe_int: 'int
-000142f0: 6567 6572 272c 0a20 2020 2020 2020 2073  eger',.        s
-00014300: 7472 3269 6e74 7475 706c 653a 207b 2262  tr2inttuple: {"b
-00014310: 6173 6522 3a20 2273 7472 696e 6722 2c20  ase": "string", 
-00014320: 2266 6f72 6d61 7422 3a20 7222 5c28 2d3f  "format": r"\(-?
-00014330: 5c64 2b2c 203f 2d3f 5c64 2b5c 2922 7d2c  \d+, ?-?\d+\)"},
-00014340: 0a20 2020 207d 290a 2020 2020 636f 6c75  .    }).    colu
-00014350: 6d6e 3264 6174 6174 7970 6520 3d20 7b63  mn2datatype = {c
-00014360: 6f6c 3a20 6d61 7070 696e 675b 6474 7970  ol: mapping[dtyp
-00014370: 655d 2066 6f72 2063 6f6c 2c20 6474 7970  e] for col, dtyp
-00014380: 6520 696e 2054 5356 5f43 4f4c 554d 4e5f  e in TSV_COLUMN_
-00014390: 434f 4e56 4552 5445 5253 2e69 7465 6d73  CONVERTERS.items
-000143a0: 2829 7d0a 2020 2020 636f 6c75 6d6e 3264  ()}.    column2d
-000143b0: 6174 6174 7970 652e 7570 6461 7465 287b  atatype.update({
-000143c0: 636f 6c3a 206d 6170 7069 6e67 5b64 7479  col: mapping[dty
-000143d0: 7065 5d20 666f 7220 636f 6c2c 2064 7479  pe] for col, dty
-000143e0: 7065 2069 6e20 5453 565f 4454 5950 4553  pe in TSV_DTYPES
-000143f0: 2e69 7465 6d73 2829 7d29 0a20 2020 2072  .items()}).    r
-00014400: 6574 7572 6e20 636f 6c75 6d6e 3264 6174  eturn column2dat
-00014410: 6174 7970 650a 0a0a 406c 7275 5f63 6163  atype...@lru_cac
-00014420: 6865 2829 0a64 6566 2074 7376 5f63 6f6c  he().def tsv_col
-00014430: 756d 6e32 6465 7363 7269 7074 696f 6e28  umn2description(
-00014440: 636f 6c3a 2073 7472 2920 2d3e 204f 7074  col: str) -> Opt
-00014450: 696f 6e61 6c5b 7374 725d 3a0a 2020 2020  ional[str]:.    
-00014460: 6d61 7070 696e 6720 3d20 7b0a 2020 2020  mapping = {.    
-00014470: 2020 2020 276d 6327 3a20 274d 6561 7375      'mc': 'Measu
-00014480: 7265 2063 6f75 6e74 2e27 2c0a 2020 2020  re count.',.    
-00014490: 2020 2020 276d 6e27 3a20 274d 6561 7375      'mn': 'Measu
-000144a0: 7265 206e 756d 6265 722e 272c 0a20 2020  re number.',.   
-000144b0: 2020 2020 2027 6d63 5f6f 6e73 6574 273a       'mc_onset':
-000144c0: 2022 416e 2065 7665 6e74 2773 2064 6973   "An event's dis
-000144d0: 7461 6e63 6520 2866 7261 6374 696f 6e20  tance (fraction 
-000144e0: 6f66 2061 2077 686f 6c65 206e 6f74 6529  of a whole note)
-000144f0: 2066 726f 6d20 7468 6520 6265 6769 6e6e   from the beginn
-00014500: 696e 6720 6f66 2074 6865 204d 432e 222c  ing of the MC.",
-00014510: 0a20 2020 2020 2020 2027 6d6e 5f6f 6e73  .        'mn_ons
-00014520: 6574 273a 2022 416e 2065 7665 6e74 2773  et': "An event's
-00014530: 2064 6973 7461 6e63 6520 2866 7261 6374   distance (fract
-00014540: 696f 6e20 6f66 2061 2077 686f 6c65 206e  ion of a whole n
-00014550: 6f74 6529 2066 726f 6d20 7468 6520 6265  ote) from the be
-00014560: 6769 6e6e 696e 6720 6f66 2074 6865 204d  ginning of the M
-00014570: 4e2e 222c 0a20 2020 207d 0a20 2020 2069  N.",.    }.    i
-00014580: 6620 636f 6c20 696e 206d 6170 7069 6e67  f col in mapping
-00014590: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000145a0: 206d 6170 7069 6e67 5b63 6f6c 5d0a 0a0a   mapping[col]...
-000145b0: 406c 7275 5f63 6163 6865 2829 0a64 6566  @lru_cache().def
-000145c0: 2074 7376 5f63 6f6c 756d 6e32 7363 6865   tsv_column2sche
-000145d0: 6d61 2863 6f6c 3a20 7374 7229 202d 3e20  ma(col: str) -> 
-000145e0: 6469 6374 3a0a 2020 2020 7265 7375 6c74  dict:.    result
-000145f0: 203d 207b 0a20 2020 2020 2020 2022 7469   = {.        "ti
-00014600: 746c 6573 223a 2063 6f6c 2c0a 2020 2020  tles": col,.    
-00014610: 7d0a 2020 2020 636f 6c75 6d6e 3274 7970  }.    column2typ
-00014620: 6520 3d20 7473 765f 636f 6c75 6d6e 3264  e = tsv_column2d
-00014630: 6174 6174 7970 6528 290a 2020 2020 6966  atatype().    if
-00014640: 2063 6f6c 2069 6e20 636f 6c75 6d6e 3274   col in column2t
-00014650: 7970 653a 0a20 2020 2020 2020 2072 6573  ype:.        res
-00014660: 756c 745b 2264 6174 6174 7970 6522 5d20  ult["datatype"] 
-00014670: 3d20 636f 6c75 6d6e 3274 7970 655b 636f  = column2type[co
-00014680: 6c5d 0a20 2020 2064 6573 6372 6970 7469  l].    descripti
-00014690: 6f6e 203d 2074 7376 5f63 6f6c 756d 6e32  on = tsv_column2
-000146a0: 6465 7363 7269 7074 696f 6e28 636f 6c29  description(col)
-000146b0: 0a20 2020 2069 6620 6465 7363 7269 7074  .    if descript
-000146c0: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
-000146d0: 0a20 2020 2020 2020 2072 6573 756c 745b  .        result[
-000146e0: 2264 633a 6465 7363 7269 7074 696f 6e22  "dc:description"
-000146f0: 5d20 3d20 6465 7363 7269 7074 696f 6e0a  ] = description.
-00014700: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-00014710: 740a 0a0a 6465 6620 6d61 6b65 5f63 7376  t...def make_csv
-00014720: 775f 6a73 6f6e 6c64 2874 6974 6c65 3a20  w_jsonld(title: 
-00014730: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
-00014740: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00014750: 733a 2043 6f6c 6c65 6374 696f 6e5b 7374  s: Collection[st
-00014760: 725d 2c0a 2020 2020 2020 2020 2020 2020  r],.            
-00014770: 2020 2020 2020 2020 2075 726c 733a 2055           urls: U
-00014780: 6e69 6f6e 5b73 7472 2c20 436f 6c6c 6563  nion[str, Collec
-00014790: 7469 6f6e 5b73 7472 5d5d 2c0a 2020 2020  tion[str]],.    
-000147a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147b0: 2064 6573 6372 6970 7469 6f6e 3a20 4f70   description: Op
-000147c0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-000147d0: 6e65 2920 2d3e 2064 6963 743a 0a20 2020  ne) -> dict:.   
-000147e0: 2022 2222 5733 4327 7320 4353 5620 6f6e   """W3C's CSV on
-000147f0: 2074 6865 2057 6562 2050 7269 6d65 723a   the Web Primer:
-00014800: 2068 7474 7073 3a2f 2f77 7777 2e77 332e   https://www.w3.
-00014810: 6f72 672f 5452 2f74 6162 756c 6172 2d64  org/TR/tabular-d
-00014820: 6174 612d 7072 696d 6572 2f22 2222 0a20  ata-primer/""". 
-00014830: 2020 2072 6573 756c 7420 3d20 7b0a 2020     result = {.  
-00014840: 2020 2020 2020 2240 636f 6e74 6578 7422        "@context"
-00014850: 3a20 5b22 6874 7470 3a2f 2f77 7777 2e77  : ["http://www.w
-00014860: 332e 6f72 672f 6e73 2f63 7376 7723 222c  3.org/ns/csvw#",
-00014870: 207b 2240 6c61 6e67 7561 6765 223a 2022   {"@language": "
-00014880: 656e 2022 7d5d 2c0a 2020 2020 2020 2020  en "}],.        
-00014890: 2264 633a 7469 746c 6522 3a20 7469 746c  "dc:title": titl
-000148a0: 652c 0a20 2020 2020 2020 2022 6469 616c  e,.        "dial
-000148b0: 6563 7422 3a20 7b0a 2020 2020 2020 2020  ect": {.        
-000148c0: 2020 2020 2264 656c 696d 6974 6572 223a      "delimiter":
-000148d0: 2022 5c74 222c 0a20 2020 2020 2020 207d   "\t",.        }
-000148e0: 0a20 2020 207d 0a20 2020 2069 6620 6465  .    }.    if de
-000148f0: 7363 7269 7074 696f 6e20 6973 206e 6f74  scription is not
-00014900: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
-00014910: 6573 756c 745b 2264 633a 6465 7363 7269  esult["dc:descri
-00014920: 7074 696f 6e22 5d20 3d20 6465 7363 7269  ption"] = descri
-00014930: 7074 696f 6e0a 2020 2020 7265 7375 6c74  ption.    result
-00014940: 5b22 6463 3a63 7265 6174 6564 225d 203d  ["dc:created"] =
-00014950: 2064 6174 6574 696d 652e 6e6f 7728 292e   datetime.now().
-00014960: 7265 706c 6163 6528 6d69 6372 6f73 6563  replace(microsec
-00014970: 6f6e 643d 3029 2e69 736f 666f 726d 6174  ond=0).isoformat
-00014980: 2829 0a20 2020 2072 6573 756c 745b 2264  ().    result["d
-00014990: 633a 6372 6561 746f 7222 5d20 3d20 5b7b  c:creator"] = [{
-000149a0: 0a20 2020 2020 2020 2022 4063 6f6e 7465  .        "@conte
-000149b0: 7874 223a 2022 6874 7470 733a 2f2f 7363  xt": "https://sc
-000149c0: 6865 6d61 2e6f 7267 2f22 2c0a 2020 2020  hema.org/",.    
-000149d0: 2020 2020 2240 7479 7065 223a 2022 536f      "@type": "So
-000149e0: 6674 7761 7265 4170 706c 6963 6174 696f  ftwareApplicatio
-000149f0: 6e22 2c0a 2020 2020 2020 2020 2240 6964  n",.        "@id
-00014a00: 223a 2022 6874 7470 733a 2f2f 6769 7468  ": "https://gith
-00014a10: 7562 2e63 6f6d 2f6a 6f68 656e 7473 6368  ub.com/johentsch
-00014a20: 2f6d 7333 222c 0a20 2020 2020 2020 2022  /ms3",.        "
-00014a30: 6e61 6d65 223a 2022 6d73 3322 2c0a 2020  name": "ms3",.  
-00014a40: 2020 2020 2020 2264 6573 6372 6970 7469        "descripti
-00014a50: 6f6e 223a 2022 4120 7061 7273 6572 2066  on": "A parser f
-00014a60: 6f72 204d 7573 6553 636f 7265 2033 2066  or MuseScore 3 f
-00014a70: 696c 6573 2e22 2c0a 2020 2020 2020 2020  iles.",.        
-00014a80: 2261 7574 686f 7222 3a20 7b22 6e61 6d65  "author": {"name
-00014a90: 223a 2022 4a6f 6861 6e6e 6573 2048 656e  ": "Johannes Hen
-00014aa0: 7473 6368 656c 222c 0a20 2020 2020 2020  tschel",.       
-00014ab0: 2020 2020 2020 2020 2020 2020 2240 6964              "@id
-00014ac0: 223a 2022 6874 7470 733a 2f2f 6f72 6369  ": "https://orci
-00014ad0: 642e 6f72 672f 3030 3030 2d30 3030 322d  d.org/0000-0002-
-00014ae0: 3139 3836 2d39 3534 3522 2c0a 2020 2020  1986-9545",.    
-00014af0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00014b00: 2c0a 2020 2020 2020 2020 2273 6f66 7477  ,.        "softw
-00014b10: 6172 6556 6572 7369 6f6e 223a 204d 5333  areVersion": MS3
-00014b20: 5f56 4552 5349 4f4e 2c0a 2020 2020 7d5d  _VERSION,.    }]
-00014b30: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00014b40: 6365 2875 726c 732c 2073 7472 293a 0a20  ce(urls, str):. 
-00014b50: 2020 2020 2020 2072 6573 756c 745b 2275         result["u
-00014b60: 726c 225d 203d 2075 726c 732c 0a20 2020  rl"] = urls,.   
-00014b70: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
-00014b80: 6573 756c 745b 2274 6162 6c65 7322 5d20  esult["tables"] 
-00014b90: 3d20 5b7b 2275 726c 223a 2070 7d20 666f  = [{"url": p} fo
-00014ba0: 7220 7020 696e 2075 726c 735d 0a20 2020  r p in urls].   
-00014bb0: 2072 6573 756c 745b 2274 6162 6c65 5363   result["tableSc
-00014bc0: 6865 6d61 225d 203d 207b 0a20 2020 2020  hema"] = {.     
-00014bd0: 2020 2022 636f 6c75 6d6e 7322 3a20 5b74     "columns": [t
-00014be0: 7376 5f63 6f6c 756d 6e32 7363 6865 6d61  sv_column2schema
-00014bf0: 2863 6f6c 2920 666f 7220 636f 6c20 696e  (col) for col in
-00014c00: 2063 6f6c 756d 6e73 5d0a 2020 2020 7d0a   columns].    }.
-00014c10: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-00014c20: 740a 0a64 6566 2073 746f 7265 5f63 7376  t..def store_csv
-00014c30: 775f 6a73 6f6e 6c64 2863 6f72 7075 733a  w_jsonld(corpus:
-00014c40: 2073 7472 2c0a 2020 2020 2020 2020 2020   str,.          
-00014c50: 2020 2020 2020 2020 2020 2020 666f 6c64              fold
-00014c60: 6572 3a20 7374 722c 0a20 2020 2020 2020  er: str,.       
-00014c70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00014c80: 6163 6574 3a20 7374 722c 0a20 2020 2020  acet: str,.     
-00014c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ca0: 2063 6f6c 756d 6e73 3a20 436f 6c6c 6563   columns: Collec
-00014cb0: 7469 6f6e 5b73 7472 5d2c 0a20 2020 2020  tion[str],.     
-00014cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014cd0: 2066 696c 6573 3a20 556e 696f 6e5b 7374   files: Union[st
-00014ce0: 722c 2043 6f6c 6c65 6374 696f 6e5b 7374  r, Collection[st
-00014cf0: 725d 5d29 202d 3e20 7374 723a 0a20 2020  r]]) -> str:.   
-00014d00: 2074 6974 6c65 7320 3d20 7b0a 2020 2020   titles = {.    
-00014d10: 2020 2020 2265 7870 616e 6465 6422 3a20      "expanded": 
-00014d20: 2244 434d 4c20 6861 726d 6f6e 7920 616e  "DCML harmony an
-00014d30: 6e6f 7461 7469 6f6e 7322 2c0a 2020 2020  notations",.    
-00014d40: 2020 2020 226d 6561 7375 7265 7322 3a20      "measures": 
-00014d50: 224d 6561 7375 7265 2074 6162 6c65 7322  "Measure tables"
-00014d60: 2c0a 2020 2020 2020 2020 226e 6f74 6573  ,.        "notes
-00014d70: 223a 2022 4e6f 7465 2074 6162 6c65 7322  ": "Note tables"
-00014d80: 2c0a 0a20 2020 207d 0a20 2020 2064 6573  ,..    }.    des
-00014d90: 6372 6970 7469 6f6e 7320 3d20 7b0a 2020  criptions = {.  
-00014da0: 2020 2020 2020 2265 7870 616e 6465 6422        "expanded"
-00014db0: 3a20 224f 6e65 2066 6561 7475 7265 206d  : "One feature m
-00014dc0: 6174 7269 7820 7065 7220 7363 6f72 652c  atrix per score,
-00014dd0: 2063 6f6e 7461 696e 696e 6720 6f6e 6520   containing one 
-00014de0: 6c69 6e65 2070 6572 206c 6162 656c 2e20  line per label. 
-00014df0: 5468 6520 6669 7273 7420 636f 6c75 6d6e  The first column
-00014e00: 7320 2875 6e74 696c 2027 6c61 6265 6c27  s (until 'label'
-00014e10: 2920 220a 2020 2020 2020 2020 2020 2020  ) ".            
-00014e20: 2020 2020 2020 2020 2261 7265 2074 6865          "are the
-00014e30: 2073 616d 6520 6173 2069 6e20 6578 7472   same as in extr
-00014e40: 6163 7465 6420 276c 6162 656c 7327 2074  acted 'labels' t
-00014e50: 6162 6c65 7320 7769 7468 2074 6865 2064  ables with the d
-00014e60: 6966 6665 7265 6e63 6520 7468 6174 206f  ifference that o
-00014e70: 6e6c 7920 7468 6f73 6520 6861 726d 6f6e  nly those harmon
-00014e80: 7920 6c61 6265 6c73 2022 0a20 2020 2020  y labels ".     
-00014e90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014ea0: 7468 6174 206d 6174 6368 2074 6865 2044  that match the D
-00014eb0: 434d 4c20 6861 726d 6f6e 7920 616e 6e6f  CML harmony anno
-00014ec0: 7461 7469 6f6e 2073 7461 6e64 6172 6420  tation standard 
-00014ed0: 2864 636d 6c61 622e 6769 7468 7562 2e69  (dcmlab.github.i
-00014ee0: 6f2f 7374 616e 6461 7264 7329 2061 7265  o/standards) are
-00014ef0: 2069 6e63 6c75 6465 642e 2053 696e 6365   included. Since
-00014f00: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00014f10: 2020 2020 2020 2022 7468 6573 6520 666f         "these fo
-00014f20: 6c6c 6f77 2061 2073 7065 6369 6669 6320  llow a specific 
-00014f30: 7379 6e74 6178 2c20 7468 6579 2063 616e  syntax, they can
-00014f40: 2062 6520 7370 6c69 7420 696e 746f 2074   be split into t
-00014f50: 6865 6972 2063 6f6d 706f 6e65 6e74 7320  heir components 
-00014f60: 2866 6561 7475 7265 7329 2061 6e64 2074  (features) and t
-00014f70: 7261 6e73 666f 726d 6564 2022 0a20 2020  ransformed ".   
-00014f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f90: 2022 696e 746f 2073 6361 6c65 2064 6567   "into scale deg
-00014fa0: 7265 6573 2e20 466f 7220 6d6f 7265 2069  rees. For more i
-00014fb0: 6e66 6f72 6d61 7469 6f6e 2c20 706c 6561  nformation, plea
-00014fc0: 7365 2072 6566 6572 2074 6f20 7468 6520  se refer to the 
-00014fd0: 646f 6373 2061 7420 6874 7470 733a 2f2f  docs at https://
-00014fe0: 6a6f 6865 6e74 7363 682e 6769 7468 7562  johentsch.github
-00014ff0: 2e69 6f2f 6d73 332f 636f 6c75 6d6e 7322  .io/ms3/columns"
-00015000: 2c0a 2020 2020 2020 2020 226d 6561 7375  ,.        "measu
-00015010: 7265 7322 3a20 224f 6e65 2066 6561 7475  res": "One featu
-00015020: 7265 206d 6174 7269 7820 7065 7220 7363  re matrix per sc
-00015030: 6f72 652c 2063 6f6e 7461 696e 696e 6720  ore, containing 
-00015040: 6f6e 6520 6c69 6e65 2070 6572 2073 7461  one line per sta
-00015050: 636b 206f 6620 3c4d 6561 7375 7265 3e20  ck of <Measure> 
-00015060: 7461 6773 2069 6e20 7468 6520 7363 6f72  tags in the scor
-00015070: 6527 7320 584d 4c20 7472 6565 2e20 220a  e's XML tree. ".
-00015080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015090: 2020 2020 2254 6865 7920 6172 6520 636f      "They are co
-000150a0: 756e 7465 6420 696e 2074 6865 2063 6f6c  unted in the col
-000150b0: 756d 6e20 276d 6327 2073 7461 7274 696e  umn 'mc' startin
-000150c0: 6720 6672 6f6d 2031 2c20 7768 6572 6561  g from 1, wherea
-000150d0: 7320 7468 6520 636f 6e76 656e 7469 6f6e  s the convention
-000150e0: 616c 206d 6561 7375 7265 206e 756d 6265  al measure numbe
-000150f0: 7273 2061 7265 2073 686f 776e 2022 0a20  rs are shown ". 
-00015100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015110: 2020 2022 696e 2074 6865 2063 6f6c 756d     "in the colum
-00015120: 6e20 276d 6e27 2e20 4f6e 6520 4d4e 2069  n 'mn'. One MN i
-00015130: 7320 6672 6571 7565 6e74 6c79 2063 6f6d  s frequently com
-00015140: 706f 7365 6420 696e 2074 776f 2028 6f72  posed in two (or
-00015150: 206d 6f72 6529 204d 4373 2e20 4675 7274   more) MCs. Furt
-00015160: 6865 726d 6f72 652c 2074 6865 7365 2074  hermore, these t
-00015170: 6162 6c65 7320 696e 636c 7564 6520 220a  ables include ".
-00015180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015190: 2020 2020 2273 7065 6369 616c 2062 6172      "special bar
-000151a0: 206c 696e 6573 2c20 7265 7065 6174 2073   lines, repeat s
-000151b0: 6967 6e73 2c20 6669 7273 7420 616e 6420  igns, first and 
-000151c0: 7365 636f 6e64 2065 6e64 696e 6773 2c20  second endings, 
-000151d0: 6972 7265 6775 6c61 7220 6d65 6173 7572  irregular measur
-000151e0: 6520 6c65 6e67 7468 732c 2061 7320 7765  e lengths, as we
-000151f0: 6c6c 2061 7320 7468 6520 220a 2020 2020  ll as the ".    
-00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015210: 2263 6f6c 756d 6e20 276e 6578 7427 2077  "column 'next' w
-00015220: 6869 6368 2063 6f6e 7461 696e 7320 666f  hich contains fo
-00015230: 6c6c 6f77 2d75 7020 4d43 7320 666f 7220  llow-up MCs for 
-00015240: 756e 666f 6c64 696e 6720 6120 7363 6f72  unfolding a scor
-00015250: 6527 7320 7265 7065 6174 2073 7472 7563  e's repeat struc
-00015260: 7475 7265 2e20 466f 7220 6d6f 7265 2069  ture. For more i
-00015270: 6e66 6f72 6d61 7469 6f6e 2c20 220a 2020  nformation, ".  
-00015280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015290: 2020 2270 6c65 6173 6520 7265 6665 7220    "please refer 
-000152a0: 746f 2074 6865 2064 6f63 7320 6174 2068  to the docs at h
-000152b0: 7474 7073 3a2f 2f6a 6f68 656e 7473 6368  ttps://johentsch
-000152c0: 2e67 6974 6875 622e 696f 2f6d 7333 2f63  .github.io/ms3/c
-000152d0: 6f6c 756d 6e73 222c 0a20 2020 2020 2020  olumns",.       
-000152e0: 2022 6e6f 7465 7322 3a20 224f 6e65 2066   "notes": "One f
-000152f0: 6561 7475 7265 206d 6174 7269 7820 7065  eature matrix pe
-00015300: 7220 7363 6f72 652c 2063 6f6e 7461 696e  r score, contain
-00015310: 696e 6720 6f6e 6520 726f 7720 7065 7220  ing one row per 
-00015320: 6e6f 7465 2068 6561 642e 204e 6f74 2065  note head. Not e
-00015330: 7665 7279 2072 6f77 2072 6570 7265 7365  very row represe
-00015340: 6e74 7320 616e 2022 0a20 2020 2020 2020  nts an ".       
-00015350: 2020 2020 2020 2020 2020 226f 6e73 6574            "onset
-00015360: 2062 6563 6175 7365 206e 6f74 6520 6865   because note he
-00015370: 6164 7320 6d61 7920 6265 2074 6965 6420  ads may be tied 
-00015380: 746f 6765 7468 6572 2028 7365 6520 636f  together (see co
-00015390: 6c75 6d6e 2027 7469 6564 2729 2e20 220a  lumn 'tied'). ".
-000153a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153b0: 2022 466f 7220 6d6f 7265 2069 6e66 6f72   "For more infor
-000153c0: 6d61 7469 6f6e 2c20 706c 6561 7365 2072  mation, please r
-000153d0: 6566 6572 2074 6f20 7468 6520 646f 6373  efer to the docs
-000153e0: 2061 7420 6874 7470 733a 2f2f 6a6f 6865   at https://johe
-000153f0: 6e74 7363 682e 6769 7468 7562 2e69 6f2f  ntsch.github.io/
-00015400: 6d73 332f 636f 6c75 6d6e 7322 2c0a 2020  ms3/columns",.  
-00015410: 2020 7d0a 2020 2020 7469 746c 6520 3d20    }.    title = 
-00015420: 7469 746c 6573 5b66 6163 6574 5d20 6966  titles[facet] if
-00015430: 2066 6163 6574 2069 6e20 7469 746c 6573   facet in titles
-00015440: 2065 6c73 6520 6661 6365 740a 2020 2020   else facet.    
-00015450: 7469 746c 6520 2b3d 2022 2066 6f72 2022  title += " for "
-00015460: 202b 2063 6f72 7075 730a 2020 2020 6465   + corpus.    de
-00015470: 7363 7269 7074 696f 6e20 3d20 6465 7363  scription = desc
-00015480: 7269 7074 696f 6e73 5b66 6163 6574 5d20  riptions[facet] 
-00015490: 6966 2066 6163 6574 2069 6e20 6465 7363  if facet in desc
-000154a0: 7269 7074 696f 6e73 2065 6c73 6520 4e6f  riptions else No
-000154b0: 6e65 0a20 2020 206a 736f 6e6c 6420 3d20  ne.    jsonld = 
-000154c0: 6d61 6b65 5f63 7376 775f 6a73 6f6e 6c64  make_csvw_jsonld
-000154d0: 2874 6974 6c65 3d74 6974 6c65 2c0a 2020  (title=title,.  
-000154e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154f0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-00015500: 6d6e 733d 636f 6c75 6d6e 732c 0a20 2020  mns=columns,.   
-00015510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015520: 2020 2020 2020 2020 2020 2075 726c 733d             urls=
-00015530: 6669 6c65 732c 0a20 2020 2020 2020 2020  files,.         
-00015540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015550: 2020 2020 2064 6573 6372 6970 7469 6f6e       description
-00015560: 3d64 6573 6372 6970 7469 6f6e 0a20 2020  =description.   
-00015570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015580: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00015590: 206a 736f 6e5f 7061 7468 203d 206f 732e   json_path = os.
-000155a0: 7061 7468 2e6a 6f69 6e28 666f 6c64 6572  path.join(folder
-000155b0: 2c20 2763 7376 2d6d 6574 6164 6174 612e  , 'csv-metadata.
-000155c0: 6a73 6f6e 2729 0a20 2020 2077 6974 6820  json').    with 
-000155d0: 6f70 656e 286a 736f 6e5f 7061 7468 2c20  open(json_path, 
-000155e0: 2777 272c 2065 6e63 6f64 696e 673d 2775  'w', encoding='u
-000155f0: 7466 2d38 2729 2061 7320 663a 0a20 2020  tf-8') as f:.   
-00015600: 2020 2020 2070 7269 6e74 286a 736f 6e2e       print(json.
-00015610: 6475 6d70 7328 6a73 6f6e 6c64 2c20 696e  dumps(jsonld, in
-00015620: 6465 6e74 3d32 292c 2066 696c 653d 6629  dent=2), file=f)
-00015630: 0a20 2020 2072 6574 7572 6e20 6a73 6f6e  .    return json
-00015640: 5f70 6174 680a 0a0a 4066 756e 6374 696f  _path...@functio
-00015650: 6e5f 6c6f 6767 6572 0a64 6566 206d 616b  n_logger.def mak
-00015660: 655f 636f 6e74 696e 756f 7573 5f6f 6666  e_continuous_off
-00015670: 7365 745f 7365 7269 6573 286d 6561 7375  set_series(measu
-00015680: 7265 732c 2071 7561 7274 6572 733d 5472  res, quarters=Tr
-00015690: 7565 2c20 6e65 6761 7469 7665 5f61 6e61  ue, negative_ana
-000156a0: 6372 7573 6973 3d4e 6f6e 6529 3a0a 2020  crusis=None):.  
-000156b0: 2020 2222 2220 4163 6365 7074 7320 6120    """ Accepts a 
-000156c0: 6d65 6173 7572 6520 7461 626c 6520 7769  measure table wi
-000156d0: 7468 6f75 7420 2771 7561 7274 6572 6265  thout 'quarterbe
-000156e0: 6174 7327 2063 6f6c 756d 6e20 616e 6420  ats' column and 
-000156f0: 636f 6d70 7574 6573 2065 6163 6820 4d43  computes each MC
-00015700: 2773 206f 6666 7365 7420 6672 6f6d 2074  's offset from t
-00015710: 6865 2070 6965 6365 2773 2062 6567 696e  he piece's begin
-00015720: 6e69 6e67 2e0a 2020 2020 4465 616c 2077  ning..    Deal w
-00015730: 6974 6820 766f 6c74 6173 2062 6566 6f72  ith voltas befor
-00015740: 6520 7061 7373 696e 6720 7468 6520 7461  e passing the ta
-00015750: 626c 652e 0a0a 2020 2020 4966 2079 6f75  ble...    If you
-00015760: 206e 6565 6420 616e 206f 6666 7365 745f   need an offset_
-00015770: 6469 6374 2061 6e64 2074 6865 206d 6561  dict and the mea
-00015780: 7375 7265 7320 616c 7265 6164 7920 636f  sures already co
-00015790: 6d65 2077 6974 6820 6120 2771 7561 7274  me with a 'quart
-000157a0: 6572 6265 6174 7327 2063 6f6c 756d 6e2c  erbeats' column,
-000157b0: 2079 6f75 2063 616e 2063 616c 6c0a 2020   you can call.  
-000157c0: 2020 3a66 756e 633a 606d 616b 655f 6f66    :func:`make_of
-000157d0: 6673 6574 5f64 6963 745f 6672 6f6d 5f6d  fset_dict_from_m
-000157e0: 6561 7375 7265 7360 2e0a 0a20 2020 2050  easures`...    P
-000157f0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00015800: 2d2d 2d2d 2d2d 2d2d 0a20 2020 206d 6561  --------.    mea
-00015810: 7375 7265 7320 3a20 3a6f 626a 3a60 7061  sures : :obj:`pa
-00015820: 6e64 6173 2e44 6174 6146 7261 6d65 600a  ndas.DataFrame`.
-00015830: 2020 2020 2020 2020 4120 6d65 6173 7572          A measur
-00015840: 6573 2074 6162 6c65 2077 6974 6820 276e  es table with 'n
-00015850: 6f72 6d61 6c27 2052 616e 6765 496e 6465  ormal' RangeInde
-00015860: 7820 636f 6e74 6169 6e69 6e67 2074 6865  x containing the
-00015870: 2063 6f6c 756d 6e20 2761 6374 5f64 7572   column 'act_dur
-00015880: 7327 2061 6e64 206f 6e65 206f 660a 2020  s' and one of.  
-00015890: 2020 2020 2020 276d 6327 206f 7220 276d        'mc' or 'm
-000158a0: 635f 706c 6179 7468 726f 7567 6827 2028  c_playthrough' (
-000158b0: 6966 2072 6570 6561 7473 2077 6572 6520  if repeats were 
-000158c0: 756e 666f 6c64 6564 292e 0a20 2020 2071  unfolded)..    q
-000158d0: 7561 7274 6572 7320 3a20 3a6f 626a 3a60  uarters : :obj:`
-000158e0: 626f 6f6c 602c 206f 7074 696f 6e61 6c0a  bool`, optional.
-000158f0: 2020 2020 2020 2020 4279 2064 6566 6175          By defau
-00015900: 6c74 2c20 7468 6520 636f 6e74 696e 756f  lt, the continuo
-00015910: 7573 206f 6666 7365 7473 2061 7265 2065  us offsets are e
-00015920: 7870 7265 7373 6564 2069 6e20 7175 6172  xpressed in quar
-00015930: 7465 7220 6e6f 7465 732e 2050 6173 7320  ter notes. Pass 
-00015940: 6661 6c73 6520 746f 206c 6561 7665 2074  false to leave t
-00015950: 6865 6d20 6173 2066 7261 6374 696f 6e73  hem as fractions
-00015960: 0a20 2020 2020 2020 206f 6620 6120 7768  .        of a wh
-00015970: 6f6c 6520 6e6f 7465 2e0a 2020 2020 6e65  ole note..    ne
-00015980: 6761 7469 7665 5f61 6e61 6372 7573 6973  gative_anacrusis
-00015990: 203a 203a 6f62 6a3a 6066 7261 6374 696f   : :obj:`fractio
-000159a0: 6e73 2e46 7261 6374 696f 6e60 0a20 2020  ns.Fraction`.   
-000159b0: 2020 2020 2042 7920 6465 6661 756c 742c       By default,
-000159c0: 2074 6865 2066 6972 7374 2076 616c 7565   the first value
-000159d0: 2069 7320 302e 2049 6620 796f 7520 7061   is 0. If you pa
-000159e0: 7373 2061 2066 7261 6374 696f 6e20 6865  ss a fraction he
-000159f0: 7265 2c20 7468 6520 6669 7273 7420 7661  re, the first va
-00015a00: 6c75 6520 7769 6c6c 2062 6520 6974 7320  lue will be its 
-00015a10: 6e65 6761 7469 7665 2061 6e64 2074 6865  negative and the
-00015a20: 0a20 2020 2020 2020 2073 6563 6f6e 6420  .        second 
-00015a30: 7661 6c75 6520 7769 6c6c 2062 6520 302e  value will be 0.
-00015a40: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-00015a50: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 3a6f    -------.    :o
-00015a60: 626a 3a60 7061 6e64 6173 2e53 6572 6965  bj:`pandas.Serie
-00015a70: 7360 0a20 2020 2020 2020 2043 756d 756c  s`.        Cumul
-00015a80: 6174 6976 6520 7375 6d20 6f66 2074 6865  ative sum of the
-00015a90: 2061 6374 7561 6c20 6475 7261 7469 6f6e   actual duration
-00015aa0: 732c 2073 6869 6674 6564 2064 6f77 6e20  s, shifted down 
-00015ab0: 6279 2031 2e20 436f 6d70 6172 6564 2074  by 1. Compared t
-00015ac0: 6f20 7468 6520 6f72 6967 696e 616c 2044  o the original D
-00015ad0: 6174 6146 7261 6d65 2069 7420 6861 730a  ataFrame it has.
-00015ae0: 2020 2020 2020 2020 6c65 6e67 7468 202b          length +
-00015af0: 2032 2062 6563 6175 7365 2069 7420 6164   2 because it ad
-00015b00: 6473 2074 6865 2065 6e64 2076 616c 7565  ds the end value
-00015b10: 2074 7769 6365 2c20 6f6e 6365 2077 6974   twice, once wit
-00015b20: 6820 7468 6520 6e65 7874 2069 6e64 6578  h the next index
-00015b30: 2076 616c 7565 2c20 616e 6420 6f6e 6365   value, and once
-00015b40: 2077 6974 6820 7468 6520 696e 6465 7820   with the index 
-00015b50: 2765 6e64 272e 0a20 2020 2020 2020 204f  'end'..        O
-00015b60: 7468 6572 7769 7365 2074 6865 2065 6e64  therwise the end
-00015b70: 2076 616c 7565 2077 6f75 6c64 2062 6520   value would be 
-00015b80: 6c6f 7374 2064 7565 2074 6f20 7468 6520  lost due to the 
-00015b90: 7368 6966 7469 6e67 2e0a 2020 2020 2222  shifting..    ""
-00015ba0: 220a 2020 2020 6966 2027 6d63 5f70 6c61  ".    if 'mc_pla
-00015bb0: 7974 6872 6f75 6768 2720 696e 206d 6561  ythrough' in mea
-00015bc0: 7375 7265 732e 636f 6c75 6d6e 733a 0a20  sures.columns:. 
-00015bd0: 2020 2020 2020 2061 6374 5f64 7572 7320         act_durs 
-00015be0: 3d20 6d65 6173 7572 6573 2e73 6574 5f69  = measures.set_i
-00015bf0: 6e64 6578 2827 6d63 5f70 6c61 7974 6872  ndex('mc_playthr
-00015c00: 6f75 6768 2729 2e61 6374 5f64 7572 0a20  ough').act_dur. 
-00015c10: 2020 2065 6c69 6620 276d 6327 2069 6e20     elif 'mc' in 
-00015c20: 6d65 6173 7572 6573 2e63 6f6c 756d 6e73  measures.columns
-00015c30: 3a0a 2020 2020 2020 2020 6163 745f 6475  :.        act_du
-00015c40: 7273 203d 206d 6561 7375 7265 732e 7365  rs = measures.se
-00015c50: 745f 696e 6465 7828 276d 6327 292e 6163  t_index('mc').ac
-00015c60: 745f 6475 720a 2020 2020 656c 7365 3a0a  t_dur.    else:.
-00015c70: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
-00015c80: 7272 6f72 2822 4578 7065 6374 6564 2074  rror("Expected t
-00015c90: 6f20 6861 7665 2061 7420 6c65 6173 7420  o have at least 
-00015ca0: 6f6e 6520 636f 6c75 6d6e 2063 616c 6c65  one column calle
-00015cb0: 6420 276d 6327 206f 7220 276d 635f 706c  d 'mc' or 'mc_pl
-00015cc0: 6179 7468 726f 7567 6827 2e22 290a 2020  aythrough'.").  
-00015cd0: 2020 2020 2020 7265 7475 726e 2070 642e        return pd.
-00015ce0: 5365 7269 6573 2829 0a20 2020 2069 6620  Series().    if 
-00015cf0: 7175 6172 7465 7273 3a0a 2020 2020 2020  quarters:.      
-00015d00: 2020 6163 745f 6475 7273 203d 2061 6374    act_durs = act
-00015d10: 5f64 7572 7320 2a20 340a 2020 2020 7265  _durs * 4.    re
-00015d20: 7320 3d20 6163 745f 6475 7273 2e63 756d  s = act_durs.cum
-00015d30: 7375 6d28 290a 2020 2020 6c61 7374 5f76  sum().    last_v
-00015d40: 616c 203d 2072 6573 2e69 6c6f 635b 2d31  al = res.iloc[-1
-00015d50: 5d0a 2020 2020 6c61 7374 5f69 7820 3d20  ].    last_ix = 
-00015d60: 7265 732e 696e 6465 785b 2d31 5d20 2b20  res.index[-1] + 
-00015d70: 310a 2020 2020 7265 7320 3d20 7265 732e  1.    res = res.
-00015d80: 7368 6966 7428 6669 6c6c 5f76 616c 7565  shift(fill_value
-00015d90: 3d30 290a 2020 2020 656e 6469 6e67 203d  =0).    ending =
-00015da0: 2070 642e 5365 7269 6573 285b 6c61 7374   pd.Series([last
-00015db0: 5f76 616c 2c20 6c61 7374 5f76 616c 5d2c  _val, last_val],
-00015dc0: 2069 6e64 6578 3d5b 6c61 7374 5f69 782c   index=[last_ix,
-00015dd0: 2027 656e 6427 5d29 0a20 2020 2072 6573   'end']).    res
-00015de0: 203d 2070 642e 636f 6e63 6174 285b 7265   = pd.concat([re
-00015df0: 732c 2065 6e64 696e 675d 290a 2020 2020  s, ending]).    
-00015e00: 6966 206e 6567 6174 6976 655f 616e 6163  if negative_anac
-00015e10: 7275 7369 7320 6973 206e 6f74 204e 6f6e  rusis is not Non
-00015e20: 653a 0a20 2020 2020 2020 2072 6573 202d  e:.        res -
-00015e30: 3d20 6162 7328 6672 6163 286e 6567 6174  = abs(frac(negat
-00015e40: 6976 655f 616e 6163 7275 7369 7329 290a  ive_anacrusis)).
-00015e50: 2020 2020 7265 7475 726e 2072 6573 0a0a      return res..
-00015e60: 6465 6620 6d61 6b65 5f6f 6666 7365 745f  def make_offset_
-00015e70: 6469 6374 5f66 726f 6d5f 6d65 6173 7572  dict_from_measur
-00015e80: 6573 286d 6561 7375 7265 733a 2070 642e  es(measures: pd.
-00015e90: 4461 7461 4672 616d 652c 2061 6c6c 5f65  DataFrame, all_e
-00015ea0: 6e64 696e 6773 3a20 626f 6f6c 203d 2046  ndings: bool = F
-00015eb0: 616c 7365 2920 2d3e 2064 6963 743a 0a20  alse) -> dict:. 
-00015ec0: 2020 2022 2222 2054 7572 6e20 6120 6d65     """ Turn a me
-00015ed0: 6173 7572 6520 7461 626c 6520 7468 6174  asure table that
-00015ee0: 2063 6f6d 6573 2077 6974 6820 6120 2771   comes with a 'q
-00015ef0: 7561 7274 6572 6265 6174 7327 2063 6f6c  uarterbeats' col
-00015f00: 756d 6e20 696e 746f 2061 2064 6963 7469  umn into a dicti
-00015f10: 6f6e 6172 7920 7468 6174 206d 6170 7320  onary that maps 
-00015f20: 4d43 7320 286d 6561 7375 7265 2063 6f75  MCs (measure cou
-00015f30: 6e74 7329 0a20 2020 2074 6f20 7468 6569  nts).    to thei
-00015f40: 7220 7175 6172 7465 7262 6561 7420 6f66  r quarterbeat of
-00015f50: 6673 6574 2066 726f 6d20 7468 6520 7069  fset from the pi
-00015f60: 6563 6527 7320 6265 6769 6e6e 696e 672c  ece's beginning,
-00015f70: 2075 7365 6420 666f 7220 636f 6d70 7574   used for comput
-00015f80: 696e 6720 7175 6172 7465 7262 6561 7473  ing quarterbeats
-00015f90: 2066 6f72 206f 7468 6572 2066 6163 6574   for other facet
-00015fa0: 732e 0a0a 2020 2020 5468 6973 2066 756e  s...    This fun
-00015fb0: 6374 696f 6e20 6973 2075 7365 6420 666f  ction is used fo
-00015fc0: 7220 7468 6520 6465 6661 756c 7420 6361  r the default ca
-00015fd0: 7365 2e20 4966 2079 6f75 206e 6565 6420  se. If you need 
-00015fe0: 6d6f 7265 206f 7074 696f 6e73 2c20 652e  more options, e.
-00015ff0: 672e 2061 6e20 6f66 6673 6574 2064 6963  g. an offset dic
-00016000: 7420 6672 6f6d 2075 6e66 6f6c 6465 640a  t from unfolded.
-00016010: 2020 2020 6d65 6173 7572 6573 206f 7220      measures or 
-00016020: 6578 7072 6573 7365 6420 696e 2077 686f  expressed in who
-00016030: 6c65 206e 6f74 6573 206f 7220 7769 7468  le notes or with
-00016040: 206e 6567 6174 6976 6520 616e 6163 7275   negative anacru
-00016050: 7369 732c 2075 7365 0a20 2020 203a 6675  sis, use.    :fu
-00016060: 6e63 3a60 6d61 6b65 5f63 6f6e 7469 6e75  nc:`make_continu
-00016070: 6f75 735f 6f66 6673 6574 5f73 6572 6965  ous_offset_serie
-00016080: 7360 2069 6e73 7465 6164 2e0a 0a20 2020  s` instead...   
-00016090: 2041 7267 733a 0a20 2020 2020 206d 6561   Args:.      mea
-000160a0: 7375 7265 733a 204d 6561 7375 7265 7320  sures: Measures 
-000160b0: 7461 626c 6520 636f 6e74 6169 6e69 6e67  table containing
-000160c0: 2061 2027 7175 6172 7465 7262 6561 7473   a 'quarterbeats
-000160d0: 2720 636f 6c75 6d6e 2e0a 2020 2020 2020  ' column..      
-000160e0: 616c 6c5f 656e 6469 6e67 733a 2055 7365  all_endings: Use
-000160f0: 7320 7468 6520 636f 6c75 6d6e 2027 7175  s the column 'qu
-00016100: 6172 7465 7262 6561 7473 5f61 6c6c 5f65  arterbeats_all_e
-00016110: 6e64 696e 6773 2720 6f66 2074 6865 206d  ndings' of the m
-00016120: 6561 7375 7265 7320 7461 626c 6520 6966  easures table if
-00016130: 2069 7420 6861 7320 6f6e 652c 206f 7468   it has one, oth
-00016140: 6572 7769 7365 0a20 2020 2020 2020 2020  erwise.         
-00016150: 2066 616c 6c73 2062 6163 6b20 746f 2074   falls back to t
-00016160: 6865 2064 6566 6175 6c74 2027 7175 6172  he default 'quar
-00016170: 7465 7262 6561 7473 272e 0a0a 2020 2020  terbeats'...    
-00016180: 5265 7475 726e 733a 0a20 2020 2020 207b  Returns:.      {
-00016190: 4d43 202d 3e20 7175 6172 7465 7262 6561  MC -> quarterbea
-000161a0: 745f 6f66 6673 6574 7d2e 204f 6666 7365  t_offset}. Offse
-000161b0: 7473 2061 7265 2046 7261 6374 696f 6e73  ts are Fractions
-000161c0: 2e20 4966 2060 6061 6c6c 5f65 6e64 696e  . If ``all_endin
-000161d0: 6773 6060 2069 7320 6e6f 7420 7365 7420  gs`` is not set 
-000161e0: 746f 2060 6054 7275 6560 602c 0a20 2020  to ``True``,.   
-000161f0: 2020 2076 616c 7565 7320 666f 7220 4d43     values for MC
-00016200: 7320 7468 6174 2061 7265 2070 6172 7420  s that are part 
-00016210: 6f66 2061 2066 6972 7374 2065 6e64 696e  of a first endin
-00016220: 6720 286f 7220 7468 6972 6420 6f72 206c  g (or third or l
-00016230: 6172 6765 7229 2061 7265 204e 412e 0a20  arger) are NA.. 
-00016240: 2020 2022 2222 0a20 2020 206d 6561 7375     """.    measu
-00016250: 7265 7320 3d20 6d65 6173 7572 6573 2e73  res = measures.s
-00016260: 6574 5f69 6e64 6578 2827 6d63 2729 0a20  et_index('mc'). 
-00016270: 2020 2069 6620 616c 6c5f 656e 6469 6e67     if all_ending
-00016280: 7320 616e 6420 2771 7561 7274 6572 6265  s and 'quarterbe
-00016290: 6174 735f 616c 6c5f 656e 6469 6e67 7327  ats_all_endings'
-000162a0: 2069 6e20 6d65 6173 7572 6573 2e63 6f6c   in measures.col
-000162b0: 756d 6e73 3a0a 2020 2020 2020 2020 636f  umns:.        co
-000162c0: 6c20 3d20 2771 7561 7274 6572 6265 6174  l = 'quarterbeat
-000162d0: 735f 616c 6c5f 656e 6469 6e67 7327 0a20  s_all_endings'. 
-000162e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000162f0: 2063 6f6c 203d 2027 7175 6172 7465 7262   col = 'quarterb
-00016300: 6561 7473 270a 2020 2020 6f66 6673 6574  eats'.    offset
-00016310: 5f64 6963 7420 3d20 6d65 6173 7572 6573  _dict = measures
-00016320: 5b63 6f6c 5d2e 746f 5f64 6963 7428 290a  [col].to_dict().
-00016330: 2020 2020 6c61 7374 5f72 6f77 203d 206d      last_row = m
-00016340: 6561 7375 7265 732e 696c 6f63 5b2d 315d  easures.iloc[-1]
-00016350: 0a20 2020 206f 6666 7365 745f 6469 6374  .    offset_dict
-00016360: 5b27 656e 6427 5d20 3d20 6c61 7374 5f72  ['end'] = last_r
-00016370: 6f77 5b63 6f6c 5d20 2b20 3420 2a20 6c61  ow[col] + 4 * la
-00016380: 7374 5f72 6f77 2e61 6374 5f64 7572 0a20  st_row.act_dur. 
-00016390: 2020 2072 6574 7572 6e20 6f66 6673 6574     return offset
-000163a0: 5f64 6963 740a 0a0a 6465 6620 6d61 6b65  _dict...def make
-000163b0: 5f69 645f 7475 706c 6573 286b 6579 2c20  _id_tuples(key, 
-000163c0: 6e29 3a0a 2020 2020 2222 2220 466f 7220  n):.    """ For 
-000163d0: 6120 6769 7665 6e20 6b65 792c 2074 6869  a given key, thi
-000163e0: 7320 6675 6e63 7469 6f6e 2072 6574 7572  s function retur
-000163f0: 6e73 2069 6e64 6578 2074 7570 6c65 7320  ns index tuples 
-00016400: 696e 2074 6865 2066 6f72 6d20 5b28 6b65  in the form [(ke
-00016410: 792c 2030 292c 202e 2e2e 2c20 286b 6579  y, 0), ..., (key
-00016420: 2c20 6e29 5d0a 0a20 2020 2052 6574 7572  , n)]..    Retur
-00016430: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
-00016440: 2020 206c 6973 740a 2020 2020 2020 2020     list.        
-00016450: 696e 6469 6365 7320 696e 2074 6865 2066  indices in the f
-00016460: 6f72 6d20 5b28 6b65 792c 2030 292c 202e  orm [(key, 0), .
-00016470: 2e2e 2c20 286b 6579 2c20 6e29 5d0a 0a20  .., (key, n)].. 
-00016480: 2020 2022 2222 0a20 2020 2072 6574 7572     """.    retur
-00016490: 6e20 6c69 7374 287a 6970 2872 6570 6561  n list(zip(repea
-000164a0: 7428 6b65 7929 2c20 7261 6e67 6528 6e29  t(key), range(n)
-000164b0: 2929 0a0a 0a40 6675 6e63 7469 6f6e 5f6c  ))...@function_l
-000164c0: 6f67 6765 720a 6465 6620 6d61 6b65 5f69  ogger.def make_i
-000164d0: 6e74 6572 7661 6c5f 696e 6465 785f 6672  nterval_index_fr
-000164e0: 6f6d 5f62 7265 616b 7328 532c 2065 6e64  om_breaks(S, end
-000164f0: 5f76 616c 7565 3d4e 6f6e 652c 2063 6c6f  _value=None, clo
-00016500: 7365 643d 276c 6566 7427 2c20 6e61 6d65  sed='left', name
-00016510: 3d27 696e 7465 7276 616c 2729 3a0a 2020  ='interval'):.  
-00016520: 2020 2222 2220 496e 7465 7270 7265 7420    """ Interpret 
-00016530: 6120 5365 7269 6573 2061 7320 696e 7465  a Series as inte
-00016540: 7276 616c 2062 7265 616b 7320 616e 6420  rval breaks and 
-00016550: 6d61 6b65 2061 6e20 496e 7465 7276 616c  make an Interval
-00016560: 496e 6465 7820 6f75 7420 6f66 2069 742e  Index out of it.
-00016570: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-00016580: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-00016590: 2020 2020 5320 3a20 3a6f 626a 3a60 7061      S : :obj:`pa
-000165a0: 6e64 6173 2e53 6572 6965 7360 0a20 2020  ndas.Series`.   
-000165b0: 2020 2020 2049 6e74 6572 7661 6c20 6272       Interval br
-000165c0: 6561 6b73 2e20 4974 2069 7320 6173 7375  eaks. It is assu
-000165d0: 6d65 6420 7468 6174 2074 6865 2062 7265  med that the bre
-000165e0: 616b 7320 6172 6520 736f 7274 6564 2e0a  aks are sorted..
-000165f0: 2020 2020 656e 645f 7661 6c75 6520 3a20      end_value : 
-00016600: 6e75 6d65 7269 632c 206f 7074 696f 6e61  numeric, optiona
-00016610: 6c0a 2020 2020 2020 2020 4f66 7465 6e20  l.        Often 
-00016620: 796f 7520 7761 6e74 2074 6f20 7061 7373  you want to pass
-00016630: 2074 6865 2072 6967 6874 2062 6f72 6465   the right borde
-00016640: 7220 6f66 2074 6865 206c 6173 7420 696e  r of the last in
-00016650: 7465 7276 616c 2e0a 2020 2020 636c 6f73  terval..    clos
-00016660: 6564 203a 203a 6f62 6a3a 6073 7472 602c  ed : :obj:`str`,
-00016670: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00016680: 2020 4465 6661 756c 7473 2074 6f20 276c    Defaults to 'l
-00016690: 6566 7427 2e20 4172 6775 6d65 6e74 2070  eft'. Argument p
-000166a0: 6173 7365 6420 746f 2074 6f20 3a70 793a  assed to to :py:
-000166b0: 6d65 7468 3a60 7061 6e64 6173 2e49 6e74  meth:`pandas.Int
-000166c0: 6572 7661 6c49 6e64 6578 2e66 726f 6d5f  ervalIndex.from_
-000166d0: 6272 6561 6b73 602e 0a20 2020 206e 616d  breaks`..    nam
-000166e0: 6520 3a20 3a6f 626a 3a60 7374 7260 2c20  e : :obj:`str`, 
-000166f0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00016700: 204e 616d 6520 6f66 2074 6865 2063 7265   Name of the cre
-00016710: 6174 6564 2069 6e64 6578 2e20 4465 6661  ated index. Defa
-00016720: 756c 7473 2074 6f20 2769 6e74 6572 7661  ults to 'interva
-00016730: 6c27 2e0a 0a20 2020 2052 6574 7572 6e73  l'...    Returns
-00016740: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-00016750: 203a 6f62 6a3a 6070 616e 6461 732e 496e   :obj:`pandas.In
-00016760: 7465 7276 616c 496e 6465 7860 0a0a 2020  tervalIndex`..  
-00016770: 2020 2222 220a 2020 2020 6272 6561 6b73    """.    breaks
-00016780: 203d 2053 2e74 6f5f 6c69 7374 2829 0a20   = S.to_list(). 
-00016790: 2020 2069 6620 656e 645f 7661 6c75 6520     if end_value 
-000167a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000167b0: 2020 2020 206c 6173 7420 3d20 6272 6561       last = brea
-000167c0: 6b73 5b2d 315d 0a20 2020 2020 2020 2069  ks[-1].        i
-000167d0: 6620 656e 645f 7661 6c75 6520 3e20 6c61  f end_value > la
-000167e0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-000167f0: 6272 6561 6b73 202b 3d20 5b65 6e64 5f76  breaks += [end_v
-00016800: 616c 7565 5d0a 2020 2020 2020 2020 656c  alue].        el
-00016810: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00016820: 6272 6561 6b73 202b 3d20 5b6c 6173 745d  breaks += [last]
-00016830: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00016840: 2020 6969 7820 3d20 7064 2e49 6e74 6572    iix = pd.Inter
-00016850: 7661 6c49 6e64 6578 2e66 726f 6d5f 6272  valIndex.from_br
-00016860: 6561 6b73 2862 7265 616b 732c 2063 6c6f  eaks(breaks, clo
-00016870: 7365 643d 636c 6f73 6564 2c20 6e61 6d65  sed=closed, name
-00016880: 3d6e 616d 6529 0a20 2020 2065 7863 6570  =name).    excep
-00016890: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-000168a0: 3a0a 2020 2020 2020 2020 756e 736f 7274  :.        unsort
-000168b0: 6564 203d 205b 2861 2c20 6229 2066 6f72  ed = [(a, b) for
-000168c0: 2061 2c20 6220 696e 207a 6970 2862 7265   a, b in zip(bre
-000168d0: 616b 732c 2062 7265 616b 735b 313a 5d29  aks, breaks[1:])
-000168e0: 2069 6620 6220 3c20 615d 0a20 2020 2020   if b < a].     
-000168f0: 2020 2069 6620 6c65 6e28 756e 736f 7274     if len(unsort
-00016900: 6564 2920 3e20 303a 0a20 2020 2020 2020  ed) > 0:.       
-00016910: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
-00016920: 7228 6622 4272 6561 6b73 2061 7265 206e  r(f"Breaks are n
-00016930: 6f74 2073 6f72 7465 643a 207b 756e 736f  ot sorted: {unso
-00016940: 7274 6564 7d22 290a 2020 2020 2020 2020  rted}").        
-00016950: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00016960: 2020 6c6f 6767 6572 2e65 7272 6f72 2866    logger.error(f
-00016970: 2243 616e 6e6f 7420 6372 6561 7465 2049  "Cannot create I
-00016980: 6e74 6572 7661 6c49 6e64 6578 2066 726f  ntervalIndex fro
-00016990: 6d20 7468 6573 6520 6272 6561 6b73 3a5c  m these breaks:\
-000169a0: 6e7b 6272 6561 6b73 7d5c 6e45 7863 6570  n{breaks}\nExcep
-000169b0: 7469 6f6e 3a20 7b65 7d22 290a 2020 2020  tion: {e}").    
-000169c0: 2020 2020 7261 6973 650a 2020 2020 7265      raise.    re
-000169d0: 7475 726e 2069 6978 0a0a 0a64 6566 206d  turn iix...def m
-000169e0: 616b 655f 6e61 6d65 5f63 6f6c 756d 6e73  ake_name_columns
-000169f0: 2864 6629 3a0a 2020 2020 2222 2252 656c  (df):.    """Rel
-00016a00: 6965 7320 6f6e 2074 6865 2063 6f6c 756d  ies on the colum
-00016a10: 6e73 2060 606c 6f63 616c 6b65 7960 6020  ns ``localkey`` 
-00016a20: 616e 6420 6060 676c 6f62 616c 6b65 7960  and ``globalkey`
-00016a30: 6020 746f 2074 7261 6e73 666f 726d 2074  ` to transform t
-00016a40: 6865 2063 6f6c 756d 6e73 2060 6072 6f6f  he columns ``roo
-00016a50: 7460 6020 616e 6420 6060 6261 7373 5f6e  t`` and ``bass_n
-00016a60: 6f74 6573 6060 2066 726f 6d0a 2020 2020  otes`` from.    
-00016a70: 7363 616c 6520 6465 6772 6565 7320 2865  scale degrees (e
-00016a80: 7870 7265 7373 6564 2061 7320 6669 6674  xpressed as fift
-00016a90: 6873 2920 746f 2061 6273 6f6c 7574 6520  hs) to absolute 
-00016aa0: 6e6f 7465 206e 616d 6573 2c20 652e 672e  note names, e.g.
-00016ab0: 2069 6e20 4320 6d61 6a6f 723a 2030 203d   in C major: 0 =
-00016ac0: 3e20 2743 272c 2037 203d 3e20 2743 2327  > 'C', 7 => 'C#'
-00016ad0: 2c20 2d35 203d 3e20 2744 6227 0a20 2020  , -5 => 'Db'.   
-00016ae0: 2055 7365 733a 2074 7261 6e73 666f 726d   Uses: transform
-00016af0: 2829 2c20 7363 616c 655f 6465 6772 6565  (), scale_degree
-00016b00: 326e 616d 6522 2222 0a20 2020 206e 6577  2name""".    new
-00016b10: 5f63 6f6c 7320 3d20 7b7d 0a20 2020 2066  _cols = {}.    f
-00016b20: 6f72 2063 6f6c 2069 6e20 2827 726f 6f74  or col in ('root
-00016b30: 272c 2027 6261 7373 5f6e 6f74 6527 293a  ', 'bass_note'):
-00016b40: 0a20 2020 2020 2020 2069 6620 636f 6c20  .        if col 
-00016b50: 696e 2064 662e 636f 6c75 6d6e 733a 0a20  in df.columns:. 
-00016b60: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
-00016b70: 6f6c 735b 6622 7b63 6f6c 7d5f 6e61 6d65  ols[f"{col}_name
-00016b80: 225d 203d 2074 7261 6e73 666f 726d 2864  "] = transform(d
-00016b90: 662c 2073 6361 6c65 5f64 6567 7265 6532  f, scale_degree2
-00016ba0: 6e61 6d65 2c20 5b63 6f6c 2c20 276c 6f63  name, [col, 'loc
-00016bb0: 616c 6b65 7927 2c20 2767 6c6f 6261 6c6b  alkey', 'globalk
-00016bc0: 6579 275d 290a 2020 2020 7265 7475 726e  ey']).    return
-00016bd0: 2070 642e 4461 7461 4672 616d 6528 6e65   pd.DataFrame(ne
-00016be0: 775f 636f 6c73 290a 0a0a 4066 756e 6374  w_cols)...@funct
-00016bf0: 696f 6e5f 6c6f 6767 6572 0a64 6566 206d  ion_logger.def m
-00016c00: 616b 655f 706c 6179 7468 726f 7567 6832  ake_playthrough2
-00016c10: 6d63 286d 6561 7375 7265 733a 2070 642e  mc(measures: pd.
-00016c20: 4461 7461 4672 616d 6529 202d 3e20 4f70  DataFrame) -> Op
-00016c30: 7469 6f6e 616c 5b70 642e 5365 7269 6573  tional[pd.Series
-00016c40: 5d3a 0a20 2020 2022 2222 5475 726e 7320  ]:.    """Turns 
-00016c50: 7468 6520 636f 6c75 6d6e 2027 6e65 7874  the column 'next
-00016c60: 2720 696e 746f 2061 206d 6170 7069 6e67  ' into a mapping
-00016c70: 206f 6620 706c 6179 7468 726f 7567 685f   of playthrough_
-00016c80: 6d63 202d 3e20 6d63 2e22 2222 0a20 2020  mc -> mc.""".   
-00016c90: 206d 6c20 3d20 6d65 6173 7572 6573 2e73   ml = measures.s
-00016ca0: 6574 5f69 6e64 6578 2827 6d63 2729 0a20  et_index('mc'). 
-00016cb0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00016cc0: 7365 7120 3d20 6e65 7874 3273 6571 7565  seq = next2seque
-00016cd0: 6e63 6528 6d6c 2e6e 6578 742c 206c 6f67  nce(ml.next, log
-00016ce0: 6765 723d 6c6f 6767 6572 290a 2020 2020  ger=logger).    
-00016cf0: 2020 2020 6966 2073 6571 2069 7320 4e6f      if seq is No
-00016d00: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00016d10: 7265 7475 726e 0a20 2020 2065 7863 6570  return.    excep
-00016d20: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00016d30: 3a0a 2020 2020 2020 2020 6c6f 6767 6572  :.        logger
-00016d40: 2e77 6172 6e69 6e67 2866 2243 6f6d 7075  .warning(f"Compu
-00016d50: 7469 6e67 2075 6e66 6f6c 6465 6420 7365  ting unfolded se
-00016d60: 7175 656e 6365 206f 6620 4d43 7320 6661  quence of MCs fa
-00016d70: 696c 6564 2077 6974 683a 5c6e 277b 657d  iled with:\n'{e}
-00016d80: 2722 2c0a 2020 2020 2020 2020 2020 2020  '",.            
-00016d90: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-00016da0: 3d7b 276d 6573 7361 6765 5f69 6427 3a20  ={'message_id': 
-00016db0: 2832 362c 2029 7d29 0a20 2020 2020 2020  (26, )}).       
-00016dc0: 2072 6574 7572 6e0a 2020 2020 6d63 5f70   return.    mc_p
-00016dd0: 6c61 7974 6872 6f75 6768 203d 2070 642e  laythrough = pd.
-00016de0: 5365 7269 6573 2873 6571 2c20 6e61 6d65  Series(seq, name
-00016df0: 3d27 6d63 5f70 6c61 7974 6872 6f75 6768  ='mc_playthrough
-00016e00: 272c 2064 7479 7065 3d27 496e 7436 3427  ', dtype='Int64'
-00016e10: 290a 2020 2020 6966 206c 656e 286d 635f  ).    if len(mc_
-00016e20: 706c 6179 7468 726f 7567 6829 203d 3d20  playthrough) == 
-00016e30: 303a 0a20 2020 2020 2020 2070 6173 730a  0:.        pass.
-00016e40: 2020 2020 656c 6966 2073 6571 5b30 5d20      elif seq[0] 
-00016e50: 3d3d 2031 3a0a 2020 2020 2020 2020 6d63  == 1:.        mc
-00016e60: 5f70 6c61 7974 6872 6f75 6768 2e69 6e64  _playthrough.ind
-00016e70: 6578 202b 3d20 310a 2020 2020 656c 7365  ex += 1.    else
-00016e80: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
-00016e90: 2073 6571 5b30 5d20 3d3d 2030 2c20 6622   seq[0] == 0, f"
-00016ea0: 5468 6520 6669 7273 7420 6d63 2073 686f  The first mc sho
-00016eb0: 756c 6420 6265 2030 206f 7220 312c 206e  uld be 0 or 1, n
-00016ec0: 6f74 207b 7365 715b 305d 7d22 0a20 2020  ot {seq[0]}".   
-00016ed0: 2072 6574 7572 6e20 6d63 5f70 6c61 7974   return mc_playt
-00016ee0: 6872 6f75 6768 0a0a 4066 756e 6374 696f  hrough..@functio
-00016ef0: 6e5f 6c6f 6767 6572 0a64 6566 206d 616b  n_logger.def mak
-00016f00: 655f 706c 6179 7468 726f 7567 685f 696e  e_playthrough_in
-00016f10: 666f 286d 6561 7375 7265 733a 2070 642e  fo(measures: pd.
-00016f20: 4461 7461 4672 616d 6529 202d 3e20 4f70  DataFrame) -> Op
-00016f30: 7469 6f6e 616c 5b55 6e69 6f6e 5b70 642e  tional[Union[pd.
-00016f40: 4461 7461 4672 616d 652c 2070 642e 5365  DataFrame, pd.Se
-00016f50: 7269 6573 5d5d 3a0a 2020 2020 2222 2254  ries]]:.    """T
-00016f60: 7572 6e73 2061 206d 6561 7375 7265 7320  urns a measures 
-00016f70: 7461 626c 6520 696e 746f 2061 2044 6174  table into a Dat
-00016f80: 6146 7261 6d65 206f 7220 5365 7269 6573  aFrame or Series
-00016f90: 2074 6861 7420 6361 6e20 6265 2070 6173   that can be pas
-00016fa0: 7365 6420 6173 2061 7267 756d 656e 7420  sed as argument 
-00016fb0: 746f 203a 6675 6e63 3a60 756e 666f 6c64  to :func:`unfold
-00016fc0: 5f72 6570 6561 7473 602e 0a20 2020 2054  _repeats`..    T
-00016fd0: 6865 2072 6574 7572 6e20 7479 7065 2069  he return type i
-00016fe0: 7320 4461 7461 4672 616d 6520 6966 2074  s DataFrame if t
-00016ff0: 6865 2075 6e66 6f6c 6465 6420 6d65 6173  he unfolded meas
-00017000: 7572 6573 2074 6162 6c65 2063 6f6e 7461  ures table conta
-00017010: 696e 7320 616e 2027 6d6e 5f70 6c61 7974  ins an 'mn_playt
-00017020: 6872 6f75 6768 2720 636f 6c75 6d6e 2c20  hrough' column, 
-00017030: 6f74 6865 7277 6973 6520 6974 0a20 2020  otherwise it.   
-00017040: 2069 7320 6571 7561 6c20 746f 2074 6865   is equal to the
-00017050: 2072 6573 756c 7420 6f66 203a 6675 6e63   result of :func
-00017060: 3a60 6d61 6b65 5f70 6c61 7974 6872 6f75  :`make_playthrou
-00017070: 6768 326d 6360 2e20 4865 6e63 652c 2074  gh2mc`. Hence, t
-00017080: 6865 2070 7572 706f 7365 206f 6620 7468  he purpose of th
-00017090: 6520 6675 6e63 7469 6f6e 2069 7320 746f  e function is to
-000170a0: 2061 6464 2061 6e0a 2020 2020 276d 6e5f   add an.    'mn_
-000170b0: 706c 6179 7468 726f 7567 6827 2063 6f6c  playthrough' col
-000170c0: 756d 6e20 746f 2075 6e66 6f6c 6465 6420  umn to unfolded 
-000170d0: 6661 6365 7473 2077 6865 6e65 7665 7220  facets whenever 
-000170e0: 706f 7373 6962 6c65 2e0a 2020 2020 2222  possible..    ""
-000170f0: 220a 2020 2020 756e 666f 6c64 6564 5f6d  ".    unfolded_m
-00017100: 6561 7375 7265 7320 3d20 756e 666f 6c64  easures = unfold
-00017110: 5f6d 6561 7375 7265 735f 7461 626c 6528  _measures_table(
-00017120: 6d65 6173 7572 6573 2c20 6c6f 6767 6572  measures, logger
-00017130: 3d6c 6f67 6765 7229 0a20 2020 2069 6620  =logger).    if 
-00017140: 756e 666f 6c64 6564 5f6d 6561 7375 7265  unfolded_measure
-00017150: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00017160: 2020 2072 6574 7572 6e0a 2020 2020 756e     return.    un
-00017170: 666f 6c64 6564 5f6d 6561 7375 7265 7320  folded_measures 
-00017180: 3d20 756e 666f 6c64 6564 5f6d 6561 7375  = unfolded_measu
-00017190: 7265 732e 7365 745f 696e 6465 7828 276d  res.set_index('m
-000171a0: 635f 706c 6179 7468 726f 7567 6827 290a  c_playthrough').
-000171b0: 2020 2020 6966 2027 6d6e 5f70 6c61 7974      if 'mn_playt
-000171c0: 6872 6f75 6768 2720 696e 2075 6e66 6f6c  hrough' in unfol
-000171d0: 6465 645f 6d65 6173 7572 6573 2e63 6f6c  ded_measures.col
-000171e0: 756d 6e73 3a0a 2020 2020 2020 2020 7265  umns:.        re
-000171f0: 7475 726e 2075 6e66 6f6c 6465 645f 6d65  turn unfolded_me
-00017200: 6173 7572 6573 5b5b 276d 6327 2c20 276d  asures[['mc', 'm
-00017210: 6e5f 706c 6179 7468 726f 7567 6827 5d5d  n_playthrough']]
-00017220: 0a20 2020 2072 6574 7572 6e20 756e 666f  .    return unfo
-00017230: 6c64 6564 5f6d 6561 7375 7265 732e 6d63  lded_measures.mc
-00017240: 0a0a 0a64 6566 206d 6170 3265 6c65 6d65  ...def map2eleme
-00017250: 6e74 7328 652c 2066 2c20 2a61 7267 732c  nts(e, f, *args,
-00017260: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00017270: 2222 2220 4966 2060 6560 2069 7320 616e  """ If `e` is an
-00017280: 2069 7465 7261 626c 652c 2060 6660 2069   iterable, `f` i
-00017290: 7320 6170 706c 6965 6420 746f 2061 6c6c  s applied to all
-000172a0: 2065 6c65 6d65 6e74 732e 0a20 2020 2022   elements..    "
-000172b0: 2222 0a20 2020 2069 6620 6973 696e 7374  "".    if isinst
-000172c0: 616e 6365 2865 2c20 4974 6572 6162 6c65  ance(e, Iterable
-000172d0: 2920 616e 6420 6e6f 7420 6973 696e 7374  ) and not isinst
-000172e0: 616e 6365 2865 2c20 7374 7229 3a0a 2020  ance(e, str):.  
-000172f0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00017300: 2020 2020 2020 2072 6574 7572 6e20 652e         return e.
-00017310: 5f5f 636c 6173 735f 5f28 6d61 7032 656c  __class__(map2el
-00017320: 656d 656e 7473 2878 2c20 662c 202a 6172  ements(x, f, *ar
-00017330: 6773 2c20 2a2a 6b77 6172 6773 2920 666f  gs, **kwargs) fo
-00017340: 7220 7820 696e 2065 290a 2020 2020 2020  r x in e).      
-00017350: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
-00017360: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00017370: 6966 2069 7369 6e73 7461 6e63 6528 652c  if isinstance(e,
-00017380: 2070 642e 496e 6465 7829 3a0a 2020 2020   pd.Index):.    
-00017390: 2020 2020 2020 2020 2020 2020 2323 2320              ### 
-000173a0: 652e 672e 2c20 6966 2061 206e 756d 6572  e.g., if a numer
-000173b0: 6963 616c 2069 6e64 6578 2069 7320 7472  ical index is tr
-000173c0: 616e 7366 6f72 6d65 6420 746f 2073 7472  ansformed to str
-000173d0: 696e 6773 0a20 2020 2020 2020 2020 2020  ings.           
-000173e0: 2020 2020 2072 6574 7572 6e20 7064 2e49       return pd.I
-000173f0: 6e64 6578 286d 6170 3265 6c65 6d65 6e74  ndex(map2element
-00017400: 7328 782c 2066 2c20 2a61 7267 732c 202a  s(x, f, *args, *
-00017410: 2a6b 7761 7267 7329 2066 6f72 2078 2069  *kwargs) for x i
-00017420: 6e20 6529 0a20 2020 2072 6574 7572 6e20  n e).    return 
-00017430: 6628 652c 202a 6172 6773 2c20 2a2a 6b77  f(e, *args, **kw
-00017440: 6172 6773 290a 0a0a 4066 756e 6374 696f  args)...@functio
-00017450: 6e5f 6c6f 6767 6572 0a64 6566 206d 6572  n_logger.def mer
-00017460: 6765 5f74 6965 7328 6466 2c20 7265 7475  ge_ties(df, retu
-00017470: 726e 5f64 726f 7070 6564 3d46 616c 7365  rn_dropped=False
-00017480: 2c20 7065 7266 6f72 6d5f 6368 6563 6b73  , perform_checks
-00017490: 3d54 7275 6529 3a0a 2020 2020 2222 2220  =True):.    """ 
-000174a0: 496e 2061 206e 6f74 6520 6c69 7374 2c20  In a note list, 
-000174b0: 6d65 7267 6520 7469 6564 206e 6f74 6573  merge tied notes
-000174c0: 2074 6f20 7369 6e67 6c65 2065 7665 6e74   to single event
-000174d0: 7320 7769 7468 2061 6363 756d 756c 6174  s with accumulat
-000174e0: 6564 2064 7572 6174 696f 6e73 2e0a 2020  ed durations..  
-000174f0: 2020 2020 2020 496e 7075 7420 6461 7461        Input data
-00017500: 6672 616d 6520 6e65 6564 7320 636f 6c75  frame needs colu
-00017510: 6d6e 7320 5b27 6475 7261 7469 6f6e 272c  mns ['duration',
-00017520: 2027 7469 6564 272c 2027 6d69 6469 272c   'tied', 'midi',
-00017530: 2027 7374 6166 6627 5d2e 2054 6869 730a   'staff']. This.
-00017540: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
-00017550: 2064 6f65 7320 6e6f 7420 6861 6e64 6c65   does not handle
-00017560: 2063 6f72 7265 6374 6c79 206f 7665 726c   correctly overl
-00017570: 6170 7069 6e67 2074 6965 7320 6f6e 2074  apping ties on t
-00017580: 6865 2073 616d 6520 7069 7463 6820 7369  he same pitch si
-00017590: 6e63 650a 2020 2020 2020 2020 6974 2064  nce.        it d
-000175a0: 6f65 736e 2774 2074 616b 6520 696e 746f  oesn't take into
-000175b0: 2061 6363 6f75 6e74 2074 6865 206e 6f74   account the not
-000175c0: 6174 696f 6e61 6c20 6c61 7965 7273 2028  ational layers (
-000175d0: 2776 6f69 6365 2729 2e0a 0a0a 2020 2020  'voice')....    
-000175e0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-000175f0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6466  ---------.    df
-00017600: 0a20 2020 2072 6574 7572 6e5f 6472 6f70  .    return_drop
-00017610: 7065 640a 0a20 2020 2052 6574 7572 6e73  ped..    Returns
-00017620: 0a20 2020 202d 2d2d 2d2d 2d2d 0a0a 2020  .    -------..  
-00017630: 2020 2222 220a 0a20 2020 2064 6566 206d    """..    def m
-00017640: 6572 6765 2864 6629 3a0a 2020 2020 2020  erge(df):.      
-00017650: 2020 7663 203d 2064 662e 7469 6564 2e76    vc = df.tied.v
-00017660: 616c 7565 5f63 6f75 6e74 7328 290a 2020  alue_counts().  
-00017670: 2020 2020 2020 6966 2076 635b 315d 2021        if vc[1] !
-00017680: 3d20 3120 6f72 2076 635b 2d31 5d20 213d  = 1 or vc[-1] !=
-00017690: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-000176a0: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
-000176b0: 224d 6f72 6520 7468 616e 206f 6e65 2031  "More than one 1
-000176c0: 206f 7220 2d31 3a5c 6e7b 7663 7d22 290a   or -1:\n{vc}").
-000176d0: 2020 2020 2020 2020 6978 203d 2064 662e          ix = df.
-000176e0: 696c 6f63 5b30 5d2e 6e61 6d65 0a20 2020  iloc[0].name.   
-000176f0: 2020 2020 2064 7572 203d 2064 662e 6475       dur = df.du
-00017700: 7261 7469 6f6e 2e73 756d 2829 0a20 2020  ration.sum().   
-00017710: 2020 2020 2064 726f 7020 3d20 6466 2e69       drop = df.i
-00017720: 6c6f 635b 313a 5d2e 696e 6465 782e 746f  loc[1:].index.to
-00017730: 5f6c 6973 7428 290a 2020 2020 2020 2020  _list().        
-00017740: 7265 7475 726e 2070 642e 5365 7269 6573  return pd.Series
-00017750: 287b 2769 7827 3a20 6978 2c20 2764 7572  ({'ix': ix, 'dur
-00017760: 6174 696f 6e27 3a20 6475 722c 2027 6472  ation': dur, 'dr
-00017770: 6f70 7065 6427 3a20 6472 6f70 7d29 0a0a  opped': drop})..
-00017780: 2020 2020 6465 6620 6d65 7267 655f 6e6f      def merge_no
-00017790: 7465 7328 7374 6166 665f 6d69 6469 293a  tes(staff_midi):
-000177a0: 0a0a 2020 2020 2020 2020 7374 6166 665f  ..        staff_
-000177b0: 6d69 6469 5b27 6368 756e 6b73 275d 203d  midi['chunks'] =
-000177c0: 2028 7374 6166 665f 6d69 6469 2e74 6965   (staff_midi.tie
-000177d0: 6420 3d3d 2031 292e 6173 7479 7065 2869  d == 1).astype(i
-000177e0: 6e74 292e 6375 6d73 756d 2829 0a20 2020  nt).cumsum().   
-000177f0: 2020 2020 2074 203d 2073 7461 6666 5f6d       t = staff_m
-00017800: 6964 692e 6772 6f75 7062 7928 2763 6875  idi.groupby('chu
-00017810: 6e6b 7327 2c20 6772 6f75 705f 6b65 7973  nks', group_keys
-00017820: 3d46 616c 7365 292e 6170 706c 7928 6d65  =False).apply(me
-00017830: 7267 6529 0a20 2020 2020 2020 2072 6574  rge).        ret
-00017840: 7572 6e20 742e 7365 745f 696e 6465 7828  urn t.set_index(
-00017850: 2769 7827 290a 0a20 2020 2069 6620 6e6f  'ix')..    if no
-00017860: 7420 6466 2e74 6965 642e 6e6f 746e 6128  t df.tied.notna(
-00017870: 292e 616e 7928 293a 0a20 2020 2020 2020  ).any():.       
-00017880: 2072 6574 7572 6e20 6466 0a20 2020 2064   return df.    d
-00017890: 6620 3d20 6466 2e63 6f70 7928 290a 2020  f = df.copy().  
-000178a0: 2020 6e6f 746e 6120 3d20 6466 2e6c 6f63    notna = df.loc
-000178b0: 5b64 662e 7469 6564 2e6e 6f74 6e61 2829  [df.tied.notna()
-000178c0: 2c20 5b27 6475 7261 7469 6f6e 272c 2027  , ['duration', '
-000178d0: 7469 6564 272c 2027 6d69 6469 272c 2027  tied', 'midi', '
-000178e0: 7374 6166 6627 5d5d 0a20 2020 2069 6620  staff']].    if 
-000178f0: 7065 7266 6f72 6d5f 6368 6563 6b73 3a0a  perform_checks:.
-00017900: 2020 2020 2020 2020 6265 666f 7265 203d          before =
-00017910: 206e 6f74 6e61 2e74 6965 642e 7661 6c75   notna.tied.valu
-00017920: 655f 636f 756e 7473 2829 0a20 2020 206e  e_counts().    n
-00017930: 6577 5f64 7572 203d 206e 6f74 6e61 2e67  ew_dur = notna.g
-00017940: 726f 7570 6279 285b 2773 7461 6666 272c  roupby(['staff',
-00017950: 2027 6d69 6469 275d 2c20 6772 6f75 705f   'midi'], group_
-00017960: 6b65 7973 3d46 616c 7365 292e 6170 706c  keys=False).appl
-00017970: 7928 6d65 7267 655f 6e6f 7465 7329 2e73  y(merge_notes).s
-00017980: 6f72 745f 696e 6465 7828 290a 2020 2020  ort_index().    
-00017990: 7472 793a 0a20 2020 2020 2020 2064 662e  try:.        df.
-000179a0: 6c6f 635b 6e65 775f 6475 722e 696e 6465  loc[new_dur.inde
-000179b0: 782c 2027 6475 7261 7469 6f6e 275d 203d  x, 'duration'] =
-000179c0: 206e 6577 5f64 7572 2e64 7572 6174 696f   new_dur.duratio
-000179d0: 6e0a 2020 2020 6578 6365 7074 2045 7863  n.    except Exc
-000179e0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-000179f0: 7072 696e 7428 6e65 775f 6475 7229 0a20  print(new_dur). 
-00017a00: 2020 2069 6620 7265 7475 726e 5f64 726f     if return_dro
-00017a10: 7070 6564 3a0a 2020 2020 2020 2020 6466  pped:.        df
-00017a20: 2e6c 6f63 5b6e 6577 5f64 7572 2e69 6e64  .loc[new_dur.ind
-00017a30: 6578 2c20 2764 726f 7070 6564 275d 203d  ex, 'dropped'] =
-00017a40: 206e 6577 5f64 7572 2e64 726f 7070 6564   new_dur.dropped
-00017a50: 0a20 2020 2064 6620 3d20 6466 2e64 726f  .    df = df.dro
-00017a60: 7028 6e65 775f 6475 722e 6472 6f70 7065  p(new_dur.droppe
-00017a70: 642e 7375 6d28 2929 0a20 2020 2069 6620  d.sum()).    if 
-00017a80: 7065 7266 6f72 6d5f 6368 6563 6b73 3a0a  perform_checks:.
-00017a90: 2020 2020 2020 2020 6166 7465 7220 3d20          after = 
-00017aa0: 6466 2e74 6965 642e 7661 6c75 655f 636f  df.tied.value_co
-00017ab0: 756e 7473 2829 0a20 2020 2020 2020 2061  unts().        a
-00017ac0: 7373 6572 7420 6265 666f 7265 5b31 5d20  ssert before[1] 
-00017ad0: 3d3d 2061 6674 6572 5b31 5d2c 2066 2245  == after[1], f"E
-00017ae0: 7272 6f72 2077 6869 6c65 206d 6572 6769  rror while mergi
-00017af0: 6e67 2074 6965 732e 2042 6566 6f72 653a  ng ties. Before:
-00017b00: 5c6e 7b62 6566 6f72 657d 5c6e 4166 7465  \n{before}\nAfte
-00017b10: 723a 5c6e 7b61 6674 6572 7d22 0a20 2020  r:\n{after}".   
-00017b20: 2072 6574 7572 6e20 6466 0a0a 6465 6620   return df..def 
-00017b30: 6d65 7267 655f 6368 6f72 6473 5f61 6e64  merge_chords_and
-00017b40: 5f6e 6f74 6573 2863 686f 7264 735f 7461  _notes(chords_ta
-00017b50: 626c 653a 2070 642e 4461 7461 4672 616d  ble: pd.DataFram
-00017b60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00017b70: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00017b80: 7465 735f 7461 626c 653a 2070 642e 4461  tes_table: pd.Da
-00017b90: 7461 4672 616d 6529 202d 3e20 7064 2e44  taFrame) -> pd.D
-00017ba0: 6174 6146 7261 6d65 3a0a 2020 2020 2222  ataFrame:.    ""
-00017bb0: 2250 6572 666f 726d 7320 616e 206f 7574  "Performs an out
-00017bc0: 6572 206a 6f69 6e20 6265 7477 6565 6e20  er join between 
-00017bd0: 6120 6368 6f72 6473 2074 6162 6c65 2061  a chords table a
-00017be0: 6e64 2061 206e 6f74 6573 2074 6162 6c65  nd a notes table
-00017bf0: 2c20 6261 7365 6420 6f6e 2074 6865 2063  , based on the c
-00017c00: 6f6c 756d 6e20 2763 686f 7264 5f69 6427  olumn 'chord_id'
-00017c10: 2e20 4966 2074 6865 2063 686f 7264 730a  . If the chords.
-00017c20: 2020 2020 636f 6d65 2077 6974 6820 616e      come with an
-00017c30: 2027 6576 656e 7427 2063 6f6c 756d 6e2c   'event' column,
-00017c40: 2061 6c6c 2063 686f 7264 2065 7665 6e74   all chord event
-00017c50: 7320 6d61 7463 6865 6420 7769 7468 2061  s matched with a
-00017c60: 7420 6c65 6173 7420 6f6e 6520 6e6f 7465  t least one note
-00017c70: 2077 696c 6c20 6265 2072 656e 616d 6564   will be renamed
-00017c80: 2074 6f20 274e 6f74 6527 2e0a 2020 2020   to 'Note'..    
-00017c90: 4d61 726b 7570 2064 6973 706c 6179 6564  Markup displayed
-00017ca0: 2069 6e20 696e 6469 7669 6475 616c 2072   in individual r
-00017cb0: 6f77 7320 2827 4479 6e61 6d69 6327 2c20  ows ('Dynamic', 
-00017cc0: 2753 7061 6e6e 6572 272c 2027 5374 6166  'Spanner', 'Staf
-00017cd0: 6654 6578 7427 2c20 2753 7973 7465 6d54  fText', 'SystemT
-00017ce0: 6578 7427 2c20 2754 656d 706f 272c 2027  ext', 'Tempo', '
-00017cf0: 4669 6775 7265 6442 6173 7327 292c 0a20  FiguredBass'),. 
-00017d00: 2020 2061 7265 2f72 656d 6169 6e20 706c     are/remain pl
-00017d10: 6163 6564 2062 6566 6f72 6520 7468 6520  aced before the 
-00017d20: 6e6f 7465 2873 2920 7769 7468 2074 6865  note(s) with the
-00017d30: 2073 616d 6520 6f6e 7365 742e 0a20 2020   same onset..   
-00017d40: 204d 6172 6b75 7020 7368 6f77 696e 6720   Markup showing 
-00017d50: 7570 2069 6e20 6120 4368 6f72 6420 6576  up in a Chord ev
-00017d60: 656e 7427 7320 726f 7720 2865 2e67 2e20  ent's row (e.g. 
-00017d70: 6120 5370 616e 6e65 7220 4944 2920 7769  a Spanner ID) wi
-00017d80: 6c6c 2062 6520 6475 706c 6963 6174 6564  ll be duplicated
-00017d90: 2066 6f72 2065 6163 6820 6e6f 7465 2070   for each note p
-00017da0: 6572 7461 696e 696e 6720 746f 2074 6861  ertaining to tha
-00017db0: 7420 6368 6f72 642c 0a20 2020 2069 2e65  t chord,.    i.e
-00017dc0: 2e2c 206f 6e6c 7920 666f 7220 6e6f 7465  ., only for note
-00017dd0: 7320 696e 2074 6865 2073 616d 6520 7374  s in the same st
-00017de0: 6166 6620 616e 6420 766f 6963 652e 0a0a  aff and voice...
-00017df0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00017e00: 6368 6f72 6473 5f74 6162 6c65 3a0a 2020  chords_table:.  
-00017e10: 2020 2020 6e6f 7465 735f 7461 626c 653a      notes_table:
-00017e20: 0a0a 2020 2020 5265 7475 726e 733a 0a20  ..    Returns:. 
-00017e30: 2020 2020 204d 6572 6765 6420 4461 7461       Merged Data
-00017e40: 4672 616d 652e 0a20 2020 2022 2222 0a20  Frame..    """. 
-00017e50: 2020 206e 6f74 6573 5f63 6f6c 756d 6e73     notes_columns
-00017e60: 203d 205b 2774 6965 6427 2c20 2774 7063   = ['tied', 'tpc
-00017e70: 272c 2027 6d69 6469 272c 2027 6e61 6d65  ', 'midi', 'name
-00017e80: 272c 2027 6f63 7461 7665 272c 2027 6368  ', 'octave', 'ch
-00017e90: 6f72 645f 6964 275d 2023 2027 6772 6163  ord_id'] # 'grac
-00017ea0: 656e 6f74 6527 2c20 2774 7265 6d6f 6c6f  enote', 'tremolo
-00017eb0: 2720 776f 756c 6420 6265 2063 6f6e 7461  ' would be conta
-00017ec0: 696e 6564 2069 6e20 6368 6f72 6473 2061  ined in chords a
-00017ed0: 6c72 6561 6479 0a20 2020 2070 7265 7365  lready.    prese
-00017ee0: 6e74 5f63 6f6c 756d 6e73 203d 205b 636f  nt_columns = [co
-00017ef0: 6c20 666f 7220 636f 6c20 696e 206e 6f74  l for col in not
-00017f00: 6573 5f63 6f6c 756d 6e73 2069 6620 636f  es_columns if co
-00017f10: 6c20 696e 206e 6f74 6573 5f74 6162 6c65  l in notes_table
-00017f20: 5d0a 2020 2020 6173 7365 7274 2027 6368  ].    assert 'ch
-00017f30: 6f72 645f 6964 2720 696e 2070 7265 7365  ord_id' in prese
-00017f40: 6e74 5f63 6f6c 756d 6e73 2c20 6622 4e6f  nt_columns, f"No
-00017f50: 7465 7320 7461 626c 6520 646f 6573 206e  tes table does n
-00017f60: 6f74 2063 6f6d 6520 7769 7468 2061 2027  ot come with a '
-00017f70: 6368 6f72 645f 6964 2720 636f 6c75 6d6e  chord_id' column
-00017f80: 206e 6565 6465 6420 666f 7220 6d65 7267   needed for merg
-00017f90: 696e 673a 207b 6e6f 7465 735f 7461 626c  ing: {notes_tabl
-00017fa0: 652e 636f 6c75 6d6e 737d 220a 2020 2020  e.columns}".    
-00017fb0: 6e6f 7465 7320 3d20 6e6f 7465 735f 7461  notes = notes_ta
-00017fc0: 626c 655b 7072 6573 656e 745f 636f 6c75  ble[present_colu
-00017fd0: 6d6e 735d 2e61 7374 7970 6528 7b27 6368  mns].astype({'ch
-00017fe0: 6f72 645f 6964 273a 2027 496e 7436 3427  ord_id': 'Int64'
-00017ff0: 7d29 0a20 2020 2061 6d65 6e64 5f65 7665  }).    amend_eve
-00018000: 6e74 7320 3d20 2765 7665 6e74 2720 696e  nts = 'event' in
-00018010: 2063 686f 7264 735f 7461 626c 650a 2020   chords_table.  
-00018020: 2020 6d65 7267 6564 203d 2070 642e 6d65    merged = pd.me
-00018030: 7267 6528 6368 6f72 6473 5f74 6162 6c65  rge(chords_table
-00018040: 2c20 6e6f 7465 732c 206f 6e3d 2763 686f  , notes, on='cho
-00018050: 7264 5f69 6427 2c20 686f 773d 276f 7574  rd_id', how='out
-00018060: 6572 272c 2069 6e64 6963 6174 6f72 3d61  er', indicator=a
-00018070: 6d65 6e64 5f65 7665 6e74 7329 0a20 2020  mend_events).   
-00018080: 206d 6572 6765 6420 3d20 736f 7274 5f6e   merged = sort_n
-00018090: 6f74 655f 6c69 7374 286d 6572 6765 6429  ote_list(merged)
-000180a0: 0a20 2020 2069 6620 616d 656e 645f 6576  .    if amend_ev
-000180b0: 656e 7473 3a0a 2020 2020 2020 2020 6d61  ents:.        ma
-000180c0: 7463 6865 735f 6d61 736b 203d 206d 6572  tches_mask = mer
-000180d0: 6765 642e 5f6d 6572 6765 203d 3d20 2762  ged._merge == 'b
-000180e0: 6f74 6827 0a20 2020 2020 2020 206d 6572  oth'.        mer
-000180f0: 6765 642e 6c6f 635b 6d61 7463 6865 735f  ged.loc[matches_
-00018100: 6d61 736b 2c20 2765 7665 6e74 275d 203d  mask, 'event'] =
-00018110: 2027 4e6f 7465 270a 2020 2020 2020 2020   'Note'.        
-00018120: 6d65 7267 6564 2e64 726f 7028 636f 6c75  merged.drop(colu
-00018130: 6d6e 733d 275f 6d65 7267 6527 2c20 696e  mns='_merge', in
-00018140: 706c 6163 653d 5472 7565 290a 2020 2020  place=True).    
-00018150: 7265 7475 726e 206d 6572 6765 640a 0a64  return merged..d
-00018160: 6566 206d 6574 6164 6174 6132 7365 7269  ef metadata2seri
-00018170: 6573 2864 3a20 6469 6374 2920 2d3e 2070  es(d: dict) -> p
-00018180: 642e 5365 7269 6573 3a0a 2020 2020 2222  d.Series:.    ""
-00018190: 2220 5475 726e 7320 6120 6d65 7461 6461  " Turns a metada
-000181a0: 7461 2064 6963 7420 696e 746f 2061 2070  ta dict into a p
-000181b0: 642e 5365 7269 6573 2829 2028 666f 7220  d.Series() (for 
-000181c0: 7374 6f72 696e 6720 696e 2061 2044 6174  storing in a Dat
-000181d0: 6146 7261 6d65 290a 2020 2020 5573 6573  aFrame).    Uses
-000181e0: 3a20 616d 6269 7475 7332 6f6e 656c 696e  : ambitus2onelin
-000181f0: 6572 2829 2c20 6469 6374 326f 6e65 6c69  er(), dict2oneli
-00018200: 6e65 7228 292c 2070 6172 7473 5f69 6e66  ner(), parts_inf
-00018210: 6f28 290a 0a20 2020 2052 6574 7572 6e73  o()..    Returns
-00018220: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-00018230: 203a 6f62 6a3a 6070 616e 6461 732e 5365   :obj:`pandas.Se
-00018240: 7269 6573 600a 2020 2020 2020 2020 4120  ries`.        A 
-00018250: 7365 7269 6573 2061 6c6c 6f77 696e 6720  series allowing 
-00018260: 666f 7220 7374 6f72 696e 6720 6d65 7461  for storing meta
-00018270: 6461 7461 2061 7320 6120 726f 7720 6f66  data as a row of
-00018280: 2061 2044 6174 6146 7261 6d65 2e0a 2020   a DataFrame..  
-00018290: 2020 2222 220a 2020 2020 6420 3d20 6469    """.    d = di
-000182a0: 6374 2864 290a 2020 2020 645b 2754 696d  ct(d).    d['Tim
-000182b0: 6553 6967 275d 203d 2064 6963 7432 6f6e  eSig'] = dict2on
-000182c0: 656c 696e 6572 2864 5b27 5469 6d65 5369  eliner(d['TimeSi
-000182d0: 6727 5d29 0a20 2020 2064 5b27 4b65 7953  g']).    d['KeyS
-000182e0: 6967 275d 203d 2064 6963 7432 6f6e 656c  ig'] = dict2onel
-000182f0: 696e 6572 2864 5b27 4b65 7953 6967 275d  iner(d['KeySig']
-00018300: 290a 2020 2020 6966 2027 616d 6269 7475  ).    if 'ambitu
-00018310: 7327 2069 6e20 643a 0a20 2020 2020 2020  s' in d:.       
-00018320: 2064 5b27 616d 6269 7475 7327 5d20 3d20   d['ambitus'] = 
-00018330: 616d 6269 7475 7332 6f6e 656c 696e 6572  ambitus2oneliner
-00018340: 2864 5b27 616d 6269 7475 7327 5d29 0a20  (d['ambitus']). 
-00018350: 2020 2069 6620 2770 6172 7473 2720 696e     if 'parts' in
-00018360: 2064 3a0a 2020 2020 2020 2020 642e 7570   d:.        d.up
-00018370: 6461 7465 2870 6172 7473 5f69 6e66 6f28  date(parts_info(
-00018380: 645b 2770 6172 7473 275d 2929 0a20 2020  d['parts'])).   
-00018390: 2020 2020 2064 656c 2028 645b 2770 6172       del (d['par
-000183a0: 7473 275d 290a 2020 2020 7320 3d20 7064  ts']).    s = pd
-000183b0: 2e53 6572 6965 7328 6429 0a20 2020 2072  .Series(d).    r
-000183c0: 6574 7572 6e20 730a 0a40 6f76 6572 6c6f  eturn s..@overlo
-000183d0: 6164 0a64 6566 206d 6964 695f 616e 645f  ad.def midi_and_
-000183e0: 7470 6332 6f63 7461 7665 286d 6964 693a  tpc2octave(midi:
-000183f0: 2069 6e74 2c20 7470 633a 2069 6e74 2920   int, tpc: int) 
-00018400: 2d3e 2069 6e74 3a0a 2020 2020 2e2e 2e0a  -> int:.    ....
-00018410: 406f 7665 726c 6f61 640a 6465 6620 6d69  @overload.def mi
-00018420: 6469 5f61 6e64 5f74 7063 326f 6374 6176  di_and_tpc2octav
-00018430: 6528 6d69 6469 3a20 7064 2e53 6572 6965  e(midi: pd.Serie
-00018440: 732c 2074 7063 3a20 7064 2e53 6572 6965  s, tpc: pd.Serie
-00018450: 7329 202d 3e20 7064 2e53 6572 6965 733a  s) -> pd.Series:
-00018460: 0a20 2020 202e 2e2e 0a40 6f76 6572 6c6f  .    ....@overlo
-00018470: 6164 0a64 6566 206d 6964 695f 616e 645f  ad.def midi_and_
-00018480: 7470 6332 6f63 7461 7665 286d 6964 693a  tpc2octave(midi:
-00018490: 204e 4441 7272 6179 5b69 6e74 5d2c 2074   NDArray[int], t
-000184a0: 7063 3a20 4e44 4172 7261 795b 696e 745d  pc: NDArray[int]
-000184b0: 2920 2d3e 204e 4441 7272 6179 5b69 6e74  ) -> NDArray[int
-000184c0: 5d3a 0a20 2020 202e 2e2e 0a40 6f76 6572  ]:.    ....@over
-000184d0: 6c6f 6164 0a64 6566 206d 6964 695f 616e  load.def midi_an
-000184e0: 645f 7470 6332 6f63 7461 7665 286d 6964  d_tpc2octave(mid
-000184f0: 693a 204c 6973 745b 696e 745d 2c20 7470  i: List[int], tp
-00018500: 633a 204c 6973 745b 696e 745d 2920 2d3e  c: List[int]) ->
-00018510: 204c 6973 745b 696e 745d 3a0a 2020 2020   List[int]:.    
-00018520: 2e2e 2e0a 406f 7665 726c 6f61 640a 6465  ....@overload.de
-00018530: 6620 6d69 6469 5f61 6e64 5f74 7063 326f  f midi_and_tpc2o
-00018540: 6374 6176 6528 6d69 6469 3a20 2054 7570  ctave(midi:  Tup
-00018550: 6c65 5b69 6e74 5d2c 2074 7063 3a20 2054  le[int], tpc:  T
-00018560: 7570 6c65 5b69 6e74 5d29 202d 3e20 5475  uple[int]) -> Tu
-00018570: 706c 655b 696e 745d 3a0a 2020 2020 2e2e  ple[int]:.    ..
-00018580: 2e0a 6465 6620 6d69 6469 5f61 6e64 5f74  ..def midi_and_t
-00018590: 7063 326f 6374 6176 6528 6d69 6469 3a20  pc2octave(midi: 
-000185a0: 556e 696f 6e5b 696e 742c 2070 642e 5365  Union[int, pd.Se
-000185b0: 7269 6573 2c20 4e44 4172 7261 795b 696e  ries, NDArray[in
-000185c0: 745d 2c20 4c69 7374 5b69 6e74 5d2c 2054  t], List[int], T
-000185d0: 7570 6c65 5b69 6e74 5d5d 2c0a 2020 2020  uple[int]],.    
-000185e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185f0: 2020 2020 7470 633a 2055 6e69 6f6e 5b69      tpc: Union[i
-00018600: 6e74 2c20 7064 2e53 6572 6965 732c 204e  nt, pd.Series, N
-00018610: 4441 7272 6179 5b69 6e74 5d2c 204c 6973  DArray[int], Lis
-00018620: 745b 696e 745d 2c20 5475 706c 655b 696e  t[int], Tuple[in
-00018630: 745d 5d29 202d 3e20 556e 696f 6e5b 696e  t]]) -> Union[in
-00018640: 742c 2070 642e 5365 7269 6573 2c20 4e44  t, pd.Series, ND
-00018650: 4172 7261 795b 696e 745d 2c20 4c69 7374  Array[int], List
-00018660: 5b69 6e74 5d2c 2054 7570 6c65 5b69 6e74  [int], Tuple[int
-00018670: 5d5d 3a0a 2020 2020 7472 793a 0a20 2020  ]]:.    try:.   
-00018680: 2020 2020 206d 6964 6920 3d20 696e 7428       midi = int(
-00018690: 666c 6f61 7428 6d69 6469 2929 0a20 2020  float(midi)).   
-000186a0: 2065 7863 6570 7420 5479 7065 4572 726f   except TypeErro
-000186b0: 723a 0a20 2020 2020 2020 2074 7279 3a0a  r:.        try:.
-000186c0: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-000186d0: 206e 756d 7079 2061 7272 6179 206f 7220   numpy array or 
-000186e0: 5061 6e64 6173 2053 6572 6965 732c 2063  Pandas Series, c
-000186f0: 6f6d 7075 7465 2076 6563 746f 7269 7a65  ompute vectorize
-00018700: 642c 206f 7468 6572 7769 7365 2069 7465  d, otherwise ite
-00018710: 7261 7465 0a20 2020 2020 2020 2020 2020  rate.           
-00018720: 206d 6964 692e 6474 7970 650a 2020 2020   midi.dtype.    
-00018730: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
-00018740: 6275 7465 4572 726f 723a 0a20 2020 2020  buteError:.     
-00018750: 2020 2020 2020 2072 6574 7572 6e20 6d69         return mi
-00018760: 6469 2e5f 5f63 6c61 7373 5f5f 286d 6964  di.__class__(mid
-00018770: 695f 616e 645f 7470 6332 6f63 7461 7665  i_and_tpc2octave
-00018780: 286d 2c20 7429 2066 6f72 206d 2c20 7420  (m, t) for m, t 
-00018790: 696e 207a 6970 286d 6964 692c 2074 7063  in zip(midi, tpc
-000187a0: 2929 0a20 2020 2061 6363 203d 2074 7063  )).    acc = tpc
-000187b0: 202f 2f20 370a 2020 2020 7265 7475 726e   // 7.    return
-000187c0: 2028 6d69 6469 202d 2061 6363 2920 2f2f   (midi - acc) //
-000187d0: 2031 3220 2d20 310a 0a40 6f76 6572 6c6f   12 - 1..@overlo
-000187e0: 6164 0a64 6566 206d 6964 6932 6f63 7461  ad.def midi2octa
-000187f0: 7665 286d 6964 693a 2069 6e74 2c20 6669  ve(midi: int, fi
-00018800: 6674 6873 3a20 4f70 7469 6f6e 616c 5b69  fths: Optional[i
-00018810: 6e74 5d29 202d 3e20 696e 743a 0a20 2020  nt]) -> int:.   
-00018820: 202e 2e2e 0a40 6f76 6572 6c6f 6164 0a64   ....@overload.d
-00018830: 6566 206d 6964 6932 6f63 7461 7665 286d  ef midi2octave(m
-00018840: 6964 693a 2070 642e 5365 7269 6573 2c20  idi: pd.Series, 
-00018850: 6669 6674 6873 3a20 4f70 7469 6f6e 616c  fifths: Optional
-00018860: 5b70 642e 5365 7269 6573 5d29 202d 3e20  [pd.Series]) -> 
-00018870: 7064 2e53 6572 6965 733a 0a20 2020 202e  pd.Series:.    .
-00018880: 2e2e 0a40 6f76 6572 6c6f 6164 0a64 6566  ...@overload.def
-00018890: 206d 6964 6932 6f63 7461 7665 286d 6964   midi2octave(mid
-000188a0: 693a 204e 4441 7272 6179 5b69 6e74 5d2c  i: NDArray[int],
-000188b0: 2066 6966 7468 733a 204f 7074 696f 6e61   fifths: Optiona
-000188c0: 6c5b 4e44 4172 7261 795d 2920 2d3e 204e  l[NDArray]) -> N
-000188d0: 4441 7272 6179 5b69 6e74 5d3a 0a20 2020  DArray[int]:.   
-000188e0: 202e 2e2e 0a40 6f76 6572 6c6f 6164 0a64   ....@overload.d
-000188f0: 6566 206d 6964 6932 6f63 7461 7665 286d  ef midi2octave(m
-00018900: 6964 693a 204c 6973 745b 696e 745d 2c20  idi: List[int], 
-00018910: 6669 6674 6873 3a20 4f70 7469 6f6e 616c  fifths: Optional
-00018920: 5b4c 6973 745b 696e 745d 5d29 202d 3e20  [List[int]]) -> 
-00018930: 4c69 7374 5b69 6e74 5d3a 0a20 2020 202e  List[int]:.    .
-00018940: 2e2e 0a40 6f76 6572 6c6f 6164 0a64 6566  ...@overload.def
-00018950: 206d 6964 6932 6f63 7461 7665 286d 6964   midi2octave(mid
-00018960: 693a 2020 5475 706c 655b 696e 745d 2c20  i:  Tuple[int], 
-00018970: 6669 6674 6873 3a20 4f70 7469 6f6e 616c  fifths: Optional
-00018980: 5b54 7570 6c65 5b69 6e74 5d5d 2920 2d3e  [Tuple[int]]) ->
-00018990: 2054 7570 6c65 5b69 6e74 5d3a 0a20 2020   Tuple[int]:.   
-000189a0: 202e 2e2e 0a64 6566 206d 6964 6932 6f63   ....def midi2oc
-000189b0: 7461 7665 286d 6964 693a 2055 6e69 6f6e  tave(midi: Union
-000189c0: 5b69 6e74 2c20 7064 2e53 6572 6965 732c  [int, pd.Series,
-000189d0: 204e 4441 7272 6179 5b69 6e74 5d2c 204c   NDArray[int], L
-000189e0: 6973 745b 696e 745d 2c20 5475 706c 655b  ist[int], Tuple[
-000189f0: 696e 745d 5d2c 0a20 2020 2020 2020 2020  int]],.         
-00018a00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00018a10: 6966 7468 733a 204f 7074 696f 6e61 6c5b  ifths: Optional[
-00018a20: 556e 696f 6e5b 696e 742c 2070 642e 5365  Union[int, pd.Se
-00018a30: 7269 6573 2c20 4e44 4172 7261 795b 696e  ries, NDArray[in
-00018a40: 745d 2c20 4c69 7374 5b69 6e74 5d2c 2054  t], List[int], T
-00018a50: 7570 6c65 5b69 6e74 5d5d 5d20 3d20 4e6f  uple[int]]] = No
-00018a60: 6e65 2920 2d3e 2055 6e69 6f6e 5b69 6e74  ne) -> Union[int
-00018a70: 2c20 7064 2e53 6572 6965 732c 204e 4441  , pd.Series, NDA
-00018a80: 7272 6179 5b69 6e74 5d2c 204c 6973 745b  rray[int], List[
-00018a90: 696e 745d 2c20 5475 706c 655b 696e 745d  int], Tuple[int]
-00018aa0: 5d3a 0a20 2020 2022 2222 2046 6f72 2061  ]:.    """ For a
-00018ab0: 2067 6976 656e 204d 4944 4920 7069 7463   given MIDI pitc
-00018ac0: 682c 2063 616c 6375 6c61 7465 2074 6865  h, calculate the
-00018ad0: 206f 6374 6176 652e 204d 6964 646c 6520   octave. Middle 
-00018ae0: 6f63 7461 7665 203d 2034 0a20 2020 2020  octave = 4.     
-00018af0: 2020 2055 7365 733a 206d 6964 695f 616e     Uses: midi_an
-00018b00: 645f 7470 6332 6f63 7461 7665 2829 2c20  d_tpc2octave(), 
-00018b10: 6d61 7032 656c 656d 656e 7473 2829 0a0a  map2elements()..
-00018b20: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00018b30: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00018b40: 2020 6d69 6469 203a 203a 6f62 6a3a 6069    midi : :obj:`i
-00018b50: 6e74 600a 2020 2020 2020 2020 4d49 4449  nt`.        MIDI
-00018b60: 2070 6974 6368 2028 706f 7369 7469 7665   pitch (positive
-00018b70: 2069 6e74 6567 6572 290a 2020 2020 6669   integer).    fi
-00018b80: 6674 6873 203a 203a 6f62 6a3a 6069 6e74  fths : :obj:`int
-00018b90: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
-00018ba0: 2020 2020 546f 2062 6520 7072 6563 6973      To be precis
-00018bb0: 652c 2066 6f72 2073 6f6d 6520 546f 6e61  e, for some Tona
-00018bc0: 6c20 5069 7463 6820 436c 6173 7365 732c  l Pitch Classes,
-00018bd0: 2074 6865 206f 6374 6176 6520 6465 7669   the octave devi
-00018be0: 6174 6573 0a20 2020 2020 2020 2066 726f  ates.        fro
-00018bf0: 6d20 7468 6520 7369 6d70 6c65 2066 6f72  m the simple for
-00018c00: 6d75 6c61 2060 604d 4944 4920 2f2f 2031  mula ``MIDI // 1
-00018c10: 3220 2d20 3160 602c 2065 2e67 2e20 666f  2 - 1``, e.g. fo
-00018c20: 7220 4223 206f 7220 4362 2e0a 2020 2020  r B# or Cb..    
-00018c30: 2222 220a 2020 2020 6966 2066 6966 7468  """.    if fifth
-00018c40: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
-00018c50: 2020 2020 2020 2072 6574 7572 6e20 6d69         return mi
-00018c60: 6469 5f61 6e64 5f74 7063 326f 6374 6176  di_and_tpc2octav
-00018c70: 6528 6d69 6469 2c20 6669 6674 6873 290a  e(midi, fifths).
-00018c80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00018c90: 206d 6964 6920 3d20 696e 7428 666c 6f61   midi = int(floa
-00018ca0: 7428 6d69 6469 2929 0a20 2020 2065 7863  t(midi)).    exc
-00018cb0: 6570 7420 5479 7065 4572 726f 723a 0a20  ept TypeError:. 
-00018cc0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00018cd0: 2020 2020 2020 2020 2320 6966 206e 756d          # if num
-00018ce0: 7079 2061 7272 6179 206f 7220 5061 6e64  py array or Pand
-00018cf0: 6173 2053 6572 6965 732c 2063 6f6d 7075  as Series, compu
-00018d00: 7465 2076 6563 746f 7269 7a65 642c 206f  te vectorized, o
-00018d10: 7468 6572 7769 7365 2069 7465 7261 7465  therwise iterate
-00018d20: 0a20 2020 2020 2020 2020 2020 206d 6964  .            mid
-00018d30: 692e 6474 7970 650a 2020 2020 2020 2020  i.dtype.        
-00018d40: 6578 6365 7074 2041 7474 7269 6275 7465  except Attribute
-00018d50: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-00018d60: 2020 2072 6574 7572 6e20 6d61 7032 656c     return map2el
-00018d70: 656d 656e 7473 286d 6964 692c 206d 6964  ements(midi, mid
-00018d80: 6932 6f63 7461 7665 290a 2020 2020 7265  i2octave).    re
-00018d90: 7475 726e 206d 6964 6920 2f2f 2031 3220  turn midi // 12 
-00018da0: 2d20 310a 0a0a 6465 6620 6d69 6469 326e  - 1...def midi2n
-00018db0: 616d 6528 6d69 6469 293a 0a20 2020 2074  ame(midi):.    t
-00018dc0: 7279 3a0a 2020 2020 2020 2020 6d69 6469  ry:.        midi
-00018dd0: 203d 2069 6e74 2866 6c6f 6174 286d 6964   = int(float(mid
-00018de0: 6929 290a 2020 2020 6578 6365 7074 2045  i)).    except E
-00018df0: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-00018e00: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00018e10: 6d69 6469 2c20 7064 2e53 6572 6965 7329  midi, pd.Series)
-00018e20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00018e30: 7475 726e 2074 7261 6e73 666f 726d 286d  turn transform(m
-00018e40: 6964 692c 206d 6964 6932 6e61 6d65 290a  idi, midi2name).
-00018e50: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00018e60: 7461 6e63 6528 6d69 6469 2c20 4974 6572  tance(midi, Iter
-00018e70: 6162 6c65 293a 0a20 2020 2020 2020 2020  able):.         
-00018e80: 2020 2072 6574 7572 6e20 6d61 7032 656c     return map2el
-00018e90: 656d 656e 7473 286d 6964 692c 206d 6964  ements(midi, mid
-00018ea0: 6932 6e61 6d65 290a 2020 2020 2020 2020  i2name).        
-00018eb0: 7265 7475 726e 206d 6964 690a 2020 2020  return midi.    
-00018ec0: 6e61 6d65 7320 3d20 7b30 3a20 2743 272c  names = {0: 'C',
-00018ed0: 0a20 2020 2020 2020 2020 2020 2020 313a  .             1:
-00018ee0: 2027 4323 2f44 6227 2c0a 2020 2020 2020   'C#/Db',.      
-00018ef0: 2020 2020 2020 2032 3a20 2744 272c 0a20         2: 'D',. 
-00018f00: 2020 2020 2020 2020 2020 2020 333a 2027              3: '
-00018f10: 4423 2f45 6227 2c0a 2020 2020 2020 2020  D#/Eb',.        
-00018f20: 2020 2020 2034 3a20 2745 272c 0a20 2020       4: 'E',.   
-00018f30: 2020 2020 2020 2020 2020 353a 2027 4627            5: 'F'
-00018f40: 2c0a 2020 2020 2020 2020 2020 2020 2036  ,.             6
-00018f50: 3a20 2746 232f 4762 272c 0a20 2020 2020  : 'F#/Gb',.     
-00018f60: 2020 2020 2020 2020 373a 2027 4727 2c0a          7: 'G',.
-00018f70: 2020 2020 2020 2020 2020 2020 2038 3a20               8: 
-00018f80: 2747 232f 4162 272c 0a20 2020 2020 2020  'G#/Ab',.       
-00018f90: 2020 2020 2020 393a 2027 4127 2c0a 2020        9: 'A',.  
-00018fa0: 2020 2020 2020 2020 2020 2031 303a 2027             10: '
-00018fb0: 4123 2f42 6227 2c0a 2020 2020 2020 2020  A#/Bb',.        
-00018fc0: 2020 2020 2031 313a 2027 4227 7d0a 2020       11: 'B'}.  
-00018fd0: 2020 7265 7475 726e 206e 616d 6573 5b6d    return names[m
-00018fe0: 6964 6920 2520 3132 5d0a 0a0a 6465 6620  idi % 12]...def 
-00018ff0: 6d6e 3269 6e74 286d 6e5f 7365 7269 6573  mn2int(mn_series
-00019000: 293a 0a20 2020 2022 2222 2054 7572 6e20  ):.    """ Turn 
-00019010: 6120 7365 7269 6573 206f 6620 6d65 6173  a series of meas
-00019020: 7572 6520 6e75 6d62 6572 7320 7061 7273  ure numbers pars
-00019030: 6564 2061 7320 7374 7269 6e67 7320 696e  ed as strings in
-00019040: 746f 2074 776f 2069 6e74 6567 6572 2063  to two integer c
-00019050: 6f6c 756d 6e73 2027 6d6e 2720 616e 6420  olumns 'mn' and 
-00019060: 2776 6f6c 7461 272e 2022 2222 0a20 2020  'volta'. """.   
-00019070: 2074 7279 3a0a 2020 2020 2020 2020 7370   try:.        sp
-00019080: 6c69 7420 3d20 6d6e 5f73 6572 6965 732e  lit = mn_series.
-00019090: 6669 6c6c 6e61 2827 2729 2e73 7472 2e65  fillna('').str.e
-000190a0: 7874 7261 6374 2872 2228 3f50 3c6d 6e3e  xtract(r"(?P<mn>
-000190b0: 5c64 2b29 283f 503c 766f 6c74 613e 5b61  \d+)(?P<volta>[a
-000190c0: 2d67 5d29 3f22 290a 2020 2020 6578 6365  -g])?").    exce
-000190d0: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-000190e0: 2020 2020 2020 6d6e 5f73 6572 6965 7320        mn_series 
-000190f0: 3d20 7064 2e44 6174 6146 7261 6d65 286d  = pd.DataFrame(m
-00019100: 6e5f 7365 7269 6573 2c20 636f 6c75 6d6e  n_series, column
-00019110: 733d 5b27 6d6e 272c 2027 766f 6c74 6127  s=['mn', 'volta'
-00019120: 5d29 0a20 2020 2020 2020 2074 7279 3a0a  ]).        try:.
-00019130: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00019140: 726e 206d 6e5f 7365 7269 6573 2e61 7374  rn mn_series.ast
-00019150: 7970 6528 2749 6e74 3634 2729 0a20 2020  ype('Int64').   
-00019160: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00019170: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-00019180: 2020 2072 6574 7572 6e20 6d6e 5f73 6572     return mn_ser
-00019190: 6965 730a 2020 2020 7370 6c69 742e 6d6e  ies.    split.mn
-000191a0: 203d 2070 642e 746f 5f6e 756d 6572 6963   = pd.to_numeric
-000191b0: 2873 706c 6974 2e6d 6e29 0a20 2020 2073  (split.mn).    s
-000191c0: 706c 6974 2e76 6f6c 7461 203d 2070 642e  plit.volta = pd.
-000191d0: 746f 5f6e 756d 6572 6963 2873 706c 6974  to_numeric(split
-000191e0: 2e76 6f6c 7461 2e6d 6170 287b 2761 273a  .volta.map({'a':
-000191f0: 2031 2c20 2762 273a 2032 2c20 2763 273a   1, 'b': 2, 'c':
-00019200: 2033 2c20 2764 273a 2034 2c20 2765 273a   3, 'd': 4, 'e':
-00019210: 2035 7d29 290a 2020 2020 7265 7475 726e   5})).    return
-00019220: 2073 706c 6974 2e61 7374 7970 6528 2749   split.astype('I
-00019230: 6e74 3634 2729 0a0a 0a64 6566 206e 616d  nt64')...def nam
-00019240: 6532 666f 726d 6174 2864 662c 2066 6f72  e2format(df, for
-00019250: 6d61 743d 2768 746d 6c27 2c20 6e61 6d65  mat='html', name
-00019260: 5f63 6f6c 3d27 636f 6c6f 725f 6e61 6d65  _col='color_name
-00019270: 2729 3a0a 2020 2020 2222 2220 436f 6e76  '):.    """ Conv
-00019280: 6572 7473 2061 2063 6f6c 756d 6e20 7769  erts a column wi
-00019290: 7468 2043 5353 3320 6e61 6d65 7320 696e  th CSS3 names in
-000192a0: 746f 2027 6874 6d6c 272c 2027 7267 6227  to 'html', 'rgb'
-000192b0: 2c20 6f72 2020 2772 6762 6127 2e22 2222  , or  'rgba'."""
-000192c0: 0a20 2020 2069 6620 666f 726d 6174 203d  .    if format =
-000192d0: 3d20 2768 746d 6c27 3a0a 2020 2020 2020  = 'html':.      
-000192e0: 2020 7265 7475 726e 2064 665b 6e61 6d65    return df[name
-000192f0: 5f63 6f6c 5d2e 6d61 7028 636f 6c6f 725f  _col].map(color_
-00019300: 6e61 6d65 3268 746d 6c29 0a20 2020 2069  name2html).    i
-00019310: 6620 666f 726d 6174 203d 3d20 2772 6762  f format == 'rgb
-00019320: 273a 0a20 2020 2020 2020 2072 6574 7572  ':.        retur
-00019330: 6e20 6466 5b6e 616d 655f 636f 6c5d 2e6d  n df[name_col].m
-00019340: 6170 2863 6f6c 6f72 5f6e 616d 6532 7267  ap(color_name2rg
-00019350: 6229 0a20 2020 2069 6620 666f 726d 6174  b).    if format
-00019360: 203d 3d20 2772 6762 6127 3a0a 2020 2020   == 'rgba':.    
-00019370: 2020 2020 7265 7475 726e 2064 665b 6e61      return df[na
-00019380: 6d65 5f63 6f6c 5d2e 6d61 7028 636f 6c6f  me_col].map(colo
-00019390: 725f 6e61 6d65 3272 6762 6129 0a0a 0a40  r_name2rgba)...@
-000193a0: 6675 6e63 7469 6f6e 5f6c 6f67 6765 720a  function_logger.
-000193b0: 6465 6620 6e61 6d65 3266 6966 7468 7328  def name2fifths(
-000193c0: 6e6e 293a 0a20 2020 2022 2222 2054 7572  nn):.    """ Tur
-000193d0: 6e20 6120 6e6f 7465 206e 616d 6520 7375  n a note name su
-000193e0: 6368 2061 7320 6041 6260 2069 6e74 6f20  ch as `Ab` into 
-000193f0: 6120 746f 6e61 6c20 7069 7463 6820 636c  a tonal pitch cl
-00019400: 6173 732c 2073 7563 6820 7468 6174 202d  ass, such that -
-00019410: 313d 462c 2030 3d43 2c20 313d 4720 6574  1=F, 0=C, 1=G et
-00019420: 632e 0a20 2020 2020 2020 2055 7365 733a  c..        Uses:
-00019430: 2073 706c 6974 5f6e 6f74 655f 6e61 6d65   split_note_name
-00019440: 2829 0a20 2020 2022 2222 0a20 2020 2069  ().    """.    i
-00019450: 6620 6e6e 2e5f 5f63 6c61 7373 5f5f 203d  f nn.__class__ =
-00019460: 3d20 696e 7420 6f72 2070 642e 6973 6e75  = int or pd.isnu
-00019470: 6c6c 286e 6e29 3a0a 2020 2020 2020 2020  ll(nn):.        
-00019480: 7265 7475 726e 206e 6e0a 2020 2020 6e61  return nn.    na
-00019490: 6d65 5f74 7063 7320 3d20 7b27 4327 3a20  me_tpcs = {'C': 
-000194a0: 302c 2027 4427 3a20 322c 2027 4527 3a20  0, 'D': 2, 'E': 
-000194b0: 342c 2027 4627 3a20 2d31 2c20 2747 273a  4, 'F': -1, 'G':
-000194c0: 2031 2c20 2741 273a 2033 2c20 2742 273a   1, 'A': 3, 'B':
-000194d0: 2035 7d0a 2020 2020 6163 6369 6465 6e74   5}.    accident
-000194e0: 616c 732c 206e 6f74 655f 6e61 6d65 203d  als, note_name =
-000194f0: 2073 706c 6974 5f6e 6f74 655f 6e61 6d65   split_note_name
-00019500: 286e 6e2c 2063 6f75 6e74 3d54 7275 652c  (nn, count=True,
-00019510: 206c 6f67 6765 723d 6c6f 6767 6572 290a   logger=logger).
-00019520: 2020 2020 6966 206e 6f74 655f 6e61 6d65      if note_name
-00019530: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00019540: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
-00019550: 2020 7374 6570 5f74 7063 203d 206e 616d    step_tpc = nam
-00019560: 655f 7470 6373 5b6e 6f74 655f 6e61 6d65  e_tpcs[note_name
-00019570: 2e75 7070 6572 2829 5d0a 2020 2020 7265  .upper()].    re
-00019580: 7475 726e 2073 7465 705f 7470 6320 2b20  turn step_tpc + 
-00019590: 3720 2a20 6163 6369 6465 6e74 616c 730a  7 * accidentals.
-000195a0: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
-000195b0: 6572 0a64 6566 206e 616d 6532 7063 286e  er.def name2pc(n
-000195c0: 6e29 3a0a 2020 2020 2222 2220 5475 726e  n):.    """ Turn
-000195d0: 2061 206e 6f74 6520 6e61 6d65 2073 7563   a note name suc
-000195e0: 6820 6173 2060 4162 6020 696e 746f 2061  h as `Ab` into a
-000195f0: 2074 6f6e 616c 2070 6974 6368 2063 6c61   tonal pitch cla
-00019600: 7373 2c20 7375 6368 2074 6861 7420 2d31  ss, such that -1
-00019610: 3d46 2c20 303d 432c 2031 3d47 2065 7463  =F, 0=C, 1=G etc
-00019620: 2e0a 2020 2020 2020 2020 5573 6573 3a20  ..        Uses: 
-00019630: 7370 6c69 745f 6e6f 7465 5f6e 616d 6528  split_note_name(
-00019640: 290a 2020 2020 2222 220a 2020 2020 6966  ).    """.    if
-00019650: 206e 6e2e 5f5f 636c 6173 735f 5f20 3d3d   nn.__class__ ==
-00019660: 2069 6e74 206f 7220 7064 2e69 736e 756c   int or pd.isnul
-00019670: 6c28 6e6e 293a 0a20 2020 2020 2020 206c  l(nn):.        l
-00019680: 6f67 6765 722e 7761 726e 696e 6728 6622  ogger.warning(f"
-00019690: 277b 6e6e 7d27 2069 7320 6e6f 7420 6120  '{nn}' is not a 
-000196a0: 7661 6c69 6420 6e6f 7465 206e 616d 652e  valid note name.
-000196b0: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-000196c0: 6e20 6e6e 0a20 2020 206e 616d 655f 7470  n nn.    name_tp
-000196d0: 6373 203d 207b 2743 273a 2030 2c20 2744  cs = {'C': 0, 'D
-000196e0: 273a 2032 2c20 2745 273a 2034 2c20 2746  ': 2, 'E': 4, 'F
-000196f0: 273a 2035 2c20 2747 273a 2037 2c20 2741  ': 5, 'G': 7, 'A
-00019700: 273a 2039 2c20 2742 273a 2031 317d 0a20  ': 9, 'B': 11}. 
-00019710: 2020 2061 6363 6964 656e 7461 6c73 2c20     accidentals, 
-00019720: 6e6f 7465 5f6e 616d 6520 3d20 7370 6c69  note_name = spli
-00019730: 745f 6e6f 7465 5f6e 616d 6528 6e6e 2c20  t_note_name(nn, 
-00019740: 636f 756e 743d 5472 7565 2c20 6c6f 6767  count=True, logg
-00019750: 6572 3d6c 6f67 6765 7229 0a20 2020 2069  er=logger).    i
-00019760: 6620 6e6f 7465 5f6e 616d 6520 6973 204e  f note_name is N
-00019770: 6f6e 653a 0a20 2020 2020 2020 2072 6574  one:.        ret
-00019780: 7572 6e20 4e6f 6e65 0a20 2020 2073 7465  urn None.    ste
-00019790: 705f 7063 203d 206e 616d 655f 7470 6373  p_pc = name_tpcs
-000197a0: 5b6e 6f74 655f 6e61 6d65 2e75 7070 6572  [note_name.upper
-000197b0: 2829 5d0a 2020 2020 7265 7475 726e 2028  ()].    return (
-000197c0: 7374 6570 5f70 6320 2b20 6163 6369 6465  step_pc + accide
-000197d0: 6e74 616c 7329 2025 2031 320a 0a0a 6465  ntals) % 12...de
-000197e0: 6620 6e61 6e5f 6571 2861 2c20 6229 3a0a  f nan_eq(a, b):.
-000197f0: 2020 2020 2222 2252 6574 7572 6e73 2054      """Returns T
-00019800: 7275 6520 6966 2061 2061 6e64 2062 2061  rue if a and b a
-00019810: 7265 2065 7175 616c 206f 7220 626f 7468  re equal or both
-00019820: 206e 756c 6c2e 2057 6f72 6b73 206f 6e20   null. Works on 
-00019830: 7477 6f20 5365 7269 6573 206f 7220 7477  two Series or tw
-00019840: 6f20 656c 656d 656e 7473 2e22 2222 0a20  o elements.""". 
-00019850: 2020 2072 6574 7572 6e20 2861 203d 3d20     return (a == 
-00019860: 6229 207c 2028 7064 2e69 736e 756c 6c28  b) | (pd.isnull(
-00019870: 6129 2026 2070 642e 6973 6e75 6c6c 2862  a) & pd.isnull(b
-00019880: 2929 0a0a 0a40 6675 6e63 7469 6f6e 5f6c  ))...@function_l
-00019890: 6f67 6765 720a 6465 6620 6e65 7874 3273  ogger.def next2s
-000198a0: 6571 7565 6e63 6528 6e65 7874 5f63 6f6c  equence(next_col
-000198b0: 3a20 7064 2e53 6572 6965 7329 202d 3e20  : pd.Series) -> 
-000198c0: 4f70 7469 6f6e 616c 5b4c 6973 745b 696e  Optional[List[in
-000198d0: 745d 5d3a 0a20 2020 2022 2222 2054 7572  t]]:.    """ Tur
-000198e0: 6e73 2061 2027 6e65 7874 2720 636f 6c75  ns a 'next' colu
-000198f0: 6d6e 2069 6e74 6f20 7468 6520 636f 7272  mn into the corr
-00019900: 6563 7420 7365 7175 656e 6365 206f 6620  ect sequence of 
-00019910: 4d43 7320 636f 7272 6573 706f 6e64 696e  MCs correspondin
-00019920: 6720 746f 2075 6e66 6f6c 6465 6420 7265  g to unfolded re
-00019930: 7065 7469 7469 6f6e 732e 0a20 2020 2052  petitions..    R
-00019940: 6571 7569 7265 7320 7468 6174 2074 6865  equires that the
-00019950: 2053 6572 6965 7327 2069 6e64 6578 2062   Series' index b
-00019960: 6520 7468 6520 4d43 7320 6173 2069 6e20  e the MCs as in 
-00019970: 6060 6d65 6173 7572 6573 2e73 6574 5f69  ``measures.set_i
-00019980: 6e64 6578 2827 6d63 2729 2e6e 6578 7460  ndex('mc').next`
-00019990: 602e 0a20 2020 2022 2222 0a20 2020 206d  `..    """.    m
-000199a0: 6320 3d20 6e65 7874 5f63 6f6c 2e69 6e64  c = next_col.ind
-000199b0: 6578 5b30 5d0a 2020 2020 6c61 7374 5f6d  ex[0].    last_m
-000199c0: 6320 3d20 6e65 7874 5f63 6f6c 2e69 6e64  c = next_col.ind
-000199d0: 6578 5b2d 315d 0a20 2020 206d 6178 5f69  ex[-1].    max_i
-000199e0: 7465 7220 3d20 3130 202a 206c 6173 745f  ter = 10 * last_
-000199f0: 6d63 0a20 2020 2069 203d 2030 0a20 2020  mc.    i = 0.   
-00019a00: 2072 6573 756c 7420 3d20 5b5d 0a20 2020   result = [].   
-00019a10: 206e 7874 203d 206e 6578 745f 636f 6c2e   nxt = next_col.
-00019a20: 746f 5f64 6963 7428 290a 2020 2020 7768  to_dict().    wh
-00019a30: 696c 6520 6d63 2021 3d20 2d31 2061 6e64  ile mc != -1 and
-00019a40: 2069 203c 206d 6178 5f69 7465 723a 0a20   i < max_iter:. 
-00019a50: 2020 2020 2020 2069 6620 6d63 206e 6f74         if mc not
-00019a60: 2069 6e20 6e78 743a 0a20 2020 2020 2020   in nxt:.       
-00019a70: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
-00019a80: 7228 6622 436f 6c75 6d6e 2027 6e65 7874  r(f"Column 'next
-00019a90: 2720 636f 6e74 6169 6e73 204d 4320 7b6d  ' contains MC {m
-00019aa0: 637d 2077 6869 6368 2074 6865 2070 6965  c} which the pie
-00019ab0: 6365 7320 646f 6573 206e 6f74 2068 6176  ces does not hav
-00019ac0: 652e 222c 0a20 2020 2020 2020 2020 2020  e.",.           
-00019ad0: 2020 2020 2020 2020 2020 2020 6578 7472              extr
-00019ae0: 613d 7b27 6d65 7373 6167 655f 6964 273a  a={'message_id':
-00019af0: 2028 3236 2c20 297d 290a 2020 2020 2020   (26, )}).      
-00019b00: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-00019b10: 2020 2020 2072 6573 756c 742e 6170 7065       result.appe
-00019b20: 6e64 286d 6329 0a20 2020 2020 2020 206e  nd(mc).        n
-00019b30: 6577 5f6d 632c 202a 7265 7374 203d 206e  ew_mc, *rest = n
-00019b40: 7874 5b6d 635d 0a20 2020 2020 2020 2069  xt[mc].        i
-00019b50: 6620 6c65 6e28 7265 7374 2920 3e20 303a  f len(rest) > 0:
-00019b60: 0a20 2020 2020 2020 2020 2020 206e 7874  .            nxt
-00019b70: 5b6d 635d 203d 2072 6573 740a 2020 2020  [mc] = rest.    
-00019b80: 2020 2020 6d63 203d 206e 6577 5f6d 630a      mc = new_mc.
-00019b90: 2020 2020 2020 2020 6920 2b3d 2031 0a20          i += 1. 
-00019ba0: 2020 2069 6620 6920 3d3d 206d 6178 5f69     if i == max_i
-00019bb0: 7465 723a 0a20 2020 2020 2020 2072 6574  ter:.        ret
-00019bc0: 7572 6e20 5b5d 0a20 2020 2072 6574 7572  urn [].    retur
-00019bd0: 6e20 7265 7375 6c74 0a0a 0a40 6675 6e63  n result...@func
-00019be0: 7469 6f6e 5f6c 6f67 6765 720a 6465 6620  tion_logger.def 
-00019bf0: 6e6f 5f63 6f6c 6c65 6374 696f 6e73 5f6e  no_collections_n
-00019c00: 6f5f 626f 6f6c 6561 6e73 2864 662c 2063  o_booleans(df, c
-00019c10: 6f6c 6c5f 636f 6c75 6d6e 733d 4e6f 6e65  oll_columns=None
-00019c20: 2c20 626f 6f6c 5f63 6f6c 756d 6e73 3d4e  , bool_columns=N
-00019c30: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
-00019c40: 2020 436c 6561 6e73 2074 6865 2044 6174    Cleans the Dat
-00019c50: 6146 7261 6d65 2063 6f6c 756d 6e73 205b  aFrame columns [
-00019c60: 276e 6578 7427 2c20 2763 686f 7264 5f74  'next', 'chord_t
-00019c70: 6f6e 6573 272c 2027 6164 6465 645f 746f  ones', 'added_to
-00019c80: 6e65 7327 2c20 2776 6f6c 7461 5f6d 6373  nes', 'volta_mcs
-00019c90: 5d20 6672 6f6d 2074 7570 6c65 7320 616e  ] from tuples an
-00019ca0: 6420 7468 6520 636f 6c75 6d6e 730a 2020  d the columns.  
-00019cb0: 2020 5b27 676c 6f62 616c 6b65 795f 6973    ['globalkey_is
-00019cc0: 5f6d 696e 6f72 272c 2027 6c6f 6361 6c6b  _minor', 'localk
-00019cd0: 6579 5f69 735f 6d69 6e6f 7227 5d20 6672  ey_is_minor'] fr
-00019ce0: 6f6d 2062 6f6f 6c65 616e 732c 2063 6f6e  om booleans, con
-00019cf0: 7665 7274 696e 6720 7468 656d 2061 6c6c  verting them all
-00019d00: 2074 6f20 696e 7465 6765 7273 0a0a 2020   to integers..  
-00019d10: 2020 2222 220a 2020 2020 6966 2064 6620    """.    if df 
-00019d20: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00019d30: 2072 6574 7572 6e20 6466 0a20 2020 2063   return df.    c
-00019d40: 6f6c 6c65 6374 696f 6e5f 636f 6c73 203d  ollection_cols =
-00019d50: 205b 276e 6578 7427 2c20 2763 686f 7264   ['next', 'chord
-00019d60: 5f74 6f6e 6573 272c 2027 6164 6465 645f  _tones', 'added_
-00019d70: 746f 6e65 7327 2c20 2776 6f6c 7461 5f6d  tones', 'volta_m
-00019d80: 6373 275d 0a20 2020 2062 6f6f 6c5f 636f  cs'].    bool_co
-00019d90: 6c73 203d 205b 2767 6c6f 6261 6c6b 6579  ls = ['globalkey
-00019da0: 5f69 735f 6d69 6e6f 7227 2c20 276c 6f63  _is_minor', 'loc
-00019db0: 616c 6b65 795f 6973 5f6d 696e 6f72 272c  alkey_is_minor',
-00019dc0: 2027 6861 735f 6472 756d 7365 7427 5d0a   'has_drumset'].
-00019dd0: 2020 2020 6966 2063 6f6c 6c5f 636f 6c75      if coll_colu
-00019de0: 6d6e 7320 6973 206e 6f74 204e 6f6e 653a  mns is not None:
-00019df0: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-00019e00: 696f 6e5f 636f 6c73 202b 3d20 6c69 7374  ion_cols += list
-00019e10: 2863 6f6c 6c5f 636f 6c75 6d6e 7329 0a20  (coll_columns). 
-00019e20: 2020 2069 6620 626f 6f6c 5f63 6f6c 756d     if bool_colum
-00019e30: 6e73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ns is not None:.
-00019e40: 2020 2020 2020 2020 626f 6f6c 5f63 6f6c          bool_col
-00019e50: 7320 2b3d 206c 6973 7428 626f 6f6c 5f63  s += list(bool_c
-00019e60: 6f6c 756d 6e73 290a 2020 2020 7472 793a  olumns).    try:
-00019e70: 0a20 2020 2020 2020 2063 6320 3d20 5b63  .        cc = [c
-00019e80: 2066 6f72 2063 2069 6e20 636f 6c6c 6563   for c in collec
-00019e90: 7469 6f6e 5f63 6f6c 7320 6966 2063 2069  tion_cols if c i
-00019ea0: 6e20 6466 2e63 6f6c 756d 6e73 5d0a 2020  n df.columns].  
-00019eb0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00019ec0: 6f6e 3a0a 2020 2020 2020 2020 6c6f 6767  on:.        logg
-00019ed0: 6572 2e65 7272 6f72 2866 2264 6620 6e65  er.error(f"df ne
-00019ee0: 6564 7320 746f 2062 6520 6120 4461 7461  eds to be a Data
-00019ef0: 4672 616d 652c 206e 6f74 2061 207b 6466  Frame, not a {df
-00019f00: 2e5f 5f63 6c61 7373 5f5f 7d2e 2229 0a20  .__class__}."). 
-00019f10: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-00019f20: 0a20 2020 2064 6620 3d20 6466 2e63 6f70  .    df = df.cop
-00019f30: 7928 290a 2020 2020 666f 7220 6320 696e  y().    for c in
-00019f40: 2063 633a 0a20 2020 2020 2020 206e 756c   cc:.        nul
-00019f50: 6c5f 7661 6c73 203d 2064 665b 635d 2e69  l_vals = df[c].i
-00019f60: 736e 6128 290a 2020 2020 2020 2020 6966  sna().        if
-00019f70: 206e 756c 6c5f 7661 6c73 2e61 6c6c 2829   null_vals.all()
-00019f80: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00019f90: 6e74 696e 7565 0a20 2020 2020 2020 2064  ntinue.        d
-00019fa0: 662e 6c6f 635b 6e75 6c6c 5f76 616c 732c  f.loc[null_vals,
-00019fb0: 2063 5d20 3d20 7064 2e4e 410a 2020 2020   c] = pd.NA.    
-00019fc0: 2020 2020 7769 7468 2077 6172 6e69 6e67      with warning
-00019fd0: 732e 6361 7463 685f 7761 726e 696e 6773  s.catch_warnings
-00019fe0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00019ff0: 2320 5365 7474 696e 6720 7661 6c75 6573  # Setting values
-0001a000: 2069 6e2d 706c 6163 6520 6973 2066 696e   in-place is fin
-0001a010: 652c 2069 676e 6f72 6520 7468 6520 7761  e, ignore the wa
-0001a020: 726e 696e 6720 696e 2050 616e 6461 7320  rning in Pandas 
-0001a030: 3e3d 2031 2e35 2e30 0a20 2020 2020 2020  >= 1.5.0.       
-0001a040: 2020 2020 2023 2054 6869 7320 6361 6e20       # This can 
-0001a050: 6265 2072 656d 6f76 6564 2c20 6966 2050  be removed, if P
-0001a060: 616e 6461 7320 312e 352e 3020 646f 6573  andas 1.5.0 does
-0001a070: 206e 6f74 206e 6565 6420 746f 2062 6520   not need to be 
-0001a080: 7375 7070 6f72 7465 6420 616e 7920 6c6f  supported any lo
-0001a090: 6e67 6572 2e0a 2020 2020 2020 2020 2020  nger..          
-0001a0a0: 2020 2320 5365 6520 616c 736f 3a20 6874    # See also: ht
-0001a0b0: 7470 733a 2f2f 7374 6163 6b6f 7665 7266  tps://stackoverf
-0001a0c0: 6c6f 772e 636f 6d2f 712f 3734 3035 3733  low.com/q/740573
-0001a0d0: 3637 2f38 3539 3539 310a 2020 2020 2020  67/859591.      
-0001a0e0: 2020 2020 2020 7761 726e 696e 6773 2e66        warnings.f
-0001a0f0: 696c 7465 7277 6172 6e69 6e67 7328 0a20  ilterwarnings(. 
-0001a100: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001a110: 6967 6e6f 7265 222c 0a20 2020 2020 2020  ignore",.       
-0001a120: 2020 2020 2020 2020 2063 6174 6567 6f72           categor
-0001a130: 793d 4675 7475 7265 5761 726e 696e 672c  y=FutureWarning,
-0001a140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a150: 206d 6573 7361 6765 3d28 0a20 2020 2020   message=(.     
-0001a160: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001a170: 2e2a 7769 6c6c 2061 7474 656d 7074 2074  .*will attempt t
-0001a180: 6f20 7365 7420 7468 6520 7661 6c75 6573  o set the values
-0001a190: 2069 6e70 6c61 6365 2069 6e73 7465 6164   inplace instead
-0001a1a0: 206f 6620 616c 7761 7973 2073 6574 7469   of always setti
-0001a1b0: 6e67 2061 206e 6577 2061 7272 6179 2e20  ng a new array. 
-0001a1c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001a1d0: 2020 2020 2020 2254 6f20 7265 7461 696e        "To retain
-0001a1e0: 2074 6865 206f 6c64 2062 6568 6176 696f   the old behavio
-0001a1f0: 722c 2075 7365 2065 6974 6865 722e 2a22  r, use either.*"
-0001a200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a210: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-0001a220: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-0001a230: 2e6c 6f63 5b3a 2c20 635d 203d 2074 7261  .loc[:, c] = tra
-0001a240: 6e73 666f 726d 2864 665b 635d 2c20 6974  nsform(df[c], it
-0001a250: 6572 6162 6c65 3273 7472 290a 2020 2020  erable2str).    
-0001a260: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-0001a270: 2866 2254 7261 6e73 666f 726d 6564 2069  (f"Transformed i
-0001a280: 7465 7261 626c 6573 2069 6e20 7468 6520  terables in the 
-0001a290: 636f 6c75 6d6e 207b 637d 2074 6f20 7374  column {c} to st
-0001a2a0: 7269 6e67 732e 2229 0a20 2020 2023 6466  rings.").    #df
-0001a2b0: 2e6c 6f63 5b3a 2c20 6363 5d20 3d20 7472  .loc[:, cc] = tr
-0001a2c0: 616e 7366 6f72 6d28 6466 5b63 635d 2c20  ansform(df[cc], 
-0001a2d0: 6974 6572 6162 6c65 3273 7472 2c20 636f  iterable2str, co
-0001a2e0: 6c75 6d6e 5f77 6973 653d 5472 7565 290a  lumn_wise=True).
-0001a2f0: 2020 2020 626f 6f6c 6561 6e5f 636f 6c75      boolean_colu
-0001a300: 6d6e 7320 3d20 5b63 2066 6f72 2063 2069  mns = [c for c i
-0001a310: 6e20 626f 6f6c 5f63 6f6c 7320 6966 2063  n bool_cols if c
-0001a320: 2069 6e20 6466 2e63 6f6c 756d 6e73 5d0a   in df.columns].
-0001a330: 2020 2020 666f 7220 6263 2069 6e20 626f      for bc in bo
-0001a340: 6f6c 6561 6e5f 636f 6c75 6d6e 733a 0a20  olean_columns:. 
-0001a350: 2020 2020 2020 206e 756c 6c5f 7661 6c73         null_vals
-0001a360: 203d 2064 665b 6263 5d2e 6973 6e61 2829   = df[bc].isna()
-0001a370: 0a20 2020 2020 2020 2069 6620 6e75 6c6c  .        if null
-0001a380: 5f76 616c 732e 616c 6c28 293a 0a20 2020  _vals.all():.   
-0001a390: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0001a3a0: 650a 2020 2020 2020 2020 7769 7468 2077  e.        with w
-0001a3b0: 6172 6e69 6e67 732e 6361 7463 685f 7761  arnings.catch_wa
-0001a3c0: 726e 696e 6773 2829 3a0a 2020 2020 2020  rnings():.      
-0001a3d0: 2020 2020 2020 2320 5365 7474 696e 6720        # Setting 
-0001a3e0: 7661 6c75 6573 2069 6e2d 706c 6163 6520  values in-place 
-0001a3f0: 6973 2066 696e 652c 2069 676e 6f72 6520  is fine, ignore 
-0001a400: 7468 6520 7761 726e 696e 6720 696e 2050  the warning in P
-0001a410: 616e 6461 7320 3e3d 2031 2e35 2e30 0a20  andas >= 1.5.0. 
-0001a420: 2020 2020 2020 2020 2020 2023 2054 6869             # Thi
-0001a430: 7320 6361 6e20 6265 2072 656d 6f76 6564  s can be removed
-0001a440: 2c20 6966 2050 616e 6461 7320 312e 352e  , if Pandas 1.5.
-0001a450: 3020 646f 6573 206e 6f74 206e 6565 6420  0 does not need 
-0001a460: 746f 2062 6520 7375 7070 6f72 7465 6420  to be supported 
-0001a470: 616e 7920 6c6f 6e67 6572 2e0a 2020 2020  any longer..    
-0001a480: 2020 2020 2020 2020 2320 5365 6520 616c          # See al
-0001a490: 736f 3a20 6874 7470 733a 2f2f 7374 6163  so: https://stac
-0001a4a0: 6b6f 7665 7266 6c6f 772e 636f 6d2f 712f  koverflow.com/q/
-0001a4b0: 3734 3035 3733 3637 2f38 3539 3539 310a  74057367/859591.
-0001a4c0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0001a4d0: 696e 6773 2e66 696c 7465 7277 6172 6e69  ings.filterwarni
-0001a4e0: 6e67 7328 0a20 2020 2020 2020 2020 2020  ngs(.           
-0001a4f0: 2020 2020 2022 6967 6e6f 7265 222c 0a20       "ignore",. 
-0001a500: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001a510: 6174 6567 6f72 793d 4675 7475 7265 5761  ategory=FutureWa
-0001a520: 726e 696e 672c 0a20 2020 2020 2020 2020  rning,.         
-0001a530: 2020 2020 2020 206d 6573 7361 6765 3d28         message=(
-0001a540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a550: 2020 2020 2022 2e2a 7769 6c6c 2061 7474       ".*will att
-0001a560: 656d 7074 2074 6f20 7365 7420 7468 6520  empt to set the 
-0001a570: 7661 6c75 6573 2069 6e70 6c61 6365 2069  values inplace i
-0001a580: 6e73 7465 6164 206f 6620 616c 7761 7973  nstead of always
-0001a590: 2073 6574 7469 6e67 2061 206e 6577 2061   setting a new a
-0001a5a0: 7272 6179 2e20 220a 2020 2020 2020 2020  rray. ".        
-0001a5b0: 2020 2020 2020 2020 2020 2020 2254 6f20              "To 
-0001a5c0: 7265 7461 696e 2074 6865 206f 6c64 2062  retain the old b
-0001a5d0: 6568 6176 696f 722c 2075 7365 2065 6974  ehavior, use eit
-0001a5e0: 6865 722e 2a22 0a20 2020 2020 2020 2020  her.*".         
-0001a5f0: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-0001a600: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001a610: 2020 2020 6466 2e6c 6f63 5b3a 2c20 6263      df.loc[:, bc
-0001a620: 5d20 3d20 6466 5b62 635d 2e61 7374 7970  ] = df[bc].astyp
-0001a630: 6528 2762 6f6f 6c65 616e 2729 2e61 7374  e('boolean').ast
-0001a640: 7970 6528 2749 6e74 3634 2729 0a20 2020  ype('Int64').   
-0001a650: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
-0001a660: 6728 6622 5472 616e 7366 6f72 6d65 6420  g(f"Transformed 
-0001a670: 626f 6f6c 6561 6e73 2069 6e20 7468 6520  booleans in the 
-0001a680: 636f 6c75 6d6e 207b 6263 7d20 746f 2069  column {bc} to i
-0001a690: 6e74 6567 6572 732e 2229 0a20 2020 2072  ntegers.").    r
-0001a6a0: 6574 7572 6e20 6466 0a0a 0a64 6566 206f  eturn df...def o
-0001a6b0: 7264 696e 616c 5f73 7566 6669 7828 6e29  rdinal_suffix(n)
-0001a6c0: 3a0a 2020 2020 7375 6666 6978 6573 203d  :.    suffixes =
-0001a6d0: 207b 0a20 2020 2020 2020 2022 3122 3a20   {.        "1": 
-0001a6e0: 2773 7427 2c0a 2020 2020 2020 2020 2232  'st',.        "2
-0001a6f0: 223a 2027 6e64 272c 0a20 2020 2020 2020  ": 'nd',.       
-0001a700: 2022 3322 3a20 2772 6427 0a20 2020 207d   "3": 'rd'.    }
-0001a710: 0a20 2020 206c 6173 745f 6469 6769 7420  .    last_digit 
-0001a720: 3d20 7374 7228 6e29 5b2d 315d 0a20 2020  = str(n)[-1].   
-0001a730: 2072 6574 7572 6e20 7375 6666 6978 6573   return suffixes
-0001a740: 2e67 6574 286c 6173 745f 6469 6769 742c  .get(last_digit,
-0001a750: 2027 7468 2729 0a0a 0a64 6566 2070 6172   'th')...def par
-0001a760: 7473 5f69 6e66 6f28 6429 3a0a 2020 2020  ts_info(d):.    
-0001a770: 2222 220a 2020 2020 5475 726e 7320 6120  """.    Turns a 
-0001a780: 286e 6573 7465 6429 2060 606d 6574 6164  (nested) ``metad
-0001a790: 6174 615b 2770 6172 7473 275d 6060 2064  ata['parts']`` d
-0001a7a0: 6963 7420 696e 746f 2061 2066 6c61 7420  ict into a flat 
-0001a7b0: 6469 6374 2062 6173 6564 206f 6e20 7374  dict based on st
-0001a7c0: 6176 6573 2e0a 0a20 2020 2045 7861 6d70  aves...    Examp
-0001a7d0: 6c65 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  le.    -------. 
-0001a7e0: 2020 203e 3e3e 2064 203d 2073 2e6d 7363     >>> d = s.msc
-0001a7f0: 782e 6d65 7461 6461 7461 5f66 726f 6d5f  x.metadata_from_
-0001a800: 7061 7273 6564 0a20 2020 203e 3e3e 2070  parsed.    >>> p
-0001a810: 6172 7473 5f69 6e66 6f28 645b 2770 6172  arts_info(d['par
-0001a820: 7473 275d 290a 2020 2020 7b27 7374 6166  ts']).    {'staf
-0001a830: 665f 315f 696e 7374 7275 6d65 6e74 273a  f_1_instrument':
-0001a840: 2027 566f 6963 6527 2c0a 2020 2020 2027   'Voice',.     '
-0001a850: 7374 6166 665f 315f 616d 6269 7475 7327  staff_1_ambitus'
-0001a860: 3a20 2736 362d 3736 2028 4623 342d 4535  : '66-76 (F#4-E5
-0001a870: 2927 2c0a 2020 2020 2027 7374 6166 665f  )',.     'staff_
-0001a880: 325f 696e 7374 7275 6d65 6e74 273a 2027  2_instrument': '
-0001a890: 566f 6963 6527 2c0a 2020 2020 2027 7374  Voice',.     'st
-0001a8a0: 6166 665f 325f 616d 6269 7475 7327 3a20  aff_2_ambitus': 
-0001a8b0: 2735 352d 3639 2028 4733 2d41 3429 272c  '55-69 (G3-A4)',
-0001a8c0: 0a20 2020 2020 2773 7461 6666 5f33 5f69  .     'staff_3_i
-0001a8d0: 6e73 7472 756d 656e 7427 3a20 2756 6f69  nstrument': 'Voi
-0001a8e0: 6365 272c 0a20 2020 2020 2773 7461 6666  ce',.     'staff
-0001a8f0: 5f33 5f61 6d62 6974 7573 273a 2027 3438  _3_ambitus': '48
-0001a900: 2d36 3720 2843 332d 4734 2927 2c0a 2020  -67 (C3-G4)',.  
-0001a910: 2020 2027 7374 6166 665f 345f 696e 7374     'staff_4_inst
-0001a920: 7275 6d65 6e74 273a 2027 566f 6963 6527  rument': 'Voice'
-0001a930: 2c0a 2020 2020 2027 7374 6166 665f 345f  ,.     'staff_4_
-0001a940: 616d 6269 7475 7327 3a20 2734 312d 3630  ambitus': '41-60
-0001a950: 2028 4632 2d43 3429 277d 0a20 2020 2022   (F2-C4)'}.    "
-0001a960: 2222 0a20 2020 2072 6573 203d 207b 7d0a  "".    res = {}.
-0001a970: 2020 2020 666f 7220 7061 7274 5f64 6963      for part_dic
-0001a980: 7420 696e 2064 2e76 616c 7565 7328 293a  t in d.values():
-0001a990: 0a20 2020 2020 2020 2066 6f72 2069 6420  .        for id 
-0001a9a0: 696e 2070 6172 745f 6469 6374 5b27 7374  in part_dict['st
-0001a9b0: 6176 6573 275d 3a0a 2020 2020 2020 2020  aves']:.        
-0001a9c0: 2020 2020 6e61 6d65 203d 2066 2273 7461      name = f"sta
-0001a9d0: 6666 5f7b 6964 7d22 0a20 2020 2020 2020  ff_{id}".       
-0001a9e0: 2020 2020 2072 6573 5b66 227b 6e61 6d65       res[f"{name
-0001a9f0: 7d5f 696e 7374 7275 6d65 6e74 225d 203d  }_instrument"] =
-0001aa00: 2070 6172 745f 6469 6374 5b27 696e 7374   part_dict['inst
-0001aa10: 7275 6d65 6e74 275d 0a20 2020 2020 2020  rument'].       
-0001aa20: 2020 2020 2061 6d62 5f6e 616d 6520 3d20       amb_name = 
-0001aa30: 6e61 6d65 202b 2027 5f61 6d62 6974 7573  name + '_ambitus
-0001aa40: 270a 2020 2020 2020 2020 2020 2020 7265  '.            re
-0001aa50: 735b 616d 625f 6e61 6d65 5d20 3d20 616d  s[amb_name] = am
-0001aa60: 6269 7475 7332 6f6e 656c 696e 6572 2870  bitus2oneliner(p
-0001aa70: 6172 745f 6469 6374 5b61 6d62 5f6e 616d  art_dict[amb_nam
-0001aa80: 655d 290a 2020 2020 7265 7475 726e 2072  e]).    return r
-0001aa90: 6573 0a0a 0a40 6675 6e63 7469 6f6e 5f6c  es...@function_l
-0001aaa0: 6f67 6765 720a 6465 6620 7061 7468 3274  ogger.def path2t
-0001aab0: 7970 6528 7061 7468 293a 0a20 2020 2022  ype(path):.    "
-0001aac0: 2222 2044 6574 6572 6d69 6e65 2061 2066  "" Determine a f
-0001aad0: 696c 6527 7320 7479 7065 2062 7920 7363  ile's type by sc
-0001aae0: 616e 6e69 6e67 2069 7473 2070 6174 6820  anning its path 
-0001aaf0: 666f 7220 6465 6661 756c 7420 636f 6d70  for default comp
-0001ab00: 6f6e 656e 7473 2069 6e20 7468 6520 636f  onents in the co
-0001ab10: 6e73 7461 6e74 2053 5441 4e44 4152 445f  nstant STANDARD_
-0001ab20: 4e41 4d45 532e 0a0a 2020 2020 5061 7261  NAMES...    Para
-0001ab30: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-0001ab40: 2d2d 2d2d 2d0a 2020 2020 7061 7468 0a0a  -----.    path..
-0001ab50: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-0001ab60: 2d2d 2d2d 2d2d 2d0a 0a20 2020 2022 2222  -------..    """
-0001ab70: 0a20 2020 205f 2c20 6665 7874 203d 206f  .    _, fext = o
-0001ab80: 732e 7061 7468 2e73 706c 6974 6578 7428  s.path.splitext(
-0001ab90: 7061 7468 290a 2020 2020 6966 2066 6578  path).    if fex
-0001aba0: 742e 6c6f 7765 7228 2920 696e 2053 434f  t.lower() in SCO
-0001abb0: 5245 5f45 5854 454e 5349 4f4e 533a 0a20  RE_EXTENSIONS:. 
-0001abc0: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
-0001abd0: 6275 6728 6622 5265 636f 676e 697a 6564  bug(f"Recognized
-0001abe0: 2066 696c 6520 6578 7465 6e73 696f 6e20   file extension 
-0001abf0: 277b 6665 7874 7d27 2061 7320 7363 6f72  '{fext}' as scor
-0001ac00: 652e 2229 0a20 2020 2020 2020 2072 6574  e.").        ret
-0001ac10: 7572 6e20 2773 636f 7265 7327 0a20 2020  urn 'scores'.   
-0001ac20: 2063 6f6d 706f 6e65 6e74 3274 7970 6520   component2type 
-0001ac30: 3d20 7061 7468 5f63 6f6d 706f 6e65 6e74  = path_component
-0001ac40: 3266 696c 655f 7479 7065 5f6d 6170 2829  2file_type_map()
-0001ac50: 0a20 2020 2064 6566 2066 696e 645f 636f  .    def find_co
-0001ac60: 6d70 6f6e 656e 7473 2873 293a 0a20 2020  mponents(s):.   
-0001ac70: 2020 2020 2072 6573 203d 205b 636f 6d70       res = [comp
-0001ac80: 2066 6f72 2063 6f6d 7020 696e 2063 6f6d   for comp in com
-0001ac90: 706f 6e65 6e74 3274 7970 652e 6b65 7973  ponent2type.keys
-0001aca0: 2829 2069 6620 636f 6d70 2069 6e20 735d  () if comp in s]
-0001acb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001acc0: 7265 732c 206c 656e 2872 6573 290a 2020  res, len(res).  
-0001acd0: 2020 6966 206f 732e 7061 7468 2e69 7366    if os.path.isf
-0001ace0: 696c 6528 7061 7468 293a 0a20 2020 2020  ile(path):.     
-0001acf0: 2020 2023 2067 6976 6520 7072 6566 6572     # give prefer
-0001ad00: 656e 6365 2074 6f20 666f 6c64 6572 206e  ence to folder n
-0001ad10: 616d 6573 2062 6566 6f72 6520 6669 6c65  ames before file
-0001ad20: 206e 616d 6573 0a20 2020 2020 2020 2064   names.        d
-0001ad30: 6972 6563 746f 7279 2c20 666e 616d 6520  irectory, fname 
-0001ad40: 3d20 6f73 2e70 6174 682e 7370 6c69 7428  = os.path.split(
-0001ad50: 7061 7468 290a 2020 2020 2020 2020 6966  path).        if
-0001ad60: 2027 6d65 7461 6461 7461 2720 696e 2066   'metadata' in f
-0001ad70: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-0001ad80: 2020 7265 7475 726e 2027 6d65 7461 6461    return 'metada
-0001ad90: 7461 270a 2020 2020 2020 2020 666f 756e  ta'.        foun
-0001ada0: 645f 636f 6d70 6f6e 656e 7473 2c20 6e5f  d_components, n_
-0001adb0: 666f 756e 6420 3d20 6669 6e64 5f63 6f6d  found = find_com
-0001adc0: 706f 6e65 6e74 7328 6469 7265 6374 6f72  ponents(director
-0001add0: 7929 0a20 2020 2020 2020 2069 6620 6e5f  y).        if n_
-0001ade0: 666f 756e 6420 3d3d 2030 3a0a 2020 2020  found == 0:.    
-0001adf0: 2020 2020 2020 2020 666f 756e 645f 636f          found_co
-0001ae00: 6d70 6f6e 656e 7473 2c20 6e5f 666f 756e  mponents, n_foun
-0001ae10: 6420 3d20 6669 6e64 5f63 6f6d 706f 6e65  d = find_compone
-0001ae20: 6e74 7328 666e 616d 6529 0a20 2020 2065  nts(fname).    e
-0001ae30: 6c73 653a 0a20 2020 2020 2020 2066 6f75  lse:.        fou
-0001ae40: 6e64 5f63 6f6d 706f 6e65 6e74 732c 206e  nd_components, n
-0001ae50: 5f66 6f75 6e64 203d 2066 696e 645f 636f  _found = find_co
-0001ae60: 6d70 6f6e 656e 7473 2870 6174 6829 0a20  mponents(path). 
-0001ae70: 2020 2069 6620 6e5f 666f 756e 6420 3d3d     if n_found ==
-0001ae80: 2030 3a0a 2020 2020 2020 2020 6c6f 6767   0:.        logg
-0001ae90: 6572 2e64 6562 7567 2866 2254 7970 6520  er.debug(f"Type 
-0001aea0: 636f 756c 6420 6e6f 7420 6265 2069 6e66  could not be inf
-0001aeb0: 6572 7265 6420 6672 6f6d 2070 6174 6820  erred from path 
-0001aec0: 277b 7061 7468 7d27 2e22 290a 2020 2020  '{path}'.").    
-0001aed0: 2020 2020 7265 7475 726e 2027 756e 6b6e      return 'unkn
-0001aee0: 6f77 6e27 0a20 2020 2069 6620 6e5f 666f  own'.    if n_fo
-0001aef0: 756e 6420 3d3d 2031 3a0a 2020 2020 2020  und == 1:.      
-0001af00: 2020 7479 7020 3d20 636f 6d70 6f6e 656e    typ = componen
-0001af10: 7432 7479 7065 5b66 6f75 6e64 5f63 6f6d  t2type[found_com
-0001af20: 706f 6e65 6e74 735b 305d 5d0a 2020 2020  ponents[0]].    
-0001af30: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-0001af40: 2866 2250 6174 6820 277b 7061 7468 7d27  (f"Path '{path}'
-0001af50: 2072 6563 6f67 6e69 7a65 6420 6173 207b   recognized as {
-0001af60: 7479 707d 2e22 290a 2020 2020 2020 2020  typ}.").        
-0001af70: 7265 7475 726e 2074 7970 0a20 2020 2065  return typ.    e
-0001af80: 6c73 653a 0a20 2020 2020 2020 2073 686f  lse:.        sho
-0001af90: 7274 656e 6564 5f70 6174 6820 3d20 7061  rtened_path = pa
-0001afa0: 7468 0a20 2020 2020 2020 2077 6869 6c65  th.        while
-0001afb0: 206c 656e 2873 686f 7274 656e 6564 5f70   len(shortened_p
-0001afc0: 6174 6829 203e 2030 3a0a 2020 2020 2020  ath) > 0:.      
-0001afd0: 2020 2020 2020 7368 6f72 7465 6e65 645f        shortened_
-0001afe0: 7061 7468 2c20 6261 7365 203d 206f 732e  path, base = os.
-0001aff0: 7061 7468 2e73 706c 6974 2873 686f 7274  path.split(short
-0001b000: 656e 6564 5f70 6174 6829 0a20 2020 2020  ened_path).     
-0001b010: 2020 2020 2020 2066 6f72 2063 6f6d 7020         for comp 
-0001b020: 696e 2063 6f6d 706f 6e65 6e74 3274 7970  in component2typ
-0001b030: 652e 6b65 7973 2829 3a0a 2020 2020 2020  e.keys():.      
-0001b040: 2020 2020 2020 2020 2020 6966 2063 6f6d            if com
-0001b050: 7020 696e 2062 6173 653a 0a20 2020 2020  p in base:.     
-0001b060: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001b070: 7970 203d 2063 6f6d 706f 6e65 6e74 3274  yp = component2t
-0001b080: 7970 655b 636f 6d70 5d0a 2020 2020 2020  ype[comp].      
-0001b090: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001b0a0: 6767 6572 2e64 6562 7567 2866 224d 756c  gger.debug(f"Mul
-0001b0b0: 7469 706c 6520 636f 6d70 6f6e 656e 7473  tiple components
-0001b0c0: 2028 7b27 2c20 272e 6a6f 696e 2866 6f75   ({', '.join(fou
-0001b0d0: 6e64 5f63 6f6d 706f 6e65 6e74 7329 7d29  nd_components)})
-0001b0e0: 2066 6f75 6e64 2069 6e20 7061 7468 2027   found in path '
-0001b0f0: 7b70 6174 687d 272e 2043 686f 7365 2074  {path}'. Chose t
-0001b100: 6865 206c 6173 7420 6f6e 653a 207b 7479  he last one: {ty
-0001b110: 707d 2229 0a20 2020 2020 2020 2020 2020  p}").           
-0001b120: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001b130: 7479 700a 2020 2020 2020 2020 6c6f 6767  typ.        logg
-0001b140: 6572 2e77 6172 6e69 6e67 2866 2243 6f6d  er.warning(f"Com
-0001b150: 706f 6e65 6e74 7320 7b27 2c20 272e 6a6f  ponents {', '.jo
-0001b160: 696e 2866 6f75 6e64 5f63 6f6d 706f 6e65  in(found_compone
-0001b170: 6e74 7329 7d20 666f 756e 6420 696e 2070  nts)} found in p
-0001b180: 6174 6820 277b 7061 7468 7d27 2c20 6275  ath '{path}', bu
-0001b190: 7420 6e6f 7420 696e 206f 6e65 206f 6620  t not in one of 
-0001b1a0: 6974 7320 636f 6e73 7469 7475 656e 7473  its constituents
-0001b1b0: 2e22 290a 2020 2020 2020 2020 7265 7475  .").        retu
-0001b1c0: 726e 2027 6f74 6865 7227 0a0a 0a40 6c72  rn 'other'...@lr
-0001b1d0: 755f 6361 6368 6528 290a 6465 6620 7061  u_cache().def pa
-0001b1e0: 7468 5f63 6f6d 706f 6e65 6e74 3266 696c  th_component2fil
-0001b1f0: 655f 7479 7065 5f6d 6170 2829 202d 3e20  e_type_map() -> 
-0001b200: 6469 6374 3a0a 2020 2020 636f 6d70 3274  dict:.    comp2t
-0001b210: 7970 6520 3d20 7b63 6f6d 703a 2063 6f6d  ype = {comp: com
-0001b220: 7020 666f 7220 636f 6d70 2069 6e20 5354  p for comp in ST
-0001b230: 414e 4441 5244 5f4e 414d 4553 7d0a 2020  ANDARD_NAMES}.  
-0001b240: 2020 636f 6d70 3274 7970 655b 274d 5333    comp2type['MS3
-0001b250: 275d 203d 2027 7363 6f72 6573 270a 2020  '] = 'scores'.  
-0001b260: 2020 636f 6d70 3274 7970 655b 2768 6172    comp2type['har
-0001b270: 6d6f 6e69 6573 275d 203d 2027 6578 7061  monies'] = 'expa
-0001b280: 6e64 6564 270a 2020 2020 636f 6d70 3274  nded'.    comp2t
-0001b290: 7970 655b 276f 7574 7075 7427 5d20 3d20  ype['output'] = 
-0001b2a0: 276c 6162 656c 7327 0a20 2020 2063 6f6d  'labels'.    com
-0001b2b0: 7032 7479 7065 5b27 696e 6665 7227 5d20  p2type['infer'] 
-0001b2c0: 3d20 276c 6162 656c 7327 0a20 2020 2072  = 'labels'.    r
-0001b2d0: 6574 7572 6e20 636f 6d70 3274 7970 650a  eturn comp2type.
-0001b2e0: 0a64 6566 2066 696c 655f 7479 7065 3270  .def file_type2p
-0001b2f0: 6174 685f 636f 6d70 6f6e 656e 745f 6d61  ath_component_ma
-0001b300: 7028 2920 2d3e 2064 6963 743a 0a20 2020  p() -> dict:.   
-0001b310: 2063 6f6d 7032 7479 7065 203d 2070 6174   comp2type = pat
-0001b320: 685f 636f 6d70 6f6e 656e 7432 6669 6c65  h_component2file
-0001b330: 5f74 7970 655f 6d61 7028 290a 2020 2020  _type_map().    
-0001b340: 7479 7065 3263 6f6d 7073 203d 2064 6566  type2comps = def
-0001b350: 6175 6c74 6469 6374 286c 6973 7429 0a20  aultdict(list). 
-0001b360: 2020 2066 6f72 2063 6f6d 702c 2074 7970     for comp, typ
-0001b370: 2069 6e20 636f 6d70 3274 7970 652e 6974   in comp2type.it
-0001b380: 656d 7328 293a 0a20 2020 2020 2020 2074  ems():.        t
-0001b390: 7970 6532 636f 6d70 735b 7479 705d 2e61  ype2comps[typ].a
-0001b3a0: 7070 656e 6428 636f 6d70 290a 2020 2020  ppend(comp).    
-0001b3b0: 7265 7475 726e 2064 6963 7428 7479 7065  return dict(type
-0001b3c0: 3263 6f6d 7073 290a 0a0a 6465 6620 7072  2comps)...def pr
-0001b3d0: 6574 7479 5f64 6963 7428 7567 6c79 5f64  etty_dict(ugly_d
-0001b3e0: 6963 743a 2064 6963 742c 2068 6561 6469  ict: dict, headi
-0001b3f0: 6e67 5f6b 6579 3a20 7374 7220 3d20 4e6f  ng_key: str = No
-0001b400: 6e65 2c20 6865 6164 696e 675f 7661 6c75  ne, heading_valu
-0001b410: 653a 2073 7472 203d 204e 6f6e 6529 202d  e: str = None) -
-0001b420: 3e20 7374 723a 0a20 2020 2022 2222 2054  > str:.    """ T
-0001b430: 7572 6e73 2061 2064 6963 7469 6f6e 6172  urns a dictionar
-0001b440: 7920 696e 746f 2061 2073 7472 696e 6720  y into a string 
-0001b450: 7768 6572 6520 7468 6520 6b65 7973 2061  where the keys a
-0001b460: 7265 2070 7269 6e74 6564 2069 6e20 6120  re printed in a 
-0001b470: 636f 6c75 6d6e 2c20 7365 7061 7261 7465  column, separate
-0001b480: 6420 6279 2027 2d3e 272e 0a20 2020 2022  d by '->'..    "
-0001b490: 2222 0a20 2020 2069 6620 6865 6164 696e  "".    if headin
-0001b4a0: 675f 6b65 7920 6973 206e 6f74 204e 6f6e  g_key is not Non
-0001b4b0: 6520 6f72 2068 6561 6469 6e67 5f76 616c  e or heading_val
-0001b4c0: 7565 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ue is not None:.
-0001b4d0: 2020 2020 2020 2020 6865 6164 5f6b 6579          head_key
-0001b4e0: 203d 2027 4b45 5927 2069 6620 6865 6164   = 'KEY' if head
-0001b4f0: 696e 675f 6b65 7920 6973 204e 6f6e 6520  ing_key is None 
-0001b500: 656c 7365 2068 6561 6469 6e67 5f6b 6579  else heading_key
-0001b510: 0a20 2020 2020 2020 2068 6561 645f 7661  .        head_va
-0001b520: 6c20 3d20 2727 2069 6620 6865 6164 696e  l = '' if headin
-0001b530: 675f 7661 6c75 6520 6973 204e 6f6e 6520  g_value is None 
-0001b540: 656c 7365 2068 6561 6469 6e67 5f76 616c  else heading_val
-0001b550: 7565 0a20 2020 2020 2020 2068 6561 645f  ue.        head_
-0001b560: 7661 6c5f 6c65 6e67 7468 203d 206c 656e  val_length = len
-0001b570: 2868 6561 645f 7661 6c29 202b 2034 0a20  (head_val) + 4. 
-0001b580: 2020 2020 2020 2064 203d 207b 6865 6164         d = {head
-0001b590: 5f6b 6579 3a20 6865 6164 5f76 616c 7d0a  _key: head_val}.
-0001b5a0: 2020 2020 2020 2020 642e 7570 6461 7465          d.update
-0001b5b0: 2875 676c 795f 6469 6374 290a 2020 2020  (ugly_dict).    
-0001b5c0: 656c 7365 3a0a 2020 2020 2020 2020 6865  else:.        he
-0001b5d0: 6164 5f76 616c 5f6c 656e 6774 6820 3d20  ad_val_length = 
-0001b5e0: 2d31 0a20 2020 2020 2020 2074 7279 3a0a  -1.        try:.
-0001b5f0: 2020 2020 2020 2020 2020 2020 6420 3d20              d = 
-0001b600: 6469 6374 2875 676c 795f 6469 6374 290a  dict(ugly_dict).
-0001b610: 2020 2020 2020 2020 6578 6365 7074 2056          except V
-0001b620: 616c 7565 4572 726f 723a 0a20 2020 2020  alueError:.     
-0001b630: 2020 2020 2020 2070 7269 6e74 2866 2250         print(f"P
-0001b640: 6c65 6173 6520 7061 7373 2061 2064 6963  lease pass a dic
-0001b650: 7469 6f6e 6172 792c 206e 6f74 2061 207b  tionary, not a {
-0001b660: 7479 7065 2875 676c 795f 6469 6374 297d  type(ugly_dict)}
-0001b670: 3a20 7b75 676c 795f 6469 6374 7d22 290a  : {ugly_dict}").
-0001b680: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001b690: 650a 2020 2020 6c65 6674 203d 206d 6178  e.    left = max
-0001b6a0: 286c 656e 2873 7472 286b 2929 2066 6f72  (len(str(k)) for
-0001b6b0: 206b 2069 6e20 642e 6b65 7973 2829 290a   k in d.keys()).
-0001b6c0: 2020 2020 7265 7320 3d20 5b5d 0a20 2020      res = [].   
-0001b6d0: 2066 6f72 206b 2c20 7620 696e 2064 2e69   for k, v in d.i
-0001b6e0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0001b6f0: 6b73 203d 2073 7472 286b 290a 2020 2020  ks = str(k).    
-0001b700: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0001b710: 6528 762c 2070 642e 4461 7461 4672 616d  e(v, pd.DataFram
-0001b720: 6529 206f 7220 6973 696e 7374 616e 6365  e) or isinstance
-0001b730: 2876 2c20 7064 2e53 6572 6965 7329 3a0a  (v, pd.Series):.
-0001b740: 2020 2020 2020 2020 2020 2020 7673 203d              vs =
-0001b750: 2076 2e74 6f5f 7374 7269 6e67 2829 0a20   v.to_string(). 
-0001b760: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001b770: 2020 2020 2020 2020 2076 7320 3d20 7374           vs = st
-0001b780: 7228 7629 0a20 2020 2020 2020 2069 6620  r(v).        if 
-0001b790: 275c 6e27 2069 6e20 7673 3a0a 2020 2020  '\n' in vs:.    
-0001b7a0: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
-0001b7b0: 7673 2e73 706c 6974 2827 5c6e 2729 0a20  vs.split('\n'). 
-0001b7c0: 2020 2020 2020 2020 2020 2072 6573 2e65             res.e
-0001b7d0: 7874 656e 6428 5b66 227b 6b73 2069 6620  xtend([f"{ks if 
-0001b7e0: 6920 3d3d 2030 2065 6c73 6520 2727 3a7b  i == 0 else '':{
-0001b7f0: 6c65 6674 7d7d 202d 3e20 7b6c 7d22 2066  left}} -> {l}" f
-0001b800: 6f72 2069 2c20 6c20 696e 2065 6e75 6d65  or i, l in enume
-0001b810: 7261 7465 286c 696e 6573 295d 290a 2020  rate(lines)]).  
-0001b820: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001b830: 2020 2020 2020 2020 7265 732e 6170 7065          res.appe
-0001b840: 6e64 2866 227b 6b73 3a7b 6c65 6674 7d7d  nd(f"{ks:{left}}
-0001b850: 202d 3e20 7b76 737d 2229 0a20 2020 2069   -> {vs}").    i
-0001b860: 6620 6865 6164 5f76 616c 5f6c 656e 6774  f head_val_lengt
-0001b870: 6820 3e20 2d31 3a0a 2020 2020 2020 2020  h > -1:.        
-0001b880: 7265 732e 696e 7365 7274 2831 2c20 272d  res.insert(1, '-
-0001b890: 2720 2a20 286c 6566 7420 2b20 6865 6164  ' * (left + head
-0001b8a0: 5f76 616c 5f6c 656e 6774 6829 290a 2020  _val_length)).  
-0001b8b0: 2020 7265 7475 726e 2027 5c6e 272e 6a6f    return '\n'.jo
-0001b8c0: 696e 2872 6573 290a 0a0a 0a64 6566 2072  in(res)....def r
-0001b8d0: 6573 6f6c 7665 5f64 6972 2864 293a 0a20  esolve_dir(d):. 
-0001b8e0: 2020 2022 2222 2052 6573 6f6c 7665 7320     """ Resolves 
-0001b8f0: 277e 2720 746f 2048 4f4d 4520 6469 7265  '~' to HOME dire
-0001b900: 6374 6f72 7920 616e 6420 7475 726e 7320  ctory and turns 
-0001b910: 6060 6460 6020 696e 746f 2061 6e20 6162  ``d`` into an ab
-0001b920: 736f 6c75 7465 2070 6174 682e 0a20 2020  solute path..   
-0001b930: 2022 2222 0a20 2020 2069 6620 6420 6973   """.    if d is
-0001b940: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
-0001b950: 6574 7572 6e20 4e6f 6e65 0a20 2020 2064  eturn None.    d
-0001b960: 203d 2073 7472 2864 290a 2020 2020 6966   = str(d).    if
-0001b970: 2027 7e27 2069 6e20 643a 0a20 2020 2020   '~' in d:.     
-0001b980: 2020 2072 6574 7572 6e20 6f73 2e70 6174     return os.pat
-0001b990: 682e 6578 7061 6e64 7573 6572 2864 290a  h.expanduser(d).
-0001b9a0: 2020 2020 7265 7475 726e 206f 732e 7061      return os.pa
-0001b9b0: 7468 2e61 6273 7061 7468 2864 290a 0a0a  th.abspath(d)...
-0001b9c0: 6465 6620 7267 6232 666f 726d 6174 2864  def rgb2format(d
-0001b9d0: 662c 2066 6f72 6d61 743d 2768 746d 6c27  f, format='html'
-0001b9e0: 2c20 725f 636f 6c3d 2763 6f6c 6f72 5f72  , r_col='color_r
-0001b9f0: 272c 2067 5f63 6f6c 3d27 636f 6c6f 725f  ', g_col='color_
-0001ba00: 6727 2c20 625f 636f 6c3d 2763 6f6c 6f72  g', b_col='color
-0001ba10: 5f62 2729 3a0a 2020 2020 2222 2220 436f  _b'):.    """ Co
-0001ba20: 6e76 6572 7473 2074 6872 6565 2052 4742  nverts three RGB
-0001ba30: 2063 6f6c 756d 6e73 2069 6e74 6f20 6120   columns into a 
-0001ba40: 636f 6c6f 725f 6874 6d6c 206f 7220 636f  color_html or co
-0001ba50: 6c6f 725f 6e61 6d65 2063 6f6c 756d 6e2e  lor_name column.
-0001ba60: 2022 2222 0a20 2020 2063 6f6c 7320 3d20   """.    cols = 
-0001ba70: 5b72 5f63 6f6c 2c20 675f 636f 6c2c 2062  [r_col, g_col, b
-0001ba80: 5f63 6f6c 5d0a 2020 2020 6966 2066 6f72  _col].    if for
-0001ba90: 6d61 7420 3d3d 2027 6874 6d6c 273a 0a20  mat == 'html':. 
-0001baa0: 2020 2020 2020 2068 746d 6c20 3d20 6c69         html = li
-0001bab0: 7374 286d 6170 2872 6762 5f74 7570 6c65  st(map(rgb_tuple
-0001bac0: 3268 746d 6c2c 2064 665b 636f 6c73 5d2e  2html, df[cols].
-0001bad0: 6974 6572 7475 706c 6573 2869 6e64 6578  itertuples(index
-0001bae0: 3d46 616c 7365 2c20 6e61 6d65 3d4e 6f6e  =False, name=Non
-0001baf0: 6529 2929 0a20 2020 2020 2020 2072 6574  e))).        ret
-0001bb00: 7572 6e20 7064 2e53 6572 6965 7328 6874  urn pd.Series(ht
-0001bb10: 6d6c 2c20 696e 6465 783d 6466 2e69 6e64  ml, index=df.ind
-0001bb20: 6578 292e 7265 6e61 6d65 2827 636f 6c6f  ex).rename('colo
-0001bb30: 725f 6874 6d6c 2729 0a20 2020 2069 6620  r_html').    if 
-0001bb40: 666f 726d 6174 203d 3d20 276e 616d 6527  format == 'name'
-0001bb50: 3a0a 2020 2020 2020 2020 6e61 6d65 7320  :.        names 
-0001bb60: 3d20 6c69 7374 286d 6170 2872 6762 5f74  = list(map(rgb_t
-0001bb70: 7570 6c65 326e 616d 652c 2064 665b 636f  uple2name, df[co
-0001bb80: 6c73 5d2e 6974 6572 7475 706c 6573 2869  ls].itertuples(i
-0001bb90: 6e64 6578 3d46 616c 7365 2c20 6e61 6d65  ndex=False, name
-0001bba0: 3d4e 6f6e 6529 2929 0a20 2020 2020 2020  =None))).       
-0001bbb0: 2072 6574 7572 6e20 7064 2e53 6572 6965   return pd.Serie
-0001bbc0: 7328 6e61 6d65 732c 2069 6e64 6578 3d64  s(names, index=d
-0001bbd0: 662e 696e 6465 7829 2e72 656e 616d 6528  f.index).rename(
-0001bbe0: 2763 6f6c 6f72 5f6e 616d 6527 290a 0a0a  'color_name')...
-0001bbf0: 6465 6620 7267 625f 7475 706c 6532 666f  def rgb_tuple2fo
-0001bc00: 726d 6174 2874 2c20 666f 726d 6174 3d27  rmat(t, format='
-0001bc10: 6874 6d6c 2729 3a0a 2020 2020 2222 2220  html'):.    """ 
-0001bc20: 436f 6e76 6572 7473 2061 2073 696e 676c  Converts a singl
-0001bc30: 6520 5247 4220 7475 706c 6520 696e 746f  e RGB tuple into
-0001bc40: 2027 4854 4d4c 2720 6f72 2027 6e61 6d65   'HTML' or 'name
-0001bc50: 272e 2222 220a 2020 2020 6966 2070 642e  '.""".    if pd.
-0001bc60: 6973 6e75 6c6c 2874 293a 0a20 2020 2020  isnull(t):.     
-0001bc70: 2020 2072 6574 7572 6e20 740a 2020 2020     return t.    
-0001bc80: 6966 2070 642e 6973 6e75 6c6c 2874 5b30  if pd.isnull(t[0
-0001bc90: 5d29 3a0a 2020 2020 2020 2020 7265 7475  ]):.        retu
-0001bca0: 726e 2074 5b30 5d0a 2020 2020 6e6f 726d  rn t[0].    norm
-0001bcb0: 203d 2077 6562 636f 6c6f 7273 2e6e 6f72   = webcolors.nor
-0001bcc0: 6d61 6c69 7a65 5f69 6e74 6567 6572 5f74  malize_integer_t
-0001bcd0: 7269 706c 6574 2874 7570 6c65 2869 6e74  riplet(tuple(int
-0001bce0: 2869 2920 666f 7220 6920 696e 2074 2929  (i) for i in t))
-0001bcf0: 0a20 2020 2069 6620 666f 726d 6174 203d  .    if format =
-0001bd00: 3d20 2768 746d 6c27 3a0a 2020 2020 2020  = 'html':.      
-0001bd10: 2020 7265 7475 726e 2077 6562 636f 6c6f    return webcolo
-0001bd20: 7273 2e72 6762 5f74 6f5f 6865 7828 6e6f  rs.rgb_to_hex(no
-0001bd30: 726d 290a 2020 2020 6966 2066 6f72 6d61  rm).    if forma
-0001bd40: 7420 3d3d 2027 6e61 6d65 273a 0a20 2020  t == 'name':.   
-0001bd50: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0001bd60: 2020 2020 2020 7265 7475 726e 2077 6562        return web
-0001bd70: 636f 6c6f 7273 2e72 6762 5f74 6f5f 6e61  colors.rgb_to_na
-0001bd80: 6d65 286e 6f72 6d29 0a20 2020 2020 2020  me(norm).       
-0001bd90: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0001bda0: 6e3a 0a20 2020 2020 2020 2020 2020 2074  n:.            t
-0001bdb0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001bdc0: 2020 2020 7265 7475 726e 204d 5333 5f52      return MS3_R
-0001bdd0: 4742 5b6e 6f72 6d5d 0a20 2020 2020 2020  GB[norm].       
-0001bde0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-0001bdf0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-0001be00: 2020 2020 2020 2072 6574 7572 6e20 7765         return we
-0001be10: 6263 6f6c 6f72 732e 7267 625f 746f 5f68  bcolors.rgb_to_h
-0001be20: 6578 286e 6f72 6d29 0a0a 0a64 6566 2072  ex(norm)...def r
-0001be30: 6762 5f74 7570 6c65 3268 746d 6c28 7429  gb_tuple2html(t)
-0001be40: 3a0a 2020 2020 2222 2220 436f 6e76 6572  :.    """ Conver
-0001be50: 7473 2061 2073 696e 676c 6520 5247 4220  ts a single RGB 
-0001be60: 7475 706c 6520 696e 746f 2048 544d 4c2e  tuple into HTML.
-0001be70: 2222 220a 2020 2020 7265 7475 726e 2072  """.    return r
-0001be80: 6762 5f74 7570 6c65 3266 6f72 6d61 7428  gb_tuple2format(
-0001be90: 742c 2066 6f72 6d61 743d 2768 746d 6c27  t, format='html'
-0001bea0: 290a 0a0a 6465 6620 7267 625f 7475 706c  )...def rgb_tupl
-0001beb0: 6532 6e61 6d65 2874 293a 0a20 2020 2022  e2name(t):.    "
-0001bec0: 2222 2043 6f6e 7665 7274 7320 6120 7369  "" Converts a si
-0001bed0: 6e67 6c65 2052 4742 2074 7570 6c65 2069  ngle RGB tuple i
-0001bee0: 6e74 6f20 6974 7320 4353 5333 206e 616d  nto its CSS3 nam
-0001bef0: 6520 6f72 2074 6f20 4854 4d4c 2069 6620  e or to HTML if 
-0001bf00: 7468 6572 6520 6973 206e 6f6e 652e 2222  there is none.""
-0001bf10: 220a 2020 2020 7265 7475 726e 2072 6762  ".    return rgb
-0001bf20: 5f74 7570 6c65 3266 6f72 6d61 7428 742c  _tuple2format(t,
-0001bf30: 2066 6f72 6d61 743d 276e 616d 6527 290a   format='name').
-0001bf40: 0a0a 6465 6620 7267 6261 3261 7474 7273  ..def rgba2attrs
-0001bf50: 286e 616d 6564 5f74 7570 6c65 293a 0a20  (named_tuple):. 
-0001bf60: 2020 2072 6574 7572 6e20 7b6b 3a20 7374     return {k: st
-0001bf70: 7228 7629 2066 6f72 206b 2c20 7620 696e  r(v) for k, v in
-0001bf80: 206e 616d 6564 5f74 7570 6c65 2e5f 6173   named_tuple._as
-0001bf90: 6469 6374 2829 2e69 7465 6d73 2829 7d0a  dict().items()}.
-0001bfa0: 0a64 6566 2072 6762 6132 7061 7261 6d73  .def rgba2params
-0001bfb0: 286e 616d 6564 5f74 7570 6c65 293a 0a20  (named_tuple):. 
-0001bfc0: 2020 2061 7474 7273 203d 2072 6762 6132     attrs = rgba2
-0001bfd0: 6174 7472 7328 6e61 6d65 645f 7475 706c  attrs(named_tupl
-0001bfe0: 6529 0a20 2020 2072 6574 7572 6e20 7b27  e).    return {'
-0001bff0: 636f 6c6f 725f 272b 6b3a 2076 2066 6f72  color_'+k: v for
-0001c000: 206b 2c20 7620 696e 2061 7474 7273 2e69   k, v in attrs.i
-0001c010: 7465 6d73 2829 7d0a 0a40 6675 6e63 7469  tems()}..@functi
-0001c020: 6f6e 5f6c 6f67 6765 720a 6465 6620 726f  on_logger.def ro
-0001c030: 6d61 6e5f 6e75 6d65 7261 6c32 6669 6674  man_numeral2fift
-0001c040: 6873 2872 6e2c 2067 6c6f 6261 6c5f 6d69  hs(rn, global_mi
-0001c050: 6e6f 723d 4661 6c73 6529 3a0a 2020 2020  nor=False):.    
-0001c060: 2222 2220 5475 726e 2061 2052 6f6d 616e  """ Turn a Roman
-0001c070: 206e 756d 6572 616c 2069 6e74 6f20 6120   numeral into a 
-0001c080: 5450 4320 696e 7465 7276 616c 2028 652e  TPC interval (e.
-0001c090: 672e 2066 6f72 2074 7261 6e73 706f 7369  g. for transposi
-0001c0a0: 7469 6f6e 2070 7572 706f 7365 7329 2e0a  tion purposes)..
-0001c0b0: 2020 2020 2020 2020 5573 6573 3a20 7370          Uses: sp
-0001c0c0: 6c69 745f 7363 616c 655f 6465 6772 6565  lit_scale_degree
-0001c0d0: 2829 0a20 2020 2022 2222 0a20 2020 2069  ().    """.    i
-0001c0e0: 6620 7064 2e69 736e 756c 6c28 726e 293a  f pd.isnull(rn):
-0001c0f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001c100: 726e 0a20 2020 2069 6620 272f 2720 696e  rn.    if '/' in
-0001c110: 2072 6e3a 0a20 2020 2020 2020 2072 6573   rn:.        res
-0001c120: 6f6c 7665 6420 3d20 7265 736f 6c76 655f  olved = resolve_
-0001c130: 7265 6c61 7469 7665 5f6b 6579 7328 726e  relative_keys(rn
-0001c140: 2c20 676c 6f62 616c 5f6d 696e 6f72 290a  , global_minor).
-0001c150: 2020 2020 2020 2020 6d6f 6465 203d 2027          mode = '
-0001c160: 6d69 6e6f 7227 2069 6620 676c 6f62 616c  minor' if global
-0001c170: 5f6d 696e 6f72 2065 6c73 6520 276d 616a  _minor else 'maj
-0001c180: 6f72 270a 2020 2020 2020 2020 6c6f 6767  or'.        logg
-0001c190: 6572 2e64 6562 7567 2866 2252 656c 6174  er.debug(f"Relat
-0001c1a0: 6976 6520 6e75 6d65 7261 6c20 7b72 6e7d  ive numeral {rn}
-0001c1b0: 2069 6e20 7b6d 6f64 657d 206d 6f64 6520   in {mode} mode 
-0001c1c0: 7265 736f 6c76 6564 2074 6f20 7b72 6573  resolved to {res
-0001c1d0: 6f6c 7665 647d 2e22 290a 2020 2020 2020  olved}.").      
-0001c1e0: 2020 726e 203d 2072 6573 6f6c 7665 640a    rn = resolved.
-0001c1f0: 2020 2020 726e 5f74 7063 735f 6d61 6a20      rn_tpcs_maj 
-0001c200: 3d20 7b27 4927 3a20 302c 2027 4949 273a  = {'I': 0, 'II':
-0001c210: 2032 2c20 2749 4949 273a 2034 2c20 2749   2, 'III': 4, 'I
-0001c220: 5627 3a20 2d31 2c20 2756 273a 2031 2c20  V': -1, 'V': 1, 
-0001c230: 2756 4927 3a20 332c 2027 5649 4927 3a20  'VI': 3, 'VII': 
-0001c240: 357d 0a20 2020 2072 6e5f 7470 6373 5f6d  5}.    rn_tpcs_m
-0001c250: 696e 203d 207b 2749 273a 2030 2c20 2749  in = {'I': 0, 'I
-0001c260: 4927 3a20 322c 2027 4949 4927 3a20 2d33  I': 2, 'III': -3
-0001c270: 2c20 2749 5627 3a20 2d31 2c20 2756 273a  , 'IV': -1, 'V':
-0001c280: 2031 2c20 2756 4927 3a20 2d34 2c20 2756   1, 'VI': -4, 'V
-0001c290: 4949 273a 202d 327d 0a20 2020 2061 6363  II': -2}.    acc
-0001c2a0: 6964 656e 7461 6c73 2c20 726e 5f73 7465  identals, rn_ste
-0001c2b0: 7020 3d20 7370 6c69 745f 7363 616c 655f  p = split_scale_
-0001c2c0: 6465 6772 6565 2872 6e2c 2063 6f75 6e74  degree(rn, count
-0001c2d0: 3d54 7275 652c 206c 6f67 6765 723d 6c6f  =True, logger=lo
-0001c2e0: 6767 6572 290a 2020 2020 6966 2061 6e79  gger).    if any
-0001c2f0: 2876 2069 7320 4e6f 6e65 2066 6f72 2076  (v is None for v
-0001c300: 2069 6e20 2861 6363 6964 656e 7461 6c73   in (accidentals
-0001c310: 2c20 726e 5f73 7465 7029 293a 0a20 2020  , rn_step)):.   
-0001c320: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0001c330: 0a20 2020 2072 6e5f 7374 6570 203d 2072  .    rn_step = r
-0001c340: 6e5f 7374 6570 2e75 7070 6572 2829 0a20  n_step.upper(). 
-0001c350: 2020 2073 7465 705f 7470 6320 3d20 726e     step_tpc = rn
-0001c360: 5f74 7063 735f 6d69 6e5b 726e 5f73 7465  _tpcs_min[rn_ste
-0001c370: 705d 2069 6620 676c 6f62 616c 5f6d 696e  p] if global_min
-0001c380: 6f72 2065 6c73 6520 726e 5f74 7063 735f  or else rn_tpcs_
-0001c390: 6d61 6a5b 726e 5f73 7465 705d 0a20 2020  maj[rn_step].   
-0001c3a0: 2072 6574 7572 6e20 7374 6570 5f74 7063   return step_tpc
-0001c3b0: 202b 2037 202a 2061 6363 6964 656e 7461   + 7 * accidenta
-0001c3c0: 6c73 0a0a 4066 756e 6374 696f 6e5f 6c6f  ls..@function_lo
-0001c3d0: 6767 6572 0a64 6566 2072 6f6d 616e 5f6e  gger.def roman_n
-0001c3e0: 756d 6572 616c 3273 656d 6974 6f6e 6573  umeral2semitones
-0001c3f0: 2872 6e2c 2067 6c6f 6261 6c5f 6d69 6e6f  (rn, global_mino
-0001c400: 723d 4661 6c73 6529 3a0a 2020 2020 2222  r=False):.    ""
-0001c410: 2220 5475 726e 2061 2052 6f6d 616e 206e  " Turn a Roman n
-0001c420: 756d 6572 616c 2069 6e74 6f20 6120 7365  umeral into a se
-0001c430: 6d69 746f 6e65 2064 6973 7461 6e63 6520  mitone distance 
-0001c440: 6672 6f6d 2074 6865 2072 6f6f 7420 2830  from the root (0
-0001c450: 2d31 3129 2e0a 2020 2020 2020 2020 5573  -11)..        Us
-0001c460: 6573 3a20 7370 6c69 745f 7363 616c 655f  es: split_scale_
-0001c470: 6465 6772 6565 2829 0a20 2020 2022 2222  degree().    """
-0001c480: 0a20 2020 2069 6620 7064 2e69 736e 756c  .    if pd.isnul
-0001c490: 6c28 726e 293a 0a20 2020 2020 2020 2072  l(rn):.        r
-0001c4a0: 6574 7572 6e20 726e 0a20 2020 2069 6620  eturn rn.    if 
-0001c4b0: 272f 2720 696e 2072 6e3a 0a20 2020 2020  '/' in rn:.     
-0001c4c0: 2020 2072 6573 6f6c 7665 6420 3d20 7265     resolved = re
-0001c4d0: 736f 6c76 655f 7265 6c61 7469 7665 5f6b  solve_relative_k
-0001c4e0: 6579 7328 726e 2c20 676c 6f62 616c 5f6d  eys(rn, global_m
-0001c4f0: 696e 6f72 290a 2020 2020 2020 2020 6d6f  inor).        mo
-0001c500: 6465 203d 2027 6d69 6e6f 7227 2069 6620  de = 'minor' if 
-0001c510: 676c 6f62 616c 5f6d 696e 6f72 2065 6c73  global_minor els
-0001c520: 6520 276d 616a 6f72 270a 2020 2020 2020  e 'major'.      
-0001c530: 2020 6c6f 6767 6572 2e64 6562 7567 2866    logger.debug(f
-0001c540: 2252 656c 6174 6976 6520 6e75 6d65 7261  "Relative numera
-0001c550: 6c20 7b72 6e7d 2069 6e20 7b6d 6f64 657d  l {rn} in {mode}
-0001c560: 206d 6f64 6520 7265 736f 6c76 6564 2074   mode resolved t
-0001c570: 6f20 7b72 6573 6f6c 7665 647d 2e22 290a  o {resolved}.").
-0001c580: 2020 2020 2020 2020 726e 203d 2072 6573          rn = res
-0001c590: 6f6c 7665 640a 2020 2020 726e 5f74 7063  olved.    rn_tpc
-0001c5a0: 735f 6d61 6a20 3d20 7b27 4927 3a20 302c  s_maj = {'I': 0,
-0001c5b0: 2027 4949 273a 2032 2c20 2749 4949 273a   'II': 2, 'III':
-0001c5c0: 2034 2c20 2749 5627 3a20 352c 2027 5627   4, 'IV': 5, 'V'
-0001c5d0: 3a20 372c 2027 5649 273a 2039 2c20 2756  : 7, 'VI': 9, 'V
-0001c5e0: 4949 273a 2031 317d 0a20 2020 2072 6e5f  II': 11}.    rn_
-0001c5f0: 7470 6373 5f6d 696e 203d 207b 2749 273a  tpcs_min = {'I':
-0001c600: 2030 2c20 2749 4927 3a20 322c 2027 4949   0, 'II': 2, 'II
-0001c610: 4927 3a20 332c 2027 4956 273a 2035 2c20  I': 3, 'IV': 5, 
-0001c620: 2756 273a 2037 2c20 2756 4927 3a20 382c  'V': 7, 'VI': 8,
-0001c630: 2027 5649 4927 3a20 3130 7d0a 2020 2020   'VII': 10}.    
-0001c640: 6163 6369 6465 6e74 616c 732c 2072 6e5f  accidentals, rn_
-0001c650: 7374 6570 203d 2073 706c 6974 5f73 6361  step = split_sca
-0001c660: 6c65 5f64 6567 7265 6528 726e 2c20 636f  le_degree(rn, co
-0001c670: 756e 743d 5472 7565 2c20 6c6f 6767 6572  unt=True, logger
-0001c680: 3d6c 6f67 6765 7229 0a20 2020 2069 6620  =logger).    if 
-0001c690: 616e 7928 7620 6973 204e 6f6e 6520 666f  any(v is None fo
-0001c6a0: 7220 7620 696e 2028 6163 6369 6465 6e74  r v in (accident
-0001c6b0: 616c 732c 2072 6e5f 7374 6570 2929 3a0a  als, rn_step)):.
-0001c6c0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001c6d0: 6f6e 650a 2020 2020 726e 5f73 7465 7020  one.    rn_step 
-0001c6e0: 3d20 726e 5f73 7465 702e 7570 7065 7228  = rn_step.upper(
-0001c6f0: 290a 2020 2020 7374 6570 5f74 7063 203d  ).    step_tpc =
-0001c700: 2072 6e5f 7470 6373 5f6d 696e 5b72 6e5f   rn_tpcs_min[rn_
-0001c710: 7374 6570 5d20 6966 2067 6c6f 6261 6c5f  step] if global_
-0001c720: 6d69 6e6f 7220 656c 7365 2072 6e5f 7470  minor else rn_tp
-0001c730: 6373 5f6d 616a 5b72 6e5f 7374 6570 5d0a  cs_maj[rn_step].
-0001c740: 2020 2020 7265 7475 726e 2073 7465 705f      return step_
-0001c750: 7470 6320 2b20 6163 6369 6465 6e74 616c  tpc + accidental
-0001c760: 730a 0a0a 6465 6620 7363 616c 655f 6465  s...def scale_de
-0001c770: 6772 6565 326e 616d 6528 7364 2c20 6c6f  gree2name(sd, lo
-0001c780: 6361 6c6b 6579 2c20 676c 6f62 616c 6b65  calkey, globalke
-0001c790: 7929 3a0a 2020 2020 2222 2220 466f 7220  y):.    """ For 
-0001c7a0: 6578 616d 706c 652c 2073 6361 6c65 2064  example, scale d
-0001c7b0: 6567 7265 6520 2d31 2028 6669 6674 6873  egree -1 (fifths
-0001c7c0: 2c20 692e 652e 2074 6865 2073 7562 646f  , i.e. the subdo
-0001c7d0: 6d69 6e61 6e74 2920 6f66 2074 6865 206c  minant) of the l
-0001c7e0: 6f63 616c 6b65 7920 6f66 2027 5649 2720  ocalkey of 'VI' 
-0001c7f0: 7769 7468 696e 2027 4527 206d 696e 6f72  within 'E' minor
-0001c800: 2069 7320 2746 272e 0a0a 2020 2020 5061   is 'F'...    Pa
-0001c810: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-0001c820: 2d2d 2d2d 2d2d 2d0a 2020 2020 7364 203a  -------.    sd :
-0001c830: 203a 6f62 6a3a 6069 6e74 600a 2020 2020   :obj:`int`.    
-0001c840: 2020 2020 5363 616c 6520 6465 6772 6565      Scale degree
-0001c850: 2065 7870 7265 7373 6564 2061 7320 6469   expressed as di
-0001c860: 7374 616e 6365 2066 726f 6d20 7468 6520  stance from the 
-0001c870: 746f 6e69 6320 696e 2066 6966 7468 732e  tonic in fifths.
-0001c880: 0a20 2020 206c 6f63 616c 6b65 7920 3a20  .    localkey : 
-0001c890: 3a6f 626a 3a60 7374 7260 0a20 2020 2020  :obj:`str`.     
-0001c8a0: 2020 204c 6f63 616c 206b 6579 2069 6e20     Local key in 
-0001c8b0: 7768 6963 6820 7468 6520 7363 616c 6520  which the scale 
-0001c8c0: 6465 6772 6565 2069 7320 7369 7475 6174  degree is situat
-0001c8d0: 6564 2c20 6173 2052 6f6d 616e 206e 756d  ed, as Roman num
-0001c8e0: 6572 616c 2028 6361 6e20 696e 636c 7564  eral (can includ
-0001c8f0: 6520 736c 6173 6820 6e6f 7461 7469 6f6e  e slash notation
-0001c900: 2073 7563 6820 6173 2056 2f69 6929 2e0a   such as V/ii)..
-0001c910: 2020 2020 676c 6f62 616c 6b65 7920 3a20      globalkey : 
-0001c920: 3a6f 626a 3a60 7374 7260 0a20 2020 2020  :obj:`str`.     
-0001c930: 2020 2047 6c6f 6261 6c20 6b65 7920 6173     Global key as
-0001c940: 2061 206e 6f74 6520 6e61 6d65 2e20 452e   a note name. E.
-0001c950: 672e 2060 4162 6020 666f 7220 4162 206d  g. `Ab` for Ab m
-0001c960: 616a 6f72 2c20 6f72 2027 6323 2720 666f  ajor, or 'c#' fo
-0001c970: 7220 4323 206d 696e 6f72 2e0a 0a20 2020  r C# minor...   
-0001c980: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-0001c990: 2d2d 2d2d 0a20 2020 203a 6f62 6a3a 6073  ----.    :obj:`s
-0001c9a0: 7472 600a 2020 2020 2020 2020 5468 6520  tr`.        The 
-0001c9b0: 6769 7665 6e20 7363 616c 6520 6465 6772  given scale degr
-0001c9c0: 6565 2c20 6578 7072 6573 7365 6420 6173  ee, expressed as
-0001c9d0: 2061 206e 6f74 6520 6e61 6d65 2e0a 0a20   a note name... 
-0001c9e0: 2020 2022 2222 0a20 2020 2069 6620 616e     """.    if an
-0001c9f0: 7928 7064 2e69 736e 756c 6c28 7661 6c29  y(pd.isnull(val)
-0001ca00: 2066 6f72 2076 616c 2069 6e20 2873 642c   for val in (sd,
-0001ca10: 206c 6f63 616c 6b65 792c 2067 6c6f 6261   localkey, globa
-0001ca20: 6c6b 6579 2929 3a0a 2020 2020 2020 2020  lkey)):.        
-0001ca30: 7265 7475 726e 2070 642e 4e41 0a20 2020  return pd.NA.   
-0001ca40: 2067 6c6f 6261 6c5f 6d69 6e6f 7220 3d20   global_minor = 
-0001ca50: 676c 6f62 616c 6b65 792e 6973 6c6f 7765  globalkey.islowe
-0001ca60: 7228 290a 2020 2020 6966 2027 2f27 2069  r().    if '/' i
-0001ca70: 6e20 6c6f 6361 6c6b 6579 3a0a 2020 2020  n localkey:.    
-0001ca80: 2020 2020 6c6f 6361 6c6b 6579 203d 2072      localkey = r
-0001ca90: 6573 6f6c 7665 5f72 656c 6174 6976 655f  esolve_relative_
-0001caa0: 6b65 7973 286c 6f63 616c 6b65 792c 2067  keys(localkey, g
-0001cab0: 6c6f 6261 6c5f 6d69 6e6f 7229 0a20 2020  lobal_minor).   
-0001cac0: 206c 6b5f 6669 6674 6873 203d 2072 6f6d   lk_fifths = rom
-0001cad0: 616e 5f6e 756d 6572 616c 3266 6966 7468  an_numeral2fifth
-0001cae0: 7328 6c6f 6361 6c6b 6579 2c20 676c 6f62  s(localkey, glob
-0001caf0: 616c 5f6d 696e 6f72 290a 2020 2020 676b  al_minor).    gk
-0001cb00: 5f66 6966 7468 7320 3d20 6e61 6d65 3266  _fifths = name2f
-0001cb10: 6966 7468 7328 676c 6f62 616c 6b65 7929  ifths(globalkey)
-0001cb20: 0a20 2020 2073 645f 7472 616e 7370 6f73  .    sd_transpos
-0001cb30: 6564 203d 2073 6420 2b20 6c6b 5f66 6966  ed = sd + lk_fif
-0001cb40: 7468 7320 2b20 676b 5f66 6966 7468 730a  ths + gk_fifths.
-0001cb50: 2020 2020 7265 7475 726e 2066 6966 7468      return fifth
-0001cb60: 7332 6e61 6d65 2873 645f 7472 616e 7370  s2name(sd_transp
-0001cb70: 6f73 6564 290a 0a0a 4066 756e 6374 696f  osed)...@functio
-0001cb80: 6e5f 6c6f 6767 6572 0a64 6566 2073 6361  n_logger.def sca
-0001cb90: 6e5f 6469 7265 6374 6f72 7928 6469 7265  n_directory(dire
-0001cba0: 6374 6f72 793a 2073 7472 2c0a 2020 2020  ctory: str,.    
-0001cbb0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001cbc0: 696c 655f 7265 3a20 7374 7220 3d20 7222  ile_re: str = r"
-0001cbd0: 2e2a 222c 0a20 2020 2020 2020 2020 2020  .*",.           
-0001cbe0: 2020 2020 2020 2020 666f 6c64 6572 5f72          folder_r
-0001cbf0: 653a 2073 7472 203d 2072 222e 2a22 2c0a  e: str = r".*",.
-0001cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc10: 2020 2065 7863 6c75 6465 5f72 653a 2073     exclude_re: s
-0001cc20: 7472 203d 2072 225e 285c 2e7c 5f29 222c  tr = r"^(\.|_)",
-0001cc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cc40: 2020 2020 7265 6375 7273 6976 653a 2062      recursive: b
-0001cc50: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
-0001cc60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001cc70: 7562 6469 7273 3a20 626f 6f6c 203d 2046  ubdirs: bool = F
-0001cc80: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-0001cc90: 2020 2020 2020 2020 2070 726f 6772 6573           progres
-0001cca0: 733a 2062 6f6f 6c20 3d20 4661 6c73 652c  s: bool = False,
-0001ccb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ccc0: 2020 2020 6578 636c 7564 655f 6669 6c65      exclude_file
-0001ccd0: 735f 6f6e 6c79 3a20 626f 6f6c 203d 2046  s_only: bool = F
-0001cce0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-0001ccf0: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
-0001cd00: 6d65 7461 6461 7461 3a20 626f 6f6c 203d  metadata: bool =
-0001cd10: 2046 616c 7365 2920 2d3e 2049 7465 7261   False) -> Itera
-0001cd20: 746f 725b 556e 696f 6e5b 7374 722c 2054  tor[Union[str, T
-0001cd30: 7570 6c65 5b73 7472 2c20 7374 725d 5d5d  uple[str, str]]]
-0001cd40: 3a0a 2020 2020 2222 2220 4765 6e65 7261  :.    """ Genera
-0001cd50: 746f 7220 6f66 2066 696c 7465 7265 6420  tor of filtered 
-0001cd60: 6669 6c65 2070 6174 6873 2069 6e20 6060  file paths in ``
-0001cd70: 6469 7265 6374 6f72 7960 602e 0a0a 2020  directory``...  
-0001cd80: 2020 4172 6773 3a0a 2020 2020 2020 6469    Args:.      di
-0001cd90: 7265 6374 6f72 793a 2044 6972 6563 746f  rectory: Directo
-0001cda0: 7279 2074 6f20 6265 2073 6361 6e6e 6564  ry to be scanned
-0001cdb0: 2066 6f72 2066 696c 6573 2e0a 2020 2020   for files..    
-0001cdc0: 2020 6669 6c65 5f72 652c 2066 6f6c 6465    file_re, folde
-0001cdd0: 725f 7265 3a0a 2020 2020 2020 2020 2020  r_re:.          
-0001cde0: 5265 6775 6c61 7220 6578 7072 6573 7369  Regular expressi
-0001cdf0: 6f6e 7320 666f 7220 6669 6c74 6572 696e  ons for filterin
-0001ce00: 6720 6365 7274 6169 6e20 6669 6c65 206e  g certain file n
-0001ce10: 616d 6573 206f 7220 666f 6c64 6572 206e  ames or folder n
-0001ce20: 616d 6573 2e0a 2020 2020 2020 2020 2020  ames..          
-0001ce30: 5468 6520 7265 6745 7820 6172 6520 6368  The regEx are ch
-0001ce40: 6563 6b65 6420 7769 7468 2073 6561 7263  ecked with searc
-0001ce50: 6828 292c 206e 6f74 206d 6174 6368 2829  h(), not match()
-0001ce60: 2c20 616c 6c6f 7769 6e67 2066 6f72 2066  , allowing for f
-0001ce70: 757a 7a79 2073 6561 7263 682e 0a20 2020  uzzy search..   
-0001ce80: 2020 2065 7863 6c75 6465 5f72 653a 0a20     exclude_re:. 
-0001ce90: 2020 2020 2020 2020 2045 7863 6c75 6465           Exclude
-0001cea0: 2066 696c 6573 2061 6e64 2066 6f6c 6465   files and folde
-0001ceb0: 7273 2028 756e 6c65 7373 2060 6065 7863  rs (unless ``exc
-0001cec0: 6c75 6465 5f66 696c 6573 5f6f 6e6c 793d  lude_files_only=
-0001ced0: 5472 7565 6060 2920 636f 6e74 6169 6e69  True``) containi
-0001cee0: 6e67 2074 6869 7320 7265 6775 6c61 7220  ng this regular 
-0001cef0: 6578 7072 6573 7369 6f6e 2e0a 2020 2020  expression..    
-0001cf00: 2020 7265 6375 7273 6976 653a 2042 7920    recursive: By 
-0001cf10: 6465 6661 756c 742c 2073 7562 2d64 6972  default, sub-dir
-0001cf20: 6563 746f 7269 6573 2061 7265 2072 6563  ectories are rec
-0001cf30: 7572 7369 7665 6c79 2073 6361 6e6e 6564  ursively scanned
-0001cf40: 2e20 5061 7373 2046 616c 7365 2074 6f20  . Pass False to 
-0001cf50: 7363 616e 206f 6e6c 7920 6060 6469 7260  scan only ``dir`
-0001cf60: 602e 0a20 2020 2020 2073 7562 6469 7273  `..      subdirs
-0001cf70: 3a20 4279 2064 6566 6175 6c74 2c20 6675  : By default, fu
-0001cf80: 6c6c 2066 696c 6520 7061 7468 7320 6172  ll file paths ar
-0001cf90: 6520 7265 7475 726e 6564 2e20 5061 7373  e returned. Pass
-0001cfa0: 2054 7275 6520 746f 2072 6574 7572 6e20   True to return 
-0001cfb0: 2870 6174 682c 206e 616d 6529 2074 7570  (path, name) tup
-0001cfc0: 6c65 7320 696e 7374 6561 642e 0a20 2020  les instead..   
-0001cfd0: 2020 2070 726f 6772 6573 733a 2050 6173     progress: Pas
-0001cfe0: 7320 5472 7565 2074 6f20 6469 7370 6c61  s True to displa
-0001cff0: 7920 7468 6520 7072 6f67 7265 7373 2028  y the progress (
-0001d000: 7573 6566 756c 2066 6f72 206c 6172 6765  useful for large
-0001d010: 2064 6972 6563 746f 7269 6573 292e 0a20   directories).. 
-0001d020: 2020 2020 2065 7863 6c75 6465 5f66 696c       exclude_fil
-0001d030: 6573 5f6f 6e6c 793a 0a20 2020 2020 2020  es_only:.       
-0001d040: 2020 2042 7920 6465 6661 756c 742c 2060     By default, `
-0001d050: 6065 7863 6c75 6465 5f72 6560 6020 6578  `exclude_re`` ex
-0001d060: 636c 7564 6573 2066 696c 6573 2061 6e64  cludes files and
-0001d070: 2066 6f6c 6465 722e 2050 6173 7320 5472   folder. Pass Tr
-0001d080: 7565 2074 6f20 6578 636c 7564 6520 6f6e  ue to exclude on
-0001d090: 6c79 2066 696c 6573 206d 6174 6368 696e  ly files matchin
-0001d0a0: 6720 7468 6520 7265 6745 782e 0a20 2020  g the regEx..   
-0001d0b0: 2020 2072 6574 7572 6e5f 6d65 7461 6461     return_metada
-0001d0c0: 7461 3a0a 2020 2020 2020 2020 2020 4966  ta:.          If
-0001d0d0: 2073 6574 2074 6f20 5472 7565 2c20 276d   set to True, 'm
-0001d0e0: 6574 6164 6174 612e 7473 7627 2061 7265  etadata.tsv' are
-0001d0f0: 2061 6c77 6179 7320 7969 656c 6465 6420   always yielded 
-0001d100: 7265 6761 7264 6c65 7373 206f 6620 6060  regardless of ``
-0001d110: 6669 6c65 5f72 6560 602e 0a0a 2020 2020  file_re``...    
-0001d120: 5969 656c 6473 3a0a 2020 2020 2020 4675  Yields:.      Fu
-0001d130: 6c6c 2066 696c 6520 7061 7468 206f 722c  ll file path or,
-0001d140: 2069 6620 6060 7375 6264 6972 733d 5472   if ``subdirs=Tr
-0001d150: 7565 6060 2c20 2870 6174 682c 2066 696c  ue``, (path, fil
-0001d160: 655f 6e61 6d65 2920 7061 6972 7320 696e  e_name) pairs in
-0001d170: 2072 616e 646f 6d20 6f72 6465 722e 0a20   random order.. 
-0001d180: 2020 2022 2222 0a20 2020 2069 6620 6669     """.    if fi
-0001d190: 6c65 5f72 6520 6973 204e 6f6e 653a 0a20  le_re is None:. 
-0001d1a0: 2020 2020 2020 2066 696c 655f 7265 203d         file_re =
-0001d1b0: 2072 222e 2a22 0a20 2020 2069 6620 666f   r".*".    if fo
-0001d1c0: 6c64 6572 5f72 6520 6973 204e 6f6e 653a  lder_re is None:
-0001d1d0: 0a20 2020 2020 2020 2066 6f6c 6465 725f  .        folder_
-0001d1e0: 7265 203d 2072 222e 2a22 0a0a 2020 2020  re = r".*"..    
-0001d1f0: 6465 6620 7472 6176 6572 7365 2864 293a  def traverse(d):
-0001d200: 0a20 2020 2020 2020 206e 6f6e 6c6f 6361  .        nonloca
-0001d210: 6c20 636f 756e 7465 720a 0a20 2020 2020  l counter..     
-0001d220: 2020 2064 6566 2063 6865 636b 5f72 6567     def check_reg
-0001d230: 6578 2872 6567 2c20 732c 2065 7863 6c3d  ex(reg, s, excl=
-0001d240: 6578 636c 7564 655f 7265 293a 0a20 2020  exclude_re):.   
-0001d250: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0001d260: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001d270: 7320 3d20 7265 2e73 6561 7263 6828 7265  s = re.search(re
-0001d280: 672c 2073 2920 6973 206e 6f74 204e 6f6e  g, s) is not Non
-0001d290: 6520 616e 6420 7265 2e73 6561 7263 6828  e and re.search(
-0001d2a0: 6578 636c 2c20 7329 2069 7320 4e6f 6e65  excl, s) is None
-0001d2b0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0001d2c0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-0001d2d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001d2e0: 7269 6e74 2872 6567 290a 2020 2020 2020  rint(reg).      
-0001d2f0: 2020 2020 2020 2020 2020 7261 6973 650a            raise.
-0001d300: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001d310: 726e 2072 6573 0a0a 2020 2020 2020 2020  rn res..        
-0001d320: 666f 7220 6469 725f 656e 7472 7920 696e  for dir_entry in
-0001d330: 206f 732e 7363 616e 6469 7228 6429 3a0a   os.scandir(d):.
-0001d340: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0001d350: 203d 2064 6972 5f65 6e74 7279 2e6e 616d   = dir_entry.nam
-0001d360: 650a 2020 2020 2020 2020 2020 2020 7061  e.            pa
-0001d370: 7468 203d 206f 732e 7061 7468 2e6a 6f69  th = os.path.joi
-0001d380: 6e28 642c 206e 616d 6529 0a20 2020 2020  n(d, name).     
-0001d390: 2020 2020 2020 2069 6620 6469 725f 656e         if dir_en
-0001d3a0: 7472 792e 6973 5f64 6972 2829 2061 6e64  try.is_dir() and
-0001d3b0: 2028 7265 6375 7273 6976 6520 6f72 2066   (recursive or f
-0001d3c0: 6f6c 6465 725f 7265 2021 3d20 272e 2a27  older_re != '.*'
-0001d3d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001d3e0: 2020 2066 6f72 2072 6573 2069 6e20 7472     for res in tr
-0001d3f0: 6176 6572 7365 2870 6174 6829 3a0a 2020  averse(path):.  
-0001d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d410: 2020 7969 656c 6420 7265 730a 2020 2020    yield res.    
-0001d420: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001d430: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001d440: 2070 6261 7220 6973 206e 6f74 204e 6f6e   pbar is not Non
-0001d450: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001d460: 2020 2020 2020 2070 6261 722e 7570 6461         pbar.upda
-0001d470: 7465 2829 0a20 2020 2020 2020 2020 2020  te().           
-0001d480: 2020 2020 2069 6620 666f 6c64 6572 5f72       if folder_r
-0001d490: 6520 3d3d 2027 2e2a 273a 0a20 2020 2020  e == '.*':.     
-0001d4a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001d4b0: 6f6c 6465 725f 7061 7373 6573 203d 2054  older_passes = T
-0001d4c0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0001d4d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001d4e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001d4f0: 6c64 6572 5f70 6174 6820 3d20 6f73 2e70  lder_path = os.p
-0001d500: 6174 682e 6469 726e 616d 6528 7061 7468  ath.dirname(path
-0001d510: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d520: 2020 2020 2020 6966 2072 6563 7572 7369        if recursi
-0001d530: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
-0001d540: 2020 2020 2020 2020 2020 2020 666f 6c64              fold
-0001d550: 6572 5f70 6173 7365 7320 3d20 6368 6563  er_passes = chec
-0001d560: 6b5f 7265 6765 7828 666f 6c64 6572 5f72  k_regex(folder_r
-0001d570: 652c 2066 6f6c 6465 725f 7061 7468 2c20  e, folder_path, 
-0001d580: 6578 636c 3d27 5e24 2729 2020 2320 7061  excl='^$')  # pa
-0001d590: 7373 6573 2069 6620 7468 6520 666f 6c64  sses if the fold
-0001d5a0: 6572 2070 6174 6820 6d61 7463 6865 7320  er path matches 
-0001d5b0: 7468 6520 7265 6765 780a 2020 2020 2020  the regex.      
-0001d5c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001d5d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001d5e0: 2020 2020 2020 2020 2020 2020 666f 6c64              fold
-0001d5f0: 6572 203d 206f 732e 7061 7468 2e62 6173  er = os.path.bas
-0001d600: 656e 616d 6528 666f 6c64 6572 5f70 6174  ename(folder_pat
-0001d610: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-0001d620: 2020 2020 2020 2020 2020 2066 6f6c 6465             folde
-0001d630: 725f 7061 7373 6573 203d 2063 6865 636b  r_passes = check
-0001d640: 5f72 6567 6578 2866 6f6c 6465 725f 7265  _regex(folder_re
-0001d650: 2c20 666f 6c64 6572 2c20 6578 636c 3d27  , folder, excl='
-0001d660: 5e24 2729 2020 2320 7061 7373 6573 2069  ^$')  # passes i
-0001d670: 6620 7468 6520 666f 6c64 6572 206e 616d  f the folder nam
-0001d680: 6520 6974 7365 6c66 206d 6174 6368 6573  e itself matches
-0001d690: 2074 6865 2072 6567 6578 0a20 2020 2020   the regex.     
-0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d6b0: 6620 666f 6c64 6572 5f70 6173 7365 7320  f folder_passes 
-0001d6c0: 616e 6420 6e6f 7420 6578 636c 7564 655f  and not exclude_
-0001d6d0: 6669 6c65 735f 6f6e 6c79 3a20 2320 5472  files_only: # Tr
-0001d6e0: 7565 2069 6620 7468 6520 6578 636c 7564  ue if the exclud
-0001d6f0: 655f 7265 2073 686f 756c 6420 616c 736f  e_re should also
-0001d700: 2065 7863 6c75 6465 2066 6f6c 6465 7220   exclude folder 
-0001d710: 6e61 6d65 730a 2020 2020 2020 2020 2020  names.          
-0001d720: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001d730: 6c64 6572 5f70 6173 7365 7320 3d20 6368  lder_passes = ch
-0001d740: 6563 6b5f 7265 6765 7828 666f 6c64 6572  eck_regex(folder
-0001d750: 5f72 652c 2066 6f6c 6465 725f 7061 7468  _re, folder_path
-0001d760: 2920 2320 6973 2066 616c 7365 2069 6620  ) # is false if 
-0001d770: 616e 7920 7061 7274 206f 6620 7468 6520  any part of the 
-0001d780: 666f 6c64 6572 2070 6174 6820 6d61 7463  folder path matc
-0001d790: 6865 7320 6578 636c 7564 655f 7265 0a20  hes exclude_re. 
-0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d7b0: 6620 6469 725f 656e 7472 792e 6973 5f66  f dir_entry.is_f
-0001d7c0: 696c 6528 2920 616e 6420 666f 6c64 6572  ile() and folder
-0001d7d0: 5f70 6173 7365 7320 616e 6420 2863 6865  _passes and (che
-0001d7e0: 636b 5f72 6567 6578 2866 696c 655f 7265  ck_regex(file_re
-0001d7f0: 2c20 6e61 6d65 2920 6f72 2028 7265 7475  , name) or (retu
-0001d800: 726e 5f6d 6574 6164 6174 6120 616e 6420  rn_metadata and 
-0001d810: 6e61 6d65 3d3d 276d 6574 6164 6174 612e  name=='metadata.
-0001d820: 7473 7627 2929 3a0a 2020 2020 2020 2020  tsv')):.        
-0001d830: 2020 2020 2020 2020 2020 2020 636f 756e              coun
-0001d840: 7465 7220 2b3d 2031 0a20 2020 2020 2020  ter += 1.       
-0001d850: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001d860: 7062 6172 2069 7320 6e6f 7420 4e6f 6e65  pbar is not None
-0001d870: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d880: 2020 2020 2020 2020 2020 7062 6172 2e73            pbar.s
-0001d890: 6574 5f70 6f73 7466 6978 287b 2773 656c  et_postfix({'sel
-0001d8a0: 6563 7465 6427 3a20 636f 756e 7465 727d  ected': counter}
-0001d8b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d8c0: 2020 2020 2020 6966 2073 7562 6469 7273        if subdirs
-0001d8d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d8e0: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-0001d8f0: 2864 2c20 6e61 6d65 290a 2020 2020 2020  (d, name).      
-0001d900: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001d910: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001d920: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
-0001d930: 6420 7061 7468 0a0a 2020 2020 6966 2065  d path..    if e
-0001d940: 7863 6c75 6465 5f72 6520 6973 204e 6f6e  xclude_re is Non
-0001d950: 6520 6f72 2065 7863 6c75 6465 5f72 6520  e or exclude_re 
-0001d960: 3d3d 2027 273a 0a20 2020 2020 2020 2065  == '':.        e
-0001d970: 7863 6c75 6465 5f72 6520 3d20 275e 2427  xclude_re = '^$'
-0001d980: 0a20 2020 2064 6972 6563 746f 7279 203d  .    directory =
-0001d990: 2072 6573 6f6c 7665 5f64 6972 2864 6972   resolve_dir(dir
-0001d9a0: 6563 746f 7279 290a 2020 2020 636f 756e  ectory).    coun
-0001d9b0: 7465 7220 3d20 300a 2020 2020 6966 206e  ter = 0.    if n
-0001d9c0: 6f74 206f 732e 7061 7468 2e69 7364 6972  ot os.path.isdir
-0001d9d0: 2864 6972 6563 746f 7279 293a 0a20 2020  (directory):.   
-0001d9e0: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
-0001d9f0: 7228 224e 6f74 2061 6e20 6578 6973 7469  r("Not an existi
-0001da00: 6e67 2064 6972 6563 746f 7279 3a20 2220  ng directory: " 
-0001da10: 2b20 6469 7265 6374 6f72 7929 0a20 2020  + directory).   
-0001da20: 2020 2020 2072 6574 7572 6e20 6974 6572       return iter
-0001da30: 285b 5d29 0a20 2020 2070 6261 7220 3d20  ([]).    pbar = 
-0001da40: 7471 646d 2864 6573 633d 2753 6361 6e6e  tqdm(desc='Scann
-0001da50: 696e 6720 6669 6c65 7327 2c20 756e 6974  ing files', unit
-0001da60: 3d27 2066 696c 6573 2729 2069 6620 7072  =' files') if pr
-0001da70: 6f67 7265 7373 2065 6c73 6520 4e6f 6e65  ogress else None
-0001da80: 0a20 2020 2072 6574 7572 6e20 7472 6176  .    return trav
-0001da90: 6572 7365 2864 6972 6563 746f 7279 290a  erse(directory).
-0001daa0: 0a0a 6465 6620 636f 6c75 6d6e 5f6f 7264  ..def column_ord
-0001dab0: 6572 2864 662c 2066 6972 7374 5f63 6f6c  er(df, first_col
-0001dac0: 733d 4e6f 6e65 2c20 736f 7274 3d54 7275  s=None, sort=Tru
-0001dad0: 6529 3a0a 2020 2020 2222 2253 6f72 7420  e):.    """Sort 
-0001dae0: 4461 7461 4672 616d 6520 636f 6c75 6d6e  DataFrame column
-0001daf0: 7320 736f 2074 6861 7420 7468 6579 2073  s so that they s
-0001db00: 7461 7274 2077 6974 6820 7468 6520 6f72  tart with the or
-0001db10: 6465 7220 6f66 2060 6066 6972 7374 5f63  der of ``first_c
-0001db20: 6f6c 7360 602c 2066 6f6c 6c6f 7765 6420  ols``, followed 
-0001db30: 6279 2074 686f 7365 206e 6f74 2069 6e63  by those not inc
-0001db40: 6c75 6465 642e 2022 2222 0a20 2020 2069  luded. """.    i
-0001db50: 6620 6669 7273 745f 636f 6c73 2069 7320  f first_cols is 
-0001db60: 4e6f 6e65 3a0a 2020 2020 2020 2020 6669  None:.        fi
-0001db70: 7273 745f 636f 6c73 203d 2053 5441 4e44  rst_cols = STAND
-0001db80: 4152 445f 434f 4c55 4d4e 5f4f 5244 4552  ARD_COLUMN_ORDER
-0001db90: 0a20 2020 2063 6f6c 7320 3d20 6466 2e63  .    cols = df.c
-0001dba0: 6f6c 756d 6e73 0a20 2020 2072 656d 6169  olumns.    remai
-0001dbb0: 6e69 6e67 203d 205b 636f 6c20 666f 7220  ning = [col for 
-0001dbc0: 636f 6c20 696e 2063 6f6c 7320 6966 2063  col in cols if c
-0001dbd0: 6f6c 206e 6f74 2069 6e20 6669 7273 745f  ol not in first_
-0001dbe0: 636f 6c73 5d0a 2020 2020 6966 2073 6f72  cols].    if sor
-0001dbf0: 743a 0a20 2020 2020 2020 2023 2050 726f  t:.        # Pro
-0001dc00: 626c 656d 3a20 7374 7269 6e67 2073 6f72  blem: string sor
-0001dc10: 7420 6f72 6465 7273 2073 7461 6666 5f31  t orders staff_1
-0001dc20: 2073 7461 6666 5f31 3020 7374 6166 665f   staff_10 staff_
-0001dc30: 3131 202e 2e2e 2061 6e64 206f 6e6c 7920  11 ... and only 
-0001dc40: 7468 656e 2073 7461 6666 5f32 0a20 2020  then staff_2.   
-0001dc50: 2020 2020 2072 656d 6169 6e69 6e67 203d       remaining =
-0001dc60: 2073 6f72 7465 6428 7265 6d61 696e 696e   sorted(remainin
-0001dc70: 6729 0a20 2020 2063 6f6c 756d 6e5f 6f72  g).    column_or
-0001dc80: 6465 7220 3d20 5b63 6f6c 2066 6f72 2063  der = [col for c
-0001dc90: 6f6c 2069 6e20 6669 7273 745f 636f 6c73  ol in first_cols
-0001dca0: 2069 6620 636f 6c20 696e 2063 6f6c 735d   if col in cols]
-0001dcb0: 202b 2072 656d 6169 6e69 6e67 0a20 2020   + remaining.   
-0001dcc0: 2072 6574 7572 6e20 6466 5b63 6f6c 756d   return df[colum
-0001dcd0: 6e5f 6f72 6465 725d 0a0a 0a64 6566 2073  n_order]...def s
-0001dce0: 6f72 745f 6e6f 7465 5f6c 6973 7428 6466  ort_note_list(df
-0001dcf0: 2c20 6d63 5f63 6f6c 3d27 6d63 272c 206d  , mc_col='mc', m
-0001dd00: 635f 6f6e 7365 745f 636f 6c3d 276d 635f  c_onset_col='mc_
-0001dd10: 6f6e 7365 7427 2c20 6d69 6469 5f63 6f6c  onset', midi_col
-0001dd20: 3d27 6d69 6469 272c 2064 7572 6174 696f  ='midi', duratio
-0001dd30: 6e5f 636f 6c3d 2764 7572 6174 696f 6e27  n_col='duration'
-0001dd40: 293a 0a20 2020 2022 2222 2053 6f72 7420  ):.    """ Sort 
-0001dd50: 6576 6572 7920 6d65 6173 7572 6520 284d  every measure (M
-0001dd60: 4329 2062 7920 5b27 6d63 5f6f 6e73 6574  C) by ['mc_onset
-0001dd70: 272c 2027 6d69 6469 272c 2027 6475 7261  ', 'midi', 'dura
-0001dd80: 7469 6f6e 275d 2077 6869 6c65 206c 6561  tion'] while lea
-0001dd90: 7669 6e67 2067 7261 6365 6e6f 7465 7327  ving gracenotes'
-0001dda0: 206f 7264 6572 2028 6475 7261 7469 6f6e   order (duration
-0001ddb0: 3d30 2920 696e 7461 6374 2e0a 0a20 2020  =0) intact...   
-0001ddc0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0001ddd0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064  ----------.    d
-0001dde0: 660a 2020 2020 6d63 5f63 6f6c 0a20 2020  f.    mc_col.   
-0001ddf0: 206d 635f 6f6e 7365 745f 636f 6c0a 2020   mc_onset_col.  
-0001de00: 2020 6d69 6469 5f63 6f6c 0a20 2020 2064    midi_col.    d
-0001de10: 7572 6174 696f 6e5f 636f 6c0a 0a20 2020  uration_col..   
-0001de20: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-0001de30: 2d2d 2d2d 0a0a 2020 2020 2222 220a 2020  ----..    """.  
-0001de40: 2020 6466 203d 2064 662e 636f 7079 2829    df = df.copy()
-0001de50: 0a20 2020 2069 735f 6772 6163 6520 3d20  .    is_grace = 
-0001de60: 6466 5b64 7572 6174 696f 6e5f 636f 6c5d  df[duration_col]
-0001de70: 203d 3d20 300a 2020 2020 6772 6163 655f   == 0.    grace_
-0001de80: 6978 203d 207b 6b3a 2076 2e74 6f5f 6e75  ix = {k: v.to_nu
-0001de90: 6d70 7928 2920 666f 7220 6b2c 2076 2069  mpy() for k, v i
-0001dea0: 6e20 6466 5b69 735f 6772 6163 655d 2e67  n df[is_grace].g
-0001deb0: 726f 7570 6279 285b 6d63 5f63 6f6c 2c20  roupby([mc_col, 
-0001dec0: 6d63 5f6f 6e73 6574 5f63 6f6c 5d29 2e67  mc_onset_col]).g
-0001ded0: 726f 7570 732e 6974 656d 7328 297d 0a20  roups.items()}. 
-0001dee0: 2020 2068 6173 5f6e 616e 203d 2064 665b     has_nan = df[
-0001def0: 6d69 6469 5f63 6f6c 5d2e 6973 6e61 2829  midi_col].isna()
-0001df00: 2e61 6e79 2829 0a20 2020 2069 6620 6861  .any().    if ha
-0001df10: 735f 6e61 6e3a 0a20 2020 2020 2020 2077  s_nan:.        w
-0001df20: 6974 6820 7761 726e 696e 6773 2e63 6174  ith warnings.cat
-0001df30: 6368 5f77 6172 6e69 6e67 7328 293a 0a20  ch_warnings():. 
-0001df40: 2020 2020 2020 2020 2020 2023 2053 6574             # Set
-0001df50: 7469 6e67 2076 616c 7565 7320 696e 2d70  ting values in-p
-0001df60: 6c61 6365 2069 7320 6669 6e65 2c20 6967  lace is fine, ig
-0001df70: 6e6f 7265 2074 6865 2077 6172 6e69 6e67  nore the warning
-0001df80: 2069 6e20 5061 6e64 6173 203e 3d20 312e   in Pandas >= 1.
-0001df90: 352e 300a 2020 2020 2020 2020 2020 2020  5.0.            
-0001dfa0: 2320 5468 6973 2063 616e 2062 6520 7265  # This can be re
-0001dfb0: 6d6f 7665 642c 2069 6620 5061 6e64 6173  moved, if Pandas
-0001dfc0: 2031 2e35 2e30 2064 6f65 7320 6e6f 7420   1.5.0 does not 
-0001dfd0: 6e65 6564 2074 6f20 6265 2073 7570 706f  need to be suppo
-0001dfe0: 7274 6564 2061 6e79 206c 6f6e 6765 722e  rted any longer.
-0001dff0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-0001e000: 6565 2061 6c73 6f3a 2068 7474 7073 3a2f  ee also: https:/
-0001e010: 2f73 7461 636b 6f76 6572 666c 6f77 2e63  /stackoverflow.c
-0001e020: 6f6d 2f71 2f37 3430 3537 3336 372f 3835  om/q/74057367/85
-0001e030: 3935 3931 0a20 2020 2020 2020 2020 2020  9591.           
-0001e040: 2077 6172 6e69 6e67 732e 6669 6c74 6572   warnings.filter
-0001e050: 7761 726e 696e 6773 280a 2020 2020 2020  warnings(.      
-0001e060: 2020 2020 2020 2020 2020 2269 676e 6f72            "ignor
-0001e070: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-0001e080: 2020 2020 6361 7465 676f 7279 3d46 7574      category=Fut
-0001e090: 7572 6557 6172 6e69 6e67 2c0a 2020 2020  ureWarning,.    
-0001e0a0: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
-0001e0b0: 6167 653d 280a 2020 2020 2020 2020 2020  age=(.          
-0001e0c0: 2020 2020 2020 2020 2020 222e 2a77 696c            ".*wil
-0001e0d0: 6c20 6174 7465 6d70 7420 746f 2073 6574  l attempt to set
-0001e0e0: 2074 6865 2076 616c 7565 7320 696e 706c   the values inpl
-0001e0f0: 6163 6520 696e 7374 6561 6420 6f66 2061  ace instead of a
-0001e100: 6c77 6179 7320 7365 7474 696e 6720 6120  lways setting a 
-0001e110: 6e65 7720 6172 7261 792e 2022 0a20 2020  new array. ".   
-0001e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e130: 2022 546f 2072 6574 6169 6e20 7468 6520   "To retain the 
-0001e140: 6f6c 6420 6265 6861 7669 6f72 2c20 7573  old behavior, us
-0001e150: 6520 6569 7468 6572 2e2a 220a 2020 2020  e either.*".    
-0001e160: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-0001e170: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001e180: 2020 2020 2020 2020 2064 662e 6c6f 635b           df.loc[
-0001e190: 3a2c 206d 6964 695f 636f 6c5d 203d 2064  :, midi_col] = d
-0001e1a0: 665b 6d69 6469 5f63 6f6c 5d2e 6669 6c6c  f[midi_col].fill
-0001e1b0: 6e61 2831 3030 3029 0a20 2020 206e 6f72  na(1000).    nor
-0001e1c0: 6d61 6c5f 6978 203d 2064 662e 6c6f 635b  mal_ix = df.loc[
-0001e1d0: 7e69 735f 6772 6163 652c 205b 6d63 5f63  ~is_grace, [mc_c
-0001e1e0: 6f6c 2c20 6d63 5f6f 6e73 6574 5f63 6f6c  ol, mc_onset_col
-0001e1f0: 2c20 6d69 6469 5f63 6f6c 2c20 6475 7261  , midi_col, dura
-0001e200: 7469 6f6e 5f63 6f6c 5d5d 2e67 726f 7570  tion_col]].group
-0001e210: 6279 285b 6d63 5f63 6f6c 2c20 6d63 5f6f  by([mc_col, mc_o
-0001e220: 6e73 6574 5f63 6f6c 5d29 2e61 7070 6c79  nset_col]).apply
-0001e230: 280a 2020 2020 2020 2020 6c61 6d62 6461  (.        lambda
-0001e240: 2067 723a 2067 722e 696e 6465 785b 6e70   gr: gr.index[np
-0001e250: 2e6c 6578 736f 7274 2828 6772 2e76 616c  .lexsort((gr.val
-0001e260: 7565 735b 3a2c 2033 5d2c 2067 722e 7661  ues[:, 3], gr.va
-0001e270: 6c75 6573 5b3a 2c20 325d 2929 5d2e 746f  lues[:, 2]))].to
-0001e280: 5f6e 756d 7079 2829 290a 2020 2020 736f  _numpy()).    so
-0001e290: 7274 6564 5f69 7873 203d 205b 6e70 2e63  rted_ixs = [np.c
-0001e2a0: 6f6e 6361 7465 6e61 7465 2828 6772 6163  oncatenate((grac
-0001e2b0: 655f 6978 5b6f 6e73 6574 5d2c 2069 7829  e_ix[onset], ix)
-0001e2c0: 2920 6966 206f 6e73 6574 2069 6e20 6772  ) if onset in gr
-0001e2d0: 6163 655f 6978 2065 6c73 6520 6978 2066  ace_ix else ix f
-0001e2e0: 6f72 206f 6e73 6574 2c20 6978 2069 6e0a  or onset, ix in.
-0001e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e300: 2020 6e6f 726d 616c 5f69 782e 6974 656d    normal_ix.item
-0001e310: 7328 295d 0a20 2020 2064 6620 3d20 6466  s()].    df = df
-0001e320: 2e72 6569 6e64 6578 286e 702e 636f 6e63  .reindex(np.conc
-0001e330: 6174 656e 6174 6528 736f 7274 6564 5f69  atenate(sorted_i
-0001e340: 7873 2929 2e72 6573 6574 5f69 6e64 6578  xs)).reset_index
-0001e350: 2864 726f 703d 5472 7565 290a 2020 2020  (drop=True).    
-0001e360: 6966 2068 6173 5f6e 616e 3a0a 2020 2020  if has_nan:.    
-0001e370: 2020 2020 7769 7468 2077 6172 6e69 6e67      with warning
-0001e380: 732e 6361 7463 685f 7761 726e 696e 6773  s.catch_warnings
-0001e390: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0001e3a0: 2320 5365 7474 696e 6720 7661 6c75 6573  # Setting values
-0001e3b0: 2069 6e2d 706c 6163 6520 6973 2066 696e   in-place is fin
-0001e3c0: 652c 2069 676e 6f72 6520 7468 6520 7761  e, ignore the wa
-0001e3d0: 726e 696e 6720 696e 2050 616e 6461 7320  rning in Pandas 
-0001e3e0: 3e3d 2031 2e35 2e30 0a20 2020 2020 2020  >= 1.5.0.       
-0001e3f0: 2020 2020 2023 2054 6869 7320 6361 6e20       # This can 
-0001e400: 6265 2072 656d 6f76 6564 2c20 6966 2050  be removed, if P
-0001e410: 616e 6461 7320 312e 352e 3020 646f 6573  andas 1.5.0 does
-0001e420: 206e 6f74 206e 6565 6420 746f 2062 6520   not need to be 
-0001e430: 7375 7070 6f72 7465 6420 616e 7920 6c6f  supported any lo
-0001e440: 6e67 6572 2e0a 2020 2020 2020 2020 2020  nger..          
-0001e450: 2020 2320 5365 6520 616c 736f 3a20 6874    # See also: ht
-0001e460: 7470 733a 2f2f 7374 6163 6b6f 7665 7266  tps://stackoverf
-0001e470: 6c6f 772e 636f 6d2f 712f 3734 3035 3733  low.com/q/740573
-0001e480: 3637 2f38 3539 3539 310a 2020 2020 2020  67/859591.      
-0001e490: 2020 2020 2020 7761 726e 696e 6773 2e66        warnings.f
-0001e4a0: 696c 7465 7277 6172 6e69 6e67 7328 0a20  ilterwarnings(. 
-0001e4b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001e4c0: 6967 6e6f 7265 222c 0a20 2020 2020 2020  ignore",.       
-0001e4d0: 2020 2020 2020 2020 2063 6174 6567 6f72           categor
-0001e4e0: 793d 4675 7475 7265 5761 726e 696e 672c  y=FutureWarning,
-0001e4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e500: 206d 6573 7361 6765 3d28 0a20 2020 2020   message=(.     
-0001e510: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001e520: 2e2a 7769 6c6c 2061 7474 656d 7074 2074  .*will attempt t
-0001e530: 6f20 7365 7420 7468 6520 7661 6c75 6573  o set the values
-0001e540: 2069 6e70 6c61 6365 2069 6e73 7465 6164   inplace instead
-0001e550: 206f 6620 616c 7761 7973 2073 6574 7469   of always setti
-0001e560: 6e67 2061 206e 6577 2061 7272 6179 2e20  ng a new array. 
-0001e570: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001e580: 2020 2020 2020 2254 6f20 7265 7461 696e        "To retain
-0001e590: 2074 6865 206f 6c64 2062 6568 6176 696f   the old behavio
-0001e5a0: 722c 2075 7365 2065 6974 6865 722e 2a22  r, use either.*"
-0001e5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e5c0: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-0001e5d0: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-0001e5e0: 2e6c 6f63 5b3a 2c20 6d69 6469 5f63 6f6c  .loc[:, midi_col
-0001e5f0: 5d20 3d20 6466 5b6d 6964 695f 636f 6c5d  ] = df[midi_col]
-0001e600: 2e72 6570 6c61 6365 287b 3130 3030 3a20  .replace({1000: 
-0001e610: 7064 2e4e 417d 292e 6173 7479 7065 2827  pd.NA}).astype('
-0001e620: 496e 7436 3427 290a 2020 2020 7265 7475  Int64').    retu
-0001e630: 726e 2064 660a 0a0a 6465 6620 736f 7274  rn df...def sort
-0001e640: 5f74 7063 7328 7470 6373 2c20 6173 6365  _tpcs(tpcs, asce
-0001e650: 6e64 696e 673d 5472 7565 2c20 7374 6172  nding=True, star
-0001e660: 743d 4e6f 6e65 293a 0a20 2020 2022 2222  t=None):.    """
-0001e670: 2053 6f72 7420 746f 6e61 6c20 7069 7463   Sort tonal pitc
-0001e680: 6820 636c 6173 7365 7320 6279 206f 7264  h classes by ord
-0001e690: 6572 206f 6e20 7468 6520 7069 616e 6f2e  er on the piano.
-0001e6a0: 0a20 2020 2020 2020 2055 7365 733a 2066  .        Uses: f
-0001e6b0: 6966 7468 7332 7063 2829 0a0a 2020 2020  ifths2pc()..    
-0001e6c0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0001e6d0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7470  ---------.    tp
-0001e6e0: 6373 203a 2063 6f6c 6c65 6374 696f 6e20  cs : collection 
-0001e6f0: 6f66 203a 6f62 6a3a 6069 6e74 600a 2020  of :obj:`int`.  
-0001e700: 2020 2020 2020 546f 6e61 6c20 7069 7463        Tonal pitc
-0001e710: 6820 636c 6173 7365 7320 746f 2073 6f72  h classes to sor
-0001e720: 742e 0a20 2020 2061 7363 656e 6469 6e67  t..    ascending
-0001e730: 203a 203a 6f62 6a3a 6062 6f6f 6c60 2c20   : :obj:`bool`, 
-0001e740: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0001e750: 2050 6173 7320 4661 6c73 6520 746f 2073   Pass False to s
-0001e760: 6f72 7420 6279 2064 6573 6365 6e64 696e  ort by descendin
-0001e770: 6720 6f72 6465 722e 0a20 2020 2073 7461  g order..    sta
-0001e780: 7274 203a 203a 6f62 6a3a 6069 6e74 602c  rt : :obj:`int`,
-0001e790: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0001e7a0: 2020 5374 6172 7420 6f6e 206f 7220 6162    Start on or ab
-0001e7b0: 6f76 6520 7468 6973 2054 5043 2e0a 2020  ove this TPC..  
-0001e7c0: 2020 2222 220a 2020 2020 7265 7320 3d20    """.    res = 
-0001e7d0: 736f 7274 6564 2874 7063 732c 206b 6579  sorted(tpcs, key
-0001e7e0: 3d6c 616d 6264 6120 783a 2028 6669 6674  =lambda x: (fift
-0001e7f0: 6873 3270 6328 7829 2c20 2d78 2929 0a20  hs2pc(x), -x)). 
-0001e800: 2020 2069 6620 7374 6172 7420 6973 206e     if start is n
-0001e810: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0001e820: 2070 6373 203d 205b 6669 6674 6873 3270   pcs = [fifths2p
-0001e830: 6328 7470 6329 2066 6f72 2074 7063 2069  c(tpc) for tpc i
-0001e840: 6e20 7265 735d 0a20 2020 2020 2020 2073  n res].        s
-0001e850: 7461 7274 203d 2066 6966 7468 7332 7063  tart = fifths2pc
-0001e860: 2873 7461 7274 290a 2020 2020 2020 2020  (start).        
-0001e870: 6920 3d20 300a 2020 2020 2020 2020 7768  i = 0.        wh
-0001e880: 696c 6520 6920 3c20 6c65 6e28 7063 7329  ile i < len(pcs)
-0001e890: 202d 2031 2061 6e64 2070 6373 5b69 5d20   - 1 and pcs[i] 
-0001e8a0: 3c20 7374 6172 743a 0a20 2020 2020 2020  < start:.       
-0001e8b0: 2020 2020 2069 202b 3d20 310a 2020 2020       i += 1.    
-0001e8c0: 2020 2020 7265 7320 3d20 7265 735b 693a      res = res[i:
-0001e8d0: 5d20 2b20 7265 735b 3a69 5d0a 2020 2020  ] + res[:i].    
-0001e8e0: 7265 7475 726e 2072 6573 2069 6620 6173  return res if as
-0001e8f0: 6365 6e64 696e 6720 656c 7365 206c 6973  cending else lis
-0001e900: 7428 7265 7665 7273 6564 2872 6573 2929  t(reversed(res))
-0001e910: 0a0a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  ...@function_log
-0001e920: 6765 720a 6465 6620 7370 6c69 745f 616c  ger.def split_al
-0001e930: 7465 726e 6174 6976 6573 2864 662c 2063  ternatives(df, c
-0001e940: 6f6c 756d 6e3d 276c 6162 656c 272c 2072  olumn='label', r
-0001e950: 6567 6578 3d72 222d 283f 2128 5c64 7c62  egex=r"-(?!(\d|b
-0001e960: 2b5c 647c 5c23 2b5c 6429 2922 2c20 6d61  +\d|\#+\d))", ma
-0001e970: 783d 322c 2069 6e70 6c61 6365 3d46 616c  x=2, inplace=Fal
-0001e980: 7365 2c20 616c 7465 726e 6174 6976 6573  se, alternatives
-0001e990: 5f6f 6e6c 793d 4661 6c73 6529 3a0a 2020  _only=False):.  
-0001e9a0: 2020 2222 220a 2020 2020 5370 6c69 7473    """.    Splits
-0001e9b0: 206c 6162 656c 7320 7468 6174 2063 6f6d   labels that com
-0001e9c0: 6520 7769 7468 2061 6e20 616c 7465 726e  e with an altern
-0001e9d0: 6174 6976 6520 7365 7061 7261 7465 6420  ative separated 
-0001e9e0: 6279 2027 2d27 2061 6e64 2061 6464 730a  by '-' and adds.
-0001e9f0: 2020 2020 6120 6e65 7720 636f 6c75 6d6e      a new column
-0001ea00: 2e20 4f6e 6c79 206f 6e65 2061 6c74 6572  . Only one alter
-0001ea10: 6e61 7469 7665 2069 7320 7461 6b65 6e20  native is taken 
-0001ea20: 696e 746f 2061 6363 6f75 6e74 2e20 6064  into account. `d
-0001ea30: 6660 2069 730a 2020 2020 6d75 7461 7465  f` is.    mutate
-0001ea40: 6420 696e 706c 6163 652e 0a0a 2020 2020  d inplace...    
-0001ea50: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0001ea60: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6466  ---------.    df
-0001ea70: 203a 203a 6f62 6a3a 6070 616e 6461 732e   : :obj:`pandas.
-0001ea80: 4461 7461 4672 616d 6560 0a20 2020 2020  DataFrame`.     
-0001ea90: 2020 2044 6174 6166 7261 6d65 2077 6865     Dataframe whe
-0001eaa0: 7265 206f 6e65 2063 6f6c 756d 6e20 636f  re one column co
-0001eab0: 6e74 6169 6e73 2044 434d 4c20 6368 6f72  ntains DCML chor
-0001eac0: 6420 6c61 6265 6c73 2e0a 2020 2020 636f  d labels..    co
-0001ead0: 6c75 6d6e 203a 203a 6f62 6a3a 6073 7472  lumn : :obj:`str
-0001eae0: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
-0001eaf0: 2020 2020 4e61 6d65 206f 6620 7468 6520      Name of the 
-0001eb00: 636f 6c75 6d6e 2074 6861 7420 686f 6c64  column that hold
-0001eb10: 7320 7468 6520 6861 726d 6f6e 7920 6c61  s the harmony la
-0001eb20: 6265 6c73 2e0a 2020 2020 7265 6765 7820  bels..    regex 
-0001eb30: 3a20 3a6f 626a 3a60 7374 7260 2c20 6f70  : :obj:`str`, op
-0001eb40: 7469 6f6e 616c 0a20 2020 2020 2020 2054  tional.        T
-0001eb50: 6865 2072 6567 756c 6172 2065 7870 7265  he regular expre
-0001eb60: 7373 696f 6e20 286f 7220 7369 6d70 6c65  ssion (or simple
-0001eb70: 2073 7472 696e 6729 2074 6861 7420 6465   string) that de
-0001eb80: 7465 6374 7320 7468 6520 6368 6172 6163  tects the charac
-0001eb90: 7465 7220 636f 6d62 696e 6174 696f 6e20  ter combination 
-0001eba0: 7573 6564 2074 6f20 7365 7061 7261 7465  used to separate
-0001ebb0: 2061 6c74 6572 6e61 7469 7665 2061 6e6e   alternative ann
-0001ebc0: 6f74 6174 696f 6e73 2e0a 2020 2020 2020  otations..      
-0001ebd0: 2020 4279 2064 6566 6175 6c74 2c20 616c    By default, al
-0001ebe0: 7465 726e 6174 6976 6573 2061 7265 2073  ternatives are s
-0001ebf0: 6570 6172 6174 6564 2062 7920 6120 272d  eparated by a '-
-0001ec00: 2720 7468 6174 2064 6f65 7320 6e6f 7420  ' that does not 
-0001ec10: 7072 6563 6564 6520 6120 7363 616c 6520  precede a scale 
-0001ec20: 6465 6772 6565 2073 7563 6820 6173 2027  degree such as '
-0001ec30: 6236 2720 6f72 2027 3327 2e0a 2020 2020  b6' or '3'..    
-0001ec40: 6d61 7820 3a20 3a6f 626a 3a60 696e 7460  max : :obj:`int`
-0001ec50: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0001ec60: 2020 204d 6178 696d 756d 206e 756d 6265     Maximum numbe
-0001ec70: 7220 6f66 2061 646d 6974 7465 6420 616c  r of admitted al
-0001ec80: 7465 726e 6174 6976 6573 2c20 6465 6661  ternatives, defa
-0001ec90: 756c 7473 2074 6f20 322e 0a20 2020 2069  ults to 2..    i
-0001eca0: 6e70 6c61 6365 203a 203a 6f62 6a3a 6062  nplace : :obj:`b
-0001ecb0: 6f6f 6c60 2c20 6f70 7469 6f6e 616c 0a20  ool`, optional. 
-0001ecc0: 2020 2020 2020 2050 6173 7320 5472 7565         Pass True
-0001ecd0: 2069 6620 796f 7520 7761 6e74 2074 6f20   if you want to 
-0001ece0: 6d75 7461 7465 2060 6064 6660 602e 0a20  mutate ``df``.. 
-0001ecf0: 2020 2061 6c74 6572 6e61 7469 7665 735f     alternatives_
-0001ed00: 6f6e 6c79 203a 203a 6f62 6a3a 6062 6f6f  only : :obj:`boo
-0001ed10: 6c60 2c20 6f70 7469 6f6e 616c 0a20 2020  l`, optional.   
-0001ed20: 2020 2020 2042 7920 6465 6661 756c 7420       By default 
-0001ed30: 7468 6520 616c 7465 726e 6174 6976 6573  the alternatives
-0001ed40: 2061 7265 2061 6464 6564 2074 6f20 7468   are added to th
-0001ed50: 6520 6f72 6967 696e 616c 2044 6174 6146  e original DataF
-0001ed60: 7261 6d65 2028 6060 696e 706c 6163 6560  rame (``inplace`
-0001ed70: 6020 6f72 206e 6f74 292e 0a20 2020 2020  ` or not)..     
-0001ed80: 2020 2050 6173 7320 5472 7565 2069 6620     Pass True if 
-0001ed90: 796f 7520 6a75 7374 206e 6565 6420 7468  you just need th
-0001eda0: 6520 7370 6c69 7420 616c 7465 726e 6174  e split alternat
-0001edb0: 6976 6573 2e0a 0a20 2020 2045 7861 6d70  ives...    Examp
-0001edc0: 6c65 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  le.    -------. 
-0001edd0: 2020 203e 3e3e 2069 6d70 6f72 7420 7061     >>> import pa
-0001ede0: 6e64 6173 2061 7320 7064 0a20 2020 203e  ndas as pd.    >
-0001edf0: 3e3e 206c 6162 656c 7320 3d20 7064 2e72  >> labels = pd.r
-0001ee00: 6561 645f 6373 7628 276c 6162 656c 732e  ead_csv('labels.
-0001ee10: 6373 7627 290a 2020 2020 3e3e 3e20 7370  csv').    >>> sp
-0001ee20: 6c69 745f 616c 7465 726e 6174 6976 6573  lit_alternatives
-0001ee30: 286c 6162 656c 732c 2069 6e70 6c61 6365  (labels, inplace
-0001ee40: 3d54 7275 6529 0a20 2020 2022 2222 0a20  =True).    """. 
-0001ee50: 2020 2069 6620 6e6f 7420 696e 706c 6163     if not inplac
-0001ee60: 653a 0a20 2020 2020 2020 2064 6620 3d20  e:.        df = 
-0001ee70: 6466 2e63 6f70 7928 290a 2020 2020 616c  df.copy().    al
-0001ee80: 7465 726e 6174 6976 6573 203d 2064 665b  ternatives = df[
-0001ee90: 636f 6c75 6d6e 5d2e 7374 722e 7370 6c69  column].str.spli
-0001eea0: 7428 7265 6765 782c 2065 7870 616e 643d  t(regex, expand=
-0001eeb0: 5472 7565 290a 2020 2020 616c 7465 726e  True).    altern
-0001eec0: 6174 6976 6573 2e64 726f 706e 6128 6178  atives.dropna(ax
-0001eed0: 6973 3d31 2c20 686f 773d 2761 6c6c 272c  is=1, how='all',
-0001eee0: 2069 6e70 6c61 6365 3d54 7275 6529 0a20   inplace=True). 
-0001eef0: 2020 2061 6c74 6572 6e61 7469 7665 732e     alternatives.
-0001ef00: 636f 6c75 6d6e 7320 3d20 7261 6e67 6528  columns = range(
-0001ef10: 616c 7465 726e 6174 6976 6573 2e73 6861  alternatives.sha
-0001ef20: 7065 5b31 5d29 0a20 2020 2069 6620 616c  pe[1]).    if al
-0001ef30: 7465 726e 6174 6976 6573 5f6f 6e6c 793a  ternatives_only:
-0001ef40: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
-0001ef50: 203d 205b 636f 6c75 6d6e 5d20 2b20 5b66   = [column] + [f
-0001ef60: 2261 6c74 5f7b 636f 6c75 6d6e 7d22 2069  "alt_{column}" i
-0001ef70: 6620 6920 3d3d 2031 2065 6c73 6520 6622  f i == 1 else f"
-0001ef80: 616c 747b 697d 5f7b 636f 6c75 6d6e 7d22  alt{i}_{column}"
-0001ef90: 2066 6f72 2069 2069 6e20 616c 7465 726e   for i in altern
-0001efa0: 6174 6976 6573 2e63 6f6c 756d 6e73 5b31  atives.columns[1
-0001efb0: 3a5d 5d0a 2020 2020 2020 2020 616c 7465  :]].        alte
-0001efc0: 726e 6174 6976 6573 2e63 6f6c 756d 6e73  rnatives.columns
-0001efd0: 203d 2063 6f6c 756d 6e73 0a20 2020 2020   = columns.     
-0001efe0: 2020 2072 6574 7572 6e20 616c 7465 726e     return altern
-0001eff0: 6174 6976 6573 2e69 6c6f 635b 3a2c 203a  atives.iloc[:, :
-0001f000: 6d61 785d 0a20 2020 2069 6620 6c65 6e28  max].    if len(
-0001f010: 616c 7465 726e 6174 6976 6573 2e63 6f6c  alternatives.col
-0001f020: 756d 6e73 2920 3e20 313a 0a20 2020 2020  umns) > 1:.     
-0001f030: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
-0001f040: 224c 6162 656c 7320 7370 6c69 7420 696e  "Labels split in
-0001f050: 746f 2061 6c74 6572 6e61 7469 7665 732e  to alternatives.
-0001f060: 2229 0a20 2020 2020 2020 2064 662e 6c6f  ").        df.lo
-0001f070: 635b 3a2c 2063 6f6c 756d 6e5d 203d 2061  c[:, column] = a
-0001f080: 6c74 6572 6e61 7469 7665 735b 305d 0a20  lternatives[0]. 
-0001f090: 2020 2020 2020 2070 6f73 6974 696f 6e20         position 
-0001f0a0: 3d20 6466 2e63 6f6c 756d 6e73 2e67 6574  = df.columns.get
-0001f0b0: 5f6c 6f63 2863 6f6c 756d 6e29 202b 2031  _loc(column) + 1
-0001f0c0: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
-0001f0d0: 6e20 616c 7465 726e 6174 6976 6573 2e63  n alternatives.c
-0001f0e0: 6f6c 756d 6e73 5b31 3a5d 3a0a 2020 2020  olumns[1:]:.    
-0001f0f0: 2020 2020 2020 2020 6966 2069 203d 3d20          if i == 
-0001f100: 6d61 783a 0a20 2020 2020 2020 2020 2020  max:.           
-0001f110: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-0001f120: 2020 2020 2020 2061 6c74 5f6e 616d 6520         alt_name 
-0001f130: 3d20 6622 616c 745f 7b63 6f6c 756d 6e7d  = f"alt_{column}
-0001f140: 2220 6966 2069 203d 3d20 3120 656c 7365  " if i == 1 else
-0001f150: 2066 2261 6c74 7b69 7d5f 7b63 6f6c 756d   f"alt{i}_{colum
-0001f160: 6e7d 220a 2020 2020 2020 2020 2020 2020  n}".            
-0001f170: 6466 2e69 6e73 6572 7428 706f 7369 7469  df.insert(positi
-0001f180: 6f6e 2c20 616c 745f 6e61 6d65 2c20 616c  on, alt_name, al
-0001f190: 7465 726e 6174 6976 6573 5b69 5d2e 6669  ternatives[i].fi
-0001f1a0: 6c6c 6e61 2870 642e 4e41 2929 2020 2320  llna(pd.NA))  # 
-0001f1b0: 7265 706c 6163 6520 4e6f 6e65 2062 7920  replace None by 
-0001f1c0: 4e41 0a20 2020 2020 2020 2020 2020 2070  NA.            p
-0001f1d0: 6f73 6974 696f 6e20 2b3d 2031 0a20 2020  osition += 1.   
-0001f1e0: 2020 2020 2069 6620 6c65 6e28 616c 7465       if len(alte
-0001f1f0: 726e 6174 6976 6573 2e63 6f6c 756d 6e73  rnatives.columns
-0001f200: 2920 3e20 6d61 783a 0a20 2020 2020 2020  ) > max:.       
-0001f210: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
-0001f220: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
-0001f230: 2020 2020 2066 224d 6f72 6520 7468 616e       f"More than
-0001f240: 207b 6d61 787d 2061 6c74 6572 6e61 7469   {max} alternati
-0001f250: 7665 7320 6172 6520 6e6f 7420 7461 6b65  ves are not take
-0001f260: 6e20 696e 746f 2061 6363 6f75 6e74 3a5c  n into account:\
-0001f270: 6e7b 616c 7465 726e 6174 6976 6573 5b61  n{alternatives[a
-0001f280: 6c74 6572 6e61 7469 7665 735b 325d 2e6e  lternatives[2].n
-0001f290: 6f74 6e61 2829 5d7d 2229 0a20 2020 2065  otna()]}").    e
-0001f2a0: 6c73 653a 0a20 2020 2020 2020 206c 6f67  lse:.        log
-0001f2b0: 6765 722e 6465 6275 6728 2243 6f6e 7461  ger.debug("Conta
-0001f2c0: 696e 7320 6e6f 2061 6c74 6572 6e61 7469  ins no alternati
-0001f2d0: 7665 206c 6162 656c 732e 2229 0a20 2020  ve labels.").   
-0001f2e0: 2069 6620 6e6f 7420 696e 706c 6163 653a   if not inplace:
-0001f2f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001f300: 6466 0a0a 0a0a 4066 756e 6374 696f 6e5f  df....@function_
-0001f310: 6c6f 6767 6572 0a64 6566 2073 706c 6974  logger.def split
-0001f320: 5f6e 6f74 655f 6e61 6d65 286e 6e2c 2063  _note_name(nn, c
-0001f330: 6f75 6e74 3d46 616c 7365 293a 0a20 2020  ount=False):.   
-0001f340: 2022 2222 2053 706c 6974 7320 6120 6e6f   """ Splits a no
-0001f350: 7465 206e 616d 6520 7375 6368 2061 7320  te name such as 
-0001f360: 2741 6227 2069 6e74 6f20 6163 6369 6465  'Ab' into accide
-0001f370: 6e74 616c 7320 616e 6420 6e61 6d65 2e0a  ntals and name..
-0001f380: 0a20 2020 206e 6e20 3a20 3a6f 626a 3a60  .    nn : :obj:`
-0001f390: 7374 7260 0a20 2020 2020 2020 204e 6f74  str`.        Not
-0001f3a0: 6520 6e61 6d65 2e0a 2020 2020 636f 756e  e name..    coun
-0001f3b0: 7420 3a20 3a6f 626a 3a60 626f 6f6c 602c  t : :obj:`bool`,
-0001f3c0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0001f3d0: 2020 5061 7373 2054 7275 6520 746f 2067    Pass True to g
-0001f3e0: 6574 2074 6865 2061 6363 6964 656e 7461  et the accidenta
-0001f3f0: 6c73 2061 7320 696e 7465 6765 7220 7261  ls as integer ra
-0001f400: 7468 6572 2074 6861 6e20 6173 2073 7472  ther than as str
-0001f410: 696e 672e 0a20 2020 2022 2222 0a20 2020  ing..    """.   
-0001f420: 206d 203d 2072 652e 6d61 7463 6828 225e   m = re.match("^
-0001f430: 285b 412d 475d 7c5b 612d 675d 2928 232a  ([A-G]|[a-g])(#*
-0001f440: 7c62 2a29 2422 2c20 7374 7228 6e6e 2929  |b*)$", str(nn))
-0001f450: 0a20 2020 2069 6620 6d20 6973 204e 6f6e  .    if m is Non
-0001f460: 653a 0a20 2020 2020 2020 206c 6f67 6765  e:.        logge
-0001f470: 722e 6572 726f 7228 6e6e 202b 2022 2069  r.error(nn + " i
-0001f480: 7320 6e6f 7420 6120 7661 6c69 6420 7363  s not a valid sc
-0001f490: 616c 6520 6465 6772 6565 2e22 290a 2020  ale degree.").  
-0001f4a0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0001f4b0: 652c 204e 6f6e 650a 2020 2020 6e6f 7465  e, None.    note
-0001f4c0: 5f6e 616d 652c 2061 6363 6964 656e 7461  _name, accidenta
-0001f4d0: 6c73 203d 206d 2e67 726f 7570 2831 292c  ls = m.group(1),
-0001f4e0: 206d 2e67 726f 7570 2832 290a 2020 2020   m.group(2).    
-0001f4f0: 6966 2063 6f75 6e74 3a0a 2020 2020 2020  if count:.      
-0001f500: 2020 6163 6369 6465 6e74 616c 7320 3d20    accidentals = 
-0001f510: 6163 6369 6465 6e74 616c 732e 636f 756e  accidentals.coun
-0001f520: 7428 2723 2729 202d 2061 6363 6964 656e  t('#') - acciden
-0001f530: 7461 6c73 2e63 6f75 6e74 2827 6227 290a  tals.count('b').
-0001f540: 2020 2020 7265 7475 726e 2061 6363 6964      return accid
-0001f550: 656e 7461 6c73 2c20 6e6f 7465 5f6e 616d  entals, note_nam
-0001f560: 650a 0a0a 4066 756e 6374 696f 6e5f 6c6f  e...@function_lo
-0001f570: 6767 6572 0a64 6566 2073 706c 6974 5f73  gger.def split_s
-0001f580: 6361 6c65 5f64 6567 7265 6528 7364 2c20  cale_degree(sd, 
-0001f590: 636f 756e 743d 4661 6c73 6529 3a0a 2020  count=False):.  
-0001f5a0: 2020 2222 2220 5370 6c69 7473 2061 2073    """ Splits a s
-0001f5b0: 6361 6c65 2064 6567 7265 6520 7375 6368  cale degree such
-0001f5c0: 2061 7320 2762 6256 4927 206f 7220 2762   as 'bbVI' or 'b
-0001f5d0: 3627 2069 6e74 6f20 6163 6369 6465 6e74  6' into accident
-0001f5e0: 616c 7320 616e 6420 6e75 6d65 7261 6c2e  als and numeral.
-0001f5f0: 0a0a 2020 2020 7364 203a 203a 6f62 6a3a  ..    sd : :obj:
-0001f600: 6073 7472 600a 2020 2020 2020 2020 5363  `str`.        Sc
-0001f610: 616c 6520 6465 6772 6565 2e0a 2020 2020  ale degree..    
-0001f620: 636f 756e 7420 3a20 3a6f 626a 3a60 626f  count : :obj:`bo
-0001f630: 6f6c 602c 206f 7074 696f 6e61 6c0a 2020  ol`, optional.  
-0001f640: 2020 2020 2020 5061 7373 2054 7275 6520        Pass True 
-0001f650: 746f 2067 6574 2074 6865 2061 6363 6964  to get the accid
-0001f660: 656e 7461 6c73 2061 7320 696e 7465 6765  entals as intege
-0001f670: 7220 7261 7468 6572 2074 6861 6e20 6173  r rather than as
-0001f680: 2073 7472 696e 672e 0a20 2020 2022 2222   string..    """
-0001f690: 0a20 2020 206d 203d 2072 652e 6d61 7463  .    m = re.matc
-0001f6a0: 6828 7222 5e28 232a 7c62 2a29 2856 4949  h(r"^(#*|b*)(VII
-0001f6b0: 7c56 497c 567c 4956 7c49 4949 7c49 497c  |VI|V|IV|III|II|
-0001f6c0: 497c 7669 697c 7669 7c76 7c69 767c 6969  I|vii|vi|v|iv|ii
-0001f6d0: 697c 6969 7c69 7c5c 6429 2422 2c20 7374  i|ii|i|\d)$", st
-0001f6e0: 7228 7364 2929 0a20 2020 2069 6620 6d20  r(sd)).    if m 
-0001f6f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001f700: 2069 6620 272f 2720 696e 2073 643a 0a20   if '/' in sd:. 
-0001f710: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0001f720: 722e 6572 726f 7228 6622 7b73 647d 206e  r.error(f"{sd} n
-0001f730: 6565 6473 2074 6f20 6265 2072 6573 6f6c  eeds to be resol
-0001f740: 7665 642c 2077 6869 6368 2072 6571 7569  ved, which requi
-0001f750: 7265 7320 696e 666f 726d 6174 696f 6e20  res information 
-0001f760: 6162 6f75 7420 7468 6520 6d6f 6465 206f  about the mode o
-0001f770: 6620 7468 6520 6c6f 6361 6c20 6b65 792e  f the local key.
-0001f780: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0001f790: 2020 2020 2020 2020 2020 2020 6622 596f              f"Yo
-0001f7a0: 7520 6361 6e20 7573 6520 6d73 332e 7574  u can use ms3.ut
-0001f7b0: 696c 732e 7265 736f 6c76 655f 7265 6c61  ils.resolve_rela
-0001f7c0: 7469 7665 5f6b 6579 7328 7363 616c 655f  tive_keys(scale_
-0001f7d0: 6465 6772 6565 2c20 6973 5f6d 696e 6f72  degree, is_minor
-0001f7e0: 5f63 6f6e 7465 7874 292e 2229 0a20 2020  _context).").   
-0001f7f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001f800: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
-0001f810: 726f 7228 6622 7b73 647d 2069 7320 6e6f  ror(f"{sd} is no
-0001f820: 7420 6120 7661 6c69 6420 7363 616c 6520  t a valid scale 
-0001f830: 6465 6772 6565 2e22 290a 2020 2020 2020  degree.").      
-0001f840: 2020 7265 7475 726e 204e 6f6e 652c 204e    return None, N
-0001f850: 6f6e 650a 2020 2020 6163 632c 206e 756d  one.    acc, num
-0001f860: 203d 206d 2e67 726f 7570 2831 292c 206d   = m.group(1), m
-0001f870: 2e67 726f 7570 2832 290a 2020 2020 6966  .group(2).    if
-0001f880: 2063 6f75 6e74 3a0a 2020 2020 2020 2020   count:.        
-0001f890: 6163 6320 3d20 6163 632e 636f 756e 7428  acc = acc.count(
-0001f8a0: 2723 2729 202d 2061 6363 2e63 6f75 6e74  '#') - acc.count
-0001f8b0: 2827 6227 290a 2020 2020 7265 7475 726e  ('b').    return
-0001f8c0: 2061 6363 2c20 6e75 6d0a 0a0a 2320 6465   acc, num...# de
-0001f8d0: 6620 6368 756e 6b73 7472 696e 6728 7374  f chunkstring(st
-0001f8e0: 7269 6e67 2c20 6c65 6e67 7468 3d38 3029  ring, length=80)
-0001f8f0: 3a0a 2320 2020 2020 2222 2220 4765 6e65  :.#     """ Gene
-0001f900: 7261 7465 2063 6875 6e6b 7320 6f66 2061  rate chunks of a
-0001f910: 2067 6976 656e 206c 656e 6774 6820 2222   given length ""
-0001f920: 220a 2320 2020 2020 7374 7269 6e67 203d  ".#     string =
-0001f930: 2073 7472 2873 7472 696e 6729 0a23 2020   str(string).#  
-0001f940: 2020 2072 6574 7572 6e20 2873 7472 696e     return (strin
-0001f950: 675b 3020 2b20 693a 6c65 6e67 7468 202b  g[0 + i:length +
-0001f960: 2069 5d20 666f 7220 6920 696e 2072 616e   i] for i in ran
-0001f970: 6765 2830 2c20 6c65 6e28 7374 7269 6e67  ge(0, len(string
-0001f980: 292c 206c 656e 6774 6829 290a 230a 230a  ), length)).#.#.
-0001f990: 2320 6465 6620 7374 7269 6e67 326c 696e  # def string2lin
-0001f9a0: 6573 2873 7472 696e 672c 206c 656e 6774  es(string, lengt
-0001f9b0: 683d 3830 293a 0a23 2020 2020 2022 2222  h=80):.#     """
-0001f9c0: 2055 7365 2063 6875 6e6b 7374 7269 6e67   Use chunkstring
-0001f9d0: 2829 2061 6e64 206d 616b 6520 6368 756e  () and make chun
-0001f9e0: 6b73 2069 6e74 6f20 6c69 6e65 732e 2022  ks into lines. "
-0001f9f0: 2222 0a23 2020 2020 2072 6574 7572 6e20  "".#     return 
-0001fa00: 275c 6e27 2e6a 6f69 6e28 6368 756e 6b73  '\n'.join(chunks
-0001fa10: 7472 696e 6728 7374 7269 6e67 2c20 6c65  tring(string, le
-0001fa20: 6e67 7468 2929 0a0a 0a40 6675 6e63 7469  ngth))...@functi
-0001fa30: 6f6e 5f6c 6f67 6765 720a 6465 6620 7465  on_logger.def te
-0001fa40: 7374 5f62 696e 6172 7928 636f 6d6d 616e  st_binary(comman
-0001fa50: 6429 3a0a 2020 2020 6966 2063 6f6d 6d61  d):.    if comma
-0001fa60: 6e64 2069 7320 4e6f 6e65 3a0a 2020 2020  nd is None:.    
-0001fa70: 2020 2020 7265 7475 726e 2063 6f6d 6d61      return comma
-0001fa80: 6e64 0a20 2020 2069 6620 6f73 2e70 6174  nd.    if os.pat
-0001fa90: 682e 6973 6669 6c65 2863 6f6d 6d61 6e64  h.isfile(command
-0001faa0: 293a 0a20 2020 2020 2020 206c 6f67 6765  ):.        logge
-0001fab0: 722e 6465 6275 6728 6622 466f 756e 6420  r.debug(f"Found 
-0001fac0: 4d75 7365 5363 6f72 6520 6269 6e61 7279  MuseScore binary
-0001fad0: 3a20 7b63 6f6d 6d61 6e64 7d22 290a 2020  : {command}").  
-0001fae0: 2020 2020 2020 7265 7475 726e 2063 6f6d        return com
-0001faf0: 6d61 6e64 0a20 2020 2069 6620 7768 6963  mand.    if whic
-0001fb00: 6828 636f 6d6d 616e 6429 2069 7320 4e6f  h(command) is No
-0001fb10: 6e65 3a0a 2020 2020 2020 2020 6c6f 6767  ne:.        logg
-0001fb20: 6572 2e77 6172 6e69 6e67 2866 224d 7573  er.warning(f"Mus
-0001fb30: 6553 636f 7265 2062 696e 6172 7920 6e6f  eScore binary no
-0001fb40: 7420 666f 756e 6420 616e 6420 6e6f 7420  t found and not 
-0001fb50: 616e 2069 6e73 7461 6c6c 6564 2063 6f6d  an installed com
-0001fb60: 6d61 6e64 3a20 7b63 6f6d 6d61 6e64 7d22  mand: {command}"
-0001fb70: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001fb80: 204e 6f6e 650a 2020 2020 656c 7365 3a0a   None.    else:.
-0001fb90: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-0001fba0: 6562 7567 2866 2246 6f75 6e64 204d 7573  ebug(f"Found Mus
-0001fbb0: 6553 636f 7265 2063 6f6d 6d61 6e64 3a20  eScore command: 
-0001fbc0: 7b63 6f6d 6d61 6e64 7d22 290a 2020 2020  {command}").    
-0001fbd0: 2020 2020 7265 7475 726e 2063 6f6d 6d61      return comma
-0001fbe0: 6e64 0a0a 0a64 6566 2074 7261 6e73 666f  nd...def transfo
-0001fbf0: 726d 2864 662c 2066 756e 632c 2070 6172  rm(df, func, par
-0001fc00: 616d 3263 6f6c 3d4e 6f6e 652c 2063 6f6c  am2col=None, col
-0001fc10: 756d 6e5f 7769 7365 3d46 616c 7365 2c20  umn_wise=False, 
-0001fc20: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-0001fc30: 2222 2043 6f6d 7075 7465 2061 2066 756e  "" Compute a fun
-0001fc40: 6374 696f 6e20 666f 7220 6576 6572 7920  ction for every 
-0001fc50: 726f 7720 6f66 2061 2044 6174 6146 7261  row of a DataFra
-0001fc60: 6d65 2c20 7573 696e 6720 7365 7665 7261  me, using severa
-0001fc70: 6c20 636f 6c73 2061 7320 6172 6775 6d65  l cols as argume
-0001fc80: 6e74 732e 0a20 2020 2020 2020 2054 6865  nts..        The
-0001fc90: 2072 6573 756c 7420 6973 2074 6865 2073   result is the s
-0001fca0: 616d 6520 6173 2075 7369 6e67 2064 662e  ame as using df.
-0001fcb0: 6170 706c 7928 6c61 6d62 6461 2072 3a20  apply(lambda r: 
-0001fcc0: 6675 6e63 2870 6172 616d 313d 722e 636f  func(param1=r.co
-0001fcd0: 6c31 2c20 7061 7261 6d32 3d72 2e63 6f6c  l1, param2=r.col
-0001fce0: 322e 2e2e 292c 2061 7869 733d 3129 0a20  2...), axis=1). 
-0001fcf0: 2020 2020 2020 2062 7574 2069 7420 6f70         but it op
-0001fd00: 7469 6d69 7a65 7320 7468 6520 7072 6f63  timizes the proc
-0001fd10: 6564 7572 6520 6279 2070 7265 636f 6d70  edure by precomp
-0001fd20: 7574 696e 6720 6066 756e 6360 2066 6f72  uting `func` for
-0001fd30: 2061 6c6c 206f 6363 7572 7265 6e74 2070   all occurrent p
-0001fd40: 6172 616d 6574 6572 2063 6f6d 6269 6e61  arameter combina
-0001fd50: 7469 6f6e 732e 0a20 2020 2020 2020 2055  tions..        U
-0001fd60: 7365 733a 2069 6e73 7065 6374 2e67 6574  ses: inspect.get
-0001fd70: 6675 6c6c 6172 6773 7065 6328 290a 0a20  fullargspec().. 
-0001fd80: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0001fd90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0001fda0: 2064 6620 3a20 3a6f 626a 3a60 7061 6e64   df : :obj:`pand
-0001fdb0: 6173 2e44 6174 6146 7261 6d65 6020 6f72  as.DataFrame` or
-0001fdc0: 203a 6f62 6a3a 6070 616e 6461 732e 5365   :obj:`pandas.Se
-0001fdd0: 7269 6573 600a 2020 2020 2020 2020 4461  ries`.        Da
-0001fde0: 7461 6672 616d 6520 636f 6e74 6169 6e69  taframe containi
-0001fdf0: 6e67 2066 756e 6374 696f 6e20 7061 7261  ng function para
-0001fe00: 6d65 7465 7273 2e0a 2020 2020 6675 6e63  meters..    func
-0001fe10: 203a 203a 6f62 6a3a 6063 616c 6c61 626c   : :obj:`callabl
-0001fe20: 6560 0a20 2020 2020 2020 2054 6865 2072  e`.        The r
-0001fe30: 6573 756c 7420 6f66 2074 6869 7320 6675  esult of this fu
-0001fe40: 6e63 7469 6f6e 2066 6f72 2065 7665 7279  nction for every
-0001fe50: 2072 6f77 2077 696c 6c20 6265 2072 6574   row will be ret
-0001fe60: 7572 6e65 642e 0a20 2020 2070 6172 616d  urned..    param
-0001fe70: 3263 6f6c 203a 203a 6f62 6a3a 6064 6963  2col : :obj:`dic
-0001fe80: 7460 206f 7220 3a6f 626a 3a60 6c69 7374  t` or :obj:`list
-0001fe90: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
-0001fea0: 2020 2020 4d61 7070 696e 6720 6672 6f6d      Mapping from
-0001feb0: 2070 6172 616d 6574 6572 206e 616d 6573   parameter names
-0001fec0: 206f 6620 6066 756e 6360 2074 6f20 636f   of `func` to co
-0001fed0: 6c75 6d6e 206e 616d 6573 2e0a 2020 2020  lumn names..    
-0001fee0: 2020 2020 4966 2079 6f75 2070 6173 7320      If you pass 
-0001fef0: 6120 6c69 7374 206f 6620 636f 6c75 6d6e  a list of column
-0001ff00: 206e 616d 6573 2c20 7468 6520 636f 6c75   names, the colu
-0001ff10: 6d6e 7327 2076 616c 7565 7320 6172 6520  mns' values are 
-0001ff20: 7061 7373 6564 2061 7320 706f 7369 7469  passed as positi
-0001ff30: 6f6e 616c 2061 7267 756d 656e 7473 2e0a  onal arguments..
-0001ff40: 2020 2020 2020 2020 5061 7373 204e 6f6e          Pass Non
-0001ff50: 6520 6966 2079 6f75 2077 616e 7420 746f  e if you want to
-0001ff60: 2075 7365 2061 6c6c 2063 6f6c 756d 6e73   use all columns
-0001ff70: 2061 7320 706f 7369 7469 6f6e 616c 2061   as positional a
-0001ff80: 7267 756d 656e 7473 2e0a 2020 2020 636f  rguments..    co
-0001ff90: 6c75 6d6e 5f77 6973 6520 3a20 3a6f 626a  lumn_wise : :obj
-0001ffa0: 3a60 626f 6f6c 602c 206f 7074 696f 6e61  :`bool`, optiona
-0001ffb0: 6c0a 2020 2020 2020 2020 5061 7373 2054  l.        Pass T
-0001ffc0: 7275 6520 6966 2079 6f75 2077 616e 7420  rue if you want 
-0001ffd0: 746f 206d 6170 2060 6066 756e 6360 6020  to map ``func`` 
-0001ffe0: 746f 2074 6865 2065 6c65 6d65 6e74 7320  to the elements 
-0001fff0: 6f66 2065 7665 7279 2063 6f6c 756d 6e20  of every column 
-00020000: 7365 7061 7261 7465 6c79 2e0a 2020 2020  separately..    
-00020010: 2020 2020 5468 6973 2069 7320 7369 6d70      This is simp
-00020020: 6c79 2061 6e20 6f70 7469 6d69 7a65 6420  ly an optimized 
-00020030: 7665 7273 696f 6e20 6f66 2064 662e 6170  version of df.ap
-00020040: 706c 7928 6675 6e63 2920 6275 7420 616c  ply(func) but al
-00020050: 6c6f 7773 2066 6f72 206e 616d 696e 670a  lows for naming.
-00020060: 2020 2020 2020 2020 636f 6c75 6d6e 7320          columns 
-00020070: 746f 2075 7365 2061 7320 6675 6e63 7469  to use as functi
-00020080: 6f6e 2061 7267 756d 656e 7473 2e20 4966  on arguments. If
-00020090: 2070 6172 616d 3263 6f6c 2069 7320 4e6f   param2col is No
-000200a0: 6e65 2c20 6060 6675 6e63 6060 2069 7320  ne, ``func`` is 
-000200b0: 6d61 7070 6564 0a20 2020 2020 2020 2074  mapped.        t
-000200c0: 6f20 7468 6520 656c 656d 656e 7473 206f  o the elements o
-000200d0: 6620 616c 6c20 636f 6c75 6d6e 732c 206f  f all columns, o
-000200e0: 7468 6572 7769 7365 2074 6f20 616c 6c20  therwise to all 
-000200f0: 636f 6c75 6d6e 7320 7468 6174 2061 7265  columns that are
-00020100: 206e 6f74 206e 616d 6564 0a20 2020 2020   not named.     
-00020110: 2020 2061 7320 7061 7261 6d65 7465 7273     as parameters
-00020120: 2069 6e20 6060 7061 7261 6d32 636f 6c60   in ``param2col`
-00020130: 602e 0a20 2020 2020 2020 2049 6e20 7468  `..        In th
-00020140: 6520 6361 7365 2077 6865 7265 2060 6066  e case where ``f
-00020150: 756e 6360 6020 646f 6573 206e 6f74 2072  unc`` does not r
-00020160: 6571 7569 7265 2061 2070 6f73 6974 696f  equire a positio
-00020170: 6e61 6c20 6669 7273 7420 656c 656d 656e  nal first elemen
-00020180: 7420 616e 640a 2020 2020 2020 2020 796f  t and.        yo
-00020190: 7520 7761 6e74 2074 6f20 7061 7373 2074  u want to pass t
-000201a0: 6865 2065 6c65 6d65 6e74 7320 6f66 2074  he elements of t
-000201b0: 6865 2076 6172 696f 7573 2063 6f6c 756d  he various colum
-000201c0: 6e73 2061 7320 6b65 7977 6f72 6420 6172  ns as keyword ar
-000201d0: 6775 6d65 6e74 2c0a 2020 2020 2020 2020  gument,.        
-000201e0: 6769 7665 2069 7420 6173 2070 6172 616d  give it as param
-000201f0: 3263 6f6c 3d7b 2766 756e 6374 696f 6e5f  2col={'function_
-00020200: 6172 6775 6d65 6e74 273a 204e 6f6e 657d  argument': None}
-00020210: 0a20 2020 2069 6e70 6c61 6365 203a 203a  .    inplace : :
-00020220: 6f62 6a3a 6062 6f6f 6c60 2c20 6f70 7469  obj:`bool`, opti
-00020230: 6f6e 616c 0a20 2020 2020 2020 2050 6173  onal.        Pas
-00020240: 7320 5472 7565 2069 6620 796f 7520 7761  s True if you wa
-00020250: 6e74 2074 6f20 6d75 7461 7465 2060 6064  nt to mutate ``d
-00020260: 6660 6020 7261 7468 6572 2074 6861 6e20  f`` rather than 
-00020270: 6765 7474 696e 6720 616e 2061 6c74 6572  getting an alter
-00020280: 6564 2063 6f70 792e 0a20 2020 202a 2a6b  ed copy..    **k
-00020290: 7761 7267 7320 3a20 4f74 6865 7220 7061  wargs : Other pa
-000202a0: 7261 6d65 7465 7273 2070 6173 7365 6420  rameters passed 
-000202b0: 746f 2060 6066 756e 6360 602e 0a20 2020  to ``func``..   
-000202c0: 2022 2222 0a20 2020 2069 6620 636f 6c75   """.    if colu
-000202d0: 6d6e 5f77 6973 653a 0a20 2020 2020 2020  mn_wise:.       
-000202e0: 2069 6620 6e6f 7420 6466 2e5f 5f63 6c61   if not df.__cla
-000202f0: 7373 5f5f 203d 3d20 7064 2e63 6f72 652e  ss__ == pd.core.
-00020300: 7365 7269 6573 2e53 6572 6965 733a 0a20  series.Series:. 
-00020310: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
-00020320: 7261 6d32 636f 6c20 6973 204e 6f6e 653a  ram2col is None:
-00020330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020340: 2072 6574 7572 6e20 6466 2e61 7070 6c79   return df.apply
-00020350: 2874 7261 6e73 666f 726d 2c20 6172 6773  (transform, args
-00020360: 3d28 6675 6e63 2c29 2c20 2a2a 6b77 6172  =(func,), **kwar
-00020370: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
-00020380: 6966 2070 6172 616d 3263 6f6c 2e5f 5f63  if param2col.__c
-00020390: 6c61 7373 5f5f 203d 3d20 6469 6374 3a0a  lass__ == dict:.
-000203a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203b0: 7661 725f 6172 6720 3d20 5b6b 2066 6f72  var_arg = [k for
-000203c0: 206b 2c20 7620 696e 2070 6172 616d 3263   k, v in param2c
-000203d0: 6f6c 2e69 7465 6d73 2829 2069 6620 7620  ol.items() if v 
-000203e0: 6973 204e 6f6e 655d 0a20 2020 2020 2020  is None].       
-000203f0: 2020 2020 2020 2020 2061 7070 6c79 5f63           apply_c
-00020400: 6f6c 7320 3d20 5b63 6f6c 2066 6f72 2063  ols = [col for c
-00020410: 6f6c 2069 6e20 6466 2e63 6f6c 756d 6e73  ol in df.columns
-00020420: 2069 6620 6e6f 7420 636f 6c20 696e 2070   if not col in p
-00020430: 6172 616d 3263 6f6c 2e76 616c 7565 7328  aram2col.values(
-00020440: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-00020450: 2020 2061 7373 6572 7420 6c65 6e28 0a20     assert len(. 
-00020460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020470: 2020 2076 6172 5f61 7267 2920 3c20 322c     var_arg) < 2,
-00020480: 2066 224e 616d 6520 6f6e 6c79 206f 6e65   f"Name only one
-00020490: 2076 6172 6961 626c 6520 6b65 7977 6f72   variable keywor
-000204a0: 6420 6172 6775 6d65 6e74 2061 7320 7768  d argument as wh
-000204b0: 6963 6820 7b61 7070 6c79 5f63 6f6c 737d  ich {apply_cols}
-000204c0: 2061 7265 2075 7365 6420 7b27 6172 6775   are used {'argu
-000204d0: 6d65 6e74 273a 204e 6f6e 657d 2e22 0a20  ment': None}.". 
-000204e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000204f0: 6172 5f61 7267 203d 2076 6172 5f61 7267  ar_arg = var_arg
-00020500: 5b30 5d20 6966 206c 656e 2876 6172 5f61  [0] if len(var_a
-00020510: 7267 2920 3e20 3020 656c 7365 2067 6574  rg) > 0 else get
-00020520: 6675 6c6c 6172 6773 7065 6328 6675 6e63  fullargspec(func
-00020530: 292e 6172 6773 5b30 5d0a 2020 2020 2020  ).args[0].      
-00020540: 2020 2020 2020 2020 2020 7061 7261 6d32            param2
-00020550: 636f 6c20 3d20 7b6b 3a20 7620 666f 7220  col = {k: v for 
-00020560: 6b2c 2076 2069 6e20 7061 7261 6d32 636f  k, v in param2co
-00020570: 6c2e 6974 656d 7328 2920 6966 2076 2069  l.items() if v i
-00020580: 7320 6e6f 7420 4e6f 6e65 7d0a 2020 2020  s not None}.    
-00020590: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000205a0: 6c74 5f63 6f6c 7320 3d20 7b63 6f6c 3a20  lt_cols = {col: 
-000205b0: 7472 616e 7366 6f72 6d28 6466 2c20 6675  transform(df, fu
-000205c0: 6e63 2c20 6469 6374 287b 7661 725f 6172  nc, dict({var_ar
-000205d0: 673a 2063 6f6c 7d2c 202a 2a70 6172 616d  g: col}, **param
-000205e0: 3263 6f6c 292c 202a 2a6b 7761 7267 7329  2col), **kwargs)
-000205f0: 2066 6f72 2063 6f6c 2069 6e0a 2020 2020   for col in.    
-00020600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020610: 2020 2020 2020 2020 2020 2061 7070 6c79             apply
-00020620: 5f63 6f6c 737d 0a20 2020 2020 2020 2020  _cols}.         
-00020630: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00020640: 2020 2020 2020 2020 2061 7070 6c79 5f63           apply_c
-00020650: 6f6c 7320 3d20 5b63 6f6c 2066 6f72 2063  ols = [col for c
-00020660: 6f6c 2069 6e20 6466 2e63 6f6c 756d 6e73  ol in df.columns
-00020670: 2069 6620 6e6f 7420 636f 6c20 696e 2070   if not col in p
-00020680: 6172 616d 3263 6f6c 5d0a 2020 2020 2020  aram2col].      
-00020690: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-000206a0: 5f63 6f6c 7320 3d20 7b63 6f6c 3a20 7472  _cols = {col: tr
-000206b0: 616e 7366 6f72 6d28 6466 2c20 6675 6e63  ansform(df, func
-000206c0: 2c20 5b63 6f6c 5d20 2b20 7061 7261 6d32  , [col] + param2
-000206d0: 636f 6c2c 202a 2a6b 7761 7267 7329 2066  col, **kwargs) f
-000206e0: 6f72 2063 6f6c 2069 6e20 6170 706c 795f  or col in apply_
-000206f0: 636f 6c73 7d0a 2020 2020 2020 2020 2020  cols}.          
-00020700: 2020 7265 7475 726e 2070 642e 4461 7461    return pd.Data
-00020710: 4672 616d 6528 7265 7375 6c74 5f63 6f6c  Frame(result_col
-00020720: 732c 2069 6e64 6578 3d64 662e 696e 6465  s, index=df.inde
-00020730: 7829 0a0a 2020 2020 6966 2070 6172 616d  x)..    if param
-00020740: 3263 6f6c 2e5f 5f63 6c61 7373 5f5f 203d  2col.__class__ =
-00020750: 3d20 6469 6374 3a0a 2020 2020 2020 2020  = dict:.        
-00020760: 7061 7261 6d5f 7475 706c 6573 203d 206c  param_tuples = l
-00020770: 6973 7428 6466 5b70 6172 616d 3263 6f6c  ist(df[param2col
-00020780: 2e76 616c 7565 7328 295d 2e69 7465 7274  .values()].itert
-00020790: 7570 6c65 7328 696e 6465 783d 4661 6c73  uples(index=Fals
-000207a0: 652c 206e 616d 653d 4e6f 6e65 2929 0a20  e, name=None)). 
-000207b0: 2020 2020 2020 2072 6573 756c 745f 6469         result_di
-000207c0: 6374 203d 207b 743a 2066 756e 6328 2a2a  ct = {t: func(**
-000207d0: 7b61 3a20 6220 666f 7220 612c 2062 2069  {a: b for a, b i
-000207e0: 6e20 7a69 7028 7061 7261 6d32 636f 6c2e  n zip(param2col.
-000207f0: 6b65 7973 2829 2c20 7429 7d2c 202a 2a6b  keys(), t)}, **k
-00020800: 7761 7267 7329 2066 6f72 2074 2069 6e20  wargs) for t in 
-00020810: 7365 7428 7061 7261 6d5f 7475 706c 6573  set(param_tuples
-00020820: 297d 0a20 2020 2065 6c73 653a 0a20 2020  )}.    else:.   
-00020830: 2020 2020 2069 6620 6466 2e5f 5f63 6c61       if df.__cla
-00020840: 7373 5f5f 203d 3d20 7064 2e63 6f72 652e  ss__ == pd.core.
-00020850: 7365 7269 6573 2e53 6572 6965 733a 0a20  series.Series:. 
-00020860: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
-00020870: 7261 6d32 636f 6c20 6973 206e 6f74 204e  ram2col is not N
-00020880: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00020890: 2020 2020 2070 7269 6e74 2822 5768 656e       print("When
-000208a0: 2027 6466 2720 6973 2061 2053 6572 6965   'df' is a Serie
-000208b0: 732c 2074 6865 2070 6172 616d 6574 6572  s, the parameter
-000208c0: 2027 7061 7261 6d32 636f 6c27 2068 6173   'param2col' has
-000208d0: 206e 6f20 7573 652e 2229 0a20 2020 2020   no use.").     
-000208e0: 2020 2020 2020 2070 6172 616d 5f74 7570         param_tup
-000208f0: 6c65 7320 3d20 6466 2e76 616c 7565 730a  les = df.values.
-00020900: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00020910: 6c74 5f64 6963 7420 3d20 7b74 3a20 6675  lt_dict = {t: fu
-00020920: 6e63 2874 2c20 2a2a 6b77 6172 6773 2920  nc(t, **kwargs) 
-00020930: 666f 7220 7420 696e 2073 6574 2870 6172  for t in set(par
-00020940: 616d 5f74 7570 6c65 7329 7d0a 2020 2020  am_tuples)}.    
-00020950: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00020960: 2020 2020 2020 6966 2070 6172 616d 3263        if param2c
-00020970: 6f6c 2069 7320 4e6f 6e65 3a0a 2020 2020  ol is None:.    
-00020980: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00020990: 6d5f 7475 706c 6573 203d 206c 6973 7428  m_tuples = list(
-000209a0: 6466 2e69 7465 7274 7570 6c65 7328 696e  df.itertuples(in
-000209b0: 6465 783d 4661 6c73 652c 206e 616d 653d  dex=False, name=
-000209c0: 4e6f 6e65 2929 0a20 2020 2020 2020 2020  None)).         
-000209d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000209e0: 2020 2020 2020 2020 2070 6172 616d 5f74           param_t
-000209f0: 7570 6c65 7320 3d20 6c69 7374 2864 665b  uples = list(df[
-00020a00: 6c69 7374 2870 6172 616d 3263 6f6c 295d  list(param2col)]
-00020a10: 2e69 7465 7274 7570 6c65 7328 696e 6465  .itertuples(inde
-00020a20: 783d 4661 6c73 652c 206e 616d 653d 4e6f  x=False, name=No
-00020a30: 6e65 2929 0a20 2020 2020 2020 2020 2020  ne)).           
-00020a40: 2072 6573 756c 745f 6469 6374 203d 207b   result_dict = {
-00020a50: 743a 2066 756e 6328 2a74 2c20 2a2a 6b77  t: func(*t, **kw
-00020a60: 6172 6773 2920 666f 7220 7420 696e 2073  args) for t in s
-00020a70: 6574 2870 6172 616d 5f74 7570 6c65 7329  et(param_tuples)
-00020a80: 7d0a 2020 2020 7769 7468 2077 6172 6e69  }.    with warni
-00020a90: 6e67 732e 6361 7463 685f 7761 726e 696e  ngs.catch_warnin
-00020aa0: 6773 2829 3a0a 2020 2020 2020 2020 2320  gs():.        # 
-00020ab0: 7061 6e64 6173 2064 6576 656c 6f70 6572  pandas developer
-00020ac0: 7320 646f 696e 6720 7468 6569 7220 6d6f  s doing their mo
-00020ad0: 7374 2061 6e6e 6f79 696e 6720 7468 696e  st annoying thin
-00020ae0: 6720 3e3a 280a 2020 2020 2020 2020 7761  g >:(.        wa
-00020af0: 726e 696e 6773 2e66 696c 7465 7277 6172  rnings.filterwar
-00020b00: 6e69 6e67 7328 0a20 2020 2020 2020 2020  nings(.         
-00020b10: 2020 2022 6967 6e6f 7265 222c 0a20 2020     "ignore",.   
-00020b20: 2020 2020 2020 2020 2063 6174 6567 6f72           categor
-00020b30: 793d 4675 7475 7265 5761 726e 696e 672c  y=FutureWarning,
-00020b40: 0a20 2020 2020 2020 2020 2020 206d 6573  .            mes
-00020b50: 7361 6765 3d28 0a20 2020 2020 2020 2020  sage=(.         
-00020b60: 2020 2020 2020 2022 2e2a 5468 6520 6465         ".*The de
-00020b70: 6661 756c 7420 6474 7970 6520 666f 7220  fault dtype for 
-00020b80: 656d 7074 7920 5365 7269 6573 2e2a 220a  empty Series.*".
-00020b90: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-00020ba0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00020bb0: 2072 6573 203d 2070 642e 5365 7269 6573   res = pd.Series
-00020bc0: 285b 7265 7375 6c74 5f64 6963 745b 745d  ([result_dict[t]
-00020bd0: 2066 6f72 2074 2069 6e20 7061 7261 6d5f   for t in param_
-00020be0: 7475 706c 6573 5d2c 2069 6e64 6578 3d64  tuples], index=d
-00020bf0: 662e 696e 6465 7829 0a20 2020 2072 6574  f.index).    ret
-00020c00: 7572 6e20 7265 730a 0a40 6675 6e63 7469  urn res..@functi
-00020c10: 6f6e 5f6c 6f67 6765 720a 6465 6620 6164  on_logger.def ad
-00020c20: 6a61 6365 6e63 795f 6772 6f75 7073 2853  jacency_groups(S
-00020c30: 3a20 7064 2e53 6572 6965 732c 0a20 2020  : pd.Series,.   
-00020c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c50: 2020 6e61 5f76 616c 7565 733a 204f 7074    na_values: Opt
-00020c60: 696f 6e61 6c5b 7374 725d 203d 2027 6772  ional[str] = 'gr
-00020c70: 6f75 7027 2c0a 2020 2020 2020 2020 2020  oup',.          
-00020c80: 2020 2020 2020 2020 2020 2070 7265 7665             preve
-00020c90: 6e74 5f6d 6572 6765 3a20 626f 6f6c 203d  nt_merge: bool =
-00020ca0: 2046 616c 7365 2920 2d3e 2054 7570 6c65   False) -> Tuple
-00020cb0: 5b70 642e 5365 7269 6573 2c20 4469 6374  [pd.Series, Dict
-00020cc0: 5b69 6e74 2c20 416e 795d 5d3a 0a20 2020  [int, Any]]:.   
-00020cd0: 2022 2222 2054 7572 6e73 2061 2053 6572   """ Turns a Ser
-00020ce0: 6965 7320 696e 746f 2061 2053 6572 6965  ies into a Serie
-00020cf0: 7320 6f66 2061 7363 656e 6469 6e67 2069  s of ascending i
-00020d00: 6e74 6567 6572 7320 7374 6172 7469 6e67  ntegers starting
-00020d10: 2066 726f 6d20 3120 7468 6174 2072 6566   from 1 that ref
-00020d20: 6c65 6374 2067 726f 7570 7320 6f66 2073  lect groups of s
-00020d30: 7563 6365 7373 6976 650a 2020 2020 6571  uccessive.    eq
-00020d40: 7561 6c20 7661 6c75 6573 2e20 5468 6572  ual values. Ther
-00020d50: 6520 6172 6520 7365 7665 7261 6c20 6f70  e are several op
-00020d60: 7469 6f6e 7320 6f66 2068 6f77 2074 6f20  tions of how to 
-00020d70: 6465 616c 2077 6974 6820 4e41 2076 616c  deal with NA val
-00020d80: 7565 732e 0a0a 2020 2020 4172 6773 3a0a  ues...    Args:.
-00020d90: 2020 2020 2020 533a 2053 6572 6965 7320        S: Series 
-00020da0: 696e 2077 6869 6368 2074 6f20 6772 6f75  in which to grou
-00020db0: 7020 6964 656e 7469 6361 6c20 6164 6a61  p identical adja
-00020dc0: 6365 6e74 2076 616c 7565 7320 7769 7468  cent values with
-00020dd0: 2065 6163 6820 6f74 6865 722e 0a20 2020   each other..   
-00020de0: 2020 206e 615f 7661 6c75 6573 3a0a 2020     na_values:.  
-00020df0: 2020 2020 2020 2020 7c20 2767 726f 7570          | 'group
-00020e00: 2720 6372 6561 7465 7320 696e 6469 7669  ' creates indivi
-00020e10: 6475 616c 2067 726f 7570 7320 666f 7220  dual groups for 
-00020e20: 4e41 2076 616c 7565 7320 2864 6566 6175  NA values (defau
-00020e30: 6c74 292e 0a20 2020 2020 2020 2020 207c  lt)..          |
-00020e40: 2027 6261 636b 6669 6c6c 2720 6f72 2027   'backfill' or '
-00020e50: 6266 696c 6c27 2067 726f 7570 7320 4e41  bfill' groups NA
-00020e60: 2076 616c 7565 7320 7769 7468 2074 6865   values with the
-00020e70: 2073 7562 7365 7175 656e 7420 6772 6f75   subsequent grou
-00020e80: 700a 2020 2020 2020 2020 2020 7c20 2770  p.          | 'p
-00020e90: 6164 272c 2027 6666 696c 6c27 2067 726f  ad', 'ffill' gro
-00020ea0: 7570 7320 4e41 2076 616c 7565 7320 7769  ups NA values wi
-00020eb0: 7468 2074 6865 2070 7265 6365 6469 6e67  th the preceding
-00020ec0: 2067 726f 7570 0a20 2020 2020 2020 2020   group.         
-00020ed0: 207c 2041 6e79 206f 7468 6572 2073 7472   | Any other str
-00020ee0: 696e 6720 776f 726b 7320 6c69 6b65 2027  ing works like '
-00020ef0: 6772 6f75 7027 2c20 7769 7468 2074 6865  group', with the
-00020f00: 2064 6966 6665 7265 6e63 6520 7468 6174   difference that
-00020f10: 2074 6865 2067 726f 7570 7320 7769 6c6c   the groups will
-00020f20: 2062 6520 6e61 6d65 6420 7769 7468 2074   be named with t
-00020f30: 6869 7320 7661 6c75 652e 0a20 2020 2020  his value..     
-00020f40: 2020 2020 207c 2050 6173 7369 6e67 204e       | Passing N
-00020f50: 6f6e 6520 6d65 616e 7320 4e41 2076 616c  one means NA val
-00020f60: 7565 7320 2620 7261 6e67 6573 2061 7265  ues & ranges are
-00020f70: 2062 6569 6e67 2069 676e 6f72 6564 2c20   being ignored, 
-00020f80: 692e 652e 2074 6865 7920 7769 6c6c 2061  i.e. they will a
-00020f90: 6c73 6f20 6265 2070 7265 7365 6e74 2069  lso be present i
-00020fa0: 6e20 7468 6520 6f75 7470 7574 2061 6e64  n the output and
-00020fb0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00020fc0: 2073 7562 7365 7175 656e 7420 7661 6c75   subsequent valu
-00020fd0: 6520 7769 6c6c 2062 6520 6261 7365 6420  e will be based 
-00020fe0: 6f6e 2074 6865 2070 7265 6365 6469 6e67  on the preceding
-00020ff0: 2076 616c 7565 2e0a 2020 2020 2020 7072   value..      pr
-00021000: 6576 656e 745f 6d65 7267 653a 0a20 2020  event_merge:.   
-00021010: 2020 2020 2020 2042 7920 6465 6661 756c         By defaul
-00021020: 742c 2069 6620 796f 7520 7573 6520 7468  t, if you use th
-00021030: 6520 606e 615f 7661 6c75 6573 6020 6172  e `na_values` ar
-00021040: 6775 6d65 6e74 2074 6f20 6669 6c6c 204e  gument to fill N
-00021050: 4120 7661 6c75 6573 2c20 7468 6579 206d  A values, they m
-00021060: 6967 6874 206c 6561 6420 746f 2074 776f  ight lead to two
-00021070: 2067 726f 7570 7320 6d65 7267 696e 672e   groups merging.
-00021080: 0a20 2020 2020 2020 2020 2050 6173 7320  .          Pass 
-00021090: 5472 7565 2074 6f20 7072 6576 656e 7420  True to prevent 
-000210a0: 7468 6973 2e20 466f 7220 6578 616d 706c  this. For exampl
-000210b0: 652c 2074 616b 6520 7468 6520 7365 7175  e, take the sequ
-000210c0: 656e 6365 205b 2761 272c 204e 412c 2027  ence ['a', NA, '
-000210d0: 6127 5d20 7769 7468 2060 606e 615f 7661  a'] with ``na_va
-000210e0: 6c75 6573 3d27 6666 696c 6c27 6060 3a20  lues='ffill'``: 
-000210f0: 4279 2064 6566 6175 6c74 2c0a 2020 2020  By default,.    
-00021100: 2020 2020 2020 6974 2077 696c 6c20 6265        it will be
-00021110: 206d 6572 6765 6420 746f 206f 6e65 2073   merged to one s
-00021120: 696e 676c 6520 6772 6f75 7020 6060 5b31  ingle group ``[1
-00021130: 2c20 312c 2031 5d2c 207b 313a 2027 6127  , 1, 1], {1: 'a'
-00021140: 7d60 602e 2048 6f77 6576 6572 2c20 7061  }``. However, pa
-00021150: 7373 696e 6720 6060 7072 6576 656e 745f  ssing ``prevent_
-00021160: 6d65 7267 653d 5472 7565 6060 2077 696c  merge=True`` wil
-00021170: 6c0a 2020 2020 2020 2020 2020 7265 7375  l.          resu
-00021180: 6c74 2069 6e20 6060 5b31 2c20 312c 2032  lt in ``[1, 1, 2
-00021190: 5d2c 207b 313a 2027 6127 2c20 323a 2027  ], {1: 'a', 2: '
-000211a0: 6127 7d60 602e 0a0a 2020 2020 5265 7475  a'}``...    Retu
-000211b0: 726e 733a 0a20 2020 2020 2041 2073 6572  rns:.      A ser
-000211c0: 6965 7320 7769 7468 2069 6e63 7265 6173  ies with increas
-000211d0: 696e 6720 696e 7465 6765 7273 2074 6861  ing integers tha
-000211e0: 7420 6361 6e20 6265 2075 7365 6420 666f  t can be used fo
-000211f0: 7220 6772 6f75 7069 6e67 2e0a 2020 2020  r grouping..    
-00021200: 2020 4120 6469 6374 696f 6e61 7279 206d    A dictionary m
-00021210: 6170 7069 6e67 2074 6865 2069 6e74 6567  apping the integ
-00021220: 6572 7320 746f 2074 6865 2067 726f 7570  ers to the group
-00021230: 6564 2076 616c 7565 732e 0a0a 2020 2020  ed values...    
-00021240: 2222 220a 2020 2020 7265 696e 6465 785f  """.    reindex_
-00021250: 666c 6167 203d 2046 616c 7365 0a20 2020  flag = False.   
-00021260: 2023 2072 6569 6e64 6578 2069 7320 7365   # reindex is se
-00021270: 7420 746f 2054 7275 6520 696e 2063 6173  t to True in cas
-00021280: 6573 2077 6865 7265 204e 4120 7661 6c75  es where NA valu
-00021290: 6573 2061 7265 2062 6569 6e67 2065 7863  es are being exc
-000212a0: 6c75 6465 6420 6672 6f6d 2074 6865 206f  luded from the o
-000212b0: 7065 7261 7469 6f6e 2061 6e64 2072 6573  peration and res
-000212c0: 746f 7265 6420 6166 7465 7277 6172 6473  tored afterwards
-000212d0: 0a20 2020 2069 6620 7072 6576 656e 745f  .    if prevent_
-000212e0: 6d65 7267 653a 0a20 2020 2020 2020 2066  merge:.        f
-000212f0: 6f72 6365 645f 6265 6769 6e6e 696e 6773  orced_beginnings
-00021300: 203d 2053 2e6e 6f74 6e61 2829 2026 207e   = S.notna() & ~
-00021310: 532e 6e6f 746e 6128 292e 7368 6966 7428  S.notna().shift(
-00021320: 292e 6669 6c6c 6e61 2846 616c 7365 290a  ).fillna(False).
-00021330: 2020 2020 6966 206e 615f 7661 6c75 6573      if na_values
-00021340: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00021350: 2020 6966 2053 2e69 736e 6128 292e 616e    if S.isna().an
-00021360: 7928 293a 0a20 2020 2020 2020 2020 2020  y():.           
-00021370: 2073 203d 2053 2e64 726f 706e 6128 290a   s = S.dropna().
-00021380: 2020 2020 2020 2020 2020 2020 7265 696e              rein
-00021390: 6465 785f 666c 6167 203d 2054 7275 650a  dex_flag = True.
-000213a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000213b0: 2020 2020 2020 2020 2020 7320 3d20 530a            s = S.
-000213c0: 2020 2020 656c 6966 206e 615f 7661 6c75      elif na_valu
-000213d0: 6573 203d 3d20 2767 726f 7570 273a 0a20  es == 'group':. 
-000213e0: 2020 2020 2020 2073 203d 2053 0a20 2020         s = S.   
-000213f0: 2065 6c69 6620 6e61 5f76 616c 7565 7320   elif na_values 
-00021400: 696e 2028 2762 6163 6b66 696c 6c27 2c20  in ('backfill', 
-00021410: 2762 6669 6c6c 272c 2027 7061 6427 2c20  'bfill', 'pad', 
-00021420: 2766 6669 6c6c 2729 3a0a 2020 2020 2020  'ffill'):.      
-00021430: 2020 7320 3d20 532e 6669 6c6c 6e61 286d    s = S.fillna(m
-00021440: 6574 686f 643d 6e61 5f76 616c 7565 7329  ethod=na_values)
-00021450: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00021460: 2020 2073 203d 2053 2e66 696c 6c6e 6128     s = S.fillna(
-00021470: 7661 6c75 653d 6e61 5f76 616c 7565 7329  value=na_values)
-00021480: 0a0a 2020 2020 6966 2073 2e69 736e 6128  ..    if s.isna(
-00021490: 292e 616e 7928 293a 0a20 2020 2020 2020  ).any():.       
-000214a0: 2069 6620 6e61 5f76 616c 7565 7320 3d3d   if na_values ==
-000214b0: 2027 6772 6f75 7027 3a0a 2020 2020 2020   'group':.      
-000214c0: 2020 2020 2020 7368 6966 7465 6420 3d20        shifted = 
-000214d0: 732e 7368 6966 7428 290a 2020 2020 2020  s.shift().      
-000214e0: 2020 2020 2020 6966 2070 642e 6973 6e75        if pd.isnu
-000214f0: 6c6c 2853 2e69 6c6f 635b 305d 293a 0a20  ll(S.iloc[0]):. 
-00021500: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00021510: 6869 6674 6564 2e69 6c6f 635b 305d 203d  hifted.iloc[0] =
-00021520: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00021530: 2020 6265 6769 6e6e 696e 6773 203d 207e    beginnings = ~
-00021540: 6e61 6e5f 6571 2873 2c20 7368 6966 7465  nan_eq(s, shifte
-00021550: 6429 0a20 2020 2020 2020 2065 6c73 653a  d).        else:
-00021560: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00021570: 6765 722e 7761 726e 696e 6728 6622 4166  ger.warning(f"Af
-00021580: 7465 7220 7472 6561 7469 6e67 2074 6865  ter treating the
-00021590: 2053 6572 6965 7320 277b 532e 6e61 6d65   Series '{S.name
-000215a0: 7d27 2077 6974 6820 6e61 5f76 616c 7565  }' with na_value
-000215b0: 733d 277b 6e61 5f76 616c 7565 737d 272c  s='{na_values}',
-000215c0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000215d0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000215e0: 7468 6572 6520 7765 7265 2073 7469 6c6c  there were still
-000215f0: 207b 732e 6973 6e61 2829 2e73 756d 2829   {s.isna().sum()
-00021600: 7d20 4e41 2076 616c 7565 7320 6c65 6674  } NA values left
-00021610: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00021620: 7320 3d20 732e 6472 6f70 6e61 2829 0a20  s = s.dropna(). 
-00021630: 2020 2020 2020 2020 2020 2062 6567 696e             begin
-00021640: 6e69 6e67 7320 3d20 2873 2021 3d20 732e  nings = (s != s.
-00021650: 7368 6966 7428 2929 2e66 696c 6c6e 6128  shift()).fillna(
-00021660: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-00021670: 2020 2062 6567 696e 6e69 6e67 732e 696c     beginnings.il
-00021680: 6f63 5b30 5d20 3d20 5472 7565 0a20 2020  oc[0] = True.   
-00021690: 2020 2020 2020 2020 2072 6569 6e64 6578           reindex
-000216a0: 5f66 6c61 6720 3d20 5472 7565 0a20 2020  _flag = True.   
-000216b0: 2065 6c73 653a 0a20 2020 2020 2020 2062   else:.        b
-000216c0: 6567 696e 6e69 6e67 7320 3d20 7320 213d  eginnings = s !=
-000216d0: 2073 2e73 6869 6674 2829 0a20 2020 2020   s.shift().     
-000216e0: 2020 2062 6567 696e 6e69 6e67 732e 696c     beginnings.il
-000216f0: 6f63 5b30 5d20 3d20 5472 7565 0a20 2020  oc[0] = True.   
-00021700: 2069 6620 7072 6576 656e 745f 6d65 7267   if prevent_merg
-00021710: 653a 0a20 2020 2020 2020 2062 6567 696e  e:.        begin
-00021720: 6e69 6e67 7320 7c3d 2066 6f72 6365 645f  nings |= forced_
-00021730: 6265 6769 6e6e 696e 6773 0a20 2020 2067  beginnings.    g
-00021740: 726f 7570 7320 3d20 6265 6769 6e6e 696e  roups = beginnin
-00021750: 6773 2e63 756d 7375 6d28 290a 2020 2020  gs.cumsum().    
-00021760: 6e61 6d65 7320 3d20 6469 6374 2865 6e75  names = dict(enu
-00021770: 6d65 7261 7465 2873 5b62 6567 696e 6e69  merate(s[beginni
-00021780: 6e67 735d 2c20 3129 290a 2020 2020 6966  ngs], 1)).    if
-00021790: 2072 6569 6e64 6578 5f66 6c61 673a 0a20   reindex_flag:. 
-000217a0: 2020 2020 2020 2067 726f 7570 7320 3d20         groups = 
-000217b0: 6772 6f75 7073 2e72 6569 6e64 6578 2853  groups.reindex(S
-000217c0: 2e69 6e64 6578 290a 2020 2020 7472 793a  .index).    try:
-000217d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000217e0: 7064 2e74 6f5f 6e75 6d65 7269 6328 6772  pd.to_numeric(gr
-000217f0: 6f75 7073 292e 6173 7479 7065 2827 496e  oups).astype('In
-00021800: 7436 3427 292c 206e 616d 6573 0a20 2020  t64'), names.   
-00021810: 2065 7863 6570 7420 5479 7065 4572 726f   except TypeErro
-00021820: 723a 0a20 2020 2020 2020 206c 6f67 6765  r:.        logge
-00021830: 722e 7761 726e 696e 6728 6622 4572 726f  r.warning(f"Erro
-00021840: 6e65 6f75 7320 6f75 7463 6f6d 6520 7768  neous outcome wh
-00021850: 696c 6520 636f 6d70 7574 696e 6720 6164  ile computing ad
-00021860: 6a61 6365 6e63 7920 6772 6f75 7073 3a20  jacency groups: 
-00021870: 7b67 726f 7570 737d 2229 0a20 2020 2020  {groups}").     
-00021880: 2020 2072 6574 7572 6e20 6772 6f75 7073     return groups
-00021890: 2c20 6e61 6d65 730a 0a40 6675 6e63 7469  , names..@functi
-000218a0: 6f6e 5f6c 6f67 6765 720a 6465 6620 756e  on_logger.def un
-000218b0: 666f 6c64 5f6d 6561 7375 7265 735f 7461  fold_measures_ta
-000218c0: 626c 6528 6d65 6173 7572 6573 3a20 7064  ble(measures: pd
-000218d0: 2e44 6174 6146 7261 6d65 2920 2d3e 204f  .DataFrame) -> O
-000218e0: 7074 696f 6e61 6c5b 7064 2e44 6174 6146  ptional[pd.DataF
-000218f0: 7261 6d65 5d3a 0a20 2020 2022 2222 2052  rame]:.    """ R
-00021900: 6574 7572 6e73 2061 2063 6f70 7920 6f66  eturns a copy of
-00021910: 2061 206d 6561 7375 7265 7320 7461 626c   a measures tabl
-00021920: 6520 7468 6174 2063 6f72 7265 7370 6f6e  e that correspon
-00021930: 6473 2074 6872 6f75 6768 2061 2073 7563  ds through a suc
-00021940: 6365 7373 696f 6e20 6f66 204d 4373 2077  cession of MCs w
-00021950: 6865 6e20 706c 6179 696e 6720 616c 6c20  hen playing all 
-00021960: 7265 7065 6174 732e 0a20 2020 2054 6f20  repeats..    To 
-00021970: 6469 7374 696e 6775 6973 6820 6265 7477  distinguish betw
-00021980: 6565 6e20 7265 7065 6174 6564 204d 4373  een repeated MCs
-00021990: 2061 6e64 204d 4e73 2c20 6974 2061 6464   and MNs, it add
-000219a0: 7320 7468 6520 636f 6e74 696e 7565 7320  s the continues 
-000219b0: 636f 6c75 6d6e 2027 6d63 5f70 6c61 7974  column 'mc_playt
-000219c0: 6872 6f75 6768 2720 2873 7461 7274 696e  hrough' (startin
-000219d0: 6720 6174 2031 2920 616e 640a 2020 2020  g at 1) and.    
-000219e0: 276d 6e5f 706c 6179 7468 726f 7567 6827  'mn_playthrough'
-000219f0: 2077 6869 6368 2063 6f6e 7461 696e 7320   which contains 
-00021a00: 7468 6520 7661 6c75 6573 206f 6620 276d  the values of 'm
-00021a10: 6e27 2061 7320 7374 7269 6e67 2077 6974  n' as string wit
-00021a20: 6820 6c65 7474 6572 7320 7b27 6127 2c20  h letters {'a', 
-00021a30: 2762 272c 202e 2e2e 7d20 6170 7065 6e64  'b', ...} append
-00021a40: 6564 2e0a 0a20 2020 2041 7267 733a 0a20  ed...    Args:. 
-00021a50: 2020 2020 206d 6561 7375 7265 733a 204d       measures: M
-00021a60: 6561 7375 7265 7320 7461 626c 6520 7769  easures table wi
-00021a70: 7468 2063 6f6c 756d 6e73 205b 276d 6327  th columns ['mc'
-00021a80: 2c20 276e 6578 7427 2c20 2764 6f6e 745f  , 'next', 'dont_
-00021a90: 636f 756e 7427 5d0a 0a20 2020 2052 6574  count']..    Ret
-00021aa0: 7572 6e73 3a0a 0a20 2020 2022 2222 0a20  urns:..    """. 
-00021ab0: 2020 2069 6620 276d 635f 706c 6179 7468     if 'mc_playth
-00021ac0: 726f 7567 6827 2069 6e20 6d65 6173 7572  rough' in measur
-00021ad0: 6573 3a0a 2020 2020 2020 2020 6c6f 6767  es:.        logg
-00021ae0: 6572 2e69 6e66 6f28 6622 5265 6365 6976  er.info(f"Receiv
-00021af0: 6564 2061 2064 6174 6166 7261 6d65 2077  ed a dataframe w
-00021b00: 6974 6820 7468 6520 636f 6c75 6d6e 2027  ith the column '
-00021b10: 6d63 5f70 6c61 7974 6872 6f75 6768 2720  mc_playthrough' 
-00021b20: 7468 6174 2069 7320 616c 7265 6164 7920  that is already 
-00021b30: 756e 666f 6c64 6564 2e20 5265 7475 726e  unfolded. Return
-00021b40: 696e 6720 6173 2069 732e 2229 0a20 2020  ing as is.").   
-00021b50: 2020 2020 2072 6574 7572 6e20 6d65 6173       return meas
-00021b60: 7572 6573 0a20 2020 2070 6c61 7974 6872  ures.    playthr
-00021b70: 6f75 6768 326d 6320 3d20 6d61 6b65 5f70  ough2mc = make_p
-00021b80: 6c61 7974 6872 6f75 6768 326d 6328 6d65  laythrough2mc(me
-00021b90: 6173 7572 6573 2c20 6c6f 6767 6572 3d6c  asures, logger=l
-00021ba0: 6f67 6765 7229 0a20 2020 2069 6620 706c  ogger).    if pl
-00021bb0: 6179 7468 726f 7567 6832 6d63 2069 7320  aythrough2mc is 
-00021bc0: 4e6f 6e65 206f 7220 6c65 6e28 706c 6179  None or len(play
-00021bd0: 7468 726f 7567 6832 6d63 2920 3d3d 2030  through2mc) == 0
-00021be0: 3a0a 2020 2020 2020 2020 6c6f 6767 6572  :.        logger
-00021bf0: 2e77 6172 6e69 6e67 2866 2245 7272 6f72  .warning(f"Error
-00021c00: 2069 6e20 7468 6520 7265 7065 6174 2073   in the repeat s
-00021c10: 7472 7563 7475 7265 3a20 4469 6420 6e6f  tructure: Did no
-00021c20: 7420 7265 6163 6820 7468 6520 7374 6f70  t reach the stop
-00021c30: 7069 6e67 2076 616c 7565 202d 3120 696e  ping value -1 in
-00021c40: 206d 6561 7375 7265 732e 6e65 7874 3a5c   measures.next:\
-00021c50: 6e7b 6d65 6173 7572 6573 2e73 6574 5f69  n{measures.set_i
-00021c60: 6e64 6578 2827 6d63 2729 2e6e 6578 747d  ndex('mc').next}
-00021c70: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-00021c80: 6e20 4e6f 6e65 0a20 2020 2065 6c73 653a  n None.    else:
-00021c90: 0a20 2020 2020 2020 206c 6f67 6765 722e  .        logger.
-00021ca0: 6465 6275 6728 2252 6570 6561 7420 7374  debug("Repeat st
-00021cb0: 7275 6374 7572 6520 7375 6363 6573 7366  ructure successf
-00021cc0: 756c 6c79 2075 6e66 6f6c 6465 642e 2229  ully unfolded.")
-00021cd0: 0a20 2020 2075 6e66 6f6c 6465 645f 6d65  .    unfolded_me
-00021ce0: 6173 7572 6573 203d 2075 6e66 6f6c 645f  asures = unfold_
-00021cf0: 7265 7065 6174 7328 6d65 6173 7572 6573  repeats(measures
-00021d00: 2c20 706c 6179 7468 726f 7567 6832 6d63  , playthrough2mc
-00021d10: 2c20 6c6f 6767 6572 3d6c 6f67 6765 7229  , logger=logger)
-00021d20: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00021d30: 2020 6d6e 5f70 6c61 7974 6872 6f75 6768    mn_playthrough
-00021d40: 5f63 6f6c 203d 2063 6f6d 7075 7465 5f6d  _col = compute_m
-00021d50: 6e5f 706c 6179 7468 726f 7567 6828 756e  n_playthrough(un
-00021d60: 666f 6c64 6564 5f6d 6561 7375 7265 732c  folded_measures,
-00021d70: 206c 6f67 6765 723d 6c6f 6767 6572 290a   logger=logger).
-00021d80: 2020 2020 2020 2020 696e 7365 7274 5f70          insert_p
-00021d90: 6f73 6974 696f 6e20 3d20 756e 666f 6c64  osition = unfold
-00021da0: 6564 5f6d 6561 7375 7265 732e 636f 6c75  ed_measures.colu
-00021db0: 6d6e 732e 6765 745f 6c6f 6328 276d 635f  mns.get_loc('mc_
-00021dc0: 706c 6179 7468 726f 7567 6827 2920 2b20  playthrough') + 
-00021dd0: 310a 2020 2020 2020 2020 756e 666f 6c64  1.        unfold
-00021de0: 6564 5f6d 6561 7375 7265 732e 696e 7365  ed_measures.inse
-00021df0: 7274 2869 6e73 6572 745f 706f 7369 7469  rt(insert_positi
-00021e00: 6f6e 2c20 276d 6e5f 706c 6179 7468 726f  on, 'mn_playthro
-00021e10: 7567 6827 2c20 6d6e 5f70 6c61 7974 6872  ugh', mn_playthr
-00021e20: 6f75 6768 5f63 6f6c 290a 2020 2020 6578  ough_col).    ex
-00021e30: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00021e40: 7320 653a 0a20 2020 2020 2020 206c 6f67  s e:.        log
-00021e50: 6765 722e 7761 726e 696e 6728 6622 4164  ger.warning(f"Ad
-00021e60: 6469 6e67 2074 6865 2063 6f6c 756d 6e20  ding the column 
-00021e70: 276d 6e5f 706c 6179 7468 726f 7567 6827  'mn_playthrough'
-00021e80: 2074 6f20 7468 6520 756e 666f 6c64 6564   to the unfolded
-00021e90: 206d 6561 7375 7265 7320 7461 626c 6520   measures table 
-00021ea0: 6661 696c 6564 2077 6974 683a 5c6e 277b  failed with:\n'{
-00021eb0: 657d 2722 290a 2020 2020 6c6f 6767 6572  e}'").    logger
-00021ec0: 2e64 6562 7567 2866 224d 6561 7375 7265  .debug(f"Measure
-00021ed0: 7320 7375 6363 6573 7366 756c 6c79 2075  s successfully u
-00021ee0: 6e66 6f6c 6465 642e 2229 0a20 2020 2072  nfolded.").    r
-00021ef0: 6574 7572 6e20 756e 666f 6c64 6564 5f6d  eturn unfolded_m
-00021f00: 6561 7375 7265 730a 0a0a 4066 756e 6374  easures...@funct
-00021f10: 696f 6e5f 6c6f 6767 6572 0a64 6566 2075  ion_logger.def u
-00021f20: 6e66 6f6c 645f 7265 7065 6174 7328 6466  nfold_repeats(df
-00021f30: 3a20 7064 2e44 6174 6146 7261 6d65 2c0a  : pd.DataFrame,.
-00021f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f50: 2020 2070 6c61 7974 6872 6f75 6768 5f69     playthrough_i
-00021f60: 6e66 6f3a 2055 6e69 6f6e 5b70 642e 5365  nfo: Union[pd.Se
-00021f70: 7269 6573 2c20 7064 2e44 6174 6146 7261  ries, pd.DataFra
-00021f80: 6d65 5d29 202d 3e20 7064 2e44 6174 6146  me]) -> pd.DataF
-00021f90: 7261 6d65 3a0a 2020 2020 2222 2220 5573  rame:.    """ Us
-00021fa0: 6520 6120 7375 6363 6573 696f 6e20 6f66  e a succesion of
-00021fb0: 204d 4373 2074 6f20 6272 696e 6720 6120   MCs to bring a 
-00021fc0: 4461 7461 4672 616d 6520 696e 2074 6869  DataFrame in thi
-00021fd0: 7320 7375 6363 6573 7369 6f6e 2e20 4d43  s succession. MC
-00021fe0: 7320 6d61 7920 7265 7065 6174 2e0a 0a20  s may repeat... 
-00021ff0: 2020 2041 7267 733a 0a20 2020 2020 2064     Args:.      d
-00022000: 663a 2044 6174 6146 7261 6d65 206e 6565  f: DataFrame nee
-00022010: 6473 2074 6f20 6861 7665 2074 6865 2063  ds to have the c
-00022020: 6f6c 756d 6e73 2027 6d63 272e 2049 6620  olumns 'mc'. If 
-00022030: 276d 6e27 2069 7320 7072 6573 656e 742c  'mn' is present,
-00022040: 2074 6865 2063 6f6c 756d 6e20 276d 6e27   the column 'mn'
-00022050: 2077 696c 6c20 6265 2061 6464 6564 2c20   will be added, 
-00022060: 746f 6f2e 0a20 2020 2020 2070 6c61 7974  too..      playt
-00022070: 6872 6f75 6768 326d 633a 0a20 2020 2020  hrough2mc:.     
-00022080: 2020 2020 2041 2053 6572 6965 7320 6f66       A Series of
-00022090: 2074 6865 2066 6f72 6d61 7420 6060 7b6d   the format ``{m
-000220a0: 635f 706c 6179 7468 726f 7567 683a 206d  c_playthrough: m
-000220b0: 637d 6060 2077 6865 7265 2060 606d 635f  c}`` where ``mc_
-000220c0: 706c 6179 7468 726f 7567 6860 6020 636f  playthrough`` co
-000220d0: 7272 6573 706f 6e64 730a 2020 2020 2020  rresponds.      
-000220e0: 2020 2020 746f 2063 6f6e 7469 6e75 6f75      to continuou
-000220f0: 7320 4d43 0a0a 2020 2020 5265 7475 726e  s MC..    Return
-00022100: 733a 0a20 2020 2020 2041 2063 6f70 7920  s:.      A copy 
-00022110: 6f66 2074 6865 2064 6174 6166 7261 6d65  of the dataframe
-00022120: 2077 6974 6820 7468 6520 636f 6c75 6d6e   with the column
-00022130: 7320 276d 635f 706c 6179 7468 726f 7567  s 'mc_playthroug
-00022140: 6827 2061 6e64 2027 6d6e 5f70 6c61 7974  h' and 'mn_playt
-00022150: 6872 6f75 6768 2720 2869 6620 276d 6e27  hrough' (if 'mn'
-00022160: 2069 7320 7072 6573 656e 7429 2069 6e73   is present) ins
-00022170: 6572 7465 642e 0a20 2020 2022 2222 0a20  erted..    """. 
-00022180: 2020 206e 5f6f 6363 7572 7265 6e63 6573     n_occurrences
-00022190: 203d 2064 662e 6d63 2e76 616c 7565 5f63   = df.mc.value_c
-000221a0: 6f75 6e74 7328 290a 2020 2020 7265 7375  ounts().    resu
-000221b0: 6c74 5f64 6620 3d20 6466 2e73 6574 5f69  lt_df = df.set_i
-000221c0: 6e64 6578 2827 6d63 2729 0a20 2020 2069  ndex('mc').    i
-000221d0: 6620 6973 696e 7374 616e 6365 2870 6c61  f isinstance(pla
-000221e0: 7974 6872 6f75 6768 5f69 6e66 6f2c 2070  ythrough_info, p
-000221f0: 642e 4461 7461 4672 616d 6529 3a0a 2020  d.DataFrame):.  
-00022200: 2020 2020 2020 706c 6179 7468 726f 7567        playthroug
-00022210: 6832 6d63 203d 2070 6c61 7974 6872 6f75  h2mc = playthrou
-00022220: 6768 5f69 6e66 6f5b 276d 6327 5d0a 2020  gh_info['mc'].  
-00022230: 2020 2020 2020 706c 6179 7468 726f 7567        playthroug
-00022240: 6832 6d6e 203d 2070 6c61 7974 6872 6f75  h2mn = playthrou
-00022250: 6768 5f69 6e66 6f5b 276d 6e5f 706c 6179  gh_info['mn_play
-00022260: 7468 726f 7567 6827 5d2e 746f 5f64 6963  through'].to_dic
-00022270: 7428 290a 2020 2020 656c 7365 3a0a 2020  t().    else:.  
-00022280: 2020 2020 2020 706c 6179 7468 726f 7567        playthroug
-00022290: 6832 6d63 203d 2070 6c61 7974 6872 6f75  h2mc = playthrou
-000222a0: 6768 5f69 6e66 6f0a 2020 2020 2020 2020  gh_info.        
-000222b0: 706c 6179 7468 726f 7567 6832 6d6e 203d  playthrough2mn =
-000222c0: 204e 6f6e 650a 2020 2020 706c 6179 7468   None.    playth
-000222d0: 726f 7567 6832 6d63 203d 2070 6c61 7974  rough2mc = playt
-000222e0: 6872 6f75 6768 326d 635b 706c 6179 7468  hrough2mc[playth
-000222f0: 726f 7567 6832 6d63 2e69 7369 6e28 7265  rough2mc.isin(re
-00022300: 7375 6c74 5f64 662e 696e 6465 7829 5d0a  sult_df.index)].
-00022310: 2020 2020 6d63 5f70 6c61 7974 6872 6f75      mc_playthrou
-00022320: 6768 5f63 6f6c 203d 2070 642e 5365 7269  gh_col = pd.Seri
-00022330: 6573 2873 756d 285b 5b70 6c61 7974 6872  es(sum([[playthr
-00022340: 6f75 6768 5d20 2a20 6e5f 6f63 6375 7272  ough] * n_occurr
-00022350: 656e 6365 735b 6d63 5d20 666f 7220 706c  ences[mc] for pl
-00022360: 6179 7468 726f 7567 682c 206d 6320 696e  aythrough, mc in
-00022370: 2070 6c61 7974 6872 6f75 6768 326d 632e   playthrough2mc.
-00022380: 6974 656d 7328 295d 2c20 5b5d 2929 0a20  items()], [])). 
-00022390: 2020 2072 6573 756c 745f 6466 203d 2072     result_df = r
-000223a0: 6573 756c 745f 6466 2e6c 6f63 5b70 6c61  esult_df.loc[pla
-000223b0: 7974 6872 6f75 6768 326d 632e 7661 6c75  ythrough2mc.valu
-000223c0: 6573 5d2e 7265 7365 745f 696e 6465 7828  es].reset_index(
-000223d0: 290a 2020 2020 6966 2027 6d6e 2720 696e  ).    if 'mn' in
-000223e0: 2072 6573 756c 745f 6466 2e63 6f6c 756d   result_df.colum
-000223f0: 6e73 3a0a 2020 2020 2020 2020 636f 6c75  ns:.        colu
-00022400: 6d6e 5f70 6f73 6974 696f 6e20 3d20 7265  mn_position = re
-00022410: 7375 6c74 5f64 662e 636f 6c75 6d6e 732e  sult_df.columns.
-00022420: 6765 745f 6c6f 6328 276d 6e27 2920 2b20  get_loc('mn') + 
-00022430: 310a 2020 2020 2020 2020 6966 2070 6c61  1.        if pla
-00022440: 7974 6872 6f75 6768 326d 6e20 6973 206e  ythrough2mn is n
-00022450: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00022460: 2020 2020 206d 6e5f 706c 6179 7468 726f       mn_playthro
-00022470: 7567 685f 636f 6c20 3d20 6d63 5f70 6c61  ugh_col = mc_pla
-00022480: 7974 6872 6f75 6768 5f63 6f6c 2e6d 6170  ythrough_col.map
-00022490: 2870 6c61 7974 6872 6f75 6768 326d 6e29  (playthrough2mn)
-000224a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000224b0: 756c 745f 6466 2e69 6e73 6572 7428 636f  ult_df.insert(co
-000224c0: 6c75 6d6e 5f70 6f73 6974 696f 6e2c 2027  lumn_position, '
-000224d0: 6d6e 5f70 6c61 7974 6872 6f75 6768 272c  mn_playthrough',
-000224e0: 206d 6e5f 706c 6179 7468 726f 7567 685f   mn_playthrough_
-000224f0: 636f 6c29 0a20 2020 2065 6c73 653a 0a20  col).    else:. 
-00022500: 2020 2020 2020 2063 6f6c 756d 6e5f 706f         column_po
-00022510: 7369 7469 6f6e 203d 2072 6573 756c 745f  sition = result_
-00022520: 6466 2e63 6f6c 756d 6e73 2e67 6574 5f6c  df.columns.get_l
-00022530: 6f63 2827 6d63 2729 202b 2031 0a20 2020  oc('mc') + 1.   
-00022540: 2072 6573 756c 745f 6466 2e69 6e73 6572   result_df.inser
-00022550: 7428 636f 6c75 6d6e 5f70 6f73 6974 696f  t(column_positio
-00022560: 6e2c 2027 6d63 5f70 6c61 7974 6872 6f75  n, 'mc_playthrou
-00022570: 6768 272c 206d 635f 706c 6179 7468 726f  gh', mc_playthro
-00022580: 7567 685f 636f 6c29 0a20 2020 2072 6574  ugh_col).    ret
-00022590: 7572 6e20 7265 7375 6c74 5f64 660a 0a0a  urn result_df...
-000225a0: 4063 6f6e 7465 7874 6d61 6e61 6765 720a  @contextmanager.
-000225b0: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
-000225c0: 0a64 6566 2075 6e70 6163 6b5f 6d73 637a  .def unpack_mscz
-000225d0: 286d 7363 7a2c 2074 6d70 5f64 6972 3d4e  (mscz, tmp_dir=N
-000225e0: 6f6e 6529 3a0a 2020 2020 6966 2074 6d70  one):.    if tmp
-000225f0: 5f64 6972 2069 7320 4e6f 6e65 3a0a 2020  _dir is None:.  
-00022600: 2020 2020 2020 746d 705f 6469 7220 3d20        tmp_dir = 
-00022610: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00022620: 6d73 637a 290a 2020 2020 746d 705f 6669  mscz).    tmp_fi
-00022630: 6c65 203d 2054 656d 7028 7375 6666 6978  le = Temp(suffix
-00022640: 3d27 2e6d 7363 7827 2c20 7072 6566 6978  ='.mscx', prefix
-00022650: 3d27 2e27 2c20 6469 723d 746d 705f 6469  ='.', dir=tmp_di
-00022660: 722c 2064 656c 6574 653d 4661 6c73 6529  r, delete=False)
-00022670: 0a20 2020 2077 6974 6820 5a69 7028 6d73  .    with Zip(ms
-00022680: 637a 2920 6173 207a 6970 5f66 696c 653a  cz) as zip_file:
-00022690: 0a20 2020 2020 2020 206d 7363 785f 6669  .        mscx_fi
-000226a0: 6c65 7320 3d20 5b66 2066 6f72 2066 2069  les = [f for f i
-000226b0: 6e20 7a69 705f 6669 6c65 2e6e 616d 656c  n zip_file.namel
-000226c0: 6973 7428 2920 6966 2066 2e65 6e64 7377  ist() if f.endsw
-000226d0: 6974 6828 272e 6d73 6378 2729 5d0a 2020  ith('.mscx')].  
-000226e0: 2020 2020 2020 6966 206c 656e 286d 7363        if len(msc
-000226f0: 785f 6669 6c65 7329 203e 2031 3a0a 2020  x_files) > 1:.  
-00022700: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00022710: 2e69 6e66 6f28 6622 7b6d 7363 7a7d 2063  .info(f"{mscz} c
-00022720: 6f6e 7461 696e 7320 7365 7665 7261 6c20  ontains several 
-00022730: 4d53 4358 2066 696c 6573 2e20 5069 636b  MSCX files. Pick
-00022740: 696e 6720 7468 6520 6669 7273 7420 6f6e  ing the first on
-00022750: 6522 290a 2020 2020 2020 2020 6d73 6378  e").        mscx
-00022760: 203d 206d 7363 785f 6669 6c65 735b 305d   = mscx_files[0]
-00022770: 0a20 2020 2020 2020 2077 6974 6820 7a69  .        with zi
-00022780: 705f 6669 6c65 2e6f 7065 6e28 6d73 6378  p_file.open(mscx
-00022790: 2920 6173 206d 7363 785f 6669 6c65 3a0a  ) as mscx_file:.
-000227a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-000227b0: 2074 6d70 5f66 696c 6520 6173 2074 6d70   tmp_file as tmp
-000227c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000227d0: 2020 666f 7220 6c69 6e65 2069 6e20 6d73    for line in ms
-000227e0: 6378 5f66 696c 653a 0a20 2020 2020 2020  cx_file:.       
-000227f0: 2020 2020 2020 2020 2020 2020 2074 6d70               tmp
-00022800: 2e77 7269 7465 286c 696e 6529 0a20 2020  .write(line).   
-00022810: 2074 7279 3a0a 2020 2020 2020 2020 7969   try:.        yi
-00022820: 656c 6420 746d 705f 6669 6c65 2e6e 616d  eld tmp_file.nam
-00022830: 650a 2020 2020 6578 6365 7074 2045 7863  e.    except Exc
-00022840: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00022850: 6c6f 6767 6572 2e65 7272 6f72 2866 2245  logger.error(f"E
-00022860: 7272 6f72 2077 6869 6c65 2064 6561 6c69  rror while deali
-00022870: 6e67 2077 6974 6820 7468 6520 7465 6d70  ng with the temp
-00022880: 6f72 6172 696c 7920 756e 7061 636b 6564  orarily unpacked
-00022890: 207b 6f73 2e70 6174 682e 6261 7365 6e61   {os.path.basena
-000228a0: 6d65 286d 7363 7a29 7d22 290a 2020 2020  me(mscz)}").    
-000228b0: 2020 2020 7261 6973 650a 2020 2020 6669      raise.    fi
-000228c0: 6e61 6c6c 793a 0a20 2020 2020 2020 206f  nally:.        o
-000228d0: 732e 7265 6d6f 7665 2874 6d70 5f66 696c  s.remove(tmp_fil
-000228e0: 652e 6e61 6d65 290a 0a40 636f 6e74 6578  e.name)..@contex
-000228f0: 746d 616e 6167 6572 0a40 6675 6e63 7469  tmanager.@functi
-00022900: 6f6e 5f6c 6f67 6765 720a 6465 6620 6361  on_logger.def ca
-00022910: 7074 7572 655f 7061 7273 655f 6c6f 6773  pture_parse_logs
-00022920: 286c 6f67 6765 725f 6f62 6a65 6374 3a20  (logger_object: 
-00022930: 6c6f 6767 696e 672e 4c6f 6767 6572 2c0a  logging.Logger,.
-00022940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022950: 2020 2020 2020 206c 6576 656c 3a20 556e         level: Un
-00022960: 696f 6e5b 7374 722c 2069 6e74 5d20 3d20  ion[str, int] = 
-00022970: 2777 2729 202d 3e20 4c6f 6743 6170 7475  'w') -> LogCaptu
-00022980: 7265 723a 0a20 2020 2022 2222 5769 7468  rer:.    """With
-00022990: 696e 2074 6865 2063 6f6e 7465 7874 2c20  in the context, 
-000229a0: 7468 6520 6769 7665 6e20 6c6f 6767 6572  the given logger
-000229b0: 2077 696c 6c20 6861 7665 2061 6e20 6164   will have an ad
-000229c0: 6469 7469 6f6e 616c 2068 616e 646c 6572  ditional handler
-000229d0: 2074 6861 7420 6361 7074 7572 6573 2061   that captures a
-000229e0: 6c6c 206d 6573 7361 6765 7320 7769 7468  ll messages with
-000229f0: 206c 6576 656c 0a20 2020 2060 606c 6576   level.    ``lev
-00022a00: 656c 6060 206f 7220 6869 6768 6572 2e20  el`` or higher. 
-00022a10: 4174 2074 6865 2065 6e64 206f 6620 7468  At the end of th
-00022a20: 6520 636f 6e74 6578 742c 2072 6574 7269  e context, retri
-00022a30: 6576 6520 7468 6520 6d65 7373 6167 6520  eve the message 
-00022a40: 6c69 7374 2076 6961 204c 6f63 4361 7074  list via LocCapt
-00022a50: 7572 6572 2e63 6f6e 7465 6e74 5f6c 6973  urer.content_lis
-00022a60: 742e 0a0a 2020 2020 4578 616d 706c 653a  t...    Example:
-00022a70: 0a20 2020 2020 2020 202e 2e20 636f 6465  .        .. code
-00022a80: 2d62 6c6f 636b 3a3a 2070 7974 686f 6e0a  -block:: python.
-00022a90: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00022aa0: 6820 6361 7074 7572 655f 7061 7273 655f  h capture_parse_
-00022ab0: 6c6f 6773 286c 6f67 6765 722c 206c 6576  logs(logger, lev
-00022ac0: 656c 3d27 6427 2920 6173 2063 6170 7475  el='d') as captu
-00022ad0: 7265 723a 0a20 2020 2020 2020 2020 2020  rer:.           
-00022ae0: 2020 2020 2023 2064 6f20 7468 6520 7374       # do the st
-00022af0: 7566 6620 6f66 2077 6869 6368 2079 6f75  uff of which you
-00022b00: 2077 616e 7420 746f 2063 6170 7475 7265   want to capture
-00022b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022b20: 2061 6c6c 5f6d 6573 7361 6765 7320 3d20   all_messages = 
-00022b30: 6361 7074 7572 6572 2e63 6f6e 7465 6e74  capturer.content
-00022b40: 5f6c 6973 740a 2020 2020 2222 220a 2020  _list.    """.  
-00022b50: 2020 6361 7074 7572 6564 5f77 6172 6e69    captured_warni
-00022b60: 6e67 7320 3d20 4c6f 6743 6170 7475 7265  ngs = LogCapture
-00022b70: 7228 6c65 7665 6c3d 6c65 7665 6c29 0a20  r(level=level). 
-00022b80: 2020 206c 6f67 6765 725f 6f62 6a65 6374     logger_object
-00022b90: 2e61 6464 4861 6e64 6c65 7228 6361 7074  .addHandler(capt
-00022ba0: 7572 6564 5f77 6172 6e69 6e67 732e 6c6f  ured_warnings.lo
-00022bb0: 675f 6861 6e64 6c65 7229 0a20 2020 2079  g_handler).    y
-00022bc0: 6965 6c64 2063 6170 7475 7265 645f 7761  ield captured_wa
-00022bd0: 726e 696e 6773 0a20 2020 206c 6f67 6765  rnings.    logge
-00022be0: 725f 6f62 6a65 6374 2e72 656d 6f76 6548  r_object.removeH
-00022bf0: 616e 646c 6572 2863 6170 7475 7265 645f  andler(captured_
-00022c00: 7761 726e 696e 6773 2e6c 6f67 5f68 616e  warnings.log_han
-00022c10: 646c 6572 290a 0a0a 0a40 6675 6e63 7469  dler)....@functi
-00022c20: 6f6e 5f6c 6f67 6765 720a 6465 6620 7570  on_logger.def up
-00022c30: 6461 7465 5f6c 6162 656c 735f 6366 6728  date_labels_cfg(
-00022c40: 6c61 6265 6c73 5f63 6667 293a 0a20 2020  labels_cfg):.   
-00022c50: 206b 6579 7320 3d20 5b27 7374 6166 6627   keys = ['staff'
-00022c60: 2c20 2776 6f69 6365 272c 2027 6861 726d  , 'voice', 'harm
-00022c70: 6f6e 795f 6c61 7965 7227 2c20 2770 6f73  ony_layer', 'pos
-00022c80: 6974 696f 6e69 6e67 272c 2027 6465 636f  itioning', 'deco
-00022c90: 6465 272c 2027 636f 6c75 6d6e 5f6e 616d  de', 'column_nam
-00022ca0: 6527 2c20 2763 6f6c 6f72 5f66 6f72 6d61  e', 'color_forma
-00022cb0: 7427 5d0a 2020 2020 6966 2027 6c6f 6767  t'].    if 'logg
-00022cc0: 6572 2720 696e 206c 6162 656c 735f 6366  er' in labels_cf
-00022cd0: 673a 0a20 2020 2020 2020 2064 656c 286c  g:.        del(l
-00022ce0: 6162 656c 735f 6366 675b 276c 6f67 6765  abels_cfg['logge
-00022cf0: 7227 5d29 0a20 2020 2075 7064 6174 6564  r']).    updated
-00022d00: 2c20 696e 636f 7272 6563 7420 3d20 7570  , incorrect = up
-00022d10: 6461 7465 5f63 6667 2863 6667 5f64 6963  date_cfg(cfg_dic
-00022d20: 743d 6c61 6265 6c73 5f63 6667 2c20 6164  t=labels_cfg, ad
-00022d30: 6d69 7474 6564 5f6b 6579 733d 6b65 7973  mitted_keys=keys
-00022d40: 290a 2020 2020 6966 206c 656e 2869 6e63  ).    if len(inc
-00022d50: 6f72 7265 6374 2920 3e20 303a 0a20 2020  orrect) > 0:.   
-00022d60: 2020 2020 206c 6173 745f 3520 3d20 272c       last_5 = ',
-00022d70: 2027 2e6a 6f69 6e28 6622 2d7b 697d 3a20   '.join(f"-{i}: 
-00022d80: 7b73 7461 636b 2829 5b69 5d2e 6675 6e63  {stack()[i].func
-00022d90: 7469 6f6e 7d28 2922 2066 6f72 2069 2069  tion}()" for i i
-00022da0: 6e20 7261 6e67 6528 312c 2036 2929 0a20  n range(1, 6)). 
-00022db0: 2020 2020 2020 2070 6c75 7261 6c20 3d20         plural = 
-00022dc0: 2754 6865 7365 206f 7074 696f 6e73 2061  'These options a
-00022dd0: 7265 2720 6966 206c 656e 2869 6e63 6f72  re' if len(incor
-00022de0: 7265 6374 2920 3e20 3120 656c 7365 2027  rect) > 1 else '
-00022df0: 5468 6973 206f 7074 696f 6e20 6973 270a  This option is'.
-00022e00: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-00022e10: 6172 6e69 6e67 2866 227b 706c 7572 616c  arning(f"{plural
-00022e20: 7d20 6e6f 7420 7661 6c69 6420 746f 2063  } not valid to c
-00022e30: 6f6e 6669 6775 7265 206c 6162 656c 733a  onfigure labels:
-00022e40: 207b 696e 636f 7272 6563 747d 5c6e 4c61   {incorrect}\nLa
-00022e50: 7374 2035 2066 756e 6374 696f 6e20 6361  st 5 function ca
-00022e60: 6c6c 7320 6c65 6164 696e 6720 6865 7265  lls leading here
-00022e70: 3a20 7b6c 6173 745f 357d 2229 0a20 2020  : {last_5}").   
-00022e80: 2072 6574 7572 6e20 7570 6461 7465 640a   return updated.
-00022e90: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
-00022ea0: 6572 0a64 6566 2077 7269 7465 5f6d 6574  er.def write_met
-00022eb0: 6164 6174 6128 6d65 7461 6461 7461 5f64  adata(metadata_d
-00022ec0: 663a 2070 642e 4461 7461 4672 616d 652c  f: pd.DataFrame,
-00022ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022ee0: 2020 2020 7061 7468 3a20 7374 722c 0a20      path: str,. 
-00022ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f00: 2020 696e 6465 783d 4661 6c73 6529 202d    index=False) -
-00022f10: 3e20 626f 6f6c 3a0a 2020 2020 2222 220a  > bool:.    """.
-00022f20: 2020 2020 5772 6974 6520 7468 6520 4461      Write the Da
-00022f30: 7461 4672 616d 6520 6060 6d65 7461 6461  taFrame ``metada
-00022f40: 7461 5f64 6660 6020 746f 2060 6070 6174  ta_df`` to ``pat
-00022f50: 6860 602c 2075 7064 6174 696e 6720 616e  h``, updating an
-00022f60: 2065 7869 7374 696e 6720 6669 6c65 2072   existing file r
-00022f70: 6174 6865 7220 7468 616e 206f 7665 7277  ather than overw
-00022f80: 7269 7469 6e67 2069 742e 0a0a 2020 2020  riting it...    
-00022f90: 4172 6773 3a0a 2020 2020 2020 6d65 7461  Args:.      meta
-00022fa0: 6461 7461 5f64 663a 0a20 2020 2020 2020  data_df:.       
-00022fb0: 2020 2044 6174 6146 7261 6d65 2077 6974     DataFrame wit
-00022fc0: 6820 6f6e 6520 726f 7720 7065 7220 7069  h one row per pi
-00022fd0: 6563 6520 616e 6420 616e 2069 6e64 6578  ece and an index
-00022fe0: 206f 6620 7374 7269 6e67 7320 6964 656e   of strings iden
-00022ff0: 7469 6679 696e 6720 7069 6563 6573 2e20  tifying pieces. 
-00023000: 5468 6520 696e 6465 7820 6973 2075 7365  The index is use
-00023010: 6420 666f 720a 2020 2020 2020 2020 2020  d for.          
-00023020: 7570 6461 7469 6e67 2061 2070 6f74 656e  updating a poten
-00023030: 7469 616c 6c79 2070 7265 2d65 7869 7374  tially pre-exist
-00023040: 656e 7420 6669 6c65 2c20 6672 6f6d 2077  ent file, from w
-00023050: 6869 6368 2074 6865 2066 6972 7374 2063  hich the first c
-00023060: 6f6c 756d 6e20 e288 8820 2827 666e 616d  olumn ... ('fnam
-00023070: 6527 2c20 2766 6e61 6d65 7327 2c20 276e  e', 'fnames', 'n
-00023080: 616d 6527 2c20 276e 616d 6573 2729 0a20  ame', 'names'). 
-00023090: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
-000230a0: 2075 7365 6420 6173 2069 6e64 6578 2e0a   used as index..
-000230b0: 2020 2020 2020 7061 7468 3a0a 2020 2020        path:.    
-000230c0: 2020 2020 2020 4966 2066 6f6c 6465 7220        If folder 
-000230d0: 7061 7468 2c20 7468 6520 6669 6c65 6e61  path, the filena
-000230e0: 6d65 2027 6d65 7461 6461 7461 2e74 7376  me 'metadata.tsv
-000230f0: 2720 7769 6c6c 2062 6520 6170 7065 6e64  ' will be append
-00023100: 6564 3b20 6669 6c65 5f70 6174 6820 7769  ed; file_path wi
-00023110: 6c6c 2062 6520 7573 6564 2061 7320 6973  ll be used as is
-00023120: 2062 7574 2061 0a20 2020 2020 2020 2020   but a.         
-00023130: 2077 6172 6e69 6e67 2069 7320 7468 726f   warning is thro
-00023140: 776e 2069 6620 7468 6520 6578 7465 6e73  wn if the extens
-00023150: 696f 6e20 6973 206e 6f74 202e 7473 760a  ion is not .tsv.
-00023160: 2020 2020 2020 696e 6465 783a 2050 6173        index: Pas
-00023170: 7320 5472 7565 2069 6620 796f 7520 7761  s True if you wa
-00023180: 6e74 2074 6865 2066 6972 7374 2063 6f6c  nt the first col
-00023190: 756d 6e20 6f66 2074 6865 206f 7574 7075  umn of the outpu
-000231a0: 7420 746f 2062 6520 6120 5261 6e67 6549  t to be a RangeI
-000231b0: 6e64 6578 2073 7461 7274 696e 6720 6672  ndex starting fr
-000231c0: 6f6d 2030 2e0a 0a20 2020 2052 6574 7572  om 0...    Retur
-000231d0: 6e73 3a0a 2020 2020 2020 5472 7565 2069  ns:.      True i
-000231e0: 6620 7468 6520 6d65 7461 6461 7461 2077  f the metadata w
-000231f0: 6572 6520 7375 6363 6573 7366 756c 6c79  ere successfully
-00023200: 2077 7269 7474 656e 2c20 4661 6c73 6520   written, False 
-00023210: 6f74 6865 7277 6973 652e 0a20 2020 2022  otherwise..    "
-00023220: 2222 0a20 2020 206d 6574 6164 6174 615f  "".    metadata_
-00023230: 6466 203d 206d 6574 6164 6174 615f 6466  df = metadata_df
-00023240: 2e61 7374 7970 6528 2773 7472 696e 6727  .astype('string'
-00023250: 290a 2020 2020 6d65 7461 6461 7461 5f64  ).    metadata_d
-00023260: 6620 3d20 656e 666f 7263 655f 666e 616d  f = enforce_fnam
-00023270: 655f 696e 6465 785f 666f 725f 6d65 7461  e_index_for_meta
-00023280: 6461 7461 286d 6574 6164 6174 615f 6466  data(metadata_df
-00023290: 290a 2020 2020 7061 7468 203d 2072 6573  ).    path = res
-000232a0: 6f6c 7665 5f64 6972 2870 6174 6829 0a20  olve_dir(path). 
-000232b0: 2020 2069 6620 6f73 2e70 6174 682e 6973     if os.path.is
-000232c0: 6469 7228 7061 7468 293a 0a20 2020 2020  dir(path):.     
-000232d0: 2020 2074 7376 5f70 6174 6820 3d20 6f73     tsv_path = os
-000232e0: 2e70 6174 682e 6a6f 696e 2870 6174 682c  .path.join(path,
-000232f0: 2027 6d65 7461 6461 7461 2e74 7376 2729   'metadata.tsv')
-00023300: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00023310: 2020 2074 7376 5f70 6174 6820 3d20 7061     tsv_path = pa
-00023320: 7468 0a20 2020 205f 2c20 6665 7874 203d  th.    _, fext =
-00023330: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-00023340: 7428 7473 765f 7061 7468 290a 2020 2020  t(tsv_path).    
-00023350: 6966 2066 6578 7420 213d 2027 2e74 7376  if fext != '.tsv
-00023360: 273a 0a20 2020 2020 2020 206c 6f67 6765  ':.        logge
-00023370: 722e 7761 726e 696e 6728 6622 5468 6520  r.warning(f"The 
-00023380: 6f75 7470 7574 2066 6f72 6d61 7420 666f  output format fo
-00023390: 7220 6d65 7461 6461 7461 2069 7320 5461  r metadata is Ta
-000233a0: 622d 5365 7061 7261 7465 6420 5661 6c75  b-Separated Valu
-000233b0: 6573 2028 2e74 7376 2920 6275 7420 7468  es (.tsv) but th
-000233c0: 6520 6669 6c65 2065 7874 656e 7369 6f6e  e file extension
-000233d0: 7320 6973 207b 6665 7874 7d2e 2229 0a20  s is {fext}."). 
-000233e0: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
-000233f0: 682e 6973 6669 6c65 2874 7376 5f70 6174  h.isfile(tsv_pat
-00023400: 6829 3a0a 2020 2020 2020 2020 6f75 7470  h):.        outp
-00023410: 7574 5f64 6620 3d20 6d65 7461 6461 7461  ut_df = metadata
-00023420: 5f64 660a 2020 2020 2020 2020 6d73 6720  _df.        msg 
-00023430: 3d20 2743 7265 6174 6564 270a 2020 2020  = 'Created'.    
-00023440: 656c 7365 3a0a 2020 2020 2020 2020 2320  else:.        # 
-00023450: 5472 7969 6e67 2074 6f20 6c6f 6164 2061  Trying to load a
-00023460: 6e20 6578 6973 7469 6e67 2027 6d65 7461  n existing 'meta
-00023470: 6461 7461 2e74 7376 2720 6669 6c65 2074  data.tsv' file t
-00023480: 6f20 7570 6461 7465 2065 7869 7374 696e  o update existin
-00023490: 6720 726f 7773 0a20 2020 2020 2020 2070  g rows.        p
-000234a0: 7265 7669 6f75 7320 3d20 7064 2e72 6561  revious = pd.rea
-000234b0: 645f 6373 7628 7473 765f 7061 7468 2c20  d_csv(tsv_path, 
-000234c0: 7365 703d 275c 7427 2c20 6474 7970 653d  sep='\t', dtype=
-000234d0: 2773 7472 696e 6727 290a 2020 2020 2020  'string').      
-000234e0: 2020 7072 6576 696f 7573 203d 2065 6e66    previous = enf
-000234f0: 6f72 6365 5f66 6e61 6d65 5f69 6e64 6578  orce_fname_index
-00023500: 5f66 6f72 5f6d 6574 6164 6174 6128 7072  _for_metadata(pr
-00023510: 6576 696f 7573 290a 2020 2020 2020 2020  evious).        
-00023520: 666f 7220 6978 2c20 7768 6174 2069 6e20  for ix, what in 
-00023530: 7a69 7028 2870 7265 7669 6f75 732e 696e  zip((previous.in
-00023540: 6465 782c 2070 7265 7669 6f75 732e 636f  dex, previous.co
-00023550: 6c75 6d6e 732c 206d 6574 6164 6174 615f  lumns, metadata_
-00023560: 6466 2e69 6e64 6578 2c20 6d65 7461 6461  df.index, metada
-00023570: 7461 5f64 662e 636f 6c75 6d6e 7329 2c0a  ta_df.columns),.
-00023580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023590: 2020 2020 2020 2020 2020 2020 2827 696e              ('in
-000235a0: 6465 7820 6f66 2074 6865 2065 7869 7374  dex of the exist
-000235b0: 696e 6727 2c20 2763 6f6c 756d 6e73 206f  ing', 'columns o
-000235c0: 6620 7468 6520 6578 6973 7469 6e67 272c  f the existing',
-000235d0: 2027 696e 6465 7820 6f66 2074 6865 2075   'index of the u
-000235e0: 7064 6174 6564 272c 2027 636f 6c75 6d6e  pdated', 'column
-000235f0: 7320 6f66 2074 6865 2075 7064 6174 6564  s of the updated
-00023600: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
-00023610: 2069 6620 6e6f 7420 6978 2e69 735f 756e   if not ix.is_un
-00023620: 6971 7565 3a0a 2020 2020 2020 2020 2020  ique:.          
-00023630: 2020 2020 2020 6475 706c 6963 6174 6564        duplicated
-00023640: 203d 2069 785b 6978 2e64 7570 6c69 6361   = ix[ix.duplica
-00023650: 7465 6428 295d 2e74 6f5f 6c69 7374 2829  ted()].to_list()
-00023660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023670: 206c 6f67 6765 722e 6572 726f 7228 6622   logger.error(f"
-00023680: 5468 6520 7b77 6861 747d 206d 6574 6164  The {what} metad
-00023690: 6174 6120 636f 6e74 6169 6e73 2064 7570  ata contains dup
-000236a0: 6c69 6361 7465 7320 616e 6420 6e6f 206d  licates and no m
-000236b0: 6574 6164 6174 6120 7765 7265 2077 7269  etadata were wri
-000236c0: 7474 656e 2e5c 6e44 7570 6c69 6361 7465  tten.\nDuplicate
-000236d0: 733a 207b 6475 706c 6963 6174 6564 7d22  s: {duplicated}"
-000236e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000236f0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-00023700: 2020 2020 2020 206e 6577 5f63 6f6c 7320         new_cols 
-00023710: 3d20 6d65 7461 6461 7461 5f64 662e 636f  = metadata_df.co
-00023720: 6c75 6d6e 732e 6469 6666 6572 656e 6365  lumns.difference
-00023730: 2870 7265 7669 6f75 732e 636f 6c75 6d6e  (previous.column
-00023740: 7329 0a20 2020 2020 2020 2073 6861 7265  s).        share
-00023750: 645f 636f 6c73 203d 206d 6574 6164 6174  d_cols = metadat
-00023760: 615f 6466 2e63 6f6c 756d 6e73 2e69 6e74  a_df.columns.int
-00023770: 6572 7365 6374 696f 6e28 7072 6576 696f  ersection(previo
-00023780: 7573 2e63 6f6c 756d 6e73 290a 2020 2020  us.columns).    
-00023790: 2020 2020 6e65 775f 726f 7773 203d 206d      new_rows = m
-000237a0: 6574 6164 6174 615f 6466 2e69 6e64 6578  etadata_df.index
-000237b0: 2e64 6966 6665 7265 6e63 6528 7072 6576  .difference(prev
-000237c0: 696f 7573 2e69 6e64 6578 290a 2020 2020  ious.index).    
-000237d0: 2020 2020 7072 6576 696f 7573 203d 2070      previous = p
-000237e0: 642e 636f 6e63 6174 285b 7072 6576 696f  d.concat([previo
-000237f0: 7573 2c20 6d65 7461 6461 7461 5f64 662e  us, metadata_df.
-00023800: 6c6f 635b 6e65 775f 726f 7773 2c20 7368  loc[new_rows, sh
-00023810: 6172 6564 5f63 6f6c 735d 5d29 0a20 2020  ared_cols]]).   
-00023820: 2020 2020 2070 7265 7669 6f75 7320 3d20       previous = 
-00023830: 7064 2e63 6f6e 6361 7428 5b70 7265 7669  pd.concat([previ
-00023840: 6f75 732c 206d 6574 6164 6174 615f 6466  ous, metadata_df
-00023850: 5b6e 6577 5f63 6f6c 735d 5d2c 2061 7869  [new_cols]], axi
-00023860: 733d 3129 0a20 2020 2020 2020 2070 7265  s=1).        pre
-00023870: 7669 6f75 732e 7570 6461 7465 286d 6574  vious.update(met
-00023880: 6164 6174 615f 6466 290a 2020 2020 2020  adata_df).      
-00023890: 2020 6c65 6761 6379 5f63 6f6c 756d 6e73    legacy_columns
-000238a0: 203d 205b 6320 666f 7220 6320 696e 204c   = [c for c in L
-000238b0: 4547 4143 595f 434f 4c55 4d4e 5320 6966  EGACY_COLUMNS if
-000238c0: 2063 2069 6e20 7072 6576 696f 7573 2e63   c in previous.c
-000238d0: 6f6c 756d 6e73 5d0a 2020 2020 2020 2020  olumns].        
-000238e0: 6966 206c 656e 286c 6567 6163 795f 636f  if len(legacy_co
-000238f0: 6c75 6d6e 7329 203e 2030 3a0a 2020 2020  lumns) > 0:.    
-00023900: 2020 2020 2020 2020 706c 7572 616c 203d          plural =
-00023910: 2066 2773 207b 6c65 6761 6379 5f63 6f6c   f's {legacy_col
-00023920: 756d 6e73 7d27 2069 6620 6c65 6e28 6c65  umns}' if len(le
-00023930: 6761 6379 5f63 6f6c 756d 6e73 2920 3e20  gacy_columns) > 
-00023940: 3120 656c 7365 2066 2720 7b6c 6567 6163  1 else f' {legac
-00023950: 795f 636f 6c75 6d6e 735b 305d 7d27 0a20  y_columns[0]}'. 
-00023960: 2020 2020 2020 2020 2020 2070 7265 7669             previ
-00023970: 6f75 7320 3d20 7072 6576 696f 7573 2e64  ous = previous.d
-00023980: 726f 7028 636f 6c75 6d6e 733d 6c65 6761  rop(columns=lega
-00023990: 6379 5f63 6f6c 756d 6e73 290a 2020 2020  cy_columns).    
-000239a0: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-000239b0: 6e66 6f28 6622 4472 6f70 7065 6420 6c65  nfo(f"Dropped le
-000239c0: 6761 6379 2063 6f6c 756d 6e7b 706c 7572  gacy column{plur
-000239d0: 616c 7d20 2e22 290a 2020 2020 2020 2020  al} .").        
-000239e0: 6f75 7470 7574 5f64 6620 3d20 7072 6576  output_df = prev
-000239f0: 696f 7573 2e72 6573 6574 5f69 6e64 6578  ious.reset_index
-00023a00: 2829 0a20 2020 2020 2020 206d 7367 203d  ().        msg =
-00023a10: 2027 5570 6461 7465 6427 0a20 2020 206f   'Updated'.    o
-00023a20: 7574 7075 745f 6466 203d 2070 7265 7061  utput_df = prepa
-00023a30: 7265 5f6d 6574 6164 6174 615f 666f 725f  re_metadata_for_
-00023a40: 7772 6974 696e 6728 6f75 7470 7574 5f64  writing(output_d
-00023a50: 6629 0a20 2020 206f 7574 7075 745f 6466  f).    output_df
-00023a60: 2e74 6f5f 6373 7628 7473 765f 7061 7468  .to_csv(tsv_path
-00023a70: 2c20 7365 703d 275c 7427 2c20 696e 6465  , sep='\t', inde
-00023a80: 783d 696e 6465 7829 0a20 2020 206c 6f67  x=index).    log
-00023a90: 6765 722e 696e 666f 2866 227b 6d73 677d  ger.info(f"{msg}
-00023aa0: 207b 7473 765f 7061 7468 7d22 290a 2020   {tsv_path}").  
-00023ab0: 2020 7265 7475 726e 2054 7275 650a 0a40    return True..@
-00023ac0: 6675 6e63 7469 6f6e 5f6c 6f67 6765 720a  function_logger.
-00023ad0: 6465 6620 656e 666f 7263 655f 666e 616d  def enforce_fnam
-00023ae0: 655f 696e 6465 785f 666f 725f 6d65 7461  e_index_for_meta
-00023af0: 6461 7461 286d 6574 6164 6174 615f 6466  data(metadata_df
-00023b00: 3a20 7064 2e44 6174 6146 7261 6d65 2c20  : pd.DataFrame, 
-00023b10: 6170 7065 6e64 3d46 616c 7365 2920 2d3e  append=False) ->
-00023b20: 2070 642e 4461 7461 4672 616d 653a 0a20   pd.DataFrame:. 
-00023b30: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-00023b40: 636f 7079 206f 6620 7468 6520 4461 7461  copy of the Data
-00023b50: 4672 616d 6520 7468 6174 2068 6173 2061  Frame that has a
-00023b60: 6e20 696e 6465 7820 6c65 7665 6c20 6361  n index level ca
-00023b70: 6c6c 6564 2027 666e 616d 6527 2e22 2222  lled 'fname'."""
-00023b80: 0a20 2020 2070 6f73 7369 626c 655f 636f  .    possible_co
-00023b90: 6c75 6d6e 5f6e 616d 6573 203d 2028 2766  lumn_names = ('f
-00023ba0: 6e61 6d65 272c 2027 666e 616d 6573 272c  name', 'fnames',
-00023bb0: 2027 6669 6c65 6e61 6d65 272c 2027 6e61   'filename', 'na
-00023bc0: 6d65 272c 2027 6e61 6d65 7327 2c29 0a20  me', 'names',). 
-00023bd0: 2020 2069 6620 616e 7928 6e61 6d65 2069     if any(name i
-00023be0: 6e20 6d65 7461 6461 7461 5f64 662e 696e  n metadata_df.in
-00023bf0: 6465 782e 6e61 6d65 7320 666f 7220 6e61  dex.names for na
-00023c00: 6d65 2069 6e20 706f 7373 6962 6c65 5f63  me in possible_c
-00023c10: 6f6c 756d 6e5f 6e61 6d65 7329 3a0a 2020  olumn_names):.  
-00023c20: 2020 2020 2020 7265 7475 726e 206d 6574        return met
-00023c30: 6164 6174 615f 6466 0a20 2020 2074 7279  adata_df.    try
-00023c40: 3a0a 2020 2020 2020 2020 666e 616d 655f  :.        fname_
-00023c50: 636f 6c20 3d20 6e65 7874 2863 6f6c 2066  col = next(col f
-00023c60: 6f72 2063 6f6c 2069 6e20 706f 7373 6962  or col in possib
-00023c70: 6c65 5f63 6f6c 756d 6e5f 6e61 6d65 7320  le_column_names 
-00023c80: 6966 2063 6f6c 2069 6e20 6d65 7461 6461  if col in metada
-00023c90: 7461 5f64 662e 636f 6c75 6d6e 7329 0a20  ta_df.columns). 
-00023ca0: 2020 2065 7863 6570 7420 5374 6f70 4974     except StopIt
-00023cb0: 6572 6174 696f 6e3a 0a20 2020 2020 2020  eration:.       
-00023cc0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00023cd0: 7228 6622 4d65 7461 6461 7461 2069 7320  r(f"Metadata is 
-00023ce0: 6578 7065 6374 6564 2074 6f20 636f 6d65  expected to come
-00023cf0: 2077 6974 6820 6120 636f 6c75 6d6e 206f   with a column o
-00023d00: 7220 696e 6465 7820 6c65 7665 6c20 6361  r index level ca
-00023d10: 6c6c 6564 2027 666e 616d 6527 206f 7220  lled 'fname' or 
-00023d20: 2870 7265 7669 6f75 736c 7929 2027 666e  (previously) 'fn
-00023d30: 616d 6573 272e 2229 0a20 2020 2069 6620  ames'.").    if 
-00023d40: 666e 616d 655f 636f 6c20 213d 2027 666e  fname_col != 'fn
-00023d50: 616d 6527 3a0a 2020 2020 2020 2020 6d65  ame':.        me
-00023d60: 7461 6461 7461 5f64 6620 3d20 6d65 7461  tadata_df = meta
-00023d70: 6461 7461 5f64 662e 7265 6e61 6d65 2863  data_df.rename(c
-00023d80: 6f6c 756d 6e73 3d7b 666e 616d 655f 636f  olumns={fname_co
-00023d90: 6c3a 2027 666e 616d 6527 7d29 0a20 2020  l: 'fname'}).   
-00023da0: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-00023db0: 2866 2252 656e 616d 6564 2063 6f6c 756d  (f"Renamed colum
-00023dc0: 6e20 277b 666e 616d 655f 636f 6c7d 2720  n '{fname_col}' 
-00023dd0: 2d3e 2027 666e 616d 6527 2229 0a20 2020  -> 'fname'").   
-00023de0: 2072 6574 7572 6e20 6d65 7461 6461 7461   return metadata
-00023df0: 5f64 662e 7365 745f 696e 6465 7828 2766  _df.set_index('f
-00023e00: 6e61 6d65 272c 2061 7070 656e 643d 6170  name', append=ap
-00023e10: 7065 6e64 290a 0a0a 4066 756e 6374 696f  pend)...@functio
-00023e20: 6e5f 6c6f 6767 6572 0a64 6566 2077 7269  n_logger.def wri
-00023e30: 7465 5f6d 6172 6b64 6f77 6e28 6d65 7461  te_markdown(meta
-00023e40: 6461 7461 5f64 663a 2070 642e 4461 7461  data_df: pd.Data
-00023e50: 4672 616d 652c 2066 696c 655f 7061 7468  Frame, file_path
-00023e60: 3a20 7374 7229 202d 3e20 4e6f 6e65 3a0a  : str) -> None:.
-00023e70: 2020 2020 2222 220a 2020 2020 5772 6974      """.    Writ
-00023e80: 6520 6120 7375 6273 6574 206f 6620 7468  e a subset of th
-00023e90: 6520 4461 7461 4672 616d 6520 6060 6d65  e DataFrame ``me
-00023ea0: 7461 6461 7461 5f64 6660 6020 746f 2060  tadata_df`` to `
-00023eb0: 6070 6174 6860 6020 696e 206d 6172 6b64  `path`` in markd
-00023ec0: 6f77 6e20 666f 726d 6174 2e20 4966 2074  own format. If t
-00023ed0: 6865 2066 696c 6520 6578 6973 7473 2c20  he file exists, 
-00023ee0: 6974 2077 696c 6c20 6265 0a20 2020 2073  it will be.    s
-00023ef0: 6361 6e6e 6564 2066 6f72 2061 206c 696e  canned for a lin
-00023f00: 6520 636f 6e74 6169 6e69 6e67 2074 6865  e containing the
-00023f10: 2073 7472 696e 6720 2723 204f 7665 7276   string '# Overv
-00023f20: 6965 7727 2061 6e64 206f 7665 7277 7269  iew' and overwri
-00023f30: 7474 656e 2066 726f 6d20 7468 6174 206c  tten from that l
-00023f40: 696e 6520 6f6e 7761 7264 732e 0a0a 2020  ine onwards...  
-00023f50: 2020 4172 6773 3a0a 2020 2020 2020 6d65    Args:.      me
-00023f60: 7461 6461 7461 5f64 663a 2044 6174 6146  tadata_df: DataF
-00023f70: 7261 6d65 2063 6f6e 7461 696e 696e 6720  rame containing 
-00023f80: 6d65 7461 6461 7461 2e0a 2020 2020 2020  metadata..      
-00023f90: 6669 6c65 5f70 6174 683a 2050 6174 6820  file_path: Path 
-00023fa0: 6f66 2074 6865 206d 6172 6b64 6f77 6e20  of the markdown 
-00023fb0: 6669 6c65 2e0a 2020 2020 2222 220a 2020  file..    """.  
-00023fc0: 2020 7265 6e61 6d65 346d 6172 6b64 6f77    rename4markdow
-00023fd0: 6e20 3d20 7b0a 2020 2020 2020 2020 2766  n = {.        'f
-00023fe0: 6e61 6d65 273a 2027 6669 6c65 5f6e 616d  name': 'file_nam
-00023ff0: 6527 2c0a 2020 2020 2020 2020 276c 6173  e',.        'las
-00024000: 745f 6d6e 273a 2027 6d65 6173 7572 6573  t_mn': 'measures
-00024010: 272c 0a20 2020 2020 2020 2027 6c61 6265  ',.        'labe
-00024020: 6c5f 636f 756e 7427 3a20 276c 6162 656c  l_count': 'label
-00024030: 7327 2c0a 2020 2020 2020 2020 2768 6172  s',.        'har
-00024040: 6d6f 6e79 5f76 6572 7369 6f6e 273a 2027  mony_version': '
-00024050: 7374 616e 6461 7264 272c 0a20 2020 2020  standard',.     
-00024060: 2020 2027 616e 6e6f 7461 746f 7273 273a     'annotators':
-00024070: 2027 616e 6e6f 7461 746f 7273 272c 0a20   'annotators',. 
-00024080: 2020 2020 2020 2027 7265 7669 6577 6572         'reviewer
-00024090: 7327 3a20 2772 6576 6965 7765 7273 272c  s': 'reviewers',
-000240a0: 0a20 2020 207d 0a20 2020 2072 656e 616d  .    }.    renam
-000240b0: 6534 6d61 726b 646f 776e 203d 207b 6b3a  e4markdown = {k:
-000240c0: 2076 2066 6f72 206b 2c20 7620 696e 2072   v for k, v in r
-000240d0: 656e 616d 6534 6d61 726b 646f 776e 2e69  ename4markdown.i
-000240e0: 7465 6d73 2829 2069 6620 6b20 696e 206d  tems() if k in m
-000240f0: 6574 6164 6174 615f 6466 2e63 6f6c 756d  etadata_df.colum
-00024100: 6e73 7d0a 2020 2020 6472 6f70 5f69 6e64  ns}.    drop_ind
-00024110: 6578 203d 2027 666e 616d 6573 2720 696e  ex = 'fnames' in
-00024120: 206d 6574 6164 6174 615f 6466 2e63 6f6c   metadata_df.col
-00024130: 756d 6e73 0a20 2020 206d 6420 3d20 6d65  umns.    md = me
-00024140: 7461 6461 7461 5f64 662e 7265 7365 745f  tadata_df.reset_
-00024150: 696e 6465 7828 6472 6f70 3d64 726f 705f  index(drop=drop_
-00024160: 696e 6465 7829 5b6c 6973 7428 7265 6e61  index)[list(rena
-00024170: 6d65 346d 6172 6b64 6f77 6e2e 6b65 7973  me4markdown.keys
-00024180: 2829 295d 2e66 696c 6c6e 6128 2727 290a  ())].fillna('').
-00024190: 2020 2020 6d64 203d 206d 642e 7265 6e61      md = md.rena
-000241a0: 6d65 2863 6f6c 756d 6e73 3d72 656e 616d  me(columns=renam
-000241b0: 6534 6d61 726b 646f 776e 290a 2020 2020  e4markdown).    
-000241c0: 6d64 5f74 6162 6c65 203d 2073 7472 2864  md_table = str(d
-000241d0: 6632 6d64 286d 6429 290a 2020 2020 6d64  f2md(md)).    md
-000241e0: 5f74 6162 6c65 202b 3d20 6622 5c6e 5c6e  _table += f"\n\n
-000241f0: 2a4f 7665 7276 6965 7720 7461 626c 6520  *Overview table 
-00024200: 7570 6461 7465 6420 7573 696e 6720 5b6d  updated using [m
-00024210: 7333 5d28 6874 7470 733a 2f2f 6a6f 6865  s3](https://johe
-00024220: 6e74 7363 682e 6769 7468 7562 2e69 6f2f  ntsch.github.io/
-00024230: 6d73 332f 2920 7b4d 5333 5f56 4552 5349  ms3/) {MS3_VERSI
-00024240: 4f4e 7d2e 2a5c 6e22 0a0a 2020 2020 6966  ON}.*\n"..    if
-00024250: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
-00024260: 6669 6c65 5f70 6174 6829 3a0a 2020 2020  file_path):.    
-00024270: 2020 2020 6d73 6720 3d20 2755 7064 6174      msg = 'Updat
-00024280: 6564 270a 2020 2020 2020 2020 7769 7468  ed'.        with
-00024290: 206f 7065 6e28 6669 6c65 5f70 6174 682c   open(file_path,
-000242a0: 2027 7227 2c20 656e 636f 6469 6e67 3d27   'r', encoding='
-000242b0: 7574 662d 3827 2920 6173 2066 3a0a 2020  utf-8') as f:.  
-000242c0: 2020 2020 2020 2020 2020 6c69 6e65 7320            lines 
-000242d0: 3d20 662e 7265 6164 6c69 6e65 7328 290a  = f.readlines().
-000242e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000242f0: 2020 6d73 6720 3d20 2743 7265 6174 6564    msg = 'Created
-00024300: 270a 2020 2020 2020 2020 6c69 6e65 7320  '.        lines 
-00024310: 3d20 5b5d 0a20 2020 2023 2069 6e20 6361  = [].    # in ca
-00024320: 7365 2074 6865 2052 4541 444d 452e 6d64  se the README.md
-00024330: 2065 7869 7374 732c 2065 7665 7279 7468   exists, everyth
-00024340: 696e 6720 6672 6f6d 2074 6865 206c 696e  ing from the lin
-00024350: 6520 696e 636c 7564 696e 6720 2723 204f  e including '# O
-00024360: 7665 7276 6965 7727 2028 6f72 206c 6173  verview' (or las
-00024370: 7420 6c69 6e65 206f 7468 6572 7769 7365  t line otherwise
-00024380: 2920 6973 206f 7665 7277 7269 7474 656e  ) is overwritten
-00024390: 0a20 2020 2077 6974 6820 6f70 656e 2866  .    with open(f
-000243a0: 696c 655f 7061 7468 2c20 2777 272c 2065  ile_path, 'w', e
-000243b0: 6e63 6f64 696e 673d 2775 7466 2d38 2729  ncoding='utf-8')
-000243c0: 2061 7320 663a 0a20 2020 2020 2020 2066   as f:.        f
-000243d0: 6f72 206c 696e 6520 696e 206c 696e 6573  or line in lines
-000243e0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000243f0: 2027 2320 4f76 6572 7669 6577 2720 696e   '# Overview' in
-00024400: 206c 696e 653a 0a20 2020 2020 2020 2020   line:.         
-00024410: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-00024420: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
-00024430: 286c 696e 6529 0a20 2020 2020 2020 2065  (line).        e
-00024440: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00024450: 2066 2e77 7269 7465 2827 5c6e 5c6e 2729   f.write('\n\n')
-00024460: 0a20 2020 2020 2020 2066 2e77 7269 7465  .        f.write
-00024470: 286d 645f 7461 626c 6529 0a20 2020 206c  (md_table).    l
-00024480: 6f67 6765 722e 696e 666f 2866 227b 6d73  ogger.info(f"{ms
-00024490: 677d 207b 6669 6c65 5f70 6174 687d 2229  g} {file_path}")
-000244a0: 0a0a 0a64 6566 2070 7265 7061 7265 5f6d  ...def prepare_m
-000244b0: 6574 6164 6174 615f 666f 725f 7772 6974  etadata_for_writ
-000244c0: 696e 6728 6d65 7461 6461 7461 5f64 6629  ing(metadata_df)
-000244d0: 3a0a 2020 2020 2320 636f 6e76 6572 745f  :.    # convert_
-000244e0: 746f 5f73 7472 203d 207b 633a 2027 7374  to_str = {c: 'st
-000244f0: 7269 6e67 2720 666f 7220 6320 696e 2028  ring' for c in (
-00024500: 276c 656e 6774 685f 7162 272c 2027 6c65  'length_qb', 'le
-00024510: 6e67 7468 5f71 625f 756e 666f 6c64 6564  ngth_qb_unfolded
-00024520: 272c 2027 616c 6c5f 6e6f 7465 735f 7162  ', 'all_notes_qb
-00024530: 2729 2069 6620 6320 696e 206d 6574 6164  ') if c in metad
-00024540: 6174 615f 6466 7d0a 2020 2020 2320 6966  ata_df}.    # if
-00024550: 206c 656e 2863 6f6e 7665 7274 5f74 6f5f   len(convert_to_
-00024560: 7374 7229 203e 2030 3a0a 2020 2020 2320  str) > 0:.    # 
-00024570: 2020 2020 6d65 7461 6461 7461 5f64 6620      metadata_df 
-00024580: 3d20 6d65 7461 6461 7461 5f64 662e 6173  = metadata_df.as
-00024590: 7479 7065 2863 6f6e 7665 7274 5f74 6f5f  type(convert_to_
-000245a0: 7374 722c 2065 7272 6f72 733d 2769 676e  str, errors='ign
-000245b0: 6f72 6527 290a 2020 2020 6d65 7461 6461  ore').    metada
-000245c0: 7461 5f64 6620 3d20 6d65 7461 6461 7461  ta_df = metadata
-000245d0: 5f64 662e 6173 7479 7065 2827 7374 7269  _df.astype('stri
-000245e0: 6e67 272c 2065 7272 6f72 733d 2769 676e  ng', errors='ign
-000245f0: 6f72 6527 290a 2020 2020 6d65 7461 6461  ore').    metada
-00024600: 7461 5f64 662e 736f 7274 5f69 6e64 6578  ta_df.sort_index
-00024610: 2869 6e70 6c61 6365 3d54 7275 6529 0a20  (inplace=True). 
-00024620: 2020 206d 6574 6164 6174 615f 6466 203d     metadata_df =
-00024630: 2063 6f6c 756d 6e5f 6f72 6465 7228 6d65   column_order(me
-00024640: 7461 6461 7461 5f64 662c 204d 4554 4144  tadata_df, METAD
-00024650: 4154 415f 434f 4c55 4d4e 5f4f 5244 4552  ATA_COLUMN_ORDER
-00024660: 2c20 736f 7274 3d46 616c 7365 290a 2020  , sort=False).  
-00024670: 2020 2320 6f6e 2057 696e 646f 7773 2c20    # on Windows, 
-00024680: 6d61 6b65 2073 7572 6520 7468 6520 7061  make sure the pa
-00024690: 7468 7320 6172 6520 7772 6974 7465 6e20  ths are written 
-000246a0: 7769 7468 202f 2073 6570 6172 6174 6f72  with / separator
-000246b0: 730a 2020 2020 7061 7468 5f63 6f6c 7320  s.    path_cols 
-000246c0: 3d20 5b63 6f6c 2066 6f72 2063 6f6c 2069  = [col for col i
-000246d0: 6e20 2827 7375 6264 6972 272c 2027 7265  n ('subdir', 're
-000246e0: 6c5f 7061 7468 2729 2069 6620 636f 6c20  l_path') if col 
-000246f0: 696e 206d 6574 6164 6174 615f 6466 2e63  in metadata_df.c
-00024700: 6f6c 756d 6e73 5d0a 2020 2020 666f 7220  olumns].    for 
-00024710: 636f 6c20 696e 2070 6174 685f 636f 6c73  col in path_cols
-00024720: 3a0a 2020 2020 2020 2020 7769 7468 2077  :.        with w
-00024730: 6172 6e69 6e67 732e 6361 7463 685f 7761  arnings.catch_wa
-00024740: 726e 696e 6773 2829 3a0a 2020 2020 2020  rnings():.      
-00024750: 2020 2020 2020 2320 5365 7474 696e 6720        # Setting 
-00024760: 7661 6c75 6573 2069 6e2d 706c 6163 6520  values in-place 
-00024770: 6973 2066 696e 652c 2069 676e 6f72 6520  is fine, ignore 
-00024780: 7468 6520 7761 726e 696e 6720 696e 2050  the warning in P
-00024790: 616e 6461 7320 3e3d 2031 2e35 2e30 0a20  andas >= 1.5.0. 
-000247a0: 2020 2020 2020 2020 2020 2023 2054 6869             # Thi
-000247b0: 7320 6361 6e20 6265 2072 656d 6f76 6564  s can be removed
-000247c0: 2c20 6966 2050 616e 6461 7320 312e 352e  , if Pandas 1.5.
-000247d0: 3020 646f 6573 206e 6f74 206e 6565 6420  0 does not need 
-000247e0: 746f 2062 6520 7375 7070 6f72 7465 6420  to be supported 
-000247f0: 616e 7920 6c6f 6e67 6572 2e0a 2020 2020  any longer..    
-00024800: 2020 2020 2020 2020 2320 5365 6520 616c          # See al
-00024810: 736f 3a20 6874 7470 733a 2f2f 7374 6163  so: https://stac
-00024820: 6b6f 7665 7266 6c6f 772e 636f 6d2f 712f  koverflow.com/q/
-00024830: 3734 3035 3733 3637 2f38 3539 3539 310a  74057367/859591.
-00024840: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-00024850: 696e 6773 2e66 696c 7465 7277 6172 6e69  ings.filterwarni
-00024860: 6e67 7328 0a20 2020 2020 2020 2020 2020  ngs(.           
-00024870: 2020 2020 2022 6967 6e6f 7265 222c 0a20       "ignore",. 
-00024880: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00024890: 6174 6567 6f72 793d 4675 7475 7265 5761  ategory=FutureWa
-000248a0: 726e 696e 672c 0a20 2020 2020 2020 2020  rning,.         
-000248b0: 2020 2020 2020 206d 6573 7361 6765 3d28         message=(
-000248c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000248d0: 2020 2020 2022 2e2a 7769 6c6c 2061 7474       ".*will att
-000248e0: 656d 7074 2074 6f20 7365 7420 7468 6520  empt to set the 
-000248f0: 7661 6c75 6573 2069 6e70 6c61 6365 2069  values inplace i
-00024900: 6e73 7465 6164 206f 6620 616c 7761 7973  nstead of always
-00024910: 2073 6574 7469 6e67 2061 206e 6577 2061   setting a new a
-00024920: 7272 6179 2e20 220a 2020 2020 2020 2020  rray. ".        
-00024930: 2020 2020 2020 2020 2020 2020 2254 6f20              "To 
-00024940: 7265 7461 696e 2074 6865 206f 6c64 2062  retain the old b
-00024950: 6568 6176 696f 722c 2075 7365 2065 6974  ehavior, use eit
-00024960: 6865 722e 2a22 0a20 2020 2020 2020 2020  her.*".         
-00024970: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00024980: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00024990: 2020 2020 6d65 7461 6461 7461 5f64 662e      metadata_df.
-000249a0: 6c6f 635b 3a2c 2063 6f6c 5d20 3d20 6d65  loc[:, col] = me
-000249b0: 7461 6461 7461 5f64 665b 636f 6c5d 2e73  tadata_df[col].s
-000249c0: 7472 2e72 6570 6c61 6365 286f 732e 7365  tr.replace(os.se
-000249d0: 702c 2027 2f27 290a 2020 2020 7374 6166  p, '/').    staf
-000249e0: 665f 636f 6c73 2c20 6f74 6865 725f 636f  f_cols, other_co
-000249f0: 6c73 203d 205b 5d2c 205b 5d0a 2020 2020  ls = [], [].    
-00024a00: 666f 7220 636f 6c20 696e 206d 6574 6164  for col in metad
-00024a10: 6174 615f 6466 2e63 6f6c 756d 6e73 3a0a  ata_df.columns:.
-00024a20: 2020 2020 2020 2020 6966 2072 652e 6d61          if re.ma
-00024a30: 7463 6828 7222 5e73 7461 6666 5f28 5c64  tch(r"^staff_(\d
-00024a40: 2b29 222c 2063 6f6c 293a 0a20 2020 2020  +)", col):.     
-00024a50: 2020 2020 2020 2073 7461 6666 5f63 6f6c         staff_col
-00024a60: 732e 6170 7065 6e64 2863 6f6c 290a 2020  s.append(col).  
-00024a70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00024a80: 2020 2020 2020 2020 6f74 6865 725f 636f          other_co
-00024a90: 6c73 2e61 7070 656e 6428 636f 6c29 0a20  ls.append(col). 
-00024aa0: 2020 2073 7461 6666 5f63 6f6c 7320 3d20     staff_cols = 
-00024ab0: 736f 7274 6564 2873 7461 6666 5f63 6f6c  sorted(staff_col
-00024ac0: 732c 206b 6579 3d6c 616d 6264 6120 733a  s, key=lambda s:
-00024ad0: 2069 6e74 2872 652e 6d61 7463 6828 7222   int(re.match(r"
-00024ae0: 5e73 7461 6666 5f28 5c64 2b29 222c 2073  ^staff_(\d+)", s
-00024af0: 295b 315d 2929 0a20 2020 206d 6574 6164  )[1])).    metad
-00024b00: 6174 615f 6466 203d 206d 6574 6164 6174  ata_df = metadat
-00024b10: 615f 6466 5b6f 7468 6572 5f63 6f6c 7320  a_df[other_cols 
-00024b20: 2b20 7374 6166 665f 636f 6c73 5d0a 2020  + staff_cols].  
-00024b30: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00024b40: 6e63 6528 6d65 7461 6461 7461 5f64 662e  nce(metadata_df.
-00024b50: 696e 6465 782c 2070 642e 5261 6e67 6549  index, pd.RangeI
-00024b60: 6e64 6578 293a 0a20 2020 2020 2020 206d  ndex):.        m
-00024b70: 6574 6164 6174 615f 6466 203d 206d 6574  etadata_df = met
-00024b80: 6164 6174 615f 6466 2e72 6573 6574 5f69  adata_df.reset_i
-00024b90: 6e64 6578 2829 0a20 2020 2072 6574 7572  ndex().    retur
-00024ba0: 6e20 6d65 7461 6461 7461 5f64 660a 0a0a  n metadata_df...
-00024bb0: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
-00024bc0: 0a64 6566 2077 7269 7465 5f74 7376 2864  .def write_tsv(d
-00024bd0: 662c 2066 696c 655f 7061 7468 2c20 7072  f, file_path, pr
-00024be0: 655f 7072 6f63 6573 733d 5472 7565 2c20  e_process=True, 
-00024bf0: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-00024c00: 2222 2057 7269 7465 2061 2044 6174 6146  "" Write a DataF
-00024c10: 7261 6d65 2074 6f20 6120 5453 5620 6f72  rame to a TSV or
-00024c20: 2043 5356 2066 696c 6520 6261 7365 6420   CSV file based 
-00024c30: 6f6e 2074 6865 2065 7874 656e 7369 6f6e  on the extension
-00024c40: 206f 6620 2766 696c 655f 7061 7468 272e   of 'file_path'.
-00024c50: 0a20 2020 2055 7365 733a 203a 7079 3a66  .    Uses: :py:f
-00024c60: 756e 633a 606e 6f5f 636f 6c6c 6563 7469  unc:`no_collecti
-00024c70: 6f6e 735f 6e6f 5f62 6f6f 6c65 616e 7360  ons_no_booleans`
-00024c80: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-00024c90: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-00024ca0: 2020 2020 6466 203a 203a 6f62 6a3a 6070      df : :obj:`p
-00024cb0: 616e 6461 732e 4461 7461 4672 616d 6560  andas.DataFrame`
-00024cc0: 0a20 2020 2020 2020 2044 6174 6146 7261  .        DataFra
-00024cd0: 6d65 2074 6f20 7772 6974 652e 0a20 2020  me to write..   
-00024ce0: 2066 696c 655f 7061 7468 203a 203a 6f62   file_path : :ob
-00024cf0: 6a3a 6073 7472 600a 2020 2020 2020 2020  j:`str`.        
-00024d00: 4669 6c65 2074 6f20 6372 6561 7465 206f  File to create o
-00024d10: 7220 6f76 6572 7772 6974 652e 2049 6620  r overwrite. If 
-00024d20: 7468 6520 6578 7465 6e73 696f 6e20 6973  the extension is
-00024d30: 202e 7473 762c 2074 6865 2061 7267 756d   .tsv, the argum
-00024d40: 656e 7420 2773 6570 2720 7769 6c6c 2062  ent 'sep' will b
-00024d50: 6520 7365 7420 746f 2027 5c74 272c 206f  e set to '\t', o
-00024d60: 7468 6572 7769 7365 2074 6865 0a20 2020  therwise the.   
-00024d70: 2020 2020 2065 7874 656e 7369 6f6e 2069       extension i
-00024d80: 7320 6578 7065 6374 6564 2074 6f20 6265  s expected to be
-00024d90: 202e 6373 7620 616e 6420 7468 6520 6465   .csv and the de
-00024da0: 6661 756c 7420 7365 7061 7261 746f 7220  fault separator 
-00024db0: 272c 2720 7769 6c6c 2062 6520 7573 6564  ',' will be used
-00024dc0: 2e0a 2020 2020 7072 655f 7072 6f63 6573  ..    pre_proces
-00024dd0: 7320 3a20 3a6f 626a 3a60 626f 6f6c 602c  s : :obj:`bool`,
-00024de0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00024df0: 2020 4279 2064 6566 6175 6c74 2c20 4461    By default, Da
-00024e00: 7461 4672 616d 6520 6365 6c6c 7320 636f  taFrame cells co
-00024e10: 6e74 6169 6e69 6e67 206c 6973 7473 2061  ntaining lists a
-00024e20: 6e64 2074 7570 6c65 7320 7769 6c6c 2062  nd tuples will b
-00024e30: 6520 7472 616e 7366 6f72 6d65 6420 746f  e transformed to
-00024e40: 2073 7472 696e 6773 2061 6e64 2042 6f6f   strings and Boo
-00024e50: 6c65 616e 7320 7769 6c6c 2062 650a 2020  leans will be.  
-00024e60: 2020 2020 2020 636f 6e76 6572 7465 6420        converted 
-00024e70: 746f 2030 2061 6e64 2031 2028 6f74 6865  to 0 and 1 (othe
-00024e80: 7277 6973 6520 7468 6579 2077 696c 6c20  rwise they will 
-00024e90: 6265 2077 7269 7474 656e 206f 7574 2061  be written out a
-00024ea0: 7320 5472 7565 2061 6e64 2046 616c 7365  s True and False
-00024eb0: 292e 2050 6173 7320 4661 6c73 6520 746f  ). Pass False to
-00024ec0: 2070 7265 7665 6e74 2e0a 2020 2020 6b77   prevent..    kw
-00024ed0: 6172 6773 203a 0a20 2020 2020 2020 2041  args :.        A
-00024ee0: 6464 6974 696f 6e61 6c20 6b65 7977 6f72  dditional keywor
-00024ef0: 6420 6172 6775 6d65 6e74 7320 7769 6c6c  d arguments will
-00024f00: 2062 6520 7061 7373 6564 206f 6e20 746f   be passed on to
-00024f10: 203a 7079 3a6d 6574 683a 6070 616e 6461   :py:meth:`panda
-00024f20: 732e 4461 7461 4672 616d 652e 746f 5f63  s.DataFrame.to_c
-00024f30: 7376 602e 0a20 2020 2020 2020 2044 6566  sv`..        Def
-00024f40: 6175 6c74 7320 6172 6775 6d65 6e74 7320  aults arguments 
-00024f50: 6172 6520 6060 696e 6465 783d 4661 6c73  are ``index=Fals
-00024f60: 6560 6020 616e 6420 6060 7365 703d 275c  e`` and ``sep='\
-00024f70: 7427 6060 2028 6173 7375 6d69 6e67 2065  t'`` (assuming e
-00024f80: 7874 656e 7369 6f6e 2027 2e74 7376 272c  xtension '.tsv',
-00024f90: 2073 6565 2061 626f 7665 292e 0a0a 2020   see above)...  
-00024fa0: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
-00024fb0: 2d2d 2d2d 2d0a 2020 2020 4e6f 6e65 0a20  -----.    None. 
-00024fc0: 2020 2022 2222 0a20 2020 2070 6174 682c     """.    path,
-00024fd0: 2066 696c 6520 3d20 6f73 2e70 6174 682e   file = os.path.
-00024fe0: 7370 6c69 7428 6669 6c65 5f70 6174 6829  split(file_path)
-00024ff0: 0a20 2020 2070 6174 6820 3d20 7265 736f  .    path = reso
-00025000: 6c76 655f 6469 7228 7061 7468 290a 2020  lve_dir(path).  
-00025010: 2020 6f73 2e70 6174 682e 6a6f 696e 2870    os.path.join(p
-00025020: 6174 682c 2066 696c 6529 0a20 2020 2066  ath, file).    f
-00025030: 6e61 6d65 2c20 6578 7420 3d20 6f73 2e70  name, ext = os.p
-00025040: 6174 682e 7370 6c69 7465 7874 2866 696c  ath.splitext(fil
-00025050: 6529 0a20 2020 2069 6620 6578 742e 6c6f  e).    if ext.lo
-00025060: 7765 7228 2920 6e6f 7420 696e 2028 272e  wer() not in ('.
-00025070: 7473 7627 2c20 272e 6373 7627 293a 0a20  tsv', '.csv'):. 
-00025080: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
-00025090: 726f 7228 6622 5468 6973 2066 756e 6374  ror(f"This funct
-000250a0: 696f 6e20 6578 7065 6374 7320 6669 6c65  ion expects file
-000250b0: 5f70 6174 6820 746f 2069 6e63 6c75 6465  _path to include
-000250c0: 2074 6865 2066 696c 6520 6e61 6d65 2065   the file name e
-000250d0: 6e64 696e 6720 6f6e 202e 6373 7620 6f72  nding on .csv or
-000250e0: 202e 7473 762c 206e 6f74 2027 7b65 7874   .tsv, not '{ext
-000250f0: 7d27 2e22 290a 2020 2020 2020 2020 7265  }'.").        re
-00025100: 7475 726e 0a20 2020 206f 732e 6d61 6b65  turn.    os.make
-00025110: 6469 7273 2870 6174 682c 2065 7869 7374  dirs(path, exist
-00025120: 5f6f 6b3d 5472 7565 290a 2020 2020 6966  _ok=True).    if
-00025130: 2065 7874 2e6c 6f77 6572 2829 203d 3d20   ext.lower() == 
-00025140: 272e 7473 7627 3a0a 2020 2020 2020 2020  '.tsv':.        
-00025150: 6b77 6172 6773 2e75 7064 6174 6528 6469  kwargs.update(di
-00025160: 6374 2873 6570 3d27 5c74 2729 290a 2020  ct(sep='\t')).  
-00025170: 2020 6966 2027 696e 6465 7827 206e 6f74    if 'index' not
-00025180: 2069 6e20 6b77 6172 6773 3a0a 2020 2020   in kwargs:.    
-00025190: 2020 2020 6b77 6172 6773 5b27 696e 6465      kwargs['inde
-000251a0: 7827 5d20 3d20 4661 6c73 650a 2020 2020  x'] = False.    
-000251b0: 6966 2070 7265 5f70 726f 6365 7373 3a0a  if pre_process:.
-000251c0: 2020 2020 2020 2020 6466 203d 206e 6f5f          df = no_
-000251d0: 636f 6c6c 6563 7469 6f6e 735f 6e6f 5f62  collections_no_b
-000251e0: 6f6f 6c65 616e 7328 6466 2c20 6c6f 6767  ooleans(df, logg
-000251f0: 6572 3d6c 6f67 6765 7229 0a20 2020 2064  er=logger).    d
-00025200: 662e 746f 5f63 7376 2866 696c 655f 7061  f.to_csv(file_pa
-00025210: 7468 2c20 2a2a 6b77 6172 6773 290a 2020  th, **kwargs).  
-00025220: 2020 6c6f 6767 6572 2e64 6562 7567 2866    logger.debug(f
-00025230: 227b 6669 6c65 5f70 6174 687d 2077 7269  "{file_path} wri
-00025240: 7474 656e 2077 6974 6820 7061 7261 6d65  tten with parame
-00025250: 7465 7273 207b 6b77 6172 6773 7d2e 2229  ters {kwargs}.")
-00025260: 0a20 2020 2072 6574 7572 6e0a 0a0a 4066  .    return...@f
-00025270: 756e 6374 696f 6e5f 6c6f 6767 6572 0a64  unction_logger.d
-00025280: 6566 2061 6273 3272 656c 5f6b 6579 2861  ef abs2rel_key(a
-00025290: 6273 6f6c 7574 653a 2073 7472 2c0a 2020  bsolute: str,.  
-000252a0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-000252b0: 6361 6c6b 6579 3a20 7374 722c 0a20 2020  calkey: str,.   
-000252c0: 2020 2020 2020 2020 2020 2020 2067 6c6f               glo
-000252d0: 6261 6c5f 6d69 6e6f 723a 2062 6f6f 6c20  bal_minor: bool 
-000252e0: 3d20 4661 6c73 6529 202d 3e20 7374 723a  = False) -> str:
-000252f0: 0a20 2020 2022 2222 0a20 2020 2045 7870  .    """.    Exp
-00025300: 7265 7373 6573 2061 2052 6f6d 616e 206e  resses a Roman n
-00025310: 756d 6572 616c 2061 7320 7363 616c 6520  umeral as scale 
-00025320: 6465 6772 6565 2072 656c 6174 6976 6520  degree relative 
-00025330: 746f 2061 2067 6976 656e 206c 6f63 616c  to a given local
-00025340: 6b65 792e 0a20 2020 2054 6865 2072 6573  key..    The res
-00025350: 756c 7420 6368 616e 6765 7320 6465 7065  ult changes depe
-00025360: 6e64 696e 6720 6f6e 2077 6865 7468 6572  nding on whether
-00025370: 2052 6f6d 616e 206e 756d 6572 616c 2061   Roman numeral a
-00025380: 6e64 206c 6f63 616c 6b65 7920 6172 650a  nd localkey are.
-00025390: 2020 2020 696e 7465 7270 7265 7465 6420      interpreted 
-000253a0: 7769 7468 696e 2061 2067 6c6f 6261 6c20  within a global 
-000253b0: 6d61 6a6f 7220 6f72 206d 696e 6f72 206b  major or minor k
-000253c0: 6579 2e0a 0a20 2020 2055 7365 733a 203a  ey...    Uses: :
-000253d0: 7079 3a66 756e 633a 6073 706c 6974 5f73  py:func:`split_s
-000253e0: 6361 6c65 5f64 6567 7265 6560 0a0a 0a20  cale_degree`... 
-000253f0: 2020 2041 7267 733a 0a20 2020 2020 2061     Args:.      a
-00025400: 6273 6f6c 7574 653a 2041 6273 6f6c 7574  bsolute: Absolut
-00025410: 6520 6b65 7920 6578 7072 6573 7365 6420  e key expressed 
-00025420: 6173 2052 6f6d 616e 2073 6361 6c65 2064  as Roman scale d
-00025430: 6567 7265 6520 6f66 2074 6865 206c 6f63  egree of the loc
-00025440: 616c 206b 6579 2e0a 2020 2020 2020 6c6f  al key..      lo
-00025450: 6361 6c6b 6579 3a20 5468 6520 6c6f 6361  calkey: The loca
-00025460: 6c20 6b65 7920 696e 2074 6572 6d73 206f  l key in terms o
-00025470: 6620 7768 6963 6820 6060 6162 736f 6c75  f which ``absolu
-00025480: 7465 6060 2077 696c 6c20 6265 2065 7870  te`` will be exp
-00025490: 7265 7373 6564 2e0a 2020 2020 2020 676c  ressed..      gl
-000254a0: 6f62 616c 5f6d 696e 6f72 3a20 4861 7320  obal_minor: Has 
-000254b0: 746f 2062 6520 7365 7420 746f 2054 7275  to be set to Tru
-000254c0: 6520 6966 2060 6162 736f 6c75 7465 6020  e if `absolute` 
-000254d0: 616e 6420 606c 6f63 616c 6b65 7960 2061  and `localkey` a
-000254e0: 7265 2073 6361 6c65 2064 6567 7265 6573  re scale degrees
-000254f0: 206f 6620 6120 676c 6f62 616c 206d 696e   of a global min
-00025500: 6f72 206b 6579 2e0a 0a20 2020 2045 7861  or key...    Exa
-00025510: 6d70 6c65 733a 0a20 2020 2020 2049 6e20  mples:.      In 
-00025520: 6120 6d69 6e6f 7220 636f 6e74 6578 742c  a minor context,
-00025530: 2074 6865 206b 6579 206f 6620 4949 2077   the key of II w
-00025540: 6f75 6c64 2061 7070 6561 7220 7769 7468  ould appear with
-00025550: 696e 2074 6865 206b 6579 206f 6620 7669  in the key of vi
-00025560: 6920 6173 2023 4949 492e 0a0a 2020 2020  i as #III...    
-00025570: 2020 2020 2020 3e3e 3e20 6162 7332 7265        >>> abs2re
-00025580: 6c5f 6b65 7928 2769 7627 2c20 2756 4927  l_key('iv', 'VI'
-00025590: 2c20 676c 6f62 616c 5f6d 696e 6f72 3d46  , global_minor=F
-000255a0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-000255b0: 2762 7669 2720 2020 2020 2020 2320 4620  'bvi'       # F 
-000255c0: 6d69 6e6f 7220 6578 7072 6573 7365 6420  minor expressed 
-000255d0: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
-000255e0: 4120 6d61 6a6f 720a 2020 2020 2020 2020  A major.        
-000255f0: 2020 3e3e 3e20 6162 7332 7265 6c5f 6b65    >>> abs2rel_ke
-00025600: 7928 2769 7627 2c20 2776 6927 2c20 676c  y('iv', 'vi', gl
-00025610: 6f62 616c 5f6d 696e 6f72 3d46 616c 7365  obal_minor=False
-00025620: 290a 2020 2020 2020 2020 2020 2776 6927  ).          'vi'
-00025630: 2020 2020 2020 2320 4620 6d69 6e6f 7220        # F minor 
-00025640: 6578 7072 6573 7365 6420 7769 7468 2072  expressed with r
-00025650: 6573 7065 6374 2074 6f20 4120 6d69 6e6f  espect to A mino
-00025660: 720a 2020 2020 2020 2020 2020 3e3e 3e20  r.          >>> 
-00025670: 6162 7332 7265 6c5f 6b65 7928 2769 7627  abs2rel_key('iv'
-00025680: 2c20 2756 4927 2c20 676c 6f62 616c 5f6d  , 'VI', global_m
-00025690: 696e 6f72 3d54 7275 6529 0a20 2020 2020  inor=True).     
-000256a0: 2020 2020 2027 7669 2720 2020 2020 2023       'vi'      #
-000256b0: 2046 206d 696e 6f72 2065 7870 7265 7373   F minor express
-000256c0: 6564 2077 6974 6820 7265 7370 6563 7420  ed with respect 
-000256d0: 746f 2041 6220 6d61 6a6f 720a 2020 2020  to Ab major.    
-000256e0: 2020 2020 2020 3e3e 3e20 6162 7332 7265        >>> abs2re
-000256f0: 6c5f 6b65 7928 2769 7627 2c20 2776 6927  l_key('iv', 'vi'
-00025700: 2c20 676c 6f62 616c 5f6d 696e 6f72 3d54  , global_minor=T
-00025710: 7275 6529 0a20 2020 2020 2020 2020 2027  rue).          '
-00025720: 2376 6927 2020 2020 2020 2023 2046 206d  #vi'       # F m
-00025730: 696e 6f72 2065 7870 7265 7373 6564 2077  inor expressed w
-00025740: 6974 6820 7265 7370 6563 7420 746f 2041  ith respect to A
-00025750: 6220 6d69 6e6f 720a 0a20 2020 2020 2020  b minor..       
-00025760: 2020 203e 3e3e 2061 6273 3272 656c 5f6b     >>> abs2rel_k
-00025770: 6579 2827 5649 272c 2027 4956 272c 2067  ey('VI', 'IV', g
-00025780: 6c6f 6261 6c5f 6d69 6e6f 723d 4661 6c73  lobal_minor=Fals
-00025790: 6529 0a20 2020 2020 2020 2020 2027 4949  e).          'II
-000257a0: 4927 2020 2020 2020 2023 2041 206d 616a  I'       # A maj
-000257b0: 6f72 2065 7870 7265 7373 6564 2077 6974  or expressed wit
-000257c0: 6820 7265 7370 6563 7420 746f 2046 206d  h respect to F m
-000257d0: 616a 6f72 0a20 2020 2020 2020 2020 203e  ajor.          >
-000257e0: 3e3e 2061 6273 3272 656c 5f6b 6579 2827  >> abs2rel_key('
-000257f0: 5649 272c 2027 6976 272c 2067 6c6f 6261  VI', 'iv', globa
-00025800: 6c5f 6d69 6e6f 723d 4661 6c73 6529 0a20  l_minor=False). 
-00025810: 2020 2020 2020 2020 2027 2349 4949 2720           '#III' 
-00025820: 2020 2020 2020 2320 4120 6d61 6a6f 7220        # A major 
-00025830: 6578 7072 6573 7365 6420 7769 7468 2072  expressed with r
-00025840: 6573 7065 6374 2074 6f20 4620 6d69 6e6f  espect to F mino
-00025850: 720a 2020 2020 2020 2020 2020 3e3e 3e20  r.          >>> 
-00025860: 6162 7332 7265 6c5f 6b65 7928 2756 4927  abs2rel_key('VI'
-00025870: 2c20 2749 5627 2c20 676c 6f62 616c 5f6d  , 'IV', global_m
-00025880: 696e 6f72 3d54 7275 6529 0a20 2020 2020  inor=True).     
-00025890: 2020 2020 2027 6249 4949 2720 2020 2020       'bIII'     
-000258a0: 2020 2320 4162 206d 616a 6f72 2065 7870    # Ab major exp
-000258b0: 7265 7373 6564 2077 6974 6820 7265 7370  ressed with resp
-000258c0: 6563 7420 746f 2046 206d 616a 6f72 0a20  ect to F major. 
-000258d0: 2020 2020 2020 2020 203e 3e3e 2061 6273           >>> abs
-000258e0: 3272 656c 5f6b 6579 2827 5649 272c 2027  2rel_key('VI', '
-000258f0: 6976 272c 2067 6c6f 6261 6c5f 6d69 6e6f  iv', global_mino
-00025900: 723d 4661 6c73 6529 0a20 2020 2020 2020  r=False).       
-00025910: 2020 2027 4949 4927 2020 2020 2020 2023     'III'       #
-00025920: 2041 6220 6d61 6a6f 7220 6578 7072 6573   Ab major expres
-00025930: 7365 6420 7769 7468 2072 6573 7065 6374  sed with respect
-00025940: 2074 6f20 4620 6d69 6e6f 720a 2020 2020   to F minor.    
-00025950: 2222 220a 2020 2020 6966 2070 642e 6973  """.    if pd.is
-00025960: 6e75 6c6c 2861 6273 6f6c 7574 6529 206f  null(absolute) o
-00025970: 7220 7064 2e69 736e 756c 6c28 6c6f 6361  r pd.isnull(loca
-00025980: 6c6b 6579 293a 0a20 2020 2020 2020 2072  lkey):.        r
-00025990: 6574 7572 6e20 6162 736f 6c75 7465 0a20  eturn absolute. 
-000259a0: 2020 2061 6273 6f6c 7574 6520 3d20 7265     absolute = re
-000259b0: 736f 6c76 655f 7265 6c61 7469 7665 5f6b  solve_relative_k
-000259c0: 6579 7328 6162 736f 6c75 7465 290a 2020  eys(absolute).  
-000259d0: 2020 6c6f 6361 6c6b 6579 203d 2072 6573    localkey = res
-000259e0: 6f6c 7665 5f72 656c 6174 6976 655f 6b65  olve_relative_ke
-000259f0: 7973 286c 6f63 616c 6b65 7929 0a20 2020  ys(localkey).   
-00025a00: 206d 616a 5f72 6e20 3d20 5b27 4927 2c20   maj_rn = ['I', 
-00025a10: 2749 4927 2c20 2749 4949 272c 2027 4956  'II', 'III', 'IV
-00025a20: 272c 2027 5627 2c20 2756 4927 2c20 2756  ', 'V', 'VI', 'V
-00025a30: 4949 275d 0a20 2020 206d 696e 5f72 6e20  II'].    min_rn 
-00025a40: 3d20 5b27 6927 2c20 2769 6927 2c20 2769  = ['i', 'ii', 'i
-00025a50: 6969 272c 2027 6976 272c 2027 7627 2c20  ii', 'iv', 'v', 
-00025a60: 2776 6927 2c20 2776 6969 275d 0a20 2020  'vi', 'vii'].   
-00025a70: 2077 6869 7465 5f6b 6579 5f6d 616a 6f72   white_key_major
-00025a80: 5f61 6363 6964 656e 7461 6c73 203d 206e  _accidentals = n
-00025a90: 702e 6172 7261 7928 5b5b 302c 2030 2c20  p.array([[0, 0, 
-00025aa0: 302c 2030 2c20 302c 2030 2c20 305d 2c0a  0, 0, 0, 0, 0],.
-00025ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ad0: 2020 2020 2020 2020 2020 2020 5b30 2c20              [0, 
-00025ae0: 302c 2031 2c20 302c 2030 2c20 302c 2031  0, 1, 0, 0, 0, 1
-00025af0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00025b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b10: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00025b20: 302c 2031 2c20 312c 2030 2c20 302c 2031  0, 1, 1, 0, 0, 1
-00025b30: 2c20 315d 2c0a 2020 2020 2020 2020 2020  , 1],.          
-00025b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b60: 2020 5b30 2c20 302c 2030 2c20 2d31 2c20    [0, 0, 0, -1, 
-00025b70: 302c 2030 2c20 305d 2c0a 2020 2020 2020  0, 0, 0],.      
-00025b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ba0: 2020 2020 2020 5b30 2c20 302c 2030 2c20        [0, 0, 0, 
-00025bb0: 302c 2030 2c20 302c 2031 5d2c 0a20 2020  0, 0, 0, 1],.   
-00025bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025be0: 2020 2020 2020 2020 205b 302c 2030 2c20           [0, 0, 
-00025bf0: 312c 2030 2c20 302c 2031 2c20 315d 2c0a  1, 0, 0, 1, 1],.
-00025c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c20: 2020 2020 2020 2020 2020 2020 5b30 2c20              [0, 
-00025c30: 312c 2031 2c20 302c 2031 2c20 312c 2031  1, 1, 0, 1, 1, 1
-00025c40: 5d5d 290a 2020 2020 6162 735f 6163 6369  ]]).    abs_acci
-00025c50: 6465 6e74 616c 732c 2061 6273 6f6c 7574  dentals, absolut
-00025c60: 6520 3d20 7370 6c69 745f 7363 616c 655f  e = split_scale_
-00025c70: 6465 6772 6565 2861 6273 6f6c 7574 652c  degree(absolute,
-00025c80: 2063 6f75 6e74 3d54 7275 652c 206c 6f67   count=True, log
-00025c90: 6765 723d 6c6f 6767 6572 290a 2020 2020  ger=logger).    
-00025ca0: 6c6f 6361 6c6b 6579 5f61 6363 6964 656e  localkey_acciden
-00025cb0: 7461 6c73 2c20 6c6f 6361 6c6b 6579 203d  tals, localkey =
-00025cc0: 2073 706c 6974 5f73 6361 6c65 5f64 6567   split_scale_deg
-00025cd0: 7265 6528 6c6f 6361 6c6b 6579 2c20 636f  ree(localkey, co
-00025ce0: 756e 743d 5472 7565 2c20 6c6f 6767 6572  unt=True, logger
-00025cf0: 3d6c 6f67 6765 7229 0a20 2020 2072 6573  =logger).    res
-00025d00: 756c 7469 6e67 5f61 6363 6964 656e 7461  ulting_accidenta
-00025d10: 6c73 203d 2061 6273 5f61 6363 6964 656e  ls = abs_acciden
-00025d20: 7461 6c73 202d 206c 6f63 616c 6b65 795f  tals - localkey_
-00025d30: 6163 6369 6465 6e74 616c 730a 2020 2020  accidentals.    
-00025d40: 6e75 6d65 7261 6c73 203d 206d 616a 5f72  numerals = maj_r
-00025d50: 6e20 6966 2061 6273 6f6c 7574 652e 6973  n if absolute.is
-00025d60: 7570 7065 7228 2920 656c 7365 206d 696e  upper() else min
-00025d70: 5f72 6e0a 2020 2020 6c6f 6361 6c6b 6579  _rn.    localkey
-00025d80: 5f69 6e64 6578 203d 206d 616a 5f72 6e2e  _index = maj_rn.
-00025d90: 696e 6465 7828 6c6f 6361 6c6b 6579 2e75  index(localkey.u
-00025da0: 7070 6572 2829 290a 2020 2020 7265 7375  pper()).    resu
-00025db0: 6c74 5f69 6e64 6578 203d 2028 6e75 6d65  lt_index = (nume
-00025dc0: 7261 6c73 2e69 6e64 6578 2861 6273 6f6c  rals.index(absol
-00025dd0: 7574 6529 202d 206c 6f63 616c 6b65 795f  ute) - localkey_
-00025de0: 696e 6465 7829 2025 2037 0a20 2020 2072  index) % 7.    r
-00025df0: 6573 756c 745f 6e75 6d65 7261 6c20 3d20  esult_numeral = 
-00025e00: 6e75 6d65 7261 6c73 5b72 6573 756c 745f  numerals[result_
-00025e10: 696e 6465 785d 0a20 2020 2069 6620 6c6f  index].    if lo
-00025e20: 6361 6c6b 6579 2e69 736c 6f77 6572 2829  calkey.islower()
-00025e30: 2061 6e64 2072 6573 756c 745f 696e 6465   and result_inde
-00025e40: 7820 696e 205b 322c 2035 2c20 365d 3a0a  x in [2, 5, 6]:.
-00025e50: 2020 2020 2020 2020 7265 7375 6c74 696e          resultin
-00025e60: 675f 6163 6369 6465 6e74 616c 7320 2b3d  g_accidentals +=
-00025e70: 2031 0a20 2020 2069 6620 676c 6f62 616c   1.    if global
-00025e80: 5f6d 696e 6f72 3a0a 2020 2020 2020 2020  _minor:.        
-00025e90: 6c6f 6361 6c6b 6579 5f69 6e64 6578 203d  localkey_index =
-00025ea0: 2028 6c6f 6361 6c6b 6579 5f69 6e64 6578   (localkey_index
-00025eb0: 202d 2032 2920 2520 370a 2020 2020 7265   - 2) % 7.    re
-00025ec0: 7375 6c74 696e 675f 6163 6369 6465 6e74  sulting_accident
-00025ed0: 616c 7320 2d3d 2077 6869 7465 5f6b 6579  als -= white_key
-00025ee0: 5f6d 616a 6f72 5f61 6363 6964 656e 7461  _major_accidenta
-00025ef0: 6c73 5b6c 6f63 616c 6b65 795f 696e 6465  ls[localkey_inde
-00025f00: 785d 5b72 6573 756c 745f 696e 6465 785d  x][result_index]
-00025f10: 0a20 2020 2061 6363 203d 2072 6573 756c  .    acc = resul
-00025f20: 7469 6e67 5f61 6363 6964 656e 7461 6c73  ting_accidentals
-00025f30: 202a 2027 2327 2069 6620 7265 7375 6c74   * '#' if result
-00025f40: 696e 675f 6163 6369 6465 6e74 616c 7320  ing_accidentals 
-00025f50: 3e20 3020 656c 7365 202d 7265 7375 6c74  > 0 else -result
-00025f60: 696e 675f 6163 6369 6465 6e74 616c 7320  ing_accidentals 
-00025f70: 2a20 2762 270a 2020 2020 7265 7475 726e  * 'b'.    return
-00025f80: 2061 6363 202b 2072 6573 756c 745f 6e75   acc + result_nu
-00025f90: 6d65 7261 6c0a 0a0a 4066 756e 6374 696f  meral...@functio
-00025fa0: 6e5f 6c6f 6767 6572 0a64 6566 2072 656c  n_logger.def rel
-00025fb0: 3261 6273 5f6b 6579 2872 656c 6174 6976  2abs_key(relativ
-00025fc0: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
-00025fd0: 2020 2020 2020 2020 6c6f 6361 6c6b 6579          localkey
-00025fe0: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
-00025ff0: 2020 2020 2020 2067 6c6f 6261 6c5f 6d69         global_mi
-00026000: 6e6f 723a 2062 6f6f 6c20 3d20 4661 6c73  nor: bool = Fals
-00026010: 6529 3a0a 2020 2020 2222 2245 7870 7265  e):.    """Expre
-00026020: 7373 6573 2061 2052 6f6d 616e 206e 756d  sses a Roman num
-00026030: 6572 616c 2074 6861 7420 6973 2065 7870  eral that is exp
-00026040: 7265 7373 6564 2072 656c 6174 6976 6520  ressed relative 
-00026050: 746f 2061 206c 6f63 616c 6b65 790a 2020  to a localkey.  
-00026060: 2020 6173 2073 6361 6c65 2064 6567 7265    as scale degre
-00026070: 6520 6f66 2074 6865 2067 6c6f 6261 6c20  e of the global 
-00026080: 6b65 792e 2046 6f72 206c 6f63 616c 206b  key. For local k
-00026090: 6579 7320 7b49 4949 2c20 6969 692c 2056  eys {III, iii, V
-000260a0: 492c 2076 692c 2056 4949 2c20 7669 697d  I, vi, VII, vii}
-000260b0: 0a20 2020 2074 6865 2072 6573 756c 7420  .    the result 
-000260c0: 6368 616e 6765 7320 6465 7065 6e64 696e  changes dependin
-000260d0: 6720 6f6e 2077 6865 7468 6572 2074 6865  g on whether the
-000260e0: 2067 6c6f 6261 6c20 6b65 7920 6973 206d   global key is m
-000260f0: 616a 6f72 206f 7220 6d69 6e6f 722e 0a0a  ajor or minor...
-00026100: 2020 2020 5573 6573 3a20 3a70 793a 6675      Uses: :py:fu
-00026110: 6e63 3a60 7370 6c69 745f 7363 616c 655f  nc:`split_scale_
-00026120: 6465 6772 6565 600a 0a0a 2020 2020 4172  degree`...    Ar
-00026130: 6773 3a0a 2020 2020 2020 7265 6c61 7469  gs:.      relati
-00026140: 7665 3a20 5265 6c61 7469 7665 206b 6579  ve: Relative key
-00026150: 206f 7220 6368 6f72 6420 6578 7072 6573   or chord expres
-00026160: 7365 6420 6173 2052 6f6d 616e 2073 6361  sed as Roman sca
-00026170: 6c65 2064 6567 7265 6520 6f66 2074 6865  le degree of the
-00026180: 206c 6f63 616c 206b 6579 2e0a 2020 2020   local key..    
-00026190: 2020 6c6f 6361 6c6b 6579 3a20 5468 6520    localkey: The 
-000261a0: 6c6f 6361 6c20 6b65 7920 746f 2077 6869  local key to whi
-000261b0: 6368 2060 7265 6c60 2069 7320 7265 6c61  ch `rel` is rela
-000261c0: 7469 7665 2e0a 2020 2020 2020 676c 6f62  tive..      glob
-000261d0: 616c 5f6d 696e 6f72 3a20 4861 7320 746f  al_minor: Has to
-000261e0: 2062 6520 7365 7420 746f 2054 7275 6520   be set to True 
-000261f0: 6966 2060 6c6f 6361 6c6b 6579 6020 6973  if `localkey` is
-00026200: 2061 2073 6361 6c65 2064 6567 7265 6520   a scale degree 
-00026210: 6f66 2061 2067 6c6f 6261 6c20 6d69 6e6f  of a global mino
-00026220: 7220 6b65 792e 0a0a 2020 2020 4578 616d  r key...    Exam
-00026230: 706c 6573 3a0a 2020 2020 2020 4966 2074  ples:.      If t
-00026240: 6865 206c 6162 656c 2076 6969 6f36 2f56  he label viio6/V
-00026250: 4920 6170 7065 6172 7320 696e 2074 6865  I appears in the
-00026260: 2063 6f6e 7465 7874 206f 6620 7468 6520   context of the 
-00026270: 6c6f 6361 6c20 6b65 7920 5649 206f 7220  local key VI or 
-00026280: 7669 2c0a 2020 2020 2020 7468 6520 6162  vi,.      the ab
-00026290: 736f 6c75 7465 206b 6579 2074 6f20 7768  solute key to wh
-000262a0: 6963 6820 7669 696f 3620 6170 706c 6965  ich viio6 applie
-000262b0: 7320 6465 7065 6e64 7320 6f6e 2074 6865  s depends on the
-000262c0: 2067 6c6f 6261 6c20 6b65 792e 0a20 2020   global key..   
-000262d0: 2020 2054 6865 2063 6f6d 6d65 6e74 7320     The comments 
-000262e0: 6578 7072 6573 7320 7468 6520 6578 616d  express the exam
-000262f0: 706c 6573 2069 6e20 7265 6c61 7469 6f6e  ples in relation
-00026300: 2074 6f20 676c 6f62 616c 2043 206d 616a   to global C maj
-00026310: 6f72 206f 7220 4320 6d69 6e6f 722e 0a0a  or or C minor...
-00026320: 2020 2020 2020 2020 2020 3e3e 3e20 7265            >>> re
-00026330: 6c32 6162 735f 6b65 7928 2776 6927 2c20  l2abs_key('vi', 
-00026340: 2756 4927 2c20 676c 6f62 616c 5f6d 696e  'VI', global_min
-00026350: 6f72 3d46 616c 7365 290a 2020 2020 2020  or=False).      
-00026360: 2020 2020 2723 6976 2720 2020 2020 2020      '#iv'       
-00026370: 2320 7669 206f 6620 4120 6d61 6a6f 7220  # vi of A major 
-00026380: 3d20 4623 206d 696e 6f72 0a20 2020 2020  = F# minor.     
-00026390: 2020 2020 203e 3e3e 2072 656c 3261 6273       >>> rel2abs
-000263a0: 5f6b 6579 2827 7669 272c 2027 7669 272c  _key('vi', 'vi',
-000263b0: 2067 6c6f 6261 6c5f 6d69 6e6f 723d 4661   global_minor=Fa
-000263c0: 6c73 6529 0a20 2020 2020 2020 2020 2027  lse).          '
-000263d0: 6976 2720 2020 2020 2023 2076 6920 6f66  iv'      # vi of
-000263e0: 2041 206d 696e 6f72 203d 2046 206d 696e   A minor = F min
-000263f0: 6f72 0a20 2020 2020 2020 2020 203e 3e3e  or.          >>>
-00026400: 2072 656c 3261 6273 5f6b 6579 2827 7669   rel2abs_key('vi
-00026410: 272c 2027 5649 272c 2067 6c6f 6261 6c5f  ', 'VI', global_
-00026420: 6d69 6e6f 723d 5472 7565 290a 2020 2020  minor=True).    
-00026430: 2020 2020 2020 2769 7627 2020 2020 2020        'iv'      
-00026440: 2320 7669 206f 6620 4162 206d 616a 6f72  # vi of Ab major
-00026450: 203d 2046 206d 696e 6f72 0a20 2020 2020   = F minor.     
-00026460: 2020 2020 203e 3e3e 2072 656c 3261 6273       >>> rel2abs
-00026470: 5f6b 6579 2827 7669 272c 2027 7669 272c  _key('vi', 'vi',
-00026480: 2067 6c6f 6261 6c5f 6d69 6e6f 723d 5472   global_minor=Tr
-00026490: 7565 290a 2020 2020 2020 2020 2020 2762  ue).          'b
-000264a0: 6976 2720 2020 2020 2020 2320 7669 206f  iv'       # vi o
-000264b0: 6620 4162 206d 696e 6f72 203d 2046 6220  f Ab minor = Fb 
-000264c0: 6d69 6e6f 720a 0a20 2020 2020 2054 6865  minor..      The
-000264d0: 2073 616d 6520 6578 616d 706c 6573 2068   same examples h
-000264e0: 6f6c 6420 6966 2079 6f75 2772 6520 6578  old if you're ex
-000264f0: 7072 6573 7369 6e67 2069 6e20 7465 726d  pressing in term
-00026500: 7320 6f66 2074 6865 2067 6c6f 6261 6c20  s of the global 
-00026510: 6b65 790a 2020 2020 2020 7468 6520 726f  key.      the ro
-00026520: 6f74 206f 6620 6120 5649 2d63 686f 7264  ot of a VI-chord
-00026530: 2077 6974 6869 6e20 7468 6520 6c6f 6361   within the loca
-00026540: 6c20 6b65 7973 2056 4920 6f72 2076 692e  l keys VI or vi.
-00026550: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-00026560: 7064 2e69 736e 756c 6c28 7265 6c61 7469  pd.isnull(relati
-00026570: 7665 2920 6f72 2070 642e 6973 6e75 6c6c  ve) or pd.isnull
-00026580: 286c 6f63 616c 6b65 7929 3a0a 2020 2020  (localkey):.    
-00026590: 2020 2020 7265 7475 726e 2072 656c 6174      return relat
-000265a0: 6976 650a 2020 2020 7265 6c61 7469 7665  ive.    relative
-000265b0: 203d 2072 6573 6f6c 7665 5f72 656c 6174   = resolve_relat
-000265c0: 6976 655f 6b65 7973 2872 656c 6174 6976  ive_keys(relativ
-000265d0: 6529 0a20 2020 206c 6f63 616c 6b65 7920  e).    localkey 
-000265e0: 3d20 7265 736f 6c76 655f 7265 6c61 7469  = resolve_relati
-000265f0: 7665 5f6b 6579 7328 6c6f 6361 6c6b 6579  ve_keys(localkey
-00026600: 290a 2020 2020 6d61 6a5f 726e 203d 205b  ).    maj_rn = [
-00026610: 2749 272c 2027 4949 272c 2027 4949 4927  'I', 'II', 'III'
-00026620: 2c20 2749 5627 2c20 2756 272c 2027 5649  , 'IV', 'V', 'VI
-00026630: 272c 2027 5649 4927 5d0a 2020 2020 6d69  ', 'VII'].    mi
-00026640: 6e5f 726e 203d 205b 2769 272c 2027 6969  n_rn = ['i', 'ii
-00026650: 272c 2027 6969 6927 2c20 2769 7627 2c20  ', 'iii', 'iv', 
-00026660: 2776 272c 2027 7669 272c 2027 7669 6927  'v', 'vi', 'vii'
-00026670: 5d0a 2020 2020 7768 6974 655f 6b65 795f  ].    white_key_
-00026680: 6d61 6a6f 725f 6163 6369 6465 6e74 616c  major_accidental
-00026690: 7320 3d20 6e70 2e61 7272 6179 285b 5b30  s = np.array([[0
-000266a0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-000266b0: 2030 5d2c 0a20 2020 2020 2020 2020 2020   0],.           
-000266c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000266d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000266e0: 2020 5b30 2c20 302c 2031 2c20 302c 2030    [0, 0, 1, 0, 0
-000266f0: 2c20 302c 2031 5d2c 0a20 2020 2020 2020  , 0, 1],.       
-00026700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026720: 2020 2020 2020 5b30 2c20 312c 2031 2c20        [0, 1, 1, 
-00026730: 302c 2030 2c20 312c 2031 5d2c 0a20 2020  0, 0, 1, 1],.   
-00026740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026760: 2020 2020 2020 2020 2020 5b30 2c20 302c            [0, 0,
-00026770: 2030 2c20 2d31 2c20 302c 2030 2c20 305d   0, -1, 0, 0, 0]
-00026780: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00026790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267a0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-000267b0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-000267c0: 2c20 315d 2c0a 2020 2020 2020 2020 2020  , 1],.          
-000267d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267f0: 2020 205b 302c 2030 2c20 312c 2030 2c20     [0, 0, 1, 0, 
-00026800: 302c 2031 2c20 315d 2c0a 2020 2020 2020  0, 1, 1],.      
-00026810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026830: 2020 2020 2020 205b 302c 2031 2c20 312c         [0, 1, 1,
-00026840: 2030 2c20 312c 2031 2c20 315d 5d29 0a20   0, 1, 1, 1]]). 
-00026850: 2020 2072 656c 6174 6976 655f 6163 6369     relative_acci
-00026860: 6465 6e74 616c 732c 2072 656c 6174 6976  dentals, relativ
-00026870: 6520 3d20 7370 6c69 745f 7363 616c 655f  e = split_scale_
-00026880: 6465 6772 6565 2872 656c 6174 6976 652c  degree(relative,
-00026890: 2063 6f75 6e74 3d54 7275 652c 206c 6f67   count=True, log
-000268a0: 6765 723d 6c6f 6767 6572 290a 2020 2020  ger=logger).    
-000268b0: 6c6f 6361 6c6b 6579 5f61 6363 6964 656e  localkey_acciden
-000268c0: 7461 6c73 2c20 6c6f 6361 6c6b 6579 203d  tals, localkey =
-000268d0: 2073 706c 6974 5f73 6361 6c65 5f64 6567   split_scale_deg
-000268e0: 7265 6528 6c6f 6361 6c6b 6579 2c20 636f  ree(localkey, co
-000268f0: 756e 743d 5472 7565 2c20 6c6f 6767 6572  unt=True, logger
-00026900: 3d6c 6f67 6765 7229 0a20 2020 2072 6573  =logger).    res
-00026910: 756c 7469 6e67 5f61 6363 6964 656e 7461  ulting_accidenta
-00026920: 6c73 203d 2072 656c 6174 6976 655f 6163  ls = relative_ac
-00026930: 6369 6465 6e74 616c 7320 2b20 6c6f 6361  cidentals + loca
-00026940: 6c6b 6579 5f61 6363 6964 656e 7461 6c73  lkey_accidentals
-00026950: 0a20 2020 206e 756d 6572 616c 7320 3d20  .    numerals = 
-00026960: 6d61 6a5f 726e 2069 6620 7265 6c61 7469  maj_rn if relati
-00026970: 7665 2e69 7375 7070 6572 2829 2065 6c73  ve.isupper() els
-00026980: 6520 6d69 6e5f 726e 0a20 2020 2072 656c  e min_rn.    rel
-00026990: 5f6e 756d 203d 206e 756d 6572 616c 732e  _num = numerals.
-000269a0: 696e 6465 7828 7265 6c61 7469 7665 290a  index(relative).
-000269b0: 2020 2020 6c6f 6361 6c6b 6579 5f69 6e64      localkey_ind
-000269c0: 6578 203d 206d 616a 5f72 6e2e 696e 6465  ex = maj_rn.inde
-000269d0: 7828 6c6f 6361 6c6b 6579 2e75 7070 6572  x(localkey.upper
-000269e0: 2829 290a 2020 2020 7265 7375 6c74 5f6e  ()).    result_n
-000269f0: 756d 6572 616c 203d 206e 756d 6572 616c  umeral = numeral
-00026a00: 735b 2872 656c 5f6e 756d 202b 206c 6f63  s[(rel_num + loc
-00026a10: 616c 6b65 795f 696e 6465 7829 2025 2037  alkey_index) % 7
-00026a20: 5d0a 2020 2020 6966 206c 6f63 616c 6b65  ].    if localke
-00026a30: 792e 6973 6c6f 7765 7228 2920 616e 6420  y.islower() and 
-00026a40: 7265 6c5f 6e75 6d20 696e 205b 322c 2035  rel_num in [2, 5
-00026a50: 2c20 365d 3a0a 2020 2020 2020 2020 7265  , 6]:.        re
-00026a60: 7375 6c74 696e 675f 6163 6369 6465 6e74  sulting_accident
-00026a70: 616c 7320 2d3d 2031 0a20 2020 2069 6620  als -= 1.    if 
-00026a80: 676c 6f62 616c 5f6d 696e 6f72 3a0a 2020  global_minor:.  
-00026a90: 2020 2020 2020 6c6f 6361 6c6b 6579 5f69        localkey_i
-00026aa0: 6e64 6578 203d 2028 6c6f 6361 6c6b 6579  ndex = (localkey
-00026ab0: 5f69 6e64 6578 202d 2032 2920 2520 370a  _index - 2) % 7.
-00026ac0: 2020 2020 7265 7375 6c74 696e 675f 6163      resulting_ac
-00026ad0: 6369 6465 6e74 616c 7320 2b3d 2077 6869  cidentals += whi
-00026ae0: 7465 5f6b 6579 5f6d 616a 6f72 5f61 6363  te_key_major_acc
-00026af0: 6964 656e 7461 6c73 5b72 656c 5f6e 756d  identals[rel_num
-00026b00: 5d5b 6c6f 6361 6c6b 6579 5f69 6e64 6578  ][localkey_index
-00026b10: 5d0a 2020 2020 6163 6320 3d20 7265 7375  ].    acc = resu
-00026b20: 6c74 696e 675f 6163 6369 6465 6e74 616c  lting_accidental
-00026b30: 7320 2a20 2723 2720 6966 2072 6573 756c  s * '#' if resul
-00026b40: 7469 6e67 5f61 6363 6964 656e 7461 6c73  ting_accidentals
-00026b50: 203e 2030 2065 6c73 6520 2d72 6573 756c   > 0 else -resul
-00026b60: 7469 6e67 5f61 6363 6964 656e 7461 6c73  ting_accidentals
-00026b70: 202a 2027 6227 0a20 2020 2072 6574 7572   * 'b'.    retur
-00026b80: 6e20 6163 6320 2b20 7265 7375 6c74 5f6e  n acc + result_n
-00026b90: 756d 6572 616c 0a0a 0a40 6675 6e63 7469  umeral...@functi
-00026ba0: 6f6e 5f6c 6f67 6765 720a 6465 6620 6d61  on_logger.def ma
-00026bb0: 6b65 5f69 6e74 6572 7661 6c5f 696e 6465  ke_interval_inde
-00026bc0: 785f 6672 6f6d 5f64 7572 6174 696f 6e73  x_from_durations
-00026bd0: 2864 662c 2070 6f73 6974 696f 6e5f 636f  (df, position_co
-00026be0: 6c3d 2771 7561 7274 6572 6265 6174 7327  l='quarterbeats'
-00026bf0: 2c20 6475 7261 7469 6f6e 5f63 6f6c 3d27  , duration_col='
-00026c00: 6475 7261 7469 6f6e 5f71 6227 2c20 636c  duration_qb', cl
-00026c10: 6f73 6564 3d27 6c65 6674 272c 0a20 2020  osed='left',.   
+0000a3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000a3e0: 2e66 696e 6461 6c6c 2873 7562 5f63 6f6d  .findall(sub_com
+0000a3f0: 706f 6e65 6e74 5f72 6567 6578 2c20 746f  ponent_regex, to
+0000a400: 6b65 6e29 202b 205b 2727 5d29 290a 0a0a  ken) + ['']))...
+0000a410: 0a40 6675 6e63 7469 6f6e 5f6c 6f67 6765  .@function_logge
+0000a420: 720a 6465 6620 6469 7374 7269 6275 7465  r.def distribute
+0000a430: 5f74 6f6b 656e 735f 6f76 6572 5f6c 6576  _tokens_over_lev
+0000a440: 656c 7328 6c65 7665 6c73 3a20 436f 6c6c  els(levels: Coll
+0000a450: 6563 7469 6f6e 5b73 7472 5d2c 0a20 2020  ection[str],.   
+0000a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a470: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000a480: 6f6b 656e 733a 2043 6f6c 6c65 6374 696f  okens: Collectio
+0000a490: 6e5b 7374 725d 2c0a 2020 2020 2020 2020  n[str],.        
+0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4b0: 2020 2020 2020 2020 2020 6d63 3a20 4f70            mc: Op
+0000a4c0: 7469 6f6e 616c 5b55 6e69 6f6e 5b69 6e74  tional[Union[int
+0000a4d0: 2c20 7374 725d 5d20 3d20 4e6f 6e65 2c0a  , str]] = None,.
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a500: 2020 6162 6272 6576 6961 7469 6f6e 733a    abbreviations:
+0000a510: 2064 6963 7420 3d20 7b7d 2c0a 2020 2020   dict = {},.    
+0000a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a530: 2020 2020 2020 2020 2020 2020 2020 2920                ) 
+0000a540: 2d3e 2044 6963 745b 5475 706c 655b 7374  -> Dict[Tuple[st
+0000a550: 722c 2073 7472 5d2c 2073 7472 5d3a 0a20  r, str], str]:. 
+0000a560: 2020 2022 2222 5461 6b65 7320 7468 6520     """Takes the 
+0000a570: 7265 6765 7820 6d61 7463 6865 7320 6f66  regex matches of
+0000a580: 206f 6e65 206c 6162 656c 2061 6e64 2074   one label and t
+0000a590: 7572 6e73 2074 6865 6d20 696e 746f 2061  urns them into a
+0000a5a0: 7320 6d61 6e79 207b 6c61 7965 7220 2d3e  s many {layer ->
+0000a5b0: 2074 6f6b 656e 7d20 7061 6972 7320 6173   token} pairs as
+0000a5c0: 2074 6865 206c 6162 656c 2063 6f6e 7461   the label conta
+0000a5d0: 696e 730a 2020 2020 746f 6b65 6e73 2e0a  ins.    tokens..
+0000a5e0: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
+0000a5f0: 206c 6576 656c 733a 2043 6f6c 6c65 6374   levels: Collect
+0000a600: 696f 6e20 6f66 2073 7472 696e 6773 2069  ion of strings i
+0000a610: 6e64 6963 6174 696e 6720 616e 616c 7974  ndicating analyt
+0000a620: 6963 616c 206c 6179 6572 732e 0a20 2020  ical layers..   
+0000a630: 2020 2074 6f6b 656e 733a 2043 6f6c 6c65     tokens: Colle
+0000a640: 6374 696f 6e20 6f66 2074 6f6b 656e 7320  ction of tokens 
+0000a650: 636f 6d69 6e67 2061 6c6f 6e67 2c20 7361  coming along, sa
+0000a660: 6d65 2073 697a 6520 6173 206c 6576 656c  me size as level
+0000a670: 732e 0a20 2020 2020 206d 633a 2050 6173  s..      mc: Pas
+0000a680: 7320 7468 6520 6c61 6265 6c27 7320 6c61  s the label's la
+0000a690: 6265 6c27 7320 4d43 2074 6f20 6469 7370  bel's MC to disp
+0000a6a0: 6c61 7920 6974 2069 6e20 6572 726f 7220  lay it in error 
+0000a6b0: 6d65 7373 6167 6573 2e0a 2020 2020 2020  messages..      
+0000a6c0: 6162 6272 6576 6961 7469 6f6e 733a 207b  abbreviations: {
+0000a6d0: 6162 6272 6576 6174 696f 6e20 2d3e 206c  abbrevation -> l
+0000a6e0: 6f6e 6720 6e61 6d65 7d20 6d61 7070 696e  ong name} mappin
+0000a6f0: 6720 6162 6272 6576 6961 7469 6f6e 7320  g abbreviations 
+0000a700: 746f 2077 6861 7420 7468 6579 2061 7265  to what they are
+0000a710: 2074 6f20 6265 2072 6570 6c61 6365 6420   to be replaced 
+0000a720: 7769 7468 0a0a 2020 2020 5265 7475 726e  with..    Return
+0000a730: 733a 0a20 2020 2020 2041 207b 2866 6f72  s:.      A {(for
+0000a740: 6d5f 7472 6565 2c20 6c65 7665 6c29 202d  m_tree, level) -
+0000a750: 3e20 746f 6b65 6e7d 2064 6963 7420 7768  > token} dict wh
+0000a760: 6572 6520 666f 726d 5f74 7265 6520 6973  ere form_tree is
+0000a770: 2065 6974 6865 7220 2727 206f 7220 6120   either '' or a 
+0000a780: 6c65 7474 6572 2062 6574 7765 656e 2061  letter between a
+0000a790: 2d68 2069 6465 6e74 6966 7969 6e67 206f  -h identifying o
+0000a7a0: 6e65 206f 660a 2020 2020 2020 7365 7665  ne of.      seve
+0000a7b0: 7261 6c20 7472 6565 7320 616e 6e6f 7461  ral trees annota
+0000a7c0: 7465 6420 696e 2070 6172 616c 6c65 6c2e  ted in parallel.
+0000a7d0: 0a20 2020 2022 2222 0a20 2020 2063 6f6c  .    """.    col
+0000a7e0: 756d 6e32 7661 6c75 6520 3d20 7b7d 0a20  umn2value = {}. 
+0000a7f0: 2020 2072 6561 6469 6e67 5f72 6567 6578     reading_regex
+0000a800: 203d 2072 225e 2828 3f3a 5b69 7678 5d2b   = r"^((?:[ivx]+
+0000a810: 5c26 3f29 2b29 3a22 0a20 2020 206d 635f  \&?)+):".    mc_
+0000a820: 7374 7269 6e67 203d 2027 2720 6966 206d  string = '' if m
+0000a830: 6320 6973 204e 6f6e 6520 656c 7365 2066  c is None else f
+0000a840: 224d 4320 7b6d 637d 3a20 220a 2020 2020  "MC {mc}: ".    
+0000a850: 666f 7220 6c65 7665 6c5f 7374 722c 2074  for level_str, t
+0000a860: 6f6b 656e 5f73 7472 2069 6e20 7a69 7028  oken_str in zip(
+0000a870: 6c65 7665 6c73 2c20 746f 6b65 6e73 293a  levels, tokens):
+0000a880: 0a20 2020 2020 2020 2073 706c 6974 5f6c  .        split_l
+0000a890: 6576 656c 5f69 6e66 6f20 3d20 7064 2e53  evel_info = pd.S
+0000a8a0: 6572 6965 7328 6c65 7665 6c5f 7374 722e  eries(level_str.
+0000a8b0: 7370 6c69 7428 2726 2729 290a 2020 2020  split('&')).    
+0000a8c0: 2020 2020 2320 7475 726e 206c 6179 6572      # turn layer
+0000a8d0: 2069 6e64 6963 6174 696f 6e73 2069 6e74   indications int
+0000a8e0: 6f20 6120 4461 7461 4672 616d 6520 7769  o a DataFrame wi
+0000a8f0: 7468 2074 6865 2063 6f6c 756d 6e73 205b  th the columns [
+0000a900: 276c 6576 656c 272c 2027 666f 726d 5f74  'level', 'form_t
+0000a910: 7265 6527 2c20 616e 6420 2772 6561 6469  ree', and 'readi
+0000a920: 6e67 275d 0a20 2020 2020 2020 2061 6e61  ng'].        ana
+0000a930: 6c79 7469 6361 6c5f 6c61 7965 7273 203d  lytical_layers =
+0000a940: 2073 706c 6974 5f6c 6576 656c 5f69 6e66   split_level_inf
+0000a950: 6f2e 7374 722e 6578 7472 6163 7428 464f  o.str.extract(FO
+0000a960: 524d 5f4c 4556 454c 5f52 4547 4558 290a  RM_LEVEL_REGEX).
+0000a970: 2020 2020 2020 2020 6c65 7665 6c73 5f69          levels_i
+0000a980: 6e63 6c75 6465 5f72 6561 6469 6e67 203d  nclude_reading =
+0000a990: 2061 6e61 6c79 7469 6361 6c5f 6c61 7965   analytical_laye
+0000a9a0: 7273 2e72 6561 6469 6e67 2e6e 6f74 6e61  rs.reading.notna
+0000a9b0: 2829 2e61 6e79 2829 0a20 2020 2020 2020  ().any().       
+0000a9c0: 2023 2072 6561 6469 6e67 2069 6e64 6963   # reading indic
+0000a9d0: 6174 696f 6e73 2062 6563 6f6d 6520 7061  ations become pa
+0000a9e0: 7274 206f 6620 7468 6520 746f 6b65 6e20  rt of the token 
+0000a9f0: 616e 6420 6561 6368 2077 696c 6c20 6265  and each will be
+0000aa00: 2066 6f6c 6c6f 7765 6420 6279 2061 2063   followed by a c
+0000aa10: 6f6c 6f6e 0a20 2020 2020 2020 2061 6e61  olon.        ana
+0000aa20: 6c79 7469 6361 6c5f 6c61 7965 7273 2e72  lytical_layers.r
+0000aa30: 6561 6469 6e67 203d 2028 616e 616c 7974  eading = (analyt
+0000aa40: 6963 616c 5f6c 6179 6572 732e 7265 6164  ical_layers.read
+0000aa50: 696e 6720 2b20 273a 2027 292e 6669 6c6c  ing + ': ').fill
+0000aa60: 6e61 2827 2729 0a20 2020 2020 2020 2023  na('').        #
+0000aa70: 2070 726f 7061 6761 7465 2069 6e66 6f72   propagate infor
+0000aa80: 6d61 7469 6f6e 2074 6861 7420 6861 7320  mation that has 
+0000aa90: 6265 656e 206f 6d69 7474 6564 2069 6e20  been omitted in 
+0000aaa0: 7468 6520 7365 636f 6e64 2061 6e64 2066  the second and f
+0000aab0: 6f6c 6c6f 7769 6e67 2069 6e64 6963 6174  ollowing indicat
+0000aac0: 696f 6e73 2c0a 2020 2020 2020 2020 2320  ions,.        # 
+0000aad0: 652e 672e 2032 6126 6220 2d3e 205b 3261  e.g. 2a&b -> [2a
+0000aae0: 3a2c 2032 623a 5d3b 2031 6169 6926 6969  :, 2b:]; 1aii&ii
+0000aaf0: 6920 2d3e 205b 3161 6969 3a2c 2031 6169  i -> [1aii:, 1ai
+0000ab00: 6969 3a5d 3b20 3161 6926 6220 2d3e 205b  ii:]; 1ai&b -> [
+0000ab10: 3161 693a 2c20 3162 5d20 2869 2e65 2e2c  1ai:, 1b] (i.e.,
+0000ab20: 2072 6561 6469 6e67 7320 6172 6520 6e6f   readings are no
+0000ab30: 7420 7072 6f70 6167 6174 6564 290a 2020  t propagated).  
+0000ab40: 2020 2020 2020 616e 616c 7974 6963 616c        analytical
+0000ab50: 5f6c 6179 6572 7320 3d20 616e 616c 7974  _layers = analyt
+0000ab60: 6963 616c 5f6c 6179 6572 732e 6669 6c6c  ical_layers.fill
+0000ab70: 6e61 286d 6574 686f 643d 2766 6669 6c6c  na(method='ffill
+0000ab80: 2729 0a20 2020 2020 2020 2061 6e61 6c79  ').        analy
+0000ab90: 7469 6361 6c5f 6c61 7965 7273 2e66 6f72  tical_layers.for
+0000aba0: 6d5f 7472 6565 203d 2061 6e61 6c79 7469  m_tree = analyti
+0000abb0: 6361 6c5f 6c61 7965 7273 2e66 6f72 6d5f  cal_layers.form_
+0000abc0: 7472 6565 2e66 696c 6c6e 6128 2727 290a  tree.fillna('').
+0000abd0: 2020 2020 2020 2020 2320 7370 6c69 7420          # split 
+0000abe0: 746f 6b65 6e20 696e 746f 2061 6c74 6572  token into alter
+0000abf0: 6e61 7469 7665 2063 6f6d 706f 6e65 6e74  native component
+0000ac00: 732c 2072 6570 6c61 6365 2073 7065 6369  s, replace speci
+0000ac10: 616c 2077 6974 6820 6e6f 726d 616c 2077  al with normal w
+0000ac20: 6869 7465 2d73 7061 6365 2063 6861 7261  hite-space chara
+0000ac30: 6374 6572 732c 2061 6e64 2073 7472 6970  cters, and strip
+0000ac40: 2065 6163 680a 2020 2020 2020 2020 2320   each.        # 
+0000ac50: 636f 6d70 6f6e 656e 7420 6672 6f6d 2077  component from w
+0000ac60: 6869 7465 2073 7061 6365 2061 6e64 2073  hite space and s
+0000ac70: 6570 6172 6174 696e 6720 636f 6d6d 6173  eparating commas
+0000ac80: 0a20 2020 2020 2020 2074 6f6b 656e 5f61  .        token_a
+0000ac90: 6c74 6572 6e61 7469 7665 7320 3d20 5b72  lternatives = [r
+0000aca0: 652e 7375 6228 7227 5c73 2b27 2c20 2027  e.sub(r'\s+',  '
+0000acb0: 2027 2c20 7429 2e73 7472 6970 2827 205c   ', t).strip(' \
+0000acc0: 6e2c 2729 2066 6f72 2074 2069 6e20 746f  n,') for t in to
+0000acd0: 6b65 6e5f 7374 722e 7370 6c69 7428 2720  ken_str.split(' 
+0000ace0: 2d20 2729 5d0a 2020 2020 2020 2020 746f  - ')].        to
+0000acf0: 6b65 6e5f 616c 7465 726e 6174 6976 6573  ken_alternatives
+0000ad00: 203d 205b 7420 666f 7220 7420 696e 2074   = [t for t in t
+0000ad10: 6f6b 656e 5f61 6c74 6572 6e61 7469 7665  oken_alternative
+0000ad20: 7320 6966 2074 2021 3d20 2727 5d0a 2020  s if t != ''].  
+0000ad30: 2020 2020 2020 6966 206c 656e 2861 6262        if len(abb
+0000ad40: 7265 7669 6174 696f 6e73 2920 3e20 303a  reviations) > 0:
+0000ad50: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+0000ad60: 656e 5f61 6c74 6572 6e61 7469 7665 7320  en_alternatives 
+0000ad70: 3d20 5b72 6573 6f6c 7665 5f66 6f72 6d5f  = [resolve_form_
+0000ad80: 6162 6272 6576 6961 7469 6f6e 7328 746f  abbreviations(to
+0000ad90: 6b65 6e2c 2061 6262 7265 7669 6174 696f  ken, abbreviatio
+0000ada0: 6e73 2c20 6d63 3d6d 632c 206c 6f67 6765  ns, mc=mc, logge
+0000adb0: 723d 6c6f 6767 6572 2920 666f 7220 746f  r=logger) for to
+0000adc0: 6b65 6e20 696e 2074 6f6b 656e 5f61 6c74  ken in token_alt
+0000add0: 6572 6e61 7469 7665 735d 0a20 2020 2020  ernatives].     
+0000ade0: 2020 2069 6620 6c65 6e28 746f 6b65 6e5f     if len(token_
+0000adf0: 616c 7465 726e 6174 6976 6573 2920 3d3d  alternatives) ==
+0000ae00: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0000ae10: 6966 206c 6576 656c 735f 696e 636c 7564  if levels_includ
+0000ae20: 655f 7265 6164 696e 673a 0a20 2020 2020  e_reading:.     
+0000ae30: 2020 2020 2020 2020 2020 2061 6e61 6c79             analy
+0000ae40: 7469 6361 6c5f 6c61 7965 7273 2e72 6561  tical_layers.rea
+0000ae50: 6469 6e67 202b 3d20 746f 6b65 6e5f 616c  ding += token_al
+0000ae60: 7465 726e 6174 6976 6573 5b30 5d0a 2020  ternatives[0].  
+0000ae70: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+0000ae80: 6265 6c20 3d20 2727 0a20 2020 2020 2020  bel = ''.       
+0000ae90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000aea0: 2020 2020 2020 2020 2020 206c 6162 656c             label
+0000aeb0: 203d 2074 6f6b 656e 5f61 6c74 6572 6e61   = token_alterna
+0000aec0: 7469 7665 735b 305d 0a20 2020 2020 2020  tives[0].       
+0000aed0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000aee0: 2020 2023 2074 6869 7320 7365 6374 696f     # this sectio
+0000aef0: 6e20 6465 616c 7320 7769 7468 2063 6173  n deals with cas
+0000af00: 6573 2077 6865 7265 2061 6c74 6572 6e61  es where alterna
+0000af10: 7469 7665 2072 6561 6469 6e67 7320 6172  tive readings ar
+0000af20: 6520 6f72 2061 7265 206e 6f74 2069 6465  e or are not ide
+0000af30: 6e74 6966 6965 6420 6279 2052 6f6d 616e  ntified by Roman
+0000af40: 206e 756d 6265 7273 2c0a 2020 2020 2020   numbers,.      
+0000af50: 2020 2020 2020 2320 616e 6420 6465 616c        # and deal
+0000af60: 7320 7769 7468 2074 6865 2067 6976 656e  s with the given
+0000af70: 2052 6f6d 616e 206e 756d 6265 7273 2064   Roman numbers d
+0000af80: 6570 656e 6469 6e67 206f 6e20 7768 6574  epending on whet
+0000af90: 6865 7220 7468 6520 616e 616c 7974 6963  her the analytic
+0000afa0: 616c 206c 6179 6572 7320 696e 636c 7564  al layers includ
+0000afb0: 6520 736f 6d65 2061 7320 7765 6c6c 0a20  e some as well. 
+0000afc0: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+0000afd0: 5f69 6e63 6c75 6465 735f 7265 6164 696e  _includes_readin
+0000afe0: 6720 3d20 616e 7928 7265 2e6d 6174 6368  g = any(re.match
+0000aff0: 2872 6561 6469 6e67 5f72 6567 6578 2c20  (reading_regex, 
+0000b000: 7429 2069 7320 6e6f 7420 4e6f 6e65 2066  t) is not None f
+0000b010: 6f72 2074 2069 6e20 746f 6b65 6e5f 616c  or t in token_al
+0000b020: 7465 726e 6174 6976 6573 290a 2020 2020  ternatives).    
+0000b030: 2020 2020 2020 2020 6966 2074 6f6b 656e          if token
+0000b040: 5f69 6e63 6c75 6465 735f 7265 6164 696e  _includes_readin
+0000b050: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+0000b060: 2020 2072 6561 6469 6e67 5f69 6e66 6f20     reading_info 
+0000b070: 3d20 5b72 652e 6d61 7463 6828 7265 6164  = [re.match(read
+0000b080: 696e 675f 7265 6765 782c 2074 2920 666f  ing_regex, t) fo
+0000b090: 7220 7420 696e 2074 6f6b 656e 5f61 6c74  r t in token_alt
+0000b0a0: 6572 6e61 7469 7665 735d 0a20 2020 2020  ernatives].     
+0000b0b0: 2020 2020 2020 2020 2020 2072 6561 6469             readi
+0000b0c0: 6e67 3274 6f6b 656e 203d 207b 7d0a 2020  ng2token = {}.  
+0000b0d0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000b0e0: 7220 7265 6164 696e 6773 5f73 7472 2c20  r readings_str, 
+0000b0f0: 746f 6b65 6e5f 636f 6d70 6f6e 656e 7420  token_component 
+0000b100: 696e 207a 6970 2872 6561 6469 6e67 5f69  in zip(reading_i
+0000b110: 6e66 6f5b 313a 5d2c 2074 6f6b 656e 5f61  nfo[1:], token_a
+0000b120: 6c74 6572 6e61 7469 7665 735b 313a 5d29  lternatives[1:])
+0000b130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b140: 2020 2020 2020 6966 2072 6561 6469 6e67        if reading
+0000b150: 735f 7374 7220 6973 204e 6f6e 653a 0a20  s_str is None:. 
+0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b170: 2020 2020 2020 2072 6561 6469 6e67 203d         reading =
+0000b180: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
+0000b190: 2020 2020 2020 2020 2020 2020 7265 6164              read
+0000b1a0: 696e 6732 746f 6b65 6e5b 7265 6164 696e  ing2token[readin
+0000b1b0: 675d 203d 2074 6f6b 656e 5f63 6f6d 706f  g] = token_compo
+0000b1c0: 6e65 6e74 0a20 2020 2020 2020 2020 2020  nent.           
+0000b1d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1f0: 2020 2020 2020 2074 6f6b 656e 5f63 6f6d         token_com
+0000b200: 706f 6e65 6e74 203d 2074 6f6b 656e 5f63  ponent = token_c
+0000b210: 6f6d 706f 6e65 6e74 5b72 6561 6469 6e67  omponent[reading
+0000b220: 735f 7374 722e 656e 6428 293a 5d2e 7374  s_str.end():].st
+0000b230: 7269 7028 2720 2729 0a20 2020 2020 2020  rip(' ').       
+0000b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b250: 2066 6f72 2072 6f6d 616e 2069 6e20 7265   for roman in re
+0000b260: 6164 696e 6773 5f73 7472 2e67 726f 7570  adings_str.group
+0000b270: 2831 292e 7370 6c69 7428 2726 2729 3a0a  (1).split('&'):.
+0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b290: 2020 2020 2020 2020 2020 2020 7265 6164              read
+0000b2a0: 696e 6720 3d20 6622 7b72 6f6d 616e 7d3a  ing = f"{roman}:
+0000b2b0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0000b2c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b2d0: 6620 6c65 7665 6c73 5f69 6e63 6c75 6465  f levels_include
+0000b2e0: 5f72 6561 6469 6e67 2061 6e64 2072 6561  _reading and rea
+0000b2f0: 6469 6e67 2069 6e20 616e 616c 7974 6963  ding in analytic
+0000b300: 616c 5f6c 6179 6572 732e 7265 6164 696e  al_layers.readin
+0000b310: 672e 7661 6c75 6573 3a0a 2020 2020 2020  g.values:.      
+0000b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b330: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+0000b340: 5f65 6d70 7479 203d 2028 616e 616c 7974  _empty = (analyt
+0000b350: 6963 616c 5f6c 6179 6572 7320 3d3d 2027  ical_layers == '
+0000b360: 2729 2e61 6c6c 2829 0a20 2020 2020 2020  ').all().       
+0000b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b380: 2020 2020 2020 2020 2073 686f 775f 6c61           show_la
+0000b390: 7965 7273 203d 2061 6e61 6c79 7469 6361  yers = analytica
+0000b3a0: 6c5f 6c61 7965 7273 2e6c 6f63 5b3a 2c20  l_layers.loc[:, 
+0000b3b0: 7e63 6f6c 756d 6e5f 656d 7074 795d 0a20  ~column_empty]. 
+0000b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3d0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000b3e0: 6f67 6765 722e 7761 726e 696e 6728 0a20  ogger.warning(. 
+0000b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b410: 2020 2066 227b 6d63 5f73 7472 696e 677d     f"{mc_string}
+0000b420: 416c 7465 726e 6174 6976 6520 7265 6164  Alternative read
+0000b430: 696e 6720 696e 2027 7b74 6f6b 656e 5f73  ing in '{token_s
+0000b440: 7472 7d27 2073 7065 6369 6669 6573 2052  tr}' specifies R
+0000b450: 6f6d 616e 2027 7b72 6561 6469 6e67 7d27  oman '{reading}'
+0000b460: 2077 6869 6368 2063 6f6e 666c 6963 7473   which conflicts
+0000b470: 2077 6974 6820 6f6e 6520 7370 6563 6966   with one specif
+0000b480: 6965 6420 696e 2074 6865 206c 6576 656c  ied in the level
+0000b490: 3a5c 6e7b 7368 6f77 5f6c 6179 6572 737d  :\n{show_layers}
+0000b4a0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000b4b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000b4c0: 6561 6469 6e67 3274 6f6b 656e 5b72 6561  eading2token[rea
+0000b4d0: 6469 6e67 5d20 3d20 746f 6b65 6e5f 636f  ding] = token_co
+0000b4e0: 6d70 6f6e 656e 740a 2020 2020 2020 2020  mponent.        
+0000b4f0: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
+0000b500: 2720 2d20 272e 6a6f 696e 2872 6561 6469  ' - '.join(readi
+0000b510: 6e67 202b 2074 6b6e 2066 6f72 2072 6561  ng + tkn for rea
+0000b520: 6469 6e67 2c20 746b 6e20 696e 2072 6561  ding, tkn in rea
+0000b530: 6469 6e67 3274 6f6b 656e 2e69 7465 6d73  ding2token.items
+0000b540: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+0000b550: 2020 2020 6966 206c 6576 656c 735f 696e      if levels_in
+0000b560: 636c 7564 655f 7265 6164 696e 673a 0a20  clude_reading:. 
+0000b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b580: 2020 2069 6620 7265 6164 696e 675f 696e     if reading_in
+0000b590: 666f 5b30 5d20 6973 206e 6f74 204e 6f6e  fo[0] is not Non
+0000b5a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000b5b0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0000b5c0: 722e 7761 726e 696e 6728 0a20 2020 2020  r.warning(.     
+0000b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5e0: 2020 2020 2020 2066 227b 6d63 5f73 7472         f"{mc_str
+0000b5f0: 696e 677d 277b 746f 6b65 6e5f 7374 727d  ing}'{token_str}
+0000b600: 273a 2054 6865 2066 6972 7374 2072 6561  ': The first rea
+0000b610: 6469 6e67 2027 7b72 6561 6469 6e67 5f69  ding '{reading_i
+0000b620: 6e66 6f5b 305d 2e67 726f 7570 2829 7d27  nfo[0].group()}'
+0000b630: 2073 7065 6369 6669 6573 2052 6f6d 616e   specifies Roman
+0000b640: 206e 756d 6265 7220 696e 2061 6464 6974   number in addit
+0000b650: 696f 6e20 746f 2074 686f 7365 2073 7065  ion to those spe
+0000b660: 6369 6669 6564 2069 6e20 7468 6520 6c65  cified in the le
+0000b670: 7665 6c3a 5c6e 7b61 6e61 6c79 7469 6361  vel:\n{analytica
+0000b680: 6c5f 6c61 7965 7273 7d22 290a 2020 2020  l_layers}").    
+0000b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6a0: 616e 616c 7974 6963 616c 5f6c 6179 6572  analytical_layer
+0000b6b0: 732e 7265 6164 696e 6720 2b3d 2074 6f6b  s.reading += tok
+0000b6c0: 656e 5f61 6c74 6572 6e61 7469 7665 735b  en_alternatives[
+0000b6d0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+0000b6e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000b6f0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
+0000b700: 656c 203d 2074 6f6b 656e 5f61 6c74 6572  el = token_alter
+0000b710: 6e61 7469 7665 735b 305d 202b 2027 202d  natives[0] + ' -
+0000b720: 2027 202b 206c 6162 656c 0a20 2020 2020   ' + label.     
+0000b730: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000b740: 2020 2020 2020 2020 2020 2020 2023 2074               # t
+0000b750: 6f6b 656e 2064 6f65 7320 6e6f 7420 696e  oken does not in
+0000b760: 636c 7564 6520 616e 7920 526f 6d61 6e20  clude any Roman 
+0000b770: 6e75 6d62 6572 7320 616e 6420 6973 2075  numbers and is u
+0000b780: 7365 6420 6173 2069 7320 666f 7220 616c  sed as is for al
+0000b790: 6c20 6c61 7965 7273 0a20 2020 2020 2020  l layers.       
+0000b7a0: 2020 2020 2020 2020 2061 6e61 6c79 7469           analyti
+0000b7b0: 6361 6c5f 6c61 7965 7273 2e72 6561 6469  cal_layers.readi
+0000b7c0: 6e67 202b 3d20 2720 2d20 272e 6a6f 696e  ng += ' - '.join
+0000b7d0: 2874 2066 6f72 2074 2069 6e20 746f 6b65  (t for t in toke
+0000b7e0: 6e5f 616c 7465 726e 6174 6976 6573 290a  n_alternatives).
+0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b800: 6c61 6265 6c20 3d20 2727 0a0a 2020 2020  label = ''..    
+0000b810: 2020 2020 666f 7220 2866 6f72 6d5f 7472      for (form_tr
+0000b820: 6565 2c20 6c65 7665 6c29 2c20 6466 2069  ee, level), df i
+0000b830: 6e20 616e 616c 7974 6963 616c 5f6c 6179  n analytical_lay
+0000b840: 6572 732e 6772 6f75 7062 7928 5b27 666f  ers.groupby(['fo
+0000b850: 726d 5f74 7265 6527 2c20 276c 6576 656c  rm_tree', 'level
+0000b860: 275d 2c20 6472 6f70 6e61 3d46 616c 7365  '], dropna=False
+0000b870: 293a 0a20 2020 2020 2020 2020 2020 206b  ):.            k
+0000b880: 6579 203d 2028 666f 726d 5f74 7265 652c  ey = (form_tree,
+0000b890: 206c 6576 656c 2920 2023 2066 6f72 6d5f   level)  # form_
+0000b8a0: 7472 6565 2062 6563 6f6d 6573 2066 6972  tree becomes fir
+0000b8b0: 7374 206c 6576 656c 206f 6620 7468 6520  st level of the 
+0000b8c0: 636f 6c75 6d6e 7327 204d 756c 7469 496e  columns' MultiIn
+0000b8d0: 6465 782c 2065 2e67 2e20 2761 2720 616e  dex, e.g. 'a' an
+0000b8e0: 6420 2762 270a 2020 2020 2020 2020 2020  d 'b'.          
+0000b8f0: 2020 6966 2028 6466 2e72 6561 6469 6e67    if (df.reading
+0000b900: 203d 3d20 2727 292e 616c 6c28 293a 0a20   == '').all():. 
+0000b910: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000b920: 616c 7565 203d 206c 6162 656c 0a20 2020  alue = label.   
+0000b930: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000b940: 6c65 6e28 6466 2920 3e20 313a 0a20 2020  len(df) > 1:.   
+0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b960: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
+0000b970: 6622 7b6d 635f 7374 7269 6e67 7d44 7570  f"{mc_string}Dup
+0000b980: 6c69 6361 7469 6f6e 206f 6620 6c65 7665  lication of leve
+0000b990: 6c20 7769 7468 6f75 7420 7370 6563 6966  l without specif
+0000b9a0: 7969 6e67 2073 6570 6172 6174 6520 7265  ying separate re
+0000b9b0: 6164 696e 6773 3a5c 6e7b 6466 7d22 290a  adings:\n{df}").
+0000b9c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000b9d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b9e0: 2020 7661 6c75 6520 3d20 2720 2d20 272e    value = ' - '.
+0000b9f0: 6a6f 696e 2872 6561 6469 6e67 2066 6f72  join(reading for
+0000ba00: 2072 6561 6469 6e67 2069 6e20 6466 2e72   reading in df.r
+0000ba10: 6561 6469 6e67 2e74 6f5f 6c69 7374 2829  eading.to_list()
+0000ba20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ba30: 2020 6966 206c 6162 656c 2021 3d20 2727    if label != ''
+0000ba40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ba50: 2020 2020 2020 7661 6c75 6520 2b3d 2027        value += '
+0000ba60: 202d 2027 202b 206c 6162 656c 0a20 2020   - ' + label.   
+0000ba70: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
+0000ba80: 696e 2063 6f6c 756d 6e32 7661 6c75 653a  in column2value:
+0000ba90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000baa0: 2063 6f6c 756d 6e32 7661 6c75 655b 6b65   column2value[ke
+0000bab0: 795d 202b 3d20 2720 2d20 2720 2b20 7661  y] += ' - ' + va
+0000bac0: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+0000bad0: 2020 2020 2320 6c6f 6767 6572 2e77 6172      # logger.war
+0000bae0: 6e69 6e67 2866 227b 6d63 5f73 7472 696e  ning(f"{mc_strin
+0000baf0: 677d 5468 6520 746f 6b65 6e20 277b 636f  g}The token '{co
+0000bb00: 6c75 6d6e 3276 616c 7565 5b6b 6579 5d7d  lumn2value[key]}
+0000bb10: 2720 666f 7220 6c65 7665 6c20 7b6b 6579  ' for level {key
+0000bb20: 7d20 7761 7320 6f76 6572 7772 6974 7465  } was overwritte
+0000bb30: 6e20 7769 7468 2027 7b76 616c 7565 7d27  n with '{value}'
+0000bb40: 3a5c 6e6c 6576 656c 733a 207b 6c65 7665  :\nlevels: {leve
+0000bb50: 6c5f 7374 727d 2c20 746f 6b65 6e3a 207b  l_str}, token: {
+0000bb60: 746f 6b65 6e7d 2229 0a20 2020 2020 2020  token}").       
+0000bb70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000bb80: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+0000bb90: 6e32 7661 6c75 655b 6b65 795d 203d 2076  n2value[key] = v
+0000bba0: 616c 7565 0a20 2020 2072 6574 7572 6e20  alue.    return 
+0000bbb0: 636f 6c75 6d6e 3276 616c 7565 0a0a 4066  column2value..@f
+0000bbc0: 756e 6374 696f 6e5f 6c6f 6767 6572 0a64  unction_logger.d
+0000bbd0: 6566 2065 7870 616e 645f 7369 6e67 6c65  ef expand_single
+0000bbe0: 5f66 6f72 6d5f 6c61 6265 6c28 6c61 6265  _form_label(labe
+0000bbf0: 6c3a 2073 7472 2c20 6465 6661 756c 745f  l: str, default_
+0000bc00: 6162 6272 6576 6961 7469 6f6e 733d 5472  abbreviations=Tr
+0000bc10: 7565 2c20 2a2a 6b77 6172 6773 2920 2d3e  ue, **kwargs) ->
+0000bc20: 2044 6963 745b 5475 706c 655b 7374 722c   Dict[Tuple[str,
+0000bc30: 2073 7472 5d2c 2073 7472 5d3a 0a20 2020   str], str]:.   
+0000bc40: 2022 2222 2053 706c 6974 7320 6120 666f   """ Splits a fo
+0000bc50: 726d 206c 6162 656c 2061 6e64 2061 7070  rm label and app
+0000bc60: 6c69 6573 2064 6973 7472 6962 7574 655f  lies distribute_
+0000bc70: 746f 6b65 6e73 5f6f 7665 725f 6c65 7665  tokens_over_leve
+0000bc80: 6c73 2829 0a0a 2020 2020 4172 6773 3a0a  ls()..    Args:.
+0000bc90: 2020 2020 2020 6c61 6265 6c3a 2043 6f6d        label: Com
+0000bca0: 706c 6574 6520 666f 726d 206c 6162 656c  plete form label
+0000bcb0: 2069 6e63 6c75 6469 6e67 2069 6e64 6963   including indic
+0000bcc0: 6174 696f 6e73 206f 6620 616e 616c 7974  ations of analyt
+0000bcd0: 6963 616c 206c 6179 6572 2873 292e 0a20  ical layer(s).. 
+0000bce0: 2020 2020 2064 6566 6175 6c74 5f61 6262       default_abb
+0000bcf0: 7265 7669 6174 696f 6e73 3a20 4279 2064  reviations: By d
+0000bd00: 6566 6175 6c74 2c20 6561 6368 2074 6f6b  efault, each tok
+0000bd10: 656e 2063 6f6d 706f 6e65 6e74 2069 7320  en component is 
+0000bd20: 6368 6563 6b65 6420 6167 6169 6e73 7420  checked against 
+0000bd30: 6120 6d61 7070 696e 6720 6672 6f6d 2061  a mapping from a
+0000bd40: 6262 7265 7669 6174 696f 6e73 2074 6f0a  bbreviations to.
+0000bd50: 2020 2020 2020 2020 2020 6c6f 6e67 206e            long n
+0000bd60: 616d 6573 2e20 5061 7373 2046 616c 7365  ames. Pass False
+0000bd70: 2074 6f20 7072 6576 656e 7420 7468 6174   to prevent that
+0000bd80: 2e0a 2020 2020 2020 2a2a 6b77 6172 6773  ..      **kwargs
+0000bd90: 3a20 4162 6272 6576 6961 7469 6f6e 3d27  : Abbreviation='
+0000bda0: 6c6f 6e67 206e 616d 6527 206d 6170 7069  long name' mappi
+0000bdb0: 6e67 7320 746f 2072 6573 6f6c 7665 2069  ngs to resolve i
+0000bdc0: 6e64 6976 6964 7561 6c20 6162 6272 6576  ndividual abbrev
+0000bdd0: 6961 7469 6f6e 730a 0a20 2020 2052 6574  iations..    Ret
+0000bde0: 7572 6e73 3a0a 2020 2020 2020 4120 4461  urns:.      A Da
+0000bdf0: 7461 4672 616d 6520 7769 7468 206f 6e65  taFrame with one
+0000be00: 2063 6f6c 756d 6e20 6164 6465 6420 7065   column added pe
+0000be10: 7220 6869 6572 6172 6368 6963 616c 206c  r hierarchical l
+0000be20: 6179 6572 206f 6620 616e 616c 7973 6973  ayer of analysis
+0000be30: 2c20 7374 6172 7469 6e67 2066 726f 6d20  , starting from 
+0000be40: 6c65 7665 6c20 302e 0a20 2020 2022 2222  level 0..    """
+0000be50: 0a20 2020 2065 7874 7261 6374 6564 5f6c  .    extracted_l
+0000be60: 6576 656c 7320 3d20 7265 2e66 696e 6461  evels = re.finda
+0000be70: 6c6c 2846 4f52 4d5f 4c45 5645 4c5f 4341  ll(FORM_LEVEL_CA
+0000be80: 5054 5552 455f 5245 4745 582c 206c 6162  PTURE_REGEX, lab
+0000be90: 656c 290a 2020 2020 6578 7472 6163 7465  el).    extracte
+0000bea0: 645f 746f 6b65 6e73 203d 2072 652e 7370  d_tokens = re.sp
+0000beb0: 6c69 7428 464f 524d 5f4c 4556 454c 5f53  lit(FORM_LEVEL_S
+0000bec0: 504c 4954 5f52 4547 4558 2c20 6c61 6265  PLIT_REGEX, labe
+0000bed0: 6c29 5b31 3a5d 0a20 2020 2061 6262 7265  l)[1:].    abbre
+0000bee0: 7669 6174 696f 6e73 203d 2046 4f52 4d5f  viations = FORM_
+0000bef0: 544f 4b45 4e5f 4142 4252 4556 4941 5449  TOKEN_ABBREVIATI
+0000bf00: 4f4e 5320 6966 2064 6566 6175 6c74 5f61  ONS if default_a
+0000bf10: 6262 7265 7669 6174 696f 6e73 2065 6c73  bbreviations els
+0000bf20: 6520 7b7d 0a20 2020 2061 6262 7265 7669  e {}.    abbrevi
+0000bf30: 6174 696f 6e73 2e75 7064 6174 6528 6b77  ations.update(kw
+0000bf40: 6172 6773 290a 2020 2020 7265 7475 726e  args).    return
+0000bf50: 2064 6973 7472 6962 7574 655f 746f 6b65   distribute_toke
+0000bf60: 6e73 5f6f 7665 725f 6c65 7665 6c73 2865  ns_over_levels(e
+0000bf70: 7874 7261 6374 6564 5f6c 6576 656c 732c  xtracted_levels,
+0000bf80: 2065 7874 7261 6374 6564 5f74 6f6b 656e   extracted_token
+0000bf90: 732c 2061 6262 7265 7669 6174 696f 6e73  s, abbreviations
+0000bfa0: 3d61 6262 7265 7669 6174 696f 6e73 290a  =abbreviations).
+0000bfb0: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
+0000bfc0: 6572 0a64 6566 2065 7870 616e 645f 666f  er.def expand_fo
+0000bfd0: 726d 5f6c 6162 656c 7328 666c 3a20 7064  rm_labels(fl: pd
+0000bfe0: 2e44 6174 6146 7261 6d65 2c20 6669 6c6c  .DataFrame, fill
+0000bff0: 5f6d 6e5f 756e 7469 6c3a 2069 6e74 203d  _mn_until: int =
+0000c000: 204e 6f6e 652c 2064 6566 6175 6c74 5f61   None, default_a
+0000c010: 6262 7265 7669 6174 696f 6e73 3d54 7275  bbreviations=Tru
+0000c020: 652c 202a 2a6b 7761 7267 7329 202d 3e20  e, **kwargs) -> 
+0000c030: 7064 2e44 6174 6146 7261 6d65 3a0a 2020  pd.DataFrame:.  
+0000c040: 2020 2222 2220 4578 7061 6e64 7320 666f    """ Expands fo
+0000c050: 726d 206c 6162 656c 7320 696e 746f 2061  rm labels into a
+0000c060: 2068 6965 7261 7263 6869 6361 6c20 7669   hierarchical vi
+0000c070: 6577 206f 6620 6c65 7665 6c73 2069 6e20  ew of levels in 
+0000c080: 6120 7461 626c 652e 0a0a 2020 2020 4172  a table...    Ar
+0000c090: 6773 3a0a 2020 2020 2020 666c 3a20 4120  gs:.      fl: A 
+0000c0a0: 4461 7461 4672 616d 6520 636f 6e74 6169  DataFrame contai
+0000c0b0: 6e69 6e67 2072 6177 2066 6f72 6d20 6c61  ning raw form la
+0000c0c0: 6265 6c73 2061 7320 7265 7472 6965 7665  bels as retrieve
+0000c0d0: 6420 6672 6f6d 203a 6d65 7468 3a60 6d73  d from :meth:`ms
+0000c0e0: 332e 5363 6f72 652e 6d73 6378 2e66 6f72  3.Score.mscx.for
+0000c0f0: 6d5f 6c61 6265 6c73 2829 602e 0a20 2020  m_labels()`..   
+0000c100: 2020 2066 696c 6c5f 6d6e 5f75 6e74 696c     fill_mn_until
+0000c110: 3a20 5061 7373 2074 6865 206c 6173 7420  : Pass the last 
+0000c120: 6d65 6173 7572 6520 6e75 6d62 6572 2069  measure number i
+0000c130: 6620 796f 7520 7761 6e74 2065 7665 7279  f you want every
+0000c140: 206d 6561 7375 7265 206f 6620 7468 6520   measure of the 
+0000c150: 7069 6563 6520 6861 7665 2061 2072 6f77  piece have a row
+0000c160: 2069 6e20 7468 6520 7472 6565 2076 6965   in the tree vie
+0000c170: 772c 0a20 2020 2020 2020 2020 2065 7665  w,.          eve
+0000c180: 6e20 6966 2069 7420 646f 6573 6e27 7420  n if it doesn't 
+0000c190: 636f 6d65 2077 6974 6820 6120 666f 726d  come with a form
+0000c1a0: 206c 6162 656c 2e20 5468 6973 206d 6179   label. This may
+0000c1b0: 2062 6520 6465 7369 7265 6420 666f 7220   be desired for 
+0000c1c0: 696e 6372 6561 7365 6420 696e 7475 6974  increased intuit
+0000c1d0: 696f 6e20 6f66 2070 726f 706f 7274 696f  ion of proportio
+0000c1e0: 6e73 2c0a 2020 2020 2020 2020 2020 7261  ns,.          ra
+0000c1f0: 7468 6572 2074 6861 6e20 7365 6569 6e67  ther than seeing
+0000c200: 2061 6c6c 2066 6f72 6d20 6c61 6265 6c73   all form labels
+0000c210: 2072 6967 6874 2062 656c 6f77 2065 6163   right below eac
+0000c220: 6820 6f74 6865 722e 2049 6e20 6f72 6465  h other. In orde
+0000c230: 7220 746f 2061 6464 2074 6865 2065 6d70  r to add the emp
+0000c240: 7479 2072 6f77 732c 2065 7665 6e20 7769  ty rows, even wi
+0000c250: 7468 6f75 740a 2020 2020 2020 2020 2020  thout.          
+0000c260: 6b6e 6f77 696e 6720 7468 6520 6e75 6d62  knowing the numb
+0000c270: 6572 206f 6620 6d65 6173 7572 6573 2c20  er of measures, 
+0000c280: 7061 7373 202d 312e 0a20 2020 2020 2064  pass -1..      d
+0000c290: 6566 6175 6c74 5f61 6262 7265 7669 6174  efault_abbreviat
+0000c2a0: 696f 6e73 3a20 4279 2064 6566 6175 6c74  ions: By default
+0000c2b0: 2c20 6561 6368 2074 6f6b 656e 2063 6f6d  , each token com
+0000c2c0: 706f 6e65 6e74 2069 7320 6368 6563 6b65  ponent is checke
+0000c2d0: 6420 6167 6169 6e73 7420 6120 6d61 7070  d against a mapp
+0000c2e0: 696e 6720 6672 6f6d 2061 6262 7265 7669  ing from abbrevi
+0000c2f0: 6174 696f 6e73 2074 6f0a 2020 2020 2020  ations to.      
+0000c300: 2020 2020 6c6f 6e67 206e 616d 6573 2e20      long names. 
+0000c310: 5061 7373 2046 616c 7365 2074 6f20 7072  Pass False to pr
+0000c320: 6576 656e 7420 7468 6174 2e0a 2020 2020  event that..    
+0000c330: 2020 2a2a 6b77 6172 6773 3a20 4162 6272    **kwargs: Abbr
+0000c340: 6576 6961 7469 6f6e 3d27 6c6f 6e67 206e  eviation='long n
+0000c350: 616d 6527 206d 6170 7069 6e67 7320 746f  ame' mappings to
+0000c360: 2072 6573 6f6c 7665 2069 6e64 6976 6964   resolve individ
+0000c370: 7561 6c20 6162 6272 6576 6961 7469 6f6e  ual abbreviation
+0000c380: 730a 0a20 2020 2052 6574 7572 6e73 3a0a  s..    Returns:.
+0000c390: 2020 2020 2020 4120 4461 7461 4672 616d        A DataFram
+0000c3a0: 6520 7769 7468 206f 6e65 2063 6f6c 756d  e with one colum
+0000c3b0: 6e20 6164 6465 6420 7065 7220 6869 6572  n added per hier
+0000c3c0: 6172 6368 6963 616c 206c 6179 6572 206f  archical layer o
+0000c3d0: 6620 616e 616c 7973 6973 2c20 7374 6172  f analysis, star
+0000c3e0: 7469 6e67 2066 726f 6d20 6c65 7665 6c20  ting from level 
+0000c3f0: 302e 0a20 2020 2022 2222 0a20 2020 2066  0..    """.    f
+0000c400: 6f72 6d5f 6c61 6265 6c73 203d 2066 6c2e  orm_labels = fl.
+0000c410: 666f 726d 5f6c 6162 656c 2e73 7472 2e72  form_label.str.r
+0000c420: 6570 6c61 6365 2822 2661 6d70 3b22 2c20  eplace("&amp;", 
+0000c430: 2226 222c 2072 6567 6578 3d46 616c 7365  "&", regex=False
+0000c440: 292e 7374 722e 7265 706c 6163 6528 7222  ).str.replace(r"
+0000c450: 5c73 222c 2022 2022 2c20 7265 6765 783d  \s", " ", regex=
+0000c460: 5472 7565 290a 2020 2020 6578 7472 6163  True).    extrac
+0000c470: 7465 645f 6c65 7665 6c73 203d 2066 6f72  ted_levels = for
+0000c480: 6d5f 6c61 6265 6c73 2e73 7472 2e65 7874  m_labels.str.ext
+0000c490: 7261 6374 616c 6c28 464f 524d 5f4c 4556  ractall(FORM_LEV
+0000c4a0: 454c 5f43 4150 5455 5245 5f52 4547 4558  EL_CAPTURE_REGEX
+0000c4b0: 290a 2020 2020 6578 7472 6163 7465 645f  ).    extracted_
+0000c4c0: 6c65 7665 6c73 203d 2065 7874 7261 6374  levels = extract
+0000c4d0: 6564 5f6c 6576 656c 732e 756e 7374 6163  ed_levels.unstac
+0000c4e0: 6b28 292e 7265 696e 6465 7828 666c 2e69  k().reindex(fl.i
+0000c4f0: 6e64 6578 290a 2020 2020 6578 7472 6163  ndex).    extrac
+0000c500: 7465 645f 746f 6b65 6e73 203d 2066 6f72  ted_tokens = for
+0000c510: 6d5f 6c61 6265 6c73 2e73 7472 2e73 706c  m_labels.str.spl
+0000c520: 6974 2846 4f52 4d5f 4c45 5645 4c5f 5350  it(FORM_LEVEL_SP
+0000c530: 4c49 545f 5245 4745 582c 2065 7870 616e  LIT_REGEX, expan
+0000c540: 643d 5472 7565 290a 2020 2020 2320 4348  d=True).    # CH
+0000c550: 4543 4b53 3a0a 2020 2020 2320 6578 7472  ECKS:.    # extr
+0000c560: 6163 7465 645f 746f 6b65 6e73 2e61 7070  acted_tokens.app
+0000c570: 6c79 286c 616d 6264 6120 533a 2053 2e73  ly(lambda S: S.s
+0000c580: 7472 2e63 6f6e 7461 696e 7328 7227 283f  tr.contains(r'(?
+0000c590: 3c21 5b69 7876 5d29 3a27 292e 6669 6c6c  <![ixv]):').fill
+0000c5a0: 6e61 2846 616c 7365 2929 2e61 6e79 2861  na(False)).any(a
+0000c5b0: 7869 733d 3129 0a20 2020 2023 2065 7874  xis=1).    # ext
+0000c5c0: 7261 6374 6564 5f74 6f6b 656e 735b 6578  racted_tokens[ex
+0000c5d0: 7472 6163 7465 645f 746f 6b65 6e73 5b30  tracted_tokens[0
+0000c5e0: 5d20 213d 2027 275d 0a20 2020 2023 2066  ] != ''].    # f
+0000c5f0: 6c5b 666c 2e66 6f72 6d5f 6c61 6265 6c2e  l[fl.form_label.
+0000c600: 7374 722e 636f 6e74 6169 6e73 2827 3a26  str.contains(':&
+0000c610: 2729 5d0a 2020 2020 6578 7472 6163 7465  ')].    extracte
+0000c620: 645f 746f 6b65 6e73 203d 2065 7874 7261  d_tokens = extra
+0000c630: 6374 6564 5f74 6f6b 656e 732e 6472 6f70  cted_tokens.drop
+0000c640: 2863 6f6c 756d 6e73 3d30 290a 2020 2020  (columns=0).    
+0000c650: 6173 7365 7274 2028 6578 7472 6163 7465  assert (extracte
+0000c660: 645f 746f 6b65 6e73 2e69 6e64 6578 203d  d_tokens.index =
+0000c670: 3d20 6578 7472 6163 7465 645f 6c65 7665  = extracted_leve
+0000c680: 6c73 2e69 6e64 6578 292e 616c 6c28 292c  ls.index).all(),
+0000c690: 2022 496e 6469 6365 7320 6e65 6564 2074   "Indices need t
+0000c6a0: 6f20 6265 2069 6465 6e74 6963 616c 2061  o be identical a
+0000c6b0: 6674 6572 2072 6567 6578 2065 7874 7261  fter regex extra
+0000c6c0: 6374 696f 6e2e 220a 2020 2020 7265 7375  ction.".    resu
+0000c6d0: 6c74 5f64 6963 7420 3d20 7b7d 0a20 2020  lt_dict = {}.   
+0000c6e0: 2061 6262 7265 7669 6174 696f 6e73 203d   abbreviations =
+0000c6f0: 2046 4f52 4d5f 544f 4b45 4e5f 4142 4252   FORM_TOKEN_ABBR
+0000c700: 4556 4941 5449 4f4e 5320 6966 2064 6566  EVIATIONS if def
+0000c710: 6175 6c74 5f61 6262 7265 7669 6174 696f  ault_abbreviatio
+0000c720: 6e73 2065 6c73 6520 7b7d 0a20 2020 2061  ns else {}.    a
+0000c730: 6262 7265 7669 6174 696f 6e73 2e75 7064  bbreviations.upd
+0000c740: 6174 6528 6b77 6172 6773 290a 2020 2020  ate(kwargs).    
+0000c750: 666f 7220 6d63 2c20 2869 2c20 6c76 6c73  for mc, (i, lvls
+0000c760: 292c 2028 5f2c 2074 6b6e 7329 2069 6e20  ), (_, tkns) in 
+0000c770: 7a69 7028 666c 2e6d 632c 2065 7874 7261  zip(fl.mc, extra
+0000c780: 6374 6564 5f6c 6576 656c 732e 6974 6572  cted_levels.iter
+0000c790: 726f 7773 2829 2c20 6578 7472 6163 7465  rows(), extracte
+0000c7a0: 645f 746f 6b65 6e73 2e69 7465 7272 6f77  d_tokens.iterrow
+0000c7b0: 7328 2929 3a0a 2020 2020 2020 2020 6c65  s()):.        le
+0000c7c0: 7665 6c5f 7365 6c65 6374 2c20 746f 6b65  vel_select, toke
+0000c7d0: 6e5f 7365 6c65 6374 203d 206c 766c 732e  n_select = lvls.
+0000c7e0: 6e6f 746e 6128 292c 2074 6b6e 732e 6e6f  notna(), tkns.no
+0000c7f0: 746e 6128 290a 2020 2020 2020 2020 7072  tna().        pr
+0000c800: 6573 656e 745f 6c65 7665 6c73 2c20 7072  esent_levels, pr
+0000c810: 6573 656e 745f 746f 6b65 6e73 203d 206c  esent_tokens = l
+0000c820: 766c 735b 6c65 7665 6c5f 7365 6c65 6374  vls[level_select
+0000c830: 5d2c 2074 6b6e 735b 746f 6b65 6e5f 7365  ], tkns[token_se
+0000c840: 6c65 6374 5d0a 2020 2020 2020 2020 6173  lect].        as
+0000c850: 7365 7274 206c 6576 656c 5f73 656c 6563  sert level_selec
+0000c860: 742e 7375 6d28 2920 3d3d 2074 6f6b 656e  t.sum() == token
+0000c870: 5f73 656c 6563 742e 7375 6d28 292c 2066  _select.sum(), f
+0000c880: 224d 4320 7b6d 637d 3a20 7b6c 6576 656c  "MC {mc}: {level
+0000c890: 5f73 656c 6563 742e 7375 6d28 297d 206c  _select.sum()} l
+0000c8a0: 6576 656c 735c 6e7b 7072 6573 656e 745f  evels\n{present_
+0000c8b0: 6c65 7665 6c73 7d5c 6e62 7574 207b 746f  levels}\nbut {to
+0000c8c0: 6b65 6e5f 7365 6c65 6374 2e73 756d 2829  ken_select.sum()
+0000c8d0: 7d20 746f 6b65 6e73 3a5c 6e7b 7072 6573  } tokens:\n{pres
+0000c8e0: 656e 745f 746f 6b65 6e73 7d22 0a20 2020  ent_tokens}".   
+0000c8f0: 2020 2020 2072 6573 756c 745f 6469 6374       result_dict
+0000c900: 5b69 5d20 3d20 6469 7374 7269 6275 7465  [i] = distribute
+0000c910: 5f74 6f6b 656e 735f 6f76 6572 5f6c 6576  _tokens_over_lev
+0000c920: 656c 7328 7072 6573 656e 745f 6c65 7665  els(present_leve
+0000c930: 6c73 2c20 7072 6573 656e 745f 746f 6b65  ls, present_toke
+0000c940: 6e73 2c20 6d63 3d6d 632c 2061 6262 7265  ns, mc=mc, abbre
+0000c950: 7669 6174 696f 6e73 3d61 6262 7265 7669  viations=abbrevi
+0000c960: 6174 696f 6e73 2c20 6c6f 6767 6572 3d6c  ations, logger=l
+0000c970: 6f67 6765 7229 0a20 2020 2072 6573 203d  ogger).    res =
+0000c980: 2070 642e 4461 7461 4672 616d 652e 6672   pd.DataFrame.fr
+0000c990: 6f6d 5f64 6963 7428 7265 7375 6c74 5f64  om_dict(result_d
+0000c9a0: 6963 742c 206f 7269 656e 743d 2769 6e64  ict, orient='ind
+0000c9b0: 6578 2729 0a20 2020 2072 6573 2e63 6f6c  ex').    res.col
+0000c9c0: 756d 6e73 203d 2070 642e 4d75 6c74 6949  umns = pd.MultiI
+0000c9d0: 6e64 6578 2e66 726f 6d5f 7475 706c 6573  ndex.from_tuples
+0000c9e0: 2872 6573 2e63 6f6c 756d 6e73 290a 2020  (res.columns).  
+0000c9f0: 2020 666f 726d 5f74 7970 6573 203d 2072    form_types = r
+0000ca00: 6573 2e63 6f6c 756d 6e73 2e6c 6576 656c  es.columns.level
+0000ca10: 735b 305d 0a20 2020 2069 6620 6c65 6e28  s[0].    if len(
+0000ca20: 666f 726d 5f74 7970 6573 2920 3e20 313a  form_types) > 1:
+0000ca30: 0a20 2020 2020 2020 2023 2063 6f6c 756d  .        # colum
+0000ca40: 6e73 2077 696c 6c20 6265 204d 756c 7469  ns will be Multi
+0000ca50: 496e 6465 780a 2020 2020 2020 2020 6966  Index.        if
+0000ca60: 2027 2720 696e 2066 6f72 6d5f 7479 7065   '' in form_type
+0000ca70: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
+0000ca80: 2074 6865 7265 2061 7265 206c 6162 656c   there are label
+0000ca90: 7320 7065 7274 6169 6e69 6e67 2074 6f20  s pertaining to 
+0000caa0: 616c 6c20 666f 726d 5f74 7970 6573 0a20  all form_types. 
+0000cab0: 2020 2020 2020 2020 2020 2066 6f72 6d73             forms
+0000cac0: 203d 205b 6620 666f 7220 6620 696e 2066   = [f for f in f
+0000cad0: 6f72 6d5f 7479 7065 7320 6966 2066 2021  orm_types if f !
+0000cae0: 3d20 2727 5d0a 2020 2020 2020 2020 2020  = ''].          
+0000caf0: 2020 7065 7274 6169 6e69 6e67 5f74 6f5f    pertaining_to_
+0000cb00: 616c 6c20 3d20 7265 732e 6c6f 635b 3a2c  all = res.loc[:,
+0000cb10: 2027 275d 0a20 2020 2020 2020 2020 2020   ''].           
+0000cb20: 2064 6973 7472 6962 7574 6564 5f74 6f5f   distributed_to_
+0000cb30: 616c 6c20 3d20 7064 2e63 6f6e 6361 7428  all = pd.concat(
+0000cb40: 5b70 6572 7461 696e 696e 675f 746f 5f61  [pertaining_to_a
+0000cb50: 6c6c 5d20 2a20 6c65 6e28 666f 726d 7329  ll] * len(forms)
+0000cb60: 2c20 6b65 7973 3d66 6f72 6d73 2c20 6178  , keys=forms, ax
+0000cb70: 6973 3d31 290a 2020 2020 2020 2020 2020  is=1).          
+0000cb80: 2020 6c65 7665 6c5f 6578 6973 7473 203d    level_exists =
+0000cb90: 2064 6973 7472 6962 7574 6564 5f74 6f5f   distributed_to_
+0000cba0: 616c 6c2e 636f 6c75 6d6e 732e 6973 696e  all.columns.isin
+0000cbb0: 2872 6573 2e63 6f6c 756d 6e73 290a 2020  (res.columns).  
+0000cbc0: 2020 2020 2020 2020 2020 6578 6973 7469            existi
+0000cbd0: 6e67 5f6c 6576 656c 5f6e 616d 6573 203d  ng_level_names =
+0000cbe0: 2064 6973 7472 6962 7574 6564 5f74 6f5f   distributed_to_
+0000cbf0: 616c 6c2e 636f 6c75 6d6e 735b 6c65 7665  all.columns[leve
+0000cc00: 6c5f 6578 6973 7473 5d0a 2020 2020 2020  l_exists].      
+0000cc10: 2020 2020 2020 7265 7320 3d20 7064 2e63        res = pd.c
+0000cc20: 6f6e 6361 7428 5b72 6573 2e6c 6f63 5b3a  oncat([res.loc[:
+0000cc30: 2c20 666f 726d 735d 2c0a 2020 2020 2020  , forms],.      
+0000cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc50: 2020 2020 2020 2064 6973 7472 6962 7574         distribut
+0000cc60: 6564 5f74 6f5f 616c 6c2e 6c6f 635b 3a2c  ed_to_all.loc[:,
+0000cc70: 207e 6c65 7665 6c5f 6578 6973 7473 5d5d   ~level_exists]]
+0000cc80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cc90: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+0000cca0: 6973 3d31 290a 2020 2020 2020 2020 2020  is=1).          
+0000ccb0: 2020 706f 7465 6e74 6961 6c6c 795f 7072    potentially_pr
+0000ccc0: 6565 7869 7374 656e 7420 3d20 6469 7374  eexistent = dist
+0000ccd0: 7269 6275 7465 645f 746f 5f61 6c6c 2e6c  ributed_to_all.l
+0000cce0: 6f63 5b3a 2c20 6c65 7665 6c5f 6578 6973  oc[:, level_exis
+0000ccf0: 7473 5d0a 2020 2020 2020 2020 2020 2020  ts].            
+0000cd00: 6368 6563 6b5f 646f 7562 6c65 5f61 7474  check_double_att
+0000cd10: 7269 6275 7469 6f6e 203d 2072 6573 5b65  ribution = res[e
+0000cd20: 7869 7374 696e 675f 6c65 7665 6c5f 6e61  xisting_level_na
+0000cd30: 6d65 735d 2e6e 6f74 6e61 2829 2026 2070  mes].notna() & p
+0000cd40: 6f74 656e 7469 616c 6c79 5f70 7265 6578  otentially_preex
+0000cd50: 6973 7465 6e74 2e6e 6f74 6e61 2829 0a20  istent.notna(). 
+0000cd60: 2020 2020 2020 2020 2020 2069 6620 6368             if ch
+0000cd70: 6563 6b5f 646f 7562 6c65 5f61 7474 7269  eck_double_attri
+0000cd80: 6275 7469 6f6e 2e61 6e79 2829 2e61 6e79  bution.any().any
+0000cd90: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0000cda0: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
+0000cdb0: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
+0000cdc0: 2020 2020 2020 2020 2244 6964 206e 6f74          "Did not
+0000cdd0: 2064 6973 7472 6962 7574 6520 6c65 7665   distribute leve
+0000cde0: 6c73 2074 6f20 616c 6c20 666f 726d 2074  ls to all form t
+0000cdf0: 7970 6573 2062 6563 6175 7365 2073 6f6d  ypes because som
+0000ce00: 6520 6861 6420 616c 7265 6164 7920 6265  e had already be
+0000ce10: 656e 2069 6e64 6976 6964 7561 6c6c 7920  en individually 
+0000ce20: 7370 6563 6966 6965 642e 2229 0a20 2020  specified.").   
+0000ce30: 2020 2020 2020 2020 2072 6573 2e6c 6f63           res.loc
+0000ce40: 5b3a 2c20 6578 6973 7469 6e67 5f6c 6576  [:, existing_lev
+0000ce50: 656c 5f6e 616d 6573 5d20 3d20 7265 735b  el_names] = res[
+0000ce60: 6578 6973 7469 6e67 5f6c 6576 656c 5f6e  existing_level_n
+0000ce70: 616d 6573 5d2e 6669 6c6c 6e61 2870 6f74  ames].fillna(pot
+0000ce80: 656e 7469 616c 6c79 5f70 7265 6578 6973  entially_preexis
+0000ce90: 7465 6e74 290a 2020 2020 2020 2020 666c  tent).        fl
+0000cea0: 5f6d 756c 7469 696e 6465 7820 3d20 7064  _multiindex = pd
+0000ceb0: 2e63 6f6e 6361 7428 5b66 6c5d 2c20 6b65  .concat([fl], ke
+0000cec0: 7973 3d5b 2727 5d2c 2061 7869 733d 3129  ys=[''], axis=1)
+0000ced0: 0a20 2020 2020 2020 2072 6573 203d 2070  .        res = p
+0000cee0: 642e 636f 6e63 6174 285b 666c 5f6d 756c  d.concat([fl_mul
+0000cef0: 7469 696e 6465 782c 2072 6573 2e73 6f72  tiindex, res.sor
+0000cf00: 745f 696e 6465 7828 6178 6973 3d31 295d  t_index(axis=1)]
+0000cf10: 2c20 6178 6973 3d31 290a 2020 2020 656c  , axis=1).    el
+0000cf20: 7365 3a0a 2020 2020 2020 2020 6966 2066  se:.        if f
+0000cf30: 6f72 6d5f 7479 7065 735b 305d 203d 3d20  orm_types[0] == 
+0000cf40: 2727 3a0a 2020 2020 2020 2020 2020 2020  '':.            
+0000cf50: 7265 7320 3d20 7064 2e63 6f6e 6361 7428  res = pd.concat(
+0000cf60: 5b66 6c2c 2072 6573 2e64 726f 706c 6576  [fl, res.droplev
+0000cf70: 656c 2830 2c20 6178 6973 3d31 292e 736f  el(0, axis=1).so
+0000cf80: 7274 5f69 6e64 6578 2861 7869 733d 3129  rt_index(axis=1)
+0000cf90: 5d2c 2061 7869 733d 3129 0a20 2020 2020  ], axis=1).     
+0000cfa0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000cfb0: 2020 2020 2072 6573 203d 2070 642e 636f       res = pd.co
+0000cfc0: 6e63 6174 285b 666c 2c20 7265 732e 736f  ncat([fl, res.so
+0000cfd0: 7274 5f69 6e64 6578 2861 7869 733d 3129  rt_index(axis=1)
+0000cfe0: 5d2c 2061 7869 733d 3129 0a20 2020 2020  ], axis=1).     
+0000cff0: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
+0000d000: 666f 2866 2253 796e 7461 7820 666f 7220  fo(f"Syntax for 
+0000d010: 7365 7665 7261 6c20 666f 726d 2074 7970  several form typ
+0000d020: 6573 2075 7365 6420 666f 7220 6120 7369  es used for a si
+0000d030: 6e67 6c65 206f 6e65 3a20 277b 666f 726d  ngle one: '{form
+0000d040: 5f74 7970 6573 5b30 5d7d 2722 290a 0a20  _types[0]}'").. 
+0000d050: 2020 2069 6620 6669 6c6c 5f6d 6e5f 756e     if fill_mn_un
+0000d060: 7469 6c20 6973 206e 6f74 204e 6f6e 653a  til is not None:
+0000d070: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0000d080: 666f 726d 5f74 7970 6573 2920 3d3d 2031  form_types) == 1
+0000d090: 3a0a 2020 2020 2020 2020 2020 2020 6d6e  :.            mn
+0000d0a0: 5f63 6f6c 2c20 6d6e 5f6f 6e73 6574 203d  _col, mn_onset =
+0000d0b0: 2027 6d6e 272c 2027 6d6e 5f6f 6e73 6574   'mn', 'mn_onset
+0000d0c0: 270a 2020 2020 2020 2020 656c 7365 3a0a  '.        else:.
+0000d0d0: 2020 2020 2020 2020 2020 2020 6d6e 5f63              mn_c
+0000d0e0: 6f6c 2c20 6d6e 5f6f 6e73 6574 203d 2028  ol, mn_onset = (
+0000d0f0: 2727 2c20 276d 6e27 292c 2028 2727 2c20  '', 'mn'), ('', 
+0000d100: 276d 6e5f 6f6e 7365 7427 290a 2020 2020  'mn_onset').    
+0000d110: 2020 2020 6669 7273 745f 6d6e 203d 2066      first_mn = f
+0000d120: 6c2e 6d6e 2e6d 696e 2829 0a20 2020 2020  l.mn.min().     
+0000d130: 2020 206c 6173 745f 6d6e 203d 2066 696c     last_mn = fil
+0000d140: 6c5f 6d6e 5f75 6e74 696c 2069 6620 6669  l_mn_until if fi
+0000d150: 6c6c 5f6d 6e5f 756e 7469 6c20 3e20 2d31  ll_mn_until > -1
+0000d160: 2065 6c73 6520 666c 2e6d 6e2e 6d61 7828   else fl.mn.max(
+0000d170: 290a 2020 2020 2020 2020 616c 6c5f 6d6e  ).        all_mn
+0000d180: 7320 3d20 7365 7428 7261 6e67 6528 6669  s = set(range(fi
+0000d190: 7273 745f 6d6e 2c20 6c61 7374 5f6d 6e20  rst_mn, last_mn 
+0000d1a0: 2b20 3129 290a 2020 2020 2020 2020 6d69  + 1)).        mi
+0000d1b0: 7373 696e 6720 3d20 616c 6c5f 6d6e 732e  ssing = all_mns.
+0000d1c0: 6469 6666 6572 656e 6365 2873 6574 2872  difference(set(r
+0000d1d0: 6573 5b6d 6e5f 636f 6c5d 2929 0a20 2020  es[mn_col])).   
+0000d1e0: 2020 2020 206d 6973 7369 6e67 5f6d 6e20       missing_mn 
+0000d1f0: 3d20 7064 2e44 6174 6146 7261 6d65 287b  = pd.DataFrame({
+0000d200: 6d6e 5f63 6f6c 3a20 6c69 7374 286d 6973  mn_col: list(mis
+0000d210: 7369 6e67 297d 292e 7265 696e 6465 7828  sing)}).reindex(
+0000d220: 7265 732e 636f 6c75 6d6e 732c 2061 7869  res.columns, axi
+0000d230: 733d 3129 0a20 2020 2020 2020 2072 6573  s=1).        res
+0000d240: 203d 2070 642e 636f 6e63 6174 285b 7265   = pd.concat([re
+0000d250: 732c 206d 6973 7369 6e67 5f6d 6e5d 2c20  s, missing_mn], 
+0000d260: 6967 6e6f 7265 5f69 6e64 6578 3d54 7275  ignore_index=Tru
+0000d270: 6529 2e73 6f72 745f 7661 6c75 6573 285b  e).sort_values([
+0000d280: 6d6e 5f63 6f6c 2c20 6d6e 5f6f 6e73 6574  mn_col, mn_onset
+0000d290: 5d29 2e72 6573 6574 5f69 6e64 6578 2864  ]).reset_index(d
+0000d2a0: 726f 703d 5472 7565 290a 2020 2020 7265  rop=True).    re
+0000d2b0: 7475 726e 2072 6573 0a0a 406f 7665 726c  turn res..@overl
+0000d2c0: 6f61 640a 6465 6620 6164 645f 636f 6c6c  oad.def add_coll
+0000d2d0: 6563 7469 6f6e 7328 6c65 6674 3a20 7064  ections(left: pd
+0000d2e0: 2e53 6572 6965 732c 2072 6967 6874 3a20  .Series, right: 
+0000d2f0: 436f 6c6c 6563 7469 6f6e 2c20 6474 7970  Collection, dtyp
+0000d300: 653a 2044 7479 7065 2920 2d3e 2070 642e  e: Dtype) -> pd.
+0000d310: 5365 7269 6573 3a0a 2020 2020 2e2e 2e0a  Series:.    ....
+0000d320: 406f 7665 726c 6f61 640a 6465 6620 6164  @overload.def ad
+0000d330: 645f 636f 6c6c 6563 7469 6f6e 7328 6c65  d_collections(le
+0000d340: 6674 3a20 4e44 4172 7261 792c 2072 6967  ft: NDArray, rig
+0000d350: 6874 3a20 436f 6c6c 6563 7469 6f6e 2c20  ht: Collection, 
+0000d360: 6474 7970 653a 2044 7479 7065 2920 2d3e  dtype: Dtype) ->
+0000d370: 204e 4441 7272 6179 3a0a 2020 2020 2e2e   NDArray:.    ..
+0000d380: 2e0a 406f 7665 726c 6f61 640a 6465 6620  ..@overload.def 
+0000d390: 6164 645f 636f 6c6c 6563 7469 6f6e 7328  add_collections(
+0000d3a0: 6c65 6674 3a20 6c69 7374 2c20 7269 6768  left: list, righ
+0000d3b0: 743a 2043 6f6c 6c65 6374 696f 6e2c 2064  t: Collection, d
+0000d3c0: 7479 7065 3a20 4474 7970 6529 202d 3e20  type: Dtype) -> 
+0000d3d0: 6c69 7374 3a0a 2020 2020 2e2e 2e0a 406f  list:.    ....@o
+0000d3e0: 7665 726c 6f61 640a 6465 6620 6164 645f  verload.def add_
+0000d3f0: 636f 6c6c 6563 7469 6f6e 7328 6c65 6674  collections(left
+0000d400: 3a20 7475 706c 652c 2072 6967 6874 3a20  : tuple, right: 
+0000d410: 436f 6c6c 6563 7469 6f6e 2c20 6474 7970  Collection, dtyp
+0000d420: 653a 2044 7479 7065 2920 2d3e 2074 7570  e: Dtype) -> tup
+0000d430: 6c65 3a0a 2020 2020 2e2e 2e0a 6465 6620  le:.    ....def 
+0000d440: 6164 645f 636f 6c6c 6563 7469 6f6e 7328  add_collections(
+0000d450: 6c65 6674 3a20 556e 696f 6e5b 7064 2e53  left: Union[pd.S
+0000d460: 6572 6965 732c 204e 4441 7272 6179 2c20  eries, NDArray, 
+0000d470: 6c69 7374 2c20 7475 706c 655d 2c0a 2020  list, tuple],.  
+0000d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d490: 2020 7269 6768 743a 2043 6f6c 6c65 6374    right: Collect
+0000d4a0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+0000d4b0: 2020 2020 2020 2020 2064 7479 7065 3a20           dtype: 
+0000d4c0: 4474 7970 6520 3d20 2773 7472 696e 6727  Dtype = 'string'
+0000d4d0: 2920 2d3e 2055 6e69 6f6e 5b70 642e 5365  ) -> Union[pd.Se
+0000d4e0: 7269 6573 2c20 4e44 4172 7261 792c 206c  ries, NDArray, l
+0000d4f0: 6973 742c 2074 7570 6c65 5d3a 0a20 2020  ist, tuple]:.   
+0000d500: 2022 2222 5a69 702d 6164 6473 2074 6f67   """Zip-adds tog
+0000d510: 6574 6865 7220 7468 6520 7374 7269 6e67  ether the string
+0000d520: 7320 2862 7920 6465 6661 756c 7429 2063  s (by default) c
+0000d530: 6f6e 7461 696e 6564 2069 6e20 7477 6f20  ontained in two 
+0000d540: 636f 6c6c 6563 7469 6f6e 7320 7265 6761  collections rega
+0000d550: 7264 6c65 7373 206f 6620 7468 6569 7220  rdless of their 
+0000d560: 7479 7065 7320 2874 6869 6e6b 206f 6620  types (think of 
+0000d570: 6164 6469 6e67 0a20 2020 2074 776f 2063  adding.    two c
+0000d580: 6f6c 756d 6e73 2074 6f67 6574 6865 7220  olumns together 
+0000d590: 656c 656d 656e 742d 7769 7365 292e 2050  element-wise). P
+0000d5a0: 6173 7320 616e 6f74 6865 7220 6060 6474  ass another ``dt
+0000d5b0: 7970 6560 6020 6966 2079 6f75 2077 616e  ype`` if you wan
+0000d5c0: 7420 7468 6520 7661 6c75 6573 2074 6f20  t the values to 
+0000d5d0: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
+0000d5e0: 616e 6f74 6865 720a 2020 2020 6461 7461  another.    data
+0000d5f0: 7479 7065 2062 6566 6f72 6520 6164 6469  type before addi
+0000d600: 6e67 2074 6865 6d20 746f 6765 7468 6572  ng them together
+0000d610: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
+0000d620: 2069 7369 6e73 7461 6e63 6528 6c65 6674   isinstance(left
+0000d630: 2c20 7064 2e53 6572 6965 7329 2061 6e64  , pd.Series) and
+0000d640: 2069 7369 6e73 7461 6e63 6528 7269 6768   isinstance(righ
+0000d650: 742c 2070 642e 5365 7269 6573 293a 0a20  t, pd.Series):. 
+0000d660: 2020 2020 2020 206c 6566 742e 6173 7479         left.asty
+0000d670: 7065 2864 7479 7065 2920 2b20 7269 6768  pe(dtype) + righ
+0000d680: 742e 6173 7479 7065 2864 7479 7065 290a  t.astype(dtype).
+0000d690: 2020 2020 7265 7375 6c74 5f73 6572 6965      result_serie
+0000d6a0: 7320 3d20 7064 2e53 6572 6965 7328 6c65  s = pd.Series(le
+0000d6b0: 6674 2c20 6474 7970 653d 6474 7970 6529  ft, dtype=dtype)
+0000d6c0: 202b 2070 642e 5365 7269 6573 2872 6967   + pd.Series(rig
+0000d6d0: 6874 2c20 6474 7970 653d 6474 7970 6529  ht, dtype=dtype)
+0000d6e0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+0000d6f0: 2020 7265 7475 726e 206c 6566 742e 5f5f    return left.__
+0000d700: 636c 6173 735f 5f28 7265 7375 6c74 5f73  class__(result_s
+0000d710: 6572 6965 732e 746f 5f6c 6973 7428 2929  eries.to_list())
+0000d720: 0a20 2020 2065 7863 6570 7420 2854 7970  .    except (Typ
+0000d730: 6545 7272 6f72 2c20 5661 6c75 6545 7272  eError, ValueErr
+0000d740: 6f72 293a 0a20 2020 2020 2020 2072 6574  or):.        ret
+0000d750: 7572 6e20 7265 7375 6c74 5f73 6572 6965  urn result_serie
+0000d760: 732e 7661 6c75 6573 0a0a 406f 7665 726c  s.values..@overl
+0000d770: 6f61 640a 6465 6620 6361 7374 3263 6f6c  oad.def cast2col
+0000d780: 6c65 6374 696f 6e28 636f 6c6c 3a20 7064  lection(coll: pd
+0000d790: 2e53 6572 6965 732c 2066 756e 633a 2043  .Series, func: C
+0000d7a0: 616c 6c61 626c 652c 202a 6172 6773 2c20  allable, *args, 
+0000d7b0: 2a2a 6b77 6172 6773 2920 2d3e 2070 642e  **kwargs) -> pd.
+0000d7c0: 5365 7269 6573 3a0a 2020 2020 2e2e 2e0a  Series:.    ....
+0000d7d0: 406f 7665 726c 6f61 640a 6465 6620 6361  @overload.def ca
+0000d7e0: 7374 3263 6f6c 6c65 6374 696f 6e28 636f  st2collection(co
+0000d7f0: 6c6c 3a20 4e44 4172 7261 792c 2066 756e  ll: NDArray, fun
+0000d800: 633a 2043 616c 6c61 626c 652c 202a 6172  c: Callable, *ar
+0000d810: 6773 2c20 2a2a 6b77 6172 6773 2920 2d3e  gs, **kwargs) ->
+0000d820: 204e 4441 7272 6179 3a0a 2020 2020 2e2e   NDArray:.    ..
+0000d830: 2e0a 406f 7665 726c 6f61 640a 6465 6620  ..@overload.def 
+0000d840: 6361 7374 3263 6f6c 6c65 6374 696f 6e28  cast2collection(
+0000d850: 636f 6c6c 3a20 6c69 7374 2c20 6675 6e63  coll: list, func
+0000d860: 3a20 4361 6c6c 6162 6c65 2c20 2a61 7267  : Callable, *arg
+0000d870: 732c 202a 2a6b 7761 7267 7329 202d 3e20  s, **kwargs) -> 
+0000d880: 6c69 7374 3a0a 2020 2020 2e2e 2e0a 406f  list:.    ....@o
+0000d890: 7665 726c 6f61 640a 6465 6620 6361 7374  verload.def cast
+0000d8a0: 3263 6f6c 6c65 6374 696f 6e28 636f 6c6c  2collection(coll
+0000d8b0: 3a20 7475 706c 652c 2066 756e 633a 2043  : tuple, func: C
+0000d8c0: 616c 6c61 626c 652c 202a 6172 6773 2c20  allable, *args, 
+0000d8d0: 2a2a 6b77 6172 6773 2920 2d3e 2074 7570  **kwargs) -> tup
+0000d8e0: 6c65 3a0a 2020 2020 2e2e 2e0a 6465 6620  le:.    ....def 
+0000d8f0: 6361 7374 3263 6f6c 6c65 6374 696f 6e28  cast2collection(
+0000d900: 636f 6c6c 3a20 556e 696f 6e5b 7064 2e53  coll: Union[pd.S
+0000d910: 6572 6965 732c 204e 4441 7272 6179 2c20  eries, NDArray, 
+0000d920: 6c69 7374 2c20 7475 706c 655d 2c20 6675  list, tuple], fu
+0000d930: 6e63 3a20 4361 6c6c 6162 6c65 2c20 2a61  nc: Callable, *a
+0000d940: 7267 732c 202a 2a6b 7761 7267 7329 202d  rgs, **kwargs) -
+0000d950: 3e20 556e 696f 6e5b 7064 2e53 6572 6965  > Union[pd.Serie
+0000d960: 732c 204e 4441 7272 6179 2c20 6c69 7374  s, NDArray, list
+0000d970: 2c20 7475 706c 655d 3a0a 2020 2020 6966  , tuple]:.    if
+0000d980: 2069 7369 6e73 7461 6e63 6528 636f 6c6c   isinstance(coll
+0000d990: 2c20 7064 2e53 6572 6965 7329 3a0a 2020  , pd.Series):.  
+0000d9a0: 2020 2020 2020 7265 7475 726e 2074 7261        return tra
+0000d9b0: 6e73 666f 726d 2863 6f6c 6c2c 2066 756e  nsform(coll, fun
+0000d9c0: 632c 202a 6172 6773 2c20 2a2a 6b77 6172  c, *args, **kwar
+0000d9d0: 6773 290a 2020 2020 7769 7468 2077 6172  gs).    with war
+0000d9e0: 6e69 6e67 732e 6361 7463 685f 7761 726e  nings.catch_warn
+0000d9f0: 696e 6773 2829 3a0a 2020 2020 2020 2020  ings():.        
+0000da00: 2320 7061 6e64 6173 2064 6576 656c 6f70  # pandas develop
+0000da10: 6572 7320 646f 696e 6720 7468 6569 7220  ers doing their 
+0000da20: 6d6f 7374 2061 6e6e 6f79 696e 6720 7468  most annoying th
+0000da30: 696e 6720 3e3a 280a 2020 2020 2020 2020  ing >:(.        
+0000da40: 7761 726e 696e 6773 2e66 696c 7465 7277  warnings.filterw
+0000da50: 6172 6e69 6e67 7328 0a20 2020 2020 2020  arnings(.       
+0000da60: 2020 2020 2022 6967 6e6f 7265 222c 0a20       "ignore",. 
+0000da70: 2020 2020 2020 2020 2020 2063 6174 6567             categ
+0000da80: 6f72 793d 4675 7475 7265 5761 726e 696e  ory=FutureWarnin
+0000da90: 672c 0a20 2020 2020 2020 2020 2020 206d  g,.            m
+0000daa0: 6573 7361 6765 3d28 0a20 2020 2020 2020  essage=(.       
+0000dab0: 2020 2020 2020 2020 2022 2e2a 5468 6520           ".*The 
+0000dac0: 6465 6661 756c 7420 6474 7970 6520 666f  default dtype fo
+0000dad0: 7220 656d 7074 7920 5365 7269 6573 2e2a  r empty Series.*
+0000dae0: 220a 2020 2020 2020 2020 2020 2020 292c  ".            ),
+0000daf0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0000db00: 2020 2072 6573 756c 745f 7365 7269 6573     result_series
+0000db10: 203d 2066 756e 6328 7064 2e53 6572 6965   = func(pd.Serie
+0000db20: 7328 636f 6c6c 292c 202a 6172 6773 2c20  s(coll), *args, 
+0000db30: 2a2a 6b77 6172 6773 290a 2020 2020 7472  **kwargs).    tr
+0000db40: 793a 0a20 2020 2020 2020 2072 6574 7572  y:.        retur
+0000db50: 6e20 636f 6c6c 2e5f 5f63 6c61 7373 5f5f  n coll.__class__
+0000db60: 2872 6573 756c 745f 7365 7269 6573 2e74  (result_series.t
+0000db70: 6f5f 6c69 7374 2829 290a 2020 2020 6578  o_list()).    ex
+0000db80: 6365 7074 2054 7970 6545 7272 6f72 3a0a  cept TypeError:.
+0000db90: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000dba0: 6573 756c 745f 7365 7269 6573 2e76 616c  esult_series.val
+0000dbb0: 7565 730a 0a0a 0a40 6f76 6572 6c6f 6164  ues....@overload
+0000dbc0: 0a64 6566 2066 6966 7468 7332 6163 6328  .def fifths2acc(
+0000dbd0: 6669 6674 6873 3a20 696e 7429 202d 3e20  fifths: int) -> 
+0000dbe0: 7374 723a 0a20 2020 202e 2e2e 0a40 6f76  str:.    ....@ov
+0000dbf0: 6572 6c6f 6164 0a64 6566 2066 6966 7468  erload.def fifth
+0000dc00: 7332 6163 6328 6669 6674 6873 3a20 7064  s2acc(fifths: pd
+0000dc10: 2e53 6572 6965 7329 202d 3e20 7064 2e53  .Series) -> pd.S
+0000dc20: 6572 6965 733a 0a20 2020 202e 2e2e 0a40  eries:.    ....@
+0000dc30: 6f76 6572 6c6f 6164 0a64 6566 2066 6966  overload.def fif
+0000dc40: 7468 7332 6163 6328 6669 6674 6873 3a20  ths2acc(fifths: 
+0000dc50: 4e44 4172 7261 795b 696e 745d 2920 2d3e  NDArray[int]) ->
+0000dc60: 204e 4441 7272 6179 5b73 7472 5d3a 0a20   NDArray[str]:. 
+0000dc70: 2020 202e 2e2e 0a40 6f76 6572 6c6f 6164     ....@overload
+0000dc80: 0a64 6566 2066 6966 7468 7332 6163 6328  .def fifths2acc(
+0000dc90: 6669 6674 6873 3a20 4c69 7374 5b69 6e74  fifths: List[int
+0000dca0: 5d29 202d 3e20 4c69 7374 5b73 7472 5d3a  ]) -> List[str]:
+0000dcb0: 0a20 2020 202e 2e2e 0a40 6f76 6572 6c6f  .    ....@overlo
+0000dcc0: 6164 0a64 6566 2066 6966 7468 7332 6163  ad.def fifths2ac
+0000dcd0: 6328 6669 6674 6873 3a20 5475 706c 655b  c(fifths: Tuple[
+0000dce0: 696e 745d 2920 2d3e 2054 7570 6c65 5b73  int]) -> Tuple[s
+0000dcf0: 7472 5d3a 0a20 2020 202e 2e2e 0a64 6566  tr]:.    ....def
+0000dd00: 2066 6966 7468 7332 6163 6328 6669 6674   fifths2acc(fift
+0000dd10: 6873 3a20 556e 696f 6e5b 696e 742c 2070  hs: Union[int, p
+0000dd20: 642e 5365 7269 6573 2c20 4e44 4172 7261  d.Series, NDArra
+0000dd30: 795b 696e 745d 2c20 4c69 7374 5b69 6e74  y[int], List[int
+0000dd40: 5d2c 2054 7570 6c65 5b69 6e74 5d5d 2920  ], Tuple[int]]) 
+0000dd50: 2d3e 2055 6e69 6f6e 5b73 7472 2c20 7064  -> Union[str, pd
+0000dd60: 2e53 6572 6965 732c 204e 4441 7272 6179  .Series, NDArray
+0000dd70: 5b73 7472 5d2c 204c 6973 745b 7374 725d  [str], List[str]
+0000dd80: 2c20 5475 706c 655b 7374 725d 5d3a 0a20  , Tuple[str]]:. 
+0000dd90: 2020 2022 2222 2052 6574 7572 6e73 2061     """ Returns a
+0000dda0: 6363 6964 656e 7461 6c73 2066 6f72 2061  ccidentals for a
+0000ddb0: 2073 7461 636b 206f 6620 6669 6674 6873   stack of fifths
+0000ddc0: 2074 6861 7420 6361 6e20 6265 2063 6f6d   that can be com
+0000ddd0: 6269 6e65 6420 7769 7468 2061 0a20 2020  bined with a.   
+0000dde0: 2020 2020 2062 6173 6963 2072 6570 7265       basic repre
+0000ddf0: 7365 6e74 6174 696f 6e20 6f66 2074 6865  sentation of the
+0000de00: 2073 6576 656e 2073 7465 7073 2e22 2222   seven steps."""
+0000de10: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+0000de20: 2020 6669 6674 6873 203d 2069 6e74 2866    fifths = int(f
+0000de30: 6c6f 6174 2866 6966 7468 7329 290a 2020  loat(fifths)).  
+0000de40: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
+0000de50: 6f72 3a0a 2020 2020 2020 2020 7265 7475  or:.        retu
+0000de60: 726e 2063 6173 7432 636f 6c6c 6563 7469  rn cast2collecti
+0000de70: 6f6e 2863 6f6c 6c3d 6669 6674 6873 2c20  on(coll=fifths, 
+0000de80: 6675 6e63 3d66 6966 7468 7332 6163 6329  func=fifths2acc)
+0000de90: 0a20 2020 2061 6363 203d 2028 6669 6674  .    acc = (fift
+0000dea0: 6873 202b 2031 2920 2f2f 2037 0a20 2020  hs + 1) // 7.   
+0000deb0: 2072 6574 7572 6e20 6162 7328 6163 6329   return abs(acc)
+0000dec0: 202a 2027 6227 2069 6620 6163 6320 3c20   * 'b' if acc < 
+0000ded0: 3020 656c 7365 2061 6363 202a 2027 2327  0 else acc * '#'
+0000dee0: 0a0a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  ...@function_log
+0000def0: 6765 720a 6465 6620 6669 6674 6873 3269  ger.def fifths2i
+0000df00: 7628 6669 6674 6873 3a20 696e 742c 0a20  v(fifths: int,. 
+0000df10: 2020 2020 2020 2020 2020 2020 736d 616c              smal
+0000df20: 6c65 7374 3a20 626f 6f6c 203d 2046 616c  lest: bool = Fal
+0000df30: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+0000df40: 2070 6572 6665 6374 3a20 7374 7220 3d20   perfect: str = 
+0000df50: 2750 272c 0a20 2020 2020 2020 2020 2020  'P',.           
+0000df60: 2020 6d61 6a6f 723a 2073 7472 203d 2027    major: str = '
+0000df70: 4d27 2c0a 2020 2020 2020 2020 2020 2020  M',.            
+0000df80: 206d 696e 6f72 3a20 7374 7220 3d20 276d   minor: str = 'm
+0000df90: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0000dfa0: 6175 676d 656e 7465 643a 2073 7472 203d  augmented: str =
+0000dfb0: 2027 6127 2c0a 2020 2020 2020 2020 2020   'a',.          
+0000dfc0: 2020 2064 696d 696e 6973 6865 643a 2073     diminished: s
+0000dfd0: 7472 203d 2027 6427 2920 2d3e 2073 7472  tr = 'd') -> str
+0000dfe0: 3a0a 2020 2020 2222 2220 5265 7475 726e  :.    """ Return
+0000dff0: 2069 6e74 6572 7661 6c20 6e61 6d65 206f   interval name o
+0000e000: 6620 6120 7374 6163 6b20 6f66 2066 6966  f a stack of fif
+0000e010: 7468 7320 7375 6368 2074 6861 7420 3020  ths such that 0 
+0000e020: 3d20 2750 3127 2c20 2d31 203d 2027 5034  = 'P1', -1 = 'P4
+0000e030: 272c 202d 3220 3d20 276d 3727 2c20 3420  ', -2 = 'm7', 4 
+0000e040: 3d20 274d 3327 2065 7463 2e20 4966 2079  = 'M3' etc. If y
+0000e050: 6f75 2070 6173 730a 2020 2020 6060 736d  ou pass.    ``sm
+0000e060: 616c 6c65 7374 3d54 7275 6560 602c 2069  allest=True``, i
+0000e070: 6e74 6572 7661 6c73 206f 6620 6120 6669  ntervals of a fi
+0000e080: 6674 6820 6f72 2067 7265 6174 6572 2077  fth or greater w
+0000e090: 696c 6c20 6265 2069 6e76 6572 7465 6420  ill be inverted 
+0000e0a0: 2865 2e67 2e20 276d 3627 203d 3e20 272d  (e.g. 'm6' => '-
+0000e0b0: 4d33 2720 616e 6420 2744 3527 203d 3e20  M3' and 'D5' => 
+0000e0c0: 272d 4134 2729 2e0a 0a0a 2020 2020 4172  '-A4')....    Ar
+0000e0d0: 6773 3a0a 2020 2020 2020 6669 6674 6873  gs:.      fifths
+0000e0e0: 3a20 4e75 6d62 6572 206f 6620 6669 6674  : Number of fift
+0000e0f0: 6873 2072 6570 7265 7365 6e74 696e 6720  hs representing 
+0000e100: 7468 6520 696e 7665 7261 6c0a 2020 2020  the inveral.    
+0000e110: 2020 736d 616c 6c65 7374 3a20 5061 7373    smallest: Pass
+0000e120: 2054 7275 6520 6966 2079 6f75 2077 616e   True if you wan
+0000e130: 7420 746f 2077 7261 7020 696e 7465 7276  t to wrap interv
+0000e140: 616c 7320 6f66 2061 2066 6966 7468 7320  als of a fifths 
+0000e150: 616e 6420 6c61 7267 6572 2074 6f20 7468  and larger to th
+0000e160: 6520 646f 776e 7761 7264 2063 6f75 6e74  e downward count
+0000e170: 6572 7061 7274 2e0a 2020 2020 2020 7065  erpart..      pe
+0000e180: 7266 6563 743a 2053 7472 696e 6720 7265  rfect: String re
+0000e190: 7072 6573 656e 7469 6e67 2074 6865 2070  presenting the p
+0000e1a0: 6572 6665 6374 2069 6e74 6572 7661 6c20  erfect interval 
+0000e1b0: 7175 616c 6974 792c 2064 6566 6175 6c74  quality, default
+0000e1c0: 7320 746f 2027 5027 2e0a 2020 2020 2020  s to 'P'..      
+0000e1d0: 6d61 6a6f 723a 2053 7472 696e 6720 7265  major: String re
+0000e1e0: 7072 6573 656e 7469 6e67 2074 6865 206d  presenting the m
+0000e1f0: 616a 6f72 2069 6e74 6572 7661 6c20 7175  ajor interval qu
+0000e200: 616c 6974 792c 2064 6566 6175 6c74 7320  ality, defaults 
+0000e210: 746f 2027 4d27 2e0a 2020 2020 2020 6d69  to 'M'..      mi
+0000e220: 6e6f 723a 2053 7472 696e 6720 7265 7072  nor: String repr
+0000e230: 6573 656e 7469 6e67 2074 6865 206d 696e  esenting the min
+0000e240: 6f72 2069 6e74 6572 7661 6c20 7175 616c  or interval qual
+0000e250: 6974 792c 2064 6566 6175 6c74 7320 746f  ity, defaults to
+0000e260: 2027 6d27 2e0a 2020 2020 2020 6175 676d   'm'..      augm
+0000e270: 656e 7465 643a 2053 7472 696e 6720 7265  ented: String re
+0000e280: 7072 6573 656e 7469 6e67 2074 6865 2061  presenting the a
+0000e290: 7567 6d65 6e74 6564 2069 6e74 6572 7661  ugmented interva
+0000e2a0: 6c20 7175 616c 6974 792c 2064 6566 6175  l quality, defau
+0000e2b0: 6c74 7320 746f 2027 6127 2e0a 2020 2020  lts to 'a'..    
+0000e2c0: 2020 6469 6d69 6e69 7368 6564 3a20 5374    diminished: St
+0000e2d0: 7269 6e67 2072 6570 7265 7365 6e74 696e  ring representin
+0000e2e0: 6720 7468 6520 6469 6d69 6e69 7368 6564  g the diminished
+0000e2f0: 2069 6e74 6572 7661 6c20 7175 616c 6974   interval qualit
+0000e300: 792c 2064 6566 6175 6c74 7320 746f 2027  y, defaults to '
+0000e310: 6427 2e0a 0a20 2020 2052 6574 7572 6e73  d'...    Returns
+0000e320: 3a0a 2020 2020 2020 4e61 6d65 206f 6620  :.      Name of 
+0000e330: 7468 6520 696e 7465 7276 616c 2061 7320  the interval as 
+0000e340: 6120 7374 7269 6e67 2e0a 2020 2020 2222  a string..    ""
+0000e350: 220a 2020 2020 6669 6674 6873 5f70 6c75  ".    fifths_plu
+0000e360: 735f 6f6e 6520 3d20 6669 6674 6873 202b  s_one = fifths +
+0000e370: 2031 2020 2320 6d61 6b69 6e67 2030 203d   1  # making 0 =
+0000e380: 2066 6f75 7274 682c 2031 203d 2075 6e69   fourth, 1 = uni
+0000e390: 736f 6e2c 2032 203d 2066 6966 7468 2065  son, 2 = fifth e
+0000e3a0: 7463 2e0a 2020 2020 696e 745f 6e75 6d20  tc..    int_num 
+0000e3b0: 3d20 5b22 3422 2c20 2231 222c 2022 3522  = ["4", "1", "5"
+0000e3c0: 2c20 2232 222c 2022 3622 2c20 2233 222c  , "2", "6", "3",
+0000e3d0: 2022 3722 5d5b 6669 6674 6873 5f70 6c75   "7"][fifths_plu
+0000e3e0: 735f 6f6e 6520 2520 375d 0a20 2020 2073  s_one % 7].    s
+0000e3f0: 6861 7270 5f77 6973 655f 7175 616c 6974  harp_wise_qualit
+0000e400: 7920 3d20 6175 676d 656e 7465 640a 2020  y = augmented.  
+0000e410: 2020 666c 6174 5f77 6973 655f 7175 616c    flat_wise_qual
+0000e420: 6974 7920 3d20 6469 6d69 6e69 7368 6564  ity = diminished
+0000e430: 0a20 2020 2071 7561 6c69 7469 6573 203d  .    qualities =
+0000e440: 2028 6d69 6e6f 722c 206d 696e 6f72 2c20   (minor, minor, 
+0000e450: 6d69 6e6f 722c 206d 696e 6f72 2c20 7065  minor, minor, pe
+0000e460: 7266 6563 742c 2070 6572 6665 6374 2c20  rfect, perfect, 
+0000e470: 7065 7266 6563 742c 206d 616a 6f72 2c20  perfect, major, 
+0000e480: 6d61 6a6f 722c 206d 616a 6f72 2c20 6d61  major, major, ma
+0000e490: 6a6f 7229 0a20 2020 2071 7561 6c69 7479  jor).    quality
+0000e4a0: 203d 2022 220a 2020 2020 6966 2073 6d61   = "".    if sma
+0000e4b0: 6c6c 6573 7420 616e 6420 696e 7428 696e  llest and int(in
+0000e4c0: 745f 6e75 6d29 203e 2034 3a0a 2020 2020  t_num) > 4:.    
+0000e4d0: 2020 2020 696e 745f 6e75 6d20 3d20 7374      int_num = st
+0000e4e0: 7228 3920 2d20 696e 7428 696e 745f 6e75  r(9 - int(int_nu
+0000e4f0: 6d29 290a 2020 2020 2020 2020 7368 6172  m)).        shar
+0000e500: 705f 7769 7365 5f71 7561 6c69 7479 2c20  p_wise_quality, 
+0000e510: 666c 6174 5f77 6973 655f 7175 616c 6974  flat_wise_qualit
+0000e520: 7920 3d20 666c 6174 5f77 6973 655f 7175  y = flat_wise_qu
+0000e530: 616c 6974 792c 2073 6861 7270 5f77 6973  ality, sharp_wis
+0000e540: 655f 7175 616c 6974 790a 2020 2020 2020  e_quality.      
+0000e550: 2020 7175 616c 6974 6965 7320 3d20 7475    qualities = tu
+0000e560: 706c 6528 7265 7665 7273 6564 2871 7561  ple(reversed(qua
+0000e570: 6c69 7469 6573 2929 0a20 2020 2020 2020  lities)).       
+0000e580: 2071 7561 6c69 7479 203d 2022 2d22 0a20   quality = "-". 
+0000e590: 2020 2069 6620 2d35 203c 3d20 6669 6674     if -5 <= fift
+0000e5a0: 6873 203c 3d20 353a 0a20 2020 2020 2020  hs <= 5:.       
+0000e5b0: 2071 7561 6c69 7479 202b 3d20 7175 616c   quality += qual
+0000e5c0: 6974 6965 735b 6669 6674 6873 202b 2035  ities[fifths + 5
+0000e5d0: 5d0a 2020 2020 656c 6966 2066 6966 7468  ].    elif fifth
+0000e5e0: 7320 3e20 353a 0a20 2020 2020 2020 2071  s > 5:.        q
+0000e5f0: 7561 6c69 7479 202b 3d20 7368 6172 705f  uality += sharp_
+0000e600: 7769 7365 5f71 7561 6c69 7479 202a 2028  wise_quality * (
+0000e610: 6669 6674 6873 5f70 6c75 735f 6f6e 6520  fifths_plus_one 
+0000e620: 2f2f 2037 290a 2020 2020 656c 7365 3a0a  // 7).    else:.
+0000e630: 2020 2020 2020 2020 7175 616c 6974 7920          quality 
+0000e640: 2b3d 2066 6c61 745f 7769 7365 5f71 7561  += flat_wise_qua
+0000e650: 6c69 7479 202a 2028 282d 6669 6674 6873  lity * ((-fifths
+0000e660: 202b 2031 2920 2f2f 2037 290a 2020 2020   + 1) // 7).    
+0000e670: 7265 7475 726e 2071 7561 6c69 7479 202b  return quality +
+0000e680: 2069 6e74 5f6e 756d 0a0a 406f 7665 726c   int_num..@overl
+0000e690: 6f61 640a 6465 6620 7470 6332 6e61 6d65  oad.def tpc2name
+0000e6a0: 2874 7063 3a20 696e 742c 206d 733a 2062  (tpc: int, ms: b
+0000e6b0: 6f6f 6c20 3d20 4661 6c73 652c 206d 696e  ool = False, min
+0000e6c0: 6f72 3a20 626f 6f6c 203d 2046 616c 7365  or: bool = False
+0000e6d0: 2920 2d3e 204f 7074 696f 6e61 6c5b 7374  ) -> Optional[st
+0000e6e0: 725d 3a0a 2020 2020 2e2e 2e0a 406f 7665  r]:.    ....@ove
+0000e6f0: 726c 6f61 640a 6465 6620 7470 6332 6e61  rload.def tpc2na
+0000e700: 6d65 2874 7063 3a20 7064 2e53 6572 6965  me(tpc: pd.Serie
+0000e710: 732c 206d 733a 2062 6f6f 6c20 3d20 4661  s, ms: bool = Fa
+0000e720: 6c73 652c 206d 696e 6f72 3a20 626f 6f6c  lse, minor: bool
+0000e730: 203d 2046 616c 7365 2920 2d3e 204f 7074   = False) -> Opt
+0000e740: 696f 6e61 6c5b 7064 2e53 6572 6965 735d  ional[pd.Series]
+0000e750: 3a0a 2020 2020 2e2e 2e0a 406f 7665 726c  :.    ....@overl
+0000e760: 6f61 640a 6465 6620 7470 6332 6e61 6d65  oad.def tpc2name
+0000e770: 2874 7063 3a20 4e44 4172 7261 795b 696e  (tpc: NDArray[in
+0000e780: 745d 2c20 6d73 3a20 626f 6f6c 203d 2046  t], ms: bool = F
+0000e790: 616c 7365 2c20 6d69 6e6f 723a 2062 6f6f  alse, minor: boo
+0000e7a0: 6c20 3d20 4661 6c73 6529 202d 3e20 4f70  l = False) -> Op
+0000e7b0: 7469 6f6e 616c 5b4e 4441 7272 6179 5b73  tional[NDArray[s
+0000e7c0: 7472 5d5d 3a0a 2020 2020 2e2e 2e0a 406f  tr]]:.    ....@o
+0000e7d0: 7665 726c 6f61 640a 6465 6620 7470 6332  verload.def tpc2
+0000e7e0: 6e61 6d65 2874 7063 3a20 4c69 7374 5b69  name(tpc: List[i
+0000e7f0: 6e74 5d2c 206d 733a 2062 6f6f 6c20 3d20  nt], ms: bool = 
+0000e800: 4661 6c73 652c 206d 696e 6f72 3a20 626f  False, minor: bo
+0000e810: 6f6c 203d 2046 616c 7365 2920 2d3e 204f  ol = False) -> O
+0000e820: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
+0000e830: 5d5d 3a0a 2020 2020 2e2e 2e0a 406f 7665  ]]:.    ....@ove
+0000e840: 726c 6f61 640a 6465 6620 7470 6332 6e61  rload.def tpc2na
+0000e850: 6d65 2874 7063 3a20 2054 7570 6c65 5b69  me(tpc:  Tuple[i
+0000e860: 6e74 5d2c 206d 733a 2062 6f6f 6c20 3d20  nt], ms: bool = 
+0000e870: 4661 6c73 652c 206d 696e 6f72 3a20 626f  False, minor: bo
+0000e880: 6f6c 203d 2046 616c 7365 2920 2d3e 204f  ol = False) -> O
+0000e890: 7074 696f 6e61 6c5b 5475 706c 655b 7374  ptional[Tuple[st
+0000e8a0: 725d 5d3a 0a20 2020 202e 2e2e 0a64 6566  r]]:.    ....def
+0000e8b0: 2074 7063 326e 616d 6528 7470 633a 2055   tpc2name(tpc: U
+0000e8c0: 6e69 6f6e 5b69 6e74 2c20 7064 2e53 6572  nion[int, pd.Ser
+0000e8d0: 6965 732c 204e 4441 7272 6179 5b69 6e74  ies, NDArray[int
+0000e8e0: 5d2c 204c 6973 745b 696e 745d 2c20 5475  ], List[int], Tu
+0000e8f0: 706c 655b 696e 745d 5d2c 0a20 2020 2020  ple[int]],.     
+0000e900: 2020 2020 2020 2020 6d73 3a20 626f 6f6c          ms: bool
+0000e910: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+0000e920: 2020 2020 2020 206d 696e 6f72 3a20 626f         minor: bo
+0000e930: 6f6c 203d 2046 616c 7365 2920 2d3e 204f  ol = False) -> O
+0000e940: 7074 696f 6e61 6c5b 556e 696f 6e5b 7374  ptional[Union[st
+0000e950: 722c 2070 642e 5365 7269 6573 2c20 4e44  r, pd.Series, ND
+0000e960: 4172 7261 795b 7374 725d 2c20 4c69 7374  Array[str], List
+0000e970: 5b73 7472 5d2c 2054 7570 6c65 5b73 7472  [str], Tuple[str
+0000e980: 5d5d 5d3a 0a20 2020 2022 2222 2054 7572  ]]]:.    """ Tur
+0000e990: 6e20 6120 746f 6e61 6c20 7069 7463 6820  n a tonal pitch 
+0000e9a0: 636c 6173 7320 2854 5043 2920 696e 746f  class (TPC) into
+0000e9b0: 2061 206e 616d 6520 6f72 2070 6572 666f   a name or perfo
+0000e9c0: 726d 2074 6865 206f 7065 7261 7469 6f6e  rm the operation
+0000e9d0: 206f 6e20 6120 636f 6c6c 6563 7469 6f6e   on a collection
+0000e9e0: 206f 6620 696e 7465 6765 7273 2e0a 0a20   of integers... 
+0000e9f0: 2020 2041 7267 733a 0a20 2020 2020 2074     Args:.      t
+0000ea00: 7063 3a20 546f 6e61 6c20 7069 7463 6820  pc: Tonal pitch 
+0000ea10: 636c 6173 7328 6573 2920 746f 2074 7572  class(es) to tur
+0000ea20: 6e20 696e 746f 2061 206e 6f74 6520 6e61  n into a note na
+0000ea30: 6d65 2e0a 2020 2020 2020 6d73 3a20 5061  me..      ms: Pa
+0000ea40: 7373 2054 7275 6520 6966 2060 6074 7063  ss True if ``tpc
+0000ea50: 6060 2069 7320 6120 4d75 7365 5363 6f72  `` is a MuseScor
+0000ea60: 6520 5450 432c 2069 2e65 2e20 4320 3d20  e TPC, i.e. C = 
+0000ea70: 3134 0a20 2020 2020 206d 696e 6f72 3a20  14.      minor: 
+0000ea80: 5061 7373 2054 7275 6520 6966 2074 6865  Pass True if the
+0000ea90: 2073 7472 696e 6720 6973 2074 6f20 6265   string is to be
+0000eaa0: 2072 6574 7572 6e65 6420 6173 206c 6f77   returned as low
+0000eab0: 6572 6361 7365 2e0a 0a20 2020 2052 6574  ercase...    Ret
+0000eac0: 7572 6e73 3a0a 0a20 2020 2022 2222 0a20  urns:..    """. 
+0000ead0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000eae0: 6966 2070 642e 6973 6e75 6c6c 2874 7063  if pd.isnull(tpc
+0000eaf0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0000eb00: 6574 7572 6e20 7470 630a 2020 2020 6578  eturn tpc.    ex
+0000eb10: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
+0000eb20: 0a20 2020 2020 2020 2070 6173 730a 2020  .        pass.  
+0000eb30: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000eb40: 7470 632c 2070 642e 5365 7269 6573 293a  tpc, pd.Series):
+0000eb50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000eb60: 6361 7374 3263 6f6c 6c65 6374 696f 6e28  cast2collection(
+0000eb70: 636f 6c6c 3d74 7063 2c20 6675 6e63 3d74  coll=tpc, func=t
+0000eb80: 7063 326e 616d 652c 206d 733d 6d73 2c20  pc2name, ms=ms, 
+0000eb90: 6d69 6e6f 723d 6d69 6e6f 7229 0a20 2020  minor=minor).   
+0000eba0: 2074 7279 3a0a 2020 2020 2020 2020 7470   try:.        tp
+0000ebb0: 6320 3d20 696e 7428 666c 6f61 7428 7470  c = int(float(tp
+0000ebc0: 6329 290a 2020 2020 6578 6365 7074 2054  c)).    except T
+0000ebd0: 7970 6545 7272 6f72 3a0a 2020 2020 2020  ypeError:.      
+0000ebe0: 2020 7265 7475 726e 2063 6173 7432 636f    return cast2co
+0000ebf0: 6c6c 6563 7469 6f6e 2863 6f6c 6c3d 7470  llection(coll=tp
+0000ec00: 632c 2066 756e 633d 7470 6332 6e61 6d65  c, func=tpc2name
+0000ec10: 2c20 6d73 3d6d 732c 206d 696e 6f72 3d6d  , ms=ms, minor=m
+0000ec20: 696e 6f72 290a 2020 2020 6e6f 7465 5f6e  inor).    note_n
+0000ec30: 616d 6573 203d 2028 2766 272c 2027 6327  ames = ('f', 'c'
+0000ec40: 2c20 2767 272c 2027 6427 2c20 2761 272c  , 'g', 'd', 'a',
+0000ec50: 2027 6527 2c20 2762 2729 2069 6620 6d69   'e', 'b') if mi
+0000ec60: 6e6f 7220 656c 7365 2028 2746 272c 2027  nor else ('F', '
+0000ec70: 4327 2c20 2747 272c 2027 4427 2c20 2741  C', 'G', 'D', 'A
+0000ec80: 272c 2027 4527 2c20 2742 2729 0a20 2020  ', 'E', 'B').   
+0000ec90: 2069 6620 6d73 3a0a 2020 2020 2020 2020   if ms:.        
+0000eca0: 7470 6320 3d20 7470 6320 2d20 3134 0a20  tpc = tpc - 14. 
+0000ecb0: 2020 2061 6363 2c20 6978 203d 2064 6976     acc, ix = div
+0000ecc0: 6d6f 6428 7470 6320 2b20 312c 2037 290a  mod(tpc + 1, 7).
+0000ecd0: 2020 2020 6163 635f 7374 7220 3d20 6162      acc_str = ab
+0000ece0: 7328 6163 6329 202a 2027 6227 2069 6620  s(acc) * 'b' if 
+0000ecf0: 6163 6320 3c20 3020 656c 7365 2061 6363  acc < 0 else acc
+0000ed00: 202a 2027 2327 0a20 2020 2072 6574 7572   * '#'.    retur
+0000ed10: 6e20 6622 7b6e 6f74 655f 6e61 6d65 735b  n f"{note_names[
+0000ed20: 6978 5d7d 7b61 6363 5f73 7472 7d22 0a0a  ix]}{acc_str}"..
+0000ed30: 406f 7665 726c 6f61 640a 6465 6620 6669  @overload.def fi
+0000ed40: 6674 6873 326e 616d 6528 6669 6674 6873  fths2name(fifths
+0000ed50: 3a20 696e 742c 206d 6964 693a 204f 7074  : int, midi: Opt
+0000ed60: 696f 6e61 6c5b 696e 745d 2c20 6d73 3a20  ional[int], ms: 
+0000ed70: 626f 6f6c 2c20 6d69 6e6f 723a 2062 6f6f  bool, minor: boo
+0000ed80: 6c29 202d 3e20 4f70 7469 6f6e 616c 5b73  l) -> Optional[s
+0000ed90: 7472 5d3a 0a20 2020 202e 2e2e 0a40 6f76  tr]:.    ....@ov
+0000eda0: 6572 6c6f 6164 0a64 6566 2066 6966 7468  erload.def fifth
+0000edb0: 7332 6e61 6d65 2866 6966 7468 733a 2070  s2name(fifths: p
+0000edc0: 642e 5365 7269 6573 2c20 6d69 6469 3a20  d.Series, midi: 
+0000edd0: 4f70 7469 6f6e 616c 5b70 642e 5365 7269  Optional[pd.Seri
+0000ede0: 6573 5d2c 206d 733a 2062 6f6f 6c2c 206d  es], ms: bool, m
+0000edf0: 696e 6f72 3a20 626f 6f6c 2920 2d3e 204f  inor: bool) -> O
+0000ee00: 7074 696f 6e61 6c5b 7064 2e53 6572 6965  ptional[pd.Serie
+0000ee10: 735d 3a0a 2020 2020 2e2e 2e0a 406f 7665  s]:.    ....@ove
+0000ee20: 726c 6f61 640a 6465 6620 6669 6674 6873  rload.def fifths
+0000ee30: 326e 616d 6528 6669 6674 6873 3a20 4e44  2name(fifths: ND
+0000ee40: 4172 7261 795b 696e 745d 2c20 6d69 6469  Array[int], midi
+0000ee50: 3a20 4f70 7469 6f6e 616c 5b4e 4441 7272  : Optional[NDArr
+0000ee60: 6179 5b69 6e74 5d5d 2c20 6d73 3a20 626f  ay[int]], ms: bo
+0000ee70: 6f6c 2c20 6d69 6e6f 723a 2062 6f6f 6c29  ol, minor: bool)
+0000ee80: 202d 3e20 4f70 7469 6f6e 616c 5b4e 4441   -> Optional[NDA
+0000ee90: 7272 6179 5b73 7472 5d5d 3a0a 2020 2020  rray[str]]:.    
+0000eea0: 2e2e 2e0a 406f 7665 726c 6f61 640a 6465  ....@overload.de
+0000eeb0: 6620 6669 6674 6873 326e 616d 6528 6669  f fifths2name(fi
+0000eec0: 6674 6873 3a20 4c69 7374 5b69 6e74 5d2c  fths: List[int],
+0000eed0: 206d 6964 693a 204f 7074 696f 6e61 6c5b   midi: Optional[
+0000eee0: 4c69 7374 5b69 6e74 5d5d 2c20 6d73 3a20  List[int]], ms: 
+0000eef0: 626f 6f6c 2c20 6d69 6e6f 723a 2062 6f6f  bool, minor: boo
+0000ef00: 6c29 202d 3e20 4f70 7469 6f6e 616c 5b4c  l) -> Optional[L
+0000ef10: 6973 745b 7374 725d 5d3a 0a20 2020 202e  ist[str]]:.    .
+0000ef20: 2e2e 0a40 6f76 6572 6c6f 6164 0a64 6566  ...@overload.def
+0000ef30: 2066 6966 7468 7332 6e61 6d65 2866 6966   fifths2name(fif
+0000ef40: 7468 733a 2054 7570 6c65 5b69 6e74 5d2c  ths: Tuple[int],
+0000ef50: 206d 6964 693a 204f 7074 696f 6e61 6c5b   midi: Optional[
+0000ef60: 5475 706c 655b 696e 745d 5d2c 206d 733a  Tuple[int]], ms:
+0000ef70: 2062 6f6f 6c2c 206d 696e 6f72 3a20 626f   bool, minor: bo
+0000ef80: 6f6c 2920 2d3e 204f 7074 696f 6e61 6c5b  ol) -> Optional[
+0000ef90: 5475 706c 655b 7374 725d 5d3a 0a20 2020  Tuple[str]]:.   
+0000efa0: 202e 2e2e 0a40 6675 6e63 7469 6f6e 5f6c   ....@function_l
+0000efb0: 6f67 6765 720a 6465 6620 6669 6674 6873  ogger.def fifths
+0000efc0: 326e 616d 6528 6669 6674 6873 3a20 556e  2name(fifths: Un
+0000efd0: 696f 6e5b 696e 742c 2070 642e 5365 7269  ion[int, pd.Seri
+0000efe0: 6573 2c20 4e44 4172 7261 795b 696e 745d  es, NDArray[int]
+0000eff0: 2c20 4c69 7374 5b69 6e74 5d2c 2054 7570  , List[int], Tup
+0000f000: 6c65 5b69 6e74 5d5d 2c0a 2020 2020 2020  le[int]],.      
+0000f010: 2020 2020 2020 2020 2020 6d69 6469 3a20            midi: 
+0000f020: 4f70 7469 6f6e 616c 5b55 6e69 6f6e 5b69  Optional[Union[i
+0000f030: 6e74 2c20 7064 2e53 6572 6965 732c 204e  nt, pd.Series, N
+0000f040: 4441 7272 6179 5b69 6e74 5d2c 204c 6973  DArray[int], Lis
+0000f050: 745b 696e 745d 2c20 5475 706c 655b 696e  t[int], Tuple[in
+0000f060: 745d 5d5d 203d 204e 6f6e 652c 0a20 2020  t]]] = None,.   
+0000f070: 2020 2020 2020 2020 2020 2020 206d 733a               ms:
+0000f080: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0000f090: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000f0a0: 696e 6f72 3a20 626f 6f6c 203d 2046 616c  inor: bool = Fal
+0000f0b0: 7365 2920 2d3e 204f 7074 696f 6e61 6c5b  se) -> Optional[
+0000f0c0: 556e 696f 6e5b 7374 722c 2070 642e 5365  Union[str, pd.Se
+0000f0d0: 7269 6573 2c20 4e44 4172 7261 795b 7374  ries, NDArray[st
+0000f0e0: 725d 2c20 4c69 7374 5b73 7472 5d2c 2054  r], List[str], T
+0000f0f0: 7570 6c65 5b73 7472 5d5d 5d3a 0a20 2020  uple[str]]]:.   
+0000f100: 2022 2222 5265 7475 726e 206e 6f74 6520   """Return note 
+0000f110: 6e61 6d65 206f 6620 6120 7374 6163 6b20  name of a stack 
+0000f120: 6f66 2066 6966 7468 7320 7375 6368 2074  of fifths such t
+0000f130: 6861 740a 2020 2020 2020 2030 203d 2043  hat.       0 = C
+0000f140: 2c20 2d31 203d 2046 2c20 2d32 203d 2042  , -1 = F, -2 = B
+0000f150: 622c 2031 203d 2047 2065 7463 2e20 5468  b, 1 = G etc. Th
+0000f160: 6973 2069 7320 6120 7772 6170 7065 7220  is is a wrapper 
+0000f170: 6f66 203a 6675 6e63 3a60 7470 6332 6e61  of :func:`tpc2na
+0000f180: 6d65 602c 2074 6861 7420 6164 6469 7469  me`, that additi
+0000f190: 6f6e 616c 6c79 2061 6363 6570 7473 2074  onally accepts t
+0000f1a0: 6865 2061 7267 756d 656e 740a 2020 2020  he argument.    
+0000f1b0: 2020 2060 606d 6964 6960 6020 7768 6963     ``midi`` whic
+0000f1c0: 6820 616c 6c6f 7773 2066 6f72 2061 6464  h allows for add
+0000f1d0: 696e 6720 6f63 7461 7665 2069 6e66 6f72  ing octave infor
+0000f1e0: 6d61 7469 6f6e 2e0a 0a20 2020 2041 7267  mation...    Arg
+0000f1f0: 733a 0a20 2020 2020 2066 6966 7468 733a  s:.      fifths:
+0000f200: 2054 6f6e 616c 2070 6974 6368 2063 6c61   Tonal pitch cla
+0000f210: 7373 2865 7329 2074 6f20 7475 726e 2069  ss(es) to turn i
+0000f220: 6e74 6f20 6120 6e6f 7465 206e 616d 652e  nto a note name.
+0000f230: 0a20 2020 2020 206d 6964 693a 2049 6e20  .      midi: In 
+0000f240: 6f72 6465 7220 746f 2069 6e63 6c75 6465  order to include
+0000f250: 2074 6865 206f 6374 6176 6520 696e 746f   the octave into
+0000f260: 2074 6865 206e 6f74 6520 6e61 6d65 2c20   the note name, 
+0000f270: 7061 7373 2074 6865 2063 6f72 7265 7370  pass the corresp
+0000f280: 6f6e 6469 6e67 204d 4944 4920 7069 7463  onding MIDI pitc
+0000f290: 6828 6573 292e 0a20 2020 2020 206d 733a  h(es)..      ms:
+0000f2a0: 2050 6173 7320 5472 7565 2069 6620 6060   Pass True if ``
+0000f2b0: 6669 6674 6873 6060 2069 7320 6120 4d75  fifths`` is a Mu
+0000f2c0: 7365 5363 6f72 6520 5450 432c 2069 2e65  seScore TPC, i.e
+0000f2d0: 2e20 4320 3d20 3134 0a20 2020 2020 206d  . C = 14.      m
+0000f2e0: 696e 6f72 3a20 5061 7373 2054 7275 6520  inor: Pass True 
+0000f2f0: 6966 2074 6865 2073 7472 696e 6720 6973  if the string is
+0000f300: 2074 6f20 6265 2072 6574 7572 6e65 6420   to be returned 
+0000f310: 6173 206c 6f77 6572 6361 7365 2e0a 2020  as lowercase..  
+0000f320: 2020 2222 220a 2020 2020 7472 793a 0a20    """.    try:. 
+0000f330: 2020 2020 2020 2069 6620 7064 2e69 736e         if pd.isn
+0000f340: 756c 6c28 6669 6674 6873 293a 0a20 2020  ull(fifths):.   
+0000f350: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000f360: 6669 6674 6873 0a20 2020 2065 7863 6570  fifths.    excep
+0000f370: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
+0000f380: 2020 2020 2020 7061 7373 0a20 2020 2074        pass.    t
+0000f390: 7279 3a0a 2020 2020 2020 2020 6669 6674  ry:.        fift
+0000f3a0: 6873 203d 2069 6e74 2866 6c6f 6174 2866  hs = int(float(f
+0000f3b0: 6966 7468 7329 290a 2020 2020 6578 6365  ifths)).    exce
+0000f3c0: 7074 2054 7970 6545 7272 6f72 3a0a 2020  pt TypeError:.  
+0000f3d0: 2020 2020 2020 6e61 6d65 7320 3d20 7470        names = tp
+0000f3e0: 6332 6e61 6d65 2866 6966 7468 732c 206d  c2name(fifths, m
+0000f3f0: 733d 6d73 2c20 6d69 6e6f 723d 6d69 6e6f  s=ms, minor=mino
+0000f400: 7229 0a20 2020 2020 2020 2069 6620 6d69  r).        if mi
+0000f410: 6469 2069 7320 4e6f 6e65 3a0a 2020 2020  di is None:.    
+0000f420: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+0000f430: 616d 6573 0a20 2020 2020 2020 206f 6374  ames.        oct
+0000f440: 6176 6573 203d 206d 6964 6932 6f63 7461  aves = midi2octa
+0000f450: 7665 286d 6964 692c 2066 6966 7468 7329  ve(midi, fifths)
+0000f460: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f470: 6164 645f 636f 6c6c 6563 7469 6f6e 7328  add_collections(
+0000f480: 6e61 6d65 732c 206f 6374 6176 6573 2c20  names, octaves, 
+0000f490: 6474 7970 653d 2773 7472 696e 6727 290a  dtype='string').
+0000f4a0: 2020 2020 6e61 6d65 203d 2074 7063 326e      name = tpc2n
+0000f4b0: 616d 6528 6669 6674 6873 2c20 6d73 3d6d  ame(fifths, ms=m
+0000f4c0: 732c 206d 696e 6f72 3d6d 696e 6f72 290a  s, minor=minor).
+0000f4d0: 2020 2020 6966 206d 6964 6920 6973 204e      if midi is N
+0000f4e0: 6f6e 653a 0a20 2020 2020 2020 2072 6574  one:.        ret
+0000f4f0: 7572 6e20 6e61 6d65 0a20 2020 206f 6374  urn name.    oct
+0000f500: 6176 6520 3d20 6d69 6469 326f 6374 6176  ave = midi2octav
+0000f510: 6528 6d69 6469 2c20 6669 6674 6873 290a  e(midi, fifths).
+0000f520: 2020 2020 7265 7475 726e 2066 227b 6e61      return f"{na
+0000f530: 6d65 7d7b 6f63 7461 7665 7d22 0a0a 0a0a  me}{octave}"....
+0000f540: 6465 6620 6669 6674 6873 3270 6328 6669  def fifths2pc(fi
+0000f550: 6674 6873 293a 0a20 2020 2022 2222 2054  fths):.    """ T
+0000f560: 7572 6e20 6120 7374 6163 6b20 6f66 2066  urn a stack of f
+0000f570: 6966 7468 7320 696e 746f 2061 2063 6872  ifths into a chr
+0000f580: 6f6d 6174 6963 2070 6974 6368 2063 6c61  omatic pitch cla
+0000f590: 7373 2e0a 2020 2020 2020 2020 5573 6573  ss..        Uses
+0000f5a0: 3a20 6d61 7032 656c 656d 656e 7473 2829  : map2elements()
+0000f5b0: 0a20 2020 2022 2222 0a20 2020 2074 7279  .    """.    try
+0000f5c0: 3a0a 2020 2020 2020 2020 6669 6674 6873  :.        fifths
+0000f5d0: 203d 2069 6e74 2866 6c6f 6174 2866 6966   = int(float(fif
+0000f5e0: 7468 7329 290a 2020 2020 6578 6365 7074  ths)).    except
+0000f5f0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+0000f600: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000f610: 6528 6669 6674 6873 2c20 4974 6572 6162  e(fifths, Iterab
+0000f620: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+0000f630: 2072 6574 7572 6e20 6d61 7032 656c 656d   return map2elem
+0000f640: 656e 7473 2866 6966 7468 732c 2066 6966  ents(fifths, fif
+0000f650: 7468 7332 7063 290a 2020 2020 2020 2020  ths2pc).        
+0000f660: 7265 7475 726e 2066 6966 7468 730a 0a20  return fifths.. 
+0000f670: 2020 2072 6574 7572 6e20 696e 7428 3720     return int(7 
+0000f680: 2a20 6669 6674 6873 2025 2031 3229 0a0a  * fifths % 12)..
+0000f690: 0a0a 6465 6620 6669 6674 6873 3272 6e28  ..def fifths2rn(
+0000f6a0: 6669 6674 6873 2c20 6d69 6e6f 723d 4661  fifths, minor=Fa
+0000f6b0: 6c73 652c 2061 7574 6f5f 6b65 793d 4661  lse, auto_key=Fa
+0000f6c0: 6c73 6529 3a0a 2020 2020 2222 2252 6574  lse):.    """Ret
+0000f6d0: 7572 6e20 526f 6d61 6e20 6e75 6d65 7261  urn Roman numera
+0000f6e0: 6c20 6f66 2061 2073 7461 636b 206f 6620  l of a stack of 
+0000f6f0: 6669 6674 6873 2073 7563 6820 7468 6174  fifths such that
+0000f700: 0a20 2020 2020 2020 3020 3d20 492c 202d  .       0 = I, -
+0000f710: 3120 3d20 4956 2c20 3120 3d20 562c 202d  1 = IV, 1 = V, -
+0000f720: 3220 3d20 6256 4949 2069 6e20 6d61 6a6f  2 = bVII in majo
+0000f730: 722c 2056 4949 2069 6e20 6d69 6e6f 722c  r, VII in minor,
+0000f740: 2065 7463 2e0a 2020 2020 2020 2055 7365   etc..       Use
+0000f750: 733a 206d 6170 3265 6c65 6d65 6e74 7328  s: map2elements(
+0000f760: 292c 2069 735f 6d69 6e6f 725f 6d6f 6465  ), is_minor_mode
+0000f770: 2829 0a0a 2020 2020 5061 7261 6d65 7465  ()..    Paramete
+0000f780: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+0000f790: 2d0a 2020 2020 6175 746f 5f6b 6579 203a  -.    auto_key :
+0000f7a0: 203a 6f62 6a3a 6062 6f6f 6c60 2c20 6f70   :obj:`bool`, op
+0000f7b0: 7469 6f6e 616c 0a20 2020 2020 2020 2042  tional.        B
+0000f7c0: 7920 6465 6661 756c 742c 2074 6865 2072  y default, the r
+0000f7d0: 6574 7572 6e65 6420 526f 6d61 6e20 6e75  eturned Roman nu
+0000f7e0: 6d65 7261 6c73 2061 7265 2075 7070 6572  merals are upper
+0000f7f0: 6361 7365 2e20 5061 7373 2054 7275 6520  case. Pass True 
+0000f800: 746f 2070 6173 7320 7570 7065 722d 0a20  to pass upper-. 
+0000f810: 2020 2020 2020 206f 7220 6c6f 7765 7263         or lowerc
+0000f820: 6173 6520 6163 636f 7264 696e 6720 746f  ase according to
+0000f830: 2074 6865 2070 6f73 6974 696f 6e20 696e   the position in
+0000f840: 2074 6865 2073 6361 6c65 2e0a 2020 2020   the scale..    
+0000f850: 2222 220a 2020 2020 6966 2069 7369 6e73  """.    if isins
+0000f860: 7461 6e63 6528 6669 6674 6873 2c20 4974  tance(fifths, It
+0000f870: 6572 6162 6c65 293a 0a20 2020 2020 2020  erable):.       
+0000f880: 2072 6574 7572 6e20 6d61 7032 656c 656d   return map2elem
+0000f890: 656e 7473 2866 6966 7468 732c 2066 6966  ents(fifths, fif
+0000f8a0: 7468 7332 726e 2c20 6d69 6e6f 723d 6d69  ths2rn, minor=mi
+0000f8b0: 6e6f 7229 0a20 2020 2069 6620 7064 2e69  nor).    if pd.i
+0000f8c0: 736e 756c 6c28 6669 6674 6873 293a 0a20  snull(fifths):. 
+0000f8d0: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+0000f8e0: 6674 6873 0a20 2020 2072 6e20 3d20 5b27  fths.    rn = ['
+0000f8f0: 5649 272c 2027 4949 4927 2c20 2756 4949  VI', 'III', 'VII
+0000f900: 272c 2027 4956 272c 2027 4927 2c20 2756  ', 'IV', 'I', 'V
+0000f910: 272c 2027 4949 275d 2069 6620 6d69 6e6f  ', 'II'] if mino
+0000f920: 7220 656c 7365 205b 2749 5627 2c20 2749  r else ['IV', 'I
+0000f930: 272c 2027 5627 2c20 2749 4927 2c20 2756  ', 'V', 'II', 'V
+0000f940: 4927 2c20 2749 4949 272c 2027 5649 4927  I', 'III', 'VII'
+0000f950: 5d0a 2020 2020 7365 6c20 3d20 6669 6674  ].    sel = fift
+0000f960: 6873 202b 2033 2069 6620 6d69 6e6f 7220  hs + 3 if minor 
+0000f970: 656c 7365 2066 6966 7468 730a 2020 2020  else fifths.    
+0000f980: 7265 7320 3d20 5f66 6966 7468 7332 7374  res = _fifths2st
+0000f990: 7228 7365 6c2c 2072 6e29 0a20 2020 2069  r(sel, rn).    i
+0000f9a0: 6620 6175 746f 5f6b 6579 2061 6e64 2069  f auto_key and i
+0000f9b0: 735f 6d69 6e6f 725f 6d6f 6465 2866 6966  s_minor_mode(fif
+0000f9c0: 7468 732c 206d 696e 6f72 293a 0a20 2020  ths, minor):.   
+0000f9d0: 2020 2020 2072 6574 7572 6e20 7265 732e       return res.
+0000f9e0: 6c6f 7765 7228 290a 2020 2020 7265 7475  lower().    retu
+0000f9f0: 726e 2072 6573 0a0a 0a0a 6465 6620 6669  rn res....def fi
+0000fa00: 6674 6873 3273 6428 6669 6674 6873 2c20  fths2sd(fifths, 
+0000fa10: 6d69 6e6f 723d 4661 6c73 6529 3a0a 2020  minor=False):.  
+0000fa20: 2020 2222 2252 6574 7572 6e20 7363 616c    """Return scal
+0000fa30: 6520 6465 6772 6565 206f 6620 6120 7374  e degree of a st
+0000fa40: 6163 6b20 6f66 2066 6966 7468 7320 7375  ack of fifths su
+0000fa50: 6368 2074 6861 740a 2020 2020 2020 2030  ch that.       0
+0000fa60: 203d 2027 3127 2c20 2d31 203d 2027 3427   = '1', -1 = '4'
+0000fa70: 2c20 2d32 203d 2027 6237 2720 696e 206d  , -2 = 'b7' in m
+0000fa80: 616a 6f72 2c20 2737 2720 696e 206d 696e  ajor, '7' in min
+0000fa90: 6f72 2065 7463 2e0a 2020 2020 2020 2055  or etc..       U
+0000faa0: 7365 733a 206d 6170 3265 6c65 6d65 6e74  ses: map2element
+0000fab0: 7328 292c 2066 6966 7468 7332 7374 7228  s(), fifths2str(
+0000fac0: 290a 2020 2020 2222 220a 2020 2020 6966  ).    """.    if
+0000fad0: 2069 7369 6e73 7461 6e63 6528 6669 6674   isinstance(fift
+0000fae0: 6873 2c20 4974 6572 6162 6c65 293a 0a20  hs, Iterable):. 
+0000faf0: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
+0000fb00: 7032 656c 656d 656e 7473 2866 6966 7468  p2elements(fifth
+0000fb10: 732c 2066 6966 7468 7332 7364 2c20 6d69  s, fifths2sd, mi
+0000fb20: 6e6f 723d 6d69 6e6f 7229 0a20 2020 2069  nor=minor).    i
+0000fb30: 6620 7064 2e69 736e 756c 6c28 6669 6674  f pd.isnull(fift
+0000fb40: 6873 293a 0a20 2020 2020 2020 2072 6574  hs):.        ret
+0000fb50: 7572 6e20 6669 6674 6873 0a20 2020 2073  urn fifths.    s
+0000fb60: 6420 3d20 5b27 3627 2c20 2733 272c 2027  d = ['6', '3', '
+0000fb70: 3727 2c20 2734 272c 2027 3127 2c20 2735  7', '4', '1', '5
+0000fb80: 272c 2027 3227 5d20 6966 206d 696e 6f72  ', '2'] if minor
+0000fb90: 2065 6c73 6520 5b27 3427 2c20 2731 272c   else ['4', '1',
+0000fba0: 2027 3527 2c20 2732 272c 2027 3627 2c20   '5', '2', '6', 
+0000fbb0: 2733 272c 2027 3727 5d0a 2020 2020 6966  '3', '7'].    if
+0000fbc0: 206d 696e 6f72 3a0a 2020 2020 2020 2020   minor:.        
+0000fbd0: 6669 6674 6873 202b 3d20 330a 2020 2020  fifths += 3.    
+0000fbe0: 7265 7475 726e 205f 6669 6674 6873 3273  return _fifths2s
+0000fbf0: 7472 2866 6966 7468 732c 2073 6429 0a0a  tr(fifths, sd)..
+0000fc00: 0a0a 6465 6620 5f66 6966 7468 7332 7374  ..def _fifths2st
+0000fc10: 7228 6669 6674 6873 3a20 696e 742c 0a20  r(fifths: int,. 
+0000fc20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000fc30: 7465 7073 3a20 436f 6c6c 6563 7469 6f6e  teps: Collection
+0000fc40: 5b73 7472 5d2c 0a20 2020 2020 2020 2020  [str],.         
+0000fc50: 2020 2020 2020 2069 6e76 6572 7465 643a         inverted:
+0000fc60: 2062 6f6f 6c20 3d20 4661 6c73 6529 202d   bool = False) -
+0000fc70: 3e20 7374 723a 0a20 2020 2022 2222 2042  > str:.    """ B
+0000fc80: 6f69 6c65 7220 706c 6174 6520 7573 6564  oiler plate used
+0000fc90: 2062 7920 6669 6674 6873 322d 6675 6e63   by fifths2-func
+0000fca0: 7469 6f6e 732e 0a0a 2020 2020 4172 6773  tions...    Args
+0000fcb0: 3a0a 2020 2020 2020 6669 6674 6873 3a20  :.      fifths: 
+0000fcc0: 5374 6163 6b20 6f66 2066 6966 7468 730a  Stack of fifths.
+0000fcd0: 2020 2020 2020 7374 6570 733a 2043 6f6c        steps: Col
+0000fce0: 6c65 6374 696f 6e20 6f66 2073 6576 656e  lection of seven
+0000fcf0: 206e 616d 6573 2c20 7363 616c 6520 6465   names, scale de
+0000fd00: 6772 6565 732c 2069 6e74 6572 7661 6c73  grees, intervals
+0000fd10: 2c20 6574 632e 0a20 2020 2020 2069 6e76  , etc..      inv
+0000fd20: 6572 7465 643a 2042 7920 6465 6661 756c  erted: By defaul
+0000fd30: 742c 2072 6574 7572 6e20 6163 6369 6465  t, return accide
+0000fd40: 6e74 616c 202b 2073 7465 702e 2050 6173  ntal + step. Pas
+0000fd50: 7320 5472 7565 2074 6f20 6765 7420 7374  s True to get st
+0000fd60: 6570 202b 2061 6363 6964 656e 7461 6c20  ep + accidental 
+0000fd70: 696e 7374 6561 642e 0a0a 2020 2020 5265  instead...    Re
+0000fd80: 7475 726e 733a 0a20 2020 2020 2041 6363  turns:.      Acc
+0000fd90: 6964 656e 7461 6c73 202b 2073 7465 7020  identals + step 
+0000fda0: 6672 6f6d 2060 6073 7465 7073 6060 206f  from ``steps`` o
+0000fdb0: 722c 2069 6620 696e 7665 7274 6564 2c20  r, if inverted, 
+0000fdc0: 7374 6570 202b 2061 6363 6964 656e 7461  step + accidenta
+0000fdd0: 6c73 2e0a 2020 2020 2222 220a 2020 2020  ls..    """.    
+0000fde0: 6163 6320 3d20 6669 6674 6873 3261 6363  acc = fifths2acc
+0000fdf0: 2866 6966 7468 7329 0a20 2020 2066 6966  (fifths).    fif
+0000fe00: 7468 7320 2b3d 2031 0a20 2020 2069 6620  ths += 1.    if 
+0000fe10: 696e 7665 7274 6564 3a0a 2020 2020 2020  inverted:.      
+0000fe20: 2020 7265 7475 726e 2073 7465 7073 5b66    return steps[f
+0000fe30: 6966 7468 7320 2520 375d 202b 2061 6363  ifths % 7] + acc
+0000fe40: 0a20 2020 2072 6574 7572 6e20 6163 6320  .    return acc 
+0000fe50: 2b20 7374 6570 735b 6669 6674 6873 2025  + steps[fifths %
+0000fe60: 2037 5d0a 0a0a 6465 6620 6765 745f 6d73   7]...def get_ms
+0000fe70: 5f76 6572 7369 6f6e 286d 7363 785f 6669  _version(mscx_fi
+0000fe80: 6c65 293a 0a20 2020 2077 6974 6820 6f70  le):.    with op
+0000fe90: 656e 286d 7363 785f 6669 6c65 2c20 656e  en(mscx_file, en
+0000fea0: 636f 6469 6e67 3d27 7574 662d 3827 2920  coding='utf-8') 
+0000feb0: 6173 2066 696c 653a 0a20 2020 2020 2020  as file:.       
+0000fec0: 2066 6f72 2069 2c20 6c20 696e 2065 6e75   for i, l in enu
+0000fed0: 6d65 7261 7465 2866 696c 6529 3a0a 2020  merate(file):.  
+0000fee0: 2020 2020 2020 2020 2020 6966 2069 203c            if i <
+0000fef0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+0000ff00: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+0000ff10: 2020 2020 2069 6620 6920 3d3d 2032 3a0a       if i == 2:.
+0000ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff30: 6d20 3d20 7265 2e73 6561 7263 6828 7222  m = re.search(r"
+0000ff40: 3c70 726f 6772 616d 5665 7273 696f 6e3e  <programVersion>
+0000ff50: 282e 2a3f 293c 2f70 726f 6772 616d 5665  (.*?)</programVe
+0000ff60: 7273 696f 6e3e 222c 206c 290a 2020 2020  rsion>", l).    
+0000ff70: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+0000ff80: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000ff90: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000ffa0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+0000ffb0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffd0: 2020 2020 7265 7475 726e 206d 2e67 726f      return m.gro
+0000ffe0: 7570 2831 290a 0a0a 4066 756e 6374 696f  up(1)...@functio
+0000fff0: 6e5f 6c6f 6767 6572 0a64 6566 2067 6574  n_logger.def get
+00010000: 5f6d 7573 6573 636f 7265 284d 533a 2055  _musescore(MS: U
+00010010: 6e69 6f6e 5b73 7472 2c20 4c69 7465 7261  nion[str, Litera
+00010020: 6c5b 2761 7574 6f27 2c20 2777 696e 272c  l['auto', 'win',
+00010030: 2027 6d61 6327 5d5d 203d 2027 6175 746f   'mac']] = 'auto
+00010040: 2729 202d 3e20 4f70 7469 6f6e 616c 5b73  ') -> Optional[s
+00010050: 7472 5d3a 0a20 2020 2022 2222 5465 7374  tr]:.    """Test
+00010060: 7320 7768 6574 6865 7220 6120 4d75 7365  s whether a Muse
+00010070: 5363 6f72 6520 6578 6563 7574 6162 6c65  Score executable
+00010080: 2063 616e 2062 6520 666f 756e 6420 6f6e   can be found on
+00010090: 2074 6865 2073 7973 7465 6d2e 0a20 2020   the system..   
+000100a0: 2055 7365 733a 2074 6573 745f 6269 6e61   Uses: test_bina
+000100b0: 7279 2829 0a0a 0a20 2020 2041 7267 733a  ry()...    Args:
+000100c0: 0a20 2020 2020 204d 533a 2041 2070 6174  .      MS: A pat
+000100d0: 6820 746f 2074 6865 2065 7865 6375 7461  h to the executa
+000100e0: 626c 652c 2069 6e73 7461 6c6c 6564 2063  ble, installed c
+000100f0: 6f6d 6d61 6e64 2c20 6f72 206f 6e65 206f  ommand, or one o
+00010100: 6620 7468 6520 6b65 7977 6f72 6473 207b  f the keywords {
+00010110: 2761 7574 6f27 2c20 2777 696e 272c 2027  'auto', 'win', '
+00010120: 6d61 6327 7d0a 0a20 2020 2052 6574 7572  mac'}..    Retur
+00010130: 6e73 3a0a 2020 2020 2020 5061 7468 2074  ns:.      Path t
+00010140: 6f20 7468 6520 6578 6563 7574 6162 6c65  o the executable
+00010150: 2069 6620 666f 756e 6420 6f72 204e 6f6e   if found or Non
+00010160: 652e 0a20 2020 2022 2222 0a20 2020 2069  e..    """.    i
+00010170: 6620 4d53 2069 7320 4e6f 6e65 3a0a 2020  f MS is None:.  
+00010180: 2020 2020 2020 7265 7475 726e 204d 530a        return MS.
+00010190: 2020 2020 6966 204d 5320 3d3d 2027 6175      if MS == 'au
+000101a0: 746f 273a 0a20 2020 2020 2020 206d 6170  to':.        map
+000101b0: 7069 6e67 203d 207b 0a20 2020 2020 2020  ping = {.       
+000101c0: 2020 2020 2027 5769 6e64 6f77 7327 3a20       'Windows': 
+000101d0: 2777 696e 272c 0a20 2020 2020 2020 2020  'win',.         
+000101e0: 2020 2027 4461 7277 696e 273a 2027 6d61     'Darwin': 'ma
+000101f0: 6327 2c0a 2020 2020 2020 2020 2020 2020  c',.            
+00010200: 274c 696e 7578 273a 2027 6d73 636f 7265  'Linux': 'mscore
+00010210: 270a 2020 2020 2020 2020 7d0a 2020 2020  '.        }.    
+00010220: 2020 2020 7379 7374 656d 203d 2070 6c61      system = pla
+00010230: 7466 6f72 6d2e 7379 7374 656d 2829 0a20  tform.system(). 
+00010240: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00010250: 2020 2020 2020 2020 4d53 203d 206d 6170          MS = map
+00010260: 7069 6e67 5b73 7973 7465 6d5d 0a20 2020  ping[system].   
+00010270: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00010280: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+00010290: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
+000102a0: 6728 6622 5379 7374 656d 2063 6f75 6c64  g(f"System could
+000102b0: 206e 6f74 2062 6520 696e 6665 7272 6564   not be inferred
+000102c0: 3a20 7b73 7973 7465 6d7d 2229 0a20 2020  : {system}").   
+000102d0: 2020 2020 2020 2020 204d 5320 3d20 276d           MS = 'm
+000102e0: 7363 6f72 6527 0a20 2020 2069 6620 4d53  score'.    if MS
+000102f0: 203d 3d20 2777 696e 273a 0a20 2020 2020   == 'win':.     
+00010300: 2020 2070 726f 6772 616d 5f66 696c 6573     program_files
+00010310: 203d 206f 732e 656e 7669 726f 6e5b 2750   = os.environ['P
+00010320: 524f 4752 414d 4649 4c45 5327 5d0a 2020  ROGRAMFILES'].  
+00010330: 2020 2020 2020 4d53 203d 206f 732e 7061        MS = os.pa
+00010340: 7468 2e6a 6f69 6e28 7072 6f67 7261 6d5f  th.join(program_
+00010350: 6669 6c65 732c 2072 224d 7573 6553 636f  files, r"MuseSco
+00010360: 7265 2033 5c62 696e 5c4d 7573 6553 636f  re 3\bin\MuseSco
+00010370: 7265 332e 6578 6522 290a 2020 2020 656c  re3.exe").    el
+00010380: 6966 204d 5320 3d3d 2027 6d61 6327 3a0a  if MS == 'mac':.
+00010390: 2020 2020 2020 2020 4d53 203d 2022 2f41          MS = "/A
+000103a0: 7070 6c69 6361 7469 6f6e 732f 4d75 7365  pplications/Muse
+000103b0: 5363 6f72 6520 332e 6170 702f 436f 6e74  Score 3.app/Cont
+000103c0: 656e 7473 2f4d 6163 4f53 2f6d 7363 6f72  ents/MacOS/mscor
+000103d0: 6522 0a20 2020 2072 6574 7572 6e20 7465  e".    return te
+000103e0: 7374 5f62 696e 6172 7928 4d53 2c20 6c6f  st_binary(MS, lo
+000103f0: 6767 6572 3d6c 6f67 6765 7229 0a0a 0a64  gger=logger)...d
+00010400: 6566 2067 6574 5f70 6174 685f 636f 6d70  ef get_path_comp
+00010410: 6f6e 656e 7428 7061 7468 2c20 6166 7465  onent(path, afte
+00010420: 7229 3a0a 2020 2020 2222 2252 6574 7572  r):.    """Retur
+00010430: 6e73 206f 6e6c 7920 7468 6520 7061 7468  ns only the path
+00010440: 2773 2073 7562 666f 6c64 6572 7320 6265  's subfolders be
+00010450: 6c6f 7720 6060 6166 7465 7260 602e 2049  low ``after``. I
+00010460: 6620 6060 6166 7465 7260 6020 6973 2074  f ``after`` is t
+00010470: 6865 206c 6173 740a 2020 2020 636f 6d70  he last.    comp
+00010480: 6f6e 656e 742c 2027 2e27 2069 7320 7265  onent, '.' is re
+00010490: 7475 726e 6564 2e22 2222 0a20 2020 2064  turned.""".    d
+000104a0: 6972 312c 2062 6173 6531 203d 206f 732e  ir1, base1 = os.
+000104b0: 7061 7468 2e73 706c 6974 2870 6174 6829  path.split(path)
+000104c0: 0a20 2020 2069 6620 6469 7231 2069 6e20  .    if dir1 in 
+000104d0: 2827 272c 2027 2e27 2c20 272f 272c 2027  ('', '.', '/', '
+000104e0: 7e27 293a 0a20 2020 2020 2020 2069 6620  ~'):.        if 
+000104f0: 6261 7365 3120 3d3d 2061 6674 6572 3a0a  base1 == after:.
+00010500: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00010510: 726e 2027 2e27 0a20 2020 2020 2020 2072  rn '.'.        r
+00010520: 6574 7572 6e20 7061 7468 0a20 2020 2064  eturn path.    d
+00010530: 6972 322c 2062 6173 6532 203d 206f 732e  ir2, base2 = os.
+00010540: 7061 7468 2e73 706c 6974 2864 6972 3129  path.split(dir1)
+00010550: 0a20 2020 2069 6620 6261 7365 3220 3d3d  .    if base2 ==
+00010560: 2061 6674 6572 3a0a 2020 2020 2020 2020   after:.        
+00010570: 7265 7475 726e 2062 6173 6531 0a20 2020  return base1.   
+00010580: 2068 6967 6865 725f 6c65 7665 6c73 203d   higher_levels =
+00010590: 2067 6574 5f70 6174 685f 636f 6d70 6f6e   get_path_compon
+000105a0: 656e 7428 6469 7231 2c20 6166 7465 723d  ent(dir1, after=
+000105b0: 6166 7465 7229 0a20 2020 2072 6574 7572  after).    retur
+000105c0: 6e20 6f73 2e70 6174 682e 6a6f 696e 2868  n os.path.join(h
+000105d0: 6967 6865 725f 6c65 7665 6c73 2c20 6261  igher_levels, ba
+000105e0: 7365 3129 0a0a 0a23 2064 6566 2067 6574  se1)...# def get
+000105f0: 5f71 7561 7274 6572 6265 6174 735f 6c65  _quarterbeats_le
+00010600: 6e67 7468 286d 6561 7375 7265 733a 2070  ngth(measures: p
+00010610: 642e 4461 7461 4672 616d 652c 2064 6563  d.DataFrame, dec
+00010620: 696d 616c 733a 2069 6e74 203d 2032 2920  imals: int = 2) 
+00010630: 2d3e 2054 7570 6c65 5b66 6c6f 6174 2c20  -> Tuple[float, 
+00010640: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d5d  Optional[float]]
+00010650: 3a0a 2320 2020 2020 2222 2220 5265 7475  :.#     """ Retu
+00010660: 726e 7320 7468 6520 7379 6d62 6f6c 6963  rns the symbolic
+00010670: 206c 656e 6774 6820 616e 6420 756e 666f   length and unfo
+00010680: 6c64 6564 2073 796d 626f 6c69 6320 6c65  lded symbolic le
+00010690: 6e67 7468 206f 6620 6120 7069 6563 6520  ngth of a piece 
+000106a0: 696e 2071 7561 7274 6572 206e 6f74 6573  in quarter notes
+000106b0: 2e0a 230a 2320 2020 2020 5061 7261 6d65  ..#.#     Parame
+000106c0: 7465 7273 0a23 2020 2020 202d 2d2d 2d2d  ters.#     -----
+000106d0: 2d2d 2d2d 2d0a 2320 2020 2020 6d65 6173  -----.#     meas
+000106e0: 7572 6573 203a 203a 6f62 6a3a 6070 616e  ures : :obj:`pan
+000106f0: 6461 732e 4461 7461 4672 616d 6560 0a23  das.DataFrame`.#
+00010700: 0a23 2020 2020 2052 6574 7572 6e73 0a23  .#     Returns.#
+00010710: 2020 2020 202d 2d2d 2d2d 2d2d 0a23 2020       -------.#  
+00010720: 2020 2066 6c6f 6174 2c20 666c 6f61 740a     float, float.
+00010730: 2320 2020 2020 2020 2020 4c65 6e67 7468  #         Length
+00010740: 2061 6e64 2075 6e66 6f6c 6465 6420 6c65   and unfolded le
+00010750: 6e67 7468 2c20 626f 7468 206d 6561 7375  ngth, both measu
+00010760: 7265 7364 2069 6e20 7175 6172 7465 7220  resd in quarter 
+00010770: 6e6f 7465 732e 0a23 2020 2020 2022 2222  notes..#     """
+00010780: 0a23 2020 2020 206d 635f 6475 7261 7469  .#     mc_durati
+00010790: 6f6e 7320 3d20 6d65 6173 7572 6573 2e73  ons = measures.s
+000107a0: 6574 5f69 6e64 6578 2827 6d63 2729 2e61  et_index('mc').a
+000107b0: 6374 5f64 7572 202a 2034 2e0a 2320 2020  ct_dur * 4..#   
+000107c0: 2020 6c65 6e67 7468 5f71 6220 3d20 726f    length_qb = ro
+000107d0: 756e 6428 6d63 5f64 7572 6174 696f 6e73  und(mc_durations
+000107e0: 2e73 756d 2829 2c20 6465 6369 6d61 6c73  .sum(), decimals
+000107f0: 290a 2320 2020 2020 7472 793a 0a23 2020  ).#     try:.#  
+00010800: 2020 2020 2020 2070 6c61 7974 6872 6f75         playthrou
+00010810: 6768 326d 6320 3d20 6d61 6b65 5f70 6c61  gh2mc = make_pla
+00010820: 7974 6872 6f75 6768 326d 6328 6d65 6173  ythrough2mc(meas
+00010830: 7572 6573 2c20 6c6f 6767 6572 3d6c 6f67  ures, logger=log
+00010840: 6765 7229 0a23 2020 2020 2020 2020 2069  ger).#         i
+00010850: 6620 6c65 6e28 706c 6179 7468 726f 7567  f len(playthroug
+00010860: 6832 6d63 2920 3d3d 2030 3a0a 2320 2020  h2mc) == 0:.#   
+00010870: 2020 2020 2020 2020 2020 6c65 6e67 7468            length
+00010880: 5f71 625f 756e 666f 6c64 6564 203d 204e  _qb_unfolded = N
+00010890: 6f6e 650a 2320 2020 2020 2020 2020 656c  one.#         el
+000108a0: 7365 3a0a 2320 2020 2020 2020 2020 2020  se:.#           
+000108b0: 2020 6c65 6e67 7468 5f71 625f 756e 666f    length_qb_unfo
+000108c0: 6c64 6564 203d 2072 6f75 6e64 286d 635f  lded = round(mc_
+000108d0: 6475 7261 7469 6f6e 732e 6c6f 635b 706c  durations.loc[pl
+000108e0: 6179 7468 726f 7567 6832 6d63 2e76 616c  aythrough2mc.val
+000108f0: 7565 735d 2e73 756d 2829 2c20 6465 6369  ues].sum(), deci
+00010900: 6d61 6c73 290a 2320 2020 2020 6578 6365  mals).#     exce
+00010910: 7074 2045 7863 6570 7469 6f6e 3a0a 2320  pt Exception:.# 
+00010920: 2020 2020 2020 2020 6c65 6e67 7468 5f71          length_q
+00010930: 625f 756e 666f 6c64 6564 203d 204e 6f6e  b_unfolded = Non
+00010940: 650a 2320 2020 2020 7265 7475 726e 206c  e.#     return l
+00010950: 656e 6774 685f 7162 2c20 6c65 6e67 7468  ength_qb, length
+00010960: 5f71 625f 756e 666f 6c64 6564 0a0a 0a64  _qb_unfolded...d
+00010970: 6566 2067 726f 7570 5f69 645f 7475 706c  ef group_id_tupl
+00010980: 6573 286c 293a 0a20 2020 2022 2222 2054  es(l):.    """ T
+00010990: 7572 6e73 2061 206c 6973 7420 6f66 2028  urns a list of (
+000109a0: 6b65 792c 2069 7829 2069 6e74 6f20 6120  key, ix) into a 
+000109b0: 7b6b 6579 3a20 5b69 785d 7d0a 0a20 2020  {key: [ix]}..   
+000109c0: 2022 2222 0a20 2020 2064 203d 2064 6566   """.    d = def
+000109d0: 6175 6c74 6469 6374 286c 6973 7429 0a20  aultdict(list). 
+000109e0: 2020 2066 6f72 206b 2c20 6920 696e 206c     for k, i in l
+000109f0: 3a0a 2020 2020 2020 2020 6966 206b 2069  :.        if k i
+00010a00: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00010a10: 2020 2020 2020 2020 645b 6b5d 2e61 7070          d[k].app
+00010a20: 656e 6428 6929 0a20 2020 2072 6574 7572  end(i).    retur
+00010a30: 6e20 6469 6374 2864 290a 0a0a 6465 6620  n dict(d)...def 
+00010a40: 6874 6d6c 3266 6f72 6d61 7428 6466 2c20  html2format(df, 
+00010a50: 666f 726d 6174 3d27 6e61 6d65 272c 2068  format='name', h
+00010a60: 746d 6c5f 636f 6c3d 2763 6f6c 6f72 5f68  tml_col='color_h
+00010a70: 746d 6c27 293a 0a20 2020 2022 2222 2043  tml'):.    """ C
+00010a80: 6f6e 7665 7274 7320 7468 6520 4854 4d4c  onverts the HTML
+00010a90: 2063 6f6c 756d 6e20 6f66 2061 2044 6174   column of a Dat
+00010aa0: 6146 7261 6d65 2069 6e74 6f20 276e 616d  aFrame into 'nam
+00010ab0: 6527 2c20 2772 6762 202c 206f 7220 2772  e', 'rgb , or 'r
+00010ac0: 6762 6127 2e20 2222 220a 2020 2020 6966  gba'. """.    if
+00010ad0: 2066 6f72 6d61 7420 3d3d 2027 6e61 6d65   format == 'name
+00010ae0: 273a 0a20 2020 2020 2020 2072 6574 7572  ':.        retur
+00010af0: 6e20 6466 5b68 746d 6c5f 636f 6c5d 2e6d  n df[html_col].m
+00010b00: 6170 2863 6f6c 6f72 5f6e 616d 6532 6874  ap(color_name2ht
+00010b10: 6d6c 290a 2020 2020 6966 2066 6f72 6d61  ml).    if forma
+00010b20: 7420 3d3d 2027 7267 6227 3a0a 2020 2020  t == 'rgb':.    
+00010b30: 2020 2020 7265 7475 726e 2064 665b 6874      return df[ht
+00010b40: 6d6c 5f63 6f6c 5d2e 6d61 7028 636f 6c6f  ml_col].map(colo
+00010b50: 725f 6e61 6d65 3272 6762 290a 2020 2020  r_name2rgb).    
+00010b60: 6966 2066 6f72 6d61 7420 3d3d 2027 7267  if format == 'rg
+00010b70: 6261 273a 0a20 2020 2020 2020 2072 6574  ba':.        ret
+00010b80: 7572 6e20 6466 5b68 746d 6c5f 636f 6c5d  urn df[html_col]
+00010b90: 2e6d 6170 2863 6f6c 6f72 5f6e 616d 6532  .map(color_name2
+00010ba0: 7267 6261 290a 0a0a 6465 6620 6874 6d6c  rgba)...def html
+00010bb0: 5f63 6f6c 6f72 3266 6f72 6d61 7428 682c  _color2format(h,
+00010bc0: 2066 6f72 6d61 743d 276e 616d 6527 293a   format='name'):
+00010bd0: 0a20 2020 2022 2222 2043 6f6e 7665 7274  .    """ Convert
+00010be0: 7320 6120 7369 6e67 6c65 2048 544d 4c20  s a single HTML 
+00010bf0: 636f 6c6f 7220 696e 746f 2027 6e61 6d65  color into 'name
+00010c00: 272c 2027 7267 6227 2c20 6f72 2020 2772  ', 'rgb', or  'r
+00010c10: 6762 6127 2e22 2222 0a20 2020 2069 6620  gba'.""".    if 
+00010c20: 7064 2e69 736e 756c 6c28 6829 3a0a 2020  pd.isnull(h):.  
+00010c30: 2020 2020 2020 7265 7475 726e 2068 0a20        return h. 
+00010c40: 2020 2069 6620 666f 726d 6174 203d 3d20     if format == 
+00010c50: 276e 616d 6527 3a0a 2020 2020 2020 2020  'name':.        
+00010c60: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00010c70: 2072 6574 7572 6e20 7765 6263 6f6c 6f72   return webcolor
+00010c80: 732e 6865 785f 746f 5f6e 616d 6528 6829  s.hex_to_name(h)
+00010c90: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00010ca0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00010cb0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00010cc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00010cd0: 726e 204d 5333 5f48 544d 4c5b 685d 0a20  rn MS3_HTML[h]. 
+00010ce0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00010cf0: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
+00010d00: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00010d10: 7572 6e20 680a 2020 2020 6966 2066 6f72  urn h.    if for
+00010d20: 6d61 7420 3d3d 2027 7267 6227 3a0a 2020  mat == 'rgb':.  
+00010d30: 2020 2020 2020 7265 7475 726e 2077 6562        return web
+00010d40: 636f 6c6f 7273 2e68 6578 5f74 6f5f 7267  colors.hex_to_rg
+00010d50: 6228 6829 0a20 2020 2069 6620 666f 726d  b(h).    if form
+00010d60: 6174 203d 3d20 2772 6762 6127 3a0a 2020  at == 'rgba':.  
+00010d70: 2020 2020 2020 7267 6220 3d20 7765 6263        rgb = webc
+00010d80: 6f6c 6f72 732e 6865 785f 746f 5f72 6762  olors.hex_to_rgb
+00010d90: 2868 290a 2020 2020 2020 2020 7265 7475  (h).        retu
+00010da0: 726e 2072 6762 6128 2a28 7267 6220 2b20  rn rgba(*(rgb + 
+00010db0: 2832 3535 2c29 2929 0a0a 0a64 6566 2068  (255,)))...def h
+00010dc0: 746d 6c5f 636f 6c6f 7232 6e61 6d65 2868  tml_color2name(h
+00010dd0: 293a 0a20 2020 2022 2222 2043 6f6e 7665  ):.    """ Conve
+00010de0: 7274 7320 6120 4854 4d4c 2063 6f6c 6f72  rts a HTML color
+00010df0: 2069 6e74 6f20 6974 7320 4353 5333 206e   into its CSS3 n
+00010e00: 616d 6520 6f72 2069 7473 656c 6620 6966  ame or itself if
+00010e10: 2074 6865 7265 2069 7320 6e6f 6e65 2e22   there is none."
+00010e20: 2222 0a20 2020 2072 6574 7572 6e20 6874  "".    return ht
+00010e30: 6d6c 5f63 6f6c 6f72 3266 6f72 6d61 7428  ml_color2format(
+00010e40: 682c 2027 6e61 6d65 2729 0a0a 0a64 6566  h, 'name')...def
+00010e50: 2068 746d 6c5f 636f 6c6f 7232 7267 6228   html_color2rgb(
+00010e60: 6829 3a0a 2020 2020 2222 2220 436f 6e76  h):.    """ Conv
+00010e70: 6572 7473 2061 2048 544d 4c20 636f 6c6f  erts a HTML colo
+00010e80: 7220 696e 746f 2052 4742 2e22 2222 0a20  r into RGB.""". 
+00010e90: 2020 2072 6574 7572 6e20 6874 6d6c 5f63     return html_c
+00010ea0: 6f6c 6f72 3266 6f72 6d61 7428 682c 2027  olor2format(h, '
+00010eb0: 7267 6227 290a 0a0a 6465 6620 6874 6d6c  rgb')...def html
+00010ec0: 5f63 6f6c 6f72 3272 6762 6128 6829 3a0a  _color2rgba(h):.
+00010ed0: 2020 2020 2222 2220 436f 6e76 6572 7473      """ Converts
+00010ee0: 2061 2048 544d 4c20 636f 6c6f 7220 696e   a HTML color in
+00010ef0: 746f 2052 4742 412e 2222 220a 2020 2020  to RGBA.""".    
+00010f00: 7265 7475 726e 2068 746d 6c5f 636f 6c6f  return html_colo
+00010f10: 7232 666f 726d 6174 2868 2c20 2772 6762  r2format(h, 'rgb
+00010f20: 6127 290a 0a0a 6465 6620 696e 7465 7276  a')...def interv
+00010f30: 616c 5f6f 7665 726c 6170 2861 2c20 622c  al_overlap(a, b,
+00010f40: 2063 6c6f 7365 643d 4e6f 6e65 293a 0a20   closed=None):. 
+00010f50: 2020 2022 2222 2052 6574 7572 6e73 2074     """ Returns t
+00010f60: 6865 206f 7665 726c 6170 206f 6620 7477  he overlap of tw
+00010f70: 6f20 7064 2e49 6e74 6572 7661 6c73 2061  o pd.Intervals a
+00010f80: 7320 6120 6e65 7720 7064 2e49 6e74 6572  s a new pd.Inter
+00010f90: 7661 6c2e 0a0a 2020 2020 5061 7261 6d65  val...    Parame
+00010fa0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00010fb0: 2d2d 2d0a 2020 2020 612c 2062 203a 203a  ---.    a, b : :
+00010fc0: 6f62 6a3a 6070 616e 6461 732e 496e 7465  obj:`pandas.Inte
+00010fd0: 7276 616c 600a 2020 2020 2020 2020 496e  rval`.        In
+00010fe0: 7465 7276 616c 7320 666f 7220 7768 6963  tervals for whic
+00010ff0: 6820 746f 2063 6f6d 7075 7465 2074 6865  h to compute the
+00011000: 206f 7665 726c 6170 2e0a 2020 2020 636c   overlap..    cl
+00011010: 6f73 6564 203a 207b 276c 6566 7427 2c20  osed : {'left', 
+00011020: 2772 6967 6874 272c 2027 626f 7468 272c  'right', 'both',
+00011030: 2027 6e65 6974 6865 7227 7d2c 206f 7074   'neither'}, opt
+00011040: 696f 6e61 6c0a 2020 2020 2020 2020 4966  ional.        If
+00011050: 206e 6f20 7661 6c75 6520 6973 2070 6173   no value is pas
+00011060: 7365 642c 2074 6865 2063 6c6f 7375 7265  sed, the closure
+00011070: 206f 6620 7468 6520 7265 7475 726e 6564   of the returned
+00011080: 2069 6e74 6572 7661 6c20 6973 2069 6e66   interval is inf
+00011090: 6572 7265 6420 6672 6f6d 2060 6061 6060  erred from ``a``
+000110a0: 2061 6e64 2060 6062 6060 2e0a 0a20 2020   and ``b``...   
+000110b0: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+000110c0: 2d2d 2d2d 0a20 2020 203a 6f62 6a3a 6070  ----.    :obj:`p
+000110d0: 616e 6461 732e 496e 7465 7276 616c 600a  andas.Interval`.
+000110e0: 2020 2020 2222 220a 2020 2020 6966 206e      """.    if n
+000110f0: 6f74 2061 2e6f 7665 726c 6170 7328 6229  ot a.overlaps(b)
+00011100: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00011110: 204e 6f6e 650a 2020 2020 6966 2062 2e6c   None.    if b.l
+00011120: 6566 7420 3c20 612e 6c65 6674 3a0a 2020  eft < a.left:.  
+00011130: 2020 2020 2020 2320 6d61 6b69 6e67 2061        # making a
+00011140: 2074 6865 206c 6566 746d 6f73 7420 696e   the leftmost in
+00011150: 7465 7276 616c 0a20 2020 2020 2020 2061  terval.        a
+00011160: 2c20 6220 3d20 622c 2061 0a20 2020 2069  , b = b, a.    i
+00011170: 6620 636c 6f73 6564 2069 7320 4e6f 6e65  f closed is None
+00011180: 3a0a 2020 2020 2020 2020 6966 2061 2e72  :.        if a.r
+00011190: 6967 6874 203c 2062 2e72 6967 6874 3a0a  ight < b.right:.
+000111a0: 2020 2020 2020 2020 2020 2020 7269 6768              righ
+000111b0: 7420 3d20 612e 7269 6768 740a 2020 2020  t = a.right.    
+000111c0: 2020 2020 2020 2020 7269 6768 745f 636c          right_cl
+000111d0: 6f73 6564 203d 2061 2e63 6c6f 7365 6420  osed = a.closed 
+000111e0: 696e 2028 2772 6967 6874 272c 2027 626f  in ('right', 'bo
+000111f0: 7468 2729 0a20 2020 2020 2020 2020 2020  th').           
+00011200: 206f 7468 6572 5f69 7620 3d20 620a 2020   other_iv = b.  
+00011210: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00011220: 2020 2020 2020 2020 7269 6768 7420 3d20          right = 
+00011230: 622e 7269 6768 740a 2020 2020 2020 2020  b.right.        
+00011240: 2020 2020 7269 6768 745f 636c 6f73 6564      right_closed
+00011250: 203d 2062 2e63 6c6f 7365 6420 696e 2028   = b.closed in (
+00011260: 2772 6967 6874 272c 2027 626f 7468 2729  'right', 'both')
+00011270: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+00011280: 6572 5f69 7620 3d20 610a 2020 2020 2020  er_iv = a.      
+00011290: 2020 6966 2072 6967 6874 5f63 6c6f 7365    if right_close
+000112a0: 6420 616e 6420 7269 6768 7420 3d3d 206f  d and right == o
+000112b0: 7468 6572 5f69 762e 7269 6768 7420 616e  ther_iv.right an
+000112c0: 6420 6f74 6865 725f 6976 2e63 6c6f 7365  d other_iv.close
+000112d0: 6420 6e6f 7420 696e 2028 2772 6967 6874  d not in ('right
+000112e0: 272c 2027 626f 7468 2729 3a0a 2020 2020  ', 'both'):.    
+000112f0: 2020 2020 2020 2020 7269 6768 745f 636c          right_cl
+00011300: 6f73 6564 203d 2046 616c 7365 0a20 2020  osed = False.   
+00011310: 2020 2020 206c 6566 745f 636c 6f73 6564       left_closed
+00011320: 203d 2062 2e63 6c6f 7365 6420 696e 2028   = b.closed in (
+00011330: 276c 6566 7427 2c20 2762 6f74 6827 290a  'left', 'both').
+00011340: 2020 2020 2020 2020 6966 206c 6566 745f          if left_
+00011350: 636c 6f73 6564 2061 6e64 2061 2e6c 6566  closed and a.lef
+00011360: 7420 3d3d 2062 2e6c 6566 7420 616e 6420  t == b.left and 
+00011370: 612e 636c 6f73 6564 206e 6f74 2069 6e20  a.closed not in 
+00011380: 2827 6c65 6674 272c 2027 626f 7468 2729  ('left', 'both')
+00011390: 3a0a 2020 2020 2020 2020 2020 2020 6c65  :.            le
+000113a0: 6674 5f63 6c6f 7365 6420 3d20 4661 6c73  ft_closed = Fals
+000113b0: 650a 0a20 2020 2020 2020 2069 6620 6c65  e..        if le
+000113c0: 6674 5f63 6c6f 7365 6420 616e 6420 7269  ft_closed and ri
+000113d0: 6768 745f 636c 6f73 6564 3a0a 2020 2020  ght_closed:.    
+000113e0: 2020 2020 2020 2020 636c 6f73 6564 203d          closed =
+000113f0: 2027 626f 7468 270a 2020 2020 2020 2020   'both'.        
+00011400: 656c 6966 206c 6566 745f 636c 6f73 6564  elif left_closed
+00011410: 3a0a 2020 2020 2020 2020 2020 2020 636c  :.            cl
+00011420: 6f73 6564 203d 2027 6c65 6674 270a 2020  osed = 'left'.  
+00011430: 2020 2020 2020 656c 6966 2072 6967 6874        elif right
+00011440: 5f63 6c6f 7365 643a 0a20 2020 2020 2020  _closed:.       
+00011450: 2020 2020 2063 6c6f 7365 6420 3d20 2772       closed = 'r
+00011460: 6967 6874 270a 2020 2020 2020 2020 656c  ight'.        el
+00011470: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00011480: 636c 6f73 6564 203d 2027 6e65 6974 6865  closed = 'neithe
+00011490: 7227 0a20 2020 2065 6c73 653a 0a20 2020  r'.    else:.   
+000114a0: 2020 2020 2072 6967 6874 203d 2061 2e72       right = a.r
+000114b0: 6967 6874 2069 6620 612e 7269 6768 7420  ight if a.right 
+000114c0: 3c20 622e 7269 6768 7420 656c 7365 2062  < b.right else b
+000114d0: 2e72 6967 6874 0a20 2020 2072 6574 7572  .right.    retur
+000114e0: 6e20 7064 2e49 6e74 6572 7661 6c28 622e  n pd.Interval(b.
+000114f0: 6c65 6674 2c20 7269 6768 742c 2063 6c6f  left, right, clo
+00011500: 7365 643d 636c 6f73 6564 290a 0a0a 6465  sed=closed)...de
+00011510: 6620 696e 7465 7276 616c 5f6f 7665 726c  f interval_overl
+00011520: 6170 5f73 697a 6528 612c 2062 2c20 6465  ap_size(a, b, de
+00011530: 6369 6d61 6c73 3d33 293a 0a20 2020 2022  cimals=3):.    "
+00011540: 2222 5265 7475 726e 7320 7468 6520 7369  ""Returns the si
+00011550: 7a65 206f 6620 7468 6520 6f76 6572 6c61  ze of the overla
+00011560: 7020 6f66 2074 776f 2070 642e 496e 7465  p of two pd.Inte
+00011570: 7276 616c 732e 2222 220a 2020 2020 6966  rvals.""".    if
+00011580: 206e 6f74 2061 2e6f 7665 726c 6170 7328   not a.overlaps(
+00011590: 6229 3a0a 2020 2020 2020 2020 7265 7475  b):.        retu
+000115a0: 726e 2030 2e30 0a20 2020 2069 6620 622e  rn 0.0.    if b.
+000115b0: 6c65 6674 203c 2061 2e6c 6566 743a 0a20  left < a.left:. 
+000115c0: 2020 2020 2020 2023 206d 616b 696e 6720         # making 
+000115d0: 6120 7468 6520 6c65 6674 6d6f 7374 2069  a the leftmost i
+000115e0: 6e74 6572 7661 6c0a 2020 2020 2020 2020  nterval.        
+000115f0: 612c 2062 203d 2062 2c20 610a 2020 2020  a, b = b, a.    
+00011600: 7269 6768 7420 3d20 612e 7269 6768 7420  right = a.right 
+00011610: 6966 2061 2e72 6967 6874 203c 2062 2e72  if a.right < b.r
+00011620: 6967 6874 2065 6c73 6520 622e 7269 6768  ight else b.righ
+00011630: 740a 2020 2020 7265 7375 6c74 203d 2072  t.    result = r
+00011640: 6967 6874 202d 2062 2e6c 6566 740a 2020  ight - b.left.  
+00011650: 2020 7265 7475 726e 2072 6f75 6e64 2872    return round(r
+00011660: 6573 756c 742c 2064 6563 696d 616c 7329  esult, decimals)
+00011670: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
+00011680: 6572 0a64 6566 2069 735f 616e 795f 726f  er.def is_any_ro
+00011690: 775f 6571 7561 6c28 6466 312c 2064 6632  w_equal(df1, df2
+000116a0: 293a 0a20 2020 2022 2222 2052 6574 7572  ):.    """ Retur
+000116b0: 6e73 2054 7275 6520 6966 2061 6e79 2074  ns True if any t
+000116c0: 776f 2072 6f77 7320 6f66 2074 6865 2074  wo rows of the t
+000116d0: 776f 2044 6174 6146 7261 6d65 7320 636f  wo DataFrames co
+000116e0: 6e74 6169 6e20 7468 6520 7361 6d65 2076  ntain the same v
+000116f0: 616c 7565 2074 7570 6c65 732e 2022 2222  alue tuples. """
+00011700: 0a20 2020 2061 7373 6572 7420 6c65 6e28  .    assert len(
+00011710: 6466 312e 636f 6c75 6d6e 7329 203d 3d20  df1.columns) == 
+00011720: 6c65 6e28 6466 322e 636f 6c75 6d6e 7329  len(df2.columns)
+00011730: 2c20 2250 6173 7320 7468 6520 7361 6d65  , "Pass the same
+00011740: 206e 756d 6265 7220 6f66 2063 6f6c 756d   number of colum
+00011750: 6e73 2066 6f72 2062 6f74 6820 4461 7461  ns for both Data
+00011760: 4672 616d 6573 220a 2020 2020 7631 203d  Frames".    v1 =
+00011770: 2073 6574 2864 6631 2e69 7465 7274 7570   set(df1.itertup
+00011780: 6c65 7328 696e 6465 783d 4661 6c73 652c  les(index=False,
+00011790: 206e 616d 653d 4e6f 6e65 2929 0a20 2020   name=None)).   
+000117a0: 2076 3220 3d20 7365 7428 6466 322e 6974   v2 = set(df2.it
+000117b0: 6572 7475 706c 6573 2869 6e64 6578 3d46  ertuples(index=F
+000117c0: 616c 7365 2c20 6e61 6d65 3d4e 6f6e 6529  alse, name=None)
+000117d0: 290a 2020 2020 7265 7475 726e 2076 312e  ).    return v1.
+000117e0: 696e 7465 7273 6563 7469 6f6e 2876 3229  intersection(v2)
+000117f0: 0a0a 0a64 6566 2069 735f 6d69 6e6f 725f  ...def is_minor_
+00011800: 6d6f 6465 2866 6966 7468 732c 206d 696e  mode(fifths, min
+00011810: 6f72 3d46 616c 7365 293a 0a20 2020 2022  or=False):.    "
+00011820: 2222 2052 6574 7572 6e73 2054 7275 6520  "" Returns True 
+00011830: 6966 2074 6865 2073 6361 6c65 2064 6567  if the scale deg
+00011840: 7265 6520 6066 6966 7468 7360 206e 6174  ree `fifths` nat
+00011850: 7572 616c 6c79 2068 6173 2061 206d 696e  urally has a min
+00011860: 6f72 2074 6869 7264 2069 6e20 7468 6520  or third in the 
+00011870: 7363 616c 652e 0a20 2020 2022 2222 0a20  scale..    """. 
+00011880: 2020 2074 6869 7264 7320 3d20 5b2d 342c     thirds = [-4,
+00011890: 202d 332c 202d 322c 202d 312c 2030 2c20   -3, -2, -1, 0, 
+000118a0: 312c 2032 5d20 6966 206d 696e 6f72 2065  1, 2] if minor e
+000118b0: 6c73 6520 5b33 2c20 342c 2035 2c20 2d31  lse [3, 4, 5, -1
+000118c0: 2c20 302c 2031 2c20 325d 0a20 2020 2074  , 0, 1, 2].    t
+000118d0: 6869 7264 203d 2074 6869 7264 735b 2866  hird = thirds[(f
+000118e0: 6966 7468 7320 2b20 3129 2025 2037 5d20  ifths + 1) % 7] 
+000118f0: 2d20 6669 6674 6873 0a20 2020 2072 6574  - fifths.    ret
+00011900: 7572 6e20 7468 6972 6420 3d3d 202d 330a  urn third == -3.
+00011910: 0a0a 6465 6620 6974 6572 5f6e 6573 7465  ..def iter_neste
+00011920: 6428 6e65 7374 6564 293a 0a20 2020 2022  d(nested):.    "
+00011930: 2222 4974 6572 6174 6520 7468 726f 7567  ""Iterate throug
+00011940: 6820 616e 7920 6e65 7374 6564 2073 7472  h any nested str
+00011950: 7563 7475 7265 206f 6620 6c69 7374 7320  ucture of lists 
+00011960: 616e 6420 7475 706c 6573 2066 726f 6d20  and tuples from 
+00011970: 6c65 6674 2074 6f20 7269 6768 742e 2222  left to right.""
+00011980: 220a 2020 2020 666f 7220 656c 656d 2069  ".    for elem i
+00011990: 6e20 6e65 7374 6564 3a0a 2020 2020 2020  n nested:.      
+000119a0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000119b0: 656c 656d 2c20 6c69 7374 2920 6f72 2069  elem, list) or i
+000119c0: 7369 6e73 7461 6e63 6528 656c 656d 2c20  sinstance(elem, 
+000119d0: 7475 706c 6529 3a0a 2020 2020 2020 2020  tuple):.        
+000119e0: 2020 2020 666f 7220 6c6f 7765 7220 696e      for lower in
+000119f0: 2069 7465 725f 6e65 7374 6564 2865 6c65   iter_nested(ele
+00011a00: 6d29 3a0a 2020 2020 2020 2020 2020 2020  m):.            
+00011a10: 2020 2020 7969 656c 6420 6c6f 7765 720a      yield lower.
+00011a20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00011a30: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+00011a40: 656c 656d 0a0a 0a64 6566 2069 7465 725f  elem...def iter_
+00011a50: 7365 6c65 6374 696f 6e28 636f 6c6c 6563  selection(collec
+00011a60: 7469 6f2c 2073 656c 6563 746f 723d 4e6f  tio, selector=No
+00011a70: 6e65 2c20 6f70 706f 7369 7465 3d46 616c  ne, opposite=Fal
+00011a80: 7365 293a 0a20 2020 2022 2222 2052 6574  se):.    """ Ret
+00011a90: 7572 6e73 2061 2067 656e 6572 6174 6f72  urns a generator
+00011aa0: 206f 6620 6060 636f 6c6c 6563 7469 6f60   of ``collectio`
+00011ab0: 602e 2060 6073 656c 6563 746f 7260 6020  `. ``selector`` 
+00011ac0: 6361 6e20 6265 2061 2063 6f6c 6c65 6374  can be a collect
+00011ad0: 696f 6e20 6f66 2069 6e64 6578 206e 756d  ion of index num
+00011ae0: 6265 7273 2074 6f20 7365 6c65 6374 206f  bers to select o
+00011af0: 7220 756e 7365 6c65 6374 0a20 2020 2065  r unselect.    e
+00011b00: 6c65 6d65 6e74 7320 2d2d 2064 6570 656e  lements -- depen
+00011b10: 6469 6e67 206f 6e20 6060 6f70 706f 7369  ding on ``opposi
+00011b20: 7465 6060 2022 2222 0a20 2020 2069 6620  te`` """.    if 
+00011b30: 7365 6c65 6374 6f72 2069 7320 4e6f 6e65  selector is None
+00011b40: 3a0a 2020 2020 2020 2020 666f 7220 6520  :.        for e 
+00011b50: 696e 2063 6f6c 6c65 6374 696f 3a0a 2020  in collectio:.  
+00011b60: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+00011b70: 650a 2020 2020 6966 206f 7070 6f73 6974  e.    if opposit
+00011b80: 653a 0a20 2020 2020 2020 2066 6f72 2069  e:.        for i
+00011b90: 2c20 6520 696e 2065 6e75 6d65 7261 7465  , e in enumerate
+00011ba0: 2863 6f6c 6c65 6374 696f 293a 0a20 2020  (collectio):.   
+00011bb0: 2020 2020 2020 2020 2069 6620 6920 6e6f           if i no
+00011bc0: 7420 696e 2073 656c 6563 746f 723a 0a20  t in selector:. 
+00011bd0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00011be0: 6965 6c64 2065 0a20 2020 2065 6c73 653a  ield e.    else:
+00011bf0: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
+00011c00: 6520 696e 2065 6e75 6d65 7261 7465 2863  e in enumerate(c
+00011c10: 6f6c 6c65 6374 696f 293a 0a20 2020 2020  ollectio):.     
+00011c20: 2020 2020 2020 2069 6620 6920 696e 2073         if i in s
+00011c30: 656c 6563 746f 723a 0a20 2020 2020 2020  elector:.       
+00011c40: 2020 2020 2020 2020 2079 6965 6c64 2065           yield e
+00011c50: 0a0a 0a64 6566 2069 7465 7261 626c 6532  ...def iterable2
+00011c60: 7374 7228 6974 6572 6162 6c65 293a 0a20  str(iterable):. 
+00011c70: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00011c80: 7265 7475 726e 2027 2c20 272e 6a6f 696e  return ', '.join
+00011c90: 2873 7472 2873 2920 666f 7220 7320 696e  (str(s) for s in
+00011ca0: 2069 7465 7261 626c 6529 0a20 2020 2065   iterable).    e
+00011cb0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00011cc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011cd0: 6974 6572 6162 6c65 0a0a 0a64 6566 2063  iterable...def c
+00011ce0: 6f6e 7461 696e 735f 6d65 7461 6461 7461  ontains_metadata
+00011cf0: 2870 6174 6829 3a0a 2020 2020 666f 7220  (path):.    for 
+00011d00: 5f2c 205f 2c20 6669 6c65 7320 696e 206f  _, _, files in o
+00011d10: 732e 7761 6c6b 2870 6174 6829 3a0a 2020  s.walk(path):.  
+00011d20: 2020 2020 2020 7265 7475 726e 2061 6e79        return any
+00011d30: 2866 203d 3d20 276d 6574 6164 6174 612e  (f == 'metadata.
+00011d40: 7473 7627 2066 6f72 2066 2069 6e20 6669  tsv' for f in fi
+00011d50: 6c65 7329 0a0a 6465 6620 6669 7273 745f  les)..def first_
+00011d60: 6c65 7665 6c5f 7375 6264 6972 7328 7061  level_subdirs(pa
+00011d70: 7468 293a 0a20 2020 2022 2222 5265 7475  th):.    """Retu
+00011d80: 726e 7320 7468 6520 6469 7265 6374 6f72  rns the director
+00011d90: 7920 6e61 6d65 7320 636f 6e74 6169 6e65  y names containe
+00011da0: 6420 696e 2070 6174 682e 2222 220a 2020  d in path.""".  
+00011db0: 2020 666f 7220 5f2c 2073 7562 6469 7273    for _, subdirs
+00011dc0: 2c20 5f20 696e 206f 732e 7761 6c6b 2870  , _ in os.walk(p
+00011dd0: 6174 6829 3a0a 2020 2020 2020 2020 7265  ath):.        re
+00011de0: 7475 726e 2073 7562 6469 7273 0a0a 6465  turn subdirs..de
+00011df0: 6620 6669 7273 745f 6c65 7665 6c5f 6669  f first_level_fi
+00011e00: 6c65 735f 616e 645f 7375 6264 6972 7328  les_and_subdirs(
+00011e10: 7061 7468 293a 0a20 2020 2022 2222 5265  path):.    """Re
+00011e20: 7475 726e 7320 7468 6520 6469 7265 6374  turns the direct
+00011e30: 6f72 7920 6e61 6d65 7320 616e 6420 6669  ory names and fi
+00011e40: 6c65 6e61 6d65 7320 636f 6e74 6169 6e65  lenames containe
+00011e50: 6420 696e 2070 6174 682e 2222 220a 2020  d in path.""".  
+00011e60: 2020 666f 7220 5f2c 2073 7562 6469 7273    for _, subdirs
+00011e70: 2c20 6669 6c65 7320 696e 206f 732e 7761  , files in os.wa
+00011e80: 6c6b 2870 6174 6829 3a0a 2020 2020 2020  lk(path):.      
+00011e90: 2020 7265 7475 726e 2073 7562 6469 7273    return subdirs
+00011ea0: 2c20 6669 6c65 730a 0a40 6675 6e63 7469  , files..@functi
+00011eb0: 6f6e 5f6c 6f67 6765 720a 6465 6620 636f  on_logger.def co
+00011ec0: 6e74 6169 6e73 5f63 6f72 7075 735f 696e  ntains_corpus_in
+00011ed0: 6469 6361 746f 7228 7061 7468 293a 0a20  dicator(path):. 
+00011ee0: 2020 2066 6f72 2073 7562 6469 7220 696e     for subdir in
+00011ef0: 2066 6972 7374 5f6c 6576 656c 5f73 7562   first_level_sub
+00011f00: 6469 7273 2870 6174 6829 3a0a 2020 2020  dirs(path):.    
+00011f10: 2020 2020 6966 2073 7562 6469 7220 696e      if subdir in
+00011f20: 2053 5441 4e44 4152 445f 4e41 4d45 535f   STANDARD_NAMES_
+00011f30: 4f52 5f47 4954 3a0a 2020 2020 2020 2020  OR_GIT:.        
+00011f40: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
+00011f50: 2866 227b 7061 7468 7d20 636f 6e74 6169  (f"{path} contai
+00011f60: 6e73 2061 2073 7562 6469 7265 6374 6f72  ns a subdirector
+00011f70: 7920 6361 6c6c 6564 207b 7375 6264 6972  y called {subdir
+00011f80: 7d20 616e 6420 6973 2061 7373 756d 6564  } and is assumed
+00011f90: 2074 6f20 6265 2061 2063 6f72 7075 732e   to be a corpus.
+00011fa0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+00011fb0: 6574 7572 6e20 5472 7565 0a20 2020 2072  eturn True.    r
+00011fc0: 6574 7572 6e20 4661 6c73 650a 0a0a 4066  eturn False...@f
+00011fd0: 756e 6374 696f 6e5f 6c6f 6767 6572 0a64  unction_logger.d
+00011fe0: 6566 2067 6574 5f66 6972 7374 5f6c 6576  ef get_first_lev
+00011ff0: 656c 5f63 6f72 706f 7261 2870 6174 683a  el_corpora(path:
+00012000: 2073 7472 2920 2d3e 204c 6973 745b 7374   str) -> List[st
+00012010: 725d 3a0a 2020 2020 2222 2243 6865 636b  r]:.    """Check
+00012020: 7320 7468 6520 6669 7273 742d 6c65 7665  s the first-leve
+00012030: 6c20 7375 6264 6972 6563 746f 7269 6573  l subdirectories
+00012040: 206f 6620 7061 7468 2066 6f72 2069 6e64   of path for ind
+00012050: 6963 6174 6f72 7320 6f66 2062 6569 6e67  icators of being
+00012060: 2061 2063 6f72 7075 732e 2049 6620 6f6e   a corpus. If on
+00012070: 6520 6f66 2074 6865 6d20 7368 6f77 7320  e of them shows 
+00012080: 616e 0a20 2020 2069 6e64 6963 6174 6f72  an.    indicator
+00012090: 2028 7072 6573 656e 6365 206f 6620 6120   (presence of a 
+000120a0: 276d 6574 6164 6174 612e 7473 7627 2066  'metadata.tsv' f
+000120b0: 696c 652c 206f 7220 6f66 2061 2027 2e67  ile, or of a '.g
+000120c0: 6974 2720 666f 6c64 6572 206f 7220 616e  it' folder or an
+000120d0: 7920 6f66 2074 6865 2064 6566 6175 6c74  y of the default
+000120e0: 2066 6f6c 6465 7220 6e61 6d65 7329 2c20   folder names), 
+000120f0: 7265 7475 726e 730a 2020 2020 6120 6c69  returns.    a li
+00012100: 7374 206f 6620 616c 6c20 7375 6264 6972  st of all subdir
+00012110: 6563 746f 7269 6573 2e0a 2020 2020 2222  ectories..    ""
+00012120: 220a 2020 2020 6966 2070 6174 6820 6973  ".    if path is
+00012130: 204e 6f6e 6520 6f72 206e 6f74 206f 732e   None or not os.
+00012140: 7061 7468 2e69 7364 6972 2870 6174 6829  path.isdir(path)
+00012150: 3a0a 2020 2020 2020 2020 6c6f 6767 6572  :.        logger
+00012160: 2e69 6e66 6f28 6622 7b70 6174 687d 2069  .info(f"{path} i
+00012170: 7320 6e6f 7420 616e 2065 7869 7374 696e  s not an existin
+00012180: 6720 6469 7265 6374 6f72 792e 2229 0a20  g directory."). 
+00012190: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+000121a0: 2020 7375 6270 6174 6873 203d 205b 6f73    subpaths = [os
+000121b0: 2e70 6174 682e 6a6f 696e 2870 6174 682c  .path.join(path,
+000121c0: 2073 7562 6469 7229 2066 6f72 2073 7562   subdir) for sub
+000121d0: 6469 7220 696e 2066 6972 7374 5f6c 6576  dir in first_lev
+000121e0: 656c 5f73 7562 6469 7273 2870 6174 6829  el_subdirs(path)
+000121f0: 2069 6620 7375 6264 6972 5b30 5d20 213d   if subdir[0] !=
+00012200: 2027 2e27 5d0a 2020 2020 666f 7220 7375   '.'].    for su
+00012210: 6270 6174 6820 696e 2073 7562 7061 7468  bpath in subpath
+00012220: 733a 0a20 2020 2020 2020 2069 6620 636f  s:.        if co
+00012230: 6e74 6169 6e73 5f6d 6574 6164 6174 6128  ntains_metadata(
+00012240: 7375 6270 6174 6829 3a0a 2020 2020 2020  subpath):.      
+00012250: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
+00012260: 7567 2866 227b 7375 6270 6174 687d 2072  ug(f"{subpath} r
+00012270: 6563 6f67 6e69 7a65 6420 6173 2063 6f72  ecognized as cor
+00012280: 7075 7320 6469 7265 6374 6f72 7920 6265  pus directory be
+00012290: 6361 7573 6520 6974 2063 6f6e 7461 696e  cause it contain
+000122a0: 7320 6d65 7461 6461 7461 2e22 290a 2020  s metadata.").  
+000122b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000122c0: 2073 7562 7061 7468 730a 2020 2020 2020   subpaths.      
+000122d0: 2020 6966 2063 6f6e 7461 696e 735f 636f    if contains_co
+000122e0: 7270 7573 5f69 6e64 6963 6174 6f72 2873  rpus_indicator(s
+000122f0: 7562 7061 7468 2c20 6c6f 6767 6572 3d6c  ubpath, logger=l
+00012300: 6f67 6765 7229 3a0a 2020 2020 2020 2020  ogger):.        
+00012310: 2020 2020 7265 7475 726e 2073 7562 7061      return subpa
+00012320: 7468 730a 2020 2020 7265 7475 726e 205b  ths.    return [
+00012330: 5d0a 0a0a 0a40 6675 6e63 7469 6f6e 5f6c  ]....@function_l
+00012340: 6f67 6765 720a 6465 6620 6a6f 696e 5f74  ogger.def join_t
+00012350: 7376 7328 6466 732c 2073 6f72 745f 636f  svs(dfs, sort_co
+00012360: 6c73 3d46 616c 7365 293a 0a20 2020 2022  ls=False):.    "
+00012370: 2222 2050 6572 666f 726d 7320 6f75 7465  "" Performs oute
+00012380: 7220 6a6f 696e 206f 6e20 7468 6520 7061  r join on the pa
+00012390: 7373 6564 2044 6174 6146 7261 6d65 7320  ssed DataFrames 
+000123a0: 6261 7365 6420 6f6e 2027 6d63 2720 616e  based on 'mc' an
+000123b0: 6420 276d 635f 6f6e 7365 7427 2c20 6966  d 'mc_onset', if
+000123c0: 2061 6e79 2e0a 2020 2020 5573 6573 3a20   any..    Uses: 
+000123d0: 6675 6e63 746f 6f6c 732e 7265 6475 6365  functools.reduce
+000123e0: 2829 2c20 736f 7274 5f63 6f6c 7328 292c  (), sort_cols(),
+000123f0: 2073 6f72 745f 6e6f 7465 5f6c 6973 7473   sort_note_lists
+00012400: 2829 0a0a 2020 2020 5061 7261 6d65 7465  ()..    Paramete
+00012410: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00012420: 2d0a 2020 2020 6466 7320 3a20 3a6f 626a  -.    dfs : :obj
+00012430: 3a60 436f 6c6c 6563 7469 6f6e 600a 2020  :`Collection`.  
+00012440: 2020 2020 2020 436f 6c6c 6563 7469 6f6e        Collection
+00012450: 206f 6620 4461 7461 4672 616d 6573 2074   of DataFrames t
+00012460: 6f20 6a6f 696e 2e0a 2020 2020 736f 7274  o join..    sort
+00012470: 5f63 6f6c 7320 3a20 3a6f 626a 3a60 626f  _cols : :obj:`bo
+00012480: 6f6c 602c 206f 7074 696f 6e61 6c0a 2020  ol`, optional.  
+00012490: 2020 2020 2020 4966 2079 6f75 2070 6173        If you pas
+000124a0: 7320 5472 7565 2c20 7468 6520 636f 6c75  s True, the colu
+000124b0: 6d6e 7320 6166 7465 7220 7468 6f73 6520  mns after those 
+000124c0: 6465 6669 6e65 6420 696e 203a 7079 3a61  defined in :py:a
+000124d0: 7474 723a 6053 5441 4e44 4152 445f 434f  ttr:`STANDARD_CO
+000124e0: 4c55 4d4e 5f4f 5244 4552 600a 2020 2020  LUMN_ORDER`.    
+000124f0: 2020 2020 7769 6c6c 2062 6520 736f 7274      will be sort
+00012500: 6564 2061 6c70 6861 6265 7469 6361 6c6c  ed alphabeticall
+00012510: 792e 0a0a 2020 2020 5265 7475 726e 730a  y...    Returns.
+00012520: 2020 2020 2d2d 2d2d 2d2d 2d0a 0a20 2020      -------..   
+00012530: 2022 2222 0a20 2020 2069 6620 6c65 6e28   """.    if len(
+00012540: 6466 7329 203d 3d20 313a 0a20 2020 2020  dfs) == 1:.     
+00012550: 2020 2072 6574 7572 6e20 6466 735b 305d     return dfs[0]
+00012560: 0a20 2020 207a 6572 6f2c 206f 6e65 2c20  .    zero, one, 
+00012570: 7477 6f20 3d20 5b5d 2c20 5b5d 2c20 5b5d  two = [], [], []
+00012580: 0a20 2020 2066 6f72 2064 6620 696e 2064  .    for df in d
+00012590: 6673 3a0a 2020 2020 2020 2020 6966 2027  fs:.        if '
+000125a0: 6d63 2720 696e 2064 662e 636f 6c75 6d6e  mc' in df.column
+000125b0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+000125c0: 6620 276d 635f 6f6e 7365 7427 2069 6e20  f 'mc_onset' in 
+000125d0: 6466 2e63 6f6c 756d 6e73 3a0a 2020 2020  df.columns:.    
+000125e0: 2020 2020 2020 2020 2020 2020 7477 6f2e              two.
+000125f0: 6170 7065 6e64 2864 6629 0a20 2020 2020  append(df).     
+00012600: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00012610: 2020 2020 2020 2020 2020 2020 206f 6e65               one
+00012620: 2e61 7070 656e 6428 6466 290a 2020 2020  .append(df).    
+00012630: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00012640: 2020 2020 2020 7a65 726f 2e61 7070 656e        zero.appen
+00012650: 6428 6466 290a 2020 2020 6a6f 696e 5f6f  d(df).    join_o
+00012660: 7264 6572 203d 2074 776f 202b 206f 6e65  rder = two + one
+00012670: 0a20 2020 2069 6620 6c65 6e28 7a65 726f  .    if len(zero
+00012680: 2920 3e20 303a 0a20 2020 2020 2020 206c  ) > 0:.        l
+00012690: 6f67 6765 722e 696e 666f 2866 227b 6c65  ogger.info(f"{le
+000126a0: 6e28 7a65 726f 297d 2044 6174 6146 7261  n(zero)} DataFra
+000126b0: 6d65 7320 636f 6e74 6169 6e20 6e6f 6e65  mes contain none
+000126c0: 206f 6620 7468 6520 636f 6c75 6d6e 7320   of the columns 
+000126d0: 276d 6327 2061 6e64 2027 6d63 5f6f 6e73  'mc' and 'mc_ons
+000126e0: 6574 272e 2229 0a0a 2020 2020 706f 735f  et'.")..    pos_
+000126f0: 636f 6c73 203d 205b 276d 6327 2c20 276d  cols = ['mc', 'm
+00012700: 635f 6f6e 7365 7427 5d0a 0a20 2020 2064  c_onset']..    d
+00012710: 6566 206a 6f69 6e5f 7473 7628 612c 2062  ef join_tsv(a, b
+00012720: 293a 0a20 2020 2020 2020 206a 6f69 6e5f  ):.        join_
+00012730: 636f 6c73 203d 205b 6320 666f 7220 6320  cols = [c for c 
+00012740: 696e 2070 6f73 5f63 6f6c 7320 6966 2063  in pos_cols if c
+00012750: 2069 6e20 612e 636f 6c75 6d6e 7320 616e   in a.columns an
+00012760: 6420 6320 696e 2062 2e63 6f6c 756d 6e73  d c in b.columns
+00012770: 5d0a 2020 2020 2020 2020 7265 7320 3d20  ].        res = 
+00012780: 7064 2e6d 6572 6765 2861 2c20 622c 2068  pd.merge(a, b, h
+00012790: 6f77 3d27 6f75 7465 7227 2c20 6f6e 3d6a  ow='outer', on=j
+000127a0: 6f69 6e5f 636f 6c73 2c20 7375 6666 6978  oin_cols, suffix
+000127b0: 6573 3d28 2727 2c20 275f 7927 2929 2e72  es=('', '_y')).r
+000127c0: 6573 6574 5f69 6e64 6578 2864 726f 703d  eset_index(drop=
+000127d0: 5472 7565 290a 2020 2020 2020 2020 6475  True).        du
+000127e0: 706c 6963 6174 6573 203d 205b 636f 6c20  plicates = [col 
+000127f0: 666f 7220 636f 6c20 696e 2072 6573 2e63  for col in res.c
+00012800: 6f6c 756d 6e73 2069 6620 636f 6c2e 656e  olumns if col.en
+00012810: 6473 7769 7468 2827 5f79 2729 5d0a 2020  dswith('_y')].  
+00012820: 2020 2020 2020 666f 7220 6420 696e 2064        for d in d
+00012830: 7570 6c69 6361 7465 733a 0a20 2020 2020  uplicates:.     
+00012840: 2020 2020 2020 206c 6566 7420 3d20 645b         left = d[
+00012850: 3a2d 325d 0a20 2020 2020 2020 2020 2020  :-2].           
+00012860: 2069 6620 7265 735b 6c65 6674 5d2e 6973   if res[left].is
+00012870: 6e61 2829 2e61 6e79 2829 3a0a 2020 2020  na().any():.    
+00012880: 2020 2020 2020 2020 2020 2020 7265 735b              res[
+00012890: 6c65 6674 5d2e 6669 6c6c 6e61 2872 6573  left].fillna(res
+000128a0: 5b64 5d2c 2069 6e70 6c61 6365 3d54 7275  [d], inplace=Tru
+000128b0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+000128c0: 6e20 7265 732e 6472 6f70 2863 6f6c 756d  n res.drop(colum
+000128d0: 6e73 3d64 7570 6c69 6361 7465 7329 0a0a  ns=duplicates)..
+000128e0: 2020 2020 7265 7320 3d20 7265 6475 6365      res = reduce
+000128f0: 286a 6f69 6e5f 7473 762c 206a 6f69 6e5f  (join_tsv, join_
+00012900: 6f72 6465 7229 0a20 2020 2069 6620 276d  order).    if 'm
+00012910: 6964 6927 2069 6e20 7265 732e 636f 6c75  idi' in res.colu
+00012920: 6d6e 733a 0a20 2020 2020 2020 2072 6573  mns:.        res
+00012930: 203d 2073 6f72 745f 6e6f 7465 5f6c 6973   = sort_note_lis
+00012940: 7428 7265 7329 0a20 2020 2065 6c69 6620  t(res).    elif 
+00012950: 6c65 6e28 7477 6f29 203e 2030 3a0a 2020  len(two) > 0:.  
+00012960: 2020 2020 2020 7265 7320 3d20 7265 732e        res = res.
+00012970: 736f 7274 5f76 616c 7565 7328 706f 735f  sort_values(pos_
+00012980: 636f 6c73 290a 2020 2020 656c 7365 3a0a  cols).    else:.
+00012990: 2020 2020 2020 2020 7265 7320 3d20 7265          res = re
+000129a0: 732e 736f 7274 5f76 616c 7565 7328 276d  s.sort_values('m
+000129b0: 6327 290a 2020 2020 7265 7475 726e 2063  c').    return c
+000129c0: 6f6c 756d 6e5f 6f72 6465 7228 7265 732c  olumn_order(res,
+000129d0: 2073 6f72 743d 736f 7274 5f63 6f6c 7329   sort=sort_cols)
+000129e0: 2e72 6573 6574 5f69 6e64 6578 2864 726f  .reset_index(dro
+000129f0: 703d 5472 7565 290a 0a0a 6465 6620 7374  p=True)...def st
+00012a00: 7232 696e 7474 7570 6c65 286c 3a20 7374  r2inttuple(l: st
+00012a10: 722c 2073 7472 6963 743a 2062 6f6f 6c20  r, strict: bool 
+00012a20: 3d20 5472 7565 2920 2d3e 2054 7570 6c65  = True) -> Tuple
+00012a30: 5b69 6e74 5d3a 0a20 2020 206c 203d 206c  [int]:.    l = l
+00012a40: 2e73 7472 6970 2827 2829 2c27 290a 2020  .strip('(),').  
+00012a50: 2020 6966 206c 203d 3d20 2727 3a0a 2020    if l == '':.  
+00012a60: 2020 2020 2020 7265 7475 726e 2074 7570        return tup
+00012a70: 6c65 2829 0a20 2020 2072 6573 203d 205b  le().    res = [
+00012a80: 5d0a 2020 2020 666f 7220 7320 696e 206c  ].    for s in l
+00012a90: 2e73 706c 6974 2827 2c20 2729 3a0a 2020  .split(', '):.  
+00012aa0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00012ab0: 2020 2020 2020 2072 6573 2e61 7070 656e         res.appen
+00012ac0: 6428 696e 7428 7329 290a 2020 2020 2020  d(int(s)).      
+00012ad0: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
+00012ae0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00012af0: 2069 6620 7374 7269 6374 3a0a 2020 2020   if strict:.    
+00012b00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00012b10: 7428 6622 5374 7269 6e67 2076 616c 7565  t(f"String value
+00012b20: 2027 7b73 7d27 2063 6f75 6c64 206e 6f74   '{s}' could not
+00012b30: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
+00012b40: 2061 6e20 696e 7465 6765 722c 2027 7b6c   an integer, '{l
+00012b50: 7d27 206e 6f74 2074 6f20 616e 2069 6e74  }' not to an int
+00012b60: 6567 6572 2074 7570 6c65 2e22 290a 2020  eger tuple.").  
+00012b70: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00012b80: 6973 650a 2020 2020 2020 2020 2020 2020  ise.            
+00012b90: 6966 2073 5b30 5d20 3d3d 2073 5b2d 315d  if s[0] == s[-1]
+00012ba0: 2061 6e64 2073 5b30 5d20 696e 2028 225c   and s[0] in ("\
+00012bb0: 2222 2c20 225c 2722 293a 0a20 2020 2020  "", "\'"):.     
+00012bc0: 2020 2020 2020 2020 2020 2073 203d 2073             s = s
+00012bd0: 5b31 3a2d 315d 0a20 2020 2020 2020 2020  [1:-1].         
+00012be0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00012bf0: 2020 2020 2020 2020 7265 732e 6170 7065          res.appe
+00012c00: 6e64 2869 6e74 2873 2929 0a20 2020 2020  nd(int(s)).     
+00012c10: 2020 2020 2020 2065 7863 6570 7420 5661         except Va
+00012c20: 6c75 6545 7272 6f72 3a0a 2020 2020 2020  lueError:.      
+00012c30: 2020 2020 2020 2020 2020 7265 732e 6170            res.ap
+00012c40: 7065 6e64 2873 290a 2020 2020 7265 7475  pend(s).    retu
+00012c50: 726e 2074 7570 6c65 2872 6573 290a 0a0a  rn tuple(res)...
+00012c60: 6465 6620 696e 7432 626f 6f6c 2873 3a20  def int2bool(s: 
+00012c70: 7374 7229 202d 3e20 556e 696f 6e5b 626f  str) -> Union[bo
+00012c80: 6f6c 2c20 7374 725d 3a0a 2020 2020 7472  ol, str]:.    tr
+00012c90: 793a 0a20 2020 2020 2020 2072 6574 7572  y:.        retur
+00012ca0: 6e20 626f 6f6c 2869 6e74 2873 2929 0a20  n bool(int(s)). 
+00012cb0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00012cc0: 696f 6e3a 0a20 2020 2020 2020 2072 6574  ion:.        ret
+00012cd0: 7572 6e20 730a 0a0a 6465 6620 7361 6665  urn s...def safe
+00012ce0: 5f66 7261 6328 733a 2073 7472 2920 2d3e  _frac(s: str) ->
+00012cf0: 2055 6e69 6f6e 5b66 7261 632c 2073 7472   Union[frac, str
+00012d00: 5d3a 0a20 2020 2074 7279 3a0a 2020 2020  ]:.    try:.    
+00012d10: 2020 2020 7265 7475 726e 2066 7261 6328      return frac(
+00012d20: 7329 0a20 2020 2065 7863 6570 7420 4578  s).    except Ex
+00012d30: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00012d40: 2072 6574 7572 6e20 730a 0a64 6566 2073   return s..def s
+00012d50: 6166 655f 696e 7428 7329 202d 3e20 556e  afe_int(s) -> Un
+00012d60: 696f 6e5b 696e 742c 2073 7472 5d3a 0a20  ion[int, str]:. 
+00012d70: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00012d80: 7265 7475 726e 2069 6e74 2866 6c6f 6174  return int(float
+00012d90: 2873 2929 0a20 2020 2065 7863 6570 7420  (s)).    except 
+00012da0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00012db0: 2020 2072 6574 7572 6e20 730a 0a64 6566     return s..def
+00012dc0: 2070 6172 7365 5f69 6e74 6572 7661 6c5f   parse_interval_
+00012dd0: 696e 6465 785f 636f 6c75 6d6e 2864 662c  index_column(df,
+00012de0: 2063 6f6c 756d 6e3d 4e6f 6e65 2c20 636c   column=None, cl
+00012df0: 6f73 6564 3d27 6c65 6674 2729 3a0a 2020  osed='left'):.  
+00012e00: 2020 2222 2220 5475 726e 7320 6120 636f    """ Turns a co
+00012e10: 6c75 6d6e 206f 6620 7374 7269 6e67 7320  lumn of strings 
+00012e20: 696e 2074 6865 2066 6f72 6d20 275b 302e  in the form '[0.
+00012e30: 302c 2031 2e31 2927 2069 6e74 6f20 6120  0, 1.1)' into a 
+00012e40: 3a6f 626a 3a60 7061 6e64 6173 2e49 6e74  :obj:`pandas.Int
+00012e50: 6572 7661 6c49 6e64 6578 602e 0a0a 2020  ervalIndex`...  
+00012e60: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00012e70: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00012e80: 6466 203a 203a 6f62 6a3a 6070 616e 6461  df : :obj:`panda
+00012e90: 732e 4461 7461 4672 616d 6560 0a20 2020  s.DataFrame`.   
+00012ea0: 2063 6f6c 756d 6e20 3a20 3a6f 626a 3a60   column : :obj:`
+00012eb0: 7374 7260 2c20 6f70 7469 6f6e 616c 0a20  str`, optional. 
+00012ec0: 2020 2020 2020 204e 616d 6520 6f66 2074         Name of t
+00012ed0: 6865 2063 6f6c 756d 6e20 636f 6e74 6169  he column contai
+00012ee0: 6e69 6e67 2073 7472 696e 6773 2e20 4966  ning strings. If
+00012ef0: 206e 6f74 2073 7065 6369 6669 6564 2c20   not specified, 
+00012f00: 7573 6520 7468 6520 696e 6465 782e 0a20  use the index.. 
+00012f10: 2020 2063 6c6f 7365 6420 3a20 3a6f 626a     closed : :obj
+00012f20: 3a60 7374 7260 2c20 6f70 7469 6f6e 616c  :`str`, optional
+00012f30: 0a20 2020 2020 2020 204f 6e20 7768 6f74  .        On whot
+00012f40: 2073 6964 6520 7468 6520 696e 7465 7276   side the interv
+00012f50: 616c 7320 7368 6f75 6c64 2062 6520 636c  als should be cl
+00012f60: 6f73 6564 2e20 4465 6661 756c 7473 2074  osed. Defaults t
+00012f70: 6f20 276c 6566 7427 2e0a 0a20 2020 2052  o 'left'...    R
+00012f80: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+00012f90: 2d2d 0a20 2020 203a 6f62 6a3a 6070 616e  --.    :obj:`pan
+00012fa0: 6461 732e 496e 7465 7276 616c 496e 6465  das.IntervalInde
+00012fb0: 7860 0a20 2020 2022 2222 0a20 2020 2069  x`.    """.    i
+00012fc0: 765f 7265 6765 7820 3d20 7222 5b5c 5b5c  v_regex = r"[\[\
+00012fd0: 285d 285b 302d 395d 2a5c 2e5b 302d 395d  (]([0-9]*\.[0-9]
+00012fe0: 2b29 2c20 285b 302d 395d 2a5c 2e5b 302d  +), ([0-9]*\.[0-
+00012ff0: 395d 2b29 5b5c 295c 5d5d 220a 2020 2020  9]+)[\)\]]".    
+00013000: 6966 2063 6f6c 756d 6e20 6973 204e 6f6e  if column is Non
+00013010: 653a 0a20 2020 2020 2020 2069 765f 7374  e:.        iv_st
+00013020: 7269 6e67 7320 3d20 6466 2e69 6e64 6578  rings = df.index
+00013030: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00013040: 2020 2069 765f 7374 7269 6e67 7320 3d20     iv_strings = 
+00013050: 6466 5b63 6f6c 756d 6e5d 0a20 2020 2076  df[column].    v
+00013060: 616c 7565 7320 3d20 6976 5f73 7472 696e  alues = iv_strin
+00013070: 6773 2e73 7472 2e65 7874 7261 6374 2869  gs.str.extract(i
+00013080: 765f 7265 6765 7829 2e61 7374 7970 6528  v_regex).astype(
+00013090: 666c 6f61 7429 0a20 2020 2069 6978 203d  float).    iix =
+000130a0: 2070 642e 496e 7465 7276 616c 496e 6465   pd.IntervalInde
+000130b0: 782e 6672 6f6d 5f61 7272 6179 7328 7661  x.from_arrays(va
+000130c0: 6c75 6573 5b30 5d2c 2076 616c 7565 735b  lues[0], values[
+000130d0: 315d 2c20 636c 6f73 6564 3d63 6c6f 7365  1], closed=close
+000130e0: 6429 0a20 2020 2072 6574 7572 6e20 6969  d).    return ii
+000130f0: 780a 0a0a 5453 565f 434f 4c55 4d4e 5f43  x...TSV_COLUMN_C
+00013100: 4f4e 5645 5254 4552 5320 3d20 7b0a 2020  ONVERTERS = {.  
+00013110: 2020 2761 6464 6564 5f74 6f6e 6573 273a    'added_tones':
+00013120: 2073 7472 3269 6e74 7475 706c 652c 0a20   str2inttuple,. 
+00013130: 2020 2027 6163 745f 6475 7227 3a20 7361     'act_dur': sa
+00013140: 6665 5f66 7261 632c 0a20 2020 2027 636f  fe_frac,.    'co
+00013150: 6d70 6f73 6564 5f65 6e64 273a 2073 6166  mposed_end': saf
+00013160: 655f 696e 742c 0a20 2020 2027 636f 6d70  e_int,.    'comp
+00013170: 6f73 6564 5f73 7461 7274 273a 2073 6166  osed_start': saf
+00013180: 655f 696e 742c 0a20 2020 2027 6368 6f72  e_int,.    'chor
+00013190: 645f 746f 6e65 7327 3a20 7374 7232 696e  d_tones': str2in
+000131a0: 7474 7570 6c65 2c0a 2020 2020 2767 6c6f  ttuple,.    'glo
+000131b0: 6261 6c6b 6579 5f69 735f 6d69 6e6f 7227  balkey_is_minor'
+000131c0: 3a20 696e 7432 626f 6f6c 2c0a 2020 2020  : int2bool,.    
+000131d0: 276c 6f63 616c 6b65 795f 6973 5f6d 696e  'localkey_is_min
+000131e0: 6f72 273a 2069 6e74 3262 6f6f 6c2c 0a20  or': int2bool,. 
+000131f0: 2020 2027 6d63 5f6f 6666 7365 7427 3a20     'mc_offset': 
+00013200: 7361 6665 5f66 7261 632c 0a20 2020 2027  safe_frac,.    '
+00013210: 6d63 5f6f 6e73 6574 273a 2073 6166 655f  mc_onset': safe_
+00013220: 6672 6163 2c0a 2020 2020 276d 6e5f 6f6e  frac,.    'mn_on
+00013230: 7365 7427 3a20 7361 6665 5f66 7261 632c  set': safe_frac,
+00013240: 0a20 2020 2027 6d6f 7665 6d65 6e74 4e75  .    'movementNu
+00013250: 6d62 6572 273a 2073 6166 655f 696e 742c  mber': safe_int,
+00013260: 0a20 2020 2027 6e65 7874 273a 2073 7472  .    'next': str
+00013270: 3269 6e74 7475 706c 652c 0a20 2020 2027  2inttuple,.    '
+00013280: 6e6f 6d69 6e61 6c5f 6475 7261 7469 6f6e  nominal_duration
+00013290: 273a 2073 6166 655f 6672 6163 2c0a 2020  ': safe_frac,.  
+000132a0: 2020 2771 7561 7274 6572 6265 6174 7327    'quarterbeats'
+000132b0: 3a20 7361 6665 5f66 7261 632c 0a20 2020  : safe_frac,.   
+000132c0: 2027 7175 6172 7465 7262 6561 7473 5f61   'quarterbeats_a
+000132d0: 6c6c 5f65 6e64 696e 6773 273a 2073 6166  ll_endings': saf
+000132e0: 655f 6672 6163 2c0a 2020 2020 276f 6e73  e_frac,.    'ons
+000132f0: 6574 273a 2073 6166 655f 6672 6163 2c0a  et': safe_frac,.
+00013300: 2020 2020 2764 7572 6174 696f 6e27 3a20      'duration': 
+00013310: 7361 6665 5f66 7261 632c 0a20 2020 2027  safe_frac,.    '
+00013320: 7363 616c 6172 273a 2073 6166 655f 6672  scalar': safe_fr
+00013330: 6163 2c20 7d0a 0a54 5356 5f44 5459 5045  ac, }..TSV_DTYPE
+00013340: 5320 3d20 7b0a 2020 2020 2761 6273 6f6c  S = {.    'absol
+00013350: 7574 655f 6261 7365 273a 2027 496e 7436  ute_base': 'Int6
+00013360: 3427 2c0a 2020 2020 2761 6273 6f6c 7574  4',.    'absolut
+00013370: 655f 726f 6f74 273a 2027 496e 7436 3427  e_root': 'Int64'
+00013380: 2c0a 2020 2020 2761 6c74 5f6c 6162 656c  ,.    'alt_label
+00013390: 273a 2073 7472 2c0a 2020 2020 2762 6172  ': str,.    'bar
+000133a0: 6c69 6e65 273a 2073 7472 2c0a 2020 2020  line': str,.    
+000133b0: 2762 6173 6527 3a20 2749 6e74 3634 272c  'base': 'Int64',
+000133c0: 0a20 2020 2027 6261 7373 5f6e 6f74 6527  .    'bass_note'
+000133d0: 3a20 2749 6e74 3634 272c 0a20 2020 2027  : 'Int64',.    '
+000133e0: 6272 6561 6b73 273a 2027 7374 7269 6e67  breaks': 'string
+000133f0: 272c 0a20 2020 2027 6361 6465 6e63 6527  ',.    'cadence'
+00013400: 3a20 7374 722c 0a20 2020 2027 6361 6465  : str,.    'cade
+00013410: 6e63 6573 5f69 6427 3a20 2749 6e74 3634  nces_id': 'Int64
+00013420: 272c 0a20 2020 2027 6368 616e 6765 7327  ',.    'changes'
+00013430: 3a20 7374 722c 0a20 2020 2027 6368 6f72  : str,.    'chor
+00013440: 6427 3a20 7374 722c 0a20 2020 2027 6368  d': str,.    'ch
+00013450: 6f72 645f 6964 273a 2027 496e 7436 3427  ord_id': 'Int64'
+00013460: 2c0a 2020 2020 2763 686f 7264 5f74 7970  ,.    'chord_typ
+00013470: 6527 3a20 7374 722c 0a20 2020 2027 636f  e': str,.    'co
+00013480: 6c6f 725f 6e61 6d65 273a 2073 7472 2c0a  lor_name': str,.
+00013490: 2020 2020 2763 6f6c 6f72 5f68 746d 6c27      'color_html'
+000134a0: 3a20 7374 722c 0a20 2020 2027 636f 6c6f  : str,.    'colo
+000134b0: 725f 7227 3a20 2749 6e74 3634 272c 0a20  r_r': 'Int64',. 
+000134c0: 2020 2027 636f 6c6f 725f 6727 3a20 2749     'color_g': 'I
+000134d0: 6e74 3634 272c 0a20 2020 2027 636f 6c6f  nt64',.    'colo
+000134e0: 725f 6227 3a20 2749 6e74 3634 272c 0a20  r_b': 'Int64',. 
+000134f0: 2020 2027 636f 6c6f 725f 6127 3a20 2749     'color_a': 'I
+00013500: 6e74 3634 272c 0a20 2020 2027 646f 6e74  nt64',.    'dont
+00013510: 5f63 6f75 6e74 273a 2027 496e 7436 3427  _count': 'Int64'
+00013520: 2c0a 2020 2020 2764 7572 6174 696f 6e5f  ,.    'duration_
+00013530: 7162 273a 2066 6c6f 6174 2c0a 2020 2020  qb': float,.    
+00013540: 2765 7870 616e 6465 645f 6964 273a 2027  'expanded_id': '
+00013550: 496e 7436 3427 2c0a 2020 2020 2766 6967  Int64',.    'fig
+00013560: 6261 7373 273a 2073 7472 2c0a 2020 2020  bass': str,.    
+00013570: 2766 6f72 6d27 3a20 7374 722c 0a20 2020  'form': str,.   
+00013580: 2027 676c 6f62 616c 6b65 7927 3a20 7374   'globalkey': st
+00013590: 722c 0a20 2020 2027 6772 6163 656e 6f74  r,.    'gracenot
+000135a0: 6527 3a20 7374 722c 0a20 2020 2027 6861  e': str,.    'ha
+000135b0: 726d 6f6e 6965 735f 6964 273a 2027 496e  rmonies_id': 'In
+000135c0: 7436 3427 2c0a 2020 2020 2768 6172 6d6f  t64',.    'harmo
+000135d0: 6e79 5f6c 6179 6572 273a 2073 7472 2c0a  ny_layer': str,.
+000135e0: 2020 2020 276b 6579 7369 6727 3a20 2749      'keysig': 'I
+000135f0: 6e74 3634 272c 0a20 2020 2027 6c61 6265  nt64',.    'labe
+00013600: 6c27 3a20 7374 722c 0a20 2020 2027 6c61  l': str,.    'la
+00013610: 6265 6c5f 7479 7065 273a 2073 7472 2c0a  bel_type': str,.
+00013620: 2020 2020 276c 6566 7450 6172 656e 273a      'leftParen':
+00013630: 2073 7472 2c0a 2020 2020 276c 6f63 616c   str,.    'local
+00013640: 6b65 7927 3a20 7374 722c 0a20 2020 2027  key': str,.    '
+00013650: 6d61 726b 6572 273a 2073 7472 2c0a 2020  marker': str,.  
+00013660: 2020 276d 6327 3a20 2749 6e74 3634 272c    'mc': 'Int64',
+00013670: 0a20 2020 2027 6d63 5f70 6c61 7974 6872  .    'mc_playthr
+00013680: 6f75 6768 273a 2027 496e 7436 3427 2c0a  ough': 'Int64',.
+00013690: 2020 2020 276d 6964 6927 3a20 2749 6e74      'midi': 'Int
+000136a0: 3634 272c 0a20 2020 2027 6d6e 273a 2073  64',.    'mn': s
+000136b0: 7472 2c0a 2020 2020 276e 616d 6527 3a20  tr,.    'name': 
+000136c0: 7374 722c 0a20 2020 2027 6f66 6673 6574  str,.    'offset
+000136d0: 3a78 273a 2073 7472 2c0a 2020 2020 276f  :x': str,.    'o
+000136e0: 6666 7365 745f 7827 3a20 7374 722c 0a20  ffset_x': str,. 
+000136f0: 2020 2027 6f66 6673 6574 3a79 273a 2073     'offset:y': s
+00013700: 7472 2c0a 2020 2020 276f 6666 7365 745f  tr,.    'offset_
+00013710: 7927 3a20 7374 722c 0a20 2020 2027 6e61  y': str,.    'na
+00013720: 7368 7669 6c6c 6527 3a20 2749 6e74 3634  shville': 'Int64
+00013730: 272c 0a20 2020 2027 6e6f 7465 735f 6964  ',.    'notes_id
+00013740: 273a 2027 496e 7436 3427 2c0a 2020 2020  ': 'Int64',.    
+00013750: 276e 756d 6265 7269 6e67 5f6f 6666 7365  'numbering_offse
+00013760: 7427 3a20 2749 6e74 3634 272c 0a20 2020  t': 'Int64',.   
+00013770: 2027 6e75 6d65 7261 6c27 3a20 7374 722c   'numeral': str,
+00013780: 0a20 2020 2027 6f63 7461 7665 273a 2027  .    'octave': '
+00013790: 496e 7436 3427 2c0a 2020 2020 2770 6564  Int64',.    'ped
+000137a0: 616c 273a 2073 7472 2c0a 2020 2020 2770  al': str,.    'p
+000137b0: 6c61 7974 6872 6f75 6768 273a 2027 496e  laythrough': 'In
+000137c0: 7436 3427 2c0a 2020 2020 2770 6872 6173  t64',.    'phras
+000137d0: 6565 6e64 273a 2073 7472 2c0a 2020 2020  eend': str,.    
+000137e0: 2772 6567 6578 5f6d 6174 6368 273a 2073  'regex_match': s
+000137f0: 7472 2c0a 2020 2020 2772 656c 6174 6976  tr,.    'relativ
+00013800: 6572 6f6f 7427 3a20 7374 722c 0a20 2020  eroot': str,.   
+00013810: 2027 7265 7065 6174 7327 3a20 7374 722c   'repeats': str,
+00013820: 0a20 2020 2027 7269 6768 7450 6172 656e  .    'rightParen
+00013830: 273a 2073 7472 2c0a 2020 2020 2772 6f6f  ': str,.    'roo
+00013840: 7427 3a20 2749 6e74 3634 272c 0a20 2020  t': 'Int64',.   
+00013850: 2027 726f 6f74 4361 7365 273a 2027 496e   'rootCase': 'In
+00013860: 7436 3427 2c0a 2020 2020 2773 6c75 7227  t64',.    'slur'
+00013870: 3a20 7374 722c 0a20 2020 2027 7370 6563  : str,.    'spec
+00013880: 6961 6c27 3a20 7374 722c 0a20 2020 2027  ial': str,.    '
+00013890: 7374 6166 6627 3a20 2749 6e74 3634 272c  staff': 'Int64',
+000138a0: 0a20 2020 2027 7469 6564 273a 2027 496e  .    'tied': 'In
+000138b0: 7436 3427 2c0a 2020 2020 2774 696d 6573  t64',.    'times
+000138c0: 6967 273a 2073 7472 2c0a 2020 2020 2774  ig': str,.    't
+000138d0: 7063 273a 2027 496e 7436 3427 2c0a 2020  pc': 'Int64',.  
+000138e0: 2020 2776 6f69 6365 273a 2027 496e 7436    'voice': 'Int6
+000138f0: 3427 2c0a 2020 2020 2776 6f69 6365 7327  4',.    'voices'
+00013900: 3a20 2749 6e74 3634 272c 0a20 2020 2027  : 'Int64',.    '
+00013910: 766f 6c74 6127 3a20 2749 6e74 3634 272c  volta': 'Int64',
+00013920: 0a20 2020 2027 766f 6c74 615f 6d63 7327  .    'volta_mcs'
+00013930: 3a20 6f62 6a65 6374 2c0a 7d0a 0a64 6566  : object,.}..def
+00013940: 206c 6f61 645f 7473 7628 7061 7468 2c0a   load_tsv(path,.
+00013950: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+00013960: 6578 5f63 6f6c 3d4e 6f6e 652c 0a20 2020  ex_col=None,.   
+00013970: 2020 2020 2020 2020 2020 7365 703d 275c            sep='\
+00013980: 7427 2c0a 2020 2020 2020 2020 2020 2020  t',.            
+00013990: 2063 6f6e 7665 7274 6572 733d 7b7d 2c0a   converters={},.
+000139a0: 2020 2020 2020 2020 2020 2020 2064 7479               dty
+000139b0: 7065 3d7b 7d2c 0a20 2020 2020 2020 2020  pe={},.         
+000139c0: 2020 2020 7374 7269 6e67 7479 7065 3d46      stringtype=F
+000139d0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+000139e0: 2020 202a 2a6b 7761 7267 7329 202d 3e20     **kwargs) -> 
+000139f0: 4f70 7469 6f6e 616c 5b70 642e 4461 7461  Optional[pd.Data
+00013a00: 4672 616d 655d 3a0a 2020 2020 2222 2220  Frame]:.    """ 
+00013a10: 4c6f 6164 7320 7468 6520 5453 5620 6669  Loads the TSV fi
+00013a20: 6c65 2060 7061 7468 6020 7768 696c 6520  le `path` while 
+00013a30: 6170 706c 7969 6e67 2063 6f72 7265 6374  applying correct
+00013a40: 2074 7970 6520 636f 6e76 6572 7369 6f6e   type conversion
+00013a50: 2061 6e64 2070 6172 7369 6e67 2074 7570   and parsing tup
+00013a60: 6c65 732e 0a0a 2020 2020 5061 7261 6d65  les...    Parame
+00013a70: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00013a80: 2d2d 2d0a 2020 2020 7061 7468 203a 203a  ---.    path : :
+00013a90: 6f62 6a3a 6073 7472 600a 2020 2020 2020  obj:`str`.      
+00013aa0: 2020 5061 7468 2074 6f20 6120 5453 5620    Path to a TSV 
+00013ab0: 6669 6c65 2061 7320 6f75 7470 7574 2062  file as output b
+00013ac0: 7920 666f 726d 6174 5f64 6174 6128 292e  y format_data().
+00013ad0: 0a20 2020 2069 6e64 6578 5f63 6f6c 203a  .    index_col :
+00013ae0: 203a 6f62 6a3a 606c 6973 7460 2c20 6f70   :obj:`list`, op
+00013af0: 7469 6f6e 616c 0a20 2020 2020 2020 2042  tional.        B
+00013b00: 7920 6465 6661 756c 742c 2074 6865 2066  y default, the f
+00013b10: 6972 7374 2074 776f 2063 6f6c 756d 6e73  irst two columns
+00013b20: 2061 7265 206c 6f61 6465 6420 6173 204d   are loaded as M
+00013b30: 756c 7469 496e 6465 782e 0a20 2020 2020  ultiIndex..     
+00013b40: 2020 2054 6865 2066 6972 7374 206c 6576     The first lev
+00013b50: 656c 2064 6973 7469 6e67 7569 7368 6573  el distinguishes
+00013b60: 2070 6965 6365 7320 616e 6420 7468 6520   pieces and the 
+00013b70: 7365 636f 6e64 206c 6576 656c 2074 6865  second level the
+00013b80: 2065 6c65 6d65 6e74 7320 7769 7468 696e   elements within
+00013b90: 2e0a 2020 2020 636f 6e76 6572 7465 7273  ..    converters
+00013ba0: 2c20 6474 7970 6520 3a20 3a6f 626a 3a60  , dtype : :obj:`
+00013bb0: 6469 6374 602c 206f 7074 696f 6e61 6c0a  dict`, optional.
+00013bc0: 2020 2020 2020 2020 456e 6861 6e63 6573          Enhances
+00013bd0: 206f 7220 6f76 6572 7772 6974 6573 2074   or overwrites t
+00013be0: 6865 206d 6170 7069 6e67 2066 726f 6d20  he mapping from 
+00013bf0: 636f 6c75 6d6e 206e 616d 6573 2074 6f20  column names to 
+00013c00: 7479 7065 7320 696e 636c 7564 6564 2074  types included t
+00013c10: 6865 2063 6f6e 7374 616e 7473 2e0a 2020  he constants..  
+00013c20: 2020 7374 7269 6e67 7479 7065 203a 203a    stringtype : :
+00013c30: 6f62 6a3a 6062 6f6f 6c60 2c20 6f70 7469  obj:`bool`, opti
+00013c40: 6f6e 616c 0a20 2020 2020 2020 2049 6620  onal.        If 
+00013c50: 796f 7527 7265 2075 7369 6e67 2070 616e  you're using pan
+00013c60: 6461 7320 3e3d 2031 2e30 2e30 2079 6f75  das >= 1.0.0 you
+00013c70: 206d 6967 6874 2077 616e 7420 746f 2073   might want to s
+00013c80: 6574 2074 6869 7320 746f 2054 7275 6520  et this to True 
+00013c90: 696e 206f 7264 6572 0a20 2020 2020 2020  in order.       
+00013ca0: 2074 6f20 6265 2075 7369 6e67 2074 6865   to be using the
+00013cb0: 206e 6577 2060 7374 7269 6e67 6020 6461   new `string` da
+00013cc0: 7461 7479 7065 2074 6861 7420 696e 636c  tatype that incl
+00013cd0: 7564 6573 2074 6865 206e 6577 206e 756c  udes the new nul
+00013ce0: 6c20 7479 7065 2060 7064 2e4e 4160 2e0a  l type `pd.NA`..
+00013cf0: 2020 2020 2222 220a 0a20 2020 2067 6c6f      """..    glo
+00013d00: 6261 6c20 5453 565f 434f 4c55 4d4e 5f43  bal TSV_COLUMN_C
+00013d10: 4f4e 5645 5254 4552 532c 2054 5356 5f44  ONVERTERS, TSV_D
+00013d20: 5459 5045 530a 0a20 2020 2069 6620 636f  TYPES..    if co
+00013d30: 6e76 6572 7465 7273 2069 7320 4e6f 6e65  nverters is None
+00013d40: 3a0a 2020 2020 2020 2020 636f 6e76 203d  :.        conv =
+00013d50: 204e 6f6e 650a 2020 2020 656c 7365 3a0a   None.    else:.
+00013d60: 2020 2020 2020 2020 636f 6e76 203d 2064          conv = d
+00013d70: 6963 7428 5453 565f 434f 4c55 4d4e 5f43  ict(TSV_COLUMN_C
+00013d80: 4f4e 5645 5254 4552 5329 0a20 2020 2020  ONVERTERS).     
+00013d90: 2020 2063 6f6e 762e 7570 6461 7465 2863     conv.update(c
+00013da0: 6f6e 7665 7274 6572 7329 0a0a 2020 2020  onverters)..    
+00013db0: 6966 2064 7479 7065 2069 7320 4e6f 6e65  if dtype is None
+00013dc0: 3a0a 2020 2020 2020 2020 7479 7065 7320  :.        types 
+00013dd0: 3d20 4e6f 6e65 0a20 2020 2065 6c69 6620  = None.    elif 
+00013de0: 6973 696e 7374 616e 6365 2864 7479 7065  isinstance(dtype
+00013df0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+00013e00: 7479 7065 7320 3d20 6474 7970 650a 2020  types = dtype.  
+00013e10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00013e20: 7479 7065 7320 3d20 6469 6374 2854 5356  types = dict(TSV
+00013e30: 5f44 5459 5045 5329 0a20 2020 2020 2020  _DTYPES).       
+00013e40: 2074 7970 6573 2e75 7064 6174 6528 6474   types.update(dt
+00013e50: 7970 6529 0a0a 2020 2020 6966 2073 7472  ype)..    if str
+00013e60: 696e 6774 7970 653a 0a20 2020 2020 2020  ingtype:.       
+00013e70: 2074 7970 6573 203d 207b 636f 6c3a 2027   types = {col: '
+00013e80: 7374 7269 6e67 2720 6966 2074 7970 203d  string' if typ =
+00013e90: 3d20 7374 7220 656c 7365 2074 7970 2066  = str else typ f
+00013ea0: 6f72 2063 6f6c 2c20 7479 7020 696e 2074  or col, typ in t
+00013eb0: 7970 6573 2e69 7465 6d73 2829 7d0a 2020  ypes.items()}.  
+00013ec0: 2020 7472 793a 0a20 2020 2020 2020 2064    try:.        d
+00013ed0: 6620 3d20 7064 2e72 6561 645f 6373 7628  f = pd.read_csv(
+00013ee0: 7061 7468 2c20 7365 703d 7365 702c 2069  path, sep=sep, i
+00013ef0: 6e64 6578 5f63 6f6c 3d69 6e64 6578 5f63  ndex_col=index_c
+00013f00: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
+00013f10: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00013f20: 7479 7065 3d74 7970 6573 2c0a 2020 2020  type=types,.    
+00013f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f40: 2020 2020 2020 2063 6f6e 7665 7274 6572         converter
+00013f50: 733d 636f 6e76 2c20 2a2a 6b77 6172 6773  s=conv, **kwargs
+00013f60: 290a 2020 2020 6578 6365 7074 2045 6d70  ).    except Emp
+00013f70: 7479 4461 7461 4572 726f 723a 0a20 2020  tyDataError:.   
+00013f80: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00013f90: 6966 2027 6d6e 2720 696e 2064 663a 0a20  if 'mn' in df:. 
+00013fa0: 2020 2020 2020 206d 6e5f 766f 6c74 6120         mn_volta 
+00013fb0: 3d20 6d6e 3269 6e74 2864 662e 6d6e 290a  = mn2int(df.mn).
+00013fc0: 2020 2020 2020 2020 6466 2e6d 6e20 3d20          df.mn = 
+00013fd0: 6d6e 5f76 6f6c 7461 2e6d 6e0a 2020 2020  mn_volta.mn.    
+00013fe0: 2020 2020 6966 206d 6e5f 766f 6c74 612e      if mn_volta.
+00013ff0: 766f 6c74 612e 6e6f 746e 6128 292e 616e  volta.notna().an
+00014000: 7928 293a 0a20 2020 2020 2020 2020 2020  y():.           
+00014010: 2069 6620 2776 6f6c 7461 2720 6e6f 7420   if 'volta' not 
+00014020: 696e 2064 662e 636f 6c75 6d6e 733a 0a20  in df.columns:. 
+00014030: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00014040: 665b 2776 6f6c 7461 275d 203d 2070 642e  f['volta'] = pd.
+00014050: 5365 7269 6573 2870 642e 4e41 2c20 696e  Series(pd.NA, in
+00014060: 6465 783d 6466 2e69 6e64 6578 292e 6173  dex=df.index).as
+00014070: 7479 7065 2827 496e 7436 3427 290a 2020  type('Int64').  
+00014080: 2020 2020 2020 2020 2020 6466 2e76 6f6c            df.vol
+00014090: 7461 2e66 696c 6c6e 6128 6d6e 5f76 6f6c  ta.fillna(mn_vol
+000140a0: 7461 2e76 6f6c 7461 2c20 696e 706c 6163  ta.volta, inplac
+000140b0: 653d 5472 7565 290a 2020 2020 6966 2027  e=True).    if '
+000140c0: 696e 7465 7276 616c 2720 696e 2064 663a  interval' in df:
+000140d0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000140e0: 2020 2020 2020 2020 2020 6976 5f69 6e64            iv_ind
+000140f0: 6578 203d 2070 6172 7365 5f69 6e74 6572  ex = parse_inter
+00014100: 7661 6c5f 696e 6465 785f 636f 6c75 6d6e  val_index_column
+00014110: 2864 662c 2027 696e 7465 7276 616c 2729  (df, 'interval')
+00014120: 0a20 2020 2020 2020 2020 2020 2064 662e  .            df.
+00014130: 696e 6465 7820 3d20 6976 5f69 6e64 6578  index = iv_index
+00014140: 0a20 2020 2020 2020 2020 2020 2064 6620  .            df 
+00014150: 3d20 6466 2e64 726f 7028 636f 6c75 6d6e  = df.drop(column
+00014160: 733d 2769 6e74 6572 7661 6c27 290a 2020  s='interval').  
+00014170: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00014180: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00014190: 2020 2020 7061 7373 0a20 2020 2072 6574      pass.    ret
+000141a0: 7572 6e20 6466 0a0a 0a40 6c72 755f 6361  urn df...@lru_ca
+000141b0: 6368 6528 290a 6465 6620 7473 765f 636f  che().def tsv_co
+000141c0: 6c75 6d6e 3264 6174 6174 7970 6528 293a  lumn2datatype():
+000141d0: 0a20 2020 206d 6170 7069 6e67 203d 2064  .    mapping = d
+000141e0: 6566 6175 6c74 6469 6374 286c 616d 6264  efaultdict(lambd
+000141f0: 613a 2027 7374 7269 6e67 2729 0a20 2020  a: 'string').   
+00014200: 206d 6170 7069 6e67 2e75 7064 6174 6528   mapping.update(
+00014210: 7b0a 2020 2020 2020 2020 2749 6e74 3634  {.        'Int64
+00014220: 273a 2027 696e 7465 6765 7227 2c0a 2020  ': 'integer',.  
+00014230: 2020 2020 2020 7374 723a 2027 7374 7269        str: 'stri
+00014240: 6e67 272c 0a20 2020 2020 2020 2027 7374  ng',.        'st
+00014250: 7269 6e67 273a 2027 7374 7269 6e67 272c  ring': 'string',
+00014260: 0a20 2020 2020 2020 2066 6c6f 6174 3a20  .        float: 
+00014270: 2766 6c6f 6174 272c 0a20 2020 2020 2020  'float',.       
+00014280: 2069 6e74 3a20 2769 6e74 6567 6572 272c   int: 'integer',
+00014290: 0a20 2020 2020 2020 2069 6e74 3262 6f6f  .        int2boo
+000142a0: 6c3a 2027 626f 6f6c 6561 6e27 2c0a 2020  l: 'boolean',.  
+000142b0: 2020 2020 2020 7361 6665 5f66 7261 633a        safe_frac:
+000142c0: 207b 2262 6173 6522 3a20 2273 7472 696e   {"base": "strin
+000142d0: 6722 2c20 2266 6f72 6d61 7422 3a20 7222  g", "format": r"
+000142e0: 2d3f 5c64 2b28 3f3a 5c2f 5c64 2b29 3f22  -?\d+(?:\/\d+)?"
+000142f0: 7d2c 0a20 2020 2020 2020 2073 6166 655f  },.        safe_
+00014300: 696e 743a 2027 696e 7465 6765 7227 2c0a  int: 'integer',.
+00014310: 2020 2020 2020 2020 7374 7232 696e 7474          str2intt
+00014320: 7570 6c65 3a20 7b22 6261 7365 223a 2022  uple: {"base": "
+00014330: 7374 7269 6e67 222c 2022 666f 726d 6174  string", "format
+00014340: 223a 2072 225c 282d 3f5c 642b 2c20 3f2d  ": r"\(-?\d+, ?-
+00014350: 3f5c 642b 5c29 227d 2c0a 2020 2020 7d29  ?\d+\)"},.    })
+00014360: 0a20 2020 2063 6f6c 756d 6e32 6461 7461  .    column2data
+00014370: 7479 7065 203d 207b 636f 6c3a 206d 6170  type = {col: map
+00014380: 7069 6e67 5b64 7479 7065 5d20 666f 7220  ping[dtype] for 
+00014390: 636f 6c2c 2064 7479 7065 2069 6e20 5453  col, dtype in TS
+000143a0: 565f 434f 4c55 4d4e 5f43 4f4e 5645 5254  V_COLUMN_CONVERT
+000143b0: 4552 532e 6974 656d 7328 297d 0a20 2020  ERS.items()}.   
+000143c0: 2063 6f6c 756d 6e32 6461 7461 7479 7065   column2datatype
+000143d0: 2e75 7064 6174 6528 7b63 6f6c 3a20 6d61  .update({col: ma
+000143e0: 7070 696e 675b 6474 7970 655d 2066 6f72  pping[dtype] for
+000143f0: 2063 6f6c 2c20 6474 7970 6520 696e 2054   col, dtype in T
+00014400: 5356 5f44 5459 5045 532e 6974 656d 7328  SV_DTYPES.items(
+00014410: 297d 290a 2020 2020 7265 7475 726e 2063  )}).    return c
+00014420: 6f6c 756d 6e32 6461 7461 7479 7065 0a0a  olumn2datatype..
+00014430: 0a40 6c72 755f 6361 6368 6528 290a 6465  .@lru_cache().de
+00014440: 6620 7473 765f 636f 6c75 6d6e 3264 6573  f tsv_column2des
+00014450: 6372 6970 7469 6f6e 2863 6f6c 3a20 7374  cription(col: st
+00014460: 7229 202d 3e20 4f70 7469 6f6e 616c 5b73  r) -> Optional[s
+00014470: 7472 5d3a 0a20 2020 206d 6170 7069 6e67  tr]:.    mapping
+00014480: 203d 207b 0a20 2020 2020 2020 2027 6d63   = {.        'mc
+00014490: 273a 2027 4d65 6173 7572 6520 636f 756e  ': 'Measure coun
+000144a0: 742e 272c 0a20 2020 2020 2020 2027 6d6e  t.',.        'mn
+000144b0: 273a 2027 4d65 6173 7572 6520 6e75 6d62  ': 'Measure numb
+000144c0: 6572 2e27 2c0a 2020 2020 2020 2020 276d  er.',.        'm
+000144d0: 635f 6f6e 7365 7427 3a20 2241 6e20 6576  c_onset': "An ev
+000144e0: 656e 7427 7320 6469 7374 616e 6365 2028  ent's distance (
+000144f0: 6672 6163 7469 6f6e 206f 6620 6120 7768  fraction of a wh
+00014500: 6f6c 6520 6e6f 7465 2920 6672 6f6d 2074  ole note) from t
+00014510: 6865 2062 6567 696e 6e69 6e67 206f 6620  he beginning of 
+00014520: 7468 6520 4d43 2e22 2c0a 2020 2020 2020  the MC.",.      
+00014530: 2020 276d 6e5f 6f6e 7365 7427 3a20 2241    'mn_onset': "A
+00014540: 6e20 6576 656e 7427 7320 6469 7374 616e  n event's distan
+00014550: 6365 2028 6672 6163 7469 6f6e 206f 6620  ce (fraction of 
+00014560: 6120 7768 6f6c 6520 6e6f 7465 2920 6672  a whole note) fr
+00014570: 6f6d 2074 6865 2062 6567 696e 6e69 6e67  om the beginning
+00014580: 206f 6620 7468 6520 4d4e 2e22 2c0a 2020   of the MN.",.  
+00014590: 2020 7d0a 2020 2020 6966 2063 6f6c 2069    }.    if col i
+000145a0: 6e20 6d61 7070 696e 673a 0a20 2020 2020  n mapping:.     
+000145b0: 2020 2072 6574 7572 6e20 6d61 7070 696e     return mappin
+000145c0: 675b 636f 6c5d 0a0a 0a40 6c72 755f 6361  g[col]...@lru_ca
+000145d0: 6368 6528 290a 6465 6620 7473 765f 636f  che().def tsv_co
+000145e0: 6c75 6d6e 3273 6368 656d 6128 636f 6c3a  lumn2schema(col:
+000145f0: 2073 7472 2920 2d3e 2064 6963 743a 0a20   str) -> dict:. 
+00014600: 2020 2072 6573 756c 7420 3d20 7b0a 2020     result = {.  
+00014610: 2020 2020 2020 2274 6974 6c65 7322 3a20        "titles": 
+00014620: 636f 6c2c 0a20 2020 207d 0a20 2020 2063  col,.    }.    c
+00014630: 6f6c 756d 6e32 7479 7065 203d 2074 7376  olumn2type = tsv
+00014640: 5f63 6f6c 756d 6e32 6461 7461 7479 7065  _column2datatype
+00014650: 2829 0a20 2020 2069 6620 636f 6c20 696e  ().    if col in
+00014660: 2063 6f6c 756d 6e32 7479 7065 3a0a 2020   column2type:.  
+00014670: 2020 2020 2020 7265 7375 6c74 5b22 6461        result["da
+00014680: 7461 7479 7065 225d 203d 2063 6f6c 756d  tatype"] = colum
+00014690: 6e32 7479 7065 5b63 6f6c 5d0a 2020 2020  n2type[col].    
+000146a0: 6465 7363 7269 7074 696f 6e20 3d20 7473  description = ts
+000146b0: 765f 636f 6c75 6d6e 3264 6573 6372 6970  v_column2descrip
+000146c0: 7469 6f6e 2863 6f6c 290a 2020 2020 6966  tion(col).    if
+000146d0: 2064 6573 6372 6970 7469 6f6e 2069 7320   description is 
+000146e0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000146f0: 2020 7265 7375 6c74 5b22 6463 3a64 6573    result["dc:des
+00014700: 6372 6970 7469 6f6e 225d 203d 2064 6573  cription"] = des
+00014710: 6372 6970 7469 6f6e 0a20 2020 2072 6574  cription.    ret
+00014720: 7572 6e20 7265 7375 6c74 0a0a 0a64 6566  urn result...def
+00014730: 206d 616b 655f 6373 7677 5f6a 736f 6e6c   make_csvw_jsonl
+00014740: 6428 7469 746c 653a 2073 7472 2c0a 2020  d(title: str,.  
+00014750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014760: 2020 2063 6f6c 756d 6e73 3a20 436f 6c6c     columns: Coll
+00014770: 6563 7469 6f6e 5b73 7472 5d2c 0a20 2020  ection[str],.   
+00014780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014790: 2020 7572 6c73 3a20 556e 696f 6e5b 7374    urls: Union[st
+000147a0: 722c 2043 6f6c 6c65 6374 696f 6e5b 7374  r, Collection[st
+000147b0: 725d 5d2c 0a20 2020 2020 2020 2020 2020  r]],.           
+000147c0: 2020 2020 2020 2020 2020 6465 7363 7269            descri
+000147d0: 7074 696f 6e3a 204f 7074 696f 6e61 6c5b  ption: Optional[
+000147e0: 7374 725d 203d 204e 6f6e 6529 202d 3e20  str] = None) -> 
+000147f0: 6469 6374 3a0a 2020 2020 2222 2257 3343  dict:.    """W3C
+00014800: 2773 2043 5356 206f 6e20 7468 6520 5765  's CSV on the We
+00014810: 6220 5072 696d 6572 3a20 6874 7470 733a  b Primer: https:
+00014820: 2f2f 7777 772e 7733 2e6f 7267 2f54 522f  //www.w3.org/TR/
+00014830: 7461 6275 6c61 722d 6461 7461 2d70 7269  tabular-data-pri
+00014840: 6d65 722f 2222 220a 2020 2020 7265 7375  mer/""".    resu
+00014850: 6c74 203d 207b 0a20 2020 2020 2020 2022  lt = {.        "
+00014860: 4063 6f6e 7465 7874 223a 205b 2268 7474  @context": ["htt
+00014870: 703a 2f2f 7777 772e 7733 2e6f 7267 2f6e  p://www.w3.org/n
+00014880: 732f 6373 7677 2322 2c20 7b22 406c 616e  s/csvw#", {"@lan
+00014890: 6775 6167 6522 3a20 2265 6e20 227d 5d2c  guage": "en "}],
+000148a0: 0a20 2020 2020 2020 2022 6463 3a74 6974  .        "dc:tit
+000148b0: 6c65 223a 2074 6974 6c65 2c0a 2020 2020  le": title,.    
+000148c0: 2020 2020 2264 6961 6c65 6374 223a 207b      "dialect": {
+000148d0: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+000148e0: 6c69 6d69 7465 7222 3a20 225c 7422 2c0a  limiter": "\t",.
+000148f0: 2020 2020 2020 2020 7d0a 2020 2020 7d0a          }.    }.
+00014900: 2020 2020 6966 2064 6573 6372 6970 7469      if descripti
+00014910: 6f6e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  on is not None:.
+00014920: 2020 2020 2020 2020 7265 7375 6c74 5b22          result["
+00014930: 6463 3a64 6573 6372 6970 7469 6f6e 225d  dc:description"]
+00014940: 203d 2064 6573 6372 6970 7469 6f6e 0a20   = description. 
+00014950: 2020 2072 6573 756c 745b 2264 633a 6372     result["dc:cr
+00014960: 6561 7465 6422 5d20 3d20 6461 7465 7469  eated"] = dateti
+00014970: 6d65 2e6e 6f77 2829 2e72 6570 6c61 6365  me.now().replace
+00014980: 286d 6963 726f 7365 636f 6e64 3d30 292e  (microsecond=0).
+00014990: 6973 6f66 6f72 6d61 7428 290a 2020 2020  isoformat().    
+000149a0: 7265 7375 6c74 5b22 6463 3a63 7265 6174  result["dc:creat
+000149b0: 6f72 225d 203d 205b 7b0a 2020 2020 2020  or"] = [{.      
+000149c0: 2020 2240 636f 6e74 6578 7422 3a20 2268    "@context": "h
+000149d0: 7474 7073 3a2f 2f73 6368 656d 612e 6f72  ttps://schema.or
+000149e0: 672f 222c 0a20 2020 2020 2020 2022 4074  g/",.        "@t
+000149f0: 7970 6522 3a20 2253 6f66 7477 6172 6541  ype": "SoftwareA
+00014a00: 7070 6c69 6361 7469 6f6e 222c 0a20 2020  pplication",.   
+00014a10: 2020 2020 2022 4069 6422 3a20 2268 7474       "@id": "htt
+00014a20: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00014a30: 6a6f 6865 6e74 7363 682f 6d73 3322 2c0a  johentsch/ms3",.
+00014a40: 2020 2020 2020 2020 226e 616d 6522 3a20          "name": 
+00014a50: 226d 7333 222c 0a20 2020 2020 2020 2022  "ms3",.        "
+00014a60: 6465 7363 7269 7074 696f 6e22 3a20 2241  description": "A
+00014a70: 2070 6172 7365 7220 666f 7220 4d75 7365   parser for Muse
+00014a80: 5363 6f72 6520 3320 6669 6c65 732e 222c  Score 3 files.",
+00014a90: 0a20 2020 2020 2020 2022 6175 7468 6f72  .        "author
+00014aa0: 223a 207b 226e 616d 6522 3a20 224a 6f68  ": {"name": "Joh
+00014ab0: 616e 6e65 7320 4865 6e74 7363 6865 6c22  annes Hentschel"
+00014ac0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014ad0: 2020 2020 2022 4069 6422 3a20 2268 7474       "@id": "htt
+00014ae0: 7073 3a2f 2f6f 7263 6964 2e6f 7267 2f30  ps://orcid.org/0
+00014af0: 3030 302d 3030 3032 2d31 3938 362d 3935  000-0002-1986-95
+00014b00: 3435 222c 0a20 2020 2020 2020 2020 2020  45",.           
+00014b10: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+00014b20: 2020 2022 736f 6674 7761 7265 5665 7273     "softwareVers
+00014b30: 696f 6e22 3a20 4d53 335f 5645 5253 494f  ion": MS3_VERSIO
+00014b40: 4e2c 0a20 2020 207d 5d0a 2020 2020 6966  N,.    }].    if
+00014b50: 2069 7369 6e73 7461 6e63 6528 7572 6c73   isinstance(urls
+00014b60: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+00014b70: 7265 7375 6c74 5b22 7572 6c22 5d20 3d20  result["url"] = 
+00014b80: 7572 6c73 2c0a 2020 2020 656c 7365 3a0a  urls,.    else:.
+00014b90: 2020 2020 2020 2020 7265 7375 6c74 5b22          result["
+00014ba0: 7461 626c 6573 225d 203d 205b 7b22 7572  tables"] = [{"ur
+00014bb0: 6c22 3a20 707d 2066 6f72 2070 2069 6e20  l": p} for p in 
+00014bc0: 7572 6c73 5d0a 2020 2020 7265 7375 6c74  urls].    result
+00014bd0: 5b22 7461 626c 6553 6368 656d 6122 5d20  ["tableSchema"] 
+00014be0: 3d20 7b0a 2020 2020 2020 2020 2263 6f6c  = {.        "col
+00014bf0: 756d 6e73 223a 205b 7473 765f 636f 6c75  umns": [tsv_colu
+00014c00: 6d6e 3273 6368 656d 6128 636f 6c29 2066  mn2schema(col) f
+00014c10: 6f72 2063 6f6c 2069 6e20 636f 6c75 6d6e  or col in column
+00014c20: 735d 0a20 2020 207d 0a20 2020 2072 6574  s].    }.    ret
+00014c30: 7572 6e20 7265 7375 6c74 0a0a 6465 6620  urn result..def 
+00014c40: 7374 6f72 655f 6373 7677 5f6a 736f 6e6c  store_csvw_jsonl
+00014c50: 6428 636f 7270 7573 3a20 7374 722c 0a20  d(corpus: str,. 
+00014c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c70: 2020 2020 2066 6f6c 6465 723a 2073 7472       folder: str
+00014c80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014c90: 2020 2020 2020 2020 6661 6365 743a 2073          facet: s
+00014ca0: 7472 2c0a 2020 2020 2020 2020 2020 2020  tr,.            
+00014cb0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+00014cc0: 733a 2043 6f6c 6c65 6374 696f 6e5b 7374  s: Collection[st
+00014cd0: 725d 2c0a 2020 2020 2020 2020 2020 2020  r],.            
+00014ce0: 2020 2020 2020 2020 2020 6669 6c65 733a            files:
+00014cf0: 2055 6e69 6f6e 5b73 7472 2c20 436f 6c6c   Union[str, Coll
+00014d00: 6563 7469 6f6e 5b73 7472 5d5d 2920 2d3e  ection[str]]) ->
+00014d10: 2073 7472 3a0a 2020 2020 7469 746c 6573   str:.    titles
+00014d20: 203d 207b 0a20 2020 2020 2020 2022 6578   = {.        "ex
+00014d30: 7061 6e64 6564 223a 2022 4443 4d4c 2068  panded": "DCML h
+00014d40: 6172 6d6f 6e79 2061 6e6e 6f74 6174 696f  armony annotatio
+00014d50: 6e73 222c 0a20 2020 2020 2020 2022 6d65  ns",.        "me
+00014d60: 6173 7572 6573 223a 2022 4d65 6173 7572  asures": "Measur
+00014d70: 6520 7461 626c 6573 222c 0a20 2020 2020  e tables",.     
+00014d80: 2020 2022 6e6f 7465 7322 3a20 224e 6f74     "notes": "Not
+00014d90: 6520 7461 626c 6573 222c 0a0a 2020 2020  e tables",..    
+00014da0: 7d0a 2020 2020 6465 7363 7269 7074 696f  }.    descriptio
+00014db0: 6e73 203d 207b 0a20 2020 2020 2020 2022  ns = {.        "
+00014dc0: 6578 7061 6e64 6564 223a 2022 4f6e 6520  expanded": "One 
+00014dd0: 6665 6174 7572 6520 6d61 7472 6978 2070  feature matrix p
+00014de0: 6572 2073 636f 7265 2c20 636f 6e74 6169  er score, contai
+00014df0: 6e69 6e67 206f 6e65 206c 696e 6520 7065  ning one line pe
+00014e00: 7220 6c61 6265 6c2e 2054 6865 2066 6972  r label. The fir
+00014e10: 7374 2063 6f6c 756d 6e73 2028 756e 7469  st columns (unti
+00014e20: 6c20 276c 6162 656c 2729 2022 0a20 2020  l 'label') ".   
+00014e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e40: 2022 6172 6520 7468 6520 7361 6d65 2061   "are the same a
+00014e50: 7320 696e 2065 7874 7261 6374 6564 2027  s in extracted '
+00014e60: 6c61 6265 6c73 2720 7461 626c 6573 2077  labels' tables w
+00014e70: 6974 6820 7468 6520 6469 6666 6572 656e  ith the differen
+00014e80: 6365 2074 6861 7420 6f6e 6c79 2074 686f  ce that only tho
+00014e90: 7365 2068 6172 6d6f 6e79 206c 6162 656c  se harmony label
+00014ea0: 7320 220a 2020 2020 2020 2020 2020 2020  s ".            
+00014eb0: 2020 2020 2020 2020 2274 6861 7420 6d61          "that ma
+00014ec0: 7463 6820 7468 6520 4443 4d4c 2068 6172  tch the DCML har
+00014ed0: 6d6f 6e79 2061 6e6e 6f74 6174 696f 6e20  mony annotation 
+00014ee0: 7374 616e 6461 7264 2028 6463 6d6c 6162  standard (dcmlab
+00014ef0: 2e67 6974 6875 622e 696f 2f73 7461 6e64  .github.io/stand
+00014f00: 6172 6473 2920 6172 6520 696e 636c 7564  ards) are includ
+00014f10: 6564 2e20 5369 6e63 6520 220a 2020 2020  ed. Since ".    
+00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f30: 2274 6865 7365 2066 6f6c 6c6f 7720 6120  "these follow a 
+00014f40: 7370 6563 6966 6963 2073 796e 7461 782c  specific syntax,
+00014f50: 2074 6865 7920 6361 6e20 6265 2073 706c   they can be spl
+00014f60: 6974 2069 6e74 6f20 7468 6569 7220 636f  it into their co
+00014f70: 6d70 6f6e 656e 7473 2028 6665 6174 7572  mponents (featur
+00014f80: 6573 2920 616e 6420 7472 616e 7366 6f72  es) and transfor
+00014f90: 6d65 6420 220a 2020 2020 2020 2020 2020  med ".          
+00014fa0: 2020 2020 2020 2020 2020 2269 6e74 6f20            "into 
+00014fb0: 7363 616c 6520 6465 6772 6565 732e 2046  scale degrees. F
+00014fc0: 6f72 206d 6f72 6520 696e 666f 726d 6174  or more informat
+00014fd0: 696f 6e2c 2070 6c65 6173 6520 7265 6665  ion, please refe
+00014fe0: 7220 746f 2074 6865 2064 6f63 7320 6174  r to the docs at
+00014ff0: 2068 7474 7073 3a2f 2f6a 6f68 656e 7473   https://johents
+00015000: 6368 2e67 6974 6875 622e 696f 2f6d 7333  ch.github.io/ms3
+00015010: 2f63 6f6c 756d 6e73 222c 0a20 2020 2020  /columns",.     
+00015020: 2020 2022 6d65 6173 7572 6573 223a 2022     "measures": "
+00015030: 4f6e 6520 6665 6174 7572 6520 6d61 7472  One feature matr
+00015040: 6978 2070 6572 2073 636f 7265 2c20 636f  ix per score, co
+00015050: 6e74 6169 6e69 6e67 206f 6e65 206c 696e  ntaining one lin
+00015060: 6520 7065 7220 7374 6163 6b20 6f66 203c  e per stack of <
+00015070: 4d65 6173 7572 653e 2074 6167 7320 696e  Measure> tags in
+00015080: 2074 6865 2073 636f 7265 2773 2058 4d4c   the score's XML
+00015090: 2074 7265 652e 2022 0a20 2020 2020 2020   tree. ".       
+000150a0: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
+000150b0: 6579 2061 7265 2063 6f75 6e74 6564 2069  ey are counted i
+000150c0: 6e20 7468 6520 636f 6c75 6d6e 2027 6d63  n the column 'mc
+000150d0: 2720 7374 6172 7469 6e67 2066 726f 6d20  ' starting from 
+000150e0: 312c 2077 6865 7265 6173 2074 6865 2063  1, whereas the c
+000150f0: 6f6e 7665 6e74 696f 6e61 6c20 6d65 6173  onventional meas
+00015100: 7572 6520 6e75 6d62 6572 7320 6172 6520  ure numbers are 
+00015110: 7368 6f77 6e20 220a 2020 2020 2020 2020  shown ".        
+00015120: 2020 2020 2020 2020 2020 2020 2269 6e20              "in 
+00015130: 7468 6520 636f 6c75 6d6e 2027 6d6e 272e  the column 'mn'.
+00015140: 204f 6e65 204d 4e20 6973 2066 7265 7175   One MN is frequ
+00015150: 656e 746c 7920 636f 6d70 6f73 6564 2069  ently composed i
+00015160: 6e20 7477 6f20 286f 7220 6d6f 7265 2920  n two (or more) 
+00015170: 4d43 732e 2046 7572 7468 6572 6d6f 7265  MCs. Furthermore
+00015180: 2c20 7468 6573 6520 7461 626c 6573 2069  , these tables i
+00015190: 6e63 6c75 6465 2022 0a20 2020 2020 2020  nclude ".       
+000151a0: 2020 2020 2020 2020 2020 2020 2022 7370               "sp
+000151b0: 6563 6961 6c20 6261 7220 6c69 6e65 732c  ecial bar lines,
+000151c0: 2072 6570 6561 7420 7369 676e 732c 2066   repeat signs, f
+000151d0: 6972 7374 2061 6e64 2073 6563 6f6e 6420  irst and second 
+000151e0: 656e 6469 6e67 732c 2069 7272 6567 756c  endings, irregul
+000151f0: 6172 206d 6561 7375 7265 206c 656e 6774  ar measure lengt
+00015200: 6873 2c20 6173 2077 656c 6c20 6173 2074  hs, as well as t
+00015210: 6865 2022 0a20 2020 2020 2020 2020 2020  he ".           
+00015220: 2020 2020 2020 2020 2022 636f 6c75 6d6e           "column
+00015230: 2027 6e65 7874 2720 7768 6963 6820 636f   'next' which co
+00015240: 6e74 6169 6e73 2066 6f6c 6c6f 772d 7570  ntains follow-up
+00015250: 204d 4373 2066 6f72 2075 6e66 6f6c 6469   MCs for unfoldi
+00015260: 6e67 2061 2073 636f 7265 2773 2072 6570  ng a score's rep
+00015270: 6561 7420 7374 7275 6374 7572 652e 2046  eat structure. F
+00015280: 6f72 206d 6f72 6520 696e 666f 726d 6174  or more informat
+00015290: 696f 6e2c 2022 0a20 2020 2020 2020 2020  ion, ".         
+000152a0: 2020 2020 2020 2020 2020 2022 706c 6561             "plea
+000152b0: 7365 2072 6566 6572 2074 6f20 7468 6520  se refer to the 
+000152c0: 646f 6373 2061 7420 6874 7470 733a 2f2f  docs at https://
+000152d0: 6a6f 6865 6e74 7363 682e 6769 7468 7562  johentsch.github
+000152e0: 2e69 6f2f 6d73 332f 636f 6c75 6d6e 7322  .io/ms3/columns"
+000152f0: 2c0a 2020 2020 2020 2020 226e 6f74 6573  ,.        "notes
+00015300: 223a 2022 4f6e 6520 6665 6174 7572 6520  ": "One feature 
+00015310: 6d61 7472 6978 2070 6572 2073 636f 7265  matrix per score
+00015320: 2c20 636f 6e74 6169 6e69 6e67 206f 6e65  , containing one
+00015330: 2072 6f77 2070 6572 206e 6f74 6520 6865   row per note he
+00015340: 6164 2e20 4e6f 7420 6576 6572 7920 726f  ad. Not every ro
+00015350: 7720 7265 7072 6573 656e 7473 2061 6e20  w represents an 
+00015360: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00015370: 2020 2022 6f6e 7365 7420 6265 6361 7573     "onset becaus
+00015380: 6520 6e6f 7465 2068 6561 6473 206d 6179  e note heads may
+00015390: 2062 6520 7469 6564 2074 6f67 6574 6865   be tied togethe
+000153a0: 7220 2873 6565 2063 6f6c 756d 6e20 2774  r (see column 't
+000153b0: 6965 6427 292e 2022 0a20 2020 2020 2020  ied'). ".       
+000153c0: 2020 2020 2020 2020 2020 2246 6f72 206d            "For m
+000153d0: 6f72 6520 696e 666f 726d 6174 696f 6e2c  ore information,
+000153e0: 2070 6c65 6173 6520 7265 6665 7220 746f   please refer to
+000153f0: 2074 6865 2064 6f63 7320 6174 2068 7474   the docs at htt
+00015400: 7073 3a2f 2f6a 6f68 656e 7473 6368 2e67  ps://johentsch.g
+00015410: 6974 6875 622e 696f 2f6d 7333 2f63 6f6c  ithub.io/ms3/col
+00015420: 756d 6e73 222c 0a20 2020 207d 0a20 2020  umns",.    }.   
+00015430: 2074 6974 6c65 203d 2074 6974 6c65 735b   title = titles[
+00015440: 6661 6365 745d 2069 6620 6661 6365 7420  facet] if facet 
+00015450: 696e 2074 6974 6c65 7320 656c 7365 2066  in titles else f
+00015460: 6163 6574 0a20 2020 2074 6974 6c65 202b  acet.    title +
+00015470: 3d20 2220 666f 7220 2220 2b20 636f 7270  = " for " + corp
+00015480: 7573 0a20 2020 2064 6573 6372 6970 7469  us.    descripti
+00015490: 6f6e 203d 2064 6573 6372 6970 7469 6f6e  on = description
+000154a0: 735b 6661 6365 745d 2069 6620 6661 6365  s[facet] if face
+000154b0: 7420 696e 2064 6573 6372 6970 7469 6f6e  t in description
+000154c0: 7320 656c 7365 204e 6f6e 650a 2020 2020  s else None.    
+000154d0: 6a73 6f6e 6c64 203d 206d 616b 655f 6373  jsonld = make_cs
+000154e0: 7677 5f6a 736f 6e6c 6428 7469 746c 653d  vw_jsonld(title=
+000154f0: 7469 746c 652c 0a20 2020 2020 2020 2020  title,.         
+00015500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015510: 2020 2020 2063 6f6c 756d 6e73 3d63 6f6c       columns=col
+00015520: 756d 6e73 2c0a 2020 2020 2020 2020 2020  umns,.          
+00015530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015540: 2020 2020 7572 6c73 3d66 696c 6573 2c0a      urls=files,.
+00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015560: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00015570: 7363 7269 7074 696f 6e3d 6465 7363 7269  scription=descri
+00015580: 7074 696f 6e0a 2020 2020 2020 2020 2020  ption.          
+00015590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155a0: 2020 2020 290a 2020 2020 6a73 6f6e 5f70      ).    json_p
+000155b0: 6174 6820 3d20 6f73 2e70 6174 682e 6a6f  ath = os.path.jo
+000155c0: 696e 2866 6f6c 6465 722c 2027 6373 762d  in(folder, 'csv-
+000155d0: 6d65 7461 6461 7461 2e6a 736f 6e27 290a  metadata.json').
+000155e0: 2020 2020 7769 7468 206f 7065 6e28 6a73      with open(js
+000155f0: 6f6e 5f70 6174 682c 2027 7727 2c20 656e  on_path, 'w', en
+00015600: 636f 6469 6e67 3d27 7574 662d 3827 2920  coding='utf-8') 
+00015610: 6173 2066 3a0a 2020 2020 2020 2020 7072  as f:.        pr
+00015620: 696e 7428 6a73 6f6e 2e64 756d 7073 286a  int(json.dumps(j
+00015630: 736f 6e6c 642c 2069 6e64 656e 743d 3229  sonld, indent=2)
+00015640: 2c20 6669 6c65 3d66 290a 2020 2020 7265  , file=f).    re
+00015650: 7475 726e 206a 736f 6e5f 7061 7468 0a0a  turn json_path..
+00015660: 0a40 6675 6e63 7469 6f6e 5f6c 6f67 6765  .@function_logge
+00015670: 720a 6465 6620 6d61 6b65 5f63 6f6e 7469  r.def make_conti
+00015680: 6e75 6f75 735f 6f66 6673 6574 5f73 6572  nuous_offset_ser
+00015690: 6965 7328 6d65 6173 7572 6573 2c20 7175  ies(measures, qu
+000156a0: 6172 7465 7273 3d54 7275 652c 206e 6567  arters=True, neg
+000156b0: 6174 6976 655f 616e 6163 7275 7369 733d  ative_anacrusis=
+000156c0: 4e6f 6e65 293a 0a20 2020 2022 2222 2041  None):.    """ A
+000156d0: 6363 6570 7473 2061 206d 6561 7375 7265  ccepts a measure
+000156e0: 2074 6162 6c65 2077 6974 686f 7574 2027   table without '
+000156f0: 7175 6172 7465 7262 6561 7473 2720 636f  quarterbeats' co
+00015700: 6c75 6d6e 2061 6e64 2063 6f6d 7075 7465  lumn and compute
+00015710: 7320 6561 6368 204d 4327 7320 6f66 6673  s each MC's offs
+00015720: 6574 2066 726f 6d20 7468 6520 7069 6563  et from the piec
+00015730: 6527 7320 6265 6769 6e6e 696e 672e 0a20  e's beginning.. 
+00015740: 2020 2044 6561 6c20 7769 7468 2076 6f6c     Deal with vol
+00015750: 7461 7320 6265 666f 7265 2070 6173 7369  tas before passi
+00015760: 6e67 2074 6865 2074 6162 6c65 2e0a 0a20  ng the table... 
+00015770: 2020 2049 6620 796f 7520 6e65 6564 2061     If you need a
+00015780: 6e20 6f66 6673 6574 5f64 6963 7420 616e  n offset_dict an
+00015790: 6420 7468 6520 6d65 6173 7572 6573 2061  d the measures a
+000157a0: 6c72 6561 6479 2063 6f6d 6520 7769 7468  lready come with
+000157b0: 2061 2027 7175 6172 7465 7262 6561 7473   a 'quarterbeats
+000157c0: 2720 636f 6c75 6d6e 2c20 796f 7520 6361  ' column, you ca
+000157d0: 6e20 6361 6c6c 0a20 2020 203a 6675 6e63  n call.    :func
+000157e0: 3a60 6d61 6b65 5f6f 6666 7365 745f 6469  :`make_offset_di
+000157f0: 6374 5f66 726f 6d5f 6d65 6173 7572 6573  ct_from_measures
+00015800: 602e 0a0a 2020 2020 5061 7261 6d65 7465  `...    Paramete
+00015810: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00015820: 2d0a 2020 2020 6d65 6173 7572 6573 203a  -.    measures :
+00015830: 203a 6f62 6a3a 6070 616e 6461 732e 4461   :obj:`pandas.Da
+00015840: 7461 4672 616d 6560 0a20 2020 2020 2020  taFrame`.       
+00015850: 2041 206d 6561 7375 7265 7320 7461 626c   A measures tabl
+00015860: 6520 7769 7468 2027 6e6f 726d 616c 2720  e with 'normal' 
+00015870: 5261 6e67 6549 6e64 6578 2063 6f6e 7461  RangeIndex conta
+00015880: 696e 696e 6720 7468 6520 636f 6c75 6d6e  ining the column
+00015890: 2027 6163 745f 6475 7273 2720 616e 6420   'act_durs' and 
+000158a0: 6f6e 6520 6f66 0a20 2020 2020 2020 2027  one of.        '
+000158b0: 6d63 2720 6f72 2027 6d63 5f70 6c61 7974  mc' or 'mc_playt
+000158c0: 6872 6f75 6768 2720 2869 6620 7265 7065  hrough' (if repe
+000158d0: 6174 7320 7765 7265 2075 6e66 6f6c 6465  ats were unfolde
+000158e0: 6429 2e0a 2020 2020 7175 6172 7465 7273  d)..    quarters
+000158f0: 203a 203a 6f62 6a3a 6062 6f6f 6c60 2c20   : :obj:`bool`, 
+00015900: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00015910: 2042 7920 6465 6661 756c 742c 2074 6865   By default, the
+00015920: 2063 6f6e 7469 6e75 6f75 7320 6f66 6673   continuous offs
+00015930: 6574 7320 6172 6520 6578 7072 6573 7365  ets are expresse
+00015940: 6420 696e 2071 7561 7274 6572 206e 6f74  d in quarter not
+00015950: 6573 2e20 5061 7373 2066 616c 7365 2074  es. Pass false t
+00015960: 6f20 6c65 6176 6520 7468 656d 2061 7320  o leave them as 
+00015970: 6672 6163 7469 6f6e 730a 2020 2020 2020  fractions.      
+00015980: 2020 6f66 2061 2077 686f 6c65 206e 6f74    of a whole not
+00015990: 652e 0a20 2020 206e 6567 6174 6976 655f  e..    negative_
+000159a0: 616e 6163 7275 7369 7320 3a20 3a6f 626a  anacrusis : :obj
+000159b0: 3a60 6672 6163 7469 6f6e 732e 4672 6163  :`fractions.Frac
+000159c0: 7469 6f6e 600a 2020 2020 2020 2020 4279  tion`.        By
+000159d0: 2064 6566 6175 6c74 2c20 7468 6520 6669   default, the fi
+000159e0: 7273 7420 7661 6c75 6520 6973 2030 2e20  rst value is 0. 
+000159f0: 4966 2079 6f75 2070 6173 7320 6120 6672  If you pass a fr
+00015a00: 6163 7469 6f6e 2068 6572 652c 2074 6865  action here, the
+00015a10: 2066 6972 7374 2076 616c 7565 2077 696c   first value wil
+00015a20: 6c20 6265 2069 7473 206e 6567 6174 6976  l be its negativ
+00015a30: 6520 616e 6420 7468 650a 2020 2020 2020  e and the.      
+00015a40: 2020 7365 636f 6e64 2076 616c 7565 2077    second value w
+00015a50: 696c 6c20 6265 2030 2e0a 0a20 2020 2052  ill be 0...    R
+00015a60: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+00015a70: 2d2d 0a20 2020 203a 6f62 6a3a 6070 616e  --.    :obj:`pan
+00015a80: 6461 732e 5365 7269 6573 600a 2020 2020  das.Series`.    
+00015a90: 2020 2020 4375 6d75 6c61 7469 7665 2073      Cumulative s
+00015aa0: 756d 206f 6620 7468 6520 6163 7475 616c  um of the actual
+00015ab0: 2064 7572 6174 696f 6e73 2c20 7368 6966   durations, shif
+00015ac0: 7465 6420 646f 776e 2062 7920 312e 2043  ted down by 1. C
+00015ad0: 6f6d 7061 7265 6420 746f 2074 6865 206f  ompared to the o
+00015ae0: 7269 6769 6e61 6c20 4461 7461 4672 616d  riginal DataFram
+00015af0: 6520 6974 2068 6173 0a20 2020 2020 2020  e it has.       
+00015b00: 206c 656e 6774 6820 2b20 3220 6265 6361   length + 2 beca
+00015b10: 7573 6520 6974 2061 6464 7320 7468 6520  use it adds the 
+00015b20: 656e 6420 7661 6c75 6520 7477 6963 652c  end value twice,
+00015b30: 206f 6e63 6520 7769 7468 2074 6865 206e   once with the n
+00015b40: 6578 7420 696e 6465 7820 7661 6c75 652c  ext index value,
+00015b50: 2061 6e64 206f 6e63 6520 7769 7468 2074   and once with t
+00015b60: 6865 2069 6e64 6578 2027 656e 6427 2e0a  he index 'end'..
+00015b70: 2020 2020 2020 2020 4f74 6865 7277 6973          Otherwis
+00015b80: 6520 7468 6520 656e 6420 7661 6c75 6520  e the end value 
+00015b90: 776f 756c 6420 6265 206c 6f73 7420 6475  would be lost du
+00015ba0: 6520 746f 2074 6865 2073 6869 6674 696e  e to the shiftin
+00015bb0: 672e 0a20 2020 2022 2222 0a20 2020 2069  g..    """.    i
+00015bc0: 6620 276d 635f 706c 6179 7468 726f 7567  f 'mc_playthroug
+00015bd0: 6827 2069 6e20 6d65 6173 7572 6573 2e63  h' in measures.c
+00015be0: 6f6c 756d 6e73 3a0a 2020 2020 2020 2020  olumns:.        
+00015bf0: 6163 745f 6475 7273 203d 206d 6561 7375  act_durs = measu
+00015c00: 7265 732e 7365 745f 696e 6465 7828 276d  res.set_index('m
+00015c10: 635f 706c 6179 7468 726f 7567 6827 292e  c_playthrough').
+00015c20: 6163 745f 6475 720a 2020 2020 656c 6966  act_dur.    elif
+00015c30: 2027 6d63 2720 696e 206d 6561 7375 7265   'mc' in measure
+00015c40: 732e 636f 6c75 6d6e 733a 0a20 2020 2020  s.columns:.     
+00015c50: 2020 2061 6374 5f64 7572 7320 3d20 6d65     act_durs = me
+00015c60: 6173 7572 6573 2e73 6574 5f69 6e64 6578  asures.set_index
+00015c70: 2827 6d63 2729 2e61 6374 5f64 7572 0a20  ('mc').act_dur. 
+00015c80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00015c90: 206c 6f67 6765 722e 6572 726f 7228 2245   logger.error("E
+00015ca0: 7870 6563 7465 6420 746f 2068 6176 6520  xpected to have 
+00015cb0: 6174 206c 6561 7374 206f 6e65 2063 6f6c  at least one col
+00015cc0: 756d 6e20 6361 6c6c 6564 2027 6d63 2720  umn called 'mc' 
+00015cd0: 6f72 2027 6d63 5f70 6c61 7974 6872 6f75  or 'mc_playthrou
+00015ce0: 6768 272e 2229 0a20 2020 2020 2020 2072  gh'.").        r
+00015cf0: 6574 7572 6e20 7064 2e53 6572 6965 7328  eturn pd.Series(
+00015d00: 290a 2020 2020 6966 2071 7561 7274 6572  ).    if quarter
+00015d10: 733a 0a20 2020 2020 2020 2061 6374 5f64  s:.        act_d
+00015d20: 7572 7320 3d20 6163 745f 6475 7273 202a  urs = act_durs *
+00015d30: 2034 0a20 2020 2072 6573 203d 2061 6374   4.    res = act
+00015d40: 5f64 7572 732e 6375 6d73 756d 2829 0a20  _durs.cumsum(). 
+00015d50: 2020 206c 6173 745f 7661 6c20 3d20 7265     last_val = re
+00015d60: 732e 696c 6f63 5b2d 315d 0a20 2020 206c  s.iloc[-1].    l
+00015d70: 6173 745f 6978 203d 2072 6573 2e69 6e64  ast_ix = res.ind
+00015d80: 6578 5b2d 315d 202b 2031 0a20 2020 2072  ex[-1] + 1.    r
+00015d90: 6573 203d 2072 6573 2e73 6869 6674 2866  es = res.shift(f
+00015da0: 696c 6c5f 7661 6c75 653d 3029 0a20 2020  ill_value=0).   
+00015db0: 2065 6e64 696e 6720 3d20 7064 2e53 6572   ending = pd.Ser
+00015dc0: 6965 7328 5b6c 6173 745f 7661 6c2c 206c  ies([last_val, l
+00015dd0: 6173 745f 7661 6c5d 2c20 696e 6465 783d  ast_val], index=
+00015de0: 5b6c 6173 745f 6978 2c20 2765 6e64 275d  [last_ix, 'end']
+00015df0: 290a 2020 2020 7265 7320 3d20 7064 2e63  ).    res = pd.c
+00015e00: 6f6e 6361 7428 5b72 6573 2c20 656e 6469  oncat([res, endi
+00015e10: 6e67 5d29 0a20 2020 2069 6620 6e65 6761  ng]).    if nega
+00015e20: 7469 7665 5f61 6e61 6372 7573 6973 2069  tive_anacrusis i
+00015e30: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00015e40: 2020 2020 7265 7320 2d3d 2061 6273 2866      res -= abs(f
+00015e50: 7261 6328 6e65 6761 7469 7665 5f61 6e61  rac(negative_ana
+00015e60: 6372 7573 6973 2929 0a20 2020 2072 6574  crusis)).    ret
+00015e70: 7572 6e20 7265 730a 0a64 6566 206d 616b  urn res..def mak
+00015e80: 655f 6f66 6673 6574 5f64 6963 745f 6672  e_offset_dict_fr
+00015e90: 6f6d 5f6d 6561 7375 7265 7328 6d65 6173  om_measures(meas
+00015ea0: 7572 6573 3a20 7064 2e44 6174 6146 7261  ures: pd.DataFra
+00015eb0: 6d65 2c20 616c 6c5f 656e 6469 6e67 733a  me, all_endings:
+00015ec0: 2062 6f6f 6c20 3d20 4661 6c73 6529 202d   bool = False) -
+00015ed0: 3e20 6469 6374 3a0a 2020 2020 2222 2220  > dict:.    """ 
+00015ee0: 5475 726e 2061 206d 6561 7375 7265 2074  Turn a measure t
+00015ef0: 6162 6c65 2074 6861 7420 636f 6d65 7320  able that comes 
+00015f00: 7769 7468 2061 2027 7175 6172 7465 7262  with a 'quarterb
+00015f10: 6561 7473 2720 636f 6c75 6d6e 2069 6e74  eats' column int
+00015f20: 6f20 6120 6469 6374 696f 6e61 7279 2074  o a dictionary t
+00015f30: 6861 7420 6d61 7073 204d 4373 2028 6d65  hat maps MCs (me
+00015f40: 6173 7572 6520 636f 756e 7473 290a 2020  asure counts).  
+00015f50: 2020 746f 2074 6865 6972 2071 7561 7274    to their quart
+00015f60: 6572 6265 6174 206f 6666 7365 7420 6672  erbeat offset fr
+00015f70: 6f6d 2074 6865 2070 6965 6365 2773 2062  om the piece's b
+00015f80: 6567 696e 6e69 6e67 2c20 7573 6564 2066  eginning, used f
+00015f90: 6f72 2063 6f6d 7075 7469 6e67 2071 7561  or computing qua
+00015fa0: 7274 6572 6265 6174 7320 666f 7220 6f74  rterbeats for ot
+00015fb0: 6865 7220 6661 6365 7473 2e0a 0a20 2020  her facets...   
+00015fc0: 2054 6869 7320 6675 6e63 7469 6f6e 2069   This function i
+00015fd0: 7320 7573 6564 2066 6f72 2074 6865 2064  s used for the d
+00015fe0: 6566 6175 6c74 2063 6173 652e 2049 6620  efault case. If 
+00015ff0: 796f 7520 6e65 6564 206d 6f72 6520 6f70  you need more op
+00016000: 7469 6f6e 732c 2065 2e67 2e20 616e 206f  tions, e.g. an o
+00016010: 6666 7365 7420 6469 6374 2066 726f 6d20  ffset dict from 
+00016020: 756e 666f 6c64 6564 0a20 2020 206d 6561  unfolded.    mea
+00016030: 7375 7265 7320 6f72 2065 7870 7265 7373  sures or express
+00016040: 6564 2069 6e20 7768 6f6c 6520 6e6f 7465  ed in whole note
+00016050: 7320 6f72 2077 6974 6820 6e65 6761 7469  s or with negati
+00016060: 7665 2061 6e61 6372 7573 6973 2c20 7573  ve anacrusis, us
+00016070: 650a 2020 2020 3a66 756e 633a 606d 616b  e.    :func:`mak
+00016080: 655f 636f 6e74 696e 756f 7573 5f6f 6666  e_continuous_off
+00016090: 7365 745f 7365 7269 6573 6020 696e 7374  set_series` inst
+000160a0: 6561 642e 0a0a 2020 2020 4172 6773 3a0a  ead...    Args:.
+000160b0: 2020 2020 2020 6d65 6173 7572 6573 3a20        measures: 
+000160c0: 4d65 6173 7572 6573 2074 6162 6c65 2063  Measures table c
+000160d0: 6f6e 7461 696e 696e 6720 6120 2771 7561  ontaining a 'qua
+000160e0: 7274 6572 6265 6174 7327 2063 6f6c 756d  rterbeats' colum
+000160f0: 6e2e 0a20 2020 2020 2061 6c6c 5f65 6e64  n..      all_end
+00016100: 696e 6773 3a20 5573 6573 2074 6865 2063  ings: Uses the c
+00016110: 6f6c 756d 6e20 2771 7561 7274 6572 6265  olumn 'quarterbe
+00016120: 6174 735f 616c 6c5f 656e 6469 6e67 7327  ats_all_endings'
+00016130: 206f 6620 7468 6520 6d65 6173 7572 6573   of the measures
+00016140: 2074 6162 6c65 2069 6620 6974 2068 6173   table if it has
+00016150: 206f 6e65 2c20 6f74 6865 7277 6973 650a   one, otherwise.
+00016160: 2020 2020 2020 2020 2020 6661 6c6c 7320            falls 
+00016170: 6261 636b 2074 6f20 7468 6520 6465 6661  back to the defa
+00016180: 756c 7420 2771 7561 7274 6572 6265 6174  ult 'quarterbeat
+00016190: 7327 2e0a 0a20 2020 2052 6574 7572 6e73  s'...    Returns
+000161a0: 3a0a 2020 2020 2020 7b4d 4320 2d3e 2071  :.      {MC -> q
+000161b0: 7561 7274 6572 6265 6174 5f6f 6666 7365  uarterbeat_offse
+000161c0: 747d 2e20 4f66 6673 6574 7320 6172 6520  t}. Offsets are 
+000161d0: 4672 6163 7469 6f6e 732e 2049 6620 6060  Fractions. If ``
+000161e0: 616c 6c5f 656e 6469 6e67 7360 6020 6973  all_endings`` is
+000161f0: 206e 6f74 2073 6574 2074 6f20 6060 5472   not set to ``Tr
+00016200: 7565 6060 2c0a 2020 2020 2020 7661 6c75  ue``,.      valu
+00016210: 6573 2066 6f72 204d 4373 2074 6861 7420  es for MCs that 
+00016220: 6172 6520 7061 7274 206f 6620 6120 6669  are part of a fi
+00016230: 7273 7420 656e 6469 6e67 2028 6f72 2074  rst ending (or t
+00016240: 6869 7264 206f 7220 6c61 7267 6572 2920  hird or larger) 
+00016250: 6172 6520 4e41 2e0a 2020 2020 2222 220a  are NA..    """.
+00016260: 2020 2020 6d65 6173 7572 6573 203d 206d      measures = m
+00016270: 6561 7375 7265 732e 7365 745f 696e 6465  easures.set_inde
+00016280: 7828 276d 6327 290a 2020 2020 6966 2061  x('mc').    if a
+00016290: 6c6c 5f65 6e64 696e 6773 2061 6e64 2027  ll_endings and '
+000162a0: 7175 6172 7465 7262 6561 7473 5f61 6c6c  quarterbeats_all
+000162b0: 5f65 6e64 696e 6773 2720 696e 206d 6561  _endings' in mea
+000162c0: 7375 7265 732e 636f 6c75 6d6e 733a 0a20  sures.columns:. 
+000162d0: 2020 2020 2020 2063 6f6c 203d 2027 7175         col = 'qu
+000162e0: 6172 7465 7262 6561 7473 5f61 6c6c 5f65  arterbeats_all_e
+000162f0: 6e64 696e 6773 270a 2020 2020 656c 7365  ndings'.    else
+00016300: 3a0a 2020 2020 2020 2020 636f 6c20 3d20  :.        col = 
+00016310: 2771 7561 7274 6572 6265 6174 7327 0a20  'quarterbeats'. 
+00016320: 2020 206f 6666 7365 745f 6469 6374 203d     offset_dict =
+00016330: 206d 6561 7375 7265 735b 636f 6c5d 2e74   measures[col].t
+00016340: 6f5f 6469 6374 2829 0a20 2020 206c 6173  o_dict().    las
+00016350: 745f 726f 7720 3d20 6d65 6173 7572 6573  t_row = measures
+00016360: 2e69 6c6f 635b 2d31 5d0a 2020 2020 6f66  .iloc[-1].    of
+00016370: 6673 6574 5f64 6963 745b 2765 6e64 275d  fset_dict['end']
+00016380: 203d 206c 6173 745f 726f 775b 636f 6c5d   = last_row[col]
+00016390: 202b 2034 202a 206c 6173 745f 726f 772e   + 4 * last_row.
+000163a0: 6163 745f 6475 720a 2020 2020 7265 7475  act_dur.    retu
+000163b0: 726e 206f 6666 7365 745f 6469 6374 0a0a  rn offset_dict..
+000163c0: 0a64 6566 206d 616b 655f 6964 5f74 7570  .def make_id_tup
+000163d0: 6c65 7328 6b65 792c 206e 293a 0a20 2020  les(key, n):.   
+000163e0: 2022 2222 2046 6f72 2061 2067 6976 656e   """ For a given
+000163f0: 206b 6579 2c20 7468 6973 2066 756e 6374   key, this funct
+00016400: 696f 6e20 7265 7475 726e 7320 696e 6465  ion returns inde
+00016410: 7820 7475 706c 6573 2069 6e20 7468 6520  x tuples in the 
+00016420: 666f 726d 205b 286b 6579 2c20 3029 2c20  form [(key, 0), 
+00016430: 2e2e 2e2c 2028 6b65 792c 206e 295d 0a0a  ..., (key, n)]..
+00016440: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00016450: 2d2d 2d2d 2d2d 2d0a 2020 2020 6c69 7374  -------.    list
+00016460: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
+00016470: 2069 6e20 7468 6520 666f 726d 205b 286b   in the form [(k
+00016480: 6579 2c20 3029 2c20 2e2e 2e2c 2028 6b65  ey, 0), ..., (ke
+00016490: 792c 206e 295d 0a0a 2020 2020 2222 220a  y, n)]..    """.
+000164a0: 2020 2020 7265 7475 726e 206c 6973 7428      return list(
+000164b0: 7a69 7028 7265 7065 6174 286b 6579 292c  zip(repeat(key),
+000164c0: 2072 616e 6765 286e 2929 290a 0a0a 4066   range(n)))...@f
+000164d0: 756e 6374 696f 6e5f 6c6f 6767 6572 0a64  unction_logger.d
+000164e0: 6566 206d 616b 655f 696e 7465 7276 616c  ef make_interval
+000164f0: 5f69 6e64 6578 5f66 726f 6d5f 6272 6561  _index_from_brea
+00016500: 6b73 2853 2c20 656e 645f 7661 6c75 653d  ks(S, end_value=
+00016510: 4e6f 6e65 2c20 636c 6f73 6564 3d27 6c65  None, closed='le
+00016520: 6674 272c 206e 616d 653d 2769 6e74 6572  ft', name='inter
+00016530: 7661 6c27 293a 0a20 2020 2022 2222 2049  val'):.    """ I
+00016540: 6e74 6572 7072 6574 2061 2053 6572 6965  nterpret a Serie
+00016550: 7320 6173 2069 6e74 6572 7661 6c20 6272  s as interval br
+00016560: 6561 6b73 2061 6e64 206d 616b 6520 616e  eaks and make an
+00016570: 2049 6e74 6572 7661 6c49 6e64 6578 206f   IntervalIndex o
+00016580: 7574 206f 6620 6974 2e0a 0a20 2020 2050  ut of it...    P
+00016590: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+000165a0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2053 203a  --------.    S :
+000165b0: 203a 6f62 6a3a 6070 616e 6461 732e 5365   :obj:`pandas.Se
+000165c0: 7269 6573 600a 2020 2020 2020 2020 496e  ries`.        In
+000165d0: 7465 7276 616c 2062 7265 616b 732e 2049  terval breaks. I
+000165e0: 7420 6973 2061 7373 756d 6564 2074 6861  t is assumed tha
+000165f0: 7420 7468 6520 6272 6561 6b73 2061 7265  t the breaks are
+00016600: 2073 6f72 7465 642e 0a20 2020 2065 6e64   sorted..    end
+00016610: 5f76 616c 7565 203a 206e 756d 6572 6963  _value : numeric
+00016620: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00016630: 2020 204f 6674 656e 2079 6f75 2077 616e     Often you wan
+00016640: 7420 746f 2070 6173 7320 7468 6520 7269  t to pass the ri
+00016650: 6768 7420 626f 7264 6572 206f 6620 7468  ght border of th
+00016660: 6520 6c61 7374 2069 6e74 6572 7661 6c2e  e last interval.
+00016670: 0a20 2020 2063 6c6f 7365 6420 3a20 3a6f  .    closed : :o
+00016680: 626a 3a60 7374 7260 2c20 6f70 7469 6f6e  bj:`str`, option
+00016690: 616c 0a20 2020 2020 2020 2044 6566 6175  al.        Defau
+000166a0: 6c74 7320 746f 2027 6c65 6674 272e 2041  lts to 'left'. A
+000166b0: 7267 756d 656e 7420 7061 7373 6564 2074  rgument passed t
+000166c0: 6f20 746f 203a 7079 3a6d 6574 683a 6070  o to :py:meth:`p
+000166d0: 616e 6461 732e 496e 7465 7276 616c 496e  andas.IntervalIn
+000166e0: 6465 782e 6672 6f6d 5f62 7265 616b 7360  dex.from_breaks`
+000166f0: 2e0a 2020 2020 6e61 6d65 203a 203a 6f62  ..    name : :ob
+00016700: 6a3a 6073 7472 602c 206f 7074 696f 6e61  j:`str`, optiona
+00016710: 6c0a 2020 2020 2020 2020 4e61 6d65 206f  l.        Name o
+00016720: 6620 7468 6520 6372 6561 7465 6420 696e  f the created in
+00016730: 6465 782e 2044 6566 6175 6c74 7320 746f  dex. Defaults to
+00016740: 2027 696e 7465 7276 616c 272e 0a0a 2020   'interval'...  
+00016750: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00016760: 2d2d 2d2d 2d0a 2020 2020 3a6f 626a 3a60  -----.    :obj:`
+00016770: 7061 6e64 6173 2e49 6e74 6572 7661 6c49  pandas.IntervalI
+00016780: 6e64 6578 600a 0a20 2020 2022 2222 0a20  ndex`..    """. 
+00016790: 2020 2062 7265 616b 7320 3d20 532e 746f     breaks = S.to
+000167a0: 5f6c 6973 7428 290a 2020 2020 6966 2065  _list().    if e
+000167b0: 6e64 5f76 616c 7565 2069 7320 6e6f 7420  nd_value is not 
+000167c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6c61  None:.        la
+000167d0: 7374 203d 2062 7265 616b 735b 2d31 5d0a  st = breaks[-1].
+000167e0: 2020 2020 2020 2020 6966 2065 6e64 5f76          if end_v
+000167f0: 616c 7565 203e 206c 6173 743a 0a20 2020  alue > last:.   
+00016800: 2020 2020 2020 2020 2062 7265 616b 7320           breaks 
+00016810: 2b3d 205b 656e 645f 7661 6c75 655d 0a20  += [end_value]. 
+00016820: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00016830: 2020 2020 2020 2020 2062 7265 616b 7320           breaks 
+00016840: 2b3d 205b 6c61 7374 5d0a 2020 2020 7472  += [last].    tr
+00016850: 793a 0a20 2020 2020 2020 2069 6978 203d  y:.        iix =
+00016860: 2070 642e 496e 7465 7276 616c 496e 6465   pd.IntervalInde
+00016870: 782e 6672 6f6d 5f62 7265 616b 7328 6272  x.from_breaks(br
+00016880: 6561 6b73 2c20 636c 6f73 6564 3d63 6c6f  eaks, closed=clo
+00016890: 7365 642c 206e 616d 653d 6e61 6d65 290a  sed, name=name).
+000168a0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+000168b0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+000168c0: 2020 2075 6e73 6f72 7465 6420 3d20 5b28     unsorted = [(
+000168d0: 612c 2062 2920 666f 7220 612c 2062 2069  a, b) for a, b i
+000168e0: 6e20 7a69 7028 6272 6561 6b73 2c20 6272  n zip(breaks, br
+000168f0: 6561 6b73 5b31 3a5d 2920 6966 2062 203c  eaks[1:]) if b <
+00016900: 2061 5d0a 2020 2020 2020 2020 6966 206c   a].        if l
+00016910: 656e 2875 6e73 6f72 7465 6429 203e 2030  en(unsorted) > 0
+00016920: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00016930: 6767 6572 2e65 7272 6f72 2866 2242 7265  gger.error(f"Bre
+00016940: 616b 7320 6172 6520 6e6f 7420 736f 7274  aks are not sort
+00016950: 6564 3a20 7b75 6e73 6f72 7465 647d 2229  ed: {unsorted}")
+00016960: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00016970: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00016980: 722e 6572 726f 7228 6622 4361 6e6e 6f74  r.error(f"Cannot
+00016990: 2063 7265 6174 6520 496e 7465 7276 616c   create Interval
+000169a0: 496e 6465 7820 6672 6f6d 2074 6865 7365  Index from these
+000169b0: 2062 7265 616b 733a 5c6e 7b62 7265 616b   breaks:\n{break
+000169c0: 737d 5c6e 4578 6365 7074 696f 6e3a 207b  s}\nException: {
+000169d0: 657d 2229 0a20 2020 2020 2020 2072 6169  e}").        rai
+000169e0: 7365 0a20 2020 2072 6574 7572 6e20 6969  se.    return ii
+000169f0: 780a 0a0a 6465 6620 6d61 6b65 5f6e 616d  x...def make_nam
+00016a00: 655f 636f 6c75 6d6e 7328 6466 293a 0a20  e_columns(df):. 
+00016a10: 2020 2022 2222 5265 6c69 6573 206f 6e20     """Relies on 
+00016a20: 7468 6520 636f 6c75 6d6e 7320 6060 6c6f  the columns ``lo
+00016a30: 6361 6c6b 6579 6060 2061 6e64 2060 6067  calkey`` and ``g
+00016a40: 6c6f 6261 6c6b 6579 6060 2074 6f20 7472  lobalkey`` to tr
+00016a50: 616e 7366 6f72 6d20 7468 6520 636f 6c75  ansform the colu
+00016a60: 6d6e 7320 6060 726f 6f74 6060 2061 6e64  mns ``root`` and
+00016a70: 2060 6062 6173 735f 6e6f 7465 7360 6020   ``bass_notes`` 
+00016a80: 6672 6f6d 0a20 2020 2073 6361 6c65 2064  from.    scale d
+00016a90: 6567 7265 6573 2028 6578 7072 6573 7365  egrees (expresse
+00016aa0: 6420 6173 2066 6966 7468 7329 2074 6f20  d as fifths) to 
+00016ab0: 6162 736f 6c75 7465 206e 6f74 6520 6e61  absolute note na
+00016ac0: 6d65 732c 2065 2e67 2e20 696e 2043 206d  mes, e.g. in C m
+00016ad0: 616a 6f72 3a20 3020 3d3e 2027 4327 2c20  ajor: 0 => 'C', 
+00016ae0: 3720 3d3e 2027 4323 272c 202d 3520 3d3e  7 => 'C#', -5 =>
+00016af0: 2027 4462 270a 2020 2020 5573 6573 3a20   'Db'.    Uses: 
+00016b00: 7472 616e 7366 6f72 6d28 292c 2073 6361  transform(), sca
+00016b10: 6c65 5f64 6567 7265 6532 6e61 6d65 2222  le_degree2name""
+00016b20: 220a 2020 2020 6e65 775f 636f 6c73 203d  ".    new_cols =
+00016b30: 207b 7d0a 2020 2020 666f 7220 636f 6c20   {}.    for col 
+00016b40: 696e 2028 2772 6f6f 7427 2c20 2762 6173  in ('root', 'bas
+00016b50: 735f 6e6f 7465 2729 3a0a 2020 2020 2020  s_note'):.      
+00016b60: 2020 6966 2063 6f6c 2069 6e20 6466 2e63    if col in df.c
+00016b70: 6f6c 756d 6e73 3a0a 2020 2020 2020 2020  olumns:.        
+00016b80: 2020 2020 6e65 775f 636f 6c73 5b66 227b      new_cols[f"{
+00016b90: 636f 6c7d 5f6e 616d 6522 5d20 3d20 7472  col}_name"] = tr
+00016ba0: 616e 7366 6f72 6d28 6466 2c20 7363 616c  ansform(df, scal
+00016bb0: 655f 6465 6772 6565 326e 616d 652c 205b  e_degree2name, [
+00016bc0: 636f 6c2c 2027 6c6f 6361 6c6b 6579 272c  col, 'localkey',
+00016bd0: 2027 676c 6f62 616c 6b65 7927 5d29 0a20   'globalkey']). 
+00016be0: 2020 2072 6574 7572 6e20 7064 2e44 6174     return pd.Dat
+00016bf0: 6146 7261 6d65 286e 6577 5f63 6f6c 7329  aFrame(new_cols)
+00016c00: 0a0a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  ...@function_log
+00016c10: 6765 720a 6465 6620 6d61 6b65 5f70 6c61  ger.def make_pla
+00016c20: 7974 6872 6f75 6768 326d 6328 6d65 6173  ythrough2mc(meas
+00016c30: 7572 6573 3a20 7064 2e44 6174 6146 7261  ures: pd.DataFra
+00016c40: 6d65 2920 2d3e 204f 7074 696f 6e61 6c5b  me) -> Optional[
+00016c50: 7064 2e53 6572 6965 735d 3a0a 2020 2020  pd.Series]:.    
+00016c60: 2222 2254 7572 6e73 2074 6865 2063 6f6c  """Turns the col
+00016c70: 756d 6e20 276e 6578 7427 2069 6e74 6f20  umn 'next' into 
+00016c80: 6120 6d61 7070 696e 6720 6f66 2070 6c61  a mapping of pla
+00016c90: 7974 6872 6f75 6768 5f6d 6320 2d3e 206d  ythrough_mc -> m
+00016ca0: 632e 2222 220a 2020 2020 6d6c 203d 206d  c.""".    ml = m
+00016cb0: 6561 7375 7265 732e 7365 745f 696e 6465  easures.set_inde
+00016cc0: 7828 276d 6327 290a 2020 2020 7472 793a  x('mc').    try:
+00016cd0: 0a20 2020 2020 2020 2073 6571 203d 206e  .        seq = n
+00016ce0: 6578 7432 7365 7175 656e 6365 286d 6c2e  ext2sequence(ml.
+00016cf0: 6e65 7874 2c20 6c6f 6767 6572 3d6c 6f67  next, logger=log
+00016d00: 6765 7229 0a20 2020 2020 2020 2069 6620  ger).        if 
+00016d10: 7365 7120 6973 204e 6f6e 653a 0a20 2020  seq is None:.   
+00016d20: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00016d30: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00016d40: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00016d50: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
+00016d60: 6728 6622 436f 6d70 7574 696e 6720 756e  g(f"Computing un
+00016d70: 666f 6c64 6564 2073 6571 7565 6e63 6520  folded sequence 
+00016d80: 6f66 204d 4373 2066 6169 6c65 6420 7769  of MCs failed wi
+00016d90: 7468 3a5c 6e27 7b65 7d27 222c 0a20 2020  th:\n'{e}'",.   
+00016da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016db0: 2020 2020 6578 7472 613d 7b27 6d65 7373      extra={'mess
+00016dc0: 6167 655f 6964 273a 2028 3236 2c20 297d  age_id': (26, )}
+00016dd0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00016de0: 0a20 2020 206d 635f 706c 6179 7468 726f  .    mc_playthro
+00016df0: 7567 6820 3d20 7064 2e53 6572 6965 7328  ugh = pd.Series(
+00016e00: 7365 712c 206e 616d 653d 276d 635f 706c  seq, name='mc_pl
+00016e10: 6179 7468 726f 7567 6827 2c20 6474 7970  aythrough', dtyp
+00016e20: 653d 2749 6e74 3634 2729 0a20 2020 2069  e='Int64').    i
+00016e30: 6620 6c65 6e28 6d63 5f70 6c61 7974 6872  f len(mc_playthr
+00016e40: 6f75 6768 2920 3d3d 2030 3a0a 2020 2020  ough) == 0:.    
+00016e50: 2020 2020 7061 7373 0a20 2020 2065 6c69      pass.    eli
+00016e60: 6620 7365 715b 305d 203d 3d20 313a 0a20  f seq[0] == 1:. 
+00016e70: 2020 2020 2020 206d 635f 706c 6179 7468         mc_playth
+00016e80: 726f 7567 682e 696e 6465 7820 2b3d 2031  rough.index += 1
+00016e90: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00016ea0: 2020 2061 7373 6572 7420 7365 715b 305d     assert seq[0]
+00016eb0: 203d 3d20 302c 2066 2254 6865 2066 6972   == 0, f"The fir
+00016ec0: 7374 206d 6320 7368 6f75 6c64 2062 6520  st mc should be 
+00016ed0: 3020 6f72 2031 2c20 6e6f 7420 7b73 6571  0 or 1, not {seq
+00016ee0: 5b30 5d7d 220a 2020 2020 7265 7475 726e  [0]}".    return
+00016ef0: 206d 635f 706c 6179 7468 726f 7567 680a   mc_playthrough.
+00016f00: 0a40 6675 6e63 7469 6f6e 5f6c 6f67 6765  .@function_logge
+00016f10: 720a 6465 6620 6d61 6b65 5f70 6c61 7974  r.def make_playt
+00016f20: 6872 6f75 6768 5f69 6e66 6f28 6d65 6173  hrough_info(meas
+00016f30: 7572 6573 3a20 7064 2e44 6174 6146 7261  ures: pd.DataFra
+00016f40: 6d65 2920 2d3e 204f 7074 696f 6e61 6c5b  me) -> Optional[
+00016f50: 556e 696f 6e5b 7064 2e44 6174 6146 7261  Union[pd.DataFra
+00016f60: 6d65 2c20 7064 2e53 6572 6965 735d 5d3a  me, pd.Series]]:
+00016f70: 0a20 2020 2022 2222 5475 726e 7320 6120  .    """Turns a 
+00016f80: 6d65 6173 7572 6573 2074 6162 6c65 2069  measures table i
+00016f90: 6e74 6f20 6120 4461 7461 4672 616d 6520  nto a DataFrame 
+00016fa0: 6f72 2053 6572 6965 7320 7468 6174 2063  or Series that c
+00016fb0: 616e 2062 6520 7061 7373 6564 2061 7320  an be passed as 
+00016fc0: 6172 6775 6d65 6e74 2074 6f20 3a66 756e  argument to :fun
+00016fd0: 633a 6075 6e66 6f6c 645f 7265 7065 6174  c:`unfold_repeat
+00016fe0: 7360 2e0a 2020 2020 5468 6520 7265 7475  s`..    The retu
+00016ff0: 726e 2074 7970 6520 6973 2044 6174 6146  rn type is DataF
+00017000: 7261 6d65 2069 6620 7468 6520 756e 666f  rame if the unfo
+00017010: 6c64 6564 206d 6561 7375 7265 7320 7461  lded measures ta
+00017020: 626c 6520 636f 6e74 6169 6e73 2061 6e20  ble contains an 
+00017030: 276d 6e5f 706c 6179 7468 726f 7567 6827  'mn_playthrough'
+00017040: 2063 6f6c 756d 6e2c 206f 7468 6572 7769   column, otherwi
+00017050: 7365 2069 740a 2020 2020 6973 2065 7175  se it.    is equ
+00017060: 616c 2074 6f20 7468 6520 7265 7375 6c74  al to the result
+00017070: 206f 6620 3a66 756e 633a 606d 616b 655f   of :func:`make_
+00017080: 706c 6179 7468 726f 7567 6832 6d63 602e  playthrough2mc`.
+00017090: 2048 656e 6365 2c20 7468 6520 7075 7270   Hence, the purp
+000170a0: 6f73 6520 6f66 2074 6865 2066 756e 6374  ose of the funct
+000170b0: 696f 6e20 6973 2074 6f20 6164 6420 616e  ion is to add an
+000170c0: 0a20 2020 2027 6d6e 5f70 6c61 7974 6872  .    'mn_playthr
+000170d0: 6f75 6768 2720 636f 6c75 6d6e 2074 6f20  ough' column to 
+000170e0: 756e 666f 6c64 6564 2066 6163 6574 7320  unfolded facets 
+000170f0: 7768 656e 6576 6572 2070 6f73 7369 626c  whenever possibl
+00017100: 652e 0a20 2020 2022 2222 0a20 2020 2075  e..    """.    u
+00017110: 6e66 6f6c 6465 645f 6d65 6173 7572 6573  nfolded_measures
+00017120: 203d 2075 6e66 6f6c 645f 6d65 6173 7572   = unfold_measur
+00017130: 6573 5f74 6162 6c65 286d 6561 7375 7265  es_table(measure
+00017140: 732c 206c 6f67 6765 723d 6c6f 6767 6572  s, logger=logger
+00017150: 290a 2020 2020 6966 2075 6e66 6f6c 6465  ).    if unfolde
+00017160: 645f 6d65 6173 7572 6573 2069 7320 4e6f  d_measures is No
+00017170: 6e65 3a0a 2020 2020 2020 2020 7265 7475  ne:.        retu
+00017180: 726e 0a20 2020 2075 6e66 6f6c 6465 645f  rn.    unfolded_
+00017190: 6d65 6173 7572 6573 203d 2075 6e66 6f6c  measures = unfol
+000171a0: 6465 645f 6d65 6173 7572 6573 2e73 6574  ded_measures.set
+000171b0: 5f69 6e64 6578 2827 6d63 5f70 6c61 7974  _index('mc_playt
+000171c0: 6872 6f75 6768 2729 0a20 2020 2069 6620  hrough').    if 
+000171d0: 276d 6e5f 706c 6179 7468 726f 7567 6827  'mn_playthrough'
+000171e0: 2069 6e20 756e 666f 6c64 6564 5f6d 6561   in unfolded_mea
+000171f0: 7375 7265 732e 636f 6c75 6d6e 733a 0a20  sures.columns:. 
+00017200: 2020 2020 2020 2072 6574 7572 6e20 756e         return un
+00017210: 666f 6c64 6564 5f6d 6561 7375 7265 735b  folded_measures[
+00017220: 5b27 6d63 272c 2027 6d6e 5f70 6c61 7974  ['mc', 'mn_playt
+00017230: 6872 6f75 6768 275d 5d0a 2020 2020 7265  hrough']].    re
+00017240: 7475 726e 2075 6e66 6f6c 6465 645f 6d65  turn unfolded_me
+00017250: 6173 7572 6573 2e6d 630a 0a0a 6465 6620  asures.mc...def 
+00017260: 6d61 7032 656c 656d 656e 7473 2865 2c20  map2elements(e, 
+00017270: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
+00017280: 6773 293a 0a20 2020 2022 2222 2049 6620  gs):.    """ If 
+00017290: 6065 6020 6973 2061 6e20 6974 6572 6162  `e` is an iterab
+000172a0: 6c65 2c20 6066 6020 6973 2061 7070 6c69  le, `f` is appli
+000172b0: 6564 2074 6f20 616c 6c20 656c 656d 656e  ed to all elemen
+000172c0: 7473 2e0a 2020 2020 2222 220a 2020 2020  ts..    """.    
+000172d0: 6966 2069 7369 6e73 7461 6e63 6528 652c  if isinstance(e,
+000172e0: 2049 7465 7261 626c 6529 2061 6e64 206e   Iterable) and n
+000172f0: 6f74 2069 7369 6e73 7461 6e63 6528 652c  ot isinstance(e,
+00017300: 2073 7472 293a 0a20 2020 2020 2020 2074   str):.        t
+00017310: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00017320: 7265 7475 726e 2065 2e5f 5f63 6c61 7373  return e.__class
+00017330: 5f5f 286d 6170 3265 6c65 6d65 6e74 7328  __(map2elements(
+00017340: 782c 2066 2c20 2a61 7267 732c 202a 2a6b  x, f, *args, **k
+00017350: 7761 7267 7329 2066 6f72 2078 2069 6e20  wargs) for x in 
+00017360: 6529 0a20 2020 2020 2020 2065 7863 6570  e).        excep
+00017370: 7420 5479 7065 4572 726f 723a 0a20 2020  t TypeError:.   
+00017380: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00017390: 7374 616e 6365 2865 2c20 7064 2e49 6e64  stance(e, pd.Ind
+000173a0: 6578 293a 0a20 2020 2020 2020 2020 2020  ex):.           
+000173b0: 2020 2020 2023 2323 2065 2e67 2e2c 2069       ### e.g., i
+000173c0: 6620 6120 6e75 6d65 7269 6361 6c20 696e  f a numerical in
+000173d0: 6465 7820 6973 2074 7261 6e73 666f 726d  dex is transform
+000173e0: 6564 2074 6f20 7374 7269 6e67 730a 2020  ed to strings.  
+000173f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00017400: 7475 726e 2070 642e 496e 6465 7828 6d61  turn pd.Index(ma
+00017410: 7032 656c 656d 656e 7473 2878 2c20 662c  p2elements(x, f,
+00017420: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+00017430: 2920 666f 7220 7820 696e 2065 290a 2020  ) for x in e).  
+00017440: 2020 7265 7475 726e 2066 2865 2c20 2a61    return f(e, *a
+00017450: 7267 732c 202a 2a6b 7761 7267 7329 0a0a  rgs, **kwargs)..
+00017460: 0a40 6675 6e63 7469 6f6e 5f6c 6f67 6765  .@function_logge
+00017470: 720a 6465 6620 6d65 7267 655f 7469 6573  r.def merge_ties
+00017480: 2864 662c 2072 6574 7572 6e5f 6472 6f70  (df, return_drop
+00017490: 7065 643d 4661 6c73 652c 2070 6572 666f  ped=False, perfo
+000174a0: 726d 5f63 6865 636b 733d 5472 7565 293a  rm_checks=True):
+000174b0: 0a20 2020 2022 2222 2049 6e20 6120 6e6f  .    """ In a no
+000174c0: 7465 206c 6973 742c 206d 6572 6765 2074  te list, merge t
+000174d0: 6965 6420 6e6f 7465 7320 746f 2073 696e  ied notes to sin
+000174e0: 676c 6520 6576 656e 7473 2077 6974 6820  gle events with 
+000174f0: 6163 6375 6d75 6c61 7465 6420 6475 7261  accumulated dura
+00017500: 7469 6f6e 732e 0a20 2020 2020 2020 2049  tions..        I
+00017510: 6e70 7574 2064 6174 6166 7261 6d65 206e  nput dataframe n
+00017520: 6565 6473 2063 6f6c 756d 6e73 205b 2764  eeds columns ['d
+00017530: 7572 6174 696f 6e27 2c20 2774 6965 6427  uration', 'tied'
+00017540: 2c20 276d 6964 6927 2c20 2773 7461 6666  , 'midi', 'staff
+00017550: 275d 2e20 5468 6973 0a20 2020 2020 2020  ']. This.       
+00017560: 2066 756e 6374 696f 6e20 646f 6573 206e   function does n
+00017570: 6f74 2068 616e 646c 6520 636f 7272 6563  ot handle correc
+00017580: 746c 7920 6f76 6572 6c61 7070 696e 6720  tly overlapping 
+00017590: 7469 6573 206f 6e20 7468 6520 7361 6d65  ties on the same
+000175a0: 2070 6974 6368 2073 696e 6365 0a20 2020   pitch since.   
+000175b0: 2020 2020 2069 7420 646f 6573 6e27 7420       it doesn't 
+000175c0: 7461 6b65 2069 6e74 6f20 6163 636f 756e  take into accoun
+000175d0: 7420 7468 6520 6e6f 7461 7469 6f6e 616c  t the notational
+000175e0: 206c 6179 6572 7320 2827 766f 6963 6527   layers ('voice'
+000175f0: 292e 0a0a 0a20 2020 2050 6172 616d 6574  )....    Paramet
+00017600: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00017610: 2d2d 0a20 2020 2064 660a 2020 2020 7265  --.    df.    re
+00017620: 7475 726e 5f64 726f 7070 6564 0a0a 2020  turn_dropped..  
+00017630: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00017640: 2d2d 2d2d 2d0a 0a20 2020 2022 2222 0a0a  -----..    """..
+00017650: 2020 2020 6465 6620 6d65 7267 6528 6466      def merge(df
+00017660: 293a 0a20 2020 2020 2020 2076 6320 3d20  ):.        vc = 
+00017670: 6466 2e74 6965 642e 7661 6c75 655f 636f  df.tied.value_co
+00017680: 756e 7473 2829 0a20 2020 2020 2020 2069  unts().        i
+00017690: 6620 7663 5b31 5d20 213d 2031 206f 7220  f vc[1] != 1 or 
+000176a0: 7663 5b2d 315d 2021 3d20 313a 0a20 2020  vc[-1] != 1:.   
+000176b0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+000176c0: 7761 726e 696e 6728 6622 4d6f 7265 2074  warning(f"More t
+000176d0: 6861 6e20 6f6e 6520 3120 6f72 202d 313a  han one 1 or -1:
+000176e0: 5c6e 7b76 637d 2229 0a20 2020 2020 2020  \n{vc}").       
+000176f0: 2069 7820 3d20 6466 2e69 6c6f 635b 305d   ix = df.iloc[0]
+00017700: 2e6e 616d 650a 2020 2020 2020 2020 6475  .name.        du
+00017710: 7220 3d20 6466 2e64 7572 6174 696f 6e2e  r = df.duration.
+00017720: 7375 6d28 290a 2020 2020 2020 2020 6472  sum().        dr
+00017730: 6f70 203d 2064 662e 696c 6f63 5b31 3a5d  op = df.iloc[1:]
+00017740: 2e69 6e64 6578 2e74 6f5f 6c69 7374 2829  .index.to_list()
+00017750: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00017760: 7064 2e53 6572 6965 7328 7b27 6978 273a  pd.Series({'ix':
+00017770: 2069 782c 2027 6475 7261 7469 6f6e 273a   ix, 'duration':
+00017780: 2064 7572 2c20 2764 726f 7070 6564 273a   dur, 'dropped':
+00017790: 2064 726f 707d 290a 0a20 2020 2064 6566   drop})..    def
+000177a0: 206d 6572 6765 5f6e 6f74 6573 2873 7461   merge_notes(sta
+000177b0: 6666 5f6d 6964 6929 3a0a 0a20 2020 2020  ff_midi):..     
+000177c0: 2020 2073 7461 6666 5f6d 6964 695b 2763     staff_midi['c
+000177d0: 6875 6e6b 7327 5d20 3d20 2873 7461 6666  hunks'] = (staff
+000177e0: 5f6d 6964 692e 7469 6564 203d 3d20 3129  _midi.tied == 1)
+000177f0: 2e61 7374 7970 6528 696e 7429 2e63 756d  .astype(int).cum
+00017800: 7375 6d28 290a 2020 2020 2020 2020 7420  sum().        t 
+00017810: 3d20 7374 6166 665f 6d69 6469 2e67 726f  = staff_midi.gro
+00017820: 7570 6279 2827 6368 756e 6b73 272c 2067  upby('chunks', g
+00017830: 726f 7570 5f6b 6579 733d 4661 6c73 6529  roup_keys=False)
+00017840: 2e61 7070 6c79 286d 6572 6765 290a 2020  .apply(merge).  
+00017850: 2020 2020 2020 7265 7475 726e 2074 2e73        return t.s
+00017860: 6574 5f69 6e64 6578 2827 6978 2729 0a0a  et_index('ix')..
+00017870: 2020 2020 6966 206e 6f74 2064 662e 7469      if not df.ti
+00017880: 6564 2e6e 6f74 6e61 2829 2e61 6e79 2829  ed.notna().any()
+00017890: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000178a0: 2064 660a 2020 2020 6466 203d 2064 662e   df.    df = df.
+000178b0: 636f 7079 2829 0a20 2020 206e 6f74 6e61  copy().    notna
+000178c0: 203d 2064 662e 6c6f 635b 6466 2e74 6965   = df.loc[df.tie
+000178d0: 642e 6e6f 746e 6128 292c 205b 2764 7572  d.notna(), ['dur
+000178e0: 6174 696f 6e27 2c20 2774 6965 6427 2c20  ation', 'tied', 
+000178f0: 276d 6964 6927 2c20 2773 7461 6666 275d  'midi', 'staff']
+00017900: 5d0a 2020 2020 6966 2070 6572 666f 726d  ].    if perform
+00017910: 5f63 6865 636b 733a 0a20 2020 2020 2020  _checks:.       
+00017920: 2062 6566 6f72 6520 3d20 6e6f 746e 612e   before = notna.
+00017930: 7469 6564 2e76 616c 7565 5f63 6f75 6e74  tied.value_count
+00017940: 7328 290a 2020 2020 6e65 775f 6475 7220  s().    new_dur 
+00017950: 3d20 6e6f 746e 612e 6772 6f75 7062 7928  = notna.groupby(
+00017960: 5b27 7374 6166 6627 2c20 276d 6964 6927  ['staff', 'midi'
+00017970: 5d2c 2067 726f 7570 5f6b 6579 733d 4661  ], group_keys=Fa
+00017980: 6c73 6529 2e61 7070 6c79 286d 6572 6765  lse).apply(merge
+00017990: 5f6e 6f74 6573 292e 736f 7274 5f69 6e64  _notes).sort_ind
+000179a0: 6578 2829 0a20 2020 2074 7279 3a0a 2020  ex().    try:.  
+000179b0: 2020 2020 2020 6466 2e6c 6f63 5b6e 6577        df.loc[new
+000179c0: 5f64 7572 2e69 6e64 6578 2c20 2764 7572  _dur.index, 'dur
+000179d0: 6174 696f 6e27 5d20 3d20 6e65 775f 6475  ation'] = new_du
+000179e0: 722e 6475 7261 7469 6f6e 0a20 2020 2065  r.duration.    e
+000179f0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00017a00: 0a20 2020 2020 2020 2070 7269 6e74 286e  .        print(n
+00017a10: 6577 5f64 7572 290a 2020 2020 6966 2072  ew_dur).    if r
+00017a20: 6574 7572 6e5f 6472 6f70 7065 643a 0a20  eturn_dropped:. 
+00017a30: 2020 2020 2020 2064 662e 6c6f 635b 6e65         df.loc[ne
+00017a40: 775f 6475 722e 696e 6465 782c 2027 6472  w_dur.index, 'dr
+00017a50: 6f70 7065 6427 5d20 3d20 6e65 775f 6475  opped'] = new_du
+00017a60: 722e 6472 6f70 7065 640a 2020 2020 6466  r.dropped.    df
+00017a70: 203d 2064 662e 6472 6f70 286e 6577 5f64   = df.drop(new_d
+00017a80: 7572 2e64 726f 7070 6564 2e73 756d 2829  ur.dropped.sum()
+00017a90: 290a 2020 2020 6966 2070 6572 666f 726d  ).    if perform
+00017aa0: 5f63 6865 636b 733a 0a20 2020 2020 2020  _checks:.       
+00017ab0: 2061 6674 6572 203d 2064 662e 7469 6564   after = df.tied
+00017ac0: 2e76 616c 7565 5f63 6f75 6e74 7328 290a  .value_counts().
+00017ad0: 2020 2020 2020 2020 6173 7365 7274 2062          assert b
+00017ae0: 6566 6f72 655b 315d 203d 3d20 6166 7465  efore[1] == afte
+00017af0: 725b 315d 2c20 6622 4572 726f 7220 7768  r[1], f"Error wh
+00017b00: 696c 6520 6d65 7267 696e 6720 7469 6573  ile merging ties
+00017b10: 2e20 4265 666f 7265 3a5c 6e7b 6265 666f  . Before:\n{befo
+00017b20: 7265 7d5c 6e41 6674 6572 3a5c 6e7b 6166  re}\nAfter:\n{af
+00017b30: 7465 727d 220a 2020 2020 7265 7475 726e  ter}".    return
+00017b40: 2064 660a 0a64 6566 206d 6572 6765 5f63   df..def merge_c
+00017b50: 686f 7264 735f 616e 645f 6e6f 7465 7328  hords_and_notes(
+00017b60: 6368 6f72 6473 5f74 6162 6c65 3a20 7064  chords_table: pd
+00017b70: 2e44 6174 6146 7261 6d65 2c0a 2020 2020  .DataFrame,.    
+00017b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b90: 2020 2020 2020 206e 6f74 6573 5f74 6162         notes_tab
+00017ba0: 6c65 3a20 7064 2e44 6174 6146 7261 6d65  le: pd.DataFrame
+00017bb0: 2920 2d3e 2070 642e 4461 7461 4672 616d  ) -> pd.DataFram
+00017bc0: 653a 0a20 2020 2022 2222 5065 7266 6f72  e:.    """Perfor
+00017bd0: 6d73 2061 6e20 6f75 7465 7220 6a6f 696e  ms an outer join
+00017be0: 2062 6574 7765 656e 2061 2063 686f 7264   between a chord
+00017bf0: 7320 7461 626c 6520 616e 6420 6120 6e6f  s table and a no
+00017c00: 7465 7320 7461 626c 652c 2062 6173 6564  tes table, based
+00017c10: 206f 6e20 7468 6520 636f 6c75 6d6e 2027   on the column '
+00017c20: 6368 6f72 645f 6964 272e 2049 6620 7468  chord_id'. If th
+00017c30: 6520 6368 6f72 6473 0a20 2020 2063 6f6d  e chords.    com
+00017c40: 6520 7769 7468 2061 6e20 2765 7665 6e74  e with an 'event
+00017c50: 2720 636f 6c75 6d6e 2c20 616c 6c20 6368  ' column, all ch
+00017c60: 6f72 6420 6576 656e 7473 206d 6174 6368  ord events match
+00017c70: 6564 2077 6974 6820 6174 206c 6561 7374  ed with at least
+00017c80: 206f 6e65 206e 6f74 6520 7769 6c6c 2062   one note will b
+00017c90: 6520 7265 6e61 6d65 6420 746f 2027 4e6f  e renamed to 'No
+00017ca0: 7465 272e 0a20 2020 204d 6172 6b75 7020  te'..    Markup 
+00017cb0: 6469 7370 6c61 7965 6420 696e 2069 6e64  displayed in ind
+00017cc0: 6976 6964 7561 6c20 726f 7773 2028 2744  ividual rows ('D
+00017cd0: 796e 616d 6963 272c 2027 5370 616e 6e65  ynamic', 'Spanne
+00017ce0: 7227 2c20 2753 7461 6666 5465 7874 272c  r', 'StaffText',
+00017cf0: 2027 5379 7374 656d 5465 7874 272c 2027   'SystemText', '
+00017d00: 5465 6d70 6f27 2c20 2746 6967 7572 6564  Tempo', 'Figured
+00017d10: 4261 7373 2729 2c0a 2020 2020 6172 652f  Bass'),.    are/
+00017d20: 7265 6d61 696e 2070 6c61 6365 6420 6265  remain placed be
+00017d30: 666f 7265 2074 6865 206e 6f74 6528 7329  fore the note(s)
+00017d40: 2077 6974 6820 7468 6520 7361 6d65 206f   with the same o
+00017d50: 6e73 6574 2e0a 2020 2020 4d61 726b 7570  nset..    Markup
+00017d60: 2073 686f 7769 6e67 2075 7020 696e 2061   showing up in a
+00017d70: 2043 686f 7264 2065 7665 6e74 2773 2072   Chord event's r
+00017d80: 6f77 2028 652e 672e 2061 2053 7061 6e6e  ow (e.g. a Spann
+00017d90: 6572 2049 4429 2077 696c 6c20 6265 2064  er ID) will be d
+00017da0: 7570 6c69 6361 7465 6420 666f 7220 6561  uplicated for ea
+00017db0: 6368 206e 6f74 6520 7065 7274 6169 6e69  ch note pertaini
+00017dc0: 6e67 2074 6f20 7468 6174 2063 686f 7264  ng to that chord
+00017dd0: 2c0a 2020 2020 692e 652e 2c20 6f6e 6c79  ,.    i.e., only
+00017de0: 2066 6f72 206e 6f74 6573 2069 6e20 7468   for notes in th
+00017df0: 6520 7361 6d65 2073 7461 6666 2061 6e64  e same staff and
+00017e00: 2076 6f69 6365 2e0a 0a20 2020 2041 7267   voice...    Arg
+00017e10: 733a 0a20 2020 2020 2063 686f 7264 735f  s:.      chords_
+00017e20: 7461 626c 653a 0a20 2020 2020 206e 6f74  table:.      not
+00017e30: 6573 5f74 6162 6c65 3a0a 0a20 2020 2052  es_table:..    R
+00017e40: 6574 7572 6e73 3a0a 2020 2020 2020 4d65  eturns:.      Me
+00017e50: 7267 6564 2044 6174 6146 7261 6d65 2e0a  rged DataFrame..
+00017e60: 2020 2020 2222 220a 2020 2020 6e6f 7465      """.    note
+00017e70: 735f 636f 6c75 6d6e 7320 3d20 5b27 7469  s_columns = ['ti
+00017e80: 6564 272c 2027 7470 6327 2c20 276d 6964  ed', 'tpc', 'mid
+00017e90: 6927 2c20 276e 616d 6527 2c20 276f 6374  i', 'name', 'oct
+00017ea0: 6176 6527 2c20 2763 686f 7264 5f69 6427  ave', 'chord_id'
+00017eb0: 5d20 2320 2767 7261 6365 6e6f 7465 272c  ] # 'gracenote',
+00017ec0: 2027 7472 656d 6f6c 6f27 2077 6f75 6c64   'tremolo' would
+00017ed0: 2062 6520 636f 6e74 6169 6e65 6420 696e   be contained in
+00017ee0: 2063 686f 7264 7320 616c 7265 6164 790a   chords already.
+00017ef0: 2020 2020 7072 6573 656e 745f 636f 6c75      present_colu
+00017f00: 6d6e 7320 3d20 5b63 6f6c 2066 6f72 2063  mns = [col for c
+00017f10: 6f6c 2069 6e20 6e6f 7465 735f 636f 6c75  ol in notes_colu
+00017f20: 6d6e 7320 6966 2063 6f6c 2069 6e20 6e6f  mns if col in no
+00017f30: 7465 735f 7461 626c 655d 0a20 2020 2061  tes_table].    a
+00017f40: 7373 6572 7420 2763 686f 7264 5f69 6427  ssert 'chord_id'
+00017f50: 2069 6e20 7072 6573 656e 745f 636f 6c75   in present_colu
+00017f60: 6d6e 732c 2066 224e 6f74 6573 2074 6162  mns, f"Notes tab
+00017f70: 6c65 2064 6f65 7320 6e6f 7420 636f 6d65  le does not come
+00017f80: 2077 6974 6820 6120 2763 686f 7264 5f69   with a 'chord_i
+00017f90: 6427 2063 6f6c 756d 6e20 6e65 6564 6564  d' column needed
+00017fa0: 2066 6f72 206d 6572 6769 6e67 3a20 7b6e   for merging: {n
+00017fb0: 6f74 6573 5f74 6162 6c65 2e63 6f6c 756d  otes_table.colum
+00017fc0: 6e73 7d22 0a20 2020 206e 6f74 6573 203d  ns}".    notes =
+00017fd0: 206e 6f74 6573 5f74 6162 6c65 5b70 7265   notes_table[pre
+00017fe0: 7365 6e74 5f63 6f6c 756d 6e73 5d2e 6173  sent_columns].as
+00017ff0: 7479 7065 287b 2763 686f 7264 5f69 6427  type({'chord_id'
+00018000: 3a20 2749 6e74 3634 277d 290a 2020 2020  : 'Int64'}).    
+00018010: 616d 656e 645f 6576 656e 7473 203d 2027  amend_events = '
+00018020: 6576 656e 7427 2069 6e20 6368 6f72 6473  event' in chords
+00018030: 5f74 6162 6c65 0a20 2020 206d 6572 6765  _table.    merge
+00018040: 6420 3d20 7064 2e6d 6572 6765 2863 686f  d = pd.merge(cho
+00018050: 7264 735f 7461 626c 652c 206e 6f74 6573  rds_table, notes
+00018060: 2c20 6f6e 3d27 6368 6f72 645f 6964 272c  , on='chord_id',
+00018070: 2068 6f77 3d27 6f75 7465 7227 2c20 696e   how='outer', in
+00018080: 6469 6361 746f 723d 616d 656e 645f 6576  dicator=amend_ev
+00018090: 656e 7473 290a 2020 2020 6d65 7267 6564  ents).    merged
+000180a0: 203d 2073 6f72 745f 6e6f 7465 5f6c 6973   = sort_note_lis
+000180b0: 7428 6d65 7267 6564 290a 2020 2020 6966  t(merged).    if
+000180c0: 2061 6d65 6e64 5f65 7665 6e74 733a 0a20   amend_events:. 
+000180d0: 2020 2020 2020 206d 6174 6368 6573 5f6d         matches_m
+000180e0: 6173 6b20 3d20 6d65 7267 6564 2e5f 6d65  ask = merged._me
+000180f0: 7267 6520 3d3d 2027 626f 7468 270a 2020  rge == 'both'.  
+00018100: 2020 2020 2020 6d65 7267 6564 2e6c 6f63        merged.loc
+00018110: 5b6d 6174 6368 6573 5f6d 6173 6b2c 2027  [matches_mask, '
+00018120: 6576 656e 7427 5d20 3d20 274e 6f74 6527  event'] = 'Note'
+00018130: 0a20 2020 2020 2020 206d 6572 6765 642e  .        merged.
+00018140: 6472 6f70 2863 6f6c 756d 6e73 3d27 5f6d  drop(columns='_m
+00018150: 6572 6765 272c 2069 6e70 6c61 6365 3d54  erge', inplace=T
+00018160: 7275 6529 0a20 2020 2072 6574 7572 6e20  rue).    return 
+00018170: 6d65 7267 6564 0a0a 6465 6620 6d65 7461  merged..def meta
+00018180: 6461 7461 3273 6572 6965 7328 643a 2064  data2series(d: d
+00018190: 6963 7429 202d 3e20 7064 2e53 6572 6965  ict) -> pd.Serie
+000181a0: 733a 0a20 2020 2022 2222 2054 7572 6e73  s:.    """ Turns
+000181b0: 2061 206d 6574 6164 6174 6120 6469 6374   a metadata dict
+000181c0: 2069 6e74 6f20 6120 7064 2e53 6572 6965   into a pd.Serie
+000181d0: 7328 2920 2866 6f72 2073 746f 7269 6e67  s() (for storing
+000181e0: 2069 6e20 6120 4461 7461 4672 616d 6529   in a DataFrame)
+000181f0: 0a20 2020 2055 7365 733a 2061 6d62 6974  .    Uses: ambit
+00018200: 7573 326f 6e65 6c69 6e65 7228 292c 2064  us2oneliner(), d
+00018210: 6963 7432 6f6e 656c 696e 6572 2829 2c20  ict2oneliner(), 
+00018220: 7061 7274 735f 696e 666f 2829 0a0a 2020  parts_info()..  
+00018230: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00018240: 2d2d 2d2d 2d0a 2020 2020 3a6f 626a 3a60  -----.    :obj:`
+00018250: 7061 6e64 6173 2e53 6572 6965 7360 0a20  pandas.Series`. 
+00018260: 2020 2020 2020 2041 2073 6572 6965 7320         A series 
+00018270: 616c 6c6f 7769 6e67 2066 6f72 2073 746f  allowing for sto
+00018280: 7269 6e67 206d 6574 6164 6174 6120 6173  ring metadata as
+00018290: 2061 2072 6f77 206f 6620 6120 4461 7461   a row of a Data
+000182a0: 4672 616d 652e 0a20 2020 2022 2222 0a20  Frame..    """. 
+000182b0: 2020 2064 203d 2064 6963 7428 6429 0a20     d = dict(d). 
+000182c0: 2020 2064 5b27 5469 6d65 5369 6727 5d20     d['TimeSig'] 
+000182d0: 3d20 6469 6374 326f 6e65 6c69 6e65 7228  = dict2oneliner(
+000182e0: 645b 2754 696d 6553 6967 275d 290a 2020  d['TimeSig']).  
+000182f0: 2020 645b 274b 6579 5369 6727 5d20 3d20    d['KeySig'] = 
+00018300: 6469 6374 326f 6e65 6c69 6e65 7228 645b  dict2oneliner(d[
+00018310: 274b 6579 5369 6727 5d29 0a20 2020 2069  'KeySig']).    i
+00018320: 6620 2761 6d62 6974 7573 2720 696e 2064  f 'ambitus' in d
+00018330: 3a0a 2020 2020 2020 2020 645b 2761 6d62  :.        d['amb
+00018340: 6974 7573 275d 203d 2061 6d62 6974 7573  itus'] = ambitus
+00018350: 326f 6e65 6c69 6e65 7228 645b 2761 6d62  2oneliner(d['amb
+00018360: 6974 7573 275d 290a 2020 2020 6966 2027  itus']).    if '
+00018370: 7061 7274 7327 2069 6e20 643a 0a20 2020  parts' in d:.   
+00018380: 2020 2020 2064 2e75 7064 6174 6528 7061       d.update(pa
+00018390: 7274 735f 696e 666f 2864 5b27 7061 7274  rts_info(d['part
+000183a0: 7327 5d29 290a 2020 2020 2020 2020 6465  s'])).        de
+000183b0: 6c20 2864 5b27 7061 7274 7327 5d29 0a20  l (d['parts']). 
+000183c0: 2020 2073 203d 2070 642e 5365 7269 6573     s = pd.Series
+000183d0: 2864 290a 2020 2020 7265 7475 726e 2073  (d).    return s
+000183e0: 0a0a 406f 7665 726c 6f61 640a 6465 6620  ..@overload.def 
+000183f0: 6d69 6469 5f61 6e64 5f74 7063 326f 6374  midi_and_tpc2oct
+00018400: 6176 6528 6d69 6469 3a20 696e 742c 2074  ave(midi: int, t
+00018410: 7063 3a20 696e 7429 202d 3e20 696e 743a  pc: int) -> int:
+00018420: 0a20 2020 202e 2e2e 0a40 6f76 6572 6c6f  .    ....@overlo
+00018430: 6164 0a64 6566 206d 6964 695f 616e 645f  ad.def midi_and_
+00018440: 7470 6332 6f63 7461 7665 286d 6964 693a  tpc2octave(midi:
+00018450: 2070 642e 5365 7269 6573 2c20 7470 633a   pd.Series, tpc:
+00018460: 2070 642e 5365 7269 6573 2920 2d3e 2070   pd.Series) -> p
+00018470: 642e 5365 7269 6573 3a0a 2020 2020 2e2e  d.Series:.    ..
+00018480: 2e0a 406f 7665 726c 6f61 640a 6465 6620  ..@overload.def 
+00018490: 6d69 6469 5f61 6e64 5f74 7063 326f 6374  midi_and_tpc2oct
+000184a0: 6176 6528 6d69 6469 3a20 4e44 4172 7261  ave(midi: NDArra
+000184b0: 795b 696e 745d 2c20 7470 633a 204e 4441  y[int], tpc: NDA
+000184c0: 7272 6179 5b69 6e74 5d29 202d 3e20 4e44  rray[int]) -> ND
+000184d0: 4172 7261 795b 696e 745d 3a0a 2020 2020  Array[int]:.    
+000184e0: 2e2e 2e0a 406f 7665 726c 6f61 640a 6465  ....@overload.de
+000184f0: 6620 6d69 6469 5f61 6e64 5f74 7063 326f  f midi_and_tpc2o
+00018500: 6374 6176 6528 6d69 6469 3a20 4c69 7374  ctave(midi: List
+00018510: 5b69 6e74 5d2c 2074 7063 3a20 4c69 7374  [int], tpc: List
+00018520: 5b69 6e74 5d29 202d 3e20 4c69 7374 5b69  [int]) -> List[i
+00018530: 6e74 5d3a 0a20 2020 202e 2e2e 0a40 6f76  nt]:.    ....@ov
+00018540: 6572 6c6f 6164 0a64 6566 206d 6964 695f  erload.def midi_
+00018550: 616e 645f 7470 6332 6f63 7461 7665 286d  and_tpc2octave(m
+00018560: 6964 693a 2020 5475 706c 655b 696e 745d  idi:  Tuple[int]
+00018570: 2c20 7470 633a 2020 5475 706c 655b 696e  , tpc:  Tuple[in
+00018580: 745d 2920 2d3e 2054 7570 6c65 5b69 6e74  t]) -> Tuple[int
+00018590: 5d3a 0a20 2020 202e 2e2e 0a64 6566 206d  ]:.    ....def m
+000185a0: 6964 695f 616e 645f 7470 6332 6f63 7461  idi_and_tpc2octa
+000185b0: 7665 286d 6964 693a 2055 6e69 6f6e 5b69  ve(midi: Union[i
+000185c0: 6e74 2c20 7064 2e53 6572 6965 732c 204e  nt, pd.Series, N
+000185d0: 4441 7272 6179 5b69 6e74 5d2c 204c 6973  DArray[int], Lis
+000185e0: 745b 696e 745d 2c20 5475 706c 655b 696e  t[int], Tuple[in
+000185f0: 745d 5d2c 0a20 2020 2020 2020 2020 2020  t]],.           
+00018600: 2020 2020 2020 2020 2020 2020 2074 7063               tpc
+00018610: 3a20 556e 696f 6e5b 696e 742c 2070 642e  : Union[int, pd.
+00018620: 5365 7269 6573 2c20 4e44 4172 7261 795b  Series, NDArray[
+00018630: 696e 745d 2c20 4c69 7374 5b69 6e74 5d2c  int], List[int],
+00018640: 2054 7570 6c65 5b69 6e74 5d5d 2920 2d3e   Tuple[int]]) ->
+00018650: 2055 6e69 6f6e 5b69 6e74 2c20 7064 2e53   Union[int, pd.S
+00018660: 6572 6965 732c 204e 4441 7272 6179 5b69  eries, NDArray[i
+00018670: 6e74 5d2c 204c 6973 745b 696e 745d 2c20  nt], List[int], 
+00018680: 5475 706c 655b 696e 745d 5d3a 0a20 2020  Tuple[int]]:.   
+00018690: 2074 7279 3a0a 2020 2020 2020 2020 6d69   try:.        mi
+000186a0: 6469 203d 2069 6e74 2866 6c6f 6174 286d  di = int(float(m
+000186b0: 6964 6929 290a 2020 2020 6578 6365 7074  idi)).    except
+000186c0: 2054 7970 6545 7272 6f72 3a0a 2020 2020   TypeError:.    
+000186d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000186e0: 2020 2020 2023 2069 6620 6e75 6d70 7920       # if numpy 
+000186f0: 6172 7261 7920 6f72 2050 616e 6461 7320  array or Pandas 
+00018700: 5365 7269 6573 2c20 636f 6d70 7574 6520  Series, compute 
+00018710: 7665 6374 6f72 697a 6564 2c20 6f74 6865  vectorized, othe
+00018720: 7277 6973 6520 6974 6572 6174 650a 2020  rwise iterate.  
+00018730: 2020 2020 2020 2020 2020 6d69 6469 2e64            midi.d
+00018740: 7479 7065 0a20 2020 2020 2020 2065 7863  type.        exc
+00018750: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
+00018760: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+00018770: 7265 7475 726e 206d 6964 692e 5f5f 636c  return midi.__cl
+00018780: 6173 735f 5f28 6d69 6469 5f61 6e64 5f74  ass__(midi_and_t
+00018790: 7063 326f 6374 6176 6528 6d2c 2074 2920  pc2octave(m, t) 
+000187a0: 666f 7220 6d2c 2074 2069 6e20 7a69 7028  for m, t in zip(
+000187b0: 6d69 6469 2c20 7470 6329 290a 2020 2020  midi, tpc)).    
+000187c0: 6163 6320 3d20 7470 6320 2f2f 2037 0a20  acc = tpc // 7. 
+000187d0: 2020 2072 6574 7572 6e20 286d 6964 6920     return (midi 
+000187e0: 2d20 6163 6329 202f 2f20 3132 202d 2031  - acc) // 12 - 1
+000187f0: 0a0a 406f 7665 726c 6f61 640a 6465 6620  ..@overload.def 
+00018800: 6d69 6469 326f 6374 6176 6528 6d69 6469  midi2octave(midi
+00018810: 3a20 696e 742c 2066 6966 7468 733a 204f  : int, fifths: O
+00018820: 7074 696f 6e61 6c5b 696e 745d 2920 2d3e  ptional[int]) ->
+00018830: 2069 6e74 3a0a 2020 2020 2e2e 2e0a 406f   int:.    ....@o
+00018840: 7665 726c 6f61 640a 6465 6620 6d69 6469  verload.def midi
+00018850: 326f 6374 6176 6528 6d69 6469 3a20 7064  2octave(midi: pd
+00018860: 2e53 6572 6965 732c 2066 6966 7468 733a  .Series, fifths:
+00018870: 204f 7074 696f 6e61 6c5b 7064 2e53 6572   Optional[pd.Ser
+00018880: 6965 735d 2920 2d3e 2070 642e 5365 7269  ies]) -> pd.Seri
+00018890: 6573 3a0a 2020 2020 2e2e 2e0a 406f 7665  es:.    ....@ove
+000188a0: 726c 6f61 640a 6465 6620 6d69 6469 326f  rload.def midi2o
+000188b0: 6374 6176 6528 6d69 6469 3a20 4e44 4172  ctave(midi: NDAr
+000188c0: 7261 795b 696e 745d 2c20 6669 6674 6873  ray[int], fifths
+000188d0: 3a20 4f70 7469 6f6e 616c 5b4e 4441 7272  : Optional[NDArr
+000188e0: 6179 5d29 202d 3e20 4e44 4172 7261 795b  ay]) -> NDArray[
+000188f0: 696e 745d 3a0a 2020 2020 2e2e 2e0a 406f  int]:.    ....@o
+00018900: 7665 726c 6f61 640a 6465 6620 6d69 6469  verload.def midi
+00018910: 326f 6374 6176 6528 6d69 6469 3a20 4c69  2octave(midi: Li
+00018920: 7374 5b69 6e74 5d2c 2066 6966 7468 733a  st[int], fifths:
+00018930: 204f 7074 696f 6e61 6c5b 4c69 7374 5b69   Optional[List[i
+00018940: 6e74 5d5d 2920 2d3e 204c 6973 745b 696e  nt]]) -> List[in
+00018950: 745d 3a0a 2020 2020 2e2e 2e0a 406f 7665  t]:.    ....@ove
+00018960: 726c 6f61 640a 6465 6620 6d69 6469 326f  rload.def midi2o
+00018970: 6374 6176 6528 6d69 6469 3a20 2054 7570  ctave(midi:  Tup
+00018980: 6c65 5b69 6e74 5d2c 2066 6966 7468 733a  le[int], fifths:
+00018990: 204f 7074 696f 6e61 6c5b 5475 706c 655b   Optional[Tuple[
+000189a0: 696e 745d 5d29 202d 3e20 5475 706c 655b  int]]) -> Tuple[
+000189b0: 696e 745d 3a0a 2020 2020 2e2e 2e0a 6465  int]:.    ....de
+000189c0: 6620 6d69 6469 326f 6374 6176 6528 6d69  f midi2octave(mi
+000189d0: 6469 3a20 556e 696f 6e5b 696e 742c 2070  di: Union[int, p
+000189e0: 642e 5365 7269 6573 2c20 4e44 4172 7261  d.Series, NDArra
+000189f0: 795b 696e 745d 2c20 4c69 7374 5b69 6e74  y[int], List[int
+00018a00: 5d2c 2054 7570 6c65 5b69 6e74 5d5d 2c0a  ], Tuple[int]],.
+00018a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a20: 2020 2020 2020 2020 6669 6674 6873 3a20          fifths: 
+00018a30: 4f70 7469 6f6e 616c 5b55 6e69 6f6e 5b69  Optional[Union[i
+00018a40: 6e74 2c20 7064 2e53 6572 6965 732c 204e  nt, pd.Series, N
+00018a50: 4441 7272 6179 5b69 6e74 5d2c 204c 6973  DArray[int], Lis
+00018a60: 745b 696e 745d 2c20 5475 706c 655b 696e  t[int], Tuple[in
+00018a70: 745d 5d5d 203d 204e 6f6e 6529 202d 3e20  t]]] = None) -> 
+00018a80: 556e 696f 6e5b 696e 742c 2070 642e 5365  Union[int, pd.Se
+00018a90: 7269 6573 2c20 4e44 4172 7261 795b 696e  ries, NDArray[in
+00018aa0: 745d 2c20 4c69 7374 5b69 6e74 5d2c 2054  t], List[int], T
+00018ab0: 7570 6c65 5b69 6e74 5d5d 3a0a 2020 2020  uple[int]]:.    
+00018ac0: 2222 2220 466f 7220 6120 6769 7665 6e20  """ For a given 
+00018ad0: 4d49 4449 2070 6974 6368 2c20 6361 6c63  MIDI pitch, calc
+00018ae0: 756c 6174 6520 7468 6520 6f63 7461 7665  ulate the octave
+00018af0: 2e20 4d69 6464 6c65 206f 6374 6176 6520  . Middle octave 
+00018b00: 3d20 340a 2020 2020 2020 2020 5573 6573  = 4.        Uses
+00018b10: 3a20 6d69 6469 5f61 6e64 5f74 7063 326f  : midi_and_tpc2o
+00018b20: 6374 6176 6528 292c 206d 6170 3265 6c65  ctave(), map2ele
+00018b30: 6d65 6e74 7328 290a 0a20 2020 2050 6172  ments()..    Par
+00018b40: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00018b50: 2d2d 2d2d 2d2d 0a20 2020 206d 6964 6920  ------.    midi 
+00018b60: 3a20 3a6f 626a 3a60 696e 7460 0a20 2020  : :obj:`int`.   
+00018b70: 2020 2020 204d 4944 4920 7069 7463 6820       MIDI pitch 
+00018b80: 2870 6f73 6974 6976 6520 696e 7465 6765  (positive intege
+00018b90: 7229 0a20 2020 2066 6966 7468 7320 3a20  r).    fifths : 
+00018ba0: 3a6f 626a 3a60 696e 7460 2c20 6f70 7469  :obj:`int`, opti
+00018bb0: 6f6e 616c 0a20 2020 2020 2020 2054 6f20  onal.        To 
+00018bc0: 6265 2070 7265 6369 7365 2c20 666f 7220  be precise, for 
+00018bd0: 736f 6d65 2054 6f6e 616c 2050 6974 6368  some Tonal Pitch
+00018be0: 2043 6c61 7373 6573 2c20 7468 6520 6f63   Classes, the oc
+00018bf0: 7461 7665 2064 6576 6961 7465 730a 2020  tave deviates.  
+00018c00: 2020 2020 2020 6672 6f6d 2074 6865 2073        from the s
+00018c10: 696d 706c 6520 666f 726d 756c 6120 6060  imple formula ``
+00018c20: 4d49 4449 202f 2f20 3132 202d 2031 6060  MIDI // 12 - 1``
+00018c30: 2c20 652e 672e 2066 6f72 2042 2320 6f72  , e.g. for B# or
+00018c40: 2043 622e 0a20 2020 2022 2222 0a20 2020   Cb..    """.   
+00018c50: 2069 6620 6669 6674 6873 2069 7320 6e6f   if fifths is no
+00018c60: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00018c70: 7265 7475 726e 206d 6964 695f 616e 645f  return midi_and_
+00018c80: 7470 6332 6f63 7461 7665 286d 6964 692c  tpc2octave(midi,
+00018c90: 2066 6966 7468 7329 0a20 2020 2074 7279   fifths).    try
+00018ca0: 3a0a 2020 2020 2020 2020 6d69 6469 203d  :.        midi =
+00018cb0: 2069 6e74 2866 6c6f 6174 286d 6964 6929   int(float(midi)
+00018cc0: 290a 2020 2020 6578 6365 7074 2054 7970  ).    except Typ
+00018cd0: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
+00018ce0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00018cf0: 2023 2069 6620 6e75 6d70 7920 6172 7261   # if numpy arra
+00018d00: 7920 6f72 2050 616e 6461 7320 5365 7269  y or Pandas Seri
+00018d10: 6573 2c20 636f 6d70 7574 6520 7665 6374  es, compute vect
+00018d20: 6f72 697a 6564 2c20 6f74 6865 7277 6973  orized, otherwis
+00018d30: 6520 6974 6572 6174 650a 2020 2020 2020  e iterate.      
+00018d40: 2020 2020 2020 6d69 6469 2e64 7479 7065        midi.dtype
+00018d50: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00018d60: 4174 7472 6962 7574 6545 7272 6f72 3a0a  AttributeError:.
+00018d70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00018d80: 726e 206d 6170 3265 6c65 6d65 6e74 7328  rn map2elements(
+00018d90: 6d69 6469 2c20 6d69 6469 326f 6374 6176  midi, midi2octav
+00018da0: 6529 0a20 2020 2072 6574 7572 6e20 6d69  e).    return mi
+00018db0: 6469 202f 2f20 3132 202d 2031 0a0a 0a64  di // 12 - 1...d
+00018dc0: 6566 206d 6964 6932 6e61 6d65 286d 6964  ef midi2name(mid
+00018dd0: 6929 3a0a 2020 2020 7472 793a 0a20 2020  i):.    try:.   
+00018de0: 2020 2020 206d 6964 6920 3d20 696e 7428       midi = int(
+00018df0: 666c 6f61 7428 6d69 6469 2929 0a20 2020  float(midi)).   
+00018e00: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00018e10: 6e3a 0a20 2020 2020 2020 2069 6620 6973  n:.        if is
+00018e20: 696e 7374 616e 6365 286d 6964 692c 2070  instance(midi, p
+00018e30: 642e 5365 7269 6573 293a 0a20 2020 2020  d.Series):.     
+00018e40: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
+00018e50: 616e 7366 6f72 6d28 6d69 6469 2c20 6d69  ansform(midi, mi
+00018e60: 6469 326e 616d 6529 0a20 2020 2020 2020  di2name).       
+00018e70: 2069 6620 6973 696e 7374 616e 6365 286d   if isinstance(m
+00018e80: 6964 692c 2049 7465 7261 626c 6529 3a0a  idi, Iterable):.
+00018e90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00018ea0: 726e 206d 6170 3265 6c65 6d65 6e74 7328  rn map2elements(
+00018eb0: 6d69 6469 2c20 6d69 6469 326e 616d 6529  midi, midi2name)
+00018ec0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00018ed0: 6d69 6469 0a20 2020 206e 616d 6573 203d  midi.    names =
+00018ee0: 207b 303a 2027 4327 2c0a 2020 2020 2020   {0: 'C',.      
+00018ef0: 2020 2020 2020 2031 3a20 2743 232f 4462         1: 'C#/Db
+00018f00: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00018f10: 323a 2027 4427 2c0a 2020 2020 2020 2020  2: 'D',.        
+00018f20: 2020 2020 2033 3a20 2744 232f 4562 272c       3: 'D#/Eb',
+00018f30: 0a20 2020 2020 2020 2020 2020 2020 343a  .             4:
+00018f40: 2027 4527 2c0a 2020 2020 2020 2020 2020   'E',.          
+00018f50: 2020 2035 3a20 2746 272c 0a20 2020 2020     5: 'F',.     
+00018f60: 2020 2020 2020 2020 363a 2027 4623 2f47          6: 'F#/G
+00018f70: 6227 2c0a 2020 2020 2020 2020 2020 2020  b',.            
+00018f80: 2037 3a20 2747 272c 0a20 2020 2020 2020   7: 'G',.       
+00018f90: 2020 2020 2020 383a 2027 4723 2f41 6227        8: 'G#/Ab'
+00018fa0: 2c0a 2020 2020 2020 2020 2020 2020 2039  ,.             9
+00018fb0: 3a20 2741 272c 0a20 2020 2020 2020 2020  : 'A',.         
+00018fc0: 2020 2020 3130 3a20 2741 232f 4262 272c      10: 'A#/Bb',
+00018fd0: 0a20 2020 2020 2020 2020 2020 2020 3131  .             11
+00018fe0: 3a20 2742 277d 0a20 2020 2072 6574 7572  : 'B'}.    retur
+00018ff0: 6e20 6e61 6d65 735b 6d69 6469 2025 2031  n names[midi % 1
+00019000: 325d 0a0a 0a64 6566 206d 6e32 696e 7428  2]...def mn2int(
+00019010: 6d6e 5f73 6572 6965 7329 3a0a 2020 2020  mn_series):.    
+00019020: 2222 2220 5475 726e 2061 2073 6572 6965  """ Turn a serie
+00019030: 7320 6f66 206d 6561 7375 7265 206e 756d  s of measure num
+00019040: 6265 7273 2070 6172 7365 6420 6173 2073  bers parsed as s
+00019050: 7472 696e 6773 2069 6e74 6f20 7477 6f20  trings into two 
+00019060: 696e 7465 6765 7220 636f 6c75 6d6e 7320  integer columns 
+00019070: 276d 6e27 2061 6e64 2027 766f 6c74 6127  'mn' and 'volta'
+00019080: 2e20 2222 220a 2020 2020 7472 793a 0a20  . """.    try:. 
+00019090: 2020 2020 2020 2073 706c 6974 203d 206d         split = m
+000190a0: 6e5f 7365 7269 6573 2e66 696c 6c6e 6128  n_series.fillna(
+000190b0: 2727 292e 7374 722e 6578 7472 6163 7428  '').str.extract(
+000190c0: 7222 283f 503c 6d6e 3e5c 642b 2928 3f50  r"(?P<mn>\d+)(?P
+000190d0: 3c76 6f6c 7461 3e5b 612d 675d 293f 2229  <volta>[a-g])?")
+000190e0: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
+000190f0: 7074 696f 6e3a 0a20 2020 2020 2020 206d  ption:.        m
+00019100: 6e5f 7365 7269 6573 203d 2070 642e 4461  n_series = pd.Da
+00019110: 7461 4672 616d 6528 6d6e 5f73 6572 6965  taFrame(mn_serie
+00019120: 732c 2063 6f6c 756d 6e73 3d5b 276d 6e27  s, columns=['mn'
+00019130: 2c20 2776 6f6c 7461 275d 290a 2020 2020  , 'volta']).    
+00019140: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00019150: 2020 2020 2072 6574 7572 6e20 6d6e 5f73       return mn_s
+00019160: 6572 6965 732e 6173 7479 7065 2827 496e  eries.astype('In
+00019170: 7436 3427 290a 2020 2020 2020 2020 6578  t64').        ex
+00019180: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+00019190: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000191a0: 726e 206d 6e5f 7365 7269 6573 0a20 2020  rn mn_series.   
+000191b0: 2073 706c 6974 2e6d 6e20 3d20 7064 2e74   split.mn = pd.t
+000191c0: 6f5f 6e75 6d65 7269 6328 7370 6c69 742e  o_numeric(split.
+000191d0: 6d6e 290a 2020 2020 7370 6c69 742e 766f  mn).    split.vo
+000191e0: 6c74 6120 3d20 7064 2e74 6f5f 6e75 6d65  lta = pd.to_nume
+000191f0: 7269 6328 7370 6c69 742e 766f 6c74 612e  ric(split.volta.
+00019200: 6d61 7028 7b27 6127 3a20 312c 2027 6227  map({'a': 1, 'b'
+00019210: 3a20 322c 2027 6327 3a20 332c 2027 6427  : 2, 'c': 3, 'd'
+00019220: 3a20 342c 2027 6527 3a20 357d 2929 0a20  : 4, 'e': 5})). 
+00019230: 2020 2072 6574 7572 6e20 7370 6c69 742e     return split.
+00019240: 6173 7479 7065 2827 496e 7436 3427 290a  astype('Int64').
+00019250: 0a0a 6465 6620 6e61 6d65 3266 6f72 6d61  ..def name2forma
+00019260: 7428 6466 2c20 666f 726d 6174 3d27 6874  t(df, format='ht
+00019270: 6d6c 272c 206e 616d 655f 636f 6c3d 2763  ml', name_col='c
+00019280: 6f6c 6f72 5f6e 616d 6527 293a 0a20 2020  olor_name'):.   
+00019290: 2022 2222 2043 6f6e 7665 7274 7320 6120   """ Converts a 
+000192a0: 636f 6c75 6d6e 2077 6974 6820 4353 5333  column with CSS3
+000192b0: 206e 616d 6573 2069 6e74 6f20 2768 746d   names into 'htm
+000192c0: 6c27 2c20 2772 6762 272c 206f 7220 2027  l', 'rgb', or  '
+000192d0: 7267 6261 272e 2222 220a 2020 2020 6966  rgba'.""".    if
+000192e0: 2066 6f72 6d61 7420 3d3d 2027 6874 6d6c   format == 'html
+000192f0: 273a 0a20 2020 2020 2020 2072 6574 7572  ':.        retur
+00019300: 6e20 6466 5b6e 616d 655f 636f 6c5d 2e6d  n df[name_col].m
+00019310: 6170 2863 6f6c 6f72 5f6e 616d 6532 6874  ap(color_name2ht
+00019320: 6d6c 290a 2020 2020 6966 2066 6f72 6d61  ml).    if forma
+00019330: 7420 3d3d 2027 7267 6227 3a0a 2020 2020  t == 'rgb':.    
+00019340: 2020 2020 7265 7475 726e 2064 665b 6e61      return df[na
+00019350: 6d65 5f63 6f6c 5d2e 6d61 7028 636f 6c6f  me_col].map(colo
+00019360: 725f 6e61 6d65 3272 6762 290a 2020 2020  r_name2rgb).    
+00019370: 6966 2066 6f72 6d61 7420 3d3d 2027 7267  if format == 'rg
+00019380: 6261 273a 0a20 2020 2020 2020 2072 6574  ba':.        ret
+00019390: 7572 6e20 6466 5b6e 616d 655f 636f 6c5d  urn df[name_col]
+000193a0: 2e6d 6170 2863 6f6c 6f72 5f6e 616d 6532  .map(color_name2
+000193b0: 7267 6261 290a 0a0a 4066 756e 6374 696f  rgba)...@functio
+000193c0: 6e5f 6c6f 6767 6572 0a64 6566 206e 616d  n_logger.def nam
+000193d0: 6532 6669 6674 6873 286e 6e29 3a0a 2020  e2fifths(nn):.  
+000193e0: 2020 2222 2220 5475 726e 2061 206e 6f74    """ Turn a not
+000193f0: 6520 6e61 6d65 2073 7563 6820 6173 2060  e name such as `
+00019400: 4162 6020 696e 746f 2061 2074 6f6e 616c  Ab` into a tonal
+00019410: 2070 6974 6368 2063 6c61 7373 2c20 7375   pitch class, su
+00019420: 6368 2074 6861 7420 2d31 3d46 2c20 303d  ch that -1=F, 0=
+00019430: 432c 2031 3d47 2065 7463 2e0a 2020 2020  C, 1=G etc..    
+00019440: 2020 2020 5573 6573 3a20 7370 6c69 745f      Uses: split_
+00019450: 6e6f 7465 5f6e 616d 6528 290a 2020 2020  note_name().    
+00019460: 2222 220a 2020 2020 6966 206e 6e2e 5f5f  """.    if nn.__
+00019470: 636c 6173 735f 5f20 3d3d 2069 6e74 206f  class__ == int o
+00019480: 7220 7064 2e69 736e 756c 6c28 6e6e 293a  r pd.isnull(nn):
+00019490: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000194a0: 6e6e 0a20 2020 206e 616d 655f 7470 6373  nn.    name_tpcs
+000194b0: 203d 207b 2743 273a 2030 2c20 2744 273a   = {'C': 0, 'D':
+000194c0: 2032 2c20 2745 273a 2034 2c20 2746 273a   2, 'E': 4, 'F':
+000194d0: 202d 312c 2027 4727 3a20 312c 2027 4127   -1, 'G': 1, 'A'
+000194e0: 3a20 332c 2027 4227 3a20 357d 0a20 2020  : 3, 'B': 5}.   
+000194f0: 2061 6363 6964 656e 7461 6c73 2c20 6e6f   accidentals, no
+00019500: 7465 5f6e 616d 6520 3d20 7370 6c69 745f  te_name = split_
+00019510: 6e6f 7465 5f6e 616d 6528 6e6e 2c20 636f  note_name(nn, co
+00019520: 756e 743d 5472 7565 2c20 6c6f 6767 6572  unt=True, logger
+00019530: 3d6c 6f67 6765 7229 0a20 2020 2069 6620  =logger).    if 
+00019540: 6e6f 7465 5f6e 616d 6520 6973 204e 6f6e  note_name is Non
+00019550: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
+00019560: 6e20 4e6f 6e65 0a20 2020 2073 7465 705f  n None.    step_
+00019570: 7470 6320 3d20 6e61 6d65 5f74 7063 735b  tpc = name_tpcs[
+00019580: 6e6f 7465 5f6e 616d 652e 7570 7065 7228  note_name.upper(
+00019590: 295d 0a20 2020 2072 6574 7572 6e20 7374  )].    return st
+000195a0: 6570 5f74 7063 202b 2037 202a 2061 6363  ep_tpc + 7 * acc
+000195b0: 6964 656e 7461 6c73 0a0a 0a40 6675 6e63  identals...@func
+000195c0: 7469 6f6e 5f6c 6f67 6765 720a 6465 6620  tion_logger.def 
+000195d0: 6e61 6d65 3270 6328 6e6e 293a 0a20 2020  name2pc(nn):.   
+000195e0: 2022 2222 2054 7572 6e20 6120 6e6f 7465   """ Turn a note
+000195f0: 206e 616d 6520 7375 6368 2061 7320 6041   name such as `A
+00019600: 6260 2069 6e74 6f20 6120 746f 6e61 6c20  b` into a tonal 
+00019610: 7069 7463 6820 636c 6173 732c 2073 7563  pitch class, suc
+00019620: 6820 7468 6174 202d 313d 462c 2030 3d43  h that -1=F, 0=C
+00019630: 2c20 313d 4720 6574 632e 0a20 2020 2020  , 1=G etc..     
+00019640: 2020 2055 7365 733a 2073 706c 6974 5f6e     Uses: split_n
+00019650: 6f74 655f 6e61 6d65 2829 0a20 2020 2022  ote_name().    "
+00019660: 2222 0a20 2020 2069 6620 6e6e 2e5f 5f63  "".    if nn.__c
+00019670: 6c61 7373 5f5f 203d 3d20 696e 7420 6f72  lass__ == int or
+00019680: 2070 642e 6973 6e75 6c6c 286e 6e29 3a0a   pd.isnull(nn):.
+00019690: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+000196a0: 6172 6e69 6e67 2866 2227 7b6e 6e7d 2720  arning(f"'{nn}' 
+000196b0: 6973 206e 6f74 2061 2076 616c 6964 206e  is not a valid n
+000196c0: 6f74 6520 6e61 6d65 2e22 290a 2020 2020  ote name.").    
+000196d0: 2020 2020 7265 7475 726e 206e 6e0a 2020      return nn.  
+000196e0: 2020 6e61 6d65 5f74 7063 7320 3d20 7b27    name_tpcs = {'
+000196f0: 4327 3a20 302c 2027 4427 3a20 322c 2027  C': 0, 'D': 2, '
+00019700: 4527 3a20 342c 2027 4627 3a20 352c 2027  E': 4, 'F': 5, '
+00019710: 4727 3a20 372c 2027 4127 3a20 392c 2027  G': 7, 'A': 9, '
+00019720: 4227 3a20 3131 7d0a 2020 2020 6163 6369  B': 11}.    acci
+00019730: 6465 6e74 616c 732c 206e 6f74 655f 6e61  dentals, note_na
+00019740: 6d65 203d 2073 706c 6974 5f6e 6f74 655f  me = split_note_
+00019750: 6e61 6d65 286e 6e2c 2063 6f75 6e74 3d54  name(nn, count=T
+00019760: 7275 652c 206c 6f67 6765 723d 6c6f 6767  rue, logger=logg
+00019770: 6572 290a 2020 2020 6966 206e 6f74 655f  er).    if note_
+00019780: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
+00019790: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+000197a0: 650a 2020 2020 7374 6570 5f70 6320 3d20  e.    step_pc = 
+000197b0: 6e61 6d65 5f74 7063 735b 6e6f 7465 5f6e  name_tpcs[note_n
+000197c0: 616d 652e 7570 7065 7228 295d 0a20 2020  ame.upper()].   
+000197d0: 2072 6574 7572 6e20 2873 7465 705f 7063   return (step_pc
+000197e0: 202b 2061 6363 6964 656e 7461 6c73 2920   + accidentals) 
+000197f0: 2520 3132 0a0a 0a64 6566 206e 616e 5f65  % 12...def nan_e
+00019800: 7128 612c 2062 293a 0a20 2020 2022 2222  q(a, b):.    """
+00019810: 5265 7475 726e 7320 5472 7565 2069 6620  Returns True if 
+00019820: 6120 616e 6420 6220 6172 6520 6571 7561  a and b are equa
+00019830: 6c20 6f72 2062 6f74 6820 6e75 6c6c 2e20  l or both null. 
+00019840: 576f 726b 7320 6f6e 2074 776f 2053 6572  Works on two Ser
+00019850: 6965 7320 6f72 2074 776f 2065 6c65 6d65  ies or two eleme
+00019860: 6e74 732e 2222 220a 2020 2020 7265 7475  nts.""".    retu
+00019870: 726e 2028 6120 3d3d 2062 2920 7c20 2870  rn (a == b) | (p
+00019880: 642e 6973 6e75 6c6c 2861 2920 2620 7064  d.isnull(a) & pd
+00019890: 2e69 736e 756c 6c28 6229 290a 0a0a 4066  .isnull(b))...@f
+000198a0: 756e 6374 696f 6e5f 6c6f 6767 6572 0a64  unction_logger.d
+000198b0: 6566 206e 6578 7432 7365 7175 656e 6365  ef next2sequence
+000198c0: 286e 6578 745f 636f 6c3a 2070 642e 5365  (next_col: pd.Se
+000198d0: 7269 6573 2920 2d3e 204f 7074 696f 6e61  ries) -> Optiona
+000198e0: 6c5b 4c69 7374 5b69 6e74 5d5d 3a0a 2020  l[List[int]]:.  
+000198f0: 2020 2222 2220 5475 726e 7320 6120 276e    """ Turns a 'n
+00019900: 6578 7427 2063 6f6c 756d 6e20 696e 746f  ext' column into
+00019910: 2074 6865 2063 6f72 7265 6374 2073 6571   the correct seq
+00019920: 7565 6e63 6520 6f66 204d 4373 2063 6f72  uence of MCs cor
+00019930: 7265 7370 6f6e 6469 6e67 2074 6f20 756e  responding to un
+00019940: 666f 6c64 6564 2072 6570 6574 6974 696f  folded repetitio
+00019950: 6e73 2e0a 2020 2020 5265 7175 6972 6573  ns..    Requires
+00019960: 2074 6861 7420 7468 6520 5365 7269 6573   that the Series
+00019970: 2720 696e 6465 7820 6265 2074 6865 204d  ' index be the M
+00019980: 4373 2061 7320 696e 2060 606d 6561 7375  Cs as in ``measu
+00019990: 7265 732e 7365 745f 696e 6465 7828 276d  res.set_index('m
+000199a0: 6327 292e 6e65 7874 6060 2e0a 2020 2020  c').next``..    
+000199b0: 2222 220a 2020 2020 6d63 203d 206e 6578  """.    mc = nex
+000199c0: 745f 636f 6c2e 696e 6465 785b 305d 0a20  t_col.index[0]. 
+000199d0: 2020 206c 6173 745f 6d63 203d 206e 6578     last_mc = nex
+000199e0: 745f 636f 6c2e 696e 6465 785b 2d31 5d0a  t_col.index[-1].
+000199f0: 2020 2020 6d61 785f 6974 6572 203d 2031      max_iter = 1
+00019a00: 3020 2a20 6c61 7374 5f6d 630a 2020 2020  0 * last_mc.    
+00019a10: 6920 3d20 300a 2020 2020 7265 7375 6c74  i = 0.    result
+00019a20: 203d 205b 5d0a 2020 2020 6e78 7420 3d20   = [].    nxt = 
+00019a30: 6e65 7874 5f63 6f6c 2e74 6f5f 6469 6374  next_col.to_dict
+00019a40: 2829 0a20 2020 2077 6869 6c65 206d 6320  ().    while mc 
+00019a50: 213d 202d 3120 616e 6420 6920 3c20 6d61  != -1 and i < ma
+00019a60: 785f 6974 6572 3a0a 2020 2020 2020 2020  x_iter:.        
+00019a70: 6966 206d 6320 6e6f 7420 696e 206e 7874  if mc not in nxt
+00019a80: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00019a90: 6767 6572 2e65 7272 6f72 2866 2243 6f6c  gger.error(f"Col
+00019aa0: 756d 6e20 276e 6578 7427 2063 6f6e 7461  umn 'next' conta
+00019ab0: 696e 7320 4d43 207b 6d63 7d20 7768 6963  ins MC {mc} whic
+00019ac0: 6820 7468 6520 7069 6563 6573 2064 6f65  h the pieces doe
+00019ad0: 7320 6e6f 7420 6861 7665 2e22 2c0a 2020  s not have.",.  
+00019ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019af0: 2020 2020 2065 7874 7261 3d7b 276d 6573       extra={'mes
+00019b00: 7361 6765 5f69 6427 3a20 2832 362c 2029  sage_id': (26, )
+00019b10: 7d29 0a20 2020 2020 2020 2020 2020 2072  }).            r
+00019b20: 6574 7572 6e0a 2020 2020 2020 2020 7265  eturn.        re
+00019b30: 7375 6c74 2e61 7070 656e 6428 6d63 290a  sult.append(mc).
+00019b40: 2020 2020 2020 2020 6e65 775f 6d63 2c20          new_mc, 
+00019b50: 2a72 6573 7420 3d20 6e78 745b 6d63 5d0a  *rest = nxt[mc].
+00019b60: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
+00019b70: 6573 7429 203e 2030 3a0a 2020 2020 2020  est) > 0:.      
+00019b80: 2020 2020 2020 6e78 745b 6d63 5d20 3d20        nxt[mc] = 
+00019b90: 7265 7374 0a20 2020 2020 2020 206d 6320  rest.        mc 
+00019ba0: 3d20 6e65 775f 6d63 0a20 2020 2020 2020  = new_mc.       
+00019bb0: 2069 202b 3d20 310a 2020 2020 6966 2069   i += 1.    if i
+00019bc0: 203d 3d20 6d61 785f 6974 6572 3a0a 2020   == max_iter:.  
+00019bd0: 2020 2020 2020 7265 7475 726e 205b 5d0a        return [].
+00019be0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+00019bf0: 740a 0a0a 4066 756e 6374 696f 6e5f 6c6f  t...@function_lo
+00019c00: 6767 6572 0a64 6566 206e 6f5f 636f 6c6c  gger.def no_coll
+00019c10: 6563 7469 6f6e 735f 6e6f 5f62 6f6f 6c65  ections_no_boole
+00019c20: 616e 7328 6466 2c20 636f 6c6c 5f63 6f6c  ans(df, coll_col
+00019c30: 756d 6e73 3d4e 6f6e 652c 2062 6f6f 6c5f  umns=None, bool_
+00019c40: 636f 6c75 6d6e 733d 4e6f 6e65 293a 0a20  columns=None):. 
+00019c50: 2020 2022 2222 0a20 2020 2043 6c65 616e     """.    Clean
+00019c60: 7320 7468 6520 4461 7461 4672 616d 6520  s the DataFrame 
+00019c70: 636f 6c75 6d6e 7320 5b27 6e65 7874 272c  columns ['next',
+00019c80: 2027 6368 6f72 645f 746f 6e65 7327 2c20   'chord_tones', 
+00019c90: 2761 6464 6564 5f74 6f6e 6573 272c 2027  'added_tones', '
+00019ca0: 766f 6c74 615f 6d63 735d 2066 726f 6d20  volta_mcs] from 
+00019cb0: 7475 706c 6573 2061 6e64 2074 6865 2063  tuples and the c
+00019cc0: 6f6c 756d 6e73 0a20 2020 205b 2767 6c6f  olumns.    ['glo
+00019cd0: 6261 6c6b 6579 5f69 735f 6d69 6e6f 7227  balkey_is_minor'
+00019ce0: 2c20 276c 6f63 616c 6b65 795f 6973 5f6d  , 'localkey_is_m
+00019cf0: 696e 6f72 275d 2066 726f 6d20 626f 6f6c  inor'] from bool
+00019d00: 6561 6e73 2c20 636f 6e76 6572 7469 6e67  eans, converting
+00019d10: 2074 6865 6d20 616c 6c20 746f 2069 6e74   them all to int
+00019d20: 6567 6572 730a 0a20 2020 2022 2222 0a20  egers..    """. 
+00019d30: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+00019d40: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00019d50: 2064 660a 2020 2020 636f 6c6c 6563 7469   df.    collecti
+00019d60: 6f6e 5f63 6f6c 7320 3d20 5b27 6e65 7874  on_cols = ['next
+00019d70: 272c 2027 6368 6f72 645f 746f 6e65 7327  ', 'chord_tones'
+00019d80: 2c20 2761 6464 6564 5f74 6f6e 6573 272c  , 'added_tones',
+00019d90: 2027 766f 6c74 615f 6d63 7327 5d0a 2020   'volta_mcs'].  
+00019da0: 2020 626f 6f6c 5f63 6f6c 7320 3d20 5b27    bool_cols = ['
+00019db0: 676c 6f62 616c 6b65 795f 6973 5f6d 696e  globalkey_is_min
+00019dc0: 6f72 272c 2027 6c6f 6361 6c6b 6579 5f69  or', 'localkey_i
+00019dd0: 735f 6d69 6e6f 7227 2c20 2768 6173 5f64  s_minor', 'has_d
+00019de0: 7275 6d73 6574 275d 0a20 2020 2069 6620  rumset'].    if 
+00019df0: 636f 6c6c 5f63 6f6c 756d 6e73 2069 7320  coll_columns is 
+00019e00: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00019e10: 2020 636f 6c6c 6563 7469 6f6e 5f63 6f6c    collection_col
+00019e20: 7320 2b3d 206c 6973 7428 636f 6c6c 5f63  s += list(coll_c
+00019e30: 6f6c 756d 6e73 290a 2020 2020 6966 2062  olumns).    if b
+00019e40: 6f6f 6c5f 636f 6c75 6d6e 7320 6973 206e  ool_columns is n
+00019e50: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00019e60: 2062 6f6f 6c5f 636f 6c73 202b 3d20 6c69   bool_cols += li
+00019e70: 7374 2862 6f6f 6c5f 636f 6c75 6d6e 7329  st(bool_columns)
+00019e80: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+00019e90: 2020 6363 203d 205b 6320 666f 7220 6320    cc = [c for c 
+00019ea0: 696e 2063 6f6c 6c65 6374 696f 6e5f 636f  in collection_co
+00019eb0: 6c73 2069 6620 6320 696e 2064 662e 636f  ls if c in df.co
+00019ec0: 6c75 6d6e 735d 0a20 2020 2065 7863 6570  lumns].    excep
+00019ed0: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
+00019ee0: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
+00019ef0: 7228 6622 6466 206e 6565 6473 2074 6f20  r(f"df needs to 
+00019f00: 6265 2061 2044 6174 6146 7261 6d65 2c20  be a DataFrame, 
+00019f10: 6e6f 7420 6120 7b64 662e 5f5f 636c 6173  not a {df.__clas
+00019f20: 735f 5f7d 2e22 290a 2020 2020 2020 2020  s__}.").        
+00019f30: 7265 7475 726e 2064 660a 2020 2020 6466  return df.    df
+00019f40: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
+00019f50: 2066 6f72 2063 2069 6e20 6363 3a0a 2020   for c in cc:.  
+00019f60: 2020 2020 2020 6e75 6c6c 5f76 616c 7320        null_vals 
+00019f70: 3d20 6466 5b63 5d2e 6973 6e61 2829 0a20  = df[c].isna(). 
+00019f80: 2020 2020 2020 2069 6620 6e75 6c6c 5f76         if null_v
+00019f90: 616c 732e 616c 6c28 293a 0a20 2020 2020  als.all():.     
+00019fa0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00019fb0: 2020 2020 2020 2020 6466 2e6c 6f63 5b6e          df.loc[n
+00019fc0: 756c 6c5f 7661 6c73 2c20 635d 203d 2070  ull_vals, c] = p
+00019fd0: 642e 4e41 0a20 2020 2020 2020 2077 6974  d.NA.        wit
+00019fe0: 6820 7761 726e 696e 6773 2e63 6174 6368  h warnings.catch
+00019ff0: 5f77 6172 6e69 6e67 7328 293a 0a20 2020  _warnings():.   
+0001a000: 2020 2020 2020 2020 2023 2053 6574 7469           # Setti
+0001a010: 6e67 2076 616c 7565 7320 696e 2d70 6c61  ng values in-pla
+0001a020: 6365 2069 7320 6669 6e65 2c20 6967 6e6f  ce is fine, igno
+0001a030: 7265 2074 6865 2077 6172 6e69 6e67 2069  re the warning i
+0001a040: 6e20 5061 6e64 6173 203e 3d20 312e 352e  n Pandas >= 1.5.
+0001a050: 300a 2020 2020 2020 2020 2020 2020 2320  0.            # 
+0001a060: 5468 6973 2063 616e 2062 6520 7265 6d6f  This can be remo
+0001a070: 7665 642c 2069 6620 5061 6e64 6173 2031  ved, if Pandas 1
+0001a080: 2e35 2e30 2064 6f65 7320 6e6f 7420 6e65  .5.0 does not ne
+0001a090: 6564 2074 6f20 6265 2073 7570 706f 7274  ed to be support
+0001a0a0: 6564 2061 6e79 206c 6f6e 6765 722e 0a20  ed any longer.. 
+0001a0b0: 2020 2020 2020 2020 2020 2023 2053 6565             # See
+0001a0c0: 2061 6c73 6f3a 2068 7474 7073 3a2f 2f73   also: https://s
+0001a0d0: 7461 636b 6f76 6572 666c 6f77 2e63 6f6d  tackoverflow.com
+0001a0e0: 2f71 2f37 3430 3537 3336 372f 3835 3935  /q/74057367/8595
+0001a0f0: 3931 0a20 2020 2020 2020 2020 2020 2077  91.            w
+0001a100: 6172 6e69 6e67 732e 6669 6c74 6572 7761  arnings.filterwa
+0001a110: 726e 696e 6773 280a 2020 2020 2020 2020  rnings(.        
+0001a120: 2020 2020 2020 2020 2269 676e 6f72 6522          "ignore"
+0001a130: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001a140: 2020 6361 7465 676f 7279 3d46 7574 7572    category=Futur
+0001a150: 6557 6172 6e69 6e67 2c0a 2020 2020 2020  eWarning,.      
+0001a160: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
+0001a170: 653d 280a 2020 2020 2020 2020 2020 2020  e=(.            
+0001a180: 2020 2020 2020 2020 222e 2a77 696c 6c20          ".*will 
+0001a190: 6174 7465 6d70 7420 746f 2073 6574 2074  attempt to set t
+0001a1a0: 6865 2076 616c 7565 7320 696e 706c 6163  he values inplac
+0001a1b0: 6520 696e 7374 6561 6420 6f66 2061 6c77  e instead of alw
+0001a1c0: 6179 7320 7365 7474 696e 6720 6120 6e65  ays setting a ne
+0001a1d0: 7720 6172 7261 792e 2022 0a20 2020 2020  w array. ".     
+0001a1e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001a1f0: 546f 2072 6574 6169 6e20 7468 6520 6f6c  To retain the ol
+0001a200: 6420 6265 6861 7669 6f72 2c20 7573 6520  d behavior, use 
+0001a210: 6569 7468 6572 2e2a 220a 2020 2020 2020  either.*".      
+0001a220: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+0001a230: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001a240: 2020 2020 2020 2064 662e 6c6f 635b 3a2c         df.loc[:,
+0001a250: 2063 5d20 3d20 7472 616e 7366 6f72 6d28   c] = transform(
+0001a260: 6466 5b63 5d2c 2069 7465 7261 626c 6532  df[c], iterable2
+0001a270: 7374 7229 0a20 2020 2020 2020 206c 6f67  str).        log
+0001a280: 6765 722e 6465 6275 6728 6622 5472 616e  ger.debug(f"Tran
+0001a290: 7366 6f72 6d65 6420 6974 6572 6162 6c65  sformed iterable
+0001a2a0: 7320 696e 2074 6865 2063 6f6c 756d 6e20  s in the column 
+0001a2b0: 7b63 7d20 746f 2073 7472 696e 6773 2e22  {c} to strings."
+0001a2c0: 290a 2020 2020 2364 662e 6c6f 635b 3a2c  ).    #df.loc[:,
+0001a2d0: 2063 635d 203d 2074 7261 6e73 666f 726d   cc] = transform
+0001a2e0: 2864 665b 6363 5d2c 2069 7465 7261 626c  (df[cc], iterabl
+0001a2f0: 6532 7374 722c 2063 6f6c 756d 6e5f 7769  e2str, column_wi
+0001a300: 7365 3d54 7275 6529 0a20 2020 2062 6f6f  se=True).    boo
+0001a310: 6c65 616e 5f63 6f6c 756d 6e73 203d 205b  lean_columns = [
+0001a320: 6320 666f 7220 6320 696e 2062 6f6f 6c5f  c for c in bool_
+0001a330: 636f 6c73 2069 6620 6320 696e 2064 662e  cols if c in df.
+0001a340: 636f 6c75 6d6e 735d 0a20 2020 2066 6f72  columns].    for
+0001a350: 2062 6320 696e 2062 6f6f 6c65 616e 5f63   bc in boolean_c
+0001a360: 6f6c 756d 6e73 3a0a 2020 2020 2020 2020  olumns:.        
+0001a370: 6e75 6c6c 5f76 616c 7320 3d20 6466 5b62  null_vals = df[b
+0001a380: 635d 2e69 736e 6128 290a 2020 2020 2020  c].isna().      
+0001a390: 2020 6966 206e 756c 6c5f 7661 6c73 2e61    if null_vals.a
+0001a3a0: 6c6c 2829 3a0a 2020 2020 2020 2020 2020  ll():.          
+0001a3b0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+0001a3c0: 2020 2077 6974 6820 7761 726e 696e 6773     with warnings
+0001a3d0: 2e63 6174 6368 5f77 6172 6e69 6e67 7328  .catch_warnings(
+0001a3e0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+0001a3f0: 2053 6574 7469 6e67 2076 616c 7565 7320   Setting values 
+0001a400: 696e 2d70 6c61 6365 2069 7320 6669 6e65  in-place is fine
+0001a410: 2c20 6967 6e6f 7265 2074 6865 2077 6172  , ignore the war
+0001a420: 6e69 6e67 2069 6e20 5061 6e64 6173 203e  ning in Pandas >
+0001a430: 3d20 312e 352e 300a 2020 2020 2020 2020  = 1.5.0.        
+0001a440: 2020 2020 2320 5468 6973 2063 616e 2062      # This can b
+0001a450: 6520 7265 6d6f 7665 642c 2069 6620 5061  e removed, if Pa
+0001a460: 6e64 6173 2031 2e35 2e30 2064 6f65 7320  ndas 1.5.0 does 
+0001a470: 6e6f 7420 6e65 6564 2074 6f20 6265 2073  not need to be s
+0001a480: 7570 706f 7274 6564 2061 6e79 206c 6f6e  upported any lon
+0001a490: 6765 722e 0a20 2020 2020 2020 2020 2020  ger..           
+0001a4a0: 2023 2053 6565 2061 6c73 6f3a 2068 7474   # See also: htt
+0001a4b0: 7073 3a2f 2f73 7461 636b 6f76 6572 666c  ps://stackoverfl
+0001a4c0: 6f77 2e63 6f6d 2f71 2f37 3430 3537 3336  ow.com/q/7405736
+0001a4d0: 372f 3835 3935 3931 0a20 2020 2020 2020  7/859591.       
+0001a4e0: 2020 2020 2077 6172 6e69 6e67 732e 6669       warnings.fi
+0001a4f0: 6c74 6572 7761 726e 696e 6773 280a 2020  lterwarnings(.  
+0001a500: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+0001a510: 676e 6f72 6522 2c0a 2020 2020 2020 2020  gnore",.        
+0001a520: 2020 2020 2020 2020 6361 7465 676f 7279          category
+0001a530: 3d46 7574 7572 6557 6172 6e69 6e67 2c0a  =FutureWarning,.
+0001a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a550: 6d65 7373 6167 653d 280a 2020 2020 2020  message=(.      
+0001a560: 2020 2020 2020 2020 2020 2020 2020 222e                ".
+0001a570: 2a77 696c 6c20 6174 7465 6d70 7420 746f  *will attempt to
+0001a580: 2073 6574 2074 6865 2076 616c 7565 7320   set the values 
+0001a590: 696e 706c 6163 6520 696e 7374 6561 6420  inplace instead 
+0001a5a0: 6f66 2061 6c77 6179 7320 7365 7474 696e  of always settin
+0001a5b0: 6720 6120 6e65 7720 6172 7261 792e 2022  g a new array. "
+0001a5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a5d0: 2020 2020 2022 546f 2072 6574 6169 6e20       "To retain 
+0001a5e0: 7468 6520 6f6c 6420 6265 6861 7669 6f72  the old behavior
+0001a5f0: 2c20 7573 6520 6569 7468 6572 2e2a 220a  , use either.*".
+0001a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a610: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+0001a620: 0a20 2020 2020 2020 2020 2020 2064 662e  .            df.
+0001a630: 6c6f 635b 3a2c 2062 635d 203d 2064 665b  loc[:, bc] = df[
+0001a640: 6263 5d2e 6173 7479 7065 2827 626f 6f6c  bc].astype('bool
+0001a650: 6561 6e27 292e 6173 7479 7065 2827 496e  ean').astype('In
+0001a660: 7436 3427 290a 2020 2020 2020 2020 6c6f  t64').        lo
+0001a670: 6767 6572 2e64 6562 7567 2866 2254 7261  gger.debug(f"Tra
+0001a680: 6e73 666f 726d 6564 2062 6f6f 6c65 616e  nsformed boolean
+0001a690: 7320 696e 2074 6865 2063 6f6c 756d 6e20  s in the column 
+0001a6a0: 7b62 637d 2074 6f20 696e 7465 6765 7273  {bc} to integers
+0001a6b0: 2e22 290a 2020 2020 7265 7475 726e 2064  .").    return d
+0001a6c0: 660a 0a0a 6465 6620 6f72 6469 6e61 6c5f  f...def ordinal_
+0001a6d0: 7375 6666 6978 286e 293a 0a20 2020 2073  suffix(n):.    s
+0001a6e0: 7566 6669 7865 7320 3d20 7b0a 2020 2020  uffixes = {.    
+0001a6f0: 2020 2020 2231 223a 2027 7374 272c 0a20      "1": 'st',. 
+0001a700: 2020 2020 2020 2022 3222 3a20 276e 6427         "2": 'nd'
+0001a710: 2c0a 2020 2020 2020 2020 2233 223a 2027  ,.        "3": '
+0001a720: 7264 270a 2020 2020 7d0a 2020 2020 6c61  rd'.    }.    la
+0001a730: 7374 5f64 6967 6974 203d 2073 7472 286e  st_digit = str(n
+0001a740: 295b 2d31 5d0a 2020 2020 7265 7475 726e  )[-1].    return
+0001a750: 2073 7566 6669 7865 732e 6765 7428 6c61   suffixes.get(la
+0001a760: 7374 5f64 6967 6974 2c20 2774 6827 290a  st_digit, 'th').
+0001a770: 0a0a 6465 6620 7061 7274 735f 696e 666f  ..def parts_info
+0001a780: 2864 293a 0a20 2020 2022 2222 0a20 2020  (d):.    """.   
+0001a790: 2054 7572 6e73 2061 2028 6e65 7374 6564   Turns a (nested
+0001a7a0: 2920 6060 6d65 7461 6461 7461 5b27 7061  ) ``metadata['pa
+0001a7b0: 7274 7327 5d60 6020 6469 6374 2069 6e74  rts']`` dict int
+0001a7c0: 6f20 6120 666c 6174 2064 6963 7420 6261  o a flat dict ba
+0001a7d0: 7365 6420 6f6e 2073 7461 7665 732e 0a0a  sed on staves...
+0001a7e0: 2020 2020 4578 616d 706c 650a 2020 2020      Example.    
+0001a7f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+0001a800: 6420 3d20 732e 6d73 6378 2e6d 6574 6164  d = s.mscx.metad
+0001a810: 6174 615f 6672 6f6d 5f70 6172 7365 640a  ata_from_parsed.
+0001a820: 2020 2020 3e3e 3e20 7061 7274 735f 696e      >>> parts_in
+0001a830: 666f 2864 5b27 7061 7274 7327 5d29 0a20  fo(d['parts']). 
+0001a840: 2020 207b 2773 7461 6666 5f31 5f69 6e73     {'staff_1_ins
+0001a850: 7472 756d 656e 7427 3a20 2756 6f69 6365  trument': 'Voice
+0001a860: 272c 0a20 2020 2020 2773 7461 6666 5f31  ',.     'staff_1
+0001a870: 5f61 6d62 6974 7573 273a 2027 3636 2d37  _ambitus': '66-7
+0001a880: 3620 2846 2334 2d45 3529 272c 0a20 2020  6 (F#4-E5)',.   
+0001a890: 2020 2773 7461 6666 5f32 5f69 6e73 7472    'staff_2_instr
+0001a8a0: 756d 656e 7427 3a20 2756 6f69 6365 272c  ument': 'Voice',
+0001a8b0: 0a20 2020 2020 2773 7461 6666 5f32 5f61  .     'staff_2_a
+0001a8c0: 6d62 6974 7573 273a 2027 3535 2d36 3920  mbitus': '55-69 
+0001a8d0: 2847 332d 4134 2927 2c0a 2020 2020 2027  (G3-A4)',.     '
+0001a8e0: 7374 6166 665f 335f 696e 7374 7275 6d65  staff_3_instrume
+0001a8f0: 6e74 273a 2027 566f 6963 6527 2c0a 2020  nt': 'Voice',.  
+0001a900: 2020 2027 7374 6166 665f 335f 616d 6269     'staff_3_ambi
+0001a910: 7475 7327 3a20 2734 382d 3637 2028 4333  tus': '48-67 (C3
+0001a920: 2d47 3429 272c 0a20 2020 2020 2773 7461  -G4)',.     'sta
+0001a930: 6666 5f34 5f69 6e73 7472 756d 656e 7427  ff_4_instrument'
+0001a940: 3a20 2756 6f69 6365 272c 0a20 2020 2020  : 'Voice',.     
+0001a950: 2773 7461 6666 5f34 5f61 6d62 6974 7573  'staff_4_ambitus
+0001a960: 273a 2027 3431 2d36 3020 2846 322d 4334  ': '41-60 (F2-C4
+0001a970: 2927 7d0a 2020 2020 2222 220a 2020 2020  )'}.    """.    
+0001a980: 7265 7320 3d20 7b7d 0a20 2020 2066 6f72  res = {}.    for
+0001a990: 2070 6172 745f 6469 6374 2069 6e20 642e   part_dict in d.
+0001a9a0: 7661 6c75 6573 2829 3a0a 2020 2020 2020  values():.      
+0001a9b0: 2020 666f 7220 6964 2069 6e20 7061 7274    for id in part
+0001a9c0: 5f64 6963 745b 2773 7461 7665 7327 5d3a  _dict['staves']:
+0001a9d0: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
+0001a9e0: 6520 3d20 6622 7374 6166 665f 7b69 647d  e = f"staff_{id}
+0001a9f0: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
+0001aa00: 735b 6622 7b6e 616d 657d 5f69 6e73 7472  s[f"{name}_instr
+0001aa10: 756d 656e 7422 5d20 3d20 7061 7274 5f64  ument"] = part_d
+0001aa20: 6963 745b 2769 6e73 7472 756d 656e 7427  ict['instrument'
+0001aa30: 5d0a 2020 2020 2020 2020 2020 2020 616d  ].            am
+0001aa40: 625f 6e61 6d65 203d 206e 616d 6520 2b20  b_name = name + 
+0001aa50: 275f 616d 6269 7475 7327 0a20 2020 2020  '_ambitus'.     
+0001aa60: 2020 2020 2020 2072 6573 5b61 6d62 5f6e         res[amb_n
+0001aa70: 616d 655d 203d 2061 6d62 6974 7573 326f  ame] = ambitus2o
+0001aa80: 6e65 6c69 6e65 7228 7061 7274 5f64 6963  neliner(part_dic
+0001aa90: 745b 616d 625f 6e61 6d65 5d29 0a20 2020  t[amb_name]).   
+0001aaa0: 2072 6574 7572 6e20 7265 730a 0a0a 4066   return res...@f
+0001aab0: 756e 6374 696f 6e5f 6c6f 6767 6572 0a64  unction_logger.d
+0001aac0: 6566 2070 6174 6832 7479 7065 2870 6174  ef path2type(pat
+0001aad0: 6829 3a0a 2020 2020 2222 2220 4465 7465  h):.    """ Dete
+0001aae0: 726d 696e 6520 6120 6669 6c65 2773 2074  rmine a file's t
+0001aaf0: 7970 6520 6279 2073 6361 6e6e 696e 6720  ype by scanning 
+0001ab00: 6974 7320 7061 7468 2066 6f72 2064 6566  its path for def
+0001ab10: 6175 6c74 2063 6f6d 706f 6e65 6e74 7320  ault components 
+0001ab20: 696e 2074 6865 2063 6f6e 7374 616e 7420  in the constant 
+0001ab30: 5354 414e 4441 5244 5f4e 414d 4553 2e0a  STANDARD_NAMES..
+0001ab40: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+0001ab50: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+0001ab60: 2020 2070 6174 680a 0a20 2020 2052 6574     path..    Ret
+0001ab70: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+0001ab80: 0a0a 2020 2020 2222 220a 2020 2020 5f2c  ..    """.    _,
+0001ab90: 2066 6578 7420 3d20 6f73 2e70 6174 682e   fext = os.path.
+0001aba0: 7370 6c69 7465 7874 2870 6174 6829 0a20  splitext(path). 
+0001abb0: 2020 2069 6620 6665 7874 2e6c 6f77 6572     if fext.lower
+0001abc0: 2829 2069 6e20 5343 4f52 455f 4558 5445  () in SCORE_EXTE
+0001abd0: 4e53 494f 4e53 3a0a 2020 2020 2020 2020  NSIONS:.        
+0001abe0: 6c6f 6767 6572 2e64 6562 7567 2866 2252  logger.debug(f"R
+0001abf0: 6563 6f67 6e69 7a65 6420 6669 6c65 2065  ecognized file e
+0001ac00: 7874 656e 7369 6f6e 2027 7b66 6578 747d  xtension '{fext}
+0001ac10: 2720 6173 2073 636f 7265 2e22 290a 2020  ' as score.").  
+0001ac20: 2020 2020 2020 7265 7475 726e 2027 7363        return 'sc
+0001ac30: 6f72 6573 270a 2020 2020 636f 6d70 6f6e  ores'.    compon
+0001ac40: 656e 7432 7479 7065 203d 2070 6174 685f  ent2type = path_
+0001ac50: 636f 6d70 6f6e 656e 7432 6669 6c65 5f74  component2file_t
+0001ac60: 7970 655f 6d61 7028 290a 2020 2020 6465  ype_map().    de
+0001ac70: 6620 6669 6e64 5f63 6f6d 706f 6e65 6e74  f find_component
+0001ac80: 7328 7329 3a0a 2020 2020 2020 2020 7265  s(s):.        re
+0001ac90: 7320 3d20 5b63 6f6d 7020 666f 7220 636f  s = [comp for co
+0001aca0: 6d70 2069 6e20 636f 6d70 6f6e 656e 7432  mp in component2
+0001acb0: 7479 7065 2e6b 6579 7328 2920 6966 2063  type.keys() if c
+0001acc0: 6f6d 7020 696e 2073 5d0a 2020 2020 2020  omp in s].      
+0001acd0: 2020 7265 7475 726e 2072 6573 2c20 6c65    return res, le
+0001ace0: 6e28 7265 7329 0a20 2020 2069 6620 6f73  n(res).    if os
+0001acf0: 2e70 6174 682e 6973 6669 6c65 2870 6174  .path.isfile(pat
+0001ad00: 6829 3a0a 2020 2020 2020 2020 2320 6769  h):.        # gi
+0001ad10: 7665 2070 7265 6665 7265 6e63 6520 746f  ve preference to
+0001ad20: 2066 6f6c 6465 7220 6e61 6d65 7320 6265   folder names be
+0001ad30: 666f 7265 2066 696c 6520 6e61 6d65 730a  fore file names.
+0001ad40: 2020 2020 2020 2020 6469 7265 6374 6f72          director
+0001ad50: 792c 2066 6e61 6d65 203d 206f 732e 7061  y, fname = os.pa
+0001ad60: 7468 2e73 706c 6974 2870 6174 6829 0a20  th.split(path). 
+0001ad70: 2020 2020 2020 2069 6620 276d 6574 6164         if 'metad
+0001ad80: 6174 6127 2069 6e20 666e 616d 653a 0a20  ata' in fname:. 
+0001ad90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001ada0: 6e20 276d 6574 6164 6174 6127 0a20 2020  n 'metadata'.   
+0001adb0: 2020 2020 2066 6f75 6e64 5f63 6f6d 706f       found_compo
+0001adc0: 6e65 6e74 732c 206e 5f66 6f75 6e64 203d  nents, n_found =
+0001add0: 2066 696e 645f 636f 6d70 6f6e 656e 7473   find_components
+0001ade0: 2864 6972 6563 746f 7279 290a 2020 2020  (directory).    
+0001adf0: 2020 2020 6966 206e 5f66 6f75 6e64 203d      if n_found =
+0001ae00: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0001ae10: 2066 6f75 6e64 5f63 6f6d 706f 6e65 6e74   found_component
+0001ae20: 732c 206e 5f66 6f75 6e64 203d 2066 696e  s, n_found = fin
+0001ae30: 645f 636f 6d70 6f6e 656e 7473 2866 6e61  d_components(fna
+0001ae40: 6d65 290a 2020 2020 656c 7365 3a0a 2020  me).    else:.  
+0001ae50: 2020 2020 2020 666f 756e 645f 636f 6d70        found_comp
+0001ae60: 6f6e 656e 7473 2c20 6e5f 666f 756e 6420  onents, n_found 
+0001ae70: 3d20 6669 6e64 5f63 6f6d 706f 6e65 6e74  = find_component
+0001ae80: 7328 7061 7468 290a 2020 2020 6966 206e  s(path).    if n
+0001ae90: 5f66 6f75 6e64 203d 3d20 303a 0a20 2020  _found == 0:.   
+0001aea0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+0001aeb0: 6728 6622 5479 7065 2063 6f75 6c64 206e  g(f"Type could n
+0001aec0: 6f74 2062 6520 696e 6665 7272 6564 2066  ot be inferred f
+0001aed0: 726f 6d20 7061 7468 2027 7b70 6174 687d  rom path '{path}
+0001aee0: 272e 2229 0a20 2020 2020 2020 2072 6574  '.").        ret
+0001aef0: 7572 6e20 2775 6e6b 6e6f 776e 270a 2020  urn 'unknown'.  
+0001af00: 2020 6966 206e 5f66 6f75 6e64 203d 3d20    if n_found == 
+0001af10: 313a 0a20 2020 2020 2020 2074 7970 203d  1:.        typ =
+0001af20: 2063 6f6d 706f 6e65 6e74 3274 7970 655b   component2type[
+0001af30: 666f 756e 645f 636f 6d70 6f6e 656e 7473  found_components
+0001af40: 5b30 5d5d 0a20 2020 2020 2020 206c 6f67  [0]].        log
+0001af50: 6765 722e 6465 6275 6728 6622 5061 7468  ger.debug(f"Path
+0001af60: 2027 7b70 6174 687d 2720 7265 636f 676e   '{path}' recogn
+0001af70: 697a 6564 2061 7320 7b74 7970 7d2e 2229  ized as {typ}.")
+0001af80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001af90: 7479 700a 2020 2020 656c 7365 3a0a 2020  typ.    else:.  
+0001afa0: 2020 2020 2020 7368 6f72 7465 6e65 645f        shortened_
+0001afb0: 7061 7468 203d 2070 6174 680a 2020 2020  path = path.    
+0001afc0: 2020 2020 7768 696c 6520 6c65 6e28 7368      while len(sh
+0001afd0: 6f72 7465 6e65 645f 7061 7468 2920 3e20  ortened_path) > 
+0001afe0: 303a 0a20 2020 2020 2020 2020 2020 2073  0:.            s
+0001aff0: 686f 7274 656e 6564 5f70 6174 682c 2062  hortened_path, b
+0001b000: 6173 6520 3d20 6f73 2e70 6174 682e 7370  ase = os.path.sp
+0001b010: 6c69 7428 7368 6f72 7465 6e65 645f 7061  lit(shortened_pa
+0001b020: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+0001b030: 666f 7220 636f 6d70 2069 6e20 636f 6d70  for comp in comp
+0001b040: 6f6e 656e 7432 7479 7065 2e6b 6579 7328  onent2type.keys(
+0001b050: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001b060: 2020 2069 6620 636f 6d70 2069 6e20 6261     if comp in ba
+0001b070: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001b080: 2020 2020 2020 2020 7479 7020 3d20 636f          typ = co
+0001b090: 6d70 6f6e 656e 7432 7479 7065 5b63 6f6d  mponent2type[com
+0001b0a0: 705d 0a20 2020 2020 2020 2020 2020 2020  p].             
+0001b0b0: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+0001b0c0: 6275 6728 6622 4d75 6c74 6970 6c65 2063  bug(f"Multiple c
+0001b0d0: 6f6d 706f 6e65 6e74 7320 287b 272c 2027  omponents ({', '
+0001b0e0: 2e6a 6f69 6e28 666f 756e 645f 636f 6d70  .join(found_comp
+0001b0f0: 6f6e 656e 7473 297d 2920 666f 756e 6420  onents)}) found 
+0001b100: 696e 2070 6174 6820 277b 7061 7468 7d27  in path '{path}'
+0001b110: 2e20 4368 6f73 6520 7468 6520 6c61 7374  . Chose the last
+0001b120: 206f 6e65 3a20 7b74 7970 7d22 290a 2020   one: {typ}").  
+0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b140: 2020 7265 7475 726e 2074 7970 0a20 2020    return typ.   
+0001b150: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
+0001b160: 696e 6728 6622 436f 6d70 6f6e 656e 7473  ing(f"Components
+0001b170: 207b 272c 2027 2e6a 6f69 6e28 666f 756e   {', '.join(foun
+0001b180: 645f 636f 6d70 6f6e 656e 7473 297d 2066  d_components)} f
+0001b190: 6f75 6e64 2069 6e20 7061 7468 2027 7b70  ound in path '{p
+0001b1a0: 6174 687d 272c 2062 7574 206e 6f74 2069  ath}', but not i
+0001b1b0: 6e20 6f6e 6520 6f66 2069 7473 2063 6f6e  n one of its con
+0001b1c0: 7374 6974 7565 6e74 732e 2229 0a20 2020  stituents.").   
+0001b1d0: 2020 2020 2072 6574 7572 6e20 276f 7468       return 'oth
+0001b1e0: 6572 270a 0a0a 406c 7275 5f63 6163 6865  er'...@lru_cache
+0001b1f0: 2829 0a64 6566 2070 6174 685f 636f 6d70  ().def path_comp
+0001b200: 6f6e 656e 7432 6669 6c65 5f74 7970 655f  onent2file_type_
+0001b210: 6d61 7028 2920 2d3e 2064 6963 743a 0a20  map() -> dict:. 
+0001b220: 2020 2063 6f6d 7032 7479 7065 203d 207b     comp2type = {
+0001b230: 636f 6d70 3a20 636f 6d70 2066 6f72 2063  comp: comp for c
+0001b240: 6f6d 7020 696e 2053 5441 4e44 4152 445f  omp in STANDARD_
+0001b250: 4e41 4d45 537d 0a20 2020 2063 6f6d 7032  NAMES}.    comp2
+0001b260: 7479 7065 5b27 4d53 3327 5d20 3d20 2773  type['MS3'] = 's
+0001b270: 636f 7265 7327 0a20 2020 2063 6f6d 7032  cores'.    comp2
+0001b280: 7479 7065 5b27 6861 726d 6f6e 6965 7327  type['harmonies'
+0001b290: 5d20 3d20 2765 7870 616e 6465 6427 0a20  ] = 'expanded'. 
+0001b2a0: 2020 2063 6f6d 7032 7479 7065 5b27 6f75     comp2type['ou
+0001b2b0: 7470 7574 275d 203d 2027 6c61 6265 6c73  tput'] = 'labels
+0001b2c0: 270a 2020 2020 636f 6d70 3274 7970 655b  '.    comp2type[
+0001b2d0: 2769 6e66 6572 275d 203d 2027 6c61 6265  'infer'] = 'labe
+0001b2e0: 6c73 270a 2020 2020 7265 7475 726e 2063  ls'.    return c
+0001b2f0: 6f6d 7032 7479 7065 0a0a 6465 6620 6669  omp2type..def fi
+0001b300: 6c65 5f74 7970 6532 7061 7468 5f63 6f6d  le_type2path_com
+0001b310: 706f 6e65 6e74 5f6d 6170 2829 202d 3e20  ponent_map() -> 
+0001b320: 6469 6374 3a0a 2020 2020 636f 6d70 3274  dict:.    comp2t
+0001b330: 7970 6520 3d20 7061 7468 5f63 6f6d 706f  ype = path_compo
+0001b340: 6e65 6e74 3266 696c 655f 7479 7065 5f6d  nent2file_type_m
+0001b350: 6170 2829 0a20 2020 2074 7970 6532 636f  ap().    type2co
+0001b360: 6d70 7320 3d20 6465 6661 756c 7464 6963  mps = defaultdic
+0001b370: 7428 6c69 7374 290a 2020 2020 666f 7220  t(list).    for 
+0001b380: 636f 6d70 2c20 7479 7020 696e 2063 6f6d  comp, typ in com
+0001b390: 7032 7479 7065 2e69 7465 6d73 2829 3a0a  p2type.items():.
+0001b3a0: 2020 2020 2020 2020 7479 7065 3263 6f6d          type2com
+0001b3b0: 7073 5b74 7970 5d2e 6170 7065 6e64 2863  ps[typ].append(c
+0001b3c0: 6f6d 7029 0a20 2020 2072 6574 7572 6e20  omp).    return 
+0001b3d0: 6469 6374 2874 7970 6532 636f 6d70 7329  dict(type2comps)
+0001b3e0: 0a0a 0a64 6566 2070 7265 7474 795f 6469  ...def pretty_di
+0001b3f0: 6374 2875 676c 795f 6469 6374 3a20 6469  ct(ugly_dict: di
+0001b400: 6374 2c20 6865 6164 696e 675f 6b65 793a  ct, heading_key:
+0001b410: 2073 7472 203d 204e 6f6e 652c 2068 6561   str = None, hea
+0001b420: 6469 6e67 5f76 616c 7565 3a20 7374 7220  ding_value: str 
+0001b430: 3d20 4e6f 6e65 2920 2d3e 2073 7472 3a0a  = None) -> str:.
+0001b440: 2020 2020 2222 2220 5475 726e 7320 6120      """ Turns a 
+0001b450: 6469 6374 696f 6e61 7279 2069 6e74 6f20  dictionary into 
+0001b460: 6120 7374 7269 6e67 2077 6865 7265 2074  a string where t
+0001b470: 6865 206b 6579 7320 6172 6520 7072 696e  he keys are prin
+0001b480: 7465 6420 696e 2061 2063 6f6c 756d 6e2c  ted in a column,
+0001b490: 2073 6570 6172 6174 6564 2062 7920 272d   separated by '-
+0001b4a0: 3e27 2e0a 2020 2020 2222 220a 2020 2020  >'..    """.    
+0001b4b0: 6966 2068 6561 6469 6e67 5f6b 6579 2069  if heading_key i
+0001b4c0: 7320 6e6f 7420 4e6f 6e65 206f 7220 6865  s not None or he
+0001b4d0: 6164 696e 675f 7661 6c75 6520 6973 206e  ading_value is n
+0001b4e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001b4f0: 2068 6561 645f 6b65 7920 3d20 274b 4559   head_key = 'KEY
+0001b500: 2720 6966 2068 6561 6469 6e67 5f6b 6579  ' if heading_key
+0001b510: 2069 7320 4e6f 6e65 2065 6c73 6520 6865   is None else he
+0001b520: 6164 696e 675f 6b65 790a 2020 2020 2020  ading_key.      
+0001b530: 2020 6865 6164 5f76 616c 203d 2027 2720    head_val = '' 
+0001b540: 6966 2068 6561 6469 6e67 5f76 616c 7565  if heading_value
+0001b550: 2069 7320 4e6f 6e65 2065 6c73 6520 6865   is None else he
+0001b560: 6164 696e 675f 7661 6c75 650a 2020 2020  ading_value.    
+0001b570: 2020 2020 6865 6164 5f76 616c 5f6c 656e      head_val_len
+0001b580: 6774 6820 3d20 6c65 6e28 6865 6164 5f76  gth = len(head_v
+0001b590: 616c 2920 2b20 340a 2020 2020 2020 2020  al) + 4.        
+0001b5a0: 6420 3d20 7b68 6561 645f 6b65 793a 2068  d = {head_key: h
+0001b5b0: 6561 645f 7661 6c7d 0a20 2020 2020 2020  ead_val}.       
+0001b5c0: 2064 2e75 7064 6174 6528 7567 6c79 5f64   d.update(ugly_d
+0001b5d0: 6963 7429 0a20 2020 2065 6c73 653a 0a20  ict).    else:. 
+0001b5e0: 2020 2020 2020 2068 6561 645f 7661 6c5f         head_val_
+0001b5f0: 6c65 6e67 7468 203d 202d 310a 2020 2020  length = -1.    
+0001b600: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001b610: 2020 2020 2064 203d 2064 6963 7428 7567       d = dict(ug
+0001b620: 6c79 5f64 6963 7429 0a20 2020 2020 2020  ly_dict).       
+0001b630: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+0001b640: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0001b650: 7072 696e 7428 6622 506c 6561 7365 2070  print(f"Please p
+0001b660: 6173 7320 6120 6469 6374 696f 6e61 7279  ass a dictionary
+0001b670: 2c20 6e6f 7420 6120 7b74 7970 6528 7567  , not a {type(ug
+0001b680: 6c79 5f64 6963 7429 7d3a 207b 7567 6c79  ly_dict)}: {ugly
+0001b690: 5f64 6963 747d 2229 0a20 2020 2020 2020  _dict}").       
+0001b6a0: 2020 2020 2072 6169 7365 0a20 2020 206c       raise.    l
+0001b6b0: 6566 7420 3d20 6d61 7828 6c65 6e28 7374  eft = max(len(st
+0001b6c0: 7228 6b29 2920 666f 7220 6b20 696e 2064  r(k)) for k in d
+0001b6d0: 2e6b 6579 7328 2929 0a20 2020 2072 6573  .keys()).    res
+0001b6e0: 203d 205b 5d0a 2020 2020 666f 7220 6b2c   = [].    for k,
+0001b6f0: 2076 2069 6e20 642e 6974 656d 7328 293a   v in d.items():
+0001b700: 0a20 2020 2020 2020 206b 7320 3d20 7374  .        ks = st
+0001b710: 7228 6b29 0a20 2020 2020 2020 2069 6620  r(k).        if 
+0001b720: 6973 696e 7374 616e 6365 2876 2c20 7064  isinstance(v, pd
+0001b730: 2e44 6174 6146 7261 6d65 2920 6f72 2069  .DataFrame) or i
+0001b740: 7369 6e73 7461 6e63 6528 762c 2070 642e  sinstance(v, pd.
+0001b750: 5365 7269 6573 293a 0a20 2020 2020 2020  Series):.       
+0001b760: 2020 2020 2076 7320 3d20 762e 746f 5f73       vs = v.to_s
+0001b770: 7472 696e 6728 290a 2020 2020 2020 2020  tring().        
+0001b780: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001b790: 2020 7673 203d 2073 7472 2876 290a 2020    vs = str(v).  
+0001b7a0: 2020 2020 2020 6966 2027 5c6e 2720 696e        if '\n' in
+0001b7b0: 2076 733a 0a20 2020 2020 2020 2020 2020   vs:.           
+0001b7c0: 206c 696e 6573 203d 2076 732e 7370 6c69   lines = vs.spli
+0001b7d0: 7428 275c 6e27 290a 2020 2020 2020 2020  t('\n').        
+0001b7e0: 2020 2020 7265 732e 6578 7465 6e64 285b      res.extend([
+0001b7f0: 6622 7b6b 7320 6966 2069 203d 3d20 3020  f"{ks if i == 0 
+0001b800: 656c 7365 2027 273a 7b6c 6566 747d 7d20  else '':{left}} 
+0001b810: 2d3e 207b 6c7d 2220 666f 7220 692c 206c  -> {l}" for i, l
+0001b820: 2069 6e20 656e 756d 6572 6174 6528 6c69   in enumerate(li
+0001b830: 6e65 7329 5d29 0a20 2020 2020 2020 2065  nes)]).        e
+0001b840: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001b850: 2072 6573 2e61 7070 656e 6428 6622 7b6b   res.append(f"{k
+0001b860: 733a 7b6c 6566 747d 7d20 2d3e 207b 7673  s:{left}} -> {vs
+0001b870: 7d22 290a 2020 2020 6966 2068 6561 645f  }").    if head_
+0001b880: 7661 6c5f 6c65 6e67 7468 203e 202d 313a  val_length > -1:
+0001b890: 0a20 2020 2020 2020 2072 6573 2e69 6e73  .        res.ins
+0001b8a0: 6572 7428 312c 2027 2d27 202a 2028 6c65  ert(1, '-' * (le
+0001b8b0: 6674 202b 2068 6561 645f 7661 6c5f 6c65  ft + head_val_le
+0001b8c0: 6e67 7468 2929 0a20 2020 2072 6574 7572  ngth)).    retur
+0001b8d0: 6e20 275c 6e27 2e6a 6f69 6e28 7265 7329  n '\n'.join(res)
+0001b8e0: 0a0a 0a0a 6465 6620 7265 736f 6c76 655f  ....def resolve_
+0001b8f0: 6469 7228 6429 3a0a 2020 2020 2222 2220  dir(d):.    """ 
+0001b900: 5265 736f 6c76 6573 2027 7e27 2074 6f20  Resolves '~' to 
+0001b910: 484f 4d45 2064 6972 6563 746f 7279 2061  HOME directory a
+0001b920: 6e64 2074 7572 6e73 2060 6064 6060 2069  nd turns ``d`` i
+0001b930: 6e74 6f20 616e 2061 6273 6f6c 7574 6520  nto an absolute 
+0001b940: 7061 7468 2e0a 2020 2020 2222 220a 2020  path..    """.  
+0001b950: 2020 6966 2064 2069 7320 4e6f 6e65 3a0a    if d is None:.
+0001b960: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0001b970: 6f6e 650a 2020 2020 6420 3d20 7374 7228  one.    d = str(
+0001b980: 6429 0a20 2020 2069 6620 277e 2720 696e  d).    if '~' in
+0001b990: 2064 3a0a 2020 2020 2020 2020 7265 7475   d:.        retu
+0001b9a0: 726e 206f 732e 7061 7468 2e65 7870 616e  rn os.path.expan
+0001b9b0: 6475 7365 7228 6429 0a20 2020 2072 6574  duser(d).    ret
+0001b9c0: 7572 6e20 6f73 2e70 6174 682e 6162 7370  urn os.path.absp
+0001b9d0: 6174 6828 6429 0a0a 0a64 6566 2072 6762  ath(d)...def rgb
+0001b9e0: 3266 6f72 6d61 7428 6466 2c20 666f 726d  2format(df, form
+0001b9f0: 6174 3d27 6874 6d6c 272c 2072 5f63 6f6c  at='html', r_col
+0001ba00: 3d27 636f 6c6f 725f 7227 2c20 675f 636f  ='color_r', g_co
+0001ba10: 6c3d 2763 6f6c 6f72 5f67 272c 2062 5f63  l='color_g', b_c
+0001ba20: 6f6c 3d27 636f 6c6f 725f 6227 293a 0a20  ol='color_b'):. 
+0001ba30: 2020 2022 2222 2043 6f6e 7665 7274 7320     """ Converts 
+0001ba40: 7468 7265 6520 5247 4220 636f 6c75 6d6e  three RGB column
+0001ba50: 7320 696e 746f 2061 2063 6f6c 6f72 5f68  s into a color_h
+0001ba60: 746d 6c20 6f72 2063 6f6c 6f72 5f6e 616d  tml or color_nam
+0001ba70: 6520 636f 6c75 6d6e 2e20 2222 220a 2020  e column. """.  
+0001ba80: 2020 636f 6c73 203d 205b 725f 636f 6c2c    cols = [r_col,
+0001ba90: 2067 5f63 6f6c 2c20 625f 636f 6c5d 0a20   g_col, b_col]. 
+0001baa0: 2020 2069 6620 666f 726d 6174 203d 3d20     if format == 
+0001bab0: 2768 746d 6c27 3a0a 2020 2020 2020 2020  'html':.        
+0001bac0: 6874 6d6c 203d 206c 6973 7428 6d61 7028  html = list(map(
+0001bad0: 7267 625f 7475 706c 6532 6874 6d6c 2c20  rgb_tuple2html, 
+0001bae0: 6466 5b63 6f6c 735d 2e69 7465 7274 7570  df[cols].itertup
+0001baf0: 6c65 7328 696e 6465 783d 4661 6c73 652c  les(index=False,
+0001bb00: 206e 616d 653d 4e6f 6e65 2929 290a 2020   name=None))).  
+0001bb10: 2020 2020 2020 7265 7475 726e 2070 642e        return pd.
+0001bb20: 5365 7269 6573 2868 746d 6c2c 2069 6e64  Series(html, ind
+0001bb30: 6578 3d64 662e 696e 6465 7829 2e72 656e  ex=df.index).ren
+0001bb40: 616d 6528 2763 6f6c 6f72 5f68 746d 6c27  ame('color_html'
+0001bb50: 290a 2020 2020 6966 2066 6f72 6d61 7420  ).    if format 
+0001bb60: 3d3d 2027 6e61 6d65 273a 0a20 2020 2020  == 'name':.     
+0001bb70: 2020 206e 616d 6573 203d 206c 6973 7428     names = list(
+0001bb80: 6d61 7028 7267 625f 7475 706c 6532 6e61  map(rgb_tuple2na
+0001bb90: 6d65 2c20 6466 5b63 6f6c 735d 2e69 7465  me, df[cols].ite
+0001bba0: 7274 7570 6c65 7328 696e 6465 783d 4661  rtuples(index=Fa
+0001bbb0: 6c73 652c 206e 616d 653d 4e6f 6e65 2929  lse, name=None))
+0001bbc0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001bbd0: 2070 642e 5365 7269 6573 286e 616d 6573   pd.Series(names
+0001bbe0: 2c20 696e 6465 783d 6466 2e69 6e64 6578  , index=df.index
+0001bbf0: 292e 7265 6e61 6d65 2827 636f 6c6f 725f  ).rename('color_
+0001bc00: 6e61 6d65 2729 0a0a 0a64 6566 2072 6762  name')...def rgb
+0001bc10: 5f74 7570 6c65 3266 6f72 6d61 7428 742c  _tuple2format(t,
+0001bc20: 2066 6f72 6d61 743d 2768 746d 6c27 293a   format='html'):
+0001bc30: 0a20 2020 2022 2222 2043 6f6e 7665 7274  .    """ Convert
+0001bc40: 7320 6120 7369 6e67 6c65 2052 4742 2074  s a single RGB t
+0001bc50: 7570 6c65 2069 6e74 6f20 2748 544d 4c27  uple into 'HTML'
+0001bc60: 206f 7220 276e 616d 6527 2e22 2222 0a20   or 'name'.""". 
+0001bc70: 2020 2069 6620 7064 2e69 736e 756c 6c28     if pd.isnull(
+0001bc80: 7429 3a0a 2020 2020 2020 2020 7265 7475  t):.        retu
+0001bc90: 726e 2074 0a20 2020 2069 6620 7064 2e69  rn t.    if pd.i
+0001bca0: 736e 756c 6c28 745b 305d 293a 0a20 2020  snull(t[0]):.   
+0001bcb0: 2020 2020 2072 6574 7572 6e20 745b 305d       return t[0]
+0001bcc0: 0a20 2020 206e 6f72 6d20 3d20 7765 6263  .    norm = webc
+0001bcd0: 6f6c 6f72 732e 6e6f 726d 616c 697a 655f  olors.normalize_
+0001bce0: 696e 7465 6765 725f 7472 6970 6c65 7428  integer_triplet(
+0001bcf0: 7475 706c 6528 696e 7428 6929 2066 6f72  tuple(int(i) for
+0001bd00: 2069 2069 6e20 7429 290a 2020 2020 6966   i in t)).    if
+0001bd10: 2066 6f72 6d61 7420 3d3d 2027 6874 6d6c   format == 'html
+0001bd20: 273a 0a20 2020 2020 2020 2072 6574 7572  ':.        retur
+0001bd30: 6e20 7765 6263 6f6c 6f72 732e 7267 625f  n webcolors.rgb_
+0001bd40: 746f 5f68 6578 286e 6f72 6d29 0a20 2020  to_hex(norm).   
+0001bd50: 2069 6620 666f 726d 6174 203d 3d20 276e   if format == 'n
+0001bd60: 616d 6527 3a0a 2020 2020 2020 2020 7472  ame':.        tr
+0001bd70: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+0001bd80: 6574 7572 6e20 7765 6263 6f6c 6f72 732e  eturn webcolors.
+0001bd90: 7267 625f 746f 5f6e 616d 6528 6e6f 726d  rgb_to_name(norm
+0001bda0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+0001bdb0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+0001bdc0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001bdd0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001bde0: 7572 6e20 4d53 335f 5247 425b 6e6f 726d  urn MS3_RGB[norm
+0001bdf0: 5d0a 2020 2020 2020 2020 2020 2020 6578  ].            ex
+0001be00: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+0001be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be20: 7265 7475 726e 2077 6562 636f 6c6f 7273  return webcolors
+0001be30: 2e72 6762 5f74 6f5f 6865 7828 6e6f 726d  .rgb_to_hex(norm
+0001be40: 290a 0a0a 6465 6620 7267 625f 7475 706c  )...def rgb_tupl
+0001be50: 6532 6874 6d6c 2874 293a 0a20 2020 2022  e2html(t):.    "
+0001be60: 2222 2043 6f6e 7665 7274 7320 6120 7369  "" Converts a si
+0001be70: 6e67 6c65 2052 4742 2074 7570 6c65 2069  ngle RGB tuple i
+0001be80: 6e74 6f20 4854 4d4c 2e22 2222 0a20 2020  nto HTML.""".   
+0001be90: 2072 6574 7572 6e20 7267 625f 7475 706c   return rgb_tupl
+0001bea0: 6532 666f 726d 6174 2874 2c20 666f 726d  e2format(t, form
+0001beb0: 6174 3d27 6874 6d6c 2729 0a0a 0a64 6566  at='html')...def
+0001bec0: 2072 6762 5f74 7570 6c65 326e 616d 6528   rgb_tuple2name(
+0001bed0: 7429 3a0a 2020 2020 2222 2220 436f 6e76  t):.    """ Conv
+0001bee0: 6572 7473 2061 2073 696e 676c 6520 5247  erts a single RG
+0001bef0: 4220 7475 706c 6520 696e 746f 2069 7473  B tuple into its
+0001bf00: 2043 5353 3320 6e61 6d65 206f 7220 746f   CSS3 name or to
+0001bf10: 2048 544d 4c20 6966 2074 6865 7265 2069   HTML if there i
+0001bf20: 7320 6e6f 6e65 2e22 2222 0a20 2020 2072  s none.""".    r
+0001bf30: 6574 7572 6e20 7267 625f 7475 706c 6532  eturn rgb_tuple2
+0001bf40: 666f 726d 6174 2874 2c20 666f 726d 6174  format(t, format
+0001bf50: 3d27 6e61 6d65 2729 0a0a 0a64 6566 2072  ='name')...def r
+0001bf60: 6762 6132 6174 7472 7328 6e61 6d65 645f  gba2attrs(named_
+0001bf70: 7475 706c 6529 3a0a 2020 2020 7265 7475  tuple):.    retu
+0001bf80: 726e 207b 6b3a 2073 7472 2876 2920 666f  rn {k: str(v) fo
+0001bf90: 7220 6b2c 2076 2069 6e20 6e61 6d65 645f  r k, v in named_
+0001bfa0: 7475 706c 652e 5f61 7364 6963 7428 292e  tuple._asdict().
+0001bfb0: 6974 656d 7328 297d 0a0a 6465 6620 7267  items()}..def rg
+0001bfc0: 6261 3270 6172 616d 7328 6e61 6d65 645f  ba2params(named_
+0001bfd0: 7475 706c 6529 3a0a 2020 2020 6174 7472  tuple):.    attr
+0001bfe0: 7320 3d20 7267 6261 3261 7474 7273 286e  s = rgba2attrs(n
+0001bff0: 616d 6564 5f74 7570 6c65 290a 2020 2020  amed_tuple).    
+0001c000: 7265 7475 726e 207b 2763 6f6c 6f72 5f27  return {'color_'
+0001c010: 2b6b 3a20 7620 666f 7220 6b2c 2076 2069  +k: v for k, v i
+0001c020: 6e20 6174 7472 732e 6974 656d 7328 297d  n attrs.items()}
+0001c030: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
+0001c040: 6572 0a64 6566 2072 6f6d 616e 5f6e 756d  er.def roman_num
+0001c050: 6572 616c 3266 6966 7468 7328 726e 2c20  eral2fifths(rn, 
+0001c060: 676c 6f62 616c 5f6d 696e 6f72 3d46 616c  global_minor=Fal
+0001c070: 7365 293a 0a20 2020 2022 2222 2054 7572  se):.    """ Tur
+0001c080: 6e20 6120 526f 6d61 6e20 6e75 6d65 7261  n a Roman numera
+0001c090: 6c20 696e 746f 2061 2054 5043 2069 6e74  l into a TPC int
+0001c0a0: 6572 7661 6c20 2865 2e67 2e20 666f 7220  erval (e.g. for 
+0001c0b0: 7472 616e 7370 6f73 6974 696f 6e20 7075  transposition pu
+0001c0c0: 7270 6f73 6573 292e 0a20 2020 2020 2020  rposes)..       
+0001c0d0: 2055 7365 733a 2073 706c 6974 5f73 6361   Uses: split_sca
+0001c0e0: 6c65 5f64 6567 7265 6528 290a 2020 2020  le_degree().    
+0001c0f0: 2222 220a 2020 2020 6966 2070 642e 6973  """.    if pd.is
+0001c100: 6e75 6c6c 2872 6e29 3a0a 2020 2020 2020  null(rn):.      
+0001c110: 2020 7265 7475 726e 2072 6e0a 2020 2020    return rn.    
+0001c120: 6966 2027 2f27 2069 6e20 726e 3a0a 2020  if '/' in rn:.  
+0001c130: 2020 2020 2020 7265 736f 6c76 6564 203d        resolved =
+0001c140: 2072 6573 6f6c 7665 5f72 656c 6174 6976   resolve_relativ
+0001c150: 655f 6b65 7973 2872 6e2c 2067 6c6f 6261  e_keys(rn, globa
+0001c160: 6c5f 6d69 6e6f 7229 0a20 2020 2020 2020  l_minor).       
+0001c170: 206d 6f64 6520 3d20 276d 696e 6f72 2720   mode = 'minor' 
+0001c180: 6966 2067 6c6f 6261 6c5f 6d69 6e6f 7220  if global_minor 
+0001c190: 656c 7365 2027 6d61 6a6f 7227 0a20 2020  else 'major'.   
+0001c1a0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+0001c1b0: 6728 6622 5265 6c61 7469 7665 206e 756d  g(f"Relative num
+0001c1c0: 6572 616c 207b 726e 7d20 696e 207b 6d6f  eral {rn} in {mo
+0001c1d0: 6465 7d20 6d6f 6465 2072 6573 6f6c 7665  de} mode resolve
+0001c1e0: 6420 746f 207b 7265 736f 6c76 6564 7d2e  d to {resolved}.
+0001c1f0: 2229 0a20 2020 2020 2020 2072 6e20 3d20  ").        rn = 
+0001c200: 7265 736f 6c76 6564 0a20 2020 2072 6e5f  resolved.    rn_
+0001c210: 7470 6373 5f6d 616a 203d 207b 2749 273a  tpcs_maj = {'I':
+0001c220: 2030 2c20 2749 4927 3a20 322c 2027 4949   0, 'II': 2, 'II
+0001c230: 4927 3a20 342c 2027 4956 273a 202d 312c  I': 4, 'IV': -1,
+0001c240: 2027 5627 3a20 312c 2027 5649 273a 2033   'V': 1, 'VI': 3
+0001c250: 2c20 2756 4949 273a 2035 7d0a 2020 2020  , 'VII': 5}.    
+0001c260: 726e 5f74 7063 735f 6d69 6e20 3d20 7b27  rn_tpcs_min = {'
+0001c270: 4927 3a20 302c 2027 4949 273a 2032 2c20  I': 0, 'II': 2, 
+0001c280: 2749 4949 273a 202d 332c 2027 4956 273a  'III': -3, 'IV':
+0001c290: 202d 312c 2027 5627 3a20 312c 2027 5649   -1, 'V': 1, 'VI
+0001c2a0: 273a 202d 342c 2027 5649 4927 3a20 2d32  ': -4, 'VII': -2
+0001c2b0: 7d0a 2020 2020 6163 6369 6465 6e74 616c  }.    accidental
+0001c2c0: 732c 2072 6e5f 7374 6570 203d 2073 706c  s, rn_step = spl
+0001c2d0: 6974 5f73 6361 6c65 5f64 6567 7265 6528  it_scale_degree(
+0001c2e0: 726e 2c20 636f 756e 743d 5472 7565 2c20  rn, count=True, 
+0001c2f0: 6c6f 6767 6572 3d6c 6f67 6765 7229 0a20  logger=logger). 
+0001c300: 2020 2069 6620 616e 7928 7620 6973 204e     if any(v is N
+0001c310: 6f6e 6520 666f 7220 7620 696e 2028 6163  one for v in (ac
+0001c320: 6369 6465 6e74 616c 732c 2072 6e5f 7374  cidentals, rn_st
+0001c330: 6570 2929 3a0a 2020 2020 2020 2020 7265  ep)):.        re
+0001c340: 7475 726e 204e 6f6e 650a 2020 2020 726e  turn None.    rn
+0001c350: 5f73 7465 7020 3d20 726e 5f73 7465 702e  _step = rn_step.
+0001c360: 7570 7065 7228 290a 2020 2020 7374 6570  upper().    step
+0001c370: 5f74 7063 203d 2072 6e5f 7470 6373 5f6d  _tpc = rn_tpcs_m
+0001c380: 696e 5b72 6e5f 7374 6570 5d20 6966 2067  in[rn_step] if g
+0001c390: 6c6f 6261 6c5f 6d69 6e6f 7220 656c 7365  lobal_minor else
+0001c3a0: 2072 6e5f 7470 6373 5f6d 616a 5b72 6e5f   rn_tpcs_maj[rn_
+0001c3b0: 7374 6570 5d0a 2020 2020 7265 7475 726e  step].    return
+0001c3c0: 2073 7465 705f 7470 6320 2b20 3720 2a20   step_tpc + 7 * 
+0001c3d0: 6163 6369 6465 6e74 616c 730a 0a40 6675  accidentals..@fu
+0001c3e0: 6e63 7469 6f6e 5f6c 6f67 6765 720a 6465  nction_logger.de
+0001c3f0: 6620 726f 6d61 6e5f 6e75 6d65 7261 6c32  f roman_numeral2
+0001c400: 7365 6d69 746f 6e65 7328 726e 2c20 676c  semitones(rn, gl
+0001c410: 6f62 616c 5f6d 696e 6f72 3d46 616c 7365  obal_minor=False
+0001c420: 293a 0a20 2020 2022 2222 2054 7572 6e20  ):.    """ Turn 
+0001c430: 6120 526f 6d61 6e20 6e75 6d65 7261 6c20  a Roman numeral 
+0001c440: 696e 746f 2061 2073 656d 6974 6f6e 6520  into a semitone 
+0001c450: 6469 7374 616e 6365 2066 726f 6d20 7468  distance from th
+0001c460: 6520 726f 6f74 2028 302d 3131 292e 0a20  e root (0-11).. 
+0001c470: 2020 2020 2020 2055 7365 733a 2073 706c         Uses: spl
+0001c480: 6974 5f73 6361 6c65 5f64 6567 7265 6528  it_scale_degree(
+0001c490: 290a 2020 2020 2222 220a 2020 2020 6966  ).    """.    if
+0001c4a0: 2070 642e 6973 6e75 6c6c 2872 6e29 3a0a   pd.isnull(rn):.
+0001c4b0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0001c4c0: 6e0a 2020 2020 6966 2027 2f27 2069 6e20  n.    if '/' in 
+0001c4d0: 726e 3a0a 2020 2020 2020 2020 7265 736f  rn:.        reso
+0001c4e0: 6c76 6564 203d 2072 6573 6f6c 7665 5f72  lved = resolve_r
+0001c4f0: 656c 6174 6976 655f 6b65 7973 2872 6e2c  elative_keys(rn,
+0001c500: 2067 6c6f 6261 6c5f 6d69 6e6f 7229 0a20   global_minor). 
+0001c510: 2020 2020 2020 206d 6f64 6520 3d20 276d         mode = 'm
+0001c520: 696e 6f72 2720 6966 2067 6c6f 6261 6c5f  inor' if global_
+0001c530: 6d69 6e6f 7220 656c 7365 2027 6d61 6a6f  minor else 'majo
+0001c540: 7227 0a20 2020 2020 2020 206c 6f67 6765  r'.        logge
+0001c550: 722e 6465 6275 6728 6622 5265 6c61 7469  r.debug(f"Relati
+0001c560: 7665 206e 756d 6572 616c 207b 726e 7d20  ve numeral {rn} 
+0001c570: 696e 207b 6d6f 6465 7d20 6d6f 6465 2072  in {mode} mode r
+0001c580: 6573 6f6c 7665 6420 746f 207b 7265 736f  esolved to {reso
+0001c590: 6c76 6564 7d2e 2229 0a20 2020 2020 2020  lved}.").       
+0001c5a0: 2072 6e20 3d20 7265 736f 6c76 6564 0a20   rn = resolved. 
+0001c5b0: 2020 2072 6e5f 7470 6373 5f6d 616a 203d     rn_tpcs_maj =
+0001c5c0: 207b 2749 273a 2030 2c20 2749 4927 3a20   {'I': 0, 'II': 
+0001c5d0: 322c 2027 4949 4927 3a20 342c 2027 4956  2, 'III': 4, 'IV
+0001c5e0: 273a 2035 2c20 2756 273a 2037 2c20 2756  ': 5, 'V': 7, 'V
+0001c5f0: 4927 3a20 392c 2027 5649 4927 3a20 3131  I': 9, 'VII': 11
+0001c600: 7d0a 2020 2020 726e 5f74 7063 735f 6d69  }.    rn_tpcs_mi
+0001c610: 6e20 3d20 7b27 4927 3a20 302c 2027 4949  n = {'I': 0, 'II
+0001c620: 273a 2032 2c20 2749 4949 273a 2033 2c20  ': 2, 'III': 3, 
+0001c630: 2749 5627 3a20 352c 2027 5627 3a20 372c  'IV': 5, 'V': 7,
+0001c640: 2027 5649 273a 2038 2c20 2756 4949 273a   'VI': 8, 'VII':
+0001c650: 2031 307d 0a20 2020 2061 6363 6964 656e   10}.    acciden
+0001c660: 7461 6c73 2c20 726e 5f73 7465 7020 3d20  tals, rn_step = 
+0001c670: 7370 6c69 745f 7363 616c 655f 6465 6772  split_scale_degr
+0001c680: 6565 2872 6e2c 2063 6f75 6e74 3d54 7275  ee(rn, count=Tru
+0001c690: 652c 206c 6f67 6765 723d 6c6f 6767 6572  e, logger=logger
+0001c6a0: 290a 2020 2020 6966 2061 6e79 2876 2069  ).    if any(v i
+0001c6b0: 7320 4e6f 6e65 2066 6f72 2076 2069 6e20  s None for v in 
+0001c6c0: 2861 6363 6964 656e 7461 6c73 2c20 726e  (accidentals, rn
+0001c6d0: 5f73 7465 7029 293a 0a20 2020 2020 2020  _step)):.       
+0001c6e0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+0001c6f0: 2072 6e5f 7374 6570 203d 2072 6e5f 7374   rn_step = rn_st
+0001c700: 6570 2e75 7070 6572 2829 0a20 2020 2073  ep.upper().    s
+0001c710: 7465 705f 7470 6320 3d20 726e 5f74 7063  tep_tpc = rn_tpc
+0001c720: 735f 6d69 6e5b 726e 5f73 7465 705d 2069  s_min[rn_step] i
+0001c730: 6620 676c 6f62 616c 5f6d 696e 6f72 2065  f global_minor e
+0001c740: 6c73 6520 726e 5f74 7063 735f 6d61 6a5b  lse rn_tpcs_maj[
+0001c750: 726e 5f73 7465 705d 0a20 2020 2072 6574  rn_step].    ret
+0001c760: 7572 6e20 7374 6570 5f74 7063 202b 2061  urn step_tpc + a
+0001c770: 6363 6964 656e 7461 6c73 0a0a 406f 7665  ccidentals..@ove
+0001c780: 726c 6f61 640a 6465 6620 7363 616c 655f  rload.def scale_
+0001c790: 6465 6772 6565 326e 616d 6528 6669 6674  degree2name(fift
+0001c7a0: 6873 3a20 696e 742c 206c 6f63 616c 6b65  hs: int, localke
+0001c7b0: 793a 2073 7472 2c20 676c 6f62 616c 6b65  y: str, globalke
+0001c7c0: 793a 2073 7472 2920 2d3e 2073 7472 3a0a  y: str) -> str:.
+0001c7d0: 2020 2020 2e2e 2e0a 406f 7665 726c 6f61      ....@overloa
+0001c7e0: 640a 6465 6620 7363 616c 655f 6465 6772  d.def scale_degr
+0001c7f0: 6565 326e 616d 6528 6669 6674 6873 3a20  ee2name(fifths: 
+0001c800: 7064 2e53 6572 6965 732c 206c 6f63 616c  pd.Series, local
+0001c810: 6b65 793a 2073 7472 2c20 676c 6f62 616c  key: str, global
+0001c820: 6b65 793a 2073 7472 2920 2d3e 2070 642e  key: str) -> pd.
+0001c830: 5365 7269 6573 3a0a 2020 2020 2e2e 2e0a  Series:.    ....
+0001c840: 406f 7665 726c 6f61 640a 6465 6620 7363  @overload.def sc
+0001c850: 616c 655f 6465 6772 6565 326e 616d 6528  ale_degree2name(
+0001c860: 6669 6674 6873 3a20 4e44 4172 7261 795b  fifths: NDArray[
+0001c870: 696e 745d 2c20 6c6f 6361 6c6b 6579 3a20  int], localkey: 
+0001c880: 7374 722c 2067 6c6f 6261 6c6b 6579 3a20  str, globalkey: 
+0001c890: 7374 7229 202d 3e20 4e44 4172 7261 795b  str) -> NDArray[
+0001c8a0: 7374 725d 3a0a 2020 2020 2e2e 2e0a 406f  str]:.    ....@o
+0001c8b0: 7665 726c 6f61 640a 6465 6620 7363 616c  verload.def scal
+0001c8c0: 655f 6465 6772 6565 326e 616d 6528 6669  e_degree2name(fi
+0001c8d0: 6674 6873 3a20 4c69 7374 5b69 6e74 5d2c  fths: List[int],
+0001c8e0: 206c 6f63 616c 6b65 793a 2073 7472 2c20   localkey: str, 
+0001c8f0: 676c 6f62 616c 6b65 793a 2073 7472 2920  globalkey: str) 
+0001c900: 2d3e 204c 6973 745b 7374 725d 3a0a 2020  -> List[str]:.  
+0001c910: 2020 2e2e 2e0a 406f 7665 726c 6f61 640a    ....@overload.
+0001c920: 6465 6620 7363 616c 655f 6465 6772 6565  def scale_degree
+0001c930: 326e 616d 6528 6669 6674 6873 3a20 5475  2name(fifths: Tu
+0001c940: 706c 655b 696e 745d 2c20 6c6f 6361 6c6b  ple[int], localk
+0001c950: 6579 3a20 7374 722c 2067 6c6f 6261 6c6b  ey: str, globalk
+0001c960: 6579 3a20 7374 7229 202d 3e20 5475 706c  ey: str) -> Tupl
+0001c970: 655b 7374 725d 3a0a 2020 2020 2e2e 2e0a  e[str]:.    ....
+0001c980: 6465 6620 7363 616c 655f 6465 6772 6565  def scale_degree
+0001c990: 326e 616d 6528 6669 6674 6873 3a20 556e  2name(fifths: Un
+0001c9a0: 696f 6e5b 696e 742c 2070 642e 5365 7269  ion[int, pd.Seri
+0001c9b0: 6573 2c20 4e44 4172 7261 795b 696e 745d  es, NDArray[int]
+0001c9c0: 2c20 4c69 7374 5b69 6e74 5d2c 2054 7570  , List[int], Tup
+0001c9d0: 6c65 5b69 6e74 5d5d 2c0a 2020 2020 2020  le[int]],.      
+0001c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9f0: 6c6f 6361 6c6b 6579 3a20 7374 722c 0a20  localkey: str,. 
+0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca10: 2020 2020 2067 6c6f 6261 6c6b 6579 3a20       globalkey: 
+0001ca20: 7374 7229 202d 3e20 556e 696f 6e5b 7374  str) -> Union[st
+0001ca30: 722c 2070 642e 5365 7269 6573 2c20 4e44  r, pd.Series, ND
+0001ca40: 4172 7261 795b 7374 725d 2c20 4c69 7374  Array[str], List
+0001ca50: 5b73 7472 5d2c 2054 7570 6c65 5b73 7472  [str], Tuple[str
+0001ca60: 5d5d 3a0a 2020 2020 2222 2220 466f 7220  ]]:.    """ For 
+0001ca70: 6578 616d 706c 652c 2073 6361 6c65 2064  example, scale d
+0001ca80: 6567 7265 6520 2d31 2028 6669 6674 6873  egree -1 (fifths
+0001ca90: 2c20 692e 652e 2074 6865 2073 7562 646f  , i.e. the subdo
+0001caa0: 6d69 6e61 6e74 2920 6f66 2074 6865 206c  minant) of the l
+0001cab0: 6f63 616c 6b65 7920 6f66 2027 5649 2720  ocalkey of 'VI' 
+0001cac0: 7769 7468 696e 2027 4527 206d 696e 6f72  within 'E' minor
+0001cad0: 2069 7320 2746 272e 0a0a 2020 2020 4172   is 'F'...    Ar
+0001cae0: 6773 3a0a 2020 2020 2020 2020 6669 6674  gs:.        fift
+0001caf0: 6873 3a20 5363 616c 6520 6465 6772 6565  hs: Scale degree
+0001cb00: 2065 7870 7265 7373 6564 2061 7320 6469   expressed as di
+0001cb10: 7374 616e 6365 2066 726f 6d20 7468 6520  stance from the 
+0001cb20: 746f 6e69 6320 696e 2066 6966 7468 732e  tonic in fifths.
+0001cb30: 0a20 2020 2020 2020 206c 6f63 616c 6b65  .        localke
+0001cb40: 793a 204c 6f63 616c 206b 6579 2069 6e20  y: Local key in 
+0001cb50: 7768 6963 6820 7468 6520 7363 616c 6520  which the scale 
+0001cb60: 6465 6772 6565 2069 7320 7369 7475 6174  degree is situat
+0001cb70: 6564 2c20 6173 2052 6f6d 616e 206e 756d  ed, as Roman num
+0001cb80: 6572 616c 2028 6361 6e20 696e 636c 7564  eral (can includ
+0001cb90: 6520 736c 6173 6820 6e6f 7461 7469 6f6e  e slash notation
+0001cba0: 2073 7563 6820 6173 2056 2f69 6929 2e0a   such as V/ii)..
+0001cbb0: 2020 2020 2020 2020 676c 6f62 616c 6b65          globalke
+0001cbc0: 793a 2047 6c6f 6261 6c20 6b65 7920 6173  y: Global key as
+0001cbd0: 2061 206e 6f74 6520 6e61 6d65 2e20 452e   a note name. E.
+0001cbe0: 672e 2060 4162 6020 666f 7220 4162 206d  g. `Ab` for Ab m
+0001cbf0: 616a 6f72 2c20 6f72 2027 6323 2720 666f  ajor, or 'c#' fo
+0001cc00: 7220 4323 206d 696e 6f72 2e0a 0a20 2020  r C# minor...   
+0001cc10: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+0001cc20: 2020 5468 6520 6769 7665 6e20 7363 616c    The given scal
+0001cc30: 6520 6465 6772 6565 2873 292c 2065 7870  e degree(s), exp
+0001cc40: 7265 7373 6564 2061 7320 6120 6e6f 7465  ressed as a note
+0001cc50: 206e 616d 6528 7329 2e0a 2020 2020 2222   name(s)..    ""
+0001cc60: 220a 2020 2020 7472 793a 0a20 2020 2020  ".    try:.     
+0001cc70: 2020 2069 6620 616e 7928 7064 2e69 736e     if any(pd.isn
+0001cc80: 756c 6c28 7661 6c29 2066 6f72 2076 616c  ull(val) for val
+0001cc90: 2069 6e20 2866 6966 7468 732c 206c 6f63   in (fifths, loc
+0001cca0: 616c 6b65 792c 2067 6c6f 6261 6c6b 6579  alkey, globalkey
+0001ccb0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0001ccc0: 7265 7475 726e 2066 6966 7468 730a 2020  return fifths.  
+0001ccd0: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
+0001cce0: 726f 723a 0a20 2020 2020 2020 2070 6173  ror:.        pas
+0001ccf0: 730a 2020 2020 6966 2069 7369 6e73 7461  s.    if isinsta
+0001cd00: 6e63 6528 6669 6674 6873 2c20 7064 2e53  nce(fifths, pd.S
+0001cd10: 6572 6965 7329 3a0a 2020 2020 2020 2020  eries):.        
+0001cd20: 7265 7475 726e 2063 6173 7432 636f 6c6c  return cast2coll
+0001cd30: 6563 7469 6f6e 2863 6f6c 6c3d 6669 6674  ection(coll=fift
+0001cd40: 6873 2c20 6675 6e63 3d73 6361 6c65 5f64  hs, func=scale_d
+0001cd50: 6567 7265 6532 6e61 6d65 2c20 6c6f 6361  egree2name, loca
+0001cd60: 6c6b 6579 3d6c 6f63 616c 6b65 792c 2067  lkey=localkey, g
+0001cd70: 6c6f 6261 6c6b 6579 3d67 6c6f 6261 6c6b  lobalkey=globalk
+0001cd80: 6579 290a 2020 2020 7472 793a 0a20 2020  ey).    try:.   
+0001cd90: 2020 2020 2066 6966 7468 7320 3d20 696e       fifths = in
+0001cda0: 7428 666c 6f61 7428 6669 6674 6873 2929  t(float(fifths))
+0001cdb0: 0a20 2020 2065 7863 6570 7420 5479 7065  .    except Type
+0001cdc0: 4572 726f 723a 0a20 2020 2020 2020 2072  Error:.        r
+0001cdd0: 6574 7572 6e20 6361 7374 3263 6f6c 6c65  eturn cast2colle
+0001cde0: 6374 696f 6e28 636f 6c6c 3d66 6966 7468  ction(coll=fifth
+0001cdf0: 732c 2066 756e 633d 7363 616c 655f 6465  s, func=scale_de
+0001ce00: 6772 6565 326e 616d 652c 206c 6f63 616c  gree2name, local
+0001ce10: 6b65 793d 6c6f 6361 6c6b 6579 2c20 676c  key=localkey, gl
+0001ce20: 6f62 616c 6b65 793d 676c 6f62 616c 6b65  obalkey=globalke
+0001ce30: 7929 0a20 2020 2067 6c6f 6261 6c5f 6d69  y).    global_mi
+0001ce40: 6e6f 7220 3d20 676c 6f62 616c 6b65 792e  nor = globalkey.
+0001ce50: 6973 6c6f 7765 7228 290a 2020 2020 6966  islower().    if
+0001ce60: 2027 2f27 2069 6e20 6c6f 6361 6c6b 6579   '/' in localkey
+0001ce70: 3a0a 2020 2020 2020 2020 6c6f 6361 6c6b  :.        localk
+0001ce80: 6579 203d 2072 6573 6f6c 7665 5f72 656c  ey = resolve_rel
+0001ce90: 6174 6976 655f 6b65 7973 286c 6f63 616c  ative_keys(local
+0001cea0: 6b65 792c 2067 6c6f 6261 6c5f 6d69 6e6f  key, global_mino
+0001ceb0: 7229 0a20 2020 206c 6b5f 6669 6674 6873  r).    lk_fifths
+0001cec0: 203d 2072 6f6d 616e 5f6e 756d 6572 616c   = roman_numeral
+0001ced0: 3266 6966 7468 7328 6c6f 6361 6c6b 6579  2fifths(localkey
+0001cee0: 2c20 676c 6f62 616c 5f6d 696e 6f72 290a  , global_minor).
+0001cef0: 2020 2020 676b 5f66 6966 7468 7320 3d20      gk_fifths = 
+0001cf00: 6e61 6d65 3266 6966 7468 7328 676c 6f62  name2fifths(glob
+0001cf10: 616c 6b65 7929 0a20 2020 2073 645f 7472  alkey).    sd_tr
+0001cf20: 616e 7370 6f73 6564 203d 2066 6966 7468  ansposed = fifth
+0001cf30: 7320 2b20 6c6b 5f66 6966 7468 7320 2b20  s + lk_fifths + 
+0001cf40: 676b 5f66 6966 7468 730a 2020 2020 7265  gk_fifths.    re
+0001cf50: 7475 726e 2066 6966 7468 7332 6e61 6d65  turn fifths2name
+0001cf60: 2873 645f 7472 616e 7370 6f73 6564 290a  (sd_transposed).
+0001cf70: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
+0001cf80: 6572 0a64 6566 2073 6361 6e5f 6469 7265  er.def scan_dire
+0001cf90: 6374 6f72 7928 6469 7265 6374 6f72 793a  ctory(directory:
+0001cfa0: 2073 7472 2c0a 2020 2020 2020 2020 2020   str,.          
+0001cfb0: 2020 2020 2020 2020 2066 696c 655f 7265           file_re
+0001cfc0: 3a20 7374 7220 3d20 7222 2e2a 222c 0a20  : str = r".*",. 
+0001cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfe0: 2020 666f 6c64 6572 5f72 653a 2073 7472    folder_re: str
+0001cff0: 203d 2072 222e 2a22 2c0a 2020 2020 2020   = r".*",.      
+0001d000: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0001d010: 6c75 6465 5f72 653a 2073 7472 203d 2072  lude_re: str = r
+0001d020: 225e 285c 2e7c 5f29 222c 0a20 2020 2020  "^(\.|_)",.     
+0001d030: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001d040: 6375 7273 6976 653a 2062 6f6f 6c20 3d20  cursive: bool = 
+0001d050: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0001d060: 2020 2020 2020 2020 2073 7562 6469 7273           subdirs
+0001d070: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0001d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d090: 2020 2070 726f 6772 6573 733a 2062 6f6f     progress: boo
+0001d0a0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+0001d0b0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0001d0c0: 636c 7564 655f 6669 6c65 735f 6f6e 6c79  clude_files_only
+0001d0d0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0001d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0f0: 2020 2072 6574 7572 6e5f 6d65 7461 6461     return_metada
+0001d100: 7461 3a20 626f 6f6c 203d 2046 616c 7365  ta: bool = False
+0001d110: 2920 2d3e 2049 7465 7261 746f 725b 556e  ) -> Iterator[Un
+0001d120: 696f 6e5b 7374 722c 2054 7570 6c65 5b73  ion[str, Tuple[s
+0001d130: 7472 2c20 7374 725d 5d5d 3a0a 2020 2020  tr, str]]]:.    
+0001d140: 2222 2220 4765 6e65 7261 746f 7220 6f66  """ Generator of
+0001d150: 2066 696c 7465 7265 6420 6669 6c65 2070   filtered file p
+0001d160: 6174 6873 2069 6e20 6060 6469 7265 6374  aths in ``direct
+0001d170: 6f72 7960 602e 0a0a 2020 2020 4172 6773  ory``...    Args
+0001d180: 3a0a 2020 2020 2020 6469 7265 6374 6f72  :.      director
+0001d190: 793a 2044 6972 6563 746f 7279 2074 6f20  y: Directory to 
+0001d1a0: 6265 2073 6361 6e6e 6564 2066 6f72 2066  be scanned for f
+0001d1b0: 696c 6573 2e0a 2020 2020 2020 6669 6c65  iles..      file
+0001d1c0: 5f72 652c 2066 6f6c 6465 725f 7265 3a0a  _re, folder_re:.
+0001d1d0: 2020 2020 2020 2020 2020 5265 6775 6c61            Regula
+0001d1e0: 7220 6578 7072 6573 7369 6f6e 7320 666f  r expressions fo
+0001d1f0: 7220 6669 6c74 6572 696e 6720 6365 7274  r filtering cert
+0001d200: 6169 6e20 6669 6c65 206e 616d 6573 206f  ain file names o
+0001d210: 7220 666f 6c64 6572 206e 616d 6573 2e0a  r folder names..
+0001d220: 2020 2020 2020 2020 2020 5468 6520 7265            The re
+0001d230: 6745 7820 6172 6520 6368 6563 6b65 6420  gEx are checked 
+0001d240: 7769 7468 2073 6561 7263 6828 292c 206e  with search(), n
+0001d250: 6f74 206d 6174 6368 2829 2c20 616c 6c6f  ot match(), allo
+0001d260: 7769 6e67 2066 6f72 2066 757a 7a79 2073  wing for fuzzy s
+0001d270: 6561 7263 682e 0a20 2020 2020 2065 7863  earch..      exc
+0001d280: 6c75 6465 5f72 653a 0a20 2020 2020 2020  lude_re:.       
+0001d290: 2020 2045 7863 6c75 6465 2066 696c 6573     Exclude files
+0001d2a0: 2061 6e64 2066 6f6c 6465 7273 2028 756e   and folders (un
+0001d2b0: 6c65 7373 2060 6065 7863 6c75 6465 5f66  less ``exclude_f
+0001d2c0: 696c 6573 5f6f 6e6c 793d 5472 7565 6060  iles_only=True``
+0001d2d0: 2920 636f 6e74 6169 6e69 6e67 2074 6869  ) containing thi
+0001d2e0: 7320 7265 6775 6c61 7220 6578 7072 6573  s regular expres
+0001d2f0: 7369 6f6e 2e0a 2020 2020 2020 7265 6375  sion..      recu
+0001d300: 7273 6976 653a 2042 7920 6465 6661 756c  rsive: By defaul
+0001d310: 742c 2073 7562 2d64 6972 6563 746f 7269  t, sub-directori
+0001d320: 6573 2061 7265 2072 6563 7572 7369 7665  es are recursive
+0001d330: 6c79 2073 6361 6e6e 6564 2e20 5061 7373  ly scanned. Pass
+0001d340: 2046 616c 7365 2074 6f20 7363 616e 206f   False to scan o
+0001d350: 6e6c 7920 6060 6469 7260 602e 0a20 2020  nly ``dir``..   
+0001d360: 2020 2073 7562 6469 7273 3a20 4279 2064     subdirs: By d
+0001d370: 6566 6175 6c74 2c20 6675 6c6c 2066 696c  efault, full fil
+0001d380: 6520 7061 7468 7320 6172 6520 7265 7475  e paths are retu
+0001d390: 726e 6564 2e20 5061 7373 2054 7275 6520  rned. Pass True 
+0001d3a0: 746f 2072 6574 7572 6e20 2870 6174 682c  to return (path,
+0001d3b0: 206e 616d 6529 2074 7570 6c65 7320 696e   name) tuples in
+0001d3c0: 7374 6561 642e 0a20 2020 2020 2070 726f  stead..      pro
+0001d3d0: 6772 6573 733a 2050 6173 7320 5472 7565  gress: Pass True
+0001d3e0: 2074 6f20 6469 7370 6c61 7920 7468 6520   to display the 
+0001d3f0: 7072 6f67 7265 7373 2028 7573 6566 756c  progress (useful
+0001d400: 2066 6f72 206c 6172 6765 2064 6972 6563   for large direc
+0001d410: 746f 7269 6573 292e 0a20 2020 2020 2065  tories)..      e
+0001d420: 7863 6c75 6465 5f66 696c 6573 5f6f 6e6c  xclude_files_onl
+0001d430: 793a 0a20 2020 2020 2020 2020 2042 7920  y:.          By 
+0001d440: 6465 6661 756c 742c 2060 6065 7863 6c75  default, ``exclu
+0001d450: 6465 5f72 6560 6020 6578 636c 7564 6573  de_re`` excludes
+0001d460: 2066 696c 6573 2061 6e64 2066 6f6c 6465   files and folde
+0001d470: 722e 2050 6173 7320 5472 7565 2074 6f20  r. Pass True to 
+0001d480: 6578 636c 7564 6520 6f6e 6c79 2066 696c  exclude only fil
+0001d490: 6573 206d 6174 6368 696e 6720 7468 6520  es matching the 
+0001d4a0: 7265 6745 782e 0a20 2020 2020 2072 6574  regEx..      ret
+0001d4b0: 7572 6e5f 6d65 7461 6461 7461 3a0a 2020  urn_metadata:.  
+0001d4c0: 2020 2020 2020 2020 4966 2073 6574 2074          If set t
+0001d4d0: 6f20 5472 7565 2c20 276d 6574 6164 6174  o True, 'metadat
+0001d4e0: 612e 7473 7627 2061 7265 2061 6c77 6179  a.tsv' are alway
+0001d4f0: 7320 7969 656c 6465 6420 7265 6761 7264  s yielded regard
+0001d500: 6c65 7373 206f 6620 6060 6669 6c65 5f72  less of ``file_r
+0001d510: 6560 602e 0a0a 2020 2020 5969 656c 6473  e``...    Yields
+0001d520: 3a0a 2020 2020 2020 4675 6c6c 2066 696c  :.      Full fil
+0001d530: 6520 7061 7468 206f 722c 2069 6620 6060  e path or, if ``
+0001d540: 7375 6264 6972 733d 5472 7565 6060 2c20  subdirs=True``, 
+0001d550: 2870 6174 682c 2066 696c 655f 6e61 6d65  (path, file_name
+0001d560: 2920 7061 6972 7320 696e 2072 616e 646f  ) pairs in rando
+0001d570: 6d20 6f72 6465 722e 0a20 2020 2022 2222  m order..    """
+0001d580: 0a20 2020 2069 6620 6669 6c65 5f72 6520  .    if file_re 
+0001d590: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001d5a0: 2066 696c 655f 7265 203d 2072 222e 2a22   file_re = r".*"
+0001d5b0: 0a20 2020 2069 6620 666f 6c64 6572 5f72  .    if folder_r
+0001d5c0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+0001d5d0: 2020 2066 6f6c 6465 725f 7265 203d 2072     folder_re = r
+0001d5e0: 222e 2a22 0a0a 2020 2020 6465 6620 7472  ".*"..    def tr
+0001d5f0: 6176 6572 7365 2864 293a 0a20 2020 2020  averse(d):.     
+0001d600: 2020 206e 6f6e 6c6f 6361 6c20 636f 756e     nonlocal coun
+0001d610: 7465 720a 0a20 2020 2020 2020 2064 6566  ter..        def
+0001d620: 2063 6865 636b 5f72 6567 6578 2872 6567   check_regex(reg
+0001d630: 2c20 732c 2065 7863 6c3d 6578 636c 7564  , s, excl=exclud
+0001d640: 655f 7265 293a 0a20 2020 2020 2020 2020  e_re):.         
+0001d650: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001d660: 2020 2020 2020 2020 7265 7320 3d20 7265          res = re
+0001d670: 2e73 6561 7263 6828 7265 672c 2073 2920  .search(reg, s) 
+0001d680: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+0001d690: 7265 2e73 6561 7263 6828 6578 636c 2c20  re.search(excl, 
+0001d6a0: 7329 2069 7320 4e6f 6e65 0a20 2020 2020  s) is None.     
+0001d6b0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0001d6c0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+0001d6d0: 2020 2020 2020 2020 2070 7269 6e74 2872           print(r
+0001d6e0: 6567 290a 2020 2020 2020 2020 2020 2020  eg).            
+0001d6f0: 2020 2020 7261 6973 650a 2020 2020 2020      raise.      
+0001d700: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+0001d710: 0a0a 2020 2020 2020 2020 666f 7220 6469  ..        for di
+0001d720: 725f 656e 7472 7920 696e 206f 732e 7363  r_entry in os.sc
+0001d730: 616e 6469 7228 6429 3a0a 2020 2020 2020  andir(d):.      
+0001d740: 2020 2020 2020 6e61 6d65 203d 2064 6972        name = dir
+0001d750: 5f65 6e74 7279 2e6e 616d 650a 2020 2020  _entry.name.    
+0001d760: 2020 2020 2020 2020 7061 7468 203d 206f          path = o
+0001d770: 732e 7061 7468 2e6a 6f69 6e28 642c 206e  s.path.join(d, n
+0001d780: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+0001d790: 2069 6620 6469 725f 656e 7472 792e 6973   if dir_entry.is
+0001d7a0: 5f64 6972 2829 2061 6e64 2028 7265 6375  _dir() and (recu
+0001d7b0: 7273 6976 6520 6f72 2066 6f6c 6465 725f  rsive or folder_
+0001d7c0: 7265 2021 3d20 272e 2a27 293a 0a20 2020  re != '.*'):.   
+0001d7d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001d7e0: 2072 6573 2069 6e20 7472 6176 6572 7365   res in traverse
+0001d7f0: 2870 6174 6829 3a0a 2020 2020 2020 2020  (path):.        
+0001d800: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+0001d810: 6420 7265 730a 2020 2020 2020 2020 2020  d res.          
+0001d820: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001d830: 2020 2020 2020 2020 6966 2070 6261 7220          if pbar 
+0001d840: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0001d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d860: 2070 6261 722e 7570 6461 7465 2829 0a20   pbar.update(). 
+0001d870: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001d880: 6620 666f 6c64 6572 5f72 6520 3d3d 2027  f folder_re == '
+0001d890: 2e2a 273a 0a20 2020 2020 2020 2020 2020  .*':.           
+0001d8a0: 2020 2020 2020 2020 2066 6f6c 6465 725f           folder_
+0001d8b0: 7061 7373 6573 203d 2054 7275 650a 2020  passes = True.  
+0001d8c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001d8d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001d8e0: 2020 2020 2020 2020 666f 6c64 6572 5f70          folder_p
+0001d8f0: 6174 6820 3d20 6f73 2e70 6174 682e 6469  ath = os.path.di
+0001d900: 726e 616d 6528 7061 7468 290a 2020 2020  rname(path).    
+0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d920: 6966 2072 6563 7572 7369 7665 3a0a 2020  if recursive:.  
+0001d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d940: 2020 2020 2020 666f 6c64 6572 5f70 6173        folder_pas
+0001d950: 7365 7320 3d20 6368 6563 6b5f 7265 6765  ses = check_rege
+0001d960: 7828 666f 6c64 6572 5f72 652c 2066 6f6c  x(folder_re, fol
+0001d970: 6465 725f 7061 7468 2c20 6578 636c 3d27  der_path, excl='
+0001d980: 5e24 2729 2020 2320 7061 7373 6573 2069  ^$')  # passes i
+0001d990: 6620 7468 6520 666f 6c64 6572 2070 6174  f the folder pat
+0001d9a0: 6820 6d61 7463 6865 7320 7468 6520 7265  h matches the re
+0001d9b0: 6765 780a 2020 2020 2020 2020 2020 2020  gex.            
+0001d9c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9e0: 2020 2020 2020 666f 6c64 6572 203d 206f        folder = o
+0001d9f0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0001da00: 666f 6c64 6572 5f70 6174 6829 0a20 2020  folder_path).   
+0001da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da20: 2020 2020 2066 6f6c 6465 725f 7061 7373       folder_pass
+0001da30: 6573 203d 2063 6865 636b 5f72 6567 6578  es = check_regex
+0001da40: 2866 6f6c 6465 725f 7265 2c20 666f 6c64  (folder_re, fold
+0001da50: 6572 2c20 6578 636c 3d27 5e24 2729 2020  er, excl='^$')  
+0001da60: 2320 7061 7373 6573 2069 6620 7468 6520  # passes if the 
+0001da70: 666f 6c64 6572 206e 616d 6520 6974 7365  folder name itse
+0001da80: 6c66 206d 6174 6368 6573 2074 6865 2072  lf matches the r
+0001da90: 6567 6578 0a20 2020 2020 2020 2020 2020  egex.           
+0001daa0: 2020 2020 2020 2020 2069 6620 666f 6c64           if fold
+0001dab0: 6572 5f70 6173 7365 7320 616e 6420 6e6f  er_passes and no
+0001dac0: 7420 6578 636c 7564 655f 6669 6c65 735f  t exclude_files_
+0001dad0: 6f6e 6c79 3a20 2320 5472 7565 2069 6620  only: # True if 
+0001dae0: 7468 6520 6578 636c 7564 655f 7265 2073  the exclude_re s
+0001daf0: 686f 756c 6420 616c 736f 2065 7863 6c75  hould also exclu
+0001db00: 6465 2066 6f6c 6465 7220 6e61 6d65 730a  de folder names.
+0001db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db20: 2020 2020 2020 2020 666f 6c64 6572 5f70          folder_p
+0001db30: 6173 7365 7320 3d20 6368 6563 6b5f 7265  asses = check_re
+0001db40: 6765 7828 666f 6c64 6572 5f72 652c 2066  gex(folder_re, f
+0001db50: 6f6c 6465 725f 7061 7468 2920 2320 6973  older_path) # is
+0001db60: 2066 616c 7365 2069 6620 616e 7920 7061   false if any pa
+0001db70: 7274 206f 6620 7468 6520 666f 6c64 6572  rt of the folder
+0001db80: 2070 6174 6820 6d61 7463 6865 7320 6578   path matches ex
+0001db90: 636c 7564 655f 7265 0a20 2020 2020 2020  clude_re.       
+0001dba0: 2020 2020 2020 2020 2069 6620 6469 725f           if dir_
+0001dbb0: 656e 7472 792e 6973 5f66 696c 6528 2920  entry.is_file() 
+0001dbc0: 616e 6420 666f 6c64 6572 5f70 6173 7365  and folder_passe
+0001dbd0: 7320 616e 6420 2863 6865 636b 5f72 6567  s and (check_reg
+0001dbe0: 6578 2866 696c 655f 7265 2c20 6e61 6d65  ex(file_re, name
+0001dbf0: 2920 6f72 2028 7265 7475 726e 5f6d 6574  ) or (return_met
+0001dc00: 6164 6174 6120 616e 6420 6e61 6d65 3d3d  adata and name==
+0001dc10: 276d 6574 6164 6174 612e 7473 7627 2929  'metadata.tsv'))
+0001dc20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001dc30: 2020 2020 2020 636f 756e 7465 7220 2b3d        counter +=
+0001dc40: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+0001dc50: 2020 2020 2020 2069 6620 7062 6172 2069         if pbar i
+0001dc60: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0001dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc80: 2020 2020 7062 6172 2e73 6574 5f70 6f73      pbar.set_pos
+0001dc90: 7466 6978 287b 2773 656c 6563 7465 6427  tfix({'selected'
+0001dca0: 3a20 636f 756e 7465 727d 290a 2020 2020  : counter}).    
+0001dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcc0: 6966 2073 7562 6469 7273 3a0a 2020 2020  if subdirs:.    
+0001dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dce0: 2020 2020 7969 656c 6420 2864 2c20 6e61      yield (d, na
+0001dcf0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0001dd00: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd20: 2020 2020 2020 7969 656c 6420 7061 7468        yield path
+0001dd30: 0a0a 2020 2020 6966 2065 7863 6c75 6465  ..    if exclude
+0001dd40: 5f72 6520 6973 204e 6f6e 6520 6f72 2065  _re is None or e
+0001dd50: 7863 6c75 6465 5f72 6520 3d3d 2027 273a  xclude_re == '':
+0001dd60: 0a20 2020 2020 2020 2065 7863 6c75 6465  .        exclude
+0001dd70: 5f72 6520 3d20 275e 2427 0a20 2020 2064  _re = '^$'.    d
+0001dd80: 6972 6563 746f 7279 203d 2072 6573 6f6c  irectory = resol
+0001dd90: 7665 5f64 6972 2864 6972 6563 746f 7279  ve_dir(directory
+0001dda0: 290a 2020 2020 636f 756e 7465 7220 3d20  ).    counter = 
+0001ddb0: 300a 2020 2020 6966 206e 6f74 206f 732e  0.    if not os.
+0001ddc0: 7061 7468 2e69 7364 6972 2864 6972 6563  path.isdir(direc
+0001ddd0: 746f 7279 293a 0a20 2020 2020 2020 206c  tory):.        l
+0001dde0: 6f67 6765 722e 6572 726f 7228 224e 6f74  ogger.error("Not
+0001ddf0: 2061 6e20 6578 6973 7469 6e67 2064 6972   an existing dir
+0001de00: 6563 746f 7279 3a20 2220 2b20 6469 7265  ectory: " + dire
+0001de10: 6374 6f72 7929 0a20 2020 2020 2020 2072  ctory).        r
+0001de20: 6574 7572 6e20 6974 6572 285b 5d29 0a20  eturn iter([]). 
+0001de30: 2020 2070 6261 7220 3d20 7471 646d 2864     pbar = tqdm(d
+0001de40: 6573 633d 2753 6361 6e6e 696e 6720 6669  esc='Scanning fi
+0001de50: 6c65 7327 2c20 756e 6974 3d27 2066 696c  les', unit=' fil
+0001de60: 6573 2729 2069 6620 7072 6f67 7265 7373  es') if progress
+0001de70: 2065 6c73 6520 4e6f 6e65 0a20 2020 2072   else None.    r
+0001de80: 6574 7572 6e20 7472 6176 6572 7365 2864  eturn traverse(d
+0001de90: 6972 6563 746f 7279 290a 0a0a 6465 6620  irectory)...def 
+0001dea0: 636f 6c75 6d6e 5f6f 7264 6572 2864 662c  column_order(df,
+0001deb0: 2066 6972 7374 5f63 6f6c 733d 4e6f 6e65   first_cols=None
+0001dec0: 2c20 736f 7274 3d54 7275 6529 3a0a 2020  , sort=True):.  
+0001ded0: 2020 2222 2253 6f72 7420 4461 7461 4672    """Sort DataFr
+0001dee0: 616d 6520 636f 6c75 6d6e 7320 736f 2074  ame columns so t
+0001def0: 6861 7420 7468 6579 2073 7461 7274 2077  hat they start w
+0001df00: 6974 6820 7468 6520 6f72 6465 7220 6f66  ith the order of
+0001df10: 2060 6066 6972 7374 5f63 6f6c 7360 602c   ``first_cols``,
+0001df20: 2066 6f6c 6c6f 7765 6420 6279 2074 686f   followed by tho
+0001df30: 7365 206e 6f74 2069 6e63 6c75 6465 642e  se not included.
+0001df40: 2022 2222 0a20 2020 2069 6620 6669 7273   """.    if firs
+0001df50: 745f 636f 6c73 2069 7320 4e6f 6e65 3a0a  t_cols is None:.
+0001df60: 2020 2020 2020 2020 6669 7273 745f 636f          first_co
+0001df70: 6c73 203d 2053 5441 4e44 4152 445f 434f  ls = STANDARD_CO
+0001df80: 4c55 4d4e 5f4f 5244 4552 0a20 2020 2063  LUMN_ORDER.    c
+0001df90: 6f6c 7320 3d20 6466 2e63 6f6c 756d 6e73  ols = df.columns
+0001dfa0: 0a20 2020 2072 656d 6169 6e69 6e67 203d  .    remaining =
+0001dfb0: 205b 636f 6c20 666f 7220 636f 6c20 696e   [col for col in
+0001dfc0: 2063 6f6c 7320 6966 2063 6f6c 206e 6f74   cols if col not
+0001dfd0: 2069 6e20 6669 7273 745f 636f 6c73 5d0a   in first_cols].
+0001dfe0: 2020 2020 6966 2073 6f72 743a 0a20 2020      if sort:.   
+0001dff0: 2020 2020 2023 2050 726f 626c 656d 3a20       # Problem: 
+0001e000: 7374 7269 6e67 2073 6f72 7420 6f72 6465  string sort orde
+0001e010: 7273 2073 7461 6666 5f31 2073 7461 6666  rs staff_1 staff
+0001e020: 5f31 3020 7374 6166 665f 3131 202e 2e2e  _10 staff_11 ...
+0001e030: 2061 6e64 206f 6e6c 7920 7468 656e 2073   and only then s
+0001e040: 7461 6666 5f32 0a20 2020 2020 2020 2072  taff_2.        r
+0001e050: 656d 6169 6e69 6e67 203d 2073 6f72 7465  emaining = sorte
+0001e060: 6428 7265 6d61 696e 696e 6729 0a20 2020  d(remaining).   
+0001e070: 2063 6f6c 756d 6e5f 6f72 6465 7220 3d20   column_order = 
+0001e080: 5b63 6f6c 2066 6f72 2063 6f6c 2069 6e20  [col for col in 
+0001e090: 6669 7273 745f 636f 6c73 2069 6620 636f  first_cols if co
+0001e0a0: 6c20 696e 2063 6f6c 735d 202b 2072 656d  l in cols] + rem
+0001e0b0: 6169 6e69 6e67 0a20 2020 2072 6574 7572  aining.    retur
+0001e0c0: 6e20 6466 5b63 6f6c 756d 6e5f 6f72 6465  n df[column_orde
+0001e0d0: 725d 0a0a 0a64 6566 2073 6f72 745f 6e6f  r]...def sort_no
+0001e0e0: 7465 5f6c 6973 7428 6466 2c20 6d63 5f63  te_list(df, mc_c
+0001e0f0: 6f6c 3d27 6d63 272c 206d 635f 6f6e 7365  ol='mc', mc_onse
+0001e100: 745f 636f 6c3d 276d 635f 6f6e 7365 7427  t_col='mc_onset'
+0001e110: 2c20 6d69 6469 5f63 6f6c 3d27 6d69 6469  , midi_col='midi
+0001e120: 272c 2064 7572 6174 696f 6e5f 636f 6c3d  ', duration_col=
+0001e130: 2764 7572 6174 696f 6e27 293a 0a20 2020  'duration'):.   
+0001e140: 2022 2222 2053 6f72 7420 6576 6572 7920   """ Sort every 
+0001e150: 6d65 6173 7572 6520 284d 4329 2062 7920  measure (MC) by 
+0001e160: 5b27 6d63 5f6f 6e73 6574 272c 2027 6d69  ['mc_onset', 'mi
+0001e170: 6469 272c 2027 6475 7261 7469 6f6e 275d  di', 'duration']
+0001e180: 2077 6869 6c65 206c 6561 7669 6e67 2067   while leaving g
+0001e190: 7261 6365 6e6f 7465 7327 206f 7264 6572  racenotes' order
+0001e1a0: 2028 6475 7261 7469 6f6e 3d30 2920 696e   (duration=0) in
+0001e1b0: 7461 6374 2e0a 0a20 2020 2050 6172 616d  tact...    Param
+0001e1c0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+0001e1d0: 2d2d 2d2d 0a20 2020 2064 660a 2020 2020  ----.    df.    
+0001e1e0: 6d63 5f63 6f6c 0a20 2020 206d 635f 6f6e  mc_col.    mc_on
+0001e1f0: 7365 745f 636f 6c0a 2020 2020 6d69 6469  set_col.    midi
+0001e200: 5f63 6f6c 0a20 2020 2064 7572 6174 696f  _col.    duratio
+0001e210: 6e5f 636f 6c0a 0a20 2020 2052 6574 7572  n_col..    Retur
+0001e220: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a0a  ns.    -------..
+0001e230: 2020 2020 2222 220a 2020 2020 6466 203d      """.    df =
+0001e240: 2064 662e 636f 7079 2829 0a20 2020 2069   df.copy().    i
+0001e250: 735f 6772 6163 6520 3d20 6466 5b64 7572  s_grace = df[dur
+0001e260: 6174 696f 6e5f 636f 6c5d 203d 3d20 300a  ation_col] == 0.
+0001e270: 2020 2020 6772 6163 655f 6978 203d 207b      grace_ix = {
+0001e280: 6b3a 2076 2e74 6f5f 6e75 6d70 7928 2920  k: v.to_numpy() 
+0001e290: 666f 7220 6b2c 2076 2069 6e20 6466 5b69  for k, v in df[i
+0001e2a0: 735f 6772 6163 655d 2e67 726f 7570 6279  s_grace].groupby
+0001e2b0: 285b 6d63 5f63 6f6c 2c20 6d63 5f6f 6e73  ([mc_col, mc_ons
+0001e2c0: 6574 5f63 6f6c 5d29 2e67 726f 7570 732e  et_col]).groups.
+0001e2d0: 6974 656d 7328 297d 0a20 2020 2068 6173  items()}.    has
+0001e2e0: 5f6e 616e 203d 2064 665b 6d69 6469 5f63  _nan = df[midi_c
+0001e2f0: 6f6c 5d2e 6973 6e61 2829 2e61 6e79 2829  ol].isna().any()
+0001e300: 0a20 2020 2069 6620 6861 735f 6e61 6e3a  .    if has_nan:
+0001e310: 0a20 2020 2020 2020 2077 6974 6820 7761  .        with wa
+0001e320: 726e 696e 6773 2e63 6174 6368 5f77 6172  rnings.catch_war
+0001e330: 6e69 6e67 7328 293a 0a20 2020 2020 2020  nings():.       
+0001e340: 2020 2020 2023 2053 6574 7469 6e67 2076       # Setting v
+0001e350: 616c 7565 7320 696e 2d70 6c61 6365 2069  alues in-place i
+0001e360: 7320 6669 6e65 2c20 6967 6e6f 7265 2074  s fine, ignore t
+0001e370: 6865 2077 6172 6e69 6e67 2069 6e20 5061  he warning in Pa
+0001e380: 6e64 6173 203e 3d20 312e 352e 300a 2020  ndas >= 1.5.0.  
+0001e390: 2020 2020 2020 2020 2020 2320 5468 6973            # This
+0001e3a0: 2063 616e 2062 6520 7265 6d6f 7665 642c   can be removed,
+0001e3b0: 2069 6620 5061 6e64 6173 2031 2e35 2e30   if Pandas 1.5.0
+0001e3c0: 2064 6f65 7320 6e6f 7420 6e65 6564 2074   does not need t
+0001e3d0: 6f20 6265 2073 7570 706f 7274 6564 2061  o be supported a
+0001e3e0: 6e79 206c 6f6e 6765 722e 0a20 2020 2020  ny longer..     
+0001e3f0: 2020 2020 2020 2023 2053 6565 2061 6c73         # See als
+0001e400: 6f3a 2068 7474 7073 3a2f 2f73 7461 636b  o: https://stack
+0001e410: 6f76 6572 666c 6f77 2e63 6f6d 2f71 2f37  overflow.com/q/7
+0001e420: 3430 3537 3336 372f 3835 3935 3931 0a20  4057367/859591. 
+0001e430: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0001e440: 6e67 732e 6669 6c74 6572 7761 726e 696e  ngs.filterwarnin
+0001e450: 6773 280a 2020 2020 2020 2020 2020 2020  gs(.            
+0001e460: 2020 2020 2269 676e 6f72 6522 2c0a 2020      "ignore",.  
+0001e470: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+0001e480: 7465 676f 7279 3d46 7574 7572 6557 6172  tegory=FutureWar
+0001e490: 6e69 6e67 2c0a 2020 2020 2020 2020 2020  ning,.          
+0001e4a0: 2020 2020 2020 6d65 7373 6167 653d 280a        message=(.
+0001e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4c0: 2020 2020 222e 2a77 696c 6c20 6174 7465      ".*will atte
+0001e4d0: 6d70 7420 746f 2073 6574 2074 6865 2076  mpt to set the v
+0001e4e0: 616c 7565 7320 696e 706c 6163 6520 696e  alues inplace in
+0001e4f0: 7374 6561 6420 6f66 2061 6c77 6179 7320  stead of always 
+0001e500: 7365 7474 696e 6720 6120 6e65 7720 6172  setting a new ar
+0001e510: 7261 792e 2022 0a20 2020 2020 2020 2020  ray. ".         
+0001e520: 2020 2020 2020 2020 2020 2022 546f 2072             "To r
+0001e530: 6574 6169 6e20 7468 6520 6f6c 6420 6265  etain the old be
+0001e540: 6861 7669 6f72 2c20 7573 6520 6569 7468  havior, use eith
+0001e550: 6572 2e2a 220a 2020 2020 2020 2020 2020  er.*".          
+0001e560: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+0001e570: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0001e580: 2020 2064 662e 6c6f 635b 3a2c 206d 6964     df.loc[:, mid
+0001e590: 695f 636f 6c5d 203d 2064 665b 6d69 6469  i_col] = df[midi
+0001e5a0: 5f63 6f6c 5d2e 6669 6c6c 6e61 2831 3030  _col].fillna(100
+0001e5b0: 3029 0a20 2020 206e 6f72 6d61 6c5f 6978  0).    normal_ix
+0001e5c0: 203d 2064 662e 6c6f 635b 7e69 735f 6772   = df.loc[~is_gr
+0001e5d0: 6163 652c 205b 6d63 5f63 6f6c 2c20 6d63  ace, [mc_col, mc
+0001e5e0: 5f6f 6e73 6574 5f63 6f6c 2c20 6d69 6469  _onset_col, midi
+0001e5f0: 5f63 6f6c 2c20 6475 7261 7469 6f6e 5f63  _col, duration_c
+0001e600: 6f6c 5d5d 2e67 726f 7570 6279 285b 6d63  ol]].groupby([mc
+0001e610: 5f63 6f6c 2c20 6d63 5f6f 6e73 6574 5f63  _col, mc_onset_c
+0001e620: 6f6c 5d29 2e61 7070 6c79 280a 2020 2020  ol]).apply(.    
+0001e630: 2020 2020 6c61 6d62 6461 2067 723a 2067      lambda gr: g
+0001e640: 722e 696e 6465 785b 6e70 2e6c 6578 736f  r.index[np.lexso
+0001e650: 7274 2828 6772 2e76 616c 7565 735b 3a2c  rt((gr.values[:,
+0001e660: 2033 5d2c 2067 722e 7661 6c75 6573 5b3a   3], gr.values[:
+0001e670: 2c20 325d 2929 5d2e 746f 5f6e 756d 7079  , 2]))].to_numpy
+0001e680: 2829 290a 2020 2020 736f 7274 6564 5f69  ()).    sorted_i
+0001e690: 7873 203d 205b 6e70 2e63 6f6e 6361 7465  xs = [np.concate
+0001e6a0: 6e61 7465 2828 6772 6163 655f 6978 5b6f  nate((grace_ix[o
+0001e6b0: 6e73 6574 5d2c 2069 7829 2920 6966 206f  nset], ix)) if o
+0001e6c0: 6e73 6574 2069 6e20 6772 6163 655f 6978  nset in grace_ix
+0001e6d0: 2065 6c73 6520 6978 2066 6f72 206f 6e73   else ix for ons
+0001e6e0: 6574 2c20 6978 2069 6e0a 2020 2020 2020  et, ix in.      
+0001e6f0: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
+0001e700: 616c 5f69 782e 6974 656d 7328 295d 0a20  al_ix.items()]. 
+0001e710: 2020 2064 6620 3d20 6466 2e72 6569 6e64     df = df.reind
+0001e720: 6578 286e 702e 636f 6e63 6174 656e 6174  ex(np.concatenat
+0001e730: 6528 736f 7274 6564 5f69 7873 2929 2e72  e(sorted_ixs)).r
+0001e740: 6573 6574 5f69 6e64 6578 2864 726f 703d  eset_index(drop=
+0001e750: 5472 7565 290a 2020 2020 6966 2068 6173  True).    if has
+0001e760: 5f6e 616e 3a0a 2020 2020 2020 2020 7769  _nan:.        wi
+0001e770: 7468 2077 6172 6e69 6e67 732e 6361 7463  th warnings.catc
+0001e780: 685f 7761 726e 696e 6773 2829 3a0a 2020  h_warnings():.  
+0001e790: 2020 2020 2020 2020 2020 2320 5365 7474            # Sett
+0001e7a0: 696e 6720 7661 6c75 6573 2069 6e2d 706c  ing values in-pl
+0001e7b0: 6163 6520 6973 2066 696e 652c 2069 676e  ace is fine, ign
+0001e7c0: 6f72 6520 7468 6520 7761 726e 696e 6720  ore the warning 
+0001e7d0: 696e 2050 616e 6461 7320 3e3d 2031 2e35  in Pandas >= 1.5
+0001e7e0: 2e30 0a20 2020 2020 2020 2020 2020 2023  .0.            #
+0001e7f0: 2054 6869 7320 6361 6e20 6265 2072 656d   This can be rem
+0001e800: 6f76 6564 2c20 6966 2050 616e 6461 7320  oved, if Pandas 
+0001e810: 312e 352e 3020 646f 6573 206e 6f74 206e  1.5.0 does not n
+0001e820: 6565 6420 746f 2062 6520 7375 7070 6f72  eed to be suppor
+0001e830: 7465 6420 616e 7920 6c6f 6e67 6572 2e0a  ted any longer..
+0001e840: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
+0001e850: 6520 616c 736f 3a20 6874 7470 733a 2f2f  e also: https://
+0001e860: 7374 6163 6b6f 7665 7266 6c6f 772e 636f  stackoverflow.co
+0001e870: 6d2f 712f 3734 3035 3733 3637 2f38 3539  m/q/74057367/859
+0001e880: 3539 310a 2020 2020 2020 2020 2020 2020  591.            
+0001e890: 7761 726e 696e 6773 2e66 696c 7465 7277  warnings.filterw
+0001e8a0: 6172 6e69 6e67 7328 0a20 2020 2020 2020  arnings(.       
+0001e8b0: 2020 2020 2020 2020 2022 6967 6e6f 7265           "ignore
+0001e8c0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0001e8d0: 2020 2063 6174 6567 6f72 793d 4675 7475     category=Futu
+0001e8e0: 7265 5761 726e 696e 672c 0a20 2020 2020  reWarning,.     
+0001e8f0: 2020 2020 2020 2020 2020 206d 6573 7361             messa
+0001e900: 6765 3d28 0a20 2020 2020 2020 2020 2020  ge=(.           
+0001e910: 2020 2020 2020 2020 2022 2e2a 7769 6c6c           ".*will
+0001e920: 2061 7474 656d 7074 2074 6f20 7365 7420   attempt to set 
+0001e930: 7468 6520 7661 6c75 6573 2069 6e70 6c61  the values inpla
+0001e940: 6365 2069 6e73 7465 6164 206f 6620 616c  ce instead of al
+0001e950: 7761 7973 2073 6574 7469 6e67 2061 206e  ways setting a n
+0001e960: 6577 2061 7272 6179 2e20 220a 2020 2020  ew array. ".    
+0001e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e980: 2254 6f20 7265 7461 696e 2074 6865 206f  "To retain the o
+0001e990: 6c64 2062 6568 6176 696f 722c 2075 7365  ld behavior, use
+0001e9a0: 2065 6974 6865 722e 2a22 0a20 2020 2020   either.*".     
+0001e9b0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+0001e9c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001e9d0: 2020 2020 2020 2020 6466 2e6c 6f63 5b3a          df.loc[:
+0001e9e0: 2c20 6d69 6469 5f63 6f6c 5d20 3d20 6466  , midi_col] = df
+0001e9f0: 5b6d 6964 695f 636f 6c5d 2e72 6570 6c61  [midi_col].repla
+0001ea00: 6365 287b 3130 3030 3a20 7064 2e4e 417d  ce({1000: pd.NA}
+0001ea10: 292e 6173 7479 7065 2827 496e 7436 3427  ).astype('Int64'
+0001ea20: 290a 2020 2020 7265 7475 726e 2064 660a  ).    return df.
+0001ea30: 0a0a 6465 6620 736f 7274 5f74 7063 7328  ..def sort_tpcs(
+0001ea40: 7470 6373 2c20 6173 6365 6e64 696e 673d  tpcs, ascending=
+0001ea50: 5472 7565 2c20 7374 6172 743d 4e6f 6e65  True, start=None
+0001ea60: 293a 0a20 2020 2022 2222 2053 6f72 7420  ):.    """ Sort 
+0001ea70: 746f 6e61 6c20 7069 7463 6820 636c 6173  tonal pitch clas
+0001ea80: 7365 7320 6279 206f 7264 6572 206f 6e20  ses by order on 
+0001ea90: 7468 6520 7069 616e 6f2e 0a20 2020 2020  the piano..     
+0001eaa0: 2020 2055 7365 733a 2066 6966 7468 7332     Uses: fifths2
+0001eab0: 7063 2829 0a0a 2020 2020 5061 7261 6d65  pc()..    Parame
+0001eac0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+0001ead0: 2d2d 2d0a 2020 2020 7470 6373 203a 2063  ---.    tpcs : c
+0001eae0: 6f6c 6c65 6374 696f 6e20 6f66 203a 6f62  ollection of :ob
+0001eaf0: 6a3a 6069 6e74 600a 2020 2020 2020 2020  j:`int`.        
+0001eb00: 546f 6e61 6c20 7069 7463 6820 636c 6173  Tonal pitch clas
+0001eb10: 7365 7320 746f 2073 6f72 742e 0a20 2020  ses to sort..   
+0001eb20: 2061 7363 656e 6469 6e67 203a 203a 6f62   ascending : :ob
+0001eb30: 6a3a 6062 6f6f 6c60 2c20 6f70 7469 6f6e  j:`bool`, option
+0001eb40: 616c 0a20 2020 2020 2020 2050 6173 7320  al.        Pass 
+0001eb50: 4661 6c73 6520 746f 2073 6f72 7420 6279  False to sort by
+0001eb60: 2064 6573 6365 6e64 696e 6720 6f72 6465   descending orde
+0001eb70: 722e 0a20 2020 2073 7461 7274 203a 203a  r..    start : :
+0001eb80: 6f62 6a3a 6069 6e74 602c 206f 7074 696f  obj:`int`, optio
+0001eb90: 6e61 6c0a 2020 2020 2020 2020 5374 6172  nal.        Star
+0001eba0: 7420 6f6e 206f 7220 6162 6f76 6520 7468  t on or above th
+0001ebb0: 6973 2054 5043 2e0a 2020 2020 2222 220a  is TPC..    """.
+0001ebc0: 2020 2020 7265 7320 3d20 736f 7274 6564      res = sorted
+0001ebd0: 2874 7063 732c 206b 6579 3d6c 616d 6264  (tpcs, key=lambd
+0001ebe0: 6120 783a 2028 6669 6674 6873 3270 6328  a x: (fifths2pc(
+0001ebf0: 7829 2c20 2d78 2929 0a20 2020 2069 6620  x), -x)).    if 
+0001ec00: 7374 6172 7420 6973 206e 6f74 204e 6f6e  start is not Non
+0001ec10: 653a 0a20 2020 2020 2020 2070 6373 203d  e:.        pcs =
+0001ec20: 205b 6669 6674 6873 3270 6328 7470 6329   [fifths2pc(tpc)
+0001ec30: 2066 6f72 2074 7063 2069 6e20 7265 735d   for tpc in res]
+0001ec40: 0a20 2020 2020 2020 2073 7461 7274 203d  .        start =
+0001ec50: 2066 6966 7468 7332 7063 2873 7461 7274   fifths2pc(start
+0001ec60: 290a 2020 2020 2020 2020 6920 3d20 300a  ).        i = 0.
+0001ec70: 2020 2020 2020 2020 7768 696c 6520 6920          while i 
+0001ec80: 3c20 6c65 6e28 7063 7329 202d 2031 2061  < len(pcs) - 1 a
+0001ec90: 6e64 2070 6373 5b69 5d20 3c20 7374 6172  nd pcs[i] < star
+0001eca0: 743a 0a20 2020 2020 2020 2020 2020 2069  t:.            i
+0001ecb0: 202b 3d20 310a 2020 2020 2020 2020 7265   += 1.        re
+0001ecc0: 7320 3d20 7265 735b 693a 5d20 2b20 7265  s = res[i:] + re
+0001ecd0: 735b 3a69 5d0a 2020 2020 7265 7475 726e  s[:i].    return
+0001ece0: 2072 6573 2069 6620 6173 6365 6e64 696e   res if ascendin
+0001ecf0: 6720 656c 7365 206c 6973 7428 7265 7665  g else list(reve
+0001ed00: 7273 6564 2872 6573 2929 0a0a 0a40 6675  rsed(res))...@fu
+0001ed10: 6e63 7469 6f6e 5f6c 6f67 6765 720a 6465  nction_logger.de
+0001ed20: 6620 7370 6c69 745f 616c 7465 726e 6174  f split_alternat
+0001ed30: 6976 6573 2864 662c 2063 6f6c 756d 6e3d  ives(df, column=
+0001ed40: 276c 6162 656c 272c 2072 6567 6578 3d72  'label', regex=r
+0001ed50: 222d 283f 2128 5c64 7c62 2b5c 647c 5c23  "-(?!(\d|b+\d|\#
+0001ed60: 2b5c 6429 2922 2c20 6d61 783d 322c 2069  +\d))", max=2, i
+0001ed70: 6e70 6c61 6365 3d46 616c 7365 2c20 616c  nplace=False, al
+0001ed80: 7465 726e 6174 6976 6573 5f6f 6e6c 793d  ternatives_only=
+0001ed90: 4661 6c73 6529 3a0a 2020 2020 2222 220a  False):.    """.
+0001eda0: 2020 2020 5370 6c69 7473 206c 6162 656c      Splits label
+0001edb0: 7320 7468 6174 2063 6f6d 6520 7769 7468  s that come with
+0001edc0: 2061 6e20 616c 7465 726e 6174 6976 6520   an alternative 
+0001edd0: 7365 7061 7261 7465 6420 6279 2027 2d27  separated by '-'
+0001ede0: 2061 6e64 2061 6464 730a 2020 2020 6120   and adds.    a 
+0001edf0: 6e65 7720 636f 6c75 6d6e 2e20 4f6e 6c79  new column. Only
+0001ee00: 206f 6e65 2061 6c74 6572 6e61 7469 7665   one alternative
+0001ee10: 2069 7320 7461 6b65 6e20 696e 746f 2061   is taken into a
+0001ee20: 6363 6f75 6e74 2e20 6064 6660 2069 730a  ccount. `df` is.
+0001ee30: 2020 2020 6d75 7461 7465 6420 696e 706c      mutated inpl
+0001ee40: 6163 652e 0a0a 2020 2020 5061 7261 6d65  ace...    Parame
+0001ee50: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+0001ee60: 2d2d 2d0a 2020 2020 6466 203a 203a 6f62  ---.    df : :ob
+0001ee70: 6a3a 6070 616e 6461 732e 4461 7461 4672  j:`pandas.DataFr
+0001ee80: 616d 6560 0a20 2020 2020 2020 2044 6174  ame`.        Dat
+0001ee90: 6166 7261 6d65 2077 6865 7265 206f 6e65  aframe where one
+0001eea0: 2063 6f6c 756d 6e20 636f 6e74 6169 6e73   column contains
+0001eeb0: 2044 434d 4c20 6368 6f72 6420 6c61 6265   DCML chord labe
+0001eec0: 6c73 2e0a 2020 2020 636f 6c75 6d6e 203a  ls..    column :
+0001eed0: 203a 6f62 6a3a 6073 7472 602c 206f 7074   :obj:`str`, opt
+0001eee0: 696f 6e61 6c0a 2020 2020 2020 2020 4e61  ional.        Na
+0001eef0: 6d65 206f 6620 7468 6520 636f 6c75 6d6e  me of the column
+0001ef00: 2074 6861 7420 686f 6c64 7320 7468 6520   that holds the 
+0001ef10: 6861 726d 6f6e 7920 6c61 6265 6c73 2e0a  harmony labels..
+0001ef20: 2020 2020 7265 6765 7820 3a20 3a6f 626a      regex : :obj
+0001ef30: 3a60 7374 7260 2c20 6f70 7469 6f6e 616c  :`str`, optional
+0001ef40: 0a20 2020 2020 2020 2054 6865 2072 6567  .        The reg
+0001ef50: 756c 6172 2065 7870 7265 7373 696f 6e20  ular expression 
+0001ef60: 286f 7220 7369 6d70 6c65 2073 7472 696e  (or simple strin
+0001ef70: 6729 2074 6861 7420 6465 7465 6374 7320  g) that detects 
+0001ef80: 7468 6520 6368 6172 6163 7465 7220 636f  the character co
+0001ef90: 6d62 696e 6174 696f 6e20 7573 6564 2074  mbination used t
+0001efa0: 6f20 7365 7061 7261 7465 2061 6c74 6572  o separate alter
+0001efb0: 6e61 7469 7665 2061 6e6e 6f74 6174 696f  native annotatio
+0001efc0: 6e73 2e0a 2020 2020 2020 2020 4279 2064  ns..        By d
+0001efd0: 6566 6175 6c74 2c20 616c 7465 726e 6174  efault, alternat
+0001efe0: 6976 6573 2061 7265 2073 6570 6172 6174  ives are separat
+0001eff0: 6564 2062 7920 6120 272d 2720 7468 6174  ed by a '-' that
+0001f000: 2064 6f65 7320 6e6f 7420 7072 6563 6564   does not preced
+0001f010: 6520 6120 7363 616c 6520 6465 6772 6565  e a scale degree
+0001f020: 2073 7563 6820 6173 2027 6236 2720 6f72   such as 'b6' or
+0001f030: 2027 3327 2e0a 2020 2020 6d61 7820 3a20   '3'..    max : 
+0001f040: 3a6f 626a 3a60 696e 7460 2c20 6f70 7469  :obj:`int`, opti
+0001f050: 6f6e 616c 0a20 2020 2020 2020 204d 6178  onal.        Max
+0001f060: 696d 756d 206e 756d 6265 7220 6f66 2061  imum number of a
+0001f070: 646d 6974 7465 6420 616c 7465 726e 6174  dmitted alternat
+0001f080: 6976 6573 2c20 6465 6661 756c 7473 2074  ives, defaults t
+0001f090: 6f20 322e 0a20 2020 2069 6e70 6c61 6365  o 2..    inplace
+0001f0a0: 203a 203a 6f62 6a3a 6062 6f6f 6c60 2c20   : :obj:`bool`, 
+0001f0b0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0001f0c0: 2050 6173 7320 5472 7565 2069 6620 796f   Pass True if yo
+0001f0d0: 7520 7761 6e74 2074 6f20 6d75 7461 7465  u want to mutate
+0001f0e0: 2060 6064 6660 602e 0a20 2020 2061 6c74   ``df``..    alt
+0001f0f0: 6572 6e61 7469 7665 735f 6f6e 6c79 203a  ernatives_only :
+0001f100: 203a 6f62 6a3a 6062 6f6f 6c60 2c20 6f70   :obj:`bool`, op
+0001f110: 7469 6f6e 616c 0a20 2020 2020 2020 2042  tional.        B
+0001f120: 7920 6465 6661 756c 7420 7468 6520 616c  y default the al
+0001f130: 7465 726e 6174 6976 6573 2061 7265 2061  ternatives are a
+0001f140: 6464 6564 2074 6f20 7468 6520 6f72 6967  dded to the orig
+0001f150: 696e 616c 2044 6174 6146 7261 6d65 2028  inal DataFrame (
+0001f160: 6060 696e 706c 6163 6560 6020 6f72 206e  ``inplace`` or n
+0001f170: 6f74 292e 0a20 2020 2020 2020 2050 6173  ot)..        Pas
+0001f180: 7320 5472 7565 2069 6620 796f 7520 6a75  s True if you ju
+0001f190: 7374 206e 6565 6420 7468 6520 7370 6c69  st need the spli
+0001f1a0: 7420 616c 7465 726e 6174 6976 6573 2e0a  t alternatives..
+0001f1b0: 0a20 2020 2045 7861 6d70 6c65 0a20 2020  .    Example.   
+0001f1c0: 202d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e   -------.    >>>
+0001f1d0: 2069 6d70 6f72 7420 7061 6e64 6173 2061   import pandas a
+0001f1e0: 7320 7064 0a20 2020 203e 3e3e 206c 6162  s pd.    >>> lab
+0001f1f0: 656c 7320 3d20 7064 2e72 6561 645f 6373  els = pd.read_cs
+0001f200: 7628 276c 6162 656c 732e 6373 7627 290a  v('labels.csv').
+0001f210: 2020 2020 3e3e 3e20 7370 6c69 745f 616c      >>> split_al
+0001f220: 7465 726e 6174 6976 6573 286c 6162 656c  ternatives(label
+0001f230: 732c 2069 6e70 6c61 6365 3d54 7275 6529  s, inplace=True)
+0001f240: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+0001f250: 6e6f 7420 696e 706c 6163 653a 0a20 2020  not inplace:.   
+0001f260: 2020 2020 2064 6620 3d20 6466 2e63 6f70       df = df.cop
+0001f270: 7928 290a 2020 2020 616c 7465 726e 6174  y().    alternat
+0001f280: 6976 6573 203d 2064 665b 636f 6c75 6d6e  ives = df[column
+0001f290: 5d2e 7374 722e 7370 6c69 7428 7265 6765  ].str.split(rege
+0001f2a0: 782c 2065 7870 616e 643d 5472 7565 290a  x, expand=True).
+0001f2b0: 2020 2020 616c 7465 726e 6174 6976 6573      alternatives
+0001f2c0: 2e64 726f 706e 6128 6178 6973 3d31 2c20  .dropna(axis=1, 
+0001f2d0: 686f 773d 2761 6c6c 272c 2069 6e70 6c61  how='all', inpla
+0001f2e0: 6365 3d54 7275 6529 0a20 2020 2061 6c74  ce=True).    alt
+0001f2f0: 6572 6e61 7469 7665 732e 636f 6c75 6d6e  ernatives.column
+0001f300: 7320 3d20 7261 6e67 6528 616c 7465 726e  s = range(altern
+0001f310: 6174 6976 6573 2e73 6861 7065 5b31 5d29  atives.shape[1])
+0001f320: 0a20 2020 2069 6620 616c 7465 726e 6174  .    if alternat
+0001f330: 6976 6573 5f6f 6e6c 793a 0a20 2020 2020  ives_only:.     
+0001f340: 2020 2063 6f6c 756d 6e73 203d 205b 636f     columns = [co
+0001f350: 6c75 6d6e 5d20 2b20 5b66 2261 6c74 5f7b  lumn] + [f"alt_{
+0001f360: 636f 6c75 6d6e 7d22 2069 6620 6920 3d3d  column}" if i ==
+0001f370: 2031 2065 6c73 6520 6622 616c 747b 697d   1 else f"alt{i}
+0001f380: 5f7b 636f 6c75 6d6e 7d22 2066 6f72 2069  _{column}" for i
+0001f390: 2069 6e20 616c 7465 726e 6174 6976 6573   in alternatives
+0001f3a0: 2e63 6f6c 756d 6e73 5b31 3a5d 5d0a 2020  .columns[1:]].  
+0001f3b0: 2020 2020 2020 616c 7465 726e 6174 6976        alternativ
+0001f3c0: 6573 2e63 6f6c 756d 6e73 203d 2063 6f6c  es.columns = col
+0001f3d0: 756d 6e73 0a20 2020 2020 2020 2072 6574  umns.        ret
+0001f3e0: 7572 6e20 616c 7465 726e 6174 6976 6573  urn alternatives
+0001f3f0: 2e69 6c6f 635b 3a2c 203a 6d61 785d 0a20  .iloc[:, :max]. 
+0001f400: 2020 2069 6620 6c65 6e28 616c 7465 726e     if len(altern
+0001f410: 6174 6976 6573 2e63 6f6c 756d 6e73 2920  atives.columns) 
+0001f420: 3e20 313a 0a20 2020 2020 2020 206c 6f67  > 1:.        log
+0001f430: 6765 722e 6465 6275 6728 224c 6162 656c  ger.debug("Label
+0001f440: 7320 7370 6c69 7420 696e 746f 2061 6c74  s split into alt
+0001f450: 6572 6e61 7469 7665 732e 2229 0a20 2020  ernatives.").   
+0001f460: 2020 2020 2064 662e 6c6f 635b 3a2c 2063       df.loc[:, c
+0001f470: 6f6c 756d 6e5d 203d 2061 6c74 6572 6e61  olumn] = alterna
+0001f480: 7469 7665 735b 305d 0a20 2020 2020 2020  tives[0].       
+0001f490: 2070 6f73 6974 696f 6e20 3d20 6466 2e63   position = df.c
+0001f4a0: 6f6c 756d 6e73 2e67 6574 5f6c 6f63 2863  olumns.get_loc(c
+0001f4b0: 6f6c 756d 6e29 202b 2031 0a20 2020 2020  olumn) + 1.     
+0001f4c0: 2020 2066 6f72 2069 2069 6e20 616c 7465     for i in alte
+0001f4d0: 726e 6174 6976 6573 2e63 6f6c 756d 6e73  rnatives.columns
+0001f4e0: 5b31 3a5d 3a0a 2020 2020 2020 2020 2020  [1:]:.          
+0001f4f0: 2020 6966 2069 203d 3d20 6d61 783a 0a20    if i == max:. 
+0001f500: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001f510: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+0001f520: 2061 6c74 5f6e 616d 6520 3d20 6622 616c   alt_name = f"al
+0001f530: 745f 7b63 6f6c 756d 6e7d 2220 6966 2069  t_{column}" if i
+0001f540: 203d 3d20 3120 656c 7365 2066 2261 6c74   == 1 else f"alt
+0001f550: 7b69 7d5f 7b63 6f6c 756d 6e7d 220a 2020  {i}_{column}".  
+0001f560: 2020 2020 2020 2020 2020 6466 2e69 6e73            df.ins
+0001f570: 6572 7428 706f 7369 7469 6f6e 2c20 616c  ert(position, al
+0001f580: 745f 6e61 6d65 2c20 616c 7465 726e 6174  t_name, alternat
+0001f590: 6976 6573 5b69 5d2e 6669 6c6c 6e61 2870  ives[i].fillna(p
+0001f5a0: 642e 4e41 2929 2020 2320 7265 706c 6163  d.NA))  # replac
+0001f5b0: 6520 4e6f 6e65 2062 7920 4e41 0a20 2020  e None by NA.   
+0001f5c0: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
+0001f5d0: 6e20 2b3d 2031 0a20 2020 2020 2020 2069  n += 1.        i
+0001f5e0: 6620 6c65 6e28 616c 7465 726e 6174 6976  f len(alternativ
+0001f5f0: 6573 2e63 6f6c 756d 6e73 2920 3e20 6d61  es.columns) > ma
+0001f600: 783a 0a20 2020 2020 2020 2020 2020 206c  x:.            l
+0001f610: 6f67 6765 722e 7761 726e 696e 6728 0a20  ogger.warning(. 
+0001f620: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001f630: 224d 6f72 6520 7468 616e 207b 6d61 787d  "More than {max}
+0001f640: 2061 6c74 6572 6e61 7469 7665 7320 6172   alternatives ar
+0001f650: 6520 6e6f 7420 7461 6b65 6e20 696e 746f  e not taken into
+0001f660: 2061 6363 6f75 6e74 3a5c 6e7b 616c 7465   account:\n{alte
+0001f670: 726e 6174 6976 6573 5b61 6c74 6572 6e61  rnatives[alterna
+0001f680: 7469 7665 735b 325d 2e6e 6f74 6e61 2829  tives[2].notna()
+0001f690: 5d7d 2229 0a20 2020 2065 6c73 653a 0a20  ]}").    else:. 
+0001f6a0: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+0001f6b0: 6275 6728 2243 6f6e 7461 696e 7320 6e6f  bug("Contains no
+0001f6c0: 2061 6c74 6572 6e61 7469 7665 206c 6162   alternative lab
+0001f6d0: 656c 732e 2229 0a20 2020 2069 6620 6e6f  els.").    if no
+0001f6e0: 7420 696e 706c 6163 653a 0a20 2020 2020  t inplace:.     
+0001f6f0: 2020 2072 6574 7572 6e20 6466 0a0a 0a0a     return df....
+0001f700: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
+0001f710: 0a64 6566 2073 706c 6974 5f6e 6f74 655f  .def split_note_
+0001f720: 6e61 6d65 286e 6e2c 2063 6f75 6e74 3d46  name(nn, count=F
+0001f730: 616c 7365 293a 0a20 2020 2022 2222 2053  alse):.    """ S
+0001f740: 706c 6974 7320 6120 6e6f 7465 206e 616d  plits a note nam
+0001f750: 6520 7375 6368 2061 7320 2741 6227 2069  e such as 'Ab' i
+0001f760: 6e74 6f20 6163 6369 6465 6e74 616c 7320  nto accidentals 
+0001f770: 616e 6420 6e61 6d65 2e0a 0a20 2020 206e  and name...    n
+0001f780: 6e20 3a20 3a6f 626a 3a60 7374 7260 0a20  n : :obj:`str`. 
+0001f790: 2020 2020 2020 204e 6f74 6520 6e61 6d65         Note name
+0001f7a0: 2e0a 2020 2020 636f 756e 7420 3a20 3a6f  ..    count : :o
+0001f7b0: 626a 3a60 626f 6f6c 602c 206f 7074 696f  bj:`bool`, optio
+0001f7c0: 6e61 6c0a 2020 2020 2020 2020 5061 7373  nal.        Pass
+0001f7d0: 2054 7275 6520 746f 2067 6574 2074 6865   True to get the
+0001f7e0: 2061 6363 6964 656e 7461 6c73 2061 7320   accidentals as 
+0001f7f0: 696e 7465 6765 7220 7261 7468 6572 2074  integer rather t
+0001f800: 6861 6e20 6173 2073 7472 696e 672e 0a20  han as string.. 
+0001f810: 2020 2022 2222 0a20 2020 206d 203d 2072     """.    m = r
+0001f820: 652e 6d61 7463 6828 225e 285b 412d 475d  e.match("^([A-G]
+0001f830: 7c5b 612d 675d 2928 232a 7c62 2a29 2422  |[a-g])(#*|b*)$"
+0001f840: 2c20 7374 7228 6e6e 2929 0a20 2020 2069  , str(nn)).    i
+0001f850: 6620 6d20 6973 204e 6f6e 653a 0a20 2020  f m is None:.   
+0001f860: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
+0001f870: 7228 6e6e 202b 2022 2069 7320 6e6f 7420  r(nn + " is not 
+0001f880: 6120 7661 6c69 6420 7363 616c 6520 6465  a valid scale de
+0001f890: 6772 6565 2e22 290a 2020 2020 2020 2020  gree.").        
+0001f8a0: 7265 7475 726e 204e 6f6e 652c 204e 6f6e  return None, Non
+0001f8b0: 650a 2020 2020 6e6f 7465 5f6e 616d 652c  e.    note_name,
+0001f8c0: 2061 6363 6964 656e 7461 6c73 203d 206d   accidentals = m
+0001f8d0: 2e67 726f 7570 2831 292c 206d 2e67 726f  .group(1), m.gro
+0001f8e0: 7570 2832 290a 2020 2020 6966 2063 6f75  up(2).    if cou
+0001f8f0: 6e74 3a0a 2020 2020 2020 2020 6163 6369  nt:.        acci
+0001f900: 6465 6e74 616c 7320 3d20 6163 6369 6465  dentals = accide
+0001f910: 6e74 616c 732e 636f 756e 7428 2723 2729  ntals.count('#')
+0001f920: 202d 2061 6363 6964 656e 7461 6c73 2e63   - accidentals.c
+0001f930: 6f75 6e74 2827 6227 290a 2020 2020 7265  ount('b').    re
+0001f940: 7475 726e 2061 6363 6964 656e 7461 6c73  turn accidentals
+0001f950: 2c20 6e6f 7465 5f6e 616d 650a 0a0a 4066  , note_name...@f
+0001f960: 756e 6374 696f 6e5f 6c6f 6767 6572 0a64  unction_logger.d
+0001f970: 6566 2073 706c 6974 5f73 6361 6c65 5f64  ef split_scale_d
+0001f980: 6567 7265 6528 7364 2c20 636f 756e 743d  egree(sd, count=
+0001f990: 4661 6c73 6529 3a0a 2020 2020 2222 2220  False):.    """ 
+0001f9a0: 5370 6c69 7473 2061 2073 6361 6c65 2064  Splits a scale d
+0001f9b0: 6567 7265 6520 7375 6368 2061 7320 2762  egree such as 'b
+0001f9c0: 6256 4927 206f 7220 2762 3627 2069 6e74  bVI' or 'b6' int
+0001f9d0: 6f20 6163 6369 6465 6e74 616c 7320 616e  o accidentals an
+0001f9e0: 6420 6e75 6d65 7261 6c2e 0a0a 2020 2020  d numeral...    
+0001f9f0: 7364 203a 203a 6f62 6a3a 6073 7472 600a  sd : :obj:`str`.
+0001fa00: 2020 2020 2020 2020 5363 616c 6520 6465          Scale de
+0001fa10: 6772 6565 2e0a 2020 2020 636f 756e 7420  gree..    count 
+0001fa20: 3a20 3a6f 626a 3a60 626f 6f6c 602c 206f  : :obj:`bool`, o
+0001fa30: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0001fa40: 5061 7373 2054 7275 6520 746f 2067 6574  Pass True to get
+0001fa50: 2074 6865 2061 6363 6964 656e 7461 6c73   the accidentals
+0001fa60: 2061 7320 696e 7465 6765 7220 7261 7468   as integer rath
+0001fa70: 6572 2074 6861 6e20 6173 2073 7472 696e  er than as strin
+0001fa80: 672e 0a20 2020 2022 2222 0a20 2020 206d  g..    """.    m
+0001fa90: 203d 2072 652e 6d61 7463 6828 7222 5e28   = re.match(r"^(
+0001faa0: 232a 7c62 2a29 2856 4949 7c56 497c 567c  #*|b*)(VII|VI|V|
+0001fab0: 4956 7c49 4949 7c49 497c 497c 7669 697c  IV|III|II|I|vii|
+0001fac0: 7669 7c76 7c69 767c 6969 697c 6969 7c69  vi|v|iv|iii|ii|i
+0001fad0: 7c5c 6429 2422 2c20 7374 7228 7364 2929  |\d)$", str(sd))
+0001fae0: 0a20 2020 2069 6620 6d20 6973 204e 6f6e  .    if m is Non
+0001faf0: 653a 0a20 2020 2020 2020 2069 6620 272f  e:.        if '/
+0001fb00: 2720 696e 2073 643a 0a20 2020 2020 2020  ' in sd:.       
+0001fb10: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
+0001fb20: 7228 6622 7b73 647d 206e 6565 6473 2074  r(f"{sd} needs t
+0001fb30: 6f20 6265 2072 6573 6f6c 7665 642c 2077  o be resolved, w
+0001fb40: 6869 6368 2072 6571 7569 7265 7320 696e  hich requires in
+0001fb50: 666f 726d 6174 696f 6e20 6162 6f75 7420  formation about 
+0001fb60: 7468 6520 6d6f 6465 206f 6620 7468 6520  the mode of the 
+0001fb70: 6c6f 6361 6c20 6b65 792e 2022 0a20 2020  local key. ".   
+0001fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb90: 2020 2020 2020 6622 596f 7520 6361 6e20        f"You can 
+0001fba0: 7573 6520 6d73 332e 7574 696c 732e 7265  use ms3.utils.re
+0001fbb0: 736f 6c76 655f 7265 6c61 7469 7665 5f6b  solve_relative_k
+0001fbc0: 6579 7328 7363 616c 655f 6465 6772 6565  eys(scale_degree
+0001fbd0: 2c20 6973 5f6d 696e 6f72 5f63 6f6e 7465  , is_minor_conte
+0001fbe0: 7874 292e 2229 0a20 2020 2020 2020 2065  xt).").        e
+0001fbf0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001fc00: 206c 6f67 6765 722e 6572 726f 7228 6622   logger.error(f"
+0001fc10: 7b73 647d 2069 7320 6e6f 7420 6120 7661  {sd} is not a va
+0001fc20: 6c69 6420 7363 616c 6520 6465 6772 6565  lid scale degree
+0001fc30: 2e22 290a 2020 2020 2020 2020 7265 7475  .").        retu
+0001fc40: 726e 204e 6f6e 652c 204e 6f6e 650a 2020  rn None, None.  
+0001fc50: 2020 6163 632c 206e 756d 203d 206d 2e67    acc, num = m.g
+0001fc60: 726f 7570 2831 292c 206d 2e67 726f 7570  roup(1), m.group
+0001fc70: 2832 290a 2020 2020 6966 2063 6f75 6e74  (2).    if count
+0001fc80: 3a0a 2020 2020 2020 2020 6163 6320 3d20  :.        acc = 
+0001fc90: 6163 632e 636f 756e 7428 2723 2729 202d  acc.count('#') -
+0001fca0: 2061 6363 2e63 6f75 6e74 2827 6227 290a   acc.count('b').
+0001fcb0: 2020 2020 7265 7475 726e 2061 6363 2c20      return acc, 
+0001fcc0: 6e75 6d0a 0a0a 2320 6465 6620 6368 756e  num...# def chun
+0001fcd0: 6b73 7472 696e 6728 7374 7269 6e67 2c20  kstring(string, 
+0001fce0: 6c65 6e67 7468 3d38 3029 3a0a 2320 2020  length=80):.#   
+0001fcf0: 2020 2222 2220 4765 6e65 7261 7465 2063    """ Generate c
+0001fd00: 6875 6e6b 7320 6f66 2061 2067 6976 656e  hunks of a given
+0001fd10: 206c 656e 6774 6820 2222 220a 2320 2020   length """.#   
+0001fd20: 2020 7374 7269 6e67 203d 2073 7472 2873    string = str(s
+0001fd30: 7472 696e 6729 0a23 2020 2020 2072 6574  tring).#     ret
+0001fd40: 7572 6e20 2873 7472 696e 675b 3020 2b20  urn (string[0 + 
+0001fd50: 693a 6c65 6e67 7468 202b 2069 5d20 666f  i:length + i] fo
+0001fd60: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+0001fd70: 6c65 6e28 7374 7269 6e67 292c 206c 656e  len(string), len
+0001fd80: 6774 6829 290a 230a 230a 2320 6465 6620  gth)).#.#.# def 
+0001fd90: 7374 7269 6e67 326c 696e 6573 2873 7472  string2lines(str
+0001fda0: 696e 672c 206c 656e 6774 683d 3830 293a  ing, length=80):
+0001fdb0: 0a23 2020 2020 2022 2222 2055 7365 2063  .#     """ Use c
+0001fdc0: 6875 6e6b 7374 7269 6e67 2829 2061 6e64  hunkstring() and
+0001fdd0: 206d 616b 6520 6368 756e 6b73 2069 6e74   make chunks int
+0001fde0: 6f20 6c69 6e65 732e 2022 2222 0a23 2020  o lines. """.#  
+0001fdf0: 2020 2072 6574 7572 6e20 275c 6e27 2e6a     return '\n'.j
+0001fe00: 6f69 6e28 6368 756e 6b73 7472 696e 6728  oin(chunkstring(
+0001fe10: 7374 7269 6e67 2c20 6c65 6e67 7468 2929  string, length))
+0001fe20: 0a0a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  ...@function_log
+0001fe30: 6765 720a 6465 6620 7465 7374 5f62 696e  ger.def test_bin
+0001fe40: 6172 7928 636f 6d6d 616e 6429 3a0a 2020  ary(command):.  
+0001fe50: 2020 6966 2063 6f6d 6d61 6e64 2069 7320    if command is 
+0001fe60: 4e6f 6e65 3a0a 2020 2020 2020 2020 7265  None:.        re
+0001fe70: 7475 726e 2063 6f6d 6d61 6e64 0a20 2020  turn command.   
+0001fe80: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
+0001fe90: 6c65 2863 6f6d 6d61 6e64 293a 0a20 2020  le(command):.   
+0001fea0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+0001feb0: 6728 6622 466f 756e 6420 4d75 7365 5363  g(f"Found MuseSc
+0001fec0: 6f72 6520 6269 6e61 7279 3a20 7b63 6f6d  ore binary: {com
+0001fed0: 6d61 6e64 7d22 290a 2020 2020 2020 2020  mand}").        
+0001fee0: 7265 7475 726e 2063 6f6d 6d61 6e64 0a20  return command. 
+0001fef0: 2020 2069 6620 7768 6963 6828 636f 6d6d     if which(comm
+0001ff00: 616e 6429 2069 7320 4e6f 6e65 3a0a 2020  and) is None:.  
+0001ff10: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+0001ff20: 6e69 6e67 2866 224d 7573 6553 636f 7265  ning(f"MuseScore
+0001ff30: 2062 696e 6172 7920 6e6f 7420 666f 756e   binary not foun
+0001ff40: 6420 616e 6420 6e6f 7420 616e 2069 6e73  d and not an ins
+0001ff50: 7461 6c6c 6564 2063 6f6d 6d61 6e64 3a20  talled command: 
+0001ff60: 7b63 6f6d 6d61 6e64 7d22 290a 2020 2020  {command}").    
+0001ff70: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+0001ff80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001ff90: 2020 6c6f 6767 6572 2e64 6562 7567 2866    logger.debug(f
+0001ffa0: 2246 6f75 6e64 204d 7573 6553 636f 7265  "Found MuseScore
+0001ffb0: 2063 6f6d 6d61 6e64 3a20 7b63 6f6d 6d61   command: {comma
+0001ffc0: 6e64 7d22 290a 2020 2020 2020 2020 7265  nd}").        re
+0001ffd0: 7475 726e 2063 6f6d 6d61 6e64 0a0a 0a64  turn command...d
+0001ffe0: 6566 2074 7261 6e73 666f 726d 2864 662c  ef transform(df,
+0001fff0: 2066 756e 632c 2070 6172 616d 3263 6f6c   func, param2col
+00020000: 3d4e 6f6e 652c 2063 6f6c 756d 6e5f 7769  =None, column_wi
+00020010: 7365 3d46 616c 7365 2c20 2a2a 6b77 6172  se=False, **kwar
+00020020: 6773 293a 0a20 2020 2022 2222 2043 6f6d  gs):.    """ Com
+00020030: 7075 7465 2061 2066 756e 6374 696f 6e20  pute a function 
+00020040: 666f 7220 6576 6572 7920 726f 7720 6f66  for every row of
+00020050: 2061 2044 6174 6146 7261 6d65 2c20 7573   a DataFrame, us
+00020060: 696e 6720 7365 7665 7261 6c20 636f 6c73  ing several cols
+00020070: 2061 7320 6172 6775 6d65 6e74 732e 0a20   as arguments.. 
+00020080: 2020 2020 2020 2054 6865 2072 6573 756c         The resul
+00020090: 7420 6973 2074 6865 2073 616d 6520 6173  t is the same as
+000200a0: 2075 7369 6e67 2064 662e 6170 706c 7928   using df.apply(
+000200b0: 6c61 6d62 6461 2072 3a20 6675 6e63 2870  lambda r: func(p
+000200c0: 6172 616d 313d 722e 636f 6c31 2c20 7061  aram1=r.col1, pa
+000200d0: 7261 6d32 3d72 2e63 6f6c 322e 2e2e 292c  ram2=r.col2...),
+000200e0: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
+000200f0: 2062 7574 2069 7420 6f70 7469 6d69 7a65   but it optimize
+00020100: 7320 7468 6520 7072 6f63 6564 7572 6520  s the procedure 
+00020110: 6279 2070 7265 636f 6d70 7574 696e 6720  by precomputing 
+00020120: 6066 756e 6360 2066 6f72 2061 6c6c 206f  `func` for all o
+00020130: 6363 7572 7265 6e74 2070 6172 616d 6574  ccurrent paramet
+00020140: 6572 2063 6f6d 6269 6e61 7469 6f6e 732e  er combinations.
+00020150: 0a20 2020 2020 2020 2055 7365 733a 2069  .        Uses: i
+00020160: 6e73 7065 6374 2e67 6574 6675 6c6c 6172  nspect.getfullar
+00020170: 6773 7065 6328 290a 0a20 2020 2050 6172  gspec()..    Par
+00020180: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00020190: 2d2d 2d2d 2d2d 0a20 2020 2064 6620 3a20  ------.    df : 
+000201a0: 3a6f 626a 3a60 7061 6e64 6173 2e44 6174  :obj:`pandas.Dat
+000201b0: 6146 7261 6d65 6020 6f72 203a 6f62 6a3a  aFrame` or :obj:
+000201c0: 6070 616e 6461 732e 5365 7269 6573 600a  `pandas.Series`.
+000201d0: 2020 2020 2020 2020 4461 7461 6672 616d          Datafram
+000201e0: 6520 636f 6e74 6169 6e69 6e67 2066 756e  e containing fun
+000201f0: 6374 696f 6e20 7061 7261 6d65 7465 7273  ction parameters
+00020200: 2e0a 2020 2020 6675 6e63 203a 203a 6f62  ..    func : :ob
+00020210: 6a3a 6063 616c 6c61 626c 6560 0a20 2020  j:`callable`.   
+00020220: 2020 2020 2054 6865 2072 6573 756c 7420       The result 
+00020230: 6f66 2074 6869 7320 6675 6e63 7469 6f6e  of this function
+00020240: 2066 6f72 2065 7665 7279 2072 6f77 2077   for every row w
+00020250: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
+00020260: 0a20 2020 2070 6172 616d 3263 6f6c 203a  .    param2col :
+00020270: 203a 6f62 6a3a 6064 6963 7460 206f 7220   :obj:`dict` or 
+00020280: 3a6f 626a 3a60 6c69 7374 602c 206f 7074  :obj:`list`, opt
+00020290: 696f 6e61 6c0a 2020 2020 2020 2020 4d61  ional.        Ma
+000202a0: 7070 696e 6720 6672 6f6d 2070 6172 616d  pping from param
+000202b0: 6574 6572 206e 616d 6573 206f 6620 6066  eter names of `f
+000202c0: 756e 6360 2074 6f20 636f 6c75 6d6e 206e  unc` to column n
+000202d0: 616d 6573 2e0a 2020 2020 2020 2020 4966  ames..        If
+000202e0: 2079 6f75 2070 6173 7320 6120 6c69 7374   you pass a list
+000202f0: 206f 6620 636f 6c75 6d6e 206e 616d 6573   of column names
+00020300: 2c20 7468 6520 636f 6c75 6d6e 7327 2076  , the columns' v
+00020310: 616c 7565 7320 6172 6520 7061 7373 6564  alues are passed
+00020320: 2061 7320 706f 7369 7469 6f6e 616c 2061   as positional a
+00020330: 7267 756d 656e 7473 2e0a 2020 2020 2020  rguments..      
+00020340: 2020 5061 7373 204e 6f6e 6520 6966 2079    Pass None if y
+00020350: 6f75 2077 616e 7420 746f 2075 7365 2061  ou want to use a
+00020360: 6c6c 2063 6f6c 756d 6e73 2061 7320 706f  ll columns as po
+00020370: 7369 7469 6f6e 616c 2061 7267 756d 656e  sitional argumen
+00020380: 7473 2e0a 2020 2020 636f 6c75 6d6e 5f77  ts..    column_w
+00020390: 6973 6520 3a20 3a6f 626a 3a60 626f 6f6c  ise : :obj:`bool
+000203a0: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
+000203b0: 2020 2020 5061 7373 2054 7275 6520 6966      Pass True if
+000203c0: 2079 6f75 2077 616e 7420 746f 206d 6170   you want to map
+000203d0: 2060 6066 756e 6360 6020 746f 2074 6865   ``func`` to the
+000203e0: 2065 6c65 6d65 6e74 7320 6f66 2065 7665   elements of eve
+000203f0: 7279 2063 6f6c 756d 6e20 7365 7061 7261  ry column separa
+00020400: 7465 6c79 2e0a 2020 2020 2020 2020 5468  tely..        Th
+00020410: 6973 2069 7320 7369 6d70 6c79 2061 6e20  is is simply an 
+00020420: 6f70 7469 6d69 7a65 6420 7665 7273 696f  optimized versio
+00020430: 6e20 6f66 2064 662e 6170 706c 7928 6675  n of df.apply(fu
+00020440: 6e63 2920 6275 7420 616c 6c6f 7773 2066  nc) but allows f
+00020450: 6f72 206e 616d 696e 670a 2020 2020 2020  or naming.      
+00020460: 2020 636f 6c75 6d6e 7320 746f 2075 7365    columns to use
+00020470: 2061 7320 6675 6e63 7469 6f6e 2061 7267   as function arg
+00020480: 756d 656e 7473 2e20 4966 2070 6172 616d  uments. If param
+00020490: 3263 6f6c 2069 7320 4e6f 6e65 2c20 6060  2col is None, ``
+000204a0: 6675 6e63 6060 2069 7320 6d61 7070 6564  func`` is mapped
+000204b0: 0a20 2020 2020 2020 2074 6f20 7468 6520  .        to the 
+000204c0: 656c 656d 656e 7473 206f 6620 616c 6c20  elements of all 
+000204d0: 636f 6c75 6d6e 732c 206f 7468 6572 7769  columns, otherwi
+000204e0: 7365 2074 6f20 616c 6c20 636f 6c75 6d6e  se to all column
+000204f0: 7320 7468 6174 2061 7265 206e 6f74 206e  s that are not n
+00020500: 616d 6564 0a20 2020 2020 2020 2061 7320  amed.        as 
+00020510: 7061 7261 6d65 7465 7273 2069 6e20 6060  parameters in ``
+00020520: 7061 7261 6d32 636f 6c60 602e 0a20 2020  param2col``..   
+00020530: 2020 2020 2049 6e20 7468 6520 6361 7365       In the case
+00020540: 2077 6865 7265 2060 6066 756e 6360 6020   where ``func`` 
+00020550: 646f 6573 206e 6f74 2072 6571 7569 7265  does not require
+00020560: 2061 2070 6f73 6974 696f 6e61 6c20 6669   a positional fi
+00020570: 7273 7420 656c 656d 656e 7420 616e 640a  rst element and.
+00020580: 2020 2020 2020 2020 796f 7520 7761 6e74          you want
+00020590: 2074 6f20 7061 7373 2074 6865 2065 6c65   to pass the ele
+000205a0: 6d65 6e74 7320 6f66 2074 6865 2076 6172  ments of the var
+000205b0: 696f 7573 2063 6f6c 756d 6e73 2061 7320  ious columns as 
+000205c0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
+000205d0: 2c0a 2020 2020 2020 2020 6769 7665 2069  ,.        give i
+000205e0: 7420 6173 2070 6172 616d 3263 6f6c 3d7b  t as param2col={
+000205f0: 2766 756e 6374 696f 6e5f 6172 6775 6d65  'function_argume
+00020600: 6e74 273a 204e 6f6e 657d 0a20 2020 2069  nt': None}.    i
+00020610: 6e70 6c61 6365 203a 203a 6f62 6a3a 6062  nplace : :obj:`b
+00020620: 6f6f 6c60 2c20 6f70 7469 6f6e 616c 0a20  ool`, optional. 
+00020630: 2020 2020 2020 2050 6173 7320 5472 7565         Pass True
+00020640: 2069 6620 796f 7520 7761 6e74 2074 6f20   if you want to 
+00020650: 6d75 7461 7465 2060 6064 6660 6020 7261  mutate ``df`` ra
+00020660: 7468 6572 2074 6861 6e20 6765 7474 696e  ther than gettin
+00020670: 6720 616e 2061 6c74 6572 6564 2063 6f70  g an altered cop
+00020680: 792e 0a20 2020 202a 2a6b 7761 7267 7320  y..    **kwargs 
+00020690: 3a20 4f74 6865 7220 7061 7261 6d65 7465  : Other paramete
+000206a0: 7273 2070 6173 7365 6420 746f 2060 6066  rs passed to ``f
+000206b0: 756e 6360 602e 0a20 2020 2022 2222 0a20  unc``..    """. 
+000206c0: 2020 2069 6620 636f 6c75 6d6e 5f77 6973     if column_wis
+000206d0: 653a 0a20 2020 2020 2020 2069 6620 6e6f  e:.        if no
+000206e0: 7420 6466 2e5f 5f63 6c61 7373 5f5f 203d  t df.__class__ =
+000206f0: 3d20 7064 2e63 6f72 652e 7365 7269 6573  = pd.core.series
+00020700: 2e53 6572 6965 733a 0a20 2020 2020 2020  .Series:.       
+00020710: 2020 2020 2069 6620 7061 7261 6d32 636f       if param2co
+00020720: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
+00020730: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00020740: 6e20 6466 2e61 7070 6c79 2874 7261 6e73  n df.apply(trans
+00020750: 666f 726d 2c20 6172 6773 3d28 6675 6e63  form, args=(func
+00020760: 2c29 2c20 2a2a 6b77 6172 6773 290a 2020  ,), **kwargs).  
+00020770: 2020 2020 2020 2020 2020 6966 2070 6172            if par
+00020780: 616d 3263 6f6c 2e5f 5f63 6c61 7373 5f5f  am2col.__class__
+00020790: 203d 3d20 6469 6374 3a0a 2020 2020 2020   == dict:.      
+000207a0: 2020 2020 2020 2020 2020 7661 725f 6172            var_ar
+000207b0: 6720 3d20 5b6b 2066 6f72 206b 2c20 7620  g = [k for k, v 
+000207c0: 696e 2070 6172 616d 3263 6f6c 2e69 7465  in param2col.ite
+000207d0: 6d73 2829 2069 6620 7620 6973 204e 6f6e  ms() if v is Non
+000207e0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+000207f0: 2020 2061 7070 6c79 5f63 6f6c 7320 3d20     apply_cols = 
+00020800: 5b63 6f6c 2066 6f72 2063 6f6c 2069 6e20  [col for col in 
+00020810: 6466 2e63 6f6c 756d 6e73 2069 6620 6e6f  df.columns if no
+00020820: 7420 636f 6c20 696e 2070 6172 616d 3263  t col in param2c
+00020830: 6f6c 2e76 616c 7565 7328 295d 0a20 2020  ol.values()].   
+00020840: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+00020850: 6572 7420 6c65 6e28 0a20 2020 2020 2020  ert len(.       
+00020860: 2020 2020 2020 2020 2020 2020 2076 6172               var
+00020870: 5f61 7267 2920 3c20 322c 2066 224e 616d  _arg) < 2, f"Nam
+00020880: 6520 6f6e 6c79 206f 6e65 2076 6172 6961  e only one varia
+00020890: 626c 6520 6b65 7977 6f72 6420 6172 6775  ble keyword argu
+000208a0: 6d65 6e74 2061 7320 7768 6963 6820 7b61  ment as which {a
+000208b0: 7070 6c79 5f63 6f6c 737d 2061 7265 2075  pply_cols} are u
+000208c0: 7365 6420 7b27 6172 6775 6d65 6e74 273a  sed {'argument':
+000208d0: 204e 6f6e 657d 2e22 0a20 2020 2020 2020   None}.".       
+000208e0: 2020 2020 2020 2020 2076 6172 5f61 7267           var_arg
+000208f0: 203d 2076 6172 5f61 7267 5b30 5d20 6966   = var_arg[0] if
+00020900: 206c 656e 2876 6172 5f61 7267 2920 3e20   len(var_arg) > 
+00020910: 3020 656c 7365 2067 6574 6675 6c6c 6172  0 else getfullar
+00020920: 6773 7065 6328 6675 6e63 292e 6172 6773  gspec(func).args
+00020930: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00020940: 2020 2020 7061 7261 6d32 636f 6c20 3d20      param2col = 
+00020950: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
+00020960: 6e20 7061 7261 6d32 636f 6c2e 6974 656d  n param2col.item
+00020970: 7328 2920 6966 2076 2069 7320 6e6f 7420  s() if v is not 
+00020980: 4e6f 6e65 7d0a 2020 2020 2020 2020 2020  None}.          
+00020990: 2020 2020 2020 7265 7375 6c74 5f63 6f6c        result_col
+000209a0: 7320 3d20 7b63 6f6c 3a20 7472 616e 7366  s = {col: transf
+000209b0: 6f72 6d28 6466 2c20 6675 6e63 2c20 6469  orm(df, func, di
+000209c0: 6374 287b 7661 725f 6172 673a 2063 6f6c  ct({var_arg: col
+000209d0: 7d2c 202a 2a70 6172 616d 3263 6f6c 292c  }, **param2col),
+000209e0: 202a 2a6b 7761 7267 7329 2066 6f72 2063   **kwargs) for c
+000209f0: 6f6c 2069 6e0a 2020 2020 2020 2020 2020  ol in.          
+00020a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a10: 2020 2020 2061 7070 6c79 5f63 6f6c 737d       apply_cols}
+00020a20: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00020a30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00020a40: 2020 2061 7070 6c79 5f63 6f6c 7320 3d20     apply_cols = 
+00020a50: 5b63 6f6c 2066 6f72 2063 6f6c 2069 6e20  [col for col in 
+00020a60: 6466 2e63 6f6c 756d 6e73 2069 6620 6e6f  df.columns if no
+00020a70: 7420 636f 6c20 696e 2070 6172 616d 3263  t col in param2c
+00020a80: 6f6c 5d0a 2020 2020 2020 2020 2020 2020  ol].            
+00020a90: 2020 2020 7265 7375 6c74 5f63 6f6c 7320      result_cols 
+00020aa0: 3d20 7b63 6f6c 3a20 7472 616e 7366 6f72  = {col: transfor
+00020ab0: 6d28 6466 2c20 6675 6e63 2c20 5b63 6f6c  m(df, func, [col
+00020ac0: 5d20 2b20 7061 7261 6d32 636f 6c2c 202a  ] + param2col, *
+00020ad0: 2a6b 7761 7267 7329 2066 6f72 2063 6f6c  *kwargs) for col
+00020ae0: 2069 6e20 6170 706c 795f 636f 6c73 7d0a   in apply_cols}.
+00020af0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00020b00: 726e 2070 642e 4461 7461 4672 616d 6528  rn pd.DataFrame(
+00020b10: 7265 7375 6c74 5f63 6f6c 732c 2069 6e64  result_cols, ind
+00020b20: 6578 3d64 662e 696e 6465 7829 0a0a 2020  ex=df.index)..  
+00020b30: 2020 6966 2070 6172 616d 3263 6f6c 2e5f    if param2col._
+00020b40: 5f63 6c61 7373 5f5f 203d 3d20 6469 6374  _class__ == dict
+00020b50: 3a0a 2020 2020 2020 2020 7061 7261 6d5f  :.        param_
+00020b60: 7475 706c 6573 203d 206c 6973 7428 6466  tuples = list(df
+00020b70: 5b70 6172 616d 3263 6f6c 2e76 616c 7565  [param2col.value
+00020b80: 7328 295d 2e69 7465 7274 7570 6c65 7328  s()].itertuples(
+00020b90: 696e 6465 783d 4661 6c73 652c 206e 616d  index=False, nam
+00020ba0: 653d 4e6f 6e65 2929 0a20 2020 2020 2020  e=None)).       
+00020bb0: 2072 6573 756c 745f 6469 6374 203d 207b   result_dict = {
+00020bc0: 743a 2066 756e 6328 2a2a 7b61 3a20 6220  t: func(**{a: b 
+00020bd0: 666f 7220 612c 2062 2069 6e20 7a69 7028  for a, b in zip(
+00020be0: 7061 7261 6d32 636f 6c2e 6b65 7973 2829  param2col.keys()
+00020bf0: 2c20 7429 7d2c 202a 2a6b 7761 7267 7329  , t)}, **kwargs)
+00020c00: 2066 6f72 2074 2069 6e20 7365 7428 7061   for t in set(pa
+00020c10: 7261 6d5f 7475 706c 6573 297d 0a20 2020  ram_tuples)}.   
+00020c20: 2065 6c73 653a 0a20 2020 2020 2020 2069   else:.        i
+00020c30: 6620 6466 2e5f 5f63 6c61 7373 5f5f 203d  f df.__class__ =
+00020c40: 3d20 7064 2e63 6f72 652e 7365 7269 6573  = pd.core.series
+00020c50: 2e53 6572 6965 733a 0a20 2020 2020 2020  .Series:.       
+00020c60: 2020 2020 2069 6620 7061 7261 6d32 636f       if param2co
+00020c70: 6c20 6973 206e 6f74 204e 6f6e 653a 0a20  l is not None:. 
+00020c80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00020c90: 7269 6e74 2822 5768 656e 2027 6466 2720  rint("When 'df' 
+00020ca0: 6973 2061 2053 6572 6965 732c 2074 6865  is a Series, the
+00020cb0: 2070 6172 616d 6574 6572 2027 7061 7261   parameter 'para
+00020cc0: 6d32 636f 6c27 2068 6173 206e 6f20 7573  m2col' has no us
+00020cd0: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
+00020ce0: 2070 6172 616d 5f74 7570 6c65 7320 3d20   param_tuples = 
+00020cf0: 6466 2e76 616c 7565 730a 2020 2020 2020  df.values.      
+00020d00: 2020 2020 2020 7265 7375 6c74 5f64 6963        result_dic
+00020d10: 7420 3d20 7b74 3a20 6675 6e63 2874 2c20  t = {t: func(t, 
+00020d20: 2a2a 6b77 6172 6773 2920 666f 7220 7420  **kwargs) for t 
+00020d30: 696e 2073 6574 2870 6172 616d 5f74 7570  in set(param_tup
+00020d40: 6c65 7329 7d0a 2020 2020 2020 2020 656c  les)}.        el
+00020d50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00020d60: 6966 2070 6172 616d 3263 6f6c 2069 7320  if param2col is 
+00020d70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00020d80: 2020 2020 2020 7061 7261 6d5f 7475 706c        param_tupl
+00020d90: 6573 203d 206c 6973 7428 6466 2e69 7465  es = list(df.ite
+00020da0: 7274 7570 6c65 7328 696e 6465 783d 4661  rtuples(index=Fa
+00020db0: 6c73 652c 206e 616d 653d 4e6f 6e65 2929  lse, name=None))
+00020dc0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00020dd0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00020de0: 2020 2070 6172 616d 5f74 7570 6c65 7320     param_tuples 
+00020df0: 3d20 6c69 7374 2864 665b 6c69 7374 2870  = list(df[list(p
+00020e00: 6172 616d 3263 6f6c 295d 2e69 7465 7274  aram2col)].itert
+00020e10: 7570 6c65 7328 696e 6465 783d 4661 6c73  uples(index=Fals
+00020e20: 652c 206e 616d 653d 4e6f 6e65 2929 0a20  e, name=None)). 
+00020e30: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00020e40: 745f 6469 6374 203d 207b 743a 2066 756e  t_dict = {t: fun
+00020e50: 6328 2a74 2c20 2a2a 6b77 6172 6773 2920  c(*t, **kwargs) 
+00020e60: 666f 7220 7420 696e 2073 6574 2870 6172  for t in set(par
+00020e70: 616d 5f74 7570 6c65 7329 7d0a 2020 2020  am_tuples)}.    
+00020e80: 7769 7468 2077 6172 6e69 6e67 732e 6361  with warnings.ca
+00020e90: 7463 685f 7761 726e 696e 6773 2829 3a0a  tch_warnings():.
+00020ea0: 2020 2020 2020 2020 2320 7061 6e64 6173          # pandas
+00020eb0: 2064 6576 656c 6f70 6572 7320 646f 696e   developers doin
+00020ec0: 6720 7468 6569 7220 6d6f 7374 2061 6e6e  g their most ann
+00020ed0: 6f79 696e 6720 7468 696e 6720 3e3a 280a  oying thing >:(.
+00020ee0: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+00020ef0: 2e66 696c 7465 7277 6172 6e69 6e67 7328  .filterwarnings(
+00020f00: 0a20 2020 2020 2020 2020 2020 2022 6967  .            "ig
+00020f10: 6e6f 7265 222c 0a20 2020 2020 2020 2020  nore",.         
+00020f20: 2020 2063 6174 6567 6f72 793d 4675 7475     category=Futu
+00020f30: 7265 5761 726e 696e 672c 0a20 2020 2020  reWarning,.     
+00020f40: 2020 2020 2020 206d 6573 7361 6765 3d28         message=(
+00020f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020f60: 2022 2e2a 5468 6520 6465 6661 756c 7420   ".*The default 
+00020f70: 6474 7970 6520 666f 7220 656d 7074 7920  dtype for empty 
+00020f80: 5365 7269 6573 2e2a 220a 2020 2020 2020  Series.*".      
+00020f90: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00020fa0: 2029 0a20 2020 2020 2020 2072 6573 203d   ).        res =
+00020fb0: 2070 642e 5365 7269 6573 285b 7265 7375   pd.Series([resu
+00020fc0: 6c74 5f64 6963 745b 745d 2066 6f72 2074  lt_dict[t] for t
+00020fd0: 2069 6e20 7061 7261 6d5f 7475 706c 6573   in param_tuples
+00020fe0: 5d2c 2069 6e64 6578 3d64 662e 696e 6465  ], index=df.inde
+00020ff0: 7829 0a20 2020 2072 6574 7572 6e20 7265  x).    return re
+00021000: 730a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  s..@function_log
+00021010: 6765 720a 6465 6620 6164 6a61 6365 6e63  ger.def adjacenc
+00021020: 795f 6772 6f75 7073 2853 3a20 7064 2e53  y_groups(S: pd.S
+00021030: 6572 6965 732c 0a20 2020 2020 2020 2020  eries,.         
+00021040: 2020 2020 2020 2020 2020 2020 6e61 5f76              na_v
+00021050: 616c 7565 733a 204f 7074 696f 6e61 6c5b  alues: Optional[
+00021060: 7374 725d 203d 2027 6772 6f75 7027 2c0a  str] = 'group',.
+00021070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021080: 2020 2020 2070 7265 7665 6e74 5f6d 6572       prevent_mer
+00021090: 6765 3a20 626f 6f6c 203d 2046 616c 7365  ge: bool = False
+000210a0: 2920 2d3e 2054 7570 6c65 5b70 642e 5365  ) -> Tuple[pd.Se
+000210b0: 7269 6573 2c20 4469 6374 5b69 6e74 2c20  ries, Dict[int, 
+000210c0: 416e 795d 5d3a 0a20 2020 2022 2222 2054  Any]]:.    """ T
+000210d0: 7572 6e73 2061 2053 6572 6965 7320 696e  urns a Series in
+000210e0: 746f 2061 2053 6572 6965 7320 6f66 2061  to a Series of a
+000210f0: 7363 656e 6469 6e67 2069 6e74 6567 6572  scending integer
+00021100: 7320 7374 6172 7469 6e67 2066 726f 6d20  s starting from 
+00021110: 3120 7468 6174 2072 6566 6c65 6374 2067  1 that reflect g
+00021120: 726f 7570 7320 6f66 2073 7563 6365 7373  roups of success
+00021130: 6976 650a 2020 2020 6571 7561 6c20 7661  ive.    equal va
+00021140: 6c75 6573 2e20 5468 6572 6520 6172 6520  lues. There are 
+00021150: 7365 7665 7261 6c20 6f70 7469 6f6e 7320  several options 
+00021160: 6f66 2068 6f77 2074 6f20 6465 616c 2077  of how to deal w
+00021170: 6974 6820 4e41 2076 616c 7565 732e 0a0a  ith NA values...
+00021180: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00021190: 533a 2053 6572 6965 7320 696e 2077 6869  S: Series in whi
+000211a0: 6368 2074 6f20 6772 6f75 7020 6964 656e  ch to group iden
+000211b0: 7469 6361 6c20 6164 6a61 6365 6e74 2076  tical adjacent v
+000211c0: 616c 7565 7320 7769 7468 2065 6163 6820  alues with each 
+000211d0: 6f74 6865 722e 0a20 2020 2020 206e 615f  other..      na_
+000211e0: 7661 6c75 6573 3a0a 2020 2020 2020 2020  values:.        
+000211f0: 2020 7c20 2767 726f 7570 2720 6372 6561    | 'group' crea
+00021200: 7465 7320 696e 6469 7669 6475 616c 2067  tes individual g
+00021210: 726f 7570 7320 666f 7220 4e41 2076 616c  roups for NA val
+00021220: 7565 7320 2864 6566 6175 6c74 292e 0a20  ues (default).. 
+00021230: 2020 2020 2020 2020 207c 2027 6261 636b           | 'back
+00021240: 6669 6c6c 2720 6f72 2027 6266 696c 6c27  fill' or 'bfill'
+00021250: 2067 726f 7570 7320 4e41 2076 616c 7565   groups NA value
+00021260: 7320 7769 7468 2074 6865 2073 7562 7365  s with the subse
+00021270: 7175 656e 7420 6772 6f75 700a 2020 2020  quent group.    
+00021280: 2020 2020 2020 7c20 2770 6164 272c 2027        | 'pad', '
+00021290: 6666 696c 6c27 2067 726f 7570 7320 4e41  ffill' groups NA
+000212a0: 2076 616c 7565 7320 7769 7468 2074 6865   values with the
+000212b0: 2070 7265 6365 6469 6e67 2067 726f 7570   preceding group
+000212c0: 0a20 2020 2020 2020 2020 207c 2041 6e79  .          | Any
+000212d0: 206f 7468 6572 2073 7472 696e 6720 776f   other string wo
+000212e0: 726b 7320 6c69 6b65 2027 6772 6f75 7027  rks like 'group'
+000212f0: 2c20 7769 7468 2074 6865 2064 6966 6665  , with the diffe
+00021300: 7265 6e63 6520 7468 6174 2074 6865 2067  rence that the g
+00021310: 726f 7570 7320 7769 6c6c 2062 6520 6e61  roups will be na
+00021320: 6d65 6420 7769 7468 2074 6869 7320 7661  med with this va
+00021330: 6c75 652e 0a20 2020 2020 2020 2020 207c  lue..          |
+00021340: 2050 6173 7369 6e67 204e 6f6e 6520 6d65   Passing None me
+00021350: 616e 7320 4e41 2076 616c 7565 7320 2620  ans NA values & 
+00021360: 7261 6e67 6573 2061 7265 2062 6569 6e67  ranges are being
+00021370: 2069 676e 6f72 6564 2c20 692e 652e 2074   ignored, i.e. t
+00021380: 6865 7920 7769 6c6c 2061 6c73 6f20 6265  hey will also be
+00021390: 2070 7265 7365 6e74 2069 6e20 7468 6520   present in the 
+000213a0: 6f75 7470 7574 2061 6e64 2074 6865 0a20  output and the. 
+000213b0: 2020 2020 2020 2020 2020 2073 7562 7365             subse
+000213c0: 7175 656e 7420 7661 6c75 6520 7769 6c6c  quent value will
+000213d0: 2062 6520 6261 7365 6420 6f6e 2074 6865   be based on the
+000213e0: 2070 7265 6365 6469 6e67 2076 616c 7565   preceding value
+000213f0: 2e0a 2020 2020 2020 7072 6576 656e 745f  ..      prevent_
+00021400: 6d65 7267 653a 0a20 2020 2020 2020 2020  merge:.         
+00021410: 2042 7920 6465 6661 756c 742c 2069 6620   By default, if 
+00021420: 796f 7520 7573 6520 7468 6520 606e 615f  you use the `na_
+00021430: 7661 6c75 6573 6020 6172 6775 6d65 6e74  values` argument
+00021440: 2074 6f20 6669 6c6c 204e 4120 7661 6c75   to fill NA valu
+00021450: 6573 2c20 7468 6579 206d 6967 6874 206c  es, they might l
+00021460: 6561 6420 746f 2074 776f 2067 726f 7570  ead to two group
+00021470: 7320 6d65 7267 696e 672e 0a20 2020 2020  s merging..     
+00021480: 2020 2020 2050 6173 7320 5472 7565 2074       Pass True t
+00021490: 6f20 7072 6576 656e 7420 7468 6973 2e20  o prevent this. 
+000214a0: 466f 7220 6578 616d 706c 652c 2074 616b  For example, tak
+000214b0: 6520 7468 6520 7365 7175 656e 6365 205b  e the sequence [
+000214c0: 2761 272c 204e 412c 2027 6127 5d20 7769  'a', NA, 'a'] wi
+000214d0: 7468 2060 606e 615f 7661 6c75 6573 3d27  th ``na_values='
+000214e0: 6666 696c 6c27 6060 3a20 4279 2064 6566  ffill'``: By def
+000214f0: 6175 6c74 2c0a 2020 2020 2020 2020 2020  ault,.          
+00021500: 6974 2077 696c 6c20 6265 206d 6572 6765  it will be merge
+00021510: 6420 746f 206f 6e65 2073 696e 676c 6520  d to one single 
+00021520: 6772 6f75 7020 6060 5b31 2c20 312c 2031  group ``[1, 1, 1
+00021530: 5d2c 207b 313a 2027 6127 7d60 602e 2048  ], {1: 'a'}``. H
+00021540: 6f77 6576 6572 2c20 7061 7373 696e 6720  owever, passing 
+00021550: 6060 7072 6576 656e 745f 6d65 7267 653d  ``prevent_merge=
+00021560: 5472 7565 6060 2077 696c 6c0a 2020 2020  True`` will.    
+00021570: 2020 2020 2020 7265 7375 6c74 2069 6e20        result in 
+00021580: 6060 5b31 2c20 312c 2032 5d2c 207b 313a  ``[1, 1, 2], {1:
+00021590: 2027 6127 2c20 323a 2027 6127 7d60 602e   'a', 2: 'a'}``.
+000215a0: 0a0a 2020 2020 5265 7475 726e 733a 0a20  ..    Returns:. 
+000215b0: 2020 2020 2041 2073 6572 6965 7320 7769       A series wi
+000215c0: 7468 2069 6e63 7265 6173 696e 6720 696e  th increasing in
+000215d0: 7465 6765 7273 2074 6861 7420 6361 6e20  tegers that can 
+000215e0: 6265 2075 7365 6420 666f 7220 6772 6f75  be used for grou
+000215f0: 7069 6e67 2e0a 2020 2020 2020 4120 6469  ping..      A di
+00021600: 6374 696f 6e61 7279 206d 6170 7069 6e67  ctionary mapping
+00021610: 2074 6865 2069 6e74 6567 6572 7320 746f   the integers to
+00021620: 2074 6865 2067 726f 7570 6564 2076 616c   the grouped val
+00021630: 7565 732e 0a0a 2020 2020 2222 220a 2020  ues...    """.  
+00021640: 2020 7265 696e 6465 785f 666c 6167 203d    reindex_flag =
+00021650: 2046 616c 7365 0a20 2020 2023 2072 6569   False.    # rei
+00021660: 6e64 6578 2069 7320 7365 7420 746f 2054  ndex is set to T
+00021670: 7275 6520 696e 2063 6173 6573 2077 6865  rue in cases whe
+00021680: 7265 204e 4120 7661 6c75 6573 2061 7265  re NA values are
+00021690: 2062 6569 6e67 2065 7863 6c75 6465 6420   being excluded 
+000216a0: 6672 6f6d 2074 6865 206f 7065 7261 7469  from the operati
+000216b0: 6f6e 2061 6e64 2072 6573 746f 7265 6420  on and restored 
+000216c0: 6166 7465 7277 6172 6473 0a20 2020 2069  afterwards.    i
+000216d0: 6620 7072 6576 656e 745f 6d65 7267 653a  f prevent_merge:
+000216e0: 0a20 2020 2020 2020 2066 6f72 6365 645f  .        forced_
+000216f0: 6265 6769 6e6e 696e 6773 203d 2053 2e6e  beginnings = S.n
+00021700: 6f74 6e61 2829 2026 207e 532e 6e6f 746e  otna() & ~S.notn
+00021710: 6128 292e 7368 6966 7428 292e 6669 6c6c  a().shift().fill
+00021720: 6e61 2846 616c 7365 290a 2020 2020 6966  na(False).    if
+00021730: 206e 615f 7661 6c75 6573 2069 7320 4e6f   na_values is No
+00021740: 6e65 3a0a 2020 2020 2020 2020 6966 2053  ne:.        if S
+00021750: 2e69 736e 6128 292e 616e 7928 293a 0a20  .isna().any():. 
+00021760: 2020 2020 2020 2020 2020 2073 203d 2053             s = S
+00021770: 2e64 726f 706e 6128 290a 2020 2020 2020  .dropna().      
+00021780: 2020 2020 2020 7265 696e 6465 785f 666c        reindex_fl
+00021790: 6167 203d 2054 7275 650a 2020 2020 2020  ag = True.      
+000217a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000217b0: 2020 2020 7320 3d20 530a 2020 2020 656c      s = S.    el
+000217c0: 6966 206e 615f 7661 6c75 6573 203d 3d20  if na_values == 
+000217d0: 2767 726f 7570 273a 0a20 2020 2020 2020  'group':.       
+000217e0: 2073 203d 2053 0a20 2020 2065 6c69 6620   s = S.    elif 
+000217f0: 6e61 5f76 616c 7565 7320 696e 2028 2762  na_values in ('b
+00021800: 6163 6b66 696c 6c27 2c20 2762 6669 6c6c  ackfill', 'bfill
+00021810: 272c 2027 7061 6427 2c20 2766 6669 6c6c  ', 'pad', 'ffill
+00021820: 2729 3a0a 2020 2020 2020 2020 7320 3d20  '):.        s = 
+00021830: 532e 6669 6c6c 6e61 286d 6574 686f 643d  S.fillna(method=
+00021840: 6e61 5f76 616c 7565 7329 0a20 2020 2065  na_values).    e
+00021850: 6c73 653a 0a20 2020 2020 2020 2073 203d  lse:.        s =
+00021860: 2053 2e66 696c 6c6e 6128 7661 6c75 653d   S.fillna(value=
+00021870: 6e61 5f76 616c 7565 7329 0a0a 2020 2020  na_values)..    
+00021880: 6966 2073 2e69 736e 6128 292e 616e 7928  if s.isna().any(
+00021890: 293a 0a20 2020 2020 2020 2069 6620 6e61  ):.        if na
+000218a0: 5f76 616c 7565 7320 3d3d 2027 6772 6f75  _values == 'grou
+000218b0: 7027 3a0a 2020 2020 2020 2020 2020 2020  p':.            
+000218c0: 7368 6966 7465 6420 3d20 732e 7368 6966  shifted = s.shif
+000218d0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+000218e0: 6966 2070 642e 6973 6e75 6c6c 2853 2e69  if pd.isnull(S.i
+000218f0: 6c6f 635b 305d 293a 0a20 2020 2020 2020  loc[0]):.       
+00021900: 2020 2020 2020 2020 2073 6869 6674 6564           shifted
+00021910: 2e69 6c6f 635b 305d 203d 2054 7275 650a  .iloc[0] = True.
+00021920: 2020 2020 2020 2020 2020 2020 6265 6769              begi
+00021930: 6e6e 696e 6773 203d 207e 6e61 6e5f 6571  nnings = ~nan_eq
+00021940: 2873 2c20 7368 6966 7465 6429 0a20 2020  (s, shifted).   
+00021950: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00021960: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
+00021970: 726e 696e 6728 6622 4166 7465 7220 7472  rning(f"After tr
+00021980: 6561 7469 6e67 2074 6865 2053 6572 6965  eating the Serie
+00021990: 7320 277b 532e 6e61 6d65 7d27 2077 6974  s '{S.name}' wit
+000219a0: 6820 6e61 5f76 616c 7565 733d 277b 6e61  h na_values='{na
+000219b0: 5f76 616c 7565 737d 272c 2022 0a20 2020  _values}', ".   
+000219c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000219d0: 2020 2020 2020 2020 6622 7468 6572 6520          f"there 
+000219e0: 7765 7265 2073 7469 6c6c 207b 732e 6973  were still {s.is
+000219f0: 6e61 2829 2e73 756d 2829 7d20 4e41 2076  na().sum()} NA v
+00021a00: 616c 7565 7320 6c65 6674 2e22 290a 2020  alues left.").  
+00021a10: 2020 2020 2020 2020 2020 7320 3d20 732e            s = s.
+00021a20: 6472 6f70 6e61 2829 0a20 2020 2020 2020  dropna().       
+00021a30: 2020 2020 2062 6567 696e 6e69 6e67 7320       beginnings 
+00021a40: 3d20 2873 2021 3d20 732e 7368 6966 7428  = (s != s.shift(
+00021a50: 2929 2e66 696c 6c6e 6128 4661 6c73 6529  )).fillna(False)
+00021a60: 0a20 2020 2020 2020 2020 2020 2062 6567  .            beg
+00021a70: 696e 6e69 6e67 732e 696c 6f63 5b30 5d20  innings.iloc[0] 
+00021a80: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00021a90: 2020 2072 6569 6e64 6578 5f66 6c61 6720     reindex_flag 
+00021aa0: 3d20 5472 7565 0a20 2020 2065 6c73 653a  = True.    else:
+00021ab0: 0a20 2020 2020 2020 2062 6567 696e 6e69  .        beginni
+00021ac0: 6e67 7320 3d20 7320 213d 2073 2e73 6869  ngs = s != s.shi
+00021ad0: 6674 2829 0a20 2020 2020 2020 2062 6567  ft().        beg
+00021ae0: 696e 6e69 6e67 732e 696c 6f63 5b30 5d20  innings.iloc[0] 
+00021af0: 3d20 5472 7565 0a20 2020 2069 6620 7072  = True.    if pr
+00021b00: 6576 656e 745f 6d65 7267 653a 0a20 2020  event_merge:.   
+00021b10: 2020 2020 2062 6567 696e 6e69 6e67 7320       beginnings 
+00021b20: 7c3d 2066 6f72 6365 645f 6265 6769 6e6e  |= forced_beginn
+00021b30: 696e 6773 0a20 2020 2067 726f 7570 7320  ings.    groups 
+00021b40: 3d20 6265 6769 6e6e 696e 6773 2e63 756d  = beginnings.cum
+00021b50: 7375 6d28 290a 2020 2020 6e61 6d65 7320  sum().    names 
+00021b60: 3d20 6469 6374 2865 6e75 6d65 7261 7465  = dict(enumerate
+00021b70: 2873 5b62 6567 696e 6e69 6e67 735d 2c20  (s[beginnings], 
+00021b80: 3129 290a 2020 2020 6966 2072 6569 6e64  1)).    if reind
+00021b90: 6578 5f66 6c61 673a 0a20 2020 2020 2020  ex_flag:.       
+00021ba0: 2067 726f 7570 7320 3d20 6772 6f75 7073   groups = groups
+00021bb0: 2e72 6569 6e64 6578 2853 2e69 6e64 6578  .reindex(S.index
+00021bc0: 290a 2020 2020 7472 793a 0a20 2020 2020  ).    try:.     
+00021bd0: 2020 2072 6574 7572 6e20 7064 2e74 6f5f     return pd.to_
+00021be0: 6e75 6d65 7269 6328 6772 6f75 7073 292e  numeric(groups).
+00021bf0: 6173 7479 7065 2827 496e 7436 3427 292c  astype('Int64'),
+00021c00: 206e 616d 6573 0a20 2020 2065 7863 6570   names.    excep
+00021c10: 7420 5479 7065 4572 726f 723a 0a20 2020  t TypeError:.   
+00021c20: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
+00021c30: 696e 6728 6622 4572 726f 6e65 6f75 7320  ing(f"Erroneous 
+00021c40: 6f75 7463 6f6d 6520 7768 696c 6520 636f  outcome while co
+00021c50: 6d70 7574 696e 6720 6164 6a61 6365 6e63  mputing adjacenc
+00021c60: 7920 6772 6f75 7073 3a20 7b67 726f 7570  y groups: {group
+00021c70: 737d 2229 0a20 2020 2020 2020 2072 6574  s}").        ret
+00021c80: 7572 6e20 6772 6f75 7073 2c20 6e61 6d65  urn groups, name
+00021c90: 730a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  s..@function_log
+00021ca0: 6765 720a 6465 6620 756e 666f 6c64 5f6d  ger.def unfold_m
+00021cb0: 6561 7375 7265 735f 7461 626c 6528 6d65  easures_table(me
+00021cc0: 6173 7572 6573 3a20 7064 2e44 6174 6146  asures: pd.DataF
+00021cd0: 7261 6d65 2920 2d3e 204f 7074 696f 6e61  rame) -> Optiona
+00021ce0: 6c5b 7064 2e44 6174 6146 7261 6d65 5d3a  l[pd.DataFrame]:
+00021cf0: 0a20 2020 2022 2222 2052 6574 7572 6e73  .    """ Returns
+00021d00: 2061 2063 6f70 7920 6f66 2061 206d 6561   a copy of a mea
+00021d10: 7375 7265 7320 7461 626c 6520 7468 6174  sures table that
+00021d20: 2063 6f72 7265 7370 6f6e 6473 2074 6872   corresponds thr
+00021d30: 6f75 6768 2061 2073 7563 6365 7373 696f  ough a successio
+00021d40: 6e20 6f66 204d 4373 2077 6865 6e20 706c  n of MCs when pl
+00021d50: 6179 696e 6720 616c 6c20 7265 7065 6174  aying all repeat
+00021d60: 732e 0a20 2020 2054 6f20 6469 7374 696e  s..    To distin
+00021d70: 6775 6973 6820 6265 7477 6565 6e20 7265  guish between re
+00021d80: 7065 6174 6564 204d 4373 2061 6e64 204d  peated MCs and M
+00021d90: 4e73 2c20 6974 2061 6464 7320 7468 6520  Ns, it adds the 
+00021da0: 636f 6e74 696e 7565 7320 636f 6c75 6d6e  continues column
+00021db0: 2027 6d63 5f70 6c61 7974 6872 6f75 6768   'mc_playthrough
+00021dc0: 2720 2873 7461 7274 696e 6720 6174 2031  ' (starting at 1
+00021dd0: 2920 616e 640a 2020 2020 276d 6e5f 706c  ) and.    'mn_pl
+00021de0: 6179 7468 726f 7567 6827 2077 6869 6368  aythrough' which
+00021df0: 2063 6f6e 7461 696e 7320 7468 6520 7661   contains the va
+00021e00: 6c75 6573 206f 6620 276d 6e27 2061 7320  lues of 'mn' as 
+00021e10: 7374 7269 6e67 2077 6974 6820 6c65 7474  string with lett
+00021e20: 6572 7320 7b27 6127 2c20 2762 272c 202e  ers {'a', 'b', .
+00021e30: 2e2e 7d20 6170 7065 6e64 6564 2e0a 0a20  ..} appended... 
+00021e40: 2020 2041 7267 733a 0a20 2020 2020 206d     Args:.      m
+00021e50: 6561 7375 7265 733a 204d 6561 7375 7265  easures: Measure
+00021e60: 7320 7461 626c 6520 7769 7468 2063 6f6c  s table with col
+00021e70: 756d 6e73 205b 276d 6327 2c20 276e 6578  umns ['mc', 'nex
+00021e80: 7427 2c20 2764 6f6e 745f 636f 756e 7427  t', 'dont_count'
+00021e90: 5d0a 0a20 2020 2052 6574 7572 6e73 3a0a  ]..    Returns:.
+00021ea0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+00021eb0: 276d 635f 706c 6179 7468 726f 7567 6827  'mc_playthrough'
+00021ec0: 2069 6e20 6d65 6173 7572 6573 3a0a 2020   in measures:.  
+00021ed0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+00021ee0: 6f28 6622 5265 6365 6976 6564 2061 2064  o(f"Received a d
+00021ef0: 6174 6166 7261 6d65 2077 6974 6820 7468  ataframe with th
+00021f00: 6520 636f 6c75 6d6e 2027 6d63 5f70 6c61  e column 'mc_pla
+00021f10: 7974 6872 6f75 6768 2720 7468 6174 2069  ythrough' that i
+00021f20: 7320 616c 7265 6164 7920 756e 666f 6c64  s already unfold
+00021f30: 6564 2e20 5265 7475 726e 696e 6720 6173  ed. Returning as
+00021f40: 2069 732e 2229 0a20 2020 2020 2020 2072   is.").        r
+00021f50: 6574 7572 6e20 6d65 6173 7572 6573 0a20  eturn measures. 
+00021f60: 2020 2070 6c61 7974 6872 6f75 6768 326d     playthrough2m
+00021f70: 6320 3d20 6d61 6b65 5f70 6c61 7974 6872  c = make_playthr
+00021f80: 6f75 6768 326d 6328 6d65 6173 7572 6573  ough2mc(measures
+00021f90: 2c20 6c6f 6767 6572 3d6c 6f67 6765 7229  , logger=logger)
+00021fa0: 0a20 2020 2069 6620 706c 6179 7468 726f  .    if playthro
+00021fb0: 7567 6832 6d63 2069 7320 4e6f 6e65 206f  ugh2mc is None o
+00021fc0: 7220 6c65 6e28 706c 6179 7468 726f 7567  r len(playthroug
+00021fd0: 6832 6d63 2920 3d3d 2030 3a0a 2020 2020  h2mc) == 0:.    
+00021fe0: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
+00021ff0: 6e67 2866 2245 7272 6f72 2069 6e20 7468  ng(f"Error in th
+00022000: 6520 7265 7065 6174 2073 7472 7563 7475  e repeat structu
+00022010: 7265 3a20 4469 6420 6e6f 7420 7265 6163  re: Did not reac
+00022020: 6820 7468 6520 7374 6f70 7069 6e67 2076  h the stopping v
+00022030: 616c 7565 202d 3120 696e 206d 6561 7375  alue -1 in measu
+00022040: 7265 732e 6e65 7874 3a5c 6e7b 6d65 6173  res.next:\n{meas
+00022050: 7572 6573 2e73 6574 5f69 6e64 6578 2827  ures.set_index('
+00022060: 6d63 2729 2e6e 6578 747d 2229 0a20 2020  mc').next}").   
+00022070: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00022080: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00022090: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+000220a0: 2252 6570 6561 7420 7374 7275 6374 7572  "Repeat structur
+000220b0: 6520 7375 6363 6573 7366 756c 6c79 2075  e successfully u
+000220c0: 6e66 6f6c 6465 642e 2229 0a20 2020 2075  nfolded.").    u
+000220d0: 6e66 6f6c 6465 645f 6d65 6173 7572 6573  nfolded_measures
+000220e0: 203d 2075 6e66 6f6c 645f 7265 7065 6174   = unfold_repeat
+000220f0: 7328 6d65 6173 7572 6573 2c20 706c 6179  s(measures, play
+00022100: 7468 726f 7567 6832 6d63 2c20 6c6f 6767  through2mc, logg
+00022110: 6572 3d6c 6f67 6765 7229 0a20 2020 2074  er=logger).    t
+00022120: 7279 3a0a 2020 2020 2020 2020 6d6e 5f70  ry:.        mn_p
+00022130: 6c61 7974 6872 6f75 6768 5f63 6f6c 203d  laythrough_col =
+00022140: 2063 6f6d 7075 7465 5f6d 6e5f 706c 6179   compute_mn_play
+00022150: 7468 726f 7567 6828 756e 666f 6c64 6564  through(unfolded
+00022160: 5f6d 6561 7375 7265 732c 206c 6f67 6765  _measures, logge
+00022170: 723d 6c6f 6767 6572 290a 2020 2020 2020  r=logger).      
+00022180: 2020 696e 7365 7274 5f70 6f73 6974 696f    insert_positio
+00022190: 6e20 3d20 756e 666f 6c64 6564 5f6d 6561  n = unfolded_mea
+000221a0: 7375 7265 732e 636f 6c75 6d6e 732e 6765  sures.columns.ge
+000221b0: 745f 6c6f 6328 276d 635f 706c 6179 7468  t_loc('mc_playth
+000221c0: 726f 7567 6827 2920 2b20 310a 2020 2020  rough') + 1.    
+000221d0: 2020 2020 756e 666f 6c64 6564 5f6d 6561      unfolded_mea
+000221e0: 7375 7265 732e 696e 7365 7274 2869 6e73  sures.insert(ins
+000221f0: 6572 745f 706f 7369 7469 6f6e 2c20 276d  ert_position, 'm
+00022200: 6e5f 706c 6179 7468 726f 7567 6827 2c20  n_playthrough', 
+00022210: 6d6e 5f70 6c61 7974 6872 6f75 6768 5f63  mn_playthrough_c
+00022220: 6f6c 290a 2020 2020 6578 6365 7074 2045  ol).    except E
+00022230: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+00022240: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
+00022250: 726e 696e 6728 6622 4164 6469 6e67 2074  rning(f"Adding t
+00022260: 6865 2063 6f6c 756d 6e20 276d 6e5f 706c  he column 'mn_pl
+00022270: 6179 7468 726f 7567 6827 2074 6f20 7468  aythrough' to th
+00022280: 6520 756e 666f 6c64 6564 206d 6561 7375  e unfolded measu
+00022290: 7265 7320 7461 626c 6520 6661 696c 6564  res table failed
+000222a0: 2077 6974 683a 5c6e 277b 657d 2722 290a   with:\n'{e}'").
+000222b0: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
+000222c0: 2866 224d 6561 7375 7265 7320 7375 6363  (f"Measures succ
+000222d0: 6573 7366 756c 6c79 2075 6e66 6f6c 6465  essfully unfolde
+000222e0: 642e 2229 0a20 2020 2072 6574 7572 6e20  d.").    return 
+000222f0: 756e 666f 6c64 6564 5f6d 6561 7375 7265  unfolded_measure
+00022300: 730a 0a0a 4066 756e 6374 696f 6e5f 6c6f  s...@function_lo
+00022310: 6767 6572 0a64 6566 2075 6e66 6f6c 645f  gger.def unfold_
+00022320: 7265 7065 6174 7328 6466 3a20 7064 2e44  repeats(df: pd.D
+00022330: 6174 6146 7261 6d65 2c0a 2020 2020 2020  ataFrame,.      
+00022340: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
+00022350: 7974 6872 6f75 6768 5f69 6e66 6f3a 2055  ythrough_info: U
+00022360: 6e69 6f6e 5b70 642e 5365 7269 6573 2c20  nion[pd.Series, 
+00022370: 7064 2e44 6174 6146 7261 6d65 5d29 202d  pd.DataFrame]) -
+00022380: 3e20 7064 2e44 6174 6146 7261 6d65 3a0a  > pd.DataFrame:.
+00022390: 2020 2020 2222 2220 5573 6520 6120 7375      """ Use a su
+000223a0: 6363 6573 696f 6e20 6f66 204d 4373 2074  ccesion of MCs t
+000223b0: 6f20 6272 696e 6720 6120 4461 7461 4672  o bring a DataFr
+000223c0: 616d 6520 696e 2074 6869 7320 7375 6363  ame in this succ
+000223d0: 6573 7369 6f6e 2e20 4d43 7320 6d61 7920  ession. MCs may 
+000223e0: 7265 7065 6174 2e0a 0a20 2020 2041 7267  repeat...    Arg
+000223f0: 733a 0a20 2020 2020 2064 663a 2044 6174  s:.      df: Dat
+00022400: 6146 7261 6d65 206e 6565 6473 2074 6f20  aFrame needs to 
+00022410: 6861 7665 2074 6865 2063 6f6c 756d 6e73  have the columns
+00022420: 2027 6d63 272e 2049 6620 276d 6e27 2069   'mc'. If 'mn' i
+00022430: 7320 7072 6573 656e 742c 2074 6865 2063  s present, the c
+00022440: 6f6c 756d 6e20 276d 6e27 2077 696c 6c20  olumn 'mn' will 
+00022450: 6265 2061 6464 6564 2c20 746f 6f2e 0a20  be added, too.. 
+00022460: 2020 2020 2070 6c61 7974 6872 6f75 6768       playthrough
+00022470: 326d 633a 0a20 2020 2020 2020 2020 2041  2mc:.          A
+00022480: 2053 6572 6965 7320 6f66 2074 6865 2066   Series of the f
+00022490: 6f72 6d61 7420 6060 7b6d 635f 706c 6179  ormat ``{mc_play
+000224a0: 7468 726f 7567 683a 206d 637d 6060 2077  through: mc}`` w
+000224b0: 6865 7265 2060 606d 635f 706c 6179 7468  here ``mc_playth
+000224c0: 726f 7567 6860 6020 636f 7272 6573 706f  rough`` correspo
+000224d0: 6e64 730a 2020 2020 2020 2020 2020 746f  nds.          to
+000224e0: 2063 6f6e 7469 6e75 6f75 7320 4d43 0a0a   continuous MC..
+000224f0: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+00022500: 2020 2041 2063 6f70 7920 6f66 2074 6865     A copy of the
+00022510: 2064 6174 6166 7261 6d65 2077 6974 6820   dataframe with 
+00022520: 7468 6520 636f 6c75 6d6e 7320 276d 635f  the columns 'mc_
+00022530: 706c 6179 7468 726f 7567 6827 2061 6e64  playthrough' and
+00022540: 2027 6d6e 5f70 6c61 7974 6872 6f75 6768   'mn_playthrough
+00022550: 2720 2869 6620 276d 6e27 2069 7320 7072  ' (if 'mn' is pr
+00022560: 6573 656e 7429 2069 6e73 6572 7465 642e  esent) inserted.
+00022570: 0a20 2020 2022 2222 0a20 2020 206e 5f6f  .    """.    n_o
+00022580: 6363 7572 7265 6e63 6573 203d 2064 662e  ccurrences = df.
+00022590: 6d63 2e76 616c 7565 5f63 6f75 6e74 7328  mc.value_counts(
+000225a0: 290a 2020 2020 7265 7375 6c74 5f64 6620  ).    result_df 
+000225b0: 3d20 6466 2e73 6574 5f69 6e64 6578 2827  = df.set_index('
+000225c0: 6d63 2729 0a20 2020 2069 6620 6973 696e  mc').    if isin
+000225d0: 7374 616e 6365 2870 6c61 7974 6872 6f75  stance(playthrou
+000225e0: 6768 5f69 6e66 6f2c 2070 642e 4461 7461  gh_info, pd.Data
+000225f0: 4672 616d 6529 3a0a 2020 2020 2020 2020  Frame):.        
+00022600: 706c 6179 7468 726f 7567 6832 6d63 203d  playthrough2mc =
+00022610: 2070 6c61 7974 6872 6f75 6768 5f69 6e66   playthrough_inf
+00022620: 6f5b 276d 6327 5d0a 2020 2020 2020 2020  o['mc'].        
+00022630: 706c 6179 7468 726f 7567 6832 6d6e 203d  playthrough2mn =
+00022640: 2070 6c61 7974 6872 6f75 6768 5f69 6e66   playthrough_inf
+00022650: 6f5b 276d 6e5f 706c 6179 7468 726f 7567  o['mn_playthroug
+00022660: 6827 5d2e 746f 5f64 6963 7428 290a 2020  h'].to_dict().  
+00022670: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00022680: 706c 6179 7468 726f 7567 6832 6d63 203d  playthrough2mc =
+00022690: 2070 6c61 7974 6872 6f75 6768 5f69 6e66   playthrough_inf
+000226a0: 6f0a 2020 2020 2020 2020 706c 6179 7468  o.        playth
+000226b0: 726f 7567 6832 6d6e 203d 204e 6f6e 650a  rough2mn = None.
+000226c0: 2020 2020 706c 6179 7468 726f 7567 6832      playthrough2
+000226d0: 6d63 203d 2070 6c61 7974 6872 6f75 6768  mc = playthrough
+000226e0: 326d 635b 706c 6179 7468 726f 7567 6832  2mc[playthrough2
+000226f0: 6d63 2e69 7369 6e28 7265 7375 6c74 5f64  mc.isin(result_d
+00022700: 662e 696e 6465 7829 5d0a 2020 2020 6d63  f.index)].    mc
+00022710: 5f70 6c61 7974 6872 6f75 6768 5f63 6f6c  _playthrough_col
+00022720: 203d 2070 642e 5365 7269 6573 2873 756d   = pd.Series(sum
+00022730: 285b 5b70 6c61 7974 6872 6f75 6768 5d20  ([[playthrough] 
+00022740: 2a20 6e5f 6f63 6375 7272 656e 6365 735b  * n_occurrences[
+00022750: 6d63 5d20 666f 7220 706c 6179 7468 726f  mc] for playthro
+00022760: 7567 682c 206d 6320 696e 2070 6c61 7974  ugh, mc in playt
+00022770: 6872 6f75 6768 326d 632e 6974 656d 7328  hrough2mc.items(
+00022780: 295d 2c20 5b5d 2929 0a20 2020 2072 6573  )], [])).    res
+00022790: 756c 745f 6466 203d 2072 6573 756c 745f  ult_df = result_
+000227a0: 6466 2e6c 6f63 5b70 6c61 7974 6872 6f75  df.loc[playthrou
+000227b0: 6768 326d 632e 7661 6c75 6573 5d2e 7265  gh2mc.values].re
+000227c0: 7365 745f 696e 6465 7828 290a 2020 2020  set_index().    
+000227d0: 6966 2027 6d6e 2720 696e 2072 6573 756c  if 'mn' in resul
+000227e0: 745f 6466 2e63 6f6c 756d 6e73 3a0a 2020  t_df.columns:.  
+000227f0: 2020 2020 2020 636f 6c75 6d6e 5f70 6f73        column_pos
+00022800: 6974 696f 6e20 3d20 7265 7375 6c74 5f64  ition = result_d
+00022810: 662e 636f 6c75 6d6e 732e 6765 745f 6c6f  f.columns.get_lo
+00022820: 6328 276d 6e27 2920 2b20 310a 2020 2020  c('mn') + 1.    
+00022830: 2020 2020 6966 2070 6c61 7974 6872 6f75      if playthrou
+00022840: 6768 326d 6e20 6973 206e 6f74 204e 6f6e  gh2mn is not Non
+00022850: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+00022860: 6e5f 706c 6179 7468 726f 7567 685f 636f  n_playthrough_co
+00022870: 6c20 3d20 6d63 5f70 6c61 7974 6872 6f75  l = mc_playthrou
+00022880: 6768 5f63 6f6c 2e6d 6170 2870 6c61 7974  gh_col.map(playt
+00022890: 6872 6f75 6768 326d 6e29 0a20 2020 2020  hrough2mn).     
+000228a0: 2020 2020 2020 2072 6573 756c 745f 6466         result_df
+000228b0: 2e69 6e73 6572 7428 636f 6c75 6d6e 5f70  .insert(column_p
+000228c0: 6f73 6974 696f 6e2c 2027 6d6e 5f70 6c61  osition, 'mn_pla
+000228d0: 7974 6872 6f75 6768 272c 206d 6e5f 706c  ythrough', mn_pl
+000228e0: 6179 7468 726f 7567 685f 636f 6c29 0a20  aythrough_col). 
+000228f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00022900: 2063 6f6c 756d 6e5f 706f 7369 7469 6f6e   column_position
+00022910: 203d 2072 6573 756c 745f 6466 2e63 6f6c   = result_df.col
+00022920: 756d 6e73 2e67 6574 5f6c 6f63 2827 6d63  umns.get_loc('mc
+00022930: 2729 202b 2031 0a20 2020 2072 6573 756c  ') + 1.    resul
+00022940: 745f 6466 2e69 6e73 6572 7428 636f 6c75  t_df.insert(colu
+00022950: 6d6e 5f70 6f73 6974 696f 6e2c 2027 6d63  mn_position, 'mc
+00022960: 5f70 6c61 7974 6872 6f75 6768 272c 206d  _playthrough', m
+00022970: 635f 706c 6179 7468 726f 7567 685f 636f  c_playthrough_co
+00022980: 6c29 0a20 2020 2072 6574 7572 6e20 7265  l).    return re
+00022990: 7375 6c74 5f64 660a 0a0a 4063 6f6e 7465  sult_df...@conte
+000229a0: 7874 6d61 6e61 6765 720a 4066 756e 6374  xtmanager.@funct
+000229b0: 696f 6e5f 6c6f 6767 6572 0a64 6566 2075  ion_logger.def u
+000229c0: 6e70 6163 6b5f 6d73 637a 286d 7363 7a2c  npack_mscz(mscz,
+000229d0: 2074 6d70 5f64 6972 3d4e 6f6e 6529 3a0a   tmp_dir=None):.
+000229e0: 2020 2020 6966 2074 6d70 5f64 6972 2069      if tmp_dir i
+000229f0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00022a00: 746d 705f 6469 7220 3d20 6f73 2e70 6174  tmp_dir = os.pat
+00022a10: 682e 6469 726e 616d 6528 6d73 637a 290a  h.dirname(mscz).
+00022a20: 2020 2020 746d 705f 6669 6c65 203d 2054      tmp_file = T
+00022a30: 656d 7028 7375 6666 6978 3d27 2e6d 7363  emp(suffix='.msc
+00022a40: 7827 2c20 7072 6566 6978 3d27 2e27 2c20  x', prefix='.', 
+00022a50: 6469 723d 746d 705f 6469 722c 2064 656c  dir=tmp_dir, del
+00022a60: 6574 653d 4661 6c73 6529 0a20 2020 2077  ete=False).    w
+00022a70: 6974 6820 5a69 7028 6d73 637a 2920 6173  ith Zip(mscz) as
+00022a80: 207a 6970 5f66 696c 653a 0a20 2020 2020   zip_file:.     
+00022a90: 2020 206d 7363 785f 6669 6c65 7320 3d20     mscx_files = 
+00022aa0: 5b66 2066 6f72 2066 2069 6e20 7a69 705f  [f for f in zip_
+00022ab0: 6669 6c65 2e6e 616d 656c 6973 7428 2920  file.namelist() 
+00022ac0: 6966 2066 2e65 6e64 7377 6974 6828 272e  if f.endswith('.
+00022ad0: 6d73 6378 2729 5d0a 2020 2020 2020 2020  mscx')].        
+00022ae0: 6966 206c 656e 286d 7363 785f 6669 6c65  if len(mscx_file
+00022af0: 7329 203e 2031 3a0a 2020 2020 2020 2020  s) > 1:.        
+00022b00: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+00022b10: 6622 7b6d 7363 7a7d 2063 6f6e 7461 696e  f"{mscz} contain
+00022b20: 7320 7365 7665 7261 6c20 4d53 4358 2066  s several MSCX f
+00022b30: 696c 6573 2e20 5069 636b 696e 6720 7468  iles. Picking th
+00022b40: 6520 6669 7273 7420 6f6e 6522 290a 2020  e first one").  
+00022b50: 2020 2020 2020 6d73 6378 203d 206d 7363        mscx = msc
+00022b60: 785f 6669 6c65 735b 305d 0a20 2020 2020  x_files[0].     
+00022b70: 2020 2077 6974 6820 7a69 705f 6669 6c65     with zip_file
+00022b80: 2e6f 7065 6e28 6d73 6378 2920 6173 206d  .open(mscx) as m
+00022b90: 7363 785f 6669 6c65 3a0a 2020 2020 2020  scx_file:.      
+00022ba0: 2020 2020 2020 7769 7468 2074 6d70 5f66        with tmp_f
+00022bb0: 696c 6520 6173 2074 6d70 3a0a 2020 2020  ile as tmp:.    
+00022bc0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00022bd0: 6c69 6e65 2069 6e20 6d73 6378 5f66 696c  line in mscx_fil
+00022be0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00022bf0: 2020 2020 2020 2074 6d70 2e77 7269 7465         tmp.write
+00022c00: 286c 696e 6529 0a20 2020 2074 7279 3a0a  (line).    try:.
+00022c10: 2020 2020 2020 2020 7969 656c 6420 746d          yield tm
+00022c20: 705f 6669 6c65 2e6e 616d 650a 2020 2020  p_file.name.    
+00022c30: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00022c40: 3a0a 2020 2020 2020 2020 6c6f 6767 6572  :.        logger
+00022c50: 2e65 7272 6f72 2866 2245 7272 6f72 2077  .error(f"Error w
+00022c60: 6869 6c65 2064 6561 6c69 6e67 2077 6974  hile dealing wit
+00022c70: 6820 7468 6520 7465 6d70 6f72 6172 696c  h the temporaril
+00022c80: 7920 756e 7061 636b 6564 207b 6f73 2e70  y unpacked {os.p
+00022c90: 6174 682e 6261 7365 6e61 6d65 286d 7363  ath.basename(msc
+00022ca0: 7a29 7d22 290a 2020 2020 2020 2020 7261  z)}").        ra
+00022cb0: 6973 650a 2020 2020 6669 6e61 6c6c 793a  ise.    finally:
+00022cc0: 0a20 2020 2020 2020 206f 732e 7265 6d6f  .        os.remo
+00022cd0: 7665 2874 6d70 5f66 696c 652e 6e61 6d65  ve(tmp_file.name
+00022ce0: 290a 0a40 636f 6e74 6578 746d 616e 6167  )..@contextmanag
+00022cf0: 6572 0a40 6675 6e63 7469 6f6e 5f6c 6f67  er.@function_log
+00022d00: 6765 720a 6465 6620 6361 7074 7572 655f  ger.def capture_
+00022d10: 7061 7273 655f 6c6f 6773 286c 6f67 6765  parse_logs(logge
+00022d20: 725f 6f62 6a65 6374 3a20 6c6f 6767 696e  r_object: loggin
+00022d30: 672e 4c6f 6767 6572 2c0a 2020 2020 2020  g.Logger,.      
+00022d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d50: 206c 6576 656c 3a20 556e 696f 6e5b 7374   level: Union[st
+00022d60: 722c 2069 6e74 5d20 3d20 2777 2729 202d  r, int] = 'w') -
+00022d70: 3e20 4c6f 6743 6170 7475 7265 723a 0a20  > LogCapturer:. 
+00022d80: 2020 2022 2222 5769 7468 696e 2074 6865     """Within the
+00022d90: 2063 6f6e 7465 7874 2c20 7468 6520 6769   context, the gi
+00022da0: 7665 6e20 6c6f 6767 6572 2077 696c 6c20  ven logger will 
+00022db0: 6861 7665 2061 6e20 6164 6469 7469 6f6e  have an addition
+00022dc0: 616c 2068 616e 646c 6572 2074 6861 7420  al handler that 
+00022dd0: 6361 7074 7572 6573 2061 6c6c 206d 6573  captures all mes
+00022de0: 7361 6765 7320 7769 7468 206c 6576 656c  sages with level
+00022df0: 0a20 2020 2060 606c 6576 656c 6060 206f  .    ``level`` o
+00022e00: 7220 6869 6768 6572 2e20 4174 2074 6865  r higher. At the
+00022e10: 2065 6e64 206f 6620 7468 6520 636f 6e74   end of the cont
+00022e20: 6578 742c 2072 6574 7269 6576 6520 7468  ext, retrieve th
+00022e30: 6520 6d65 7373 6167 6520 6c69 7374 2076  e message list v
+00022e40: 6961 204c 6f63 4361 7074 7572 6572 2e63  ia LocCapturer.c
+00022e50: 6f6e 7465 6e74 5f6c 6973 742e 0a0a 2020  ontent_list...  
+00022e60: 2020 4578 616d 706c 653a 0a20 2020 2020    Example:.     
+00022e70: 2020 202e 2e20 636f 6465 2d62 6c6f 636b     .. code-block
+00022e80: 3a3a 2070 7974 686f 6e0a 0a20 2020 2020  :: python..     
+00022e90: 2020 2020 2020 2077 6974 6820 6361 7074         with capt
+00022ea0: 7572 655f 7061 7273 655f 6c6f 6773 286c  ure_parse_logs(l
+00022eb0: 6f67 6765 722c 206c 6576 656c 3d27 6427  ogger, level='d'
+00022ec0: 2920 6173 2063 6170 7475 7265 723a 0a20  ) as capturer:. 
+00022ed0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00022ee0: 2064 6f20 7468 6520 7374 7566 6620 6f66   do the stuff of
+00022ef0: 2077 6869 6368 2079 6f75 2077 616e 7420   which you want 
+00022f00: 746f 2063 6170 7475 7265 0a20 2020 2020  to capture.     
+00022f10: 2020 2020 2020 2020 2020 2061 6c6c 5f6d             all_m
+00022f20: 6573 7361 6765 7320 3d20 6361 7074 7572  essages = captur
+00022f30: 6572 2e63 6f6e 7465 6e74 5f6c 6973 740a  er.content_list.
+00022f40: 2020 2020 2222 220a 2020 2020 6361 7074      """.    capt
+00022f50: 7572 6564 5f77 6172 6e69 6e67 7320 3d20  ured_warnings = 
+00022f60: 4c6f 6743 6170 7475 7265 7228 6c65 7665  LogCapturer(leve
+00022f70: 6c3d 6c65 7665 6c29 0a20 2020 206c 6f67  l=level).    log
+00022f80: 6765 725f 6f62 6a65 6374 2e61 6464 4861  ger_object.addHa
+00022f90: 6e64 6c65 7228 6361 7074 7572 6564 5f77  ndler(captured_w
+00022fa0: 6172 6e69 6e67 732e 6c6f 675f 6861 6e64  arnings.log_hand
+00022fb0: 6c65 7229 0a20 2020 2079 6965 6c64 2063  ler).    yield c
+00022fc0: 6170 7475 7265 645f 7761 726e 696e 6773  aptured_warnings
+00022fd0: 0a20 2020 206c 6f67 6765 725f 6f62 6a65  .    logger_obje
+00022fe0: 6374 2e72 656d 6f76 6548 616e 646c 6572  ct.removeHandler
+00022ff0: 2863 6170 7475 7265 645f 7761 726e 696e  (captured_warnin
+00023000: 6773 2e6c 6f67 5f68 616e 646c 6572 290a  gs.log_handler).
+00023010: 0a0a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  ...@function_log
+00023020: 6765 720a 6465 6620 7570 6461 7465 5f6c  ger.def update_l
+00023030: 6162 656c 735f 6366 6728 6c61 6265 6c73  abels_cfg(labels
+00023040: 5f63 6667 293a 0a20 2020 206b 6579 7320  _cfg):.    keys 
+00023050: 3d20 5b27 7374 6166 6627 2c20 2776 6f69  = ['staff', 'voi
+00023060: 6365 272c 2027 6861 726d 6f6e 795f 6c61  ce', 'harmony_la
+00023070: 7965 7227 2c20 2770 6f73 6974 696f 6e69  yer', 'positioni
+00023080: 6e67 272c 2027 6465 636f 6465 272c 2027  ng', 'decode', '
+00023090: 636f 6c75 6d6e 5f6e 616d 6527 2c20 2763  column_name', 'c
+000230a0: 6f6c 6f72 5f66 6f72 6d61 7427 5d0a 2020  olor_format'].  
+000230b0: 2020 6966 2027 6c6f 6767 6572 2720 696e    if 'logger' in
+000230c0: 206c 6162 656c 735f 6366 673a 0a20 2020   labels_cfg:.   
+000230d0: 2020 2020 2064 656c 286c 6162 656c 735f       del(labels_
+000230e0: 6366 675b 276c 6f67 6765 7227 5d29 0a20  cfg['logger']). 
+000230f0: 2020 2075 7064 6174 6564 2c20 696e 636f     updated, inco
+00023100: 7272 6563 7420 3d20 7570 6461 7465 5f63  rrect = update_c
+00023110: 6667 2863 6667 5f64 6963 743d 6c61 6265  fg(cfg_dict=labe
+00023120: 6c73 5f63 6667 2c20 6164 6d69 7474 6564  ls_cfg, admitted
+00023130: 5f6b 6579 733d 6b65 7973 290a 2020 2020  _keys=keys).    
+00023140: 6966 206c 656e 2869 6e63 6f72 7265 6374  if len(incorrect
+00023150: 2920 3e20 303a 0a20 2020 2020 2020 206c  ) > 0:.        l
+00023160: 6173 745f 3520 3d20 272c 2027 2e6a 6f69  ast_5 = ', '.joi
+00023170: 6e28 6622 2d7b 697d 3a20 7b73 7461 636b  n(f"-{i}: {stack
+00023180: 2829 5b69 5d2e 6675 6e63 7469 6f6e 7d28  ()[i].function}(
+00023190: 2922 2066 6f72 2069 2069 6e20 7261 6e67  )" for i in rang
+000231a0: 6528 312c 2036 2929 0a20 2020 2020 2020  e(1, 6)).       
+000231b0: 2070 6c75 7261 6c20 3d20 2754 6865 7365   plural = 'These
+000231c0: 206f 7074 696f 6e73 2061 7265 2720 6966   options are' if
+000231d0: 206c 656e 2869 6e63 6f72 7265 6374 2920   len(incorrect) 
+000231e0: 3e20 3120 656c 7365 2027 5468 6973 206f  > 1 else 'This o
+000231f0: 7074 696f 6e20 6973 270a 2020 2020 2020  ption is'.      
+00023200: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+00023210: 2866 227b 706c 7572 616c 7d20 6e6f 7420  (f"{plural} not 
+00023220: 7661 6c69 6420 746f 2063 6f6e 6669 6775  valid to configu
+00023230: 7265 206c 6162 656c 733a 207b 696e 636f  re labels: {inco
+00023240: 7272 6563 747d 5c6e 4c61 7374 2035 2066  rrect}\nLast 5 f
+00023250: 756e 6374 696f 6e20 6361 6c6c 7320 6c65  unction calls le
+00023260: 6164 696e 6720 6865 7265 3a20 7b6c 6173  ading here: {las
+00023270: 745f 357d 2229 0a20 2020 2072 6574 7572  t_5}").    retur
+00023280: 6e20 7570 6461 7465 640a 0a0a 4066 756e  n updated...@fun
+00023290: 6374 696f 6e5f 6c6f 6767 6572 0a64 6566  ction_logger.def
+000232a0: 2077 7269 7465 5f6d 6574 6164 6174 6128   write_metadata(
+000232b0: 6d65 7461 6461 7461 5f64 663a 2070 642e  metadata_df: pd.
+000232c0: 4461 7461 4672 616d 652c 0a20 2020 2020  DataFrame,.     
+000232d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000232e0: 7468 3a20 7374 722c 0a20 2020 2020 2020  th: str,.       
+000232f0: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00023300: 783d 4661 6c73 6529 202d 3e20 626f 6f6c  x=False) -> bool
+00023310: 3a0a 2020 2020 2222 220a 2020 2020 5772  :.    """.    Wr
+00023320: 6974 6520 7468 6520 4461 7461 4672 616d  ite the DataFram
+00023330: 6520 6060 6d65 7461 6461 7461 5f64 6660  e ``metadata_df`
+00023340: 6020 746f 2060 6070 6174 6860 602c 2075  ` to ``path``, u
+00023350: 7064 6174 696e 6720 616e 2065 7869 7374  pdating an exist
+00023360: 696e 6720 6669 6c65 2072 6174 6865 7220  ing file rather 
+00023370: 7468 616e 206f 7665 7277 7269 7469 6e67  than overwriting
+00023380: 2069 742e 0a0a 2020 2020 4172 6773 3a0a   it...    Args:.
+00023390: 2020 2020 2020 6d65 7461 6461 7461 5f64        metadata_d
+000233a0: 663a 0a20 2020 2020 2020 2020 2044 6174  f:.          Dat
+000233b0: 6146 7261 6d65 2077 6974 6820 6f6e 6520  aFrame with one 
+000233c0: 726f 7720 7065 7220 7069 6563 6520 616e  row per piece an
+000233d0: 6420 616e 2069 6e64 6578 206f 6620 7374  d an index of st
+000233e0: 7269 6e67 7320 6964 656e 7469 6679 696e  rings identifyin
+000233f0: 6720 7069 6563 6573 2e20 5468 6520 696e  g pieces. The in
+00023400: 6465 7820 6973 2075 7365 6420 666f 720a  dex is used for.
+00023410: 2020 2020 2020 2020 2020 7570 6461 7469            updati
+00023420: 6e67 2061 2070 6f74 656e 7469 616c 6c79  ng a potentially
+00023430: 2070 7265 2d65 7869 7374 656e 7420 6669   pre-existent fi
+00023440: 6c65 2c20 6672 6f6d 2077 6869 6368 2074  le, from which t
+00023450: 6865 2066 6972 7374 2063 6f6c 756d 6e20  he first column 
+00023460: e288 8820 2827 666e 616d 6527 2c20 2766  ... ('fname', 'f
+00023470: 6e61 6d65 7327 2c20 276e 616d 6527 2c20  names', 'name', 
+00023480: 276e 616d 6573 2729 0a20 2020 2020 2020  'names').       
+00023490: 2020 2077 696c 6c20 6265 2075 7365 6420     will be used 
+000234a0: 6173 2069 6e64 6578 2e0a 2020 2020 2020  as index..      
+000234b0: 7061 7468 3a0a 2020 2020 2020 2020 2020  path:.          
+000234c0: 4966 2066 6f6c 6465 7220 7061 7468 2c20  If folder path, 
+000234d0: 7468 6520 6669 6c65 6e61 6d65 2027 6d65  the filename 'me
+000234e0: 7461 6461 7461 2e74 7376 2720 7769 6c6c  tadata.tsv' will
+000234f0: 2062 6520 6170 7065 6e64 6564 3b20 6669   be appended; fi
+00023500: 6c65 5f70 6174 6820 7769 6c6c 2062 6520  le_path will be 
+00023510: 7573 6564 2061 7320 6973 2062 7574 2061  used as is but a
+00023520: 0a20 2020 2020 2020 2020 2077 6172 6e69  .          warni
+00023530: 6e67 2069 7320 7468 726f 776e 2069 6620  ng is thrown if 
+00023540: 7468 6520 6578 7465 6e73 696f 6e20 6973  the extension is
+00023550: 206e 6f74 202e 7473 760a 2020 2020 2020   not .tsv.      
+00023560: 696e 6465 783a 2050 6173 7320 5472 7565  index: Pass True
+00023570: 2069 6620 796f 7520 7761 6e74 2074 6865   if you want the
+00023580: 2066 6972 7374 2063 6f6c 756d 6e20 6f66   first column of
+00023590: 2074 6865 206f 7574 7075 7420 746f 2062   the output to b
+000235a0: 6520 6120 5261 6e67 6549 6e64 6578 2073  e a RangeIndex s
+000235b0: 7461 7274 696e 6720 6672 6f6d 2030 2e0a  tarting from 0..
+000235c0: 0a20 2020 2052 6574 7572 6e73 3a0a 2020  .    Returns:.  
+000235d0: 2020 2020 5472 7565 2069 6620 7468 6520      True if the 
+000235e0: 6d65 7461 6461 7461 2077 6572 6520 7375  metadata were su
+000235f0: 6363 6573 7366 756c 6c79 2077 7269 7474  ccessfully writt
+00023600: 656e 2c20 4661 6c73 6520 6f74 6865 7277  en, False otherw
+00023610: 6973 652e 0a20 2020 2022 2222 0a20 2020  ise..    """.   
+00023620: 206d 6574 6164 6174 615f 6466 203d 206d   metadata_df = m
+00023630: 6574 6164 6174 615f 6466 2e61 7374 7970  etadata_df.astyp
+00023640: 6528 2773 7472 696e 6727 290a 2020 2020  e('string').    
+00023650: 6d65 7461 6461 7461 5f64 6620 3d20 656e  metadata_df = en
+00023660: 666f 7263 655f 666e 616d 655f 696e 6465  force_fname_inde
+00023670: 785f 666f 725f 6d65 7461 6461 7461 286d  x_for_metadata(m
+00023680: 6574 6164 6174 615f 6466 290a 2020 2020  etadata_df).    
+00023690: 7061 7468 203d 2072 6573 6f6c 7665 5f64  path = resolve_d
+000236a0: 6972 2870 6174 6829 0a20 2020 2069 6620  ir(path).    if 
+000236b0: 6f73 2e70 6174 682e 6973 6469 7228 7061  os.path.isdir(pa
+000236c0: 7468 293a 0a20 2020 2020 2020 2074 7376  th):.        tsv
+000236d0: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
+000236e0: 6a6f 696e 2870 6174 682c 2027 6d65 7461  join(path, 'meta
+000236f0: 6461 7461 2e74 7376 2729 0a20 2020 2065  data.tsv').    e
+00023700: 6c73 653a 0a20 2020 2020 2020 2074 7376  lse:.        tsv
+00023710: 5f70 6174 6820 3d20 7061 7468 0a20 2020  _path = path.   
+00023720: 205f 2c20 6665 7874 203d 206f 732e 7061   _, fext = os.pa
+00023730: 7468 2e73 706c 6974 6578 7428 7473 765f  th.splitext(tsv_
+00023740: 7061 7468 290a 2020 2020 6966 2066 6578  path).    if fex
+00023750: 7420 213d 2027 2e74 7376 273a 0a20 2020  t != '.tsv':.   
+00023760: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
+00023770: 696e 6728 6622 5468 6520 6f75 7470 7574  ing(f"The output
+00023780: 2066 6f72 6d61 7420 666f 7220 6d65 7461   format for meta
+00023790: 6461 7461 2069 7320 5461 622d 5365 7061  data is Tab-Sepa
+000237a0: 7261 7465 6420 5661 6c75 6573 2028 2e74  rated Values (.t
+000237b0: 7376 2920 6275 7420 7468 6520 6669 6c65  sv) but the file
+000237c0: 2065 7874 656e 7369 6f6e 7320 6973 207b   extensions is {
+000237d0: 6665 7874 7d2e 2229 0a20 2020 2069 6620  fext}.").    if 
+000237e0: 6e6f 7420 6f73 2e70 6174 682e 6973 6669  not os.path.isfi
+000237f0: 6c65 2874 7376 5f70 6174 6829 3a0a 2020  le(tsv_path):.  
+00023800: 2020 2020 2020 6f75 7470 7574 5f64 6620        output_df 
+00023810: 3d20 6d65 7461 6461 7461 5f64 660a 2020  = metadata_df.  
+00023820: 2020 2020 2020 6d73 6720 3d20 2743 7265        msg = 'Cre
+00023830: 6174 6564 270a 2020 2020 656c 7365 3a0a  ated'.    else:.
+00023840: 2020 2020 2020 2020 2320 5472 7969 6e67          # Trying
+00023850: 2074 6f20 6c6f 6164 2061 6e20 6578 6973   to load an exis
+00023860: 7469 6e67 2027 6d65 7461 6461 7461 2e74  ting 'metadata.t
+00023870: 7376 2720 6669 6c65 2074 6f20 7570 6461  sv' file to upda
+00023880: 7465 2065 7869 7374 696e 6720 726f 7773  te existing rows
+00023890: 0a20 2020 2020 2020 2070 7265 7669 6f75  .        previou
+000238a0: 7320 3d20 7064 2e72 6561 645f 6373 7628  s = pd.read_csv(
+000238b0: 7473 765f 7061 7468 2c20 7365 703d 275c  tsv_path, sep='\
+000238c0: 7427 2c20 6474 7970 653d 2773 7472 696e  t', dtype='strin
+000238d0: 6727 290a 2020 2020 2020 2020 7072 6576  g').        prev
+000238e0: 696f 7573 203d 2065 6e66 6f72 6365 5f66  ious = enforce_f
+000238f0: 6e61 6d65 5f69 6e64 6578 5f66 6f72 5f6d  name_index_for_m
+00023900: 6574 6164 6174 6128 7072 6576 696f 7573  etadata(previous
+00023910: 290a 2020 2020 2020 2020 666f 7220 6978  ).        for ix
+00023920: 2c20 7768 6174 2069 6e20 7a69 7028 2870  , what in zip((p
+00023930: 7265 7669 6f75 732e 696e 6465 782c 2070  revious.index, p
+00023940: 7265 7669 6f75 732e 636f 6c75 6d6e 732c  revious.columns,
+00023950: 206d 6574 6164 6174 615f 6466 2e69 6e64   metadata_df.ind
+00023960: 6578 2c20 6d65 7461 6461 7461 5f64 662e  ex, metadata_df.
+00023970: 636f 6c75 6d6e 7329 2c0a 2020 2020 2020  columns),.      
+00023980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023990: 2020 2020 2020 2827 696e 6465 7820 6f66        ('index of
+000239a0: 2074 6865 2065 7869 7374 696e 6727 2c20   the existing', 
+000239b0: 2763 6f6c 756d 6e73 206f 6620 7468 6520  'columns of the 
+000239c0: 6578 6973 7469 6e67 272c 2027 696e 6465  existing', 'inde
+000239d0: 7820 6f66 2074 6865 2075 7064 6174 6564  x of the updated
+000239e0: 272c 2027 636f 6c75 6d6e 7320 6f66 2074  ', 'columns of t
+000239f0: 6865 2075 7064 6174 6564 2729 293a 0a20  he updated')):. 
+00023a00: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00023a10: 7420 6978 2e69 735f 756e 6971 7565 3a0a  t ix.is_unique:.
+00023a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a30: 6475 706c 6963 6174 6564 203d 2069 785b  duplicated = ix[
+00023a40: 6978 2e64 7570 6c69 6361 7465 6428 295d  ix.duplicated()]
+00023a50: 2e74 6f5f 6c69 7374 2829 0a20 2020 2020  .to_list().     
+00023a60: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00023a70: 722e 6572 726f 7228 6622 5468 6520 7b77  r.error(f"The {w
+00023a80: 6861 747d 206d 6574 6164 6174 6120 636f  hat} metadata co
+00023a90: 6e74 6169 6e73 2064 7570 6c69 6361 7465  ntains duplicate
+00023aa0: 7320 616e 6420 6e6f 206d 6574 6164 6174  s and no metadat
+00023ab0: 6120 7765 7265 2077 7269 7474 656e 2e5c  a were written.\
+00023ac0: 6e44 7570 6c69 6361 7465 733a 207b 6475  nDuplicates: {du
+00023ad0: 706c 6963 6174 6564 7d22 290a 2020 2020  plicated}").    
+00023ae0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00023af0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00023b00: 206e 6577 5f63 6f6c 7320 3d20 6d65 7461   new_cols = meta
+00023b10: 6461 7461 5f64 662e 636f 6c75 6d6e 732e  data_df.columns.
+00023b20: 6469 6666 6572 656e 6365 2870 7265 7669  difference(previ
+00023b30: 6f75 732e 636f 6c75 6d6e 7329 0a20 2020  ous.columns).   
+00023b40: 2020 2020 2073 6861 7265 645f 636f 6c73       shared_cols
+00023b50: 203d 206d 6574 6164 6174 615f 6466 2e63   = metadata_df.c
+00023b60: 6f6c 756d 6e73 2e69 6e74 6572 7365 6374  olumns.intersect
+00023b70: 696f 6e28 7072 6576 696f 7573 2e63 6f6c  ion(previous.col
+00023b80: 756d 6e73 290a 2020 2020 2020 2020 6e65  umns).        ne
+00023b90: 775f 726f 7773 203d 206d 6574 6164 6174  w_rows = metadat
+00023ba0: 615f 6466 2e69 6e64 6578 2e64 6966 6665  a_df.index.diffe
+00023bb0: 7265 6e63 6528 7072 6576 696f 7573 2e69  rence(previous.i
+00023bc0: 6e64 6578 290a 2020 2020 2020 2020 7072  ndex).        pr
+00023bd0: 6576 696f 7573 203d 2070 642e 636f 6e63  evious = pd.conc
+00023be0: 6174 285b 7072 6576 696f 7573 2c20 6d65  at([previous, me
+00023bf0: 7461 6461 7461 5f64 662e 6c6f 635b 6e65  tadata_df.loc[ne
+00023c00: 775f 726f 7773 2c20 7368 6172 6564 5f63  w_rows, shared_c
+00023c10: 6f6c 735d 5d29 0a20 2020 2020 2020 2070  ols]]).        p
+00023c20: 7265 7669 6f75 7320 3d20 7064 2e63 6f6e  revious = pd.con
+00023c30: 6361 7428 5b70 7265 7669 6f75 732c 206d  cat([previous, m
+00023c40: 6574 6164 6174 615f 6466 5b6e 6577 5f63  etadata_df[new_c
+00023c50: 6f6c 735d 5d2c 2061 7869 733d 3129 0a20  ols]], axis=1). 
+00023c60: 2020 2020 2020 2070 7265 7669 6f75 732e         previous.
+00023c70: 7570 6461 7465 286d 6574 6164 6174 615f  update(metadata_
+00023c80: 6466 290a 2020 2020 2020 2020 6c65 6761  df).        lega
+00023c90: 6379 5f63 6f6c 756d 6e73 203d 205b 6320  cy_columns = [c 
+00023ca0: 666f 7220 6320 696e 204c 4547 4143 595f  for c in LEGACY_
+00023cb0: 434f 4c55 4d4e 5320 6966 2063 2069 6e20  COLUMNS if c in 
+00023cc0: 7072 6576 696f 7573 2e63 6f6c 756d 6e73  previous.columns
+00023cd0: 5d0a 2020 2020 2020 2020 6966 206c 656e  ].        if len
+00023ce0: 286c 6567 6163 795f 636f 6c75 6d6e 7329  (legacy_columns)
+00023cf0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00023d00: 2020 706c 7572 616c 203d 2066 2773 207b    plural = f's {
+00023d10: 6c65 6761 6379 5f63 6f6c 756d 6e73 7d27  legacy_columns}'
+00023d20: 2069 6620 6c65 6e28 6c65 6761 6379 5f63   if len(legacy_c
+00023d30: 6f6c 756d 6e73 2920 3e20 3120 656c 7365  olumns) > 1 else
+00023d40: 2066 2720 7b6c 6567 6163 795f 636f 6c75   f' {legacy_colu
+00023d50: 6d6e 735b 305d 7d27 0a20 2020 2020 2020  mns[0]}'.       
+00023d60: 2020 2020 2070 7265 7669 6f75 7320 3d20       previous = 
+00023d70: 7072 6576 696f 7573 2e64 726f 7028 636f  previous.drop(co
+00023d80: 6c75 6d6e 733d 6c65 6761 6379 5f63 6f6c  lumns=legacy_col
+00023d90: 756d 6e73 290a 2020 2020 2020 2020 2020  umns).          
+00023da0: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
+00023db0: 4472 6f70 7065 6420 6c65 6761 6379 2063  Dropped legacy c
+00023dc0: 6f6c 756d 6e7b 706c 7572 616c 7d20 2e22  olumn{plural} ."
+00023dd0: 290a 2020 2020 2020 2020 6f75 7470 7574  ).        output
+00023de0: 5f64 6620 3d20 7072 6576 696f 7573 2e72  _df = previous.r
+00023df0: 6573 6574 5f69 6e64 6578 2829 0a20 2020  eset_index().   
+00023e00: 2020 2020 206d 7367 203d 2027 5570 6461       msg = 'Upda
+00023e10: 7465 6427 0a20 2020 206f 7574 7075 745f  ted'.    output_
+00023e20: 6466 203d 2070 7265 7061 7265 5f6d 6574  df = prepare_met
+00023e30: 6164 6174 615f 666f 725f 7772 6974 696e  adata_for_writin
+00023e40: 6728 6f75 7470 7574 5f64 6629 0a20 2020  g(output_df).   
+00023e50: 206f 7574 7075 745f 6466 2e74 6f5f 6373   output_df.to_cs
+00023e60: 7628 7473 765f 7061 7468 2c20 7365 703d  v(tsv_path, sep=
+00023e70: 275c 7427 2c20 696e 6465 783d 696e 6465  '\t', index=inde
+00023e80: 7829 0a20 2020 206c 6f67 6765 722e 696e  x).    logger.in
+00023e90: 666f 2866 227b 6d73 677d 207b 7473 765f  fo(f"{msg} {tsv_
+00023ea0: 7061 7468 7d22 290a 2020 2020 7265 7475  path}").    retu
+00023eb0: 726e 2054 7275 650a 0a40 6675 6e63 7469  rn True..@functi
+00023ec0: 6f6e 5f6c 6f67 6765 720a 6465 6620 656e  on_logger.def en
+00023ed0: 666f 7263 655f 666e 616d 655f 696e 6465  force_fname_inde
+00023ee0: 785f 666f 725f 6d65 7461 6461 7461 286d  x_for_metadata(m
+00023ef0: 6574 6164 6174 615f 6466 3a20 7064 2e44  etadata_df: pd.D
+00023f00: 6174 6146 7261 6d65 2c20 6170 7065 6e64  ataFrame, append
+00023f10: 3d46 616c 7365 2920 2d3e 2070 642e 4461  =False) -> pd.Da
+00023f20: 7461 4672 616d 653a 0a20 2020 2022 2222  taFrame:.    """
+00023f30: 5265 7475 726e 7320 6120 636f 7079 206f  Returns a copy o
+00023f40: 6620 7468 6520 4461 7461 4672 616d 6520  f the DataFrame 
+00023f50: 7468 6174 2068 6173 2061 6e20 696e 6465  that has an inde
+00023f60: 7820 6c65 7665 6c20 6361 6c6c 6564 2027  x level called '
+00023f70: 666e 616d 6527 2e22 2222 0a20 2020 2070  fname'.""".    p
+00023f80: 6f73 7369 626c 655f 636f 6c75 6d6e 5f6e  ossible_column_n
+00023f90: 616d 6573 203d 2028 2766 6e61 6d65 272c  ames = ('fname',
+00023fa0: 2027 666e 616d 6573 272c 2027 6669 6c65   'fnames', 'file
+00023fb0: 6e61 6d65 272c 2027 6e61 6d65 272c 2027  name', 'name', '
+00023fc0: 6e61 6d65 7327 2c29 0a20 2020 2069 6620  names',).    if 
+00023fd0: 616e 7928 6e61 6d65 2069 6e20 6d65 7461  any(name in meta
+00023fe0: 6461 7461 5f64 662e 696e 6465 782e 6e61  data_df.index.na
+00023ff0: 6d65 7320 666f 7220 6e61 6d65 2069 6e20  mes for name in 
+00024000: 706f 7373 6962 6c65 5f63 6f6c 756d 6e5f  possible_column_
+00024010: 6e61 6d65 7329 3a0a 2020 2020 2020 2020  names):.        
+00024020: 7265 7475 726e 206d 6574 6164 6174 615f  return metadata_
+00024030: 6466 0a20 2020 2074 7279 3a0a 2020 2020  df.    try:.    
+00024040: 2020 2020 666e 616d 655f 636f 6c20 3d20      fname_col = 
+00024050: 6e65 7874 2863 6f6c 2066 6f72 2063 6f6c  next(col for col
+00024060: 2069 6e20 706f 7373 6962 6c65 5f63 6f6c   in possible_col
+00024070: 756d 6e5f 6e61 6d65 7320 6966 2063 6f6c  umn_names if col
+00024080: 2069 6e20 6d65 7461 6461 7461 5f64 662e   in metadata_df.
+00024090: 636f 6c75 6d6e 7329 0a20 2020 2065 7863  columns).    exc
+000240a0: 6570 7420 5374 6f70 4974 6572 6174 696f  ept StopIteratio
+000240b0: 6e3a 0a20 2020 2020 2020 2072 6169 7365  n:.        raise
+000240c0: 2056 616c 7565 4572 726f 7228 6622 4d65   ValueError(f"Me
+000240d0: 7461 6461 7461 2069 7320 6578 7065 6374  tadata is expect
+000240e0: 6564 2074 6f20 636f 6d65 2077 6974 6820  ed to come with 
+000240f0: 6120 636f 6c75 6d6e 206f 7220 696e 6465  a column or inde
+00024100: 7820 6c65 7665 6c20 6361 6c6c 6564 2027  x level called '
+00024110: 666e 616d 6527 206f 7220 2870 7265 7669  fname' or (previ
+00024120: 6f75 736c 7929 2027 666e 616d 6573 272e  ously) 'fnames'.
+00024130: 2229 0a20 2020 2069 6620 666e 616d 655f  ").    if fname_
+00024140: 636f 6c20 213d 2027 666e 616d 6527 3a0a  col != 'fname':.
+00024150: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+00024160: 5f64 6620 3d20 6d65 7461 6461 7461 5f64  _df = metadata_d
+00024170: 662e 7265 6e61 6d65 2863 6f6c 756d 6e73  f.rename(columns
+00024180: 3d7b 666e 616d 655f 636f 6c3a 2027 666e  ={fname_col: 'fn
+00024190: 616d 6527 7d29 0a20 2020 2020 2020 206c  ame'}).        l
+000241a0: 6f67 6765 722e 696e 666f 2866 2252 656e  ogger.info(f"Ren
+000241b0: 616d 6564 2063 6f6c 756d 6e20 277b 666e  amed column '{fn
+000241c0: 616d 655f 636f 6c7d 2720 2d3e 2027 666e  ame_col}' -> 'fn
+000241d0: 616d 6527 2229 0a20 2020 2072 6574 7572  ame'").    retur
+000241e0: 6e20 6d65 7461 6461 7461 5f64 662e 7365  n metadata_df.se
+000241f0: 745f 696e 6465 7828 2766 6e61 6d65 272c  t_index('fname',
+00024200: 2061 7070 656e 643d 6170 7065 6e64 290a   append=append).
+00024210: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
+00024220: 6572 0a64 6566 2077 7269 7465 5f6d 6172  er.def write_mar
+00024230: 6b64 6f77 6e28 6d65 7461 6461 7461 5f64  kdown(metadata_d
+00024240: 663a 2070 642e 4461 7461 4672 616d 652c  f: pd.DataFrame,
+00024250: 2066 696c 655f 7061 7468 3a20 7374 7229   file_path: str)
+00024260: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2222   -> None:.    ""
+00024270: 220a 2020 2020 5772 6974 6520 6120 7375  ".    Write a su
+00024280: 6273 6574 206f 6620 7468 6520 4461 7461  bset of the Data
+00024290: 4672 616d 6520 6060 6d65 7461 6461 7461  Frame ``metadata
+000242a0: 5f64 6660 6020 746f 2060 6070 6174 6860  _df`` to ``path`
+000242b0: 6020 696e 206d 6172 6b64 6f77 6e20 666f  ` in markdown fo
+000242c0: 726d 6174 2e20 4966 2074 6865 2066 696c  rmat. If the fil
+000242d0: 6520 6578 6973 7473 2c20 6974 2077 696c  e exists, it wil
+000242e0: 6c20 6265 0a20 2020 2073 6361 6e6e 6564  l be.    scanned
+000242f0: 2066 6f72 2061 206c 696e 6520 636f 6e74   for a line cont
+00024300: 6169 6e69 6e67 2074 6865 2073 7472 696e  aining the strin
+00024310: 6720 2723 204f 7665 7276 6965 7727 2061  g '# Overview' a
+00024320: 6e64 206f 7665 7277 7269 7474 656e 2066  nd overwritten f
+00024330: 726f 6d20 7468 6174 206c 696e 6520 6f6e  rom that line on
+00024340: 7761 7264 732e 0a0a 2020 2020 4172 6773  wards...    Args
+00024350: 3a0a 2020 2020 2020 6d65 7461 6461 7461  :.      metadata
+00024360: 5f64 663a 2044 6174 6146 7261 6d65 2063  _df: DataFrame c
+00024370: 6f6e 7461 696e 696e 6720 6d65 7461 6461  ontaining metada
+00024380: 7461 2e0a 2020 2020 2020 6669 6c65 5f70  ta..      file_p
+00024390: 6174 683a 2050 6174 6820 6f66 2074 6865  ath: Path of the
+000243a0: 206d 6172 6b64 6f77 6e20 6669 6c65 2e0a   markdown file..
+000243b0: 2020 2020 2222 220a 2020 2020 7265 6e61      """.    rena
+000243c0: 6d65 346d 6172 6b64 6f77 6e20 3d20 7b0a  me4markdown = {.
+000243d0: 2020 2020 2020 2020 2766 6e61 6d65 273a          'fname':
+000243e0: 2027 6669 6c65 5f6e 616d 6527 2c0a 2020   'file_name',.  
+000243f0: 2020 2020 2020 276c 6173 745f 6d6e 273a        'last_mn':
+00024400: 2027 6d65 6173 7572 6573 272c 0a20 2020   'measures',.   
+00024410: 2020 2020 2027 6c61 6265 6c5f 636f 756e       'label_coun
+00024420: 7427 3a20 276c 6162 656c 7327 2c0a 2020  t': 'labels',.  
+00024430: 2020 2020 2020 2768 6172 6d6f 6e79 5f76        'harmony_v
+00024440: 6572 7369 6f6e 273a 2027 7374 616e 6461  ersion': 'standa
+00024450: 7264 272c 0a20 2020 2020 2020 2027 616e  rd',.        'an
+00024460: 6e6f 7461 746f 7273 273a 2027 616e 6e6f  notators': 'anno
+00024470: 7461 746f 7273 272c 0a20 2020 2020 2020  tators',.       
+00024480: 2027 7265 7669 6577 6572 7327 3a20 2772   'reviewers': 'r
+00024490: 6576 6965 7765 7273 272c 0a20 2020 207d  eviewers',.    }
+000244a0: 0a20 2020 2072 656e 616d 6534 6d61 726b  .    rename4mark
+000244b0: 646f 776e 203d 207b 6b3a 2076 2066 6f72  down = {k: v for
+000244c0: 206b 2c20 7620 696e 2072 656e 616d 6534   k, v in rename4
+000244d0: 6d61 726b 646f 776e 2e69 7465 6d73 2829  markdown.items()
+000244e0: 2069 6620 6b20 696e 206d 6574 6164 6174   if k in metadat
+000244f0: 615f 6466 2e63 6f6c 756d 6e73 7d0a 2020  a_df.columns}.  
+00024500: 2020 6472 6f70 5f69 6e64 6578 203d 2027    drop_index = '
+00024510: 666e 616d 6573 2720 696e 206d 6574 6164  fnames' in metad
+00024520: 6174 615f 6466 2e63 6f6c 756d 6e73 0a20  ata_df.columns. 
+00024530: 2020 206d 6420 3d20 6d65 7461 6461 7461     md = metadata
+00024540: 5f64 662e 7265 7365 745f 696e 6465 7828  _df.reset_index(
+00024550: 6472 6f70 3d64 726f 705f 696e 6465 7829  drop=drop_index)
+00024560: 5b6c 6973 7428 7265 6e61 6d65 346d 6172  [list(rename4mar
+00024570: 6b64 6f77 6e2e 6b65 7973 2829 295d 2e66  kdown.keys())].f
+00024580: 696c 6c6e 6128 2727 290a 2020 2020 6d64  illna('').    md
+00024590: 203d 206d 642e 7265 6e61 6d65 2863 6f6c   = md.rename(col
+000245a0: 756d 6e73 3d72 656e 616d 6534 6d61 726b  umns=rename4mark
+000245b0: 646f 776e 290a 2020 2020 6d64 5f74 6162  down).    md_tab
+000245c0: 6c65 203d 2073 7472 2864 6632 6d64 286d  le = str(df2md(m
+000245d0: 6429 290a 2020 2020 6d64 5f74 6162 6c65  d)).    md_table
+000245e0: 202b 3d20 6622 5c6e 5c6e 2a4f 7665 7276   += f"\n\n*Overv
+000245f0: 6965 7720 7461 626c 6520 7570 6461 7465  iew table update
+00024600: 6420 7573 696e 6720 5b6d 7333 5d28 6874  d using [ms3](ht
+00024610: 7470 733a 2f2f 6a6f 6865 6e74 7363 682e  tps://johentsch.
+00024620: 6769 7468 7562 2e69 6f2f 6d73 332f 2920  github.io/ms3/) 
+00024630: 7b4d 5333 5f56 4552 5349 4f4e 7d2e 2a5c  {MS3_VERSION}.*\
+00024640: 6e22 0a0a 2020 2020 6966 206f 732e 7061  n"..    if os.pa
+00024650: 7468 2e69 7366 696c 6528 6669 6c65 5f70  th.isfile(file_p
+00024660: 6174 6829 3a0a 2020 2020 2020 2020 6d73  ath):.        ms
+00024670: 6720 3d20 2755 7064 6174 6564 270a 2020  g = 'Updated'.  
+00024680: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00024690: 6669 6c65 5f70 6174 682c 2027 7227 2c20  file_path, 'r', 
+000246a0: 656e 636f 6469 6e67 3d27 7574 662d 3827  encoding='utf-8'
+000246b0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
+000246c0: 2020 2020 6c69 6e65 7320 3d20 662e 7265      lines = f.re
+000246d0: 6164 6c69 6e65 7328 290a 2020 2020 656c  adlines().    el
+000246e0: 7365 3a0a 2020 2020 2020 2020 6d73 6720  se:.        msg 
+000246f0: 3d20 2743 7265 6174 6564 270a 2020 2020  = 'Created'.    
+00024700: 2020 2020 6c69 6e65 7320 3d20 5b5d 0a20      lines = []. 
+00024710: 2020 2023 2069 6e20 6361 7365 2074 6865     # in case the
+00024720: 2052 4541 444d 452e 6d64 2065 7869 7374   README.md exist
+00024730: 732c 2065 7665 7279 7468 696e 6720 6672  s, everything fr
+00024740: 6f6d 2074 6865 206c 696e 6520 696e 636c  om the line incl
+00024750: 7564 696e 6720 2723 204f 7665 7276 6965  uding '# Overvie
+00024760: 7727 2028 6f72 206c 6173 7420 6c69 6e65  w' (or last line
+00024770: 206f 7468 6572 7769 7365 2920 6973 206f   otherwise) is o
+00024780: 7665 7277 7269 7474 656e 0a20 2020 2077  verwritten.    w
+00024790: 6974 6820 6f70 656e 2866 696c 655f 7061  ith open(file_pa
+000247a0: 7468 2c20 2777 272c 2065 6e63 6f64 696e  th, 'w', encodin
+000247b0: 673d 2775 7466 2d38 2729 2061 7320 663a  g='utf-8') as f:
+000247c0: 0a20 2020 2020 2020 2066 6f72 206c 696e  .        for lin
+000247d0: 6520 696e 206c 696e 6573 3a0a 2020 2020  e in lines:.    
+000247e0: 2020 2020 2020 2020 6966 2027 2320 4f76          if '# Ov
+000247f0: 6572 7669 6577 2720 696e 206c 696e 653a  erview' in line:
+00024800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024810: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00024820: 2020 2066 2e77 7269 7465 286c 696e 6529     f.write(line)
+00024830: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00024840: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
+00024850: 7465 2827 5c6e 5c6e 2729 0a20 2020 2020  te('\n\n').     
+00024860: 2020 2066 2e77 7269 7465 286d 645f 7461     f.write(md_ta
+00024870: 626c 6529 0a20 2020 206c 6f67 6765 722e  ble).    logger.
+00024880: 696e 666f 2866 227b 6d73 677d 207b 6669  info(f"{msg} {fi
+00024890: 6c65 5f70 6174 687d 2229 0a0a 0a64 6566  le_path}")...def
+000248a0: 2070 7265 7061 7265 5f6d 6574 6164 6174   prepare_metadat
+000248b0: 615f 666f 725f 7772 6974 696e 6728 6d65  a_for_writing(me
+000248c0: 7461 6461 7461 5f64 6629 3a0a 2020 2020  tadata_df):.    
+000248d0: 2320 636f 6e76 6572 745f 746f 5f73 7472  # convert_to_str
+000248e0: 203d 207b 633a 2027 7374 7269 6e67 2720   = {c: 'string' 
+000248f0: 666f 7220 6320 696e 2028 276c 656e 6774  for c in ('lengt
+00024900: 685f 7162 272c 2027 6c65 6e67 7468 5f71  h_qb', 'length_q
+00024910: 625f 756e 666f 6c64 6564 272c 2027 616c  b_unfolded', 'al
+00024920: 6c5f 6e6f 7465 735f 7162 2729 2069 6620  l_notes_qb') if 
+00024930: 6320 696e 206d 6574 6164 6174 615f 6466  c in metadata_df
+00024940: 7d0a 2020 2020 2320 6966 206c 656e 2863  }.    # if len(c
+00024950: 6f6e 7665 7274 5f74 6f5f 7374 7229 203e  onvert_to_str) >
+00024960: 2030 3a0a 2020 2020 2320 2020 2020 6d65   0:.    #     me
+00024970: 7461 6461 7461 5f64 6620 3d20 6d65 7461  tadata_df = meta
+00024980: 6461 7461 5f64 662e 6173 7479 7065 2863  data_df.astype(c
+00024990: 6f6e 7665 7274 5f74 6f5f 7374 722c 2065  onvert_to_str, e
+000249a0: 7272 6f72 733d 2769 676e 6f72 6527 290a  rrors='ignore').
+000249b0: 2020 2020 6d65 7461 6461 7461 5f64 6620      metadata_df 
+000249c0: 3d20 6d65 7461 6461 7461 5f64 662e 6173  = metadata_df.as
+000249d0: 7479 7065 2827 7374 7269 6e67 272c 2065  type('string', e
+000249e0: 7272 6f72 733d 2769 676e 6f72 6527 290a  rrors='ignore').
+000249f0: 2020 2020 6d65 7461 6461 7461 5f64 662e      metadata_df.
+00024a00: 736f 7274 5f69 6e64 6578 2869 6e70 6c61  sort_index(inpla
+00024a10: 6365 3d54 7275 6529 0a20 2020 206d 6574  ce=True).    met
+00024a20: 6164 6174 615f 6466 203d 2063 6f6c 756d  adata_df = colum
+00024a30: 6e5f 6f72 6465 7228 6d65 7461 6461 7461  n_order(metadata
+00024a40: 5f64 662c 204d 4554 4144 4154 415f 434f  _df, METADATA_CO
+00024a50: 4c55 4d4e 5f4f 5244 4552 2c20 736f 7274  LUMN_ORDER, sort
+00024a60: 3d46 616c 7365 290a 2020 2020 2320 6f6e  =False).    # on
+00024a70: 2057 696e 646f 7773 2c20 6d61 6b65 2073   Windows, make s
+00024a80: 7572 6520 7468 6520 7061 7468 7320 6172  ure the paths ar
+00024a90: 6520 7772 6974 7465 6e20 7769 7468 202f  e written with /
+00024aa0: 2073 6570 6172 6174 6f72 730a 2020 2020   separators.    
+00024ab0: 7061 7468 5f63 6f6c 7320 3d20 5b63 6f6c  path_cols = [col
+00024ac0: 2066 6f72 2063 6f6c 2069 6e20 2827 7375   for col in ('su
+00024ad0: 6264 6972 272c 2027 7265 6c5f 7061 7468  bdir', 'rel_path
+00024ae0: 2729 2069 6620 636f 6c20 696e 206d 6574  ') if col in met
+00024af0: 6164 6174 615f 6466 2e63 6f6c 756d 6e73  adata_df.columns
+00024b00: 5d0a 2020 2020 666f 7220 636f 6c20 696e  ].    for col in
+00024b10: 2070 6174 685f 636f 6c73 3a0a 2020 2020   path_cols:.    
+00024b20: 2020 2020 7769 7468 2077 6172 6e69 6e67      with warning
+00024b30: 732e 6361 7463 685f 7761 726e 696e 6773  s.catch_warnings
+00024b40: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00024b50: 2320 5365 7474 696e 6720 7661 6c75 6573  # Setting values
+00024b60: 2069 6e2d 706c 6163 6520 6973 2066 696e   in-place is fin
+00024b70: 652c 2069 676e 6f72 6520 7468 6520 7761  e, ignore the wa
+00024b80: 726e 696e 6720 696e 2050 616e 6461 7320  rning in Pandas 
+00024b90: 3e3d 2031 2e35 2e30 0a20 2020 2020 2020  >= 1.5.0.       
+00024ba0: 2020 2020 2023 2054 6869 7320 6361 6e20       # This can 
+00024bb0: 6265 2072 656d 6f76 6564 2c20 6966 2050  be removed, if P
+00024bc0: 616e 6461 7320 312e 352e 3020 646f 6573  andas 1.5.0 does
+00024bd0: 206e 6f74 206e 6565 6420 746f 2062 6520   not need to be 
+00024be0: 7375 7070 6f72 7465 6420 616e 7920 6c6f  supported any lo
+00024bf0: 6e67 6572 2e0a 2020 2020 2020 2020 2020  nger..          
+00024c00: 2020 2320 5365 6520 616c 736f 3a20 6874    # See also: ht
+00024c10: 7470 733a 2f2f 7374 6163 6b6f 7665 7266  tps://stackoverf
+00024c20: 6c6f 772e 636f 6d2f 712f 3734 3035 3733  low.com/q/740573
+00024c30: 3637 2f38 3539 3539 310a 2020 2020 2020  67/859591.      
+00024c40: 2020 2020 2020 7761 726e 696e 6773 2e66        warnings.f
+00024c50: 696c 7465 7277 6172 6e69 6e67 7328 0a20  ilterwarnings(. 
+00024c60: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00024c70: 6967 6e6f 7265 222c 0a20 2020 2020 2020  ignore",.       
+00024c80: 2020 2020 2020 2020 2063 6174 6567 6f72           categor
+00024c90: 793d 4675 7475 7265 5761 726e 696e 672c  y=FutureWarning,
+00024ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024cb0: 206d 6573 7361 6765 3d28 0a20 2020 2020   message=(.     
+00024cc0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00024cd0: 2e2a 7769 6c6c 2061 7474 656d 7074 2074  .*will attempt t
+00024ce0: 6f20 7365 7420 7468 6520 7661 6c75 6573  o set the values
+00024cf0: 2069 6e70 6c61 6365 2069 6e73 7465 6164   inplace instead
+00024d00: 206f 6620 616c 7761 7973 2073 6574 7469   of always setti
+00024d10: 6e67 2061 206e 6577 2061 7272 6179 2e20  ng a new array. 
+00024d20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00024d30: 2020 2020 2020 2254 6f20 7265 7461 696e        "To retain
+00024d40: 2074 6865 206f 6c64 2062 6568 6176 696f   the old behavio
+00024d50: 722c 2075 7365 2065 6974 6865 722e 2a22  r, use either.*"
+00024d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024d70: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+00024d80: 290a 2020 2020 2020 2020 2020 2020 6d65  ).            me
+00024d90: 7461 6461 7461 5f64 662e 6c6f 635b 3a2c  tadata_df.loc[:,
+00024da0: 2063 6f6c 5d20 3d20 6d65 7461 6461 7461   col] = metadata
+00024db0: 5f64 665b 636f 6c5d 2e73 7472 2e72 6570  _df[col].str.rep
+00024dc0: 6c61 6365 286f 732e 7365 702c 2027 2f27  lace(os.sep, '/'
+00024dd0: 290a 2020 2020 7374 6166 665f 636f 6c73  ).    staff_cols
+00024de0: 2c20 6f74 6865 725f 636f 6c73 203d 205b  , other_cols = [
+00024df0: 5d2c 205b 5d0a 2020 2020 666f 7220 636f  ], [].    for co
+00024e00: 6c20 696e 206d 6574 6164 6174 615f 6466  l in metadata_df
+00024e10: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
+00024e20: 2020 6966 2072 652e 6d61 7463 6828 7222    if re.match(r"
+00024e30: 5e73 7461 6666 5f28 5c64 2b29 222c 2063  ^staff_(\d+)", c
+00024e40: 6f6c 293a 0a20 2020 2020 2020 2020 2020  ol):.           
+00024e50: 2073 7461 6666 5f63 6f6c 732e 6170 7065   staff_cols.appe
+00024e60: 6e64 2863 6f6c 290a 2020 2020 2020 2020  nd(col).        
+00024e70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00024e80: 2020 6f74 6865 725f 636f 6c73 2e61 7070    other_cols.app
+00024e90: 656e 6428 636f 6c29 0a20 2020 2073 7461  end(col).    sta
+00024ea0: 6666 5f63 6f6c 7320 3d20 736f 7274 6564  ff_cols = sorted
+00024eb0: 2873 7461 6666 5f63 6f6c 732c 206b 6579  (staff_cols, key
+00024ec0: 3d6c 616d 6264 6120 733a 2069 6e74 2872  =lambda s: int(r
+00024ed0: 652e 6d61 7463 6828 7222 5e73 7461 6666  e.match(r"^staff
+00024ee0: 5f28 5c64 2b29 222c 2073 295b 315d 2929  _(\d+)", s)[1]))
+00024ef0: 0a20 2020 206d 6574 6164 6174 615f 6466  .    metadata_df
+00024f00: 203d 206d 6574 6164 6174 615f 6466 5b6f   = metadata_df[o
+00024f10: 7468 6572 5f63 6f6c 7320 2b20 7374 6166  ther_cols + staf
+00024f20: 665f 636f 6c73 5d0a 2020 2020 6966 206e  f_cols].    if n
+00024f30: 6f74 2069 7369 6e73 7461 6e63 6528 6d65  ot isinstance(me
+00024f40: 7461 6461 7461 5f64 662e 696e 6465 782c  tadata_df.index,
+00024f50: 2070 642e 5261 6e67 6549 6e64 6578 293a   pd.RangeIndex):
+00024f60: 0a20 2020 2020 2020 206d 6574 6164 6174  .        metadat
+00024f70: 615f 6466 203d 206d 6574 6164 6174 615f  a_df = metadata_
+00024f80: 6466 2e72 6573 6574 5f69 6e64 6578 2829  df.reset_index()
+00024f90: 0a20 2020 2072 6574 7572 6e20 6d65 7461  .    return meta
+00024fa0: 6461 7461 5f64 660a 0a0a 4066 756e 6374  data_df...@funct
+00024fb0: 696f 6e5f 6c6f 6767 6572 0a64 6566 2077  ion_logger.def w
+00024fc0: 7269 7465 5f74 7376 2864 662c 2066 696c  rite_tsv(df, fil
+00024fd0: 655f 7061 7468 2c20 7072 655f 7072 6f63  e_path, pre_proc
+00024fe0: 6573 733d 5472 7565 2c20 2a2a 6b77 6172  ess=True, **kwar
+00024ff0: 6773 293a 0a20 2020 2022 2222 2057 7269  gs):.    """ Wri
+00025000: 7465 2061 2044 6174 6146 7261 6d65 2074  te a DataFrame t
+00025010: 6f20 6120 5453 5620 6f72 2043 5356 2066  o a TSV or CSV f
+00025020: 696c 6520 6261 7365 6420 6f6e 2074 6865  ile based on the
+00025030: 2065 7874 656e 7369 6f6e 206f 6620 2766   extension of 'f
+00025040: 696c 655f 7061 7468 272e 0a20 2020 2055  ile_path'..    U
+00025050: 7365 733a 203a 7079 3a66 756e 633a 606e  ses: :py:func:`n
+00025060: 6f5f 636f 6c6c 6563 7469 6f6e 735f 6e6f  o_collections_no
+00025070: 5f62 6f6f 6c65 616e 7360 0a0a 2020 2020  _booleans`..    
+00025080: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00025090: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6466  ---------.    df
+000250a0: 203a 203a 6f62 6a3a 6070 616e 6461 732e   : :obj:`pandas.
+000250b0: 4461 7461 4672 616d 6560 0a20 2020 2020  DataFrame`.     
+000250c0: 2020 2044 6174 6146 7261 6d65 2074 6f20     DataFrame to 
+000250d0: 7772 6974 652e 0a20 2020 2066 696c 655f  write..    file_
+000250e0: 7061 7468 203a 203a 6f62 6a3a 6073 7472  path : :obj:`str
+000250f0: 600a 2020 2020 2020 2020 4669 6c65 2074  `.        File t
+00025100: 6f20 6372 6561 7465 206f 7220 6f76 6572  o create or over
+00025110: 7772 6974 652e 2049 6620 7468 6520 6578  write. If the ex
+00025120: 7465 6e73 696f 6e20 6973 202e 7473 762c  tension is .tsv,
+00025130: 2074 6865 2061 7267 756d 656e 7420 2773   the argument 's
+00025140: 6570 2720 7769 6c6c 2062 6520 7365 7420  ep' will be set 
+00025150: 746f 2027 5c74 272c 206f 7468 6572 7769  to '\t', otherwi
+00025160: 7365 2074 6865 0a20 2020 2020 2020 2065  se the.        e
+00025170: 7874 656e 7369 6f6e 2069 7320 6578 7065  xtension is expe
+00025180: 6374 6564 2074 6f20 6265 202e 6373 7620  cted to be .csv 
+00025190: 616e 6420 7468 6520 6465 6661 756c 7420  and the default 
+000251a0: 7365 7061 7261 746f 7220 272c 2720 7769  separator ',' wi
+000251b0: 6c6c 2062 6520 7573 6564 2e0a 2020 2020  ll be used..    
+000251c0: 7072 655f 7072 6f63 6573 7320 3a20 3a6f  pre_process : :o
+000251d0: 626a 3a60 626f 6f6c 602c 206f 7074 696f  bj:`bool`, optio
+000251e0: 6e61 6c0a 2020 2020 2020 2020 4279 2064  nal.        By d
+000251f0: 6566 6175 6c74 2c20 4461 7461 4672 616d  efault, DataFram
+00025200: 6520 6365 6c6c 7320 636f 6e74 6169 6e69  e cells containi
+00025210: 6e67 206c 6973 7473 2061 6e64 2074 7570  ng lists and tup
+00025220: 6c65 7320 7769 6c6c 2062 6520 7472 616e  les will be tran
+00025230: 7366 6f72 6d65 6420 746f 2073 7472 696e  sformed to strin
+00025240: 6773 2061 6e64 2042 6f6f 6c65 616e 7320  gs and Booleans 
+00025250: 7769 6c6c 2062 650a 2020 2020 2020 2020  will be.        
+00025260: 636f 6e76 6572 7465 6420 746f 2030 2061  converted to 0 a
+00025270: 6e64 2031 2028 6f74 6865 7277 6973 6520  nd 1 (otherwise 
+00025280: 7468 6579 2077 696c 6c20 6265 2077 7269  they will be wri
+00025290: 7474 656e 206f 7574 2061 7320 5472 7565  tten out as True
+000252a0: 2061 6e64 2046 616c 7365 292e 2050 6173   and False). Pas
+000252b0: 7320 4661 6c73 6520 746f 2070 7265 7665  s False to preve
+000252c0: 6e74 2e0a 2020 2020 6b77 6172 6773 203a  nt..    kwargs :
+000252d0: 0a20 2020 2020 2020 2041 6464 6974 696f  .        Additio
+000252e0: 6e61 6c20 6b65 7977 6f72 6420 6172 6775  nal keyword argu
+000252f0: 6d65 6e74 7320 7769 6c6c 2062 6520 7061  ments will be pa
+00025300: 7373 6564 206f 6e20 746f 203a 7079 3a6d  ssed on to :py:m
+00025310: 6574 683a 6070 616e 6461 732e 4461 7461  eth:`pandas.Data
+00025320: 4672 616d 652e 746f 5f63 7376 602e 0a20  Frame.to_csv`.. 
+00025330: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+00025340: 6172 6775 6d65 6e74 7320 6172 6520 6060  arguments are ``
+00025350: 696e 6465 783d 4661 6c73 6560 6020 616e  index=False`` an
+00025360: 6420 6060 7365 703d 275c 7427 6060 2028  d ``sep='\t'`` (
+00025370: 6173 7375 6d69 6e67 2065 7874 656e 7369  assuming extensi
+00025380: 6f6e 2027 2e74 7376 272c 2073 6565 2061  on '.tsv', see a
+00025390: 626f 7665 292e 0a0a 2020 2020 5265 7475  bove)...    Retu
+000253a0: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+000253b0: 2020 2020 4e6f 6e65 0a20 2020 2022 2222      None.    """
+000253c0: 0a20 2020 2070 6174 682c 2066 696c 6520  .    path, file 
+000253d0: 3d20 6f73 2e70 6174 682e 7370 6c69 7428  = os.path.split(
+000253e0: 6669 6c65 5f70 6174 6829 0a20 2020 2070  file_path).    p
+000253f0: 6174 6820 3d20 7265 736f 6c76 655f 6469  ath = resolve_di
+00025400: 7228 7061 7468 290a 2020 2020 6f73 2e70  r(path).    os.p
+00025410: 6174 682e 6a6f 696e 2870 6174 682c 2066  ath.join(path, f
+00025420: 696c 6529 0a20 2020 2066 6e61 6d65 2c20  ile).    fname, 
+00025430: 6578 7420 3d20 6f73 2e70 6174 682e 7370  ext = os.path.sp
+00025440: 6c69 7465 7874 2866 696c 6529 0a20 2020  litext(file).   
+00025450: 2069 6620 6578 742e 6c6f 7765 7228 2920   if ext.lower() 
+00025460: 6e6f 7420 696e 2028 272e 7473 7627 2c20  not in ('.tsv', 
+00025470: 272e 6373 7627 293a 0a20 2020 2020 2020  '.csv'):.       
+00025480: 206c 6f67 6765 722e 6572 726f 7228 6622   logger.error(f"
+00025490: 5468 6973 2066 756e 6374 696f 6e20 6578  This function ex
+000254a0: 7065 6374 7320 6669 6c65 5f70 6174 6820  pects file_path 
+000254b0: 746f 2069 6e63 6c75 6465 2074 6865 2066  to include the f
+000254c0: 696c 6520 6e61 6d65 2065 6e64 696e 6720  ile name ending 
+000254d0: 6f6e 202e 6373 7620 6f72 202e 7473 762c  on .csv or .tsv,
+000254e0: 206e 6f74 2027 7b65 7874 7d27 2e22 290a   not '{ext}'.").
+000254f0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+00025500: 2020 206f 732e 6d61 6b65 6469 7273 2870     os.makedirs(p
+00025510: 6174 682c 2065 7869 7374 5f6f 6b3d 5472  ath, exist_ok=Tr
+00025520: 7565 290a 2020 2020 6966 2065 7874 2e6c  ue).    if ext.l
+00025530: 6f77 6572 2829 203d 3d20 272e 7473 7627  ower() == '.tsv'
+00025540: 3a0a 2020 2020 2020 2020 6b77 6172 6773  :.        kwargs
+00025550: 2e75 7064 6174 6528 6469 6374 2873 6570  .update(dict(sep
+00025560: 3d27 5c74 2729 290a 2020 2020 6966 2027  ='\t')).    if '
+00025570: 696e 6465 7827 206e 6f74 2069 6e20 6b77  index' not in kw
+00025580: 6172 6773 3a0a 2020 2020 2020 2020 6b77  args:.        kw
+00025590: 6172 6773 5b27 696e 6465 7827 5d20 3d20  args['index'] = 
+000255a0: 4661 6c73 650a 2020 2020 6966 2070 7265  False.    if pre
+000255b0: 5f70 726f 6365 7373 3a0a 2020 2020 2020  _process:.      
+000255c0: 2020 6466 203d 206e 6f5f 636f 6c6c 6563    df = no_collec
+000255d0: 7469 6f6e 735f 6e6f 5f62 6f6f 6c65 616e  tions_no_boolean
+000255e0: 7328 6466 2c20 6c6f 6767 6572 3d6c 6f67  s(df, logger=log
+000255f0: 6765 7229 0a20 2020 2064 662e 746f 5f63  ger).    df.to_c
+00025600: 7376 2866 696c 655f 7061 7468 2c20 2a2a  sv(file_path, **
+00025610: 6b77 6172 6773 290a 2020 2020 6c6f 6767  kwargs).    logg
+00025620: 6572 2e64 6562 7567 2866 227b 6669 6c65  er.debug(f"{file
+00025630: 5f70 6174 687d 2077 7269 7474 656e 2077  _path} written w
+00025640: 6974 6820 7061 7261 6d65 7465 7273 207b  ith parameters {
+00025650: 6b77 6172 6773 7d2e 2229 0a20 2020 2072  kwargs}.").    r
+00025660: 6574 7572 6e0a 0a0a 4066 756e 6374 696f  eturn...@functio
+00025670: 6e5f 6c6f 6767 6572 0a64 6566 2061 6273  n_logger.def abs
+00025680: 3272 656c 5f6b 6579 2861 6273 6f6c 7574  2rel_key(absolut
+00025690: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
+000256a0: 2020 2020 2020 2020 6c6f 6361 6c6b 6579          localkey
+000256b0: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
+000256c0: 2020 2020 2020 2067 6c6f 6261 6c5f 6d69         global_mi
+000256d0: 6e6f 723a 2062 6f6f 6c20 3d20 4661 6c73  nor: bool = Fals
+000256e0: 6529 202d 3e20 7374 723a 0a20 2020 2022  e) -> str:.    "
+000256f0: 2222 0a20 2020 2045 7870 7265 7373 6573  "".    Expresses
+00025700: 2061 2052 6f6d 616e 206e 756d 6572 616c   a Roman numeral
+00025710: 2061 7320 7363 616c 6520 6465 6772 6565   as scale degree
+00025720: 2072 656c 6174 6976 6520 746f 2061 2067   relative to a g
+00025730: 6976 656e 206c 6f63 616c 6b65 792e 0a20  iven localkey.. 
+00025740: 2020 2054 6865 2072 6573 756c 7420 6368     The result ch
+00025750: 616e 6765 7320 6465 7065 6e64 696e 6720  anges depending 
+00025760: 6f6e 2077 6865 7468 6572 2052 6f6d 616e  on whether Roman
+00025770: 206e 756d 6572 616c 2061 6e64 206c 6f63   numeral and loc
+00025780: 616c 6b65 7920 6172 650a 2020 2020 696e  alkey are.    in
+00025790: 7465 7270 7265 7465 6420 7769 7468 696e  terpreted within
+000257a0: 2061 2067 6c6f 6261 6c20 6d61 6a6f 7220   a global major 
+000257b0: 6f72 206d 696e 6f72 206b 6579 2e0a 0a20  or minor key... 
+000257c0: 2020 2055 7365 733a 203a 7079 3a66 756e     Uses: :py:fun
+000257d0: 633a 6073 706c 6974 5f73 6361 6c65 5f64  c:`split_scale_d
+000257e0: 6567 7265 6560 0a0a 0a20 2020 2041 7267  egree`...    Arg
+000257f0: 733a 0a20 2020 2020 2061 6273 6f6c 7574  s:.      absolut
+00025800: 653a 2041 6273 6f6c 7574 6520 6b65 7920  e: Absolute key 
+00025810: 6578 7072 6573 7365 6420 6173 2052 6f6d  expressed as Rom
+00025820: 616e 2073 6361 6c65 2064 6567 7265 6520  an scale degree 
+00025830: 6f66 2074 6865 206c 6f63 616c 206b 6579  of the local key
+00025840: 2e0a 2020 2020 2020 6c6f 6361 6c6b 6579  ..      localkey
+00025850: 3a20 5468 6520 6c6f 6361 6c20 6b65 7920  : The local key 
+00025860: 696e 2074 6572 6d73 206f 6620 7768 6963  in terms of whic
+00025870: 6820 6060 6162 736f 6c75 7465 6060 2077  h ``absolute`` w
+00025880: 696c 6c20 6265 2065 7870 7265 7373 6564  ill be expressed
+00025890: 2e0a 2020 2020 2020 676c 6f62 616c 5f6d  ..      global_m
+000258a0: 696e 6f72 3a20 4861 7320 746f 2062 6520  inor: Has to be 
+000258b0: 7365 7420 746f 2054 7275 6520 6966 2060  set to True if `
+000258c0: 6162 736f 6c75 7465 6020 616e 6420 606c  absolute` and `l
+000258d0: 6f63 616c 6b65 7960 2061 7265 2073 6361  ocalkey` are sca
+000258e0: 6c65 2064 6567 7265 6573 206f 6620 6120  le degrees of a 
+000258f0: 676c 6f62 616c 206d 696e 6f72 206b 6579  global minor key
+00025900: 2e0a 0a20 2020 2045 7861 6d70 6c65 733a  ...    Examples:
+00025910: 0a20 2020 2020 2049 6e20 6120 6d69 6e6f  .      In a mino
+00025920: 7220 636f 6e74 6578 742c 2074 6865 206b  r context, the k
+00025930: 6579 206f 6620 4949 2077 6f75 6c64 2061  ey of II would a
+00025940: 7070 6561 7220 7769 7468 696e 2074 6865  ppear within the
+00025950: 206b 6579 206f 6620 7669 6920 6173 2023   key of vii as #
+00025960: 4949 492e 0a0a 2020 2020 2020 2020 2020  III...          
+00025970: 3e3e 3e20 6162 7332 7265 6c5f 6b65 7928  >>> abs2rel_key(
+00025980: 2769 7627 2c20 2756 4927 2c20 676c 6f62  'iv', 'VI', glob
+00025990: 616c 5f6d 696e 6f72 3d46 616c 7365 290a  al_minor=False).
+000259a0: 2020 2020 2020 2020 2020 2762 7669 2720            'bvi' 
+000259b0: 2020 2020 2020 2320 4620 6d69 6e6f 7220        # F minor 
+000259c0: 6578 7072 6573 7365 6420 7769 7468 2072  expressed with r
+000259d0: 6573 7065 6374 2074 6f20 4120 6d61 6a6f  espect to A majo
+000259e0: 720a 2020 2020 2020 2020 2020 3e3e 3e20  r.          >>> 
+000259f0: 6162 7332 7265 6c5f 6b65 7928 2769 7627  abs2rel_key('iv'
+00025a00: 2c20 2776 6927 2c20 676c 6f62 616c 5f6d  , 'vi', global_m
+00025a10: 696e 6f72 3d46 616c 7365 290a 2020 2020  inor=False).    
+00025a20: 2020 2020 2020 2776 6927 2020 2020 2020        'vi'      
+00025a30: 2320 4620 6d69 6e6f 7220 6578 7072 6573  # F minor expres
+00025a40: 7365 6420 7769 7468 2072 6573 7065 6374  sed with respect
+00025a50: 2074 6f20 4120 6d69 6e6f 720a 2020 2020   to A minor.    
+00025a60: 2020 2020 2020 3e3e 3e20 6162 7332 7265        >>> abs2re
+00025a70: 6c5f 6b65 7928 2769 7627 2c20 2756 4927  l_key('iv', 'VI'
+00025a80: 2c20 676c 6f62 616c 5f6d 696e 6f72 3d54  , global_minor=T
+00025a90: 7275 6529 0a20 2020 2020 2020 2020 2027  rue).          '
+00025aa0: 7669 2720 2020 2020 2023 2046 206d 696e  vi'      # F min
+00025ab0: 6f72 2065 7870 7265 7373 6564 2077 6974  or expressed wit
+00025ac0: 6820 7265 7370 6563 7420 746f 2041 6220  h respect to Ab 
+00025ad0: 6d61 6a6f 720a 2020 2020 2020 2020 2020  major.          
+00025ae0: 3e3e 3e20 6162 7332 7265 6c5f 6b65 7928  >>> abs2rel_key(
+00025af0: 2769 7627 2c20 2776 6927 2c20 676c 6f62  'iv', 'vi', glob
+00025b00: 616c 5f6d 696e 6f72 3d54 7275 6529 0a20  al_minor=True). 
+00025b10: 2020 2020 2020 2020 2027 2376 6927 2020           '#vi'  
+00025b20: 2020 2020 2023 2046 206d 696e 6f72 2065       # F minor e
+00025b30: 7870 7265 7373 6564 2077 6974 6820 7265  xpressed with re
+00025b40: 7370 6563 7420 746f 2041 6220 6d69 6e6f  spect to Ab mino
+00025b50: 720a 0a20 2020 2020 2020 2020 203e 3e3e  r..          >>>
+00025b60: 2061 6273 3272 656c 5f6b 6579 2827 5649   abs2rel_key('VI
+00025b70: 272c 2027 4956 272c 2067 6c6f 6261 6c5f  ', 'IV', global_
+00025b80: 6d69 6e6f 723d 4661 6c73 6529 0a20 2020  minor=False).   
+00025b90: 2020 2020 2020 2027 4949 4927 2020 2020         'III'    
+00025ba0: 2020 2023 2041 206d 616a 6f72 2065 7870     # A major exp
+00025bb0: 7265 7373 6564 2077 6974 6820 7265 7370  ressed with resp
+00025bc0: 6563 7420 746f 2046 206d 616a 6f72 0a20  ect to F major. 
+00025bd0: 2020 2020 2020 2020 203e 3e3e 2061 6273           >>> abs
+00025be0: 3272 656c 5f6b 6579 2827 5649 272c 2027  2rel_key('VI', '
+00025bf0: 6976 272c 2067 6c6f 6261 6c5f 6d69 6e6f  iv', global_mino
+00025c00: 723d 4661 6c73 6529 0a20 2020 2020 2020  r=False).       
+00025c10: 2020 2027 2349 4949 2720 2020 2020 2020     '#III'       
+00025c20: 2320 4120 6d61 6a6f 7220 6578 7072 6573  # A major expres
+00025c30: 7365 6420 7769 7468 2072 6573 7065 6374  sed with respect
+00025c40: 2074 6f20 4620 6d69 6e6f 720a 2020 2020   to F minor.    
+00025c50: 2020 2020 2020 3e3e 3e20 6162 7332 7265        >>> abs2re
+00025c60: 6c5f 6b65 7928 2756 4927 2c20 2749 5627  l_key('VI', 'IV'
+00025c70: 2c20 676c 6f62 616c 5f6d 696e 6f72 3d54  , global_minor=T
+00025c80: 7275 6529 0a20 2020 2020 2020 2020 2027  rue).          '
+00025c90: 6249 4949 2720 2020 2020 2020 2320 4162  bIII'       # Ab
+00025ca0: 206d 616a 6f72 2065 7870 7265 7373 6564   major expressed
+00025cb0: 2077 6974 6820 7265 7370 6563 7420 746f   with respect to
+00025cc0: 2046 206d 616a 6f72 0a20 2020 2020 2020   F major.       
+00025cd0: 2020 203e 3e3e 2061 6273 3272 656c 5f6b     >>> abs2rel_k
+00025ce0: 6579 2827 5649 272c 2027 6976 272c 2067  ey('VI', 'iv', g
+00025cf0: 6c6f 6261 6c5f 6d69 6e6f 723d 4661 6c73  lobal_minor=Fals
+00025d00: 6529 0a20 2020 2020 2020 2020 2027 4949  e).          'II
+00025d10: 4927 2020 2020 2020 2023 2041 6220 6d61  I'       # Ab ma
+00025d20: 6a6f 7220 6578 7072 6573 7365 6420 7769  jor expressed wi
+00025d30: 7468 2072 6573 7065 6374 2074 6f20 4620  th respect to F 
+00025d40: 6d69 6e6f 720a 2020 2020 2222 220a 2020  minor.    """.  
+00025d50: 2020 6966 2070 642e 6973 6e75 6c6c 2861    if pd.isnull(a
+00025d60: 6273 6f6c 7574 6529 206f 7220 7064 2e69  bsolute) or pd.i
+00025d70: 736e 756c 6c28 6c6f 6361 6c6b 6579 293a  snull(localkey):
+00025d80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00025d90: 6162 736f 6c75 7465 0a20 2020 2061 6273  absolute.    abs
+00025da0: 6f6c 7574 6520 3d20 7265 736f 6c76 655f  olute = resolve_
+00025db0: 7265 6c61 7469 7665 5f6b 6579 7328 6162  relative_keys(ab
+00025dc0: 736f 6c75 7465 290a 2020 2020 6c6f 6361  solute).    loca
+00025dd0: 6c6b 6579 203d 2072 6573 6f6c 7665 5f72  lkey = resolve_r
+00025de0: 656c 6174 6976 655f 6b65 7973 286c 6f63  elative_keys(loc
+00025df0: 616c 6b65 7929 0a20 2020 206d 616a 5f72  alkey).    maj_r
+00025e00: 6e20 3d20 5b27 4927 2c20 2749 4927 2c20  n = ['I', 'II', 
+00025e10: 2749 4949 272c 2027 4956 272c 2027 5627  'III', 'IV', 'V'
+00025e20: 2c20 2756 4927 2c20 2756 4949 275d 0a20  , 'VI', 'VII']. 
+00025e30: 2020 206d 696e 5f72 6e20 3d20 5b27 6927     min_rn = ['i'
+00025e40: 2c20 2769 6927 2c20 2769 6969 272c 2027  , 'ii', 'iii', '
+00025e50: 6976 272c 2027 7627 2c20 2776 6927 2c20  iv', 'v', 'vi', 
+00025e60: 2776 6969 275d 0a20 2020 2077 6869 7465  'vii'].    white
+00025e70: 5f6b 6579 5f6d 616a 6f72 5f61 6363 6964  _key_major_accid
+00025e80: 656e 7461 6c73 203d 206e 702e 6172 7261  entals = np.arra
+00025e90: 7928 5b5b 302c 2030 2c20 302c 2030 2c20  y([[0, 0, 0, 0, 
+00025ea0: 302c 2030 2c20 305d 2c0a 2020 2020 2020  0, 0, 0],.      
+00025eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ed0: 2020 2020 2020 5b30 2c20 302c 2031 2c20        [0, 0, 1, 
+00025ee0: 302c 2030 2c20 302c 2031 5d2c 0a20 2020  0, 0, 0, 1],.   
+00025ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f10: 2020 2020 2020 2020 205b 302c 2031 2c20           [0, 1, 
+00025f20: 312c 2030 2c20 302c 2031 2c20 315d 2c0a  1, 0, 0, 1, 1],.
+00025f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f50: 2020 2020 2020 2020 2020 2020 5b30 2c20              [0, 
+00025f60: 302c 2030 2c20 2d31 2c20 302c 2030 2c20  0, 0, -1, 0, 0, 
+00025f70: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
+00025f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fa0: 5b30 2c20 302c 2030 2c20 302c 2030 2c20  [0, 0, 0, 0, 0, 
+00025fb0: 302c 2031 5d2c 0a20 2020 2020 2020 2020  0, 1],.         
+00025fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fe0: 2020 205b 302c 2030 2c20 312c 2030 2c20     [0, 0, 1, 0, 
+00025ff0: 302c 2031 2c20 315d 2c0a 2020 2020 2020  0, 1, 1],.      
+00026000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026020: 2020 2020 2020 5b30 2c20 312c 2031 2c20        [0, 1, 1, 
+00026030: 302c 2031 2c20 312c 2031 5d5d 290a 2020  0, 1, 1, 1]]).  
+00026040: 2020 6162 735f 6163 6369 6465 6e74 616c    abs_accidental
+00026050: 732c 2061 6273 6f6c 7574 6520 3d20 7370  s, absolute = sp
+00026060: 6c69 745f 7363 616c 655f 6465 6772 6565  lit_scale_degree
+00026070: 2861 6273 6f6c 7574 652c 2063 6f75 6e74  (absolute, count
+00026080: 3d54 7275 652c 206c 6f67 6765 723d 6c6f  =True, logger=lo
+00026090: 6767 6572 290a 2020 2020 6c6f 6361 6c6b  gger).    localk
+000260a0: 6579 5f61 6363 6964 656e 7461 6c73 2c20  ey_accidentals, 
+000260b0: 6c6f 6361 6c6b 6579 203d 2073 706c 6974  localkey = split
+000260c0: 5f73 6361 6c65 5f64 6567 7265 6528 6c6f  _scale_degree(lo
+000260d0: 6361 6c6b 6579 2c20 636f 756e 743d 5472  calkey, count=Tr
+000260e0: 7565 2c20 6c6f 6767 6572 3d6c 6f67 6765  ue, logger=logge
+000260f0: 7229 0a20 2020 2072 6573 756c 7469 6e67  r).    resulting
+00026100: 5f61 6363 6964 656e 7461 6c73 203d 2061  _accidentals = a
+00026110: 6273 5f61 6363 6964 656e 7461 6c73 202d  bs_accidentals -
+00026120: 206c 6f63 616c 6b65 795f 6163 6369 6465   localkey_accide
+00026130: 6e74 616c 730a 2020 2020 6e75 6d65 7261  ntals.    numera
+00026140: 6c73 203d 206d 616a 5f72 6e20 6966 2061  ls = maj_rn if a
+00026150: 6273 6f6c 7574 652e 6973 7570 7065 7228  bsolute.isupper(
+00026160: 2920 656c 7365 206d 696e 5f72 6e0a 2020  ) else min_rn.  
+00026170: 2020 6c6f 6361 6c6b 6579 5f69 6e64 6578    localkey_index
+00026180: 203d 206d 616a 5f72 6e2e 696e 6465 7828   = maj_rn.index(
+00026190: 6c6f 6361 6c6b 6579 2e75 7070 6572 2829  localkey.upper()
+000261a0: 290a 2020 2020 7265 7375 6c74 5f69 6e64  ).    result_ind
+000261b0: 6578 203d 2028 6e75 6d65 7261 6c73 2e69  ex = (numerals.i
+000261c0: 6e64 6578 2861 6273 6f6c 7574 6529 202d  ndex(absolute) -
+000261d0: 206c 6f63 616c 6b65 795f 696e 6465 7829   localkey_index)
+000261e0: 2025 2037 0a20 2020 2072 6573 756c 745f   % 7.    result_
+000261f0: 6e75 6d65 7261 6c20 3d20 6e75 6d65 7261  numeral = numera
+00026200: 6c73 5b72 6573 756c 745f 696e 6465 785d  ls[result_index]
+00026210: 0a20 2020 2069 6620 6c6f 6361 6c6b 6579  .    if localkey
+00026220: 2e69 736c 6f77 6572 2829 2061 6e64 2072  .islower() and r
+00026230: 6573 756c 745f 696e 6465 7820 696e 205b  esult_index in [
+00026240: 322c 2035 2c20 365d 3a0a 2020 2020 2020  2, 5, 6]:.      
+00026250: 2020 7265 7375 6c74 696e 675f 6163 6369    resulting_acci
+00026260: 6465 6e74 616c 7320 2b3d 2031 0a20 2020  dentals += 1.   
+00026270: 2069 6620 676c 6f62 616c 5f6d 696e 6f72   if global_minor
+00026280: 3a0a 2020 2020 2020 2020 6c6f 6361 6c6b  :.        localk
+00026290: 6579 5f69 6e64 6578 203d 2028 6c6f 6361  ey_index = (loca
+000262a0: 6c6b 6579 5f69 6e64 6578 202d 2032 2920  lkey_index - 2) 
+000262b0: 2520 370a 2020 2020 7265 7375 6c74 696e  % 7.    resultin
+000262c0: 675f 6163 6369 6465 6e74 616c 7320 2d3d  g_accidentals -=
+000262d0: 2077 6869 7465 5f6b 6579 5f6d 616a 6f72   white_key_major
+000262e0: 5f61 6363 6964 656e 7461 6c73 5b6c 6f63  _accidentals[loc
+000262f0: 616c 6b65 795f 696e 6465 785d 5b72 6573  alkey_index][res
+00026300: 756c 745f 696e 6465 785d 0a20 2020 2061  ult_index].    a
+00026310: 6363 203d 2072 6573 756c 7469 6e67 5f61  cc = resulting_a
+00026320: 6363 6964 656e 7461 6c73 202a 2027 2327  ccidentals * '#'
+00026330: 2069 6620 7265 7375 6c74 696e 675f 6163   if resulting_ac
+00026340: 6369 6465 6e74 616c 7320 3e20 3020 656c  cidentals > 0 el
+00026350: 7365 202d 7265 7375 6c74 696e 675f 6163  se -resulting_ac
+00026360: 6369 6465 6e74 616c 7320 2a20 2762 270a  cidentals * 'b'.
+00026370: 2020 2020 7265 7475 726e 2061 6363 202b      return acc +
+00026380: 2072 6573 756c 745f 6e75 6d65 7261 6c0a   result_numeral.
+00026390: 0a0a 4066 756e 6374 696f 6e5f 6c6f 6767  ..@function_logg
+000263a0: 6572 0a64 6566 2072 656c 3261 6273 5f6b  er.def rel2abs_k
+000263b0: 6579 2872 656c 6174 6976 653a 2073 7472  ey(relative: str
+000263c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000263d0: 2020 6c6f 6361 6c6b 6579 3a20 7374 722c    localkey: str,
+000263e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000263f0: 2067 6c6f 6261 6c5f 6d69 6e6f 723a 2062   global_minor: b
+00026400: 6f6f 6c20 3d20 4661 6c73 6529 3a0a 2020  ool = False):.  
+00026410: 2020 2222 2245 7870 7265 7373 6573 2061    """Expresses a
+00026420: 2052 6f6d 616e 206e 756d 6572 616c 2074   Roman numeral t
+00026430: 6861 7420 6973 2065 7870 7265 7373 6564  hat is expressed
+00026440: 2072 656c 6174 6976 6520 746f 2061 206c   relative to a l
+00026450: 6f63 616c 6b65 790a 2020 2020 6173 2073  ocalkey.    as s
+00026460: 6361 6c65 2064 6567 7265 6520 6f66 2074  cale degree of t
+00026470: 6865 2067 6c6f 6261 6c20 6b65 792e 2046  he global key. F
+00026480: 6f72 206c 6f63 616c 206b 6579 7320 7b49  or local keys {I
+00026490: 4949 2c20 6969 692c 2056 492c 2076 692c  II, iii, VI, vi,
+000264a0: 2056 4949 2c20 7669 697d 0a20 2020 2074   VII, vii}.    t
+000264b0: 6865 2072 6573 756c 7420 6368 616e 6765  he result change
+000264c0: 7320 6465 7065 6e64 696e 6720 6f6e 2077  s depending on w
+000264d0: 6865 7468 6572 2074 6865 2067 6c6f 6261  hether the globa
+000264e0: 6c20 6b65 7920 6973 206d 616a 6f72 206f  l key is major o
+000264f0: 7220 6d69 6e6f 722e 0a0a 2020 2020 5573  r minor...    Us
+00026500: 6573 3a20 3a70 793a 6675 6e63 3a60 7370  es: :py:func:`sp
+00026510: 6c69 745f 7363 616c 655f 6465 6772 6565  lit_scale_degree
+00026520: 600a 0a0a 2020 2020 4172 6773 3a0a 2020  `...    Args:.  
+00026530: 2020 2020 7265 6c61 7469 7665 3a20 5265      relative: Re
+00026540: 6c61 7469 7665 206b 6579 206f 7220 6368  lative key or ch
+00026550: 6f72 6420 6578 7072 6573 7365 6420 6173  ord expressed as
+00026560: 2052 6f6d 616e 2073 6361 6c65 2064 6567   Roman scale deg
+00026570: 7265 6520 6f66 2074 6865 206c 6f63 616c  ree of the local
+00026580: 206b 6579 2e0a 2020 2020 2020 6c6f 6361   key..      loca
+00026590: 6c6b 6579 3a20 5468 6520 6c6f 6361 6c20  lkey: The local 
+000265a0: 6b65 7920 746f 2077 6869 6368 2060 7265  key to which `re
+000265b0: 6c60 2069 7320 7265 6c61 7469 7665 2e0a  l` is relative..
+000265c0: 2020 2020 2020 676c 6f62 616c 5f6d 696e        global_min
+000265d0: 6f72 3a20 4861 7320 746f 2062 6520 7365  or: Has to be se
+000265e0: 7420 746f 2054 7275 6520 6966 2060 6c6f  t to True if `lo
+000265f0: 6361 6c6b 6579 6020 6973 2061 2073 6361  calkey` is a sca
+00026600: 6c65 2064 6567 7265 6520 6f66 2061 2067  le degree of a g
+00026610: 6c6f 6261 6c20 6d69 6e6f 7220 6b65 792e  lobal minor key.
+00026620: 0a0a 2020 2020 4578 616d 706c 6573 3a0a  ..    Examples:.
+00026630: 2020 2020 2020 4966 2074 6865 206c 6162        If the lab
+00026640: 656c 2076 6969 6f36 2f56 4920 6170 7065  el viio6/VI appe
+00026650: 6172 7320 696e 2074 6865 2063 6f6e 7465  ars in the conte
+00026660: 7874 206f 6620 7468 6520 6c6f 6361 6c20  xt of the local 
+00026670: 6b65 7920 5649 206f 7220 7669 2c0a 2020  key VI or vi,.  
+00026680: 2020 2020 7468 6520 6162 736f 6c75 7465      the absolute
+00026690: 206b 6579 2074 6f20 7768 6963 6820 7669   key to which vi
+000266a0: 696f 3620 6170 706c 6965 7320 6465 7065  io6 applies depe
+000266b0: 6e64 7320 6f6e 2074 6865 2067 6c6f 6261  nds on the globa
+000266c0: 6c20 6b65 792e 0a20 2020 2020 2054 6865  l key..      The
+000266d0: 2063 6f6d 6d65 6e74 7320 6578 7072 6573   comments expres
+000266e0: 7320 7468 6520 6578 616d 706c 6573 2069  s the examples i
+000266f0: 6e20 7265 6c61 7469 6f6e 2074 6f20 676c  n relation to gl
+00026700: 6f62 616c 2043 206d 616a 6f72 206f 7220  obal C major or 
+00026710: 4320 6d69 6e6f 722e 0a0a 2020 2020 2020  C minor...      
+00026720: 2020 2020 3e3e 3e20 7265 6c32 6162 735f      >>> rel2abs_
+00026730: 6b65 7928 2776 6927 2c20 2756 4927 2c20  key('vi', 'VI', 
+00026740: 676c 6f62 616c 5f6d 696e 6f72 3d46 616c  global_minor=Fal
+00026750: 7365 290a 2020 2020 2020 2020 2020 2723  se).          '#
+00026760: 6976 2720 2020 2020 2020 2320 7669 206f  iv'       # vi o
+00026770: 6620 4120 6d61 6a6f 7220 3d20 4623 206d  f A major = F# m
+00026780: 696e 6f72 0a20 2020 2020 2020 2020 203e  inor.          >
+00026790: 3e3e 2072 656c 3261 6273 5f6b 6579 2827  >> rel2abs_key('
+000267a0: 7669 272c 2027 7669 272c 2067 6c6f 6261  vi', 'vi', globa
+000267b0: 6c5f 6d69 6e6f 723d 4661 6c73 6529 0a20  l_minor=False). 
+000267c0: 2020 2020 2020 2020 2027 6976 2720 2020           'iv'   
+000267d0: 2020 2023 2076 6920 6f66 2041 206d 696e     # vi of A min
+000267e0: 6f72 203d 2046 206d 696e 6f72 0a20 2020  or = F minor.   
+000267f0: 2020 2020 2020 203e 3e3e 2072 656c 3261         >>> rel2a
+00026800: 6273 5f6b 6579 2827 7669 272c 2027 5649  bs_key('vi', 'VI
+00026810: 272c 2067 6c6f 6261 6c5f 6d69 6e6f 723d  ', global_minor=
+00026820: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00026830: 2769 7627 2020 2020 2020 2320 7669 206f  'iv'      # vi o
+00026840: 6620 4162 206d 616a 6f72 203d 2046 206d  f Ab major = F m
+00026850: 696e 6f72 0a20 2020 2020 2020 2020 203e  inor.          >
+00026860: 3e3e 2072 656c 3261 6273 5f6b 6579 2827  >> rel2abs_key('
+00026870: 7669 272c 2027 7669 272c 2067 6c6f 6261  vi', 'vi', globa
+00026880: 6c5f 6d69 6e6f 723d 5472 7565 290a 2020  l_minor=True).  
+00026890: 2020 2020 2020 2020 2762 6976 2720 2020          'biv'   
+000268a0: 2020 2020 2320 7669 206f 6620 4162 206d      # vi of Ab m
+000268b0: 696e 6f72 203d 2046 6220 6d69 6e6f 720a  inor = Fb minor.
+000268c0: 0a20 2020 2020 2054 6865 2073 616d 6520  .      The same 
+000268d0: 6578 616d 706c 6573 2068 6f6c 6420 6966  examples hold if
+000268e0: 2079 6f75 2772 6520 6578 7072 6573 7369   you're expressi
+000268f0: 6e67 2069 6e20 7465 726d 7320 6f66 2074  ng in terms of t
+00026900: 6865 2067 6c6f 6261 6c20 6b65 790a 2020  he global key.  
+00026910: 2020 2020 7468 6520 726f 6f74 206f 6620      the root of 
+00026920: 6120 5649 2d63 686f 7264 2077 6974 6869  a VI-chord withi
+00026930: 6e20 7468 6520 6c6f 6361 6c20 6b65 7973  n the local keys
+00026940: 2056 4920 6f72 2076 692e 0a20 2020 2022   VI or vi..    "
+00026950: 2222 0a20 2020 2069 6620 7064 2e69 736e  "".    if pd.isn
+00026960: 756c 6c28 7265 6c61 7469 7665 2920 6f72  ull(relative) or
+00026970: 2070 642e 6973 6e75 6c6c 286c 6f63 616c   pd.isnull(local
+00026980: 6b65 7929 3a0a 2020 2020 2020 2020 7265  key):.        re
+00026990: 7475 726e 2072 656c 6174 6976 650a 2020  turn relative.  
+000269a0: 2020 7265 6c61 7469 7665 203d 2072 6573    relative = res
+000269b0: 6f6c 7665 5f72 656c 6174 6976 655f 6b65  olve_relative_ke
+000269c0: 7973 2872 656c 6174 6976 6529 0a20 2020  ys(relative).   
+000269d0: 206c 6f63 616c 6b65 7920 3d20 7265 736f   localkey = reso
+000269e0: 6c76 655f 7265 6c61 7469 7665 5f6b 6579  lve_relative_key
+000269f0: 7328 6c6f 6361 6c6b 6579 290a 2020 2020  s(localkey).    
+00026a00: 6d61 6a5f 726e 203d 205b 2749 272c 2027  maj_rn = ['I', '
+00026a10: 4949 272c 2027 4949 4927 2c20 2749 5627  II', 'III', 'IV'
+00026a20: 2c20 2756 272c 2027 5649 272c 2027 5649  , 'V', 'VI', 'VI
+00026a30: 4927 5d0a 2020 2020 6d69 6e5f 726e 203d  I'].    min_rn =
+00026a40: 205b 2769 272c 2027 6969 272c 2027 6969   ['i', 'ii', 'ii
+00026a50: 6927 2c20 2769 7627 2c20 2776 272c 2027  i', 'iv', 'v', '
+00026a60: 7669 272c 2027 7669 6927 5d0a 2020 2020  vi', 'vii'].    
+00026a70: 7768 6974 655f 6b65 795f 6d61 6a6f 725f  white_key_major_
+00026a80: 6163 6369 6465 6e74 616c 7320 3d20 6e70  accidentals = np
+00026a90: 2e61 7272 6179 285b 5b30 2c20 302c 2030  .array([[0, 0, 0
+00026aa0: 2c20 302c 2030 2c20 302c 2030 5d2c 0a20  , 0, 0, 0, 0],. 
+00026ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ad0: 2020 2020 2020 2020 2020 2020 5b30 2c20              [0, 
+00026ae0: 302c 2031 2c20 302c 2030 2c20 302c 2031  0, 1, 0, 0, 0, 1
+00026af0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00026b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b20: 5b30 2c20 312c 2031 2c20 302c 2030 2c20  [0, 1, 1, 0, 0, 
+00026b30: 312c 2031 5d2c 0a20 2020 2020 2020 2020  1, 1],.         
+00026b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b60: 2020 2020 5b30 2c20 302c 2030 2c20 2d31      [0, 0, 0, -1
+00026b70: 2c20 302c 2030 2c20 305d 2c0a 2020 2020  , 0, 0, 0],.    
+00026b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ba0: 2020 2020 2020 2020 205b 302c 2030 2c20           [0, 0, 
+00026bb0: 302c 2030 2c20 302c 2030 2c20 315d 2c0a  0, 0, 0, 0, 1],.
+00026bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026be0: 2020 2020 2020 2020 2020 2020 205b 302c               [0,
+00026bf0: 2030 2c20 312c 2030 2c20 302c 2031 2c20   0, 1, 0, 0, 1, 
+00026c00: 315d 2c0a 2020 2020 2020 2020 2020 2020  1],.            
+00026c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00026c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026c30: 2020 2020 2020 2020 2020 2020 726f 756e              roun
-00026c40: 643d 4e6f 6e65 2c20 6e61 6d65 3d27 696e  d=None, name='in
-00026c50: 7465 7276 616c 2729 3a0a 2020 2020 2222  terval'):.    ""
-00026c60: 2247 6976 656e 2061 6e20 616e 6e6f 7461  "Given an annota
-00026c70: 7469 6f6e 7320 7461 626c 6520 7769 7468  tions table with
-00026c80: 2070 6f73 6974 696f 6e73 2061 6e64 2064   positions and d
-00026c90: 7572 6174 696f 6e73 2c20 6372 6561 7465  urations, create
-00026ca0: 2061 6e20 3a6f 626a 3a60 7061 6e64 6173   an :obj:`pandas
-00026cb0: 2e49 6e74 6572 7661 6c49 6e64 6578 602e  .IntervalIndex`.
-00026cc0: 0a20 2020 2052 6574 7572 6e73 204e 6f6e  .    Returns Non
-00026cd0: 6520 6966 2061 6e79 2072 6f77 2069 7320  e if any row is 
-00026ce0: 756e 6465 7273 7065 6369 6669 6564 2e0a  underspecified..
-00026cf0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00026d00: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00026d10: 2020 2064 6620 3a20 3a6f 626a 3a60 7061     df : :obj:`pa
-00026d20: 6e64 6173 2e44 6174 6146 7261 6d65 600a  ndas.DataFrame`.
-00026d30: 2020 2020 2020 2020 416e 6e6f 7461 7469          Annotati
-00026d40: 6f6e 2074 6162 6c65 2063 6f6e 7461 696e  on table contain
-00026d50: 696e 6720 7468 6520 636f 6c75 6d6e 7320  ing the columns 
-00026d60: 6f66 2060 6070 6f73 6974 696f 6e5f 636f  of ``position_co
-00026d70: 6c60 6020 2864 6566 6175 6c74 3a20 2771  l`` (default: 'q
-00026d80: 7561 7274 6572 6265 6174 7327 2920 616e  uarterbeats') an
-00026d90: 6420 6060 6475 7261 7469 6f6e 5f63 6f6c  d ``duration_col
-00026da0: 6060 0a20 2020 2020 2020 2064 6566 6175  ``.        defau
-00026db0: 6c74 3a20 2764 7572 6174 696f 6e5f 7162  lt: 'duration_qb
-00026dc0: 2729 2e0a 2020 2020 706f 7369 7469 6f6e  ')..    position
-00026dd0: 5f63 6f6c 203a 203a 6f62 6a3a 6073 7472  _col : :obj:`str
-00026de0: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
-00026df0: 2020 2020 4e61 6d65 206f 6620 7468 6520      Name of the 
-00026e00: 636f 6c75 6d6e 2063 6f6e 7461 696e 696e  column containin
-00026e10: 6720 706f 7369 7469 6f6e 732c 2075 7365  g positions, use
-00026e20: 6420 6173 206c 6566 7420 626f 756e 6461  d as left bounda
-00026e30: 7269 6573 2e0a 2020 2020 6475 7261 7469  ries..    durati
-00026e40: 6f6e 5f63 6f6c 203a 203a 6f62 6a3a 6073  on_col : :obj:`s
-00026e50: 7472 602c 206f 7074 696f 6e61 6c0a 2020  tr`, optional.  
-00026e60: 2020 2020 2020 4e61 6d65 206f 6620 7468        Name of th
-00026e70: 6520 636f 6c75 6d6e 2063 6f6e 7461 696e  e column contain
-00026e80: 696e 6720 6475 7261 7469 6f6e 7320 7768  ing durations wh
-00026e90: 6963 6820 7769 6c6c 2062 6520 6164 6465  ich will be adde
-00026ea0: 6420 746f 2074 6865 2070 6f73 6974 696f  d to the positio
-00026eb0: 6e73 2074 6f20 6f62 7461 696e 2072 6967  ns to obtain rig
-00026ec0: 6874 2062 6f75 6e64 6172 6965 732e 0a20  ht boundaries.. 
-00026ed0: 2020 2063 6c6f 7365 6420 3a20 3a6f 626a     closed : :obj
-00026ee0: 3a60 7374 7260 2c20 6f70 7469 6f6e 616c  :`str`, optional
-00026ef0: 0a20 2020 2020 2020 2027 6c65 6674 272c  .        'left',
-00026f00: 2027 7269 6768 7427 206f 7220 2762 6f74   'right' or 'bot
-00026f10: 6827 203c 2d20 6465 6669 6e69 6e67 2074  h' <- defining t
-00026f20: 6865 2069 6e74 6572 7661 6c20 626f 756e  he interval boun
-00026f30: 6461 7269 6573 0a20 2020 2072 6f75 6e64  daries.    round
-00026f40: 203a 203a 6f62 6a3a 6069 6e74 602c 206f   : :obj:`int`, o
-00026f50: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00026f60: 546f 2068 6f77 206d 616e 7920 6465 6369  To how many deci
-00026f70: 6d61 6c20 706c 6163 6573 2074 6f20 726f  mal places to ro
-00026f80: 756e 6420 7468 6520 696e 7465 7276 616c  und the interval
-00026f90: 7327 2062 6f75 6e64 6172 7920 7661 6c75  s' boundary valu
-00026fa0: 6573 2e0a 2020 2020 6e61 6d65 203a 203a  es..    name : :
-00026fb0: 6f62 6a3a 6073 7472 602c 206f 7074 696f  obj:`str`, optio
-00026fc0: 6e61 6c0a 2020 2020 2020 2020 4e61 6d65  nal.        Name
-00026fd0: 206f 6620 7468 6520 6372 6561 7465 6420   of the created 
-00026fe0: 696e 6465 782e 2044 6566 6175 6c74 7320  index. Defaults 
-00026ff0: 746f 2027 696e 7465 7276 616c 272e 0a0a  to 'interval'...
-00027000: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00027010: 2d2d 2d2d 2d2d 2d0a 2020 2020 3a6f 626a  -------.    :obj
-00027020: 3a60 7061 6e64 6173 2e49 6e74 6572 7661  :`pandas.Interva
-00027030: 6c49 6e64 6578 600a 2020 2020 2020 2020  lIndex`.        
-00027040: 4120 636f 7079 206f 6620 6060 6466 6060  A copy of ``df``
-00027050: 2077 6974 6820 7468 6520 6f72 6967 696e   with the origin
-00027060: 616c 2069 6e64 6578 2072 6570 6c61 6365  al index replace
-00027070: 6420 616e 6420 756e 6465 7273 7065 6369  d and underspeci
-00027080: 6669 6564 2072 6f77 7320 7265 6d6f 7665  fied rows remove
-00027090: 6420 2874 686f 7365 2077 6865 7265 206e  d (those where n
-000270a0: 6f20 696e 7465 7276 616c 0a20 2020 2020  o interval.     
-000270b0: 2020 2063 6f75 6c64 2062 6520 636f 7075     could be copu
-000270c0: 7465 6429 2e0a 2020 2020 2222 220a 2020  ted)..    """.  
-000270d0: 2020 6966 206e 6f74 2061 6c6c 2863 2069    if not all(c i
-000270e0: 6e20 6466 2e63 6f6c 756d 6e73 2066 6f72  n df.columns for
-000270f0: 2063 2069 6e20 2870 6f73 6974 696f 6e5f   c in (position_
-00027100: 636f 6c2c 2064 7572 6174 696f 6e5f 636f  col, duration_co
-00027110: 6c29 293a 0a20 2020 2020 2020 206d 6973  l)):.        mis
-00027120: 7369 6e67 203d 205b 6320 666f 7220 6320  sing = [c for c 
-00027130: 696e 2028 706f 7369 7469 6f6e 5f63 6f6c  in (position_col
-00027140: 2c20 6475 7261 7469 6f6e 5f63 6f6c 2920  , duration_col) 
-00027150: 6966 2063 206e 6f74 2069 6e20 6466 2e63  if c not in df.c
-00027160: 6f6c 756d 6e73 5d0a 2020 2020 2020 2020  olumns].        
-00027170: 706c 7572 616c 203d 2027 7327 2069 6620  plural = 's' if 
-00027180: 6c65 6e28 6d69 7373 696e 6729 203e 2031  len(missing) > 1
-00027190: 2065 6c73 6520 2727 0a20 2020 2020 2020   else ''.       
-000271a0: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-000271b0: 6622 436f 6c75 6d6e 7b70 6c75 7261 6c7d  f"Column{plural}
-000271c0: 206e 6f74 2070 7265 7365 6e74 2069 6e20   not present in 
-000271d0: 4461 7461 4672 616d 653a 207b 272c 2027  DataFrame: {', '
-000271e0: 2e6a 6f69 6e28 6d69 7373 696e 6729 7d22  .join(missing)}"
-000271f0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00027200: 0a20 2020 2069 6620 6466 5b70 6f73 6974  .    if df[posit
-00027210: 696f 6e5f 636f 6c5d 2e69 736e 6128 292e  ion_col].isna().
-00027220: 616e 7928 2920 6f72 2064 665b 6475 7261  any() or df[dura
-00027230: 7469 6f6e 5f63 6f6c 5d2e 6973 6e61 2829  tion_col].isna()
-00027240: 2e61 6e79 2829 3a0a 2020 2020 2020 2020  .any():.        
-00027250: 6d69 7373 696e 6720 3d20 6466 5b64 665b  missing = df[df[
-00027260: 5b70 6f73 6974 696f 6e5f 636f 6c2c 2064  [position_col, d
-00027270: 7572 6174 696f 6e5f 636f 6c5d 5d2e 6973  uration_col]].is
-00027280: 6e61 2829 2e61 6e79 2861 7869 733d 3129  na().any(axis=1)
-00027290: 5d0a 2020 2020 2020 2020 6c6f 6767 6572  ].        logger
-000272a0: 2e77 6172 6e69 6e67 2866 2243 6f75 6c64  .warning(f"Could
-000272b0: 206e 6f74 206d 616b 6520 496e 7465 7276   not make Interv
-000272c0: 616c 496e 6465 7820 6265 6361 7573 6520  alIndex because 
-000272d0: 6f66 206d 6973 7369 6e67 2076 616c 7565  of missing value
-000272e0: 733a 5c6e 7b6d 6973 7369 6e67 7d22 290a  s:\n{missing}").
-000272f0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00027300: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00027310: 6c65 6674 203d 2064 665b 706f 7369 7469  left = df[positi
-00027320: 6f6e 5f63 6f6c 5d2e 6173 7479 7065 2866  on_col].astype(f
-00027330: 6c6f 6174 290a 2020 2020 2020 2020 7269  loat).        ri
-00027340: 6768 7420 3d20 286c 6566 7420 2b20 6466  ght = (left + df
-00027350: 5b64 7572 6174 696f 6e5f 636f 6c5d 292e  [duration_col]).
-00027360: 6173 7479 7065 2866 6c6f 6174 290a 2020  astype(float).  
-00027370: 2020 2020 2020 6966 2072 6f75 6e64 2069        if round i
-00027380: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00027390: 2020 2020 2020 2020 6c65 6674 2c20 7269          left, ri
-000273a0: 6768 7420 3d20 6c65 6674 2e72 6f75 6e64  ght = left.round
-000273b0: 2872 6f75 6e64 292c 2072 6967 6874 2e72  (round), right.r
-000273c0: 6f75 6e64 2872 6f75 6e64 290a 2020 2020  ound(round).    
-000273d0: 2020 2020 7265 7475 726e 2070 642e 496e      return pd.In
-000273e0: 7465 7276 616c 496e 6465 782e 6672 6f6d  tervalIndex.from
-000273f0: 5f61 7272 6179 7328 6c65 6674 3d6c 6566  _arrays(left=lef
-00027400: 742c 2072 6967 6874 3d72 6967 6874 2c20  t, right=right, 
-00027410: 636c 6f73 6564 3d63 6c6f 7365 642c 206e  closed=closed, n
-00027420: 616d 653d 6e61 6d65 290a 2020 2020 6578  ame=name).    ex
-00027430: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00027440: 7320 653a 0a20 2020 2020 2020 206c 6f67  s e:.        log
-00027450: 6765 722e 7761 726e 696e 6728 6622 4372  ger.warning(f"Cr
-00027460: 6561 7469 6e67 2049 6e74 6572 7661 6c49  eating IntervalI
-00027470: 6e64 6578 2066 6169 6c65 6420 7769 7468  ndex failed with
-00027480: 2065 7863 6570 7469 6f6e 207b 657d 2e22   exception {e}."
-00027490: 290a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  )..@function_log
-000274a0: 6765 720a 6465 6620 7265 706c 6163 655f  ger.def replace_
-000274b0: 696e 6465 785f 6279 5f69 6e74 6572 7661  index_by_interva
-000274c0: 6c73 2864 662c 2070 6f73 6974 696f 6e5f  ls(df, position_
-000274d0: 636f 6c3d 2771 7561 7274 6572 6265 6174  col='quarterbeat
-000274e0: 7327 2c20 6475 7261 7469 6f6e 5f63 6f6c  s', duration_col
-000274f0: 3d27 6475 7261 7469 6f6e 5f71 6227 2c20  ='duration_qb', 
-00027500: 636c 6f73 6564 3d27 6c65 6674 272c 0a20  closed='left',. 
-00027510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027520: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00027530: 6c74 6572 5f7a 6572 6f5f 6475 7261 7469  lter_zero_durati
-00027540: 6f6e 3d46 616c 7365 2c20 726f 756e 643d  on=False, round=
-00027550: 4e6f 6e65 2c20 6e61 6d65 3d27 696e 7465  None, name='inte
-00027560: 7276 616c 2729 3a0a 2020 2020 2222 2247  rval'):.    """G
-00027570: 6976 656e 2061 6e20 616e 6e6f 7461 7469  iven an annotati
-00027580: 6f6e 7320 7461 626c 6520 7769 7468 2070  ons table with p
-00027590: 6f73 6974 696f 6e73 2061 6e64 2064 7572  ositions and dur
-000275a0: 6174 696f 6e73 2c20 7265 706c 6163 6573  ations, replaces
-000275b0: 2069 7473 2069 6e64 6578 2077 6974 6820   its index with 
-000275c0: 616e 203a 6f62 6a3a 6070 616e 6461 732e  an :obj:`pandas.
-000275d0: 496e 7465 7276 616c 496e 6465 7860 2e0a  IntervalIndex`..
-000275e0: 2020 2020 556e 6465 7273 7065 6369 6669      Underspecifi
-000275f0: 6564 2072 6f77 7320 6172 6520 7265 6d6f  ed rows are remo
-00027600: 7665 642e 0a0a 2020 2020 5061 7261 6d65  ved...    Parame
-00027610: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-00027620: 2d2d 2d0a 2020 2020 6466 203a 203a 6f62  ---.    df : :ob
-00027630: 6a3a 6070 616e 6461 732e 4461 7461 4672  j:`pandas.DataFr
-00027640: 616d 6560 0a20 2020 2020 2020 2041 6e6e  ame`.        Ann
-00027650: 6f74 6174 696f 6e20 7461 626c 6520 636f  otation table co
-00027660: 6e74 6169 6e69 6e67 2074 6865 2063 6f6c  ntaining the col
-00027670: 756d 6e73 206f 6620 6060 706f 7369 7469  umns of ``positi
-00027680: 6f6e 5f63 6f6c 6060 2028 6465 6661 756c  on_col`` (defaul
-00027690: 743a 2027 7175 6172 7465 7262 6561 7473  t: 'quarterbeats
-000276a0: 2729 2061 6e64 2060 6064 7572 6174 696f  ') and ``duratio
-000276b0: 6e5f 636f 6c60 600a 2020 2020 2020 2020  n_col``.        
-000276c0: 6465 6661 756c 743a 2027 6475 7261 7469  default: 'durati
-000276d0: 6f6e 5f71 6227 292e 0a20 2020 2070 6f73  on_qb')..    pos
-000276e0: 6974 696f 6e5f 636f 6c20 3a20 3a6f 626a  ition_col : :obj
-000276f0: 3a60 7374 7260 2c20 6f70 7469 6f6e 616c  :`str`, optional
-00027700: 0a20 2020 2020 2020 204e 616d 6520 6f66  .        Name of
-00027710: 2074 6865 2063 6f6c 756d 6e20 636f 6e74   the column cont
-00027720: 6169 6e69 6e67 2070 6f73 6974 696f 6e73  aining positions
-00027730: 2e0a 2020 2020 6475 7261 7469 6f6e 5f63  ..    duration_c
-00027740: 6f6c 203a 203a 6f62 6a3a 6073 7472 602c  ol : :obj:`str`,
-00027750: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00027760: 2020 4e61 6d65 206f 6620 7468 6520 636f    Name of the co
-00027770: 6c75 6d6e 2063 6f6e 7461 696e 696e 6720  lumn containing 
-00027780: 6475 7261 7469 6f6e 732e 0a20 2020 2063  durations..    c
-00027790: 6c6f 7365 6420 3a20 3a6f 626a 3a60 7374  losed : :obj:`st
-000277a0: 7260 2c20 6f70 7469 6f6e 616c 0a20 2020  r`, optional.   
-000277b0: 2020 2020 2027 6c65 6674 272c 2027 7269       'left', 'ri
-000277c0: 6768 7427 206f 7220 2762 6f74 6827 203c  ght' or 'both' <
-000277d0: 2d20 6465 6669 6e69 6e67 2074 6865 2069  - defining the i
-000277e0: 6e74 6572 7661 6c20 626f 756e 6461 7269  nterval boundari
-000277f0: 6573 0a20 2020 2066 696c 7465 725f 7a65  es.    filter_ze
-00027800: 726f 5f64 7572 6174 696f 6e20 3a20 3a6f  ro_duration : :o
-00027810: 626a 3a60 626f 6f6c 602c 206f 7074 696f  bj:`bool`, optio
-00027820: 6e61 6c0a 2020 2020 2020 2020 4465 6661  nal.        Defa
-00027830: 756c 7473 2074 6f20 4661 6c73 652c 206d  ults to False, m
-00027840: 6561 6e69 6e67 2074 6861 7420 726f 7773  eaning that rows
-00027850: 2077 6974 6820 7a65 726f 2064 7572 6174   with zero durat
-00027860: 696f 6e73 2061 7265 206d 6169 6e74 6169  ions are maintai
-00027870: 6e65 642e 2050 6173 7320 5472 7565 2074  ned. Pass True t
-00027880: 6f20 7265 6d6f 7665 2074 6865 6d2e 0a20  o remove them.. 
-00027890: 2020 2072 6f75 6e64 203a 203a 6f62 6a3a     round : :obj:
-000278a0: 6069 6e74 602c 206f 7074 696f 6e61 6c0a  `int`, optional.
-000278b0: 2020 2020 2020 2020 546f 2068 6f77 206d          To how m
-000278c0: 616e 7920 6465 6369 6d61 6c20 706c 6163  any decimal plac
-000278d0: 6573 2074 6f20 726f 756e 6420 7468 6520  es to round the 
-000278e0: 696e 7465 7276 616c 7327 2062 6f75 6e64  intervals' bound
-000278f0: 6172 7920 7661 6c75 6573 2e0a 2020 2020  ary values..    
-00027900: 6e61 6d65 203a 203a 6f62 6a3a 6073 7472  name : :obj:`str
-00027910: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
-00027920: 2020 2020 4e61 6d65 206f 6620 7468 6520      Name of the 
-00027930: 6372 6561 7465 6420 696e 6465 782e 2044  created index. D
-00027940: 6566 6175 6c74 7320 746f 2027 696e 7465  efaults to 'inte
-00027950: 7276 616c 272e 0a0a 2020 2020 5265 7475  rval'...    Retu
-00027960: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-00027970: 2020 2020 3a6f 626a 3a60 7061 6e64 6173      :obj:`pandas
-00027980: 2e44 6174 6146 7261 6d65 600a 2020 2020  .DataFrame`.    
-00027990: 2020 2020 4120 636f 7079 206f 6620 6060      A copy of ``
-000279a0: 6466 6060 2077 6974 6820 7468 6520 6f72  df`` with the or
-000279b0: 6967 696e 616c 2069 6e64 6578 2072 6570  iginal index rep
-000279c0: 6c61 6365 6420 616e 6420 756e 6465 7273  laced and unders
-000279d0: 7065 6369 6669 6564 2072 6f77 7320 7265  pecified rows re
-000279e0: 6d6f 7665 6420 2874 686f 7365 2077 6865  moved (those whe
-000279f0: 7265 206e 6f20 696e 7465 7276 616c 0a20  re no interval. 
-00027a00: 2020 2020 2020 2063 6f75 6c64 2062 6520         could be 
-00027a10: 636f 6d70 7574 6564 292e 0a20 2020 2022  computed)..    "
-00027a20: 2222 0a20 2020 2069 6620 6e6f 7420 616c  "".    if not al
-00027a30: 6c28 6320 696e 2064 662e 636f 6c75 6d6e  l(c in df.column
-00027a40: 7320 666f 7220 6320 696e 2028 706f 7369  s for c in (posi
-00027a50: 7469 6f6e 5f63 6f6c 2c20 6475 7261 7469  tion_col, durati
-00027a60: 6f6e 5f63 6f6c 2929 3a0a 2020 2020 2020  on_col)):.      
-00027a70: 2020 6d69 7373 696e 6720 3d20 5b63 2066    missing = [c f
-00027a80: 6f72 2063 2069 6e20 2870 6f73 6974 696f  or c in (positio
-00027a90: 6e5f 636f 6c2c 2064 7572 6174 696f 6e5f  n_col, duration_
-00027aa0: 636f 6c29 2069 6620 6320 6e6f 7420 696e  col) if c not in
-00027ab0: 2064 662e 636f 6c75 6d6e 735d 0a20 2020   df.columns].   
-00027ac0: 2020 2020 2070 6c75 7261 6c20 3d20 2773       plural = 's
-00027ad0: 2720 6966 206c 656e 286d 6973 7369 6e67  ' if len(missing
-00027ae0: 2920 3e20 3120 656c 7365 2027 270a 2020  ) > 1 else ''.  
-00027af0: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
-00027b00: 6e69 6e67 2866 2243 6f6c 756d 6e7b 706c  ning(f"Column{pl
-00027b10: 7572 616c 7d20 6e6f 7420 7072 6573 656e  ural} not presen
-00027b20: 7420 696e 2044 6174 6146 7261 6d65 3a20  t in DataFrame: 
-00027b30: 7b27 2c20 272e 6a6f 696e 286d 6973 7369  {', '.join(missi
-00027b40: 6e67 297d 2229 0a20 2020 2020 2020 2072  ng)}").        r
-00027b50: 6574 7572 6e20 6466 0a20 2020 206d 6173  eturn df.    mas
-00027b60: 6b20 3d20 6466 5b70 6f73 6974 696f 6e5f  k = df[position_
-00027b70: 636f 6c5d 2e6e 6f74 6e61 2829 2026 2028  col].notna() & (
-00027b80: 6466 5b70 6f73 6974 696f 6e5f 636f 6c5d  df[position_col]
-00027b90: 2021 3d20 2727 2920 2620 6466 5b64 7572   != '') & df[dur
-00027ba0: 6174 696f 6e5f 636f 6c5d 2e6e 6f74 6e61  ation_col].notna
-00027bb0: 2829 0a20 2020 206e 5f64 726f 7070 6564  ().    n_dropped
-00027bc0: 203d 2028 7e6d 6173 6b29 2e73 756d 2829   = (~mask).sum()
-00027bd0: 0a20 2020 2069 6620 6669 6c74 6572 5f7a  .    if filter_z
-00027be0: 6572 6f5f 6475 7261 7469 6f6e 3a0a 2020  ero_duration:.  
-00027bf0: 2020 2020 2020 6d61 736b 2026 3d20 2864        mask &= (d
-00027c00: 665b 6475 7261 7469 6f6e 5f63 6f6c 5d20  f[duration_col] 
-00027c10: 3e20 3029 0a20 2020 2065 6c69 6620 6e5f  > 0).    elif n_
-00027c20: 6472 6f70 7065 6420 3e20 303a 0a20 2020  dropped > 0:.   
-00027c30: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-00027c40: 2866 2248 6164 2074 6f20 6472 6f70 207b  (f"Had to drop {
-00027c50: 6e5f 6472 6f70 7065 647d 2072 6f77 7320  n_dropped} rows 
-00027c60: 666f 7220 6372 6561 7469 6e67 2074 6865  for creating the
-00027c70: 2049 6e74 6572 7661 6c49 6e64 6578 3a5c   IntervalIndex:\
-00027c80: 6e7b 6466 5b7e 6d61 736b 5d7d 2229 0a20  n{df[~mask]}"). 
-00027c90: 2020 2064 6620 3d20 6466 5b6d 6173 6b5d     df = df[mask]
-00027ca0: 2e63 6f70 7928 290a 2020 2020 6976 5f69  .copy().    iv_i
-00027cb0: 6e64 6578 203d 206d 616b 655f 696e 7465  ndex = make_inte
-00027cc0: 7276 616c 5f69 6e64 6578 5f66 726f 6d5f  rval_index_from_
-00027cd0: 6475 7261 7469 6f6e 7328 6466 2c20 706f  durations(df, po
-00027ce0: 7369 7469 6f6e 5f63 6f6c 3d70 6f73 6974  sition_col=posit
-00027cf0: 696f 6e5f 636f 6c2c 2064 7572 6174 696f  ion_col, duratio
-00027d00: 6e5f 636f 6c3d 6475 7261 7469 6f6e 5f63  n_col=duration_c
-00027d10: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
-00027d20: 2020 2020 2020 2020 636c 6f73 6564 3d63          closed=c
-00027d30: 6c6f 7365 642c 2072 6f75 6e64 3d72 6f75  losed, round=rou
-00027d40: 6e64 2c20 6e61 6d65 3d6e 616d 652c 206c  nd, name=name, l
-00027d50: 6f67 6765 723d 6c6f 6767 6572 290a 2020  ogger=logger).  
-00027d60: 2020 6966 2064 665b 6475 7261 7469 6f6e    if df[duration
-00027d70: 5f63 6f6c 5d2e 6474 7970 6520 213d 2066  _col].dtype != f
-00027d80: 6c6f 6174 3a0a 2020 2020 2020 2020 7769  loat:.        wi
-00027d90: 7468 2077 6172 6e69 6e67 732e 6361 7463  th warnings.catc
-00027da0: 685f 7761 726e 696e 6773 2829 3a0a 2020  h_warnings():.  
-00027db0: 2020 2020 2020 2020 2020 2320 5365 7474            # Sett
-00027dc0: 696e 6720 7661 6c75 6573 2069 6e2d 706c  ing values in-pl
-00027dd0: 6163 6520 6973 2066 696e 652c 2069 676e  ace is fine, ign
-00027de0: 6f72 6520 7468 6520 7761 726e 696e 6720  ore the warning 
-00027df0: 696e 2050 616e 6461 7320 3e3d 2031 2e35  in Pandas >= 1.5
-00027e00: 2e30 0a20 2020 2020 2020 2020 2020 2023  .0.            #
-00027e10: 2054 6869 7320 6361 6e20 6265 2072 656d   This can be rem
-00027e20: 6f76 6564 2c20 6966 2050 616e 6461 7320  oved, if Pandas 
-00027e30: 312e 352e 3020 646f 6573 206e 6f74 206e  1.5.0 does not n
-00027e40: 6565 6420 746f 2062 6520 7375 7070 6f72  eed to be suppor
-00027e50: 7465 6420 616e 7920 6c6f 6e67 6572 2e0a  ted any longer..
-00027e60: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
-00027e70: 6520 616c 736f 3a20 6874 7470 733a 2f2f  e also: https://
-00027e80: 7374 6163 6b6f 7665 7266 6c6f 772e 636f  stackoverflow.co
-00027e90: 6d2f 712f 3734 3035 3733 3637 2f38 3539  m/q/74057367/859
-00027ea0: 3539 310a 2020 2020 2020 2020 2020 2020  591.            
-00027eb0: 7761 726e 696e 6773 2e66 696c 7465 7277  warnings.filterw
-00027ec0: 6172 6e69 6e67 7328 0a20 2020 2020 2020  arnings(.       
-00027ed0: 2020 2020 2020 2020 2022 6967 6e6f 7265           "ignore
-00027ee0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00027ef0: 2020 2063 6174 6567 6f72 793d 4675 7475     category=Futu
-00027f00: 7265 5761 726e 696e 672c 0a20 2020 2020  reWarning,.     
-00027f10: 2020 2020 2020 2020 2020 206d 6573 7361             messa
-00027f20: 6765 3d28 0a20 2020 2020 2020 2020 2020  ge=(.           
-00027f30: 2020 2020 2020 2020 2022 2e2a 7769 6c6c           ".*will
-00027f40: 2061 7474 656d 7074 2074 6f20 7365 7420   attempt to set 
-00027f50: 7468 6520 7661 6c75 6573 2069 6e70 6c61  the values inpla
-00027f60: 6365 2069 6e73 7465 6164 206f 6620 616c  ce instead of al
-00027f70: 7761 7973 2073 6574 7469 6e67 2061 206e  ways setting a n
-00027f80: 6577 2061 7272 6179 2e20 220a 2020 2020  ew array. ".    
-00027f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fa0: 2254 6f20 7265 7461 696e 2074 6865 206f  "To retain the o
-00027fb0: 6c64 2062 6568 6176 696f 722c 2075 7365  ld behavior, use
-00027fc0: 2065 6974 6865 722e 2a22 0a20 2020 2020   either.*".     
-00027fd0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00027fe0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00027ff0: 2020 2020 2020 2020 6466 2e6c 6f63 5b3a          df.loc[:
-00028000: 2c20 6475 7261 7469 6f6e 5f63 6f6c 5d20  , duration_col] 
-00028010: 3d20 7064 2e74 6f5f 6e75 6d65 7269 6328  = pd.to_numeric(
-00028020: 6466 5b64 7572 6174 696f 6e5f 636f 6c5d  df[duration_col]
-00028030: 290a 2020 2020 6966 2069 765f 696e 6465  ).    if iv_inde
-00028040: 7820 6973 204e 6f6e 653a 0a20 2020 2020  x is None:.     
-00028050: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
-00028060: 6728 2243 7265 6174 696e 6720 496e 7465  g("Creating Inte
-00028070: 7276 616c 496e 6465 7820 6661 696c 6564  rvalIndex failed
-00028080: 2e22 290a 2020 2020 2020 2020 7265 7475  .").        retu
-00028090: 726e 2064 660a 2020 2020 6466 2e69 6e64  rn df.    df.ind
-000280a0: 6578 203d 2069 765f 696e 6465 780a 2020  ex = iv_index.  
-000280b0: 2020 7265 7475 726e 2064 660a 0a64 6566    return df..def
-000280c0: 2062 6f6f 6c65 616e 5f6d 6f64 655f 636f   boolean_mode_co
-000280d0: 6c32 7374 7269 6e67 7328 5329 202d 3e20  l2strings(S) -> 
-000280e0: 7064 2e53 6572 6965 733a 0a20 2020 2022  pd.Series:.    "
-000280f0: 2222 5475 726e 2074 6865 2062 6f6f 6c65  ""Turn the boole
-00028100: 616e 2069 735f 6d69 6e6f 7220 636f 6c75  an is_minor colu
-00028110: 6d6e 7320 696e 746f 2073 7472 696e 6720  mns into string 
-00028120: 636f 6c75 6d6e 7320 7375 6368 2074 6861  columns such tha
-00028130: 7420 5472 7565 203d 3e20 276d 696e 6f72  t True => 'minor
-00028140: 272c 2046 616c 7365 203d 3e20 276d 616a  ', False => 'maj
-00028150: 6f72 272e 2222 220a 2020 2020 7265 7475  or'.""".    retu
-00028160: 726e 2053 2e6d 6170 287b 5472 7565 3a20  rn S.map({True: 
-00028170: 276d 696e 6f72 272c 2046 616c 7365 3a20  'minor', False: 
-00028180: 276d 616a 6f72 277d 290a 0a64 6566 2072  'major'})..def r
-00028190: 6570 6c61 6365 5f62 6f6f 6c65 616e 5f6d  eplace_boolean_m
-000281a0: 6f64 655f 6279 5f73 7472 696e 6773 2864  ode_by_strings(d
-000281b0: 6629 202d 3e20 7064 2e44 6174 6146 7261  f) -> pd.DataFra
-000281c0: 6d65 3a0a 2020 2020 2222 2252 6570 6c61  me:.    """Repla
-000281d0: 6365 7320 626f 6f6c 6561 6e20 275f 6973  ces boolean '_is
-000281e0: 5f6d 696e 6f72 2720 636f 6c75 6d6e 7320  _minor' columns 
-000281f0: 7769 7468 2073 7472 696e 6720 636f 6c75  with string colu
-00028200: 6d6e 7320 7265 6e61 6d65 6420 746f 2027  mns renamed to '
-00028210: 5f6d 6f64 6527 2e0a 2020 2020 4578 616d  _mode'..    Exam
-00028220: 706c 653a 2064 665b 2773 6f6d 655f 636f  ple: df['some_co
-00028230: 6c27 2c20 2773 6f6d 655f 6e61 6d65 5f69  l', 'some_name_i
-00028240: 735f 6d69 6e6f 7227 5d20 3d3e 2064 665b  s_minor'] => df[
-00028250: 2773 6f6d 655f 636f 6c27 2c20 2773 6f6d  'some_col', 'som
-00028260: 655f 6e61 6d65 5f6d 6f64 6527 5d0a 2020  e_name_mode'].  
-00028270: 2020 2222 220a 2020 2020 626f 6f6c 5f63    """.    bool_c
-00028280: 6f6c 7320 3d20 5b63 6f6c 2066 6f72 2063  ols = [col for c
-00028290: 6f6c 2069 6e20 6466 2e63 6f6c 756d 6e73  ol in df.columns
-000282a0: 2069 6620 636f 6c2e 656e 6473 7769 7468   if col.endswith
-000282b0: 2827 5f69 735f 6d69 6e6f 7227 295d 0a20  ('_is_minor')]. 
-000282c0: 2020 2069 6620 6c65 6e28 626f 6f6c 5f63     if len(bool_c
-000282d0: 6f6c 7329 203d 3d20 303a 0a20 2020 2020  ols) == 0:.     
-000282e0: 2020 2072 6574 7572 6e20 6466 0a20 2020     return df.   
-000282f0: 2064 6620 3d20 6466 2e63 6f70 7928 290a   df = df.copy().
-00028300: 2020 2020 7265 6e61 6d69 6e67 203d 207b      renaming = {
-00028310: 7d0a 2020 2020 666f 7220 636f 6c5f 6e61  }.    for col_na
-00028320: 6d65 2069 6e20 626f 6f6c 5f63 6f6c 733a  me in bool_cols:
-00028330: 0a20 2020 2020 2020 206e 756d 6572 616c  .        numeral
-00028340: 5f6e 616d 6520 3d20 636f 6c5f 6e61 6d65  _name = col_name
-00028350: 5b3a 2d6c 656e 2827 5f69 735f 6d69 6e6f  [:-len('_is_mino
-00028360: 7227 295d 0a20 2020 2020 2020 2069 6620  r')].        if 
-00028370: 636f 6c5f 6e61 6d65 2069 6e20 6466 2e63  col_name in df.c
-00028380: 6f6c 756d 6e73 3a0a 2020 2020 2020 2020  olumns:.        
-00028390: 2020 2020 6e65 775f 636f 6c5f 6e61 6d65      new_col_name
-000283a0: 203d 2066 227b 6e75 6d65 7261 6c5f 6e61   = f"{numeral_na
-000283b0: 6d65 7d5f 6d6f 6465 220a 2020 2020 2020  me}_mode".      
-000283c0: 2020 2020 2020 6e65 775f 636f 6c20 3d20        new_col = 
-000283d0: 626f 6f6c 6561 6e5f 6d6f 6465 5f63 6f6c  boolean_mode_col
-000283e0: 3273 7472 696e 6773 2864 665b 636f 6c5f  2strings(df[col_
-000283f0: 6e61 6d65 5d29 0a20 2020 2020 2020 2020  name]).         
-00028400: 2020 2064 662e 6c6f 635b 3a2c 636f 6c5f     df.loc[:,col_
-00028410: 6e61 6d65 5d20 3d20 6e65 775f 636f 6c0a  name] = new_col.
-00028420: 2020 2020 2020 2020 2020 2020 7265 6e61              rena
-00028430: 6d69 6e67 5b63 6f6c 5f6e 616d 655d 203d  ming[col_name] =
-00028440: 206e 6577 5f63 6f6c 5f6e 616d 650a 2020   new_col_name.  
-00028450: 2020 6466 2e72 656e 616d 6528 636f 6c75    df.rename(colu
-00028460: 6d6e 733d 7265 6e61 6d69 6e67 2c20 696e  mns=renaming, in
-00028470: 706c 6163 653d 5472 7565 290a 2020 2020  place=True).    
-00028480: 7265 7475 726e 2064 660a 0a40 6675 6e63  return df..@func
-00028490: 7469 6f6e 5f6c 6f67 6765 720a 6465 6620  tion_logger.def 
-000284a0: 7265 736f 6c76 655f 7265 6c61 7469 7665  resolve_relative
-000284b0: 5f6b 6579 7328 7265 6c61 7469 7665 726f  _keys(relativero
-000284c0: 6f74 2c20 6d69 6e6f 723d 4661 6c73 6529  ot, minor=False)
-000284d0: 3a0a 2020 2020 2222 2220 5265 736f 6c76  :.    """ Resolv
-000284e0: 6520 6e65 7374 6564 2072 656c 6174 6976  e nested relativ
-000284f0: 6520 6b65 7973 2c20 652e 672e 2027 562f  e keys, e.g. 'V/
-00028500: 562f 5627 203d 3e20 2756 4927 2e0a 0a20  V/V' => 'VI'... 
-00028510: 2020 2055 7365 733a 203a 7079 3a66 756e     Uses: :py:fun
-00028520: 633a 6072 656c 3261 6273 5f6b 6579 602c  c:`rel2abs_key`,
-00028530: 203a 7079 3a66 756e 633a 6073 7472 5f69   :py:func:`str_i
-00028540: 735f 6d69 6e6f 7260 0a0a 2020 2020 7265  s_minor`..    re
-00028550: 6c61 7469 7665 726f 6f74 203a 203a 6f62  lativeroot : :ob
-00028560: 6a3a 6073 7472 600a 2020 2020 2020 2020  j:`str`.        
-00028570: 4f6e 6520 6f72 2073 6576 6572 616c 2072  One or several r
-00028580: 656c 6174 6976 6520 6b65 7973 2c20 652e  elative keys, e.
-00028590: 672e 2069 762f 762f 5649 2028 666f 7572  g. iv/v/VI (four
-000285a0: 7468 2073 6361 6c65 2064 6567 7265 6520  th scale degree 
-000285b0: 6f66 2074 6865 2066 6966 7468 2073 6361  of the fifth sca
-000285c0: 6c65 2064 6567 7265 6520 6f66 2074 6865  le degree of the
-000285d0: 2073 6978 7468 2073 6361 6c65 2064 6567   sixth scale deg
-000285e0: 7265 6529 0a20 2020 206d 696e 6f72 203a  ree).    minor :
-000285f0: 203a 6f62 6a3a 6062 6f6f 6c60 2c20 6f70   :obj:`bool`, op
-00028600: 7469 6f6e 616c 0a20 2020 2020 2020 2050  tional.        P
-00028610: 6173 7320 5472 7565 2069 6620 7468 6520  ass True if the 
-00028620: 6c61 7374 206f 6620 7468 6520 7265 6c61  last of the rela
-00028630: 7469 7665 206b 6579 7320 6973 2074 6f20  tive keys is to 
-00028640: 6265 2069 6e74 6572 7072 6574 6564 2077  be interpreted w
-00028650: 6974 6869 6e20 6120 6d69 6e6f 7220 636f  ithin a minor co
-00028660: 6e74 6578 742e 0a20 2020 2022 2222 0a20  ntext..    """. 
-00028670: 2020 2069 6620 7064 2e69 736e 756c 6c28     if pd.isnull(
-00028680: 7265 6c61 7469 7665 726f 6f74 293a 0a20  relativeroot):. 
-00028690: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-000286a0: 6c61 7469 7665 726f 6f74 0a20 2020 2073  lativeroot.    s
-000286b0: 706c 203d 2072 656c 6174 6976 6572 6f6f  pl = relativeroo
-000286c0: 742e 7370 6c69 7428 272f 2729 0a20 2020  t.split('/').   
-000286d0: 2069 6620 6c65 6e28 7370 6c29 203c 2032   if len(spl) < 2
-000286e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000286f0: 2072 656c 6174 6976 6572 6f6f 740a 2020   relativeroot.  
-00028700: 2020 6966 206c 656e 2873 706c 2920 3d3d    if len(spl) ==
-00028710: 2032 3a0a 2020 2020 2020 2020 6170 706c   2:.        appl
-00028720: 6965 642c 2074 6f20 3d20 7370 6c0a 2020  ied, to = spl.  
-00028730: 2020 2020 2020 7265 7475 726e 2072 656c        return rel
-00028740: 3261 6273 5f6b 6579 2861 7070 6c69 6564  2abs_key(applied
-00028750: 2c20 746f 2c20 6d69 6e6f 722c 206c 6f67  , to, minor, log
-00028760: 6765 723d 6c6f 6767 6572 290a 2020 2020  ger=logger).    
-00028770: 7072 6576 696f 7573 2c20 6c61 7374 203d  previous, last =
-00028780: 2027 2f27 2e6a 6f69 6e28 7370 6c5b 3a2d   '/'.join(spl[:-
-00028790: 315d 292c 2073 706c 5b2d 315d 0a20 2020  1]), spl[-1].   
-000287a0: 2072 6574 7572 6e20 7265 6c32 6162 735f   return rel2abs_
-000287b0: 6b65 7928 7265 736f 6c76 655f 7265 6c61  key(resolve_rela
-000287c0: 7469 7665 5f6b 6579 7328 7072 6576 696f  tive_keys(previo
-000287d0: 7573 2c20 7374 725f 6973 5f6d 696e 6f72  us, str_is_minor
-000287e0: 286c 6173 742c 2069 735f 6e61 6d65 3d46  (last, is_name=F
-000287f0: 616c 7365 2929 2c20 6c61 7374 2c20 6d69  alse)), last, mi
-00028800: 6e6f 7229 0a0a 0a64 6566 2073 6572 6965  nor)...def serie
-00028810: 735f 6973 5f6d 696e 6f72 2853 2c20 6973  s_is_minor(S, is
-00028820: 5f6e 616d 653d 5472 7565 293a 0a20 2020  _name=True):.   
-00028830: 2022 2222 2052 6574 7572 6e73 2062 6f6f   """ Returns boo
-00028840: 6c65 616e 2053 6572 6965 7320 7768 6572  lean Series wher
-00028850: 6520 6576 6572 7920 7661 6c75 6520 696e  e every value in
-00028860: 2060 6053 6060 2072 6570 7265 7365 6e74   ``S`` represent
-00028870: 696e 6720 6120 6d69 6e6f 7220 6b65 792f  ing a minor key/
-00028880: 6368 6f72 6420 6973 2054 7275 652e 2222  chord is True.""
-00028890: 220a 2020 2020 2320 7265 6765 7820 3d20  ".    # regex = 
-000288a0: 7227 285b 412d 4761 2d67 5d29 5b23 7c62  r'([A-Ga-g])[#|b
-000288b0: 5d2a 2720 6966 2069 735f 6e61 6d65 2065  ]*' if is_name e
-000288c0: 6c73 6520 275b 237c 625d 2a28 5c77 2b29  lse '[#|b]*(\w+)
-000288d0: 270a 2020 2020 2320 7265 7475 726e 2053  '.    # return S
-000288e0: 2e73 7472 2e72 6570 6c61 6365 2872 6567  .str.replace(reg
-000288f0: 6578 2c20 6c61 6d62 6461 206d 3a20 6d2e  ex, lambda m: m.
-00028900: 6772 6f75 7028 3129 292e 7374 722e 6973  group(1)).str.is
-00028910: 6c6f 7765 7228 290a 2020 2020 7265 7475  lower().    retu
-00028920: 726e 2053 2e73 7472 2e69 736c 6f77 6572  rn S.str.islower
-00028930: 2829 2020 2320 6173 2073 6f6f 6e20 6173  ()  # as soon as
-00028940: 206f 6e65 2063 6861 7261 6374 6572 2069   one character i
-00028950: 7320 6e6f 7420 6c6f 7765 7263 6173 652c  s not lowercase,
-00028960: 2069 7420 7368 6f75 6c64 2062 6520 6d61   it should be ma
-00028970: 6a6f 720a 0a0a 6465 6620 7374 725f 6973  jor...def str_is
-00028980: 5f6d 696e 6f72 2874 6f6e 652c 2069 735f  _minor(tone, is_
-00028990: 6e61 6d65 3d54 7275 6529 3a0a 2020 2020  name=True):.    
-000289a0: 2222 2220 5265 7475 726e 7320 5472 7565  """ Returns True
-000289b0: 2069 6620 6060 746f 6e65 6060 2072 6570   if ``tone`` rep
-000289c0: 7265 7365 6e74 7320 6120 6d69 6e6f 7220  resents a minor 
-000289d0: 6b65 7920 6f72 2063 686f 7264 2e22 2222  key or chord."""
-000289e0: 0a20 2020 2023 2072 6567 6578 203d 2072  .    # regex = r
-000289f0: 2728 5b41 2d47 612d 675d 295b 237c 625d  '([A-Ga-g])[#|b]
-00028a00: 2a27 2069 6620 6973 5f6e 616d 6520 656c  *' if is_name el
-00028a10: 7365 2027 5b23 7c62 5d2a 285c 772b 2927  se '[#|b]*(\w+)'
-00028a20: 0a20 2020 2023 206d 203d 2072 652e 6d61  .    # m = re.ma
-00028a30: 7463 6828 7265 6765 782c 2074 6f6e 6529  tch(regex, tone)
-00028a40: 0a20 2020 2023 2069 6620 6d20 6973 204e  .    # if m is N
-00028a50: 6f6e 653a 0a20 2020 2023 2020 2020 2072  one:.    #     r
-00028a60: 6574 7572 6e20 6d0a 2020 2020 2320 7265  eturn m.    # re
-00028a70: 7475 726e 206d 2e67 726f 7570 2831 292e  turn m.group(1).
-00028a80: 6973 6c6f 7765 7228 290a 2020 2020 7265  islower().    re
-00028a90: 7475 726e 2074 6f6e 652e 6973 6c6f 7765  turn tone.islowe
-00028aa0: 7228 290a 0a0a 4066 756e 6374 696f 6e5f  r()...@function_
-00028ab0: 6c6f 6767 6572 0a64 6566 2074 7261 6e73  logger.def trans
-00028ac0: 706f 7365 5f63 6861 6e67 6573 2863 6861  pose_changes(cha
-00028ad0: 6e67 6573 2c20 6f6c 645f 6e75 6d2c 206e  nges, old_num, n
-00028ae0: 6577 5f6e 756d 2c20 6f6c 645f 6d69 6e6f  ew_num, old_mino
-00028af0: 723d 4661 6c73 652c 206e 6577 5f6d 696e  r=False, new_min
-00028b00: 6f72 3d46 616c 7365 293a 0a20 2020 2022  or=False):.    "
-00028b10: 2222 0a20 2020 2053 696e 6365 2074 6865  "".    Since the
-00028b20: 2069 6e74 6572 7661 6c20 7369 7a65 7320   interval sizes 
-00028b30: 6578 7072 6573 7365 6420 6279 2074 6865  expressed by the
-00028b40: 2063 6861 6e67 6573 206f 6620 7468 6520   changes of the 
-00028b50: 4443 4d4c 2068 6172 6d6f 6e79 2073 796e  DCML harmony syn
-00028b60: 7461 780a 2020 2020 6465 7065 6e64 206f  tax.    depend o
-00028b70: 6e20 7468 6520 6e75 6d65 7261 6c27 7320  n the numeral's 
-00028b80: 706f 7369 7469 6f6e 2069 6e20 7468 6520  position in the 
-00028b90: 7363 616c 652c 2074 6865 7365 206d 6179  scale, these may
-00028ba0: 2063 6861 6e67 6520 6966 2074 6865 206e   change if the n
-00028bb0: 756d 6572 616c 0a20 2020 2069 7320 7472  umeral.    is tr
-00028bc0: 616e 7370 6f73 6564 2e20 5468 6973 2066  ansposed. This f
-00028bd0: 756e 6374 696f 6e20 6578 7072 6573 7365  unction expresse
-00028be0: 7320 7468 6520 7361 6d65 2063 6861 6e67  s the same chang
-00028bf0: 6573 2066 6f72 2074 6865 206e 6577 2070  es for the new p
-00028c00: 6f73 6974 696f 6e2e 0a20 2020 2043 686f  osition..    Cho
-00028c10: 7264 2074 6f6e 6520 616c 7465 7261 7469  rd tone alterati
-00028c20: 6f6e 7320 286f 6620 3320 616e 6420 3529  ons (of 3 and 5)
-00028c30: 2073 7461 7920 756e 746f 7563 6865 642e   stay untouched.
-00028c40: 0a0a 2020 2020 5573 6573 3a20 3a70 793a  ..    Uses: :py:
-00028c50: 6675 6e63 3a60 6368 616e 6765 7332 7470  func:`changes2tp
-00028c60: 6360 0a0a 2020 2020 5061 7261 6d65 7465  c`..    Paramete
-00028c70: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00028c80: 2d0a 2020 2020 6368 616e 6765 7320 3a20  -.    changes : 
-00028c90: 3a6f 626a 3a60 7374 7260 0a20 2020 2020  :obj:`str`.     
-00028ca0: 2020 2041 2073 7472 696e 6720 6f66 2063     A string of c
-00028cb0: 6861 6e67 6573 2066 6f6c 6c6f 7769 6e67  hanges following
-00028cc0: 2074 6865 2044 434d 4c20 6861 726d 6f6e   the DCML harmon
-00028cd0: 7920 7374 616e 6461 7264 2e0a 2020 2020  y standard..    
-00028ce0: 6f6c 645f 6e75 6d2c 206e 6577 5f6e 756d  old_num, new_num
-00028cf0: 203a 203a 6f62 6a3a 6073 7472 603a 0a20   : :obj:`str`:. 
-00028d00: 2020 2020 2020 204f 6c64 206e 756d 6572         Old numer
-00028d10: 616c 2c20 6e65 7720 6e75 6d65 7261 6c2e  al, new numeral.
-00028d20: 0a20 2020 206f 6c64 5f6d 696e 6f72 2c20  .    old_minor, 
-00028d30: 6e65 775f 6d69 6e6f 7220 3a20 3a6f 626a  new_minor : :obj
-00028d40: 3a60 626f 6f6c 602c 206f 7074 696f 6e61  :`bool`, optiona
-00028d50: 6c0a 2020 2020 2020 2020 466f 7220 6561  l.        For ea
-00028d60: 6368 206e 756d 6572 616c 2c20 7061 7373  ch numeral, pass
-00028d70: 2054 7275 6520 6966 2069 7420 6f63 6375   True if it occu
-00028d80: 7273 2069 6e20 6120 6d69 6e6f 7220 636f  rs in a minor co
-00028d90: 6e74 6578 742e 0a20 2020 2022 2222 0a20  ntext..    """. 
-00028da0: 2020 2069 6620 7064 2e69 736e 756c 6c28     if pd.isnull(
-00028db0: 6368 616e 6765 7329 3a0a 2020 2020 2020  changes):.      
-00028dc0: 2020 7265 7475 726e 2063 6861 6e67 6573    return changes
-00028dd0: 0a20 2020 206f 6c64 203d 2063 6861 6e67  .    old = chang
-00028de0: 6573 3274 7063 2863 6861 6e67 6573 2c20  es2tpc(changes, 
-00028df0: 6f6c 645f 6e75 6d2c 206d 696e 6f72 3d6f  old_num, minor=o
-00028e00: 6c64 5f6d 696e 6f72 2c20 726f 6f74 5f61  ld_minor, root_a
-00028e10: 6c74 6572 6174 696f 6e73 3d54 7275 6529  lterations=True)
-00028e20: 0a20 2020 206e 6577 203d 2063 6861 6e67  .    new = chang
-00028e30: 6573 3274 7063 2863 6861 6e67 6573 2c20  es2tpc(changes, 
-00028e40: 6e65 775f 6e75 6d2c 206d 696e 6f72 3d6e  new_num, minor=n
-00028e50: 6577 5f6d 696e 6f72 2c20 726f 6f74 5f61  ew_minor, root_a
-00028e60: 6c74 6572 6174 696f 6e73 3d54 7275 6529  lterations=True)
-00028e70: 0a20 2020 2072 6573 203d 205b 5d0a 2020  .    res = [].  
-00028e80: 2020 6765 745f 6163 6320 3d20 6c61 6d62    get_acc = lamb
-00028e90: 6461 206e 3a20 6e20 2a20 2723 2720 6966  da n: n * '#' if
-00028ea0: 206e 203e 2030 2065 6c73 6520 2d6e 202a   n > 0 else -n *
-00028eb0: 2027 6227 0a20 2020 2066 6f72 2028 6675   'b'.    for (fu
-00028ec0: 6c6c 2c20 6164 6465 642c 2061 6363 2c20  ll, added, acc, 
-00028ed0: 6368 6f72 645f 696e 7465 7276 616c 2c20  chord_interval, 
-00028ee0: 6976 3129 2c20 285f 2c20 5f2c 205f 2c20  iv1), (_, _, _, 
-00028ef0: 5f2c 2069 7632 2920 696e 207a 6970 286f  _, iv2) in zip(o
-00028f00: 6c64 2c20 6e65 7729 3a0a 2020 2020 2020  ld, new):.      
-00028f10: 2020 6966 2069 7631 2069 7320 4e6f 6e65    if iv1 is None
-00028f20: 206f 7220 6976 3120 3d3d 2069 7632 3a0a   or iv1 == iv2:.
-00028f30: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00028f40: 6170 7065 6e64 2866 756c 6c29 0a20 2020  append(full).   
-00028f50: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00028f60: 2020 2020 2020 2064 203d 2069 7632 202d         d = iv2 -
-00028f70: 2069 7631 0a20 2020 2020 2020 2020 2020   iv1.           
-00028f80: 2069 6620 6420 2520 3720 3e20 303a 0a20   if d % 7 > 0:. 
-00028f90: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00028fa0: 6f67 6765 722e 7761 726e 696e 6728 0a20  ogger.warning(. 
-00028fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028fc0: 2020 2066 2254 6865 2064 6966 6665 7265     f"The differe
-00028fd0: 6e63 6520 6265 7477 6565 6e20 7468 6520  nce between the 
-00028fe0: 696e 7465 7276 616c 7320 6f66 207b 6675  intervals of {fu
-00028ff0: 6c6c 7d20 696e 207b 6f6c 645f 6e75 6d7d  ll} in {old_num}
-00029000: 2061 6e64 207b 6e65 775f 6e75 6d7d 2028   and {new_num} (
-00029010: 696e 207b 276d 696e 6f72 2720 6966 206d  in {'minor' if m
-00029020: 696e 6f72 2065 6c73 6520 276d 616a 6f72  inor else 'major
-00029030: 277d 2920 646f 6e27 7420 6469 6666 6572  '}) don't differ
-00029040: 2062 7920 6368 726f 6d61 7469 6320 7365   by chromatic se
-00029050: 6d69 746f 6e65 732e 2229 0a20 2020 2020  mitones.").     
-00029060: 2020 2020 2020 206e 5f61 6363 203d 2061         n_acc = a
-00029070: 6363 2e63 6f75 6e74 2827 2327 2920 2d20  cc.count('#') - 
-00029080: 6163 632e 636f 756e 7428 2762 2729 0a20  acc.count('b'). 
-00029090: 2020 2020 2020 2020 2020 206e 6577 5f61             new_a
-000290a0: 6363 203d 2067 6574 5f61 6363 286e 5f61  cc = get_acc(n_a
-000290b0: 6363 202d 2064 202f 2f20 3729 0a20 2020  cc - d // 7).   
-000290c0: 2020 2020 2020 2020 2072 6573 2e61 7070           res.app
-000290d0: 656e 6428 6164 6465 6420 2b20 6e65 775f  end(added + new_
-000290e0: 6163 6320 2b20 6368 6f72 645f 696e 7465  acc + chord_inte
-000290f0: 7276 616c 290a 2020 2020 7265 7475 726e  rval).    return
-00029100: 2027 272e 6a6f 696e 2872 6573 290a 0a0a   ''.join(res)...
-00029110: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
-00029120: 0a64 6566 2066 6561 7475 7265 7332 7470  .def features2tp
-00029130: 6373 286e 756d 6572 616c 2c20 666f 726d  cs(numeral, form
-00029140: 3d4e 6f6e 652c 2066 6967 6261 7373 3d4e  =None, figbass=N
-00029150: 6f6e 652c 2063 6861 6e67 6573 3d4e 6f6e  one, changes=Non
-00029160: 652c 2072 656c 6174 6976 6572 6f6f 743d  e, relativeroot=
-00029170: 4e6f 6e65 2c20 6b65 793d 2743 272c 206d  None, key='C', m
-00029180: 696e 6f72 3d4e 6f6e 652c 0a20 2020 2020  inor=None,.     
-00029190: 2020 2020 2020 2020 2020 2020 206d 6572               mer
-000291a0: 6765 5f74 6f6e 6573 3d54 7275 652c 2062  ge_tones=True, b
-000291b0: 6173 735f 6f6e 6c79 3d46 616c 7365 2c20  ass_only=False, 
-000291c0: 6d63 3d4e 6f6e 6529 3a0a 2020 2020 2222  mc=None):.    ""
-000291d0: 220a 2020 2020 4769 7665 6e20 7468 6520  ".    Given the 
-000291e0: 6665 6174 7572 6573 206f 6620 6120 6368  features of a ch
-000291f0: 6f72 6420 6c61 6265 6c2c 2074 6869 7320  ord label, this 
-00029200: 6675 6e63 7469 6f6e 2072 6574 7572 6e73  function returns
-00029210: 2074 6865 2063 686f 7264 2074 6f6e 6573   the chord tones
-00029220: 0a20 2020 2069 6e20 7468 6520 6f72 6465  .    in the orde
-00029230: 7220 6f66 2074 6865 2069 6e76 6572 7369  r of the inversi
-00029240: 6f6e 2c20 7374 6172 7469 6e67 2066 726f  on, starting fro
-00029250: 6d20 7468 6520 6261 7373 206e 6f74 652e  m the bass note.
-00029260: 2054 6865 2074 6f6e 6573 2061 7265 0a20   The tones are. 
-00029270: 2020 2065 7870 7265 7373 6564 2061 7320     expressed as 
-00029280: 746f 6e61 6c20 7069 7463 6820 636c 6173  tonal pitch clas
-00029290: 7365 732c 2077 6865 7265 202d 313d 462c  ses, where -1=F,
-000292a0: 2030 3d43 2c20 313d 4720 6574 632e 0a0a   0=C, 1=G etc...
-000292b0: 2020 2020 5573 6573 3a20 3a70 793a 6675      Uses: :py:fu
-000292c0: 6e63 3a60 7e2e 7574 696c 732e 6368 616e  nc:`~.utils.chan
-000292d0: 6765 7332 6c69 7374 602c 203a 7079 3a66  ges2list`, :py:f
-000292e0: 756e 633a 607e 2e75 7469 6c73 2e6e 616d  unc:`~.utils.nam
-000292f0: 6532 6669 6674 6873 602c 203a 7079 3a66  e2fifths`, :py:f
-00029300: 756e 633a 607e 2e75 7469 6c73 2e72 6573  unc:`~.utils.res
-00029310: 6f6c 7665 5f72 656c 6174 6976 655f 6b65  olve_relative_ke
-00029320: 7973 602c 203a 7079 3a66 756e 633a 607e  ys`, :py:func:`~
-00029330: 2e75 7469 6c73 2e72 6f6d 616e 5f6e 756d  .utils.roman_num
-00029340: 6572 616c 3266 6966 7468 7360 2c0a 2020  eral2fifths`,.  
-00029350: 2020 3a70 793a 6675 6e63 3a60 7e2e 7574    :py:func:`~.ut
-00029360: 696c 732e 736f 7274 5f74 7063 7360 2c20  ils.sort_tpcs`, 
-00029370: 3a70 793a 6675 6e63 3a60 7e2e 7574 696c  :py:func:`~.util
-00029380: 732e 7374 725f 6973 5f6d 696e 6f72 600a  s.str_is_minor`.
-00029390: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-000293a0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-000293b0: 2020 206e 756d 6572 616c 3a20 3a6f 626a     numeral: :obj
-000293c0: 3a60 7374 7260 0a20 2020 2020 2020 2052  :`str`.        R
-000293d0: 6f6d 616e 206e 756d 6572 616c 206f 6620  oman numeral of 
-000293e0: 7468 6520 6368 6f72 6427 7320 726f 6f74  the chord's root
-000293f0: 0a20 2020 2066 6f72 6d3a 207b 4e6f 6e65  .    form: {None
-00029400: 2c20 274d 272c 2027 6f27 2c20 272b 2720  , 'M', 'o', '+' 
-00029410: 2725 277d 2c20 6f70 7469 6f6e 616c 0a20  '%'}, optional. 
-00029420: 2020 2020 2020 2049 6e64 6963 6174 6573         Indicates
-00029430: 2074 6865 2063 686f 7264 2074 7970 6520   the chord type 
-00029440: 6966 206e 6f74 2061 206d 616a 6f72 206f  if not a major o
-00029450: 7220 6d69 6e6f 7220 7472 6961 6420 2866  r minor triad (f
-00029460: 6f72 2077 6869 6368 2060 6066 6f72 6d60  or which ``form`
-00029470: 6020 6973 204e 6f6e 6529 2e0a 2020 2020  ` is None)..    
-00029480: 2020 2020 2725 2720 616e 6420 274d 2720      '%' and 'M' 
-00029490: 6361 6e20 6f6e 6c79 206f 6363 7572 2061  can only occur a
-000294a0: 7320 7465 7472 6164 732c 206e 6f74 2061  s tetrads, not a
-000294b0: 7320 7472 6961 6473 2e0a 2020 2020 6669  s triads..    fi
-000294c0: 6762 6173 733a 207b 4e6f 6e65 2c20 2736  gbass: {None, '6
-000294d0: 272c 2027 3634 272c 2027 3727 2c20 2736  ', '64', '7', '6
-000294e0: 3527 2c20 2734 3327 2c20 2732 277d 2c20  5', '43', '2'}, 
-000294f0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00029500: 2049 6e64 6963 6174 6573 2063 686f 7264   Indicates chord
-00029510: 2773 2069 6e76 6572 7369 6f6e 2e20 5061  's inversion. Pa
-00029520: 7373 204e 6f6e 6520 666f 7220 7472 6961  ss None for tria
-00029530: 6420 726f 6f74 2070 6f73 6974 696f 6e2e  d root position.
-00029540: 0a20 2020 2063 6861 6e67 6573 3a20 3a6f  .    changes: :o
-00029550: 626a 3a60 7374 7260 2c20 6f70 7469 6f6e  bj:`str`, option
-00029560: 616c 0a20 2020 2020 2020 2041 6464 6564  al.        Added
-00029570: 2073 7465 7073 2073 7563 6820 6173 2027   steps such as '
-00029580: 2b36 2720 6f72 2073 7573 7065 6e73 696f  +6' or suspensio
-00029590: 6e73 2073 7563 6820 6173 2027 3427 206f  ns such as '4' o
-000295a0: 7220 616e 7920 636f 6d62 696e 6174 696f  r any combinatio
-000295b0: 6e20 7375 6368 2061 7320 2839 2b36 3429  n such as (9+64)
-000295c0: 2e0a 2020 2020 2020 2020 4e75 6d62 6572  ..        Number
-000295d0: 7320 6e65 6564 2074 6f20 6265 2069 6e20  s need to be in 
-000295e0: 6465 7363 656e 6469 6e67 206f 7264 6572  descending order
-000295f0: 2e0a 2020 2020 7265 6c61 7469 7665 726f  ..    relativero
-00029600: 6f74 3a20 3a6f 626a 3a60 7374 7260 2c20  ot: :obj:`str`, 
-00029610: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00029620: 2050 6173 7320 6120 526f 6d61 6e20 7363   Pass a Roman sc
-00029630: 616c 6520 6465 6772 6565 2069 6620 606e  ale degree if `n
-00029640: 756d 6572 616c 6020 6973 2074 6f20 6265  umeral` is to be
-00029650: 2061 7070 6c69 6564 2074 6f20 6120 6469   applied to a di
-00029660: 6666 6572 656e 7420 7363 616c 650a 2020  fferent scale.  
-00029670: 2020 2020 2020 6465 6772 6565 206f 6620        degree of 
-00029680: 7468 6520 6c6f 6361 6c20 6b65 792c 2061  the local key, a
-00029690: 7320 696e 2027 5636 352f 5627 0a20 2020  s in 'V65/V'.   
-000296a0: 206b 6579 203a 203a 6f62 6a3a 6073 7472   key : :obj:`str
-000296b0: 6020 6f72 203a 6f62 6a3a 6069 6e74 602c  ` or :obj:`int`,
-000296c0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-000296d0: 2020 5468 6520 6c6f 6361 6c20 6b65 7920    The local key 
-000296e0: 6578 7072 6573 7365 6420 6173 2074 6865  expressed as the
-000296f0: 2072 6f6f 7427 7320 6e6f 7465 206e 616d   root's note nam
-00029700: 6520 6f72 2061 2074 6f6e 616c 2070 6974  e or a tonal pit
-00029710: 6368 2063 6c61 7373 2e0a 2020 2020 2020  ch class..      
-00029720: 2020 4966 2069 7420 6973 2061 206e 616d    If it is a nam
-00029730: 6520 616e 6420 606d 696e 6f72 6020 6973  e and `minor` is
-00029740: 2060 4e6f 6e65 602c 2075 7070 6572 6361   `None`, upperca
-00029750: 7365 206d 6561 6e73 206d 616a 6f72 2061  se means major a
-00029760: 6e64 206c 6f77 6572 6361 7365 206d 696e  nd lowercase min
-00029770: 6f72 2e0a 2020 2020 2020 2020 4966 2069  or..        If i
-00029780: 7420 6973 2061 2074 6f6e 616c 2070 6974  t is a tonal pit
-00029790: 6368 2063 6c61 7373 2c20 606d 696e 6f72  ch class, `minor
-000297a0: 6020 6e65 6564 7320 746f 2062 6520 7370  ` needs to be sp
-000297b0: 6563 6966 6965 642e 0a20 2020 206d 696e  ecified..    min
-000297c0: 6f72 203a 203a 6f62 6a3a 6062 6f6f 6c60  or : :obj:`bool`
-000297d0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-000297e0: 2020 2050 6173 7320 5472 7565 2066 6f72     Pass True for
-000297f0: 206d 696e 6f72 2061 6e64 2046 616c 7365   minor and False
-00029800: 2066 6f72 206d 616a 6f72 2e20 4361 6e20   for major. Can 
-00029810: 6265 206f 6d69 7474 6564 2069 6620 606b  be omitted if `k
-00029820: 6579 6020 6973 2061 206e 6f74 6520 6e61  ey` is a note na
-00029830: 6d65 2e0a 2020 2020 2020 2020 5468 6973  me..        This
-00029840: 2061 6666 6563 7473 2063 616c 6375 6c61   affects calcula
-00029850: 7469 6f6e 206f 6620 6368 6f72 6473 2072  tion of chords r
-00029860: 656c 6174 6564 2074 6f20 4949 492c 2056  elated to III, V
-00029870: 4920 616e 6420 5649 492e 0a20 2020 206d  I and VII..    m
-00029880: 6572 6765 5f74 6f6e 6573 203a 203a 6f62  erge_tones : :ob
-00029890: 6a3a 6062 6f6f 6c60 2c20 6f70 7469 6f6e  j:`bool`, option
-000298a0: 616c 0a20 2020 2020 2020 2050 6173 7320  al.        Pass 
-000298b0: 4661 6c73 6520 6966 2079 6f75 2077 616e  False if you wan
-000298c0: 7420 7468 6520 6675 6e63 7469 6f6e 2074  t the function t
-000298d0: 6f20 7265 7475 726e 2074 776f 2074 7570  o return two tup
-000298e0: 6c65 732c 206f 6e65 2077 6974 6820 2870  les, one with (p
-000298f0: 6f74 656e 7469 616c 6c79 2073 7573 7065  otentially suspe
-00029900: 6e64 6564 290a 2020 2020 2020 2020 6368  nded).        ch
-00029910: 6f72 6420 746f 6e65 7320 616e 6420 6f6e  ord tones and on
-00029920: 6520 7769 7468 2061 6464 6564 206e 6f74  e with added not
-00029930: 6573 2e0a 2020 2020 6261 7373 5f6f 6e6c  es..    bass_onl
-00029940: 7920 3a20 3a6f 626a 3a60 626f 6f6c 602c  y : :obj:`bool`,
-00029950: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00029960: 2020 5265 7475 726e 206f 6e6c 7920 7468    Return only th
-00029970: 6520 6261 7373 206e 6f74 6520 696e 7374  e bass note inst
-00029980: 6561 6420 6f66 2061 6c6c 2063 686f 7264  ead of all chord
-00029990: 2074 6f6e 6573 2e0a 2020 2020 6d63 203a   tones..    mc :
-000299a0: 2069 6e74 206f 7220 7374 720a 2020 2020   int or str.    
-000299b0: 2020 2020 5061 7373 206d 6561 7375 7265      Pass measure
-000299c0: 2063 6f75 6e74 2074 6f20 6469 7370 6c61   count to displa
-000299d0: 7920 6974 2069 6e20 7761 726e 696e 6773  y it in warnings
-000299e0: 2e0a 0a20 2020 2022 2222 0a20 2020 2069  ...    """.    i
-000299f0: 6620 7064 2e69 736e 756c 6c28 6e75 6d65  f pd.isnull(nume
-00029a00: 7261 6c29 206f 7220 6e75 6d65 7261 6c20  ral) or numeral 
-00029a10: 3d3d 2027 406e 6f6e 6527 3a0a 2020 2020  == '@none':.    
-00029a20: 2020 2020 6966 2062 6173 735f 6f6e 6c79      if bass_only
-00029a30: 206f 7220 6d65 7267 655f 746f 6e65 733a   or merge_tones:
-00029a40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00029a50: 7572 6e20 7064 2e4e 410a 2020 2020 2020  urn pd.NA.      
-00029a60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00029a70: 2020 2020 7265 7475 726e 207b 0a20 2020      return {.   
-00029a80: 2020 2020 2020 2020 2020 2020 2027 6368               'ch
-00029a90: 6f72 645f 746f 6e65 7327 3a20 7064 2e4e  ord_tones': pd.N
-00029aa0: 412c 0a20 2020 2020 2020 2020 2020 2020  A,.             
-00029ab0: 2020 2027 6164 6465 645f 746f 6e65 7327     'added_tones'
-00029ac0: 3a20 7064 2e4e 412c 0a20 2020 2020 2020  : pd.NA,.       
-00029ad0: 2020 2020 2020 2020 2027 726f 6f74 273a           'root':
-00029ae0: 2070 642e 4e41 2c0a 2020 2020 2020 2020   pd.NA,.        
-00029af0: 2020 2020 7d0a 2020 2020 666f 726d 2c20      }.    form, 
-00029b00: 6669 6762 6173 732c 2063 6861 6e67 6573  figbass, changes
-00029b10: 2c20 7265 6c61 7469 7665 726f 6f74 203d  , relativeroot =
-00029b20: 2074 7570 6c65 280a 2020 2020 2020 2020   tuple(.        
-00029b30: 2727 2069 6620 7064 2e69 736e 756c 6c28  '' if pd.isnull(
-00029b40: 7661 6c29 2065 6c73 6520 7661 6c20 666f  val) else val fo
-00029b50: 7220 7661 6c20 696e 2028 666f 726d 2c20  r val in (form, 
-00029b60: 6669 6762 6173 732c 2063 6861 6e67 6573  figbass, changes
-00029b70: 2c20 7265 6c61 7469 7665 726f 6f74 2929  , relativeroot))
-00029b80: 0a20 2020 206c 6162 656c 203d 2066 227b  .    label = f"{
-00029b90: 6e75 6d65 7261 6c7d 7b66 6f72 6d7d 7b66  numeral}{form}{f
-00029ba0: 6967 6261 7373 7d7b 2728 2720 2b20 6368  igbass}{'(' + ch
-00029bb0: 616e 6765 7320 2b20 2729 2720 6966 2063  anges + ')' if c
-00029bc0: 6861 6e67 6573 2021 3d20 2727 2065 6c73  hanges != '' els
-00029bd0: 6520 2727 7d7b 272f 2720 2b20 7265 6c61  e ''}{'/' + rela
-00029be0: 7469 7665 726f 6f74 2069 6620 7265 6c61  tiveroot if rela
-00029bf0: 7469 7665 726f 6f74 2021 3d20 2727 2065  tiveroot != '' e
-00029c00: 6c73 6520 2727 7d22 0a20 2020 204d 4320  lse ''}".    MC 
-00029c10: 3d20 2727 2069 6620 6d63 2069 7320 4e6f  = '' if mc is No
-00029c20: 6e65 2065 6c73 6520 6627 4d43 207b 6d63  ne else f'MC {mc
-00029c30: 7d3a 2027 0a20 2020 2069 6620 6d69 6e6f  }: '.    if mino
-00029c40: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-00029c50: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00029c60: 2020 2020 6d69 6e6f 7220 3d20 7374 725f      minor = str_
-00029c70: 6973 5f6d 696e 6f72 286b 6579 2c20 6973  is_minor(key, is
-00029c80: 5f6e 616d 653d 5472 7565 290a 2020 2020  _name=True).    
-00029c90: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-00029ca0: 6562 7567 2866 224d 6f64 6520 696e 6665  ebug(f"Mode infe
-00029cb0: 7272 6564 2066 726f 6d20 7b6b 6579 7d2e  rred from {key}.
-00029cc0: 2229 0a20 2020 2020 2020 2065 7863 6570  ").        excep
-00029cd0: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
-00029ce0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00029cf0: 616c 7565 4572 726f 7228 6622 4966 2070  alueError(f"If p
-00029d00: 6172 616d 6574 6572 2027 6d69 6e6f 7227  arameter 'minor'
-00029d10: 2069 7320 6e6f 7420 7370 6563 6966 6965   is not specifie
-00029d20: 642c 2027 6b65 7927 206e 6565 6473 2074  d, 'key' needs t
-00029d30: 6f20 6265 2061 2073 7472 696e 672c 206e  o be a string, n
-00029d40: 6f74 207b 6b65 797d 2229 0a0a 2020 2020  ot {key}")..    
-00029d50: 6b65 7920 3d20 6e61 6d65 3266 6966 7468  key = name2fifth
-00029d60: 7328 6b65 792c 206c 6f67 6765 723d 6c6f  s(key, logger=lo
-00029d70: 6767 6572 290a 0a20 2020 2069 6620 666f  gger)..    if fo
-00029d80: 726d 2069 6e20 5b27 2527 2c20 274d 272c  rm in ['%', 'M',
-00029d90: 2027 2b4d 275d 3a0a 2020 2020 2020 2020   '+M']:.        
-00029da0: 6173 7365 7274 2066 6967 6261 7373 2069  assert figbass i
-00029db0: 6e20 5b27 3727 2c20 2736 3527 2c20 2734  n ['7', '65', '4
-00029dc0: 3327 2c0a 2020 2020 2020 2020 2020 2020  3',.            
-00029dd0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00029de0: 3227 5d2c 2066 227b 4d43 7d7b 6c61 6265  2'], f"{MC}{labe
-00029df0: 6c7d 3a20 7b66 6f72 6d7d 2072 6571 7569  l}: {form} requi
-00029e00: 7265 7320 6669 6762 6173 7320 2837 2c20  res figbass (7, 
-00029e10: 3635 2c20 3433 2c20 6f72 2032 2920 7369  65, 43, or 2) si
-00029e20: 6e63 6520 6974 2073 7065 6369 6669 6573  nce it specifies
-00029e30: 2061 2063 686f 7264 2773 2073 6576 656e   a chord's seven
-00029e40: 7468 2e22 0a0a 2020 2020 6966 2072 656c  th."..    if rel
-00029e50: 6174 6976 6572 6f6f 7420 213d 2027 273a  ativeroot != '':
-00029e60: 0a20 2020 2020 2020 2072 6573 6f6c 7665  .        resolve
-00029e70: 6420 3d20 7265 736f 6c76 655f 7265 6c61  d = resolve_rela
-00029e80: 7469 7665 5f6b 6579 7328 7265 6c61 7469  tive_keys(relati
-00029e90: 7665 726f 6f74 2c20 6d69 6e6f 722c 206c  veroot, minor, l
-00029ea0: 6f67 6765 723d 6c6f 6767 6572 290a 2020  ogger=logger).  
-00029eb0: 2020 2020 2020 7265 6c5f 6d69 6e6f 7220        rel_minor 
-00029ec0: 3d20 7374 725f 6973 5f6d 696e 6f72 2872  = str_is_minor(r
-00029ed0: 6573 6f6c 7665 642c 2069 735f 6e61 6d65  esolved, is_name
-00029ee0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-00029ef0: 7472 616e 7370 203d 2072 6f6d 616e 5f6e  transp = roman_n
-00029f00: 756d 6572 616c 3266 6966 7468 7328 7265  umeral2fifths(re
-00029f10: 736f 6c76 6564 2c20 6d69 6e6f 722c 206c  solved, minor, l
-00029f20: 6f67 6765 723d 6c6f 6767 6572 290a 2020  ogger=logger).  
-00029f30: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
-00029f40: 7567 280a 2020 2020 2020 2020 2020 2020  ug(.            
-00029f50: 6622 7b4d 437d 4368 6f72 6420 6170 706c  f"{MC}Chord appl
-00029f60: 6965 6420 746f 207b 7265 6c61 7469 7665  ied to {relative
-00029f70: 726f 6f74 7d2e 2054 6865 7265 666f 7265  root}. Therefore
-00029f80: 2074 7261 6e73 706f 7369 6e67 2069 7420   transposing it 
-00029f90: 6279 207b 7472 616e 7370 7d20 6669 6674  by {transp} fift
-00029fa0: 6873 2e22 290a 2020 2020 2020 2020 7265  hs.").        re
-00029fb0: 7475 726e 2066 6561 7475 7265 7332 7470  turn features2tp
-00029fc0: 6373 286e 756d 6572 616c 3d6e 756d 6572  cs(numeral=numer
-00029fd0: 616c 2c20 666f 726d 3d66 6f72 6d2c 2066  al, form=form, f
-00029fe0: 6967 6261 7373 3d66 6967 6261 7373 2c20  igbass=figbass, 
-00029ff0: 7265 6c61 7469 7665 726f 6f74 3d4e 6f6e  relativeroot=Non
-0002a000: 652c 2063 6861 6e67 6573 3d63 6861 6e67  e, changes=chang
-0002a010: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-0002a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a030: 206b 6579 3d6b 6579 202b 2074 7261 6e73   key=key + trans
-0002a040: 702c 206d 696e 6f72 3d72 656c 5f6d 696e  p, minor=rel_min
-0002a050: 6f72 2c20 6d65 7267 655f 746f 6e65 733d  or, merge_tones=
-0002a060: 6d65 7267 655f 746f 6e65 732c 2062 6173  merge_tones, bas
-0002a070: 735f 6f6e 6c79 3d62 6173 735f 6f6e 6c79  s_only=bass_only
-0002a080: 2c20 6d63 3d6d 632c 0a20 2020 2020 2020  , mc=mc,.       
-0002a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0a0: 2020 2020 2020 6c6f 6767 6572 3d6c 6f67        logger=log
-0002a0b0: 6765 7229 0a0a 2020 2020 6966 206e 756d  ger)..    if num
-0002a0c0: 6572 616c 2e6c 6f77 6572 2829 203d 3d20  eral.lower() == 
-0002a0d0: 2723 7669 6927 2061 6e64 206e 6f74 206d  '#vii' and not m
-0002a0e0: 696e 6f72 3a0a 2020 2020 2020 2020 6c6f  inor:.        lo
-0002a0f0: 6767 6572 2e77 6172 6e69 6e67 2866 227b  gger.warning(f"{
-0002a100: 4d43 7d7b 6e75 6d65 7261 6c7d 2069 6e20  MC}{numeral} in 
-0002a110: 6d61 6a6f 7220 636f 6e74 6578 7420 636f  major context co
-0002a120: 7272 6563 7465 6420 746f 207b 6e75 6d65  rrected to {nume
-0002a130: 7261 6c5b 313a 5d7d 2e22 2c0a 2020 2020  ral[1:]}.",.    
-0002a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a150: 2020 2065 7874 7261 3d7b 276d 6573 7361     extra={'messa
-0002a160: 6765 5f69 6427 3a20 2832 372c 204d 4329  ge_id': (27, MC)
-0002a170: 7d29 0a20 2020 2020 2020 206e 756d 6572  }).        numer
-0002a180: 616c 203d 206e 756d 6572 616c 5b31 3a5d  al = numeral[1:]
-0002a190: 0a0a 2020 2020 726f 6f74 5f61 6c74 6572  ..    root_alter
-0002a1a0: 6174 696f 6e2c 206e 756d 5f64 6567 7265  ation, num_degre
-0002a1b0: 6520 3d20 7370 6c69 745f 7363 616c 655f  e = split_scale_
-0002a1c0: 6465 6772 6565 286e 756d 6572 616c 2c20  degree(numeral, 
-0002a1d0: 636f 756e 743d 5472 7565 2c20 6c6f 6767  count=True, logg
-0002a1e0: 6572 3d6c 6f67 6765 7229 0a0a 2020 2020  er=logger)..    
-0002a1f0: 2320 6275 696c 6420 322d 6f63 7461 7665  # build 2-octave
-0002a200: 2064 6961 746f 6e69 6320 7363 616c 6520   diatonic scale 
-0002a210: 6f6e 2043 206d 616a 6f72 2f6d 696e 6f72  on C major/minor
-0002a220: 0a20 2020 2072 6f6f 7420 3d20 5b27 4927  .    root = ['I'
-0002a230: 2c20 2749 4927 2c20 2749 4949 272c 2027  , 'II', 'III', '
-0002a240: 4956 272c 2027 5627 2c20 2756 4927 2c20  IV', 'V', 'VI', 
-0002a250: 2756 4949 275d 2e69 6e64 6578 286e 756d  'VII'].index(num
-0002a260: 5f64 6567 7265 652e 7570 7065 7228 2929  _degree.upper())
-0002a270: 0a20 2020 2074 7063 7320 3d20 3220 2a20  .    tpcs = 2 * 
-0002a280: 5b69 202b 206b 6579 2066 6f72 2069 2069  [i + key for i i
-0002a290: 6e20 2830 2c20 322c 202d 332c 202d 312c  n (0, 2, -3, -1,
-0002a2a0: 2031 2c20 2d34 2c20 2d32 295d 2069 6620   1, -4, -2)] if 
-0002a2b0: 6d69 6e6f 7220 656c 7365 2032 202a 205b  minor else 2 * [
-0002a2c0: 6920 2b20 6b65 7920 666f 7220 6920 696e  i + key for i in
-0002a2d0: 2028 302c 2032 2c20 342c 202d 312c 2031   (0, 2, 4, -1, 1
-0002a2e0: 2c20 332c 2035 295d 0a20 2020 2023 2073  , 3, 5)].    # s
-0002a2f0: 7461 7274 696e 6720 7468 6520 7363 616c  tarting the scal
-0002a300: 6520 6672 6f6d 2063 686f 7264 2072 6f6f  e from chord roo
-0002a310: 742c 2069 2e65 2e20 726f 6f74 2077 696c  t, i.e. root wil
-0002a320: 6c20 6265 2074 7063 735b 305d 2c20 7468  l be tpcs[0], th
-0002a330: 6520 6368 6f72 6427 7320 7365 7665 6e74  e chord's sevent
-0002a340: 6820 7470 6373 5b36 5d20 6574 632e 0a20  h tpcs[6] etc.. 
-0002a350: 2020 2074 7063 7320 3d20 7470 6373 5b72     tpcs = tpcs[r
-0002a360: 6f6f 743a 5d20 2b20 7470 6373 5b3a 726f  oot:] + tpcs[:ro
-0002a370: 6f74 5d0a 2020 2020 726f 6f74 203d 2074  ot].    root = t
-0002a380: 7063 735b 305d 202b 2037 202a 2072 6f6f  pcs[0] + 7 * roo
-0002a390: 745f 616c 7465 7261 7469 6f6e 0a20 2020  t_alteration.   
-0002a3a0: 2074 7063 735b 305d 203d 2072 6f6f 7420   tpcs[0] = root 
-0002a3b0: 2023 206f 6374 6176 6520 7374 6179 7320   # octave stays 
-0002a3c0: 6469 6174 6f6e 6963 2c20 6973 206e 6f74  diatonic, is not
-0002a3d0: 2061 6c74 6572 6564 0a20 2020 2023 6c6f   altered.    #lo
-0002a3e0: 6767 6572 2e64 6562 7567 2866 227b 6e75  gger.debug(f"{nu
-0002a3f0: 6d5f 6465 6772 6565 7d3a 2054 6865 207b  m_degree}: The {
-0002a400: 276d 696e 6f72 2720 6966 206d 696e 6f72  'minor' if minor
-0002a410: 2065 6c73 6520 276d 616a 6f72 277d 2073   else 'major'} s
-0002a420: 6361 6c65 2073 7461 7274 696e 6720 6672  cale starting fr
-0002a430: 6f6d 2074 6865 2072 6f6f 743a 207b 7470  om the root: {tp
-0002a440: 6373 7d22 290a 0a20 2020 2064 6566 2073  cs}")..    def s
-0002a450: 6574 5f69 7628 6368 6f72 645f 696e 7465  et_iv(chord_inte
-0002a460: 7276 616c 2c20 696e 7465 7276 616c 5f73  rval, interval_s
-0002a470: 697a 6529 3a0a 2020 2020 2020 2020 2222  ize):.        ""
-0002a480: 2220 4164 6420 746f 2074 6865 2069 6e74  " Add to the int
-0002a490: 6572 7661 6c20 6f66 2061 2067 6976 656e  erval of a given
-0002a4a0: 2063 686f 7264 2069 6e74 6572 7661 6c20   chord interval 
-0002a4b0: 696e 2060 7470 6373 6020 2862 6f74 6820  in `tpcs` (both 
-0002a4c0: 7669 6577 6564 2066 726f 6d20 7468 6520  viewed from the 
-0002a4d0: 726f 6f74 206e 6f74 6529 2e0a 0a20 2020  root note)...   
-0002a4e0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-0002a4f0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0002a500: 2d2d 0a20 2020 2020 2020 2063 686f 7264  --.        chord
-0002a510: 5f69 6e74 6572 7661 6c20 3a20 3a6f 626a  _interval : :obj
-0002a520: 3a60 696e 7460 0a20 2020 2020 2020 2020  :`int`.         
-0002a530: 2020 2050 6173 7320 3020 666f 7220 7468     Pass 0 for th
-0002a540: 6520 726f 6f74 206e 6f74 652c 2032 2066  e root note, 2 f
-0002a550: 6f72 2074 6865 2074 6869 7264 2c20 3820  or the third, 8 
-0002a560: 666f 7220 7468 6520 6e69 6e74 6820 6574  for the ninth et
-0002a570: 632e 0a20 2020 2020 2020 2069 6e74 6572  c..        inter
-0002a580: 7661 6c5f 7369 7a65 203a 203a 6f62 6a3a  val_size : :obj:
-0002a590: 6069 6e74 600a 2020 2020 2020 2020 2020  `int`.          
-0002a5a0: 2020 5374 6163 6b2d 6f66 2d66 6966 7468    Stack-of-fifth
-0002a5b0: 7320 696e 7465 7276 616c 2e0a 2020 2020  s interval..    
-0002a5c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0002a5d0: 6e6f 6e6c 6f63 616c 2074 7063 732c 2072  nonlocal tpcs, r
-0002a5e0: 6f6f 740a 2020 2020 2020 2020 6976 203d  oot.        iv =
-0002a5f0: 2072 6f6f 7420 2b20 696e 7465 7276 616c   root + interval
-0002a600: 5f73 697a 650a 2020 2020 2020 2020 7470  _size.        tp
-0002a610: 6373 5b63 686f 7264 5f69 6e74 6572 7661  cs[chord_interva
-0002a620: 6c5d 203d 2069 760a 2020 2020 2020 2020  l] = iv.        
-0002a630: 7470 6373 5b63 686f 7264 5f69 6e74 6572  tpcs[chord_inter
-0002a640: 7661 6c20 2b20 375d 203d 2069 760a 0a20  val + 7] = iv.. 
-0002a650: 2020 2069 735f 7472 6961 6420 3d20 6669     is_triad = fi
-0002a660: 6762 6173 7320 696e 205b 2727 2c20 2736  gbass in ['', '6
-0002a670: 272c 2027 3634 275d 0a20 2020 2069 735f  ', '64'].    is_
-0002a680: 7365 7665 6e74 685f 6368 6f72 6420 3d20  seventh_chord = 
-0002a690: 6669 6762 6173 7320 696e 205b 2737 272c  figbass in ['7',
-0002a6a0: 2027 3635 272c 2027 3433 272c 2027 3227   '65', '43', '2'
-0002a6b0: 5d0a 2020 2020 6966 206e 6f74 2069 735f  ].    if not is_
-0002a6c0: 7472 6961 6420 616e 6420 6e6f 7420 6973  triad and not is
-0002a6d0: 5f73 6576 656e 7468 5f63 686f 7264 3a0a  _seventh_chord:.
-0002a6e0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0002a6f0: 6c75 6545 7272 6f72 2866 227b 4d43 7d7b  lueError(f"{MC}{
-0002a700: 6669 6762 6173 737d 2069 7320 6e6f 7420  figbass} is not 
-0002a710: 6120 7661 6c69 6420 6368 6f72 6420 696e  a valid chord in
-0002a720: 7665 7273 696f 6e2e 2229 0a0a 2020 2020  version.")..    
-0002a730: 6966 2066 6f72 6d20 3d3d 2027 6f27 3a0a  if form == 'o':.
-0002a740: 2020 2020 2020 2020 7365 745f 6976 2832          set_iv(2
-0002a750: 2c20 2d33 290a 2020 2020 2020 2020 7365  , -3).        se
-0002a760: 745f 6976 2834 2c20 2d36 290a 2020 2020  t_iv(4, -6).    
-0002a770: 2020 2020 6966 2069 735f 7365 7665 6e74      if is_sevent
-0002a780: 685f 6368 6f72 643a 0a20 2020 2020 2020  h_chord:.       
-0002a790: 2020 2020 2073 6574 5f69 7628 362c 202d       set_iv(6, -
-0002a7a0: 3929 0a20 2020 2065 6c69 6620 666f 726d  9).    elif form
-0002a7b0: 203d 3d20 2725 273a 0a20 2020 2020 2020   == '%':.       
-0002a7c0: 2073 6574 5f69 7628 322c 202d 3329 0a20   set_iv(2, -3). 
-0002a7d0: 2020 2020 2020 2073 6574 5f69 7628 342c         set_iv(4,
-0002a7e0: 202d 3629 0a20 2020 2020 2020 2073 6574   -6).        set
-0002a7f0: 5f69 7628 362c 202d 3229 0a20 2020 2065  _iv(6, -2).    e
-0002a800: 6c69 6620 666f 726d 203d 3d20 272b 273a  lif form == '+':
-0002a810: 0a20 2020 2020 2020 2073 6574 5f69 7628  .        set_iv(
-0002a820: 322c 2034 290a 2020 2020 2020 2020 7365  2, 4).        se
-0002a830: 745f 6976 2834 2c20 3829 0a20 2020 2020  t_iv(4, 8).     
-0002a840: 2020 2069 6620 6973 5f73 6576 656e 7468     if is_seventh
-0002a850: 5f63 686f 7264 3a0a 2020 2020 2020 2020  _chord:.        
-0002a860: 2020 2020 7365 745f 6976 2836 2c20 2d32      set_iv(6, -2
-0002a870: 290a 2020 2020 656c 6966 2066 6f72 6d20  ).    elif form 
-0002a880: 3d3d 2027 2b4d 273a 0a20 2020 2020 2020  == '+M':.       
-0002a890: 2073 6574 5f69 7628 322c 2034 290a 2020   set_iv(2, 4).  
-0002a8a0: 2020 2020 2020 7365 745f 6976 2834 2c20        set_iv(4, 
-0002a8b0: 3829 0a20 2020 2020 2020 2073 6574 5f69  8).        set_i
-0002a8c0: 7628 362c 2035 290a 2020 2020 656c 7365  v(6, 5).    else
-0002a8d0: 3a20 2023 2074 7269 6164 2077 6974 6820  :  # triad with 
-0002a8e0: 6f72 2077 6974 686f 7574 206d 616a 6f72  or without major
-0002a8f0: 206f 7220 6d69 6e6f 7220 7365 7665 6e0a   or minor seven.
-0002a900: 2020 2020 2020 2020 7365 745f 6976 2834          set_iv(4
-0002a910: 2c20 3129 0a20 2020 2020 2020 2069 6620  , 1).        if 
-0002a920: 6e75 6d5f 6465 6772 6565 2e69 7375 7070  num_degree.isupp
-0002a930: 6572 2829 3a0a 2020 2020 2020 2020 2020  er():.          
-0002a940: 2020 7365 745f 6976 2832 2c20 3429 0a20    set_iv(2, 4). 
-0002a950: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002a960: 2020 2020 2020 2020 2073 6574 5f69 7628           set_iv(
-0002a970: 322c 202d 3329 0a20 2020 2020 2020 2069  2, -3).        i
-0002a980: 6620 666f 726d 203d 3d20 274d 273a 0a20  f form == 'M':. 
-0002a990: 2020 2020 2020 2020 2020 2073 6574 5f69             set_i
-0002a9a0: 7628 362c 2035 290a 2020 2020 2020 2020  v(6, 5).        
-0002a9b0: 656c 6966 2069 735f 7365 7665 6e74 685f  elif is_seventh_
-0002a9c0: 6368 6f72 643a 0a20 2020 2020 2020 2020  chord:.         
-0002a9d0: 2020 2073 6574 5f69 7628 362c 202d 3229     set_iv(6, -2)
-0002a9e0: 0a0a 2020 2020 746f 6e65 5f66 756e 6374  ..    tone_funct
-0002a9f0: 696f 6e73 203d 2028 302c 2032 2c20 342c  ions = (0, 2, 4,
-0002aa00: 2036 2920 6966 2069 735f 7365 7665 6e74   6) if is_sevent
-0002aa10: 685f 6368 6f72 6420 656c 7365 2028 302c  h_chord else (0,
-0002aa20: 2032 2c20 3429 0a20 2020 2072 6f6f 745f   2, 4).    root_
-0002aa30: 706f 7369 7469 6f6e 203d 207b 693a 205b  position = {i: [
-0002aa40: 7470 6373 5b69 5d5d 2066 6f72 2069 2069  tpcs[i]] for i i
-0002aa50: 6e20 746f 6e65 5f66 756e 6374 696f 6e73  n tone_functions
-0002aa60: 7d0a 2020 2020 7265 706c 6163 656d 656e  }.    replacemen
-0002aa70: 7473 2020 3d20 7b69 3a20 5b5d 2066 6f72  ts  = {i: [] for
-0002aa80: 2069 2069 6e20 746f 6e65 5f66 756e 6374   i in tone_funct
-0002aa90: 696f 6e73 7d0a 0a20 2020 2064 6566 2072  ions}..    def r
-0002aaa0: 6570 6c61 6365 5f63 686f 7264 5f74 6f6e  eplace_chord_ton
-0002aab0: 6528 7768 6963 682c 2062 7929 3a0a 2020  e(which, by):.  
-0002aac0: 2020 2020 2020 6e6f 6e6c 6f63 616c 2072        nonlocal r
-0002aad0: 6f6f 745f 706f 7369 7469 6f6e 2c20 7265  oot_position, re
-0002aae0: 706c 6163 656d 656e 7473 0a20 2020 2020  placements.     
-0002aaf0: 2020 2069 6620 7768 6963 6820 696e 2072     if which in r
-0002ab00: 6f6f 745f 706f 7369 7469 6f6e 3a0a 2020  oot_position:.  
-0002ab10: 2020 2020 2020 2020 2020 726f 6f74 5f70            root_p
-0002ab20: 6f73 6974 696f 6e5b 7768 6963 685d 203d  osition[which] =
-0002ab30: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0002ab40: 7265 706c 6163 656d 656e 7473 5b77 6869  replacements[whi
-0002ab50: 6368 5d2e 696e 7365 7274 2830 2c20 6279  ch].insert(0, by
-0002ab60: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0002ab70: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0002ab80: 6572 2e77 6172 6e69 6e67 2866 224f 6e6c  er.warning(f"Onl
-0002ab90: 7920 6368 6f72 6420 746f 6e65 7320 5b30  y chord tones [0
-0002aba0: 2c32 2c34 2c28 3629 5d20 6361 6e20 6265  ,2,4,(6)] can be
-0002abb0: 2072 6570 6c61 6365 642c 206e 6f74 207b   replaced, not {
-0002abc0: 7768 6963 687d 2229 0a0a 2020 2020 2320  which}")..    # 
-0002abd0: 6170 706c 7920 6368 616e 6765 730a 2020  apply changes.  
-0002abe0: 2020 616c 7473 203d 2063 6861 6e67 6573    alts = changes
-0002abf0: 326c 6973 7428 6368 616e 6765 732c 2073  2list(changes, s
-0002ac00: 6f72 743d 4661 6c73 6529 0a20 2020 2061  ort=False).    a
-0002ac10: 6464 6564 5f6e 6f74 6573 203d 205b 5d0a  dded_notes = [].
-0002ac20: 2020 2020 666f 7220 6675 6c6c 2c20 6164      for full, ad
-0002ac30: 645f 7265 6d6f 7665 2c20 6163 632c 2063  d_remove, acc, c
-0002ac40: 686f 7264 5f69 6e74 6572 7661 6c20 696e  hord_interval in
-0002ac50: 2061 6c74 733a 0a20 2020 2020 2020 2061   alts:.        a
-0002ac60: 6464 6564 203d 2061 6464 5f72 656d 6f76  dded = add_remov
-0002ac70: 6520 3d3d 2027 2b27 0a20 2020 2020 2020  e == '+'.       
-0002ac80: 2073 7562 7374 7261 6374 6564 203d 2061   substracted = a
-0002ac90: 6464 5f72 656d 6f76 6520 3d3d 2027 2d27  dd_remove == '-'
-0002aca0: 0a20 2020 2020 2020 2072 6570 6c61 6369  .        replaci
-0002acb0: 6e67 5f75 7070 6572 203d 2061 6464 5f72  ng_upper = add_r
-0002acc0: 656d 6f76 6520 3d3d 2027 5e27 0a20 2020  emove == '^'.   
-0002acd0: 2020 2020 2072 6570 6c61 6369 6e67 5f6c       replacing_l
-0002ace0: 6f77 6572 203d 2061 6464 5f72 656d 6f76  ower = add_remov
-0002acf0: 6520 3d3d 2027 7627 0a20 2020 2020 2020  e == 'v'.       
-0002ad00: 2063 686f 7264 5f69 6e74 6572 7661 6c20   chord_interval 
-0002ad10: 3d20 696e 7428 6368 6f72 645f 696e 7465  = int(chord_inte
-0002ad20: 7276 616c 2920 2d20 310a 2020 2020 2020  rval) - 1.      
-0002ad30: 2020 2323 2320 4672 6f6d 2068 6572 6520    ### From here 
-0002ad40: 6f6e 2c20 6063 686f 7264 5f69 6e74 6572  on, `chord_inter
-0002ad50: 7661 6c60 2069 7320 6465 6372 656d 656e  val` is decremen
-0002ad60: 7465 642c 2069 2e65 2e20 7468 6520 726f  ted, i.e. the ro
-0002ad70: 6f74 2069 7320 302c 2074 6865 2073 6576  ot is 0, the sev
-0002ad80: 656e 7468 2069 7320 3620 6574 632e 2028  enth is 6 etc. (
-0002ad90: 6a75 7374 206c 696b 6520 696e 2060 7470  just like in `tp
-0002ada0: 6373 6029 0a20 2020 2020 2020 2069 6620  cs`).        if 
-0002adb0: 2863 686f 7264 5f69 6e74 6572 7661 6c20  (chord_interval 
-0002adc0: 3d3d 2030 2061 6e64 206e 6f74 2073 7562  == 0 and not sub
-0002add0: 7374 7261 6374 6564 2920 6f72 2063 686f  stracted) or cho
-0002ade0: 7264 5f69 6e74 6572 7661 6c20 3e20 3133  rd_interval > 13
-0002adf0: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-0002ae00: 6767 6572 2e77 6172 6e69 6e67 280a 2020  gger.warning(.  
-0002ae10: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0002ae20: 7b4d 437d 4368 616e 6765 207b 6675 6c6c  {MC}Change {full
-0002ae30: 7d20 6973 206d 6561 6e69 6e67 6c65 7373  } is meaningless
-0002ae40: 2061 6e64 2069 676e 6f72 6564 2062 6563   and ignored bec
-0002ae50: 6175 7365 2069 7420 636f 6e63 6572 6e73  ause it concerns
-0002ae60: 2063 686f 7264 2074 6f6e 6520 7b63 686f   chord tone {cho
-0002ae70: 7264 5f69 6e74 6572 7661 6c20 2b20 317d  rd_interval + 1}
-0002ae80: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0002ae90: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0002aea0: 206e 6578 745f 6f63 7461 7665 203d 2063   next_octave = c
-0002aeb0: 686f 7264 5f69 6e74 6572 7661 6c20 3e20  hord_interval > 
-0002aec0: 370a 2020 2020 2020 2020 7368 6966 7420  7.        shift 
-0002aed0: 3d20 3720 2a20 2861 6363 2e63 6f75 6e74  = 7 * (acc.count
-0002aee0: 2827 2327 2920 2d20 6163 632e 636f 756e  ('#') - acc.coun
-0002aef0: 7428 2762 2729 290a 2020 2020 2020 2020  t('b')).        
-0002af00: 6e65 775f 7661 6c20 3d20 7470 6373 5b63  new_val = tpcs[c
-0002af10: 686f 7264 5f69 6e74 6572 7661 6c5d 202b  hord_interval] +
-0002af20: 2073 6869 6674 0a20 2020 2020 2020 2069   shift.        i
-0002af30: 6620 7375 6273 7472 6163 7465 643a 0a20  f substracted:. 
-0002af40: 2020 2020 2020 2020 2020 2069 6620 6368             if ch
-0002af50: 6f72 645f 696e 7465 7276 616c 206e 6f74  ord_interval not
-0002af60: 2069 6e20 746f 6e65 5f66 756e 6374 696f   in tone_functio
-0002af70: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0002af80: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
-0002af90: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
-0002afa0: 2020 2020 2020 2020 6622 7b4d 437d 5468          f"{MC}Th
-0002afb0: 6520 6368 616e 6765 207b 6675 6c6c 7d20  e change {full} 
-0002afc0: 6861 7320 6e6f 2065 6666 6563 7420 6265  has no effect be
-0002afd0: 6361 7573 6520 6974 2063 6f6e 6365 726e  cause it concern
-0002afe0: 7320 616e 2069 6e74 6572 7661 6c20 7768  s an interval wh
-0002aff0: 6963 6820 6973 206e 6f74 2069 6d70 6c69  ich is not impli
-0002b000: 6564 2062 7920 7b6e 756d 6572 616c 7d7b  ed by {numeral}{
-0002b010: 666f 726d 7d7b 6669 6762 6173 737d 2e22  form}{figbass}."
-0002b020: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0002b030: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002b040: 2020 2020 726f 6f74 5f70 6f73 6974 696f      root_positio
-0002b050: 6e5b 6368 6f72 645f 696e 7465 7276 616c  n[chord_interval
-0002b060: 5d20 3d20 5b5d 0a20 2020 2020 2020 2065  ] = [].        e
-0002b070: 6c69 6620 6164 6465 643a 0a20 2020 2020  lif added:.     
-0002b080: 2020 2020 2020 2061 6464 6564 5f6e 6f74         added_not
-0002b090: 6573 2e61 7070 656e 6428 6e65 775f 7661  es.append(new_va
-0002b0a0: 6c29 0a20 2020 2020 2020 2065 6c69 6620  l).        elif 
-0002b0b0: 6e65 7874 5f6f 6374 6176 653a 0a20 2020  next_octave:.   
-0002b0c0: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
-0002b0d0: 2872 6570 6c61 6369 6e67 5f6c 6f77 6572  (replacing_lower
-0002b0e0: 2c20 7265 706c 6163 696e 675f 7570 7065  , replacing_uppe
-0002b0f0: 722c 2073 7562 7374 7261 6374 6564 2929  r, substracted))
-0002b100: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002b110: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
-0002b120: 7b4d 437d 7b66 756c 6c5b 305d 7d20 6861  {MC}{full[0]} ha
-0002b130: 7320 6e6f 2065 6666 6563 7420 696e 207b  s no effect in {
-0002b140: 6675 6c6c 7d20 2062 6563 6175 7365 2074  full}  because t
-0002b150: 6865 2069 6e74 6572 7661 6c20 6973 206c  he interval is l
-0002b160: 6172 6765 7220 7468 616e 2061 6e20 6f63  arger than an oc
-0002b170: 7461 7665 2e22 290a 2020 2020 2020 2020  tave.").        
-0002b180: 2020 2020 6164 6465 645f 6e6f 7465 732e      added_notes.
-0002b190: 6170 7065 6e64 286e 6577 5f76 616c 290a  append(new_val).
-0002b1a0: 2020 2020 2020 2020 656c 6966 2063 686f          elif cho
-0002b1b0: 7264 5f69 6e74 6572 7661 6c20 696e 205b  rd_interval in [
-0002b1c0: 312c 2033 2c20 355d 3a20 2023 2074 6865  1, 3, 5]:  # the
-0002b1d0: 7365 2061 7265 2063 6861 6e67 6573 2074  se are changes t
-0002b1e0: 6f20 7363 616c 6520 6465 6772 6565 2032  o scale degree 2
-0002b1f0: 2c20 342c 2036 2074 6861 7420 7265 706c  , 4, 6 that repl
-0002b200: 6163 6520 7468 6520 6c6f 7765 7220 6e65  ace the lower ne
-0002b210: 6967 6862 6f75 7220 756e 6c65 7373 2074  ighbour unless t
-0002b220: 6865 7920 6861 7665 2061 2023 206f 7220  hey have a # or 
-0002b230: 5e0a 2020 2020 2020 2020 2020 2020 6966  ^.            if
-0002b240: 2027 2327 2069 6e20 6163 6320 6f72 2072   '#' in acc or r
-0002b250: 6570 6c61 6369 6e67 5f75 7070 6572 3a0a  eplacing_upper:.
-0002b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b270: 6966 2027 2327 2069 6e20 6163 6320 616e  if '#' in acc an
-0002b280: 6420 7265 706c 6163 696e 675f 7570 7065  d replacing_uppe
-0002b290: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-0002b2a0: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
-0002b2b0: 666f 2866 227b 4d43 7d5e 2069 7320 7265  fo(f"{MC}^ is re
-0002b2c0: 6475 6e64 616e 7420 696e 207b 6675 6c6c  dundant in {full
-0002b2d0: 7d2e 2229 0a20 2020 2020 2020 2020 2020  }.").           
-0002b2e0: 2020 2020 2069 6620 6368 6f72 645f 696e       if chord_in
-0002b2f0: 7465 7276 616c 203d 3d20 3520 616e 6420  terval == 5 and 
-0002b300: 6973 5f74 7269 6164 3a20 2023 206c 6561  is_triad:  # lea
-0002b310: 6469 6e67 2074 6f6e 6520 746f 2037 2062  ding tone to 7 b
-0002b320: 7574 206e 6f74 2069 6e20 7365 7665 6e74  ut not in sevent
-0002b330: 6820 6368 6f72 640a 2020 2020 2020 2020  h chord.        
-0002b340: 2020 2020 2020 2020 2020 2020 6164 6465              adde
-0002b350: 645f 6e6f 7465 732e 6170 7065 6e64 286e  d_notes.append(n
-0002b360: 6577 5f76 616c 290a 2020 2020 2020 2020  ew_val).        
-0002b370: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b390: 2020 7265 706c 6163 655f 6368 6f72 645f    replace_chord_
-0002b3a0: 746f 6e65 2863 686f 7264 5f69 6e74 6572  tone(chord_inter
-0002b3b0: 7661 6c20 2b20 312c 206e 6577 5f76 616c  val + 1, new_val
-0002b3c0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0002b3d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002b3e0: 2020 2020 6966 2072 6570 6c61 6369 6e67      if replacing
-0002b3f0: 5f6c 6f77 6572 3a0a 2020 2020 2020 2020  _lower:.        
-0002b400: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0002b410: 6572 2e69 6e66 6f28 6622 7b4d 437d 7620  er.info(f"{MC}v 
-0002b420: 6973 2072 6564 756e 6461 6e74 2069 6e20  is redundant in 
-0002b430: 7b66 756c 6c7d 2e22 290a 2020 2020 2020  {full}.").      
-0002b440: 2020 2020 2020 2020 2020 7265 706c 6163            replac
-0002b450: 655f 6368 6f72 645f 746f 6e65 2863 686f  e_chord_tone(cho
-0002b460: 7264 5f69 6e74 6572 7661 6c20 2d20 312c  rd_interval - 1,
-0002b470: 206e 6577 5f76 616c 290a 2020 2020 2020   new_val).      
-0002b480: 2020 656c 7365 3a20 2023 2063 686f 7264    else:  # chord
-0002b490: 2074 6f6e 6520 616c 7465 7261 7469 6f6e   tone alteration
-0002b4a0: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
-0002b4b0: 2072 6570 6c61 6369 6e67 5f6c 6f77 6572   replacing_lower
-0002b4c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002b4d0: 2020 2320 544f 444f 3a20 5468 6973 206d    # TODO: This m
-0002b4e0: 7573 7420 6265 2070 6f73 7369 626c 652c  ust be possible,
-0002b4f0: 2065 2e67 2e20 5628 3676 3529 2077 6865   e.g. V(6v5) whe
-0002b500: 7265 2035 2069 7320 7375 7370 656e 7369  re 5 is suspensi
-0002b510: 6f6e 206f 6620 340a 2020 2020 2020 2020  on of 4.        
-0002b520: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-0002b530: 6e66 6f28 6622 7b4d 437d 7b66 756c 6c7d  nfo(f"{MC}{full}
-0002b540: 202d 3e20 6368 6f72 6420 746f 6e65 7320   -> chord tones 
-0002b550: 6361 6e6e 6f74 2072 6570 6c61 6365 206e  cannot replace n
-0002b560: 6569 6768 626f 7572 732c 2075 7365 202b  eighbours, use +
-0002b570: 2069 6e73 7465 6164 2e22 290a 2020 2020   instead.").    
-0002b580: 2020 2020 2020 2020 656c 6966 2063 686f          elif cho
-0002b590: 7264 5f69 6e74 6572 7661 6c20 3d3d 2036  rd_interval == 6
-0002b5a0: 2061 6e64 2066 6967 6261 7373 2021 3d20   and figbass != 
-0002b5b0: 2737 273a 2020 2320 3774 6820 6172 6520  '7':  # 7th are 
-0002b5c0: 6120 7370 6563 6961 6c20 6361 7365 3a0a  a special case:.
-0002b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b5e0: 6966 2066 6967 6261 7373 203d 3d20 2727  if figbass == ''
-0002b5f0: 3a20 2023 2069 6e20 726f 6f74 2070 6f73  :  # in root pos
-0002b600: 6974 696f 6e20 7472 6961 6473 2074 6865  ition triads the
-0002b610: 7920 6172 6520 6164 6465 640a 2020 2020  y are added.    
-0002b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b630: 2320 544f 444f 3a20 5468 6520 7374 616e  # TODO: The stan
-0002b640: 6461 7264 2069 7320 6c61 636b 696e 6720  dard is lacking 
-0002b650: 6120 6469 7374 696e 6374 696f 6e2c 2062  a distinction, b
-0002b660: 6563 6175 7365 2074 6865 2072 6f6f 7420  ecause the root 
-0002b670: 696e 2072 6f6f 7420 706f 732e 2063 616e  in root pos. can
-0002b680: 2061 6c73 6f20 6265 2072 6570 6c61 6365   also be replace
-0002b690: 6420 6672 6f6d 2062 656c 6f77 210a 2020  d from below!.  
-0002b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b6b0: 2020 6164 6465 645f 6e6f 7465 732e 6170    added_notes.ap
-0002b6c0: 7065 6e64 286e 6577 5f76 616c 290a 2020  pend(new_val).  
-0002b6d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0002b6e0: 6966 2066 6967 6261 7373 2069 6e20 5b27  if figbass in ['
-0002b6f0: 3627 2c20 2736 3427 5d20 6f72 2027 2327  6', '64'] or '#'
-0002b700: 2069 6e20 6163 633a 2020 2320 696e 2069   in acc:  # in i
-0002b710: 6e76 6572 7465 6420 7472 6961 6473 2074  nverted triads t
-0002b720: 6865 7920 7265 706c 6163 6520 7468 6520  hey replace the 
-0002b730: 726f 6f74 2c20 6173 2064 6f65 7320 2337  root, as does #7
-0002b740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b750: 2020 2020 2072 6570 6c61 6365 5f63 686f       replace_cho
-0002b760: 7264 5f74 6f6e 6528 302c 206e 6577 5f76  rd_tone(0, new_v
-0002b770: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
-0002b780: 2020 2020 656c 7365 3a20 2023 206f 7468      else:  # oth
-0002b790: 6572 7769 7365 2074 6865 7920 6172 6520  erwise they are 
-0002b7a0: 756e 636c 6561 720a 2020 2020 2020 2020  unclear.        
-0002b7b0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0002b7c0: 6572 2e77 6172 6e69 6e67 280a 2020 2020  er.warning(.    
-0002b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b7e0: 2020 2020 6622 7b4d 437d 496e 2073 6576      f"{MC}In sev
-0002b7f0: 656e 7468 2063 686f 7264 732c 2073 7563  enth chords, suc
-0002b800: 6820 6173 207b 6c61 6265 6c7d 2c20 6974  h as {label}, it
-0002b810: 2069 7320 6e6f 7420 636c 6561 7220 7768   is not clear wh
-0002b820: 6574 6865 7220 7468 6520 7b66 756c 6c7d  ether the {full}
-0002b830: 2061 6c74 6572 7320 7468 6520 3720 6f72   alters the 7 or
-0002b840: 2072 6570 6c61 6365 7320 7468 6520 3820   replaces the 8 
-0002b850: 616e 6420 7368 6f75 6c64 206e 6f74 2062  and should not b
-0002b860: 6520 7573 6564 2e22 2c0a 2020 2020 2020  e used.",.      
-0002b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b880: 2020 6578 7472 613d 7b22 6d65 7373 6167    extra={"messag
-0002b890: 655f 6964 223a 2028 3138 2c20 297d 290a  e_id": (18, )}).
-0002b8a0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0002b8b0: 2074 7063 735b 6368 6f72 645f 696e 7465   tpcs[chord_inte
-0002b8c0: 7276 616c 5d20 3d3d 206e 6577 5f76 616c  rval] == new_val
-0002b8d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002b8e0: 2020 6c6f 6767 6572 2e69 6e66 6f28 0a20    logger.info(. 
-0002b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b900: 2020 2066 227b 4d43 7d54 6865 2063 6861     f"{MC}The cha
-0002b910: 6e67 6520 7b66 756c 6c7d 2068 6173 206e  nge {full} has n
-0002b920: 6f20 6566 6665 6374 2069 6e20 7b6e 756d  o effect in {num
-0002b930: 6572 616c 7d7b 666f 726d 7d7b 6669 6762  eral}{form}{figb
-0002b940: 6173 737d 2229 0a20 2020 2020 2020 2020  ass}").         
-0002b950: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002b960: 2020 2020 2020 2020 2072 6f6f 745f 706f           root_po
-0002b970: 7369 7469 6f6e 5b63 686f 7264 5f69 6e74  sition[chord_int
-0002b980: 6572 7661 6c5d 203d 205b 6e65 775f 7661  erval] = [new_va
-0002b990: 6c5d 0a0a 2020 2020 6669 6762 6173 7332  l]..    figbass2
-0002b9a0: 6261 7373 203d 207b 0a20 2020 2020 2020  bass = {.       
-0002b9b0: 2027 273a 2030 2c0a 2020 2020 2020 2020   '': 0,.        
-0002b9c0: 2737 273a 2030 2c0a 2020 2020 2020 2020  '7': 0,.        
-0002b9d0: 2736 273a 2031 2c0a 2020 2020 2020 2020  '6': 1,.        
-0002b9e0: 2736 3527 3a20 312c 0a20 2020 2020 2020  '65': 1,.       
-0002b9f0: 2027 3634 273a 2032 2c0a 2020 2020 2020   '64': 2,.      
-0002ba00: 2020 2734 3327 3a20 322c 0a20 2020 2020    '43': 2,.     
-0002ba10: 2020 2027 3227 3a20 330a 2020 2020 7d0a     '2': 3.    }.
-0002ba20: 2020 2020 6261 7373 203d 2066 6967 6261      bass = figba
-0002ba30: 7373 3262 6173 735b 6669 6762 6173 735d  ss2bass[figbass]
-0002ba40: 0a20 2020 2063 686f 7264 5f74 6f6e 6573  .    chord_tones
-0002ba50: 203d 205b 5d0a 2020 2020 746f 6e65 5f66   = [].    tone_f
-0002ba60: 756e 6374 696f 6e5f 6e61 6d65 7320 3d20  unction_names = 
-0002ba70: 7b0a 2020 2020 2020 2020 303a 2027 726f  {.        0: 'ro
-0002ba80: 6f74 272c 0a20 2020 2020 2020 2032 3a20  ot',.        2: 
-0002ba90: 2733 7264 272c 0a20 2020 2020 2020 2034  '3rd',.        4
-0002baa0: 3a20 2735 7468 272c 0a20 2020 2020 2020  : '5th',.       
-0002bab0: 2036 3a20 2737 7468 272c 0a20 2020 207d   6: '7th',.    }
-0002bac0: 0a20 2020 2066 6f72 2074 6620 696e 2074  .    for tf in t
-0002bad0: 6f6e 655f 6675 6e63 7469 6f6e 735b 6261  one_functions[ba
-0002bae0: 7373 3a5d 202b 2074 6f6e 655f 6675 6e63  ss:] + tone_func
-0002baf0: 7469 6f6e 735b 3a62 6173 735d 3a0a 2020  tions[:bass]:.  
-0002bb00: 2020 2020 2020 6368 6f72 645f 746f 6e65        chord_tone
-0002bb10: 2c20 7265 706c 6163 696e 675f 746f 6e65  , replacing_tone
-0002bb20: 7320 3d20 726f 6f74 5f70 6f73 6974 696f  s = root_positio
-0002bb30: 6e5b 7466 5d2c 2072 6570 6c61 6365 6d65  n[tf], replaceme
-0002bb40: 6e74 735b 7466 5d0a 2020 2020 2020 2020  nts[tf].        
-0002bb50: 6966 2063 686f 7264 5f74 6f6e 6520 3d3d  if chord_tone ==
-0002bb60: 2072 6570 6c61 6369 6e67 5f74 6f6e 6573   replacing_tones
-0002bb70: 203d 3d20 5b5d 3a0a 2020 2020 2020 2020   == []:.        
-0002bb80: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-0002bb90: 2866 227b 4d43 7d7b 6c61 6265 6c7d 2072  (f"{MC}{label} r
-0002bba0: 6573 756c 7473 2069 6e20 6120 6368 6f72  esults in a chor
-0002bbb0: 6420 7769 7468 6f75 7420 7b74 6f6e 655f  d without {tone_
-0002bbc0: 6675 6e63 7469 6f6e 5f6e 616d 6573 5b74  function_names[t
-0002bbd0: 665d 7d2e 2229 0a20 2020 2020 2020 2069  f]}.").        i
-0002bbe0: 6620 6368 6f72 645f 746f 6e65 2021 3d20  f chord_tone != 
-0002bbf0: 5b5d 3a0a 2020 2020 2020 2020 2020 2020  []:.            
-0002bc00: 6368 6f72 645f 746f 6e65 732e 6170 7065  chord_tones.appe
-0002bc10: 6e64 2863 686f 7264 5f74 6f6e 655b 305d  nd(chord_tone[0]
-0002bc20: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0002bc30: 2072 6570 6c61 6369 6e67 5f74 6f6e 6573   replacing_tones
-0002bc40: 2021 3d20 5b5d 3a0a 2020 2020 2020 2020   != []:.        
-0002bc50: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-0002bc60: 6172 6e69 6e67 2866 227b 4d43 7d7b 6c61  arning(f"{MC}{la
-0002bc70: 6265 6c7d 2072 6573 756c 7473 2069 6e20  bel} results in 
-0002bc80: 6120 6368 6f72 6420 746f 6e65 207b 746f  a chord tone {to
-0002bc90: 6e65 5f66 756e 6374 696f 6e5f 6e61 6d65  ne_function_name
-0002bca0: 735b 7466 5d7d 2041 4e44 2069 7473 2072  s[tf]} AND its r
-0002bcb0: 6570 6c61 6365 6d65 6e74 2873 2920 2854  eplacement(s) (T
-0002bcc0: 5043 207b 7265 706c 6163 696e 675f 746f  PC {replacing_to
-0002bcd0: 6e65 737d 292e 2022 0a20 2020 2020 2020  nes}). ".       
-0002bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bcf0: 2020 2020 2020 2020 6622 596f 7520 6d69          f"You mi
-0002bd00: 6768 7420 7761 6e74 2074 6f20 6164 6420  ght want to add 
-0002bd10: 6120 2b20 746f 2064 6973 7469 6e67 7569  a + to distingui
-0002bd20: 7368 2066 726f 6d20 6120 7375 7370 656e  sh from a suspen
-0002bd30: 7369 6f6e 2c20 6f72 2061 6464 2074 6869  sion, or add thi
-0002bd40: 7320 7761 726e 696e 6720 746f 2049 474e  s warning to IGN
-0002bd50: 4f52 4544 5f57 4152 4e49 4e47 5320 7769  ORED_WARNINGS wi
-0002bd60: 7468 2061 2063 6f6d 6d65 6e74 2e22 2c0a  th a comment.",.
-0002bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0002bd90: 7874 7261 3d7b 226d 6573 7361 6765 5f69  xtra={"message_i
-0002bda0: 6422 3a20 2836 2c20 6d63 2c20 6c61 6265  d": (6, mc, labe
-0002bdb0: 6c29 7d29 0a20 2020 2020 2020 2063 686f  l)}).        cho
-0002bdc0: 7264 5f74 6f6e 6573 2e65 7874 656e 6428  rd_tones.extend(
-0002bdd0: 7265 706c 6163 696e 675f 746f 6e65 7329  replacing_tones)
-0002bde0: 0a0a 2020 2020 6261 7373 5f74 7063 203d  ..    bass_tpc =
-0002bdf0: 2063 686f 7264 5f74 6f6e 6573 5b30 5d0a   chord_tones[0].
-0002be00: 2020 2020 6966 2062 6173 735f 6f6e 6c79      if bass_only
-0002be10: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0002be20: 2062 6173 735f 7470 630a 2020 2020 656c   bass_tpc.    el
-0002be30: 6966 206d 6572 6765 5f74 6f6e 6573 3a0a  if merge_tones:.
-0002be40: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-0002be50: 7570 6c65 2873 6f72 745f 7470 6373 2863  uple(sort_tpcs(c
-0002be60: 686f 7264 5f74 6f6e 6573 202b 2061 6464  hord_tones + add
-0002be70: 6564 5f6e 6f74 6573 2c20 7374 6172 743d  ed_notes, start=
-0002be80: 6261 7373 5f74 7063 2929 0a20 2020 2065  bass_tpc)).    e
-0002be90: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
-0002bea0: 7572 6e20 7b0a 2020 2020 2020 2020 2020  urn {.          
-0002beb0: 2020 2763 686f 7264 5f74 6f6e 6573 273a    'chord_tones':
-0002bec0: 2074 7570 6c65 2863 686f 7264 5f74 6f6e   tuple(chord_ton
-0002bed0: 6573 292c 0a20 2020 2020 2020 2020 2020  es),.           
-0002bee0: 2027 6164 6465 645f 746f 6e65 7327 3a20   'added_tones': 
-0002bef0: 7475 706c 6528 6164 6465 645f 6e6f 7465  tuple(added_note
-0002bf00: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
-0002bf10: 2772 6f6f 7427 3a20 726f 6f74 2c0a 2020  'root': root,.  
-0002bf20: 2020 2020 2020 7d0a 0a64 6566 2070 6174        }..def pat
-0002bf30: 6832 7061 7265 6e74 5f63 6f72 7075 7328  h2parent_corpus(
-0002bf40: 7061 7468 293a 0a20 2020 2022 2222 5761  path):.    """Wa
-0002bf50: 6c6b 2075 7020 7468 6520 7061 7468 2061  lk up the path a
-0002bf60: 6e64 2072 6574 7572 6e20 7468 6520 6e61  nd return the na
-0002bf70: 6d65 206f 6620 7468 6520 6669 7273 7420  me of the first 
-0002bf80: 7375 7065 7264 6972 6563 746f 7279 2074  superdirectory t
-0002bf90: 6861 7420 6973 2061 2067 6974 2072 6570  hat is a git rep
-0002bfa0: 6f73 6974 6f72 7920 6f72 2063 6f6e 7461  ository or conta
-0002bfb0: 696e 7320 6120 276d 6574 6164 6174 612e  ins a 'metadata.
-0002bfc0: 7473 7627 2066 696c 652e 2222 220a 2020  tsv' file.""".  
-0002bfd0: 2020 6966 2070 6174 6820 696e 2028 2727    if path in (''
-0002bfe0: 2c20 272f 2729 3a0a 2020 2020 2020 2020  , '/'):.        
-0002bff0: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
-0002c000: 7472 793a 0a20 2020 2020 2020 2069 6620  try:.        if 
-0002c010: 6f73 2e70 6174 682e 6973 6469 7228 7061  os.path.isdir(pa
-0002c020: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-0002c030: 206c 6973 7464 6972 203d 206f 732e 6c69   listdir = os.li
-0002c040: 7374 6469 7228 7061 7468 290a 2020 2020  stdir(path).    
-0002c050: 2020 2020 2020 2020 6966 2027 6d65 7461          if 'meta
-0002c060: 6461 7461 2e74 7376 2720 696e 206c 6973  data.tsv' in lis
-0002c070: 7464 6972 206f 7220 272e 6769 7427 2069  tdir or '.git' i
-0002c080: 6e20 6c69 7374 6469 723a 0a20 2020 2020  n listdir:.     
-0002c090: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002c0a0: 6e20 7061 7468 0a20 2020 2020 2020 2072  n path.        r
-0002c0b0: 6574 7572 6e20 7061 7468 3270 6172 656e  eturn path2paren
-0002c0c0: 745f 636f 7270 7573 286f 732e 7061 7468  t_corpus(os.path
-0002c0d0: 2e64 6972 6e61 6d65 2870 6174 6829 290a  .dirname(path)).
-0002c0e0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0002c0f0: 7469 6f6e 3a0a 2020 2020 2020 2020 7265  tion:.        re
-0002c100: 7475 726e 204e 6f6e 650a 0a0a 4066 756e  turn None...@fun
-0002c110: 6374 696f 6e5f 6c6f 6767 6572 0a64 6566  ction_logger.def
-0002c120: 2063 686f 7264 3274 7063 7328 6368 6f72   chord2tpcs(chor
-0002c130: 642c 2072 6567 6578 3d4e 6f6e 652c 202a  d, regex=None, *
-0002c140: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
-0002c150: 220a 2020 2020 5370 6c69 7420 6120 6368  ".    Split a ch
-0002c160: 6f72 6420 6c61 6265 6c20 696e 746f 2069  ord label into i
-0002c170: 7473 2066 6561 7475 7265 7320 616e 6420  ts features and 
-0002c180: 6170 706c 7920 6665 6174 7572 6573 3274  apply features2t
-0002c190: 7063 7328 292e 0a0a 2020 2020 5573 6573  pcs()...    Uses
-0002c1a0: 3a20 6665 6174 7572 6573 3274 7063 7328  : features2tpcs(
-0002c1b0: 290a 0a20 2020 2050 6172 616d 6574 6572  )..    Parameter
-0002c1c0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0002c1d0: 0a20 2020 2063 686f 7264 203a 203a 6f62  .    chord : :ob
-0002c1e0: 6a3a 6073 7472 600a 2020 2020 2020 2020  j:`str`.        
-0002c1f0: 4368 6f72 6420 6c61 6265 6c20 7468 6174  Chord label that
-0002c200: 2063 616e 2062 6520 7370 6c69 7420 696e   can be split in
-0002c210: 746f 2074 6865 2066 6561 7475 7265 7320  to the features 
-0002c220: 5b27 6e75 6d65 7261 6c27 2c20 2766 6f72  ['numeral', 'for
-0002c230: 6d27 2c20 2766 6967 6261 7373 272c 2027  m', 'figbass', '
-0002c240: 6368 616e 6765 7327 2c20 2772 656c 6174  changes', 'relat
-0002c250: 6976 6572 6f6f 7427 5d2e 0a20 2020 2072  iveroot']..    r
-0002c260: 6567 6578 203a 203a 6f62 6a3a 6072 652e  egex : :obj:`re.
-0002c270: 5061 7474 6572 6e60 2c20 6f70 7469 6f6e  Pattern`, option
-0002c280: 616c 0a20 2020 2020 2020 2043 6f6d 7069  al.        Compi
-0002c290: 6c65 6420 7265 6765 7820 7769 7468 206e  led regex with n
-0002c2a0: 616d 6564 2067 726f 7570 7320 666f 7220  amed groups for 
-0002c2b0: 7468 6520 6669 7665 2066 6561 7475 7265  the five feature
-0002c2c0: 732e 2042 7920 6465 6661 756c 742c 2074  s. By default, t
-0002c2d0: 6865 2063 7572 7265 6e74 2076 6572 7369  he current versi
-0002c2e0: 6f6e 206f 6620 7468 6520 4443 4d4c 2068  on of the DCML h
-0002c2f0: 6172 6d6f 6e79 0a20 2020 2020 2020 2061  armony.        a
-0002c300: 6e6e 6f74 6174 696f 6e20 7374 616e 6461  nnotation standa
-0002c310: 7264 2069 7320 7573 6564 2e0a 2020 2020  rd is used..    
-0002c320: 2a2a 6b77 6172 6773 203a 0a20 2020 2020  **kwargs :.     
-0002c330: 2020 2061 7267 756d 656e 7473 2066 6f72     arguments for
-0002c340: 2066 6561 7475 7265 7332 7470 6373 2028   features2tpcs (
-0002c350: 7061 7373 204d 4320 746f 2073 686f 7720  pass MC to show 
-0002c360: 6974 2069 6e20 7761 726e 696e 6773 2129  it in warnings!)
-0002c370: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-0002c380: 7265 6765 7820 6973 204e 6f6e 653a 0a20  regex is None:. 
-0002c390: 2020 2020 2020 2072 6567 6578 203d 2044         regex = D
-0002c3a0: 434d 4c5f 5245 4745 580a 2020 2020 6368  CML_REGEX.    ch
-0002c3b0: 6f72 645f 6665 6174 7572 6573 203d 2072  ord_features = r
-0002c3c0: 652e 6d61 7463 6828 7265 6765 782c 2063  e.match(regex, c
-0002c3d0: 686f 7264 290a 2020 2020 6173 7365 7274  hord).    assert
-0002c3e0: 2063 686f 7264 5f66 6561 7475 7265 7320   chord_features 
-0002c3f0: 6973 206e 6f74 204e 6f6e 652c 2066 227b  is not None, f"{
-0002c400: 6368 6f72 647d 2064 6f65 7320 6e6f 7420  chord} does not 
-0002c410: 6d61 7463 6820 7468 6520 7265 6765 782e  match the regex.
-0002c420: 220a 2020 2020 6368 6f72 645f 6665 6174  ".    chord_feat
-0002c430: 7572 6573 203d 2063 686f 7264 5f66 6561  ures = chord_fea
-0002c440: 7475 7265 732e 6772 6f75 7064 6963 7428  tures.groupdict(
-0002c450: 290a 2020 2020 6e75 6d65 7261 6c2c 2066  ).    numeral, f
-0002c460: 6f72 6d2c 2066 6967 6261 7373 2c20 6368  orm, figbass, ch
-0002c470: 616e 6765 732c 2072 656c 6174 6976 6572  anges, relativer
-0002c480: 6f6f 7420 3d20 7475 706c 6528 6368 6f72  oot = tuple(chor
-0002c490: 645f 6665 6174 7572 6573 5b66 5d20 666f  d_features[f] fo
-0002c4a0: 7220 6620 696e 2028 276e 756d 6572 616c  r f in ('numeral
-0002c4b0: 272c 2027 666f 726d 272c 2027 6669 6762  ', 'form', 'figb
-0002c4c0: 6173 7327 2c20 2763 6861 6e67 6573 272c  ass', 'changes',
-0002c4d0: 2027 7265 6c61 7469 7665 726f 6f74 2729   'relativeroot')
-0002c4e0: 290a 2020 2020 7265 7475 726e 2066 6561  ).    return fea
-0002c4f0: 7475 7265 7332 7470 6373 286e 756d 6572  tures2tpcs(numer
-0002c500: 616c 3d6e 756d 6572 616c 2c20 666f 726d  al=numeral, form
-0002c510: 3d66 6f72 6d2c 2066 6967 6261 7373 3d66  =form, figbass=f
-0002c520: 6967 6261 7373 2c20 6368 616e 6765 733d  igbass, changes=
-0002c530: 6368 616e 6765 732c 2072 656c 6174 6976  changes, relativ
-0002c540: 6572 6f6f 743d 7265 6c61 7469 7665 726f  eroot=relativero
-0002c550: 6f74 2c0a 2020 2020 2020 2020 2020 2020  ot,.            
-0002c560: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-0002c570: 6765 723d 6c6f 6767 6572 2c20 2a2a 6b77  ger=logger, **kw
-0002c580: 6172 6773 290a 0a0a 6465 6620 7472 616e  args)...def tran
-0002c590: 7370 6f73 6528 652c 206e 293a 0a20 2020  spose(e, n):.   
-0002c5a0: 2022 2222 2041 6464 2060 6e60 2074 6f20   """ Add `n` to 
-0002c5b0: 616c 6c20 656c 656d 656e 7473 2060 6560  all elements `e`
-0002c5c0: 2072 6563 7572 7369 7665 6c79 2e0a 2020   recursively..  
-0002c5d0: 2020 2222 220a 2020 2020 7265 7475 726e    """.    return
-0002c5e0: 206d 6170 3265 6c65 6d65 6e74 7328 652c   map2elements(e,
-0002c5f0: 206c 616d 6264 6120 783a 2078 202b 206e   lambda x: x + n
-0002c600: 290a 0a0a 6465 6620 7061 7273 655f 6967  )...def parse_ig
-0002c610: 6e6f 7265 645f 7761 726e 696e 6773 286d  nored_warnings(m
-0002c620: 6573 7361 6765 733a 2043 6f6c 6c65 6374  essages: Collect
-0002c630: 696f 6e5b 7374 725d 2920 2d3e 2049 7465  ion[str]) -> Ite
-0002c640: 7261 746f 725b 5475 706c 655b 7374 722c  rator[Tuple[str,
-0002c650: 2054 7570 6c65 5b69 6e74 5d5d 5d3a 0a20   Tuple[int]]]:. 
-0002c660: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0002c670: 286d 6573 7361 6765 732c 2073 7472 293a  (messages, str):
-0002c680: 0a20 2020 2020 2020 2079 6965 6c64 2066  .        yield f
-0002c690: 726f 6d20 7061 7273 655f 6967 6e6f 7265  rom parse_ignore
-0002c6a0: 645f 7761 726e 696e 6773 285b 6d65 7373  d_warnings([mess
-0002c6b0: 6167 6573 5d29 0a20 2020 2065 6c73 653a  ages]).    else:
-0002c6c0: 0a20 2020 2020 2020 2066 6f72 206d 6573  .        for mes
-0002c6d0: 7361 6765 2069 6e20 6d65 7373 6167 6573  sage in messages
-0002c6e0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0002c6f0: 2027 5c6e 2720 696e 206d 6573 7361 6765   '\n' in message
-0002c700: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002c710: 2020 7969 656c 6420 6672 6f6d 2070 6172    yield from par
-0002c720: 7365 5f69 676e 6f72 6564 5f77 6172 6e69  se_ignored_warni
-0002c730: 6e67 7328 6d65 7373 6167 652e 7370 6c69  ngs(message.spli
-0002c740: 7428 275c 6e27 2929 0a20 2020 2020 2020  t('\n')).       
-0002c750: 2020 2020 2065 6c69 6620 6d65 7373 6167       elif messag
-0002c760: 6520 3d3d 2027 273a 0a20 2020 2020 2020  e == '':.       
-0002c770: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0002c780: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-0002c790: 6966 206d 6573 7361 6765 5b30 5d20 696e  if message[0] in
-0002c7a0: 2028 2720 272c 2027 5c74 272c 2027 2327   (' ', '\t', '#'
-0002c7b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0002c7c0: 2020 2023 2069 6620 7365 7665 7261 6c20     # if several 
-0002c7d0: 6c69 6e65 7320 6f66 2061 2077 6172 6e69  lines of a warni
-0002c7e0: 6e67 2077 6572 6520 636f 7069 6564 2c20  ng were copied, 
-0002c7f0: 7573 6520 6f6e 6c79 2074 6865 2066 6972  use only the fir
-0002c800: 7374 206f 6e65 0a20 2020 2020 2020 2020  st one.         
-0002c810: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0002c820: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0002c830: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002c840: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0002c850: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-0002c860: 7468 6520 616e 6e6f 7461 746f 7220 636f  the annotator co
-0002c870: 7069 6564 2074 6f6f 206d 7563 682c 2063  pied too much, c
-0002c880: 7574 206f 6666 2074 6865 2072 6564 756e  ut off the redun
-0002c890: 6461 6e74 2069 6e66 6f72 6d61 7469 6f6e  dant information
-0002c8a0: 2061 7420 7468 6520 656e 640a 2020 2020   at the end.    
-0002c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c8c0: 7265 6475 6e64 616e 7420 3d20 206d 6573  redundant =  mes
-0002c8d0: 7361 6765 2e69 6e64 6578 2827 202d 2d20  sage.index(' -- 
-0002c8e0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0002c8f0: 2020 2020 2020 206d 6573 7361 6765 203d         message =
-0002c900: 206d 6573 7361 6765 5b3a 7265 6475 6e64   message[:redund
-0002c910: 616e 745d 0a20 2020 2020 2020 2020 2020  ant].           
-0002c920: 2020 2020 2065 7863 6570 7420 5661 6c75       except Valu
-0002c930: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-0002c940: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-0002c950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c960: 206d 6573 7361 6765 203d 206d 6573 7361   message = messa
-0002c970: 6765 2e73 7472 6970 2829 0a20 2020 2020  ge.strip().     
-0002c980: 2020 2020 2020 2020 2020 2073 706c 6974             split
-0002c990: 5f72 6520 3d20 7222 5e28 2e2a 2920 285c  _re = r"^(.*) (\
-0002c9a0: 532b 2924 220a 2020 2020 2020 2020 2020  S+)$".          
-0002c9b0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0002c9c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0002c9d0: 7367 2c20 6c6f 6767 6572 5f6e 616d 6520  sg, logger_name 
-0002c9e0: 3d20 7265 2e6d 6174 6368 2873 706c 6974  = re.match(split
-0002c9f0: 5f72 652c 206d 6573 7361 6765 292e 6772  _re, message).gr
-0002ca00: 6f75 7073 2829 0a20 2020 2020 2020 2020  oups().         
-0002ca10: 2020 2020 2020 2065 7863 6570 7420 4174         except At
-0002ca20: 7472 6962 7574 6545 7272 6f72 3a0a 2020  tributeError:.  
-0002ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ca40: 2020 7072 696e 7428 6622 5468 6520 666f    print(f"The fo
-0002ca50: 6c6c 6f77 696e 6720 6d65 7373 6167 6520  llowing message 
-0002ca60: 636f 756c 6420 6e6f 7420 6265 2073 706c  could not be spl
-0002ca70: 6974 2c20 6170 7061 7265 6e74 6c79 2069  it, apparently i
-0002ca80: 7420 646f 6573 206e 6f74 2065 6e64 2077  t does not end w
-0002ca90: 6974 6820 7468 6520 6c6f 6767 6572 5f6e  ith the logger_n
-0002caa0: 616d 653a 207b 6d65 7373 6167 657d 2229  ame: {message}")
-0002cab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002cac0: 2020 2020 2072 6169 7365 0a20 2020 2020       raise.     
-0002cad0: 2020 2020 2020 2020 2020 2069 6620 6d73             if ms
-0002cae0: 675b 2d31 5d20 213d 2027 2927 3a0a 2020  g[-1] != ')':.  
-0002caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cb00: 2020 6966 2061 6e79 286d 7367 2e73 7461    if any(msg.sta
-0002cb10: 7274 7377 6974 6828 6c65 7665 6c29 2066  rtswith(level) f
-0002cb20: 6f72 206c 6576 656c 2069 6e20 2827 4445  or level in ('DE
-0002cb30: 4255 4727 2c20 2749 4e46 4f27 2c20 2757  BUG', 'INFO', 'W
-0002cb40: 4152 4e49 4e47 272c 2027 4552 524f 5227  ARNING', 'ERROR'
-0002cb50: 2c20 2743 5249 5449 4341 4c27 2929 3a0a  , 'CRITICAL')):.
-0002cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cb70: 2020 2020 2020 2020 2320 6d65 7373 6167          # messag
-0002cb80: 655f 6964 2068 6173 206e 6f74 2028 7965  e_id has not (ye
-0002cb90: 7429 2073 7065 6369 6669 6564 2066 6f72  t) specified for
-0002cba0: 2074 6869 7320 6c6f 6720 6d65 7373 6167   this log messag
-0002cbb0: 6520 616e 6420 6973 2069 676e 6f72 6564  e and is ignored
-0002cbc0: 3b0a 2020 2020 2020 2020 2020 2020 2020  ;.              
-0002cbd0: 2020 2020 2020 2020 2020 2320 6120 7761            # a wa
-0002cbe0: 726e 696e 6720 636f 756c 6420 6265 2069  rning could be i
-0002cbf0: 6d70 6c65 6d65 6e74 6564 2061 7420 7468  mplemented at th
-0002cc00: 6973 2070 6f69 6e74 0a20 2020 2020 2020  is point.       
-0002cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cc20: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-0002cc30: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0002cc40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002cc50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0002cc60: 6520 5661 6c75 6545 7272 6f72 2866 2255  e ValueError(f"U
-0002cc70: 6e65 7870 6563 7465 6420 6c6f 6720 6d65  nexpected log me
-0002cc80: 7373 6167 6520 666f 726d 6174 3a20 7b6d  ssage format: {m
-0002cc90: 7367 7d22 290a 2020 2020 2020 2020 2020  sg}").          
-0002cca0: 2020 2020 2020 7475 706c 655f 7374 6172        tuple_star
-0002ccb0: 7420 3d20 6d73 672e 696e 6465 7828 2728  t = msg.index('(
-0002ccc0: 2729 202b 2031 0a20 2020 2020 2020 2020  ') + 1.         
-0002ccd0: 2020 2020 2020 2074 7570 6c65 5f73 7472         tuple_str
-0002cce0: 203d 206d 7367 5b74 7570 6c65 5f73 7461   = msg[tuple_sta
-0002ccf0: 7274 3a2d 315d 0a20 2020 2020 2020 2020  rt:-1].         
-0002cd00: 2020 2020 2020 2069 6e66 6f20 3d20 7374         info = st
-0002cd10: 7232 696e 7474 7570 6c65 2874 7570 6c65  r2inttuple(tuple
-0002cd20: 5f73 7472 2c20 7374 7269 6374 3d46 616c  _str, strict=Fal
-0002cd30: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-0002cd40: 2020 2020 7969 656c 6420 6c6f 6767 6572      yield logger
-0002cd50: 5f6e 616d 652c 2069 6e66 6f0a 0a64 6566  _name, info..def
-0002cd60: 2069 676e 6f72 6564 5f77 6172 6e69 6e67   ignored_warning
-0002cd70: 7332 6469 6374 286d 6573 7361 6765 733a  s2dict(messages:
-0002cd80: 2043 6f6c 6c65 6374 696f 6e5b 7374 725d   Collection[str]
-0002cd90: 2920 2d3e 2044 6963 745b 7374 722c 204c  ) -> Dict[str, L
-0002cda0: 6973 745b 5475 706c 655b 696e 745d 5d5d  ist[Tuple[int]]]
-0002cdb0: 3a0a 2020 2020 2222 220a 0a20 2020 2041  :.    """..    A
-0002cdc0: 7267 733a 0a20 2020 2020 206d 6573 7361  rgs:.      messa
-0002cdd0: 6765 733a 0a0a 2020 2020 5265 7475 726e  ges:..    Return
-0002cde0: 733a 0a20 2020 2020 207b 6c6f 6767 6572  s:.      {logger
-0002cdf0: 5f6e 616d 6520 2d3e 205b 6967 6e6f 7265  _name -> [ignore
-0002ce00: 645f 7761 726e 696e 6773 5d7d 2064 6963  d_warnings]} dic
-0002ce10: 742e 0a20 2020 2022 2222 0a20 2020 2069  t..    """.    i
-0002ce20: 676e 6f72 6564 5f77 6172 6e69 6e67 7320  gnored_warnings 
-0002ce30: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
-0002ce40: 7374 290a 2020 2020 666f 7220 6c6f 6767  st).    for logg
-0002ce50: 6572 5f6e 616d 652c 2069 6e66 6f20 696e  er_name, info in
-0002ce60: 2070 6172 7365 5f69 676e 6f72 6564 5f77   parse_ignored_w
-0002ce70: 6172 6e69 6e67 7328 6d65 7373 6167 6573  arnings(messages
-0002ce80: 293a 0a20 2020 2020 2020 2069 676e 6f72  ):.        ignor
-0002ce90: 6564 5f77 6172 6e69 6e67 735b 6c6f 6767  ed_warnings[logg
-0002cea0: 6572 5f6e 616d 655d 2e61 7070 656e 6428  er_name].append(
-0002ceb0: 696e 666f 290a 2020 2020 7265 7475 726e  info).    return
-0002cec0: 2064 6963 7428 6967 6e6f 7265 645f 7761   dict(ignored_wa
-0002ced0: 726e 696e 6773 290a 0a64 6566 2070 6172  rnings)..def par
-0002cee0: 7365 5f69 676e 6f72 6564 5f77 6172 6e69  se_ignored_warni
-0002cef0: 6e67 735f 6669 6c65 2870 6174 683a 2073  ngs_file(path: s
-0002cf00: 7472 2920 2d3e 2044 6963 745b 7374 722c  tr) -> Dict[str,
-0002cf10: 204c 6973 745b 5475 706c 655b 696e 742c   List[Tuple[int,
-0002cf20: 2054 7570 6c65 5b69 6e74 5d5d 5d5d 3a0a   Tuple[int]]]]:.
-0002cf30: 2020 2020 2222 2250 6172 7365 2066 696c      """Parse fil
-0002cf40: 6520 7769 7468 206c 6f67 206d 6573 7361  e with log messa
-0002cf50: 6765 7320 7468 6174 2068 6176 6520 746f  ges that have to
-0002cf60: 2062 6520 6967 6e6f 7265 6420 746f 2074   be ignored to t
-0002cf70: 6865 2064 6963 742e 0a20 2020 2054 6865  he dict..    The
-0002cf80: 2065 7870 6563 7465 6420 7374 7275 6374   expected struct
-0002cf90: 7572 6520 6f66 206d 6573 7361 6765 3a20  ure of message: 
-0002cfa0: 7761 726e 696e 675f 7479 7065 2028 7761  warning_type (wa
-0002cfb0: 726e 696e 675f 7479 7065 5f69 642c 202a  rning_type_id, *
-0002cfc0: 696e 7465 6765 7273 2920 6669 6c65 0a20  integers) file. 
-0002cfd0: 2020 2045 7861 6d70 6c65 206f 6620 6d65     Example of me
-0002cfe0: 7373 6167 653a 2049 4e43 4f52 5245 4354  ssage: INCORRECT
-0002cff0: 5f56 4f4c 5441 5f4d 4e5f 5741 524e 494e  _VOLTA_MN_WARNIN
-0002d000: 4720 2832 2c20 3934 2920 6d73 332e 5061  G (2, 94) ms3.Pa
-0002d010: 7273 652e 6d69 7865 645f 6669 6c65 732e  rse.mixed_files.
-0002d020: 4469 6430 334d 2d53 6f6e 5f72 6567 696e  Did03M-Son_regin
-0002d030: 612d 3137 3632 2d53 6172 7469 2e6d 7363  a-1762-Sarti.msc
-0002d040: 782e 4d65 6173 7572 654c 6973 740a 0a20  x.MeasureList.. 
-0002d050: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0002d060: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0002d070: 206b 6579 203a 203a 6f62 6a3a 6073 7472   key : :obj:`str
-0002d080: 600a 2020 2020 2020 2020 7c20 5061 7468  `.        | Path
-0002d090: 2074 6f20 4947 4e4f 5245 445f 5741 524e   to IGNORED_WARN
-0002d0a0: 494e 4753 0a0a 2020 2020 5265 7475 726e  INGS..    Return
-0002d0b0: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-0002d0c0: 2020 3a6f 626a 3a20 6469 6374 0a20 2020    :obj: dict.   
-0002d0d0: 2020 2020 207b 6c6f 6767 6572 5f6e 616d       {logger_nam
-0002d0e0: 653a 205b 286d 6573 7361 6765 5f69 642c  e: [(message_id,
-0002d0f0: 206c 6162 656c 5f6f 665f 6d65 7373 6167   label_of_messag
-0002d100: 6529 2c20 286d 6573 7361 6765 5f69 642c  e), (message_id,
-0002d110: 206c 6162 656c 5f6f 665f 6d65 7373 6167   label_of_messag
-0002d120: 6529 2c20 2e2e 2e5d 7d2e 0a20 2020 2022  e), ...]}..    "
-0002d130: 2222 0a20 2020 2070 6174 6820 3d20 7265  "".    path = re
-0002d140: 736f 6c76 655f 6469 7228 7061 7468 290a  solve_dir(path).
-0002d150: 2020 2020 6d65 7373 6167 6573 203d 206f      messages = o
-0002d160: 7065 6e28 7061 7468 2c20 2772 272c 2065  pen(path, 'r', e
-0002d170: 6e63 6f64 696e 673d 2775 7466 2d38 2729  ncoding='utf-8')
-0002d180: 2e72 6561 646c 696e 6573 2829 0a20 2020  .readlines().   
-0002d190: 2072 6574 7572 6e20 6967 6e6f 7265 645f   return ignored_
-0002d1a0: 7761 726e 696e 6773 3264 6963 7428 6d65  warnings2dict(me
-0002d1b0: 7373 6167 6573 290a 0a0a 6465 6620 6f76  ssages)...def ov
-0002d1c0: 6572 6c61 7070 696e 675f 6368 756e 6b5f  erlapping_chunk_
-0002d1d0: 7065 725f 696e 7465 7276 616c 2864 663a  per_interval(df:
-0002d1e0: 2070 642e 4461 7461 4672 616d 652c 0a20   pd.DataFrame,. 
-0002d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d210: 2020 696e 7465 7276 616c 733a 204c 6973    intervals: Lis
-0002d220: 745b 7064 2e49 6e74 6572 7661 6c5d 2c0a  t[pd.Interval],.
-0002d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d250: 2020 2074 7275 6e63 6174 653a 2062 6f6f     truncate: boo
-0002d260: 6c20 3d20 5472 7565 2920 2d3e 2044 6963  l = True) -> Dic
-0002d270: 745b 7064 2e49 6e74 6572 7661 6c2c 2070  t[pd.Interval, p
-0002d280: 642e 4461 7461 4672 616d 655d 3a0a 2020  d.DataFrame]:.  
-0002d290: 2020 2222 2220 466f 7220 6561 6368 2069    """ For each i
-0002d2a0: 6e74 6572 7661 6c2c 2063 7265 6174 6520  nterval, create 
-0002d2b0: 6120 6368 756e 6b20 6f66 2074 6865 2067  a chunk of the g
-0002d2c0: 6976 656e 2044 6174 6146 7261 6d65 2062  iven DataFrame b
-0002d2d0: 6173 6564 206f 6e20 6974 7320 496e 7465  ased on its Inte
-0002d2e0: 7276 616c 496e 6465 782e 0a20 2020 2054  rvalIndex..    T
-0002d2f0: 6869 7320 6973 2061 6e20 6f70 7469 6d69  his is an optimi
-0002d300: 7a65 6420 616c 676f 7269 7468 6d20 636f  zed algorithm co
-0002d310: 6d70 6172 6564 2074 6f20 6361 6c6c 696e  mpared to callin
-0002d320: 6720 496e 7465 7276 616c 496e 6465 782e  g IntervalIndex.
-0002d330: 6f76 6572 6c61 7073 2869 6e74 6572 7661  overlaps(interva
-0002d340: 6c29 2066 6f72 2065 6163 680a 2020 2020  l) for each.    
-0002d350: 6769 7665 6e20 696e 7465 7276 616c 2c20  given interval, 
-0002d360: 7769 7468 2074 6865 2061 6464 6974 696f  with the additio
-0002d370: 6e61 6c20 6164 7661 6e74 6167 6520 7468  nal advantage th
-0002d380: 6174 2069 7420 7769 6c6c 206e 6f74 2064  at it will not d
-0002d390: 6973 6361 7264 2072 6f77 7320 7768 6572  iscard rows wher
-0002d3a0: 6520 7468 650a 2020 2020 696e 7465 7276  e the.    interv
-0002d3b0: 616c 2069 7320 7a65 726f 2c20 7375 6368  al is zero, such
-0002d3c0: 2061 7320 5b32 352e 302c 2032 352e 3029   as [25.0, 25.0)
-0002d3d0: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-0002d3e0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0002d3f0: 0a20 2020 2064 6620 3a20 3a6f 626a 3a60  .    df : :obj:`
-0002d400: 7061 6e64 6173 2e44 6174 6146 7261 6d65  pandas.DataFrame
-0002d410: 600a 2020 2020 2020 2020 5468 6520 4461  `.        The Da
-0002d420: 7461 4672 616d 6520 6973 2065 7870 6563  taFrame is expec
-0002d430: 7465 6420 746f 2063 6f6d 6520 7769 7468  ted to come with
-0002d440: 2061 6e20 496e 7465 7276 616c 496e 6465   an IntervalInde
-0002d450: 7820 616e 6420 636f 6e74 6169 6e20 7468  x and contain th
-0002d460: 6520 636f 6c75 6d6e 7320 2771 7561 7274  e columns 'quart
-0002d470: 6572 6265 6174 7327 2061 6e64 2027 6475  erbeats' and 'du
-0002d480: 7261 7469 6f6e 5f71 6227 2e0a 2020 2020  ration_qb'..    
-0002d490: 2020 2020 5468 6f73 6520 6361 6e20 6265      Those can be
-0002d4a0: 206f 6274 6169 6e65 6420 7468 726f 7567   obtained throug
-0002d4b0: 6820 6060 5061 7273 652e 6765 745f 6c69  h ``Parse.get_li
-0002d4c0: 7374 7328 696e 7465 7276 616c 5f69 6e64  sts(interval_ind
-0002d4d0: 6578 3d54 7275 6529 6060 206f 720a 2020  ex=True)`` or.  
-0002d4e0: 2020 2020 2020 6060 5061 7273 652e 6974        ``Parse.it
-0002d4f0: 6572 5f74 7261 6e73 666f 726d 6564 2869  er_transformed(i
-0002d500: 6e74 6572 7661 6c5f 696e 6465 783d 5472  nterval_index=Tr
-0002d510: 7565 2960 602e 0a20 2020 2069 6e74 6572  ue)``..    inter
-0002d520: 7661 6c73 203a 203a 6f62 6a3a 606c 6973  vals : :obj:`lis
-0002d530: 7460 206f 6620 3a6f 626a 3a60 7064 2e49  t` of :obj:`pd.I
-0002d540: 6e74 6572 7661 6c60 0a20 2020 2020 2020  nterval`.       
-0002d550: 2054 6865 2069 6e74 6572 7661 6c73 2064   The intervals d
-0002d560: 6566 696e 696e 6720 7468 6520 6368 756e  efining the chun
-0002d570: 6b73 2720 6469 6d65 6e73 696f 6e73 2e20  ks' dimensions. 
-0002d580: 4578 7065 6374 6564 2074 6f20 6265 206e  Expected to be n
-0002d590: 6f6e 2d6f 7665 726c 6170 7069 6e67 2061  on-overlapping a
-0002d5a0: 6e64 206d 6f6e 6f74 6f6e 6963 616c 6c79  nd monotonically
-0002d5b0: 2069 6e63 7265 6173 696e 672e 0a20 2020   increasing..   
-0002d5c0: 2074 7275 6e63 6174 6520 3a20 3a6f 626a   truncate : :obj
-0002d5d0: 3a60 626f 6f6c 602c 206f 7074 696f 6e61  :`bool`, optiona
-0002d5e0: 6c0a 2020 2020 2020 2020 4465 6661 756c  l.        Defaul
-0002d5f0: 7473 2074 6f20 5472 7565 2c20 6d65 616e  ts to True, mean
-0002d600: 696e 6720 7468 6174 2074 6865 2069 6e74  ing that the int
-0002d610: 6572 7661 6c20 696e 6465 7820 616e 6420  erval index and 
-0002d620: 7468 6520 2764 7572 6174 696f 6e5f 7162  the 'duration_qb
-0002d630: 2720 7769 6c6c 2062 6520 6164 6170 7465  ' will be adapte
-0002d640: 6420 666f 7220 6f76 6572 6c61 7070 696e  d for overlappin
-0002d650: 6720 696e 7465 7276 616c 732e 0a20 2020  g intervals..   
-0002d660: 2020 2020 2050 6173 7320 4661 6c73 6520       Pass False 
-0002d670: 746f 2067 6574 2063 6875 6e6b 7320 7769  to get chunks wi
-0002d680: 7468 2061 6c6c 206f 7665 726c 6170 7069  th all overlappi
-0002d690: 6e67 2069 6e74 6572 7661 6c73 2061 7320  ng intervals as 
-0002d6a0: 7468 6579 2061 7265 2e0a 0a20 2020 2052  they are...    R
-0002d6b0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-0002d6c0: 2d2d 0a20 2020 203a 6f62 6a3a 6064 6963  --.    :obj:`dic
-0002d6d0: 7460 0a20 2020 2020 2020 207b 696e 7465  t`.        {inte
-0002d6e0: 7276 616c 202d 3e20 6368 756e 6b7d 0a20  rval -> chunk}. 
-0002d6f0: 2020 2022 2222 0a20 2020 206c 6566 7473     """.    lefts
-0002d700: 203d 2064 662e 696e 6465 782e 6c65 6674   = df.index.left
-0002d710: 2e76 616c 7565 7320 2020 2023 206c 6566  .values    # lef
-0002d720: 7473 2061 6e64 2072 6967 6874 7320 7769  ts and rights wi
-0002d730: 6c6c 2067 6574 2073 686f 7274 6572 2028  ll get shorter (
-0002d740: 706f 7465 6e74 6961 6c6c 7929 2077 6974  potentially) wit
-0002d750: 6820 6576 6572 790a 2020 2020 7269 6768  h every.    righ
-0002d760: 7473 203d 2064 662e 696e 6465 782e 7269  ts = df.index.ri
-0002d770: 6768 742e 7661 6c75 6573 2020 2320 696e  ght.values  # in
-0002d780: 7465 7276 616c 2c20 696e 206f 7264 6572  terval, in order
-0002d790: 2074 6f20 7265 6475 6365 2074 6865 2074   to reduce the t
-0002d7a0: 696d 6520 666f 7220 636f 6d70 6172 696e  ime for comparin
-0002d7b0: 6720 7661 6c75 6573 0a20 2020 2063 6875  g values.    chu
-0002d7c0: 6e6b 7320 3d20 7b7d 0a20 2020 2063 7572  nks = {}.    cur
-0002d7d0: 7265 6e74 5f73 7461 7274 5f6d 6173 6b20  rent_start_mask 
-0002d7e0: 3d20 6e70 2e6f 6e65 7328 6c65 6e28 6466  = np.ones(len(df
-0002d7f0: 2e69 6e64 6578 292c 2064 7479 7065 203d  .index), dtype =
-0002d800: 2062 6f6f 6c29 2023 206c 656e 6774 6820   bool) # length 
-0002d810: 7265 6d61 696e 7320 7468 6520 7361 6d65  remains the same
-0002d820: 0a20 2020 2066 6f72 2069 7620 696e 2069  .    for iv in i
-0002d830: 6e74 6572 7661 6c73 3a0a 2020 2020 2020  ntervals:.      
-0002d840: 2020 2320 6173 7375 6d65 7320 696e 7465    # assumes inte
-0002d850: 7276 616c 7320 6172 6520 6e6f 6e2d 6f76  rvals are non-ov
-0002d860: 6572 6c61 7070 696e 6720 616e 6420 6d6f  erlapping and mo
-0002d870: 6e6f 746f 6e69 6361 6c6c 7920 696e 6372  notonically incr
-0002d880: 6561 7369 6e67 0a20 2020 2020 2020 206c  easing.        l
-0002d890: 2c20 7220 3d20 6976 2e6c 6566 742c 2069  , r = iv.left, i
-0002d8a0: 762e 7269 6768 740a 2020 2020 2020 2020  v.right.        
-0002d8b0: 2320 6e65 7665 7220 6167 6169 6e20 6368  # never again ch
-0002d8c0: 6563 6b20 6576 656e 7473 2065 6e64 696e  eck events endin
-0002d8d0: 6720 6265 666f 7265 2074 6865 2063 7572  g before the cur
-0002d8e0: 7265 6e74 2069 6e74 6572 7661 6c27 7320  rent interval's 
-0002d8f0: 7374 6172 740a 2020 2020 2020 2020 6e6f  start.        no
-0002d900: 745f 656e 6469 6e67 5f62 6566 6f72 655f  t_ending_before_
-0002d910: 6c20 3d20 2872 6967 6874 7320 3e3d 206c  l = (rights >= l
-0002d920: 290a 2020 2020 2020 2020 6c65 6674 7320  ).        lefts 
-0002d930: 3d20 6c65 6674 735b 6e6f 745f 656e 6469  = lefts[not_endi
-0002d940: 6e67 5f62 6566 6f72 655f 6c5d 0a20 2020  ng_before_l].   
-0002d950: 2020 2020 2072 6967 6874 7320 3d20 7269       rights = ri
-0002d960: 6768 7473 5b6e 6f74 5f65 6e64 696e 675f  ghts[not_ending_
-0002d970: 6265 666f 7265 5f6c 5d0a 2020 2020 2020  before_l].      
-0002d980: 2020 6375 7272 656e 745f 7374 6172 745f    current_start_
-0002d990: 6d61 736b 5b63 7572 7265 6e74 5f73 7461  mask[current_sta
-0002d9a0: 7274 5f6d 6173 6b5d 203d 206e 6f74 5f65  rt_mask] = not_e
-0002d9b0: 6e64 696e 675f 6265 666f 7265 5f6c 0a20  nding_before_l. 
-0002d9c0: 2020 2020 2020 2073 7461 7274 696e 675f         starting_
-0002d9d0: 6265 666f 7265 5f72 203d 2028 7220 3e20  before_r = (r > 
-0002d9e0: 6c65 6674 7329 0a20 2020 2020 2020 206e  lefts).        n
-0002d9f0: 6f74 5f65 6e64 696e 675f 6f6e 5f6c 5f65  ot_ending_on_l_e
-0002da00: 7863 6570 745f 656d 7074 7920 3d20 2872  xcept_empty = (r
-0002da10: 6967 6874 7320 213d 206c 2920 7c20 286c  ights != l) | (l
-0002da20: 6566 7473 203d 3d20 6c29 0a20 2020 2020  efts == l).     
-0002da30: 2020 206f 7665 726c 6170 7069 6e67 203d     overlapping =
-0002da40: 2028 7374 6172 7469 6e67 5f62 6566 6f72   (starting_befor
-0002da50: 655f 7220 2620 6e6f 745f 656e 6469 6e67  e_r & not_ending
-0002da60: 5f6f 6e5f 6c5f 6578 6365 7074 5f65 6d70  _on_l_except_emp
-0002da70: 7479 290a 2020 2020 2020 2020 626f 6f6c  ty).        bool
-0002da80: 5f6d 6173 6b20 3d20 6375 7272 656e 745f  _mask = current_
-0002da90: 7374 6172 745f 6d61 736b 2e63 6f70 7928  start_mask.copy(
-0002daa0: 290a 2020 2020 2020 2020 626f 6f6c 5f6d  ).        bool_m
-0002dab0: 6173 6b5b 6375 7272 656e 745f 7374 6172  ask[current_star
-0002dac0: 745f 6d61 736b 5d20 3d20 6f76 6572 6c61  t_mask] = overla
-0002dad0: 7070 696e 670a 2020 2020 2020 2020 6368  pping.        ch
-0002dae0: 756e 6b20 3d20 6466 5b62 6f6f 6c5f 6d61  unk = df[bool_ma
-0002daf0: 736b 5d2e 636f 7079 2829 0a20 2020 2020  sk].copy().     
-0002db00: 2020 2069 6620 7472 756e 6361 7465 3a0a     if truncate:.
-0002db10: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0002db20: 6c65 6674 732c 206e 6577 5f72 6967 6874  lefts, new_right
-0002db30: 7320 3d20 6c65 6674 735b 6f76 6572 6c61  s = lefts[overla
-0002db40: 7070 696e 675d 2c20 7269 6768 7473 5b6f  pping], rights[o
-0002db50: 7665 726c 6170 7069 6e67 5d0a 2020 2020  verlapping].    
-0002db60: 2020 2020 2020 2020 7374 6172 7469 6e67          starting
-0002db70: 5f62 6566 6f72 655f 6c2c 2065 6e64 696e  _before_l, endin
-0002db80: 675f 6166 7465 725f 7220 3d20 286e 6577  g_after_r = (new
-0002db90: 5f6c 6566 7473 203c 206c 292c 2028 6e65  _lefts < l), (ne
-0002dba0: 775f 7269 6768 7473 203e 2072 290a 2020  w_rights > r).  
-0002dbb0: 2020 2020 2020 2020 2020 6966 2073 7461            if sta
-0002dbc0: 7274 696e 675f 6265 666f 7265 5f6c 2e73  rting_before_l.s
-0002dbd0: 756d 2829 203e 2030 206f 7220 656e 6469  um() > 0 or endi
-0002dbe0: 6e67 5f61 6674 6572 5f72 2e73 756d 2829  ng_after_r.sum()
-0002dbf0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0002dc00: 2020 2020 2020 6e65 775f 6c65 6674 735b        new_lefts[
-0002dc10: 7374 6172 7469 6e67 5f62 6566 6f72 655f  starting_before_
-0002dc20: 6c5d 203d 206c 0a20 2020 2020 2020 2020  l] = l.         
-0002dc30: 2020 2020 2020 206e 6577 5f72 6967 6874         new_right
-0002dc40: 735b 656e 6469 6e67 5f61 6674 6572 5f72  s[ending_after_r
-0002dc50: 5d20 3d20 720a 2020 2020 2020 2020 2020  ] = r.          
-0002dc60: 2020 2020 2020 6368 756e 6b2e 696e 6465        chunk.inde
-0002dc70: 7820 3d20 7064 2e49 6e74 6572 7661 6c49  x = pd.IntervalI
-0002dc80: 6e64 6578 2e66 726f 6d5f 6172 7261 7973  ndex.from_arrays
-0002dc90: 286e 6577 5f6c 6566 7473 2c20 6e65 775f  (new_lefts, new_
-0002dca0: 7269 6768 7473 2c20 636c 6f73 6564 3d27  rights, closed='
-0002dcb0: 6c65 6674 2729 0a20 2020 2020 2020 2020  left').         
-0002dcc0: 2020 2020 2020 2063 6875 6e6b 2e64 7572         chunk.dur
-0002dcd0: 6174 696f 6e5f 7162 203d 2028 6e65 775f  ation_qb = (new_
-0002dce0: 7269 6768 7473 202d 206e 6577 5f6c 6566  rights - new_lef
-0002dcf0: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-0002dd00: 2020 2020 6368 756e 6b2e 7175 6172 7465      chunk.quarte
-0002dd10: 7262 6561 7473 203d 206e 6577 5f6c 6566  rbeats = new_lef
-0002dd20: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
-0002dd30: 2020 2063 6875 6e6b 2e73 6f72 745f 7661     chunk.sort_va
-0002dd40: 6c75 6573 285b 2771 7561 7274 6572 6265  lues(['quarterbe
-0002dd50: 6174 7327 2c20 2764 7572 6174 696f 6e5f  ats', 'duration_
-0002dd60: 7162 275d 2c20 696e 706c 6163 653d 5472  qb'], inplace=Tr
-0002dd70: 7565 290a 2020 2020 2020 2020 6368 756e  ue).        chun
-0002dd80: 6b73 5b69 765d 203d 2063 6875 6e6b 0a20  ks[iv] = chunk. 
-0002dd90: 2020 2072 6574 7572 6e20 6368 756e 6b73     return chunks
-0002dda0: 0a0a 0a64 6566 2069 6e66 6572 5f74 7376  ...def infer_tsv
-0002ddb0: 5f74 7970 6528 6466 3a20 7064 2e44 6174  _type(df: pd.Dat
-0002ddc0: 6146 7261 6d65 2920 2d3e 204f 7074 696f  aFrame) -> Optio
-0002ddd0: 6e61 6c5b 7374 725d 3a0a 2020 2020 2222  nal[str]:.    ""
-0002dde0: 2249 6e66 6572 7320 7468 6520 636f 6e74  "Infers the cont
-0002ddf0: 656e 7473 206f 6620 6120 4461 7461 4672  ents of a DataFr
-0002de00: 616d 6520 6672 6f6d 2074 6865 2070 7265  ame from the pre
-0002de10: 7365 6e63 6520 6f66 2070 6172 7469 6375  sence of particu
-0002de20: 6c61 7220 636f 6c75 6d6e 732e 2222 220a  lar columns.""".
-0002de30: 2020 2020 7479 7065 3263 6f6c 7320 3d20      type2cols = 
-0002de40: 7b0a 2020 2020 2020 2020 276e 6f74 6573  {.        'notes
-0002de50: 273a 205b 2774 7063 272c 2027 6d69 6469  ': ['tpc', 'midi
-0002de60: 275d 2c0a 2020 2020 2020 2020 2765 7665  '],.        'eve
-0002de70: 6e74 7327 3a20 5b27 4368 6f72 642f 6475  nts': ['Chord/du
-0002de80: 7261 7469 6f6e 5479 7065 272c 2027 5265  rationType', 'Re
-0002de90: 7374 2f64 7572 6174 696f 6e54 7970 6527  st/durationType'
-0002dea0: 5d2c 0a20 2020 2020 2020 2027 6368 6f72  ],.        'chor
-0002deb0: 6473 273a 205b 2763 686f 7264 5f69 6427  ds': ['chord_id'
-0002dec0: 5d2c 0a20 2020 2020 2020 2027 7265 7374  ],.        'rest
-0002ded0: 7327 3a20 5b27 6e6f 6d69 6e61 6c5f 6475  s': ['nominal_du
-0002dee0: 7261 7469 6f6e 275d 2c0a 2020 2020 2020  ration'],.      
-0002def0: 2020 2765 7870 616e 6465 6427 3a20 5b27    'expanded': ['
-0002df00: 6e75 6d65 7261 6c27 5d2c 0a20 2020 2020  numeral'],.     
-0002df10: 2020 2027 6c61 6265 6c73 273a 205b 2768     'labels': ['h
-0002df20: 6172 6d6f 6e79 5f6c 6179 6572 272c 2027  armony_layer', '
-0002df30: 6c61 6265 6c27 2c20 276c 6162 656c 5f74  label', 'label_t
-0002df40: 7970 6527 5d2c 0a20 2020 2020 2020 2027  ype'],.        '
-0002df50: 6d65 6173 7572 6573 273a 205b 2761 6374  measures': ['act
-0002df60: 5f64 7572 275d 2c0a 2020 2020 2020 2020  _dur'],.        
-0002df70: 2763 6164 656e 6365 7327 3a20 5b27 6361  'cadences': ['ca
-0002df80: 6465 6e63 6527 5d2c 0a20 2020 2020 2020  dence'],.       
-0002df90: 2027 6d65 7461 6461 7461 273a 205b 2766   'metadata': ['f
-0002dfa0: 6e61 6d65 275d 2c0a 2020 2020 2020 2020  name'],.        
-0002dfb0: 2766 6f72 6d5f 6c61 6265 6c73 273a 205b  'form_labels': [
-0002dfc0: 2766 6f72 6d5f 6c61 6265 6c27 2c20 2761  'form_label', 'a
-0002dfd0: 275d 2c0a 2020 2020 7d0a 2020 2020 666f  '],.    }.    fo
-0002dfe0: 7220 742c 2063 6f6c 756d 6e73 2069 6e20  r t, columns in 
-0002dff0: 7479 7065 3263 6f6c 732e 6974 656d 7328  type2cols.items(
-0002e000: 293a 0a20 2020 2020 2020 2069 6620 616e  ):.        if an
-0002e010: 7928 6320 696e 2064 662e 636f 6c75 6d6e  y(c in df.column
-0002e020: 7320 666f 7220 6320 696e 2063 6f6c 756d  s for c in colum
-0002e030: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
-0002e040: 2072 6574 7572 6e20 740a 2020 2020 6966   return t.    if
-0002e050: 2061 6e79 2863 2069 6e20 6466 2e63 6f6c   any(c in df.col
-0002e060: 756d 6e73 2066 6f72 2063 2069 6e20 5b27  umns for c in ['
-0002e070: 6d63 272c 2027 6d6e 275d 293a 0a20 2020  mc', 'mn']):.   
-0002e080: 2020 2020 2072 6574 7572 6e20 276c 6162       return 'lab
-0002e090: 656c 7327 0a20 2020 2072 6574 7572 6e20  els'.    return 
-0002e0a0: 2775 6e6b 6e6f 776e 270a 0a0a 6465 6620  'unknown'...def 
-0002e0b0: 7265 6475 6365 5f64 6174 6166 7261 6d65  reduce_dataframe
-0002e0c0: 5f64 7572 6174 696f 6e5f 746f 5f66 6972  _duration_to_fir
-0002e0d0: 7374 5f72 6f77 2864 663a 2070 642e 4461  st_row(df: pd.Da
-0002e0e0: 7461 4672 616d 6529 202d 3e20 7064 2e44  taFrame) -> pd.D
-0002e0f0: 6174 6146 7261 6d65 3a0a 2020 2020 2222  ataFrame:.    ""
-0002e100: 2220 5265 6475 6365 7320 6120 4461 7461  " Reduces a Data
-0002e110: 4672 616d 6520 746f 2069 7473 2072 6f77  Frame to its row
-0002e120: 2061 6e64 2075 7064 6174 6573 2074 6865   and updates the
-0002e130: 2064 7572 6174 696f 6e5f 7162 2063 6f6c   duration_qb col
-0002e140: 756d 6e20 746f 2072 6566 6c65 6374 2074  umn to reflect t
-0002e150: 6865 2072 6564 7563 6564 2064 7572 6174  he reduced durat
-0002e160: 696f 6e2e 0a0a 2020 2020 4172 6773 3a0a  ion...    Args:.
-0002e170: 2020 2020 2020 6466 3a20 4461 7461 6672        df: Datafr
-0002e180: 616d 6520 6f66 2077 6869 6368 2074 6f20  ame of which to 
-0002e190: 6b65 6570 206f 6e6c 7920 7468 6520 6669  keep only the fi
-0002e1a0: 7273 7420 726f 772e 2049 6620 6974 2068  rst row. If it h
-0002e1b0: 6173 2061 6e20 496e 7465 7276 616c 496e  as an IntervalIn
-0002e1c0: 6465 782c 2074 6865 2069 6e74 6572 7661  dex, the interva
-0002e1d0: 6c20 6973 2075 7064 6174 6564 2074 6f0a  l is updated to.
-0002e1e0: 2020 2020 2020 2020 2020 7265 666c 6563            reflec
-0002e1f0: 7420 7468 6520 7768 6f6c 6520 6475 7261  t the whole dura
-0002e200: 7469 6f6e 2e0a 0a20 2020 2052 6574 7572  tion...    Retur
-0002e210: 6e73 3a0a 2020 2020 2020 4461 7461 4672  ns:.      DataFr
-0002e220: 616d 6520 7769 7468 206f 6e65 2072 6f77  ame with one row
-0002e230: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
-0002e240: 206c 656e 2864 6629 203d 3d20 313a 0a20   len(df) == 1:. 
-0002e250: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-0002e260: 0a20 2020 2069 6478 203d 2064 662e 696e  .    idx = df.in
-0002e270: 6465 780a 2020 2020 6669 7273 745f 6c6f  dex.    first_lo
-0002e280: 6320 3d20 6964 785b 305d 0a20 2020 2072  c = idx[0].    r
-0002e290: 6f77 203d 2064 662e 696c 6f63 5b5b 305d  ow = df.iloc[[0]
-0002e2a0: 5d0a 2020 2020 2320 6966 2069 7369 6e73  ].    # if isins
-0002e2b0: 7461 6e63 6528 6978 2c20 7064 2e49 6e74  tance(ix, pd.Int
-0002e2c0: 6572 7661 6c29 206f 7220 2869 7369 6e73  erval) or (isins
-0002e2d0: 7461 6e63 6528 6978 2c20 7475 706c 6529  tance(ix, tuple)
-0002e2e0: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
-0002e2f0: 6978 5b2d 315d 2c20 7064 2e49 6e74 6572  ix[-1], pd.Inter
-0002e300: 7661 6c29 293a 0a20 2020 2069 6620 6973  val)):.    if is
-0002e310: 696e 7374 616e 6365 2869 6478 2c20 7064  instance(idx, pd
-0002e320: 2e49 6e74 6572 7661 6c49 6e64 6578 293a  .IntervalIndex):
-0002e330: 0a20 2020 2020 2020 2073 7461 7274 203d  .        start =
-0002e340: 206d 696e 2869 6478 2e6c 6566 7429 0a20   min(idx.left). 
-0002e350: 2020 2020 2020 2065 6e64 203d 206d 6178         end = max
-0002e360: 2869 6478 2e72 6967 6874 290a 2020 2020  (idx.right).    
-0002e370: 2020 2020 6976 203d 2070 642e 496e 7465      iv = pd.Inte
-0002e380: 7276 616c 2873 7461 7274 2c20 656e 642c  rval(start, end,
-0002e390: 2063 6c6f 7365 643d 6964 782e 636c 6f73   closed=idx.clos
-0002e3a0: 6564 290a 2020 2020 2020 2020 726f 772e  ed).        row.
-0002e3b0: 696e 6465 7820 3d20 7064 2e49 6e74 6572  index = pd.Inter
-0002e3c0: 7661 6c49 6e64 6578 285b 6976 5d29 0a20  valIndex([iv]). 
-0002e3d0: 2020 2020 2020 2072 6f77 2e6c 6f63 5b69         row.loc[i
-0002e3e0: 762c 2027 6475 7261 7469 6f6e 5f71 6227  v, 'duration_qb'
-0002e3f0: 5d20 3d20 6976 2e6c 656e 6774 680a 2020  ] = iv.length.  
-0002e400: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002e410: 6e65 775f 6475 7261 7469 6f6e 203d 2064  new_duration = d
-0002e420: 662e 6475 7261 7469 6f6e 5f71 622e 7375  f.duration_qb.su
-0002e430: 6d28 290a 2020 2020 2020 2020 726f 772e  m().        row.
-0002e440: 6c6f 635b 6669 7273 745f 6c6f 632c 2027  loc[first_loc, '
-0002e450: 6475 7261 7469 6f6e 5f71 6227 5d20 3d20  duration_qb'] = 
-0002e460: 6e65 775f 6475 7261 7469 6f6e 0a20 2020  new_duration.   
-0002e470: 2072 6574 7572 6e20 726f 770a 0a0a 0a0a   return row.....
-0002e480: 4064 6174 6163 6c61 7373 0a63 6c61 7373  @dataclass.class
-0002e490: 2046 696c 653a 0a20 2020 2022 2222 5374   File:.    """St
-0002e4a0: 6f72 696e 6720 7061 7468 2061 6e64 2066  oring path and f
-0002e4b0: 696c 6520 6e61 6d65 2069 6e66 6f72 6d61  ile name informa
-0002e4c0: 7469 6f6e 2066 6f72 206f 6e65 2066 696c  tion for one fil
-0002e4d0: 652e 2222 220a 2020 2020 6978 3a20 696e  e.""".    ix: in
-0002e4e0: 740a 2020 2020 2222 2249 6e64 6578 2069  t.    """Index i
-0002e4f0: 6e74 6567 6572 2028 4944 2922 2222 0a20  nteger (ID)""". 
-0002e500: 2020 2074 7970 653a 2073 7472 0a20 2020     type: str.   
-0002e510: 2022 2222 5265 636f 676e 697a 6564 2074   """Recognized t
-0002e520: 7970 6520 e288 8820 3a61 7474 723a 606d  ype ... :attr:`m
-0002e530: 7333 2e5f 7479 7069 6e67 2e46 6163 6574  s3._typing.Facet
-0002e540: 6022 2222 0a20 2020 2066 696c 653a 2073  `""".    file: s
-0002e550: 7472 0a20 2020 2022 2222 4669 6c65 206e  tr.    """File n
-0002e560: 616d 6520 696e 636c 7564 696e 6720 6578  ame including ex
-0002e570: 7465 6e73 696f 6e2e 2222 220a 2020 2020  tension.""".    
-0002e580: 666e 616d 653a 2073 7472 0a20 2020 2022  fname: str.    "
-0002e590: 2222 666e 616d 6520 6578 636c 7564 696e  ""fname excludin
-0002e5a0: 6720 7468 6520 7375 6666 6978 2028 6166  g the suffix (af
-0002e5b0: 7465 7220 7265 6769 7374 6572 696e 6720  ter registering 
-0002e5c0: 7468 6520 6669 6c65 2077 6974 6820 6120  the file with a 
-0002e5d0: 3a6f 626a 3a60 5069 6563 6560 292e 2222  :obj:`Piece`).""
-0002e5e0: 220a 2020 2020 6665 7874 3a20 7374 720a  ".    fext: str.
-0002e5f0: 2020 2020 2222 2246 696c 6520 6578 7465      """File exte
-0002e600: 6e73 696f 6e73 2e22 2222 0a20 2020 2073  nsions.""".    s
-0002e610: 7562 6469 723a 2073 7472 0a20 2020 2022  ubdir: str.    "
-0002e620: 2222 4469 7265 6374 6f72 7920 7265 6c61  ""Directory rela
-0002e630: 7469 7665 2074 6f20 7468 6520 636f 7270  tive to the corp
-0002e640: 7573 2070 6174 6820 2865 2e67 2e20 272e  us path (e.g. '.
-0002e650: 2f4d 5333 2729 2e22 2222 0a20 2020 2063  /MS3').""".    c
-0002e660: 6f72 7075 735f 7061 7468 3a20 7374 720a  orpus_path: str.
-0002e670: 2020 2020 2222 2241 6273 6f6c 7574 6520      """Absolute 
-0002e680: 7061 7468 206f 6620 7468 6520 6669 6c65  path of the file
-0002e690: 2773 2070 6172 656e 7420 6469 7265 6374  's parent direct
-0002e6a0: 6f72 7920 7468 6174 2069 7320 636f 6e73  ory that is cons
-0002e6b0: 6964 6572 6564 2061 7320 636f 7270 7573  idered as corpus
-0002e6c0: 2064 6972 6563 746f 7279 2e22 2222 0a20   directory.""". 
-0002e6d0: 2020 2072 656c 5f70 6174 683a 2073 7472     rel_path: str
-0002e6e0: 0a20 2020 2022 2222 4669 6c65 2070 6174  .    """File pat
-0002e6f0: 6820 7265 6c61 7469 7665 2074 6f20 7468  h relative to th
-0002e700: 6520 636f 7270 7573 2070 6174 682e 2045  e corpus path. E
-0002e710: 7175 6976 616c 656e 7420 746f 203c 7375  quivalent to <su
-0002e720: 6264 6972 3e2f 3c66 696c 653e 2e22 2222  bdir>/<file>."""
-0002e730: 0a20 2020 2066 756c 6c5f 7061 7468 3a20  .    full_path: 
-0002e740: 7374 720a 2020 2020 2222 2241 6273 6f6c  str.    """Absol
-0002e750: 7574 6520 6669 6c65 2070 6174 682e 2222  ute file path.""
-0002e760: 220a 2020 2020 6469 7265 6374 6f72 793a  ".    directory:
-0002e770: 2073 7472 0a20 2020 2022 2222 4162 736f   str.    """Abso
-0002e780: 6c75 7465 2066 6f6c 6465 7220 7061 7468  lute folder path
-0002e790: 2077 6865 7265 2074 6865 2066 696c 6520   where the file 
-0002e7a0: 6973 206c 6f63 6174 6564 2e22 2222 0a20  is located.""". 
-0002e7b0: 2020 2073 7566 6669 783a 2073 7472 0a20     suffix: str. 
-0002e7c0: 2020 2022 2222 5570 6f6e 2072 6567 6973     """Upon regis
-0002e7d0: 7465 7269 6e67 2074 6865 2046 696c 6520  tering the File 
-0002e7e0: 7769 7468 2061 203a 6f62 6a3a 6050 6965  with a :obj:`Pie
-0002e7f0: 6365 602c 2069 6620 7468 6520 6375 7272  ce`, if the curr
-0002e800: 656e 7420 666e 616d 6520 6861 7320 6120  ent fname has a 
-0002e810: 7375 6666 6978 2063 6f6d 7061 7265 6420  suffix compared 
-0002e820: 746f 2074 6865 2050 6965 6365 2773 2066  to the Piece's f
-0002e830: 6e61 6d65 2c20 0a20 2020 2073 7566 6669  name, .    suffi
-0002e840: 7820 6973 2072 656d 6f76 6564 2066 726f  x is removed fro
-0002e850: 6d20 7468 6520 4669 6c65 206f 626a 6563  m the File objec
-0002e860: 7427 7320 666e 616d 6520 6669 656c 6420  t's fname field 
-0002e870: 616e 6420 6164 6465 6420 746f 2074 6865  and added to the
-0002e880: 2073 7566 6669 7820 6669 656c 642e 2222   suffix field.""
-0002e890: 220a 2020 2020 636f 6d6d 6974 5f73 6861  ".    commit_sha
-0002e8a0: 3a20 7374 7220 3d20 2727 0a20 2020 2022  : str = ''.    "
-0002e8b0: 2222 5468 6520 7468 6520 6669 6c65 2068  ""The the file h
-0002e8c0: 6173 2062 6565 6e20 7265 7472 6965 7665  as been retrieve
-0002e8d0: 6420 6672 6f6d 2061 2070 6172 7469 6375  d from a particu
-0002e8e0: 6c61 7220 6769 7420 7265 7669 7369 6f6e  lar git revision
-0002e8f0: 2c20 7468 6973 2069 7320 7365 7420 746f  , this is set to
-0002e900: 2074 6865 2072 6576 6973 696f 6e27 7320   the revision's 
-0002e910: 6861 7368 2e22 2222 0a0a 2020 2020 6465  hash."""..    de
-0002e920: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-0002e930: 3a0a 2020 2020 2020 2020 7375 6666 6978  :.        suffix
-0002e940: 203d 2027 2720 6966 2073 656c 662e 7375   = '' if self.su
-0002e950: 6666 6978 203d 3d20 2727 2065 6c73 6520  ffix == '' else 
-0002e960: 6622 2c20 7375 6666 6978 3a20 7b73 656c  f", suffix: {sel
-0002e970: 662e 7375 6666 6978 7d2e 220a 2020 2020  f.suffix}.".    
-0002e980: 2020 2020 636f 6d6d 6974 203d 2027 2720      commit = '' 
-0002e990: 6966 2073 656c 662e 636f 6d6d 6974 5f73  if self.commit_s
-0002e9a0: 6861 203d 3d20 2727 2065 6c73 6520 6622  ha == '' else f"
-0002e9b0: 407b 7365 6c66 2e63 6f6d 6d69 745f 7368  @{self.commit_sh
-0002e9c0: 615b 3a37 5d7d 220a 2020 2020 2020 2020  a[:7]}".        
-0002e9d0: 7265 7475 726e 2066 227b 7365 6c66 2e69  return f"{self.i
-0002e9e0: 787d 3a20 277b 7365 6c66 2e72 656c 5f70  x}: '{self.rel_p
-0002e9f0: 6174 687d 277b 636f 6d6d 6974 7d7b 7375  ath}'{commit}{su
-0002ea00: 6666 6978 7d22 0a0a 4066 756e 6374 696f  ffix}"..@functio
-0002ea10: 6e5f 6c6f 6767 6572 0a64 6566 2061 7574  n_logger.def aut
-0002ea20: 6f6d 6174 6963 616c 6c79 5f63 686f 6f73  omatically_choos
-0002ea30: 655f 6672 6f6d 5f64 6973 616d 6269 6775  e_from_disambigu
-0002ea40: 6174 6564 5f66 696c 6573 2864 6973 616d  ated_files(disam
-0002ea50: 6269 6775 6174 6564 5f63 686f 6963 6573  biguated_choices
-0002ea60: 3a20 4469 6374 5b73 7472 2c20 4669 6c65  : Dict[str, File
-0002ea70: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0002ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ea90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eaa0: 2020 2020 2066 6e61 6d65 3a20 7374 722c       fname: str,
-0002eab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eae0: 2020 2066 696c 655f 7479 7065 3a20 7374     file_type: st
-0002eaf0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0002eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eb20: 2020 2020 2029 202d 3e20 4669 6c65 3a0a       ) -> File:.
-0002eb30: 2020 2020 6966 206c 656e 2864 6973 616d      if len(disam
-0002eb40: 6269 6775 6174 6564 5f63 686f 6963 6573  biguated_choices
-0002eb50: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
-0002eb60: 7265 7475 726e 206c 6973 7428 6469 7361  return list(disa
-0002eb70: 6d62 6967 7561 7465 645f 6368 6f69 6365  mbiguated_choice
-0002eb80: 732e 6b65 7973 2829 295b 305d 0a20 2020  s.keys())[0].   
-0002eb90: 2064 6973 616d 625f 7365 7269 6573 203d   disamb_series =
-0002eba0: 2070 642e 5365 7269 6573 2864 6973 616d   pd.Series(disam
-0002ebb0: 6269 6775 6174 6564 5f63 686f 6963 6573  biguated_choices
-0002ebc0: 290a 2020 2020 6669 6c65 7320 3d20 6c69  ).    files = li
-0002ebd0: 7374 2864 6973 616d 6269 6775 6174 6564  st(disambiguated
-0002ebe0: 5f63 686f 6963 6573 2e76 616c 7565 7328  _choices.values(
-0002ebf0: 2929 0a20 2020 2066 696c 6573 5f64 6620  )).    files_df 
-0002ec00: 3d20 7064 2e44 6174 6146 7261 6d65 2866  = pd.DataFrame(f
-0002ec10: 696c 6573 2c20 696e 6465 783d 6469 7361  iles, index=disa
-0002ec20: 6d62 5f73 6572 6965 732e 696e 6465 7829  mb_series.index)
-0002ec30: 0a20 2020 2063 686f 6963 655f 6265 7477  .    choice_betw
-0002ec40: 6565 6e5f 6e20 3d20 6c65 6e28 6669 6c65  een_n = len(file
-0002ec50: 7329 0a20 2020 2069 6620 6669 6c65 5f74  s).    if file_t
-0002ec60: 7970 6520 3d3d 2027 7363 6f72 6573 273a  ype == 'scores':
-0002ec70: 0a20 2020 2020 2020 2023 2069 6620 6120  .        # if a 
-0002ec80: 7363 6f72 6520 6973 2072 6571 7565 7374  score is request
-0002ec90: 6564 2c20 6368 6563 6b20 6966 2074 6865  ed, check if the
-0002eca0: 7265 2069 7320 6f6e 6c79 2061 2073 696e  re is only a sin
-0002ecb0: 676c 6520 4d53 4358 206f 7220 6f74 6865  gle MSCX or othe
-0002ecc0: 7277 6973 6520 4d53 435a 2066 696c 6520  rwise MSCZ file 
-0002ecd0: 616e 6420 7069 636b 2074 6861 740a 2020  and pick that.  
-0002ece0: 2020 2020 2020 6665 7874 7320 3d20 6669        fexts = fi
-0002ecf0: 6c65 735f 6466 2e66 6578 742e 7374 722e  les_df.fext.str.
-0002ed00: 6c6f 7765 7228 290a 2020 2020 2020 2020  lower().        
-0002ed10: 6665 7874 5f63 6f75 6e74 7320 3d20 6665  fext_counts = fe
-0002ed20: 7874 732e 7661 6c75 655f 636f 756e 7473  xts.value_counts
-0002ed30: 2829 0a20 2020 2020 2020 2069 6620 272e  ().        if '.
-0002ed40: 6d73 6378 2720 696e 2066 6578 745f 636f  mscx' in fext_co
-0002ed50: 756e 7473 3a0a 2020 2020 2020 2020 2020  unts:.          
-0002ed60: 2020 6966 2066 6578 745f 636f 756e 7473    if fext_counts
-0002ed70: 5b27 2e6d 7363 7827 5d20 3d3d 2031 3a0a  ['.mscx'] == 1:.
-0002ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ed90: 7365 6c65 6374 6564 5f66 696c 6520 3d20  selected_file = 
-0002eda0: 6469 7361 6d62 5f73 6572 6965 735b 6665  disamb_series[fe
-0002edb0: 7874 7320 3d3d 2027 2e6d 7363 7827 5d2e  xts == '.mscx'].
-0002edc0: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-0002edd0: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-0002ede0: 6562 7567 2866 2249 6e20 6f72 6465 7220  ebug(f"In order 
-0002edf0: 746f 2070 6963 6b20 6f6e 6520 6672 6f6d  to pick one from
-0002ee00: 2074 6865 207b 6368 6f69 6365 5f62 6574   the {choice_bet
-0002ee10: 7765 656e 5f6e 7d20 7363 6f72 6573 2077  ween_n} scores w
-0002ee20: 6974 6820 666e 616d 6520 277b 666e 616d  ith fname '{fnam
-0002ee30: 657d 272c 2027 7b73 656c 6563 7465 645f  e}', '{selected_
-0002ee40: 6669 6c65 2e72 656c 5f70 6174 687d 2720  file.rel_path}' 
-0002ee50: 7761 7320 7365 6c65 6374 6564 2062 6563  was selected bec
-0002ee60: 6175 7365 2069 7420 6973 2074 6865 206f  ause it is the o
-0002ee70: 6e6c 7920 220a 2020 2020 2020 2020 2020  nly ".          
-0002ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ee90: 2020 2020 2020 2066 226f 6e65 2069 6e20         f"one in 
-0002eea0: 4d53 4358 2066 6f72 6d61 742e 2229 0a20  MSCX format."). 
-0002eeb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0002eec0: 6574 7572 6e20 7365 6c65 6374 6564 5f66  eturn selected_f
-0002eed0: 696c 650a 2020 2020 2020 2020 656c 6966  ile.        elif
-0002eee0: 2027 2e6d 7363 7a27 2069 6e20 6665 7874   '.mscz' in fext
-0002eef0: 5f63 6f75 6e74 7320 616e 6420 6665 7874  _counts and fext
-0002ef00: 5f63 6f75 6e74 735b 272e 6d73 637a 275d  _counts['.mscz']
-0002ef10: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-0002ef20: 2020 2073 656c 6563 7465 645f 6669 6c65     selected_file
-0002ef30: 203d 2064 6973 616d 625f 7365 7269 6573   = disamb_series
-0002ef40: 5b66 6578 7473 203d 3d20 272e 6d73 637a  [fexts == '.mscz
-0002ef50: 275d 2e69 6c6f 635b 305d 0a20 2020 2020  '].iloc[0].     
-0002ef60: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
-0002ef70: 6275 6728 6622 496e 206f 7264 6572 2074  bug(f"In order t
-0002ef80: 6f20 7069 636b 206f 6e65 2066 726f 6d20  o pick one from 
-0002ef90: 7468 6520 7b63 686f 6963 655f 6265 7477  the {choice_betw
-0002efa0: 6565 6e5f 6e7d 2073 636f 7265 7320 7769  een_n} scores wi
-0002efb0: 7468 2066 6e61 6d65 2027 7b66 6e61 6d65  th fname '{fname
-0002efc0: 7d27 2c20 277b 7365 6c65 6374 6564 5f66  }', '{selected_f
-0002efd0: 696c 652e 7265 6c5f 7061 7468 7d27 2077  ile.rel_path}' w
-0002efe0: 6173 2073 656c 6563 7465 6420 6265 6361  as selected beca
-0002eff0: 7573 6520 6974 2069 7320 7468 6520 6f6e  use it is the on
-0002f000: 6c79 2022 0a20 2020 2020 2020 2020 2020  ly ".           
-0002f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f020: 2020 6622 6f6e 6520 696e 204d 5343 5a20    f"one in MSCZ 
-0002f030: 666f 726d 6174 2e22 290a 2020 2020 2020  format.").      
-0002f040: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0002f050: 6563 7465 645f 6669 6c65 0a20 2020 2023  ected_file.    #
-0002f060: 2061 7320 6669 7273 7420 6469 7361 6d62   as first disamb
-0002f070: 6967 7561 7469 6f6e 2063 7269 7465 7269  iguation criteri
-0002f080: 6f6e 2c20 6368 6563 6b20 6966 2074 6865  on, check if the
-0002f090: 2073 686f 7274 6573 7420 6469 7361 6d62   shortest disamb
-0002f0a0: 6967 7561 7469 6f6e 2073 7472 696e 6720  iguation string 
-0002f0b0: 7065 7274 6169 6e73 2074 6f20 3120 6669  pertains to 1 fi
-0002f0c0: 6c65 206f 6e6c 7920 616e 6420 7069 636b  le only and pick
-0002f0d0: 2074 6861 740a 2020 2020 6469 7361 6d62   that.    disamb
-0002f0e0: 5f73 7472 5f6c 656e 6774 6873 203d 2070  _str_lengths = p
-0002f0f0: 642e 5365 7269 6573 2864 6973 616d 625f  d.Series(disamb_
-0002f100: 7365 7269 6573 2e69 6e64 6578 2e6d 6170  series.index.map
-0002f110: 286c 656e 292c 2069 6e64 6578 3d64 6973  (len), index=dis
-0002f120: 616d 625f 7365 7269 6573 2e69 6e64 6578  amb_series.index
-0002f130: 290a 2020 2020 7368 6f72 7465 7374 5f6c  ).    shortest_l
-0002f140: 656e 6774 685f 7365 6c65 6374 6f72 203d  ength_selector =
-0002f150: 2028 6469 7361 6d62 5f73 7472 5f6c 656e   (disamb_str_len
-0002f160: 6774 6873 203d 3d20 6469 7361 6d62 5f73  gths == disamb_s
-0002f170: 7472 5f6c 656e 6774 6873 2e6d 696e 2829  tr_lengths.min()
-0002f180: 290a 2020 2020 6e5f 6861 7665 5f73 686f  ).    n_have_sho
-0002f190: 7274 6573 745f 6c65 6e67 7468 203d 2073  rtest_length = s
-0002f1a0: 686f 7274 6573 745f 6c65 6e67 7468 5f73  hortest_length_s
-0002f1b0: 656c 6563 746f 722e 7375 6d28 290a 2020  elector.sum().  
-0002f1c0: 2020 6966 206e 5f68 6176 655f 7368 6f72    if n_have_shor
-0002f1d0: 7465 7374 5f6c 656e 6774 6820 3d3d 2031  test_length == 1
-0002f1e0: 3a0a 2020 2020 2020 2020 6978 203d 2064  :.        ix = d
-0002f1f0: 6973 616d 625f 7374 725f 6c65 6e67 7468  isamb_str_length
-0002f200: 732e 6964 786d 696e 2829 0a20 2020 2020  s.idxmin().     
-0002f210: 2020 2073 656c 6563 7465 645f 6669 6c65     selected_file
-0002f220: 203d 2064 6973 616d 625f 7365 7269 6573   = disamb_series
-0002f230: 2e6c 6f63 5b69 785d 0a20 2020 2020 2020  .loc[ix].       
-0002f240: 206c 6f67 6765 722e 6465 6275 6728 6622   logger.debug(f"
-0002f250: 496e 206f 7264 6572 2074 6f20 7069 636b  In order to pick
-0002f260: 206f 6e65 2066 726f 6d20 7468 6520 7b63   one from the {c
-0002f270: 686f 6963 655f 6265 7477 6565 6e5f 6e7d  hoice_between_n}
-0002f280: 2027 7b66 696c 655f 7479 7065 7d27 2077   '{file_type}' w
-0002f290: 6974 6820 666e 616d 6520 277b 666e 616d  ith fname '{fnam
-0002f2a0: 657d 272c 2074 6865 206f 6e65 2077 6974  e}', the one wit
-0002f2b0: 6820 7468 6520 7368 6f72 7465 7374 2064  h the shortest d
-0002f2c0: 6973 616d 6269 6775 6174 696e 6720 7374  isambiguating st
-0002f2d0: 7269 6e67 2027 7b69 787d 2720 7761 7320  ring '{ix}' was 
-0002f2e0: 7365 6c65 6374 6564 2e22 290a 2020 2020  selected.").    
-0002f2f0: 2020 2020 7265 7475 726e 2073 656c 6563      return selec
-0002f300: 7465 645f 6669 6c65 0a20 2020 2069 6620  ted_file.    if 
-0002f310: 6669 6c65 5f74 7970 6520 213d 2027 756e  file_type != 'un
-0002f320: 6b6e 6f77 6e27 3a0a 2020 2020 2020 2020  known':.        
-0002f330: 2320 6f74 6865 7277 6973 652c 2063 6865  # otherwise, che
-0002f340: 636b 2069 6620 6f6e 6c79 206f 6e65 2066  ck if only one f
-0002f350: 696c 6520 6973 206c 7969 6e67 2069 6e20  ile is lying in 
-0002f360: 6120 6469 7265 6374 6f72 7920 7769 7468  a directory with
-0002f370: 2064 6566 6175 6c74 206e 616d 650a 2020   default name.  
-0002f380: 2020 2020 2020 7375 6264 6972 7320 3d20        subdirs = 
-0002f390: 6669 6c65 735f 6466 2e73 7562 6469 720a  files_df.subdir.
-0002f3a0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-0002f3b0: 636f 6d70 6f6e 656e 7473 203d 2066 696c  components = fil
-0002f3c0: 655f 7479 7065 3270 6174 685f 636f 6d70  e_type2path_comp
-0002f3d0: 6f6e 656e 745f 6d61 7028 295b 6669 6c65  onent_map()[file
-0002f3e0: 5f74 7970 655d 0a20 2020 2020 2020 2064  _type].        d
-0002f3f0: 6566 6175 6c74 5f63 6f6d 706f 6e65 6e74  efault_component
-0002f400: 735f 7265 6765 7820 3d20 277c 272e 6a6f  s_regex = '|'.jo
-0002f410: 696e 2863 6f6d 702e 7265 706c 6163 6528  in(comp.replace(
-0002f420: 272e 272c 2072 275c 2e27 2920 666f 7220  '.', r'\.') for 
-0002f430: 636f 6d70 2069 6e20 6465 6661 756c 745f  comp in default_
-0002f440: 636f 6d70 6f6e 656e 7473 290a 2020 2020  components).    
-0002f450: 2020 2020 6465 6661 756c 745f 7365 6c65      default_sele
-0002f460: 6374 6f72 203d 2073 7562 6469 7273 2e73  ctor = subdirs.s
-0002f470: 7472 2e63 6f6e 7461 696e 7328 6465 6661  tr.contains(defa
-0002f480: 756c 745f 636f 6d70 6f6e 656e 7473 5f72  ult_components_r
-0002f490: 6567 6578 2c20 7265 6765 783d 5472 7565  egex, regex=True
-0002f4a0: 290a 2020 2020 2020 2020 6966 2064 6566  ).        if def
-0002f4b0: 6175 6c74 5f73 656c 6563 746f 722e 7375  ault_selector.su
-0002f4c0: 6d28 2920 3d3d 2031 3a0a 2020 2020 2020  m() == 1:.      
-0002f4d0: 2020 2020 2020 7375 6264 6972 203d 2073        subdir = s
-0002f4e0: 7562 6469 7273 5b64 6566 6175 6c74 5f73  ubdirs[default_s
-0002f4f0: 656c 6563 746f 725d 2e69 6c6f 635b 305d  elector].iloc[0]
-0002f500: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0002f510: 6563 7465 645f 6669 6c65 203d 2064 6973  ected_file = dis
-0002f520: 616d 625f 7365 7269 6573 5b64 6566 6175  amb_series[defau
-0002f530: 6c74 5f73 656c 6563 746f 725d 2e69 6c6f  lt_selector].ilo
-0002f540: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
-0002f550: 206c 6f67 6765 722e 6465 6275 6728 6622   logger.debug(f"
-0002f560: 496e 206f 7264 6572 2074 6f20 7069 636b  In order to pick
-0002f570: 206f 6e65 2066 726f 6d20 7468 6520 7b63   one from the {c
-0002f580: 686f 6963 655f 6265 7477 6565 6e5f 6e7d  hoice_between_n}
-0002f590: 2027 7b66 696c 655f 7479 7065 7d27 2077   '{file_type}' w
-0002f5a0: 6974 6820 666e 616d 6520 277b 666e 616d  ith fname '{fnam
-0002f5b0: 657d 272c 2074 6865 206f 6e65 2069 6e20  e}', the one in 
-0002f5c0: 7468 6520 6465 6661 756c 7420 7375 6264  the default subd
-0002f5d0: 6972 2027 7b73 7562 6469 727d 2720 7761  ir '{subdir}' wa
-0002f5e0: 7320 7365 6c65 6374 6564 2e22 290a 2020  s selected.").  
-0002f5f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002f600: 2073 656c 6563 7465 645f 6669 6c65 0a20   selected_file. 
-0002f610: 2020 2020 2020 2023 206f 7220 6966 206f         # or if o
-0002f620: 6e6c 7920 6f6e 6520 6669 6c65 2063 6f6e  nly one file con
-0002f630: 7461 696e 7320 6120 6465 6661 756c 7420  tains a default 
-0002f640: 6e61 6d65 2069 6e20 6974 7320 7375 6666  name in its suff
-0002f650: 6978 0a20 2020 2020 2020 2073 7566 6669  ix.        suffi
-0002f660: 7865 7320 3d20 6669 6c65 735f 6466 2e73  xes = files_df.s
-0002f670: 7566 6669 780a 2020 2020 2020 2020 6465  uffix.        de
-0002f680: 6661 756c 745f 7365 6c65 6374 6f72 203d  fault_selector =
-0002f690: 2073 7566 6669 7865 732e 7374 722e 636f   suffixes.str.co
-0002f6a0: 6e74 6169 6e73 2864 6566 6175 6c74 5f63  ntains(default_c
-0002f6b0: 6f6d 706f 6e65 6e74 735f 7265 6765 782c  omponents_regex,
-0002f6c0: 2072 6567 6578 3d54 7275 6529 0a20 2020   regex=True).   
-0002f6d0: 2020 2020 2069 6620 6465 6661 756c 745f       if default_
-0002f6e0: 7365 6c65 6374 6f72 2e73 756d 2829 203d  selector.sum() =
-0002f6f0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0002f700: 2073 7566 6669 7820 3d20 7375 6666 6978   suffix = suffix
-0002f710: 6573 5b64 6566 6175 6c74 5f73 656c 6563  es[default_selec
-0002f720: 746f 725d 2e69 6c6f 635b 305d 0a20 2020  tor].iloc[0].   
-0002f730: 2020 2020 2020 2020 2073 656c 6563 7465           selecte
-0002f740: 645f 6669 6c65 203d 2064 6973 616d 625f  d_file = disamb_
-0002f750: 7365 7269 6573 5b64 6566 6175 6c74 5f73  series[default_s
-0002f760: 656c 6563 746f 725d 2e69 6c6f 635b 305d  elector].iloc[0]
-0002f770: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0002f780: 6765 722e 6465 6275 6728 6622 496e 206f  ger.debug(f"In o
-0002f790: 7264 6572 2074 6f20 7069 636b 206f 6e65  rder to pick one
-0002f7a0: 2066 726f 6d20 7468 6520 7b63 686f 6963   from the {choic
-0002f7b0: 655f 6265 7477 6565 6e5f 6e7d 2027 7b66  e_between_n} '{f
-0002f7c0: 696c 655f 7479 7065 7d27 2077 6974 6820  ile_type}' with 
-0002f7d0: 666e 616d 6520 277b 666e 616d 657d 272c  fname '{fname}',
-0002f7e0: 2074 6865 206f 6e65 2069 6e20 7468 6520   the one in the 
-0002f7f0: 6465 6661 756c 7420 7375 6666 6978 2027  default suffix '
-0002f800: 7b73 7566 6669 787d 2720 7761 7320 7365  {suffix}' was se
-0002f810: 6c65 6374 6564 2e22 290a 2020 2020 2020  lected.").      
-0002f820: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0002f830: 6563 7465 645f 6669 6c65 0a20 2020 2023  ected_file.    #
-0002f840: 2069 6620 6e6f 2066 696c 6520 7761 7320   if no file was 
-0002f850: 7365 6c65 6374 6564 2c20 7472 7920 6167  selected, try ag
-0002f860: 6169 6e20 7769 7468 206f 6e6c 7920 7468  ain with only th
-0002f870: 6f73 6520 6861 7669 6e67 2074 6865 2073  ose having the s
-0002f880: 686f 7274 6573 7420 6469 7361 6d62 6967  hortest disambig
-0002f890: 7561 7469 6f6e 2073 7472 696e 6773 0a20  uation strings. 
-0002f8a0: 2020 2069 6620 7368 6f72 7465 7374 5f6c     if shortest_l
-0002f8b0: 656e 6774 685f 7365 6c65 6374 6f72 2e61  ength_selector.a
-0002f8c0: 6c6c 2829 3a0a 2020 2020 2020 2020 2320  ll():.        # 
-0002f8d0: 6966 2061 6c6c 2064 6973 616d 6269 6775  if all disambigu
-0002f8e0: 6174 696f 6e20 7374 7269 6e67 7320 616c  ation strings al
-0002f8f0: 7265 6164 7920 6861 7665 2074 6865 2073  ready have the s
-0002f900: 686f 7274 6573 7420 6c65 6e67 7468 2c20  hortest length, 
-0002f910: 6173 2061 206c 6173 7420 7265 736f 7274  as a last resort
-0002f920: 0a20 2020 2020 2020 2023 2066 616c 6c20  .        # fall 
-0002f930: 6261 636b 2074 6f20 7468 6520 6c65 7869  back to the lexi
-0002f940: 676f 6772 6170 6869 6361 6c6c 7920 6669  gographically fi
-0002f950: 7273 740a 2020 2020 2020 2020 736f 7274  rst.        sort
-0002f960: 6564 5f64 6973 616d 625f 7365 7269 6573  ed_disamb_series
-0002f970: 203d 2064 6973 616d 625f 7365 7269 6573   = disamb_series
-0002f980: 2e73 6f72 745f 696e 6465 7828 290a 2020  .sort_index().  
-0002f990: 2020 2020 2020 6469 7361 6d62 203d 2073        disamb = s
-0002f9a0: 6f72 7465 645f 6469 7361 6d62 5f73 6572  orted_disamb_ser
-0002f9b0: 6965 732e 696e 6465 785b 305d 0a20 2020  ies.index[0].   
-0002f9c0: 2020 2020 2073 656c 6563 7465 645f 6669       selected_fi
-0002f9d0: 6c65 203d 2073 6f72 7465 645f 6469 7361  le = sorted_disa
-0002f9e0: 6d62 5f73 6572 6965 732e 696c 6f63 5b30  mb_series.iloc[0
-0002f9f0: 5d0a 2020 2020 2020 2020 6c6f 6767 6572  ].        logger
-0002fa00: 2e77 6172 6e69 6e67 2866 2255 6e61 626c  .warning(f"Unabl
-0002fa10: 6520 746f 2061 7574 6f6d 6174 6963 616c  e to automatical
-0002fa20: 6c79 2063 686f 6f73 6520 6672 6f6d 2074  ly choose from t
-0002fa30: 6865 207b 6368 6f69 6365 5f62 6574 7765  he {choice_betwe
-0002fa40: 656e 5f6e 7d20 277b 6669 6c65 5f74 7970  en_n} '{file_typ
-0002fa50: 657d 2720 7769 7468 2066 6e61 6d65 2027  e}' with fname '
-0002fa60: 7b66 6e61 6d65 7d27 2e20 4927 6d20 7069  {fname}'. I'm pi
-0002fa70: 636b 696e 6720 277b 7365 6c65 6374 6564  cking '{selected
-0002fa80: 5f66 696c 652e 7265 6c5f 7061 7468 7d27  _file.rel_path}'
-0002fa90: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0002faa0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0002fab0: 2262 6563 6175 7365 2069 7473 2064 6973  "because its dis
-0002fac0: 616d 6269 6775 6174 696f 6e20 7374 7269  ambiguation stri
-0002fad0: 6e67 2027 7b64 6973 616d 627d 2720 6973  ng '{disamb}' is
-0002fae0: 2074 6865 206c 6578 6963 6f67 7261 7068   the lexicograph
-0002faf0: 6963 616c 6c79 2066 6972 7374 2061 6d6f  ically first amo
-0002fb00: 6e67 207b 736f 7274 6564 5f64 6973 616d  ng {sorted_disam
-0002fb10: 625f 7365 7269 6573 2e69 6e64 6578 2e74  b_series.index.t
-0002fb20: 6f5f 6c69 7374 2829 7d22 290a 2020 2020  o_list()}").    
-0002fb30: 2020 2020 7265 7475 726e 2073 656c 6563      return selec
-0002fb40: 7465 645f 6669 6c65 0a20 2020 206f 6e6c  ted_file.    onl
-0002fb50: 795f 7368 6f72 7465 7374 5f64 6973 616d  y_shortest_disam
-0002fb60: 625f 7374 7220 3d20 6469 7361 6d62 5f73  b_str = disamb_s
-0002fb70: 6572 6965 735b 7368 6f72 7465 7374 5f6c  eries[shortest_l
-0002fb80: 656e 6774 685f 7365 6c65 6374 6f72 5d2e  ength_selector].
-0002fb90: 746f 5f64 6963 7428 290a 2020 2020 6c6f  to_dict().    lo
-0002fba0: 6767 6572 2e69 6e66 6f28 6622 4166 7465  gger.info(f"Afte
-0002fbb0: 7220 7468 6520 6669 7273 7420 756e 7375  r the first unsu
-0002fbc0: 6363 6573 7366 756c 2061 7474 656d 7074  ccessful attempt
-0002fbd0: 2074 6f20 6368 6f6f 7365 2066 726f 6d20   to choose from 
-0002fbe0: 7b63 686f 6963 655f 6265 7477 6565 6e5f  {choice_between_
-0002fbf0: 6e7d 2027 7b66 696c 655f 7479 7065 7d27  n} '{file_type}'
-0002fc00: 2077 6974 6820 666e 616d 6520 277b 666e   with fname '{fn
-0002fc10: 616d 657d 272c 2074 7279 696e 6720 6167  ame}', trying ag
-0002fc20: 6169 6e20 220a 2020 2020 2020 2020 2020  ain ".          
-0002fc30: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0002fc40: 6166 7465 7220 7265 6475 6369 6e67 2074  after reducing t
-0002fc50: 6865 2063 686f 6963 6573 2074 6f20 7468  he choices to th
-0002fc60: 6520 7b73 686f 7274 6573 745f 6c65 6e67  e {shortest_leng
-0002fc70: 7468 5f73 656c 6563 746f 722e 7375 6d28  th_selector.sum(
-0002fc80: 297d 2077 6974 6820 7468 6520 7368 6f72  )} with the shor
-0002fc90: 7465 7374 2064 6973 616d 6269 6775 6174  test disambiguat
-0002fca0: 696f 6e20 7374 7269 6e67 732e 2229 0a20  ion strings."). 
-0002fcb0: 2020 2072 6574 7572 6e20 6175 746f 6d61     return automa
-0002fcc0: 7469 6361 6c6c 795f 6368 6f6f 7365 5f66  tically_choose_f
-0002fcd0: 726f 6d5f 6469 7361 6d62 6967 7561 7465  rom_disambiguate
-0002fce0: 645f 6669 6c65 7328 6f6e 6c79 5f73 686f  d_files(only_sho
-0002fcf0: 7274 6573 745f 6469 7361 6d62 5f73 7472  rtest_disamb_str
-0002fd00: 2c20 666e 616d 652c 2066 696c 655f 7479  , fname, file_ty
-0002fd10: 7065 290a 0a64 6566 2061 736b 5f75 7365  pe)..def ask_use
-0002fd20: 725f 746f 5f63 686f 6f73 6528 7175 6572  r_to_choose(quer
-0002fd30: 793a 2073 7472 2c20 6368 6f69 6365 733a  y: str, choices:
-0002fd40: 2043 6f6c 6c65 6374 696f 6e5b 416e 795d   Collection[Any]
-0002fd50: 2920 2d3e 204f 7074 696f 6e61 6c5b 416e  ) -> Optional[An
-0002fd60: 795d 3a0a 2020 2020 2222 2241 736b 2075  y]:.    """Ask u
-0002fd70: 7365 7220 746f 2069 6e70 7574 2061 6e20  ser to input an 
-0002fd80: 696e 7465 6765 7220 616e 6420 7265 7475  integer and retu
-0002fd90: 726e 2074 6865 206e 7468 2063 686f 6963  rn the nth choic
-0002fda0: 6520 7365 6c65 6374 6564 2062 7920 7468  e selected by th
-0002fdb0: 6520 7573 6572 2e22 2222 0a20 2020 206e  e user.""".    n
-0002fdc0: 5f63 686f 6963 6573 203d 206c 656e 2863  _choices = len(c
-0002fdd0: 686f 6963 6573 290a 2020 2020 7261 6e67  hoices).    rang
-0002fde0: 655f 7374 7220 3d20 6622 312d 7b6e 5f63  e_str = f"1-{n_c
-0002fdf0: 686f 6963 6573 7d22 0a20 2020 2077 6869  hoices}".    whi
-0002fe00: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-0002fe10: 2073 203d 2069 6e70 7574 2871 7565 7279   s = input(query
-0002fe20: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-0002fe30: 2020 2020 2020 2020 2020 2069 6e74 5f69             int_i
-0002fe40: 203d 2069 6e74 2873 290a 2020 2020 2020   = int(s).      
-0002fe50: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-0002fe60: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-0002fe70: 7072 696e 7428 6622 5661 6c75 6520 277b  print(f"Value '{
-0002fe80: 737d 2720 636f 756c 6420 6e6f 7420 6265  s}' could not be
-0002fe90: 2063 6f6e 7665 7274 6564 2074 6f20 616e   converted to an
-0002fea0: 2069 6e74 6567 6572 2e22 290a 2020 2020   integer.").    
-0002feb0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0002fec0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0002fed0: 2830 203c 3d20 696e 745f 6920 3c3d 206e  (0 <= int_i <= n
-0002fee0: 5f63 686f 6963 6573 293a 0a20 2020 2020  _choices):.     
-0002fef0: 2020 2020 2020 2070 7269 6e74 2866 2256         print(f"V
-0002ff00: 616c 7565 2027 7b73 7d27 2069 7320 6e6f  alue '{s}' is no
-0002ff10: 7420 7769 7468 696e 207b 7261 6e67 655f  t within {range_
-0002ff20: 7374 727d 2e22 290a 2020 2020 2020 2020  str}.").        
-0002ff30: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-0002ff40: 2020 2020 2069 6620 696e 745f 6920 3d3d       if int_i ==
-0002ff50: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0002ff60: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
-0002ff70: 2020 2020 7265 7475 726e 2063 686f 6963      return choic
-0002ff80: 6573 5b69 6e74 5f69 202d 2031 5d0a 0a0a  es[int_i - 1]...
-0002ff90: 6465 6620 6173 6b5f 7573 6572 5f74 6f5f  def ask_user_to_
-0002ffa0: 6368 6f6f 7365 5f66 726f 6d5f 6469 7361  choose_from_disa
-0002ffb0: 6d62 6967 7561 7465 645f 6669 6c65 7328  mbiguated_files(
-0002ffc0: 6469 7361 6d62 6967 7561 7465 645f 6368  disambiguated_ch
-0002ffd0: 6f69 6365 733a 2044 6963 745b 7374 722c  oices: Dict[str,
-0002ffe0: 2046 696c 655d 2c0a 2020 2020 2020 2020   File],.        
-0002fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030010: 2020 2020 2020 2020 666e 616d 653a 2073          fname: s
-00030020: 7472 2c0a 2020 2020 2020 2020 2020 2020  tr,.            
-00030030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030050: 2020 2020 6669 6c65 5f74 7970 653a 2073      file_type: s
-00030060: 7472 203d 2027 2729 202d 3e20 4f70 7469  tr = '') -> Opti
-00030070: 6f6e 616c 5b46 696c 655d 3a0a 2020 2020  onal[File]:.    
-00030080: 736f 7274 6564 5f6b 6579 7320 3d20 736f  sorted_keys = so
-00030090: 7274 6564 2864 6973 616d 6269 6775 6174  rted(disambiguat
-000300a0: 6564 5f63 686f 6963 6573 2e6b 6579 7328  ed_choices.keys(
-000300b0: 292c 206b 6579 3d6c 616d 6264 6120 733a  ), key=lambda s:
-000300c0: 2028 6c65 6e28 7329 2c20 7329 290a 2020   (len(s), s)).  
-000300d0: 2020 6469 7361 6d62 6967 7561 7465 645f    disambiguated_
-000300e0: 6368 6f69 6365 7320 3d20 7b6b 3a20 6469  choices = {k: di
-000300f0: 7361 6d62 6967 7561 7465 645f 6368 6f69  sambiguated_choi
-00030100: 6365 735b 6b5d 2066 6f72 206b 2069 6e20  ces[k] for k in 
-00030110: 736f 7274 6564 5f6b 6579 737d 0a20 2020  sorted_keys}.   
-00030120: 2066 696c 655f 6c69 7374 203d 206c 6973   file_list = lis
-00030130: 7428 6469 7361 6d62 6967 7561 7465 645f  t(disambiguated_
-00030140: 6368 6f69 6365 732e 7661 6c75 6573 2829  choices.values()
-00030150: 290a 2020 2020 6469 7361 6d62 5f73 7472  ).    disamb_str
-00030160: 696e 6773 203d 2070 642e 5365 7269 6573  ings = pd.Series
-00030170: 2864 6973 616d 6269 6775 6174 6564 5f63  (disambiguated_c
-00030180: 686f 6963 6573 2e6b 6579 7328 292c 206e  hoices.keys(), n
-00030190: 616d 653d 2764 6973 616d 6269 6775 6174  ame='disambiguat
-000301a0: 696f 6e5f 7374 7227 290a 2020 2020 6368  ion_str').    ch
-000301b0: 6f69 6365 735f 6466 203d 2070 642e 636f  oices_df = pd.co
-000301c0: 6e63 6174 285b 6469 7361 6d62 5f73 7472  ncat([disamb_str
-000301d0: 696e 6773 2c0a 2020 2020 2020 2020 2020  ings,.          
-000301e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000301f0: 2020 7064 2e44 6174 6146 7261 6d65 2866    pd.DataFrame(f
-00030200: 696c 655f 6c69 7374 295b 5b27 7265 6c5f  ile_list)[['rel_
-00030210: 7061 7468 272c 2027 7479 7065 272c 2027  path', 'type', '
-00030220: 6978 275d 5d5d 2c0a 2020 2020 2020 2020  ix']]],.        
-00030230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030240: 2020 2061 7869 733d 3129 0a20 2020 2063     axis=1).    c
-00030250: 686f 6963 6573 5f64 662e 696e 6465 7820  hoices_df.index 
-00030260: 3d20 7064 2e49 6e64 6578 2872 616e 6765  = pd.Index(range
-00030270: 2831 2c20 6c65 6e28 6669 6c65 5f6c 6973  (1, len(file_lis
-00030280: 7429 202b 2031 292c 206e 616d 653d 2773  t) + 1), name='s
-00030290: 656c 6563 743a 2729 0a20 2020 2072 616e  elect:').    ran
-000302a0: 6765 5f73 7472 203d 2066 2231 2d7b 6c65  ge_str = f"1-{le
-000302b0: 6e28 6469 7361 6d62 6967 7561 7465 645f  n(disambiguated_
-000302c0: 6368 6f69 6365 7329 7d22 0a20 2020 2071  choices)}".    q
-000302d0: 7565 7279 203d 2066 2253 656c 6563 7469  uery = f"Selecti
-000302e0: 6f6e 205b 7b72 616e 6765 5f73 7472 7d5d  on [{range_str}]
-000302f0: 3a20 220a 2020 2020 7072 696e 7428 6622  : ".    print(f"
-00030300: 5365 7665 7261 6c20 277b 6669 6c65 5f74  Several '{file_t
-00030310: 7970 657d 2720 6176 6169 6c61 626c 6520  ype}' available 
-00030320: 666f 7220 277b 666e 616d 657d 273a 5c6e  for '{fname}':\n
-00030330: 7b63 686f 6963 6573 5f64 662e 746f 5f73  {choices_df.to_s
-00030340: 7472 696e 6728 297d 2229 0a20 2020 2070  tring()}").    p
-00030350: 7269 6e74 2866 2250 6c65 6173 6520 7365  rint(f"Please se
-00030360: 6c65 6374 206f 6e65 206f 6620 7468 6520  lect one of the 
-00030370: 6669 6c65 7320 6279 2070 6173 7369 6e67  files by passing
-00030380: 2061 6e20 696e 7465 6765 7220 6265 7477   an integer betw
-00030390: 6565 6e20 7b72 616e 6765 5f73 7472 7d20  een {range_str} 
-000303a0: 286f 7220 3020 666f 7220 6e6f 6e65 293a  (or 0 for none):
-000303b0: 2229 0a20 2020 2072 6574 7572 6e20 6173  ").    return as
-000303c0: 6b5f 7573 6572 5f74 6f5f 6368 6f6f 7365  k_user_to_choose
-000303d0: 2871 7565 7279 2c20 6669 6c65 5f6c 6973  (query, file_lis
-000303e0: 7429 0a0a 0a40 6675 6e63 7469 6f6e 5f6c  t)...@function_l
-000303f0: 6f67 6765 720a 6465 6620 6469 7361 6d62  ogger.def disamb
-00030400: 6967 7561 7465 5f66 696c 6573 2866 696c  iguate_files(fil
-00030410: 6573 3a20 436f 6c6c 6563 7469 6f6e 5b46  es: Collection[F
-00030420: 696c 655d 2c20 666e 616d 653a 2073 7472  ile], fname: str
-00030430: 2c20 6669 6c65 5f74 7970 653a 2073 7472  , file_type: str
-00030440: 2c20 6368 6f6f 7365 3a20 4c69 7465 7261  , choose: Litera
-00030450: 6c5b 2761 7574 6f27 2c20 2761 736b 275d  l['auto', 'ask']
-00030460: 203d 2027 6175 746f 2729 202d 3e20 4f70   = 'auto') -> Op
-00030470: 7469 6f6e 616c 5b46 696c 655d 3a0a 2020  tional[File]:.  
-00030480: 2020 2222 2252 6563 6569 7665 7320 6120    """Receives a 
-00030490: 636f 6c6c 6563 7469 6f6e 206f 6620 3a6f  collection of :o
-000304a0: 626a 3a60 4669 6c65 6020 7769 7468 2074  bj:`File` with t
-000304b0: 6865 2061 696d 2074 6f20 7069 636b 206f  he aim to pick o
-000304c0: 6e65 206f 6620 7468 656d 2e0a 2020 2020  ne of them..    
-000304d0: 4669 7273 742c 2061 2064 6963 7469 6f6e  First, a diction
-000304e0: 6172 7920 6973 2063 7265 6174 6564 2077  ary is created w
-000304f0: 6865 7265 2074 6865 206b 6579 7320 6172  here the keys ar
-00030500: 6520 6469 7361 6d62 6967 7561 7469 6f6e  e disambiguation
-00030510: 2073 7472 696e 6773 2062 6173 6564 206f   strings based o
-00030520: 6e20 7468 6520 6669 6c65 7327 2070 6174  n the files' pat
-00030530: 6873 2061 6e64 0a20 2020 2073 7566 6669  hs and.    suffi
-00030540: 7865 732e 0a0a 2020 2020 4172 6773 3a0a  xes...    Args:.
-00030550: 2020 2020 2020 6669 6c65 733a 0a20 2020        files:.   
-00030560: 2020 2063 686f 6f73 653a 2049 6620 2761     choose: If 'a
-00030570: 7574 6f27 2028 6465 6661 756c 7429 2c20  uto' (default), 
-00030580: 7468 6520 6669 6c65 2077 6974 6820 7468  the file with th
-00030590: 6520 7368 6f72 7465 7374 2064 6973 616d  e shortest disam
-000305a0: 6269 6775 6174 696f 6e20 7374 7269 6e67  biguation string
-000305b0: 2069 7320 6368 6f73 656e 2e20 5365 7420   is chosen. Set 
-000305c0: 746f 2054 7275 650a 2020 2020 2020 2020  to True.        
-000305d0: 2020 6966 2079 6f75 2077 616e 7420 746f    if you want to
-000305e0: 2062 6520 6173 6b65 6420 746f 206d 616e   be asked to man
-000305f0: 7561 6c6c 7920 6368 6f6f 7365 2061 2066  ually choose a f
-00030600: 696c 652e 0a0a 2020 2020 5265 7475 726e  ile...    Return
-00030610: 733a 0a20 2020 2020 2054 6865 2073 656c  s:.      The sel
-00030620: 6563 7465 6420 6669 6c65 2e0a 2020 2020  ected file..    
-00030630: 2222 220a 2020 2020 6e5f 6669 6c65 7320  """.    n_files 
-00030640: 3d20 6c65 6e28 6669 6c65 7329 0a20 2020  = len(files).   
-00030650: 2069 6620 6e5f 6669 6c65 7320 3d3d 2030   if n_files == 0
-00030660: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00030670: 0a20 2020 2066 696c 6573 203d 2074 7570  .    files = tup
-00030680: 6c65 2866 696c 6573 290a 2020 2020 6966  le(files).    if
-00030690: 206e 5f66 696c 6573 203d 3d20 313a 0a20   n_files == 1:. 
-000306a0: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-000306b0: 6c65 735b 305d 0a20 2020 2069 6620 6368  les[0].    if ch
-000306c0: 6f6f 7365 206e 6f74 2069 6e20 2827 6175  oose not in ('au
-000306d0: 746f 272c 2027 6173 6b27 293a 0a20 2020  to', 'ask'):.   
-000306e0: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-000306f0: 2866 2254 6865 2076 616c 7565 2066 6f72  (f"The value for
-00030700: 2063 686f 6f73 6520 6e65 6564 7320 746f   choose needs to
-00030710: 2062 6520 2761 7574 6f27 206f 7220 2761   be 'auto' or 'a
-00030720: 736b 272c 206e 6f74 207b 6368 6f6f 7365  sk', not {choose
-00030730: 7d2e 2053 6574 7469 6e67 2074 6f20 2761  }. Setting to 'a
-00030740: 7574 6f27 2e22 290a 2020 2020 2020 2020  uto'.").        
-00030750: 6368 6f6f 7365 203d 2027 6175 746f 270a  choose = 'auto'.
-00030760: 2020 2020 6469 7361 6d62 6967 7561 7469      disambiguati
-00030770: 6f6e 5f64 6963 7420 3d20 6669 6c65 7332  on_dict = files2
-00030780: 6469 7361 6d62 6967 7561 7469 6f6e 5f64  disambiguation_d
-00030790: 6963 7428 6669 6c65 732c 206c 6f67 6765  ict(files, logge
-000307a0: 723d 6c6f 6767 6572 290a 2020 2020 6966  r=logger).    if
-000307b0: 2063 686f 6f73 6520 3d3d 2027 6173 6b27   choose == 'ask'
-000307c0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000307d0: 2061 736b 5f75 7365 725f 746f 5f63 686f   ask_user_to_cho
-000307e0: 6f73 655f 6672 6f6d 5f64 6973 616d 6269  ose_from_disambi
-000307f0: 6775 6174 6564 5f66 696c 6573 2864 6973  guated_files(dis
-00030800: 616d 6269 6775 6174 696f 6e5f 6469 6374  ambiguation_dict
-00030810: 2c20 666e 616d 652c 2066 696c 655f 7479  , fname, file_ty
-00030820: 7065 290a 2020 2020 7265 7475 726e 2061  pe).    return a
-00030830: 7574 6f6d 6174 6963 616c 6c79 5f63 686f  utomatically_cho
-00030840: 6f73 655f 6672 6f6d 5f64 6973 616d 6269  ose_from_disambi
-00030850: 6775 6174 6564 5f66 696c 6573 2864 6973  guated_files(dis
-00030860: 616d 6269 6775 6174 696f 6e5f 6469 6374  ambiguation_dict
-00030870: 2c20 666e 616d 652c 2066 696c 655f 7479  , fname, file_ty
-00030880: 7065 2c20 6c6f 6767 6572 3d6c 6f67 6765  pe, logger=logge
-00030890: 7229 0a0a 2320 4066 756e 6374 696f 6e5f  r)..# @function_
-000308a0: 6c6f 6767 6572 0a23 2064 6566 2064 6973  logger.# def dis
-000308b0: 616d 6269 6775 6174 655f 7061 7273 6564  ambiguate_parsed
-000308c0: 5f66 696c 6573 2874 7570 6c65 735f 7769  _files(tuples_wi
-000308d0: 7468 5f66 696c 655f 6173 5f66 6972 7374  th_file_as_first
-000308e0: 5f65 6c65 6d65 6e74 3a20 436f 6c6c 6563  _element: Collec
-000308f0: 7469 6f6e 5b54 7570 6c65 5d2c 2066 6e61  tion[Tuple], fna
-00030900: 6d65 3a20 7374 722c 2066 696c 655f 7479  me: str, file_ty
-00030910: 7065 3a20 7374 722c 2063 686f 6f73 653a  pe: str, choose:
-00030920: 204c 6974 6572 616c 5b27 6175 746f 272c   Literal['auto',
-00030930: 2027 6173 6b27 5d20 3d20 2761 7574 6f27   'ask'] = 'auto'
-00030940: 2920 2d3e 204f 7074 696f 6e61 6c5b 4669  ) -> Optional[Fi
-00030950: 6c65 5d3a 0a23 2020 2020 2066 696c 6573  le]:.#     files
-00030960: 203d 205b 7475 705b 305d 2066 6f72 2074   = [tup[0] for t
-00030970: 7570 2069 6e20 7475 706c 6573 5f77 6974  up in tuples_wit
-00030980: 685f 6669 6c65 5f61 735f 6669 7273 745f  h_file_as_first_
-00030990: 656c 656d 656e 745d 0a23 2020 2020 2073  element].#     s
-000309a0: 656c 6563 7465 6420 3d20 6469 7361 6d62  elected = disamb
-000309b0: 6967 7561 7465 5f66 696c 6573 2866 696c  iguate_files(fil
-000309c0: 6573 2c20 666e 616d 653d 666e 616d 652c  es, fname=fname,
-000309d0: 2066 696c 655f 7479 7065 3d66 696c 655f   file_type=file_
-000309e0: 7479 7065 2c20 6368 6f6f 7365 3d63 686f  type, choose=cho
-000309f0: 6f73 652c 206c 6f67 6765 723d 6c6f 6767  ose, logger=logg
-00030a00: 6572 290a 2320 2020 2020 6966 2073 656c  er).#     if sel
-00030a10: 6563 7465 6420 6973 204e 6f6e 653a 0a23  ected is None:.#
-00030a20: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00030a30: 2320 2020 2020 666f 7220 7475 7020 696e  #     for tup in
-00030a40: 2074 7570 6c65 735f 7769 7468 5f66 696c   tuples_with_fil
-00030a50: 655f 6173 5f66 6972 7374 5f65 6c65 6d65  e_as_first_eleme
-00030a60: 6e74 3a0a 2320 2020 2020 2020 2020 6966  nt:.#         if
-00030a70: 2074 7570 5b30 5d20 3d3d 2073 656c 6563   tup[0] == selec
-00030a80: 7465 643a 0a23 2020 2020 2020 2020 2020  ted:.#          
-00030a90: 2020 2072 6574 7572 6e20 7475 700a 0a0a     return tup...
-00030aa0: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
-00030ab0: 0a64 6566 2066 696c 6573 3264 6973 616d  .def files2disam
-00030ac0: 6269 6775 6174 696f 6e5f 6469 6374 2866  biguation_dict(f
-00030ad0: 696c 6573 3a20 436f 6c6c 6563 7469 6f6e  iles: Collection
-00030ae0: 5b46 696c 655d 2c20 696e 636c 7564 655f  [File], include_
-00030af0: 6469 7361 6d62 6967 7561 746f 723a 2062  disambiguator: b
-00030b00: 6f6f 6c20 3d20 4661 6c73 6529 202d 3e20  ool = False) -> 
-00030b10: 4669 6c65 4469 6374 3a0a 2020 2020 2222  FileDict:.    ""
-00030b20: 2254 616b 6573 2061 206c 6973 7420 6f66  "Takes a list of
-00030b30: 203a 636c 6173 733a 6046 696c 6560 2072   :class:`File` r
-00030b40: 6574 7572 6e73 2061 2064 6963 7469 6f6e  eturns a diction
-00030b50: 6172 7920 7769 7468 2064 6973 616d 6269  ary with disambi
-00030b60: 6775 6174 696e 6720 7374 7269 6e67 7320  guating strings 
-00030b70: 6261 7365 6420 6f6e 2070 6174 6820 636f  based on path co
-00030b80: 6d70 6f6e 656e 7473 2e0a 2020 2020 6f66  mponents..    of
-00030b90: 2064 6973 7469 6e63 7420 7374 7269 6e67   distinct string
-00030ba0: 7320 746f 2064 6973 7469 6e67 7569 7368  s to distinguish
-00030bb0: 2066 696c 6573 2070 6572 7461 696e 696e   files pertainin
-00030bc0: 6720 746f 2074 6865 2073 616d 6520 7479  g to the same ty
-00030bd0: 7065 2e22 2222 0a20 2020 206e 5f66 696c  pe.""".    n_fil
-00030be0: 6573 203d 206c 656e 2866 696c 6573 290a  es = len(files).
-00030bf0: 2020 2020 6966 206e 5f66 696c 6573 203d      if n_files =
-00030c00: 3d20 303a 0a20 2020 2020 2020 2072 6574  = 0:.        ret
-00030c10: 7572 6e20 7b7d 0a20 2020 2066 696c 6573  urn {}.    files
-00030c20: 203d 2074 7570 6c65 2866 696c 6573 290a   = tuple(files).
-00030c30: 2020 2020 6966 206e 5f66 696c 6573 3d3d      if n_files==
-00030c40: 2031 3a0a 2020 2020 2020 2020 6620 3d20   1:.        f = 
-00030c50: 6669 6c65 735b 305d 0a20 2020 2020 2020  files[0].       
-00030c60: 2072 6574 7572 6e20 7b66 2e74 7970 653a   return {f.type:
-00030c70: 2066 7d0a 2020 2020 6469 7361 6d62 6967   f}.    disambig
-00030c80: 7561 7469 6f6e 203d 205b 662e 7479 7065  uation = [f.type
-00030c90: 2066 6f72 2066 2069 6e20 6669 6c65 735d   for f in files]
-00030ca0: 0a20 2020 2069 6620 6c65 6e28 7365 7428  .    if len(set(
-00030cb0: 6469 7361 6d62 6967 7561 7469 6f6e 2929  disambiguation))
-00030cc0: 203d 3d20 6e5f 6669 6c65 733a 0a20 2020   == n_files:.   
-00030cd0: 2020 2020 2023 2064 6f6e 6520 6469 7361       # done disa
-00030ce0: 6d62 6967 7561 7469 6e67 0a20 2020 2020  mbiguating.     
-00030cf0: 2020 2072 6574 7572 6e20 6469 6374 287a     return dict(z
-00030d00: 6970 2864 6973 616d 6269 6775 6174 696f  ip(disambiguatio
-00030d10: 6e2c 2066 696c 6573 2929 0a20 2020 2069  n, files)).    i
-00030d20: 6620 696e 636c 7564 655f 6469 7361 6d62  f include_disamb
-00030d30: 6967 7561 746f 7220 616e 6420 6c65 6e28  iguator and len(
-00030d40: 7365 7428 6469 7361 6d62 6967 7561 7469  set(disambiguati
-00030d50: 6f6e 2929 203e 2031 3a0a 2020 2020 2020  on)) > 1:.      
-00030d60: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
-00030d70: 2866 2249 6e63 6c75 6469 6e67 2074 6865  (f"Including the
-00030d80: 2064 6973 616d 6269 6775 6174 6f72 2072   disambiguator r
-00030d90: 656d 6f76 6573 2074 6865 2066 6163 6574  emoves the facet
-00030da0: 206e 616d 652c 2062 7574 2074 6865 2066   name, but the f
-00030db0: 696c 6573 2070 6572 7461 696e 2074 6f20  iles pertain to 
-00030dc0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00030dd0: 2020 2020 2020 2066 2273 6576 6572 616c         f"several
-00030de0: 2066 6163 6574 733a 207b 7365 7428 6469   facets: {set(di
-00030df0: 7361 6d62 6967 7561 7469 6f6e 297d 2229  sambiguation)}")
-00030e00: 0a20 2020 2023 2066 6972 7374 2c20 7472  .    # first, tr
-00030e10: 7920 746f 2064 6973 616d 6269 6775 6174  y to disambiguat
-00030e20: 6520 6261 7365 6420 6f6e 2074 6865 2066  e based on the f
-00030e30: 696c 6573 2720 7375 622d 6469 7265 6374  iles' sub-direct
-00030e40: 6f72 6965 730a 2020 2020 7375 6264 6972  ories.    subdir
-00030e50: 7320 3d20 5b5d 0a20 2020 2066 6f72 2066  s = [].    for f
-00030e60: 2069 6e20 6669 6c65 733a 0a20 2020 2020   in files:.     
-00030e70: 2020 2066 696c 655f 7479 7065 203d 2066     file_type = f
-00030e80: 2e74 7970 650a 2020 2020 2020 2020 7375  .type.        su
-00030e90: 6264 6972 203d 2066 2e73 7562 6469 722e  bdir = f.subdir.
-00030ea0: 7374 7269 7028 7222 5c2f 2e22 290a 2020  strip(r"\/.").  
-00030eb0: 2020 2020 2020 6966 2073 7562 6469 722e        if subdir.
-00030ec0: 7374 6172 7473 7769 7468 2866 696c 655f  startswith(file_
-00030ed0: 7479 7065 293a 0a20 2020 2020 2020 2020  type):.         
-00030ee0: 2020 2073 7562 6469 7220 3d20 7375 6264     subdir = subd
-00030ef0: 6972 5b6c 656e 2866 696c 655f 7479 7065  ir[len(file_type
-00030f00: 293a 5d0a 2020 2020 2020 2020 6966 2073  ):].        if s
-00030f10: 7562 6469 722e 7374 7269 7028 7222 5c2f  ubdir.strip(r"\/
-00030f20: 2229 203d 3d20 2727 3a0a 2020 2020 2020  ") == '':.      
-00030f30: 2020 2020 2020 7375 6264 6972 203d 2027        subdir = '
-00030f40: 270a 2020 2020 2020 2020 7375 6264 6972  '.        subdir
-00030f50: 732e 6170 7065 6e64 2873 7562 6469 7229  s.append(subdir)
-00030f60: 0a20 2020 2069 6620 6c65 6e28 7365 7428  .    if len(set(
-00030f70: 7375 6264 6972 7329 2920 3e20 313a 0a20  subdirs)) > 1:. 
-00030f80: 2020 2020 2020 2023 2066 696c 6573 2063         # files c
-00030f90: 616e 2028 7061 7274 6961 6c6c 7929 2062  an (partially) b
-00030fa0: 6520 6469 7361 6d62 6967 7561 7465 6420  e disambiguated 
-00030fb0: 6265 6361 7573 6520 7468 6579 2061 7265  because they are
-00030fc0: 2069 6e20 6469 6666 6572 656e 7420 7375   in different su
-00030fd0: 622d 6469 7265 6374 6f72 6965 730a 2020  b-directories.  
-00030fe0: 2020 2020 2020 6966 2069 6e63 6c75 6465        if include
-00030ff0: 5f64 6973 616d 6269 6775 6174 6f72 3a0a  _disambiguator:.
-00031000: 2020 2020 2020 2020 2020 2020 6469 7361              disa
-00031010: 6d62 6967 7561 7469 6f6e 203d 205b 6622  mbiguation = [f"
-00031020: 7375 6264 6972 3a20 7b27 2e27 2069 6620  subdir: {'.' if 
-00031030: 7375 6264 6972 203d 3d20 2727 2065 6c73  subdir == '' els
-00031040: 6520 7375 6264 6972 7d22 2066 6f72 2064  e subdir}" for d
-00031050: 6973 616d 622c 2073 7562 6469 7220 696e  isamb, subdir in
-00031060: 207a 6970 2864 6973 616d 6269 6775 6174   zip(disambiguat
-00031070: 696f 6e2c 2073 7562 6469 7273 295d 0a20  ion, subdirs)]. 
-00031080: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00031090: 2020 2020 2020 2020 2064 6973 616d 6269           disambi
-000310a0: 6775 6174 696f 6e20 3d20 5b6f 732e 7061  guation = [os.pa
-000310b0: 7468 2e6a 6f69 6e28 6469 7361 6d62 2c20  th.join(disamb, 
-000310c0: 7375 6264 6972 2920 666f 7220 6469 7361  subdir) for disa
-000310d0: 6d62 2c20 7375 6264 6972 2069 6e20 7a69  mb, subdir in zi
-000310e0: 7028 6469 7361 6d62 6967 7561 7469 6f6e  p(disambiguation
-000310f0: 2c20 7375 6264 6972 7329 5d0a 2020 2020  , subdirs)].    
-00031100: 6966 206c 656e 2873 6574 2864 6973 616d  if len(set(disam
-00031110: 6269 6775 6174 696f 6e29 2920 3d3d 206e  biguation)) == n
-00031120: 5f66 696c 6573 3a0a 2020 2020 2020 2020  _files:.        
-00031130: 2320 646f 6e65 2064 6973 616d 6269 6775  # done disambigu
-00031140: 6174 696e 670a 2020 2020 2020 2020 7265  ating.        re
-00031150: 7475 726e 2064 6963 7428 7a69 7028 6469  turn dict(zip(di
-00031160: 7361 6d62 6967 7561 7469 6f6e 2c20 6669  sambiguation, fi
-00031170: 6c65 7329 290a 2020 2020 2320 6e65 7874  les)).    # next
-00031180: 2c20 7472 7920 6164 6469 6e67 2064 6574  , try adding det
-00031190: 6563 7465 6420 7375 6666 6978 6573 0a20  ected suffixes. 
-000311a0: 2020 2066 6f72 2069 782c 2066 2069 6e20     for ix, f in 
-000311b0: 656e 756d 6572 6174 6528 6669 6c65 7329  enumerate(files)
-000311c0: 3a0a 2020 2020 2020 2020 6966 2066 2e73  :.        if f.s
-000311d0: 7566 6669 7820 213d 2027 273a 0a20 2020  uffix != '':.   
-000311e0: 2020 2020 2020 2020 2069 6620 696e 636c           if incl
-000311f0: 7564 655f 6469 7361 6d62 6967 7561 746f  ude_disambiguato
-00031200: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00031210: 2020 2064 6973 616d 6269 6775 6174 696f     disambiguatio
-00031220: 6e5b 6978 5d20 2b3d 2066 222c 2073 7566  n[ix] += f", suf
-00031230: 6669 783a 207b 662e 7375 6666 6978 7d22  fix: {f.suffix}"
-00031240: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00031250: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00031260: 2020 2064 6973 616d 6269 6775 6174 696f     disambiguatio
-00031270: 6e5b 6978 5d20 2b3d 2066 225b 7b66 2e73  n[ix] += f"[{f.s
-00031280: 7566 6669 787d 5d22 0a20 2020 2069 6620  uffix}]".    if 
-00031290: 6c65 6e28 7365 7428 6469 7361 6d62 6967  len(set(disambig
-000312a0: 7561 7469 6f6e 2929 203d 3d20 6e5f 6669  uation)) == n_fi
-000312b0: 6c65 733a 0a20 2020 2020 2020 2023 2064  les:.        # d
-000312c0: 6f6e 6520 6469 7361 6d62 6967 7561 7469  one disambiguati
-000312d0: 6e67 0a20 2020 2020 2020 2072 6574 7572  ng.        retur
-000312e0: 6e20 6469 6374 287a 6970 2864 6973 616d  n dict(zip(disam
-000312f0: 6269 6775 6174 696f 6e2c 2066 696c 6573  biguation, files
-00031300: 2929 0a20 2020 2023 206e 6f77 2c20 6164  )).    # now, ad
-00031310: 6420 6669 6c65 2065 7874 656e 7369 6f6e  d file extension
-00031320: 7320 746f 2064 6973 616d 6269 6775 6174  s to disambiguat
-00031330: 6520 6675 7274 6865 720a 2020 2020 6966  e further.    if
-00031340: 206c 656e 2873 6574 2866 2e66 6578 7420   len(set(f.fext 
-00031350: 666f 7220 6620 696e 2066 696c 6573 2929  for f in files))
-00031360: 203e 2031 3a0a 2020 2020 2020 2020 666f   > 1:.        fo
-00031370: 7220 6978 2c20 6620 696e 2065 6e75 6d65  r ix, f in enume
-00031380: 7261 7465 2866 696c 6573 293a 0a20 2020  rate(files):.   
-00031390: 2020 2020 2020 2020 2069 6620 696e 636c           if incl
-000313a0: 7564 655f 6469 7361 6d62 6967 7561 746f  ude_disambiguato
-000313b0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-000313c0: 2020 2064 6973 616d 6269 6775 6174 696f     disambiguatio
-000313d0: 6e5b 6978 5d20 2b3d 2066 222c 2066 6578  n[ix] += f", fex
-000313e0: 743a 207b 662e 6665 7874 7d22 0a20 2020  t: {f.fext}".   
-000313f0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00031400: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00031410: 6973 616d 6269 6775 6174 696f 6e5b 6978  isambiguation[ix
-00031420: 5d20 2b3d 2066 2e66 6578 740a 2020 2020  ] += f.fext.    
-00031430: 6966 206c 656e 2873 6574 2864 6973 616d  if len(set(disam
-00031440: 6269 6775 6174 696f 6e29 2920 3d3d 206e  biguation)) == n
-00031450: 5f66 696c 6573 3a0a 2020 2020 2020 2020  _files:.        
-00031460: 2320 646f 6e65 2064 6973 616d 6269 6775  # done disambigu
-00031470: 6174 696e 670a 2020 2020 2020 2020 7265  ating.        re
-00031480: 7475 726e 2064 6963 7428 7a69 7028 6469  turn dict(zip(di
-00031490: 7361 6d62 6967 7561 7469 6f6e 2c20 6669  sambiguation, fi
-000314a0: 6c65 7329 290a 2020 2020 7374 725f 636f  les)).    str_co
-000314b0: 756e 7473 203d 2043 6f75 6e74 6572 2864  unts = Counter(d
-000314c0: 6973 616d 6269 6775 6174 696f 6e29 0a20  isambiguation). 
-000314d0: 2020 2064 7570 6c69 6361 7465 5f64 6973     duplicate_dis
-000314e0: 616d 6269 6775 6174 696f 6e5f 7374 7269  ambiguation_stri
-000314f0: 6e67 7320 3d20 5b73 2066 6f72 2073 2c20  ngs = [s for s, 
-00031500: 636e 7420 696e 2073 7472 5f63 6f75 6e74  cnt in str_count
-00031510: 732e 6974 656d 7328 2920 6966 2063 6e74  s.items() if cnt
-00031520: 203e 2031 5d0a 2020 2020 616d 6269 6775   > 1].    ambigu
-00031530: 6174 655f 6669 6c65 7320 3d20 7b73 3a20  ate_files = {s: 
-00031540: 5b66 2066 6f72 2064 6973 616d 622c 2066  [f for disamb, f
-00031550: 2069 6e20 7a69 7028 6469 7361 6d62 6967   in zip(disambig
-00031560: 7561 7469 6f6e 2c20 6669 6c65 7329 2069  uation, files) i
-00031570: 6620 6469 7361 6d62 203d 3d20 735d 2066  f disamb == s] f
-00031580: 6f72 2073 2069 6e20 6475 706c 6963 6174  or s in duplicat
-00031590: 655f 6469 7361 6d62 6967 7561 7469 6f6e  e_disambiguation
-000315a0: 5f73 7472 696e 6773 7d0a 2020 2020 7265  _strings}.    re
-000315b0: 7375 6c74 203d 2064 6963 7428 7a69 7028  sult = dict(zip(
-000315c0: 6469 7361 6d62 6967 7561 7469 6f6e 2c20  disambiguation, 
-000315d0: 6669 6c65 7329 290a 2020 2020 7265 6d61  files)).    rema
-000315e0: 696e 696e 675f 6f6e 6573 203d 207b 733a  ining_ones = {s:
-000315f0: 2072 6573 756c 745b 735d 2066 6f72 2073   result[s] for s
-00031600: 2069 6e20 6475 706c 6963 6174 655f 6469   in duplicate_di
-00031610: 7361 6d62 6967 7561 7469 6f6e 5f73 7472  sambiguation_str
-00031620: 696e 6773 7d0a 2020 2020 6c6f 6767 6572  ings}.    logger
-00031630: 2e77 6172 6e69 6e67 2866 2254 6865 2066  .warning(f"The f
-00031640: 6f6c 6c6f 7769 6e67 2066 696c 6573 2063  ollowing files c
-00031650: 6f75 6c64 206e 6f74 2062 6520 616d 6269  ould not be ambi
-00031660: 6775 6174 6564 3a20 7b61 6d62 6967 7561  guated: {ambigua
-00031670: 7465 5f66 696c 6573 7d2e 5c6e 220a 2020  te_files}.\n".  
-00031680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031690: 2066 2249 6e20 7468 6520 7265 7375 6c74   f"In the result
-000316a0: 2c20 6f6e 6c79 2074 6865 7365 2072 656d  , only these rem
-000316b0: 6169 6e3a 207b 7265 6d61 696e 696e 675f  ain: {remaining_
-000316c0: 6f6e 6573 7d2e 2229 0a20 2020 2072 6574  ones}.").    ret
-000316d0: 7572 6e20 7265 7375 6c74 0a0a 0a64 6566  urn result...def
-000316e0: 206c 6974 6572 616c 5f74 7970 6532 7475   literal_type2tu
-000316f0: 706c 6528 7479 703a 2054 7970 6556 6172  ple(typ: TypeVar
-00031700: 2920 2d3e 2054 7570 6c65 5b73 7472 5d3a  ) -> Tuple[str]:
-00031710: 0a20 2020 2022 2222 5475 726e 7320 7468  .    """Turns th
-00031720: 6520 6669 7273 7420 4c69 7465 7261 6c20  e first Literal 
-00031730: 696e 636c 7564 6564 2069 6e20 7468 6520  included in the 
-00031740: 5479 7065 5661 7220 696e 746f 2061 206c  TypeVar into a l
-00031750: 6973 7420 6f66 2076 616c 7565 732e 2054  ist of values. T
-00031760: 6865 2066 6972 7374 206c 6974 6572 616c  he first literal
-00031770: 2076 616c 7565 0a20 2020 206e 6565 6473   value.    needs
-00031780: 2074 6f20 6265 2061 2073 7472 696e 672c   to be a string,
-00031790: 206f 7468 6572 7769 7365 2074 6865 2066   otherwise the f
-000317a0: 756e 6374 696f 6e20 6d61 7920 6c65 6164  unction may lead
-000317b0: 2074 6f20 756e 6578 7065 6374 6564 2062   to unexpected b
-000317c0: 6568 6176 696f 7572 2e0a 2020 2020 2222  ehaviour..    ""
-000317d0: 220a 2020 2020 6966 2069 7369 6e73 7461  ".    if isinsta
-000317e0: 6e63 6528 7479 702e 5f5f 6172 6773 5f5f  nce(typ.__args__
-000317f0: 5b30 5d2c 2073 7472 293a 0a20 2020 2020  [0], str):.     
-00031800: 2020 2072 6574 7572 6e20 7479 702e 5f5f     return typ.__
-00031810: 6172 6773 5f5f 0a20 2020 2072 6574 7572  args__.    retur
-00031820: 6e20 6c69 7465 7261 6c5f 7479 7065 3274  n literal_type2t
-00031830: 7570 6c65 2874 7970 2e5f 5f61 7267 735f  uple(typ.__args_
-00031840: 5f5b 305d 290a 0a0a 406c 7275 5f63 6163  _[0])...@lru_cac
-00031850: 6865 0a40 6675 6e63 7469 6f6e 5f6c 6f67  he.@function_log
-00031860: 6765 720a 6465 6620 6172 6775 6d65 6e74  ger.def argument
-00031870: 5f61 6e64 5f6c 6974 6572 616c 5f74 7970  _and_literal_typ
-00031880: 6532 6c69 7374 2861 7267 756d 656e 743a  e2list(argument:
-00031890: 2055 6e69 6f6e 5b73 7472 2c20 5475 706c   Union[str, Tupl
-000318a0: 655b 7374 725d 2c20 4c69 7465 7261 6c5b  e[str], Literal[
-000318b0: 4e6f 6e65 5d5d 2c0a 2020 2020 2020 2020  None]],.        
-000318c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000318d0: 2020 2020 2020 2020 2020 2074 7970 3a20             typ: 
-000318e0: 4f70 7469 6f6e 616c 5b55 6e69 6f6e 5b54  Optional[Union[T
-000318f0: 7970 6556 6172 2c20 5475 706c 655b 7374  ypeVar, Tuple[st
-00031900: 725d 5d5d 203d 204e 6f6e 652c 0a20 2020  r]]] = None,.   
-00031910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031930: 6e6f 6e65 5f6d 6561 6e73 5f61 6c6c 3a20  none_means_all: 
-00031940: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-00031950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031970: 2920 2d3e 204f 7074 696f 6e61 6c5b 4c69  ) -> Optional[Li
-00031980: 7374 5b73 7472 5d5d 3a0a 2020 2020 2222  st[str]]:.    ""
-00031990: 2220 4d61 6b65 7320 7375 7265 2074 6861  " Makes sure tha
-000319a0: 7420 616e 2069 6e70 7574 2076 616c 7565  t an input value
-000319b0: 2069 7320 6120 6c69 7374 206f 6620 7374   is a list of st
-000319c0: 7269 6e67 7320 616e 6420 7468 6174 2061  rings and that a
-000319d0: 6c6c 2073 7472 696e 6773 2061 7265 2076  ll strings are v
-000319e0: 616c 6964 2077 2e72 2e74 2e20 746f 0a20  alid w.r.t. to. 
-000319f0: 2020 2074 6865 2074 7970 6527 7320 6578     the type's ex
-00031a00: 7065 6374 6564 206c 6974 6572 616c 2076  pected literal v
-00031a10: 616c 7565 7320 2873 7472 696e 6773 292e  alues (strings).
-00031a20: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
-00031a30: 2020 6172 6775 6d65 6e74 3a0a 2020 2020    argument:.    
-00031a40: 2020 2020 2020 4966 2073 7472 696e 672c        If string,
-00031a50: 2077 7261 7070 6564 2069 6e20 6120 6c69   wrapped in a li
-00031a60: 7374 2c20 6f74 6865 7277 6973 6520 6578  st, otherwise ex
-00031a70: 7065 6374 6564 2074 6f20 6265 2061 2074  pected to be a t
-00031a80: 7570 6c65 206f 6620 7374 7269 6e67 7320  uple of strings 
-00031a90: 2870 6173 7369 6e67 2061 206c 6973 7420  (passing a list 
-00031aa0: 7769 6c6c 2066 6169 6c29 2e0a 2020 2020  will fail)..    
-00031ab0: 2020 2020 2020 4966 204e 6f6e 652c 2061        If None, a
-00031ac0: 206c 6973 7420 6f66 2061 6c6c 2070 6f73   list of all pos
-00031ad0: 7369 626c 6520 7661 6c75 6573 2061 6363  sible values acc
-00031ae0: 6f72 6469 6e67 2074 6f20 7468 6520 7479  ording to the ty
-00031af0: 7065 2069 7320 7265 7475 726e 6564 2069  pe is returned i
-00031b00: 6620 6e6f 6e65 5f6d 6561 6e73 5f61 6c6c  f none_means_all
-00031b10: 2e0a 2020 2020 2020 7479 703a 0a20 2020  ..      typ:.   
-00031b20: 2020 2020 2020 2041 2074 7970 696e 672e         A typing.
-00031b30: 4c69 7465 7261 6c20 6465 636c 6172 6174  Literal declarat
-00031b40: 696f 6e20 6f72 2061 2054 7970 6556 6172  ion or a TypeVar
-00031b50: 2077 6865 7265 2074 6865 2066 6972 7374   where the first
-00031b60: 2063 6f6d 706f 6e65 6e74 2069 7320 6f6e   component is on
-00031b70: 652c 206f 7220 6120 7475 706c 6520 6f66  e, or a tuple of
-00031b80: 2061 6c6c 6f77 6564 2076 616c 7565 732e   allowed values.
-00031b90: 0a20 2020 2020 2020 2020 2041 6c6c 2061  .          All a
-00031ba0: 6c6c 6f77 6564 2076 616c 7565 7320 7368  llowed values sh
-00031bb0: 6f75 6c64 2062 6520 7374 7269 6e67 732e  ould be strings.
-00031bc0: 0a20 2020 2020 206e 6f6e 655f 6d65 616e  .      none_mean
-00031bd0: 735f 616c 6c3a 0a20 2020 2020 2020 2020  s_all:.         
-00031be0: 2042 7920 6465 6661 756c 742c 204e 6f6e   By default, Non
-00031bf0: 6520 7661 6c75 6573 2061 7265 2072 6570  e values are rep
-00031c00: 6c61 6365 6420 7769 7468 2061 6c6c 2061  laced with all a
-00031c10: 6c6c 6f77 6564 2076 616c 7565 732c 2069  llowed values, i
-00031c20: 6620 7370 6563 6966 6965 642e 0a20 2020  f specified..   
-00031c30: 2020 2020 2020 2050 6173 7320 4661 6c73         Pass Fals
-00031c40: 6520 746f 2072 6574 7572 6e20 4e6f 6e65  e to return None
-00031c50: 2069 6e20 7468 6973 2063 6173 652e 0a0a   in this case...
-00031c60: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
-00031c70: 2020 2054 6865 206c 6973 7420 6f66 2061     The list of a
-00031c80: 6363 6570 7465 6420 7374 7269 6e67 732e  ccepted strings.
-00031c90: 0a20 2020 2020 2054 6865 206c 6973 7420  .      The list 
-00031ca0: 6f66 2072 656a 6563 7465 6420 7374 7269  of rejected stri
-00031cb0: 6e67 732e 0a20 2020 2022 2222 0a20 2020  ngs..    """.   
-00031cc0: 2069 6620 7479 7020 6973 204e 6f6e 653a   if typ is None:
-00031cd0: 0a20 2020 2020 2020 2061 6c6c 6f77 6564  .        allowed
-00031ce0: 203d 204e 6f6e 650a 2020 2020 656c 7365   = None.    else
-00031cf0: 3a0a 2020 2020 2020 2020 6966 2069 7369  :.        if isi
-00031d00: 6e73 7461 6e63 6528 7479 702c 2074 7570  nstance(typ, tup
-00031d10: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-00031d20: 2061 6c6c 6f77 6564 203d 2074 7970 0a20   allowed = typ. 
-00031d30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00031d40: 2020 2020 2020 2020 2061 6c6c 6f77 6564           allowed
-00031d50: 203d 206c 6974 6572 616c 5f74 7970 6532   = literal_type2
-00031d60: 7475 706c 6528 7479 7029 0a20 2020 2069  tuple(typ).    i
-00031d70: 6620 6172 6775 6d65 6e74 2069 7320 4e6f  f argument is No
-00031d80: 6e65 3a0a 2020 2020 2020 2020 6966 206e  ne:.        if n
-00031d90: 6f6e 655f 6d65 616e 735f 616c 6c20 616e  one_means_all an
-00031da0: 6420 616c 6c6f 7765 6420 6973 206e 6f74  d allowed is not
-00031db0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00031dc0: 2020 2072 6574 7572 6e20 6c69 7374 2861     return list(a
-00031dd0: 6c6c 6f77 6564 290a 2020 2020 2020 2020  llowed).        
-00031de0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00031df0: 2020 7265 7475 726e 0a20 2020 2069 6620    return.    if 
-00031e00: 6973 696e 7374 616e 6365 2861 7267 756d  isinstance(argum
-00031e10: 656e 742c 2073 7472 293a 0a20 2020 2020  ent, str):.     
-00031e20: 2020 2061 7267 756d 656e 7420 3d20 5b61     argument = [a
-00031e30: 7267 756d 656e 745d 0a20 2020 2069 6620  rgument].    if 
-00031e40: 616c 6c6f 7765 6420 6973 204e 6f6e 653a  allowed is None:
-00031e50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00031e60: 6172 6775 6d65 6e74 0a20 2020 2065 6c73  argument.    els
-00031e70: 653a 0a20 2020 2020 2020 2073 696e 6775  e:.        singu
-00031e80: 6c61 725f 6469 6374 203d 207b 616c 6c77  lar_dict = {allw
-00031e90: 645b 3a2d 315d 3a20 616c 6c77 6420 666f  d[:-1]: allwd fo
-00031ea0: 7220 616c 6c77 6420 696e 2061 6c6c 6f77  r allwd in allow
-00031eb0: 6564 7d0a 2020 2020 6163 6365 7074 6564  ed}.    accepted
-00031ec0: 2c20 7265 6a65 6374 6564 203d 205b 5d2c  , rejected = [],
-00031ed0: 205b 5d0a 2020 2020 666f 7220 6172 6720   [].    for arg 
-00031ee0: 696e 2061 7267 756d 656e 743a 0a20 2020  in argument:.   
-00031ef0: 2020 2020 2069 6620 6172 6720 696e 2061       if arg in a
-00031f00: 6c6c 6f77 6564 3a0a 2020 2020 2020 2020  llowed:.        
-00031f10: 2020 2020 6163 6365 7074 6564 2e61 7070      accepted.app
-00031f20: 656e 6428 6172 6729 0a20 2020 2020 2020  end(arg).       
-00031f30: 2065 6c69 6620 6172 6720 696e 2073 696e   elif arg in sin
-00031f40: 6775 6c61 725f 6469 6374 3a0a 2020 2020  gular_dict:.    
-00031f50: 2020 2020 2020 2020 6163 6365 7074 6564          accepted
-00031f60: 2e61 7070 656e 6428 7369 6e67 756c 6172  .append(singular
-00031f70: 5f64 6963 745b 6172 675d 290a 2020 2020  _dict[arg]).    
-00031f80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00031f90: 2020 2020 2020 7265 6a65 6374 6564 2e61        rejected.a
-00031fa0: 7070 656e 6428 6172 6729 0a20 2020 206e  ppend(arg).    n
-00031fb0: 5f72 656a 6563 7465 6420 3d20 6c65 6e28  _rejected = len(
-00031fc0: 7265 6a65 6374 6564 290a 2020 2020 6966  rejected).    if
-00031fd0: 206e 5f72 656a 6563 7465 6420 3e20 303a   n_rejected > 0:
-00031fe0: 0a20 2020 2020 2020 2069 6620 6e5f 7265  .        if n_re
-00031ff0: 6a65 6374 6564 203d 3d20 313a 0a20 2020  jected == 1:.   
-00032000: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-00032010: 7761 726e 696e 6728 6622 5468 6973 2069  warning(f"This i
-00032020: 7320 6e6f 7420 616e 2061 6363 6570 7465  s not an accepte
-00032030: 6420 7661 6c75 653a 207b 7265 6a65 6374  d value: {reject
-00032040: 6564 5b30 5d7d 5c6e 220a 2020 2020 2020  ed[0]}\n".      
-00032050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032060: 2020 2020 2066 2243 686f 6f73 6520 6672       f"Choose fr
-00032070: 6f6d 207b 616c 6c6f 7765 647d 2229 0a20  om {allowed}"). 
-00032080: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00032090: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-000320a0: 7761 726e 696e 6728 6622 5468 6573 6520  warning(f"These 
-000320b0: 6172 6520 6e6f 7420 6163 6365 7074 6564  are not accepted
-000320c0: 2076 616c 7565 2c20 6f6e 6c79 3a20 7b72   value, only: {r
-000320d0: 656a 6563 7465 647d 220a 2020 2020 2020  ejected}".      
-000320e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000320f0: 2020 2020 2066 2243 686f 6f73 6520 6672       f"Choose fr
-00032100: 6f6d 207b 616c 6c6f 7765 647d 2229 0a20  om {allowed}"). 
-00032110: 2020 2069 6620 6c65 6e28 6163 6365 7074     if len(accept
-00032120: 6564 2920 3e20 303a 0a20 2020 2020 2020  ed) > 0:.       
-00032130: 2072 6574 7572 6e20 6163 6365 7074 6564   return accepted
-00032140: 0a20 2020 206c 6f67 6765 722e 7761 726e  .    logger.warn
-00032150: 696e 6728 6622 5061 7373 2061 7420 6c65  ing(f"Pass at le
-00032160: 6173 7420 6f6e 6520 6f66 207b 616c 6c6f  ast one of {allo
-00032170: 7765 647d 2e22 290a 2020 2020 7265 7475  wed}.").    retu
-00032180: 726e 0a0a 4c20 3d20 5479 7065 5661 7228  rn..L = TypeVar(
-00032190: 274c 2729 0a0a 4066 756e 6374 696f 6e5f  'L')..@function_
-000321a0: 6c6f 6767 6572 0a64 6566 2063 6865 636b  logger.def check
-000321b0: 5f61 7267 756d 656e 745f 6167 6169 6e73  _argument_agains
-000321c0: 745f 6c69 7465 7261 6c5f 7479 7065 2861  t_literal_type(a
-000321d0: 7267 756d 656e 743a 2073 7472 2c0a 2020  rgument: str,.  
-000321e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000321f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032200: 2020 2020 2020 7479 703a 204c 2920 2d3e        typ: L) ->
-00032210: 204f 7074 696f 6e61 6c5b 4c5d 3a0a 2020   Optional[L]:.  
-00032220: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00032230: 6e63 6528 6172 6775 6d65 6e74 2c20 7374  nce(argument, st
-00032240: 7229 3a0a 2020 2020 2020 2020 6c6f 6767  r):.        logg
-00032250: 6572 2e77 6172 6e69 6e67 2866 2241 7267  er.warning(f"Arg
-00032260: 756d 656e 7420 6e65 6564 7320 746f 2062  ument needs to b
-00032270: 6520 6120 7374 7269 6e67 2c20 6e6f 7420  e a string, not 
-00032280: 277b 7479 7065 2861 7267 756d 656e 7429  '{type(argument)
-00032290: 7d27 2229 0a20 2020 2020 2020 2072 6574  }'").        ret
-000322a0: 7572 6e20 4e6f 6e65 0a20 2020 2061 6c6c  urn None.    all
-000322b0: 6f77 6564 203d 206c 6974 6572 616c 5f74  owed = literal_t
-000322c0: 7970 6532 7475 706c 6528 7479 7029 0a20  ype2tuple(typ). 
-000322d0: 2020 2073 696e 6775 6c61 725f 6469 6374     singular_dict
-000322e0: 203d 207b 616c 6c77 645b 3a2d 315d 3a20   = {allwd[:-1]: 
-000322f0: 616c 6c77 6420 666f 7220 616c 6c77 6420  allwd for allwd 
-00032300: 696e 2061 6c6c 6f77 6564 7d0a 2020 2020  in allowed}.    
-00032310: 6966 2061 7267 756d 656e 7420 6e6f 7420  if argument not 
-00032320: 696e 2061 6c6c 6f77 6564 2061 6e64 2061  in allowed and a
-00032330: 7267 756d 656e 7420 6e6f 7420 696e 2073  rgument not in s
-00032340: 696e 6775 6c61 725f 6469 6374 3a0a 2020  ingular_dict:.  
-00032350: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
-00032360: 6e69 6e67 2866 2249 6e76 616c 6964 2061  ning(f"Invalid a
-00032370: 7267 756d 656e 7420 277b 6172 6775 6d65  rgument '{argume
-00032380: 6e74 7d27 2e20 5061 7373 206f 6e65 206f  nt}'. Pass one o
-00032390: 6620 7b61 6c6c 6f77 6564 7d22 290a 2020  f {allowed}").  
-000323a0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-000323b0: 650a 2020 2020 6966 2061 7267 756d 656e  e.    if argumen
-000323c0: 7420 696e 2073 696e 6775 6c61 725f 6469  t in singular_di
-000323d0: 6374 3a0a 2020 2020 2020 2020 7265 7475  ct:.        retu
-000323e0: 726e 2073 696e 6775 6c61 725f 6469 6374  rn singular_dict
-000323f0: 5b61 7267 756d 656e 745d 0a20 2020 2072  [argument].    r
-00032400: 6574 7572 6e20 6172 6775 6d65 6e74 0a0a  eturn argument..
-00032410: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
-00032420: 0a64 6566 2072 6573 6f6c 7665 5f66 6163  .def resolve_fac
-00032430: 6574 735f 7061 7261 6d28 6661 6365 7473  ets_param(facets
-00032440: 2c20 6661 6365 745f 7479 7065 5f76 6172  , facet_type_var
-00032450: 3a20 5479 7065 5661 7220 3d20 4661 6365  : TypeVar = Face
-00032460: 742c 206e 6f6e 655f 6d65 616e 735f 616c  t, none_means_al
-00032470: 6c3d 5472 7565 293a 0a20 2020 2022 2222  l=True):.    """
-00032480: 4c69 6b65 203a 6675 6e63 3a60 6172 6775  Like :func:`argu
-00032490: 6d65 6e74 5f61 6e64 5f6c 6974 6572 616c  ment_and_literal
-000324a0: 5f74 7970 6532 6c69 7374 602c 2062 7574  _type2list`, but
-000324b0: 2061 6c73 6f20 7265 736f 6c76 6573 2027   also resolves '
-000324c0: 7473 7627 2074 6f20 616c 6c20 6e6f 6e2d  tsv' to all non-
-000324d0: 7363 6f72 6520 6661 6365 7473 2e22 2222  score facets."""
-000324e0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-000324f0: 6365 2866 6163 6574 732c 2073 7472 2920  ce(facets, str) 
-00032500: 616e 6420 6661 6365 7473 2069 6e20 2827  and facets in ('
-00032510: 7473 7627 2c20 2774 7376 7327 293a 0a20  tsv', 'tsvs'):. 
-00032520: 2020 2020 2020 2073 656c 6563 7465 645f         selected_
-00032530: 6661 6365 7473 203d 206c 6973 7428 6c69  facets = list(li
-00032540: 7465 7261 6c5f 7479 7065 3274 7570 6c65  teral_type2tuple
-00032550: 2866 6163 6574 5f74 7970 655f 7661 7229  (facet_type_var)
-00032560: 290a 2020 2020 2020 2020 6966 2027 7363  ).        if 'sc
-00032570: 6f72 6573 2720 696e 2073 656c 6563 7465  ores' in selecte
-00032580: 645f 6661 6365 7473 3a0a 2020 2020 2020  d_facets:.      
-00032590: 2020 2020 2020 7365 6c65 6374 6564 5f66        selected_f
-000325a0: 6163 6574 732e 7265 6d6f 7665 2827 7363  acets.remove('sc
-000325b0: 6f72 6573 2729 0a20 2020 2065 6c73 653a  ores').    else:
-000325c0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-000325d0: 7374 616e 6365 2866 6163 6574 732c 206c  stance(facets, l
-000325e0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
-000325f0: 2020 6661 6365 7473 203d 2074 7570 6c65    facets = tuple
-00032600: 2866 6163 6574 7329 0a20 2020 2020 2020  (facets).       
-00032610: 2073 656c 6563 7465 645f 6661 6365 7473   selected_facets
-00032620: 203d 2061 7267 756d 656e 745f 616e 645f   = argument_and_
-00032630: 6c69 7465 7261 6c5f 7479 7065 326c 6973  literal_type2lis
-00032640: 7428 6661 6365 7473 2c20 6661 6365 745f  t(facets, facet_
-00032650: 7479 7065 5f76 6172 2c20 6e6f 6e65 5f6d  type_var, none_m
-00032660: 6561 6e73 5f61 6c6c 3d6e 6f6e 655f 6d65  eans_all=none_me
-00032670: 616e 735f 616c 6c2c 206c 6f67 6765 723d  ans_all, logger=
-00032680: 6c6f 6767 6572 290a 2020 2020 236c 6f67  logger).    #log
-00032690: 6765 722e 6465 6275 6728 6622 5265 736f  ger.debug(f"Reso
-000326a0: 6c76 6564 2061 7267 756d 656e 7420 277b  lved argument '{
-000326b0: 6661 6365 7473 7d27 2074 6f20 7b73 656c  facets}' to {sel
-000326c0: 6563 7465 645f 6661 6365 7473 7d2e 2229  ected_facets}.")
-000326d0: 0a20 2020 2072 6574 7572 6e20 7365 6c65  .    return sele
-000326e0: 6374 6564 5f66 6163 6574 730a 0a64 6566  cted_facets..def
-000326f0: 2062 6f6c 645f 666f 6e74 2873 293a 0a20   bold_font(s):. 
-00032700: 2020 2072 6574 7572 6e20 6622 5c30 3333     return f"\033
-00032710: 5b31 6d7b 737d 5c30 3333 5b30 3b30 6d22  [1m{s}\033[0;0m"
-00032720: 0a0a 6465 6620 6176 6169 6c61 626c 655f  ..def available_
-00032730: 7669 6577 7332 7374 7228 7669 6577 735f  views2str(views_
-00032740: 6469 6374 3a20 5669 6577 4469 6374 2c20  dict: ViewDict, 
-00032750: 6163 7469 7665 5f76 6965 775f 6e61 6d65  active_view_name
-00032760: 3a20 7374 7220 3d20 4e6f 6e65 2920 2d3e  : str = None) ->
-00032770: 2073 7472 3a0a 2020 2020 7669 6577 5f6e   str:.    view_n
-00032780: 616d 6573 203d 207b 6b65 793a 2076 6965  ames = {key: vie
-00032790: 772e 6e61 6d65 2069 6620 6b65 7920 6973  w.name if key is
-000327a0: 204e 6f6e 6520 656c 7365 206b 6579 2066   None else key f
-000327b0: 6f72 206b 6579 2c20 7669 6577 2069 6e20  or key, view in 
-000327c0: 7669 6577 735f 6469 6374 2e69 7465 6d73  views_dict.items
-000327d0: 2829 7d0a 2020 2020 6375 7272 656e 745f  ()}.    current_
-000327e0: 7669 6577 203d 2076 6965 775f 6e61 6d65  view = view_name
-000327f0: 735b 6163 7469 7665 5f76 6965 775f 6e61  s[active_view_na
-00032800: 6d65 5d0a 2020 2020 7669 6577 5f6c 6973  me].    view_lis
-00032810: 7420 3d20 5b62 6f6c 645f 666f 6e74 2863  t = [bold_font(c
-00032820: 7572 7265 6e74 5f76 6965 7729 5d20 2b20  urrent_view)] + 
-00032830: 5b6e 616d 6520 666f 7220 6e61 6d65 2069  [name for name i
-00032840: 6e20 7669 6577 5f6e 616d 6573 2e76 616c  n view_names.val
-00032850: 7565 7328 2920 6966 206e 616d 6520 213d  ues() if name !=
-00032860: 2063 7572 7265 6e74 5f76 6965 775d 0a20   current_view]. 
-00032870: 2020 2072 6574 7572 6e20 6622 5b7b 277c     return f"[{'|
-00032880: 272e 6a6f 696e 2876 6965 775f 6c69 7374  '.join(view_list
-00032890: 297d 5d5c 6e22 0a0a 0a40 6675 6e63 7469  )}]\n"...@functi
-000328a0: 6f6e 5f6c 6f67 6765 720a 6465 6620 756e  on_logger.def un
-000328b0: 7061 636b 5f6a 736f 6e5f 7061 7468 7328  pack_json_paths(
-000328c0: 7061 7468 733a 2043 6f6c 6c65 6374 696f  paths: Collectio
-000328d0: 6e5b 7374 725d 2920 2d3e 204e 6f6e 653a  n[str]) -> None:
-000328e0: 0a20 2020 2022 2222 4d75 7461 7465 7320  .    """Mutates 
-000328f0: 7468 6520 6c69 7374 2077 6974 6820 7061  the list with pa
-00032900: 7468 7320 6279 2072 6570 6c61 6369 6e67  ths by replacing
-00032910: 202e 6a73 6f6e 2066 696c 6573 2077 6974   .json files wit
-00032920: 6820 7468 6520 6c69 7374 2028 6f66 2070  h the list (of p
-00032930: 6174 6873 2920 636f 6e74 6169 6e65 6420  aths) contained 
-00032940: 696e 2074 6865 6d2e 2222 220a 2020 2020  in them.""".    
-00032950: 6a73 6f6e 5f69 7873 203d 205b 6920 666f  json_ixs = [i fo
-00032960: 7220 692c 2070 2069 6e20 656e 756d 6572  r i, p in enumer
-00032970: 6174 6528 7061 7468 7329 2069 6620 702e  ate(paths) if p.
-00032980: 656e 6473 7769 7468 2827 2e6a 736f 6e27  endswith('.json'
-00032990: 295d 0a20 2020 2069 6620 6c65 6e28 6a73  )].    if len(js
-000329a0: 6f6e 5f69 7873 2920 3e20 303a 0a20 2020  on_ixs) > 0:.   
-000329b0: 2020 2020 2066 6f72 2069 2069 6e20 7265       for i in re
-000329c0: 7665 7273 6564 286a 736f 6e5f 6978 7329  versed(json_ixs)
-000329d0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-000329e0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000329f0: 2020 2077 6974 6820 6f70 656e 2870 6174     with open(pat
-00032a00: 6873 5b69 5d29 2061 7320 663a 0a20 2020  hs[i]) as f:.   
-00032a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032a20: 206c 6f61 6465 645f 7061 7468 7320 3d20   loaded_paths = 
-00032a30: 6a73 6f6e 2e6c 6f61 6428 6629 0a20 2020  json.load(f).   
-00032a40: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-00032a50: 6873 2e65 7874 656e 6428 6c6f 6164 6564  hs.extend(loaded
-00032a60: 5f70 6174 6873 290a 2020 2020 2020 2020  _paths).        
-00032a70: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-00032a80: 6e66 6f28 6622 556e 7061 636b 6564 2074  nfo(f"Unpacked t
-00032a90: 6865 207b 6c65 6e28 6c6f 6164 6564 5f70  he {len(loaded_p
-00032aa0: 6174 6873 297d 2070 6174 6873 2066 6f75  aths)} paths fou
-00032ab0: 6e64 2069 6e20 7b70 6174 6873 5b69 5d7d  nd in {paths[i]}
-00032ac0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00032ad0: 2020 2020 6465 6c20 2870 6174 6873 5b69      del (paths[i
-00032ae0: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
-00032af0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00032b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032b10: 206c 6f67 6765 722e 696e 666f 2866 2243   logger.info(f"C
-00032b20: 6f75 6c64 206e 6f74 206c 6f61 6420 7061  ould not load pa
-00032b30: 7468 7320 6672 6f6d 207b 7061 7468 735b  ths from {paths[
-00032b40: 695d 7d20 6265 6361 7573 6520 6f66 2074  i]} because of t
-00032b50: 6865 2066 6f6c 6c6f 7769 6e67 2065 7272  he following err
-00032b60: 6f72 2873 293a 5c6e 7b73 7973 2e65 7863  or(s):\n{sys.exc
-00032b70: 5f69 6e66 6f28 295b 315d 7d22 290a 0a0a  _info()[1]}")...
-00032b80: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
-00032b90: 0a64 6566 2072 6573 6f6c 7665 5f70 6174  .def resolve_pat
-00032ba0: 6873 5f61 7267 756d 656e 7428 7061 7468  hs_argument(path
-00032bb0: 733a 2055 6e69 6f6e 5b73 7472 2c20 436f  s: Union[str, Co
-00032bc0: 6c6c 6563 7469 6f6e 5b73 7472 5d5d 2c0a  llection[str]],.
-00032bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032be0: 2020 2020 2020 2020 2020 2066 696c 6573             files
-00032bf0: 3a20 626f 6f6c 203d 2054 7275 6529 202d  : bool = True) -
-00032c00: 3e20 4c69 7374 5b73 7472 5d3a 0a20 2020  > List[str]:.   
-00032c10: 2022 2222 204d 616b 6573 2073 7572 6520   """ Makes sure 
-00032c20: 7468 6174 2074 6865 2067 6976 656e 2070  that the given p
-00032c30: 6174 6828 7329 2065 7869 7374 7328 7329  ath(s) exists(s)
-00032c40: 2061 6e64 2066 696c 7465 7273 206f 7574   and filters out
-00032c50: 2074 686f 7365 2074 6861 7420 646f 6e27   those that don'
-00032c60: 742e 0a0a 2020 2020 4172 6773 3a0a 2020  t...    Args:.  
-00032c70: 2020 2020 7061 7468 733a 204f 6e65 206f      paths: One o
-00032c80: 7220 7365 7665 7261 6c20 7061 7468 7320  r several paths 
-00032c90: 6769 7665 6e20 6173 2073 7472 696e 6773  given as strings
-00032ca0: 2e0a 2020 2020 2020 6669 6c65 733a 2042  ..      files: B
-00032cb0: 7920 6465 6661 756c 742c 206f 6e6c 7920  y default, only 
-00032cc0: 6669 6c65 2070 6174 6873 2061 7265 2072  file paths are r
-00032cd0: 6574 7572 6e65 642e 2053 6574 2074 6f20  eturned. Set to 
-00032ce0: 4661 6c73 6520 746f 2072 6574 7572 6e20  False to return 
-00032cf0: 6f6e 6c79 2066 6f6c 6465 7273 2e0a 0a20  only folders... 
-00032d00: 2020 2052 6574 7572 6e73 3a0a 0a20 2020     Returns:..   
-00032d10: 2022 2222 0a20 2020 2069 6620 6973 696e   """.    if isin
-00032d20: 7374 616e 6365 2870 6174 6873 2c20 7374  stance(paths, st
-00032d30: 7229 3a0a 2020 2020 2020 2020 7061 7468  r):.        path
-00032d40: 7320 3d20 5b70 6174 6873 5d0a 2020 2020  s = [paths].    
-00032d50: 7265 736f 6c76 6564 5f70 6174 6873 203d  resolved_paths =
-00032d60: 205b 7265 736f 6c76 655f 6469 7228 7029   [resolve_dir(p)
-00032d70: 2066 6f72 2070 2069 6e20 7061 7468 735d   for p in paths]
-00032d80: 0a20 2020 2069 6620 6669 6c65 733a 0a20  .    if files:. 
-00032d90: 2020 2020 2020 206e 6f74 5f61 5f66 696c         not_a_fil
-00032da0: 6520 3d20 5b70 2066 6f72 2070 2069 6e20  e = [p for p in 
-00032db0: 7061 7468 7320 6966 206e 6f74 206f 732e  paths if not os.
-00032dc0: 7061 7468 2e69 7366 696c 6528 7029 5d0a  path.isfile(p)].
-00032dd0: 2020 2020 2020 2020 6966 206c 656e 286e          if len(n
-00032de0: 6f74 5f61 5f66 696c 6529 203e 2030 3a0a  ot_a_file) > 0:.
-00032df0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00032e00: 656e 286e 6f74 5f61 5f66 696c 6529 203d  en(not_a_file) =
-00032e10: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00032e20: 2020 2020 206d 7367 203d 2066 224e 6f20       msg = f"No 
-00032e30: 6578 6973 7469 6e67 2066 696c 6520 6174  existing file at
-00032e40: 207b 6e6f 745f 615f 6669 6c65 5b30 5d7d   {not_a_file[0]}
-00032e50: 2e22 0a20 2020 2020 2020 2020 2020 2065  .".            e
-00032e60: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00032e70: 2020 2020 206d 7367 203d 2066 2254 6865       msg = f"The
-00032e80: 7365 2061 7265 206e 6f74 2070 6174 6873  se are not paths
-00032e90: 206f 6620 6578 6973 7469 6e67 2066 696c   of existing fil
-00032ea0: 6573 3a20 7b6e 6f74 5f61 5f66 696c 657d  es: {not_a_file}
-00032eb0: 220a 2020 2020 2020 2020 2020 2020 6c6f  ".            lo
-00032ec0: 6767 6572 2e77 6172 6e69 6e67 286d 7367  gger.warning(msg
-00032ed0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00032ee0: 736f 6c76 6564 5f70 6174 6873 203d 205b  solved_paths = [
-00032ef0: 7020 666f 7220 7020 696e 2070 6174 6873  p for p in paths
-00032f00: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
-00032f10: 6c65 2870 295d 0a20 2020 2065 6c73 653a  le(p)].    else:
-00032f20: 0a20 2020 2020 2020 206e 6f74 5f61 5f66  .        not_a_f
-00032f30: 6f6c 6465 7220 3d20 5b70 2066 6f72 2070  older = [p for p
-00032f40: 2069 6e20 7061 7468 7320 6966 206e 6f74   in paths if not
-00032f50: 206f 732e 7061 7468 2e69 7364 6972 2870   os.path.isdir(p
-00032f60: 295d 0a20 2020 2020 2020 2069 6620 6c65  )].        if le
-00032f70: 6e28 6e6f 745f 615f 666f 6c64 6572 2920  n(not_a_folder) 
-00032f80: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00032f90: 2069 6620 6c65 6e28 6e6f 745f 615f 666f   if len(not_a_fo
-00032fa0: 6c64 6572 2920 3d3d 2031 3a0a 2020 2020  lder) == 1:.    
-00032fb0: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-00032fc0: 3d20 6622 7b6e 6f74 5f61 5f66 6f6c 6465  = f"{not_a_folde
-00032fd0: 725b 305d 7d20 6973 206e 6f74 2061 2070  r[0]} is not a p
-00032fe0: 6174 6820 746f 2061 6e20 6578 6973 7469  ath to an existi
-00032ff0: 6e67 2066 6f6c 6465 722e 220a 2020 2020  ng folder.".    
-00033000: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00033010: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-00033020: 6720 3d20 6622 5468 6573 6520 6172 6520  g = f"These are 
-00033030: 6e6f 7420 7061 7468 7320 6f66 2065 7869  not paths of exi
-00033040: 7374 696e 6720 666f 6c64 6572 733a 207b  sting folders: {
-00033050: 6e6f 745f 615f 666f 6c64 6572 7d22 0a20  not_a_folder}". 
-00033060: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00033070: 722e 7761 726e 696e 6728 6d73 6729 0a20  r.warning(msg). 
-00033080: 2020 2020 2020 2020 2020 2072 6573 6f6c             resol
-00033090: 7665 645f 7061 7468 7320 3d20 5b70 2066  ved_paths = [p f
-000330a0: 6f72 2070 2069 6e20 7061 7468 7320 6966  or p in paths if
-000330b0: 206f 732e 7061 7468 2e69 7364 6972 2870   os.path.isdir(p
-000330c0: 295d 0a20 2020 2072 6574 7572 6e20 7265  )].    return re
-000330d0: 736f 6c76 6564 5f70 6174 6873 0a0a 4066  solved_paths..@f
-000330e0: 756e 6374 696f 6e5f 6c6f 6767 6572 0a64  unction_logger.d
-000330f0: 6566 2063 6f6d 7075 7465 5f70 6174 685f  ef compute_path_
-00033100: 6672 6f6d 5f66 696c 6528 6669 6c65 3a20  from_file(file: 
-00033110: 4669 6c65 2c0a 2020 2020 2020 2020 2020  File,.          
-00033120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033130: 2072 6f6f 745f 6469 723a 204f 7074 696f   root_dir: Optio
-00033140: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
-00033150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033160: 2020 2020 2020 2020 2020 2020 666f 6c64              fold
-00033170: 6572 3a20 4f70 7469 6f6e 616c 5b73 7472  er: Optional[str
-00033180: 5d20 3d20 4e6f 6e65 2920 2d3e 2073 7472  ] = None) -> str
-00033190: 3a0a 2020 2020 2222 220a 2020 2020 436f  :.    """.    Co
-000331a0: 6e73 7472 7563 7473 2061 2070 6174 6820  nstructs a path 
-000331b0: 6261 7365 6420 6f6e 2074 6865 2061 7267  based on the arg
-000331c0: 756d 656e 7473 2e0a 0a20 2020 2041 7267  uments...    Arg
-000331d0: 733a 0a20 2020 2020 2066 696c 653a 2054  s:.      file: T
-000331e0: 6869 7320 6675 6e63 7469 6f6e 2075 7365  his function use
-000331f0: 7320 7468 6520 6669 656c 6473 2063 6f72  s the fields cor
-00033200: 7075 735f 7061 7468 2c20 7375 6264 6972  pus_path, subdir
-00033210: 2c20 616e 6420 7479 7065 2e0a 2020 2020  , and type..    
-00033220: 2020 726f 6f74 5f64 6972 3a0a 2020 2020    root_dir:.    
-00033230: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
-00033240: 6f20 4e6f 6e65 2c20 6d65 616e 696e 6720  o None, meaning 
-00033250: 7468 6174 2074 6865 2070 6174 6820 6973  that the path is
-00033260: 2063 6f6e 7374 7275 6374 6564 2062 6173   constructed bas
-00033270: 6564 206f 6e20 7468 6520 636f 7270 7573  ed on the corpus
-00033280: 5f70 6174 682e 0a20 2020 2020 2020 2020  _path..         
-00033290: 2050 6173 7320 6120 6469 7265 6374 6f72   Pass a director
-000332a0: 7920 746f 2063 6f6e 7374 7275 6374 2074  y to construct t
-000332b0: 6865 2070 6174 6820 7265 6c61 7469 7665  he path relative
-000332c0: 2074 6f20 6974 2069 6e73 7465 6164 2e20   to it instead. 
-000332d0: 4966 2060 6066 6f6c 6465 7260 6020 6973  If ``folder`` is
-000332e0: 2061 6e20 6162 736f 6c75 7465 2070 6174   an absolute pat
-000332f0: 682c 0a20 2020 2020 2020 2020 2060 6072  h,.          ``r
-00033300: 6f6f 745f 6469 7260 6020 6973 2069 676e  oot_dir`` is ign
-00033310: 6f72 6564 2e0a 2020 2020 2020 666f 6c64  ored..      fold
-00033320: 6572 3a0a 2020 2020 2020 2020 2020 2a20  er:.          * 
-00033330: 4966 2060 6066 6f6c 6465 7260 6020 6973  If ``folder`` is
-00033340: 204e 6f6e 6520 2864 6566 6175 6c74 292c   None (default),
-00033350: 2074 6865 2066 696c 6573 2720 7479 7065   the files' type
-00033360: 2077 696c 6c20 6265 2061 7070 656e 6465   will be appende
-00033370: 6420 746f 2074 6865 2060 6072 6f6f 745f  d to the ``root_
-00033380: 6469 7260 602e 0a20 2020 2020 2020 2020  dir``..         
-00033390: 202a 2049 6620 6060 666f 6c64 6572 6060   * If ``folder``
-000333a0: 2069 7320 616e 2061 6273 6f6c 7574 6520   is an absolute 
-000333b0: 7061 7468 2c20 6060 726f 6f74 5f64 6972  path, ``root_dir
-000333c0: 6060 2077 696c 6c20 6265 2069 676e 6f72  `` will be ignor
-000333d0: 6564 2e0a 2020 2020 2020 2020 2020 2a20  ed..          * 
-000333e0: 4966 2060 6066 6f6c 6465 7260 6020 6973  If ``folder`` is
-000333f0: 2061 2072 656c 6174 6976 6520 7061 7468   a relative path
-00033400: 2073 7461 7274 696e 6720 7769 7468 2061   starting with a
-00033410: 2064 6f74 2060 602e 6060 2074 6865 2072   dot ``.`` the r
-00033420: 656c 6174 6976 6520 7061 7468 2069 7320  elative path is 
-00033430: 6170 7065 6e64 6564 2074 6f20 7468 6520  appended to the 
-00033440: 6669 6c65 2773 2073 7562 6469 722e 0a20  file's subdir.. 
-00033450: 2020 2020 2020 2020 2020 2046 6f72 2065             For e
-00033460: 7861 6d70 6c65 2c20 6060 2e2e 5c6e 6f74  xample, ``..\not
-00033470: 6573 6060 2077 696c 6c20 7265 736f 6c76  es`` will resolv
-00033480: 6520 746f 2061 2073 6962 6c69 6e67 2064  e to a sibling d
-00033490: 6972 6563 746f 7279 206f 6620 7468 6520  irectory of the 
-000334a0: 6f6e 6520 7768 6572 6520 7468 6520 6060  one where the ``
-000334b0: 6669 6c65 6060 2069 7320 6c6f 6361 7465  file`` is locate
-000334c0: 642e 0a20 2020 2020 2020 2020 202a 2049  d..          * I
-000334d0: 6620 6060 666f 6c64 6572 6060 2069 7320  f ``folder`` is 
-000334e0: 6120 7265 6c61 7469 7665 2070 6174 6820  a relative path 
-000334f0: 7468 6174 2064 6f65 7320 6e6f 7420 6265  that does not be
-00033500: 6769 6e20 7769 7468 2061 2064 6f74 2060  gin with a dot `
-00033510: 602e 6060 2c20 6974 2077 696c 6c20 6265  `.``, it will be
-00033520: 2061 7070 656e 6465 6420 746f 2074 6865   appended to the
-00033530: 0a20 2020 2020 2020 2020 2020 2060 6072  .            ``r
-00033540: 6f6f 745f 6469 7260 602e 0a20 2020 2020  oot_dir``..     
-00033550: 2020 2020 202a 2049 6620 6060 666f 6c64       * If ``fold
-00033560: 6572 6060 203d 3d20 2727 2028 656d 7074  er`` == '' (empt
-00033570: 7920 7374 7269 6e67 292c 2074 6865 2072  y string), the r
-00033580: 6573 756c 7420 7769 6c6c 2062 6520 6072  esult will be `r
-00033590: 6f6f 745f 6469 7260 2e0a 0a20 2020 2052  oot_dir`...    R
-000335a0: 6574 7572 6e73 3a0a 2020 2020 2020 5468  eturns:.      Th
-000335b0: 6520 636f 6e73 7472 7563 7465 6420 6469  e constructed di
-000335c0: 7265 6374 6f72 7920 7061 7468 2e0a 2020  rectory path..  
-000335d0: 2020 2222 220a 2020 2020 6966 2066 6f6c    """.    if fol
-000335e0: 6465 7220 6973 206e 6f74 204e 6f6e 6520  der is not None 
-000335f0: 616e 6420 286f 732e 7061 7468 2e69 7361  and (os.path.isa
-00033600: 6273 2866 6f6c 6465 7229 206f 7220 277e  bs(folder) or '~
-00033610: 2720 696e 2066 6f6c 6465 7229 3a0a 2020  ' in folder):.  
-00033620: 2020 2020 2020 666f 6c64 6572 203d 2072        folder = r
-00033630: 6573 6f6c 7665 5f64 6972 2866 6f6c 6465  esolve_dir(folde
-00033640: 7229 0a20 2020 2020 2020 2070 6174 6820  r).        path 
-00033650: 3d20 666f 6c64 6572 0a20 2020 2065 6c73  = folder.    els
-00033660: 653a 0a20 2020 2020 2020 2072 6f6f 7420  e:.        root 
-00033670: 3d20 6669 6c65 2e63 6f72 7075 735f 7061  = file.corpus_pa
-00033680: 7468 2069 6620 726f 6f74 5f64 6972 2069  th if root_dir i
-00033690: 7320 4e6f 6e65 2065 6c73 6520 7265 736f  s None else reso
-000336a0: 6c76 655f 6469 7228 726f 6f74 5f64 6972  lve_dir(root_dir
-000336b0: 290a 2020 2020 2020 2020 6966 2066 6f6c  ).        if fol
-000336c0: 6465 7220 6973 204e 6f6e 653a 0a20 2020  der is None:.   
-000336d0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-000336e0: 6f73 2e70 6174 682e 6a6f 696e 2872 6f6f  os.path.join(roo
-000336f0: 742c 2066 696c 652e 7479 7065 290a 2020  t, file.type).  
-00033700: 2020 2020 2020 656c 6966 2066 6f6c 6465        elif folde
-00033710: 7220 3d3d 2027 273a 0a20 2020 2020 2020  r == '':.       
-00033720: 2020 2020 2070 6174 6820 3d20 726f 6f74       path = root
-00033730: 0a20 2020 2020 2020 2065 6c69 6620 666f  .        elif fo
-00033740: 6c64 6572 5b30 5d20 3d3d 2027 2e27 3a0a  lder[0] == '.':.
-00033750: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00033760: 203d 206f 732e 7061 7468 2e61 6273 7061   = os.path.abspa
-00033770: 7468 286f 732e 7061 7468 2e6a 6f69 6e28  th(os.path.join(
-00033780: 726f 6f74 2c20 6669 6c65 2e73 7562 6469  root, file.subdi
-00033790: 722c 2066 6f6c 6465 7229 290a 2020 2020  r, folder)).    
-000337a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000337b0: 2020 2020 2020 7061 7468 203d 206f 732e        path = os.
-000337c0: 7061 7468 2e61 6273 7061 7468 286f 732e  path.abspath(os.
-000337d0: 7061 7468 2e6a 6f69 6e28 726f 6f74 2c20  path.join(root, 
-000337e0: 666f 6c64 6572 2929 0a20 2020 2072 6574  folder)).    ret
-000337f0: 7572 6e20 7061 7468 0a0a 6465 6620 6d61  urn path..def ma
-00033800: 6b65 5f66 696c 655f 7061 7468 2866 696c  ke_file_path(fil
-00033810: 653a 2046 696c 652c 0a20 2020 2020 2020  e: File,.       
-00033820: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-00033830: 5f64 6972 3d4e 6f6e 652c 0a20 2020 2020  _dir=None,.     
-00033840: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00033850: 6c64 6572 3a20 7374 7220 3d20 4e6f 6e65  lder: str = None
-00033860: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00033870: 2020 2020 2073 7566 6669 783a 2073 7472       suffix: str
-00033880: 203d 2027 272c 0a20 2020 2020 2020 2020   = '',.         
-00033890: 2020 2020 2020 2020 2020 6665 7874 3a20            fext: 
-000338a0: 7374 7220 3d20 272e 7473 7627 293a 0a20  str = '.tsv'):. 
-000338b0: 2020 2022 2222 2043 6f6e 7374 7275 6374     """ Construct
-000338c0: 7320 6120 6669 6c65 2070 6174 6820 6261  s a file path ba
-000338d0: 7365 6420 6f6e 2074 6865 2061 7267 756d  sed on the argum
-000338e0: 656e 7473 2e0a 0a20 2020 2041 7267 733a  ents...    Args:
-000338f0: 0a20 2020 2020 2066 696c 653a 2054 6869  .      file: Thi
-00033900: 7320 6675 6e63 7469 6f6e 2075 7365 7320  s function uses 
-00033910: 7468 6520 6669 656c 6473 2066 6e61 6d65  the fields fname
-00033920: 2c20 636f 7270 7573 5f70 6174 682c 2073  , corpus_path, s
-00033930: 7562 6469 722c 2061 6e64 2074 7970 652e  ubdir, and type.
-00033940: 0a20 2020 2020 2072 6f6f 745f 6469 723a  .      root_dir:
-00033950: 0a20 2020 2020 2020 2044 6566 6175 6c74  .        Default
-00033960: 7320 746f 204e 6f6e 652c 206d 6561 6e69  s to None, meani
-00033970: 6e67 2074 6861 7420 7468 6520 7061 7468  ng that the path
-00033980: 2069 7320 636f 6e73 7472 7563 7465 6420   is constructed 
-00033990: 6261 7365 6420 6f6e 2074 6865 2063 6f72  based on the cor
-000339a0: 7075 735f 7061 7468 2e0a 2020 2020 2020  pus_path..      
-000339b0: 2020 5061 7373 2061 2064 6972 6563 746f    Pass a directo
-000339c0: 7279 2074 6f20 636f 6e73 7472 7563 7420  ry to construct 
-000339d0: 7468 6520 7061 7468 2072 656c 6174 6976  the path relativ
-000339e0: 6520 746f 2069 7420 696e 7374 6561 642e  e to it instead.
-000339f0: 2049 6620 6060 666f 6c64 6572 6060 2069   If ``folder`` i
-00033a00: 7320 616e 2061 6273 6f6c 7574 6520 7061  s an absolute pa
-00033a10: 7468 2c0a 2020 2020 2020 2020 6060 726f  th,.        ``ro
-00033a20: 6f74 5f64 6972 6060 2069 7320 6967 6e6f  ot_dir`` is igno
-00033a30: 7265 642e 0a20 2020 2020 2066 6f6c 6465  red..      folde
-00033a40: 723a 0a20 2020 2020 2020 2044 6966 6665  r:.        Diffe
-00033a50: 7265 6e74 2062 6568 6176 696f 7572 7320  rent behaviours 
-00033a60: 6172 6520 6176 6169 6c61 626c 652e 204e  are available. N
-00033a70: 6f74 6520 7468 6174 206f 6e6c 7920 7468  ote that only th
-00033a80: 6520 7468 6972 6420 6f70 7469 6f6e 2065  e third option e
-00033a90: 6e73 7572 6573 2074 6861 7420 6669 6c65  nsures that file
-00033aa0: 2070 6174 6873 2061 7265 2064 6973 7469   paths are disti
-00033ab0: 6e63 7420 666f 720a 2020 2020 2020 2020  nct for.        
-00033ac0: 6669 6c65 7320 7468 6174 2068 6176 6520  files that have 
-00033ad0: 6964 656e 7469 6361 6c20 666e 616d 6573  identical fnames
-00033ae0: 2062 7574 2061 7265 206c 6f63 6174 6564   but are located
-00033af0: 2069 6e20 6469 6666 6572 656e 7420 7375   in different su
-00033b00: 6264 6972 6563 746f 7269 6573 206f 6620  bdirectories of 
-00033b10: 7468 6520 7361 6d65 2063 6f72 7075 732e  the same corpus.
-00033b20: 0a20 2020 2020 2020 202a 2049 6620 6060  .        * If ``
-00033b30: 666f 6c64 6572 6060 2069 7320 4e6f 6e65  folder`` is None
-00033b40: 2028 6465 6661 756c 7429 2c20 7468 6520   (default), the 
-00033b50: 6669 6c65 7327 2074 7970 6520 7769 6c6c  files' type will
-00033b60: 2062 6520 6170 7065 6e64 6564 2074 6f20   be appended to 
-00033b70: 7468 6520 6060 726f 6f74 5f64 6972 6060  the ``root_dir``
-00033b80: 2e0a 2020 2020 2020 2020 2a20 4966 2060  ..        * If `
-00033b90: 6066 6f6c 6465 7260 6020 6973 2061 6e20  `folder`` is an 
-00033ba0: 6162 736f 6c75 7465 2070 6174 682c 2060  absolute path, `
-00033bb0: 6072 6f6f 745f 6469 7260 6020 7769 6c6c  `root_dir`` will
-00033bc0: 2062 6520 6967 6e6f 7265 642e 0a20 2020   be ignored..   
-00033bd0: 2020 2020 202a 2049 6620 6060 666f 6c64       * If ``fold
-00033be0: 6572 6060 2069 7320 6120 7265 6c61 7469  er`` is a relati
-00033bf0: 7665 2070 6174 6820 7374 6172 7469 6e67  ve path starting
-00033c00: 2077 6974 6820 6120 646f 7420 6060 2e60   with a dot ``.`
-00033c10: 6020 7468 6520 7265 6c61 7469 7665 2070  ` the relative p
-00033c20: 6174 6820 6973 2061 7070 656e 6465 6420  ath is appended 
-00033c30: 746f 2074 6865 2066 696c 6527 7320 7375  to the file's su
-00033c40: 6264 6972 2e0a 2020 2020 2020 2020 2020  bdir..          
-00033c50: 466f 7220 6578 616d 706c 652c 2060 602e  For example, ``.
-00033c60: 2e5c 6e6f 7465 7360 6020 7769 6c6c 2072  .\notes`` will r
-00033c70: 6573 6f6c 7665 2074 6f20 6120 7369 626c  esolve to a sibl
-00033c80: 696e 6720 6469 7265 6374 6f72 7920 6f66  ing directory of
-00033c90: 2074 6865 206f 6e65 2077 6865 7265 2074   the one where t
-00033ca0: 6865 2060 6066 696c 6560 6020 6973 206c  he ``file`` is l
-00033cb0: 6f63 6174 6564 2e0a 2020 2020 2020 2020  ocated..        
-00033cc0: 2a20 4966 2060 6066 6f6c 6465 7260 6020  * If ``folder`` 
-00033cd0: 6973 2061 2072 656c 6174 6976 6520 7061  is a relative pa
-00033ce0: 7468 2074 6861 7420 646f 6573 206e 6f74  th that does not
-00033cf0: 2062 6567 696e 2077 6974 6820 6120 646f   begin with a do
-00033d00: 7420 6060 2e60 602c 2069 7420 7769 6c6c  t ``.``, it will
-00033d10: 2062 6520 6170 7065 6e64 6564 2074 6f20   be appended to 
-00033d20: 7468 650a 2020 2020 2020 2020 2020 6060  the.          ``
-00033d30: 726f 6f74 5f64 6972 6060 2e0a 2020 2020  root_dir``..    
-00033d40: 2020 7375 6666 6978 3a20 5374 7269 6e67    suffix: String
-00033d50: 2074 6f20 6170 7065 6e64 2074 6f20 7468   to append to th
-00033d60: 6520 6669 6c65 2773 2066 6e61 6d65 2e0a  e file's fname..
-00033d70: 2020 2020 2020 6665 7874 3a20 4669 6c65        fext: File
-00033d80: 2065 7874 656e 7369 6f6e 2074 6f20 6170   extension to ap
-00033d90: 7065 6e64 2074 6f20 7468 6520 2866 6e61  pend to the (fna
-00033da0: 6d65 2b73 7566 6669 7829 2e20 4465 6661  me+suffix). Defa
-00033db0: 756c 7473 2074 6f20 6060 2e74 7376 6060  ults to ``.tsv``
-00033dc0: 2e0a 0a20 2020 2052 6574 7572 6e73 3a0a  ...    Returns:.
-00033dd0: 2020 2020 2020 5468 6520 636f 6e73 7472        The constr
-00033de0: 7563 7465 6420 6669 6c65 2070 6174 682e  ucted file path.
-00033df0: 0a20 2020 2022 2222 0a20 2020 2061 7373  .    """.    ass
-00033e00: 6572 7420 6665 7874 2069 7320 6e6f 7420  ert fext is not 
-00033e10: 4e6f 6e65 2c20 2222 0a20 2020 2070 6174  None, "".    pat
-00033e20: 6820 3d20 636f 6d70 7574 655f 7061 7468  h = compute_path
-00033e30: 5f66 726f 6d5f 6669 6c65 2866 696c 652c  _from_file(file,
-00033e40: 2072 6f6f 745f 6469 723d 726f 6f74 5f64   root_dir=root_d
-00033e50: 6972 2c20 666f 6c64 6572 3d66 6f6c 6465  ir, folder=folde
-00033e60: 7229 0a20 2020 2069 6620 7375 6666 6978  r).    if suffix
-00033e70: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00033e80: 2020 7375 6666 6978 203d 2027 270a 2020    suffix = ''.  
-00033e90: 2020 666e 616d 6520 3d20 6669 6c65 2e66    fname = file.f
-00033ea0: 6e61 6d65 202b 2073 7566 6669 7820 2b20  name + suffix + 
-00033eb0: 6665 7874 0a20 2020 2072 6574 7572 6e20  fext.    return 
-00033ec0: 6f73 2e70 6174 682e 6a6f 696e 2870 6174  os.path.join(pat
-00033ed0: 682c 2066 6e61 6d65 290a 0a64 6566 2073  h, fname)..def s
-00033ee0: 7472 696e 6732 6964 656e 7469 6669 6572  tring2identifier
-00033ef0: 2873 3a20 7374 722c 2072 656d 6f76 655f  (s: str, remove_
-00033f00: 6c65 6164 696e 675f 756e 6465 7273 636f  leading_undersco
-00033f10: 7265 3a20 626f 6f6c 203d 2054 7275 6529  re: bool = True)
-00033f20: 202d 3e20 7374 723a 0a20 2020 2022 2222   -> str:.    """
-00033f30: 5472 616e 7366 6f72 6d20 6120 7374 7269  Transform a stri
-00033f40: 6e67 2069 6e20 6120 7761 7920 7468 6174  ng in a way that
-00033f50: 2069 7420 6361 6e20 6265 2075 7365 6420   it can be used 
-00033f60: 6173 2069 6465 6e74 6966 6965 7220 2876  as identifier (v
-00033f70: 6172 6961 626c 6520 6f72 2061 7474 7269  ariable or attri
-00033f80: 6275 7465 206e 616d 6529 2e0a 2020 2020  bute name)..    
-00033f90: 536f 6c75 7469 6f6e 2062 7920 4b65 6e61  Solution by Kena
-00033fa0: 6e20 4261 6e6b 7320 6f6e 2068 7474 7073  n Banks on https
-00033fb0: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
-00033fc0: 2e63 6f6d 2f61 2f33 3330 3333 3631 0a20  .com/a/3303361. 
-00033fd0: 2020 2022 2222 0a20 2020 2023 2052 656d     """.    # Rem
-00033fe0: 6f76 6520 696e 7661 6c69 6420 6368 6172  ove invalid char
-00033ff0: 6163 7465 7273 0a20 2020 2073 203d 2072  acters.    s = r
-00034000: 652e 7375 6228 275b 5e30 2d39 612d 7a41  e.sub('[^0-9a-zA
-00034010: 2d5a 5f5d 272c 2027 272c 2073 290a 0a20  -Z_]', '', s).. 
-00034020: 2020 2023 2052 656d 6f76 6520 6c65 6164     # Remove lead
-00034030: 696e 6720 6368 6172 6163 7465 7273 2075  ing characters u
-00034040: 6e74 696c 2077 6520 6669 6e64 2061 206c  ntil we find a l
-00034050: 6574 7465 7220 6f72 2075 6e64 6572 7363  etter or undersc
-00034060: 6f72 650a 2020 2020 7265 6765 7820 3d20  ore.    regex = 
-00034070: 275e 5b5e 612d 7a41 2d5a 5d2b 2720 6966  '^[^a-zA-Z]+' if
-00034080: 2072 656d 6f76 655f 6c65 6164 696e 675f   remove_leading_
-00034090: 756e 6465 7273 636f 7265 2065 6c73 6520  underscore else 
-000340a0: 275e 5b5e 612d 7a41 2d5a 5f5d 2b27 0a20  '^[^a-zA-Z_]+'. 
-000340b0: 2020 2073 203d 2072 652e 7375 6228 7265     s = re.sub(re
-000340c0: 6765 782c 2027 272c 2073 290a 0a20 2020  gex, '', s)..   
-000340d0: 2072 6574 7572 6e20 730a 0a40 6c72 755f   return s..@lru_
-000340e0: 6361 6368 6528 290a 4066 756e 6374 696f  cache().@functio
-000340f0: 6e5f 6c6f 6767 6572 0a64 6566 2067 6574  n_logger.def get
-00034100: 5f67 6974 5f63 6f6d 6d69 7428 7265 706f  _git_commit(repo
-00034110: 5f70 6174 683a 2073 7472 2c20 6769 745f  _path: str, git_
-00034120: 7265 7669 7369 6f6e 3a20 7374 7229 202d  revision: str) -
-00034130: 3e20 4f70 7469 6f6e 616c 5b67 6974 2e43  > Optional[git.C
-00034140: 6f6d 6d69 745d 3a0a 2020 2020 7472 793a  ommit]:.    try:
-00034150: 0a20 2020 2020 2020 2072 6570 6f20 3d20  .        repo = 
-00034160: 6769 742e 5265 706f 2872 6570 6f5f 7061  git.Repo(repo_pa
-00034170: 7468 2c20 7365 6172 6368 5f70 6172 656e  th, search_paren
-00034180: 745f 6469 7265 6374 6f72 6965 733d 5472  t_directories=Tr
-00034190: 7565 290a 2020 2020 6578 6365 7074 2045  ue).    except E
-000341a0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-000341b0: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
-000341c0: 726f 7228 6622 7b72 6570 6f5f 7061 7468  ror(f"{repo_path
-000341d0: 7d20 6973 206e 6f74 2061 6e20 6578 6973  } is not an exis
-000341e0: 7469 6e67 2067 6974 2072 6570 6f73 6974  ting git reposit
-000341f0: 6f72 793a 207b 657d 2229 0a20 2020 2020  ory: {e}").     
-00034200: 2020 2072 6574 7572 6e0a 2020 2020 7472     return.    tr
-00034210: 793a 0a20 2020 2020 2020 2072 6574 7572  y:.        retur
-00034220: 6e20 7265 706f 2e63 6f6d 6d69 7428 6769  n repo.commit(gi
-00034230: 745f 7265 7669 7369 6f6e 290a 2020 2020  t_revision).    
-00034240: 6578 6365 7074 2042 6164 4e61 6d65 3a0a  except BadName:.
-00034250: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
-00034260: 7272 6f72 2866 227b 6769 745f 7265 7669  rror(f"{git_revi
-00034270: 7369 6f6e 7d20 646f 6573 206e 6f74 2072  sion} does not r
-00034280: 6573 6f6c 7665 2074 6f20 6120 636f 6d6d  esolve to a comm
-00034290: 6974 2066 6f72 2072 6570 6f20 7b6f 732e  it for repo {os.
-000342a0: 7061 7468 2e62 6173 656e 616d 6528 7265  path.basename(re
-000342b0: 706f 5f70 6174 6829 7d2e 2229 0a0a 0a40  po_path)}.")...@
-000342c0: 6675 6e63 7469 6f6e 5f6c 6f67 6765 720a  function_logger.
-000342d0: 6465 6620 7061 7273 655f 7473 765f 6669  def parse_tsv_fi
-000342e0: 6c65 5f61 745f 6769 745f 7265 7669 7369  le_at_git_revisi
-000342f0: 6f6e 2866 696c 653a 2046 696c 652c 0a20  on(file: File,. 
-00034300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034320: 2020 6769 745f 7265 7669 7369 6f6e 3a20    git_revision: 
-00034330: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
-00034340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034350: 2020 2020 2020 2020 7265 706f 5f70 6174          repo_pat
-00034360: 683a 204f 7074 696f 6e61 6c5b 7374 725d  h: Optional[str]
-00034370: 203d 204e 6f6e 6529 202d 3e20 4669 6c65   = None) -> File
-00034380: 4461 7461 6672 616d 6554 7570 6c65 4d61  DataframeTupleMa
-00034390: 7962 653a 0a20 2020 2022 2222 0a20 2020  ybe:.    """.   
-000343a0: 2050 6173 7320 6120 4669 6c65 206f 626a   Pass a File obj
-000343b0: 6563 7420 6f66 2061 2054 5356 2066 696c  ect of a TSV fil
-000343c0: 6520 616e 6420 616e 2069 6465 6e74 6966  e and an identif
-000343d0: 6965 7220 666f 7220 6120 6769 7420 7265  ier for a git re
-000343e0: 7669 7369 6f6e 2074 6f20 7265 7472 6965  vision to retrie
-000343f0: 7665 2074 6865 2070 6172 7365 6420 5453  ve the parsed TS
-00034400: 5620 6669 6c65 2061 7420 7468 6174 2063  V file at that c
-00034410: 6f6d 6d69 742e 0a20 2020 2054 6865 2066  ommit..    The f
-00034420: 696c 6520 6e65 6564 7320 746f 2068 6176  ile needs to hav
-00034430: 6520 6578 6973 7465 6420 6174 2074 6865  e existed at the
-00034440: 2072 6576 6973 696f 6e20 696e 2071 7565   revision in que
-00034450: 7374 696f 6e2e 0a0a 2020 2020 4172 6773  stion...    Args
-00034460: 3a0a 2020 2020 2020 6669 6c65 3a0a 2020  :.      file:.  
-00034470: 2020 2020 6769 745f 7265 7669 7369 6f6e      git_revision
-00034480: 3a0a 2020 2020 2020 7265 706f 5f70 6174  :.      repo_pat
-00034490: 683a 0a0a 2020 2020 5265 7475 726e 733a  h:..    Returns:
-000344a0: 0a0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
-000344b0: 2066 696c 652e 7479 7065 203d 3d20 2773   file.type == 's
-000344c0: 636f 7265 7327 3a0a 2020 2020 2020 2020  cores':.        
-000344d0: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
-000344e0: 6e74 6564 4572 726f 7228 6622 5061 7273  ntedError(f"Pars
-000344f0: 696e 6720 6f6c 6465 7220 7265 7669 7369  ing older revisi
-00034500: 6f6e 7320 6f66 2073 636f 7265 7320 6973  ons of scores is
-00034510: 206e 6f74 2069 6d70 6c65 6d65 6e74 6564   not implemented
-00034520: 2e20 4368 6563 6b6f 7574 2074 6865 2072  . Checkout the r
-00034530: 6576 6973 696f 6e20 796f 7572 7365 6c66  evision yourself
-00034540: 2e22 290a 2020 2020 6966 2072 6570 6f5f  .").    if repo_
-00034550: 7061 7468 2069 7320 4e6f 6e65 3a0a 2020  path is None:.  
-00034560: 2020 2020 2020 7265 706f 5f70 6174 6820        repo_path 
-00034570: 3d20 6669 6c65 2e63 6f72 7075 735f 7061  = file.corpus_pa
-00034580: 7468 0a20 2020 2063 6f6d 6d69 7420 3d20  th.    commit = 
-00034590: 6765 745f 6769 745f 636f 6d6d 6974 2872  get_git_commit(r
-000345a0: 6570 6f5f 7061 7468 2c20 6769 745f 7265  epo_path, git_re
-000345b0: 7669 7369 6f6e 2c20 6c6f 6767 6572 3d6c  vision, logger=l
-000345c0: 6f67 6765 7229 0a20 2020 2069 6620 636f  ogger).    if co
-000345d0: 6d6d 6974 2069 7320 4e6f 6e65 3a0a 2020  mmit is None:.  
-000345e0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-000345f0: 652c 204e 6f6e 650a 2020 2020 636f 6d6d  e, None.    comm
-00034600: 6974 5f73 6861 203d 2063 6f6d 6d69 742e  it_sha = commit.
-00034610: 6865 7873 6861 0a20 2020 2073 686f 7274  hexsha.    short
-00034620: 5f73 6861 203d 2063 6f6d 6d69 745f 7368  _sha = commit_sh
-00034630: 615b 3a37 5d0a 2020 2020 636f 6d6d 6974  a[:7].    commit
-00034640: 5f69 6e66 6f20 3d20 6622 7b73 686f 7274  _info = f"{short
-00034650: 5f73 6861 7d20 7769 7468 206d 6573 7361  _sha} with messa
-00034660: 6765 2027 7b63 6f6d 6d69 742e 6d65 7373  ge '{commit.mess
-00034670: 6167 652e 7374 7269 7028 297d 2722 0a20  age.strip()}'". 
-00034680: 2020 2069 6620 7368 6f72 745f 7368 6120     if short_sha 
-00034690: 213d 2067 6974 5f72 6576 6973 696f 6e3a  != git_revision:
-000346a0: 0a20 2020 2020 2020 206c 6f67 6765 722e  .        logger.
-000346b0: 6465 6275 6728 6622 5265 736f 6c76 6564  debug(f"Resolved
-000346c0: 2027 7b67 6974 5f72 6576 6973 696f 6e7d   '{git_revision}
-000346d0: 2720 746f 2027 7b73 686f 7274 5f73 6861  ' to '{short_sha
-000346e0: 7d27 2e22 290a 2020 2020 7265 6c5f 7061  }'.").    rel_pa
-000346f0: 7468 203d 206f 732e 7061 7468 2e6e 6f72  th = os.path.nor
-00034700: 6d70 6174 6828 6669 6c65 2e72 656c 5f70  mpath(file.rel_p
-00034710: 6174 6829 0a20 2020 2074 7279 3a0a 2020  ath).    try:.  
-00034720: 2020 2020 2020 7461 7267 6574 6669 6c65        targetfile
-00034730: 203d 2063 6f6d 6d69 742e 7472 6565 202f   = commit.tree /
-00034740: 2072 656c 5f70 6174 680a 2020 2020 6578   rel_path.    ex
-00034750: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
-00034760: 2020 2020 2020 2023 2061 6464 206c 6f67         # add log
-00034770: 6963 2068 6572 6520 746f 2066 696e 6420  ic here to find 
-00034780: 6f6c 6465 7220 7061 7468 2077 6865 6e20  older path when 
-00034790: 7468 6520 6669 6c65 2068 6173 2062 6565  the file has bee
-000347a0: 6e20 6d6f 7665 6420 6f72 2072 656e 616d  n moved or renam
-000347b0: 6564 0a20 2020 2020 2020 206c 6f67 6765  ed.        logge
-000347c0: 722e 6572 726f 7228 6622 7b72 656c 5f70  r.error(f"{rel_p
-000347d0: 6174 687d 2064 6964 206e 6f74 2065 7869  ath} did not exi
-000347e0: 7374 2061 7420 636f 6d6d 6974 207b 636f  st at commit {co
-000347f0: 6d6d 6974 5f69 6e66 6f7d 2e22 290a 2020  mmit_info}.").  
-00034800: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00034810: 652c 204e 6f6e 650a 2020 2020 7472 793a  e, None.    try:
-00034820: 0a20 2020 2020 2020 2077 6974 6820 696f  .        with io
-00034830: 2e42 7974 6573 494f 2874 6172 6765 7466  .BytesIO(targetf
-00034840: 696c 652e 6461 7461 5f73 7472 6561 6d2e  ile.data_stream.
-00034850: 7265 6164 2829 2920 6173 2066 3a0a 2020  read()) as f:.  
-00034860: 2020 2020 2020 2020 2020 7061 7273 6564            parsed
-00034870: 203d 206c 6f61 645f 7473 7628 6629 0a20   = load_tsv(f). 
-00034880: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00034890: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-000348a0: 2020 6c6f 6767 6572 2e65 7272 6f72 2866    logger.error(f
-000348b0: 2250 6172 7369 6e67 207b 7265 6c5f 7061  "Parsing {rel_pa
-000348c0: 7468 7d20 4020 636f 6d6d 6974 207b 636f  th} @ commit {co
-000348d0: 6d6d 6974 5f69 6e66 6f7d 2066 6169 6c65  mmit_info} faile
-000348e0: 6420 7769 7468 2074 6865 2066 6f6c 6c6f  d with the follo
-000348f0: 7769 6e67 2065 7863 6570 7469 6f6e 3a5c  wing exception:\
-00034900: 6e7b 657d 2229 0a20 2020 2020 2020 2072  n{e}").        r
-00034910: 6574 7572 6e20 4e6f 6e65 2c20 4e6f 6e65  eturn None, None
-00034920: 0a20 2020 206e 6577 5f66 696c 6520 3d20  .    new_file = 
-00034930: 6461 7461 636c 6173 7365 732e 7265 706c  dataclasses.repl
-00034940: 6163 6528 6669 6c65 2c20 636f 6d6d 6974  ace(file, commit
-00034950: 5f73 6861 3d63 6f6d 6d69 745f 7368 6129  _sha=commit_sha)
-00034960: 0a20 2020 2072 6574 7572 6e20 6e65 775f  .    return new_
-00034970: 6669 6c65 2c20 7061 7273 6564 0a0a 0a40  file, parsed...@
-00034980: 6675 6e63 7469 6f6e 5f6c 6f67 6765 720a  function_logger.
-00034990: 6465 6620 6368 6563 6b5f 7068 7261 7365  def check_phrase
-000349a0: 5f61 6e6e 6f74 6174 696f 6e73 2864 663a  _annotations(df:
-000349b0: 2070 642e 4461 7461 4672 616d 652c 0a20   pd.DataFrame,. 
-000349c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000349d0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-000349e0: 6d6e 3a20 7374 7229 202d 3e20 626f 6f6c  mn: str) -> bool
-000349f0: 3a0a 2020 2020 2222 2222 2222 0a20 2020  :.    """""".   
-00034a00: 2070 5f63 6f6c 203d 2064 665b 636f 6c75   p_col = df[colu
-00034a10: 6d6e 5d0a 2020 2020 6f70 656e 696e 6720  mn].    opening 
-00034a20: 3d20 705f 636f 6c2e 6669 6c6c 6e61 2827  = p_col.fillna('
-00034a30: 2729 2e73 7472 2e63 6f75 6e74 2827 7b27  ').str.count('{'
-00034a40: 290a 2020 2020 636c 6f73 696e 6720 3d20  ).    closing = 
-00034a50: 705f 636f 6c2e 6669 6c6c 6e61 2827 2729  p_col.fillna('')
-00034a60: 2e73 7472 2e63 6f75 6e74 2827 7d27 290a  .str.count('}').
-00034a70: 2020 2020 6966 2027 6d6e 5f70 6c61 7974      if 'mn_playt
-00034a80: 6872 6f75 6768 2720 696e 2064 662e 636f  hrough' in df.co
-00034a90: 6c75 6d6e 733a 0a20 2020 2020 2020 2070  lumns:.        p
-00034aa0: 6f73 6974 696f 6e5f 636f 6c20 3d20 276d  osition_col = 'm
-00034ab0: 6e5f 706c 6179 7468 726f 7567 6827 0a20  n_playthrough'. 
-00034ac0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00034ad0: 206c 6f67 6765 722e 696e 666f 2866 2243   logger.info(f"C
-00034ae0: 6f6c 756d 6e20 276d 6e5f 706c 6179 7468  olumn 'mn_playth
-00034af0: 726f 7567 6827 2069 7320 6d69 7373 696e  rough' is missin
-00034b00: 672c 2073 6f20 6d79 2061 7373 6573 736d  g, so my assessm
-00034b10: 656e 7420 6f66 2074 6865 2070 6872 6173  ent of the phras
-00034b20: 6520 616e 6e6f 7461 7469 6f6e 7320 6d69  e annotations mi
-00034b30: 6768 7420 6265 2077 726f 6e67 2e22 290a  ght be wrong.").
-00034b40: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
-00034b50: 5f63 6f6c 203d 2027 6d6e 270a 2020 2020  _col = 'mn'.    
-00034b60: 636f 6c75 6d6e 7320 3d20 5b70 6f73 6974  columns = [posit
-00034b70: 696f 6e5f 636f 6c2c 2063 6f6c 756d 6e5d  ion_col, column]
-00034b80: 0a20 2020 2069 6620 6f70 656e 696e 672e  .    if opening.
-00034b90: 7375 6d28 2920 213d 2063 6c6f 7369 6e67  sum() != closing
-00034ba0: 2e73 756d 2829 3a0a 2020 2020 2020 2020  .sum():.        
-00034bb0: 6f20 3d20 6466 2e6c 6f63 5b28 6f70 656e  o = df.loc[(open
-00034bc0: 696e 6720 3e20 3029 2c20 636f 6c75 6d6e  ing > 0), column
-00034bd0: 735d 0a20 2020 2020 2020 2063 203d 2064  s].        c = d
-00034be0: 662e 6c6f 635b 2863 6c6f 7369 6e67 203e  f.loc[(closing >
-00034bf0: 2030 292c 2063 6f6c 756d 6e73 5d0a 2020   0), columns].  
-00034c00: 2020 2020 2020 636f 6d70 6172 6520 3d20        compare = 
-00034c10: 7064 2e63 6f6e 6361 7428 5b6f 2e72 6573  pd.concat([o.res
-00034c20: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
-00034c30: 7565 292c 2063 2e72 6573 6574 5f69 6e64  ue), c.reset_ind
-00034c40: 6578 2864 726f 703d 5472 7565 295d 2c20  ex(drop=True)], 
-00034c50: 6178 6973 3d31 290a 2020 2020 2020 2020  axis=1).        
-00034c60: 6966 2027 6d6e 2720 696e 2063 6f6d 7061  if 'mn' in compa
-00034c70: 7265 3a0a 2020 2020 2020 2020 2020 2020  re:.            
-00034c80: 636f 6d70 6172 6520 3d20 636f 6d70 6172  compare = compar
-00034c90: 652e 6173 7479 7065 287b 276d 6e27 3a20  e.astype({'mn': 
-00034ca0: 2749 6e74 3634 277d 290a 2020 2020 2020  'Int64'}).      
-00034cb0: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
-00034cc0: 2866 2250 6872 6173 6520 6265 6769 6e6e  (f"Phrase beginn
-00034cd0: 696e 6720 616e 6420 656e 6469 6e67 7320  ing and endings 
-00034ce0: 646f 6e27 7420 6d61 7463 683a 5c6e 7b63  don't match:\n{c
-00034cf0: 6f6d 7061 7265 2e74 6f5f 7374 7269 6e67  ompare.to_string
-00034d00: 2869 6e64 6578 3d46 616c 7365 297d 222c  (index=False)}",
-00034d10: 2065 7874 7261 3d7b 226d 6573 7361 6765   extra={"message
-00034d20: 5f69 6422 3a20 2831 362c 297d 290a 2020  _id": (16,)}).  
-00034d30: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00034d40: 7365 0a20 2020 2072 6574 7572 6e20 5472  se.    return Tr
-00034d50: 7565 0a                                  ue.
+00026c30: 205b 302c 2031 2c20 312c 2030 2c20 312c   [0, 1, 1, 0, 1,
+00026c40: 2031 2c20 315d 5d29 0a20 2020 2072 656c   1, 1]]).    rel
+00026c50: 6174 6976 655f 6163 6369 6465 6e74 616c  ative_accidental
+00026c60: 732c 2072 656c 6174 6976 6520 3d20 7370  s, relative = sp
+00026c70: 6c69 745f 7363 616c 655f 6465 6772 6565  lit_scale_degree
+00026c80: 2872 656c 6174 6976 652c 2063 6f75 6e74  (relative, count
+00026c90: 3d54 7275 652c 206c 6f67 6765 723d 6c6f  =True, logger=lo
+00026ca0: 6767 6572 290a 2020 2020 6c6f 6361 6c6b  gger).    localk
+00026cb0: 6579 5f61 6363 6964 656e 7461 6c73 2c20  ey_accidentals, 
+00026cc0: 6c6f 6361 6c6b 6579 203d 2073 706c 6974  localkey = split
+00026cd0: 5f73 6361 6c65 5f64 6567 7265 6528 6c6f  _scale_degree(lo
+00026ce0: 6361 6c6b 6579 2c20 636f 756e 743d 5472  calkey, count=Tr
+00026cf0: 7565 2c20 6c6f 6767 6572 3d6c 6f67 6765  ue, logger=logge
+00026d00: 7229 0a20 2020 2072 6573 756c 7469 6e67  r).    resulting
+00026d10: 5f61 6363 6964 656e 7461 6c73 203d 2072  _accidentals = r
+00026d20: 656c 6174 6976 655f 6163 6369 6465 6e74  elative_accident
+00026d30: 616c 7320 2b20 6c6f 6361 6c6b 6579 5f61  als + localkey_a
+00026d40: 6363 6964 656e 7461 6c73 0a20 2020 206e  ccidentals.    n
+00026d50: 756d 6572 616c 7320 3d20 6d61 6a5f 726e  umerals = maj_rn
+00026d60: 2069 6620 7265 6c61 7469 7665 2e69 7375   if relative.isu
+00026d70: 7070 6572 2829 2065 6c73 6520 6d69 6e5f  pper() else min_
+00026d80: 726e 0a20 2020 2072 656c 5f6e 756d 203d  rn.    rel_num =
+00026d90: 206e 756d 6572 616c 732e 696e 6465 7828   numerals.index(
+00026da0: 7265 6c61 7469 7665 290a 2020 2020 6c6f  relative).    lo
+00026db0: 6361 6c6b 6579 5f69 6e64 6578 203d 206d  calkey_index = m
+00026dc0: 616a 5f72 6e2e 696e 6465 7828 6c6f 6361  aj_rn.index(loca
+00026dd0: 6c6b 6579 2e75 7070 6572 2829 290a 2020  lkey.upper()).  
+00026de0: 2020 7265 7375 6c74 5f6e 756d 6572 616c    result_numeral
+00026df0: 203d 206e 756d 6572 616c 735b 2872 656c   = numerals[(rel
+00026e00: 5f6e 756d 202b 206c 6f63 616c 6b65 795f  _num + localkey_
+00026e10: 696e 6465 7829 2025 2037 5d0a 2020 2020  index) % 7].    
+00026e20: 6966 206c 6f63 616c 6b65 792e 6973 6c6f  if localkey.islo
+00026e30: 7765 7228 2920 616e 6420 7265 6c5f 6e75  wer() and rel_nu
+00026e40: 6d20 696e 205b 322c 2035 2c20 365d 3a0a  m in [2, 5, 6]:.
+00026e50: 2020 2020 2020 2020 7265 7375 6c74 696e          resultin
+00026e60: 675f 6163 6369 6465 6e74 616c 7320 2d3d  g_accidentals -=
+00026e70: 2031 0a20 2020 2069 6620 676c 6f62 616c   1.    if global
+00026e80: 5f6d 696e 6f72 3a0a 2020 2020 2020 2020  _minor:.        
+00026e90: 6c6f 6361 6c6b 6579 5f69 6e64 6578 203d  localkey_index =
+00026ea0: 2028 6c6f 6361 6c6b 6579 5f69 6e64 6578   (localkey_index
+00026eb0: 202d 2032 2920 2520 370a 2020 2020 7265   - 2) % 7.    re
+00026ec0: 7375 6c74 696e 675f 6163 6369 6465 6e74  sulting_accident
+00026ed0: 616c 7320 2b3d 2077 6869 7465 5f6b 6579  als += white_key
+00026ee0: 5f6d 616a 6f72 5f61 6363 6964 656e 7461  _major_accidenta
+00026ef0: 6c73 5b72 656c 5f6e 756d 5d5b 6c6f 6361  ls[rel_num][loca
+00026f00: 6c6b 6579 5f69 6e64 6578 5d0a 2020 2020  lkey_index].    
+00026f10: 6163 6320 3d20 7265 7375 6c74 696e 675f  acc = resulting_
+00026f20: 6163 6369 6465 6e74 616c 7320 2a20 2723  accidentals * '#
+00026f30: 2720 6966 2072 6573 756c 7469 6e67 5f61  ' if resulting_a
+00026f40: 6363 6964 656e 7461 6c73 203e 2030 2065  ccidentals > 0 e
+00026f50: 6c73 6520 2d72 6573 756c 7469 6e67 5f61  lse -resulting_a
+00026f60: 6363 6964 656e 7461 6c73 202a 2027 6227  ccidentals * 'b'
+00026f70: 0a20 2020 2072 6574 7572 6e20 6163 6320  .    return acc 
+00026f80: 2b20 7265 7375 6c74 5f6e 756d 6572 616c  + result_numeral
+00026f90: 0a0a 0a40 6675 6e63 7469 6f6e 5f6c 6f67  ...@function_log
+00026fa0: 6765 720a 6465 6620 6d61 6b65 5f69 6e74  ger.def make_int
+00026fb0: 6572 7661 6c5f 696e 6465 785f 6672 6f6d  erval_index_from
+00026fc0: 5f64 7572 6174 696f 6e73 2864 662c 2070  _durations(df, p
+00026fd0: 6f73 6974 696f 6e5f 636f 6c3d 2771 7561  osition_col='qua
+00026fe0: 7274 6572 6265 6174 7327 2c20 6475 7261  rterbeats', dura
+00026ff0: 7469 6f6e 5f63 6f6c 3d27 6475 7261 7469  tion_col='durati
+00027000: 6f6e 5f71 6227 2c20 636c 6f73 6564 3d27  on_qb', closed='
+00027010: 6c65 6674 272c 0a20 2020 2020 2020 2020  left',.         
+00027020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027030: 2020 2020 2020 726f 756e 643d 4e6f 6e65        round=None
+00027040: 2c20 6e61 6d65 3d27 696e 7465 7276 616c  , name='interval
+00027050: 2729 3a0a 2020 2020 2222 2247 6976 656e  '):.    """Given
+00027060: 2061 6e20 616e 6e6f 7461 7469 6f6e 7320   an annotations 
+00027070: 7461 626c 6520 7769 7468 2070 6f73 6974  table with posit
+00027080: 696f 6e73 2061 6e64 2064 7572 6174 696f  ions and duratio
+00027090: 6e73 2c20 6372 6561 7465 2061 6e20 3a6f  ns, create an :o
+000270a0: 626a 3a60 7061 6e64 6173 2e49 6e74 6572  bj:`pandas.Inter
+000270b0: 7661 6c49 6e64 6578 602e 0a20 2020 2052  valIndex`..    R
+000270c0: 6574 7572 6e73 204e 6f6e 6520 6966 2061  eturns None if a
+000270d0: 6e79 2072 6f77 2069 7320 756e 6465 7273  ny row is unders
+000270e0: 7065 6369 6669 6564 2e0a 0a20 2020 2050  pecified...    P
+000270f0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00027100: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064 6620  --------.    df 
+00027110: 3a20 3a6f 626a 3a60 7061 6e64 6173 2e44  : :obj:`pandas.D
+00027120: 6174 6146 7261 6d65 600a 2020 2020 2020  ataFrame`.      
+00027130: 2020 416e 6e6f 7461 7469 6f6e 2074 6162    Annotation tab
+00027140: 6c65 2063 6f6e 7461 696e 696e 6720 7468  le containing th
+00027150: 6520 636f 6c75 6d6e 7320 6f66 2060 6070  e columns of ``p
+00027160: 6f73 6974 696f 6e5f 636f 6c60 6020 2864  osition_col`` (d
+00027170: 6566 6175 6c74 3a20 2771 7561 7274 6572  efault: 'quarter
+00027180: 6265 6174 7327 2920 616e 6420 6060 6475  beats') and ``du
+00027190: 7261 7469 6f6e 5f63 6f6c 6060 0a20 2020  ration_col``.   
+000271a0: 2020 2020 2064 6566 6175 6c74 3a20 2764       default: 'd
+000271b0: 7572 6174 696f 6e5f 7162 2729 2e0a 2020  uration_qb')..  
+000271c0: 2020 706f 7369 7469 6f6e 5f63 6f6c 203a    position_col :
+000271d0: 203a 6f62 6a3a 6073 7472 602c 206f 7074   :obj:`str`, opt
+000271e0: 696f 6e61 6c0a 2020 2020 2020 2020 4e61  ional.        Na
+000271f0: 6d65 206f 6620 7468 6520 636f 6c75 6d6e  me of the column
+00027200: 2063 6f6e 7461 696e 696e 6720 706f 7369   containing posi
+00027210: 7469 6f6e 732c 2075 7365 6420 6173 206c  tions, used as l
+00027220: 6566 7420 626f 756e 6461 7269 6573 2e0a  eft boundaries..
+00027230: 2020 2020 6475 7261 7469 6f6e 5f63 6f6c      duration_col
+00027240: 203a 203a 6f62 6a3a 6073 7472 602c 206f   : :obj:`str`, o
+00027250: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00027260: 4e61 6d65 206f 6620 7468 6520 636f 6c75  Name of the colu
+00027270: 6d6e 2063 6f6e 7461 696e 696e 6720 6475  mn containing du
+00027280: 7261 7469 6f6e 7320 7768 6963 6820 7769  rations which wi
+00027290: 6c6c 2062 6520 6164 6465 6420 746f 2074  ll be added to t
+000272a0: 6865 2070 6f73 6974 696f 6e73 2074 6f20  he positions to 
+000272b0: 6f62 7461 696e 2072 6967 6874 2062 6f75  obtain right bou
+000272c0: 6e64 6172 6965 732e 0a20 2020 2063 6c6f  ndaries..    clo
+000272d0: 7365 6420 3a20 3a6f 626a 3a60 7374 7260  sed : :obj:`str`
+000272e0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+000272f0: 2020 2027 6c65 6674 272c 2027 7269 6768     'left', 'righ
+00027300: 7427 206f 7220 2762 6f74 6827 203c 2d20  t' or 'both' <- 
+00027310: 6465 6669 6e69 6e67 2074 6865 2069 6e74  defining the int
+00027320: 6572 7661 6c20 626f 756e 6461 7269 6573  erval boundaries
+00027330: 0a20 2020 2072 6f75 6e64 203a 203a 6f62  .    round : :ob
+00027340: 6a3a 6069 6e74 602c 206f 7074 696f 6e61  j:`int`, optiona
+00027350: 6c0a 2020 2020 2020 2020 546f 2068 6f77  l.        To how
+00027360: 206d 616e 7920 6465 6369 6d61 6c20 706c   many decimal pl
+00027370: 6163 6573 2074 6f20 726f 756e 6420 7468  aces to round th
+00027380: 6520 696e 7465 7276 616c 7327 2062 6f75  e intervals' bou
+00027390: 6e64 6172 7920 7661 6c75 6573 2e0a 2020  ndary values..  
+000273a0: 2020 6e61 6d65 203a 203a 6f62 6a3a 6073    name : :obj:`s
+000273b0: 7472 602c 206f 7074 696f 6e61 6c0a 2020  tr`, optional.  
+000273c0: 2020 2020 2020 4e61 6d65 206f 6620 7468        Name of th
+000273d0: 6520 6372 6561 7465 6420 696e 6465 782e  e created index.
+000273e0: 2044 6566 6175 6c74 7320 746f 2027 696e   Defaults to 'in
+000273f0: 7465 7276 616c 272e 0a0a 2020 2020 5265  terval'...    Re
+00027400: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00027410: 2d0a 2020 2020 3a6f 626a 3a60 7061 6e64  -.    :obj:`pand
+00027420: 6173 2e49 6e74 6572 7661 6c49 6e64 6578  as.IntervalIndex
+00027430: 600a 2020 2020 2020 2020 4120 636f 7079  `.        A copy
+00027440: 206f 6620 6060 6466 6060 2077 6974 6820   of ``df`` with 
+00027450: 7468 6520 6f72 6967 696e 616c 2069 6e64  the original ind
+00027460: 6578 2072 6570 6c61 6365 6420 616e 6420  ex replaced and 
+00027470: 756e 6465 7273 7065 6369 6669 6564 2072  underspecified r
+00027480: 6f77 7320 7265 6d6f 7665 6420 2874 686f  ows removed (tho
+00027490: 7365 2077 6865 7265 206e 6f20 696e 7465  se where no inte
+000274a0: 7276 616c 0a20 2020 2020 2020 2063 6f75  rval.        cou
+000274b0: 6c64 2062 6520 636f 7075 7465 6429 2e0a  ld be coputed)..
+000274c0: 2020 2020 2222 220a 2020 2020 6966 206e      """.    if n
+000274d0: 6f74 2061 6c6c 2863 2069 6e20 6466 2e63  ot all(c in df.c
+000274e0: 6f6c 756d 6e73 2066 6f72 2063 2069 6e20  olumns for c in 
+000274f0: 2870 6f73 6974 696f 6e5f 636f 6c2c 2064  (position_col, d
+00027500: 7572 6174 696f 6e5f 636f 6c29 293a 0a20  uration_col)):. 
+00027510: 2020 2020 2020 206d 6973 7369 6e67 203d         missing =
+00027520: 205b 6320 666f 7220 6320 696e 2028 706f   [c for c in (po
+00027530: 7369 7469 6f6e 5f63 6f6c 2c20 6475 7261  sition_col, dura
+00027540: 7469 6f6e 5f63 6f6c 2920 6966 2063 206e  tion_col) if c n
+00027550: 6f74 2069 6e20 6466 2e63 6f6c 756d 6e73  ot in df.columns
+00027560: 5d0a 2020 2020 2020 2020 706c 7572 616c  ].        plural
+00027570: 203d 2027 7327 2069 6620 6c65 6e28 6d69   = 's' if len(mi
+00027580: 7373 696e 6729 203e 2031 2065 6c73 6520  ssing) > 1 else 
+00027590: 2727 0a20 2020 2020 2020 206c 6f67 6765  ''.        logge
+000275a0: 722e 7761 726e 696e 6728 6622 436f 6c75  r.warning(f"Colu
+000275b0: 6d6e 7b70 6c75 7261 6c7d 206e 6f74 2070  mn{plural} not p
+000275c0: 7265 7365 6e74 2069 6e20 4461 7461 4672  resent in DataFr
+000275d0: 616d 653a 207b 272c 2027 2e6a 6f69 6e28  ame: {', '.join(
+000275e0: 6d69 7373 696e 6729 7d22 290a 2020 2020  missing)}").    
+000275f0: 2020 2020 7265 7475 726e 0a20 2020 2069      return.    i
+00027600: 6620 6466 5b70 6f73 6974 696f 6e5f 636f  f df[position_co
+00027610: 6c5d 2e69 736e 6128 292e 616e 7928 2920  l].isna().any() 
+00027620: 6f72 2064 665b 6475 7261 7469 6f6e 5f63  or df[duration_c
+00027630: 6f6c 5d2e 6973 6e61 2829 2e61 6e79 2829  ol].isna().any()
+00027640: 3a0a 2020 2020 2020 2020 6d69 7373 696e  :.        missin
+00027650: 6720 3d20 6466 5b64 665b 5b70 6f73 6974  g = df[df[[posit
+00027660: 696f 6e5f 636f 6c2c 2064 7572 6174 696f  ion_col, duratio
+00027670: 6e5f 636f 6c5d 5d2e 6973 6e61 2829 2e61  n_col]].isna().a
+00027680: 6e79 2861 7869 733d 3129 5d0a 2020 2020  ny(axis=1)].    
+00027690: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
+000276a0: 6e67 2866 2243 6f75 6c64 206e 6f74 206d  ng(f"Could not m
+000276b0: 616b 6520 496e 7465 7276 616c 496e 6465  ake IntervalInde
+000276c0: 7820 6265 6361 7573 6520 6f66 206d 6973  x because of mis
+000276d0: 7369 6e67 2076 616c 7565 733a 5c6e 7b6d  sing values:\n{m
+000276e0: 6973 7369 6e67 7d22 290a 2020 2020 2020  issing}").      
+000276f0: 2020 7265 7475 726e 0a20 2020 2074 7279    return.    try
+00027700: 3a0a 2020 2020 2020 2020 6c65 6674 203d  :.        left =
+00027710: 2064 665b 706f 7369 7469 6f6e 5f63 6f6c   df[position_col
+00027720: 5d2e 6173 7479 7065 2866 6c6f 6174 290a  ].astype(float).
+00027730: 2020 2020 2020 2020 7269 6768 7420 3d20          right = 
+00027740: 286c 6566 7420 2b20 6466 5b64 7572 6174  (left + df[durat
+00027750: 696f 6e5f 636f 6c5d 292e 6173 7479 7065  ion_col]).astype
+00027760: 2866 6c6f 6174 290a 2020 2020 2020 2020  (float).        
+00027770: 6966 2072 6f75 6e64 2069 7320 6e6f 7420  if round is not 
+00027780: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00027790: 2020 6c65 6674 2c20 7269 6768 7420 3d20    left, right = 
+000277a0: 6c65 6674 2e72 6f75 6e64 2872 6f75 6e64  left.round(round
+000277b0: 292c 2072 6967 6874 2e72 6f75 6e64 2872  ), right.round(r
+000277c0: 6f75 6e64 290a 2020 2020 2020 2020 7265  ound).        re
+000277d0: 7475 726e 2070 642e 496e 7465 7276 616c  turn pd.Interval
+000277e0: 496e 6465 782e 6672 6f6d 5f61 7272 6179  Index.from_array
+000277f0: 7328 6c65 6674 3d6c 6566 742c 2072 6967  s(left=left, rig
+00027800: 6874 3d72 6967 6874 2c20 636c 6f73 6564  ht=right, closed
+00027810: 3d63 6c6f 7365 642c 206e 616d 653d 6e61  =closed, name=na
+00027820: 6d65 290a 2020 2020 6578 6365 7074 2045  me).    except E
+00027830: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+00027840: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
+00027850: 726e 696e 6728 6622 4372 6561 7469 6e67  rning(f"Creating
+00027860: 2049 6e74 6572 7661 6c49 6e64 6578 2066   IntervalIndex f
+00027870: 6169 6c65 6420 7769 7468 2065 7863 6570  ailed with excep
+00027880: 7469 6f6e 207b 657d 2e22 290a 0a40 6675  tion {e}.")..@fu
+00027890: 6e63 7469 6f6e 5f6c 6f67 6765 720a 6465  nction_logger.de
+000278a0: 6620 7265 706c 6163 655f 696e 6465 785f  f replace_index_
+000278b0: 6279 5f69 6e74 6572 7661 6c73 2864 662c  by_intervals(df,
+000278c0: 2070 6f73 6974 696f 6e5f 636f 6c3d 2771   position_col='q
+000278d0: 7561 7274 6572 6265 6174 7327 2c20 6475  uarterbeats', du
+000278e0: 7261 7469 6f6e 5f63 6f6c 3d27 6475 7261  ration_col='dura
+000278f0: 7469 6f6e 5f71 6227 2c20 636c 6f73 6564  tion_qb', closed
+00027900: 3d27 6c65 6674 272c 0a20 2020 2020 2020  ='left',.       
+00027910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027920: 2020 2020 2020 2020 6669 6c74 6572 5f7a          filter_z
+00027930: 6572 6f5f 6475 7261 7469 6f6e 3d46 616c  ero_duration=Fal
+00027940: 7365 2c20 726f 756e 643d 4e6f 6e65 2c20  se, round=None, 
+00027950: 6e61 6d65 3d27 696e 7465 7276 616c 2729  name='interval')
+00027960: 3a0a 2020 2020 2222 2247 6976 656e 2061  :.    """Given a
+00027970: 6e20 616e 6e6f 7461 7469 6f6e 7320 7461  n annotations ta
+00027980: 626c 6520 7769 7468 2070 6f73 6974 696f  ble with positio
+00027990: 6e73 2061 6e64 2064 7572 6174 696f 6e73  ns and durations
+000279a0: 2c20 7265 706c 6163 6573 2069 7473 2069  , replaces its i
+000279b0: 6e64 6578 2077 6974 6820 616e 203a 6f62  ndex with an :ob
+000279c0: 6a3a 6070 616e 6461 732e 496e 7465 7276  j:`pandas.Interv
+000279d0: 616c 496e 6465 7860 2e0a 2020 2020 556e  alIndex`..    Un
+000279e0: 6465 7273 7065 6369 6669 6564 2072 6f77  derspecified row
+000279f0: 7320 6172 6520 7265 6d6f 7665 642e 0a0a  s are removed...
+00027a00: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00027a10: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00027a20: 2020 6466 203a 203a 6f62 6a3a 6070 616e    df : :obj:`pan
+00027a30: 6461 732e 4461 7461 4672 616d 6560 0a20  das.DataFrame`. 
+00027a40: 2020 2020 2020 2041 6e6e 6f74 6174 696f         Annotatio
+00027a50: 6e20 7461 626c 6520 636f 6e74 6169 6e69  n table containi
+00027a60: 6e67 2074 6865 2063 6f6c 756d 6e73 206f  ng the columns o
+00027a70: 6620 6060 706f 7369 7469 6f6e 5f63 6f6c  f ``position_col
+00027a80: 6060 2028 6465 6661 756c 743a 2027 7175  `` (default: 'qu
+00027a90: 6172 7465 7262 6561 7473 2729 2061 6e64  arterbeats') and
+00027aa0: 2060 6064 7572 6174 696f 6e5f 636f 6c60   ``duration_col`
+00027ab0: 600a 2020 2020 2020 2020 6465 6661 756c  `.        defaul
+00027ac0: 743a 2027 6475 7261 7469 6f6e 5f71 6227  t: 'duration_qb'
+00027ad0: 292e 0a20 2020 2070 6f73 6974 696f 6e5f  )..    position_
+00027ae0: 636f 6c20 3a20 3a6f 626a 3a60 7374 7260  col : :obj:`str`
+00027af0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00027b00: 2020 204e 616d 6520 6f66 2074 6865 2063     Name of the c
+00027b10: 6f6c 756d 6e20 636f 6e74 6169 6e69 6e67  olumn containing
+00027b20: 2070 6f73 6974 696f 6e73 2e0a 2020 2020   positions..    
+00027b30: 6475 7261 7469 6f6e 5f63 6f6c 203a 203a  duration_col : :
+00027b40: 6f62 6a3a 6073 7472 602c 206f 7074 696f  obj:`str`, optio
+00027b50: 6e61 6c0a 2020 2020 2020 2020 4e61 6d65  nal.        Name
+00027b60: 206f 6620 7468 6520 636f 6c75 6d6e 2063   of the column c
+00027b70: 6f6e 7461 696e 696e 6720 6475 7261 7469  ontaining durati
+00027b80: 6f6e 732e 0a20 2020 2063 6c6f 7365 6420  ons..    closed 
+00027b90: 3a20 3a6f 626a 3a60 7374 7260 2c20 6f70  : :obj:`str`, op
+00027ba0: 7469 6f6e 616c 0a20 2020 2020 2020 2027  tional.        '
+00027bb0: 6c65 6674 272c 2027 7269 6768 7427 206f  left', 'right' o
+00027bc0: 7220 2762 6f74 6827 203c 2d20 6465 6669  r 'both' <- defi
+00027bd0: 6e69 6e67 2074 6865 2069 6e74 6572 7661  ning the interva
+00027be0: 6c20 626f 756e 6461 7269 6573 0a20 2020  l boundaries.   
+00027bf0: 2066 696c 7465 725f 7a65 726f 5f64 7572   filter_zero_dur
+00027c00: 6174 696f 6e20 3a20 3a6f 626a 3a60 626f  ation : :obj:`bo
+00027c10: 6f6c 602c 206f 7074 696f 6e61 6c0a 2020  ol`, optional.  
+00027c20: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
+00027c30: 6f20 4661 6c73 652c 206d 6561 6e69 6e67  o False, meaning
+00027c40: 2074 6861 7420 726f 7773 2077 6974 6820   that rows with 
+00027c50: 7a65 726f 2064 7572 6174 696f 6e73 2061  zero durations a
+00027c60: 7265 206d 6169 6e74 6169 6e65 642e 2050  re maintained. P
+00027c70: 6173 7320 5472 7565 2074 6f20 7265 6d6f  ass True to remo
+00027c80: 7665 2074 6865 6d2e 0a20 2020 2072 6f75  ve them..    rou
+00027c90: 6e64 203a 203a 6f62 6a3a 6069 6e74 602c  nd : :obj:`int`,
+00027ca0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00027cb0: 2020 546f 2068 6f77 206d 616e 7920 6465    To how many de
+00027cc0: 6369 6d61 6c20 706c 6163 6573 2074 6f20  cimal places to 
+00027cd0: 726f 756e 6420 7468 6520 696e 7465 7276  round the interv
+00027ce0: 616c 7327 2062 6f75 6e64 6172 7920 7661  als' boundary va
+00027cf0: 6c75 6573 2e0a 2020 2020 6e61 6d65 203a  lues..    name :
+00027d00: 203a 6f62 6a3a 6073 7472 602c 206f 7074   :obj:`str`, opt
+00027d10: 696f 6e61 6c0a 2020 2020 2020 2020 4e61  ional.        Na
+00027d20: 6d65 206f 6620 7468 6520 6372 6561 7465  me of the create
+00027d30: 6420 696e 6465 782e 2044 6566 6175 6c74  d index. Default
+00027d40: 7320 746f 2027 696e 7465 7276 616c 272e  s to 'interval'.
+00027d50: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
+00027d60: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 3a6f    -------.    :o
+00027d70: 626a 3a60 7061 6e64 6173 2e44 6174 6146  bj:`pandas.DataF
+00027d80: 7261 6d65 600a 2020 2020 2020 2020 4120  rame`.        A 
+00027d90: 636f 7079 206f 6620 6060 6466 6060 2077  copy of ``df`` w
+00027da0: 6974 6820 7468 6520 6f72 6967 696e 616c  ith the original
+00027db0: 2069 6e64 6578 2072 6570 6c61 6365 6420   index replaced 
+00027dc0: 616e 6420 756e 6465 7273 7065 6369 6669  and underspecifi
+00027dd0: 6564 2072 6f77 7320 7265 6d6f 7665 6420  ed rows removed 
+00027de0: 2874 686f 7365 2077 6865 7265 206e 6f20  (those where no 
+00027df0: 696e 7465 7276 616c 0a20 2020 2020 2020  interval.       
+00027e00: 2063 6f75 6c64 2062 6520 636f 6d70 7574   could be comput
+00027e10: 6564 292e 0a20 2020 2022 2222 0a20 2020  ed)..    """.   
+00027e20: 2069 6620 6e6f 7420 616c 6c28 6320 696e   if not all(c in
+00027e30: 2064 662e 636f 6c75 6d6e 7320 666f 7220   df.columns for 
+00027e40: 6320 696e 2028 706f 7369 7469 6f6e 5f63  c in (position_c
+00027e50: 6f6c 2c20 6475 7261 7469 6f6e 5f63 6f6c  ol, duration_col
+00027e60: 2929 3a0a 2020 2020 2020 2020 6d69 7373  )):.        miss
+00027e70: 696e 6720 3d20 5b63 2066 6f72 2063 2069  ing = [c for c i
+00027e80: 6e20 2870 6f73 6974 696f 6e5f 636f 6c2c  n (position_col,
+00027e90: 2064 7572 6174 696f 6e5f 636f 6c29 2069   duration_col) i
+00027ea0: 6620 6320 6e6f 7420 696e 2064 662e 636f  f c not in df.co
+00027eb0: 6c75 6d6e 735d 0a20 2020 2020 2020 2070  lumns].        p
+00027ec0: 6c75 7261 6c20 3d20 2773 2720 6966 206c  lural = 's' if l
+00027ed0: 656e 286d 6973 7369 6e67 2920 3e20 3120  en(missing) > 1 
+00027ee0: 656c 7365 2027 270a 2020 2020 2020 2020  else ''.        
+00027ef0: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
+00027f00: 2243 6f6c 756d 6e7b 706c 7572 616c 7d20  "Column{plural} 
+00027f10: 6e6f 7420 7072 6573 656e 7420 696e 2044  not present in D
+00027f20: 6174 6146 7261 6d65 3a20 7b27 2c20 272e  ataFrame: {', '.
+00027f30: 6a6f 696e 286d 6973 7369 6e67 297d 2229  join(missing)}")
+00027f40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00027f50: 6466 0a20 2020 206d 6173 6b20 3d20 6466  df.    mask = df
+00027f60: 5b70 6f73 6974 696f 6e5f 636f 6c5d 2e6e  [position_col].n
+00027f70: 6f74 6e61 2829 2026 2028 6466 5b70 6f73  otna() & (df[pos
+00027f80: 6974 696f 6e5f 636f 6c5d 2021 3d20 2727  ition_col] != ''
+00027f90: 2920 2620 6466 5b64 7572 6174 696f 6e5f  ) & df[duration_
+00027fa0: 636f 6c5d 2e6e 6f74 6e61 2829 0a20 2020  col].notna().   
+00027fb0: 206e 5f64 726f 7070 6564 203d 2028 7e6d   n_dropped = (~m
+00027fc0: 6173 6b29 2e73 756d 2829 0a20 2020 2069  ask).sum().    i
+00027fd0: 6620 6669 6c74 6572 5f7a 6572 6f5f 6475  f filter_zero_du
+00027fe0: 7261 7469 6f6e 3a0a 2020 2020 2020 2020  ration:.        
+00027ff0: 6d61 736b 2026 3d20 2864 665b 6475 7261  mask &= (df[dura
+00028000: 7469 6f6e 5f63 6f6c 5d20 3e20 3029 0a20  tion_col] > 0). 
+00028010: 2020 2065 6c69 6620 6e5f 6472 6f70 7065     elif n_droppe
+00028020: 6420 3e20 303a 0a20 2020 2020 2020 206c  d > 0:.        l
+00028030: 6f67 6765 722e 696e 666f 2866 2248 6164  ogger.info(f"Had
+00028040: 2074 6f20 6472 6f70 207b 6e5f 6472 6f70   to drop {n_drop
+00028050: 7065 647d 2072 6f77 7320 666f 7220 6372  ped} rows for cr
+00028060: 6561 7469 6e67 2074 6865 2049 6e74 6572  eating the Inter
+00028070: 7661 6c49 6e64 6578 3a5c 6e7b 6466 5b7e  valIndex:\n{df[~
+00028080: 6d61 736b 5d7d 2229 0a20 2020 2064 6620  mask]}").    df 
+00028090: 3d20 6466 5b6d 6173 6b5d 2e63 6f70 7928  = df[mask].copy(
+000280a0: 290a 2020 2020 6976 5f69 6e64 6578 203d  ).    iv_index =
+000280b0: 206d 616b 655f 696e 7465 7276 616c 5f69   make_interval_i
+000280c0: 6e64 6578 5f66 726f 6d5f 6475 7261 7469  ndex_from_durati
+000280d0: 6f6e 7328 6466 2c20 706f 7369 7469 6f6e  ons(df, position
+000280e0: 5f63 6f6c 3d70 6f73 6974 696f 6e5f 636f  _col=position_co
+000280f0: 6c2c 2064 7572 6174 696f 6e5f 636f 6c3d  l, duration_col=
+00028100: 6475 7261 7469 6f6e 5f63 6f6c 2c0a 2020  duration_col,.  
+00028110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028120: 2020 636c 6f73 6564 3d63 6c6f 7365 642c    closed=closed,
+00028130: 2072 6f75 6e64 3d72 6f75 6e64 2c20 6e61   round=round, na
+00028140: 6d65 3d6e 616d 652c 206c 6f67 6765 723d  me=name, logger=
+00028150: 6c6f 6767 6572 290a 2020 2020 6966 2064  logger).    if d
+00028160: 665b 6475 7261 7469 6f6e 5f63 6f6c 5d2e  f[duration_col].
+00028170: 6474 7970 6520 213d 2066 6c6f 6174 3a0a  dtype != float:.
+00028180: 2020 2020 2020 2020 7769 7468 2077 6172          with war
+00028190: 6e69 6e67 732e 6361 7463 685f 7761 726e  nings.catch_warn
+000281a0: 696e 6773 2829 3a0a 2020 2020 2020 2020  ings():.        
+000281b0: 2020 2020 2320 5365 7474 696e 6720 7661      # Setting va
+000281c0: 6c75 6573 2069 6e2d 706c 6163 6520 6973  lues in-place is
+000281d0: 2066 696e 652c 2069 676e 6f72 6520 7468   fine, ignore th
+000281e0: 6520 7761 726e 696e 6720 696e 2050 616e  e warning in Pan
+000281f0: 6461 7320 3e3d 2031 2e35 2e30 0a20 2020  das >= 1.5.0.   
+00028200: 2020 2020 2020 2020 2023 2054 6869 7320           # This 
+00028210: 6361 6e20 6265 2072 656d 6f76 6564 2c20  can be removed, 
+00028220: 6966 2050 616e 6461 7320 312e 352e 3020  if Pandas 1.5.0 
+00028230: 646f 6573 206e 6f74 206e 6565 6420 746f  does not need to
+00028240: 2062 6520 7375 7070 6f72 7465 6420 616e   be supported an
+00028250: 7920 6c6f 6e67 6572 2e0a 2020 2020 2020  y longer..      
+00028260: 2020 2020 2020 2320 5365 6520 616c 736f        # See also
+00028270: 3a20 6874 7470 733a 2f2f 7374 6163 6b6f  : https://stacko
+00028280: 7665 7266 6c6f 772e 636f 6d2f 712f 3734  verflow.com/q/74
+00028290: 3035 3733 3637 2f38 3539 3539 310a 2020  057367/859591.  
+000282a0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+000282b0: 6773 2e66 696c 7465 7277 6172 6e69 6e67  gs.filterwarning
+000282c0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+000282d0: 2020 2022 6967 6e6f 7265 222c 0a20 2020     "ignore",.   
+000282e0: 2020 2020 2020 2020 2020 2020 2063 6174               cat
+000282f0: 6567 6f72 793d 4675 7475 7265 5761 726e  egory=FutureWarn
+00028300: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
+00028310: 2020 2020 206d 6573 7361 6765 3d28 0a20       message=(. 
+00028320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028330: 2020 2022 2e2a 7769 6c6c 2061 7474 656d     ".*will attem
+00028340: 7074 2074 6f20 7365 7420 7468 6520 7661  pt to set the va
+00028350: 6c75 6573 2069 6e70 6c61 6365 2069 6e73  lues inplace ins
+00028360: 7465 6164 206f 6620 616c 7761 7973 2073  tead of always s
+00028370: 6574 7469 6e67 2061 206e 6577 2061 7272  etting a new arr
+00028380: 6179 2e20 220a 2020 2020 2020 2020 2020  ay. ".          
+00028390: 2020 2020 2020 2020 2020 2254 6f20 7265            "To re
+000283a0: 7461 696e 2074 6865 206f 6c64 2062 6568  tain the old beh
+000283b0: 6176 696f 722c 2075 7365 2065 6974 6865  avior, use eithe
+000283c0: 722e 2a22 0a20 2020 2020 2020 2020 2020  r.*".           
+000283d0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+000283e0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000283f0: 2020 6466 2e6c 6f63 5b3a 2c20 6475 7261    df.loc[:, dura
+00028400: 7469 6f6e 5f63 6f6c 5d20 3d20 7064 2e74  tion_col] = pd.t
+00028410: 6f5f 6e75 6d65 7269 6328 6466 5b64 7572  o_numeric(df[dur
+00028420: 6174 696f 6e5f 636f 6c5d 290a 2020 2020  ation_col]).    
+00028430: 6966 2069 765f 696e 6465 7820 6973 204e  if iv_index is N
+00028440: 6f6e 653a 0a20 2020 2020 2020 206c 6f67  one:.        log
+00028450: 6765 722e 7761 726e 696e 6728 2243 7265  ger.warning("Cre
+00028460: 6174 696e 6720 496e 7465 7276 616c 496e  ating IntervalIn
+00028470: 6465 7820 6661 696c 6564 2e22 290a 2020  dex failed.").  
+00028480: 2020 2020 2020 7265 7475 726e 2064 660a        return df.
+00028490: 2020 2020 6466 2e69 6e64 6578 203d 2069      df.index = i
+000284a0: 765f 696e 6465 780a 2020 2020 7265 7475  v_index.    retu
+000284b0: 726e 2064 660a 0a64 6566 2062 6f6f 6c65  rn df..def boole
+000284c0: 616e 5f6d 6f64 655f 636f 6c32 7374 7269  an_mode_col2stri
+000284d0: 6e67 7328 5329 202d 3e20 7064 2e53 6572  ngs(S) -> pd.Ser
+000284e0: 6965 733a 0a20 2020 2022 2222 5475 726e  ies:.    """Turn
+000284f0: 2074 6865 2062 6f6f 6c65 616e 2069 735f   the boolean is_
+00028500: 6d69 6e6f 7220 636f 6c75 6d6e 7320 696e  minor columns in
+00028510: 746f 2073 7472 696e 6720 636f 6c75 6d6e  to string column
+00028520: 7320 7375 6368 2074 6861 7420 5472 7565  s such that True
+00028530: 203d 3e20 276d 696e 6f72 272c 2046 616c   => 'minor', Fal
+00028540: 7365 203d 3e20 276d 616a 6f72 272e 2222  se => 'major'.""
+00028550: 220a 2020 2020 7265 7475 726e 2053 2e6d  ".    return S.m
+00028560: 6170 287b 5472 7565 3a20 276d 696e 6f72  ap({True: 'minor
+00028570: 272c 2046 616c 7365 3a20 276d 616a 6f72  ', False: 'major
+00028580: 277d 290a 0a64 6566 2072 6570 6c61 6365  '})..def replace
+00028590: 5f62 6f6f 6c65 616e 5f6d 6f64 655f 6279  _boolean_mode_by
+000285a0: 5f73 7472 696e 6773 2864 6629 202d 3e20  _strings(df) -> 
+000285b0: 7064 2e44 6174 6146 7261 6d65 3a0a 2020  pd.DataFrame:.  
+000285c0: 2020 2222 2252 6570 6c61 6365 7320 626f    """Replaces bo
+000285d0: 6f6c 6561 6e20 275f 6973 5f6d 696e 6f72  olean '_is_minor
+000285e0: 2720 636f 6c75 6d6e 7320 7769 7468 2073  ' columns with s
+000285f0: 7472 696e 6720 636f 6c75 6d6e 7320 7265  tring columns re
+00028600: 6e61 6d65 6420 746f 2027 5f6d 6f64 6527  named to '_mode'
+00028610: 2e0a 2020 2020 4578 616d 706c 653a 2064  ..    Example: d
+00028620: 665b 2773 6f6d 655f 636f 6c27 2c20 2773  f['some_col', 's
+00028630: 6f6d 655f 6e61 6d65 5f69 735f 6d69 6e6f  ome_name_is_mino
+00028640: 7227 5d20 3d3e 2064 665b 2773 6f6d 655f  r'] => df['some_
+00028650: 636f 6c27 2c20 2773 6f6d 655f 6e61 6d65  col', 'some_name
+00028660: 5f6d 6f64 6527 5d0a 2020 2020 2222 220a  _mode'].    """.
+00028670: 2020 2020 626f 6f6c 5f63 6f6c 7320 3d20      bool_cols = 
+00028680: 5b63 6f6c 2066 6f72 2063 6f6c 2069 6e20  [col for col in 
+00028690: 6466 2e63 6f6c 756d 6e73 2069 6620 636f  df.columns if co
+000286a0: 6c2e 656e 6473 7769 7468 2827 5f69 735f  l.endswith('_is_
+000286b0: 6d69 6e6f 7227 295d 0a20 2020 2069 6620  minor')].    if 
+000286c0: 6c65 6e28 626f 6f6c 5f63 6f6c 7329 203d  len(bool_cols) =
+000286d0: 3d20 303a 0a20 2020 2020 2020 2072 6574  = 0:.        ret
+000286e0: 7572 6e20 6466 0a20 2020 2064 6620 3d20  urn df.    df = 
+000286f0: 6466 2e63 6f70 7928 290a 2020 2020 7265  df.copy().    re
+00028700: 6e61 6d69 6e67 203d 207b 7d0a 2020 2020  naming = {}.    
+00028710: 666f 7220 636f 6c5f 6e61 6d65 2069 6e20  for col_name in 
+00028720: 626f 6f6c 5f63 6f6c 733a 0a20 2020 2020  bool_cols:.     
+00028730: 2020 206e 756d 6572 616c 5f6e 616d 6520     numeral_name 
+00028740: 3d20 636f 6c5f 6e61 6d65 5b3a 2d6c 656e  = col_name[:-len
+00028750: 2827 5f69 735f 6d69 6e6f 7227 295d 0a20  ('_is_minor')]. 
+00028760: 2020 2020 2020 2069 6620 636f 6c5f 6e61         if col_na
+00028770: 6d65 2069 6e20 6466 2e63 6f6c 756d 6e73  me in df.columns
+00028780: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
+00028790: 775f 636f 6c5f 6e61 6d65 203d 2066 227b  w_col_name = f"{
+000287a0: 6e75 6d65 7261 6c5f 6e61 6d65 7d5f 6d6f  numeral_name}_mo
+000287b0: 6465 220a 2020 2020 2020 2020 2020 2020  de".            
+000287c0: 6e65 775f 636f 6c20 3d20 626f 6f6c 6561  new_col = boolea
+000287d0: 6e5f 6d6f 6465 5f63 6f6c 3273 7472 696e  n_mode_col2strin
+000287e0: 6773 2864 665b 636f 6c5f 6e61 6d65 5d29  gs(df[col_name])
+000287f0: 0a20 2020 2020 2020 2020 2020 2064 662e  .            df.
+00028800: 6c6f 635b 3a2c 636f 6c5f 6e61 6d65 5d20  loc[:,col_name] 
+00028810: 3d20 6e65 775f 636f 6c0a 2020 2020 2020  = new_col.      
+00028820: 2020 2020 2020 7265 6e61 6d69 6e67 5b63        renaming[c
+00028830: 6f6c 5f6e 616d 655d 203d 206e 6577 5f63  ol_name] = new_c
+00028840: 6f6c 5f6e 616d 650a 2020 2020 6466 2e72  ol_name.    df.r
+00028850: 656e 616d 6528 636f 6c75 6d6e 733d 7265  ename(columns=re
+00028860: 6e61 6d69 6e67 2c20 696e 706c 6163 653d  naming, inplace=
+00028870: 5472 7565 290a 2020 2020 7265 7475 726e  True).    return
+00028880: 2064 660a 0a40 6675 6e63 7469 6f6e 5f6c   df..@function_l
+00028890: 6f67 6765 720a 6465 6620 7265 736f 6c76  ogger.def resolv
+000288a0: 655f 7265 6c61 7469 7665 5f6b 6579 7328  e_relative_keys(
+000288b0: 7265 6c61 7469 7665 726f 6f74 2c20 6d69  relativeroot, mi
+000288c0: 6e6f 723d 4661 6c73 6529 3a0a 2020 2020  nor=False):.    
+000288d0: 2222 2220 5265 736f 6c76 6520 6e65 7374  """ Resolve nest
+000288e0: 6564 2072 656c 6174 6976 6520 6b65 7973  ed relative keys
+000288f0: 2c20 652e 672e 2027 562f 562f 5627 203d  , e.g. 'V/V/V' =
+00028900: 3e20 2756 4927 2e0a 0a20 2020 2055 7365  > 'VI'...    Use
+00028910: 733a 203a 7079 3a66 756e 633a 6072 656c  s: :py:func:`rel
+00028920: 3261 6273 5f6b 6579 602c 203a 7079 3a66  2abs_key`, :py:f
+00028930: 756e 633a 6073 7472 5f69 735f 6d69 6e6f  unc:`str_is_mino
+00028940: 7260 0a0a 2020 2020 7265 6c61 7469 7665  r`..    relative
+00028950: 726f 6f74 203a 203a 6f62 6a3a 6073 7472  root : :obj:`str
+00028960: 600a 2020 2020 2020 2020 4f6e 6520 6f72  `.        One or
+00028970: 2073 6576 6572 616c 2072 656c 6174 6976   several relativ
+00028980: 6520 6b65 7973 2c20 652e 672e 2069 762f  e keys, e.g. iv/
+00028990: 762f 5649 2028 666f 7572 7468 2073 6361  v/VI (fourth sca
+000289a0: 6c65 2064 6567 7265 6520 6f66 2074 6865  le degree of the
+000289b0: 2066 6966 7468 2073 6361 6c65 2064 6567   fifth scale deg
+000289c0: 7265 6520 6f66 2074 6865 2073 6978 7468  ree of the sixth
+000289d0: 2073 6361 6c65 2064 6567 7265 6529 0a20   scale degree). 
+000289e0: 2020 206d 696e 6f72 203a 203a 6f62 6a3a     minor : :obj:
+000289f0: 6062 6f6f 6c60 2c20 6f70 7469 6f6e 616c  `bool`, optional
+00028a00: 0a20 2020 2020 2020 2050 6173 7320 5472  .        Pass Tr
+00028a10: 7565 2069 6620 7468 6520 6c61 7374 206f  ue if the last o
+00028a20: 6620 7468 6520 7265 6c61 7469 7665 206b  f the relative k
+00028a30: 6579 7320 6973 2074 6f20 6265 2069 6e74  eys is to be int
+00028a40: 6572 7072 6574 6564 2077 6974 6869 6e20  erpreted within 
+00028a50: 6120 6d69 6e6f 7220 636f 6e74 6578 742e  a minor context.
+00028a60: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+00028a70: 7064 2e69 736e 756c 6c28 7265 6c61 7469  pd.isnull(relati
+00028a80: 7665 726f 6f74 293a 0a20 2020 2020 2020  veroot):.       
+00028a90: 2072 6574 7572 6e20 7265 6c61 7469 7665   return relative
+00028aa0: 726f 6f74 0a20 2020 2073 706c 203d 2072  root.    spl = r
+00028ab0: 656c 6174 6976 6572 6f6f 742e 7370 6c69  elativeroot.spli
+00028ac0: 7428 272f 2729 0a20 2020 2069 6620 6c65  t('/').    if le
+00028ad0: 6e28 7370 6c29 203c 2032 3a0a 2020 2020  n(spl) < 2:.    
+00028ae0: 2020 2020 7265 7475 726e 2072 656c 6174      return relat
+00028af0: 6976 6572 6f6f 740a 2020 2020 6966 206c  iveroot.    if l
+00028b00: 656e 2873 706c 2920 3d3d 2032 3a0a 2020  en(spl) == 2:.  
+00028b10: 2020 2020 2020 6170 706c 6965 642c 2074        applied, t
+00028b20: 6f20 3d20 7370 6c0a 2020 2020 2020 2020  o = spl.        
+00028b30: 7265 7475 726e 2072 656c 3261 6273 5f6b  return rel2abs_k
+00028b40: 6579 2861 7070 6c69 6564 2c20 746f 2c20  ey(applied, to, 
+00028b50: 6d69 6e6f 722c 206c 6f67 6765 723d 6c6f  minor, logger=lo
+00028b60: 6767 6572 290a 2020 2020 7072 6576 696f  gger).    previo
+00028b70: 7573 2c20 6c61 7374 203d 2027 2f27 2e6a  us, last = '/'.j
+00028b80: 6f69 6e28 7370 6c5b 3a2d 315d 292c 2073  oin(spl[:-1]), s
+00028b90: 706c 5b2d 315d 0a20 2020 2072 6574 7572  pl[-1].    retur
+00028ba0: 6e20 7265 6c32 6162 735f 6b65 7928 7265  n rel2abs_key(re
+00028bb0: 736f 6c76 655f 7265 6c61 7469 7665 5f6b  solve_relative_k
+00028bc0: 6579 7328 7072 6576 696f 7573 2c20 7374  eys(previous, st
+00028bd0: 725f 6973 5f6d 696e 6f72 286c 6173 742c  r_is_minor(last,
+00028be0: 2069 735f 6e61 6d65 3d46 616c 7365 2929   is_name=False))
+00028bf0: 2c20 6c61 7374 2c20 6d69 6e6f 7229 0a0a  , last, minor)..
+00028c00: 0a64 6566 2073 6572 6965 735f 6973 5f6d  .def series_is_m
+00028c10: 696e 6f72 2853 2c20 6973 5f6e 616d 653d  inor(S, is_name=
+00028c20: 5472 7565 293a 0a20 2020 2022 2222 2052  True):.    """ R
+00028c30: 6574 7572 6e73 2062 6f6f 6c65 616e 2053  eturns boolean S
+00028c40: 6572 6965 7320 7768 6572 6520 6576 6572  eries where ever
+00028c50: 7920 7661 6c75 6520 696e 2060 6053 6060  y value in ``S``
+00028c60: 2072 6570 7265 7365 6e74 696e 6720 6120   representing a 
+00028c70: 6d69 6e6f 7220 6b65 792f 6368 6f72 6420  minor key/chord 
+00028c80: 6973 2054 7275 652e 2222 220a 2020 2020  is True.""".    
+00028c90: 2320 7265 6765 7820 3d20 7227 285b 412d  # regex = r'([A-
+00028ca0: 4761 2d67 5d29 5b23 7c62 5d2a 2720 6966  Ga-g])[#|b]*' if
+00028cb0: 2069 735f 6e61 6d65 2065 6c73 6520 275b   is_name else '[
+00028cc0: 237c 625d 2a28 5c77 2b29 270a 2020 2020  #|b]*(\w+)'.    
+00028cd0: 2320 7265 7475 726e 2053 2e73 7472 2e72  # return S.str.r
+00028ce0: 6570 6c61 6365 2872 6567 6578 2c20 6c61  eplace(regex, la
+00028cf0: 6d62 6461 206d 3a20 6d2e 6772 6f75 7028  mbda m: m.group(
+00028d00: 3129 292e 7374 722e 6973 6c6f 7765 7228  1)).str.islower(
+00028d10: 290a 2020 2020 7265 7475 726e 2053 2e73  ).    return S.s
+00028d20: 7472 2e69 736c 6f77 6572 2829 2020 2320  tr.islower()  # 
+00028d30: 6173 2073 6f6f 6e20 6173 206f 6e65 2063  as soon as one c
+00028d40: 6861 7261 6374 6572 2069 7320 6e6f 7420  haracter is not 
+00028d50: 6c6f 7765 7263 6173 652c 2069 7420 7368  lowercase, it sh
+00028d60: 6f75 6c64 2062 6520 6d61 6a6f 720a 0a0a  ould be major...
+00028d70: 6465 6620 7374 725f 6973 5f6d 696e 6f72  def str_is_minor
+00028d80: 2874 6f6e 652c 2069 735f 6e61 6d65 3d54  (tone, is_name=T
+00028d90: 7275 6529 3a0a 2020 2020 2222 2220 5265  rue):.    """ Re
+00028da0: 7475 726e 7320 5472 7565 2069 6620 6060  turns True if ``
+00028db0: 746f 6e65 6060 2072 6570 7265 7365 6e74  tone`` represent
+00028dc0: 7320 6120 6d69 6e6f 7220 6b65 7920 6f72  s a minor key or
+00028dd0: 2063 686f 7264 2e22 2222 0a20 2020 2023   chord.""".    #
+00028de0: 2072 6567 6578 203d 2072 2728 5b41 2d47   regex = r'([A-G
+00028df0: 612d 675d 295b 237c 625d 2a27 2069 6620  a-g])[#|b]*' if 
+00028e00: 6973 5f6e 616d 6520 656c 7365 2027 5b23  is_name else '[#
+00028e10: 7c62 5d2a 285c 772b 2927 0a20 2020 2023  |b]*(\w+)'.    #
+00028e20: 206d 203d 2072 652e 6d61 7463 6828 7265   m = re.match(re
+00028e30: 6765 782c 2074 6f6e 6529 0a20 2020 2023  gex, tone).    #
+00028e40: 2069 6620 6d20 6973 204e 6f6e 653a 0a20   if m is None:. 
+00028e50: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
+00028e60: 6d0a 2020 2020 2320 7265 7475 726e 206d  m.    # return m
+00028e70: 2e67 726f 7570 2831 292e 6973 6c6f 7765  .group(1).islowe
+00028e80: 7228 290a 2020 2020 7265 7475 726e 2074  r().    return t
+00028e90: 6f6e 652e 6973 6c6f 7765 7228 290a 0a0a  one.islower()...
+00028ea0: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
+00028eb0: 0a64 6566 2074 7261 6e73 706f 7365 5f63  .def transpose_c
+00028ec0: 6861 6e67 6573 2863 6861 6e67 6573 2c20  hanges(changes, 
+00028ed0: 6f6c 645f 6e75 6d2c 206e 6577 5f6e 756d  old_num, new_num
+00028ee0: 2c20 6f6c 645f 6d69 6e6f 723d 4661 6c73  , old_minor=Fals
+00028ef0: 652c 206e 6577 5f6d 696e 6f72 3d46 616c  e, new_minor=Fal
+00028f00: 7365 293a 0a20 2020 2022 2222 0a20 2020  se):.    """.   
+00028f10: 2053 696e 6365 2074 6865 2069 6e74 6572   Since the inter
+00028f20: 7661 6c20 7369 7a65 7320 6578 7072 6573  val sizes expres
+00028f30: 7365 6420 6279 2074 6865 2063 6861 6e67  sed by the chang
+00028f40: 6573 206f 6620 7468 6520 4443 4d4c 2068  es of the DCML h
+00028f50: 6172 6d6f 6e79 2073 796e 7461 780a 2020  armony syntax.  
+00028f60: 2020 6465 7065 6e64 206f 6e20 7468 6520    depend on the 
+00028f70: 6e75 6d65 7261 6c27 7320 706f 7369 7469  numeral's positi
+00028f80: 6f6e 2069 6e20 7468 6520 7363 616c 652c  on in the scale,
+00028f90: 2074 6865 7365 206d 6179 2063 6861 6e67   these may chang
+00028fa0: 6520 6966 2074 6865 206e 756d 6572 616c  e if the numeral
+00028fb0: 0a20 2020 2069 7320 7472 616e 7370 6f73  .    is transpos
+00028fc0: 6564 2e20 5468 6973 2066 756e 6374 696f  ed. This functio
+00028fd0: 6e20 6578 7072 6573 7365 7320 7468 6520  n expresses the 
+00028fe0: 7361 6d65 2063 6861 6e67 6573 2066 6f72  same changes for
+00028ff0: 2074 6865 206e 6577 2070 6f73 6974 696f   the new positio
+00029000: 6e2e 0a20 2020 2043 686f 7264 2074 6f6e  n..    Chord ton
+00029010: 6520 616c 7465 7261 7469 6f6e 7320 286f  e alterations (o
+00029020: 6620 3320 616e 6420 3529 2073 7461 7920  f 3 and 5) stay 
+00029030: 756e 746f 7563 6865 642e 0a0a 2020 2020  untouched...    
+00029040: 5573 6573 3a20 3a70 793a 6675 6e63 3a60  Uses: :py:func:`
+00029050: 6368 616e 6765 7332 7470 6360 0a0a 2020  changes2tpc`..  
+00029060: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00029070: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00029080: 6368 616e 6765 7320 3a20 3a6f 626a 3a60  changes : :obj:`
+00029090: 7374 7260 0a20 2020 2020 2020 2041 2073  str`.        A s
+000290a0: 7472 696e 6720 6f66 2063 6861 6e67 6573  tring of changes
+000290b0: 2066 6f6c 6c6f 7769 6e67 2074 6865 2044   following the D
+000290c0: 434d 4c20 6861 726d 6f6e 7920 7374 616e  CML harmony stan
+000290d0: 6461 7264 2e0a 2020 2020 6f6c 645f 6e75  dard..    old_nu
+000290e0: 6d2c 206e 6577 5f6e 756d 203a 203a 6f62  m, new_num : :ob
+000290f0: 6a3a 6073 7472 603a 0a20 2020 2020 2020  j:`str`:.       
+00029100: 204f 6c64 206e 756d 6572 616c 2c20 6e65   Old numeral, ne
+00029110: 7720 6e75 6d65 7261 6c2e 0a20 2020 206f  w numeral..    o
+00029120: 6c64 5f6d 696e 6f72 2c20 6e65 775f 6d69  ld_minor, new_mi
+00029130: 6e6f 7220 3a20 3a6f 626a 3a60 626f 6f6c  nor : :obj:`bool
+00029140: 602c 206f 7074 696f 6e61 6c0a 2020 2020  `, optional.    
+00029150: 2020 2020 466f 7220 6561 6368 206e 756d      For each num
+00029160: 6572 616c 2c20 7061 7373 2054 7275 6520  eral, pass True 
+00029170: 6966 2069 7420 6f63 6375 7273 2069 6e20  if it occurs in 
+00029180: 6120 6d69 6e6f 7220 636f 6e74 6578 742e  a minor context.
+00029190: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+000291a0: 7064 2e69 736e 756c 6c28 6368 616e 6765  pd.isnull(change
+000291b0: 7329 3a0a 2020 2020 2020 2020 7265 7475  s):.        retu
+000291c0: 726e 2063 6861 6e67 6573 0a20 2020 206f  rn changes.    o
+000291d0: 6c64 203d 2063 6861 6e67 6573 3274 7063  ld = changes2tpc
+000291e0: 2863 6861 6e67 6573 2c20 6f6c 645f 6e75  (changes, old_nu
+000291f0: 6d2c 206d 696e 6f72 3d6f 6c64 5f6d 696e  m, minor=old_min
+00029200: 6f72 2c20 726f 6f74 5f61 6c74 6572 6174  or, root_alterat
+00029210: 696f 6e73 3d54 7275 6529 0a20 2020 206e  ions=True).    n
+00029220: 6577 203d 2063 6861 6e67 6573 3274 7063  ew = changes2tpc
+00029230: 2863 6861 6e67 6573 2c20 6e65 775f 6e75  (changes, new_nu
+00029240: 6d2c 206d 696e 6f72 3d6e 6577 5f6d 696e  m, minor=new_min
+00029250: 6f72 2c20 726f 6f74 5f61 6c74 6572 6174  or, root_alterat
+00029260: 696f 6e73 3d54 7275 6529 0a20 2020 2072  ions=True).    r
+00029270: 6573 203d 205b 5d0a 2020 2020 6765 745f  es = [].    get_
+00029280: 6163 6320 3d20 6c61 6d62 6461 206e 3a20  acc = lambda n: 
+00029290: 6e20 2a20 2723 2720 6966 206e 203e 2030  n * '#' if n > 0
+000292a0: 2065 6c73 6520 2d6e 202a 2027 6227 0a20   else -n * 'b'. 
+000292b0: 2020 2066 6f72 2028 6675 6c6c 2c20 6164     for (full, ad
+000292c0: 6465 642c 2061 6363 2c20 6368 6f72 645f  ded, acc, chord_
+000292d0: 696e 7465 7276 616c 2c20 6976 3129 2c20  interval, iv1), 
+000292e0: 285f 2c20 5f2c 205f 2c20 5f2c 2069 7632  (_, _, _, _, iv2
+000292f0: 2920 696e 207a 6970 286f 6c64 2c20 6e65  ) in zip(old, ne
+00029300: 7729 3a0a 2020 2020 2020 2020 6966 2069  w):.        if i
+00029310: 7631 2069 7320 4e6f 6e65 206f 7220 6976  v1 is None or iv
+00029320: 3120 3d3d 2069 7632 3a0a 2020 2020 2020  1 == iv2:.      
+00029330: 2020 2020 2020 7265 732e 6170 7065 6e64        res.append
+00029340: 2866 756c 6c29 0a20 2020 2020 2020 2065  (full).        e
+00029350: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00029360: 2064 203d 2069 7632 202d 2069 7631 0a20   d = iv2 - iv1. 
+00029370: 2020 2020 2020 2020 2020 2069 6620 6420             if d 
+00029380: 2520 3720 3e20 303a 0a20 2020 2020 2020  % 7 > 0:.       
+00029390: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+000293a0: 7761 726e 696e 6728 0a20 2020 2020 2020  warning(.       
+000293b0: 2020 2020 2020 2020 2020 2020 2066 2254               f"T
+000293c0: 6865 2064 6966 6665 7265 6e63 6520 6265  he difference be
+000293d0: 7477 6565 6e20 7468 6520 696e 7465 7276  tween the interv
+000293e0: 616c 7320 6f66 207b 6675 6c6c 7d20 696e  als of {full} in
+000293f0: 207b 6f6c 645f 6e75 6d7d 2061 6e64 207b   {old_num} and {
+00029400: 6e65 775f 6e75 6d7d 2028 696e 207b 276d  new_num} (in {'m
+00029410: 696e 6f72 2720 6966 206d 696e 6f72 2065  inor' if minor e
+00029420: 6c73 6520 276d 616a 6f72 277d 2920 646f  lse 'major'}) do
+00029430: 6e27 7420 6469 6666 6572 2062 7920 6368  n't differ by ch
+00029440: 726f 6d61 7469 6320 7365 6d69 746f 6e65  romatic semitone
+00029450: 732e 2229 0a20 2020 2020 2020 2020 2020  s.").           
+00029460: 206e 5f61 6363 203d 2061 6363 2e63 6f75   n_acc = acc.cou
+00029470: 6e74 2827 2327 2920 2d20 6163 632e 636f  nt('#') - acc.co
+00029480: 756e 7428 2762 2729 0a20 2020 2020 2020  unt('b').       
+00029490: 2020 2020 206e 6577 5f61 6363 203d 2067       new_acc = g
+000294a0: 6574 5f61 6363 286e 5f61 6363 202d 2064  et_acc(n_acc - d
+000294b0: 202f 2f20 3729 0a20 2020 2020 2020 2020   // 7).         
+000294c0: 2020 2072 6573 2e61 7070 656e 6428 6164     res.append(ad
+000294d0: 6465 6420 2b20 6e65 775f 6163 6320 2b20  ded + new_acc + 
+000294e0: 6368 6f72 645f 696e 7465 7276 616c 290a  chord_interval).
+000294f0: 2020 2020 7265 7475 726e 2027 272e 6a6f      return ''.jo
+00029500: 696e 2872 6573 290a 0a0a 4066 756e 6374  in(res)...@funct
+00029510: 696f 6e5f 6c6f 6767 6572 0a64 6566 2066  ion_logger.def f
+00029520: 6561 7475 7265 7332 7470 6373 286e 756d  eatures2tpcs(num
+00029530: 6572 616c 2c20 666f 726d 3d4e 6f6e 652c  eral, form=None,
+00029540: 2066 6967 6261 7373 3d4e 6f6e 652c 2063   figbass=None, c
+00029550: 6861 6e67 6573 3d4e 6f6e 652c 2072 656c  hanges=None, rel
+00029560: 6174 6976 6572 6f6f 743d 4e6f 6e65 2c20  ativeroot=None, 
+00029570: 6b65 793d 2743 272c 206d 696e 6f72 3d4e  key='C', minor=N
+00029580: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00029590: 2020 2020 2020 206d 6572 6765 5f74 6f6e         merge_ton
+000295a0: 6573 3d54 7275 652c 2062 6173 735f 6f6e  es=True, bass_on
+000295b0: 6c79 3d46 616c 7365 2c20 6d63 3d4e 6f6e  ly=False, mc=Non
+000295c0: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
+000295d0: 4769 7665 6e20 7468 6520 6665 6174 7572  Given the featur
+000295e0: 6573 206f 6620 6120 6368 6f72 6420 6c61  es of a chord la
+000295f0: 6265 6c2c 2074 6869 7320 6675 6e63 7469  bel, this functi
+00029600: 6f6e 2072 6574 7572 6e73 2074 6865 2063  on returns the c
+00029610: 686f 7264 2074 6f6e 6573 0a20 2020 2069  hord tones.    i
+00029620: 6e20 7468 6520 6f72 6465 7220 6f66 2074  n the order of t
+00029630: 6865 2069 6e76 6572 7369 6f6e 2c20 7374  he inversion, st
+00029640: 6172 7469 6e67 2066 726f 6d20 7468 6520  arting from the 
+00029650: 6261 7373 206e 6f74 652e 2054 6865 2074  bass note. The t
+00029660: 6f6e 6573 2061 7265 0a20 2020 2065 7870  ones are.    exp
+00029670: 7265 7373 6564 2061 7320 746f 6e61 6c20  ressed as tonal 
+00029680: 7069 7463 6820 636c 6173 7365 732c 2077  pitch classes, w
+00029690: 6865 7265 202d 313d 462c 2030 3d43 2c20  here -1=F, 0=C, 
+000296a0: 313d 4720 6574 632e 0a0a 2020 2020 5573  1=G etc...    Us
+000296b0: 6573 3a20 3a70 793a 6675 6e63 3a60 7e2e  es: :py:func:`~.
+000296c0: 7574 696c 732e 6368 616e 6765 7332 6c69  utils.changes2li
+000296d0: 7374 602c 203a 7079 3a66 756e 633a 607e  st`, :py:func:`~
+000296e0: 2e75 7469 6c73 2e6e 616d 6532 6669 6674  .utils.name2fift
+000296f0: 6873 602c 203a 7079 3a66 756e 633a 607e  hs`, :py:func:`~
+00029700: 2e75 7469 6c73 2e72 6573 6f6c 7665 5f72  .utils.resolve_r
+00029710: 656c 6174 6976 655f 6b65 7973 602c 203a  elative_keys`, :
+00029720: 7079 3a66 756e 633a 607e 2e75 7469 6c73  py:func:`~.utils
+00029730: 2e72 6f6d 616e 5f6e 756d 6572 616c 3266  .roman_numeral2f
+00029740: 6966 7468 7360 2c0a 2020 2020 3a70 793a  ifths`,.    :py:
+00029750: 6675 6e63 3a60 7e2e 7574 696c 732e 736f  func:`~.utils.so
+00029760: 7274 5f74 7063 7360 2c20 3a70 793a 6675  rt_tpcs`, :py:fu
+00029770: 6e63 3a60 7e2e 7574 696c 732e 7374 725f  nc:`~.utils.str_
+00029780: 6973 5f6d 696e 6f72 600a 0a20 2020 2050  is_minor`..    P
+00029790: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+000297a0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 206e 756d  --------.    num
+000297b0: 6572 616c 3a20 3a6f 626a 3a60 7374 7260  eral: :obj:`str`
+000297c0: 0a20 2020 2020 2020 2052 6f6d 616e 206e  .        Roman n
+000297d0: 756d 6572 616c 206f 6620 7468 6520 6368  umeral of the ch
+000297e0: 6f72 6427 7320 726f 6f74 0a20 2020 2066  ord's root.    f
+000297f0: 6f72 6d3a 207b 4e6f 6e65 2c20 274d 272c  orm: {None, 'M',
+00029800: 2027 6f27 2c20 272b 2720 2725 277d 2c20   'o', '+' '%'}, 
+00029810: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00029820: 2049 6e64 6963 6174 6573 2074 6865 2063   Indicates the c
+00029830: 686f 7264 2074 7970 6520 6966 206e 6f74  hord type if not
+00029840: 2061 206d 616a 6f72 206f 7220 6d69 6e6f   a major or mino
+00029850: 7220 7472 6961 6420 2866 6f72 2077 6869  r triad (for whi
+00029860: 6368 2060 6066 6f72 6d60 6020 6973 204e  ch ``form`` is N
+00029870: 6f6e 6529 2e0a 2020 2020 2020 2020 2725  one)..        '%
+00029880: 2720 616e 6420 274d 2720 6361 6e20 6f6e  ' and 'M' can on
+00029890: 6c79 206f 6363 7572 2061 7320 7465 7472  ly occur as tetr
+000298a0: 6164 732c 206e 6f74 2061 7320 7472 6961  ads, not as tria
+000298b0: 6473 2e0a 2020 2020 6669 6762 6173 733a  ds..    figbass:
+000298c0: 207b 4e6f 6e65 2c20 2736 272c 2027 3634   {None, '6', '64
+000298d0: 272c 2027 3727 2c20 2736 3527 2c20 2734  ', '7', '65', '4
+000298e0: 3327 2c20 2732 277d 2c20 6f70 7469 6f6e  3', '2'}, option
+000298f0: 616c 0a20 2020 2020 2020 2049 6e64 6963  al.        Indic
+00029900: 6174 6573 2063 686f 7264 2773 2069 6e76  ates chord's inv
+00029910: 6572 7369 6f6e 2e20 5061 7373 204e 6f6e  ersion. Pass Non
+00029920: 6520 666f 7220 7472 6961 6420 726f 6f74  e for triad root
+00029930: 2070 6f73 6974 696f 6e2e 0a20 2020 2063   position..    c
+00029940: 6861 6e67 6573 3a20 3a6f 626a 3a60 7374  hanges: :obj:`st
+00029950: 7260 2c20 6f70 7469 6f6e 616c 0a20 2020  r`, optional.   
+00029960: 2020 2020 2041 6464 6564 2073 7465 7073       Added steps
+00029970: 2073 7563 6820 6173 2027 2b36 2720 6f72   such as '+6' or
+00029980: 2073 7573 7065 6e73 696f 6e73 2073 7563   suspensions suc
+00029990: 6820 6173 2027 3427 206f 7220 616e 7920  h as '4' or any 
+000299a0: 636f 6d62 696e 6174 696f 6e20 7375 6368  combination such
+000299b0: 2061 7320 2839 2b36 3429 2e0a 2020 2020   as (9+64)..    
+000299c0: 2020 2020 4e75 6d62 6572 7320 6e65 6564      Numbers need
+000299d0: 2074 6f20 6265 2069 6e20 6465 7363 656e   to be in descen
+000299e0: 6469 6e67 206f 7264 6572 2e0a 2020 2020  ding order..    
+000299f0: 7265 6c61 7469 7665 726f 6f74 3a20 3a6f  relativeroot: :o
+00029a00: 626a 3a60 7374 7260 2c20 6f70 7469 6f6e  bj:`str`, option
+00029a10: 616c 0a20 2020 2020 2020 2050 6173 7320  al.        Pass 
+00029a20: 6120 526f 6d61 6e20 7363 616c 6520 6465  a Roman scale de
+00029a30: 6772 6565 2069 6620 606e 756d 6572 616c  gree if `numeral
+00029a40: 6020 6973 2074 6f20 6265 2061 7070 6c69  ` is to be appli
+00029a50: 6564 2074 6f20 6120 6469 6666 6572 656e  ed to a differen
+00029a60: 7420 7363 616c 650a 2020 2020 2020 2020  t scale.        
+00029a70: 6465 6772 6565 206f 6620 7468 6520 6c6f  degree of the lo
+00029a80: 6361 6c20 6b65 792c 2061 7320 696e 2027  cal key, as in '
+00029a90: 5636 352f 5627 0a20 2020 206b 6579 203a  V65/V'.    key :
+00029aa0: 203a 6f62 6a3a 6073 7472 6020 6f72 203a   :obj:`str` or :
+00029ab0: 6f62 6a3a 6069 6e74 602c 206f 7074 696f  obj:`int`, optio
+00029ac0: 6e61 6c0a 2020 2020 2020 2020 5468 6520  nal.        The 
+00029ad0: 6c6f 6361 6c20 6b65 7920 6578 7072 6573  local key expres
+00029ae0: 7365 6420 6173 2074 6865 2072 6f6f 7427  sed as the root'
+00029af0: 7320 6e6f 7465 206e 616d 6520 6f72 2061  s note name or a
+00029b00: 2074 6f6e 616c 2070 6974 6368 2063 6c61   tonal pitch cla
+00029b10: 7373 2e0a 2020 2020 2020 2020 4966 2069  ss..        If i
+00029b20: 7420 6973 2061 206e 616d 6520 616e 6420  t is a name and 
+00029b30: 606d 696e 6f72 6020 6973 2060 4e6f 6e65  `minor` is `None
+00029b40: 602c 2075 7070 6572 6361 7365 206d 6561  `, uppercase mea
+00029b50: 6e73 206d 616a 6f72 2061 6e64 206c 6f77  ns major and low
+00029b60: 6572 6361 7365 206d 696e 6f72 2e0a 2020  ercase minor..  
+00029b70: 2020 2020 2020 4966 2069 7420 6973 2061        If it is a
+00029b80: 2074 6f6e 616c 2070 6974 6368 2063 6c61   tonal pitch cla
+00029b90: 7373 2c20 606d 696e 6f72 6020 6e65 6564  ss, `minor` need
+00029ba0: 7320 746f 2062 6520 7370 6563 6966 6965  s to be specifie
+00029bb0: 642e 0a20 2020 206d 696e 6f72 203a 203a  d..    minor : :
+00029bc0: 6f62 6a3a 6062 6f6f 6c60 2c20 6f70 7469  obj:`bool`, opti
+00029bd0: 6f6e 616c 0a20 2020 2020 2020 2050 6173  onal.        Pas
+00029be0: 7320 5472 7565 2066 6f72 206d 696e 6f72  s True for minor
+00029bf0: 2061 6e64 2046 616c 7365 2066 6f72 206d   and False for m
+00029c00: 616a 6f72 2e20 4361 6e20 6265 206f 6d69  ajor. Can be omi
+00029c10: 7474 6564 2069 6620 606b 6579 6020 6973  tted if `key` is
+00029c20: 2061 206e 6f74 6520 6e61 6d65 2e0a 2020   a note name..  
+00029c30: 2020 2020 2020 5468 6973 2061 6666 6563        This affec
+00029c40: 7473 2063 616c 6375 6c61 7469 6f6e 206f  ts calculation o
+00029c50: 6620 6368 6f72 6473 2072 656c 6174 6564  f chords related
+00029c60: 2074 6f20 4949 492c 2056 4920 616e 6420   to III, VI and 
+00029c70: 5649 492e 0a20 2020 206d 6572 6765 5f74  VII..    merge_t
+00029c80: 6f6e 6573 203a 203a 6f62 6a3a 6062 6f6f  ones : :obj:`boo
+00029c90: 6c60 2c20 6f70 7469 6f6e 616c 0a20 2020  l`, optional.   
+00029ca0: 2020 2020 2050 6173 7320 4661 6c73 6520       Pass False 
+00029cb0: 6966 2079 6f75 2077 616e 7420 7468 6520  if you want the 
+00029cc0: 6675 6e63 7469 6f6e 2074 6f20 7265 7475  function to retu
+00029cd0: 726e 2074 776f 2074 7570 6c65 732c 206f  rn two tuples, o
+00029ce0: 6e65 2077 6974 6820 2870 6f74 656e 7469  ne with (potenti
+00029cf0: 616c 6c79 2073 7573 7065 6e64 6564 290a  ally suspended).
+00029d00: 2020 2020 2020 2020 6368 6f72 6420 746f          chord to
+00029d10: 6e65 7320 616e 6420 6f6e 6520 7769 7468  nes and one with
+00029d20: 2061 6464 6564 206e 6f74 6573 2e0a 2020   added notes..  
+00029d30: 2020 6261 7373 5f6f 6e6c 7920 3a20 3a6f    bass_only : :o
+00029d40: 626a 3a60 626f 6f6c 602c 206f 7074 696f  bj:`bool`, optio
+00029d50: 6e61 6c0a 2020 2020 2020 2020 5265 7475  nal.        Retu
+00029d60: 726e 206f 6e6c 7920 7468 6520 6261 7373  rn only the bass
+00029d70: 206e 6f74 6520 696e 7374 6561 6420 6f66   note instead of
+00029d80: 2061 6c6c 2063 686f 7264 2074 6f6e 6573   all chord tones
+00029d90: 2e0a 2020 2020 6d63 203a 2069 6e74 206f  ..    mc : int o
+00029da0: 7220 7374 720a 2020 2020 2020 2020 5061  r str.        Pa
+00029db0: 7373 206d 6561 7375 7265 2063 6f75 6e74  ss measure count
+00029dc0: 2074 6f20 6469 7370 6c61 7920 6974 2069   to display it i
+00029dd0: 6e20 7761 726e 696e 6773 2e0a 0a20 2020  n warnings...   
+00029de0: 2022 2222 0a20 2020 2069 6620 7064 2e69   """.    if pd.i
+00029df0: 736e 756c 6c28 6e75 6d65 7261 6c29 206f  snull(numeral) o
+00029e00: 7220 6e75 6d65 7261 6c20 3d3d 2027 406e  r numeral == '@n
+00029e10: 6f6e 6527 3a0a 2020 2020 2020 2020 6966  one':.        if
+00029e20: 2062 6173 735f 6f6e 6c79 206f 7220 6d65   bass_only or me
+00029e30: 7267 655f 746f 6e65 733a 0a20 2020 2020  rge_tones:.     
+00029e40: 2020 2020 2020 2072 6574 7572 6e20 7064         return pd
+00029e50: 2e4e 410a 2020 2020 2020 2020 656c 7365  .NA.        else
+00029e60: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00029e70: 7475 726e 207b 0a20 2020 2020 2020 2020  turn {.         
+00029e80: 2020 2020 2020 2027 6368 6f72 645f 746f         'chord_to
+00029e90: 6e65 7327 3a20 7064 2e4e 412c 0a20 2020  nes': pd.NA,.   
+00029ea0: 2020 2020 2020 2020 2020 2020 2027 6164               'ad
+00029eb0: 6465 645f 746f 6e65 7327 3a20 7064 2e4e  ded_tones': pd.N
+00029ec0: 412c 0a20 2020 2020 2020 2020 2020 2020  A,.             
+00029ed0: 2020 2027 726f 6f74 273a 2070 642e 4e41     'root': pd.NA
+00029ee0: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
+00029ef0: 2020 2020 666f 726d 2c20 6669 6762 6173      form, figbas
+00029f00: 732c 2063 6861 6e67 6573 2c20 7265 6c61  s, changes, rela
+00029f10: 7469 7665 726f 6f74 203d 2074 7570 6c65  tiveroot = tuple
+00029f20: 280a 2020 2020 2020 2020 2727 2069 6620  (.        '' if 
+00029f30: 7064 2e69 736e 756c 6c28 7661 6c29 2065  pd.isnull(val) e
+00029f40: 6c73 6520 7661 6c20 666f 7220 7661 6c20  lse val for val 
+00029f50: 696e 2028 666f 726d 2c20 6669 6762 6173  in (form, figbas
+00029f60: 732c 2063 6861 6e67 6573 2c20 7265 6c61  s, changes, rela
+00029f70: 7469 7665 726f 6f74 2929 0a20 2020 206c  tiveroot)).    l
+00029f80: 6162 656c 203d 2066 227b 6e75 6d65 7261  abel = f"{numera
+00029f90: 6c7d 7b66 6f72 6d7d 7b66 6967 6261 7373  l}{form}{figbass
+00029fa0: 7d7b 2728 2720 2b20 6368 616e 6765 7320  }{'(' + changes 
+00029fb0: 2b20 2729 2720 6966 2063 6861 6e67 6573  + ')' if changes
+00029fc0: 2021 3d20 2727 2065 6c73 6520 2727 7d7b   != '' else ''}{
+00029fd0: 272f 2720 2b20 7265 6c61 7469 7665 726f  '/' + relativero
+00029fe0: 6f74 2069 6620 7265 6c61 7469 7665 726f  ot if relativero
+00029ff0: 6f74 2021 3d20 2727 2065 6c73 6520 2727  ot != '' else ''
+0002a000: 7d22 0a20 2020 204d 4320 3d20 2727 2069  }".    MC = '' i
+0002a010: 6620 6d63 2069 7320 4e6f 6e65 2065 6c73  f mc is None els
+0002a020: 6520 6627 4d43 207b 6d63 7d3a 2027 0a20  e f'MC {mc}: '. 
+0002a030: 2020 2069 6620 6d69 6e6f 7220 6973 204e     if minor is N
+0002a040: 6f6e 653a 0a20 2020 2020 2020 2074 7279  one:.        try
+0002a050: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
+0002a060: 6e6f 7220 3d20 7374 725f 6973 5f6d 696e  nor = str_is_min
+0002a070: 6f72 286b 6579 2c20 6973 5f6e 616d 653d  or(key, is_name=
+0002a080: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0002a090: 2020 6c6f 6767 6572 2e64 6562 7567 2866    logger.debug(f
+0002a0a0: 224d 6f64 6520 696e 6665 7272 6564 2066  "Mode inferred f
+0002a0b0: 726f 6d20 7b6b 6579 7d2e 2229 0a20 2020  rom {key}.").   
+0002a0c0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+0002a0d0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+0002a0e0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0002a0f0: 726f 7228 6622 4966 2070 6172 616d 6574  ror(f"If paramet
+0002a100: 6572 2027 6d69 6e6f 7227 2069 7320 6e6f  er 'minor' is no
+0002a110: 7420 7370 6563 6966 6965 642c 2027 6b65  t specified, 'ke
+0002a120: 7927 206e 6565 6473 2074 6f20 6265 2061  y' needs to be a
+0002a130: 2073 7472 696e 672c 206e 6f74 207b 6b65   string, not {ke
+0002a140: 797d 2229 0a0a 2020 2020 6b65 7920 3d20  y}")..    key = 
+0002a150: 6e61 6d65 3266 6966 7468 7328 6b65 792c  name2fifths(key,
+0002a160: 206c 6f67 6765 723d 6c6f 6767 6572 290a   logger=logger).
+0002a170: 0a20 2020 2069 6620 666f 726d 2069 6e20  .    if form in 
+0002a180: 5b27 2527 2c20 274d 272c 2027 2b4d 275d  ['%', 'M', '+M']
+0002a190: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
+0002a1a0: 2066 6967 6261 7373 2069 6e20 5b27 3727   figbass in ['7'
+0002a1b0: 2c20 2736 3527 2c20 2734 3327 2c0a 2020  , '65', '43',.  
+0002a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1d0: 2020 2020 2020 2020 2027 3227 5d2c 2066           '2'], f
+0002a1e0: 227b 4d43 7d7b 6c61 6265 6c7d 3a20 7b66  "{MC}{label}: {f
+0002a1f0: 6f72 6d7d 2072 6571 7569 7265 7320 6669  orm} requires fi
+0002a200: 6762 6173 7320 2837 2c20 3635 2c20 3433  gbass (7, 65, 43
+0002a210: 2c20 6f72 2032 2920 7369 6e63 6520 6974  , or 2) since it
+0002a220: 2073 7065 6369 6669 6573 2061 2063 686f   specifies a cho
+0002a230: 7264 2773 2073 6576 656e 7468 2e22 0a0a  rd's seventh."..
+0002a240: 2020 2020 6966 2072 656c 6174 6976 6572      if relativer
+0002a250: 6f6f 7420 213d 2027 273a 0a20 2020 2020  oot != '':.     
+0002a260: 2020 2072 6573 6f6c 7665 6420 3d20 7265     resolved = re
+0002a270: 736f 6c76 655f 7265 6c61 7469 7665 5f6b  solve_relative_k
+0002a280: 6579 7328 7265 6c61 7469 7665 726f 6f74  eys(relativeroot
+0002a290: 2c20 6d69 6e6f 722c 206c 6f67 6765 723d  , minor, logger=
+0002a2a0: 6c6f 6767 6572 290a 2020 2020 2020 2020  logger).        
+0002a2b0: 7265 6c5f 6d69 6e6f 7220 3d20 7374 725f  rel_minor = str_
+0002a2c0: 6973 5f6d 696e 6f72 2872 6573 6f6c 7665  is_minor(resolve
+0002a2d0: 642c 2069 735f 6e61 6d65 3d46 616c 7365  d, is_name=False
+0002a2e0: 290a 2020 2020 2020 2020 7472 616e 7370  ).        transp
+0002a2f0: 203d 2072 6f6d 616e 5f6e 756d 6572 616c   = roman_numeral
+0002a300: 3266 6966 7468 7328 7265 736f 6c76 6564  2fifths(resolved
+0002a310: 2c20 6d69 6e6f 722c 206c 6f67 6765 723d  , minor, logger=
+0002a320: 6c6f 6767 6572 290a 2020 2020 2020 2020  logger).        
+0002a330: 6c6f 6767 6572 2e64 6562 7567 280a 2020  logger.debug(.  
+0002a340: 2020 2020 2020 2020 2020 6622 7b4d 437d            f"{MC}
+0002a350: 4368 6f72 6420 6170 706c 6965 6420 746f  Chord applied to
+0002a360: 207b 7265 6c61 7469 7665 726f 6f74 7d2e   {relativeroot}.
+0002a370: 2054 6865 7265 666f 7265 2074 7261 6e73   Therefore trans
+0002a380: 706f 7369 6e67 2069 7420 6279 207b 7472  posing it by {tr
+0002a390: 616e 7370 7d20 6669 6674 6873 2e22 290a  ansp} fifths.").
+0002a3a0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+0002a3b0: 6561 7475 7265 7332 7470 6373 286e 756d  eatures2tpcs(num
+0002a3c0: 6572 616c 3d6e 756d 6572 616c 2c20 666f  eral=numeral, fo
+0002a3d0: 726d 3d66 6f72 6d2c 2066 6967 6261 7373  rm=form, figbass
+0002a3e0: 3d66 6967 6261 7373 2c20 7265 6c61 7469  =figbass, relati
+0002a3f0: 7665 726f 6f74 3d4e 6f6e 652c 2063 6861  veroot=None, cha
+0002a400: 6e67 6573 3d63 6861 6e67 6573 2c0a 2020  nges=changes,.  
+0002a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a420: 2020 2020 2020 2020 2020 206b 6579 3d6b             key=k
+0002a430: 6579 202b 2074 7261 6e73 702c 206d 696e  ey + transp, min
+0002a440: 6f72 3d72 656c 5f6d 696e 6f72 2c20 6d65  or=rel_minor, me
+0002a450: 7267 655f 746f 6e65 733d 6d65 7267 655f  rge_tones=merge_
+0002a460: 746f 6e65 732c 2062 6173 735f 6f6e 6c79  tones, bass_only
+0002a470: 3d62 6173 735f 6f6e 6c79 2c20 6d63 3d6d  =bass_only, mc=m
+0002a480: 632c 0a20 2020 2020 2020 2020 2020 2020  c,.             
+0002a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4a0: 6c6f 6767 6572 3d6c 6f67 6765 7229 0a0a  logger=logger)..
+0002a4b0: 2020 2020 6966 206e 756d 6572 616c 2e6c      if numeral.l
+0002a4c0: 6f77 6572 2829 203d 3d20 2723 7669 6927  ower() == '#vii'
+0002a4d0: 2061 6e64 206e 6f74 206d 696e 6f72 3a0a   and not minor:.
+0002a4e0: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+0002a4f0: 6172 6e69 6e67 2866 227b 4d43 7d7b 6e75  arning(f"{MC}{nu
+0002a500: 6d65 7261 6c7d 2069 6e20 6d61 6a6f 7220  meral} in major 
+0002a510: 636f 6e74 6578 7420 636f 7272 6563 7465  context correcte
+0002a520: 6420 746f 207b 6e75 6d65 7261 6c5b 313a  d to {numeral[1:
+0002a530: 5d7d 2e22 2c0a 2020 2020 2020 2020 2020  ]}.",.          
+0002a540: 2020 2020 2020 2020 2020 2020 2065 7874               ext
+0002a550: 7261 3d7b 276d 6573 7361 6765 5f69 6427  ra={'message_id'
+0002a560: 3a20 2832 372c 204d 4329 7d29 0a20 2020  : (27, MC)}).   
+0002a570: 2020 2020 206e 756d 6572 616c 203d 206e       numeral = n
+0002a580: 756d 6572 616c 5b31 3a5d 0a0a 2020 2020  umeral[1:]..    
+0002a590: 726f 6f74 5f61 6c74 6572 6174 696f 6e2c  root_alteration,
+0002a5a0: 206e 756d 5f64 6567 7265 6520 3d20 7370   num_degree = sp
+0002a5b0: 6c69 745f 7363 616c 655f 6465 6772 6565  lit_scale_degree
+0002a5c0: 286e 756d 6572 616c 2c20 636f 756e 743d  (numeral, count=
+0002a5d0: 5472 7565 2c20 6c6f 6767 6572 3d6c 6f67  True, logger=log
+0002a5e0: 6765 7229 0a0a 2020 2020 2320 6275 696c  ger)..    # buil
+0002a5f0: 6420 322d 6f63 7461 7665 2064 6961 746f  d 2-octave diato
+0002a600: 6e69 6320 7363 616c 6520 6f6e 2043 206d  nic scale on C m
+0002a610: 616a 6f72 2f6d 696e 6f72 0a20 2020 2072  ajor/minor.    r
+0002a620: 6f6f 7420 3d20 5b27 4927 2c20 2749 4927  oot = ['I', 'II'
+0002a630: 2c20 2749 4949 272c 2027 4956 272c 2027  , 'III', 'IV', '
+0002a640: 5627 2c20 2756 4927 2c20 2756 4949 275d  V', 'VI', 'VII']
+0002a650: 2e69 6e64 6578 286e 756d 5f64 6567 7265  .index(num_degre
+0002a660: 652e 7570 7065 7228 2929 0a20 2020 2074  e.upper()).    t
+0002a670: 7063 7320 3d20 3220 2a20 5b69 202b 206b  pcs = 2 * [i + k
+0002a680: 6579 2066 6f72 2069 2069 6e20 2830 2c20  ey for i in (0, 
+0002a690: 322c 202d 332c 202d 312c 2031 2c20 2d34  2, -3, -1, 1, -4
+0002a6a0: 2c20 2d32 295d 2069 6620 6d69 6e6f 7220  , -2)] if minor 
+0002a6b0: 656c 7365 2032 202a 205b 6920 2b20 6b65  else 2 * [i + ke
+0002a6c0: 7920 666f 7220 6920 696e 2028 302c 2032  y for i in (0, 2
+0002a6d0: 2c20 342c 202d 312c 2031 2c20 332c 2035  , 4, -1, 1, 3, 5
+0002a6e0: 295d 0a20 2020 2023 2073 7461 7274 696e  )].    # startin
+0002a6f0: 6720 7468 6520 7363 616c 6520 6672 6f6d  g the scale from
+0002a700: 2063 686f 7264 2072 6f6f 742c 2069 2e65   chord root, i.e
+0002a710: 2e20 726f 6f74 2077 696c 6c20 6265 2074  . root will be t
+0002a720: 7063 735b 305d 2c20 7468 6520 6368 6f72  pcs[0], the chor
+0002a730: 6427 7320 7365 7665 6e74 6820 7470 6373  d's seventh tpcs
+0002a740: 5b36 5d20 6574 632e 0a20 2020 2074 7063  [6] etc..    tpc
+0002a750: 7320 3d20 7470 6373 5b72 6f6f 743a 5d20  s = tpcs[root:] 
+0002a760: 2b20 7470 6373 5b3a 726f 6f74 5d0a 2020  + tpcs[:root].  
+0002a770: 2020 726f 6f74 203d 2074 7063 735b 305d    root = tpcs[0]
+0002a780: 202b 2037 202a 2072 6f6f 745f 616c 7465   + 7 * root_alte
+0002a790: 7261 7469 6f6e 0a20 2020 2074 7063 735b  ration.    tpcs[
+0002a7a0: 305d 203d 2072 6f6f 7420 2023 206f 6374  0] = root  # oct
+0002a7b0: 6176 6520 7374 6179 7320 6469 6174 6f6e  ave stays diaton
+0002a7c0: 6963 2c20 6973 206e 6f74 2061 6c74 6572  ic, is not alter
+0002a7d0: 6564 0a20 2020 2023 6c6f 6767 6572 2e64  ed.    #logger.d
+0002a7e0: 6562 7567 2866 227b 6e75 6d5f 6465 6772  ebug(f"{num_degr
+0002a7f0: 6565 7d3a 2054 6865 207b 276d 696e 6f72  ee}: The {'minor
+0002a800: 2720 6966 206d 696e 6f72 2065 6c73 6520  ' if minor else 
+0002a810: 276d 616a 6f72 277d 2073 6361 6c65 2073  'major'} scale s
+0002a820: 7461 7274 696e 6720 6672 6f6d 2074 6865  tarting from the
+0002a830: 2072 6f6f 743a 207b 7470 6373 7d22 290a   root: {tpcs}").
+0002a840: 0a20 2020 2064 6566 2073 6574 5f69 7628  .    def set_iv(
+0002a850: 6368 6f72 645f 696e 7465 7276 616c 2c20  chord_interval, 
+0002a860: 696e 7465 7276 616c 5f73 697a 6529 3a0a  interval_size):.
+0002a870: 2020 2020 2020 2020 2222 2220 4164 6420          """ Add 
+0002a880: 746f 2074 6865 2069 6e74 6572 7661 6c20  to the interval 
+0002a890: 6f66 2061 2067 6976 656e 2063 686f 7264  of a given chord
+0002a8a0: 2069 6e74 6572 7661 6c20 696e 2060 7470   interval in `tp
+0002a8b0: 6373 6020 2862 6f74 6820 7669 6577 6564  cs` (both viewed
+0002a8c0: 2066 726f 6d20 7468 6520 726f 6f74 206e   from the root n
+0002a8d0: 6f74 6529 2e0a 0a20 2020 2020 2020 2050  ote)...        P
+0002a8e0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0002a8f0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0002a900: 2020 2020 2063 686f 7264 5f69 6e74 6572       chord_inter
+0002a910: 7661 6c20 3a20 3a6f 626a 3a60 696e 7460  val : :obj:`int`
+0002a920: 0a20 2020 2020 2020 2020 2020 2050 6173  .            Pas
+0002a930: 7320 3020 666f 7220 7468 6520 726f 6f74  s 0 for the root
+0002a940: 206e 6f74 652c 2032 2066 6f72 2074 6865   note, 2 for the
+0002a950: 2074 6869 7264 2c20 3820 666f 7220 7468   third, 8 for th
+0002a960: 6520 6e69 6e74 6820 6574 632e 0a20 2020  e ninth etc..   
+0002a970: 2020 2020 2069 6e74 6572 7661 6c5f 7369       interval_si
+0002a980: 7a65 203a 203a 6f62 6a3a 6069 6e74 600a  ze : :obj:`int`.
+0002a990: 2020 2020 2020 2020 2020 2020 5374 6163              Stac
+0002a9a0: 6b2d 6f66 2d66 6966 7468 7320 696e 7465  k-of-fifths inte
+0002a9b0: 7276 616c 2e0a 2020 2020 2020 2020 2222  rval..        ""
+0002a9c0: 220a 2020 2020 2020 2020 6e6f 6e6c 6f63  ".        nonloc
+0002a9d0: 616c 2074 7063 732c 2072 6f6f 740a 2020  al tpcs, root.  
+0002a9e0: 2020 2020 2020 6976 203d 2072 6f6f 7420        iv = root 
+0002a9f0: 2b20 696e 7465 7276 616c 5f73 697a 650a  + interval_size.
+0002aa00: 2020 2020 2020 2020 7470 6373 5b63 686f          tpcs[cho
+0002aa10: 7264 5f69 6e74 6572 7661 6c5d 203d 2069  rd_interval] = i
+0002aa20: 760a 2020 2020 2020 2020 7470 6373 5b63  v.        tpcs[c
+0002aa30: 686f 7264 5f69 6e74 6572 7661 6c20 2b20  hord_interval + 
+0002aa40: 375d 203d 2069 760a 0a20 2020 2069 735f  7] = iv..    is_
+0002aa50: 7472 6961 6420 3d20 6669 6762 6173 7320  triad = figbass 
+0002aa60: 696e 205b 2727 2c20 2736 272c 2027 3634  in ['', '6', '64
+0002aa70: 275d 0a20 2020 2069 735f 7365 7665 6e74  '].    is_sevent
+0002aa80: 685f 6368 6f72 6420 3d20 6669 6762 6173  h_chord = figbas
+0002aa90: 7320 696e 205b 2737 272c 2027 3635 272c  s in ['7', '65',
+0002aaa0: 2027 3433 272c 2027 3227 5d0a 2020 2020   '43', '2'].    
+0002aab0: 6966 206e 6f74 2069 735f 7472 6961 6420  if not is_triad 
+0002aac0: 616e 6420 6e6f 7420 6973 5f73 6576 656e  and not is_seven
+0002aad0: 7468 5f63 686f 7264 3a0a 2020 2020 2020  th_chord:.      
+0002aae0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0002aaf0: 6f72 2866 227b 4d43 7d7b 6669 6762 6173  or(f"{MC}{figbas
+0002ab00: 737d 2069 7320 6e6f 7420 6120 7661 6c69  s} is not a vali
+0002ab10: 6420 6368 6f72 6420 696e 7665 7273 696f  d chord inversio
+0002ab20: 6e2e 2229 0a0a 2020 2020 6966 2066 6f72  n.")..    if for
+0002ab30: 6d20 3d3d 2027 6f27 3a0a 2020 2020 2020  m == 'o':.      
+0002ab40: 2020 7365 745f 6976 2832 2c20 2d33 290a    set_iv(2, -3).
+0002ab50: 2020 2020 2020 2020 7365 745f 6976 2834          set_iv(4
+0002ab60: 2c20 2d36 290a 2020 2020 2020 2020 6966  , -6).        if
+0002ab70: 2069 735f 7365 7665 6e74 685f 6368 6f72   is_seventh_chor
+0002ab80: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+0002ab90: 6574 5f69 7628 362c 202d 3929 0a20 2020  et_iv(6, -9).   
+0002aba0: 2065 6c69 6620 666f 726d 203d 3d20 2725   elif form == '%
+0002abb0: 273a 0a20 2020 2020 2020 2073 6574 5f69  ':.        set_i
+0002abc0: 7628 322c 202d 3329 0a20 2020 2020 2020  v(2, -3).       
+0002abd0: 2073 6574 5f69 7628 342c 202d 3629 0a20   set_iv(4, -6). 
+0002abe0: 2020 2020 2020 2073 6574 5f69 7628 362c         set_iv(6,
+0002abf0: 202d 3229 0a20 2020 2065 6c69 6620 666f   -2).    elif fo
+0002ac00: 726d 203d 3d20 272b 273a 0a20 2020 2020  rm == '+':.     
+0002ac10: 2020 2073 6574 5f69 7628 322c 2034 290a     set_iv(2, 4).
+0002ac20: 2020 2020 2020 2020 7365 745f 6976 2834          set_iv(4
+0002ac30: 2c20 3829 0a20 2020 2020 2020 2069 6620  , 8).        if 
+0002ac40: 6973 5f73 6576 656e 7468 5f63 686f 7264  is_seventh_chord
+0002ac50: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0002ac60: 745f 6976 2836 2c20 2d32 290a 2020 2020  t_iv(6, -2).    
+0002ac70: 656c 6966 2066 6f72 6d20 3d3d 2027 2b4d  elif form == '+M
+0002ac80: 273a 0a20 2020 2020 2020 2073 6574 5f69  ':.        set_i
+0002ac90: 7628 322c 2034 290a 2020 2020 2020 2020  v(2, 4).        
+0002aca0: 7365 745f 6976 2834 2c20 3829 0a20 2020  set_iv(4, 8).   
+0002acb0: 2020 2020 2073 6574 5f69 7628 362c 2035       set_iv(6, 5
+0002acc0: 290a 2020 2020 656c 7365 3a20 2023 2074  ).    else:  # t
+0002acd0: 7269 6164 2077 6974 6820 6f72 2077 6974  riad with or wit
+0002ace0: 686f 7574 206d 616a 6f72 206f 7220 6d69  hout major or mi
+0002acf0: 6e6f 7220 7365 7665 6e0a 2020 2020 2020  nor seven.      
+0002ad00: 2020 7365 745f 6976 2834 2c20 3129 0a20    set_iv(4, 1). 
+0002ad10: 2020 2020 2020 2069 6620 6e75 6d5f 6465         if num_de
+0002ad20: 6772 6565 2e69 7375 7070 6572 2829 3a0a  gree.isupper():.
+0002ad30: 2020 2020 2020 2020 2020 2020 7365 745f              set_
+0002ad40: 6976 2832 2c20 3429 0a20 2020 2020 2020  iv(2, 4).       
+0002ad50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002ad60: 2020 2073 6574 5f69 7628 322c 202d 3329     set_iv(2, -3)
+0002ad70: 0a20 2020 2020 2020 2069 6620 666f 726d  .        if form
+0002ad80: 203d 3d20 274d 273a 0a20 2020 2020 2020   == 'M':.       
+0002ad90: 2020 2020 2073 6574 5f69 7628 362c 2035       set_iv(6, 5
+0002ada0: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
+0002adb0: 735f 7365 7665 6e74 685f 6368 6f72 643a  s_seventh_chord:
+0002adc0: 0a20 2020 2020 2020 2020 2020 2073 6574  .            set
+0002add0: 5f69 7628 362c 202d 3229 0a0a 2020 2020  _iv(6, -2)..    
+0002ade0: 746f 6e65 5f66 756e 6374 696f 6e73 203d  tone_functions =
+0002adf0: 2028 302c 2032 2c20 342c 2036 2920 6966   (0, 2, 4, 6) if
+0002ae00: 2069 735f 7365 7665 6e74 685f 6368 6f72   is_seventh_chor
+0002ae10: 6420 656c 7365 2028 302c 2032 2c20 3429  d else (0, 2, 4)
+0002ae20: 0a20 2020 2072 6f6f 745f 706f 7369 7469  .    root_positi
+0002ae30: 6f6e 203d 207b 693a 205b 7470 6373 5b69  on = {i: [tpcs[i
+0002ae40: 5d5d 2066 6f72 2069 2069 6e20 746f 6e65  ]] for i in tone
+0002ae50: 5f66 756e 6374 696f 6e73 7d0a 2020 2020  _functions}.    
+0002ae60: 7265 706c 6163 656d 656e 7473 2020 3d20  replacements  = 
+0002ae70: 7b69 3a20 5b5d 2066 6f72 2069 2069 6e20  {i: [] for i in 
+0002ae80: 746f 6e65 5f66 756e 6374 696f 6e73 7d0a  tone_functions}.
+0002ae90: 0a20 2020 2064 6566 2072 6570 6c61 6365  .    def replace
+0002aea0: 5f63 686f 7264 5f74 6f6e 6528 7768 6963  _chord_tone(whic
+0002aeb0: 682c 2062 7929 3a0a 2020 2020 2020 2020  h, by):.        
+0002aec0: 6e6f 6e6c 6f63 616c 2072 6f6f 745f 706f  nonlocal root_po
+0002aed0: 7369 7469 6f6e 2c20 7265 706c 6163 656d  sition, replacem
+0002aee0: 656e 7473 0a20 2020 2020 2020 2069 6620  ents.        if 
+0002aef0: 7768 6963 6820 696e 2072 6f6f 745f 706f  which in root_po
+0002af00: 7369 7469 6f6e 3a0a 2020 2020 2020 2020  sition:.        
+0002af10: 2020 2020 726f 6f74 5f70 6f73 6974 696f      root_positio
+0002af20: 6e5b 7768 6963 685d 203d 205b 5d0a 2020  n[which] = [].  
+0002af30: 2020 2020 2020 2020 2020 7265 706c 6163            replac
+0002af40: 656d 656e 7473 5b77 6869 6368 5d2e 696e  ements[which].in
+0002af50: 7365 7274 2830 2c20 6279 290a 2020 2020  sert(0, by).    
+0002af60: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002af70: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+0002af80: 6e69 6e67 2866 224f 6e6c 7920 6368 6f72  ning(f"Only chor
+0002af90: 6420 746f 6e65 7320 5b30 2c32 2c34 2c28  d tones [0,2,4,(
+0002afa0: 3629 5d20 6361 6e20 6265 2072 6570 6c61  6)] can be repla
+0002afb0: 6365 642c 206e 6f74 207b 7768 6963 687d  ced, not {which}
+0002afc0: 2229 0a0a 2020 2020 2320 6170 706c 7920  ")..    # apply 
+0002afd0: 6368 616e 6765 730a 2020 2020 616c 7473  changes.    alts
+0002afe0: 203d 2063 6861 6e67 6573 326c 6973 7428   = changes2list(
+0002aff0: 6368 616e 6765 732c 2073 6f72 743d 4661  changes, sort=Fa
+0002b000: 6c73 6529 0a20 2020 2061 6464 6564 5f6e  lse).    added_n
+0002b010: 6f74 6573 203d 205b 5d0a 2020 2020 666f  otes = [].    fo
+0002b020: 7220 6675 6c6c 2c20 6164 645f 7265 6d6f  r full, add_remo
+0002b030: 7665 2c20 6163 632c 2063 686f 7264 5f69  ve, acc, chord_i
+0002b040: 6e74 6572 7661 6c20 696e 2061 6c74 733a  nterval in alts:
+0002b050: 0a20 2020 2020 2020 2061 6464 6564 203d  .        added =
+0002b060: 2061 6464 5f72 656d 6f76 6520 3d3d 2027   add_remove == '
+0002b070: 2b27 0a20 2020 2020 2020 2073 7562 7374  +'.        subst
+0002b080: 7261 6374 6564 203d 2061 6464 5f72 656d  racted = add_rem
+0002b090: 6f76 6520 3d3d 2027 2d27 0a20 2020 2020  ove == '-'.     
+0002b0a0: 2020 2072 6570 6c61 6369 6e67 5f75 7070     replacing_upp
+0002b0b0: 6572 203d 2061 6464 5f72 656d 6f76 6520  er = add_remove 
+0002b0c0: 3d3d 2027 5e27 0a20 2020 2020 2020 2072  == '^'.        r
+0002b0d0: 6570 6c61 6369 6e67 5f6c 6f77 6572 203d  eplacing_lower =
+0002b0e0: 2061 6464 5f72 656d 6f76 6520 3d3d 2027   add_remove == '
+0002b0f0: 7627 0a20 2020 2020 2020 2063 686f 7264  v'.        chord
+0002b100: 5f69 6e74 6572 7661 6c20 3d20 696e 7428  _interval = int(
+0002b110: 6368 6f72 645f 696e 7465 7276 616c 2920  chord_interval) 
+0002b120: 2d20 310a 2020 2020 2020 2020 2323 2320  - 1.        ### 
+0002b130: 4672 6f6d 2068 6572 6520 6f6e 2c20 6063  From here on, `c
+0002b140: 686f 7264 5f69 6e74 6572 7661 6c60 2069  hord_interval` i
+0002b150: 7320 6465 6372 656d 656e 7465 642c 2069  s decremented, i
+0002b160: 2e65 2e20 7468 6520 726f 6f74 2069 7320  .e. the root is 
+0002b170: 302c 2074 6865 2073 6576 656e 7468 2069  0, the seventh i
+0002b180: 7320 3620 6574 632e 2028 6a75 7374 206c  s 6 etc. (just l
+0002b190: 696b 6520 696e 2060 7470 6373 6029 0a20  ike in `tpcs`). 
+0002b1a0: 2020 2020 2020 2069 6620 2863 686f 7264         if (chord
+0002b1b0: 5f69 6e74 6572 7661 6c20 3d3d 2030 2061  _interval == 0 a
+0002b1c0: 6e64 206e 6f74 2073 7562 7374 7261 6374  nd not substract
+0002b1d0: 6564 2920 6f72 2063 686f 7264 5f69 6e74  ed) or chord_int
+0002b1e0: 6572 7661 6c20 3e20 3133 3a0a 2020 2020  erval > 13:.    
+0002b1f0: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+0002b200: 6172 6e69 6e67 280a 2020 2020 2020 2020  arning(.        
+0002b210: 2020 2020 2020 2020 6622 7b4d 437d 4368          f"{MC}Ch
+0002b220: 616e 6765 207b 6675 6c6c 7d20 6973 206d  ange {full} is m
+0002b230: 6561 6e69 6e67 6c65 7373 2061 6e64 2069  eaningless and i
+0002b240: 676e 6f72 6564 2062 6563 6175 7365 2069  gnored because i
+0002b250: 7420 636f 6e63 6572 6e73 2063 686f 7264  t concerns chord
+0002b260: 2074 6f6e 6520 7b63 686f 7264 5f69 6e74   tone {chord_int
+0002b270: 6572 7661 6c20 2b20 317d 2e22 290a 2020  erval + 1}.").  
+0002b280: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0002b290: 7565 0a20 2020 2020 2020 206e 6578 745f  ue.        next_
+0002b2a0: 6f63 7461 7665 203d 2063 686f 7264 5f69  octave = chord_i
+0002b2b0: 6e74 6572 7661 6c20 3e20 370a 2020 2020  nterval > 7.    
+0002b2c0: 2020 2020 7368 6966 7420 3d20 3720 2a20      shift = 7 * 
+0002b2d0: 2861 6363 2e63 6f75 6e74 2827 2327 2920  (acc.count('#') 
+0002b2e0: 2d20 6163 632e 636f 756e 7428 2762 2729  - acc.count('b')
+0002b2f0: 290a 2020 2020 2020 2020 6e65 775f 7661  ).        new_va
+0002b300: 6c20 3d20 7470 6373 5b63 686f 7264 5f69  l = tpcs[chord_i
+0002b310: 6e74 6572 7661 6c5d 202b 2073 6869 6674  nterval] + shift
+0002b320: 0a20 2020 2020 2020 2069 6620 7375 6273  .        if subs
+0002b330: 7472 6163 7465 643a 0a20 2020 2020 2020  tracted:.       
+0002b340: 2020 2020 2069 6620 6368 6f72 645f 696e       if chord_in
+0002b350: 7465 7276 616c 206e 6f74 2069 6e20 746f  terval not in to
+0002b360: 6e65 5f66 756e 6374 696f 6e73 3a0a 2020  ne_functions:.  
+0002b370: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+0002b380: 6767 6572 2e77 6172 6e69 6e67 280a 2020  gger.warning(.  
+0002b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b3a0: 2020 6622 7b4d 437d 5468 6520 6368 616e    f"{MC}The chan
+0002b3b0: 6765 207b 6675 6c6c 7d20 6861 7320 6e6f  ge {full} has no
+0002b3c0: 2065 6666 6563 7420 6265 6361 7573 6520   effect because 
+0002b3d0: 6974 2063 6f6e 6365 726e 7320 616e 2069  it concerns an i
+0002b3e0: 6e74 6572 7661 6c20 7768 6963 6820 6973  nterval which is
+0002b3f0: 206e 6f74 2069 6d70 6c69 6564 2062 7920   not implied by 
+0002b400: 7b6e 756d 6572 616c 7d7b 666f 726d 7d7b  {numeral}{form}{
+0002b410: 6669 6762 6173 737d 2e22 290a 2020 2020  figbass}.").    
+0002b420: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002b430: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+0002b440: 6f74 5f70 6f73 6974 696f 6e5b 6368 6f72  ot_position[chor
+0002b450: 645f 696e 7465 7276 616c 5d20 3d20 5b5d  d_interval] = []
+0002b460: 0a20 2020 2020 2020 2065 6c69 6620 6164  .        elif ad
+0002b470: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
+0002b480: 2061 6464 6564 5f6e 6f74 6573 2e61 7070   added_notes.app
+0002b490: 656e 6428 6e65 775f 7661 6c29 0a20 2020  end(new_val).   
+0002b4a0: 2020 2020 2065 6c69 6620 6e65 7874 5f6f       elif next_o
+0002b4b0: 6374 6176 653a 0a20 2020 2020 2020 2020  ctave:.         
+0002b4c0: 2020 2069 6620 616e 7928 2872 6570 6c61     if any((repla
+0002b4d0: 6369 6e67 5f6c 6f77 6572 2c20 7265 706c  cing_lower, repl
+0002b4e0: 6163 696e 675f 7570 7065 722c 2073 7562  acing_upper, sub
+0002b4f0: 7374 7261 6374 6564 2929 3a0a 2020 2020  stracted)):.    
+0002b500: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0002b510: 6572 2e69 6e66 6f28 6622 7b4d 437d 7b66  er.info(f"{MC}{f
+0002b520: 756c 6c5b 305d 7d20 6861 7320 6e6f 2065  ull[0]} has no e
+0002b530: 6666 6563 7420 696e 207b 6675 6c6c 7d20  ffect in {full} 
+0002b540: 2062 6563 6175 7365 2074 6865 2069 6e74   because the int
+0002b550: 6572 7661 6c20 6973 206c 6172 6765 7220  erval is larger 
+0002b560: 7468 616e 2061 6e20 6f63 7461 7665 2e22  than an octave."
+0002b570: 290a 2020 2020 2020 2020 2020 2020 6164  ).            ad
+0002b580: 6465 645f 6e6f 7465 732e 6170 7065 6e64  ded_notes.append
+0002b590: 286e 6577 5f76 616c 290a 2020 2020 2020  (new_val).      
+0002b5a0: 2020 656c 6966 2063 686f 7264 5f69 6e74    elif chord_int
+0002b5b0: 6572 7661 6c20 696e 205b 312c 2033 2c20  erval in [1, 3, 
+0002b5c0: 355d 3a20 2023 2074 6865 7365 2061 7265  5]:  # these are
+0002b5d0: 2063 6861 6e67 6573 2074 6f20 7363 616c   changes to scal
+0002b5e0: 6520 6465 6772 6565 2032 2c20 342c 2036  e degree 2, 4, 6
+0002b5f0: 2074 6861 7420 7265 706c 6163 6520 7468   that replace th
+0002b600: 6520 6c6f 7765 7220 6e65 6967 6862 6f75  e lower neighbou
+0002b610: 7220 756e 6c65 7373 2074 6865 7920 6861  r unless they ha
+0002b620: 7665 2061 2023 206f 7220 5e0a 2020 2020  ve a # or ^.    
+0002b630: 2020 2020 2020 2020 6966 2027 2327 2069          if '#' i
+0002b640: 6e20 6163 6320 6f72 2072 6570 6c61 6369  n acc or replaci
+0002b650: 6e67 5f75 7070 6572 3a0a 2020 2020 2020  ng_upper:.      
+0002b660: 2020 2020 2020 2020 2020 6966 2027 2327            if '#'
+0002b670: 2069 6e20 6163 6320 616e 6420 7265 706c   in acc and repl
+0002b680: 6163 696e 675f 7570 7065 723a 0a20 2020  acing_upper:.   
+0002b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b6a0: 206c 6f67 6765 722e 696e 666f 2866 227b   logger.info(f"{
+0002b6b0: 4d43 7d5e 2069 7320 7265 6475 6e64 616e  MC}^ is redundan
+0002b6c0: 7420 696e 207b 6675 6c6c 7d2e 2229 0a20  t in {full}."). 
+0002b6d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002b6e0: 6620 6368 6f72 645f 696e 7465 7276 616c  f chord_interval
+0002b6f0: 203d 3d20 3520 616e 6420 6973 5f74 7269   == 5 and is_tri
+0002b700: 6164 3a20 2023 206c 6561 6469 6e67 2074  ad:  # leading t
+0002b710: 6f6e 6520 746f 2037 2062 7574 206e 6f74  one to 7 but not
+0002b720: 2069 6e20 7365 7665 6e74 6820 6368 6f72   in seventh chor
+0002b730: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0002b740: 2020 2020 2020 6164 6465 645f 6e6f 7465        added_note
+0002b750: 732e 6170 7065 6e64 286e 6577 5f76 616c  s.append(new_val
+0002b760: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002b770: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002b780: 2020 2020 2020 2020 2020 2020 7265 706c              repl
+0002b790: 6163 655f 6368 6f72 645f 746f 6e65 2863  ace_chord_tone(c
+0002b7a0: 686f 7264 5f69 6e74 6572 7661 6c20 2b20  hord_interval + 
+0002b7b0: 312c 206e 6577 5f76 616c 290a 2020 2020  1, new_val).    
+0002b7c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002b7d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002b7e0: 2072 6570 6c61 6369 6e67 5f6c 6f77 6572   replacing_lower
+0002b7f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b800: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+0002b810: 6f28 6622 7b4d 437d 7620 6973 2072 6564  o(f"{MC}v is red
+0002b820: 756e 6461 6e74 2069 6e20 7b66 756c 6c7d  undant in {full}
+0002b830: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0002b840: 2020 2020 7265 706c 6163 655f 6368 6f72      replace_chor
+0002b850: 645f 746f 6e65 2863 686f 7264 5f69 6e74  d_tone(chord_int
+0002b860: 6572 7661 6c20 2d20 312c 206e 6577 5f76  erval - 1, new_v
+0002b870: 616c 290a 2020 2020 2020 2020 656c 7365  al).        else
+0002b880: 3a20 2023 2063 686f 7264 2074 6f6e 6520  :  # chord tone 
+0002b890: 616c 7465 7261 7469 6f6e 730a 2020 2020  alterations.    
+0002b8a0: 2020 2020 2020 2020 6966 2072 6570 6c61          if repla
+0002b8b0: 6369 6e67 5f6c 6f77 6572 3a0a 2020 2020  cing_lower:.    
+0002b8c0: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
+0002b8d0: 444f 3a20 5468 6973 206d 7573 7420 6265  DO: This must be
+0002b8e0: 2070 6f73 7369 626c 652c 2065 2e67 2e20   possible, e.g. 
+0002b8f0: 5628 3676 3529 2077 6865 7265 2035 2069  V(6v5) where 5 i
+0002b900: 7320 7375 7370 656e 7369 6f6e 206f 6620  s suspension of 
+0002b910: 340a 2020 2020 2020 2020 2020 2020 2020  4.              
+0002b920: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
+0002b930: 7b4d 437d 7b66 756c 6c7d 202d 3e20 6368  {MC}{full} -> ch
+0002b940: 6f72 6420 746f 6e65 7320 6361 6e6e 6f74  ord tones cannot
+0002b950: 2072 6570 6c61 6365 206e 6569 6768 626f   replace neighbo
+0002b960: 7572 732c 2075 7365 202b 2069 6e73 7465  urs, use + inste
+0002b970: 6164 2e22 290a 2020 2020 2020 2020 2020  ad.").          
+0002b980: 2020 656c 6966 2063 686f 7264 5f69 6e74    elif chord_int
+0002b990: 6572 7661 6c20 3d3d 2036 2061 6e64 2066  erval == 6 and f
+0002b9a0: 6967 6261 7373 2021 3d20 2737 273a 2020  igbass != '7':  
+0002b9b0: 2320 3774 6820 6172 6520 6120 7370 6563  # 7th are a spec
+0002b9c0: 6961 6c20 6361 7365 3a0a 2020 2020 2020  ial case:.      
+0002b9d0: 2020 2020 2020 2020 2020 6966 2066 6967            if fig
+0002b9e0: 6261 7373 203d 3d20 2727 3a20 2023 2069  bass == '':  # i
+0002b9f0: 6e20 726f 6f74 2070 6f73 6974 696f 6e20  n root position 
+0002ba00: 7472 6961 6473 2074 6865 7920 6172 6520  triads they are 
+0002ba10: 6164 6465 640a 2020 2020 2020 2020 2020  added.          
+0002ba20: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
+0002ba30: 3a20 5468 6520 7374 616e 6461 7264 2069  : The standard i
+0002ba40: 7320 6c61 636b 696e 6720 6120 6469 7374  s lacking a dist
+0002ba50: 696e 6374 696f 6e2c 2062 6563 6175 7365  inction, because
+0002ba60: 2074 6865 2072 6f6f 7420 696e 2072 6f6f   the root in roo
+0002ba70: 7420 706f 732e 2063 616e 2061 6c73 6f20  t pos. can also 
+0002ba80: 6265 2072 6570 6c61 6365 6420 6672 6f6d  be replaced from
+0002ba90: 2062 656c 6f77 210a 2020 2020 2020 2020   below!.        
+0002baa0: 2020 2020 2020 2020 2020 2020 6164 6465              adde
+0002bab0: 645f 6e6f 7465 732e 6170 7065 6e64 286e  d_notes.append(n
+0002bac0: 6577 5f76 616c 290a 2020 2020 2020 2020  ew_val).        
+0002bad0: 2020 2020 2020 2020 656c 6966 2066 6967          elif fig
+0002bae0: 6261 7373 2069 6e20 5b27 3627 2c20 2736  bass in ['6', '6
+0002baf0: 3427 5d20 6f72 2027 2327 2069 6e20 6163  4'] or '#' in ac
+0002bb00: 633a 2020 2320 696e 2069 6e76 6572 7465  c:  # in inverte
+0002bb10: 6420 7472 6961 6473 2074 6865 7920 7265  d triads they re
+0002bb20: 706c 6163 6520 7468 6520 726f 6f74 2c20  place the root, 
+0002bb30: 6173 2064 6f65 7320 2337 0a20 2020 2020  as does #7.     
+0002bb40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0002bb50: 6570 6c61 6365 5f63 686f 7264 5f74 6f6e  eplace_chord_ton
+0002bb60: 6528 302c 206e 6577 5f76 616c 290a 2020  e(0, new_val).  
+0002bb70: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0002bb80: 7365 3a20 2023 206f 7468 6572 7769 7365  se:  # otherwise
+0002bb90: 2074 6865 7920 6172 6520 756e 636c 6561   they are unclea
+0002bba0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+0002bbb0: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+0002bbc0: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
+0002bbd0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0002bbe0: 7b4d 437d 496e 2073 6576 656e 7468 2063  {MC}In seventh c
+0002bbf0: 686f 7264 732c 2073 7563 6820 6173 207b  hords, such as {
+0002bc00: 6c61 6265 6c7d 2c20 6974 2069 7320 6e6f  label}, it is no
+0002bc10: 7420 636c 6561 7220 7768 6574 6865 7220  t clear whether 
+0002bc20: 7468 6520 7b66 756c 6c7d 2061 6c74 6572  the {full} alter
+0002bc30: 7320 7468 6520 3720 6f72 2072 6570 6c61  s the 7 or repla
+0002bc40: 6365 7320 7468 6520 3820 616e 6420 7368  ces the 8 and sh
+0002bc50: 6f75 6c64 206e 6f74 2062 6520 7573 6564  ould not be used
+0002bc60: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
+0002bc70: 2020 2020 2020 2020 2020 2020 6578 7472              extr
+0002bc80: 613d 7b22 6d65 7373 6167 655f 6964 223a  a={"message_id":
+0002bc90: 2028 3138 2c20 297d 290a 2020 2020 2020   (18, )}).      
+0002bca0: 2020 2020 2020 656c 6966 2074 7063 735b        elif tpcs[
+0002bcb0: 6368 6f72 645f 696e 7465 7276 616c 5d20  chord_interval] 
+0002bcc0: 3d3d 206e 6577 5f76 616c 3a0a 2020 2020  == new_val:.    
+0002bcd0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0002bce0: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
+0002bcf0: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
+0002bd00: 4d43 7d54 6865 2063 6861 6e67 6520 7b66  MC}The change {f
+0002bd10: 756c 6c7d 2068 6173 206e 6f20 6566 6665  ull} has no effe
+0002bd20: 6374 2069 6e20 7b6e 756d 6572 616c 7d7b  ct in {numeral}{
+0002bd30: 666f 726d 7d7b 6669 6762 6173 737d 2229  form}{figbass}")
+0002bd40: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0002bd50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002bd60: 2020 2072 6f6f 745f 706f 7369 7469 6f6e     root_position
+0002bd70: 5b63 686f 7264 5f69 6e74 6572 7661 6c5d  [chord_interval]
+0002bd80: 203d 205b 6e65 775f 7661 6c5d 0a0a 2020   = [new_val]..  
+0002bd90: 2020 6669 6762 6173 7332 6261 7373 203d    figbass2bass =
+0002bda0: 207b 0a20 2020 2020 2020 2027 273a 2030   {.        '': 0
+0002bdb0: 2c0a 2020 2020 2020 2020 2737 273a 2030  ,.        '7': 0
+0002bdc0: 2c0a 2020 2020 2020 2020 2736 273a 2031  ,.        '6': 1
+0002bdd0: 2c0a 2020 2020 2020 2020 2736 3527 3a20  ,.        '65': 
+0002bde0: 312c 0a20 2020 2020 2020 2027 3634 273a  1,.        '64':
+0002bdf0: 2032 2c0a 2020 2020 2020 2020 2734 3327   2,.        '43'
+0002be00: 3a20 322c 0a20 2020 2020 2020 2027 3227  : 2,.        '2'
+0002be10: 3a20 330a 2020 2020 7d0a 2020 2020 6261  : 3.    }.    ba
+0002be20: 7373 203d 2066 6967 6261 7373 3262 6173  ss = figbass2bas
+0002be30: 735b 6669 6762 6173 735d 0a20 2020 2063  s[figbass].    c
+0002be40: 686f 7264 5f74 6f6e 6573 203d 205b 5d0a  hord_tones = [].
+0002be50: 2020 2020 746f 6e65 5f66 756e 6374 696f      tone_functio
+0002be60: 6e5f 6e61 6d65 7320 3d20 7b0a 2020 2020  n_names = {.    
+0002be70: 2020 2020 303a 2027 726f 6f74 272c 0a20      0: 'root',. 
+0002be80: 2020 2020 2020 2032 3a20 2733 7264 272c         2: '3rd',
+0002be90: 0a20 2020 2020 2020 2034 3a20 2735 7468  .        4: '5th
+0002bea0: 272c 0a20 2020 2020 2020 2036 3a20 2737  ',.        6: '7
+0002beb0: 7468 272c 0a20 2020 207d 0a20 2020 2066  th',.    }.    f
+0002bec0: 6f72 2074 6620 696e 2074 6f6e 655f 6675  or tf in tone_fu
+0002bed0: 6e63 7469 6f6e 735b 6261 7373 3a5d 202b  nctions[bass:] +
+0002bee0: 2074 6f6e 655f 6675 6e63 7469 6f6e 735b   tone_functions[
+0002bef0: 3a62 6173 735d 3a0a 2020 2020 2020 2020  :bass]:.        
+0002bf00: 6368 6f72 645f 746f 6e65 2c20 7265 706c  chord_tone, repl
+0002bf10: 6163 696e 675f 746f 6e65 7320 3d20 726f  acing_tones = ro
+0002bf20: 6f74 5f70 6f73 6974 696f 6e5b 7466 5d2c  ot_position[tf],
+0002bf30: 2072 6570 6c61 6365 6d65 6e74 735b 7466   replacements[tf
+0002bf40: 5d0a 2020 2020 2020 2020 6966 2063 686f  ].        if cho
+0002bf50: 7264 5f74 6f6e 6520 3d3d 2072 6570 6c61  rd_tone == repla
+0002bf60: 6369 6e67 5f74 6f6e 6573 203d 3d20 5b5d  cing_tones == []
+0002bf70: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+0002bf80: 6767 6572 2e64 6562 7567 2866 227b 4d43  gger.debug(f"{MC
+0002bf90: 7d7b 6c61 6265 6c7d 2072 6573 756c 7473  }{label} results
+0002bfa0: 2069 6e20 6120 6368 6f72 6420 7769 7468   in a chord with
+0002bfb0: 6f75 7420 7b74 6f6e 655f 6675 6e63 7469  out {tone_functi
+0002bfc0: 6f6e 5f6e 616d 6573 5b74 665d 7d2e 2229  on_names[tf]}.")
+0002bfd0: 0a20 2020 2020 2020 2069 6620 6368 6f72  .        if chor
+0002bfe0: 645f 746f 6e65 2021 3d20 5b5d 3a0a 2020  d_tone != []:.  
+0002bff0: 2020 2020 2020 2020 2020 6368 6f72 645f            chord_
+0002c000: 746f 6e65 732e 6170 7065 6e64 2863 686f  tones.append(cho
+0002c010: 7264 5f74 6f6e 655b 305d 290a 2020 2020  rd_tone[0]).    
+0002c020: 2020 2020 2020 2020 6966 2072 6570 6c61          if repla
+0002c030: 6369 6e67 5f74 6f6e 6573 2021 3d20 5b5d  cing_tones != []
+0002c040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002c050: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+0002c060: 2866 227b 4d43 7d7b 6c61 6265 6c7d 2072  (f"{MC}{label} r
+0002c070: 6573 756c 7473 2069 6e20 6120 6368 6f72  esults in a chor
+0002c080: 6420 746f 6e65 207b 746f 6e65 5f66 756e  d tone {tone_fun
+0002c090: 6374 696f 6e5f 6e61 6d65 735b 7466 5d7d  ction_names[tf]}
+0002c0a0: 2041 4e44 2069 7473 2072 6570 6c61 6365   AND its replace
+0002c0b0: 6d65 6e74 2873 2920 2854 5043 207b 7265  ment(s) (TPC {re
+0002c0c0: 706c 6163 696e 675f 746f 6e65 737d 292e  placing_tones}).
+0002c0d0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0002c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c0f0: 2020 6622 596f 7520 6d69 6768 7420 7761    f"You might wa
+0002c100: 6e74 2074 6f20 6164 6420 6120 2b20 746f  nt to add a + to
+0002c110: 2064 6973 7469 6e67 7569 7368 2066 726f   distinguish fro
+0002c120: 6d20 6120 7375 7370 656e 7369 6f6e 2c20  m a suspension, 
+0002c130: 6f72 2061 6464 2074 6869 7320 7761 726e  or add this warn
+0002c140: 696e 6720 746f 2049 474e 4f52 4544 5f57  ing to IGNORED_W
+0002c150: 4152 4e49 4e47 5320 7769 7468 2061 2063  ARNINGS with a c
+0002c160: 6f6d 6d65 6e74 2e22 2c0a 2020 2020 2020  omment.",.      
+0002c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c180: 2020 2020 2020 2020 2065 7874 7261 3d7b           extra={
+0002c190: 226d 6573 7361 6765 5f69 6422 3a20 2836  "message_id": (6
+0002c1a0: 2c20 6d63 2c20 6c61 6265 6c29 7d29 0a20  , mc, label)}). 
+0002c1b0: 2020 2020 2020 2063 686f 7264 5f74 6f6e         chord_ton
+0002c1c0: 6573 2e65 7874 656e 6428 7265 706c 6163  es.extend(replac
+0002c1d0: 696e 675f 746f 6e65 7329 0a0a 2020 2020  ing_tones)..    
+0002c1e0: 6261 7373 5f74 7063 203d 2063 686f 7264  bass_tpc = chord
+0002c1f0: 5f74 6f6e 6573 5b30 5d0a 2020 2020 6966  _tones[0].    if
+0002c200: 2062 6173 735f 6f6e 6c79 3a0a 2020 2020   bass_only:.    
+0002c210: 2020 2020 7265 7475 726e 2062 6173 735f      return bass_
+0002c220: 7470 630a 2020 2020 656c 6966 206d 6572  tpc.    elif mer
+0002c230: 6765 5f74 6f6e 6573 3a0a 2020 2020 2020  ge_tones:.      
+0002c240: 2020 7265 7475 726e 2074 7570 6c65 2873    return tuple(s
+0002c250: 6f72 745f 7470 6373 2863 686f 7264 5f74  ort_tpcs(chord_t
+0002c260: 6f6e 6573 202b 2061 6464 6564 5f6e 6f74  ones + added_not
+0002c270: 6573 2c20 7374 6172 743d 6261 7373 5f74  es, start=bass_t
+0002c280: 7063 2929 0a20 2020 2065 6c73 653a 0a20  pc)).    else:. 
+0002c290: 2020 2020 2020 2072 6574 7572 6e20 7b0a         return {.
+0002c2a0: 2020 2020 2020 2020 2020 2020 2763 686f              'cho
+0002c2b0: 7264 5f74 6f6e 6573 273a 2074 7570 6c65  rd_tones': tuple
+0002c2c0: 2863 686f 7264 5f74 6f6e 6573 292c 0a20  (chord_tones),. 
+0002c2d0: 2020 2020 2020 2020 2020 2027 6164 6465             'adde
+0002c2e0: 645f 746f 6e65 7327 3a20 7475 706c 6528  d_tones': tuple(
+0002c2f0: 6164 6465 645f 6e6f 7465 7329 2c0a 2020  added_notes),.  
+0002c300: 2020 2020 2020 2020 2020 2772 6f6f 7427            'root'
+0002c310: 3a20 726f 6f74 2c0a 2020 2020 2020 2020  : root,.        
+0002c320: 7d0a 0a64 6566 2070 6174 6832 7061 7265  }..def path2pare
+0002c330: 6e74 5f63 6f72 7075 7328 7061 7468 293a  nt_corpus(path):
+0002c340: 0a20 2020 2022 2222 5761 6c6b 2075 7020  .    """Walk up 
+0002c350: 7468 6520 7061 7468 2061 6e64 2072 6574  the path and ret
+0002c360: 7572 6e20 7468 6520 6e61 6d65 206f 6620  urn the name of 
+0002c370: 7468 6520 6669 7273 7420 7375 7065 7264  the first superd
+0002c380: 6972 6563 746f 7279 2074 6861 7420 6973  irectory that is
+0002c390: 2061 2067 6974 2072 6570 6f73 6974 6f72   a git repositor
+0002c3a0: 7920 6f72 2063 6f6e 7461 696e 7320 6120  y or contains a 
+0002c3b0: 276d 6574 6164 6174 612e 7473 7627 2066  'metadata.tsv' f
+0002c3c0: 696c 652e 2222 220a 2020 2020 6966 2070  ile.""".    if p
+0002c3d0: 6174 6820 696e 2028 2727 2c20 272f 2729  ath in ('', '/')
+0002c3e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0002c3f0: 204e 6f6e 650a 2020 2020 7472 793a 0a20   None.    try:. 
+0002c400: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+0002c410: 682e 6973 6469 7228 7061 7468 293a 0a20  h.isdir(path):. 
+0002c420: 2020 2020 2020 2020 2020 206c 6973 7464             listd
+0002c430: 6972 203d 206f 732e 6c69 7374 6469 7228  ir = os.listdir(
+0002c440: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+0002c450: 2020 6966 2027 6d65 7461 6461 7461 2e74    if 'metadata.t
+0002c460: 7376 2720 696e 206c 6973 7464 6972 206f  sv' in listdir o
+0002c470: 7220 272e 6769 7427 2069 6e20 6c69 7374  r '.git' in list
+0002c480: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
+0002c490: 2020 2020 2072 6574 7572 6e20 7061 7468       return path
+0002c4a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002c4b0: 7061 7468 3270 6172 656e 745f 636f 7270  path2parent_corp
+0002c4c0: 7573 286f 732e 7061 7468 2e64 6972 6e61  us(os.path.dirna
+0002c4d0: 6d65 2870 6174 6829 290a 2020 2020 6578  me(path)).    ex
+0002c4e0: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+0002c4f0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0002c500: 6f6e 650a 0a0a 4066 756e 6374 696f 6e5f  one...@function_
+0002c510: 6c6f 6767 6572 0a64 6566 2063 686f 7264  logger.def chord
+0002c520: 3274 7063 7328 6368 6f72 642c 2072 6567  2tpcs(chord, reg
+0002c530: 6578 3d4e 6f6e 652c 202a 2a6b 7761 7267  ex=None, **kwarg
+0002c540: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
+0002c550: 5370 6c69 7420 6120 6368 6f72 6420 6c61  Split a chord la
+0002c560: 6265 6c20 696e 746f 2069 7473 2066 6561  bel into its fea
+0002c570: 7475 7265 7320 616e 6420 6170 706c 7920  tures and apply 
+0002c580: 6665 6174 7572 6573 3274 7063 7328 292e  features2tpcs().
+0002c590: 0a0a 2020 2020 5573 6573 3a20 6665 6174  ..    Uses: feat
+0002c5a0: 7572 6573 3274 7063 7328 290a 0a20 2020  ures2tpcs()..   
+0002c5b0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+0002c5c0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2063  ----------.    c
+0002c5d0: 686f 7264 203a 203a 6f62 6a3a 6073 7472  hord : :obj:`str
+0002c5e0: 600a 2020 2020 2020 2020 4368 6f72 6420  `.        Chord 
+0002c5f0: 6c61 6265 6c20 7468 6174 2063 616e 2062  label that can b
+0002c600: 6520 7370 6c69 7420 696e 746f 2074 6865  e split into the
+0002c610: 2066 6561 7475 7265 7320 5b27 6e75 6d65   features ['nume
+0002c620: 7261 6c27 2c20 2766 6f72 6d27 2c20 2766  ral', 'form', 'f
+0002c630: 6967 6261 7373 272c 2027 6368 616e 6765  igbass', 'change
+0002c640: 7327 2c20 2772 656c 6174 6976 6572 6f6f  s', 'relativeroo
+0002c650: 7427 5d2e 0a20 2020 2072 6567 6578 203a  t']..    regex :
+0002c660: 203a 6f62 6a3a 6072 652e 5061 7474 6572   :obj:`re.Patter
+0002c670: 6e60 2c20 6f70 7469 6f6e 616c 0a20 2020  n`, optional.   
+0002c680: 2020 2020 2043 6f6d 7069 6c65 6420 7265       Compiled re
+0002c690: 6765 7820 7769 7468 206e 616d 6564 2067  gex with named g
+0002c6a0: 726f 7570 7320 666f 7220 7468 6520 6669  roups for the fi
+0002c6b0: 7665 2066 6561 7475 7265 732e 2042 7920  ve features. By 
+0002c6c0: 6465 6661 756c 742c 2074 6865 2063 7572  default, the cur
+0002c6d0: 7265 6e74 2076 6572 7369 6f6e 206f 6620  rent version of 
+0002c6e0: 7468 6520 4443 4d4c 2068 6172 6d6f 6e79  the DCML harmony
+0002c6f0: 0a20 2020 2020 2020 2061 6e6e 6f74 6174  .        annotat
+0002c700: 696f 6e20 7374 616e 6461 7264 2069 7320  ion standard is 
+0002c710: 7573 6564 2e0a 2020 2020 2a2a 6b77 6172  used..    **kwar
+0002c720: 6773 203a 0a20 2020 2020 2020 2061 7267  gs :.        arg
+0002c730: 756d 656e 7473 2066 6f72 2066 6561 7475  uments for featu
+0002c740: 7265 7332 7470 6373 2028 7061 7373 204d  res2tpcs (pass M
+0002c750: 4320 746f 2073 686f 7720 6974 2069 6e20  C to show it in 
+0002c760: 7761 726e 696e 6773 2129 0a20 2020 2022  warnings!).    "
+0002c770: 2222 0a20 2020 2069 6620 7265 6765 7820  "".    if regex 
+0002c780: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002c790: 2072 6567 6578 203d 2044 434d 4c5f 5245   regex = DCML_RE
+0002c7a0: 4745 580a 2020 2020 6368 6f72 645f 6665  GEX.    chord_fe
+0002c7b0: 6174 7572 6573 203d 2072 652e 6d61 7463  atures = re.matc
+0002c7c0: 6828 7265 6765 782c 2063 686f 7264 290a  h(regex, chord).
+0002c7d0: 2020 2020 6173 7365 7274 2063 686f 7264      assert chord
+0002c7e0: 5f66 6561 7475 7265 7320 6973 206e 6f74  _features is not
+0002c7f0: 204e 6f6e 652c 2066 227b 6368 6f72 647d   None, f"{chord}
+0002c800: 2064 6f65 7320 6e6f 7420 6d61 7463 6820   does not match 
+0002c810: 7468 6520 7265 6765 782e 220a 2020 2020  the regex.".    
+0002c820: 6368 6f72 645f 6665 6174 7572 6573 203d  chord_features =
+0002c830: 2063 686f 7264 5f66 6561 7475 7265 732e   chord_features.
+0002c840: 6772 6f75 7064 6963 7428 290a 2020 2020  groupdict().    
+0002c850: 6e75 6d65 7261 6c2c 2066 6f72 6d2c 2066  numeral, form, f
+0002c860: 6967 6261 7373 2c20 6368 616e 6765 732c  igbass, changes,
+0002c870: 2072 656c 6174 6976 6572 6f6f 7420 3d20   relativeroot = 
+0002c880: 7475 706c 6528 6368 6f72 645f 6665 6174  tuple(chord_feat
+0002c890: 7572 6573 5b66 5d20 666f 7220 6620 696e  ures[f] for f in
+0002c8a0: 2028 276e 756d 6572 616c 272c 2027 666f   ('numeral', 'fo
+0002c8b0: 726d 272c 2027 6669 6762 6173 7327 2c20  rm', 'figbass', 
+0002c8c0: 2763 6861 6e67 6573 272c 2027 7265 6c61  'changes', 'rela
+0002c8d0: 7469 7665 726f 6f74 2729 290a 2020 2020  tiveroot')).    
+0002c8e0: 7265 7475 726e 2066 6561 7475 7265 7332  return features2
+0002c8f0: 7470 6373 286e 756d 6572 616c 3d6e 756d  tpcs(numeral=num
+0002c900: 6572 616c 2c20 666f 726d 3d66 6f72 6d2c  eral, form=form,
+0002c910: 2066 6967 6261 7373 3d66 6967 6261 7373   figbass=figbass
+0002c920: 2c20 6368 616e 6765 733d 6368 616e 6765  , changes=change
+0002c930: 732c 2072 656c 6174 6976 6572 6f6f 743d  s, relativeroot=
+0002c940: 7265 6c61 7469 7665 726f 6f74 2c0a 2020  relativeroot,.  
+0002c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c960: 2020 2020 2020 206c 6f67 6765 723d 6c6f         logger=lo
+0002c970: 6767 6572 2c20 2a2a 6b77 6172 6773 290a  gger, **kwargs).
+0002c980: 0a0a 6465 6620 7472 616e 7370 6f73 6528  ..def transpose(
+0002c990: 652c 206e 293a 0a20 2020 2022 2222 2041  e, n):.    """ A
+0002c9a0: 6464 2060 6e60 2074 6f20 616c 6c20 656c  dd `n` to all el
+0002c9b0: 656d 656e 7473 2060 6560 2072 6563 7572  ements `e` recur
+0002c9c0: 7369 7665 6c79 2e0a 2020 2020 2222 220a  sively..    """.
+0002c9d0: 2020 2020 7265 7475 726e 206d 6170 3265      return map2e
+0002c9e0: 6c65 6d65 6e74 7328 652c 206c 616d 6264  lements(e, lambd
+0002c9f0: 6120 783a 2078 202b 206e 290a 0a0a 6465  a x: x + n)...de
+0002ca00: 6620 7061 7273 655f 6967 6e6f 7265 645f  f parse_ignored_
+0002ca10: 7761 726e 696e 6773 286d 6573 7361 6765  warnings(message
+0002ca20: 733a 2043 6f6c 6c65 6374 696f 6e5b 7374  s: Collection[st
+0002ca30: 725d 2920 2d3e 2049 7465 7261 746f 725b  r]) -> Iterator[
+0002ca40: 5475 706c 655b 7374 722c 2054 7570 6c65  Tuple[str, Tuple
+0002ca50: 5b69 6e74 5d5d 5d3a 0a20 2020 2022 2222  [int]]]:.    """
+0002ca60: 5475 726e 7320 6120 6c69 7374 206f 6620  Turns a list of 
+0002ca70: 6c6f 6720 6d65 7373 6167 6573 2069 6e74  log messages int
+0002ca80: 6f20 616e 2069 7465 7261 746f 7220 6f66  o an iterator of
+0002ca90: 2028 6c6f 6767 6572 5f6e 616d 652c 2028   (logger_name, (
+0002caa0: 6d65 7373 6167 655f 696e 666f 2c20 2e2e  message_info, ..
+0002cab0: 2e29 2920 7061 6972 732e 0a20 2020 204c  .)) pairs..    L
+0002cac0: 6f67 206d 6573 7361 6765 7320 636f 6e73  og messages cons
+0002cad0: 6973 7420 6f66 2061 2068 6561 6465 7220  ist of a header 
+0002cae0: 6f66 2074 6865 2073 6861 7065 2057 4152  of the shape WAR
+0002caf0: 4e49 4e47 5f45 4e55 4d5f 4d45 4d42 4552  NING_ENUM_MEMBER
+0002cb00: 2028 656e 756d 5f76 616c 7565 2c20 5b6d   (enum_value, [m
+0002cb10: 632c 206d 6f72 655f 696e 666f 2e2e 2e5d  c, more_info...]
+0002cb20: 2920 6d73 332e 2850 6172 7365 7c43 6f72  ) ms3.(Parse|Cor
+0002cb30: 7075 7329 2e63 6f72 7075 732e 666e 616d  pus).corpus.fnam
+0002cb40: 6520 5b2d 2d20 706f 7465 6e74 6961 6c6c  e [-- potentiall
+0002cb50: 7920 6d6f 7265 2c20 6972 7265 6c65 7661  y more, irreleva
+0002cb60: 6e74 2073 7475 6666 5d2e 0a20 2020 2054  nt stuff]..    T
+0002cb70: 6865 2068 6561 6465 7220 6d69 6768 7420  he header might 
+0002cb80: 6265 2066 6f6c 6c6f 7765 6420 6279 2073  be followed by s
+0002cb90: 6576 6572 616c 206c 696e 6573 206f 6620  everal lines of 
+0002cba0: 636f 6d6d 656e 7473 2c20 6561 6368 2062  comments, each b
+0002cbb0: 6567 696e 6e69 6e67 2077 6974 6820 6120  eginning with a 
+0002cbc0: 7370 6163 6520 6f72 2074 6162 2e0a 2020  space or tab..  
+0002cbd0: 2020 2222 220a 2020 2020 6966 2069 7369    """.    if isi
+0002cbe0: 6e73 7461 6e63 6528 6d65 7373 6167 6573  nstance(messages
+0002cbf0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+0002cc00: 7969 656c 6420 6672 6f6d 2070 6172 7365  yield from parse
+0002cc10: 5f69 676e 6f72 6564 5f77 6172 6e69 6e67  _ignored_warning
+0002cc20: 7328 5b6d 6573 7361 6765 735d 290a 2020  s([messages]).  
+0002cc30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002cc40: 666f 7220 6d65 7373 6167 6520 696e 206d  for message in m
+0002cc50: 6573 7361 6765 733a 0a20 2020 2020 2020  essages:.       
+0002cc60: 2020 2020 2069 6620 275c 6e27 2069 6e20       if '\n' in 
+0002cc70: 6d65 7373 6167 653a 0a20 2020 2020 2020  message:.       
+0002cc80: 2020 2020 2020 2020 2079 6965 6c64 2066           yield f
+0002cc90: 726f 6d20 7061 7273 655f 6967 6e6f 7265  rom parse_ignore
+0002cca0: 645f 7761 726e 696e 6773 286d 6573 7361  d_warnings(messa
+0002ccb0: 6765 2e73 706c 6974 2827 5c6e 2729 290a  ge.split('\n')).
+0002ccc0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0002ccd0: 206d 6573 7361 6765 203d 3d20 2727 3a0a   message == '':.
+0002cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ccf0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0002cd00: 2020 2020 2065 6c69 6620 6d65 7373 6167       elif messag
+0002cd10: 655b 305d 2069 6e20 2827 2027 2c20 275c  e[0] in (' ', '\
+0002cd20: 7427 2c20 2723 2729 3a0a 2020 2020 2020  t', '#'):.      
+0002cd30: 2020 2020 2020 2020 2020 2320 6966 2073            # if s
+0002cd40: 6576 6572 616c 206c 696e 6573 206f 6620  everal lines of 
+0002cd50: 6120 7761 726e 696e 6720 7765 7265 2063  a warning were c
+0002cd60: 6f70 6965 642c 2075 7365 206f 6e6c 7920  opied, use only 
+0002cd70: 7468 6520 6669 7273 7420 6f6e 650a 2020  the first one.  
+0002cd80: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0002cd90: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+0002cda0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002cdb0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0002cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cdd0: 2020 2320 6966 2074 6865 2061 6e6e 6f74    # if the annot
+0002cde0: 6174 6f72 2063 6f70 6965 6420 746f 6f20  ator copied too 
+0002cdf0: 6d75 6368 2c20 6375 7420 6f66 6620 7468  much, cut off th
+0002ce00: 6520 7265 6475 6e64 616e 7420 696e 666f  e redundant info
+0002ce10: 726d 6174 696f 6e20 6174 2074 6865 2065  rmation at the e
+0002ce20: 6e64 0a20 2020 2020 2020 2020 2020 2020  nd.             
+0002ce30: 2020 2020 2020 2072 6564 756e 6461 6e74         redundant
+0002ce40: 203d 2020 6d65 7373 6167 652e 696e 6465   =  message.inde
+0002ce50: 7828 2720 2d2d 2027 290a 2020 2020 2020  x(' -- ').      
+0002ce60: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+0002ce70: 7373 6167 6520 3d20 6d65 7373 6167 655b  ssage = message[
+0002ce80: 3a72 6564 756e 6461 6e74 5d0a 2020 2020  :redundant].    
+0002ce90: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0002cea0: 7074 2056 616c 7565 4572 726f 723a 0a20  pt ValueError:. 
+0002ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cec0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+0002ced0: 2020 2020 2020 2020 6d65 7373 6167 6520          message 
+0002cee0: 3d20 6d65 7373 6167 652e 7374 7269 7028  = message.strip(
+0002cef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002cf00: 2020 7370 6c69 745f 7265 203d 2072 225e    split_re = r"^
+0002cf10: 282e 2a29 2028 5c53 2b29 2422 0a20 2020  (.*) (\S+)$".   
+0002cf20: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0002cf30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002cf40: 2020 2020 2020 6d73 672c 206c 6f67 6765        msg, logge
+0002cf50: 725f 6e61 6d65 203d 2072 652e 6d61 7463  r_name = re.matc
+0002cf60: 6828 7370 6c69 745f 7265 2c20 6d65 7373  h(split_re, mess
+0002cf70: 6167 6529 2e67 726f 7570 7328 290a 2020  age).groups().  
+0002cf80: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0002cf90: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
+0002cfa0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+0002cfb0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+0002cfc0: 2254 6865 2066 6f6c 6c6f 7769 6e67 206d  "The following m
+0002cfd0: 6573 7361 6765 2063 6f75 6c64 206e 6f74  essage could not
+0002cfe0: 2062 6520 7370 6c69 742c 2061 7070 6172   be split, appar
+0002cff0: 656e 746c 7920 6974 2064 6f65 7320 6e6f  ently it does no
+0002d000: 7420 656e 6420 7769 7468 2074 6865 206c  t end with the l
+0002d010: 6f67 6765 725f 6e61 6d65 3a20 7b6d 6573  ogger_name: {mes
+0002d020: 7361 6765 7d22 290a 2020 2020 2020 2020  sage}").        
+0002d030: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0002d040: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002d050: 2020 6966 206d 7367 5b2d 315d 2021 3d20    if msg[-1] != 
+0002d060: 2729 273a 0a20 2020 2020 2020 2020 2020  ')':.           
+0002d070: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
+0002d080: 6d73 672e 7374 6172 7473 7769 7468 286c  msg.startswith(l
+0002d090: 6576 656c 2920 666f 7220 6c65 7665 6c20  evel) for level 
+0002d0a0: 696e 2028 2744 4542 5547 272c 2027 494e  in ('DEBUG', 'IN
+0002d0b0: 464f 272c 2027 5741 524e 494e 4727 2c20  FO', 'WARNING', 
+0002d0c0: 2745 5252 4f52 272c 2027 4352 4954 4943  'ERROR', 'CRITIC
+0002d0d0: 414c 2729 293a 0a20 2020 2020 2020 2020  AL')):.         
+0002d0e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0002d0f0: 206d 6573 7361 6765 5f69 6420 6861 7320   message_id has 
+0002d100: 6e6f 7420 2879 6574 2920 7370 6563 6966  not (yet) specif
+0002d110: 6965 6420 666f 7220 7468 6973 206c 6f67  ied for this log
+0002d120: 206d 6573 7361 6765 2061 6e64 2069 7320   message and is 
+0002d130: 6967 6e6f 7265 643b 0a20 2020 2020 2020  ignored;.       
+0002d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d150: 2023 2061 2077 6172 6e69 6e67 2063 6f75   # a warning cou
+0002d160: 6c64 2062 6520 696d 706c 656d 656e 7465  ld be implemente
+0002d170: 6420 6174 2074 6869 7320 706f 696e 740a  d at this point.
+0002d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d190: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0002d1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d1b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d1d0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0002d1e0: 726f 7228 6622 556e 6578 7065 6374 6564  ror(f"Unexpected
+0002d1f0: 206c 6f67 206d 6573 7361 6765 2066 6f72   log message for
+0002d200: 6d61 743a 207b 6d73 677d 2229 0a20 2020  mat: {msg}").   
+0002d210: 2020 2020 2020 2020 2020 2020 2074 7570               tup
+0002d220: 6c65 5f73 7461 7274 203d 206d 7367 2e69  le_start = msg.i
+0002d230: 6e64 6578 2827 2827 2920 2b20 310a 2020  ndex('(') + 1.  
+0002d240: 2020 2020 2020 2020 2020 2020 2020 7475                tu
+0002d250: 706c 655f 7374 7220 3d20 6d73 675b 7475  ple_str = msg[tu
+0002d260: 706c 655f 7374 6172 743a 2d31 5d0a 2020  ple_start:-1].  
+0002d270: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0002d280: 666f 203d 2073 7472 3269 6e74 7475 706c  fo = str2inttupl
+0002d290: 6528 7475 706c 655f 7374 722c 2073 7472  e(tuple_str, str
+0002d2a0: 6963 743d 4661 6c73 6529 0a20 2020 2020  ict=False).     
+0002d2b0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+0002d2c0: 206c 6f67 6765 725f 6e61 6d65 2c20 696e   logger_name, in
+0002d2d0: 666f 0a0a 6465 6620 6967 6e6f 7265 645f  fo..def ignored_
+0002d2e0: 7761 726e 696e 6773 3264 6963 7428 6d65  warnings2dict(me
+0002d2f0: 7373 6167 6573 3a20 436f 6c6c 6563 7469  ssages: Collecti
+0002d300: 6f6e 5b73 7472 5d29 202d 3e20 4469 6374  on[str]) -> Dict
+0002d310: 5b73 7472 2c20 4c69 7374 5b54 7570 6c65  [str, List[Tuple
+0002d320: 5b69 6e74 5d5d 5d3a 0a20 2020 2022 2222  [int]]]:.    """
+0002d330: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
+0002d340: 2020 6d65 7373 6167 6573 3a0a 0a20 2020    messages:..   
+0002d350: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+0002d360: 7b6c 6f67 6765 725f 6e61 6d65 202d 3e20  {logger_name -> 
+0002d370: 5b69 676e 6f72 6564 5f77 6172 6e69 6e67  [ignored_warning
+0002d380: 735d 7d20 6469 6374 2e0a 2020 2020 2222  s]} dict..    ""
+0002d390: 220a 2020 2020 6967 6e6f 7265 645f 7761  ".    ignored_wa
+0002d3a0: 726e 696e 6773 203d 2064 6566 6175 6c74  rnings = default
+0002d3b0: 6469 6374 286c 6973 7429 0a20 2020 2066  dict(list).    f
+0002d3c0: 6f72 206c 6f67 6765 725f 6e61 6d65 2c20  or logger_name, 
+0002d3d0: 696e 666f 2069 6e20 7061 7273 655f 6967  info in parse_ig
+0002d3e0: 6e6f 7265 645f 7761 726e 696e 6773 286d  nored_warnings(m
+0002d3f0: 6573 7361 6765 7329 3a0a 2020 2020 2020  essages):.      
+0002d400: 2020 6967 6e6f 7265 645f 7761 726e 696e    ignored_warnin
+0002d410: 6773 5b6c 6f67 6765 725f 6e61 6d65 5d2e  gs[logger_name].
+0002d420: 6170 7065 6e64 2869 6e66 6f29 0a20 2020  append(info).   
+0002d430: 2072 6574 7572 6e20 6469 6374 2869 676e   return dict(ign
+0002d440: 6f72 6564 5f77 6172 6e69 6e67 7329 0a0a  ored_warnings)..
+0002d450: 6465 6620 7061 7273 655f 6967 6e6f 7265  def parse_ignore
+0002d460: 645f 7761 726e 696e 6773 5f66 696c 6528  d_warnings_file(
+0002d470: 7061 7468 3a20 7374 7229 202d 3e20 4469  path: str) -> Di
+0002d480: 6374 5b73 7472 2c20 4c69 7374 5b54 7570  ct[str, List[Tup
+0002d490: 6c65 5b69 6e74 2c20 5475 706c 655b 696e  le[int, Tuple[in
+0002d4a0: 745d 5d5d 5d3a 0a20 2020 2022 2222 5061  t]]]]:.    """Pa
+0002d4b0: 7273 6520 6669 6c65 2077 6974 6820 6c6f  rse file with lo
+0002d4c0: 6720 6d65 7373 6167 6573 2074 6861 7420  g messages that 
+0002d4d0: 6861 7665 2074 6f20 6265 2069 676e 6f72  have to be ignor
+0002d4e0: 6564 2074 6f20 7468 6520 6469 6374 2e0a  ed to the dict..
+0002d4f0: 2020 2020 5468 6520 6578 7065 6374 6564      The expected
+0002d500: 2073 7472 7563 7475 7265 206f 6620 6d65   structure of me
+0002d510: 7373 6167 653a 2077 6172 6e69 6e67 5f74  ssage: warning_t
+0002d520: 7970 6520 2877 6172 6e69 6e67 5f74 7970  ype (warning_typ
+0002d530: 655f 6964 2c20 2a69 6e74 6567 6572 7329  e_id, *integers)
+0002d540: 2066 696c 650a 2020 2020 4578 616d 706c   file.    Exampl
+0002d550: 6520 6f66 206d 6573 7361 6765 3a20 494e  e of message: IN
+0002d560: 434f 5252 4543 545f 564f 4c54 415f 4d4e  CORRECT_VOLTA_MN
+0002d570: 5f57 4152 4e49 4e47 2028 322c 2039 3429  _WARNING (2, 94)
+0002d580: 206d 7333 2e50 6172 7365 2e6d 6978 6564   ms3.Parse.mixed
+0002d590: 5f66 696c 6573 2e44 6964 3033 4d2d 536f  _files.Did03M-So
+0002d5a0: 6e5f 7265 6769 6e61 2d31 3736 322d 5361  n_regina-1762-Sa
+0002d5b0: 7274 692e 6d73 6378 2e4d 6561 7375 7265  rti.mscx.Measure
+0002d5c0: 4c69 7374 0a0a 2020 2020 5061 7261 6d65  List..    Parame
+0002d5d0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+0002d5e0: 2d2d 2d0a 2020 2020 6b65 7920 3a20 3a6f  ---.    key : :o
+0002d5f0: 626a 3a60 7374 7260 0a20 2020 2020 2020  bj:`str`.       
+0002d600: 207c 2050 6174 6820 746f 2049 474e 4f52   | Path to IGNOR
+0002d610: 4544 5f57 4152 4e49 4e47 530a 0a20 2020  ED_WARNINGS..   
+0002d620: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+0002d630: 2d2d 2d2d 0a20 2020 203a 6f62 6a3a 2064  ----.    :obj: d
+0002d640: 6963 740a 2020 2020 2020 2020 7b6c 6f67  ict.        {log
+0002d650: 6765 725f 6e61 6d65 3a20 5b28 6d65 7373  ger_name: [(mess
+0002d660: 6167 655f 6964 2c20 6c61 6265 6c5f 6f66  age_id, label_of
+0002d670: 5f6d 6573 7361 6765 292c 2028 6d65 7373  _message), (mess
+0002d680: 6167 655f 6964 2c20 6c61 6265 6c5f 6f66  age_id, label_of
+0002d690: 5f6d 6573 7361 6765 292c 202e 2e2e 5d7d  _message), ...]}
+0002d6a0: 2e0a 2020 2020 2222 220a 2020 2020 7061  ..    """.    pa
+0002d6b0: 7468 203d 2072 6573 6f6c 7665 5f64 6972  th = resolve_dir
+0002d6c0: 2870 6174 6829 0a20 2020 206d 6573 7361  (path).    messa
+0002d6d0: 6765 7320 3d20 6f70 656e 2870 6174 682c  ges = open(path,
+0002d6e0: 2027 7227 2c20 656e 636f 6469 6e67 3d27   'r', encoding='
+0002d6f0: 7574 662d 3827 292e 7265 6164 6c69 6e65  utf-8').readline
+0002d700: 7328 290a 2020 2020 7265 7475 726e 2069  s().    return i
+0002d710: 676e 6f72 6564 5f77 6172 6e69 6e67 7332  gnored_warnings2
+0002d720: 6469 6374 286d 6573 7361 6765 7329 0a0a  dict(messages)..
+0002d730: 0a64 6566 206f 7665 726c 6170 7069 6e67  .def overlapping
+0002d740: 5f63 6875 6e6b 5f70 6572 5f69 6e74 6572  _chunk_per_inter
+0002d750: 7661 6c28 6466 3a20 7064 2e44 6174 6146  val(df: pd.DataF
+0002d760: 7261 6d65 2c0a 2020 2020 2020 2020 2020  rame,.          
+0002d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d780: 2020 2020 2020 2020 2069 6e74 6572 7661           interva
+0002d790: 6c73 3a20 4c69 7374 5b70 642e 496e 7465  ls: List[pd.Inte
+0002d7a0: 7276 616c 5d2c 0a20 2020 2020 2020 2020  rval],.         
+0002d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d7c0: 2020 2020 2020 2020 2020 7472 756e 6361            trunca
+0002d7d0: 7465 3a20 626f 6f6c 203d 2054 7275 6529  te: bool = True)
+0002d7e0: 202d 3e20 4469 6374 5b70 642e 496e 7465   -> Dict[pd.Inte
+0002d7f0: 7276 616c 2c20 7064 2e44 6174 6146 7261  rval, pd.DataFra
+0002d800: 6d65 5d3a 0a20 2020 2022 2222 2046 6f72  me]:.    """ For
+0002d810: 2065 6163 6820 696e 7465 7276 616c 2c20   each interval, 
+0002d820: 6372 6561 7465 2061 2063 6875 6e6b 206f  create a chunk o
+0002d830: 6620 7468 6520 6769 7665 6e20 4461 7461  f the given Data
+0002d840: 4672 616d 6520 6261 7365 6420 6f6e 2069  Frame based on i
+0002d850: 7473 2049 6e74 6572 7661 6c49 6e64 6578  ts IntervalIndex
+0002d860: 2e0a 2020 2020 5468 6973 2069 7320 616e  ..    This is an
+0002d870: 206f 7074 696d 697a 6564 2061 6c67 6f72   optimized algor
+0002d880: 6974 686d 2063 6f6d 7061 7265 6420 746f  ithm compared to
+0002d890: 2063 616c 6c69 6e67 2049 6e74 6572 7661   calling Interva
+0002d8a0: 6c49 6e64 6578 2e6f 7665 726c 6170 7328  lIndex.overlaps(
+0002d8b0: 696e 7465 7276 616c 2920 666f 7220 6561  interval) for ea
+0002d8c0: 6368 0a20 2020 2067 6976 656e 2069 6e74  ch.    given int
+0002d8d0: 6572 7661 6c2c 2077 6974 6820 7468 6520  erval, with the 
+0002d8e0: 6164 6469 7469 6f6e 616c 2061 6476 616e  additional advan
+0002d8f0: 7461 6765 2074 6861 7420 6974 2077 696c  tage that it wil
+0002d900: 6c20 6e6f 7420 6469 7363 6172 6420 726f  l not discard ro
+0002d910: 7773 2077 6865 7265 2074 6865 0a20 2020  ws where the.   
+0002d920: 2069 6e74 6572 7661 6c20 6973 207a 6572   interval is zer
+0002d930: 6f2c 2073 7563 6820 6173 205b 3235 2e30  o, such as [25.0
+0002d940: 2c20 3235 2e30 292e 0a0a 2020 2020 5061  , 25.0)...    Pa
+0002d950: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+0002d960: 2d2d 2d2d 2d2d 2d0a 2020 2020 6466 203a  -------.    df :
+0002d970: 203a 6f62 6a3a 6070 616e 6461 732e 4461   :obj:`pandas.Da
+0002d980: 7461 4672 616d 6560 0a20 2020 2020 2020  taFrame`.       
+0002d990: 2054 6865 2044 6174 6146 7261 6d65 2069   The DataFrame i
+0002d9a0: 7320 6578 7065 6374 6564 2074 6f20 636f  s expected to co
+0002d9b0: 6d65 2077 6974 6820 616e 2049 6e74 6572  me with an Inter
+0002d9c0: 7661 6c49 6e64 6578 2061 6e64 2063 6f6e  valIndex and con
+0002d9d0: 7461 696e 2074 6865 2063 6f6c 756d 6e73  tain the columns
+0002d9e0: 2027 7175 6172 7465 7262 6561 7473 2720   'quarterbeats' 
+0002d9f0: 616e 6420 2764 7572 6174 696f 6e5f 7162  and 'duration_qb
+0002da00: 272e 0a20 2020 2020 2020 2054 686f 7365  '..        Those
+0002da10: 2063 616e 2062 6520 6f62 7461 696e 6564   can be obtained
+0002da20: 2074 6872 6f75 6768 2060 6050 6172 7365   through ``Parse
+0002da30: 2e67 6574 5f6c 6973 7473 2869 6e74 6572  .get_lists(inter
+0002da40: 7661 6c5f 696e 6465 783d 5472 7565 2960  val_index=True)`
+0002da50: 6020 6f72 0a20 2020 2020 2020 2060 6050  ` or.        ``P
+0002da60: 6172 7365 2e69 7465 725f 7472 616e 7366  arse.iter_transf
+0002da70: 6f72 6d65 6428 696e 7465 7276 616c 5f69  ormed(interval_i
+0002da80: 6e64 6578 3d54 7275 6529 6060 2e0a 2020  ndex=True)``..  
+0002da90: 2020 696e 7465 7276 616c 7320 3a20 3a6f    intervals : :o
+0002daa0: 626a 3a60 6c69 7374 6020 6f66 203a 6f62  bj:`list` of :ob
+0002dab0: 6a3a 6070 642e 496e 7465 7276 616c 600a  j:`pd.Interval`.
+0002dac0: 2020 2020 2020 2020 5468 6520 696e 7465          The inte
+0002dad0: 7276 616c 7320 6465 6669 6e69 6e67 2074  rvals defining t
+0002dae0: 6865 2063 6875 6e6b 7327 2064 696d 656e  he chunks' dimen
+0002daf0: 7369 6f6e 732e 2045 7870 6563 7465 6420  sions. Expected 
+0002db00: 746f 2062 6520 6e6f 6e2d 6f76 6572 6c61  to be non-overla
+0002db10: 7070 696e 6720 616e 6420 6d6f 6e6f 746f  pping and monoto
+0002db20: 6e69 6361 6c6c 7920 696e 6372 6561 7369  nically increasi
+0002db30: 6e67 2e0a 2020 2020 7472 756e 6361 7465  ng..    truncate
+0002db40: 203a 203a 6f62 6a3a 6062 6f6f 6c60 2c20   : :obj:`bool`, 
+0002db50: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0002db60: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
+0002db70: 652c 206d 6561 6e69 6e67 2074 6861 7420  e, meaning that 
+0002db80: 7468 6520 696e 7465 7276 616c 2069 6e64  the interval ind
+0002db90: 6578 2061 6e64 2074 6865 2027 6475 7261  ex and the 'dura
+0002dba0: 7469 6f6e 5f71 6227 2077 696c 6c20 6265  tion_qb' will be
+0002dbb0: 2061 6461 7074 6564 2066 6f72 206f 7665   adapted for ove
+0002dbc0: 726c 6170 7069 6e67 2069 6e74 6572 7661  rlapping interva
+0002dbd0: 6c73 2e0a 2020 2020 2020 2020 5061 7373  ls..        Pass
+0002dbe0: 2046 616c 7365 2074 6f20 6765 7420 6368   False to get ch
+0002dbf0: 756e 6b73 2077 6974 6820 616c 6c20 6f76  unks with all ov
+0002dc00: 6572 6c61 7070 696e 6720 696e 7465 7276  erlapping interv
+0002dc10: 616c 7320 6173 2074 6865 7920 6172 652e  als as they are.
+0002dc20: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
+0002dc30: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 3a6f    -------.    :o
+0002dc40: 626a 3a60 6469 6374 600a 2020 2020 2020  bj:`dict`.      
+0002dc50: 2020 7b69 6e74 6572 7661 6c20 2d3e 2063    {interval -> c
+0002dc60: 6875 6e6b 7d0a 2020 2020 2222 220a 2020  hunk}.    """.  
+0002dc70: 2020 6c65 6674 7320 3d20 6466 2e69 6e64    lefts = df.ind
+0002dc80: 6578 2e6c 6566 742e 7661 6c75 6573 2020  ex.left.values  
+0002dc90: 2020 2320 6c65 6674 7320 616e 6420 7269    # lefts and ri
+0002dca0: 6768 7473 2077 696c 6c20 6765 7420 7368  ghts will get sh
+0002dcb0: 6f72 7465 7220 2870 6f74 656e 7469 616c  orter (potential
+0002dcc0: 6c79 2920 7769 7468 2065 7665 7279 0a20  ly) with every. 
+0002dcd0: 2020 2072 6967 6874 7320 3d20 6466 2e69     rights = df.i
+0002dce0: 6e64 6578 2e72 6967 6874 2e76 616c 7565  ndex.right.value
+0002dcf0: 7320 2023 2069 6e74 6572 7661 6c2c 2069  s  # interval, i
+0002dd00: 6e20 6f72 6465 7220 746f 2072 6564 7563  n order to reduc
+0002dd10: 6520 7468 6520 7469 6d65 2066 6f72 2063  e the time for c
+0002dd20: 6f6d 7061 7269 6e67 2076 616c 7565 730a  omparing values.
+0002dd30: 2020 2020 6368 756e 6b73 203d 207b 7d0a      chunks = {}.
+0002dd40: 2020 2020 6375 7272 656e 745f 7374 6172      current_star
+0002dd50: 745f 6d61 736b 203d 206e 702e 6f6e 6573  t_mask = np.ones
+0002dd60: 286c 656e 2864 662e 696e 6465 7829 2c20  (len(df.index), 
+0002dd70: 6474 7970 6520 3d20 626f 6f6c 2920 2320  dtype = bool) # 
+0002dd80: 6c65 6e67 7468 2072 656d 6169 6e73 2074  length remains t
+0002dd90: 6865 2073 616d 650a 2020 2020 666f 7220  he same.    for 
+0002dda0: 6976 2069 6e20 696e 7465 7276 616c 733a  iv in intervals:
+0002ddb0: 0a20 2020 2020 2020 2023 2061 7373 756d  .        # assum
+0002ddc0: 6573 2069 6e74 6572 7661 6c73 2061 7265  es intervals are
+0002ddd0: 206e 6f6e 2d6f 7665 726c 6170 7069 6e67   non-overlapping
+0002dde0: 2061 6e64 206d 6f6e 6f74 6f6e 6963 616c   and monotonical
+0002ddf0: 6c79 2069 6e63 7265 6173 696e 670a 2020  ly increasing.  
+0002de00: 2020 2020 2020 6c2c 2072 203d 2069 762e        l, r = iv.
+0002de10: 6c65 6674 2c20 6976 2e72 6967 6874 0a20  left, iv.right. 
+0002de20: 2020 2020 2020 2023 206e 6576 6572 2061         # never a
+0002de30: 6761 696e 2063 6865 636b 2065 7665 6e74  gain check event
+0002de40: 7320 656e 6469 6e67 2062 6566 6f72 6520  s ending before 
+0002de50: 7468 6520 6375 7272 656e 7420 696e 7465  the current inte
+0002de60: 7276 616c 2773 2073 7461 7274 0a20 2020  rval's start.   
+0002de70: 2020 2020 206e 6f74 5f65 6e64 696e 675f       not_ending_
+0002de80: 6265 666f 7265 5f6c 203d 2028 7269 6768  before_l = (righ
+0002de90: 7473 203e 3d20 6c29 0a20 2020 2020 2020  ts >= l).       
+0002dea0: 206c 6566 7473 203d 206c 6566 7473 5b6e   lefts = lefts[n
+0002deb0: 6f74 5f65 6e64 696e 675f 6265 666f 7265  ot_ending_before
+0002dec0: 5f6c 5d0a 2020 2020 2020 2020 7269 6768  _l].        righ
+0002ded0: 7473 203d 2072 6967 6874 735b 6e6f 745f  ts = rights[not_
+0002dee0: 656e 6469 6e67 5f62 6566 6f72 655f 6c5d  ending_before_l]
+0002def0: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+0002df00: 5f73 7461 7274 5f6d 6173 6b5b 6375 7272  _start_mask[curr
+0002df10: 656e 745f 7374 6172 745f 6d61 736b 5d20  ent_start_mask] 
+0002df20: 3d20 6e6f 745f 656e 6469 6e67 5f62 6566  = not_ending_bef
+0002df30: 6f72 655f 6c0a 2020 2020 2020 2020 7374  ore_l.        st
+0002df40: 6172 7469 6e67 5f62 6566 6f72 655f 7220  arting_before_r 
+0002df50: 3d20 2872 203e 206c 6566 7473 290a 2020  = (r > lefts).  
+0002df60: 2020 2020 2020 6e6f 745f 656e 6469 6e67        not_ending
+0002df70: 5f6f 6e5f 6c5f 6578 6365 7074 5f65 6d70  _on_l_except_emp
+0002df80: 7479 203d 2028 7269 6768 7473 2021 3d20  ty = (rights != 
+0002df90: 6c29 207c 2028 6c65 6674 7320 3d3d 206c  l) | (lefts == l
+0002dfa0: 290a 2020 2020 2020 2020 6f76 6572 6c61  ).        overla
+0002dfb0: 7070 696e 6720 3d20 2873 7461 7274 696e  pping = (startin
+0002dfc0: 675f 6265 666f 7265 5f72 2026 206e 6f74  g_before_r & not
+0002dfd0: 5f65 6e64 696e 675f 6f6e 5f6c 5f65 7863  _ending_on_l_exc
+0002dfe0: 6570 745f 656d 7074 7929 0a20 2020 2020  ept_empty).     
+0002dff0: 2020 2062 6f6f 6c5f 6d61 736b 203d 2063     bool_mask = c
+0002e000: 7572 7265 6e74 5f73 7461 7274 5f6d 6173  urrent_start_mas
+0002e010: 6b2e 636f 7079 2829 0a20 2020 2020 2020  k.copy().       
+0002e020: 2062 6f6f 6c5f 6d61 736b 5b63 7572 7265   bool_mask[curre
+0002e030: 6e74 5f73 7461 7274 5f6d 6173 6b5d 203d  nt_start_mask] =
+0002e040: 206f 7665 726c 6170 7069 6e67 0a20 2020   overlapping.   
+0002e050: 2020 2020 2063 6875 6e6b 203d 2064 665b       chunk = df[
+0002e060: 626f 6f6c 5f6d 6173 6b5d 2e63 6f70 7928  bool_mask].copy(
+0002e070: 290a 2020 2020 2020 2020 6966 2074 7275  ).        if tru
+0002e080: 6e63 6174 653a 0a20 2020 2020 2020 2020  ncate:.         
+0002e090: 2020 206e 6577 5f6c 6566 7473 2c20 6e65     new_lefts, ne
+0002e0a0: 775f 7269 6768 7473 203d 206c 6566 7473  w_rights = lefts
+0002e0b0: 5b6f 7665 726c 6170 7069 6e67 5d2c 2072  [overlapping], r
+0002e0c0: 6967 6874 735b 6f76 6572 6c61 7070 696e  ights[overlappin
+0002e0d0: 675d 0a20 2020 2020 2020 2020 2020 2073  g].            s
+0002e0e0: 7461 7274 696e 675f 6265 666f 7265 5f6c  tarting_before_l
+0002e0f0: 2c20 656e 6469 6e67 5f61 6674 6572 5f72  , ending_after_r
+0002e100: 203d 2028 6e65 775f 6c65 6674 7320 3c20   = (new_lefts < 
+0002e110: 6c29 2c20 286e 6577 5f72 6967 6874 7320  l), (new_rights 
+0002e120: 3e20 7229 0a20 2020 2020 2020 2020 2020  > r).           
+0002e130: 2069 6620 7374 6172 7469 6e67 5f62 6566   if starting_bef
+0002e140: 6f72 655f 6c2e 7375 6d28 2920 3e20 3020  ore_l.sum() > 0 
+0002e150: 6f72 2065 6e64 696e 675f 6166 7465 725f  or ending_after_
+0002e160: 722e 7375 6d28 2920 3e20 303a 0a20 2020  r.sum() > 0:.   
+0002e170: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0002e180: 5f6c 6566 7473 5b73 7461 7274 696e 675f  _lefts[starting_
+0002e190: 6265 666f 7265 5f6c 5d20 3d20 6c0a 2020  before_l] = l.  
+0002e1a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0002e1b0: 775f 7269 6768 7473 5b65 6e64 696e 675f  w_rights[ending_
+0002e1c0: 6166 7465 725f 725d 203d 2072 0a20 2020  after_r] = r.   
+0002e1d0: 2020 2020 2020 2020 2020 2020 2063 6875               chu
+0002e1e0: 6e6b 2e69 6e64 6578 203d 2070 642e 496e  nk.index = pd.In
+0002e1f0: 7465 7276 616c 496e 6465 782e 6672 6f6d  tervalIndex.from
+0002e200: 5f61 7272 6179 7328 6e65 775f 6c65 6674  _arrays(new_left
+0002e210: 732c 206e 6577 5f72 6967 6874 732c 2063  s, new_rights, c
+0002e220: 6c6f 7365 643d 276c 6566 7427 290a 2020  losed='left').  
+0002e230: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+0002e240: 756e 6b2e 6475 7261 7469 6f6e 5f71 6220  unk.duration_qb 
+0002e250: 3d20 286e 6577 5f72 6967 6874 7320 2d20  = (new_rights - 
+0002e260: 6e65 775f 6c65 6674 7329 0a20 2020 2020  new_lefts).     
+0002e270: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+0002e280: 2e71 7561 7274 6572 6265 6174 7320 3d20  .quarterbeats = 
+0002e290: 6e65 775f 6c65 6674 730a 2020 2020 2020  new_lefts.      
+0002e2a0: 2020 2020 2020 2020 2020 6368 756e 6b2e            chunk.
+0002e2b0: 736f 7274 5f76 616c 7565 7328 5b27 7175  sort_values(['qu
+0002e2c0: 6172 7465 7262 6561 7473 272c 2027 6475  arterbeats', 'du
+0002e2d0: 7261 7469 6f6e 5f71 6227 5d2c 2069 6e70  ration_qb'], inp
+0002e2e0: 6c61 6365 3d54 7275 6529 0a20 2020 2020  lace=True).     
+0002e2f0: 2020 2063 6875 6e6b 735b 6976 5d20 3d20     chunks[iv] = 
+0002e300: 6368 756e 6b0a 2020 2020 7265 7475 726e  chunk.    return
+0002e310: 2063 6875 6e6b 730a 0a0a 6465 6620 696e   chunks...def in
+0002e320: 6665 725f 7473 765f 7479 7065 2864 663a  fer_tsv_type(df:
+0002e330: 2070 642e 4461 7461 4672 616d 6529 202d   pd.DataFrame) -
+0002e340: 3e20 4f70 7469 6f6e 616c 5b73 7472 5d3a  > Optional[str]:
+0002e350: 0a20 2020 2022 2222 496e 6665 7273 2074  .    """Infers t
+0002e360: 6865 2063 6f6e 7465 6e74 7320 6f66 2061  he contents of a
+0002e370: 2044 6174 6146 7261 6d65 2066 726f 6d20   DataFrame from 
+0002e380: 7468 6520 7072 6573 656e 6365 206f 6620  the presence of 
+0002e390: 7061 7274 6963 756c 6172 2063 6f6c 756d  particular colum
+0002e3a0: 6e73 2e22 2222 0a20 2020 2074 7970 6532  ns.""".    type2
+0002e3b0: 636f 6c73 203d 207b 0a20 2020 2020 2020  cols = {.       
+0002e3c0: 2027 6e6f 7465 7327 3a20 5b27 7470 6327   'notes': ['tpc'
+0002e3d0: 2c20 276d 6964 6927 5d2c 0a20 2020 2020  , 'midi'],.     
+0002e3e0: 2020 2027 6576 656e 7473 273a 205b 2743     'events': ['C
+0002e3f0: 686f 7264 2f64 7572 6174 696f 6e54 7970  hord/durationTyp
+0002e400: 6527 2c20 2752 6573 742f 6475 7261 7469  e', 'Rest/durati
+0002e410: 6f6e 5479 7065 275d 2c0a 2020 2020 2020  onType'],.      
+0002e420: 2020 2763 686f 7264 7327 3a20 5b27 6368    'chords': ['ch
+0002e430: 6f72 645f 6964 275d 2c0a 2020 2020 2020  ord_id'],.      
+0002e440: 2020 2772 6573 7473 273a 205b 276e 6f6d    'rests': ['nom
+0002e450: 696e 616c 5f64 7572 6174 696f 6e27 5d2c  inal_duration'],
+0002e460: 0a20 2020 2020 2020 2027 6578 7061 6e64  .        'expand
+0002e470: 6564 273a 205b 276e 756d 6572 616c 275d  ed': ['numeral']
+0002e480: 2c0a 2020 2020 2020 2020 276c 6162 656c  ,.        'label
+0002e490: 7327 3a20 5b27 6861 726d 6f6e 795f 6c61  s': ['harmony_la
+0002e4a0: 7965 7227 2c20 276c 6162 656c 272c 2027  yer', 'label', '
+0002e4b0: 6c61 6265 6c5f 7479 7065 275d 2c0a 2020  label_type'],.  
+0002e4c0: 2020 2020 2020 276d 6561 7375 7265 7327        'measures'
+0002e4d0: 3a20 5b27 6163 745f 6475 7227 5d2c 0a20  : ['act_dur'],. 
+0002e4e0: 2020 2020 2020 2027 6361 6465 6e63 6573         'cadences
+0002e4f0: 273a 205b 2763 6164 656e 6365 275d 2c0a  ': ['cadence'],.
+0002e500: 2020 2020 2020 2020 276d 6574 6164 6174          'metadat
+0002e510: 6127 3a20 5b27 666e 616d 6527 5d2c 0a20  a': ['fname'],. 
+0002e520: 2020 2020 2020 2027 666f 726d 5f6c 6162         'form_lab
+0002e530: 656c 7327 3a20 5b27 666f 726d 5f6c 6162  els': ['form_lab
+0002e540: 656c 272c 2027 6127 5d2c 0a20 2020 207d  el', 'a'],.    }
+0002e550: 0a20 2020 2066 6f72 2074 2c20 636f 6c75  .    for t, colu
+0002e560: 6d6e 7320 696e 2074 7970 6532 636f 6c73  mns in type2cols
+0002e570: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+0002e580: 2020 6966 2061 6e79 2863 2069 6e20 6466    if any(c in df
+0002e590: 2e63 6f6c 756d 6e73 2066 6f72 2063 2069  .columns for c i
+0002e5a0: 6e20 636f 6c75 6d6e 7329 3a0a 2020 2020  n columns):.    
+0002e5b0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+0002e5c0: 0a20 2020 2069 6620 616e 7928 6320 696e  .    if any(c in
+0002e5d0: 2064 662e 636f 6c75 6d6e 7320 666f 7220   df.columns for 
+0002e5e0: 6320 696e 205b 276d 6327 2c20 276d 6e27  c in ['mc', 'mn'
+0002e5f0: 5d29 3a0a 2020 2020 2020 2020 7265 7475  ]):.        retu
+0002e600: 726e 2027 6c61 6265 6c73 270a 2020 2020  rn 'labels'.    
+0002e610: 7265 7475 726e 2027 756e 6b6e 6f77 6e27  return 'unknown'
+0002e620: 0a0a 0a64 6566 2072 6564 7563 655f 6461  ...def reduce_da
+0002e630: 7461 6672 616d 655f 6475 7261 7469 6f6e  taframe_duration
+0002e640: 5f74 6f5f 6669 7273 745f 726f 7728 6466  _to_first_row(df
+0002e650: 3a20 7064 2e44 6174 6146 7261 6d65 2920  : pd.DataFrame) 
+0002e660: 2d3e 2070 642e 4461 7461 4672 616d 653a  -> pd.DataFrame:
+0002e670: 0a20 2020 2022 2222 2052 6564 7563 6573  .    """ Reduces
+0002e680: 2061 2044 6174 6146 7261 6d65 2074 6f20   a DataFrame to 
+0002e690: 6974 7320 726f 7720 616e 6420 7570 6461  its row and upda
+0002e6a0: 7465 7320 7468 6520 6475 7261 7469 6f6e  tes the duration
+0002e6b0: 5f71 6220 636f 6c75 6d6e 2074 6f20 7265  _qb column to re
+0002e6c0: 666c 6563 7420 7468 6520 7265 6475 6365  flect the reduce
+0002e6d0: 6420 6475 7261 7469 6f6e 2e0a 0a20 2020  d duration...   
+0002e6e0: 2041 7267 733a 0a20 2020 2020 2064 663a   Args:.      df:
+0002e6f0: 2044 6174 6166 7261 6d65 206f 6620 7768   Dataframe of wh
+0002e700: 6963 6820 746f 206b 6565 7020 6f6e 6c79  ich to keep only
+0002e710: 2074 6865 2066 6972 7374 2072 6f77 2e20   the first row. 
+0002e720: 4966 2069 7420 6861 7320 616e 2049 6e74  If it has an Int
+0002e730: 6572 7661 6c49 6e64 6578 2c20 7468 6520  ervalIndex, the 
+0002e740: 696e 7465 7276 616c 2069 7320 7570 6461  interval is upda
+0002e750: 7465 6420 746f 0a20 2020 2020 2020 2020  ted to.         
+0002e760: 2072 6566 6c65 6374 2074 6865 2077 686f   reflect the who
+0002e770: 6c65 2064 7572 6174 696f 6e2e 0a0a 2020  le duration...  
+0002e780: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+0002e790: 2044 6174 6146 7261 6d65 2077 6974 6820   DataFrame with 
+0002e7a0: 6f6e 6520 726f 772e 0a20 2020 2022 2222  one row..    """
+0002e7b0: 0a20 2020 2069 6620 6c65 6e28 6466 2920  .    if len(df) 
+0002e7c0: 3d3d 2031 3a0a 2020 2020 2020 2020 7265  == 1:.        re
+0002e7d0: 7475 726e 2064 660a 2020 2020 6964 7820  turn df.    idx 
+0002e7e0: 3d20 6466 2e69 6e64 6578 0a20 2020 2066  = df.index.    f
+0002e7f0: 6972 7374 5f6c 6f63 203d 2069 6478 5b30  irst_loc = idx[0
+0002e800: 5d0a 2020 2020 726f 7720 3d20 6466 2e69  ].    row = df.i
+0002e810: 6c6f 635b 5b30 5d5d 0a20 2020 2023 2069  loc[[0]].    # i
+0002e820: 6620 6973 696e 7374 616e 6365 2869 782c  f isinstance(ix,
+0002e830: 2070 642e 496e 7465 7276 616c 2920 6f72   pd.Interval) or
+0002e840: 2028 6973 696e 7374 616e 6365 2869 782c   (isinstance(ix,
+0002e850: 2074 7570 6c65 2920 616e 6420 6973 696e   tuple) and isin
+0002e860: 7374 616e 6365 2869 785b 2d31 5d2c 2070  stance(ix[-1], p
+0002e870: 642e 496e 7465 7276 616c 2929 3a0a 2020  d.Interval)):.  
+0002e880: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0002e890: 6964 782c 2070 642e 496e 7465 7276 616c  idx, pd.Interval
+0002e8a0: 496e 6465 7829 3a0a 2020 2020 2020 2020  Index):.        
+0002e8b0: 7374 6172 7420 3d20 6d69 6e28 6964 782e  start = min(idx.
+0002e8c0: 6c65 6674 290a 2020 2020 2020 2020 656e  left).        en
+0002e8d0: 6420 3d20 6d61 7828 6964 782e 7269 6768  d = max(idx.righ
+0002e8e0: 7429 0a20 2020 2020 2020 2069 7620 3d20  t).        iv = 
+0002e8f0: 7064 2e49 6e74 6572 7661 6c28 7374 6172  pd.Interval(star
+0002e900: 742c 2065 6e64 2c20 636c 6f73 6564 3d69  t, end, closed=i
+0002e910: 6478 2e63 6c6f 7365 6429 0a20 2020 2020  dx.closed).     
+0002e920: 2020 2072 6f77 2e69 6e64 6578 203d 2070     row.index = p
+0002e930: 642e 496e 7465 7276 616c 496e 6465 7828  d.IntervalIndex(
+0002e940: 5b69 765d 290a 2020 2020 2020 2020 726f  [iv]).        ro
+0002e950: 772e 6c6f 635b 6976 2c20 2764 7572 6174  w.loc[iv, 'durat
+0002e960: 696f 6e5f 7162 275d 203d 2069 762e 6c65  ion_qb'] = iv.le
+0002e970: 6e67 7468 0a20 2020 2065 6c73 653a 0a20  ngth.    else:. 
+0002e980: 2020 2020 2020 206e 6577 5f64 7572 6174         new_durat
+0002e990: 696f 6e20 3d20 6466 2e64 7572 6174 696f  ion = df.duratio
+0002e9a0: 6e5f 7162 2e73 756d 2829 0a20 2020 2020  n_qb.sum().     
+0002e9b0: 2020 2072 6f77 2e6c 6f63 5b66 6972 7374     row.loc[first
+0002e9c0: 5f6c 6f63 2c20 2764 7572 6174 696f 6e5f  _loc, 'duration_
+0002e9d0: 7162 275d 203d 206e 6577 5f64 7572 6174  qb'] = new_durat
+0002e9e0: 696f 6e0a 2020 2020 7265 7475 726e 2072  ion.    return r
+0002e9f0: 6f77 0a0a 0a40 6461 7461 636c 6173 730a  ow...@dataclass.
+0002ea00: 636c 6173 7320 4669 6c65 3a0a 2020 2020  class File:.    
+0002ea10: 2222 2253 746f 7269 6e67 2070 6174 6820  """Storing path 
+0002ea20: 616e 6420 6669 6c65 206e 616d 6520 696e  and file name in
+0002ea30: 666f 726d 6174 696f 6e20 666f 7220 6f6e  formation for on
+0002ea40: 6520 6669 6c65 2e22 2222 0a20 2020 2069  e file.""".    i
+0002ea50: 783a 2069 6e74 0a20 2020 2022 2222 496e  x: int.    """In
+0002ea60: 6465 7820 696e 7465 6765 7220 2849 4429  dex integer (ID)
+0002ea70: 2222 220a 2020 2020 7479 7065 3a20 7374  """.    type: st
+0002ea80: 720a 2020 2020 2222 2252 6563 6f67 6e69  r.    """Recogni
+0002ea90: 7a65 6420 7479 7065 20e2 8888 203a 6174  zed type ... :at
+0002eaa0: 7472 3a60 6d73 332e 5f74 7970 696e 672e  tr:`ms3._typing.
+0002eab0: 4661 6365 7460 2222 220a 2020 2020 6669  Facet`""".    fi
+0002eac0: 6c65 3a20 7374 720a 2020 2020 2222 2246  le: str.    """F
+0002ead0: 696c 6520 6e61 6d65 2069 6e63 6c75 6469  ile name includi
+0002eae0: 6e67 2065 7874 656e 7369 6f6e 2e22 2222  ng extension."""
+0002eaf0: 0a20 2020 2066 6e61 6d65 3a20 7374 720a  .    fname: str.
+0002eb00: 2020 2020 2222 2266 6e61 6d65 2065 7863      """fname exc
+0002eb10: 6c75 6469 6e67 2074 6865 2073 7566 6669  luding the suffi
+0002eb20: 7820 2861 6674 6572 2072 6567 6973 7465  x (after registe
+0002eb30: 7269 6e67 2074 6865 2066 696c 6520 7769  ring the file wi
+0002eb40: 7468 2061 203a 6f62 6a3a 6050 6965 6365  th a :obj:`Piece
+0002eb50: 6029 2e22 2222 0a20 2020 2066 6578 743a  `).""".    fext:
+0002eb60: 2073 7472 0a20 2020 2022 2222 4669 6c65   str.    """File
+0002eb70: 2065 7874 656e 7369 6f6e 732e 2222 220a   extensions.""".
+0002eb80: 2020 2020 7375 6264 6972 3a20 7374 720a      subdir: str.
+0002eb90: 2020 2020 2222 2244 6972 6563 746f 7279      """Directory
+0002eba0: 2072 656c 6174 6976 6520 746f 2074 6865   relative to the
+0002ebb0: 2063 6f72 7075 7320 7061 7468 2028 652e   corpus path (e.
+0002ebc0: 672e 2027 2e2f 4d53 3327 292e 2222 220a  g. './MS3').""".
+0002ebd0: 2020 2020 636f 7270 7573 5f70 6174 683a      corpus_path:
+0002ebe0: 2073 7472 0a20 2020 2022 2222 4162 736f   str.    """Abso
+0002ebf0: 6c75 7465 2070 6174 6820 6f66 2074 6865  lute path of the
+0002ec00: 2066 696c 6527 7320 7061 7265 6e74 2064   file's parent d
+0002ec10: 6972 6563 746f 7279 2074 6861 7420 6973  irectory that is
+0002ec20: 2063 6f6e 7369 6465 7265 6420 6173 2063   considered as c
+0002ec30: 6f72 7075 7320 6469 7265 6374 6f72 792e  orpus directory.
+0002ec40: 2222 220a 2020 2020 7265 6c5f 7061 7468  """.    rel_path
+0002ec50: 3a20 7374 720a 2020 2020 2222 2246 696c  : str.    """Fil
+0002ec60: 6520 7061 7468 2072 656c 6174 6976 6520  e path relative 
+0002ec70: 746f 2074 6865 2063 6f72 7075 7320 7061  to the corpus pa
+0002ec80: 7468 2e20 4571 7569 7661 6c65 6e74 2074  th. Equivalent t
+0002ec90: 6f20 3c73 7562 6469 723e 2f3c 6669 6c65  o <subdir>/<file
+0002eca0: 3e2e 2222 220a 2020 2020 6675 6c6c 5f70  >.""".    full_p
+0002ecb0: 6174 683a 2073 7472 0a20 2020 2022 2222  ath: str.    """
+0002ecc0: 4162 736f 6c75 7465 2066 696c 6520 7061  Absolute file pa
+0002ecd0: 7468 2e22 2222 0a20 2020 2064 6972 6563  th.""".    direc
+0002ece0: 746f 7279 3a20 7374 720a 2020 2020 2222  tory: str.    ""
+0002ecf0: 2241 6273 6f6c 7574 6520 666f 6c64 6572  "Absolute folder
+0002ed00: 2070 6174 6820 7768 6572 6520 7468 6520   path where the 
+0002ed10: 6669 6c65 2069 7320 6c6f 6361 7465 642e  file is located.
+0002ed20: 2222 220a 2020 2020 7375 6666 6978 3a20  """.    suffix: 
+0002ed30: 7374 7220 3d20 2727 0a20 2020 2022 2222  str = ''.    """
+0002ed40: 5570 6f6e 2072 6567 6973 7465 7269 6e67  Upon registering
+0002ed50: 2074 6865 2046 696c 6520 7769 7468 2061   the File with a
+0002ed60: 203a 6f62 6a3a 6050 6965 6365 602c 2069   :obj:`Piece`, i
+0002ed70: 6620 7468 6520 6375 7272 656e 7420 666e  f the current fn
+0002ed80: 616d 6520 6861 7320 6120 7375 6666 6978  ame has a suffix
+0002ed90: 2063 6f6d 7061 7265 6420 746f 2074 6865   compared to the
+0002eda0: 2050 6965 6365 2773 2066 6e61 6d65 2c20   Piece's fname, 
+0002edb0: 0a20 2020 2073 7566 6669 7820 6973 2072  .    suffix is r
+0002edc0: 656d 6f76 6564 2066 726f 6d20 7468 6520  emoved from the 
+0002edd0: 4669 6c65 206f 626a 6563 7427 7320 666e  File object's fn
+0002ede0: 616d 6520 6669 656c 6420 616e 6420 6164  ame field and ad
+0002edf0: 6465 6420 746f 2074 6865 2073 7566 6669  ded to the suffi
+0002ee00: 7820 6669 656c 642e 2222 220a 2020 2020  x field.""".    
+0002ee10: 636f 6d6d 6974 5f73 6861 3a20 7374 7220  commit_sha: str 
+0002ee20: 3d20 2727 0a20 2020 2022 2222 5468 6520  = ''.    """The 
+0002ee30: 7468 6520 6669 6c65 2068 6173 2062 6565  the file has bee
+0002ee40: 6e20 7265 7472 6965 7665 6420 6672 6f6d  n retrieved from
+0002ee50: 2061 2070 6172 7469 6375 6c61 7220 6769   a particular gi
+0002ee60: 7420 7265 7669 7369 6f6e 2c20 7468 6973  t revision, this
+0002ee70: 2069 7320 7365 7420 746f 2074 6865 2072   is set to the r
+0002ee80: 6576 6973 696f 6e27 7320 6861 7368 2e22  evision's hash."
+0002ee90: 2222 0a0a 2020 2020 6465 6620 5f5f 7265  ""..    def __re
+0002eea0: 7072 5f5f 2873 656c 6629 3a0a 2020 2020  pr__(self):.    
+0002eeb0: 2020 2020 7375 6666 6978 203d 2027 2720      suffix = '' 
+0002eec0: 6966 2073 656c 662e 7375 6666 6978 203d  if self.suffix =
+0002eed0: 3d20 2727 2065 6c73 6520 6622 2c20 7375  = '' else f", su
+0002eee0: 6666 6978 3a20 7b73 656c 662e 7375 6666  ffix: {self.suff
+0002eef0: 6978 7d2e 220a 2020 2020 2020 2020 636f  ix}.".        co
+0002ef00: 6d6d 6974 203d 2027 2720 6966 2073 656c  mmit = '' if sel
+0002ef10: 662e 636f 6d6d 6974 5f73 6861 203d 3d20  f.commit_sha == 
+0002ef20: 2727 2065 6c73 6520 6622 407b 7365 6c66  '' else f"@{self
+0002ef30: 2e63 6f6d 6d69 745f 7368 615b 3a37 5d7d  .commit_sha[:7]}
+0002ef40: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+0002ef50: 2066 227b 7365 6c66 2e69 787d 3a20 277b   f"{self.ix}: '{
+0002ef60: 7365 6c66 2e72 656c 5f70 6174 687d 277b  self.rel_path}'{
+0002ef70: 636f 6d6d 6974 7d7b 7375 6666 6978 7d22  commit}{suffix}"
+0002ef80: 0a0a 2020 2020 6465 6620 7265 706c 6163  ..    def replac
+0002ef90: 655f 6578 7465 6e73 696f 6e28 7365 6c66  e_extension(self
+0002efa0: 2c20 6e65 775f 6578 7465 6e73 696f 6e3a  , new_extension:
+0002efb0: 2073 7472 2c20 2a2a 6b77 6172 6773 2920   str, **kwargs) 
+0002efc0: 2d3e 2053 656c 663a 0a20 2020 2020 2020  -> Self:.       
+0002efd0: 2069 6620 6e65 775f 6578 7465 6e73 696f   if new_extensio
+0002efe0: 6e5b 305d 2021 3d20 272e 273a 0a20 2020  n[0] != '.':.   
+0002eff0: 2020 2020 2020 2020 206e 6577 5f65 7874           new_ext
+0002f000: 656e 7369 6f6e 203d 2027 2e27 202b 206e  ension = '.' + n
+0002f010: 6577 5f65 7874 656e 7369 6f6e 0a20 2020  ew_extension.   
+0002f020: 2020 2020 206f 6c64 5f65 7874 5f6c 656e       old_ext_len
+0002f030: 203d 206c 656e 2873 656c 662e 6665 7874   = len(self.fext
+0002f040: 290a 2020 2020 2020 2020 6e65 775f 7661  ).        new_va
+0002f050: 6c73 203d 207b 7d0a 2020 2020 2020 2020  ls = {}.        
+0002f060: 666f 7220 6669 656c 6420 696e 2028 2266  for field in ("f
+0002f070: 696c 6522 2c20 2266 6578 7422 2c20 2272  ile", "fext", "r
+0002f080: 656c 5f70 6174 6822 2c20 2266 756c 6c5f  el_path", "full_
+0002f090: 7061 7468 2229 3a0a 2020 2020 2020 2020  path"):.        
+0002f0a0: 2020 2020 6f6c 645f 7661 6c20 3d20 6765      old_val = ge
+0002f0b0: 7461 7474 7228 7365 6c66 2c20 6669 656c  tattr(self, fiel
+0002f0c0: 6429 0a20 2020 2020 2020 2020 2020 206e  d).            n
+0002f0d0: 6577 5f76 616c 735b 6669 656c 645d 203d  ew_vals[field] =
+0002f0e0: 206f 6c64 5f76 616c 5b3a 2d6f 6c64 5f65   old_val[:-old_e
+0002f0f0: 7874 5f6c 656e 5d20 2b20 6e65 775f 6578  xt_len] + new_ex
+0002f100: 7465 6e73 696f 6e0a 2020 2020 2020 2020  tension.        
+0002f110: 7265 7475 726e 2072 6570 6c61 6365 2873  return replace(s
+0002f120: 656c 662c 202a 2a6e 6577 5f76 616c 732c  elf, **new_vals,
+0002f130: 202a 2a6b 7761 7267 7329 0a0a 0a20 2020   **kwargs)...   
+0002f140: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+0002f150: 2020 6465 6620 6672 6f6d 5f63 6f72 7075    def from_corpu
+0002f160: 735f 7061 7468 2863 6c73 2c0a 2020 2020  s_path(cls,.    
+0002f170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f180: 2020 2020 2063 6f72 7075 735f 7061 7468       corpus_path
+0002f190: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
+0002f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f1b0: 6669 6c65 6e61 6d65 3a20 7374 722c 0a20  filename: str,. 
+0002f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f1d0: 2020 2020 2020 2020 6674 7970 653a 204f          ftype: O
+0002f1e0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+0002f1f0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0002f200: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0002f210: 6264 6972 3d27 2e27 2c0a 2020 2020 2020  bdir='.',.      
+0002f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f230: 2020 2069 783a 2069 6e74 203d 202d 3129     ix: int = -1)
+0002f240: 3a0a 2020 2020 2020 2020 2222 2220 4372  :.        """ Cr
+0002f250: 6561 7465 7320 4669 6c65 206f 626a 6563  eates File objec
+0002f260: 7420 6672 6f6d 2069 6e64 6976 6964 7561  t from individua
+0002f270: 6c20 636f 6d70 6f6e 656e 7473 0a0a 2020  l components..  
+0002f280: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+0002f290: 2020 2020 2020 2020 636f 7270 7573 5f70          corpus_p
+0002f2a0: 6174 683a 2052 6f6f 7420 6469 7265 6374  ath: Root direct
+0002f2b0: 6f72 7920 6f66 2074 6865 2066 696c 6527  ory of the file'
+0002f2c0: 7320 636f 7270 7573 2e0a 2020 2020 2020  s corpus..      
+0002f2d0: 2020 2020 2020 6669 6c65 6e61 6d65 3a20        filename: 
+0002f2e0: 4675 6c6c 2066 696c 6520 6e61 6d65 2069  Full file name i
+0002f2f0: 6e63 6c75 6469 6e67 2073 7566 6669 7865  ncluding suffixe
+0002f300: 7320 616e 6420 6578 7465 6e73 696f 6e73  s and extensions
+0002f310: 2e0a 2020 2020 2020 2020 2020 2020 6674  ..            ft
+0002f320: 7970 653a 2046 696c 6520 7479 7065 2028  ype: File type (
+0002f330: 7573 6564 2061 7320 6465 6661 756c 7420  used as default 
+0002f340: 666f 6c64 6572 206e 616d 6520 666f 7220  folder name for 
+0002f350: 6372 6561 7469 6e67 2066 696c 655f 7061  creating file_pa
+0002f360: 7468 7329 2e0a 2020 2020 2020 2020 2020  ths)..          
+0002f370: 2020 7375 6264 6972 3a20 7265 6c61 7469    subdir: relati
+0002f380: 7665 2064 6972 6563 746f 7279 2061 7070  ve directory app
+0002f390: 656e 6465 6420 746f 2063 6f72 7075 735f  ended to corpus_
+0002f3a0: 7061 7468 2c20 6465 6661 756c 7473 2074  path, defaults t
+0002f3b0: 6f20 272e 272c 2069 2e65 2e20 6e6f 2073  o '.', i.e. no s
+0002f3c0: 7562 666f 6c64 6572 2e0a 2020 2020 2020  ubfolder..      
+0002f3d0: 2020 2020 2020 6978 3a20 4172 6269 7472        ix: Arbitr
+0002f3e0: 6172 7920 696e 6465 7820 6e75 6d62 6572  ary index number
+0002f3f0: 2c20 6465 6661 756c 7473 2074 6f20 2d31  , defaults to -1
+0002f400: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0002f410: 2020 2020 2020 6675 6c6c 5f70 6174 6820        full_path 
+0002f420: 3d20 6f73 2e70 6174 682e 7265 616c 7061  = os.path.realpa
+0002f430: 7468 286f 732e 7061 7468 2e6a 6f69 6e28  th(os.path.join(
+0002f440: 636f 7270 7573 5f70 6174 682c 2073 7562  corpus_path, sub
+0002f450: 6469 722c 2066 696c 656e 616d 6529 290a  dir, filename)).
+0002f460: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+0002f470: 652c 2066 696c 655f 6578 7420 3d20 6f73  e, file_ext = os
+0002f480: 2e70 6174 682e 7370 6c69 7465 7874 2866  .path.splitext(f
+0002f490: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
+0002f4a0: 2072 656c 5f70 6174 6820 3d20 6f73 2e70   rel_path = os.p
+0002f4b0: 6174 682e 6a6f 696e 2873 7562 6469 722c  ath.join(subdir,
+0002f4c0: 2066 696c 656e 616d 6529 0a20 2020 2020   filename).     
+0002f4d0: 2020 2069 6620 6674 7970 6520 6973 204e     if ftype is N
+0002f4e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002f4f0: 2066 696c 655f 7479 7065 203d 2070 6174   file_type = pat
+0002f500: 6832 7479 7065 2866 756c 6c5f 7061 7468  h2type(full_path
+0002f510: 2c20 6c6f 6767 6572 3d73 656c 662e 6c6f  , logger=self.lo
+0002f520: 6767 6572 290a 2020 2020 2020 2020 656c  gger).        el
+0002f530: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002f540: 6669 6c65 5f74 7970 6520 3d20 6674 7970  file_type = ftyp
+0002f550: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+0002f560: 2063 6c73 280a 2020 2020 2020 2020 2020   cls(.          
+0002f570: 2020 6978 3d69 782c 0a20 2020 2020 2020    ix=ix,.       
+0002f580: 2020 2020 2074 7970 653d 6669 6c65 5f74       type=file_t
+0002f590: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+0002f5a0: 2066 696c 653d 6669 6c65 6e61 6d65 2c0a   file=filename,.
+0002f5b0: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
+0002f5c0: 653d 6669 6c65 5f6e 616d 652c 0a20 2020  e=file_name,.   
+0002f5d0: 2020 2020 2020 2020 2066 6578 743d 6669           fext=fi
+0002f5e0: 6c65 5f65 7874 2c0a 2020 2020 2020 2020  le_ext,.        
+0002f5f0: 2020 2020 7375 6264 6972 3d73 7562 6469      subdir=subdi
+0002f600: 722c 0a20 2020 2020 2020 2020 2020 2063  r,.            c
+0002f610: 6f72 7075 735f 7061 7468 3d63 6f72 7075  orpus_path=corpu
+0002f620: 735f 7061 7468 2c0a 2020 2020 2020 2020  s_path,.        
+0002f630: 2020 2020 7265 6c5f 7061 7468 3d72 656c      rel_path=rel
+0002f640: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
+0002f650: 2020 2066 756c 6c5f 7061 7468 3d66 756c     full_path=ful
+0002f660: 6c5f 7061 7468 2c0a 2020 2020 2020 2020  l_path,.        
+0002f670: 2020 2020 6469 7265 6374 6f72 793d 6f73      directory=os
+0002f680: 2e70 6174 682e 6469 726e 616d 6528 6675  .path.dirname(fu
+0002f690: 6c6c 5f70 6174 6829 2c0a 2020 2020 2020  ll_path),.      
+0002f6a0: 2020 2020 2020 7375 6666 6978 3d27 272c        suffix='',
+0002f6b0: 0a20 2020 2020 2020 2029 0a0a 4066 756e  .        )..@fun
+0002f6c0: 6374 696f 6e5f 6c6f 6767 6572 0a64 6566  ction_logger.def
+0002f6d0: 2061 7574 6f6d 6174 6963 616c 6c79 5f63   automatically_c
+0002f6e0: 686f 6f73 655f 6672 6f6d 5f64 6973 616d  hoose_from_disam
+0002f6f0: 6269 6775 6174 6564 5f66 696c 6573 2864  biguated_files(d
+0002f700: 6973 616d 6269 6775 6174 6564 5f63 686f  isambiguated_cho
+0002f710: 6963 6573 3a20 4469 6374 5b73 7472 2c20  ices: Dict[str, 
+0002f720: 4669 6c65 5d2c 0a20 2020 2020 2020 2020  File],.         
+0002f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f750: 2020 2020 2020 2020 2066 6e61 6d65 3a20           fname: 
+0002f760: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
+0002f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f790: 2020 2020 2020 2066 696c 655f 7479 7065         file_type
+0002f7a0: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
+0002f7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f7d0: 2020 2020 2020 2020 2029 202d 3e20 4669           ) -> Fi
+0002f7e0: 6c65 3a0a 2020 2020 6966 206c 656e 2864  le:.    if len(d
+0002f7f0: 6973 616d 6269 6775 6174 6564 5f63 686f  isambiguated_cho
+0002f800: 6963 6573 2920 3d3d 2031 3a0a 2020 2020  ices) == 1:.    
+0002f810: 2020 2020 7265 7475 726e 206c 6973 7428      return list(
+0002f820: 6469 7361 6d62 6967 7561 7465 645f 6368  disambiguated_ch
+0002f830: 6f69 6365 732e 6b65 7973 2829 295b 305d  oices.keys())[0]
+0002f840: 0a20 2020 2064 6973 616d 625f 7365 7269  .    disamb_seri
+0002f850: 6573 203d 2070 642e 5365 7269 6573 2864  es = pd.Series(d
+0002f860: 6973 616d 6269 6775 6174 6564 5f63 686f  isambiguated_cho
+0002f870: 6963 6573 290a 2020 2020 6669 6c65 7320  ices).    files 
+0002f880: 3d20 6c69 7374 2864 6973 616d 6269 6775  = list(disambigu
+0002f890: 6174 6564 5f63 686f 6963 6573 2e76 616c  ated_choices.val
+0002f8a0: 7565 7328 2929 0a20 2020 2066 696c 6573  ues()).    files
+0002f8b0: 5f64 6620 3d20 7064 2e44 6174 6146 7261  _df = pd.DataFra
+0002f8c0: 6d65 2866 696c 6573 2c20 696e 6465 783d  me(files, index=
+0002f8d0: 6469 7361 6d62 5f73 6572 6965 732e 696e  disamb_series.in
+0002f8e0: 6465 7829 0a20 2020 2063 686f 6963 655f  dex).    choice_
+0002f8f0: 6265 7477 6565 6e5f 6e20 3d20 6c65 6e28  between_n = len(
+0002f900: 6669 6c65 7329 0a20 2020 2069 6620 6669  files).    if fi
+0002f910: 6c65 5f74 7970 6520 3d3d 2027 7363 6f72  le_type == 'scor
+0002f920: 6573 273a 0a20 2020 2020 2020 2023 2069  es':.        # i
+0002f930: 6620 6120 7363 6f72 6520 6973 2072 6571  f a score is req
+0002f940: 7565 7374 6564 2c20 6368 6563 6b20 6966  uested, check if
+0002f950: 2074 6865 7265 2069 7320 6f6e 6c79 2061   there is only a
+0002f960: 2073 696e 676c 6520 4d53 4358 206f 7220   single MSCX or 
+0002f970: 6f74 6865 7277 6973 6520 4d53 435a 2066  otherwise MSCZ f
+0002f980: 696c 6520 616e 6420 7069 636b 2074 6861  ile and pick tha
+0002f990: 740a 2020 2020 2020 2020 6665 7874 7320  t.        fexts 
+0002f9a0: 3d20 6669 6c65 735f 6466 2e66 6578 742e  = files_df.fext.
+0002f9b0: 7374 722e 6c6f 7765 7228 290a 2020 2020  str.lower().    
+0002f9c0: 2020 2020 6665 7874 5f63 6f75 6e74 7320      fext_counts 
+0002f9d0: 3d20 6665 7874 732e 7661 6c75 655f 636f  = fexts.value_co
+0002f9e0: 756e 7473 2829 0a20 2020 2020 2020 2069  unts().        i
+0002f9f0: 6620 272e 6d73 6378 2720 696e 2066 6578  f '.mscx' in fex
+0002fa00: 745f 636f 756e 7473 3a0a 2020 2020 2020  t_counts:.      
+0002fa10: 2020 2020 2020 6966 2066 6578 745f 636f        if fext_co
+0002fa20: 756e 7473 5b27 2e6d 7363 7827 5d20 3d3d  unts['.mscx'] ==
+0002fa30: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0002fa40: 2020 2020 7365 6c65 6374 6564 5f66 696c      selected_fil
+0002fa50: 6520 3d20 6469 7361 6d62 5f73 6572 6965  e = disamb_serie
+0002fa60: 735b 6665 7874 7320 3d3d 2027 2e6d 7363  s[fexts == '.msc
+0002fa70: 7827 5d2e 696c 6f63 5b30 5d0a 2020 2020  x'].iloc[0].    
+0002fa80: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0002fa90: 6572 2e64 6562 7567 2866 2249 6e20 6f72  er.debug(f"In or
+0002faa0: 6465 7220 746f 2070 6963 6b20 6f6e 6520  der to pick one 
+0002fab0: 6672 6f6d 2074 6865 207b 6368 6f69 6365  from the {choice
+0002fac0: 5f62 6574 7765 656e 5f6e 7d20 7363 6f72  _between_n} scor
+0002fad0: 6573 2077 6974 6820 666e 616d 6520 277b  es with fname '{
+0002fae0: 666e 616d 657d 272c 2027 7b73 656c 6563  fname}', '{selec
+0002faf0: 7465 645f 6669 6c65 2e72 656c 5f70 6174  ted_file.rel_pat
+0002fb00: 687d 2720 7761 7320 7365 6c65 6374 6564  h}' was selected
+0002fb10: 2062 6563 6175 7365 2069 7420 6973 2074   because it is t
+0002fb20: 6865 206f 6e6c 7920 220a 2020 2020 2020  he only ".      
+0002fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fb40: 2020 2020 2020 2020 2020 2066 226f 6e65             f"one
+0002fb50: 2069 6e20 4d53 4358 2066 6f72 6d61 742e   in MSCX format.
+0002fb60: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0002fb70: 2020 2072 6574 7572 6e20 7365 6c65 6374     return select
+0002fb80: 6564 5f66 696c 650a 2020 2020 2020 2020  ed_file.        
+0002fb90: 656c 6966 2027 2e6d 7363 7a27 2069 6e20  elif '.mscz' in 
+0002fba0: 6665 7874 5f63 6f75 6e74 7320 616e 6420  fext_counts and 
+0002fbb0: 6665 7874 5f63 6f75 6e74 735b 272e 6d73  fext_counts['.ms
+0002fbc0: 637a 275d 203d 3d20 313a 0a20 2020 2020  cz'] == 1:.     
+0002fbd0: 2020 2020 2020 2073 656c 6563 7465 645f         selected_
+0002fbe0: 6669 6c65 203d 2064 6973 616d 625f 7365  file = disamb_se
+0002fbf0: 7269 6573 5b66 6578 7473 203d 3d20 272e  ries[fexts == '.
+0002fc00: 6d73 637a 275d 2e69 6c6f 635b 305d 0a20  mscz'].iloc[0]. 
+0002fc10: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0002fc20: 722e 6465 6275 6728 6622 496e 206f 7264  r.debug(f"In ord
+0002fc30: 6572 2074 6f20 7069 636b 206f 6e65 2066  er to pick one f
+0002fc40: 726f 6d20 7468 6520 7b63 686f 6963 655f  rom the {choice_
+0002fc50: 6265 7477 6565 6e5f 6e7d 2073 636f 7265  between_n} score
+0002fc60: 7320 7769 7468 2066 6e61 6d65 2027 7b66  s with fname '{f
+0002fc70: 6e61 6d65 7d27 2c20 277b 7365 6c65 6374  name}', '{select
+0002fc80: 6564 5f66 696c 652e 7265 6c5f 7061 7468  ed_file.rel_path
+0002fc90: 7d27 2077 6173 2073 656c 6563 7465 6420  }' was selected 
+0002fca0: 6265 6361 7573 6520 6974 2069 7320 7468  because it is th
+0002fcb0: 6520 6f6e 6c79 2022 0a20 2020 2020 2020  e only ".       
+0002fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fcd0: 2020 2020 2020 6622 6f6e 6520 696e 204d        f"one in M
+0002fce0: 5343 5a20 666f 726d 6174 2e22 290a 2020  SCZ format.").  
+0002fcf0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002fd00: 2073 656c 6563 7465 645f 6669 6c65 0a20   selected_file. 
+0002fd10: 2020 2023 2061 7320 6669 7273 7420 6469     # as first di
+0002fd20: 7361 6d62 6967 7561 7469 6f6e 2063 7269  sambiguation cri
+0002fd30: 7465 7269 6f6e 2c20 6368 6563 6b20 6966  terion, check if
+0002fd40: 2074 6865 2073 686f 7274 6573 7420 6469   the shortest di
+0002fd50: 7361 6d62 6967 7561 7469 6f6e 2073 7472  sambiguation str
+0002fd60: 696e 6720 7065 7274 6169 6e73 2074 6f20  ing pertains to 
+0002fd70: 3120 6669 6c65 206f 6e6c 7920 616e 6420  1 file only and 
+0002fd80: 7069 636b 2074 6861 740a 2020 2020 6469  pick that.    di
+0002fd90: 7361 6d62 5f73 7472 5f6c 656e 6774 6873  samb_str_lengths
+0002fda0: 203d 2070 642e 5365 7269 6573 2864 6973   = pd.Series(dis
+0002fdb0: 616d 625f 7365 7269 6573 2e69 6e64 6578  amb_series.index
+0002fdc0: 2e6d 6170 286c 656e 292c 2069 6e64 6578  .map(len), index
+0002fdd0: 3d64 6973 616d 625f 7365 7269 6573 2e69  =disamb_series.i
+0002fde0: 6e64 6578 290a 2020 2020 7368 6f72 7465  ndex).    shorte
+0002fdf0: 7374 5f6c 656e 6774 685f 7365 6c65 6374  st_length_select
+0002fe00: 6f72 203d 2028 6469 7361 6d62 5f73 7472  or = (disamb_str
+0002fe10: 5f6c 656e 6774 6873 203d 3d20 6469 7361  _lengths == disa
+0002fe20: 6d62 5f73 7472 5f6c 656e 6774 6873 2e6d  mb_str_lengths.m
+0002fe30: 696e 2829 290a 2020 2020 6e5f 6861 7665  in()).    n_have
+0002fe40: 5f73 686f 7274 6573 745f 6c65 6e67 7468  _shortest_length
+0002fe50: 203d 2073 686f 7274 6573 745f 6c65 6e67   = shortest_leng
+0002fe60: 7468 5f73 656c 6563 746f 722e 7375 6d28  th_selector.sum(
+0002fe70: 290a 2020 2020 6966 206e 5f68 6176 655f  ).    if n_have_
+0002fe80: 7368 6f72 7465 7374 5f6c 656e 6774 6820  shortest_length 
+0002fe90: 3d3d 2031 3a0a 2020 2020 2020 2020 6978  == 1:.        ix
+0002fea0: 203d 2064 6973 616d 625f 7374 725f 6c65   = disamb_str_le
+0002feb0: 6e67 7468 732e 6964 786d 696e 2829 0a20  ngths.idxmin(). 
+0002fec0: 2020 2020 2020 2073 656c 6563 7465 645f         selected_
+0002fed0: 6669 6c65 203d 2064 6973 616d 625f 7365  file = disamb_se
+0002fee0: 7269 6573 2e6c 6f63 5b69 785d 0a20 2020  ries.loc[ix].   
+0002fef0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+0002ff00: 6728 6622 496e 206f 7264 6572 2074 6f20  g(f"In order to 
+0002ff10: 7069 636b 206f 6e65 2066 726f 6d20 7468  pick one from th
+0002ff20: 6520 7b63 686f 6963 655f 6265 7477 6565  e {choice_betwee
+0002ff30: 6e5f 6e7d 2027 7b66 696c 655f 7479 7065  n_n} '{file_type
+0002ff40: 7d27 2077 6974 6820 666e 616d 6520 277b  }' with fname '{
+0002ff50: 666e 616d 657d 272c 2074 6865 206f 6e65  fname}', the one
+0002ff60: 2077 6974 6820 7468 6520 7368 6f72 7465   with the shorte
+0002ff70: 7374 2064 6973 616d 6269 6775 6174 696e  st disambiguatin
+0002ff80: 6720 7374 7269 6e67 2027 7b69 787d 2720  g string '{ix}' 
+0002ff90: 7761 7320 7365 6c65 6374 6564 2e22 290a  was selected.").
+0002ffa0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0002ffb0: 656c 6563 7465 645f 6669 6c65 0a20 2020  elected_file.   
+0002ffc0: 2069 6620 6669 6c65 5f74 7970 6520 213d   if file_type !=
+0002ffd0: 2027 756e 6b6e 6f77 6e27 3a0a 2020 2020   'unknown':.    
+0002ffe0: 2020 2020 2320 6f74 6865 7277 6973 652c      # otherwise,
+0002fff0: 2063 6865 636b 2069 6620 6f6e 6c79 206f   check if only o
+00030000: 6e65 2066 696c 6520 6973 206c 7969 6e67  ne file is lying
+00030010: 2069 6e20 6120 6469 7265 6374 6f72 7920   in a directory 
+00030020: 7769 7468 2064 6566 6175 6c74 206e 616d  with default nam
+00030030: 650a 2020 2020 2020 2020 7375 6264 6972  e.        subdir
+00030040: 7320 3d20 6669 6c65 735f 6466 2e73 7562  s = files_df.sub
+00030050: 6469 720a 2020 2020 2020 2020 6465 6661  dir.        defa
+00030060: 756c 745f 636f 6d70 6f6e 656e 7473 203d  ult_components =
+00030070: 2066 696c 655f 7479 7065 3270 6174 685f   file_type2path_
+00030080: 636f 6d70 6f6e 656e 745f 6d61 7028 295b  component_map()[
+00030090: 6669 6c65 5f74 7970 655d 0a20 2020 2020  file_type].     
+000300a0: 2020 2064 6566 6175 6c74 5f63 6f6d 706f     default_compo
+000300b0: 6e65 6e74 735f 7265 6765 7820 3d20 277c  nents_regex = '|
+000300c0: 272e 6a6f 696e 2863 6f6d 702e 7265 706c  '.join(comp.repl
+000300d0: 6163 6528 272e 272c 2072 275c 2e27 2920  ace('.', r'\.') 
+000300e0: 666f 7220 636f 6d70 2069 6e20 6465 6661  for comp in defa
+000300f0: 756c 745f 636f 6d70 6f6e 656e 7473 290a  ult_components).
+00030100: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00030110: 7365 6c65 6374 6f72 203d 2073 7562 6469  selector = subdi
+00030120: 7273 2e73 7472 2e63 6f6e 7461 696e 7328  rs.str.contains(
+00030130: 6465 6661 756c 745f 636f 6d70 6f6e 656e  default_componen
+00030140: 7473 5f72 6567 6578 2c20 7265 6765 783d  ts_regex, regex=
+00030150: 5472 7565 290a 2020 2020 2020 2020 6966  True).        if
+00030160: 2064 6566 6175 6c74 5f73 656c 6563 746f   default_selecto
+00030170: 722e 7375 6d28 2920 3d3d 2031 3a0a 2020  r.sum() == 1:.  
+00030180: 2020 2020 2020 2020 2020 7375 6264 6972            subdir
+00030190: 203d 2073 7562 6469 7273 5b64 6566 6175   = subdirs[defau
+000301a0: 6c74 5f73 656c 6563 746f 725d 2e69 6c6f  lt_selector].ilo
+000301b0: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+000301c0: 2073 656c 6563 7465 645f 6669 6c65 203d   selected_file =
+000301d0: 2064 6973 616d 625f 7365 7269 6573 5b64   disamb_series[d
+000301e0: 6566 6175 6c74 5f73 656c 6563 746f 725d  efault_selector]
+000301f0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+00030200: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00030210: 6728 6622 496e 206f 7264 6572 2074 6f20  g(f"In order to 
+00030220: 7069 636b 206f 6e65 2066 726f 6d20 7468  pick one from th
+00030230: 6520 7b63 686f 6963 655f 6265 7477 6565  e {choice_betwee
+00030240: 6e5f 6e7d 2027 7b66 696c 655f 7479 7065  n_n} '{file_type
+00030250: 7d27 2077 6974 6820 666e 616d 6520 277b  }' with fname '{
+00030260: 666e 616d 657d 272c 2074 6865 206f 6e65  fname}', the one
+00030270: 2069 6e20 7468 6520 6465 6661 756c 7420   in the default 
+00030280: 7375 6264 6972 2027 7b73 7562 6469 727d  subdir '{subdir}
+00030290: 2720 7761 7320 7365 6c65 6374 6564 2e22  ' was selected."
+000302a0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000302b0: 7475 726e 2073 656c 6563 7465 645f 6669  turn selected_fi
+000302c0: 6c65 0a20 2020 2020 2020 2023 206f 7220  le.        # or 
+000302d0: 6966 206f 6e6c 7920 6f6e 6520 6669 6c65  if only one file
+000302e0: 2063 6f6e 7461 696e 7320 6120 6465 6661   contains a defa
+000302f0: 756c 7420 6e61 6d65 2069 6e20 6974 7320  ult name in its 
+00030300: 7375 6666 6978 0a20 2020 2020 2020 2073  suffix.        s
+00030310: 7566 6669 7865 7320 3d20 6669 6c65 735f  uffixes = files_
+00030320: 6466 2e73 7566 6669 780a 2020 2020 2020  df.suffix.      
+00030330: 2020 6465 6661 756c 745f 7365 6c65 6374    default_select
+00030340: 6f72 203d 2073 7566 6669 7865 732e 7374  or = suffixes.st
+00030350: 722e 636f 6e74 6169 6e73 2864 6566 6175  r.contains(defau
+00030360: 6c74 5f63 6f6d 706f 6e65 6e74 735f 7265  lt_components_re
+00030370: 6765 782c 2072 6567 6578 3d54 7275 6529  gex, regex=True)
+00030380: 0a20 2020 2020 2020 2069 6620 6465 6661  .        if defa
+00030390: 756c 745f 7365 6c65 6374 6f72 2e73 756d  ult_selector.sum
+000303a0: 2829 203d 3d20 313a 0a20 2020 2020 2020  () == 1:.       
+000303b0: 2020 2020 2073 7566 6669 7820 3d20 7375       suffix = su
+000303c0: 6666 6978 6573 5b64 6566 6175 6c74 5f73  ffixes[default_s
+000303d0: 656c 6563 746f 725d 2e69 6c6f 635b 305d  elector].iloc[0]
+000303e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000303f0: 6563 7465 645f 6669 6c65 203d 2064 6973  ected_file = dis
+00030400: 616d 625f 7365 7269 6573 5b64 6566 6175  amb_series[defau
+00030410: 6c74 5f73 656c 6563 746f 725d 2e69 6c6f  lt_selector].ilo
+00030420: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+00030430: 206c 6f67 6765 722e 6465 6275 6728 6622   logger.debug(f"
+00030440: 496e 206f 7264 6572 2074 6f20 7069 636b  In order to pick
+00030450: 206f 6e65 2066 726f 6d20 7468 6520 7b63   one from the {c
+00030460: 686f 6963 655f 6265 7477 6565 6e5f 6e7d  hoice_between_n}
+00030470: 2027 7b66 696c 655f 7479 7065 7d27 2077   '{file_type}' w
+00030480: 6974 6820 666e 616d 6520 277b 666e 616d  ith fname '{fnam
+00030490: 657d 272c 2074 6865 206f 6e65 2069 6e20  e}', the one in 
+000304a0: 7468 6520 6465 6661 756c 7420 7375 6666  the default suff
+000304b0: 6978 2027 7b73 7566 6669 787d 2720 7761  ix '{suffix}' wa
+000304c0: 7320 7365 6c65 6374 6564 2e22 290a 2020  s selected.").  
+000304d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000304e0: 2073 656c 6563 7465 645f 6669 6c65 0a20   selected_file. 
+000304f0: 2020 2023 2069 6620 6e6f 2066 696c 6520     # if no file 
+00030500: 7761 7320 7365 6c65 6374 6564 2c20 7472  was selected, tr
+00030510: 7920 6167 6169 6e20 7769 7468 206f 6e6c  y again with onl
+00030520: 7920 7468 6f73 6520 6861 7669 6e67 2074  y those having t
+00030530: 6865 2073 686f 7274 6573 7420 6469 7361  he shortest disa
+00030540: 6d62 6967 7561 7469 6f6e 2073 7472 696e  mbiguation strin
+00030550: 6773 0a20 2020 2069 6620 7368 6f72 7465  gs.    if shorte
+00030560: 7374 5f6c 656e 6774 685f 7365 6c65 6374  st_length_select
+00030570: 6f72 2e61 6c6c 2829 3a0a 2020 2020 2020  or.all():.      
+00030580: 2020 2320 6966 2061 6c6c 2064 6973 616d    # if all disam
+00030590: 6269 6775 6174 696f 6e20 7374 7269 6e67  biguation string
+000305a0: 7320 616c 7265 6164 7920 6861 7665 2074  s already have t
+000305b0: 6865 2073 686f 7274 6573 7420 6c65 6e67  he shortest leng
+000305c0: 7468 2c20 6173 2061 206c 6173 7420 7265  th, as a last re
+000305d0: 736f 7274 0a20 2020 2020 2020 2023 2066  sort.        # f
+000305e0: 616c 6c20 6261 636b 2074 6f20 7468 6520  all back to the 
+000305f0: 6c65 7869 676f 6772 6170 6869 6361 6c6c  lexigographicall
+00030600: 7920 6669 7273 740a 2020 2020 2020 2020  y first.        
+00030610: 736f 7274 6564 5f64 6973 616d 625f 7365  sorted_disamb_se
+00030620: 7269 6573 203d 2064 6973 616d 625f 7365  ries = disamb_se
+00030630: 7269 6573 2e73 6f72 745f 696e 6465 7828  ries.sort_index(
+00030640: 290a 2020 2020 2020 2020 6469 7361 6d62  ).        disamb
+00030650: 203d 2073 6f72 7465 645f 6469 7361 6d62   = sorted_disamb
+00030660: 5f73 6572 6965 732e 696e 6465 785b 305d  _series.index[0]
+00030670: 0a20 2020 2020 2020 2073 656c 6563 7465  .        selecte
+00030680: 645f 6669 6c65 203d 2073 6f72 7465 645f  d_file = sorted_
+00030690: 6469 7361 6d62 5f73 6572 6965 732e 696c  disamb_series.il
+000306a0: 6f63 5b30 5d0a 2020 2020 2020 2020 6c6f  oc[0].        lo
+000306b0: 6767 6572 2e77 6172 6e69 6e67 2866 2255  gger.warning(f"U
+000306c0: 6e61 626c 6520 746f 2061 7574 6f6d 6174  nable to automat
+000306d0: 6963 616c 6c79 2063 686f 6f73 6520 6672  ically choose fr
+000306e0: 6f6d 2074 6865 207b 6368 6f69 6365 5f62  om the {choice_b
+000306f0: 6574 7765 656e 5f6e 7d20 277b 6669 6c65  etween_n} '{file
+00030700: 5f74 7970 657d 2720 7769 7468 2066 6e61  _type}' with fna
+00030710: 6d65 2027 7b66 6e61 6d65 7d27 2e20 4927  me '{fname}'. I'
+00030720: 6d20 7069 636b 696e 6720 277b 7365 6c65  m picking '{sele
+00030730: 6374 6564 5f66 696c 652e 7265 6c5f 7061  cted_file.rel_pa
+00030740: 7468 7d27 2022 0a20 2020 2020 2020 2020  th}' ".         
+00030750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030760: 2020 2066 2262 6563 6175 7365 2069 7473     f"because its
+00030770: 2064 6973 616d 6269 6775 6174 696f 6e20   disambiguation 
+00030780: 7374 7269 6e67 2027 7b64 6973 616d 627d  string '{disamb}
+00030790: 2720 6973 2074 6865 206c 6578 6963 6f67  ' is the lexicog
+000307a0: 7261 7068 6963 616c 6c79 2066 6972 7374  raphically first
+000307b0: 2061 6d6f 6e67 207b 736f 7274 6564 5f64   among {sorted_d
+000307c0: 6973 616d 625f 7365 7269 6573 2e69 6e64  isamb_series.ind
+000307d0: 6578 2e74 6f5f 6c69 7374 2829 7d22 290a  ex.to_list()}").
+000307e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000307f0: 656c 6563 7465 645f 6669 6c65 0a20 2020  elected_file.   
+00030800: 206f 6e6c 795f 7368 6f72 7465 7374 5f64   only_shortest_d
+00030810: 6973 616d 625f 7374 7220 3d20 6469 7361  isamb_str = disa
+00030820: 6d62 5f73 6572 6965 735b 7368 6f72 7465  mb_series[shorte
+00030830: 7374 5f6c 656e 6774 685f 7365 6c65 6374  st_length_select
+00030840: 6f72 5d2e 746f 5f64 6963 7428 290a 2020  or].to_dict().  
+00030850: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
+00030860: 4166 7465 7220 7468 6520 6669 7273 7420  After the first 
+00030870: 756e 7375 6363 6573 7366 756c 2061 7474  unsuccessful att
+00030880: 656d 7074 2074 6f20 6368 6f6f 7365 2066  empt to choose f
+00030890: 726f 6d20 7b63 686f 6963 655f 6265 7477  rom {choice_betw
+000308a0: 6565 6e5f 6e7d 2027 7b66 696c 655f 7479  een_n} '{file_ty
+000308b0: 7065 7d27 2077 6974 6820 666e 616d 6520  pe}' with fname 
+000308c0: 277b 666e 616d 657d 272c 2074 7279 696e  '{fname}', tryin
+000308d0: 6720 6167 6169 6e20 220a 2020 2020 2020  g again ".      
+000308e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000308f0: 2020 6622 6166 7465 7220 7265 6475 6369    f"after reduci
+00030900: 6e67 2074 6865 2063 686f 6963 6573 2074  ng the choices t
+00030910: 6f20 7468 6520 7b73 686f 7274 6573 745f  o the {shortest_
+00030920: 6c65 6e67 7468 5f73 656c 6563 746f 722e  length_selector.
+00030930: 7375 6d28 297d 2077 6974 6820 7468 6520  sum()} with the 
+00030940: 7368 6f72 7465 7374 2064 6973 616d 6269  shortest disambi
+00030950: 6775 6174 696f 6e20 7374 7269 6e67 732e  guation strings.
+00030960: 2229 0a20 2020 2072 6574 7572 6e20 6175  ").    return au
+00030970: 746f 6d61 7469 6361 6c6c 795f 6368 6f6f  tomatically_choo
+00030980: 7365 5f66 726f 6d5f 6469 7361 6d62 6967  se_from_disambig
+00030990: 7561 7465 645f 6669 6c65 7328 6f6e 6c79  uated_files(only
+000309a0: 5f73 686f 7274 6573 745f 6469 7361 6d62  _shortest_disamb
+000309b0: 5f73 7472 2c20 666e 616d 652c 2066 696c  _str, fname, fil
+000309c0: 655f 7479 7065 290a 0a64 6566 2061 736b  e_type)..def ask
+000309d0: 5f75 7365 725f 746f 5f63 686f 6f73 6528  _user_to_choose(
+000309e0: 7175 6572 793a 2073 7472 2c20 6368 6f69  query: str, choi
+000309f0: 6365 733a 2043 6f6c 6c65 6374 696f 6e5b  ces: Collection[
+00030a00: 416e 795d 2920 2d3e 204f 7074 696f 6e61  Any]) -> Optiona
+00030a10: 6c5b 416e 795d 3a0a 2020 2020 2222 2241  l[Any]:.    """A
+00030a20: 736b 2075 7365 7220 746f 2069 6e70 7574  sk user to input
+00030a30: 2061 6e20 696e 7465 6765 7220 616e 6420   an integer and 
+00030a40: 7265 7475 726e 2074 6865 206e 7468 2063  return the nth c
+00030a50: 686f 6963 6520 7365 6c65 6374 6564 2062  hoice selected b
+00030a60: 7920 7468 6520 7573 6572 2e22 2222 0a20  y the user.""". 
+00030a70: 2020 206e 5f63 686f 6963 6573 203d 206c     n_choices = l
+00030a80: 656e 2863 686f 6963 6573 290a 2020 2020  en(choices).    
+00030a90: 7261 6e67 655f 7374 7220 3d20 6622 312d  range_str = f"1-
+00030aa0: 7b6e 5f63 686f 6963 6573 7d22 0a20 2020  {n_choices}".   
+00030ab0: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
+00030ac0: 2020 2020 2073 203d 2069 6e70 7574 2871       s = input(q
+00030ad0: 7565 7279 290a 2020 2020 2020 2020 7472  uery).        tr
+00030ae0: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
+00030af0: 6e74 5f69 203d 2069 6e74 2873 290a 2020  nt_i = int(s).  
+00030b00: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00030b10: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00030b20: 2020 2020 7072 696e 7428 6622 5661 6c75      print(f"Valu
+00030b30: 6520 277b 737d 2720 636f 756c 6420 6e6f  e '{s}' could no
+00030b40: 7420 6265 2063 6f6e 7665 7274 6564 2074  t be converted t
+00030b50: 6f20 616e 2069 6e74 6567 6572 2e22 290a  o an integer.").
+00030b60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00030b70: 696e 7565 0a20 2020 2020 2020 2069 6620  inue.        if 
+00030b80: 6e6f 7420 2830 203c 3d20 696e 745f 6920  not (0 <= int_i 
+00030b90: 3c3d 206e 5f63 686f 6963 6573 293a 0a20  <= n_choices):. 
+00030ba0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00030bb0: 2866 2256 616c 7565 2027 7b73 7d27 2069  (f"Value '{s}' i
+00030bc0: 7320 6e6f 7420 7769 7468 696e 207b 7261  s not within {ra
+00030bd0: 6e67 655f 7374 727d 2e22 290a 2020 2020  nge_str}.").    
+00030be0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00030bf0: 0a20 2020 2020 2020 2069 6620 696e 745f  .        if int_
+00030c00: 6920 3d3d 2030 3a0a 2020 2020 2020 2020  i == 0:.        
+00030c10: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00030c20: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00030c30: 686f 6963 6573 5b69 6e74 5f69 202d 2031  hoices[int_i - 1
+00030c40: 5d0a 0a0a 6465 6620 6173 6b5f 7573 6572  ]...def ask_user
+00030c50: 5f74 6f5f 6368 6f6f 7365 5f66 726f 6d5f  _to_choose_from_
+00030c60: 6469 7361 6d62 6967 7561 7465 645f 6669  disambiguated_fi
+00030c70: 6c65 7328 6469 7361 6d62 6967 7561 7465  les(disambiguate
+00030c80: 645f 6368 6f69 6365 733a 2044 6963 745b  d_choices: Dict[
+00030c90: 7374 722c 2046 696c 655d 2c0a 2020 2020  str, File],.    
+00030ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030cc0: 2020 2020 2020 2020 2020 2020 666e 616d              fnam
+00030cd0: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
+00030ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030d00: 2020 2020 2020 2020 6669 6c65 5f74 7970          file_typ
+00030d10: 653a 2073 7472 203d 2027 2729 202d 3e20  e: str = '') -> 
+00030d20: 4f70 7469 6f6e 616c 5b46 696c 655d 3a0a  Optional[File]:.
+00030d30: 2020 2020 736f 7274 6564 5f6b 6579 7320      sorted_keys 
+00030d40: 3d20 736f 7274 6564 2864 6973 616d 6269  = sorted(disambi
+00030d50: 6775 6174 6564 5f63 686f 6963 6573 2e6b  guated_choices.k
+00030d60: 6579 7328 292c 206b 6579 3d6c 616d 6264  eys(), key=lambd
+00030d70: 6120 733a 2028 6c65 6e28 7329 2c20 7329  a s: (len(s), s)
+00030d80: 290a 2020 2020 6469 7361 6d62 6967 7561  ).    disambigua
+00030d90: 7465 645f 6368 6f69 6365 7320 3d20 7b6b  ted_choices = {k
+00030da0: 3a20 6469 7361 6d62 6967 7561 7465 645f  : disambiguated_
+00030db0: 6368 6f69 6365 735b 6b5d 2066 6f72 206b  choices[k] for k
+00030dc0: 2069 6e20 736f 7274 6564 5f6b 6579 737d   in sorted_keys}
+00030dd0: 0a20 2020 2066 696c 655f 6c69 7374 203d  .    file_list =
+00030de0: 206c 6973 7428 6469 7361 6d62 6967 7561   list(disambigua
+00030df0: 7465 645f 6368 6f69 6365 732e 7661 6c75  ted_choices.valu
+00030e00: 6573 2829 290a 2020 2020 6469 7361 6d62  es()).    disamb
+00030e10: 5f73 7472 696e 6773 203d 2070 642e 5365  _strings = pd.Se
+00030e20: 7269 6573 2864 6973 616d 6269 6775 6174  ries(disambiguat
+00030e30: 6564 5f63 686f 6963 6573 2e6b 6579 7328  ed_choices.keys(
+00030e40: 292c 206e 616d 653d 2764 6973 616d 6269  ), name='disambi
+00030e50: 6775 6174 696f 6e5f 7374 7227 290a 2020  guation_str').  
+00030e60: 2020 6368 6f69 6365 735f 6466 203d 2070    choices_df = p
+00030e70: 642e 636f 6e63 6174 285b 6469 7361 6d62  d.concat([disamb
+00030e80: 5f73 7472 696e 6773 2c0a 2020 2020 2020  _strings,.      
+00030e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ea0: 2020 2020 2020 7064 2e44 6174 6146 7261        pd.DataFra
+00030eb0: 6d65 2866 696c 655f 6c69 7374 295b 5b27  me(file_list)[['
+00030ec0: 7265 6c5f 7061 7468 272c 2027 7479 7065  rel_path', 'type
+00030ed0: 272c 2027 6978 275d 5d5d 2c0a 2020 2020  ', 'ix']]],.    
+00030ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ef0: 2020 2020 2020 2061 7869 733d 3129 0a20         axis=1). 
+00030f00: 2020 2063 686f 6963 6573 5f64 662e 696e     choices_df.in
+00030f10: 6465 7820 3d20 7064 2e49 6e64 6578 2872  dex = pd.Index(r
+00030f20: 616e 6765 2831 2c20 6c65 6e28 6669 6c65  ange(1, len(file
+00030f30: 5f6c 6973 7429 202b 2031 292c 206e 616d  _list) + 1), nam
+00030f40: 653d 2773 656c 6563 743a 2729 0a20 2020  e='select:').   
+00030f50: 2072 616e 6765 5f73 7472 203d 2066 2231   range_str = f"1
+00030f60: 2d7b 6c65 6e28 6469 7361 6d62 6967 7561  -{len(disambigua
+00030f70: 7465 645f 6368 6f69 6365 7329 7d22 0a20  ted_choices)}". 
+00030f80: 2020 2071 7565 7279 203d 2066 2253 656c     query = f"Sel
+00030f90: 6563 7469 6f6e 205b 7b72 616e 6765 5f73  ection [{range_s
+00030fa0: 7472 7d5d 3a20 220a 2020 2020 7072 696e  tr}]: ".    prin
+00030fb0: 7428 6622 5365 7665 7261 6c20 277b 6669  t(f"Several '{fi
+00030fc0: 6c65 5f74 7970 657d 2720 6176 6169 6c61  le_type}' availa
+00030fd0: 626c 6520 666f 7220 277b 666e 616d 657d  ble for '{fname}
+00030fe0: 273a 5c6e 7b63 686f 6963 6573 5f64 662e  ':\n{choices_df.
+00030ff0: 746f 5f73 7472 696e 6728 297d 2229 0a20  to_string()}"). 
+00031000: 2020 2070 7269 6e74 2866 2250 6c65 6173     print(f"Pleas
+00031010: 6520 7365 6c65 6374 206f 6e65 206f 6620  e select one of 
+00031020: 7468 6520 6669 6c65 7320 6279 2070 6173  the files by pas
+00031030: 7369 6e67 2061 6e20 696e 7465 6765 7220  sing an integer 
+00031040: 6265 7477 6565 6e20 7b72 616e 6765 5f73  between {range_s
+00031050: 7472 7d20 286f 7220 3020 666f 7220 6e6f  tr} (or 0 for no
+00031060: 6e65 293a 2229 0a20 2020 2072 6574 7572  ne):").    retur
+00031070: 6e20 6173 6b5f 7573 6572 5f74 6f5f 6368  n ask_user_to_ch
+00031080: 6f6f 7365 2871 7565 7279 2c20 6669 6c65  oose(query, file
+00031090: 5f6c 6973 7429 0a0a 0a40 6675 6e63 7469  _list)...@functi
+000310a0: 6f6e 5f6c 6f67 6765 720a 6465 6620 6469  on_logger.def di
+000310b0: 7361 6d62 6967 7561 7465 5f66 696c 6573  sambiguate_files
+000310c0: 2866 696c 6573 3a20 436f 6c6c 6563 7469  (files: Collecti
+000310d0: 6f6e 5b46 696c 655d 2c20 666e 616d 653a  on[File], fname:
+000310e0: 2073 7472 2c20 6669 6c65 5f74 7970 653a   str, file_type:
+000310f0: 2073 7472 2c20 6368 6f6f 7365 3a20 4c69   str, choose: Li
+00031100: 7465 7261 6c5b 2761 7574 6f27 2c20 2761  teral['auto', 'a
+00031110: 736b 275d 203d 2027 6175 746f 2729 202d  sk'] = 'auto') -
+00031120: 3e20 4f70 7469 6f6e 616c 5b46 696c 655d  > Optional[File]
+00031130: 3a0a 2020 2020 2222 2252 6563 6569 7665  :.    """Receive
+00031140: 7320 6120 636f 6c6c 6563 7469 6f6e 206f  s a collection o
+00031150: 6620 3a6f 626a 3a60 4669 6c65 6020 7769  f :obj:`File` wi
+00031160: 7468 2074 6865 2061 696d 2074 6f20 7069  th the aim to pi
+00031170: 636b 206f 6e65 206f 6620 7468 656d 2e0a  ck one of them..
+00031180: 2020 2020 4669 7273 742c 2061 2064 6963      First, a dic
+00031190: 7469 6f6e 6172 7920 6973 2063 7265 6174  tionary is creat
+000311a0: 6564 2077 6865 7265 2074 6865 206b 6579  ed where the key
+000311b0: 7320 6172 6520 6469 7361 6d62 6967 7561  s are disambigua
+000311c0: 7469 6f6e 2073 7472 696e 6773 2062 6173  tion strings bas
+000311d0: 6564 206f 6e20 7468 6520 6669 6c65 7327  ed on the files'
+000311e0: 2070 6174 6873 2061 6e64 0a20 2020 2073   paths and.    s
+000311f0: 7566 6669 7865 732e 0a0a 2020 2020 4172  uffixes...    Ar
+00031200: 6773 3a0a 2020 2020 2020 6669 6c65 733a  gs:.      files:
+00031210: 0a20 2020 2020 2063 686f 6f73 653a 2049  .      choose: I
+00031220: 6620 2761 7574 6f27 2028 6465 6661 756c  f 'auto' (defaul
+00031230: 7429 2c20 7468 6520 6669 6c65 2077 6974  t), the file wit
+00031240: 6820 7468 6520 7368 6f72 7465 7374 2064  h the shortest d
+00031250: 6973 616d 6269 6775 6174 696f 6e20 7374  isambiguation st
+00031260: 7269 6e67 2069 7320 6368 6f73 656e 2e20  ring is chosen. 
+00031270: 5365 7420 746f 2054 7275 650a 2020 2020  Set to True.    
+00031280: 2020 2020 2020 6966 2079 6f75 2077 616e        if you wan
+00031290: 7420 746f 2062 6520 6173 6b65 6420 746f  t to be asked to
+000312a0: 206d 616e 7561 6c6c 7920 6368 6f6f 7365   manually choose
+000312b0: 2061 2066 696c 652e 0a0a 2020 2020 5265   a file...    Re
+000312c0: 7475 726e 733a 0a20 2020 2020 2054 6865  turns:.      The
+000312d0: 2073 656c 6563 7465 6420 6669 6c65 2e0a   selected file..
+000312e0: 2020 2020 2222 220a 2020 2020 6e5f 6669      """.    n_fi
+000312f0: 6c65 7320 3d20 6c65 6e28 6669 6c65 7329  les = len(files)
+00031300: 0a20 2020 2069 6620 6e5f 6669 6c65 7320  .    if n_files 
+00031310: 3d3d 2030 3a0a 2020 2020 2020 2020 7265  == 0:.        re
+00031320: 7475 726e 0a20 2020 2066 696c 6573 203d  turn.    files =
+00031330: 2074 7570 6c65 2866 696c 6573 290a 2020   tuple(files).  
+00031340: 2020 6966 206e 5f66 696c 6573 203d 3d20    if n_files == 
+00031350: 313a 0a20 2020 2020 2020 2072 6574 7572  1:.        retur
+00031360: 6e20 6669 6c65 735b 305d 0a20 2020 2069  n files[0].    i
+00031370: 6620 6368 6f6f 7365 206e 6f74 2069 6e20  f choose not in 
+00031380: 2827 6175 746f 272c 2027 6173 6b27 293a  ('auto', 'ask'):
+00031390: 0a20 2020 2020 2020 206c 6f67 6765 722e  .        logger.
+000313a0: 696e 666f 2866 2254 6865 2076 616c 7565  info(f"The value
+000313b0: 2066 6f72 2063 686f 6f73 6520 6e65 6564   for choose need
+000313c0: 7320 746f 2062 6520 2761 7574 6f27 206f  s to be 'auto' o
+000313d0: 7220 2761 736b 272c 206e 6f74 207b 6368  r 'ask', not {ch
+000313e0: 6f6f 7365 7d2e 2053 6574 7469 6e67 2074  oose}. Setting t
+000313f0: 6f20 2761 7574 6f27 2e22 290a 2020 2020  o 'auto'.").    
+00031400: 2020 2020 6368 6f6f 7365 203d 2027 6175      choose = 'au
+00031410: 746f 270a 2020 2020 6469 7361 6d62 6967  to'.    disambig
+00031420: 7561 7469 6f6e 5f64 6963 7420 3d20 6669  uation_dict = fi
+00031430: 6c65 7332 6469 7361 6d62 6967 7561 7469  les2disambiguati
+00031440: 6f6e 5f64 6963 7428 6669 6c65 732c 206c  on_dict(files, l
+00031450: 6f67 6765 723d 6c6f 6767 6572 290a 2020  ogger=logger).  
+00031460: 2020 6966 2063 686f 6f73 6520 3d3d 2027    if choose == '
+00031470: 6173 6b27 3a0a 2020 2020 2020 2020 7265  ask':.        re
+00031480: 7475 726e 2061 736b 5f75 7365 725f 746f  turn ask_user_to
+00031490: 5f63 686f 6f73 655f 6672 6f6d 5f64 6973  _choose_from_dis
+000314a0: 616d 6269 6775 6174 6564 5f66 696c 6573  ambiguated_files
+000314b0: 2864 6973 616d 6269 6775 6174 696f 6e5f  (disambiguation_
+000314c0: 6469 6374 2c20 666e 616d 652c 2066 696c  dict, fname, fil
+000314d0: 655f 7479 7065 290a 2020 2020 7265 7475  e_type).    retu
+000314e0: 726e 2061 7574 6f6d 6174 6963 616c 6c79  rn automatically
+000314f0: 5f63 686f 6f73 655f 6672 6f6d 5f64 6973  _choose_from_dis
+00031500: 616d 6269 6775 6174 6564 5f66 696c 6573  ambiguated_files
+00031510: 2864 6973 616d 6269 6775 6174 696f 6e5f  (disambiguation_
+00031520: 6469 6374 2c20 666e 616d 652c 2066 696c  dict, fname, fil
+00031530: 655f 7479 7065 2c20 6c6f 6767 6572 3d6c  e_type, logger=l
+00031540: 6f67 6765 7229 0a0a 2320 4066 756e 6374  ogger)..# @funct
+00031550: 696f 6e5f 6c6f 6767 6572 0a23 2064 6566  ion_logger.# def
+00031560: 2064 6973 616d 6269 6775 6174 655f 7061   disambiguate_pa
+00031570: 7273 6564 5f66 696c 6573 2874 7570 6c65  rsed_files(tuple
+00031580: 735f 7769 7468 5f66 696c 655f 6173 5f66  s_with_file_as_f
+00031590: 6972 7374 5f65 6c65 6d65 6e74 3a20 436f  irst_element: Co
+000315a0: 6c6c 6563 7469 6f6e 5b54 7570 6c65 5d2c  llection[Tuple],
+000315b0: 2066 6e61 6d65 3a20 7374 722c 2066 696c   fname: str, fil
+000315c0: 655f 7479 7065 3a20 7374 722c 2063 686f  e_type: str, cho
+000315d0: 6f73 653a 204c 6974 6572 616c 5b27 6175  ose: Literal['au
+000315e0: 746f 272c 2027 6173 6b27 5d20 3d20 2761  to', 'ask'] = 'a
+000315f0: 7574 6f27 2920 2d3e 204f 7074 696f 6e61  uto') -> Optiona
+00031600: 6c5b 4669 6c65 5d3a 0a23 2020 2020 2066  l[File]:.#     f
+00031610: 696c 6573 203d 205b 7475 705b 305d 2066  iles = [tup[0] f
+00031620: 6f72 2074 7570 2069 6e20 7475 706c 6573  or tup in tuples
+00031630: 5f77 6974 685f 6669 6c65 5f61 735f 6669  _with_file_as_fi
+00031640: 7273 745f 656c 656d 656e 745d 0a23 2020  rst_element].#  
+00031650: 2020 2073 656c 6563 7465 6420 3d20 6469     selected = di
+00031660: 7361 6d62 6967 7561 7465 5f66 696c 6573  sambiguate_files
+00031670: 2866 696c 6573 2c20 666e 616d 653d 666e  (files, fname=fn
+00031680: 616d 652c 2066 696c 655f 7479 7065 3d66  ame, file_type=f
+00031690: 696c 655f 7479 7065 2c20 6368 6f6f 7365  ile_type, choose
+000316a0: 3d63 686f 6f73 652c 206c 6f67 6765 723d  =choose, logger=
+000316b0: 6c6f 6767 6572 290a 2320 2020 2020 6966  logger).#     if
+000316c0: 2073 656c 6563 7465 6420 6973 204e 6f6e   selected is Non
+000316d0: 653a 0a23 2020 2020 2020 2020 2072 6574  e:.#         ret
+000316e0: 7572 6e0a 2320 2020 2020 666f 7220 7475  urn.#     for tu
+000316f0: 7020 696e 2074 7570 6c65 735f 7769 7468  p in tuples_with
+00031700: 5f66 696c 655f 6173 5f66 6972 7374 5f65  _file_as_first_e
+00031710: 6c65 6d65 6e74 3a0a 2320 2020 2020 2020  lement:.#       
+00031720: 2020 6966 2074 7570 5b30 5d20 3d3d 2073    if tup[0] == s
+00031730: 656c 6563 7465 643a 0a23 2020 2020 2020  elected:.#      
+00031740: 2020 2020 2020 2072 6574 7572 6e20 7475         return tu
+00031750: 700a 0a0a 4066 756e 6374 696f 6e5f 6c6f  p...@function_lo
+00031760: 6767 6572 0a64 6566 2066 696c 6573 3264  gger.def files2d
+00031770: 6973 616d 6269 6775 6174 696f 6e5f 6469  isambiguation_di
+00031780: 6374 2866 696c 6573 3a20 436f 6c6c 6563  ct(files: Collec
+00031790: 7469 6f6e 5b46 696c 655d 2c20 696e 636c  tion[File], incl
+000317a0: 7564 655f 6469 7361 6d62 6967 7561 746f  ude_disambiguato
+000317b0: 723a 2062 6f6f 6c20 3d20 4661 6c73 6529  r: bool = False)
+000317c0: 202d 3e20 4669 6c65 4469 6374 3a0a 2020   -> FileDict:.  
+000317d0: 2020 2222 2254 616b 6573 2061 206c 6973    """Takes a lis
+000317e0: 7420 6f66 203a 636c 6173 733a 6046 696c  t of :class:`Fil
+000317f0: 6560 2072 6574 7572 6e73 2061 2064 6963  e` returns a dic
+00031800: 7469 6f6e 6172 7920 7769 7468 2064 6973  tionary with dis
+00031810: 616d 6269 6775 6174 696e 6720 7374 7269  ambiguating stri
+00031820: 6e67 7320 6261 7365 6420 6f6e 2070 6174  ngs based on pat
+00031830: 6820 636f 6d70 6f6e 656e 7473 2e0a 2020  h components..  
+00031840: 2020 6f66 2064 6973 7469 6e63 7420 7374    of distinct st
+00031850: 7269 6e67 7320 746f 2064 6973 7469 6e67  rings to disting
+00031860: 7569 7368 2066 696c 6573 2070 6572 7461  uish files perta
+00031870: 696e 696e 6720 746f 2074 6865 2073 616d  ining to the sam
+00031880: 6520 7479 7065 2e22 2222 0a20 2020 206e  e type.""".    n
+00031890: 5f66 696c 6573 203d 206c 656e 2866 696c  _files = len(fil
+000318a0: 6573 290a 2020 2020 6966 206e 5f66 696c  es).    if n_fil
+000318b0: 6573 203d 3d20 303a 0a20 2020 2020 2020  es == 0:.       
+000318c0: 2072 6574 7572 6e20 7b7d 0a20 2020 2066   return {}.    f
+000318d0: 696c 6573 203d 2074 7570 6c65 2866 696c  iles = tuple(fil
+000318e0: 6573 290a 2020 2020 6966 206e 5f66 696c  es).    if n_fil
+000318f0: 6573 3d3d 2031 3a0a 2020 2020 2020 2020  es== 1:.        
+00031900: 6620 3d20 6669 6c65 735b 305d 0a20 2020  f = files[0].   
+00031910: 2020 2020 2072 6574 7572 6e20 7b66 2e74       return {f.t
+00031920: 7970 653a 2066 7d0a 2020 2020 6469 7361  ype: f}.    disa
+00031930: 6d62 6967 7561 7469 6f6e 203d 205b 662e  mbiguation = [f.
+00031940: 7479 7065 2066 6f72 2066 2069 6e20 6669  type for f in fi
+00031950: 6c65 735d 0a20 2020 2069 6620 6c65 6e28  les].    if len(
+00031960: 7365 7428 6469 7361 6d62 6967 7561 7469  set(disambiguati
+00031970: 6f6e 2929 203d 3d20 6e5f 6669 6c65 733a  on)) == n_files:
+00031980: 0a20 2020 2020 2020 2023 2064 6f6e 6520  .        # done 
+00031990: 6469 7361 6d62 6967 7561 7469 6e67 0a20  disambiguating. 
+000319a0: 2020 2020 2020 2072 6574 7572 6e20 6469         return di
+000319b0: 6374 287a 6970 2864 6973 616d 6269 6775  ct(zip(disambigu
+000319c0: 6174 696f 6e2c 2066 696c 6573 2929 0a20  ation, files)). 
+000319d0: 2020 2069 6620 696e 636c 7564 655f 6469     if include_di
+000319e0: 7361 6d62 6967 7561 746f 7220 616e 6420  sambiguator and 
+000319f0: 6c65 6e28 7365 7428 6469 7361 6d62 6967  len(set(disambig
+00031a00: 7561 7469 6f6e 2929 203e 2031 3a0a 2020  uation)) > 1:.  
+00031a10: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+00031a20: 6e69 6e67 2866 2249 6e63 6c75 6469 6e67  ning(f"Including
+00031a30: 2074 6865 2064 6973 616d 6269 6775 6174   the disambiguat
+00031a40: 6f72 2072 656d 6f76 6573 2074 6865 2066  or removes the f
+00031a50: 6163 6574 206e 616d 652c 2062 7574 2074  acet name, but t
+00031a60: 6865 2066 696c 6573 2070 6572 7461 696e  he files pertain
+00031a70: 2074 6f20 220a 2020 2020 2020 2020 2020   to ".          
+00031a80: 2020 2020 2020 2020 2020 2066 2273 6576             f"sev
+00031a90: 6572 616c 2066 6163 6574 733a 207b 7365  eral facets: {se
+00031aa0: 7428 6469 7361 6d62 6967 7561 7469 6f6e  t(disambiguation
+00031ab0: 297d 2229 0a20 2020 2023 2066 6972 7374  )}").    # first
+00031ac0: 2c20 7472 7920 746f 2064 6973 616d 6269  , try to disambi
+00031ad0: 6775 6174 6520 6261 7365 6420 6f6e 2074  guate based on t
+00031ae0: 6865 2066 696c 6573 2720 7375 622d 6469  he files' sub-di
+00031af0: 7265 6374 6f72 6965 730a 2020 2020 7375  rectories.    su
+00031b00: 6264 6972 7320 3d20 5b5d 0a20 2020 2066  bdirs = [].    f
+00031b10: 6f72 2066 2069 6e20 6669 6c65 733a 0a20  or f in files:. 
+00031b20: 2020 2020 2020 2066 696c 655f 7479 7065         file_type
+00031b30: 203d 2066 2e74 7970 650a 2020 2020 2020   = f.type.      
+00031b40: 2020 7375 6264 6972 203d 2066 2e73 7562    subdir = f.sub
+00031b50: 6469 722e 7374 7269 7028 7222 5c2f 2e22  dir.strip(r"\/."
+00031b60: 290a 2020 2020 2020 2020 6966 2073 7562  ).        if sub
+00031b70: 6469 722e 7374 6172 7473 7769 7468 2866  dir.startswith(f
+00031b80: 696c 655f 7479 7065 293a 0a20 2020 2020  ile_type):.     
+00031b90: 2020 2020 2020 2073 7562 6469 7220 3d20         subdir = 
+00031ba0: 7375 6264 6972 5b6c 656e 2866 696c 655f  subdir[len(file_
+00031bb0: 7479 7065 293a 5d0a 2020 2020 2020 2020  type):].        
+00031bc0: 6966 2073 7562 6469 722e 7374 7269 7028  if subdir.strip(
+00031bd0: 7222 5c2f 2229 203d 3d20 2727 3a0a 2020  r"\/") == '':.  
+00031be0: 2020 2020 2020 2020 2020 7375 6264 6972            subdir
+00031bf0: 203d 2027 270a 2020 2020 2020 2020 7375   = ''.        su
+00031c00: 6264 6972 732e 6170 7065 6e64 2873 7562  bdirs.append(sub
+00031c10: 6469 7229 0a20 2020 2069 6620 6c65 6e28  dir).    if len(
+00031c20: 7365 7428 7375 6264 6972 7329 2920 3e20  set(subdirs)) > 
+00031c30: 313a 0a20 2020 2020 2020 2023 2066 696c  1:.        # fil
+00031c40: 6573 2063 616e 2028 7061 7274 6961 6c6c  es can (partiall
+00031c50: 7929 2062 6520 6469 7361 6d62 6967 7561  y) be disambigua
+00031c60: 7465 6420 6265 6361 7573 6520 7468 6579  ted because they
+00031c70: 2061 7265 2069 6e20 6469 6666 6572 656e   are in differen
+00031c80: 7420 7375 622d 6469 7265 6374 6f72 6965  t sub-directorie
+00031c90: 730a 2020 2020 2020 2020 6966 2069 6e63  s.        if inc
+00031ca0: 6c75 6465 5f64 6973 616d 6269 6775 6174  lude_disambiguat
+00031cb0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+00031cc0: 6469 7361 6d62 6967 7561 7469 6f6e 203d  disambiguation =
+00031cd0: 205b 6622 7375 6264 6972 3a20 7b27 2e27   [f"subdir: {'.'
+00031ce0: 2069 6620 7375 6264 6972 203d 3d20 2727   if subdir == ''
+00031cf0: 2065 6c73 6520 7375 6264 6972 7d22 2066   else subdir}" f
+00031d00: 6f72 2064 6973 616d 622c 2073 7562 6469  or disamb, subdi
+00031d10: 7220 696e 207a 6970 2864 6973 616d 6269  r in zip(disambi
+00031d20: 6775 6174 696f 6e2c 2073 7562 6469 7273  guation, subdirs
+00031d30: 295d 0a20 2020 2020 2020 2065 6c73 653a  )].        else:
+00031d40: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
+00031d50: 616d 6269 6775 6174 696f 6e20 3d20 5b6f  ambiguation = [o
+00031d60: 732e 7061 7468 2e6a 6f69 6e28 6469 7361  s.path.join(disa
+00031d70: 6d62 2c20 7375 6264 6972 2920 666f 7220  mb, subdir) for 
+00031d80: 6469 7361 6d62 2c20 7375 6264 6972 2069  disamb, subdir i
+00031d90: 6e20 7a69 7028 6469 7361 6d62 6967 7561  n zip(disambigua
+00031da0: 7469 6f6e 2c20 7375 6264 6972 7329 5d0a  tion, subdirs)].
+00031db0: 2020 2020 6966 206c 656e 2873 6574 2864      if len(set(d
+00031dc0: 6973 616d 6269 6775 6174 696f 6e29 2920  isambiguation)) 
+00031dd0: 3d3d 206e 5f66 696c 6573 3a0a 2020 2020  == n_files:.    
+00031de0: 2020 2020 2320 646f 6e65 2064 6973 616d      # done disam
+00031df0: 6269 6775 6174 696e 670a 2020 2020 2020  biguating.      
+00031e00: 2020 7265 7475 726e 2064 6963 7428 7a69    return dict(zi
+00031e10: 7028 6469 7361 6d62 6967 7561 7469 6f6e  p(disambiguation
+00031e20: 2c20 6669 6c65 7329 290a 2020 2020 2320  , files)).    # 
+00031e30: 6e65 7874 2c20 7472 7920 6164 6469 6e67  next, try adding
+00031e40: 2064 6574 6563 7465 6420 7375 6666 6978   detected suffix
+00031e50: 6573 0a20 2020 2066 6f72 2069 782c 2066  es.    for ix, f
+00031e60: 2069 6e20 656e 756d 6572 6174 6528 6669   in enumerate(fi
+00031e70: 6c65 7329 3a0a 2020 2020 2020 2020 6966  les):.        if
+00031e80: 2066 2e73 7566 6669 7820 213d 2027 273a   f.suffix != '':
+00031e90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00031ea0: 696e 636c 7564 655f 6469 7361 6d62 6967  include_disambig
+00031eb0: 7561 746f 723a 0a20 2020 2020 2020 2020  uator:.         
+00031ec0: 2020 2020 2020 2064 6973 616d 6269 6775         disambigu
+00031ed0: 6174 696f 6e5b 6978 5d20 2b3d 2066 222c  ation[ix] += f",
+00031ee0: 2073 7566 6669 783a 207b 662e 7375 6666   suffix: {f.suff
+00031ef0: 6978 7d22 0a20 2020 2020 2020 2020 2020  ix}".           
+00031f00: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00031f10: 2020 2020 2020 2064 6973 616d 6269 6775         disambigu
+00031f20: 6174 696f 6e5b 6978 5d20 2b3d 2066 225b  ation[ix] += f"[
+00031f30: 7b66 2e73 7566 6669 787d 5d22 0a20 2020  {f.suffix}]".   
+00031f40: 2069 6620 6c65 6e28 7365 7428 6469 7361   if len(set(disa
+00031f50: 6d62 6967 7561 7469 6f6e 2929 203d 3d20  mbiguation)) == 
+00031f60: 6e5f 6669 6c65 733a 0a20 2020 2020 2020  n_files:.       
+00031f70: 2023 2064 6f6e 6520 6469 7361 6d62 6967   # done disambig
+00031f80: 7561 7469 6e67 0a20 2020 2020 2020 2072  uating.        r
+00031f90: 6574 7572 6e20 6469 6374 287a 6970 2864  eturn dict(zip(d
+00031fa0: 6973 616d 6269 6775 6174 696f 6e2c 2066  isambiguation, f
+00031fb0: 696c 6573 2929 0a20 2020 2023 206e 6f77  iles)).    # now
+00031fc0: 2c20 6164 6420 6669 6c65 2065 7874 656e  , add file exten
+00031fd0: 7369 6f6e 7320 746f 2064 6973 616d 6269  sions to disambi
+00031fe0: 6775 6174 6520 6675 7274 6865 720a 2020  guate further.  
+00031ff0: 2020 6966 206c 656e 2873 6574 2866 2e66    if len(set(f.f
+00032000: 6578 7420 666f 7220 6620 696e 2066 696c  ext for f in fil
+00032010: 6573 2929 203e 2031 3a0a 2020 2020 2020  es)) > 1:.      
+00032020: 2020 666f 7220 6978 2c20 6620 696e 2065    for ix, f in e
+00032030: 6e75 6d65 7261 7465 2866 696c 6573 293a  numerate(files):
+00032040: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00032050: 696e 636c 7564 655f 6469 7361 6d62 6967  include_disambig
+00032060: 7561 746f 723a 0a20 2020 2020 2020 2020  uator:.         
+00032070: 2020 2020 2020 2064 6973 616d 6269 6775         disambigu
+00032080: 6174 696f 6e5b 6978 5d20 2b3d 2066 222c  ation[ix] += f",
+00032090: 2066 6578 743a 207b 662e 6665 7874 7d22   fext: {f.fext}"
+000320a0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000320b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000320c0: 2020 2064 6973 616d 6269 6775 6174 696f     disambiguatio
+000320d0: 6e5b 6978 5d20 2b3d 2066 2e66 6578 740a  n[ix] += f.fext.
+000320e0: 2020 2020 6966 206c 656e 2873 6574 2864      if len(set(d
+000320f0: 6973 616d 6269 6775 6174 696f 6e29 2920  isambiguation)) 
+00032100: 3d3d 206e 5f66 696c 6573 3a0a 2020 2020  == n_files:.    
+00032110: 2020 2020 2320 646f 6e65 2064 6973 616d      # done disam
+00032120: 6269 6775 6174 696e 670a 2020 2020 2020  biguating.      
+00032130: 2020 7265 7475 726e 2064 6963 7428 7a69    return dict(zi
+00032140: 7028 6469 7361 6d62 6967 7561 7469 6f6e  p(disambiguation
+00032150: 2c20 6669 6c65 7329 290a 2020 2020 7374  , files)).    st
+00032160: 725f 636f 756e 7473 203d 2043 6f75 6e74  r_counts = Count
+00032170: 6572 2864 6973 616d 6269 6775 6174 696f  er(disambiguatio
+00032180: 6e29 0a20 2020 2064 7570 6c69 6361 7465  n).    duplicate
+00032190: 5f64 6973 616d 6269 6775 6174 696f 6e5f  _disambiguation_
+000321a0: 7374 7269 6e67 7320 3d20 5b73 2066 6f72  strings = [s for
+000321b0: 2073 2c20 636e 7420 696e 2073 7472 5f63   s, cnt in str_c
+000321c0: 6f75 6e74 732e 6974 656d 7328 2920 6966  ounts.items() if
+000321d0: 2063 6e74 203e 2031 5d0a 2020 2020 616d   cnt > 1].    am
+000321e0: 6269 6775 6174 655f 6669 6c65 7320 3d20  biguate_files = 
+000321f0: 7b73 3a20 5b66 2066 6f72 2064 6973 616d  {s: [f for disam
+00032200: 622c 2066 2069 6e20 7a69 7028 6469 7361  b, f in zip(disa
+00032210: 6d62 6967 7561 7469 6f6e 2c20 6669 6c65  mbiguation, file
+00032220: 7329 2069 6620 6469 7361 6d62 203d 3d20  s) if disamb == 
+00032230: 735d 2066 6f72 2073 2069 6e20 6475 706c  s] for s in dupl
+00032240: 6963 6174 655f 6469 7361 6d62 6967 7561  icate_disambigua
+00032250: 7469 6f6e 5f73 7472 696e 6773 7d0a 2020  tion_strings}.  
+00032260: 2020 7265 7375 6c74 203d 2064 6963 7428    result = dict(
+00032270: 7a69 7028 6469 7361 6d62 6967 7561 7469  zip(disambiguati
+00032280: 6f6e 2c20 6669 6c65 7329 290a 2020 2020  on, files)).    
+00032290: 7265 6d61 696e 696e 675f 6f6e 6573 203d  remaining_ones =
+000322a0: 207b 733a 2072 6573 756c 745b 735d 2066   {s: result[s] f
+000322b0: 6f72 2073 2069 6e20 6475 706c 6963 6174  or s in duplicat
+000322c0: 655f 6469 7361 6d62 6967 7561 7469 6f6e  e_disambiguation
+000322d0: 5f73 7472 696e 6773 7d0a 2020 2020 6c6f  _strings}.    lo
+000322e0: 6767 6572 2e77 6172 6e69 6e67 2866 2254  gger.warning(f"T
+000322f0: 6865 2066 6f6c 6c6f 7769 6e67 2066 696c  he following fil
+00032300: 6573 2063 6f75 6c64 206e 6f74 2062 6520  es could not be 
+00032310: 616d 6269 6775 6174 6564 3a20 7b61 6d62  ambiguated: {amb
+00032320: 6967 7561 7465 5f66 696c 6573 7d2e 5c6e  iguate_files}.\n
+00032330: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00032340: 2020 2020 2066 2249 6e20 7468 6520 7265       f"In the re
+00032350: 7375 6c74 2c20 6f6e 6c79 2074 6865 7365  sult, only these
+00032360: 2072 656d 6169 6e3a 207b 7265 6d61 696e   remain: {remain
+00032370: 696e 675f 6f6e 6573 7d2e 2229 0a20 2020  ing_ones}.").   
+00032380: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
+00032390: 0a64 6566 206c 6974 6572 616c 5f74 7970  .def literal_typ
+000323a0: 6532 7475 706c 6528 7479 703a 2054 7970  e2tuple(typ: Typ
+000323b0: 6556 6172 2920 2d3e 2054 7570 6c65 5b73  eVar) -> Tuple[s
+000323c0: 7472 5d3a 0a20 2020 2022 2222 5475 726e  tr]:.    """Turn
+000323d0: 7320 7468 6520 6669 7273 7420 4c69 7465  s the first Lite
+000323e0: 7261 6c20 696e 636c 7564 6564 2069 6e20  ral included in 
+000323f0: 7468 6520 5479 7065 5661 7220 696e 746f  the TypeVar into
+00032400: 2061 206c 6973 7420 6f66 2076 616c 7565   a list of value
+00032410: 732e 2054 6865 2066 6972 7374 206c 6974  s. The first lit
+00032420: 6572 616c 2076 616c 7565 0a20 2020 206e  eral value.    n
+00032430: 6565 6473 2074 6f20 6265 2061 2073 7472  eeds to be a str
+00032440: 696e 672c 206f 7468 6572 7769 7365 2074  ing, otherwise t
+00032450: 6865 2066 756e 6374 696f 6e20 6d61 7920  he function may 
+00032460: 6c65 6164 2074 6f20 756e 6578 7065 6374  lead to unexpect
+00032470: 6564 2062 6568 6176 696f 7572 2e0a 2020  ed behaviour..  
+00032480: 2020 2222 220a 2020 2020 6966 2069 7369    """.    if isi
+00032490: 6e73 7461 6e63 6528 7479 702e 5f5f 6172  nstance(typ.__ar
+000324a0: 6773 5f5f 5b30 5d2c 2073 7472 293a 0a20  gs__[0], str):. 
+000324b0: 2020 2020 2020 2072 6574 7572 6e20 7479         return ty
+000324c0: 702e 5f5f 6172 6773 5f5f 0a20 2020 2072  p.__args__.    r
+000324d0: 6574 7572 6e20 6c69 7465 7261 6c5f 7479  eturn literal_ty
+000324e0: 7065 3274 7570 6c65 2874 7970 2e5f 5f61  pe2tuple(typ.__a
+000324f0: 7267 735f 5f5b 305d 290a 0a0a 406c 7275  rgs__[0])...@lru
+00032500: 5f63 6163 6865 0a40 6675 6e63 7469 6f6e  _cache.@function
+00032510: 5f6c 6f67 6765 720a 6465 6620 6172 6775  _logger.def argu
+00032520: 6d65 6e74 5f61 6e64 5f6c 6974 6572 616c  ment_and_literal
+00032530: 5f74 7970 6532 6c69 7374 2861 7267 756d  _type2list(argum
+00032540: 656e 743a 2055 6e69 6f6e 5b73 7472 2c20  ent: Union[str, 
+00032550: 5475 706c 655b 7374 725d 2c20 4c69 7465  Tuple[str], Lite
+00032560: 7261 6c5b 4e6f 6e65 5d5d 2c0a 2020 2020  ral[None]],.    
+00032570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032580: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00032590: 7970 3a20 4f70 7469 6f6e 616c 5b55 6e69  yp: Optional[Uni
+000325a0: 6f6e 5b54 7970 6556 6172 2c20 5475 706c  on[TypeVar, Tupl
+000325b0: 655b 7374 725d 5d5d 203d 204e 6f6e 652c  e[str]]] = None,
+000325c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000325d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000325e0: 2020 2020 6e6f 6e65 5f6d 6561 6e73 5f61      none_means_a
+000325f0: 6c6c 3a20 626f 6f6c 203d 2054 7275 652c  ll: bool = True,
+00032600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032620: 2020 2020 2920 2d3e 204f 7074 696f 6e61      ) -> Optiona
+00032630: 6c5b 4c69 7374 5b73 7472 5d5d 3a0a 2020  l[List[str]]:.  
+00032640: 2020 2222 2220 4d61 6b65 7320 7375 7265    """ Makes sure
+00032650: 2074 6861 7420 616e 2069 6e70 7574 2076   that an input v
+00032660: 616c 7565 2069 7320 6120 6c69 7374 206f  alue is a list o
+00032670: 6620 7374 7269 6e67 7320 616e 6420 7468  f strings and th
+00032680: 6174 2061 6c6c 2073 7472 696e 6773 2061  at all strings a
+00032690: 7265 2076 616c 6964 2077 2e72 2e74 2e20  re valid w.r.t. 
+000326a0: 746f 0a20 2020 2074 6865 2074 7970 6527  to.    the type'
+000326b0: 7320 6578 7065 6374 6564 206c 6974 6572  s expected liter
+000326c0: 616c 2076 616c 7565 7320 2873 7472 696e  al values (strin
+000326d0: 6773 292e 0a0a 2020 2020 4172 6773 3a0a  gs)...    Args:.
+000326e0: 2020 2020 2020 6172 6775 6d65 6e74 3a0a        argument:.
+000326f0: 2020 2020 2020 2020 2020 4966 2073 7472            If str
+00032700: 696e 672c 2077 7261 7070 6564 2069 6e20  ing, wrapped in 
+00032710: 6120 6c69 7374 2c20 6f74 6865 7277 6973  a list, otherwis
+00032720: 6520 6578 7065 6374 6564 2074 6f20 6265  e expected to be
+00032730: 2061 2074 7570 6c65 206f 6620 7374 7269   a tuple of stri
+00032740: 6e67 7320 2870 6173 7369 6e67 2061 206c  ngs (passing a l
+00032750: 6973 7420 7769 6c6c 2066 6169 6c29 2e0a  ist will fail)..
+00032760: 2020 2020 2020 2020 2020 4966 204e 6f6e            If Non
+00032770: 652c 2061 206c 6973 7420 6f66 2061 6c6c  e, a list of all
+00032780: 2070 6f73 7369 626c 6520 7661 6c75 6573   possible values
+00032790: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
+000327a0: 6520 7479 7065 2069 7320 7265 7475 726e  e type is return
+000327b0: 6564 2069 6620 6e6f 6e65 5f6d 6561 6e73  ed if none_means
+000327c0: 5f61 6c6c 2e0a 2020 2020 2020 7479 703a  _all..      typ:
+000327d0: 0a20 2020 2020 2020 2020 2041 2074 7970  .          A typ
+000327e0: 696e 672e 4c69 7465 7261 6c20 6465 636c  ing.Literal decl
+000327f0: 6172 6174 696f 6e20 6f72 2061 2054 7970  aration or a Typ
+00032800: 6556 6172 2077 6865 7265 2074 6865 2066  eVar where the f
+00032810: 6972 7374 2063 6f6d 706f 6e65 6e74 2069  irst component i
+00032820: 7320 6f6e 652c 206f 7220 6120 7475 706c  s one, or a tupl
+00032830: 6520 6f66 2061 6c6c 6f77 6564 2076 616c  e of allowed val
+00032840: 7565 732e 0a20 2020 2020 2020 2020 2041  ues..          A
+00032850: 6c6c 2061 6c6c 6f77 6564 2076 616c 7565  ll allowed value
+00032860: 7320 7368 6f75 6c64 2062 6520 7374 7269  s should be stri
+00032870: 6e67 732e 0a20 2020 2020 206e 6f6e 655f  ngs..      none_
+00032880: 6d65 616e 735f 616c 6c3a 0a20 2020 2020  means_all:.     
+00032890: 2020 2020 2042 7920 6465 6661 756c 742c       By default,
+000328a0: 204e 6f6e 6520 7661 6c75 6573 2061 7265   None values are
+000328b0: 2072 6570 6c61 6365 6420 7769 7468 2061   replaced with a
+000328c0: 6c6c 2061 6c6c 6f77 6564 2076 616c 7565  ll allowed value
+000328d0: 732c 2069 6620 7370 6563 6966 6965 642e  s, if specified.
+000328e0: 0a20 2020 2020 2020 2020 2050 6173 7320  .          Pass 
+000328f0: 4661 6c73 6520 746f 2072 6574 7572 6e20  False to return 
+00032900: 4e6f 6e65 2069 6e20 7468 6973 2063 6173  None in this cas
+00032910: 652e 0a0a 2020 2020 5265 7475 726e 733a  e...    Returns:
+00032920: 0a20 2020 2020 2054 6865 206c 6973 7420  .      The list 
+00032930: 6f66 2061 6363 6570 7465 6420 7374 7269  of accepted stri
+00032940: 6e67 732e 0a20 2020 2020 2054 6865 206c  ngs..      The l
+00032950: 6973 7420 6f66 2072 656a 6563 7465 6420  ist of rejected 
+00032960: 7374 7269 6e67 732e 0a20 2020 2022 2222  strings..    """
+00032970: 0a20 2020 2069 6620 7479 7020 6973 204e  .    if typ is N
+00032980: 6f6e 653a 0a20 2020 2020 2020 2061 6c6c  one:.        all
+00032990: 6f77 6564 203d 204e 6f6e 650a 2020 2020  owed = None.    
+000329a0: 656c 7365 3a0a 2020 2020 2020 2020 6966  else:.        if
+000329b0: 2069 7369 6e73 7461 6e63 6528 7479 702c   isinstance(typ,
+000329c0: 2074 7570 6c65 293a 0a20 2020 2020 2020   tuple):.       
+000329d0: 2020 2020 2061 6c6c 6f77 6564 203d 2074       allowed = t
+000329e0: 7970 0a20 2020 2020 2020 2065 6c73 653a  yp.        else:
+000329f0: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
+00032a00: 6f77 6564 203d 206c 6974 6572 616c 5f74  owed = literal_t
+00032a10: 7970 6532 7475 706c 6528 7479 7029 0a20  ype2tuple(typ). 
+00032a20: 2020 2069 6620 6172 6775 6d65 6e74 2069     if argument i
+00032a30: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00032a40: 6966 206e 6f6e 655f 6d65 616e 735f 616c  if none_means_al
+00032a50: 6c20 616e 6420 616c 6c6f 7765 6420 6973  l and allowed is
+00032a60: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00032a70: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
+00032a80: 7374 2861 6c6c 6f77 6564 290a 2020 2020  st(allowed).    
+00032a90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00032aa0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00032ab0: 2069 6620 6973 696e 7374 616e 6365 2861   if isinstance(a
+00032ac0: 7267 756d 656e 742c 2073 7472 293a 0a20  rgument, str):. 
+00032ad0: 2020 2020 2020 2061 7267 756d 656e 7420         argument 
+00032ae0: 3d20 5b61 7267 756d 656e 745d 0a20 2020  = [argument].   
+00032af0: 2069 6620 616c 6c6f 7765 6420 6973 204e   if allowed is N
+00032b00: 6f6e 653a 0a20 2020 2020 2020 2072 6574  one:.        ret
+00032b10: 7572 6e20 6172 6775 6d65 6e74 0a20 2020  urn argument.   
+00032b20: 2065 6c73 653a 0a20 2020 2020 2020 2073   else:.        s
+00032b30: 696e 6775 6c61 725f 6469 6374 203d 207b  ingular_dict = {
+00032b40: 616c 6c77 645b 3a2d 315d 3a20 616c 6c77  allwd[:-1]: allw
+00032b50: 6420 666f 7220 616c 6c77 6420 696e 2061  d for allwd in a
+00032b60: 6c6c 6f77 6564 7d0a 2020 2020 6163 6365  llowed}.    acce
+00032b70: 7074 6564 2c20 7265 6a65 6374 6564 203d  pted, rejected =
+00032b80: 205b 5d2c 205b 5d0a 2020 2020 666f 7220   [], [].    for 
+00032b90: 6172 6720 696e 2061 7267 756d 656e 743a  arg in argument:
+00032ba0: 0a20 2020 2020 2020 2069 6620 6172 6720  .        if arg 
+00032bb0: 696e 2061 6c6c 6f77 6564 3a0a 2020 2020  in allowed:.    
+00032bc0: 2020 2020 2020 2020 6163 6365 7074 6564          accepted
+00032bd0: 2e61 7070 656e 6428 6172 6729 0a20 2020  .append(arg).   
+00032be0: 2020 2020 2065 6c69 6620 6172 6720 696e       elif arg in
+00032bf0: 2073 696e 6775 6c61 725f 6469 6374 3a0a   singular_dict:.
+00032c00: 2020 2020 2020 2020 2020 2020 6163 6365              acce
+00032c10: 7074 6564 2e61 7070 656e 6428 7369 6e67  pted.append(sing
+00032c20: 756c 6172 5f64 6963 745b 6172 675d 290a  ular_dict[arg]).
+00032c30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00032c40: 2020 2020 2020 2020 2020 7265 6a65 6374            reject
+00032c50: 6564 2e61 7070 656e 6428 6172 6729 0a20  ed.append(arg). 
+00032c60: 2020 206e 5f72 656a 6563 7465 6420 3d20     n_rejected = 
+00032c70: 6c65 6e28 7265 6a65 6374 6564 290a 2020  len(rejected).  
+00032c80: 2020 6966 206e 5f72 656a 6563 7465 6420    if n_rejected 
+00032c90: 3e20 303a 0a20 2020 2020 2020 2069 6620  > 0:.        if 
+00032ca0: 6e5f 7265 6a65 6374 6564 203d 3d20 313a  n_rejected == 1:
+00032cb0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00032cc0: 6765 722e 7761 726e 696e 6728 6622 5468  ger.warning(f"Th
+00032cd0: 6973 2069 7320 6e6f 7420 616e 2061 6363  is is not an acc
+00032ce0: 6570 7465 6420 7661 6c75 653a 207b 7265  epted value: {re
+00032cf0: 6a65 6374 6564 5b30 5d7d 5c6e 220a 2020  jected[0]}\n".  
+00032d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032d10: 2020 2020 2020 2020 2066 2243 686f 6f73           f"Choos
+00032d20: 6520 6672 6f6d 207b 616c 6c6f 7765 647d  e from {allowed}
+00032d30: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
+00032d40: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00032d50: 6765 722e 7761 726e 696e 6728 6622 5468  ger.warning(f"Th
+00032d60: 6573 6520 6172 6520 6e6f 7420 6163 6365  ese are not acce
+00032d70: 7074 6564 2076 616c 7565 2c20 6f6e 6c79  pted value, only
+00032d80: 3a20 7b72 656a 6563 7465 647d 220a 2020  : {rejected}".  
+00032d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032da0: 2020 2020 2020 2020 2066 2243 686f 6f73           f"Choos
+00032db0: 6520 6672 6f6d 207b 616c 6c6f 7765 647d  e from {allowed}
+00032dc0: 2229 0a20 2020 2069 6620 6c65 6e28 6163  ").    if len(ac
+00032dd0: 6365 7074 6564 2920 3e20 303a 0a20 2020  cepted) > 0:.   
+00032de0: 2020 2020 2072 6574 7572 6e20 6163 6365       return acce
+00032df0: 7074 6564 0a20 2020 206c 6f67 6765 722e  pted.    logger.
+00032e00: 7761 726e 696e 6728 6622 5061 7373 2061  warning(f"Pass a
+00032e10: 7420 6c65 6173 7420 6f6e 6520 6f66 207b  t least one of {
+00032e20: 616c 6c6f 7765 647d 2e22 290a 2020 2020  allowed}.").    
+00032e30: 7265 7475 726e 0a0a 4c20 3d20 5479 7065  return..L = Type
+00032e40: 5661 7228 274c 2729 0a0a 4066 756e 6374  Var('L')..@funct
+00032e50: 696f 6e5f 6c6f 6767 6572 0a64 6566 2063  ion_logger.def c
+00032e60: 6865 636b 5f61 7267 756d 656e 745f 6167  heck_argument_ag
+00032e70: 6169 6e73 745f 6c69 7465 7261 6c5f 7479  ainst_literal_ty
+00032e80: 7065 2861 7267 756d 656e 743a 2073 7472  pe(argument: str
+00032e90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00032ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032eb0: 2020 2020 2020 2020 2020 7479 703a 204c            typ: L
+00032ec0: 2920 2d3e 204f 7074 696f 6e61 6c5b 4c5d  ) -> Optional[L]
+00032ed0: 3a0a 2020 2020 6966 206e 6f74 2069 7369  :.    if not isi
+00032ee0: 6e73 7461 6e63 6528 6172 6775 6d65 6e74  nstance(argument
+00032ef0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+00032f00: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
+00032f10: 2241 7267 756d 656e 7420 6e65 6564 7320  "Argument needs 
+00032f20: 746f 2062 6520 6120 7374 7269 6e67 2c20  to be a string, 
+00032f30: 6e6f 7420 277b 7479 7065 2861 7267 756d  not '{type(argum
+00032f40: 656e 7429 7d27 2229 0a20 2020 2020 2020  ent)}'").       
+00032f50: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+00032f60: 2061 6c6c 6f77 6564 203d 206c 6974 6572   allowed = liter
+00032f70: 616c 5f74 7970 6532 7475 706c 6528 7479  al_type2tuple(ty
+00032f80: 7029 0a20 2020 2073 696e 6775 6c61 725f  p).    singular_
+00032f90: 6469 6374 203d 207b 616c 6c77 645b 3a2d  dict = {allwd[:-
+00032fa0: 315d 3a20 616c 6c77 6420 666f 7220 616c  1]: allwd for al
+00032fb0: 6c77 6420 696e 2061 6c6c 6f77 6564 7d0a  lwd in allowed}.
+00032fc0: 2020 2020 6966 2061 7267 756d 656e 7420      if argument 
+00032fd0: 6e6f 7420 696e 2061 6c6c 6f77 6564 2061  not in allowed a
+00032fe0: 6e64 2061 7267 756d 656e 7420 6e6f 7420  nd argument not 
+00032ff0: 696e 2073 696e 6775 6c61 725f 6469 6374  in singular_dict
+00033000: 3a0a 2020 2020 2020 2020 6c6f 6767 6572  :.        logger
+00033010: 2e77 6172 6e69 6e67 2866 2249 6e76 616c  .warning(f"Inval
+00033020: 6964 2061 7267 756d 656e 7420 277b 6172  id argument '{ar
+00033030: 6775 6d65 6e74 7d27 2e20 5061 7373 206f  gument}'. Pass o
+00033040: 6e65 206f 6620 7b61 6c6c 6f77 6564 7d22  ne of {allowed}"
+00033050: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00033060: 204e 6f6e 650a 2020 2020 6966 2061 7267   None.    if arg
+00033070: 756d 656e 7420 696e 2073 696e 6775 6c61  ument in singula
+00033080: 725f 6469 6374 3a0a 2020 2020 2020 2020  r_dict:.        
+00033090: 7265 7475 726e 2073 696e 6775 6c61 725f  return singular_
+000330a0: 6469 6374 5b61 7267 756d 656e 745d 0a20  dict[argument]. 
+000330b0: 2020 2072 6574 7572 6e20 6172 6775 6d65     return argume
+000330c0: 6e74 0a0a 4066 756e 6374 696f 6e5f 6c6f  nt..@function_lo
+000330d0: 6767 6572 0a64 6566 2072 6573 6f6c 7665  gger.def resolve
+000330e0: 5f66 6163 6574 735f 7061 7261 6d28 6661  _facets_param(fa
+000330f0: 6365 7473 2c20 6661 6365 745f 7479 7065  cets, facet_type
+00033100: 5f76 6172 3a20 5479 7065 5661 7220 3d20  _var: TypeVar = 
+00033110: 4661 6365 742c 206e 6f6e 655f 6d65 616e  Facet, none_mean
+00033120: 735f 616c 6c3d 5472 7565 293a 0a20 2020  s_all=True):.   
+00033130: 2022 2222 4c69 6b65 203a 6675 6e63 3a60   """Like :func:`
+00033140: 6172 6775 6d65 6e74 5f61 6e64 5f6c 6974  argument_and_lit
+00033150: 6572 616c 5f74 7970 6532 6c69 7374 602c  eral_type2list`,
+00033160: 2062 7574 2061 6c73 6f20 7265 736f 6c76   but also resolv
+00033170: 6573 2027 7473 7627 2074 6f20 616c 6c20  es 'tsv' to all 
+00033180: 6e6f 6e2d 7363 6f72 6520 6661 6365 7473  non-score facets
+00033190: 2e22 2222 0a20 2020 2069 6620 6973 696e  .""".    if isin
+000331a0: 7374 616e 6365 2866 6163 6574 732c 2073  stance(facets, s
+000331b0: 7472 2920 616e 6420 6661 6365 7473 2069  tr) and facets i
+000331c0: 6e20 2827 7473 7627 2c20 2774 7376 7327  n ('tsv', 'tsvs'
+000331d0: 293a 0a20 2020 2020 2020 2073 656c 6563  ):.        selec
+000331e0: 7465 645f 6661 6365 7473 203d 206c 6973  ted_facets = lis
+000331f0: 7428 6c69 7465 7261 6c5f 7479 7065 3274  t(literal_type2t
+00033200: 7570 6c65 2866 6163 6574 5f74 7970 655f  uple(facet_type_
+00033210: 7661 7229 290a 2020 2020 2020 2020 6966  var)).        if
+00033220: 2027 7363 6f72 6573 2720 696e 2073 656c   'scores' in sel
+00033230: 6563 7465 645f 6661 6365 7473 3a0a 2020  ected_facets:.  
+00033240: 2020 2020 2020 2020 2020 7365 6c65 6374            select
+00033250: 6564 5f66 6163 6574 732e 7265 6d6f 7665  ed_facets.remove
+00033260: 2827 7363 6f72 6573 2729 0a20 2020 2065  ('scores').    e
+00033270: 6c73 653a 0a20 2020 2020 2020 2069 6620  lse:.        if 
+00033280: 6973 696e 7374 616e 6365 2866 6163 6574  isinstance(facet
+00033290: 732c 206c 6973 7429 3a0a 2020 2020 2020  s, list):.      
+000332a0: 2020 2020 2020 6661 6365 7473 203d 2074        facets = t
+000332b0: 7570 6c65 2866 6163 6574 7329 0a20 2020  uple(facets).   
+000332c0: 2020 2020 2073 656c 6563 7465 645f 6661       selected_fa
+000332d0: 6365 7473 203d 2061 7267 756d 656e 745f  cets = argument_
+000332e0: 616e 645f 6c69 7465 7261 6c5f 7479 7065  and_literal_type
+000332f0: 326c 6973 7428 6661 6365 7473 2c20 6661  2list(facets, fa
+00033300: 6365 745f 7479 7065 5f76 6172 2c20 6e6f  cet_type_var, no
+00033310: 6e65 5f6d 6561 6e73 5f61 6c6c 3d6e 6f6e  ne_means_all=non
+00033320: 655f 6d65 616e 735f 616c 6c2c 206c 6f67  e_means_all, log
+00033330: 6765 723d 6c6f 6767 6572 290a 2020 2020  ger=logger).    
+00033340: 236c 6f67 6765 722e 6465 6275 6728 6622  #logger.debug(f"
+00033350: 5265 736f 6c76 6564 2061 7267 756d 656e  Resolved argumen
+00033360: 7420 277b 6661 6365 7473 7d27 2074 6f20  t '{facets}' to 
+00033370: 7b73 656c 6563 7465 645f 6661 6365 7473  {selected_facets
+00033380: 7d2e 2229 0a20 2020 2072 6574 7572 6e20  }.").    return 
+00033390: 7365 6c65 6374 6564 5f66 6163 6574 730a  selected_facets.
+000333a0: 0a64 6566 2062 6f6c 645f 666f 6e74 2873  .def bold_font(s
+000333b0: 293a 0a20 2020 2072 6574 7572 6e20 6622  ):.    return f"
+000333c0: 5c30 3333 5b31 6d7b 737d 5c30 3333 5b30  \033[1m{s}\033[0
+000333d0: 3b30 6d22 0a0a 6465 6620 6176 6169 6c61  ;0m"..def availa
+000333e0: 626c 655f 7669 6577 7332 7374 7228 7669  ble_views2str(vi
+000333f0: 6577 735f 6469 6374 3a20 5669 6577 4469  ews_dict: ViewDi
+00033400: 6374 2c20 6163 7469 7665 5f76 6965 775f  ct, active_view_
+00033410: 6e61 6d65 3a20 7374 7220 3d20 4e6f 6e65  name: str = None
+00033420: 2920 2d3e 2073 7472 3a0a 2020 2020 7669  ) -> str:.    vi
+00033430: 6577 5f6e 616d 6573 203d 207b 6b65 793a  ew_names = {key:
+00033440: 2076 6965 772e 6e61 6d65 2069 6620 6b65   view.name if ke
+00033450: 7920 6973 204e 6f6e 6520 656c 7365 206b  y is None else k
+00033460: 6579 2066 6f72 206b 6579 2c20 7669 6577  ey for key, view
+00033470: 2069 6e20 7669 6577 735f 6469 6374 2e69   in views_dict.i
+00033480: 7465 6d73 2829 7d0a 2020 2020 6375 7272  tems()}.    curr
+00033490: 656e 745f 7669 6577 203d 2076 6965 775f  ent_view = view_
+000334a0: 6e61 6d65 735b 6163 7469 7665 5f76 6965  names[active_vie
+000334b0: 775f 6e61 6d65 5d0a 2020 2020 7669 6577  w_name].    view
+000334c0: 5f6c 6973 7420 3d20 5b62 6f6c 645f 666f  _list = [bold_fo
+000334d0: 6e74 2863 7572 7265 6e74 5f76 6965 7729  nt(current_view)
+000334e0: 5d20 2b20 5b6e 616d 6520 666f 7220 6e61  ] + [name for na
+000334f0: 6d65 2069 6e20 7669 6577 5f6e 616d 6573  me in view_names
+00033500: 2e76 616c 7565 7328 2920 6966 206e 616d  .values() if nam
+00033510: 6520 213d 2063 7572 7265 6e74 5f76 6965  e != current_vie
+00033520: 775d 0a20 2020 2072 6574 7572 6e20 6622  w].    return f"
+00033530: 5b7b 277c 272e 6a6f 696e 2876 6965 775f  [{'|'.join(view_
+00033540: 6c69 7374 297d 5d5c 6e22 0a0a 0a40 6675  list)}]\n"...@fu
+00033550: 6e63 7469 6f6e 5f6c 6f67 6765 720a 6465  nction_logger.de
+00033560: 6620 756e 7061 636b 5f6a 736f 6e5f 7061  f unpack_json_pa
+00033570: 7468 7328 7061 7468 733a 2043 6f6c 6c65  ths(paths: Colle
+00033580: 6374 696f 6e5b 7374 725d 2920 2d3e 204e  ction[str]) -> N
+00033590: 6f6e 653a 0a20 2020 2022 2222 4d75 7461  one:.    """Muta
+000335a0: 7465 7320 7468 6520 6c69 7374 2077 6974  tes the list wit
+000335b0: 6820 7061 7468 7320 6279 2072 6570 6c61  h paths by repla
+000335c0: 6369 6e67 202e 6a73 6f6e 2066 696c 6573  cing .json files
+000335d0: 2077 6974 6820 7468 6520 6c69 7374 2028   with the list (
+000335e0: 6f66 2070 6174 6873 2920 636f 6e74 6169  of paths) contai
+000335f0: 6e65 6420 696e 2074 6865 6d2e 2222 220a  ned in them.""".
+00033600: 2020 2020 6a73 6f6e 5f69 7873 203d 205b      json_ixs = [
+00033610: 6920 666f 7220 692c 2070 2069 6e20 656e  i for i, p in en
+00033620: 756d 6572 6174 6528 7061 7468 7329 2069  umerate(paths) i
+00033630: 6620 702e 656e 6473 7769 7468 2827 2e6a  f p.endswith('.j
+00033640: 736f 6e27 295d 0a20 2020 2069 6620 6c65  son')].    if le
+00033650: 6e28 6a73 6f6e 5f69 7873 2920 3e20 303a  n(json_ixs) > 0:
+00033660: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
+00033670: 6e20 7265 7665 7273 6564 286a 736f 6e5f  n reversed(json_
+00033680: 6978 7329 3a0a 2020 2020 2020 2020 2020  ixs):.          
+00033690: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000336a0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+000336b0: 2870 6174 6873 5b69 5d29 2061 7320 663a  (paths[i]) as f:
+000336c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000336d0: 2020 2020 206c 6f61 6465 645f 7061 7468       loaded_path
+000336e0: 7320 3d20 6a73 6f6e 2e6c 6f61 6428 6629  s = json.load(f)
+000336f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033700: 2070 6174 6873 2e65 7874 656e 6428 6c6f   paths.extend(lo
+00033710: 6164 6564 5f70 6174 6873 290a 2020 2020  aded_paths).    
+00033720: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00033730: 6572 2e69 6e66 6f28 6622 556e 7061 636b  er.info(f"Unpack
+00033740: 6564 2074 6865 207b 6c65 6e28 6c6f 6164  ed the {len(load
+00033750: 6564 5f70 6174 6873 297d 2070 6174 6873  ed_paths)} paths
+00033760: 2066 6f75 6e64 2069 6e20 7b70 6174 6873   found in {paths
+00033770: 5b69 5d7d 2e22 290a 2020 2020 2020 2020  [i]}.").        
+00033780: 2020 2020 2020 2020 6465 6c20 2870 6174          del (pat
+00033790: 6873 5b69 5d29 0a20 2020 2020 2020 2020  hs[i]).         
+000337a0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+000337b0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+000337c0: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+000337d0: 2866 2243 6f75 6c64 206e 6f74 206c 6f61  (f"Could not loa
+000337e0: 6420 7061 7468 7320 6672 6f6d 207b 7061  d paths from {pa
+000337f0: 7468 735b 695d 7d20 6265 6361 7573 6520  ths[i]} because 
+00033800: 6f66 2074 6865 2066 6f6c 6c6f 7769 6e67  of the following
+00033810: 2065 7272 6f72 2873 293a 5c6e 7b73 7973   error(s):\n{sys
+00033820: 2e65 7863 5f69 6e66 6f28 295b 315d 7d22  .exc_info()[1]}"
+00033830: 290a 0a0a 4066 756e 6374 696f 6e5f 6c6f  )...@function_lo
+00033840: 6767 6572 0a64 6566 2072 6573 6f6c 7665  gger.def resolve
+00033850: 5f70 6174 6873 5f61 7267 756d 656e 7428  _paths_argument(
+00033860: 7061 7468 733a 2055 6e69 6f6e 5b73 7472  paths: Union[str
+00033870: 2c20 436f 6c6c 6563 7469 6f6e 5b73 7472  , Collection[str
+00033880: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
+00033890: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000338a0: 696c 6573 3a20 626f 6f6c 203d 2054 7275  iles: bool = Tru
+000338b0: 6529 202d 3e20 4c69 7374 5b73 7472 5d3a  e) -> List[str]:
+000338c0: 0a20 2020 2022 2222 204d 616b 6573 2073  .    """ Makes s
+000338d0: 7572 6520 7468 6174 2074 6865 2067 6976  ure that the giv
+000338e0: 656e 2070 6174 6828 7329 2065 7869 7374  en path(s) exist
+000338f0: 7328 7329 2061 6e64 2066 696c 7465 7273  s(s) and filters
+00033900: 206f 7574 2074 686f 7365 2074 6861 7420   out those that 
+00033910: 646f 6e27 742e 0a0a 2020 2020 4172 6773  don't...    Args
+00033920: 3a0a 2020 2020 2020 7061 7468 733a 204f  :.      paths: O
+00033930: 6e65 206f 7220 7365 7665 7261 6c20 7061  ne or several pa
+00033940: 7468 7320 6769 7665 6e20 6173 2073 7472  ths given as str
+00033950: 696e 6773 2e0a 2020 2020 2020 6669 6c65  ings..      file
+00033960: 733a 2042 7920 6465 6661 756c 742c 206f  s: By default, o
+00033970: 6e6c 7920 6669 6c65 2070 6174 6873 2061  nly file paths a
+00033980: 7265 2072 6574 7572 6e65 642e 2053 6574  re returned. Set
+00033990: 2074 6f20 4661 6c73 6520 746f 2072 6574   to False to ret
+000339a0: 7572 6e20 6f6e 6c79 2066 6f6c 6465 7273  urn only folders
+000339b0: 2e0a 0a20 2020 2052 6574 7572 6e73 3a0a  ...    Returns:.
+000339c0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+000339d0: 6973 696e 7374 616e 6365 2870 6174 6873  isinstance(paths
+000339e0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+000339f0: 7061 7468 7320 3d20 5b70 6174 6873 5d0a  paths = [paths].
+00033a00: 2020 2020 7265 736f 6c76 6564 5f70 6174      resolved_pat
+00033a10: 6873 203d 205b 7265 736f 6c76 655f 6469  hs = [resolve_di
+00033a20: 7228 7029 2066 6f72 2070 2069 6e20 7061  r(p) for p in pa
+00033a30: 7468 735d 0a20 2020 2069 6620 6669 6c65  ths].    if file
+00033a40: 733a 0a20 2020 2020 2020 206e 6f74 5f61  s:.        not_a
+00033a50: 5f66 696c 6520 3d20 5b70 2066 6f72 2070  _file = [p for p
+00033a60: 2069 6e20 7265 736f 6c76 6564 5f70 6174   in resolved_pat
+00033a70: 6873 2069 6620 6e6f 7420 6f73 2e70 6174  hs if not os.pat
+00033a80: 682e 6973 6669 6c65 2870 295d 0a20 2020  h.isfile(p)].   
+00033a90: 2020 2020 2069 6620 6c65 6e28 6e6f 745f       if len(not_
+00033aa0: 615f 6669 6c65 2920 3e20 303a 0a20 2020  a_file) > 0:.   
+00033ab0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00033ac0: 6e6f 745f 615f 6669 6c65 2920 3d3d 2031  not_a_file) == 1
+00033ad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00033ae0: 2020 6d73 6720 3d20 6622 4e6f 2065 7869    msg = f"No exi
+00033af0: 7374 696e 6720 6669 6c65 2061 7420 7b6e  sting file at {n
+00033b00: 6f74 5f61 5f66 696c 655b 305d 7d2e 220a  ot_a_file[0]}.".
+00033b10: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00033b20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00033b30: 2020 6d73 6720 3d20 6622 5468 6573 6520    msg = f"These 
+00033b40: 6172 6520 6e6f 7420 7061 7468 7320 6f66  are not paths of
+00033b50: 2065 7869 7374 696e 6720 6669 6c65 733a   existing files:
+00033b60: 207b 6e6f 745f 615f 6669 6c65 7d22 0a20   {not_a_file}". 
+00033b70: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00033b80: 722e 7761 726e 696e 6728 6d73 6729 0a20  r.warning(msg). 
+00033b90: 2020 2020 2020 2020 2020 2072 6573 6f6c             resol
+00033ba0: 7665 645f 7061 7468 7320 3d20 5b70 2066  ved_paths = [p f
+00033bb0: 6f72 2070 2069 6e20 7265 736f 6c76 6564  or p in resolved
+00033bc0: 5f70 6174 6873 2069 6620 6f73 2e70 6174  _paths if os.pat
+00033bd0: 682e 6973 6669 6c65 2870 295d 0a20 2020  h.isfile(p)].   
+00033be0: 2065 6c73 653a 0a20 2020 2020 2020 206e   else:.        n
+00033bf0: 6f74 5f61 5f66 6f6c 6465 7220 3d20 5b70  ot_a_folder = [p
+00033c00: 2066 6f72 2070 2069 6e20 7265 736f 6c76   for p in resolv
+00033c10: 6564 5f70 6174 6873 2069 6620 6e6f 7420  ed_paths if not 
+00033c20: 6f73 2e70 6174 682e 6973 6469 7228 7029  os.path.isdir(p)
+00033c30: 5d0a 2020 2020 2020 2020 6966 206c 656e  ].        if len
+00033c40: 286e 6f74 5f61 5f66 6f6c 6465 7229 203e  (not_a_folder) >
+00033c50: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00033c60: 6966 206c 656e 286e 6f74 5f61 5f66 6f6c  if len(not_a_fol
+00033c70: 6465 7229 203d 3d20 313a 0a20 2020 2020  der) == 1:.     
+00033c80: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
+00033c90: 2066 227b 6e6f 745f 615f 666f 6c64 6572   f"{not_a_folder
+00033ca0: 5b30 5d7d 2069 7320 6e6f 7420 6120 7061  [0]} is not a pa
+00033cb0: 7468 2074 6f20 616e 2065 7869 7374 696e  th to an existin
+00033cc0: 6720 666f 6c64 6572 2e22 0a20 2020 2020  g folder.".     
+00033cd0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00033ce0: 2020 2020 2020 2020 2020 2020 206d 7367               msg
+00033cf0: 203d 2066 2254 6865 7365 2061 7265 206e   = f"These are n
+00033d00: 6f74 2070 6174 6873 206f 6620 6578 6973  ot paths of exis
+00033d10: 7469 6e67 2066 6f6c 6465 7273 3a20 7b6e  ting folders: {n
+00033d20: 6f74 5f61 5f66 6f6c 6465 727d 220a 2020  ot_a_folder}".  
+00033d30: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00033d40: 2e77 6172 6e69 6e67 286d 7367 290a 2020  .warning(msg).  
+00033d50: 2020 2020 2020 2020 2020 7265 736f 6c76            resolv
+00033d60: 6564 5f70 6174 6873 203d 205b 7020 666f  ed_paths = [p fo
+00033d70: 7220 7020 696e 2072 6573 6f6c 7665 645f  r p in resolved_
+00033d80: 7061 7468 7320 6966 206f 732e 7061 7468  paths if os.path
+00033d90: 2e69 7364 6972 2870 295d 0a20 2020 2072  .isdir(p)].    r
+00033da0: 6574 7572 6e20 7265 736f 6c76 6564 5f70  eturn resolved_p
+00033db0: 6174 6873 0a0a 4066 756e 6374 696f 6e5f  aths..@function_
+00033dc0: 6c6f 6767 6572 0a64 6566 2063 6f6d 7075  logger.def compu
+00033dd0: 7465 5f70 6174 685f 6672 6f6d 5f66 696c  te_path_from_fil
+00033de0: 6528 6669 6c65 3a20 4669 6c65 2c0a 2020  e(file: File,.  
+00033df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033e00: 2020 2020 2020 2020 2072 6f6f 745f 6469           root_di
+00033e10: 723a 204f 7074 696f 6e61 6c5b 7374 725d  r: Optional[str]
+00033e20: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00033e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033e40: 2020 2020 666f 6c64 6572 3a20 4f70 7469      folder: Opti
+00033e50: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+00033e60: 2920 2d3e 2073 7472 3a0a 2020 2020 2222  ) -> str:.    ""
+00033e70: 220a 2020 2020 436f 6e73 7472 7563 7473  ".    Constructs
+00033e80: 2061 2070 6174 6820 6261 7365 6420 6f6e   a path based on
+00033e90: 2074 6865 2061 7267 756d 656e 7473 2e0a   the arguments..
+00033ea0: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
+00033eb0: 2066 696c 653a 2054 6869 7320 6675 6e63   file: This func
+00033ec0: 7469 6f6e 2075 7365 7320 7468 6520 6669  tion uses the fi
+00033ed0: 656c 6473 2063 6f72 7075 735f 7061 7468  elds corpus_path
+00033ee0: 2c20 7375 6264 6972 2c20 616e 6420 7479  , subdir, and ty
+00033ef0: 7065 2e0a 2020 2020 2020 726f 6f74 5f64  pe..      root_d
+00033f00: 6972 3a0a 2020 2020 2020 2020 2020 4465  ir:.          De
+00033f10: 6661 756c 7473 2074 6f20 4e6f 6e65 2c20  faults to None, 
+00033f20: 6d65 616e 696e 6720 7468 6174 2074 6865  meaning that the
+00033f30: 2070 6174 6820 6973 2063 6f6e 7374 7275   path is constru
+00033f40: 6374 6564 2062 6173 6564 206f 6e20 7468  cted based on th
+00033f50: 6520 636f 7270 7573 5f70 6174 682e 0a20  e corpus_path.. 
+00033f60: 2020 2020 2020 2020 2050 6173 7320 6120           Pass a 
+00033f70: 6469 7265 6374 6f72 7920 746f 2063 6f6e  directory to con
+00033f80: 7374 7275 6374 2074 6865 2070 6174 6820  struct the path 
+00033f90: 7265 6c61 7469 7665 2074 6f20 6974 2069  relative to it i
+00033fa0: 6e73 7465 6164 2e20 4966 2060 6066 6f6c  nstead. If ``fol
+00033fb0: 6465 7260 6020 6973 2061 6e20 6162 736f  der`` is an abso
+00033fc0: 6c75 7465 2070 6174 682c 0a20 2020 2020  lute path,.     
+00033fd0: 2020 2020 2060 6072 6f6f 745f 6469 7260       ``root_dir`
+00033fe0: 6020 6973 2069 676e 6f72 6564 2e0a 2020  ` is ignored..  
+00033ff0: 2020 2020 666f 6c64 6572 3a0a 2020 2020      folder:.    
+00034000: 2020 2020 2020 2a20 4966 2060 6066 6f6c        * If ``fol
+00034010: 6465 7260 6020 6973 204e 6f6e 6520 2864  der`` is None (d
+00034020: 6566 6175 6c74 292c 2074 6865 2066 696c  efault), the fil
+00034030: 6573 2720 7479 7065 2077 696c 6c20 6265  es' type will be
+00034040: 2061 7070 656e 6465 6420 746f 2074 6865   appended to the
+00034050: 2060 6072 6f6f 745f 6469 7260 602e 0a20   ``root_dir``.. 
+00034060: 2020 2020 2020 2020 202a 2049 6620 6060           * If ``
+00034070: 666f 6c64 6572 6060 2069 7320 616e 2061  folder`` is an a
+00034080: 6273 6f6c 7574 6520 7061 7468 2c20 6060  bsolute path, ``
+00034090: 726f 6f74 5f64 6972 6060 2077 696c 6c20  root_dir`` will 
+000340a0: 6265 2069 676e 6f72 6564 2e0a 2020 2020  be ignored..    
+000340b0: 2020 2020 2020 2a20 4966 2060 6066 6f6c        * If ``fol
+000340c0: 6465 7260 6020 6973 2061 2072 656c 6174  der`` is a relat
+000340d0: 6976 6520 7061 7468 2073 7461 7274 696e  ive path startin
+000340e0: 6720 7769 7468 2061 2064 6f74 2060 602e  g with a dot ``.
+000340f0: 6060 2074 6865 2072 656c 6174 6976 6520  `` the relative 
+00034100: 7061 7468 2069 7320 6170 7065 6e64 6564  path is appended
+00034110: 2074 6f20 7468 6520 6669 6c65 2773 2073   to the file's s
+00034120: 7562 6469 722e 0a20 2020 2020 2020 2020  ubdir..         
+00034130: 2020 2046 6f72 2065 7861 6d70 6c65 2c20     For example, 
+00034140: 6060 2e2e 5c6e 6f74 6573 6060 2077 696c  ``..\notes`` wil
+00034150: 6c20 7265 736f 6c76 6520 746f 2061 2073  l resolve to a s
+00034160: 6962 6c69 6e67 2064 6972 6563 746f 7279  ibling directory
+00034170: 206f 6620 7468 6520 6f6e 6520 7768 6572   of the one wher
+00034180: 6520 7468 6520 6060 6669 6c65 6060 2069  e the ``file`` i
+00034190: 7320 6c6f 6361 7465 642e 0a20 2020 2020  s located..     
+000341a0: 2020 2020 202a 2049 6620 6060 666f 6c64       * If ``fold
+000341b0: 6572 6060 2069 7320 6120 7265 6c61 7469  er`` is a relati
+000341c0: 7665 2070 6174 6820 7468 6174 2064 6f65  ve path that doe
+000341d0: 7320 6e6f 7420 6265 6769 6e20 7769 7468  s not begin with
+000341e0: 2061 2064 6f74 2060 602e 6060 2c20 6974   a dot ``.``, it
+000341f0: 2077 696c 6c20 6265 2061 7070 656e 6465   will be appende
+00034200: 6420 746f 2074 6865 0a20 2020 2020 2020  d to the.       
+00034210: 2020 2020 2060 6072 6f6f 745f 6469 7260       ``root_dir`
+00034220: 602e 0a20 2020 2020 2020 2020 202a 2049  `..          * I
+00034230: 6620 6060 666f 6c64 6572 6060 203d 3d20  f ``folder`` == 
+00034240: 2727 2028 656d 7074 7920 7374 7269 6e67  '' (empty string
+00034250: 292c 2074 6865 2072 6573 756c 7420 7769  ), the result wi
+00034260: 6c6c 2062 6520 6072 6f6f 745f 6469 7260  ll be `root_dir`
+00034270: 2e0a 0a20 2020 2052 6574 7572 6e73 3a0a  ...    Returns:.
+00034280: 2020 2020 2020 5468 6520 636f 6e73 7472        The constr
+00034290: 7563 7465 6420 6469 7265 6374 6f72 7920  ucted directory 
+000342a0: 7061 7468 2e0a 2020 2020 2222 220a 2020  path..    """.  
+000342b0: 2020 6966 2066 6f6c 6465 7220 6973 206e    if folder is n
+000342c0: 6f74 204e 6f6e 6520 616e 6420 286f 732e  ot None and (os.
+000342d0: 7061 7468 2e69 7361 6273 2866 6f6c 6465  path.isabs(folde
+000342e0: 7229 206f 7220 277e 2720 696e 2066 6f6c  r) or '~' in fol
+000342f0: 6465 7229 3a0a 2020 2020 2020 2020 666f  der):.        fo
+00034300: 6c64 6572 203d 2072 6573 6f6c 7665 5f64  lder = resolve_d
+00034310: 6972 2866 6f6c 6465 7229 0a20 2020 2020  ir(folder).     
+00034320: 2020 2070 6174 6820 3d20 666f 6c64 6572     path = folder
+00034330: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00034340: 2020 2072 6f6f 7420 3d20 6669 6c65 2e63     root = file.c
+00034350: 6f72 7075 735f 7061 7468 2069 6620 726f  orpus_path if ro
+00034360: 6f74 5f64 6972 2069 7320 4e6f 6e65 2065  ot_dir is None e
+00034370: 6c73 6520 7265 736f 6c76 655f 6469 7228  lse resolve_dir(
+00034380: 726f 6f74 5f64 6972 290a 2020 2020 2020  root_dir).      
+00034390: 2020 6966 2066 6f6c 6465 7220 6973 204e    if folder is N
+000343a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000343b0: 2070 6174 6820 3d20 6f73 2e70 6174 682e   path = os.path.
+000343c0: 6a6f 696e 2872 6f6f 742c 2066 696c 652e  join(root, file.
+000343d0: 7479 7065 290a 2020 2020 2020 2020 656c  type).        el
+000343e0: 6966 2066 6f6c 6465 7220 3d3d 2027 273a  if folder == '':
+000343f0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+00034400: 6820 3d20 726f 6f74 0a20 2020 2020 2020  h = root.       
+00034410: 2065 6c69 6620 666f 6c64 6572 5b30 5d20   elif folder[0] 
+00034420: 3d3d 2027 2e27 3a0a 2020 2020 2020 2020  == '.':.        
+00034430: 2020 2020 7061 7468 203d 206f 732e 7061      path = os.pa
+00034440: 7468 2e61 6273 7061 7468 286f 732e 7061  th.abspath(os.pa
+00034450: 7468 2e6a 6f69 6e28 726f 6f74 2c20 6669  th.join(root, fi
+00034460: 6c65 2e73 7562 6469 722c 2066 6f6c 6465  le.subdir, folde
+00034470: 7229 290a 2020 2020 2020 2020 656c 7365  r)).        else
+00034480: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00034490: 7468 203d 206f 732e 7061 7468 2e61 6273  th = os.path.abs
+000344a0: 7061 7468 286f 732e 7061 7468 2e6a 6f69  path(os.path.joi
+000344b0: 6e28 726f 6f74 2c20 666f 6c64 6572 2929  n(root, folder))
+000344c0: 0a20 2020 2072 6574 7572 6e20 7061 7468  .    return path
+000344d0: 0a0a 6465 6620 6d61 6b65 5f66 696c 655f  ..def make_file_
+000344e0: 7061 7468 2866 696c 653a 2046 696c 652c  path(file: File,
+000344f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034500: 2020 2020 726f 6f74 5f64 6972 3d4e 6f6e      root_dir=Non
+00034510: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00034520: 2020 2020 2020 666f 6c64 6572 3a20 7374        folder: st
+00034530: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
+00034540: 2020 2020 2020 2020 2020 2020 2073 7566               suf
+00034550: 6669 783a 2073 7472 203d 2027 272c 0a20  fix: str = '',. 
+00034560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034570: 2020 6665 7874 3a20 7374 7220 3d20 272e    fext: str = '.
+00034580: 7473 7627 293a 0a20 2020 2022 2222 2043  tsv'):.    """ C
+00034590: 6f6e 7374 7275 6374 7320 6120 6669 6c65  onstructs a file
+000345a0: 2070 6174 6820 6261 7365 6420 6f6e 2074   path based on t
+000345b0: 6865 2061 7267 756d 656e 7473 2e0a 0a20  he arguments... 
+000345c0: 2020 2041 7267 733a 0a20 2020 2020 2066     Args:.      f
+000345d0: 696c 653a 2054 6869 7320 6675 6e63 7469  ile: This functi
+000345e0: 6f6e 2075 7365 7320 7468 6520 6669 656c  on uses the fiel
+000345f0: 6473 2066 6e61 6d65 2c20 636f 7270 7573  ds fname, corpus
+00034600: 5f70 6174 682c 2073 7562 6469 722c 2061  _path, subdir, a
+00034610: 6e64 2074 7970 652e 0a20 2020 2020 2072  nd type..      r
+00034620: 6f6f 745f 6469 723a 0a20 2020 2020 2020  oot_dir:.       
+00034630: 2044 6566 6175 6c74 7320 746f 204e 6f6e   Defaults to Non
+00034640: 652c 206d 6561 6e69 6e67 2074 6861 7420  e, meaning that 
+00034650: 7468 6520 7061 7468 2069 7320 636f 6e73  the path is cons
+00034660: 7472 7563 7465 6420 6261 7365 6420 6f6e  tructed based on
+00034670: 2074 6865 2063 6f72 7075 735f 7061 7468   the corpus_path
+00034680: 2e0a 2020 2020 2020 2020 5061 7373 2061  ..        Pass a
+00034690: 2064 6972 6563 746f 7279 2074 6f20 636f   directory to co
+000346a0: 6e73 7472 7563 7420 7468 6520 7061 7468  nstruct the path
+000346b0: 2072 656c 6174 6976 6520 746f 2069 7420   relative to it 
+000346c0: 696e 7374 6561 642e 2049 6620 6060 666f  instead. If ``fo
+000346d0: 6c64 6572 6060 2069 7320 616e 2061 6273  lder`` is an abs
+000346e0: 6f6c 7574 6520 7061 7468 2c0a 2020 2020  olute path,.    
+000346f0: 2020 2020 6060 726f 6f74 5f64 6972 6060      ``root_dir``
+00034700: 2069 7320 6967 6e6f 7265 642e 0a20 2020   is ignored..   
+00034710: 2020 2066 6f6c 6465 723a 0a20 2020 2020     folder:.     
+00034720: 2020 2044 6966 6665 7265 6e74 2062 6568     Different beh
+00034730: 6176 696f 7572 7320 6172 6520 6176 6169  aviours are avai
+00034740: 6c61 626c 652e 204e 6f74 6520 7468 6174  lable. Note that
+00034750: 206f 6e6c 7920 7468 6520 7468 6972 6420   only the third 
+00034760: 6f70 7469 6f6e 2065 6e73 7572 6573 2074  option ensures t
+00034770: 6861 7420 6669 6c65 2070 6174 6873 2061  hat file paths a
+00034780: 7265 2064 6973 7469 6e63 7420 666f 720a  re distinct for.
+00034790: 2020 2020 2020 2020 6669 6c65 7320 7468          files th
+000347a0: 6174 2068 6176 6520 6964 656e 7469 6361  at have identica
+000347b0: 6c20 666e 616d 6573 2062 7574 2061 7265  l fnames but are
+000347c0: 206c 6f63 6174 6564 2069 6e20 6469 6666   located in diff
+000347d0: 6572 656e 7420 7375 6264 6972 6563 746f  erent subdirecto
+000347e0: 7269 6573 206f 6620 7468 6520 7361 6d65  ries of the same
+000347f0: 2063 6f72 7075 732e 0a20 2020 2020 2020   corpus..       
+00034800: 202a 2049 6620 6060 666f 6c64 6572 6060   * If ``folder``
+00034810: 2069 7320 4e6f 6e65 2028 6465 6661 756c   is None (defaul
+00034820: 7429 2c20 7468 6520 6669 6c65 7327 2074  t), the files' t
+00034830: 7970 6520 7769 6c6c 2062 6520 6170 7065  ype will be appe
+00034840: 6e64 6564 2074 6f20 7468 6520 6060 726f  nded to the ``ro
+00034850: 6f74 5f64 6972 6060 2e0a 2020 2020 2020  ot_dir``..      
+00034860: 2020 2a20 4966 2060 6066 6f6c 6465 7260    * If ``folder`
+00034870: 6020 6973 2061 6e20 6162 736f 6c75 7465  ` is an absolute
+00034880: 2070 6174 682c 2060 6072 6f6f 745f 6469   path, ``root_di
+00034890: 7260 6020 7769 6c6c 2062 6520 6967 6e6f  r`` will be igno
+000348a0: 7265 642e 0a20 2020 2020 2020 202a 2049  red..        * I
+000348b0: 6620 6060 666f 6c64 6572 6060 2069 7320  f ``folder`` is 
+000348c0: 6120 7265 6c61 7469 7665 2070 6174 6820  a relative path 
+000348d0: 7374 6172 7469 6e67 2077 6974 6820 6120  starting with a 
+000348e0: 646f 7420 6060 2e60 6020 7468 6520 7265  dot ``.`` the re
+000348f0: 6c61 7469 7665 2070 6174 6820 6973 2061  lative path is a
+00034900: 7070 656e 6465 6420 746f 2074 6865 2066  ppended to the f
+00034910: 696c 6527 7320 7375 6264 6972 2e0a 2020  ile's subdir..  
+00034920: 2020 2020 2020 2020 466f 7220 6578 616d          For exam
+00034930: 706c 652c 2060 602e 2e5c 6e6f 7465 7360  ple, ``..\notes`
+00034940: 6020 7769 6c6c 2072 6573 6f6c 7665 2074  ` will resolve t
+00034950: 6f20 6120 7369 626c 696e 6720 6469 7265  o a sibling dire
+00034960: 6374 6f72 7920 6f66 2074 6865 206f 6e65  ctory of the one
+00034970: 2077 6865 7265 2074 6865 2060 6066 696c   where the ``fil
+00034980: 6560 6020 6973 206c 6f63 6174 6564 2e0a  e`` is located..
+00034990: 2020 2020 2020 2020 2a20 4966 2060 6066          * If ``f
+000349a0: 6f6c 6465 7260 6020 6973 2061 2072 656c  older`` is a rel
+000349b0: 6174 6976 6520 7061 7468 2074 6861 7420  ative path that 
+000349c0: 646f 6573 206e 6f74 2062 6567 696e 2077  does not begin w
+000349d0: 6974 6820 6120 646f 7420 6060 2e60 602c  ith a dot ``.``,
+000349e0: 2069 7420 7769 6c6c 2062 6520 6170 7065   it will be appe
+000349f0: 6e64 6564 2074 6f20 7468 650a 2020 2020  nded to the.    
+00034a00: 2020 2020 2020 6060 726f 6f74 5f64 6972        ``root_dir
+00034a10: 6060 2e0a 2020 2020 2020 7375 6666 6978  ``..      suffix
+00034a20: 3a20 5374 7269 6e67 2074 6f20 6170 7065  : String to appe
+00034a30: 6e64 2074 6f20 7468 6520 6669 6c65 2773  nd to the file's
+00034a40: 2066 6e61 6d65 2e0a 2020 2020 2020 6665   fname..      fe
+00034a50: 7874 3a20 4669 6c65 2065 7874 656e 7369  xt: File extensi
+00034a60: 6f6e 2074 6f20 6170 7065 6e64 2074 6f20  on to append to 
+00034a70: 7468 6520 2866 6e61 6d65 2b73 7566 6669  the (fname+suffi
+00034a80: 7829 2e20 4465 6661 756c 7473 2074 6f20  x). Defaults to 
+00034a90: 6060 2e74 7376 6060 2e0a 0a20 2020 2052  ``.tsv``...    R
+00034aa0: 6574 7572 6e73 3a0a 2020 2020 2020 5468  eturns:.      Th
+00034ab0: 6520 636f 6e73 7472 7563 7465 6420 6669  e constructed fi
+00034ac0: 6c65 2070 6174 682e 0a20 2020 2022 2222  le path..    """
+00034ad0: 0a20 2020 2061 7373 6572 7420 6665 7874  .    assert fext
+00034ae0: 2069 7320 6e6f 7420 4e6f 6e65 2c20 2222   is not None, ""
+00034af0: 0a20 2020 2070 6174 6820 3d20 636f 6d70  .    path = comp
+00034b00: 7574 655f 7061 7468 5f66 726f 6d5f 6669  ute_path_from_fi
+00034b10: 6c65 2866 696c 652c 2072 6f6f 745f 6469  le(file, root_di
+00034b20: 723d 726f 6f74 5f64 6972 2c20 666f 6c64  r=root_dir, fold
+00034b30: 6572 3d66 6f6c 6465 7229 0a20 2020 2069  er=folder).    i
+00034b40: 6620 7375 6666 6978 2069 7320 4e6f 6e65  f suffix is None
+00034b50: 3a0a 2020 2020 2020 2020 7375 6666 6978  :.        suffix
+00034b60: 203d 2027 270a 2020 2020 666e 616d 6520   = ''.    fname 
+00034b70: 3d20 6669 6c65 2e66 6e61 6d65 202b 2073  = file.fname + s
+00034b80: 7566 6669 7820 2b20 6665 7874 0a20 2020  uffix + fext.   
+00034b90: 2072 6574 7572 6e20 6f73 2e70 6174 682e   return os.path.
+00034ba0: 6a6f 696e 2870 6174 682c 2066 6e61 6d65  join(path, fname
+00034bb0: 290a 0a64 6566 2073 7472 696e 6732 6964  )..def string2id
+00034bc0: 656e 7469 6669 6572 2873 3a20 7374 722c  entifier(s: str,
+00034bd0: 2072 656d 6f76 655f 6c65 6164 696e 675f   remove_leading_
+00034be0: 756e 6465 7273 636f 7265 3a20 626f 6f6c  underscore: bool
+00034bf0: 203d 2054 7275 6529 202d 3e20 7374 723a   = True) -> str:
+00034c00: 0a20 2020 2022 2222 5472 616e 7366 6f72  .    """Transfor
+00034c10: 6d20 6120 7374 7269 6e67 2069 6e20 6120  m a string in a 
+00034c20: 7761 7920 7468 6174 2069 7420 6361 6e20  way that it can 
+00034c30: 6265 2075 7365 6420 6173 2069 6465 6e74  be used as ident
+00034c40: 6966 6965 7220 2876 6172 6961 626c 6520  ifier (variable 
+00034c50: 6f72 2061 7474 7269 6275 7465 206e 616d  or attribute nam
+00034c60: 6529 2e0a 2020 2020 536f 6c75 7469 6f6e  e)..    Solution
+00034c70: 2062 7920 4b65 6e61 6e20 4261 6e6b 7320   by Kenan Banks 
+00034c80: 6f6e 2068 7474 7073 3a2f 2f73 7461 636b  on https://stack
+00034c90: 6f76 6572 666c 6f77 2e63 6f6d 2f61 2f33  overflow.com/a/3
+00034ca0: 3330 3333 3631 0a20 2020 2022 2222 0a20  303361.    """. 
+00034cb0: 2020 2023 2052 656d 6f76 6520 696e 7661     # Remove inva
+00034cc0: 6c69 6420 6368 6172 6163 7465 7273 0a20  lid characters. 
+00034cd0: 2020 2073 203d 2072 652e 7375 6228 275b     s = re.sub('[
+00034ce0: 5e30 2d39 612d 7a41 2d5a 5f5d 272c 2027  ^0-9a-zA-Z_]', '
+00034cf0: 272c 2073 290a 0a20 2020 2023 2052 656d  ', s)..    # Rem
+00034d00: 6f76 6520 6c65 6164 696e 6720 6368 6172  ove leading char
+00034d10: 6163 7465 7273 2075 6e74 696c 2077 6520  acters until we 
+00034d20: 6669 6e64 2061 206c 6574 7465 7220 6f72  find a letter or
+00034d30: 2075 6e64 6572 7363 6f72 650a 2020 2020   underscore.    
+00034d40: 7265 6765 7820 3d20 275e 5b5e 612d 7a41  regex = '^[^a-zA
+00034d50: 2d5a 5d2b 2720 6966 2072 656d 6f76 655f  -Z]+' if remove_
+00034d60: 6c65 6164 696e 675f 756e 6465 7273 636f  leading_undersco
+00034d70: 7265 2065 6c73 6520 275e 5b5e 612d 7a41  re else '^[^a-zA
+00034d80: 2d5a 5f5d 2b27 0a20 2020 2073 203d 2072  -Z_]+'.    s = r
+00034d90: 652e 7375 6228 7265 6765 782c 2027 272c  e.sub(regex, '',
+00034da0: 2073 290a 0a20 2020 2072 6574 7572 6e20   s)..    return 
+00034db0: 730a 0a40 6c72 755f 6361 6368 6528 290a  s..@lru_cache().
+00034dc0: 4066 756e 6374 696f 6e5f 6c6f 6767 6572  @function_logger
+00034dd0: 0a64 6566 2067 6574 5f67 6974 5f63 6f6d  .def get_git_com
+00034de0: 6d69 7428 7265 706f 5f70 6174 683a 2073  mit(repo_path: s
+00034df0: 7472 2c20 6769 745f 7265 7669 7369 6f6e  tr, git_revision
+00034e00: 3a20 7374 7229 202d 3e20 4f70 7469 6f6e  : str) -> Option
+00034e10: 616c 5b67 6974 2e43 6f6d 6d69 745d 3a0a  al[git.Commit]:.
+00034e20: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00034e30: 2072 6570 6f20 3d20 6769 742e 5265 706f   repo = git.Repo
+00034e40: 2872 6570 6f5f 7061 7468 2c20 7365 6172  (repo_path, sear
+00034e50: 6368 5f70 6172 656e 745f 6469 7265 6374  ch_parent_direct
+00034e60: 6f72 6965 733d 5472 7565 290a 2020 2020  ories=True).    
+00034e70: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00034e80: 2061 7320 653a 0a20 2020 2020 2020 206c   as e:.        l
+00034e90: 6f67 6765 722e 6572 726f 7228 6622 7b72  ogger.error(f"{r
+00034ea0: 6570 6f5f 7061 7468 7d20 6973 206e 6f74  epo_path} is not
+00034eb0: 2061 6e20 6578 6973 7469 6e67 2067 6974   an existing git
+00034ec0: 2072 6570 6f73 6974 6f72 793a 207b 657d   repository: {e}
+00034ed0: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
+00034ee0: 6e0a 2020 2020 7472 793a 0a20 2020 2020  n.    try:.     
+00034ef0: 2020 2072 6574 7572 6e20 7265 706f 2e63     return repo.c
+00034f00: 6f6d 6d69 7428 6769 745f 7265 7669 7369  ommit(git_revisi
+00034f10: 6f6e 290a 2020 2020 6578 6365 7074 2042  on).    except B
+00034f20: 6164 4e61 6d65 3a0a 2020 2020 2020 2020  adName:.        
+00034f30: 6c6f 6767 6572 2e65 7272 6f72 2866 227b  logger.error(f"{
+00034f40: 6769 745f 7265 7669 7369 6f6e 7d20 646f  git_revision} do
+00034f50: 6573 206e 6f74 2072 6573 6f6c 7665 2074  es not resolve t
+00034f60: 6f20 6120 636f 6d6d 6974 2066 6f72 2072  o a commit for r
+00034f70: 6570 6f20 7b6f 732e 7061 7468 2e62 6173  epo {os.path.bas
+00034f80: 656e 616d 6528 7265 706f 5f70 6174 6829  ename(repo_path)
+00034f90: 7d2e 2229 0a0a 0a40 6675 6e63 7469 6f6e  }.")...@function
+00034fa0: 5f6c 6f67 6765 720a 6465 6620 7061 7273  _logger.def pars
+00034fb0: 655f 7473 765f 6669 6c65 5f61 745f 6769  e_tsv_file_at_gi
+00034fc0: 745f 7265 7669 7369 6f6e 2866 696c 653a  t_revision(file:
+00034fd0: 2046 696c 652c 0a20 2020 2020 2020 2020   File,.         
+00034fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034ff0: 2020 2020 2020 2020 2020 6769 745f 7265            git_re
+00035000: 7669 7369 6f6e 3a20 7374 722c 0a20 2020  vision: str,.   
+00035010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035030: 7265 706f 5f70 6174 683a 204f 7074 696f  repo_path: Optio
+00035040: 6e61 6c5b 7374 725d 203d 204e 6f6e 6529  nal[str] = None)
+00035050: 202d 3e20 4669 6c65 4461 7461 6672 616d   -> FileDatafram
+00035060: 6554 7570 6c65 4d61 7962 653a 0a20 2020  eTupleMaybe:.   
+00035070: 2022 2222 0a20 2020 2050 6173 7320 6120   """.    Pass a 
+00035080: 4669 6c65 206f 626a 6563 7420 6f66 2061  File object of a
+00035090: 2054 5356 2066 696c 6520 616e 6420 616e   TSV file and an
+000350a0: 2069 6465 6e74 6966 6965 7220 666f 7220   identifier for 
+000350b0: 6120 6769 7420 7265 7669 7369 6f6e 2074  a git revision t
+000350c0: 6f20 7265 7472 6965 7665 2074 6865 2070  o retrieve the p
+000350d0: 6172 7365 6420 5453 5620 6669 6c65 2061  arsed TSV file a
+000350e0: 7420 7468 6174 2063 6f6d 6d69 742e 0a20  t that commit.. 
+000350f0: 2020 2054 6865 2066 696c 6520 6e65 6564     The file need
+00035100: 7320 746f 2068 6176 6520 6578 6973 7465  s to have existe
+00035110: 6420 6174 2074 6865 2072 6576 6973 696f  d at the revisio
+00035120: 6e20 696e 2071 7565 7374 696f 6e2e 0a0a  n in question...
+00035130: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00035140: 6669 6c65 3a0a 2020 2020 2020 6769 745f  file:.      git_
+00035150: 7265 7669 7369 6f6e 3a0a 2020 2020 2020  revision:.      
+00035160: 7265 706f 5f70 6174 683a 0a0a 2020 2020  repo_path:..    
+00035170: 5265 7475 726e 733a 0a0a 2020 2020 2222  Returns:..    ""
+00035180: 220a 2020 2020 6966 2066 696c 652e 7479  ".    if file.ty
+00035190: 7065 203d 3d20 2773 636f 7265 7327 3a0a  pe == 'scores':.
+000351a0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
+000351b0: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
+000351c0: 7228 6622 5061 7273 696e 6720 6f6c 6465  r(f"Parsing olde
+000351d0: 7220 7265 7669 7369 6f6e 7320 6f66 2073  r revisions of s
+000351e0: 636f 7265 7320 6973 206e 6f74 2069 6d70  cores is not imp
+000351f0: 6c65 6d65 6e74 6564 2e20 4368 6563 6b6f  lemented. Checko
+00035200: 7574 2074 6865 2072 6576 6973 696f 6e20  ut the revision 
+00035210: 796f 7572 7365 6c66 2e22 290a 2020 2020  yourself.").    
+00035220: 6966 2072 6570 6f5f 7061 7468 2069 7320  if repo_path is 
+00035230: 4e6f 6e65 3a0a 2020 2020 2020 2020 7265  None:.        re
+00035240: 706f 5f70 6174 6820 3d20 6669 6c65 2e63  po_path = file.c
+00035250: 6f72 7075 735f 7061 7468 0a20 2020 2063  orpus_path.    c
+00035260: 6f6d 6d69 7420 3d20 6765 745f 6769 745f  ommit = get_git_
+00035270: 636f 6d6d 6974 2872 6570 6f5f 7061 7468  commit(repo_path
+00035280: 2c20 6769 745f 7265 7669 7369 6f6e 2c20  , git_revision, 
+00035290: 6c6f 6767 6572 3d6c 6f67 6765 7229 0a20  logger=logger). 
+000352a0: 2020 2069 6620 636f 6d6d 6974 2069 7320     if commit is 
+000352b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7265  None:.        re
+000352c0: 7475 726e 204e 6f6e 652c 204e 6f6e 650a  turn None, None.
+000352d0: 2020 2020 636f 6d6d 6974 5f73 6861 203d      commit_sha =
+000352e0: 2063 6f6d 6d69 742e 6865 7873 6861 0a20   commit.hexsha. 
+000352f0: 2020 2073 686f 7274 5f73 6861 203d 2063     short_sha = c
+00035300: 6f6d 6d69 745f 7368 615b 3a37 5d0a 2020  ommit_sha[:7].  
+00035310: 2020 636f 6d6d 6974 5f69 6e66 6f20 3d20    commit_info = 
+00035320: 6622 7b73 686f 7274 5f73 6861 7d20 7769  f"{short_sha} wi
+00035330: 7468 206d 6573 7361 6765 2027 7b63 6f6d  th message '{com
+00035340: 6d69 742e 6d65 7373 6167 652e 7374 7269  mit.message.stri
+00035350: 7028 297d 2722 0a20 2020 2069 6620 7368  p()}'".    if sh
+00035360: 6f72 745f 7368 6120 213d 2067 6974 5f72  ort_sha != git_r
+00035370: 6576 6973 696f 6e3a 0a20 2020 2020 2020  evision:.       
+00035380: 206c 6f67 6765 722e 6465 6275 6728 6622   logger.debug(f"
+00035390: 5265 736f 6c76 6564 2027 7b67 6974 5f72  Resolved '{git_r
+000353a0: 6576 6973 696f 6e7d 2720 746f 2027 7b73  evision}' to '{s
+000353b0: 686f 7274 5f73 6861 7d27 2e22 290a 2020  hort_sha}'.").  
+000353c0: 2020 7265 6c5f 7061 7468 203d 206f 732e    rel_path = os.
+000353d0: 7061 7468 2e6e 6f72 6d70 6174 6828 6669  path.normpath(fi
+000353e0: 6c65 2e72 656c 5f70 6174 6829 0a20 2020  le.rel_path).   
+000353f0: 2074 7279 3a0a 2020 2020 2020 2020 7461   try:.        ta
+00035400: 7267 6574 6669 6c65 203d 2063 6f6d 6d69  rgetfile = commi
+00035410: 742e 7472 6565 202f 2072 656c 5f70 6174  t.tree / rel_pat
+00035420: 680a 2020 2020 6578 6365 7074 204b 6579  h.    except Key
+00035430: 4572 726f 723a 0a20 2020 2020 2020 2023  Error:.        #
+00035440: 2061 6464 206c 6f67 6963 2068 6572 6520   add logic here 
+00035450: 746f 2066 696e 6420 6f6c 6465 7220 7061  to find older pa
+00035460: 7468 2077 6865 6e20 7468 6520 6669 6c65  th when the file
+00035470: 2068 6173 2062 6565 6e20 6d6f 7665 6420   has been moved 
+00035480: 6f72 2072 656e 616d 6564 0a20 2020 2020  or renamed.     
+00035490: 2020 206c 6f67 6765 722e 6572 726f 7228     logger.error(
+000354a0: 6622 7b72 656c 5f70 6174 687d 2064 6964  f"{rel_path} did
+000354b0: 206e 6f74 2065 7869 7374 2061 7420 636f   not exist at co
+000354c0: 6d6d 6974 207b 636f 6d6d 6974 5f69 6e66  mmit {commit_inf
+000354d0: 6f7d 2e22 290a 2020 2020 2020 2020 7265  o}.").        re
+000354e0: 7475 726e 204e 6f6e 652c 204e 6f6e 650a  turn None, None.
+000354f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00035500: 2077 6974 6820 696f 2e42 7974 6573 494f   with io.BytesIO
+00035510: 2874 6172 6765 7466 696c 652e 6461 7461  (targetfile.data
+00035520: 5f73 7472 6561 6d2e 7265 6164 2829 2920  _stream.read()) 
+00035530: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+00035540: 2020 7061 7273 6564 203d 206c 6f61 645f    parsed = load_
+00035550: 7473 7628 6629 0a20 2020 2065 7863 6570  tsv(f).    excep
+00035560: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00035570: 3a0a 2020 2020 2020 2020 6c6f 6767 6572  :.        logger
+00035580: 2e65 7272 6f72 2866 2250 6172 7369 6e67  .error(f"Parsing
+00035590: 207b 7265 6c5f 7061 7468 7d20 4020 636f   {rel_path} @ co
+000355a0: 6d6d 6974 207b 636f 6d6d 6974 5f69 6e66  mmit {commit_inf
+000355b0: 6f7d 2066 6169 6c65 6420 7769 7468 2074  o} failed with t
+000355c0: 6865 2066 6f6c 6c6f 7769 6e67 2065 7863  he following exc
+000355d0: 6570 7469 6f6e 3a5c 6e7b 657d 2229 0a20  eption:\n{e}"). 
+000355e0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+000355f0: 6e65 2c20 4e6f 6e65 0a20 2020 206e 6577  ne, None.    new
+00035600: 5f66 696c 6520 3d20 6461 7461 636c 6173  _file = dataclas
+00035610: 7365 732e 7265 706c 6163 6528 6669 6c65  ses.replace(file
+00035620: 2c20 636f 6d6d 6974 5f73 6861 3d63 6f6d  , commit_sha=com
+00035630: 6d69 745f 7368 6129 0a20 2020 2072 6574  mit_sha).    ret
+00035640: 7572 6e20 6e65 775f 6669 6c65 2c20 7061  urn new_file, pa
+00035650: 7273 6564 0a0a 0a40 6675 6e63 7469 6f6e  rsed...@function
+00035660: 5f6c 6f67 6765 720a 6465 6620 6368 6563  _logger.def chec
+00035670: 6b5f 7068 7261 7365 5f61 6e6e 6f74 6174  k_phrase_annotat
+00035680: 696f 6e73 2864 663a 2070 642e 4461 7461  ions(df: pd.Data
+00035690: 4672 616d 652c 0a20 2020 2020 2020 2020  Frame,.         
+000356a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000356b0: 2020 2020 636f 6c75 6d6e 3a20 7374 7229      column: str)
+000356c0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2222   -> bool:.    ""
+000356d0: 2222 2222 0a20 2020 2070 5f63 6f6c 203d  """".    p_col =
+000356e0: 2064 665b 636f 6c75 6d6e 5d0a 2020 2020   df[column].    
+000356f0: 6f70 656e 696e 6720 3d20 705f 636f 6c2e  opening = p_col.
+00035700: 6669 6c6c 6e61 2827 2729 2e73 7472 2e63  fillna('').str.c
+00035710: 6f75 6e74 2827 7b27 290a 2020 2020 636c  ount('{').    cl
+00035720: 6f73 696e 6720 3d20 705f 636f 6c2e 6669  osing = p_col.fi
+00035730: 6c6c 6e61 2827 2729 2e73 7472 2e63 6f75  llna('').str.cou
+00035740: 6e74 2827 7d27 290a 2020 2020 6966 2027  nt('}').    if '
+00035750: 6d6e 5f70 6c61 7974 6872 6f75 6768 2720  mn_playthrough' 
+00035760: 696e 2064 662e 636f 6c75 6d6e 733a 0a20  in df.columns:. 
+00035770: 2020 2020 2020 2070 6f73 6974 696f 6e5f         position_
+00035780: 636f 6c20 3d20 276d 6e5f 706c 6179 7468  col = 'mn_playth
+00035790: 726f 7567 6827 0a20 2020 2065 6c73 653a  rough'.    else:
+000357a0: 0a20 2020 2020 2020 206c 6f67 6765 722e  .        logger.
+000357b0: 696e 666f 2866 2243 6f6c 756d 6e20 276d  info(f"Column 'm
+000357c0: 6e5f 706c 6179 7468 726f 7567 6827 2069  n_playthrough' i
+000357d0: 7320 6d69 7373 696e 672c 2073 6f20 6d79  s missing, so my
+000357e0: 2061 7373 6573 736d 656e 7420 6f66 2074   assessment of t
+000357f0: 6865 2070 6872 6173 6520 616e 6e6f 7461  he phrase annota
+00035800: 7469 6f6e 7320 6d69 6768 7420 6265 2077  tions might be w
+00035810: 726f 6e67 2e22 290a 2020 2020 2020 2020  rong.").        
+00035820: 706f 7369 7469 6f6e 5f63 6f6c 203d 2027  position_col = '
+00035830: 6d6e 270a 2020 2020 636f 6c75 6d6e 7320  mn'.    columns 
+00035840: 3d20 5b70 6f73 6974 696f 6e5f 636f 6c2c  = [position_col,
+00035850: 2063 6f6c 756d 6e5d 0a20 2020 2069 6620   column].    if 
+00035860: 6f70 656e 696e 672e 7375 6d28 2920 213d  opening.sum() !=
+00035870: 2063 6c6f 7369 6e67 2e73 756d 2829 3a0a   closing.sum():.
+00035880: 2020 2020 2020 2020 6f20 3d20 6466 2e6c          o = df.l
+00035890: 6f63 5b28 6f70 656e 696e 6720 3e20 3029  oc[(opening > 0)
+000358a0: 2c20 636f 6c75 6d6e 735d 0a20 2020 2020  , columns].     
+000358b0: 2020 2063 203d 2064 662e 6c6f 635b 2863     c = df.loc[(c
+000358c0: 6c6f 7369 6e67 203e 2030 292c 2063 6f6c  losing > 0), col
+000358d0: 756d 6e73 5d0a 2020 2020 2020 2020 636f  umns].        co
+000358e0: 6d70 6172 6520 3d20 7064 2e63 6f6e 6361  mpare = pd.conca
+000358f0: 7428 5b6f 2e72 6573 6574 5f69 6e64 6578  t([o.reset_index
+00035900: 2864 726f 703d 5472 7565 292c 2063 2e72  (drop=True), c.r
+00035910: 6573 6574 5f69 6e64 6578 2864 726f 703d  eset_index(drop=
+00035920: 5472 7565 295d 2c20 6178 6973 3d31 290a  True)], axis=1).
+00035930: 2020 2020 2020 2020 6966 2027 6d6e 2720          if 'mn' 
+00035940: 696e 2063 6f6d 7061 7265 3a0a 2020 2020  in compare:.    
+00035950: 2020 2020 2020 2020 636f 6d70 6172 6520          compare 
+00035960: 3d20 636f 6d70 6172 652e 6173 7479 7065  = compare.astype
+00035970: 287b 276d 6e27 3a20 2749 6e74 3634 277d  ({'mn': 'Int64'}
+00035980: 290a 2020 2020 2020 2020 6c6f 6767 6572  ).        logger
+00035990: 2e77 6172 6e69 6e67 2866 2250 6872 6173  .warning(f"Phras
+000359a0: 6520 6265 6769 6e6e 696e 6720 616e 6420  e beginning and 
+000359b0: 656e 6469 6e67 7320 646f 6e27 7420 6d61  endings don't ma
+000359c0: 7463 683a 5c6e 7b63 6f6d 7061 7265 2e74  tch:\n{compare.t
+000359d0: 6f5f 7374 7269 6e67 2869 6e64 6578 3d46  o_string(index=F
+000359e0: 616c 7365 297d 222c 2065 7874 7261 3d7b  alse)}", extra={
+000359f0: 226d 6573 7361 6765 5f69 6422 3a20 2831  "message_id": (1
+00035a00: 362c 297d 290a 2020 2020 2020 2020 7265  6,)}).        re
+00035a10: 7475 726e 2046 616c 7365 0a20 2020 2072  turn False.    r
+00035a20: 6574 7572 6e20 5472 7565 0a              eturn True.
```

### Comparing `ms3-1.2.5/src/ms3/view.py` & `ms3-1.2.6/src/ms3/view.py`

 * *Files 0% similar despite different names*

```diff
@@ -212,15 +212,15 @@
         if file_paths is not None:
             resolved_paths = resolve_paths_argument(file_paths)
             if len(resolved_paths) > 0:
                 unpack_json_paths(resolved_paths)
                 regexes = [re.escape(os.path.basename(p)) for p in resolved_paths]
                 self.include('files', *regexes)
         if folder_paths is not None:
-            resolved_paths = resolve_paths_argument(file_paths, files=False)
+            resolved_paths = resolve_paths_argument(folder_paths, files=False)
             if len(resolved_paths) > 0:
                 self.include('paths', *resolved_paths)
         if len(logger_cfg) > 0:
             self.change_logger_cfg(**logger_cfg)
 
     @property
     def include_convertible(self):
```

### Comparing `ms3-1.2.5/src/ms3.egg-info/PKG-INFO` & `ms3-1.2.6/src/ms3.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ms3
-Version: 1.2.5
+Version: 1.2.6
 Summary: A parser for annotated MuseScore 3 files.
 Home-page: https://github.com/johentsch/ms3
 Author: Johannes Hentschel
 Author-email: johannes.hentschel@epfl.ch
 License: gpl3
 Project-URL: Documentation, https://johentsch.github.io/ms3/
 Platform: any
```

### Comparing `ms3-1.2.5/src/ms3.egg-info/SOURCES.txt` & `ms3-1.2.6/src/ms3.egg-info/SOURCES.txt`

 * *Files identical despite different names*


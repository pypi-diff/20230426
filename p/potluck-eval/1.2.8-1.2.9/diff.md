# Comparing `tmp/potluck-eval-1.2.8.tar.gz` & `tmp/potluck-eval-1.2.9.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "potluck-eval-1.2.8.tar", last modified: Mon Sep 12 19:49:59 2022, max compression
+gzip compressed data, was "potluck-eval-1.2.9.tar", last modified: Fri Sep 16 02:25:17 2022, max compression
```

## Comparing `potluck-eval-1.2.8.tar` & `potluck-eval-1.2.9.tar`

### file list

```diff
@@ -1,257 +1,259 @@
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.540858 potluck-eval-1.2.8/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1585 2021-06-24 03:54:58.000000 potluck-eval-1.2.8/LICENSE.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)      724 2021-08-29 10:01:10.000000 potluck-eval-1.2.8/MANIFEST.in
--rw-r--r--   0 pmawhort   (502) staff       (20)    18255 2022-09-12 19:49:59.539890 potluck-eval-1.2.8/PKG-INFO
--rw-r--r--   0 pmawhort   (502) staff       (20)    16982 2022-09-12 19:47:21.000000 potluck-eval-1.2.8/README.md
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.181552 potluck-eval-1.2.8/potluck/
--rw-r--r--   0 pmawhort   (502) staff       (20)     2339 2021-09-04 09:59:29.000000 potluck-eval-1.2.8/potluck/__init__.py
--rw-r--r--   0 pmawhort   (502) staff       (20)       69 2022-09-07 10:51:40.000000 potluck-eval-1.2.8/potluck/_version.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    76177 2022-03-02 01:49:05.000000 potluck-eval-1.2.8/potluck/compare.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    12177 2021-11-03 19:57:29.000000 potluck-eval-1.2.8/potluck/context_utils.py
--rw-r--r--   0 pmawhort   (502) staff       (20)   107852 2022-08-27 10:32:07.000000 potluck-eval-1.2.8/potluck/contexts.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    38255 2022-01-24 20:11:36.000000 potluck-eval-1.2.8/potluck/control.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     3173 2021-11-10 18:17:45.000000 potluck-eval-1.2.8/potluck/default_config.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    19286 2022-04-15 12:44:03.000000 potluck-eval-1.2.8/potluck/explain.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     5877 2021-11-17 00:05:36.000000 potluck-eval-1.2.8/potluck/file_utils.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    72922 2022-04-14 14:11:34.000000 potluck-eval-1.2.8/potluck/harness.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    24610 2021-11-10 13:04:02.000000 potluck-eval-1.2.8/potluck/html_tools.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    15630 2022-01-19 11:46:07.000000 potluck-eval-1.2.8/potluck/load.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      969 2021-07-04 00:17:29.000000 potluck-eval-1.2.8/potluck/logging.py
--rw-r--r--   0 pmawhort   (502) staff       (20)   105301 2022-04-12 02:26:43.000000 potluck-eval-1.2.8/potluck/mast.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     2289 2021-07-02 02:08:49.000000 potluck-eval-1.2.8/potluck/mast_utils.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    21413 2022-04-27 00:46:16.000000 potluck-eval-1.2.8/potluck/meta.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    11062 2022-04-18 14:35:49.000000 potluck-eval-1.2.8/potluck/patterns.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     2473 2022-03-10 17:52:27.000000 potluck-eval-1.2.8/potluck/phrasing.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    22250 2022-09-07 10:13:26.000000 potluck-eval-1.2.8/potluck/render.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.185542 potluck-eval-1.2.8/potluck/resources/
--rw-r--r--   0 pmawhort   (502) staff       (20)    22832 2022-09-06 10:45:12.000000 potluck-eval-1.2.8/potluck/resources/potluck.css
--rw-r--r--   0 pmawhort   (502) staff       (20)    28088 2022-09-07 10:49:42.000000 potluck-eval-1.2.8/potluck/resources/potluck.js
--rw-r--r--   0 pmawhort   (502) staff       (20)   178114 2022-09-06 13:55:41.000000 potluck-eval-1.2.8/potluck/rubrics.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    50273 2022-03-01 23:14:05.000000 potluck-eval-1.2.8/potluck/snippets.py
--rw-r--r--   0 pmawhort   (502) staff       (20)   207306 2022-09-06 13:52:06.000000 potluck-eval-1.2.8/potluck/specifications.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.206766 potluck-eval-1.2.8/potluck/templates/
--rw-r--r--   0 pmawhort   (502) staff       (20)     3425 2022-09-07 10:47:47.000000 potluck-eval-1.2.8/potluck/templates/instructions.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)     5268 2022-01-09 12:09:47.000000 potluck-eval-1.2.8/potluck/templates/report.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)      796 2022-09-07 10:47:29.000000 potluck-eval-1.2.8/potluck/templates/rubric.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)      307 2021-09-03 00:04:41.000000 potluck-eval-1.2.8/potluck/templates/standalone_instructions.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)      328 2021-08-20 07:39:39.000000 potluck-eval-1.2.8/potluck/templates/standalone_report.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)      342 2022-01-09 12:08:53.000000 potluck-eval-1.2.8/potluck/templates/standalone_tests_report.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)     5023 2022-01-09 12:21:21.000000 potluck-eval-1.2.8/potluck/templates/tests_report.j2
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.067136 potluck-eval-1.2.8/potluck/testarea/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.067279 potluck-eval-1.2.8/potluck/testarea/test_course/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.216020 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.072658 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.070408 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.220017 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-02 03:58:01.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/debugMe.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      647 2022-04-12 09:15:38.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/test_debugMe.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.222035 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/filesTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1572 2022-04-12 09:46:37.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/filesTest/files.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.224008 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/freedomTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      405 2022-01-23 12:23:31.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/freedomTest/free.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.228463 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1012 2022-01-23 12:40:20.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/functions.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      670 2022-04-12 09:15:48.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/test_functions.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.230429 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/interactiveTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      799 2021-07-02 04:00:18.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/interactiveTest/interactive.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.232324 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/sceneTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-07-02 04:00:50.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/sceneTest/scene.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.234263 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/snippetsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      887 2021-08-19 21:51:58.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/snippetsTest/process.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.237839 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      536 2022-01-23 12:34:14.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/arpeggio.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      518 2022-04-12 09:15:42.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/test_arpeggio.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.240079 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/varsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      408 2021-11-06 20:45:49.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/varsTest/vars.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.072411 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.243466 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1099 2021-07-02 04:19:52.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/debugMe.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      647 2022-04-12 09:15:09.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/test_debugMe.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.245682 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/filesTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1591 2022-04-12 10:13:12.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/filesTest/files.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.248122 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/freedomTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      788 2022-04-12 09:15:23.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/freedomTest/free.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.253480 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1609 2022-04-12 09:15:26.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/functions.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      902 2022-04-12 09:15:32.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/test_functions.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.255628 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/interactiveTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      856 2021-06-28 21:25:08.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/interactiveTest/interactive.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.257374 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/sceneTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      355 2021-08-31 14:35:40.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/sceneTest/scene.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.259441 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/snippetsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      936 2021-08-19 21:51:50.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/snippetsTest/process.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.261564 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/varsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      335 2021-11-07 00:09:23.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/varsTest/vars.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.072843 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/runscode/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.263471 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/runscode/freedomTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      550 2022-04-12 09:16:03.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/runscode/freedomTest/free.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.074157 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.265496 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/filesTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)    56426 2021-11-04 10:21:05.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/filesTest/index.html
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.269653 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/functionsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)    92612 2021-08-28 02:11:44.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/functionsTest/index.html
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.273039 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/snippetsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)    57594 2021-08-23 10:03:39.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/snippetsTest/index.html
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.275790 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/synthTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)  1354772 2021-08-28 21:24:19.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/synthTest/index.html
--rw-r--r--   0 pmawhort   (502) staff       (20)      178 2021-06-24 00:02:24.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/potluck-admin.json
--rw-r--r--   0 pmawhort   (502) staff       (20)      303 2021-07-02 19:29:38.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/potluck_config.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.075215 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.303440 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmp6p2owg4g__tmp/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1605 2022-01-23 16:25:48.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmp6p2owg4g__tmp/functions.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.307949 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmpcmmo6je5__ref_tmp/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1224 2022-01-23 16:25:48.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmpcmmo6je5__ref_tmp/functions.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.310387 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmpdargdc_d__tmp/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1605 2022-01-23 18:31:51.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmpdargdc_d__tmp/functions.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.312519 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmpnuz7g0cl__ref_tmp/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1224 2022-01-23 18:31:51.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmpnuz7g0cl__ref_tmp/functions.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    76784 2022-01-23 23:01:49.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/self_printed_mast.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.076052 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.316484 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/filesTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1823 2021-11-04 10:21:05.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/filesTest/grep.part.html
--rw-r--r--   0 pmawhort   (502) staff       (20)     1216 2021-11-04 10:21:05.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/filesTest/listFile.part.html
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.322070 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/snippetsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)     4804 2021-08-23 10:03:39.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/snippetsTest/examples.part.html
--rw-r--r--   0 pmawhort   (502) staff       (20)      466 2021-08-23 10:03:39.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/snippetsTest/run.part.html
--rw-r--r--   0 pmawhort   (502) staff       (20)     2424 2021-08-23 10:03:39.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/snippetsTest/vars.part.html
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.323935 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/varsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1290 2021-11-07 00:05:07.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/varsTest/vars.part.html
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.088325 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.326184 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.330131 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/soln/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1100 2021-06-28 14:05:15.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/soln/debugMe.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      647 2022-04-12 09:10:57.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/soln/test_debugMe.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     6840 2022-08-27 18:24:35.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/spec.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.334030 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/starter/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-06-28 16:34:48.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/starter/debugMe.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      647 2022-04-12 09:11:09.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/starter/test_debugMe.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.335682 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.346108 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/soln/
--rw-r--r--   0 pmawhort   (502) staff       (20)      139 2021-11-03 14:05:33.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/soln/birds.txt
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.347898 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/soln/dir/
--rw-r--r--   0 pmawhort   (502) staff       (20)       53 2021-11-04 10:07:09.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/soln/dir/mammals.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)     1652 2022-04-12 09:49:10.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/soln/files.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      105 2021-11-03 14:05:33.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/soln/fish.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)       14 2022-04-12 09:42:56.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/soln/nums.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)       23 2022-04-12 09:43:10.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/soln/nums2.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)     3852 2022-04-12 10:16:54.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/spec.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.356187 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/starter/
--rw-r--r--   0 pmawhort   (502) staff       (20)      139 2021-11-03 13:54:42.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/starter/birds.txt
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.358247 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/starter/dir/
--rw-r--r--   0 pmawhort   (502) staff       (20)       53 2021-11-04 10:07:03.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/starter/dir/mammals.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)      105 2021-11-03 13:52:43.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/starter/fish.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)       14 2022-04-12 09:48:21.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/starter/nums.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)       23 2022-04-12 09:48:21.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/starter/nums2.txt
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.359783 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/freedomTest/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.362493 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/freedomTest/soln/
--rw-r--r--   0 pmawhort   (502) staff       (20)      772 2022-01-23 12:20:43.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/freedomTest/soln/free.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1781 2022-01-23 12:22:08.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/freedomTest/spec.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.366531 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      569 2021-08-28 02:04:43.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/instructions.md
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.370346 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1224 2022-01-23 12:08:50.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/functions.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      671 2022-04-12 09:08:03.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/test_functions.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     8435 2022-04-12 10:21:10.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/spec.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.372836 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/starter/
--rw-r--r--   0 pmawhort   (502) staff       (20)      405 2021-06-22 14:15:38.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/starter/functions.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.374485 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/interactiveTest/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.376467 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/interactiveTest/soln/
--rw-r--r--   0 pmawhort   (502) staff       (20)      856 2021-06-28 21:33:50.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/interactiveTest/soln/interactive.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     2461 2021-09-21 23:41:14.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/interactiveTest/spec.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.378474 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.381595 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/soln/
--rw-r--r--   0 pmawhort   (502) staff       (20)      254 2021-06-28 16:38:25.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/soln/scene.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    31129 2021-06-28 16:36:37.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/soln/turtleBeads.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1121 2021-08-31 14:36:54.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/spec.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.383983 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/starter/
--rw-r--r--   0 pmawhort   (502) staff       (20)    31129 2021-06-28 16:36:26.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/starter/turtleBeads.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.389318 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/snippetsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      764 2021-08-21 14:22:37.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/snippetsTest/instructions.md
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.391750 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/snippetsTest/soln/
--rw-r--r--   0 pmawhort   (502) staff       (20)      936 2021-08-19 10:32:07.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/snippetsTest/soln/process.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     2749 2022-04-12 10:07:59.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/snippetsTest/spec.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.394497 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/synthTest/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.398470 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/synthTest/soln/
--rw-r--r--   0 pmawhort   (502) staff       (20)      598 2022-01-23 12:24:36.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/synthTest/soln/arpeggio.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      772 2022-04-12 09:08:25.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/synthTest/soln/test_arpeggio.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     4930 2022-04-12 09:09:46.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/synthTest/spec.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.403018 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/varsTest/
--rw-r--r--   0 pmawhort   (502) staff       (20)      154 2021-11-06 20:48:21.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/varsTest/instructions.md
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.405335 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/varsTest/soln/
--rw-r--r--   0 pmawhort   (502) staff       (20)      293 2021-11-06 20:42:15.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/varsTest/soln/vars.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      637 2021-11-07 00:00:49.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/varsTest/spec.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.089668 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.455016 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/
--rw-r--r--   0 pmawhort   (502) staff       (20)      113 2021-07-15 13:04:17.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test-initial-debugTest-info.json
--rw-r--r--   0 pmawhort   (502) staff       (20)      117 2021-08-23 11:29:33.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test-initial-functionsTest-info.json
--rw-r--r--   0 pmawhort   (502) staff       (20)      119 2021-07-03 14:38:55.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test-initial-interactiveTest-info.json
--rw-r--r--   0 pmawhort   (502) staff       (20)      113 2021-08-23 10:34:55.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test-initial-sceneTest-info.json
--rw-r--r--   0 pmawhort   (502) staff       (20)      116 2021-08-23 10:36:05.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test-initial-snippetsTest-info.json
--rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-15 13:04:17.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1099 2021-07-03 14:25:58.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_1.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1099 2021-07-03 14:36:13.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_2.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-03 14:36:38.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_3.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-04 00:26:19.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_4.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-15 05:43:23.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_5.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-15 07:17:04.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_6.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-15 07:45:35.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_7.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     1391 2021-08-23 11:29:33.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_functions.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      979 2021-07-03 14:40:05.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_functions_1.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      799 2021-07-03 14:38:55.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_interactive.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      887 2021-08-23 10:36:05.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      887 2021-08-23 09:58:23.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process_1.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      887 2021-08-23 10:01:18.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process_2.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-08-23 10:34:55.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-07-03 14:37:05.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene_1.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-07-04 00:31:39.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene_2.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-08-23 10:31:39.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene_3.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-08-23 10:33:18.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene_4.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     2737 2021-11-06 20:49:32.000000 potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/tasks.json
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.463768 potluck-eval-1.2.8/potluck/tests/
--rw-r--r--   0 pmawhort   (502) staff       (20)       90 2021-07-15 13:48:06.000000 potluck-eval-1.2.8/potluck/tests/__init__.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      261 2021-09-27 11:14:58.000000 potluck-eval-1.2.8/potluck/tests/__main__.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    10517 2022-04-14 15:00:29.000000 potluck-eval-1.2.8/potluck/tests/test_eval.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    26171 2022-04-12 09:23:26.000000 potluck-eval-1.2.8/potluck/tests/test_mast.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      545 2021-09-03 21:50:27.000000 potluck-eval-1.2.8/potluck/tests/test_time_utils.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     6557 2021-12-01 02:47:23.000000 potluck-eval-1.2.8/potluck/time_utils.py
--rw-r--r--   0 pmawhort   (502) staff       (20)     5267 2021-07-02 01:52:38.000000 potluck-eval-1.2.8/potluck/timeout.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    30553 2022-04-12 10:19:58.000000 potluck-eval-1.2.8/potluck/validation.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    16910 2022-09-10 10:12:33.000000 potluck-eval-1.2.8/potluckDelivery.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.467350 potluck-eval-1.2.8/potluck_eval.egg-info/
--rw-r--r--   0 pmawhort   (502) staff       (20)    18255 2022-09-12 19:49:59.000000 potluck-eval-1.2.8/potluck_eval.egg-info/PKG-INFO
--rw-r--r--   0 pmawhort   (502) staff       (20)     9866 2022-09-12 19:49:59.000000 potluck-eval-1.2.8/potluck_eval.egg-info/SOURCES.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)        1 2022-09-12 19:49:59.000000 potluck-eval-1.2.8/potluck_eval.egg-info/dependency_links.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)      306 2022-09-12 19:49:59.000000 potluck-eval-1.2.8/potluck_eval.egg-info/requires.txt
--rw-r--r--   0 pmawhort   (502) staff       (20)       39 2022-09-12 19:49:59.000000 potluck-eval-1.2.8/potluck_eval.egg-info/top_level.txt
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.486344 potluck-eval-1.2.8/potluck_server/
--rw-r--r--   0 pmawhort   (502) staff       (20)      354 2021-07-15 15:36:00.000000 potluck-eval-1.2.8/potluck_server/__init__.py
--rw-r--r--   0 pmawhort   (502) staff       (20)   147956 2022-09-12 14:43:48.000000 potluck-eval-1.2.8/potluck_server/app.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.493928 potluck-eval-1.2.8/potluck_server/rundir/
--rw-r--r--   0 pmawhort   (502) staff       (20)     5912 2021-10-01 08:51:14.000000 potluck-eval-1.2.8/potluck_server/rundir/potluck-redis.conf
--rw-r--r--   0 pmawhort   (502) staff       (20)       70 2021-07-15 22:25:30.000000 potluck-eval-1.2.8/potluck_server/rundir/potluck.wsgi
--rw-r--r--   0 pmawhort   (502) staff       (20)     5820 2022-08-27 21:55:30.000000 potluck-eval-1.2.8/potluck_server/rundir/ps_config.py.example
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.505020 potluck-eval-1.2.8/potluck_server/static/
--rw-r--r--   0 pmawhort   (502) staff       (20)     1572 2021-07-03 14:17:24.000000 potluck-eval-1.2.8/potluck_server/static/pot_icon.png
--rw-r--r--   0 pmawhort   (502) staff       (20)    17125 2022-09-10 11:13:50.000000 potluck-eval-1.2.8/potluck_server/static/potluck.css
--rw-r--r--   0 pmawhort   (502) staff       (20)     9523 2021-10-05 11:30:37.000000 potluck-eval-1.2.8/potluck_server/static/potluck.js
--rw-r--r--   0 pmawhort   (502) staff       (20)    84526 2022-09-07 10:02:30.000000 potluck-eval-1.2.8/potluck_server/storage.py
--rw-r--r--   0 pmawhort   (502) staff       (20)    23320 2021-09-22 12:43:05.000000 potluck-eval-1.2.8/potluck_server/sync.py
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.531736 potluck-eval-1.2.8/potluck_server/templates/
--rw-r--r--   0 pmawhort   (502) staff       (20)     3698 2021-10-04 09:31:20.000000 potluck-eval-1.2.8/potluck_server/templates/base.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)    16166 2022-09-12 15:19:05.000000 potluck-eval-1.2.8/potluck_server/templates/dashboard.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)      545 2021-07-15 05:52:44.000000 potluck-eval-1.2.8/potluck_server/templates/error.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)    14047 2022-08-28 09:07:44.000000 potluck-eval-1.2.8/potluck_server/templates/evaluate.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)     3069 2022-08-26 10:44:42.000000 potluck-eval-1.2.8/potluck_server/templates/exercise.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)      984 2021-10-05 10:41:34.000000 potluck-eval-1.2.8/potluck_server/templates/extension_manager.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)    17065 2022-08-26 23:53:59.000000 potluck-eval-1.2.8/potluck_server/templates/feedback.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)    14326 2022-01-31 16:39:00.000000 potluck-eval-1.2.8/potluck_server/templates/gradesheet.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)     1028 2022-01-05 09:53:46.000000 potluck-eval-1.2.8/potluck_server/templates/pset_extensions_form.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)     4121 2022-08-26 23:54:34.000000 potluck-eval-1.2.8/potluck_server/templates/pset_submission_form.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)     1607 2021-07-15 05:57:17.000000 potluck-eval-1.2.8/potluck_server/templates/solution.j2
--rw-r--r--   0 pmawhort   (502) staff       (20)       87 2021-07-03 02:46:58.000000 potluck-eval-1.2.8/pyproject.toml
-drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-12 19:49:59.536196 potluck-eval-1.2.8/scripts/
--rwxr-xr-x   0 pmawhort   (502) staff       (20)     6617 2022-03-17 16:50:58.000000 potluck-eval-1.2.8/scripts/potluck_eval
--rwxr-xr-x   0 pmawhort   (502) staff       (20)    21928 2022-01-09 11:11:30.000000 potluck-eval-1.2.8/scripts/potluck_tool
--rw-r--r--   0 pmawhort   (502) staff       (20)       38 2022-09-12 19:49:59.541308 potluck-eval-1.2.8/setup.cfg
--rw-r--r--   0 pmawhort   (502) staff       (20)     2035 2022-09-12 19:47:27.000000 potluck-eval-1.2.8/setup.py
--rw-r--r--   0 pmawhort   (502) staff       (20)      605 2022-08-27 17:29:56.000000 potluck-eval-1.2.8/tox.ini
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.636917 potluck-eval-1.2.9/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1585 2021-06-24 03:54:58.000000 potluck-eval-1.2.9/LICENSE.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)      724 2021-08-29 10:01:10.000000 potluck-eval-1.2.9/MANIFEST.in
+-rw-r--r--   0 pmawhort   (502) staff       (20)    18729 2022-09-16 02:25:17.636099 potluck-eval-1.2.9/PKG-INFO
+-rw-r--r--   0 pmawhort   (502) staff       (20)    17456 2022-09-16 02:08:26.000000 potluck-eval-1.2.9/README.md
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.302791 potluck-eval-1.2.9/potluck/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     2339 2021-09-04 09:59:29.000000 potluck-eval-1.2.9/potluck/__init__.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)       69 2022-09-07 10:51:40.000000 potluck-eval-1.2.9/potluck/_version.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    76177 2022-03-02 01:49:05.000000 potluck-eval-1.2.9/potluck/compare.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    12177 2021-11-03 19:57:29.000000 potluck-eval-1.2.9/potluck/context_utils.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)   107852 2022-08-27 10:32:07.000000 potluck-eval-1.2.9/potluck/contexts.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    38255 2022-01-24 20:11:36.000000 potluck-eval-1.2.9/potluck/control.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     3173 2021-11-10 18:17:45.000000 potluck-eval-1.2.9/potluck/default_config.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    19286 2022-04-15 12:44:03.000000 potluck-eval-1.2.9/potluck/explain.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     5877 2021-11-17 00:05:36.000000 potluck-eval-1.2.9/potluck/file_utils.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    72922 2022-04-14 14:11:34.000000 potluck-eval-1.2.9/potluck/harness.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    24610 2021-11-10 13:04:02.000000 potluck-eval-1.2.9/potluck/html_tools.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    15630 2022-01-19 11:46:07.000000 potluck-eval-1.2.9/potluck/load.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      969 2021-07-04 00:17:29.000000 potluck-eval-1.2.9/potluck/logging.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)   105301 2022-04-12 02:26:43.000000 potluck-eval-1.2.9/potluck/mast.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     2289 2021-07-02 02:08:49.000000 potluck-eval-1.2.9/potluck/mast_utils.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    21413 2022-04-27 00:46:16.000000 potluck-eval-1.2.9/potluck/meta.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    11062 2022-04-18 14:35:49.000000 potluck-eval-1.2.9/potluck/patterns.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     2473 2022-03-10 17:52:27.000000 potluck-eval-1.2.9/potluck/phrasing.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    22250 2022-09-07 10:13:26.000000 potluck-eval-1.2.9/potluck/render.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.308100 potluck-eval-1.2.9/potluck/resources/
+-rw-r--r--   0 pmawhort   (502) staff       (20)    22832 2022-09-06 10:45:12.000000 potluck-eval-1.2.9/potluck/resources/potluck.css
+-rw-r--r--   0 pmawhort   (502) staff       (20)    28088 2022-09-07 10:49:42.000000 potluck-eval-1.2.9/potluck/resources/potluck.js
+-rw-r--r--   0 pmawhort   (502) staff       (20)   178114 2022-09-06 13:55:41.000000 potluck-eval-1.2.9/potluck/rubrics.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    50273 2022-03-01 23:14:05.000000 potluck-eval-1.2.9/potluck/snippets.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)   207306 2022-09-06 13:52:06.000000 potluck-eval-1.2.9/potluck/specifications.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.324344 potluck-eval-1.2.9/potluck/templates/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     3425 2022-09-07 10:47:47.000000 potluck-eval-1.2.9/potluck/templates/instructions.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)     5268 2022-01-09 12:09:47.000000 potluck-eval-1.2.9/potluck/templates/report.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)      796 2022-09-07 10:47:29.000000 potluck-eval-1.2.9/potluck/templates/rubric.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)      307 2021-09-03 00:04:41.000000 potluck-eval-1.2.9/potluck/templates/standalone_instructions.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)      328 2021-08-20 07:39:39.000000 potluck-eval-1.2.9/potluck/templates/standalone_report.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)      342 2022-01-09 12:08:53.000000 potluck-eval-1.2.9/potluck/templates/standalone_tests_report.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)     5023 2022-01-09 12:21:21.000000 potluck-eval-1.2.9/potluck/templates/tests_report.j2
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.215653 potluck-eval-1.2.9/potluck/testarea/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.215803 potluck-eval-1.2.9/potluck/testarea/test_course/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.333720 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.221115 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.218224 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.337365 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-02 03:58:01.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/debugMe.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      647 2022-04-12 09:15:38.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/test_debugMe.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.339319 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/filesTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1572 2022-04-12 09:46:37.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/filesTest/files.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.341944 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/freedomTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      405 2022-01-23 12:23:31.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/freedomTest/free.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.345487 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1012 2022-01-23 12:40:20.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/functions.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      670 2022-04-12 09:15:48.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/test_functions.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.347428 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/interactiveTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      799 2021-07-02 04:00:18.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/interactiveTest/interactive.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.349684 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/sceneTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-07-02 04:00:50.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/sceneTest/scene.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.352567 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/snippetsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      887 2021-08-19 21:51:58.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/snippetsTest/process.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.358235 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      536 2022-01-23 12:34:14.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/arpeggio.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      518 2022-04-12 09:15:42.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/test_arpeggio.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.360469 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/varsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      408 2021-11-06 20:45:49.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/varsTest/vars.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.220740 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.364585 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1099 2021-07-02 04:19:52.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/debugMe.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      647 2022-04-12 09:15:09.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/test_debugMe.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.366748 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/filesTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1591 2022-04-12 10:13:12.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/filesTest/files.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.367929 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/freedomTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      788 2022-04-12 09:15:23.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/freedomTest/free.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.371425 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1609 2022-04-12 09:15:26.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/functions.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      902 2022-04-12 09:15:32.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/test_functions.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.373349 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/interactiveTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      856 2021-06-28 21:25:08.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/interactiveTest/interactive.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.375252 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/sceneTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      355 2021-08-31 14:35:40.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/sceneTest/scene.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.377722 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/snippetsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      936 2021-08-19 21:51:50.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/snippetsTest/process.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.379533 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/varsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      335 2021-11-07 00:09:23.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/varsTest/vars.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.221320 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/runscode/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.380514 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/runscode/freedomTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      550 2022-04-12 09:16:03.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/runscode/freedomTest/free.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.223662 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.381534 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/filesTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)    56426 2021-11-04 10:21:05.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/filesTest/index.html
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.383965 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/functionsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)    92612 2021-08-28 02:11:44.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/functionsTest/index.html
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.388694 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/snippetsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)    57594 2021-08-23 10:03:39.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/snippetsTest/index.html
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.391864 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/synthTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)  1354772 2021-08-28 21:24:19.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/synthTest/index.html
+-rw-r--r--   0 pmawhort   (502) staff       (20)      178 2021-06-24 00:02:24.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/potluck-admin.json
+-rw-r--r--   0 pmawhort   (502) staff       (20)      303 2021-07-02 19:29:38.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/potluck_config.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.224955 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.410056 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmp6p2owg4g__tmp/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1605 2022-01-23 16:25:48.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmp6p2owg4g__tmp/functions.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.411817 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmpcmmo6je5__ref_tmp/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1224 2022-01-23 16:25:48.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmpcmmo6je5__ref_tmp/functions.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.414196 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmpdargdc_d__tmp/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1605 2022-01-23 18:31:51.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmpdargdc_d__tmp/functions.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.416383 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmpnuz7g0cl__ref_tmp/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1224 2022-01-23 18:31:51.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmpnuz7g0cl__ref_tmp/functions.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    76784 2022-01-23 23:01:49.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/self_printed_mast.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.226195 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.421101 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/filesTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1823 2021-11-04 10:21:05.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/filesTest/grep.part.html
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1216 2021-11-04 10:21:05.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/filesTest/listFile.part.html
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.428035 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/snippetsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     4804 2021-08-23 10:03:39.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/snippetsTest/examples.part.html
+-rw-r--r--   0 pmawhort   (502) staff       (20)      466 2021-08-23 10:03:39.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/snippetsTest/run.part.html
+-rw-r--r--   0 pmawhort   (502) staff       (20)     2424 2021-08-23 10:03:39.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/snippetsTest/vars.part.html
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.430854 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/varsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1290 2021-11-07 00:05:07.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/varsTest/vars.part.html
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.234243 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.433078 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.438007 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/soln/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1100 2021-06-28 14:05:15.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/soln/debugMe.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      647 2022-04-12 09:10:57.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/soln/test_debugMe.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     6840 2022-08-27 18:24:35.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/spec.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.442725 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/starter/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-06-28 16:34:48.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/starter/debugMe.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      647 2022-04-12 09:11:09.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/starter/test_debugMe.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.443967 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.453561 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/soln/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      139 2021-11-03 14:05:33.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/soln/birds.txt
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.455446 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/soln/dir/
+-rw-r--r--   0 pmawhort   (502) staff       (20)       53 2021-11-04 10:07:09.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/soln/dir/mammals.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1652 2022-04-12 09:49:10.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/soln/files.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      105 2021-11-03 14:05:33.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/soln/fish.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)       14 2022-04-12 09:42:56.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/soln/nums.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)       23 2022-04-12 09:43:10.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/soln/nums2.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)     3852 2022-04-12 10:16:54.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/spec.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.464230 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/starter/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      139 2021-11-03 13:54:42.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/starter/birds.txt
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.466619 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/starter/dir/
+-rw-r--r--   0 pmawhort   (502) staff       (20)       53 2021-11-04 10:07:03.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/starter/dir/mammals.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)      105 2021-11-03 13:52:43.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/starter/fish.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)       14 2022-04-12 09:48:21.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/starter/nums.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)       23 2022-04-12 09:48:21.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/starter/nums2.txt
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.468619 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/freedomTest/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.470210 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/freedomTest/soln/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      772 2022-01-23 12:20:43.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/freedomTest/soln/free.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1781 2022-01-23 12:22:08.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/freedomTest/spec.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.473991 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      569 2021-08-28 02:04:43.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/instructions.md
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.478083 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1224 2022-01-23 12:08:50.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/functions.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      671 2022-04-12 09:08:03.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/test_functions.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     8435 2022-04-12 10:21:10.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/spec.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.479493 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/starter/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      405 2021-06-22 14:15:38.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/starter/functions.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.481940 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/interactiveTest/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.484412 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/interactiveTest/soln/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      856 2021-06-28 21:33:50.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/interactiveTest/soln/interactive.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     2461 2021-09-21 23:41:14.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/interactiveTest/spec.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.485551 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.489572 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/soln/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      254 2021-06-28 16:38:25.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/soln/scene.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    31129 2021-06-28 16:36:37.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/soln/turtleBeads.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1121 2021-08-31 14:36:54.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/spec.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.492483 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/starter/
+-rw-r--r--   0 pmawhort   (502) staff       (20)    31129 2021-06-28 16:36:26.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/starter/turtleBeads.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.497545 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/snippetsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      764 2021-08-21 14:22:37.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/snippetsTest/instructions.md
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.501412 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/snippetsTest/soln/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      936 2021-08-19 10:32:07.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/snippetsTest/soln/process.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     2749 2022-04-12 10:07:59.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/snippetsTest/spec.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.502852 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/synthTest/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.507216 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/synthTest/soln/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      598 2022-01-23 12:24:36.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/synthTest/soln/arpeggio.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      772 2022-04-12 09:08:25.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/synthTest/soln/test_arpeggio.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     4930 2022-04-12 09:09:46.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/synthTest/spec.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.513479 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/varsTest/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      154 2021-11-06 20:48:21.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/varsTest/instructions.md
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.516243 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/varsTest/soln/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      293 2021-11-06 20:42:15.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/varsTest/soln/vars.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      637 2021-11-07 00:00:49.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/varsTest/spec.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.235584 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.561608 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      113 2021-07-15 13:04:17.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test-initial-debugTest-info.json
+-rw-r--r--   0 pmawhort   (502) staff       (20)      117 2021-08-23 11:29:33.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test-initial-functionsTest-info.json
+-rw-r--r--   0 pmawhort   (502) staff       (20)      119 2021-07-03 14:38:55.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test-initial-interactiveTest-info.json
+-rw-r--r--   0 pmawhort   (502) staff       (20)      113 2021-08-23 10:34:55.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test-initial-sceneTest-info.json
+-rw-r--r--   0 pmawhort   (502) staff       (20)      116 2021-08-23 10:36:05.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test-initial-snippetsTest-info.json
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-15 13:04:17.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1099 2021-07-03 14:25:58.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_1.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1099 2021-07-03 14:36:13.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_2.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-03 14:36:38.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_3.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-04 00:26:19.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_4.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-15 05:43:23.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_5.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-15 07:17:04.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_6.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1096 2021-07-15 07:45:35.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_7.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1391 2021-08-23 11:29:33.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_functions.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      979 2021-07-03 14:40:05.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_functions_1.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      799 2021-07-03 14:38:55.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_interactive.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      887 2021-08-23 10:36:05.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      887 2021-08-23 09:58:23.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process_1.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      887 2021-08-23 10:01:18.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process_2.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-08-23 10:34:55.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-07-03 14:37:05.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene_1.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-07-04 00:31:39.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene_2.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-08-23 10:31:39.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene_3.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      148 2021-08-23 10:33:18.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_scene_4.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     2737 2021-11-06 20:49:32.000000 potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/tasks.json
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.571472 potluck-eval-1.2.9/potluck/tests/
+-rw-r--r--   0 pmawhort   (502) staff       (20)       90 2021-07-15 13:48:06.000000 potluck-eval-1.2.9/potluck/tests/__init__.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      261 2021-09-27 11:14:58.000000 potluck-eval-1.2.9/potluck/tests/__main__.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    10517 2022-04-14 15:00:29.000000 potluck-eval-1.2.9/potluck/tests/test_eval.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    26171 2022-04-12 09:23:26.000000 potluck-eval-1.2.9/potluck/tests/test_mast.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      545 2021-09-03 21:50:27.000000 potluck-eval-1.2.9/potluck/tests/test_time_utils.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     6557 2021-12-01 02:47:23.000000 potluck-eval-1.2.9/potluck/time_utils.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)     5267 2021-07-02 01:52:38.000000 potluck-eval-1.2.9/potluck/timeout.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    30553 2022-04-12 10:19:58.000000 potluck-eval-1.2.9/potluck/validation.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    16910 2022-09-10 10:12:33.000000 potluck-eval-1.2.9/potluckDelivery.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.576226 potluck-eval-1.2.9/potluck_eval.egg-info/
+-rw-r--r--   0 pmawhort   (502) staff       (20)    18729 2022-09-16 02:25:17.000000 potluck-eval-1.2.9/potluck_eval.egg-info/PKG-INFO
+-rw-r--r--   0 pmawhort   (502) staff       (20)     9967 2022-09-16 02:25:17.000000 potluck-eval-1.2.9/potluck_eval.egg-info/SOURCES.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)        1 2022-09-16 02:25:17.000000 potluck-eval-1.2.9/potluck_eval.egg-info/dependency_links.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)      306 2022-09-16 02:25:17.000000 potluck-eval-1.2.9/potluck_eval.egg-info/requires.txt
+-rw-r--r--   0 pmawhort   (502) staff       (20)       39 2022-09-16 02:25:17.000000 potluck-eval-1.2.9/potluck_eval.egg-info/top_level.txt
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.584238 potluck-eval-1.2.9/potluck_server/
+-rw-r--r--   0 pmawhort   (502) staff       (20)      354 2021-07-15 15:36:00.000000 potluck-eval-1.2.9/potluck_server/__init__.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)   158216 2022-09-16 00:52:45.000000 potluck-eval-1.2.9/potluck_server/app.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.590351 potluck-eval-1.2.9/potluck_server/rundir/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     5912 2021-10-01 08:51:14.000000 potluck-eval-1.2.9/potluck_server/rundir/potluck-redis.conf
+-rw-r--r--   0 pmawhort   (502) staff       (20)       70 2021-07-15 22:25:30.000000 potluck-eval-1.2.9/potluck_server/rundir/potluck.wsgi
+-rw-r--r--   0 pmawhort   (502) staff       (20)     5908 2022-09-15 14:42:10.000000 potluck-eval-1.2.9/potluck_server/rundir/ps_config.py.example
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.597239 potluck-eval-1.2.9/potluck_server/static/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1572 2021-07-03 14:17:24.000000 potluck-eval-1.2.9/potluck_server/static/pot_icon.png
+-rw-r--r--   0 pmawhort   (502) staff       (20)    18685 2022-09-16 02:19:53.000000 potluck-eval-1.2.9/potluck_server/static/potluck.css
+-rw-r--r--   0 pmawhort   (502) staff       (20)    11128 2022-09-16 02:07:27.000000 potluck-eval-1.2.9/potluck_server/static/potluck.js
+-rw-r--r--   0 pmawhort   (502) staff       (20)    85107 2022-09-15 14:57:08.000000 potluck-eval-1.2.9/potluck_server/storage.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)    23320 2021-09-22 12:43:05.000000 potluck-eval-1.2.9/potluck_server/sync.py
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.627645 potluck-eval-1.2.9/potluck_server/templates/
+-rw-r--r--   0 pmawhort   (502) staff       (20)     4247 2022-09-16 00:24:12.000000 potluck-eval-1.2.9/potluck_server/templates/base.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)    16980 2022-09-16 02:13:33.000000 potluck-eval-1.2.9/potluck_server/templates/dashboard.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)      545 2021-07-15 05:52:44.000000 potluck-eval-1.2.9/potluck_server/templates/error.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)    14047 2022-08-28 09:07:44.000000 potluck-eval-1.2.9/potluck_server/templates/evaluate.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)     3423 2022-09-15 16:36:24.000000 potluck-eval-1.2.9/potluck_server/templates/exercise.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1139 2022-09-16 02:02:39.000000 potluck-eval-1.2.9/potluck_server/templates/exercise_extensions_form.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)     7222 2022-09-16 02:16:19.000000 potluck-eval-1.2.9/potluck_server/templates/exercise_gradesheet.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1303 2022-09-16 01:29:18.000000 potluck-eval-1.2.9/potluck_server/templates/extension_manager.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)    17065 2022-08-26 23:53:59.000000 potluck-eval-1.2.9/potluck_server/templates/feedback.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)    14328 2022-09-15 18:07:49.000000 potluck-eval-1.2.9/potluck_server/templates/gradesheet.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1746 2022-09-16 02:03:44.000000 potluck-eval-1.2.9/potluck_server/templates/pset_extensions_form.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)     4121 2022-08-26 23:54:34.000000 potluck-eval-1.2.9/potluck_server/templates/pset_submission_form.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)     1607 2021-07-15 05:57:17.000000 potluck-eval-1.2.9/potluck_server/templates/solution.j2
+-rw-r--r--   0 pmawhort   (502) staff       (20)       87 2021-07-03 02:46:58.000000 potluck-eval-1.2.9/pyproject.toml
+drwxr-xr-x   0 pmawhort   (502) staff       (20)        0 2022-09-16 02:25:17.632193 potluck-eval-1.2.9/scripts/
+-rwxr-xr-x   0 pmawhort   (502) staff       (20)     6617 2022-03-17 16:50:58.000000 potluck-eval-1.2.9/scripts/potluck_eval
+-rwxr-xr-x   0 pmawhort   (502) staff       (20)    21928 2022-01-09 11:11:30.000000 potluck-eval-1.2.9/scripts/potluck_tool
+-rw-r--r--   0 pmawhort   (502) staff       (20)       38 2022-09-16 02:25:17.637147 potluck-eval-1.2.9/setup.cfg
+-rw-r--r--   0 pmawhort   (502) staff       (20)     2035 2022-09-15 09:51:31.000000 potluck-eval-1.2.9/setup.py
+-rw-r--r--   0 pmawhort   (502) staff       (20)      605 2022-08-27 17:29:56.000000 potluck-eval-1.2.9/tox.ini
```

### Comparing `potluck-eval-1.2.8/LICENSE.txt` & `potluck-eval-1.2.9/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/MANIFEST.in` & `potluck-eval-1.2.9/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/PKG-INFO` & `potluck-eval-1.2.9/PKG-INFO`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: potluck-eval
-Version: 1.2.8
+Version: 1.2.9
 Summary: Python code evaluation system and submissions server capable of unit tests, tracing, and AST inspection. Server can run on Python 2.7 but evaluation requires 3.7+.
 Home-page: https://cs.wellesley.edu/~pmwh/potluck/docs/
 Author: Peter Mawhorter
 Author-email: pmawhort@wellesley.edu
 License: BSD 3-Clause License
 Classifier: Programming Language :: Python :: 3 :: Only
 Classifier: Development Status :: 3 - Alpha
@@ -295,18 +295,25 @@
 code, or compile it yourself if you've got `make` and `pdoc` installed by
 running the `make docs` script on the command-line (note that shenanigans
 are necessary to prevent pdoc from trying to import the test
 submissions).
 
 ## Changelog
 
+- `potluck_eval` version 1.2.9 ensures that the exercises route displays
+  exercises for the target user, not the logged-in user. Also adds a
+  mechanism for hiding psets from the dashboard via tasks.json. Also adds
+  extension management for exercises, and factors deadlines into points
+  calculations for exercises. Also adds exercise IDs to the dashboard.
 - `potluck_eval` version 1.2.8 fixes an integer-point division issue in
   computing credit fractions when running the server on Python 2. It also
   adds solution links for exercise groups to be displayed only after the
-  deadline to those who have a "complete" or better evaluation.
+  deadline to those who have a "complete" or better evaluation. Added
+  gradesheet views for exercise groups. Added +/- 24-hour buttons for
+  extensions in the extension manager.
 - `potluck_eval` version 1.2.7 adds a stderr error message to the
   potluckDelivery output when the server indicates that a submission is
   not complete, and redirects GET requests to `route_deliver` to the
   dashboard. It also adds percentages to the dashboard for exercise
   groups, updates the exercise format within exercise groups in
   tasks.json to a list of dictionaries so that ordering is preserved. The
   former dictionary-of-exercises format won't crash things but isn't
```

### Comparing `potluck-eval-1.2.8/README.md` & `potluck-eval-1.2.9/README.md`

 * *Files 3% similar despite different names*

```diff
@@ -257,18 +257,25 @@
 code, or compile it yourself if you've got `make` and `pdoc` installed by
 running the `make docs` script on the command-line (note that shenanigans
 are necessary to prevent pdoc from trying to import the test
 submissions).
 
 ## Changelog
 
+- `potluck_eval` version 1.2.9 ensures that the exercises route displays
+  exercises for the target user, not the logged-in user. Also adds a
+  mechanism for hiding psets from the dashboard via tasks.json. Also adds
+  extension management for exercises, and factors deadlines into points
+  calculations for exercises. Also adds exercise IDs to the dashboard.
 - `potluck_eval` version 1.2.8 fixes an integer-point division issue in
   computing credit fractions when running the server on Python 2. It also
   adds solution links for exercise groups to be displayed only after the
-  deadline to those who have a "complete" or better evaluation.
+  deadline to those who have a "complete" or better evaluation. Added
+  gradesheet views for exercise groups. Added +/- 24-hour buttons for
+  extensions in the extension manager.
 - `potluck_eval` version 1.2.7 adds a stderr error message to the
   potluckDelivery output when the server indicates that a submission is
   not complete, and redirects GET requests to `route_deliver` to the
   dashboard. It also adds percentages to the dashboard for exercise
   groups, updates the exercise format within exercise groups in
   tasks.json to a list of dictionaries so that ordering is preserved. The
   former dictionary-of-exercises format won't crash things but isn't
```

### Comparing `potluck-eval-1.2.8/potluck/__init__.py` & `potluck-eval-1.2.9/potluck/__init__.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/compare.py` & `potluck-eval-1.2.9/potluck/compare.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/context_utils.py` & `potluck-eval-1.2.9/potluck/context_utils.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/contexts.py` & `potluck-eval-1.2.9/potluck/contexts.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/control.py` & `potluck-eval-1.2.9/potluck/control.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/default_config.py` & `potluck-eval-1.2.9/potluck/default_config.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/explain.py` & `potluck-eval-1.2.9/potluck/explain.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/file_utils.py` & `potluck-eval-1.2.9/potluck/file_utils.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/harness.py` & `potluck-eval-1.2.9/potluck/harness.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/html_tools.py` & `potluck-eval-1.2.9/potluck/html_tools.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/load.py` & `potluck-eval-1.2.9/potluck/load.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/logging.py` & `potluck-eval-1.2.9/potluck/logging.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/mast.py` & `potluck-eval-1.2.9/potluck/mast.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/mast_utils.py` & `potluck-eval-1.2.9/potluck/mast_utils.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/meta.py` & `potluck-eval-1.2.9/potluck/meta.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/patterns.py` & `potluck-eval-1.2.9/potluck/patterns.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/phrasing.py` & `potluck-eval-1.2.9/potluck/phrasing.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/render.py` & `potluck-eval-1.2.9/potluck/render.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/resources/potluck.css` & `potluck-eval-1.2.9/potluck/resources/potluck.css`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/resources/potluck.js` & `potluck-eval-1.2.9/potluck/resources/potluck.js`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/rubrics.py` & `potluck-eval-1.2.9/potluck/rubrics.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/snippets.py` & `potluck-eval-1.2.9/potluck/snippets.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/specifications.py` & `potluck-eval-1.2.9/potluck/specifications.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/templates/instructions.j2` & `potluck-eval-1.2.9/potluck/templates/instructions.j2`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/templates/report.j2` & `potluck-eval-1.2.9/potluck/templates/report.j2`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/templates/rubric.j2` & `potluck-eval-1.2.9/potluck/templates/rubric.j2`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/templates/tests_report.j2` & `potluck-eval-1.2.9/potluck/templates/tests_report.j2`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/debugMe.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/debugMe.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/test_debugMe.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/debugTest/test_debugMe.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/filesTest/files.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/filesTest/files.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/test_functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/functionsTest/test_functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/interactiveTest/interactive.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/interactiveTest/interactive.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/snippetsTest/process.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/snippetsTest/process.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/arpeggio.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/arpeggio.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/test_arpeggio.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/imperfect/synthTest/test_arpeggio.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/debugMe.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/debugMe.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/test_debugMe.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/debugTest/test_debugMe.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/filesTest/files.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/filesTest/files.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/freedomTest/free.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/freedomTest/free.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/test_functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/functionsTest/test_functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/interactiveTest/interactive.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/interactiveTest/interactive.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/perfect/snippetsTest/process.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/perfect/snippetsTest/process.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/examples/runscode/freedomTest/free.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/examples/runscode/freedomTest/free.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/filesTest/index.html` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/filesTest/index.html`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/functionsTest/index.html` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/functionsTest/index.html`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/snippetsTest/index.html` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/snippetsTest/index.html`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/instructions/synthTest/index.html` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/instructions/synthTest/index.html`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmp6p2owg4g__tmp/functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmp6p2owg4g__tmp/functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmpcmmo6je5__ref_tmp/functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmpcmmo6je5__ref_tmp/functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmpdargdc_d__tmp/functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmpdargdc_d__tmp/functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/sandboxes/tmpnuz7g0cl__ref_tmp/functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/sandboxes/tmpnuz7g0cl__ref_tmp/functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/self_printed_mast.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/self_printed_mast.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/filesTest/grep.part.html` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/filesTest/grep.part.html`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/filesTest/listFile.part.html` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/filesTest/listFile.part.html`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/snippetsTest/examples.part.html` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/snippetsTest/examples.part.html`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/snippetsTest/vars.part.html` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/snippetsTest/vars.part.html`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/snippets/varsTest/vars.part.html` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/snippets/varsTest/vars.part.html`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/soln/debugMe.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/soln/debugMe.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/soln/test_debugMe.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/soln/test_debugMe.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/spec.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/spec.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/starter/debugMe.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/starter/debugMe.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/debugTest/starter/test_debugMe.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/debugTest/starter/test_debugMe.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/soln/files.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/soln/files.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/filesTest/spec.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/filesTest/spec.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/freedomTest/soln/free.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/freedomTest/soln/free.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/freedomTest/spec.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/freedomTest/spec.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/instructions.md` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/instructions.md`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/test_functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/soln/test_functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/functionsTest/spec.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/functionsTest/spec.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/interactiveTest/soln/interactive.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/interactiveTest/soln/interactive.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/interactiveTest/spec.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/interactiveTest/spec.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/soln/turtleBeads.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/soln/turtleBeads.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/spec.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/spec.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/sceneTest/starter/turtleBeads.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/sceneTest/starter/turtleBeads.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/snippetsTest/instructions.md` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/snippetsTest/instructions.md`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/snippetsTest/soln/process.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/snippetsTest/soln/process.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/snippetsTest/spec.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/snippetsTest/spec.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/synthTest/soln/arpeggio.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/synthTest/soln/arpeggio.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/synthTest/soln/test_arpeggio.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/synthTest/soln/test_arpeggio.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/synthTest/spec.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/synthTest/spec.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/specs/varsTest/spec.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/specs/varsTest/spec.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_1.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_1.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_2.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_2.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_3.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_3.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_4.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_4.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_5.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_5.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_6.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_6.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_7.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_debugMe_7.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_functions.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_functions.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_functions_1.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_functions_1.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_interactive.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_interactive.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process_1.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process_1.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process_2.py` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/submissions/test/test_initial_process_2.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/testarea/test_course/fall2021/tasks.json` & `potluck-eval-1.2.9/potluck/testarea/test_course/fall2021/tasks.json`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/tests/test_eval.py` & `potluck-eval-1.2.9/potluck/tests/test_eval.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/tests/test_mast.py` & `potluck-eval-1.2.9/potluck/tests/test_mast.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/tests/test_time_utils.py` & `potluck-eval-1.2.9/potluck/tests/test_time_utils.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/time_utils.py` & `potluck-eval-1.2.9/potluck/time_utils.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/timeout.py` & `potluck-eval-1.2.9/potluck/timeout.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck/validation.py` & `potluck-eval-1.2.9/potluck/validation.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluckDelivery.py` & `potluck-eval-1.2.9/potluckDelivery.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck_eval.egg-info/PKG-INFO` & `potluck-eval-1.2.9/potluck_eval.egg-info/PKG-INFO`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: potluck-eval
-Version: 1.2.8
+Version: 1.2.9
 Summary: Python code evaluation system and submissions server capable of unit tests, tracing, and AST inspection. Server can run on Python 2.7 but evaluation requires 3.7+.
 Home-page: https://cs.wellesley.edu/~pmwh/potluck/docs/
 Author: Peter Mawhorter
 Author-email: pmawhort@wellesley.edu
 License: BSD 3-Clause License
 Classifier: Programming Language :: Python :: 3 :: Only
 Classifier: Development Status :: 3 - Alpha
@@ -295,18 +295,25 @@
 code, or compile it yourself if you've got `make` and `pdoc` installed by
 running the `make docs` script on the command-line (note that shenanigans
 are necessary to prevent pdoc from trying to import the test
 submissions).
 
 ## Changelog
 
+- `potluck_eval` version 1.2.9 ensures that the exercises route displays
+  exercises for the target user, not the logged-in user. Also adds a
+  mechanism for hiding psets from the dashboard via tasks.json. Also adds
+  extension management for exercises, and factors deadlines into points
+  calculations for exercises. Also adds exercise IDs to the dashboard.
 - `potluck_eval` version 1.2.8 fixes an integer-point division issue in
   computing credit fractions when running the server on Python 2. It also
   adds solution links for exercise groups to be displayed only after the
-  deadline to those who have a "complete" or better evaluation.
+  deadline to those who have a "complete" or better evaluation. Added
+  gradesheet views for exercise groups. Added +/- 24-hour buttons for
+  extensions in the extension manager.
 - `potluck_eval` version 1.2.7 adds a stderr error message to the
   potluckDelivery output when the server indicates that a submission is
   not complete, and redirects GET requests to `route_deliver` to the
   dashboard. It also adds percentages to the dashboard for exercise
   groups, updates the exercise format within exercise groups in
   tasks.json to a list of dictionaries so that ordering is preserved. The
   former dictionary-of-exercises format won't crash things but isn't
```

### Comparing `potluck-eval-1.2.8/potluck_eval.egg-info/SOURCES.txt` & `potluck-eval-1.2.9/potluck_eval.egg-info/SOURCES.txt`

 * *Files 2% similar despite different names*

```diff
@@ -164,14 +164,16 @@
 potluck_server/static/potluck.css
 potluck_server/static/potluck.js
 potluck_server/templates/base.j2
 potluck_server/templates/dashboard.j2
 potluck_server/templates/error.j2
 potluck_server/templates/evaluate.j2
 potluck_server/templates/exercise.j2
+potluck_server/templates/exercise_extensions_form.j2
+potluck_server/templates/exercise_gradesheet.j2
 potluck_server/templates/extension_manager.j2
 potluck_server/templates/feedback.j2
 potluck_server/templates/gradesheet.j2
 potluck_server/templates/pset_extensions_form.j2
 potluck_server/templates/pset_submission_form.j2
 potluck_server/templates/solution.j2
 scripts/potluck_eval
```

### Comparing `potluck-eval-1.2.8/potluck_server/app.py` & `potluck-eval-1.2.9/potluck_server/app.py`

 * *Files 2% similar despite different names*

```diff
@@ -275,8974 +275,9615 @@
 00001120: 2020 2053 686f 7773 2073 7562 6d69 7474     Shows submitt
 00001130: 6564 206d 6174 6572 6961 6c20 2620 7374  ed material & st
 00001140: 6174 7573 2066 6f72 2061 6e20 6578 6572  atus for an exer
 00001150: 6369 7365 2073 7562 6d69 7373 696f 6e20  cise submission 
 00001160: 666f 7220 610a 2020 2020 7061 7274 6963  for a.    partic
 00001170: 756c 6172 2075 7365 7220 7265 6365 6976  ular user receiv
 00001180: 6564 2076 6961 2060 726f 7574 655f 6465  ed via `route_de
-00001190: 6c69 7665 7260 2e0a 2222 220a 0a23 2041  liver`.."""..# A
-000011a0: 7474 656d 7074 7320 6174 2032 2f33 2064  ttempts at 2/3 d
-000011b0: 7561 6c20 636f 6d70 6174 6962 696c 6974  ual compatibilit
-000011c0: 793a 0a66 726f 6d20 5f5f 6675 7475 7265  y:.from __future
-000011d0: 5f5f 2069 6d70 6f72 7420 7072 696e 745f  __ import print_
-000011e0: 6675 6e63 7469 6f6e 0a0a 5f5f 7665 7273  function..__vers
-000011f0: 696f 6e5f 5f20 3d20 2231 2e32 2e37 220a  ion__ = "1.2.7".
-00001200: 0a69 6d70 6f72 7420 7379 730a 0a0a 2320  .import sys...# 
-00001210: 4946 2077 6527 7265 206e 6f74 2069 6e20  IF we're not in 
-00001220: 7079 6874 6f6e 333a 0a69 6620 7379 732e  pyhton3:.if sys.
-00001230: 7665 7273 696f 6e5f 696e 666f 5b30 5d20  version_info[0] 
-00001240: 3c20 333a 0a20 2020 2072 656c 6f61 6428  < 3:.    reload(
-00001250: 7379 7329 2023 206e 6f71 6120 4638 3231  sys) # noqa F821
-00001260: 0a20 2020 2023 2053 6574 2065 7870 6c69  .    # Set expli
-00001270: 6369 7420 6465 6661 756c 7420 656e 636f  cit default enco
-00001280: 6469 6e67 0a20 2020 2073 7973 2e73 6574  ding.    sys.set
-00001290: 6465 6661 756c 7465 6e63 6f64 696e 6728  defaultencoding(
-000012a0: 2775 7466 2d38 2729 0a20 2020 2023 2052  'utf-8').    # R
-000012b0: 656e 616d 6520 7261 775f 696e 7075 740a  ename raw_input.
-000012c0: 2020 2020 696e 7075 7420 3d20 7261 775f      input = raw_
-000012d0: 696e 7075 7420 2320 6e6f 7161 2046 3832  input # noqa F82
-000012e0: 310a 2020 2020 4d6f 6475 6c65 4e6f 7446  1.    ModuleNotF
-000012f0: 6f75 6e64 5f6f 725f 496d 706f 7274 5f45  ound_or_Import_E
-00001300: 7272 6f72 203d 2049 6d70 6f72 7445 7272  rror = ImportErr
-00001310: 6f72 0a20 2020 2061 6e79 7374 7220 3d20  or.    anystr = 
-00001320: 2873 7472 2c20 756e 6963 6f64 6529 2023  (str, unicode) #
-00001330: 206e 6f71 6120 4638 3231 0a65 6c73 653a   noqa F821.else:
-00001340: 0a20 2020 204d 6f64 756c 654e 6f74 466f  .    ModuleNotFo
-00001350: 756e 645f 6f72 5f49 6d70 6f72 745f 4572  und_or_Import_Er
-00001360: 726f 7220 3d20 4d6f 6475 6c65 4e6f 7446  ror = ModuleNotF
-00001370: 6f75 6e64 4572 726f 720a 2020 2020 616e  oundError.    an
-00001380: 7973 7472 203d 2028 7374 722c 2062 7974  ystr = (str, byt
-00001390: 6573 290a 0a0a 6465 6620 656e 7375 7265  es)...def ensure
-000013a0: 5f64 6972 6563 746f 7279 2874 6172 6765  _directory(targe
-000013b0: 7429 3a0a 2020 2020 2222 220a 2020 2020  t):.    """.    
-000013c0: 6d61 6b65 6469 7273 2032 2f33 2073 6869  makedirs 2/3 shi
-000013d0: 6d2e 0a20 2020 2022 2222 0a20 2020 2069  m..    """.    i
-000013e0: 6620 7379 732e 7665 7273 696f 6e5f 696e  f sys.version_in
-000013f0: 666f 5b30 5d20 3c20 333a 0a20 2020 2020  fo[0] < 3:.     
-00001400: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00001410: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
-00001420: 7461 7267 6574 290a 2020 2020 2020 2020  target).        
-00001430: 6578 6365 7074 204f 5345 7272 6f72 3a0a  except OSError:.
-00001440: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00001450: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00001460: 2020 206f 732e 6d61 6b65 6469 7273 2874     os.makedirs(t
-00001470: 6172 6765 742c 2065 7869 7374 5f6f 6b3d  arget, exist_ok=
-00001480: 5472 7565 290a 0a0a 2320 4d61 696e 2069  True)...# Main i
-00001490: 6d70 6f72 7473 0a69 6d70 6f72 7420 6f73  mports.import os
-000014a0: 2c20 7375 6270 726f 6365 7373 2c20 7368  , subprocess, sh
-000014b0: 7574 696c 2023 206e 6f71 6120 4534 3032  util # noqa E402
-000014c0: 0a69 6d70 6f72 7420 6461 7465 7469 6d65  .import datetime
-000014d0: 2c20 7469 6d65 2c20 7261 6e64 6f6d 2c20  , time, random, 
-000014e0: 636f 7079 2c20 6373 762c 2072 6520 2320  copy, csv, re # 
-000014f0: 6e6f 7161 2045 3430 320a 696d 706f 7274  noqa E402.import
-00001500: 207a 6970 6669 6c65 2023 206e 6f71 6120   zipfile # noqa 
-00001510: 4534 3032 0a0a 696d 706f 7274 2066 6c61  E402..import fla
-00001520: 736b 2023 206e 6f71 6120 4534 3032 0a69  sk # noqa E402.i
-00001530: 6d70 6f72 7420 666c 6173 6b5f 6361 7320  mport flask_cas 
-00001540: 2320 6e6f 7161 2045 3430 320a 696d 706f  # noqa E402.impo
-00001550: 7274 206a 696e 6a61 3220 2320 6e6f 7161  rt jinja2 # noqa
-00001560: 2045 3430 320a 696d 706f 7274 2062 7334   E402.import bs4
-00001570: 2023 206e 6f71 6120 4534 3032 0a69 6d70   # noqa E402.imp
-00001580: 6f72 7420 7765 726b 7a65 7567 2023 206e  ort werkzeug # n
-00001590: 6f71 6120 4534 3032 0a0a 6672 6f6d 2066  oqa E402..from f
-000015a0: 6c61 736b 2069 6d70 6f72 7420 6a73 6f6e  lask import json
-000015b0: 2023 206e 6f71 6120 4534 3032 0a0a 6672   # noqa E402..fr
-000015c0: 6f6d 202e 2069 6d70 6f72 7420 7374 6f72  om . import stor
-000015d0: 6167 6520 2320 6e6f 7161 2045 3430 320a  age # noqa E402.
-000015e0: 0a23 204c 6f61 6420 706f 746c 7563 6b20  .# Load potluck 
-000015f0: 6d6f 6475 6c65 733a 0a69 6d70 6f72 7420  modules:.import 
-00001600: 706f 746c 7563 6b2e 7265 6e64 6572 2023  potluck.render #
-00001610: 206e 6f71 613a 2045 3430 320a 696d 706f   noqa: E402.impo
-00001620: 7274 2070 6f74 6c75 636b 2e68 746d 6c5f  rt potluck.html_
-00001630: 746f 6f6c 7320 2320 6e6f 7161 3a20 4534  tools # noqa: E4
-00001640: 3032 0a69 6d70 6f72 7420 706f 746c 7563  02.import potluc
-00001650: 6b2e 7469 6d65 5f75 7469 6c73 2023 206e  k.time_utils # n
-00001660: 6f71 613a 2045 3430 320a 0a0a 2320 4c6f  oqa: E402...# Lo
-00001670: 6f6b 2066 6f72 2073 6166 655f 6a6f 696e  ok for safe_join
-00001680: 2062 6f74 6820 696e 2066 6c61 736b 2061   both in flask a
-00001690: 6e64 2069 6e20 7765 726b 7a65 7567 2e2e  nd in werkzeug..
-000016a0: 2e0a 6966 2068 6173 6174 7472 2866 6c61  ..if hasattr(fla
-000016b0: 736b 2c20 2273 6166 655f 6a6f 696e 2229  sk, "safe_join")
-000016c0: 3a0a 2020 2020 7361 6665 5f6a 6f69 6e20  :.    safe_join 
-000016d0: 3d20 666c 6173 6b2e 7361 6665 5f6a 6f69  = flask.safe_joi
-000016e0: 6e0a 656c 6966 2068 6173 6174 7472 2877  n.elif hasattr(w
-000016f0: 6572 6b7a 6575 672e 7574 696c 732c 2022  erkzeug.utils, "
-00001700: 7361 6665 5f6a 6f69 6e22 293a 0a20 2020  safe_join"):.   
-00001710: 2073 6166 655f 6a6f 696e 203d 2077 6572   safe_join = wer
-00001720: 6b7a 6575 672e 7574 696c 732e 7361 6665  kzeug.utils.safe
-00001730: 5f6a 6f69 6e0a 656c 7365 3a0a 2020 2020  _join.else:.    
-00001740: 7072 696e 7428 0a20 2020 2020 2020 2022  print(.        "
-00001750: 5761 726e 696e 673a 2073 6166 655f 6a6f  Warning: safe_jo
-00001760: 696e 2077 6173 206e 6f74 2066 6f75 6e64  in was not found
-00001770: 2069 6e20 6569 7468 6572 2066 6c61 736b   in either flask
-00001780: 204f 5222 0a20 2020 2020 2020 2022 2077   OR".        " w
-00001790: 6572 6b7a 6575 672e 7574 696c 733b 2075  erkzeug.utils; u
-000017a0: 7369 6e67 2061 6e20 756e 7361 6665 2066  sing an unsafe f
-000017b0: 756e 6374 696f 6e20 696e 7374 6561 642e  unction instead.
-000017c0: 220a 2020 2020 290a 2020 2020 7361 6665  ".    ).    safe
-000017d0: 5f6a 6f69 6e20 3d20 6c61 6d62 6461 202a  _join = lambda *
-000017e0: 6172 6773 3a20 6f73 2e70 6174 682e 6a6f  args: os.path.jo
-000017f0: 696e 282a 6172 6773 290a 0a0a 232d 2d2d  in(*args)...#---
-00001800: 2d2d 2d2d 2d2d 2d2d 2d2d 230a 2320 5365  ----------#.# Se
-00001810: 7475 7020 7365 7475 7020 230a 232d 2d2d  tup setup #.#---
-00001820: 2d2d 2d2d 2d2d 2d2d 2d2d 230a 0a63 6c61  ----------#..cla
-00001830: 7373 2049 6e69 7441 7070 2866 6c61 736b  ss InitApp(flask
-00001840: 2e46 6c61 736b 293a 0a20 2020 2022 2222  .Flask):.    """
-00001850: 0a20 2020 2041 2046 6c61 736b 2061 7070  .    A Flask app
-00001860: 2073 7562 636c 6173 7320 7768 6963 6820   subclass which 
-00001870: 7275 6e73 2069 6e69 7469 616c 697a 6174  runs initializat
-00001880: 696f 6e20 6675 6e63 7469 6f6e 7320 7269  ion functions ri
-00001890: 6768 740a 2020 2020 6265 666f 7265 2061  ght.    before a
-000018a0: 7070 2073 7461 7274 7570 2e0a 2020 2020  pp startup..    
-000018b0: 2222 220a 2020 2020 6465 6620 5f5f 696e  """.    def __in
-000018c0: 6974 5f5f 2873 656c 662c 202a 6172 6773  it__(self, *args
-000018d0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-000018e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000018f0: 2041 7267 756d 656e 7473 2061 7265 2070   Arguments are p
-00001900: 6173 7365 6420 7468 726f 7567 6820 746f  assed through to
-00001910: 2066 6c61 736b 2e46 6c61 736b 2e5f 5f69   flask.Flask.__i
-00001920: 6e69 745f 5f2e 0a20 2020 2020 2020 2022  nit__..        "
-00001930: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-00001940: 6163 7469 6f6e 7320 3d20 5b5d 0a20 2020  actions = [].   
-00001950: 2020 2020 2023 204e 6f74 653a 2077 6520       # Note: we 
-00001960: 646f 6e27 7420 7573 6520 7375 7065 7228  don't use super(
-00001970: 2920 6865 7265 2073 696e 6365 2032 2f33  ) here since 2/3
-00001980: 2063 6f6d 7061 7469 6269 6c69 7479 2069   compatibility i
-00001990: 730a 2020 2020 2020 2020 2320 746f 6f20  s.        # too 
-000019a0: 6861 7264 2074 6f20 6669 6775 7265 206f  hard to figure o
-000019b0: 7574 0a20 2020 2020 2020 2066 6c61 736b  ut.        flask
-000019c0: 2e46 6c61 736b 2e5f 5f69 6e69 745f 5f28  .Flask.__init__(
-000019d0: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-000019e0: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
-000019f0: 696e 6974 2873 656c 662c 2061 6374 696f  init(self, actio
-00001a00: 6e29 3a0a 2020 2020 2020 2020 2222 220a  n):.        """.
-00001a10: 2020 2020 2020 2020 5265 6769 7374 6572          Register
-00001a20: 7320 616e 2069 6e69 7420 6163 7469 6f6e  s an init action
-00001a30: 2028 6120 6675 6e63 7469 6f6e 2077 6869   (a function whi
-00001a40: 6368 2077 696c 6c20 6265 2067 6976 656e  ch will be given
-00001a50: 2074 6865 2061 7070 0a20 2020 2020 2020   the app.       
-00001a60: 206f 626a 6563 7420 6173 2069 7473 206f   object as its o
-00001a70: 6e6c 7920 6172 6775 6d65 6e74 292e 2054  nly argument). T
-00001a80: 6865 7365 2066 756e 6374 696f 6e73 2077  hese functions w
-00001a90: 696c 6c20 6561 6368 2062 650a 2020 2020  ill each be.    
-00001aa0: 2020 2020 6361 6c6c 6564 2c20 696e 206f      called, in o
-00001ab0: 7264 6572 206f 6620 7265 6769 7374 7261  rder of registra
-00001ac0: 7469 6f6e 2c20 7269 6768 7420 6265 666f  tion, right befo
-00001ad0: 7265 2074 6865 2061 7070 2073 7461 7274  re the app start
-00001ae0: 732c 0a20 2020 2020 2020 2077 6974 6865  s,.        withe
-00001af0: 2074 6865 2061 7070 5f63 6f6e 7465 7874   the app_context
-00001b00: 2061 6374 6976 652e 2052 6574 7572 6e73   active. Returns
-00001b10: 2074 6865 2061 6374 696f 6e20 6675 6e63   the action func
-00001b20: 7469 6f6e 0a20 2020 2020 2020 2070 726f  tion.        pro
-00001b30: 7669 6465 642c 2073 6f20 7468 6174 2069  vided, so that i
-00001b40: 7420 6361 6e20 6265 2075 7365 6420 6173  t can be used as
-00001b50: 2061 2064 6563 6f72 6174 6f72 2c20 6c69   a decorator, li
-00001b60: 6b65 2073 6f3a 0a0a 2020 2020 2020 2020  ke so:..        
-00001b70: 6060 6070 790a 2020 2020 2020 2020 4061  ```py.        @a
-00001b80: 7070 2e69 6e69 740a 2020 2020 2020 2020  pp.init.        
-00001b90: 6465 6620 7365 7475 705f 736f 6d65 5f73  def setup_some_s
-00001ba0: 7475 6666 2861 7070 293a 0a20 2020 2020  tuff(app):.     
-00001bb0: 2020 2020 2020 202e 2e2e 0a20 2020 2020         ....     
-00001bc0: 2020 2060 6060 0a20 2020 2020 2020 2022     ```.        "
-00001bd0: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-00001be0: 6163 7469 6f6e 732e 6170 7065 6e64 2861  actions.append(a
-00001bf0: 6374 696f 6e29 0a20 2020 2020 2020 2072  ction).        r
-00001c00: 6574 7572 6e20 6163 7469 6f6e 0a0a 2020  eturn action..  
-00001c10: 2020 6465 6620 7365 7475 7028 7365 6c66    def setup(self
-00001c20: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00001c30: 2020 2020 2020 2052 756e 7320 616c 6c20         Runs all 
-00001c40: 7265 6769 7374 6572 6564 2069 6e69 7469  registered initi
-00001c50: 616c 697a 6174 696f 6e20 6163 7469 6f6e  alization action
-00001c60: 732e 2049 6620 796f 7527 7265 206e 6f74  s. If you're not
-00001c70: 2072 756e 6e69 6e67 0a20 2020 2020 2020   running.       
-00001c80: 2061 2064 6562 7567 6769 6e67 2073 6574   a debugging set
-00001c90: 7570 2076 6961 2074 6865 2060 7275 6e60  up via the `run`
-00001ca0: 206d 6574 686f 642c 2079 6f75 276c 6c20   method, you'll 
-00001cb0: 6e65 6564 2074 6f20 6361 6c6c 2074 6869  need to call thi
-00001cc0: 730a 2020 2020 2020 2020 6d65 7468 6f64  s.        method
-00001cd0: 2079 6f75 7273 656c 6620 2865 2e67 2e2c   yourself (e.g.,
-00001ce0: 2069 6e20 6120 2e77 7367 6920 6669 6c65   in a .wsgi file
-00001cf0: 292e 0a20 2020 2020 2020 2022 2222 0a20  )..        """. 
-00001d00: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00001d10: 2e61 7070 5f63 6f6e 7465 7874 2829 3a0a  .app_context():.
-00001d20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00001d30: 6163 7469 6f6e 2069 6e20 7365 6c66 2e61  action in self.a
-00001d40: 6374 696f 6e73 3a0a 2020 2020 2020 2020  ctions:.        
-00001d50: 2020 2020 2020 2020 6163 7469 6f6e 2873          action(s
-00001d60: 656c 6629 0a0a 2020 2020 6465 6620 7275  elf)..    def ru
-00001d70: 6e28 7365 6c66 2c20 2a61 7267 732c 202a  n(self, *args, *
-00001d80: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-00001d90: 2020 2222 220a 2020 2020 2020 2020 4f76    """.        Ov
-00001da0: 6572 7269 6464 656e 2072 756e 206d 6574  erridden run met
-00001db0: 686f 6420 7275 6e73 206f 7572 2063 7573  hod runs our cus
-00001dc0: 746f 6d20 696e 6974 2061 6374 696f 6e73  tom init actions
-00001dd0: 2077 6974 6820 7468 6520 6170 700a 2020   with the app.  
-00001de0: 2020 2020 2020 636f 6e74 6578 7420 6669        context fi
-00001df0: 7273 742e 0a20 2020 2020 2020 2022 2222  rst..        """
-00001e00: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
-00001e10: 7475 7028 290a 2020 2020 2020 2020 2320  tup().        # 
-00001e20: 4e6f 7465 3a20 7765 2064 6f6e 2774 2075  Note: we don't u
-00001e30: 7365 2073 7570 6572 2829 2068 6572 6520  se super() here 
-00001e40: 7369 6e63 6520 322f 3320 636f 6d70 6174  since 2/3 compat
-00001e50: 6962 696c 6974 7920 6973 0a20 2020 2020  ibility is.     
-00001e60: 2020 2023 2074 6f6f 2068 6172 6420 746f     # too hard to
-00001e70: 2066 6967 7572 6520 6f75 740a 2020 2020   figure out.    
-00001e80: 2020 2020 666c 6173 6b2e 466c 6173 6b2e      flask.Flask.
-00001e90: 7275 6e28 7365 6c66 2c20 2a61 7267 732c  run(self, *args,
-00001ea0: 202a 2a6b 7761 7267 7329 0a0a 0a23 2d2d   **kwargs)...#--
-00001eb0: 2d2d 2d2d 2d23 0a23 2053 6574 7570 2023  -----#.# Setup #
-00001ec0: 0a23 2d2d 2d2d 2d2d 2d23 0a0a 2320 4372  .#-------#..# Cr
-00001ed0: 6561 7465 206f 7572 2061 7070 206f 626a  eate our app obj
-00001ee0: 6563 743a 0a61 7070 203d 2049 6e69 7441  ect:.app = InitA
-00001ef0: 7070 2822 706f 746c 7563 6b5f 7365 7276  pp("potluck_serv
-00001f00: 6572 2229 0a0a 0a23 2044 6566 6175 6c74  er")...# Default
-00001f10: 2063 6f6e 6669 6775 7261 7469 6f6e 2076   configuration v
-00001f20: 616c 7565 7320 6966 2077 6520 7265 616c  alues if we real
-00001f30: 6c79 2063 616e 2774 2066 696e 6420 6120  ly can't find a 
-00001f40: 636f 6e66 6967 2066 696c 650a 4445 4641  config file.DEFA
-00001f50: 554c 545f 434f 4e46 4947 203d 207b 0a20  ULT_CONFIG = {. 
-00001f60: 2020 2022 4556 414c 5541 5449 4f4e 5f42     "EVALUATION_B
-00001f70: 4153 4522 3a20 272e 272c 0a20 2020 2022  ASE": '.',.    "
-00001f80: 504f 544c 5543 4b5f 4556 414c 5f50 5954  POTLUCK_EVAL_PYT
-00001f90: 484f 4e22 3a20 4e6f 6e65 2c0a 2020 2020  HON": None,.    
-00001fa0: 2250 4f54 4c55 434b 5f45 5641 4c5f 5343  "POTLUCK_EVAL_SC
-00001fb0: 5249 5054 223a 204e 6f6e 652c 0a20 2020  RIPT": None,.   
-00001fc0: 2022 504f 544c 5543 4b5f 4556 414c 5f49   "POTLUCK_EVAL_I
-00001fd0: 4d50 4f52 545f 4652 4f4d 223a 204e 6f6e  MPORT_FROM": Non
-00001fe0: 652c 0a20 2020 2022 434f 5552 5345 5f4e  e,.    "COURSE_N
-00001ff0: 414d 4553 223a 207b 2027 7465 7374 5f63  AMES": { 'test_c
-00002000: 6f75 7273 6527 3a20 2754 4553 5420 434f  ourse': 'TEST CO
-00002010: 5552 5345 2720 7d2c 0a20 2020 2022 4445  URSE' },.    "DE
-00002020: 4641 554c 545f 434f 5552 5345 223a 2027  FAULT_COURSE": '
-00002030: 7465 7374 5f63 6f75 7273 6527 2c0a 2020  test_course',.  
-00002040: 2020 2244 4546 4155 4c54 5f53 454d 4553    "DEFAULT_SEMES
-00002050: 5445 5222 3a20 2766 616c 6c32 3032 3127  TER": 'fall2021'
-00002060: 2c0a 2020 2020 2253 5550 504f 5254 5f45  ,.    "SUPPORT_E
-00002070: 4d41 494c 223a 2027 7573 6572 6e61 6d65  MAIL": 'username
-00002080: 4065 7861 6d70 6c65 2e63 6f6d 272c 0a20  @example.com',. 
-00002090: 2020 2022 5355 5050 4f52 545f 4c49 4e4b     "SUPPORT_LINK
-000020a0: 223a 2027 3c61 2068 7265 663d 226d 6169  ": '<a href="mai
-000020b0: 6c74 6f3a 7573 6572 6e61 6d65 4065 7861  lto:username@exa
-000020c0: 6d70 6c65 2e63 6f6d 223e 5573 6572 204e  mple.com">User N
-000020d0: 616d 653c 2f61 3e27 2c0a 2020 2020 224e  ame</a>',.    "N
-000020e0: 4f5f 4445 4255 475f 5353 4c22 3a20 4661  O_DEBUG_SSL": Fa
-000020f0: 6c73 652c 0a20 2020 2022 4341 535f 5345  lse,.    "CAS_SE
-00002100: 5256 4552 223a 2027 6874 7470 733a 2f2f  RVER": 'https://
-00002110: 6c6f 6769 6e2e 6578 616d 706c 652e 636f  login.example.co
-00002120: 6d3a 3434 3327 2c0a 2020 2020 2243 4153  m:443',.    "CAS
-00002130: 5f41 4654 4552 5f4c 4f47 494e 223a 2027  _AFTER_LOGIN": '
-00002140: 6461 7368 626f 6172 6427 2c0a 2020 2020  dashboard',.    
-00002150: 2243 4153 5f4c 4f47 494e 5f52 4f55 5445  "CAS_LOGIN_ROUTE
-00002160: 223a 2027 2f6d 6f64 756c 652e 7068 702f  ": '/module.php/
-00002170: 6361 7373 6572 7665 722f 6361 732e 7068  casserver/cas.ph
-00002180: 702f 6c6f 6769 6e27 2c0a 2020 2020 2243  p/login',.    "C
-00002190: 4153 5f4c 4f47 4f55 545f 524f 5554 4522  AS_LOGOUT_ROUTE"
-000021a0: 3a20 272f 6d6f 6475 6c65 2e70 6870 2f63  : '/module.php/c
-000021b0: 6173 7365 7276 6572 2f63 6173 2e70 6870  asserver/cas.php
-000021c0: 2f6c 6f67 6f75 7427 2c0a 2020 2020 2243  /logout',.    "C
-000021d0: 4153 5f41 4654 4552 5f4c 4f47 4f55 5422  AS_AFTER_LOGOUT"
-000021e0: 3a20 2768 7474 7073 3a2f 2f65 7861 6d70  : 'https://examp
-000021f0: 6c65 2e63 6f6d 2f70 6f74 6c75 636b 272c  le.com/potluck',
-00002200: 0a20 2020 2022 4341 535f 5641 4c49 4441  .    "CAS_VALIDA
-00002210: 5445 5f52 4f55 5445 223a 2027 2f6d 6f64  TE_ROUTE": '/mod
-00002220: 756c 652e 7068 702f 6361 7373 6572 7665  ule.php/casserve
-00002230: 722f 7365 7276 6963 6556 616c 6964 6174  r/serviceValidat
-00002240: 652e 7068 7027 2c0a 2020 2020 2250 5345  e.php',.    "PSE
-00002250: 545f 5552 4c53 223a 207b 0a20 2020 2020  T_URLS": {.     
-00002260: 2020 2027 7465 7374 5f63 6f75 7273 6527     'test_course'
-00002270: 3a20 280a 2020 2020 2020 2020 2020 2020  : (.            
-00002280: 2768 7474 7073 3a2f 2f65 7861 6d70 6c65  'https://example
-00002290: 2e63 6f6d 2f61 7263 6869 7665 2f74 6573  .com/archive/tes
-000022a0: 745f 636f 7572 7365 5f7b 7365 6d65 7374  t_course_{semest
-000022b0: 6572 7d2f 270a 2020 2020 2020 2020 2020  er}/'.          
-000022c0: 2020 2770 7562 6c69 635f 6874 6d6c 2f70    'public_html/p
-000022d0: 7365 7473 2f7b 7073 6574 7d27 0a20 2020  sets/{pset}'.   
-000022e0: 2020 2020 2029 0a20 2020 207d 2c0a 2020       ).    },.  
-000022f0: 2020 2254 4153 4b5f 5552 4c53 223a 207b    "TASK_URLS": {
-00002300: 0a20 2020 2020 2020 2027 7465 7374 5f63  .        'test_c
-00002310: 6f75 7273 6527 3a20 280a 2020 2020 2020  ourse': (.      
-00002320: 2020 2020 2020 2768 7474 7073 3a2f 2f65        'https://e
-00002330: 7861 6d70 6c65 2e63 6f6d 2f61 7263 6869  xample.com/archi
-00002340: 7665 2f74 6573 745f 636f 7572 7365 5f7b  ve/test_course_{
-00002350: 7365 6d65 7374 6572 7d2f 270a 2020 2020  semester}/'.    
-00002360: 2020 2020 2020 2020 2770 7562 6c69 635f          'public_
-00002370: 6874 6d6c 2f70 7365 7473 2f7b 7073 6574  html/psets/{pset
-00002380: 7d2f 7b74 6173 6b7d 270a 2020 2020 2020  }/{task}'.      
-00002390: 2020 290a 2020 2020 7d2c 0a20 2020 2022    ).    },.    "
-000023a0: 4558 4552 4349 5345 5f55 524c 5322 3a20  EXERCISE_URLS": 
-000023b0: 7b0a 2020 2020 2020 2020 2774 6573 745f  {.        'test_
-000023c0: 636f 7572 7365 273a 207b 0a20 2020 2020  course': {.     
-000023d0: 2020 2020 2020 2027 6c65 6327 3a20 280a         'lec': (.
-000023e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000023f0: 2768 7474 7073 3a2f 2f65 7861 6d70 6c65  'https://example
-00002400: 2e63 6f6d 2f61 7263 6869 7665 2f74 6573  .com/archive/tes
-00002410: 745f 636f 7572 7365 5f7b 7365 6d65 7374  t_course_{semest
-00002420: 6572 7d2f 270a 2020 2020 2020 2020 2020  er}/'.          
-00002430: 2020 2020 2020 2770 7562 6c69 635f 6874        'public_ht
-00002440: 6d6c 2f6c 6563 7475 7265 732f 7b67 726f  ml/lectures/{gro
-00002450: 7570 7d27 0a20 2020 2020 2020 2020 2020  up}'.           
-00002460: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00002470: 276c 6162 273a 2028 0a20 2020 2020 2020  'lab': (.       
-00002480: 2020 2020 2020 2020 2027 6874 7470 733a           'https:
-00002490: 2f2f 6578 616d 706c 652e 636f 6d2f 6172  //example.com/ar
-000024a0: 6368 6976 652f 7465 7374 5f63 6f75 7273  chive/test_cours
-000024b0: 655f 7b73 656d 6573 7465 727d 2f27 0a20  e_{semester}/'. 
-000024c0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000024d0: 7075 626c 6963 5f68 746d 6c2f 6c61 6273  public_html/labs
-000024e0: 2f7b 6772 6f75 707d 270a 2020 2020 2020  /{group}'.      
-000024f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00002500: 7d0a 2020 2020 7d2c 0a20 2020 2022 5441  }.    },.    "TA
-00002510: 534b 5f49 4e46 4f5f 4649 4c45 223a 2027  SK_INFO_FILE": '
-00002520: 7461 736b 732e 6a73 6f6e 272c 0a20 2020  tasks.json',.   
-00002530: 2022 434f 4e43 4550 5453 5f46 494c 4522   "CONCEPTS_FILE"
-00002540: 3a20 2763 6f6e 6365 7074 732e 6a73 6f6e  : 'concepts.json
-00002550: 272c 0a20 2020 2022 4144 4d49 4e5f 494e  ',.    "ADMIN_IN
-00002560: 464f 5f46 494c 4522 3a20 2770 6f74 6c75  FO_FILE": 'potlu
-00002570: 636b 2d61 646d 696e 2e6a 736f 6e27 2c0a  ck-admin.json',.
-00002580: 2020 2020 2252 4f53 5445 525f 4649 4c45      "ROSTER_FILE
-00002590: 223a 2027 726f 7374 6572 2e63 7376 272c  ": 'roster.csv',
-000025a0: 0a20 2020 2022 5354 5544 454e 545f 494e  .    "STUDENT_IN
-000025b0: 464f 5f46 494c 4522 3a20 2773 7475 6465  FO_FILE": 'stude
-000025c0: 6e74 2d69 6e66 6f2e 7473 7627 2c0a 2020  nt-info.tsv',.  
-000025d0: 2020 2253 594e 435f 504f 5254 223a 2035    "SYNC_PORT": 5
-000025e0: 3137 3233 2c0a 2020 2020 2246 494e 414c  1723,.    "FINAL
-000025f0: 5f45 5641 4c5f 5449 4d45 4f55 5422 3a20  _EVAL_TIMEOUT": 
-00002600: 3630 2c0a 2020 2020 2255 5345 5f58 5646  60,.    "USE_XVF
-00002610: 4222 3a20 4661 6c73 652c 0a20 2020 2022  B": False,.    "
-00002620: 5856 4642 5f53 4552 5645 525f 4152 4753  XVFB_SERVER_ARGS
-00002630: 223a 2022 2d73 6372 6565 6e20 3020 3130  ": "-screen 0 10
-00002640: 3234 7837 3638 7832 3422 2c0a 2020 2020  24x768x24",.    
-00002650: 2252 454d 4150 5f53 5455 4445 4e54 5f49  "REMAP_STUDENT_I
-00002660: 4e46 4f22 3a20 7b7d 2c0a 2020 2020 2253  NFO": {},.    "S
-00002670: 434f 5245 5f42 4153 4953 223a 2031 3030  CORE_BASIS": 100
-00002680: 2c0a 2020 2020 2252 4f55 4e44 5f53 434f  ,.    "ROUND_SCO
-00002690: 5245 535f 544f 223a 2030 2c0a 2020 2020  RES_TO": 0,.    
-000026a0: 2245 5641 4c55 4154 494f 4e5f 5343 4f52  "EVALUATION_SCOR
-000026b0: 4553 223a 207b 0a20 2020 2020 2020 2022  ES": {.        "
-000026c0: 6578 6365 6c6c 656e 7422 3a20 3130 302c  excellent": 100,
-000026d0: 0a20 2020 2020 2020 2022 636f 6d70 6c65  .        "comple
-000026e0: 7465 223a 2031 3030 2c0a 2020 2020 2020  te": 100,.      
-000026f0: 2020 2261 6c6d 6f73 7420 636f 6d70 6c65    "almost comple
-00002700: 7465 223a 2038 352c 0a20 2020 2020 2020  te": 85,.       
-00002710: 2022 7061 7274 6961 6c6c 7920 636f 6d70   "partially comp
-00002720: 6c65 7465 223a 2037 352c 0a20 2020 2020  lete": 75,.     
-00002730: 2020 2022 696e 636f 6d70 6c65 7465 223a     "incomplete":
-00002740: 2030 2c0a 2020 2020 2020 2020 225f 5f6f   0,.        "__o
-00002750: 7468 6572 5f5f 223a 204e 6f6e 650a 2020  ther__": None.  
-00002760: 2020 7d2c 0a20 2020 2022 5245 5649 5349    },.    "REVISI
-00002770: 4f4e 5f4d 4158 5f53 434f 5245 223a 2031  ON_MAX_SCORE": 1
-00002780: 3030 2c0a 2020 2020 2242 454c 4154 4544  00,.    "BELATED
-00002790: 5f4d 4158 5f53 434f 5245 223a 2038 352c  _MAX_SCORE": 85,
-000027a0: 0a20 2020 2022 5449 4d45 4c49 4e45 5353  .    "TIMELINESS
-000027b0: 5f50 4f49 4e54 5322 3a20 3130 2c0a 2020  _POINTS": 10,.  
-000027c0: 2020 2254 494d 454c 494e 4553 535f 4154    "TIMELINESS_AT
-000027d0: 5445 4d50 545f 5448 5245 5348 4f4c 4422  TEMPT_THRESHOLD"
-000027e0: 3a20 3735 2c0a 2020 2020 2254 494d 454c  : 75,.    "TIMEL
-000027f0: 494e 4553 535f 434f 4d50 4c45 5445 5f54  INESS_COMPLETE_T
-00002800: 4852 4553 484f 4c44 223a 2038 352c 0a20  HRESHOLD": 85,. 
-00002810: 2020 2022 5441 534b 5f57 4549 4748 5422     "TASK_WEIGHT"
-00002820: 3a20 322c 0a20 2020 2022 4558 4552 4349  : 2,.    "EXERCI
-00002830: 5345 5f57 4549 4748 5422 3a20 312c 0a20  SE_WEIGHT": 1,. 
-00002840: 2020 2022 4f55 5443 4f4d 455f 5745 4947     "OUTCOME_WEIG
-00002850: 4854 223a 2030 2e32 352c 0a20 2020 2022  HT": 0.25,.    "
-00002860: 4558 4552 4349 5345 5f47 524f 5550 5f54  EXERCISE_GROUP_T
-00002870: 4852 4553 484f 4c44 223a 2030 2e37 3935  HRESHOLD": 0.795
-00002880: 2c0a 2020 2020 2245 5845 5243 4953 455f  ,.    "EXERCISE_
-00002890: 4752 4f55 505f 5041 5254 4941 4c5f 5448  GROUP_PARTIAL_TH
-000028a0: 5245 5348 4f4c 4422 3a20 302e 3339 352c  RESHOLD": 0.395,
-000028b0: 0a20 2020 2022 4752 4144 455f 5448 5245  .    "GRADE_THRE
-000028c0: 5348 4f4c 4453 223a 207b 0a20 2020 2020  SHOLDS": {.     
-000028d0: 2020 2022 6c6f 7722 3a20 3735 2c0a 2020     "low": 75,.  
-000028e0: 2020 2020 2020 226d 6964 223a 2039 300a        "mid": 90.
-000028f0: 2020 2020 7d0a 7d0a 0a23 204c 6f61 6473      }.}..# Loads
-00002900: 2063 6f6e 6669 6775 7261 7469 6f6e 2066   configuration f
-00002910: 726f 6d20 6669 6c65 2060 7073 5f63 6f6e  rom file `ps_con
-00002920: 6669 672e 7079 602e 2049 6620 7468 6174  fig.py`. If that
-00002930: 2066 696c 6520 6973 6e27 740a 2320 7072   file isn't.# pr
-00002940: 6573 656e 7420 6275 7420 6070 735f 636f  esent but `ps_co
-00002950: 6e66 6967 2e70 792e 6578 616d 706c 6560  nfig.py.example`
-00002960: 2069 732c 2063 6f70 6965 7320 7468 6520   is, copies the 
-00002970: 6c61 7474 6572 2061 7320 7468 6520 666f  latter as the fo
-00002980: 726d 6572 0a23 2066 6972 7374 2e20 4e6f  rmer.# first. No
-00002990: 7465 2074 6861 7420 7468 6973 2043 414e  te that this CAN
-000029a0: 4e4f 5420 6265 2072 756e 2061 7320 616e  NOT be run as an
-000029b0: 2069 6e69 7469 616c 697a 6174 696f 6e20   initialization 
-000029c0: 7061 7373 2c20 7369 6e63 650a 2320 7468  pass, since.# th
-000029d0: 6520 726f 7574 6520 6465 6669 6e69 7469  e route definiti
-000029e0: 6f6e 7320 6265 6c6f 7720 7265 7175 6972  ons below requir
-000029f0: 6520 6120 776f 726b 696e 6720 636f 6e66  e a working conf
-00002a00: 6967 7572 6174 696f 6e2e 0a74 7279 3a0a  iguration..try:.
-00002a10: 2020 2020 7379 732e 7061 7468 2e61 7070      sys.path.app
-00002a20: 656e 6428 272e 2729 0a20 2020 2061 7070  end('.').    app
-00002a30: 2e63 6f6e 6669 672e 6672 6f6d 5f6f 626a  .config.from_obj
-00002a40: 6563 7428 2770 735f 636f 6e66 6967 2729  ect('ps_config')
-00002a50: 0a65 7863 6570 7420 4578 6365 7074 696f  .except Exceptio
-00002a60: 6e20 6173 2065 3a20 2320 7472 7920 636f  n as e: # try co
-00002a70: 7079 696e 6720 7468 6520 2e65 7861 6d70  pying the .examp
-00002a80: 6c65 2066 696c 653f 0a20 2020 2069 6620  le file?.    if 
-00002a90: 6f73 2e70 6174 682e 6578 6973 7473 2827  os.path.exists('
-00002aa0: 7073 5f63 6f6e 6669 672e 7079 2e65 7861  ps_config.py.exa
-00002ab0: 6d70 6c65 2729 3a0a 2020 2020 2020 2020  mple'):.        
-00002ac0: 7072 696e 7428 2243 7265 6174 696e 6720  print("Creating 
-00002ad0: 6e65 7720 2770 735f 636f 6e66 6967 2e70  new 'ps_config.p
-00002ae0: 7927 2066 726f 6d20 2770 735f 636f 6e66  y' from 'ps_conf
-00002af0: 6967 2e70 792e 6578 616d 706c 6527 2e22  ig.py.example'."
-00002b00: 290a 2020 2020 2020 2020 7368 7574 696c  ).        shutil
-00002b10: 2e63 6f70 7966 696c 6528 2770 735f 636f  .copyfile('ps_co
-00002b20: 6e66 6967 2e70 792e 6578 616d 706c 6527  nfig.py.example'
-00002b30: 2c20 2770 735f 636f 6e66 6967 2e70 7927  , 'ps_config.py'
-00002b40: 290a 2020 2020 2020 2020 6170 702e 636f  ).        app.co
-00002b50: 6e66 6967 2e66 726f 6d5f 6f62 6a65 6374  nfig.from_object
-00002b60: 2827 7073 5f63 6f6e 6669 6727 290a 2020  ('ps_config').  
-00002b70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00002b80: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00002b90: 2020 2022 4e65 6974 6865 7220 2770 735f     "Neither 'ps_
-00002ba0: 636f 6e66 6967 2e70 7927 206e 6f72 2027  config.py' nor '
-00002bb0: 7073 5f63 6f6e 6669 672e 7079 2e65 7861  ps_config.py.exa
-00002bc0: 6d70 6c65 2720 6973 220a 2020 2020 2020  mple' is".      
-00002bd0: 2020 2020 2020 2220 6176 6169 6c61 626c        " availabl
-00002be0: 652c 206f 7220 7468 6572 6520 7761 7320  e, or there was 
-00002bf0: 616e 2065 7272 6f72 2069 6e20 7061 7273  an error in pars
-00002c00: 696e 6720 7468 656d 2c20 736f 220a 2020  ing them, so".  
-00002c10: 2020 2020 2020 2020 2020 2220 6465 6661            " defa
-00002c20: 756c 7420 636f 6e66 6967 7572 6174 696f  ult configuratio
-00002c30: 6e20 7769 6c6c 2062 6520 7573 6564 2e22  n will be used."
-00002c40: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00002c50: 2020 2070 7269 6e74 2822 4357 4420 6973     print("CWD is
-00002c60: 3a22 2c20 6f73 2e67 6574 6377 6428 2929  :", os.getcwd())
-00002c70: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00002c80: 4572 726f 7220 6c6f 6164 696e 6720 2770  Error loading 'p
-00002c90: 735f 636f 6e66 6967 2e70 7927 2077 6173  s_config.py' was
-00002ca0: 3a22 2c20 7374 7228 6529 290a 2020 2020  :", str(e)).    
-00002cb0: 2020 2020 6170 702e 636f 6e66 6967 2e66      app.config.f
-00002cc0: 726f 6d5f 6d61 7070 696e 6728 4445 4641  rom_mapping(DEFA
-00002cd0: 554c 545f 434f 4e46 4947 290a 6669 6e61  ULT_CONFIG).fina
-00002ce0: 6c6c 793a 0a20 2020 2073 7973 2e70 6174  lly:.    sys.pat
-00002cf0: 682e 706f 7028 2920 2320 6e6f 206c 6f6e  h.pop() # no lon
-00002d00: 6765 7220 6e65 6564 2027 2e27 206f 6e20  ger need '.' on 
-00002d10: 7061 7468 2e2e 2e0a 0a0a 4061 7070 2e69  path......@app.i
-00002d20: 6e69 740a 6465 6620 7365 7475 705f 6a69  nit.def setup_ji
-00002d30: 6e6a 615f 6c6f 6164 6572 2861 7070 293a  nja_loader(app):
-00002d40: 0a20 2020 2022 2222 0a20 2020 2053 6574  .    """.    Set
-00002d50: 2075 7020 7465 6d70 6c61 7469 6e67 2077   up templating w
-00002d60: 6974 6820 6120 6375 7374 6f6d 206c 6f61  ith a custom loa
-00002d70: 6465 7220 7468 6174 206c 6f61 6473 2074  der that loads t
-00002d80: 656d 706c 6174 6573 2066 726f 6d20 7468  emplates from th
-00002d90: 650a 2020 2020 706f 746c 7563 6b20 7061  e.    potluck pa
-00002da0: 636b 6167 6520 6966 2069 7420 6361 6e27  ckage if it can'
-00002db0: 7420 6669 6e64 2074 6865 6d20 696e 2074  t find them in t
-00002dc0: 6869 7320 7061 636b 6167 652e 2054 6869  his package. Thi
-00002dd0: 7320 6973 2068 6f77 0a20 2020 2077 6520  s is how.    we 
-00002de0: 7368 6172 6520 7468 6520 7265 706f 7274  share the report
-00002df0: 2074 656d 706c 6174 6520 6265 7477 6565   template betwee
-00002e00: 6e20 706f 746c 7563 6b5f 7365 7276 6572  n potluck_server
-00002e10: 2061 6e64 2070 6f74 6c75 636b 2e0a 2020   and potluck..  
-00002e20: 2020 2222 220a 2020 2020 6170 702e 6a69    """.    app.ji
-00002e30: 6e6a 615f 6c6f 6164 6572 203d 206a 696e  nja_loader = jin
-00002e40: 6a61 322e 4368 6f69 6365 4c6f 6164 6572  ja2.ChoiceLoader
-00002e50: 285b 0a20 2020 2020 2020 206a 696e 6a61  ([.        jinja
-00002e60: 322e 5061 636b 6167 654c 6f61 6465 7228  2.PackageLoader(
-00002e70: 2270 6f74 6c75 636b 5f73 6572 7665 7222  "potluck_server"
-00002e80: 2c20 2274 656d 706c 6174 6573 2229 2c0a  , "templates"),.
-00002e90: 2020 2020 2020 2020 6a69 6e6a 6132 2e50          jinja2.P
-00002ea0: 6163 6b61 6765 4c6f 6164 6572 2822 706f  ackageLoader("po
-00002eb0: 746c 7563 6b22 2c20 2274 656d 706c 6174  tluck", "templat
-00002ec0: 6573 2229 0a20 2020 205d 290a 0a0a 4061  es").    ])...@a
-00002ed0: 7070 2e69 6e69 740a 6465 6620 656e 6162  pp.init.def enab
-00002ee0: 6c65 5f43 4153 2861 7070 293a 0a20 2020  le_CAS(app):.   
-00002ef0: 2022 2222 0a20 2020 2045 6e61 626c 6520   """.    Enable 
-00002f00: 6175 7468 656e 7469 6361 7469 6f6e 2076  authentication v
-00002f10: 6961 2061 2043 656e 7472 616c 2041 7574  ia a Central Aut
-00002f20: 6865 6e74 6963 6174 696f 6e20 5365 7276  hentication Serv
-00002f30: 6572 2e0a 2020 2020 2222 220a 2020 2020  er..    """.    
-00002f40: 676c 6f62 616c 2063 6173 0a20 2020 2063  global cas.    c
-00002f50: 6173 203d 2066 6c61 736b 5f63 6173 2e43  as = flask_cas.C
-00002f60: 4153 2861 7070 290a 0a0a 4061 7070 2e69  AS(app)...@app.i
-00002f70: 6e69 740a 6465 6620 7365 7475 705f 706f  nit.def setup_po
-00002f80: 746c 7563 6b5f 7265 706f 7274 696e 6728  tluck_reporting(
-00002f90: 6170 7029 3a0a 2020 2020 2222 220a 2020  app):.    """.  
-00002fa0: 2020 5365 7475 7020 666f 7220 7468 6520    Setup for the 
-00002fb0: 706f 746c 7563 6b2e 7265 6e64 6572 206d  potluck.render m
-00002fc0: 6f64 756c 6520 2875 7365 7320 6465 6661  odule (uses defa
-00002fd0: 756c 7473 292e 0a20 2020 2022 2222 0a20  ults)..    """. 
-00002fe0: 2020 2070 6f74 6c75 636b 2e72 656e 6465     potluck.rende
-00002ff0: 722e 7365 7475 7028 290a 0a0a 4061 7070  r.setup()...@app
-00003000: 2e69 6e69 740a 6465 6620 6372 6561 7465  .init.def create
-00003010: 5f73 6563 7265 745f 6b65 7928 6170 7029  _secret_key(app)
-00003020: 3a0a 2020 2020 2222 220a 2020 2020 5365  :.    """.    Se
-00003030: 7420 7365 6372 6574 206b 6579 2066 726f  t secret key fro
-00003040: 6d20 7365 6372 6574 2066 696c 652c 206f  m secret file, o
-00003050: 7220 6372 6561 7465 2061 206e 6577 2073  r create a new s
-00003060: 6563 7265 7420 6b65 7920 616e 640a 2020  ecret key and.  
-00003070: 2020 7772 6974 6520 6974 2069 6e74 6f20    write it into 
-00003080: 7468 6520 7365 6372 6574 2066 696c 652e  the secret file.
-00003090: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-000030a0: 6f73 2e70 6174 682e 6578 6973 7473 2822  os.path.exists("
-000030b0: 7365 6372 6574 2229 3a0a 2020 2020 2020  secret"):.      
-000030c0: 2020 7769 7468 206f 7065 6e28 2273 6563    with open("sec
-000030d0: 7265 7422 2c20 2772 6227 2920 6173 2066  ret", 'rb') as f
-000030e0: 696e 3a0a 2020 2020 2020 2020 2020 2020  in:.            
-000030f0: 6170 702e 7365 6372 6574 5f6b 6579 203d  app.secret_key =
-00003100: 2066 696e 2e72 6561 6428 290a 2020 2020   fin.read().    
-00003110: 656c 7365 3a0a 2020 2020 2020 2020 7072  else:.        pr
-00003120: 696e 7428 2243 7265 6174 696e 6720 6e65  int("Creating ne
-00003130: 7720 7365 6372 6574 206b 6579 2066 696c  w secret key fil
-00003140: 6520 2773 6563 7265 7427 2e22 290a 2020  e 'secret'.").  
-00003150: 2020 2020 2020 6170 702e 7365 6372 6574        app.secret
-00003160: 5f6b 6579 203d 206f 732e 7572 616e 646f  _key = os.urando
-00003170: 6d28 3136 290a 2020 2020 2020 2020 7769  m(16).        wi
-00003180: 7468 206f 7065 6e28 2273 6563 7265 7422  th open("secret"
-00003190: 2c20 2777 6227 2920 6173 2066 6f75 743a  , 'wb') as fout:
-000031a0: 0a20 2020 2020 2020 2020 2020 2066 6f75  .            fou
-000031b0: 742e 7772 6974 6528 6170 702e 7365 6372  t.write(app.secr
-000031c0: 6574 5f6b 6579 290a 0a0a 4061 7070 2e69  et_key)...@app.i
-000031d0: 6e69 740a 6465 6620 696e 6974 6961 6c69  nit.def initiali
-000031e0: 7a65 5f73 746f 7261 6765 5f6d 6f64 756c  ze_storage_modul
-000031f0: 6528 6170 7029 3a0a 2020 2020 2222 220a  e(app):.    """.
-00003200: 2020 2020 496e 6974 6961 6c69 7a65 2066      Initialize f
-00003210: 696c 6520 6163 6365 7373 2061 6e64 2073  ile access and s
-00003220: 746f 7261 6765 2073 7973 7465 6d2e 0a20  torage system.. 
-00003230: 2020 2022 2222 0a20 2020 2073 746f 7261     """.    stora
-00003240: 6765 2e69 6e69 7428 6170 702e 636f 6e66  ge.init(app.conf
-00003250: 6967 290a 0a0a 4061 7070 2e69 6e69 740a  ig)...@app.init.
-00003260: 6465 6620 656e 7375 7265 5f72 6571 7569  def ensure_requi
-00003270: 7265 645f 666f 6c64 6572 7328 6170 7029  red_folders(app)
-00003280: 3a0a 2020 2020 2222 220a 2020 2020 456e  :.    """.    En
-00003290: 7375 7265 7320 7265 7175 6972 6564 2066  sures required f
-000032a0: 6f6c 6465 7273 2066 6f72 2074 6865 2064  olders for the d
-000032b0: 6566 6175 6c74 2063 6f75 7273 652f 7365  efault course/se
-000032c0: 6d65 7374 6572 2e0a 2020 2020 544f 444f  mester..    TODO
-000032d0: 3a20 5768 6174 2061 626f 7574 206e 6f6e  : What about non
-000032e0: 2d64 6566 6175 6c74 2063 6f75 7273 6573  -default courses
-000032f0: 2f73 656d 6573 7465 7273 3f20 4966 2074  /semesters? If t
-00003300: 6865 7927 7265 2066 696e 652c 2069 730a  hey're fine, is.
-00003310: 2020 2020 7468 6973 2065 7665 6e20 6e65      this even ne
-00003320: 6365 7373 6172 793f 0a20 2020 2022 2222  cessary?.    """
-00003330: 0a20 2020 2074 6869 735f 636f 7572 7365  .    this_course
-00003340: 203d 2061 7070 2e63 6f6e 6669 672e 6765   = app.config.ge
-00003350: 7428 2244 4546 4155 4c54 5f43 4f55 5253  t("DEFAULT_COURS
-00003360: 4522 2c20 2775 6e6b 6e6f 776e 2729 0a20  E", 'unknown'). 
-00003370: 2020 2074 6869 735f 7365 6d65 7374 6572     this_semester
-00003380: 203d 2061 7070 2e63 6f6e 6669 672e 6765   = app.config.ge
-00003390: 7428 2244 4546 4155 4c54 5f53 454d 4553  t("DEFAULT_SEMES
-000033a0: 5445 5222 2c20 2775 6e6b 6e6f 776e 2729  TER", 'unknown')
-000033b0: 0a20 2020 2073 746f 7261 6765 2e65 6e73  .    storage.ens
-000033c0: 7572 655f 6469 7265 6374 6f72 7928 0a20  ure_directory(. 
-000033d0: 2020 2020 2020 2073 746f 7261 6765 2e65         storage.e
-000033e0: 7661 6c75 6174 696f 6e5f 6469 7265 6374  valuation_direct
-000033f0: 6f72 7928 7468 6973 5f63 6f75 7273 652c  ory(this_course,
-00003400: 2074 6869 735f 7365 6d65 7374 6572 290a   this_semester).
-00003410: 2020 2020 290a 2020 2020 7374 6f72 6167      ).    storag
-00003420: 652e 656e 7375 7265 5f64 6972 6563 746f  e.ensure_directo
-00003430: 7279 280a 2020 2020 2020 2020 7374 6f72  ry(.        stor
-00003440: 6167 652e 7375 626d 6973 7369 6f6e 735f  age.submissions_
-00003450: 666f 6c64 6572 2874 6869 735f 636f 7572  folder(this_cour
-00003460: 7365 2c20 7468 6973 5f73 656d 6573 7465  se, this_semeste
-00003470: 7229 0a20 2020 2029 0a0a 0a23 2d2d 2d2d  r).    )...#----
-00003480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 230a 2320  ------------#.# 
-00003490: 5365 6375 7269 7479 2073 6574 7570 2023  Security setup #
-000034a0: 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .#--------------
-000034b0: 2d2d 230a 0a4e 4f41 5554 4820 3d20 4661  --#..NOAUTH = Fa
-000034c0: 6c73 650a 5553 455f 5441 4c49 534d 414e  lse.USE_TALISMAN
-000034d0: 203d 2054 7275 650a 6966 205f 5f6e 616d   = True.if __nam
-000034e0: 655f 5f20 3d3d 2022 5f5f 6d61 696e 5f5f  e__ == "__main__
-000034f0: 223a 0a20 2020 2023 2050 7269 6e74 2069  ":.    # Print i
-00003500: 6e74 726f 2068 6572 652e 2e2e 0a20 2020  ntro here....   
-00003510: 2070 7269 6e74 2822 5468 6973 2069 7320   print("This is 
-00003520: 706f 746c 7563 6b5f 7365 7276 6572 2076  potluck_server v
-00003530: 6572 7369 6f6e 207b 7d22 2e66 6f72 6d61  ersion {}".forma
-00003540: 7428 5f5f 7665 7273 696f 6e5f 5f29 290a  t(__version__)).
-00003550: 0a20 2020 2070 7269 6e74 2822 5741 524e  .    print("WARN
-00003560: 494e 473a 2052 756e 6e69 6e67 2069 6e20  ING: Running in 
-00003570: 6465 6275 6720 6d6f 6465 2057 4954 484f  debug mode WITHO
-00003580: 5554 2041 5554 4845 4e54 4943 4154 494f  UT AUTHENTICATIO
-00003590: 4e21 2229 0a20 2020 2069 6e70 7574 2822  N!").    input("
-000035a0: 5072 6573 7320 656e 7465 7220 746f 2063  Press enter to c
-000035b0: 6f6e 7469 6e75 6520 696e 2064 6562 7567  ontinue in debug
-000035c0: 206d 6f64 652e 2229 0a20 2020 2023 2044   mode.").    # D
-000035d0: 6973 6162 6c65 206c 6f67 696e 5f72 6571  isable login_req
-000035e0: 7569 7265 640a 2020 2020 666c 6173 6b5f  uired.    flask_
-000035f0: 6361 732e 6c6f 6769 6e5f 7265 7175 6972  cas.login_requir
-00003600: 6564 203d 206c 616d 6264 6120 663a 2066  ed = lambda f: f
-00003610: 0a20 2020 2023 2053 6574 2075 7020 7573  .    # Set up us
-00003620: 6572 6e61 6d65 2077 6f72 6b61 726f 756e  ername workaroun
-00003630: 640a 2020 2020 4e4f 4155 5448 203d 2054  d.    NOAUTH = T
-00003640: 7275 650a 0a20 2020 2023 2049 6620 4f70  rue..    # If Op
-00003650: 656e 5353 4c20 6973 2061 7661 696c 6162  enSSL is availab
-00003660: 6c65 2c20 7765 2063 616e 2075 7365 2074  le, we can use t
-00003670: 616c 6973 6d61 6e20 6576 656e 2069 6620  alisman even if 
-00003680: 7275 6e6e 696e 6720 696e 0a20 2020 2023  running in.    #
-00003690: 206c 6f63 616c 2064 6562 7567 6769 6e67   local debugging
-000036a0: 206d 6f64 653b 206f 7468 6572 7769 7365   mode; otherwise
-000036b0: 2077 6520 6e65 6564 2074 6f20 6469 7361   we need to disa
-000036c0: 626c 6520 7461 6c69 736d 616e 2e0a 2020  ble talisman..  
-000036d0: 2020 7472 793a 0a20 2020 2020 2020 2069    try:.        i
-000036e0: 6d70 6f72 7420 4f70 656e 5353 4c0a 2020  mport OpenSSL.  
-000036f0: 2020 6578 6365 7074 204d 6f64 756c 654e    except ModuleN
-00003700: 6f74 466f 756e 645f 6f72 5f49 6d70 6f72  otFound_or_Impor
-00003710: 745f 4572 726f 723a 0a20 2020 2020 2020  t_Error:.       
-00003720: 2055 5345 5f54 414c 4953 4d41 4e20 3d20   USE_TALISMAN = 
-00003730: 4661 6c73 650a 0a20 2020 2023 2043 6f6e  False..    # Con
-00003740: 6669 6720 6d61 7920 6469 7361 626c 6520  fig may disable 
-00003750: 7461 6c69 736d 616e 0a20 2020 2069 6620  talisman.    if 
-00003760: 6170 702e 636f 6e66 6967 2e67 6574 2827  app.config.get('
-00003770: 4e4f 5f44 4542 5547 5f53 534c 2729 3a0a  NO_DEBUG_SSL'):.
-00003780: 2020 2020 2020 2020 5553 455f 5441 4c49          USE_TALI
-00003790: 534d 414e 203d 2046 616c 7365 0a0a 0a40  SMAN = False...@
-000037a0: 6170 702e 696e 6974 0a64 6566 2065 6e61  app.init.def ena
-000037b0: 626c 655f 7461 6c69 736d 616e 2861 7070  ble_talisman(app
-000037c0: 293a 0a20 2020 2022 2222 0a20 2020 2045  ):.    """.    E
-000037d0: 6e61 626c 6520 7461 6c69 736d 616e 2066  nable talisman f
-000037e0: 6f72 6365 642d 4854 5450 5320 616e 6420  orced-HTTPS and 
-000037f0: 6f74 6865 7220 7365 6375 7269 7479 2068  other security h
-00003800: 6561 6465 7273 2069 660a 2020 2020 6066  eaders if.    `f
-00003810: 6c61 736b 5f74 616c 6973 6d61 6e60 2069  lask_talisman` i
-00003820: 7320 6176 6169 6c61 626c 6520 616e 6420  s available and 
-00003830: 6974 2077 6f6e 2774 2069 6e74 6572 6665  it won't interfe
-00003840: 7265 2077 6974 6820 6465 6275 6767 696e  re with debuggin
-00003850: 672e 0a20 2020 2022 2222 0a20 2020 2074  g..    """.    t
-00003860: 616c 6973 6d61 6e5f 656e 6162 6c65 6420  alisman_enabled 
-00003870: 3d20 4661 6c73 650a 2020 2020 6966 2055  = False.    if U
-00003880: 5345 5f54 414c 4953 4d41 4e3a 0a20 2020  SE_TALISMAN:.   
-00003890: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-000038a0: 2020 2020 2020 696d 706f 7274 2066 6c61        import fla
-000038b0: 736b 5f74 616c 6973 6d61 6e0a 2020 2020  sk_talisman.    
-000038c0: 2020 2020 2020 2020 2320 436f 6e74 656e          # Conten
-000038d0: 742d 7365 6375 7269 7479 2070 6f6c 6963  t-security polic
-000038e0: 7920 7365 7474 696e 6773 0a20 2020 2020  y settings.     
-000038f0: 2020 2020 2020 2063 7370 203d 207b 0a20         csp = {. 
-00003900: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00003910: 6465 6661 756c 742d 7372 6327 3a20 2227  default-src': "'
-00003920: 7365 6c66 2722 2c0a 2020 2020 2020 2020  self'",.        
-00003930: 2020 2020 2020 2020 2773 6372 6970 742d          'script-
-00003940: 7372 6327 3a20 2227 7365 6c66 2720 2772  src': "'self' 'r
-00003950: 6570 6f72 742d 7361 6d70 6c65 2722 2c0a  eport-sample'",.
-00003960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003970: 2773 7479 6c65 2d73 7263 273a 2022 2773  'style-src': "'s
-00003980: 656c 6627 222c 0a20 2020 2020 2020 2020  elf'",.         
-00003990: 2020 2020 2020 2027 696d 672d 7372 6327         'img-src'
-000039a0: 3a20 2227 7365 6c66 2720 6461 7461 3a22  : "'self' data:"
-000039b0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-000039c0: 2020 2020 2020 2020 2020 2066 6c61 736b             flask
-000039d0: 5f74 616c 6973 6d61 6e2e 5461 6c69 736d  _talisman.Talism
-000039e0: 616e 280a 2020 2020 2020 2020 2020 2020  an(.            
-000039f0: 2020 2020 6170 702c 0a20 2020 2020 2020      app,.       
-00003a00: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
-00003a10: 5f73 6563 7572 6974 795f 706f 6c69 6379  _security_policy
-00003a20: 3d63 7370 2c0a 2020 2020 2020 2020 2020  =csp,.          
-00003a30: 2020 2020 2020 636f 6e74 656e 745f 7365        content_se
-00003a40: 6375 7269 7479 5f70 6f6c 6963 795f 6e6f  curity_policy_no
-00003a50: 6e63 655f 696e 3d5b 0a20 2020 2020 2020  nce_in=[.       
-00003a60: 2020 2020 2020 2020 2020 2020 2027 7363               'sc
-00003a70: 7269 7074 2d73 7263 272c 0a20 2020 2020  ript-src',.     
-00003a80: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00003a90: 7374 796c 652d 7372 6327 0a20 2020 2020  style-src'.     
-00003aa0: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-00003ab0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00003ac0: 2020 2020 2020 2074 616c 6973 6d61 6e5f         talisman_
-00003ad0: 656e 6162 6c65 6420 3d20 5472 7565 0a20  enabled = True. 
-00003ae0: 2020 2020 2020 2065 7863 6570 7420 4d6f         except Mo
-00003af0: 6475 6c65 4e6f 7446 6f75 6e64 5f6f 725f  duleNotFound_or_
-00003b00: 496d 706f 7274 5f45 7272 6f72 3a0a 2020  Import_Error:.  
-00003b10: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00003b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003b30: 2022 5761 726e 696e 673a 206d 6f64 756c   "Warning: modul
-00003b40: 6520 666c 6173 6b5f 7461 6c69 736d 616e  e flask_talisman
-00003b50: 2069 7320 6e6f 7420 6176 6169 6c61 626c   is not availabl
-00003b60: 653b 220a 2020 2020 2020 2020 2020 2020  e;".            
-00003b70: 2020 2020 2220 7365 6375 7269 7479 2068      " security h
-00003b80: 6561 6465 7273 2077 696c 6c20 6e6f 7420  eaders will not 
-00003b90: 6265 2073 6574 2e22 0a20 2020 2020 2020  be set.".       
-00003ba0: 2020 2020 2029 0a0a 2020 2020 6966 2074       )..    if t
-00003bb0: 616c 6973 6d61 6e5f 656e 6162 6c65 643a  alisman_enabled:
-00003bc0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00003bd0: 5461 6c69 736d 616e 2069 7320 656e 6162  Talisman is enab
-00003be0: 6c65 642e 2229 0a20 2020 2065 6c73 653a  led.").    else:
-00003bf0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00003c00: 5461 6c69 736d 616e 2069 7320 4e4f 5420  Talisman is NOT 
-00003c10: 656e 6162 6c65 642e 2229 0a20 2020 2020  enabled.").     
-00003c20: 2020 2023 2041 6464 2063 7370 5f6e 6f6e     # Add csp_non
-00003c30: 6365 2067 6c6f 6261 6c20 6475 6d6d 7920  ce global dummy 
-00003c40: 7369 6e63 6520 666c 6173 6b5f 7461 6c69  since flask_tali
-00003c50: 736d 616e 2064 6964 6e27 740a 2020 2020  sman didn't.    
-00003c60: 2020 2020 6170 702e 6164 645f 7465 6d70      app.add_temp
-00003c70: 6c61 7465 5f67 6c6f 6261 6c28 0a20 2020  late_global(.   
-00003c80: 2020 2020 2020 2020 206c 616d 6264 613a           lambda:
-00003c90: 2022 2d6e 6f6e 6365 2d64 6973 6162 6c65   "-nonce-disable
-00003ca0: 642d 222c 0a20 2020 2020 2020 2020 2020  d-",.           
-00003cb0: 206e 616d 653d 2763 7370 5f6e 6f6e 6365   name='csp_nonce
-00003cc0: 270a 2020 2020 2020 2020 290a 0a0a 4061  '.        )...@a
-00003cd0: 7070 2e69 6e69 740a 6465 6620 7365 7475  pp.init.def setu
-00003ce0: 705f 7365 6173 7572 6628 6170 7029 3a0a  p_seasurf(app):.
-00003cf0: 2020 2020 2222 220a 2020 2020 5365 7473      """.    Sets
-00003d00: 2075 7020 6066 6c61 736b 5f73 6561 7375   up `flask_seasu
-00003d10: 7266 6020 746f 2063 6f6d 6261 7420 6372  rf` to combat cr
-00003d20: 6f73 732d 7369 7465 2072 6571 7565 7374  oss-site request
-00003d30: 2066 6f72 6765 7279 2c20 6966 0a20 2020   forgery, if.   
-00003d40: 2074 6861 7420 6d6f 6475 6c65 2069 7320   that module is 
-00003d50: 6176 6169 6c61 626c 652e 0a0a 2020 2020  available...    
-00003d60: 4e6f 7465 2074 6861 7420 6072 6f75 7465  Note that `route
-00003d70: 5f64 656c 6976 6572 6020 6973 2065 7865  _deliver` is exe
-00003d80: 6d70 7420 6672 6f6d 2043 5352 4620 7665  mpt from CSRF ve
-00003d90: 7269 6669 6361 7469 6f6e 2e0a 2020 2020  rification..    
-00003da0: 2222 220a 2020 2020 676c 6f62 616c 2072  """.    global r
-00003db0: 6f75 7465 5f64 656c 6976 6572 0a20 2020  oute_deliver.   
-00003dc0: 2074 7279 3a0a 2020 2020 2020 2020 696d   try:.        im
-00003dd0: 706f 7274 2066 6c61 736b 5f73 6561 7375  port flask_seasu
-00003de0: 7266 0a20 2020 2020 2020 2063 7372 6620  rf.        csrf 
-00003df0: 3d20 666c 6173 6b5f 7365 6173 7572 662e  = flask_seasurf.
-00003e00: 5365 6153 7572 6628 6170 7029 2023 206e  SeaSurf(app) # n
-00003e10: 6f71 6120 4638 3431 0a20 2020 2020 2020  oqa F841.       
-00003e20: 2072 6f75 7465 5f64 656c 6976 6572 203d   route_deliver =
-00003e30: 2063 7372 662e 6578 656d 7074 2872 6f75   csrf.exempt(rou
-00003e40: 7465 5f64 656c 6976 6572 290a 2020 2020  te_deliver).    
-00003e50: 6578 6365 7074 204d 6f64 756c 654e 6f74  except ModuleNot
-00003e60: 466f 756e 645f 6f72 5f49 6d70 6f72 745f  Found_or_Import_
-00003e70: 4572 726f 723a 0a20 2020 2020 2020 2070  Error:.        p
-00003e80: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-00003e90: 2020 2257 6172 6e69 6e67 3a20 6d6f 6475    "Warning: modu
-00003ea0: 6c65 2066 6c61 736b 5f73 6561 7375 7266  le flask_seasurf
-00003eb0: 2069 7320 6e6f 7420 6176 6169 6c61 626c   is not availabl
-00003ec0: 653b 2043 5352 4622 0a20 2020 2020 2020  e; CSRF".       
-00003ed0: 2020 2020 2022 2070 726f 7465 6374 696f       " protectio
-00003ee0: 6e20 7769 6c6c 206e 6f74 2062 6520 656e  n will not be en
-00003ef0: 6162 6c65 642e 220a 2020 2020 2020 2020  abled.".        
-00003f00: 290a 2020 2020 2020 2020 2320 4164 6420  ).        # Add 
-00003f10: 6373 7266 5f74 6f6b 656e 2067 6c6f 6261  csrf_token globa
-00003f20: 6c20 6475 6d6d 7920 7369 6e63 6520 666c  l dummy since fl
-00003f30: 6173 6b5f 7365 6173 7572 6620 6973 6e27  ask_seasurf isn'
-00003f40: 7420 6176 6169 6c61 626c 650a 2020 2020  t available.    
-00003f50: 2020 2020 6170 702e 6164 645f 7465 6d70      app.add_temp
-00003f60: 6c61 7465 5f67 6c6f 6261 6c28 6c61 6d62  late_global(lamb
-00003f70: 6461 3a20 222d 6469 7361 626c 6564 2d22  da: "-disabled-"
-00003f80: 2c20 6e61 6d65 3d27 6373 7266 5f74 6f6b  , name='csrf_tok
-00003f90: 656e 2729 0a0a 0a23 2d2d 2d2d 2d2d 2d2d  en')...#--------
-00003fa0: 2d23 0a23 2048 656c 7065 7273 2023 0a23  -#.# Helpers #.#
-00003fb0: 2d2d 2d2d 2d2d 2d2d 2d23 0a0a 6465 6620  ---------#..def 
-00003fc0: 6175 676d 656e 745f 6172 6775 6d65 6e74  augment_argument
-00003fd0: 7328 726f 7574 655f 6675 6e63 7469 6f6e  s(route_function
-00003fe0: 293a 0a20 2020 2022 2222 0a20 2020 2041  ):.    """.    A
-00003ff0: 2064 6563 6f72 6174 6f72 2074 6861 7420   decorator that 
-00004000: 6d6f 6469 6669 6573 2061 2072 6f75 7465  modifies a route
-00004010: 2066 756e 6374 696f 6e20 746f 2073 7570   function to sup
-00004020: 706c 7920 6075 7365 726e 616d 6560 2c0a  ply `username`,.
-00004030: 2020 2020 6069 735f 6164 6d69 6e60 2c20      `is_admin`, 
-00004040: 606d 6173 7175 6572 6164 655f 6173 602c  `masquerade_as`,
-00004050: 2060 6566 6665 6374 6976 655f 7573 6572   `effective_user
-00004060: 602c 2061 6e64 2060 7461 736b 5f69 6e66  `, and `task_inf
-00004070: 6f60 0a20 2020 206b 6579 776f 7264 2061  o`.    keyword a
-00004080: 7267 756d 656e 7473 2061 6c6f 6e67 2077  rguments along w
-00004090: 6974 6820 7468 6520 6f74 6865 7220 6172  ith the other ar
-000040a0: 6775 6d65 6e74 7320 7468 6520 726f 7574  guments the rout
-000040b0: 6520 7265 6365 6976 6573 2e0a 2020 2020  e receives..    
-000040c0: 4d75 7374 2062 6520 6170 706c 6965 6420  Must be applied 
-000040d0: 6265 666f 7265 2061 7070 2e72 6f75 7465  before app.route
-000040e0: 2c20 616e 6420 7468 6520 6669 7273 7420  , and the first 
-000040f0: 7477 6f20 7061 7261 6d65 7465 7273 2074  two parameters t
-00004100: 6f20 7468 650a 2020 2020 6675 6e63 7469  o the.    functi
-00004110: 6f6e 206d 7573 7420 6265 2074 6865 2063  on must be the c
-00004120: 6f75 7273 6520 616e 6420 7365 6d65 7374  ourse and semest
-00004130: 6572 2e0a 0a20 2020 2042 6563 6175 7365  er...    Because
-00004140: 2066 6c61 736b 2f77 6572 6b7a 6575 6720   flask/werkzeug 
-00004150: 726f 7574 696e 6720 7265 7175 6972 6573  routing requires
-00004160: 2066 756e 6374 696f 6e20 7369 676e 6174   function signat
-00004170: 7572 6573 2074 6f20 6265 0a20 2020 2070  ures to be.    p
-00004180: 7265 7365 7276 6564 2c20 7765 2064 6f20  reserved, we do 
-00004190: 736f 6d65 2064 6972 7479 2077 6f72 6b20  some dirty work 
-000041a0: 7769 7468 2063 6f6d 7069 6c65 2061 6e64  with compile and
-000041b0: 2065 7661 6c2e 2e2e 2041 7320 610a 2020   eval... As a.  
-000041c0: 2020 7265 7375 6c74 2c20 7468 6973 2066    result, this f
-000041d0: 756e 6374 696f 6e20 6361 6e20 6f6e 6c79  unction can only
-000041e0: 2073 6166 656c 7920 6265 2075 7365 6420   safely be used 
-000041f0: 746f 2064 6563 6f72 6174 6520 6675 6e63  to decorate func
-00004200: 7469 6f6e 730a 2020 2020 7468 6174 2064  tions.    that d
-00004210: 6f6e 2774 2068 6176 6520 616e 7920 6b65  on't have any ke
-00004220: 7977 6f72 6420 6172 6775 6d65 6e74 732e  yword arguments.
-00004230: 2046 7572 7468 6572 6d6f 7265 2c20 7468   Furthermore, th
-00004240: 6520 3520 6175 676d 656e 7465 640a 2020  e 5 augmented.  
-00004250: 2020 6172 6775 6d65 6e74 7320 6d75 7374    arguments must
-00004260: 2062 6520 7468 6520 6c61 7374 2035 2061   be the last 5 a
-00004270: 7267 756d 656e 7473 2074 6861 7420 7468  rguments that th
-00004280: 6520 6675 6e63 7469 6f6e 2061 6363 6570  e function accep
-00004290: 7473 2e0a 2020 2020 2222 220a 2020 2020  ts..    """.    
-000042a0: 6465 6620 7769 7468 5f65 7874 7261 5f61  def with_extra_a
-000042b0: 7267 756d 656e 7473 282a 6172 6773 2c20  rguments(*args, 
-000042c0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-000042d0: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
-000042e0: 2064 6563 6f72 6174 6564 2072 6f75 7465   decorated route
-000042f0: 2066 756e 6374 696f 6e20 7768 6963 6820   function which 
-00004300: 7769 6c6c 2062 6520 7375 7070 6c69 6564  will be supplied
-00004310: 2077 6974 6820 7573 6572 6e61 6d65 2c0a   with username,.
-00004320: 2020 2020 2020 2020 6973 5f61 646d 696e          is_admin
-00004330: 2c20 6d61 7371 7565 7261 6465 5f61 732c  , masquerade_as,
-00004340: 2065 6666 6563 7469 7665 5f75 7365 722c   effective_user,
-00004350: 2061 6e64 2074 6173 6b5f 696e 666f 2070   and task_info p
-00004360: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00004370: 2020 6173 206b 6579 776f 7264 2061 7267    as keyword arg
-00004380: 756d 656e 7473 2061 6674 6572 206f 7468  uments after oth
-00004390: 6572 2061 7267 756d 656e 7473 2068 6176  er arguments hav
-000043a0: 6520 6265 656e 2073 7570 706c 6965 642e  e been supplied.
-000043b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000043c0: 2020 2020 2023 2047 6574 2075 7365 726e       # Get usern
-000043d0: 616d 650a 2020 2020 2020 2020 6966 204e  ame.        if N
-000043e0: 4f41 5554 483a 0a20 2020 2020 2020 2020  OAUTH:.         
-000043f0: 2020 2075 7365 726e 616d 6520 3d20 2274     username = "t
-00004400: 6573 7422 0a20 2020 2020 2020 2065 6c73  est".        els
-00004410: 653a 0a20 2020 2020 2020 2020 2020 2075  e:.            u
-00004420: 7365 726e 616d 6520 3d20 6361 732e 7573  sername = cas.us
-00004430: 6572 6e61 6d65 0a0a 2020 2020 2020 2020  ername..        
-00004440: 2320 4772 6162 2063 6f75 7273 6520 2b20  # Grab course + 
-00004450: 7365 6d65 7374 6572 2076 616c 7565 730a  semester values.
-00004460: 2020 2020 2020 2020 636f 7572 7365 203d          course =
-00004470: 206b 7761 7267 732e 6765 7428 2763 6f75   kwargs.get('cou
-00004480: 7273 6527 2c20 6172 6773 5b30 5d20 6966  rse', args[0] if
-00004490: 206c 656e 2861 7267 7329 203e 2030 2065   len(args) > 0 e
-000044a0: 6c73 6520 4e6f 6e65 290a 2020 2020 2020  lse None).      
-000044b0: 2020 7365 6d65 7374 6572 203d 206b 7761    semester = kwa
-000044c0: 7267 732e 6765 7428 0a20 2020 2020 2020  rgs.get(.       
-000044d0: 2020 2020 2027 7365 6d65 7374 6572 272c       'semester',
-000044e0: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-000044f0: 735b 3120 6966 2027 636f 7572 7365 2720  s[1 if 'course' 
-00004500: 6e6f 7420 696e 206b 7761 7267 7320 656c  not in kwargs el
-00004510: 7365 2030 5d0a 2020 2020 2020 2020 2020  se 0].          
-00004520: 2020 2020 2020 6966 206c 656e 2861 7267        if len(arg
-00004530: 7329 203e 2030 2065 6c73 6520 4e6f 6e65  s) > 0 else None
-00004540: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00004550: 2020 2020 6966 2063 6f75 7273 6520 6973      if course is
-00004560: 204e 6f6e 6520 6f72 2073 656d 6573 7465   None or semeste
-00004570: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-00004580: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
-00004590: 7368 280a 2020 2020 2020 2020 2020 2020  sh(.            
-000045a0: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
-000045b0: 2020 2020 2020 2020 2020 2245 7272 6f72            "Error
-000045c0: 3a20 556e 6162 6c65 2074 6f20 6765 7420  : Unable to get 
-000045d0: 636f 7572 7365 2061 6e64 2f6f 7220 7365  course and/or se
-000045e0: 6d65 7374 6572 2e20 436f 7572 7365 220a  mester. Course".
-000045f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004600: 2020 2020 2220 6973 207b 7d20 616e 6420      " is {} and 
-00004610: 7365 6d65 7374 6572 2069 7320 7b7d 2e22  semester is {}."
-00004620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004630: 2029 2e66 6f72 6d61 7428 7265 7072 2863   ).format(repr(c
-00004640: 6f75 7273 6529 2c20 7265 7072 2873 656d  ourse), repr(sem
-00004650: 6573 7465 7229 290a 2020 2020 2020 2020  ester)).        
-00004660: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00004670: 2020 7265 7475 726e 2065 7272 6f72 5f72    return error_r
-00004680: 6573 706f 6e73 6528 0a20 2020 2020 2020  esponse(.       
-00004690: 2020 2020 2020 2020 2063 6f75 7273 652c           course,
-000046a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000046b0: 2073 656d 6573 7465 722c 0a20 2020 2020   semester,.     
-000046c0: 2020 2020 2020 2020 2020 2075 7365 726e             usern
-000046d0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-000046e0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-000046f0: 2020 2020 2020 2020 2020 2022 4661 696c             "Fail
-00004700: 6564 2074 6f20 6163 6365 7373 203c 636f  ed to access <co
-00004710: 6465 3e63 6f75 7273 653c 2f63 6f64 653e  de>course</code>
-00004720: 2061 6e64 2f6f 7222 0a20 2020 2020 2020   and/or".       
-00004730: 2020 2020 2020 2020 2020 2020 2022 203c               " <
-00004740: 636f 6465 3e73 656d 6573 7465 723c 2f63  code>semester</c
-00004750: 6f64 653e 2076 616c 7565 732e 220a 2020  ode> values.".  
-00004760: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00004770: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00004780: 2020 2020 2020 2023 2047 6574 2061 646d         # Get adm
-00004790: 696e 2069 6e66 6f0a 2020 2020 2020 2020  in info.        
-000047a0: 6164 6d69 6e5f 696e 666f 203d 2073 746f  admin_info = sto
-000047b0: 7261 6765 2e67 6574 5f61 646d 696e 5f69  rage.get_admin_i
-000047c0: 6e66 6f28 636f 7572 7365 2c20 7365 6d65  nfo(course, seme
-000047d0: 7374 6572 290a 2020 2020 2020 2020 6966  ster).        if
-000047e0: 2061 646d 696e 5f69 6e66 6f20 6973 204e   admin_info is N
-000047f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00004800: 2066 6c61 736b 2e66 6c61 7368 2822 4572   flask.flash("Er
-00004810: 726f 7220 6c6f 6164 696e 6720 6164 6d69  ror loading admi
-00004820: 6e20 696e 666f 2122 290a 2020 2020 2020  n info!").      
-00004830: 2020 2020 2020 6164 6d69 6e5f 696e 666f        admin_info
-00004840: 203d 207b 7d0a 0a20 2020 2020 2020 2023   = {}..        #
-00004850: 2043 6865 636b 2075 7365 7220 7072 6976   Check user priv
-00004860: 696c 6567 6573 0a20 2020 2020 2020 2069  ileges.        i
-00004870: 735f 6164 6d69 6e2c 206d 6173 7175 6572  s_admin, masquer
-00004880: 6164 655f 6173 203d 2063 6865 636b 5f75  ade_as = check_u
-00004890: 7365 725f 7072 6976 696c 6567 6573 2861  ser_privileges(a
-000048a0: 646d 696e 5f69 6e66 6f2c 2075 7365 726e  dmin_info, usern
-000048b0: 616d 6529 0a0a 2020 2020 2020 2020 2320  ame)..        # 
-000048c0: 4566 6665 6374 6976 6520 7573 6572 6e61  Effective userna
-000048d0: 6d65 0a20 2020 2020 2020 2065 6666 6563  me.        effec
-000048e0: 7469 7665 5f75 7365 7220 3d20 6d61 7371  tive_user = masq
-000048f0: 7565 7261 6465 5f61 7320 6f72 2075 7365  uerade_as or use
-00004900: 726e 616d 650a 0a20 2020 2020 2020 2023  rname..        #
-00004910: 2047 6574 2062 6173 6963 2069 6e66 6f20   Get basic info 
-00004920: 6f6e 2061 6c6c 2070 7365 7473 2f74 6173  on all psets/tas
-00004930: 6b73 0a20 2020 2020 2020 2074 6173 6b5f  ks.        task_
-00004940: 696e 666f 203d 2073 746f 7261 6765 2e67  info = storage.g
-00004950: 6574 5f74 6173 6b5f 696e 666f 2863 6f75  et_task_info(cou
-00004960: 7273 652c 2073 656d 6573 7465 7229 0a20  rse, semester). 
-00004970: 2020 2020 2020 2069 6620 7461 736b 5f69         if task_i
-00004980: 6e66 6f20 6973 204e 6f6e 653a 2023 2065  nfo is None: # e
-00004990: 7272 6f72 206c 6f61 6469 6e67 2074 6173  rror loading tas
-000049a0: 6b20 696e 666f 0a20 2020 2020 2020 2020  k info.         
-000049b0: 2020 2066 6c61 736b 2e66 6c61 7368 2822     flask.flash("
-000049c0: 4572 726f 7220 6c6f 6164 696e 6720 7461  Error loading ta
-000049d0: 736b 2069 6e66 6f21 2229 0a20 2020 2020  sk info!").     
-000049e0: 2020 2020 2020 2072 6574 7572 6e20 6572         return er
-000049f0: 726f 725f 7265 7370 6f6e 7365 280a 2020  ror_response(.  
-00004a00: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00004a10: 7572 7365 2c0a 2020 2020 2020 2020 2020  urse,.          
-00004a20: 2020 2020 2020 7365 6d65 7374 6572 2c0a        semester,.
-00004a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a40: 7573 6572 6e61 6d65 2c0a 2020 2020 2020  username,.      
-00004a50: 2020 2020 2020 2020 2020 2246 6169 6c65            "Faile
-00004a60: 6420 746f 206c 6f61 6420 3c63 6f64 653e  d to load <code>
-00004a70: 7461 736b 732e 6a73 6f6e 3c2f 636f 6465  tasks.json</code
-00004a80: 3e2e 220a 2020 2020 2020 2020 2020 2020  >.".            
-00004a90: 290a 0a20 2020 2020 2020 2023 2053 6574  )..        # Set
-00004aa0: 2070 6175 7365 2074 696d 6520 666f 7220   pause time for 
-00004ab0: 7468 6520 7461 736b 2069 6e66 6f0a 2020  the task info.  
-00004ac0: 2020 2020 2020 7365 745f 7061 7573 655f        set_pause_
-00004ad0: 7469 6d65 2861 646d 696e 5f69 6e66 6f2c  time(admin_info,
-00004ae0: 2074 6173 6b5f 696e 666f 2c20 7573 6572   task_info, user
-00004af0: 6e61 6d65 2c20 6d61 7371 7565 7261 6465  name, masquerade
-00004b00: 5f61 7329 0a0a 2020 2020 2020 2020 2320  _as)..        # 
-00004b10: 5570 6461 7465 2074 6865 206b 7761 7267  Update the kwarg
-00004b20: 730a 2020 2020 2020 2020 6b77 6172 6773  s.        kwargs
-00004b30: 5b22 7573 6572 6e61 6d65 225d 203d 2075  ["username"] = u
-00004b40: 7365 726e 616d 650a 2020 2020 2020 2020  sername.        
-00004b50: 6b77 6172 6773 5b22 6973 5f61 646d 696e  kwargs["is_admin
-00004b60: 225d 203d 2069 735f 6164 6d69 6e0a 2020  "] = is_admin.  
-00004b70: 2020 2020 2020 6b77 6172 6773 5b22 6d61        kwargs["ma
-00004b80: 7371 7565 7261 6465 5f61 7322 5d20 3d20  squerade_as"] = 
-00004b90: 6d61 7371 7565 7261 6465 5f61 730a 2020  masquerade_as.  
-00004ba0: 2020 2020 2020 6b77 6172 6773 5b22 6566        kwargs["ef
-00004bb0: 6665 6374 6976 655f 7573 6572 225d 203d  fective_user"] =
-00004bc0: 2065 6666 6563 7469 7665 5f75 7365 720a   effective_user.
-00004bd0: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
-00004be0: 7461 736b 5f69 6e66 6f22 5d20 3d20 7461  task_info"] = ta
-00004bf0: 736b 5f69 6e66 6f0a 0a20 2020 2020 2020  sk_info..       
-00004c00: 2023 2043 616c 6c20 7468 6520 6465 636f   # Call the deco
-00004c10: 7261 7465 6420 6675 6e63 7469 6f6e 2077  rated function w
-00004c20: 2f20 7468 6520 6578 7472 6120 7061 7261  / the extra para
-00004c30: 6d65 7465 7273 2077 6527 7665 0a20 2020  meters we've.   
-00004c40: 2020 2020 2023 2064 6564 7563 6564 2e0a       # deduced..
-00004c50: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00004c60: 6f75 7465 5f66 756e 6374 696f 6e28 2a61  oute_function(*a
-00004c70: 7267 732c 202a 2a6b 7761 7267 7329 0a0a  rgs, **kwargs)..
-00004c80: 2020 2020 2320 4772 6162 2069 6e66 6f20      # Grab info 
-00004c90: 6f6e 206f 7269 6769 6e61 6c20 6675 6e63  on original func
-00004ca0: 7469 6f6e 2073 6967 6e61 7475 7265 0a20  tion signature. 
-00004cb0: 2020 2066 6e61 6d65 203d 2072 6f75 7465     fname = route
-00004cc0: 5f66 756e 6374 696f 6e2e 5f5f 6e61 6d65  _function.__name
-00004cd0: 5f5f 0a20 2020 206e 6172 6773 203d 2072  __.    nargs = r
-00004ce0: 6f75 7465 5f66 756e 6374 696f 6e2e 5f5f  oute_function.__
-00004cf0: 636f 6465 5f5f 2e63 6f5f 6172 6763 6f75  code__.co_argcou
-00004d00: 6e74 0a20 2020 2061 7267 6e61 6d65 7320  nt.    argnames 
-00004d10: 3d20 726f 7574 655f 6675 6e63 7469 6f6e  = route_function
-00004d20: 2e5f 5f63 6f64 655f 5f2e 636f 5f76 6172  .__code__.co_var
-00004d30: 6e61 6d65 735b 3a6e 6172 6773 202d 2035  names[:nargs - 5
-00004d40: 5d0a 0a20 2020 2023 2043 7265 6174 6520  ]..    # Create 
-00004d50: 6120 6675 6e63 7469 6f6e 2077 6974 6820  a function with 
-00004d60: 7468 6520 7361 6d65 2073 6967 6e61 7475  the same signatu
-00004d70: 7265 3a0a 2020 2020 636f 6465 203d 2022  re:.    code = "
-00004d80: 2222 5c0a 6465 6620 7b6e 616d 657d 287b  ""\.def {name}({
-00004d90: 6172 6773 7d29 3a0a 2020 2020 7265 7475  args}):.    retu
-00004da0: 726e 2077 6974 685f 6578 7472 615f 6172  rn with_extra_ar
-00004db0: 6775 6d65 6e74 7328 7b61 7267 737d 290a  guments({args}).
-00004dc0: 2222 222e 666f 726d 6174 286e 616d 653d  """.format(name=
-00004dd0: 666e 616d 652c 2061 7267 733d 272c 2027  fname, args=', '
-00004de0: 2e6a 6f69 6e28 6172 676e 616d 6573 2929  .join(argnames))
-00004df0: 0a20 2020 2065 6e76 203d 207b 2277 6974  .    env = {"wit
-00004e00: 685f 6578 7472 615f 6172 6775 6d65 6e74  h_extra_argument
-00004e10: 7322 3a20 7769 7468 5f65 7874 7261 5f61  s": with_extra_a
-00004e20: 7267 756d 656e 7473 7d0a 2020 2020 2320  rguments}.    # 
-00004e30: 322f 3320 636f 6d70 6174 6962 696c 6974  2/3 compatibilit
-00004e40: 7920 6174 7465 6d70 742e 2e2e 0a20 2020  y attempt....   
-00004e50: 2069 6620 7379 732e 7665 7273 696f 6e5f   if sys.version_
-00004e60: 696e 666f 5b30 5d20 3c20 333a 0a20 2020  info[0] < 3:.   
-00004e70: 2020 2020 2065 7865 6328 636f 6465 2920       exec(code) 
-00004e80: 696e 2065 6e76 2c20 656e 760a 2020 2020  in env, env.    
-00004e90: 656c 7365 3a0a 2020 2020 2020 2020 6578  else:.        ex
-00004ea0: 6563 2863 6f64 652c 2065 6e76 2c20 656e  ec(code, env, en
-00004eb0: 7629 2069 6e20 656e 762c 2065 6e76 0a20  v) in env, env. 
-00004ec0: 2020 2072 6573 756c 7420 3d20 656e 765b     result = env[
-00004ed0: 666e 616d 655d 0a0a 2020 2020 2320 5072  fname]..    # Pr
-00004ee0: 6573 6572 7665 2064 6f63 7374 7269 6e67  eserve docstring
-00004ef0: 0a20 2020 2072 6573 756c 742e 5f5f 646f  .    result.__do
-00004f00: 635f 5f20 3d20 726f 7574 655f 6675 6e63  c__ = route_func
-00004f10: 7469 6f6e 2e5f 5f64 6f63 5f5f 0a0a 2020  tion.__doc__..  
-00004f20: 2020 2320 5265 7475 726e 206f 7572 2073    # Return our s
-00004f30: 796e 7468 6574 6963 2066 756e 6374 696f  ynthetic functio
-00004f40: 6e2e 2e2e 0a20 2020 2072 6574 7572 6e20  n....    return 
-00004f50: 7265 7375 6c74 0a0a 0a64 6566 2067 6f62  result...def gob
-00004f60: 6163 6b28 636f 7572 7365 2c20 7365 6d65  ack(course, seme
-00004f70: 7374 6572 293a 0a20 2020 2022 2222 0a20  ster):.    """. 
-00004f80: 2020 2052 6574 7572 6e73 2061 2066 6c61     Returns a fla
-00004f90: 736b 2072 6564 6972 6563 7420 6169 6d65  sk redirect aime
-00004fa0: 6420 6174 2065 6974 6865 7220 7468 6520  d at either the 
-00004fb0: 7061 6765 2074 6861 7420 7468 6520 7573  page that the us
-00004fc0: 6572 2063 616d 650a 2020 2020 6672 6f6d  er came.    from
-00004fd0: 2c20 6f72 2074 6865 2064 6173 6862 6f61  , or the dashboa
-00004fe0: 7264 2069 6620 7468 6174 2069 6e66 6f72  rd if that infor
-00004ff0: 6d61 7469 6f6e 2069 736e 2774 2061 7661  mation isn't ava
-00005000: 696c 6162 6c65 2e0a 2020 2020 2222 220a  ilable..    """.
-00005010: 2020 2020 6966 2066 6c61 736b 2e72 6571      if flask.req
-00005020: 7565 7374 2e72 6566 6572 7265 723a 0a20  uest.referrer:. 
-00005030: 2020 2020 2020 2023 2049 6620 7765 206b         # If we k
-00005040: 6e6f 7720 7768 6572 6520 796f 7520 6361  now where you ca
-00005050: 6d65 2066 726f 6d2c 2073 656e 6420 796f  me from, send yo
-00005060: 7520 6261 636b 2074 6865 7265 0a20 2020  u back there.   
-00005070: 2020 2020 2072 6574 7572 6e20 666c 6173       return flas
-00005080: 6b2e 7265 6469 7265 6374 2866 6c61 736b  k.redirect(flask
-00005090: 2e72 6571 7565 7374 2e72 6566 6572 7265  .request.referre
-000050a0: 7229 0a20 2020 2065 6c73 653a 0a20 2020  r).    else:.   
-000050b0: 2020 2020 2023 204f 7468 6572 7769 7365       # Otherwise
-000050c0: 2062 6163 6b20 746f 2074 6865 2064 6173   back to the das
-000050d0: 6862 6f61 7264 0a20 2020 2020 2020 2072  hboard.        r
-000050e0: 6574 7572 6e20 666c 6173 6b2e 7265 6469  eturn flask.redi
-000050f0: 7265 6374 280a 2020 2020 2020 2020 2020  rect(.          
-00005100: 2020 666c 6173 6b2e 7572 6c5f 666f 7228    flask.url_for(
-00005110: 2772 6f75 7465 5f64 6173 6827 2c20 636f  'route_dash', co
-00005120: 7572 7365 3d63 6f75 7273 652c 2073 656d  urse=course, sem
-00005130: 6573 7465 723d 7365 6d65 7374 6572 290a  ester=semester).
-00005140: 2020 2020 2020 2020 290a 0a0a 232d 2d2d          )...#---
-00005150: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 230a  --------------#.
-00005160: 2320 526f 7574 6520 6675 6e63 7469 6f6e  # Route function
-00005170: 7320 230a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  s #.#-----------
-00005180: 2d2d 2d2d 2d2d 230a 0a40 6170 702e 726f  ------#..@app.ro
-00005190: 7574 6528 272f 2729 0a64 6566 2072 6f75  ute('/').def rou
-000051a0: 7465 5f69 6e64 6578 2829 3a0a 2020 2020  te_index():.    
-000051b0: 2222 220a 2020 2020 4368 6563 6b73 2061  """.    Checks a
-000051c0: 7574 6865 6e74 6963 6174 696f 6e20 616e  uthentication an
-000051d0: 6420 7265 6469 7265 6374 7320 746f 206c  d redirects to l
-000051e0: 6f67 696e 2070 6167 6520 6f72 2074 6f20  ogin page or to 
-000051f0: 6461 7368 626f 6172 642e 0a20 2020 2022  dashboard..    "
-00005200: 2222 0a20 2020 2069 6620 4e4f 4155 5448  "".    if NOAUTH
-00005210: 206f 7220 6361 732e 7573 6572 6e61 6d65   or cas.username
-00005220: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00005230: 2066 6c61 736b 2e72 6564 6972 6563 7428   flask.redirect(
-00005240: 666c 6173 6b2e 7572 6c5f 666f 7228 2772  flask.url_for('r
-00005250: 6f75 7465 5f64 6566 6175 6c74 5f64 6173  oute_default_das
-00005260: 6827 2929 0a20 2020 2065 6c73 653a 0a20  h')).    else:. 
-00005270: 2020 2020 2020 2072 6574 7572 6e20 666c         return fl
-00005280: 6173 6b2e 7265 6469 7265 6374 2866 6c61  ask.redirect(fla
-00005290: 736b 2e75 726c 5f66 6f72 2827 6361 732e  sk.url_for('cas.
-000052a0: 6c6f 6769 6e27 2929 0a0a 0a40 6170 702e  login'))...@app.
-000052b0: 726f 7574 6528 272f 6461 7368 626f 6172  route('/dashboar
-000052c0: 6427 290a 4066 6c61 736b 5f63 6173 2e6c  d').@flask_cas.l
-000052d0: 6f67 696e 5f72 6571 7569 7265 640a 6465  ogin_required.de
-000052e0: 6620 726f 7574 655f 6465 6661 756c 745f  f route_default_
-000052f0: 6461 7368 2829 3a0a 2020 2020 2222 220a  dash():.    """.
-00005300: 2020 2020 5265 6469 7265 6374 7320 746f      Redirects to
-00005310: 2064 6173 6862 6f61 7264 2077 2f20 6465   dashboard w/ de
-00005320: 6661 756c 7420 636c 6173 732f 7365 6d65  fault class/seme
-00005330: 7374 6572 2e0a 2020 2020 2222 220a 2020  ster..    """.  
-00005340: 2020 7265 7475 726e 2066 6c61 736b 2e72    return flask.r
-00005350: 6564 6972 6563 7428 0a20 2020 2020 2020  edirect(.       
-00005360: 2066 6c61 736b 2e75 726c 5f66 6f72 280a   flask.url_for(.
-00005370: 2020 2020 2020 2020 2020 2020 2772 6f75              'rou
-00005380: 7465 5f64 6173 6827 2c0a 2020 2020 2020  te_dash',.      
-00005390: 2020 2020 2020 636f 7572 7365 3d61 7070        course=app
-000053a0: 2e63 6f6e 6669 672e 6765 7428 2244 4546  .config.get("DEF
-000053b0: 4155 4c54 5f43 4f55 5253 4522 2c20 2275  AULT_COURSE", "u
-000053c0: 6e6b 6e6f 776e 2229 2c0a 2020 2020 2020  nknown"),.      
-000053d0: 2020 2020 2020 7365 6d65 7374 6572 3d61        semester=a
-000053e0: 7070 2e63 6f6e 6669 672e 6765 7428 2244  pp.config.get("D
-000053f0: 4546 4155 4c54 5f53 454d 4553 5445 5222  EFAULT_SEMESTER"
-00005400: 2c20 2275 6e6b 6e6f 776e 2229 0a20 2020  , "unknown").   
-00005410: 2020 2020 2029 0a20 2020 2029 0a0a 0a40       ).    )...@
-00005420: 6170 702e 726f 7574 6528 272f 3c63 6f75  app.route('/<cou
-00005430: 7273 653e 2f3c 7365 6d65 7374 6572 3e2f  rse>/<semester>/
-00005440: 6461 7368 626f 6172 6427 290a 4066 6c61  dashboard').@fla
-00005450: 736b 5f63 6173 2e6c 6f67 696e 5f72 6571  sk_cas.login_req
-00005460: 7569 7265 640a 4061 7567 6d65 6e74 5f61  uired.@augment_a
-00005470: 7267 756d 656e 7473 0a64 6566 2072 6f75  rguments.def rou
-00005480: 7465 5f64 6173 6828 0a20 2020 2063 6f75  te_dash(.    cou
-00005490: 7273 652c 0a20 2020 2073 656d 6573 7465  rse,.    semeste
-000054a0: 722c 0a20 2020 2023 2041 7567 6d65 6e74  r,.    # Augment
-000054b0: 6564 2061 7267 756d 656e 7473 0a20 2020  ed arguments.   
-000054c0: 2075 7365 726e 616d 652c 0a20 2020 2069   username,.    i
-000054d0: 735f 6164 6d69 6e2c 0a20 2020 206d 6173  s_admin,.    mas
-000054e0: 7175 6572 6164 655f 6173 2c0a 2020 2020  querade_as,.    
-000054f0: 6566 6665 6374 6976 655f 7573 6572 2c0a  effective_user,.
-00005500: 2020 2020 7461 736b 5f69 6e66 6f0a 293a      task_info.):
-00005510: 0a20 2020 2022 2222 0a20 2020 2044 6973  .    """.    Dis
-00005520: 706c 6179 7320 6461 7368 626f 6172 6420  plays dashboard 
-00005530: 772f 206c 696e 6b73 2066 6f72 2073 7562  w/ links for sub
-00005540: 6d69 7474 696e 6720 6561 6368 2070 7365  mitting each pse
-00005550: 742f 7461 736b 2026 2073 756d 6d61 7279  t/task & summary
-00005560: 0a20 2020 2069 6e66 6f72 6d61 7469 6f6e  .    information
-00005570: 206f 6620 7461 736b 2067 7261 6465 732e   of task grades.
-00005580: 2041 6c73 6f20 696e 636c 7564 6573 2069   Also includes i
-00005590: 6e66 6f20 6f6e 2073 7562 6d69 7474 6564  nfo on submitted
-000055a0: 0a20 2020 2065 7865 7263 6973 6573 2e0a  .    exercises..
-000055b0: 2020 2020 2222 220a 0a20 2020 2023 2041      """..    # A
-000055c0: 6464 2070 7365 7420 7374 6174 7573 2061  dd pset status a
-000055d0: 6e64 2074 6173 6b20 6665 6564 6261 636b  nd task feedback
-000055e0: 2073 756d 6d61 7269 6573 2074 6f20 7461   summaries to ta
-000055f0: 736b 2069 6e66 6f0a 2020 2020 616d 656e  sk info.    amen
-00005600: 645f 7461 736b 5f69 6e66 6f28 636f 7572  d_task_info(cour
-00005610: 7365 2c20 7365 6d65 7374 6572 2c20 7461  se, semester, ta
-00005620: 736b 5f69 6e66 6f2c 2065 6666 6563 7469  sk_info, effecti
-00005630: 7665 5f75 7365 7229 0a0a 2020 2020 2320  ve_user)..    # 
-00005640: 4765 7420 636f 6e63 6570 7473 2069 6e66  Get concepts inf
-00005650: 6f0a 2020 2020 636f 6e63 6570 7473 203d  o.    concepts =
-00005660: 2073 746f 7261 6765 2e67 6574 5f63 6f6e   storage.get_con
-00005670: 6365 7074 7328 636f 7572 7365 2c20 7365  cepts(course, se
-00005680: 6d65 7374 6572 290a 2020 2020 6966 2063  mester).    if c
-00005690: 6f6e 6365 7074 7320 6973 204e 6f6e 653a  oncepts is None:
-000056a0: 0a20 2020 2020 2020 2066 6c61 736b 2e66  .        flask.f
-000056b0: 6c61 7368 2822 5761 726e 696e 673a 2063  lash("Warning: c
-000056c0: 6f6e 6365 7074 7320 6e6f 7420 7370 6563  oncepts not spec
-000056d0: 6966 6965 642f 6176 6169 6c61 626c 652e  ified/available.
-000056e0: 2229 0a20 2020 2020 2020 2063 6f6e 6365  ").        conce
-000056f0: 7074 7320 3d20 5b5d 0a0a 2020 2020 2320  pts = []..    # 
-00005700: 4772 6162 206c 6174 6573 742d 6f75 7463  Grab latest-outc
-00005710: 6f6d 6573 2069 6e66 6f20 666f 7220 6578  omes info for ex
-00005720: 6572 6369 7365 730a 2020 2020 6f75 7463  ercises.    outc
-00005730: 6f6d 6573 203d 2073 746f 7261 6765 2e66  omes = storage.f
-00005740: 6574 6368 5f62 6573 745f 6f75 7463 6f6d  etch_best_outcom
-00005750: 6573 2863 6f75 7273 652c 2073 656d 6573  es(course, semes
-00005760: 7465 722c 2065 6666 6563 7469 7665 5f75  ter, effective_u
-00005770: 7365 7229 0a0a 2020 2020 2320 4175 676d  ser)..    # Augm
-00005780: 656e 7420 7468 6520 636f 6e63 6570 7473  ent the concepts
-00005790: 2073 7472 7563 7475 7265 2074 6f20 696e   structure to in
-000057a0: 636c 7564 6520 7265 616c 206f 626a 6563  clude real objec
-000057b0: 740a 2020 2020 2320 7265 6665 7265 6e63  t.    # referenc
-000057c0: 6573 0a20 2020 2061 7567 6d65 6e74 5f63  es.    augment_c
-000057d0: 6f6e 6365 7074 7328 636f 6e63 6570 7473  oncepts(concepts
-000057e0: 290a 0a20 2020 2023 2055 7064 6174 6520  )..    # Update 
-000057f0: 636f 6e63 6570 7473 206c 6973 7420 7769  concepts list wi
-00005800: 7468 2073 7461 7475 7365 7320 6261 7365  th statuses base
-00005810: 6420 6f6e 2065 7865 7263 6973 6520 6f75  d on exercise ou
-00005820: 7463 6f6d 6573 0a20 2020 2023 2061 6e64  tcomes.    # and
-00005830: 2061 6d65 6e64 6564 2074 6173 6b20 696e   amended task in
-00005840: 666f 2e0a 2020 2020 7365 745f 636f 6e63  fo..    set_conc
-00005850: 6570 745f 7374 6174 7573 6573 2863 6f6e  ept_statuses(con
-00005860: 6365 7074 732c 2074 6173 6b5f 696e 666f  cepts, task_info
-00005870: 2c20 6f75 7463 6f6d 6573 290a 0a20 2020  , outcomes)..   
-00005880: 2023 2052 656e 6465 7220 6461 7368 626f   # Render dashbo
-00005890: 6172 6420 7465 6d70 6c61 7465 0a20 2020  ard template.   
-000058a0: 2072 6574 7572 6e20 666c 6173 6b2e 7265   return flask.re
-000058b0: 6e64 6572 5f74 656d 706c 6174 6528 0a20  nder_template(. 
-000058c0: 2020 2020 2020 2027 6461 7368 626f 6172         'dashboar
-000058d0: 642e 6a32 272c 0a20 2020 2020 2020 2063  d.j2',.        c
-000058e0: 6f75 7273 655f 6e61 6d65 3d61 7070 2e63  ourse_name=app.c
-000058f0: 6f6e 6669 672e 6765 7428 2243 4f55 5253  onfig.get("COURS
-00005900: 455f 4e41 4d45 5322 2c20 7b7d 292e 6765  E_NAMES", {}).ge
-00005910: 7428 636f 7572 7365 2c20 636f 7572 7365  t(course, course
-00005920: 292c 0a20 2020 2020 2020 2063 6f75 7273  ),.        cours
-00005930: 653d 636f 7572 7365 2c0a 2020 2020 2020  e=course,.      
-00005940: 2020 7365 6d65 7374 6572 3d73 656d 6573    semester=semes
-00005950: 7465 722c 0a20 2020 2020 2020 2075 7365  ter,.        use
-00005960: 726e 616d 653d 7573 6572 6e61 6d65 2c0a  rname=username,.
-00005970: 2020 2020 2020 2020 6973 5f61 646d 696e          is_admin
-00005980: 3d69 735f 6164 6d69 6e2c 0a20 2020 2020  =is_admin,.     
-00005990: 2020 206d 6173 7175 6572 6164 655f 6173     masquerade_as
-000059a0: 3d6d 6173 7175 6572 6164 655f 6173 2c0a  =masquerade_as,.
-000059b0: 2020 2020 2020 2020 6566 6665 6374 6976          effectiv
-000059c0: 655f 7573 6572 3d65 6666 6563 7469 7665  e_user=effective
-000059d0: 5f75 7365 722c 0a20 2020 2020 2020 2074  _user,.        t
-000059e0: 6173 6b5f 696e 666f 3d74 6173 6b5f 696e  ask_info=task_in
-000059f0: 666f 2c0a 2020 2020 2020 2020 6f75 7463  fo,.        outc
-00005a00: 6f6d 6573 3d6f 7574 636f 6d65 732c 2023  omes=outcomes, #
-00005a10: 2054 4f44 4f3a 2055 5345 2054 4849 530a   TODO: USE THIS.
-00005a20: 2020 2020 2020 2020 636f 6e63 6570 7473          concepts
-00005a30: 3d63 6f6e 6365 7074 7320 2320 544f 444f  =concepts # TODO
-00005a40: 3a20 5553 4520 5448 4953 0a20 2020 2029  : USE THIS.    )
-00005a50: 0a0a 0a40 6170 702e 726f 7574 6528 0a20  ...@app.route(. 
-00005a60: 2020 2027 2f3c 636f 7572 7365 3e2f 3c73     '/<course>/<s
-00005a70: 656d 6573 7465 723e 2f66 6565 6462 6163  emester>/feedbac
-00005a80: 6b2f 3c74 6172 6765 745f 7573 6572 3e2f  k/<target_user>/
-00005a90: 3c70 6861 7365 3e2f 3c70 7369 643e 2f3c  <phase>/<psid>/<
-00005aa0: 7461 736b 6964 3e27 0a29 0a40 666c 6173  taskid>'.).@flas
-00005ab0: 6b5f 6361 732e 6c6f 6769 6e5f 7265 7175  k_cas.login_requ
-00005ac0: 6972 6564 0a40 6175 676d 656e 745f 6172  ired.@augment_ar
-00005ad0: 6775 6d65 6e74 730a 6465 6620 726f 7574  guments.def rout
-00005ae0: 655f 6665 6564 6261 636b 280a 2020 2020  e_feedback(.    
-00005af0: 636f 7572 7365 2c0a 2020 2020 7365 6d65  course,.    seme
-00005b00: 7374 6572 2c0a 2020 2020 7461 7267 6574  ster,.    target
-00005b10: 5f75 7365 722c 0a20 2020 2070 6861 7365  _user,.    phase
-00005b20: 2c0a 2020 2020 7073 6964 2c0a 2020 2020  ,.    psid,.    
-00005b30: 7461 736b 6964 2c0a 2020 2020 2320 4175  taskid,.    # Au
-00005b40: 676d 656e 7465 6420 6172 6775 6d65 6e74  gmented argument
-00005b50: 730a 2020 2020 7573 6572 6e61 6d65 2c0a  s.    username,.
-00005b60: 2020 2020 6973 5f61 646d 696e 2c0a 2020      is_admin,.  
-00005b70: 2020 6d61 7371 7565 7261 6465 5f61 732c    masquerade_as,
-00005b80: 0a20 2020 2065 6666 6563 7469 7665 5f75  .    effective_u
-00005b90: 7365 722c 0a20 2020 2074 6173 6b5f 696e  ser,.    task_in
-00005ba0: 666f 0a29 3a0a 2020 2020 2222 220a 2020  fo.):.    """.  
-00005bb0: 2020 4469 7370 6c61 7973 2066 6565 6462    Displays feedb
-00005bc0: 6163 6b20 6f6e 2061 2070 6172 7469 6375  ack on a particu
-00005bd0: 6c61 7220 7461 736b 206f 6620 6120 7061  lar task of a pa
-00005be0: 7274 6963 756c 6172 2070 726f 626c 656d  rticular problem
-00005bf0: 2073 6574 2c0a 2020 2020 666f 7220 6569   set,.    for ei
-00005c00: 7468 6572 2074 6865 2027 696e 6974 6961  ther the 'initia
-00005c10: 6c27 206f 7220 2772 6576 6973 696f 6e27  l' or 'revision'
-00005c20: 2070 6861 7365 2e0a 2020 2020 2222 220a   phase..    """.
-00005c30: 2020 2020 6966 2074 6172 6765 745f 7573      if target_us
-00005c40: 6572 2021 3d20 6566 6665 6374 6976 655f  er != effective_
-00005c50: 7573 6572 2061 6e64 206e 6f74 2069 735f  user and not is_
-00005c60: 6164 6d69 6e3a 0a20 2020 2020 2020 2072  admin:.        r
-00005c70: 6574 7572 6e20 6572 726f 725f 7265 7370  eturn error_resp
-00005c80: 6f6e 7365 280a 2020 2020 2020 2020 2020  onse(.          
-00005c90: 2020 636f 7572 7365 2c0a 2020 2020 2020    course,.      
-00005ca0: 2020 2020 2020 7365 6d65 7374 6572 2c0a        semester,.
-00005cb0: 2020 2020 2020 2020 2020 2020 7573 6572              user
-00005cc0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00005cd0: 2020 2259 6f75 2061 7265 206e 6f74 2061    "You are not a
-00005ce0: 6c6c 6f77 6564 2074 6f20 7669 6577 2066  llowed to view f
-00005cf0: 6565 6462 6163 6b20 666f 7220 7b7d 2e22  eedback for {}."
-00005d00: 2e66 6f72 6d61 7428 7461 7267 6574 5f75  .format(target_u
-00005d10: 7365 7229 0a20 2020 2020 2020 2029 0a20  ser).        ). 
-00005d20: 2020 2065 6c69 6620 7461 7267 6574 5f75     elif target_u
-00005d30: 7365 7220 213d 2065 6666 6563 7469 7665  ser != effective
-00005d40: 5f75 7365 723a 0a20 2020 2020 2020 2066  _user:.        f
-00005d50: 6c61 736b 2e66 6c61 7368 2822 5669 6577  lask.flash("View
-00005d60: 696e 6720 6665 6564 6261 636b 2066 6f72  ing feedback for
-00005d70: 207b 7d2e 222e 666f 726d 6174 2874 6172   {}.".format(tar
-00005d80: 6765 745f 7573 6572 2929 0a0a 2020 2020  get_user))..    
-00005d90: 2320 4672 6f6d 2068 6572 6520 6f6e 2077  # From here on w
-00005da0: 6520 7472 6561 7420 7468 6520 6566 6665  e treat the effe
-00005db0: 6374 6976 6520 7573 6572 2061 7320 7468  ctive user as th
-00005dc0: 6520 7461 7267 6574 2075 7365 720a 2020  e target user.  
-00005dd0: 2020 6566 6665 6374 6976 655f 7573 6572    effective_user
-00005de0: 203d 2074 6172 6765 745f 7573 6572 0a0a   = target_user..
-00005df0: 2020 2020 2320 4368 6563 6b20 726f 7374      # Check rost
-00005e00: 6572 2061 6e64 2066 6c61 7368 2061 2077  er and flash a w
-00005e10: 6172 6e69 6e67 2069 6620 7765 2772 6520  arning if we're 
-00005e20: 7669 6577 696e 6720 6665 6564 6261 636b  viewing feedback
-00005e30: 2066 6f72 2061 0a20 2020 2023 2075 7365   for a.    # use
-00005e40: 7220 7768 6f20 6973 206e 6f74 206f 6e20  r who is not on 
-00005e50: 7468 6520 726f 7374 6572 2e2e 2e0a 2020  the roster....  
-00005e60: 2020 7472 793a 0a20 2020 2020 2020 2072    try:.        r
-00005e70: 6f73 7465 7220 3d20 7374 6f72 6167 652e  oster = storage.
-00005e80: 6765 745f 726f 7374 6572 2863 6f75 7273  get_roster(cours
-00005e90: 652c 2073 656d 6573 7465 7229 0a20 2020  e, semester).   
-00005ea0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00005eb0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-00005ec0: 666c 6173 6b2e 666c 6173 6828 7374 7228  flask.flash(str(
-00005ed0: 6529 290a 2020 2020 2020 2020 726f 7374  e)).        rost
-00005ee0: 6572 203d 204e 6f6e 650a 0a20 2020 2069  er = None..    i
-00005ef0: 6620 726f 7374 6572 2069 7320 4e6f 6e65  f roster is None
-00005f00: 3a0a 2020 2020 2020 2020 666c 6173 6b2e  :.        flask.
-00005f10: 666c 6173 6828 0a20 2020 2020 2020 2020  flash(.         
-00005f20: 2020 2022 5761 726e 696e 673a 2063 6f75     "Warning: cou
-00005f30: 6c64 206e 6f74 2066 6574 6368 2072 6f73  ld not fetch ros
-00005f40: 7465 7220 746f 2063 6865 636b 2069 6620  ter to check if 
-00005f50: 7468 6973 2075 7365 7220 6973 206f 6e22  this user is on"
-00005f60: 0a20 2020 2020 2020 2020 2020 2022 2069  .            " i
-00005f70: 742e 220a 2020 2020 2020 2020 290a 2020  t.".        ).  
-00005f80: 2020 656c 6966 2065 6666 6563 7469 7665    elif effective
-00005f90: 5f75 7365 7220 6e6f 7420 696e 2072 6f73  _user not in ros
-00005fa0: 7465 723a 0a20 2020 2020 2020 2066 6c61  ter:.        fla
-00005fb0: 736b 2e66 6c61 7368 2822 5761 726e 696e  sk.flash("Warnin
-00005fc0: 673a 2074 6869 7320 7573 6572 2069 7320  g: this user is 
-00005fd0: 6e6f 7420 6f6e 2074 6865 2072 6f73 7465  not on the roste
-00005fe0: 7221 2229 0a0a 2020 2020 2320 4765 7420  r!")..    # Get 
-00005ff0: 6675 6c6c 2066 6565 6462 6163 6b2d 7265  full feedback-re
-00006000: 6164 7920 7073 6574 2061 6e64 2074 6173  ady pset and tas
-00006010: 6b20 6f62 6a65 6374 730a 2020 2020 7073  k objects.    ps
-00006020: 5f61 6e64 5f74 6173 6b20 3d20 6765 745f  _and_task = get_
-00006030: 6665 6564 6261 636b 5f70 735f 616e 645f  feedback_ps_and_
-00006040: 7461 736b 280a 2020 2020 2020 2020 7461  task(.        ta
-00006050: 736b 5f69 6e66 6f2c 0a20 2020 2020 2020  sk_info,.       
-00006060: 2063 6f75 7273 652c 0a20 2020 2020 2020   course,.       
-00006070: 2073 656d 6573 7465 722c 0a20 2020 2020   semester,.     
-00006080: 2020 2074 6172 6765 745f 7573 6572 2c0a     target_user,.
-00006090: 2020 2020 2020 2020 7068 6173 652c 0a20          phase,. 
-000060a0: 2020 2020 2020 2070 7369 642c 0a20 2020         psid,.   
-000060b0: 2020 2020 2074 6173 6b69 640a 2020 2020       taskid.    
-000060c0: 290a 2020 2020 6966 2069 7369 6e73 7461  ).    if isinsta
-000060d0: 6e63 6528 7073 5f61 6e64 5f74 6173 6b2c  nce(ps_and_task,
-000060e0: 2056 616c 7565 4572 726f 7229 3a0a 2020   ValueError):.  
-000060f0: 2020 2020 2020 666c 6173 6b2e 666c 6173        flask.flas
-00006100: 6828 7374 7228 7073 5f61 6e64 5f74 6173  h(str(ps_and_tas
-00006110: 6b29 290a 2020 2020 2020 2020 7265 7475  k)).        retu
-00006120: 726e 2067 6f62 6163 6b28 636f 7572 7365  rn goback(course
-00006130: 2c20 7365 6d65 7374 6572 290a 2020 2020  , semester).    
-00006140: 656c 7365 3a0a 2020 2020 2020 2020 7073  else:.        ps
-00006150: 2c20 7461 736b 203d 2070 735f 616e 645f  , task = ps_and_
-00006160: 7461 736b 0a0a 2020 2020 6966 2074 6173  task..    if tas
-00006170: 6b5b 2265 7661 6c5f 7374 6174 7573 225d  k["eval_status"]
-00006180: 206e 6f74 2069 6e20 280a 2020 2020 2020   not in (.      
-00006190: 2020 4e6f 6e65 2c0a 2020 2020 2020 2020    None,.        
-000061a0: 2275 6e6b 6e6f 776e 222c 0a20 2020 2020  "unknown",.     
-000061b0: 2020 2022 696e 6974 6961 6c22 2c0a 2020     "initial",.  
-000061c0: 2020 2020 2020 2269 6e5f 7072 6f67 7265        "in_progre
-000061d0: 7373 222c 0a20 2020 2020 2020 2022 6572  ss",.        "er
-000061e0: 726f 7222 2c0a 2020 2020 2020 2020 2265  ror",.        "e
-000061f0: 7870 6972 6564 222c 0a20 2020 2020 2020  xpired",.       
-00006200: 2022 636f 6d70 6c65 7465 6422 0a20 2020   "completed".   
-00006210: 2029 3a0a 2020 2020 2020 2020 6d73 6720   ):.        msg 
-00006220: 3d20 2249 6e76 616c 6964 2065 7661 6c75  = "Invalid evalu
-00006230: 6174 696f 6e20 7374 6174 7573 203c 636f  ation status <co
-00006240: 6465 3e7b 7d3c 2f63 6f64 653e 2e22 2e66  de>{}</code>.".f
-00006250: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
-00006260: 2020 2074 6173 6b5b 2265 7661 6c5f 7374     task["eval_st
-00006270: 6174 7573 225d 0a20 2020 2020 2020 2029  atus"].        )
-00006280: 0a20 2020 2020 2020 2066 6c61 736b 2e66  .        flask.f
-00006290: 6c61 7368 286d 7367 290a 2020 2020 2020  lash(msg).      
-000062a0: 2020 7265 7475 726e 2065 7272 6f72 5f72    return error_r
-000062b0: 6573 706f 6e73 6528 636f 7572 7365 2c20  esponse(course, 
-000062c0: 7365 6d65 7374 6572 2c20 7573 6572 6e61  semester, userna
-000062d0: 6d65 2c20 6d73 6729 0a0a 2020 2020 2320  me, msg)..    # 
-000062e0: 5365 7420 6175 746f 2d72 6566 7265 7368  Set auto-refresh
-000062f0: 2062 6173 6564 206f 6e20 6576 616c 7561   based on evalua
-00006300: 7469 6f6e 2073 7461 7475 730a 2020 2020  tion status.    
-00006310: 6966 2074 6173 6b5b 2265 7661 6c5f 7374  if task["eval_st
-00006320: 6174 7573 225d 2069 6e20 2822 756e 6b6e  atus"] in ("unkn
-00006330: 6f77 6e22 2c20 2269 6e5f 7072 6f67 7265  own", "in_progre
-00006340: 7373 222c 2022 6572 726f 7222 293a 0a20  ss", "error"):. 
-00006350: 2020 2020 2020 2072 6566 7265 7368 203d         refresh =
-00006360: 2032 300a 2020 2020 2020 2020 666c 6173   20.        flas
-00006370: 6b2e 666c 6173 6828 2222 225c 0a54 6869  k.flash("""\.Thi
-00006380: 7320 7061 6765 2073 686f 756c 6420 7265  s page should re
-00006390: 6672 6573 6820 6974 7365 6c66 207b 7265  fresh itself {re
-000063a0: 6672 6573 687d 2073 6563 6f6e 6473 2061  fresh} seconds a
-000063b0: 6674 6572 206c 6f61 6469 6e67 0a3c 7370  fter loading.<sp
-000063c0: 616e 0a20 726f 6c65 3d22 7469 6d65 7222  an. role="timer"
-000063d0: 0a20 6172 6961 2d6c 6976 653d 226f 6666  . aria-live="off
-000063e0: 220a 2063 6c61 7373 3d22 7469 6d65 7222  ". class="timer"
-000063f0: 0a20 6461 7461 2d74 696d 653d 227b 7265  . data-time="{re
-00006400: 6672 6573 687d 220a 3e0a 2020 7b72 6566  fresh}".>.  {ref
-00006410: 7265 7368 7d0a 3c2f 7370 616e 3e2e 2222  resh}.</span>.""
-00006420: 222e 666f 726d 6174 2872 6566 7265 7368  ".format(refresh
-00006430: 3d72 6566 7265 7368 2929 0a20 2020 2065  =refresh)).    e
-00006440: 6c73 653a 0a20 2020 2020 2020 2072 6566  lse:.        ref
-00006450: 7265 7368 203d 204e 6f6e 650a 0a20 2020  resh = None..   
-00006460: 2072 6574 7572 6e20 666c 6173 6b2e 7265   return flask.re
-00006470: 6e64 6572 5f74 656d 706c 6174 6528 0a20  nder_template(. 
-00006480: 2020 2020 2020 2027 6665 6564 6261 636b         'feedback
-00006490: 2e6a 3227 2c0a 2020 2020 2020 2020 636f  .j2',.        co
-000064a0: 7572 7365 5f6e 616d 653d 6170 702e 636f  urse_name=app.co
-000064b0: 6e66 6967 2e67 6574 2822 434f 5552 5345  nfig.get("COURSE
-000064c0: 5f4e 414d 4553 222c 207b 7d29 2e67 6574  _NAMES", {}).get
-000064d0: 2863 6f75 7273 652c 2063 6f75 7273 6529  (course, course)
-000064e0: 2c0a 2020 2020 2020 2020 636f 7572 7365  ,.        course
-000064f0: 3d63 6f75 7273 652c 0a20 2020 2020 2020  =course,.       
-00006500: 2073 656d 6573 7465 723d 7365 6d65 7374   semester=semest
-00006510: 6572 2c0a 2020 2020 2020 2020 7573 6572  er,.        user
-00006520: 6e61 6d65 3d75 7365 726e 616d 652c 0a20  name=username,. 
-00006530: 2020 2020 2020 2069 735f 6164 6d69 6e3d         is_admin=
-00006540: 6973 5f61 646d 696e 2c0a 2020 2020 2020  is_admin,.      
-00006550: 2020 6d61 7371 7565 7261 6465 5f61 733d    masquerade_as=
-00006560: 6d61 7371 7565 7261 6465 5f61 732c 0a20  masquerade_as,. 
-00006570: 2020 2020 2020 2065 6666 6563 7469 7665         effective
-00006580: 5f75 7365 723d 6566 6665 6374 6976 655f  _user=effective_
-00006590: 7573 6572 2c0a 2020 2020 2020 2020 7461  user,.        ta
-000065a0: 7267 6574 5f75 7365 723d 7461 7267 6574  rget_user=target
-000065b0: 5f75 7365 722c 0a20 2020 2020 2020 2070  _user,.        p
-000065c0: 6861 7365 3d70 6861 7365 2c0a 2020 2020  hase=phase,.    
-000065d0: 2020 2020 7073 3d70 732c 0a20 2020 2020      ps=ps,.     
-000065e0: 2020 2074 6173 6b3d 7461 736b 2c0a 2020     task=task,.  
-000065f0: 2020 2020 2020 7461 736b 5f69 6e66 6f3d        task_info=
-00006600: 7461 736b 5f69 6e66 6f2c 0a20 2020 2020  task_info,.     
-00006610: 2020 2066 625f 6373 733d 706f 746c 7563     fb_css=potluc
-00006620: 6b2e 7265 6e64 6572 2e67 6574 5f63 7373  k.render.get_css
-00006630: 2829 2c0a 2020 2020 2020 2020 6662 5f6a  (),.        fb_j
-00006640: 733d 706f 746c 7563 6b2e 7265 6e64 6572  s=potluck.render
-00006650: 2e67 6574 5f6a 7328 292c 0a20 2020 2020  .get_js(),.     
-00006660: 2020 2073 7570 706f 7274 5f6c 696e 6b3d     support_link=
-00006670: 6170 702e 636f 6e66 6967 5b22 5355 5050  app.config["SUPP
-00006680: 4f52 545f 4c49 4e4b 225d 2c0a 2020 2020  ORT_LINK"],.    
-00006690: 2020 2020 7265 6672 6573 683d 7265 6672      refresh=refr
-000066a0: 6573 680a 2020 2020 290a 0a0a 4061 7070  esh.    )...@app
-000066b0: 2e72 6f75 7465 280a 2020 2020 272f 3c63  .route(.    '/<c
-000066c0: 6f75 7273 653e 2f3c 7365 6d65 7374 6572  ourse>/<semester
-000066d0: 3e2f 7375 626d 6974 2f3c 7073 6964 3e2f  >/submit/<psid>/
-000066e0: 3c74 6173 6b69 643e 272c 0a20 2020 206d  <taskid>',.    m
-000066f0: 6574 686f 6473 3d5b 2750 4f53 5427 5d0a  ethods=['POST'].
-00006700: 290a 4066 6c61 736b 5f63 6173 2e6c 6f67  ).@flask_cas.log
-00006710: 696e 5f72 6571 7569 7265 640a 4061 7567  in_required.@aug
-00006720: 6d65 6e74 5f61 7267 756d 656e 7473 0a64  ment_arguments.d
-00006730: 6566 2072 6f75 7465 5f73 7562 6d69 7428  ef route_submit(
-00006740: 0a20 2020 2063 6f75 7273 652c 0a20 2020  .    course,.   
-00006750: 2073 656d 6573 7465 722c 0a20 2020 2070   semester,.    p
-00006760: 7369 642c 0a20 2020 2074 6173 6b69 642c  sid,.    taskid,
-00006770: 0a20 2020 2023 2041 7567 6d65 6e74 6564  .    # Augmented
-00006780: 2061 7267 756d 656e 7473 0a20 2020 2075   arguments.    u
-00006790: 7365 726e 616d 652c 0a20 2020 2069 735f  sername,.    is_
-000067a0: 6164 6d69 6e2c 0a20 2020 206d 6173 7175  admin,.    masqu
-000067b0: 6572 6164 655f 6173 2c0a 2020 2020 6566  erade_as,.    ef
-000067c0: 6665 6374 6976 655f 7573 6572 2c0a 2020  fective_user,.  
-000067d0: 2020 7461 736b 5f69 6e66 6f0a 293a 0a20    task_info.):. 
-000067e0: 2020 2022 2222 0a20 2020 2041 6363 6570     """.    Accep
-000067f0: 7473 2061 2066 696c 6520 7375 626d 6973  ts a file submis
-00006800: 7369 6f6e 2066 6f72 2061 2074 6173 6b20  sion for a task 
-00006810: 616e 6420 696e 6974 6961 7465 7320 616e  and initiates an
-00006820: 2065 7661 6c75 6174 696f 6e0a 2020 2020   evaluation.    
-00006830: 7072 6f63 6573 7320 666f 7220 7468 6174  process for that
-00006840: 2066 696c 652e 2046 6967 7572 6573 206f   file. Figures o
-00006850: 7574 2073 7562 6d69 7373 696f 6e20 7068  ut submission ph
-00006860: 6173 6520 6175 746f 6d61 7469 6361 6c6c  ase automaticall
-00006870: 790a 2020 2020 6261 7365 6420 6f6e 2074  y.    based on t
-00006880: 6173 6b20 696e 666f 2c20 616e 6420 6173  ask info, and as
-00006890: 7375 6d65 7320 7468 6174 2074 6865 2073  sumes that the s
-000068a0: 7562 6d69 7373 696f 6e20 6265 6c6f 6e67  ubmission belong
-000068b0: 7320 746f 2074 6865 0a20 2020 2061 7574  s to the.    aut
-000068c0: 6865 6e74 6963 6174 6564 2075 7365 722e  henticated user.
-000068d0: 2048 6f77 6576 6572 2c20 6966 2074 6865   However, if the
-000068e0: 2061 7574 6865 6e74 6963 6174 6564 2075   authenticated u
-000068f0: 7365 7220 6973 2061 6e20 6164 6d69 6e2c  ser is an admin,
-00006900: 0a20 2020 2074 6865 2022 7068 6173 6522  .    the "phase"
-00006910: 2061 6e64 2022 7461 7267 6574 5f75 7365   and "target_use
-00006920: 7222 2066 6f72 6d20 7661 6c75 6573 2063  r" form values c
-00006930: 616e 206f 7665 7272 6964 6520 7468 6573  an override thes
-00006940: 650a 2020 2020 6173 7375 6d70 7469 6f6e  e.    assumption
-00006950: 732e 2052 6564 6972 6563 7473 2074 6f20  s. Redirects to 
-00006960: 7468 6520 6665 6564 6261 636b 2070 6167  the feedback pag
-00006970: 6520 666f 7220 7468 6520 7375 626d 6974  e for the submit
-00006980: 7465 6420 7461 736b 2c0a 2020 2020 6f72  ted task,.    or
-00006990: 2074 6f20 7468 6520 6576 616c 7561 7469   to the evaluati
-000069a0: 6f6e 2070 6167 6520 6966 2074 6865 2075  on page if the u
-000069b0: 7365 7220 6973 2061 6e20 6164 6d69 6e20  ser is an admin 
-000069c0: 616e 6420 6973 206e 6f74 2074 6865 0a20  and is not the. 
-000069d0: 2020 2074 6172 6765 7420 7573 6572 2e0a     target user..
-000069e0: 0a20 2020 204e 6f74 653a 2074 6865 7265  .    Note: there
-000069f0: 2061 7265 2070 726f 6261 626c 7920 736f   are probably so
-00006a00: 6d65 206e 6173 7479 2072 6163 6520 636f  me nasty race co
-00006a10: 6e64 6974 696f 6e73 2069 6620 7468 6520  nditions if the 
-00006a20: 7361 6d65 2075 7365 720a 2020 2020 7375  same user.    su
-00006a30: 626d 6974 7320 7468 6520 7361 6d65 2074  bmits the same t
-00006a40: 6173 6b20 7369 6d75 6c74 616e 656f 7573  ask simultaneous
-00006a50: 6c79 2076 6961 206d 756c 7469 706c 6520  ly via multiple 
-00006a60: 7265 7175 6573 7473 2e20 5765 2073 696d  requests. We sim
-00006a70: 706c 790a 2020 2020 686f 7065 2074 6861  ply.    hope tha
-00006a80: 7420 7468 6174 2064 6f65 7320 6e6f 7420  t that does not 
-00006a90: 6861 7070 656e 2e0a 2020 2020 2222 220a  happen..    """.
-00006aa0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00006ab0: 2070 7320 3d20 6765 745f 7073 5f6f 626a   ps = get_ps_obj
-00006ac0: 2874 6173 6b5f 696e 666f 2c20 7073 6964  (task_info, psid
-00006ad0: 290a 2020 2020 6578 6365 7074 2056 616c  ).    except Val
-00006ae0: 7565 4572 726f 7220 6173 2065 3a0a 2020  ueError as e:.  
-00006af0: 2020 2020 2020 666c 6173 6b2e 666c 6173        flask.flas
-00006b00: 6828 7374 7228 6529 290a 2020 2020 2020  h(str(e)).      
-00006b10: 2020 7265 7475 726e 2067 6f62 6163 6b28    return goback(
-00006b20: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
-00006b30: 290a 0a20 2020 2074 7279 3a0a 2020 2020  )..    try:.    
-00006b40: 2020 2020 7461 736b 203d 2067 6574 5f74      task = get_t
-00006b50: 6173 6b5f 6f62 6a28 7461 736b 5f69 6e66  ask_obj(task_inf
-00006b60: 6f2c 2070 732c 2074 6173 6b69 6429 0a20  o, ps, taskid). 
-00006b70: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-00006b80: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-00006b90: 2020 2066 6c61 736b 2e66 6c61 7368 2873     flask.flash(s
-00006ba0: 7472 2865 2929 0a20 2020 2020 2020 2072  tr(e)).        r
-00006bb0: 6574 7572 6e20 676f 6261 636b 2863 6f75  eturn goback(cou
-00006bc0: 7273 652c 2073 656d 6573 7465 7229 0a0a  rse, semester)..
-00006bd0: 2020 2020 2320 4164 6420 7374 6174 7573      # Add status
-00006be0: 2026 2074 696d 6520 7265 6d61 696e 696e   & time remainin
-00006bf0: 6720 696e 666f 2074 6f20 7073 6574 0a20  g info to pset. 
-00006c00: 2020 2061 6d65 6e64 5f70 7365 7428 636f     amend_pset(co
-00006c10: 7572 7365 2c20 7365 6d65 7374 6572 2c20  urse, semester, 
-00006c20: 7461 736b 5f69 6e66 6f2c 2070 732c 2065  task_info, ps, e
-00006c30: 6666 6563 7469 7665 5f75 7365 7229 0a0a  ffective_user)..
-00006c40: 2020 2020 2320 4368 6563 6b20 666f 7220      # Check for 
-00006c50: 7068 6173 6520 616e 642f 6f72 2074 6172  phase and/or tar
-00006c60: 6765 745f 7573 6572 206f 7665 7272 6964  get_user overrid
-00006c70: 6573 2069 6e20 7468 6520 666f 726d 2064  es in the form d
-00006c80: 6174 6120 6966 0a20 2020 2023 2074 6865  ata if.    # the
-00006c90: 2061 7574 6865 6e74 6963 6174 6564 2075   authenticated u
-00006ca0: 7365 7220 6973 2061 6e20 6164 6d69 6e0a  ser is an admin.
-00006cb0: 2020 2020 7461 7267 6574 5f75 7365 7220      target_user 
-00006cc0: 3d20 6566 6665 6374 6976 655f 7573 6572  = effective_user
-00006cd0: 0a20 2020 2070 6861 7365 203d 204e 6f6e  .    phase = Non
-00006ce0: 650a 2020 2020 6465 7374 696e 6174 696f  e.    destinatio
-00006cf0: 6e5f 726f 7574 6520 3d20 2772 6f75 7465  n_route = 'route
-00006d00: 5f66 6565 6462 6163 6b27 0a20 2020 2069  _feedback'.    i
-00006d10: 6620 6973 5f61 646d 696e 3a0a 2020 2020  f is_admin:.    
-00006d20: 2020 2020 7461 7267 6574 5f66 726f 6d5f      target_from_
-00006d30: 666f 726d 203d 2066 6c61 736b 2e72 6571  form = flask.req
-00006d40: 7565 7374 2e66 6f72 6d2e 6765 7428 2274  uest.form.get("t
-00006d50: 6172 6765 745f 7573 6572 2229 0a20 2020  arget_user").   
-00006d60: 2020 2020 2069 6620 7461 7267 6574 5f66       if target_f
-00006d70: 726f 6d5f 666f 726d 206e 6f74 2069 6e20  rom_form not in 
-00006d80: 2822 222c 2022 6175 746f 2229 3a0a 2020  ("", "auto"):.  
-00006d90: 2020 2020 2020 2020 2020 7461 7267 6574            target
-00006da0: 5f75 7365 7220 3d20 7461 7267 6574 5f66  _user = target_f
-00006db0: 726f 6d5f 666f 726d 0a20 2020 2020 2020  rom_form.       
-00006dc0: 2070 6861 7365 5f66 726f 6d5f 666f 726d   phase_from_form
-00006dd0: 203d 2066 6c61 736b 2e72 6571 7565 7374   = flask.request
-00006de0: 2e66 6f72 6d2e 6765 7428 2270 6861 7365  .form.get("phase
-00006df0: 2229 0a20 2020 2020 2020 2069 6620 7068  ").        if ph
-00006e00: 6173 655f 6672 6f6d 5f66 6f72 6d20 213d  ase_from_form !=
-00006e10: 2022 6175 746f 223a 0a20 2020 2020 2020   "auto":.       
-00006e20: 2020 2020 2070 6861 7365 203d 2070 6861       phase = pha
-00006e30: 7365 5f66 726f 6d5f 666f 726d 0a0a 2020  se_from_form..  
-00006e40: 2020 2020 2020 2320 5365 6e64 2061 646d        # Send adm
-00006e50: 696e 7320 746f 2027 726f 7574 655f 6576  ins to 'route_ev
-00006e60: 616c 7561 7465 2720 696e 7374 6561 6420  aluate' instead 
-00006e70: 6f66 2027 726f 7574 655f 6665 6564 6261  of 'route_feedba
-00006e80: 636b 2720 6966 0a20 2020 2020 2020 2023  ck' if.        #
-00006e90: 2074 6865 2074 6172 6765 7420 7573 6572   the target user
-00006ea0: 2069 7320 6e6f 7420 7468 6520 7361 6d65   is not the same
-00006eb0: 2061 7320 7468 6520 6163 7475 616c 2075   as the actual u
-00006ec0: 7365 722c 2077 6865 7468 6572 0a20 2020  ser, whether.   
-00006ed0: 2020 2020 2023 2062 6563 6175 7365 206f       # because o
-00006ee0: 6620 6120 6d61 7371 7565 7261 6465 206f  f a masquerade o
-00006ef0: 7220 6265 6361 7573 6520 6f66 2061 6e20  r because of an 
-00006f00: 6578 706c 6963 6974 2074 6172 6765 7420  explicit target 
-00006f10: 7573 6572 2e0a 2020 2020 2020 2020 6966  user..        if
-00006f20: 2074 6172 6765 745f 7573 6572 2021 3d20   target_user != 
-00006f30: 7573 6572 6e61 6d65 3a0a 2020 2020 2020  username:.      
-00006f40: 2020 2020 2020 6465 7374 696e 6174 696f        destinatio
-00006f50: 6e5f 726f 7574 6520 3d20 2772 6f75 7465  n_route = 'route
-00006f60: 5f65 7661 6c75 6174 6527 0a0a 2020 2020  _evaluate'..    
-00006f70: 2320 4465 7465 726d 696e 6520 7468 6520  # Determine the 
-00006f80: 7068 6173 6520 6672 6f6d 2074 6865 2070  phase from the p
-00006f90: 7365 7420 7374 6174 6520 6966 2077 6520  set state if we 
-00006fa0: 6e65 6564 2074 6f0a 2020 2020 6966 2070  need to.    if p
-00006fb0: 6861 7365 2069 7320 4e6f 6e65 3a0a 2020  hase is None:.  
-00006fc0: 2020 2020 2020 7073 5f73 7461 7465 203d        ps_state =
-00006fd0: 2070 735b 2773 7461 7475 7327 5d5b 2773   ps['status']['s
-00006fe0: 7461 7465 275d 0a20 2020 2020 2020 2069  tate'].        i
-00006ff0: 6620 7073 5f73 7461 7465 203d 3d20 2275  f ps_state == "u
-00007000: 6e6b 6e6f 776e 223a 0a20 2020 2020 2020  nknown":.       
-00007010: 2020 2020 206d 7367 203d 2022 7b7d 2068       msg = "{} h
-00007020: 6173 206e 6f20 6465 6164 6c69 6e65 2e22  as no deadline."
-00007030: 2e66 6f72 6d61 7428 7073 6964 290a 2020  .format(psid).  
-00007040: 2020 2020 2020 2020 2020 666c 6173 6b2e            flask.
-00007050: 666c 6173 6828 6d73 6729 0a20 2020 2020  flash(msg).     
-00007060: 2020 2020 2020 2072 6574 7572 6e20 6572         return er
-00007070: 726f 725f 7265 7370 6f6e 7365 2863 6f75  ror_response(cou
-00007080: 7273 652c 2073 656d 6573 7465 722c 2075  rse, semester, u
-00007090: 7365 726e 616d 652c 206d 7367 290a 2020  sername, msg).  
-000070a0: 2020 2020 2020 656c 6966 2070 735f 7374        elif ps_st
-000070b0: 6174 6520 696e 2028 2275 6e72 656c 6561  ate in ("unrelea
-000070c0: 7365 6422 2c20 2272 656c 6561 7365 6422  sed", "released"
-000070d0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-000070e0: 6861 7365 203d 2022 696e 6974 6961 6c22  hase = "initial"
-000070f0: 0a20 2020 2020 2020 2065 6c69 6620 7073  .        elif ps
-00007100: 5f73 7461 7465 2069 6e20 2822 756e 6465  _state in ("unde
-00007110: 725f 7265 7669 6577 222c 2022 7265 7669  r_review", "revi
-00007120: 7361 626c 6522 293a 0a20 2020 2020 2020  sable"):.       
-00007130: 2020 2020 2070 6861 7365 203d 2022 7265       phase = "re
-00007140: 7669 7369 6f6e 220a 2020 2020 2020 2020  vision".        
-00007150: 2020 2020 2369 6620 7073 5f73 7461 7465      #if ps_state
-00007160: 203d 3d20 2275 6e64 6572 5f72 6576 6965   == "under_revie
-00007170: 7722 3a0a 2020 2020 2020 2020 2020 2020  w":.            
-00007180: 2320 2020 2066 6c61 736b 2e66 6c61 7368  #    flask.flash
-00007190: 280a 2020 2020 2020 2020 2020 2020 2320  (.            # 
-000071a0: 2020 2020 2020 2022 596f 7520 7368 6f75         "You shou
-000071b0: 6c64 2070 726f 6261 626c 7920 7761 6974  ld probably wait
-000071c0: 2075 6e74 696c 2074 6865 2072 6576 6965   until the revie
-000071d0: 7720 7065 7269 6f64 2069 7322 0a20 2020  w period is".   
-000071e0: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-000071f0: 2b20 2220 6f76 6572 2061 6e64 2076 6965  + " over and vie
-00007200: 7720 6665 6564 6261 636b 206f 6e20 796f  w feedback on yo
-00007210: 7572 2069 6e69 7469 616c 2073 7562 6d69  ur initial submi
-00007220: 7373 696f 6e22 0a20 2020 2020 2020 2020  ssion".         
-00007230: 2020 2023 2020 2020 2020 2b20 2220 6265     #      + " be
-00007240: 666f 7265 2073 7562 6d69 7474 696e 6720  fore submitting 
-00007250: 6120 7265 7669 7369 6f6e 2e22 0a20 2020  a revision.".   
-00007260: 2020 2020 2020 2020 2023 2020 2020 290a           #    ).
-00007270: 2020 2020 2020 2020 656c 6966 2070 735f          elif ps_
-00007280: 7374 6174 6520 3d3d 2022 6669 6e61 6c22  state == "final"
-00007290: 3a0a 2020 2020 2020 2020 2020 2020 666c  :.            fl
-000072a0: 6173 6b2e 666c 6173 6828 0a20 2020 2020  ask.flash(.     
-000072b0: 2020 2020 2020 2020 2020 2022 5765 2061             "We a
-000072c0: 7265 206e 6f20 6c6f 6e67 6572 2061 6363  re no longer acc
-000072d0: 6570 7469 6e67 206e 6577 2073 7562 6d69  epting new submi
-000072e0: 7373 696f 6e73 2066 6f72 207b 7d2e 222e  ssions for {}.".
-000072f0: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
-00007300: 2020 2020 2020 2020 2020 2020 7073 6964              psid
-00007310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007320: 2029 0a20 2020 2020 2020 2020 2020 2029   ).            )
-00007330: 0a20 2020 2020 2020 2020 2020 2070 6861  .            pha
-00007340: 7365 203d 2022 6265 6c61 7465 6422 0a0a  se = "belated"..
-00007350: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
-00007360: 7420 7468 6572 6527 7320 6120 6669 6c65  t there's a file
-00007370: 2062 6569 6e67 2073 7562 6d69 7474 6564   being submitted
-00007380: 0a20 2020 2066 696c 6573 203d 2066 6c61  .    files = fla
-00007390: 736b 2e72 6571 7565 7374 2e66 696c 6573  sk.request.files
-000073a0: 0a20 2020 2069 6620 2827 7570 6c6f 6164  .    if ('upload
-000073b0: 2720 6e6f 7420 696e 2066 696c 6573 206f  ' not in files o
-000073c0: 7220 6669 6c65 735b 2775 706c 6f61 6427  r files['upload'
-000073d0: 5d2e 6669 6c65 6e61 6d65 203d 3d20 2727  ].filename == ''
-000073e0: 293a 0a20 2020 2020 2020 2066 6c61 736b  ):.        flask
-000073f0: 2e66 6c61 7368 2822 596f 7520 6d75 7374  .flash("You must
-00007400: 2063 686f 6f73 6520 6120 6669 6c65 2074   choose a file t
-00007410: 6f20 7375 626d 6974 2e22 290a 2020 2020  o submit.").    
-00007420: 2020 2020 7265 7475 726e 2067 6f62 6163      return gobac
-00007430: 6b28 636f 7572 7365 2c20 7365 6d65 7374  k(course, semest
-00007440: 6572 290a 2020 2020 656c 7365 3a0a 2020  er).    else:.  
-00007450: 2020 2020 2020 7570 6c6f 6164 6564 203d        uploaded =
-00007460: 2066 696c 6573 5b27 7570 6c6f 6164 275d   files['upload']
-00007470: 0a0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
-00007480: 6b20 666f 7220 616e 2069 6e2d 666c 6967  k for an in-flig
-00007490: 6874 2067 7261 6469 6e67 2070 726f 6365  ht grading proce
-000074a0: 7373 2066 6f72 2074 6869 7320 7461 736b  ss for this task
-000074b0: 0a20 2020 2020 2020 2074 732c 205f 2c20  .        ts, _, 
-000074c0: 5f2c 2073 7461 7475 7320 3d20 7374 6f72  _, status = stor
-000074d0: 6167 652e 6765 745f 696e 666c 6967 6874  age.get_inflight
-000074e0: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
-000074f0: 7572 7365 2c0a 2020 2020 2020 2020 2020  urse,.          
-00007500: 2020 7365 6d65 7374 6572 2c0a 2020 2020    semester,.    
-00007510: 2020 2020 2020 2020 6566 6665 6374 6976          effectiv
-00007520: 655f 7573 6572 2c0a 2020 2020 2020 2020  e_user,.        
-00007530: 2020 2020 7068 6173 652c 0a20 2020 2020      phase,.     
-00007540: 2020 2020 2020 2070 7369 642c 0a20 2020         psid,.   
-00007550: 2020 2020 2020 2020 2074 6173 6b69 640a           taskid.
-00007560: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00007570: 2020 2023 2049 6620 7468 6520 7375 626d     # If the subm
-00007580: 6973 7369 6f6e 2069 7320 616c 7265 6164  ission is alread
-00007590: 7920 6265 696e 6720 6576 616c 7561 7465  y being evaluate
-000075a0: 642c 206f 7220 6966 2077 6520 636f 756c  d, or if we coul
-000075b0: 646e 2774 0a20 2020 2020 2020 2023 2066  dn't.        # f
-000075c0: 6967 7572 6520 6f75 7420 7768 6574 6865  igure out whethe
-000075d0: 7220 7468 6174 2077 6173 2074 6865 2063  r that was the c
-000075e0: 6173 652c 2077 6520 6361 6e27 7420 7374  ase, we can't st
-000075f0: 6172 7420 616e 6f74 6865 720a 2020 2020  art another.    
-00007600: 2020 2020 2320 6576 616c 7561 7469 6f6e      # evaluation
-00007610: 2070 726f 6365 7373 210a 2020 2020 2020   process!.      
-00007620: 2020 6966 2074 7320 3d3d 2022 6572 726f    if ts == "erro
-00007630: 7222 3a0a 2020 2020 2020 2020 2020 2020  r":.            
-00007640: 666c 6173 6b2e 666c 6173 6828 0a20 2020  flask.flash(.   
-00007650: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
-00007660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007670: 2020 2022 4552 524f 523a 2046 6169 6c65     "ERROR: Faile
-00007680: 6420 746f 2063 6865 636b 2065 7661 6c75  d to check evalu
-00007690: 6174 696f 6e20 7374 6174 7573 2e20 5472  ation status. Tr
-000076a0: 7922 0a20 2020 2020 2020 2020 2020 2020  y".             
-000076b0: 2020 2020 202b 2022 2072 6566 7265 7368       + " refresh
-000076c0: 696e 6720 7468 6973 2070 6167 652c 2061  ing this page, a
-000076d0: 6e64 2069 6620 7468 6520 7072 6f62 6c65  nd if the proble
-000076e0: 6d20 7065 7273 6973 7473 2c22 0a20 2020  m persists,".   
-000076f0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00007700: 2022 2063 6f6e 7461 6374 207b 7d2e 220a   " contact {}.".
-00007710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007720: 292e 666f 726d 6174 2861 7070 2e63 6f6e  ).format(app.con
-00007730: 6669 675b 2253 5550 504f 5254 5f4c 494e  fig["SUPPORT_LIN
-00007740: 4b22 5d29 0a20 2020 2020 2020 2020 2020  K"]).           
-00007750: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
-00007760: 6574 7572 6e20 666c 6173 6b2e 7265 6469  eturn flask.redi
-00007770: 7265 6374 280a 2020 2020 2020 2020 2020  rect(.          
-00007780: 2020 2020 2020 666c 6173 6b2e 7572 6c5f        flask.url_
-00007790: 666f 7228 0a20 2020 2020 2020 2020 2020  for(.           
-000077a0: 2020 2020 2020 2020 2064 6573 7469 6e61           destina
-000077b0: 7469 6f6e 5f72 6f75 7465 2c0a 2020 2020  tion_route,.    
-000077c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077d0: 636f 7572 7365 3d63 6f75 7273 652c 0a20  course=course,. 
+00001190: 6c69 7665 7260 2e0a 0a2f 2a2a 2463 6f75  liver`.../**$cou
+000011a0: 7273 652a 2a2f 2a2a 2473 656d 6573 7465  rse**/**$semeste
+000011b0: 722a 2a2f 6578 5f67 7261 6465 7368 6565  r**/ex_gradeshee
+000011c0: 742f 2a2a 2467 726f 7570 2a2a 2028 726f  t/**$group** (ro
+000011d0: 7574 655f 6578 5f67 7261 6465 7368 6565  ute_ex_gradeshee
+000011e0: 7429 3a0a 2020 2020 416e 206f 7665 7276  t):.    An overv
+000011f0: 6965 7720 6f66 2061 6c6c 2067 7261 6465  iew of all grade
+00001200: 7320 666f 7220 6120 7370 6563 6966 6963  s for a specific
+00001210: 2065 7865 7263 6973 6520 6772 6f75 702c   exercise group,
+00001220: 2076 6973 6962 6c65 206f 6e6c 7920 746f   visible only to
+00001230: 0a20 2020 2061 646d 696e 732e 0a20 2020  .    admins..   
+00001240: 2023 2054 4f44 4f3a 204d 616b 6520 7468   # TODO: Make th
+00001250: 6973 2066 6173 7465 723f 0a22 2222 0a0a  is faster?."""..
+00001260: 2320 4174 7465 6d70 7473 2061 7420 322f  # Attempts at 2/
+00001270: 3320 6475 616c 2063 6f6d 7061 7469 6269  3 dual compatibi
+00001280: 6c69 7479 3a0a 6672 6f6d 205f 5f66 7574  lity:.from __fut
+00001290: 7572 655f 5f20 696d 706f 7274 2070 7269  ure__ import pri
+000012a0: 6e74 5f66 756e 6374 696f 6e0a 0a5f 5f76  nt_function..__v
+000012b0: 6572 7369 6f6e 5f5f 203d 2022 312e 322e  ersion__ = "1.2.
+000012c0: 3722 0a0a 696d 706f 7274 2073 7973 0a0a  7"..import sys..
+000012d0: 0a23 2049 4620 7765 2772 6520 6e6f 7420  .# IF we're not 
+000012e0: 696e 2070 7968 746f 6e33 3a0a 6966 2073  in pyhton3:.if s
+000012f0: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f5b  ys.version_info[
+00001300: 305d 203c 2033 3a0a 2020 2020 7265 6c6f  0] < 3:.    relo
+00001310: 6164 2873 7973 2920 2320 6e6f 7161 2046  ad(sys) # noqa F
+00001320: 3832 310a 2020 2020 2320 5365 7420 6578  821.    # Set ex
+00001330: 706c 6963 6974 2064 6566 6175 6c74 2065  plicit default e
+00001340: 6e63 6f64 696e 670a 2020 2020 7379 732e  ncoding.    sys.
+00001350: 7365 7464 6566 6175 6c74 656e 636f 6469  setdefaultencodi
+00001360: 6e67 2827 7574 662d 3827 290a 2020 2020  ng('utf-8').    
+00001370: 2320 5265 6e61 6d65 2072 6177 5f69 6e70  # Rename raw_inp
+00001380: 7574 0a20 2020 2069 6e70 7574 203d 2072  ut.    input = r
+00001390: 6177 5f69 6e70 7574 2023 206e 6f71 6120  aw_input # noqa 
+000013a0: 4638 3231 0a20 2020 204d 6f64 756c 654e  F821.    ModuleN
+000013b0: 6f74 466f 756e 645f 6f72 5f49 6d70 6f72  otFound_or_Impor
+000013c0: 745f 4572 726f 7220 3d20 496d 706f 7274  t_Error = Import
+000013d0: 4572 726f 720a 2020 2020 616e 7973 7472  Error.    anystr
+000013e0: 203d 2028 7374 722c 2075 6e69 636f 6465   = (str, unicode
+000013f0: 2920 2320 6e6f 7161 2046 3832 310a 656c  ) # noqa F821.el
+00001400: 7365 3a0a 2020 2020 4d6f 6475 6c65 4e6f  se:.    ModuleNo
+00001410: 7446 6f75 6e64 5f6f 725f 496d 706f 7274  tFound_or_Import
+00001420: 5f45 7272 6f72 203d 204d 6f64 756c 654e  _Error = ModuleN
+00001430: 6f74 466f 756e 6445 7272 6f72 0a20 2020  otFoundError.   
+00001440: 2061 6e79 7374 7220 3d20 2873 7472 2c20   anystr = (str, 
+00001450: 6279 7465 7329 0a0a 0a64 6566 2065 6e73  bytes)...def ens
+00001460: 7572 655f 6469 7265 6374 6f72 7928 7461  ure_directory(ta
+00001470: 7267 6574 293a 0a20 2020 2022 2222 0a20  rget):.    """. 
+00001480: 2020 206d 616b 6564 6972 7320 322f 3320     makedirs 2/3 
+00001490: 7368 696d 2e0a 2020 2020 2222 220a 2020  shim..    """.  
+000014a0: 2020 6966 2073 7973 2e76 6572 7369 6f6e    if sys.version
+000014b0: 5f69 6e66 6f5b 305d 203c 2033 3a0a 2020  _info[0] < 3:.  
+000014c0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000014d0: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
+000014e0: 7273 2874 6172 6765 7429 0a20 2020 2020  rs(target).     
+000014f0: 2020 2065 7863 6570 7420 4f53 4572 726f     except OSErro
+00001500: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
+00001510: 6173 730a 2020 2020 656c 7365 3a0a 2020  ass.    else:.  
+00001520: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
+00001530: 7328 7461 7267 6574 2c20 6578 6973 745f  s(target, exist_
+00001540: 6f6b 3d54 7275 6529 0a0a 0a23 204d 6169  ok=True)...# Mai
+00001550: 6e20 696d 706f 7274 730a 696d 706f 7274  n imports.import
+00001560: 206f 732c 2073 7562 7072 6f63 6573 732c   os, subprocess,
+00001570: 2073 6875 7469 6c20 2320 6e6f 7161 2045   shutil # noqa E
+00001580: 3430 320a 696d 706f 7274 2064 6174 6574  402.import datet
+00001590: 696d 652c 2074 696d 652c 2072 616e 646f  ime, time, rando
+000015a0: 6d2c 2063 6f70 792c 2063 7376 2c20 7265  m, copy, csv, re
+000015b0: 2023 206e 6f71 6120 4534 3032 0a69 6d70   # noqa E402.imp
+000015c0: 6f72 7420 7a69 7066 696c 6520 2320 6e6f  ort zipfile # no
+000015d0: 7161 2045 3430 320a 0a69 6d70 6f72 7420  qa E402..import 
+000015e0: 666c 6173 6b20 2320 6e6f 7161 2045 3430  flask # noqa E40
+000015f0: 320a 696d 706f 7274 2066 6c61 736b 5f63  2.import flask_c
+00001600: 6173 2023 206e 6f71 6120 4534 3032 0a69  as # noqa E402.i
+00001610: 6d70 6f72 7420 6a69 6e6a 6132 2023 206e  mport jinja2 # n
+00001620: 6f71 6120 4534 3032 0a69 6d70 6f72 7420  oqa E402.import 
+00001630: 6273 3420 2320 6e6f 7161 2045 3430 320a  bs4 # noqa E402.
+00001640: 696d 706f 7274 2077 6572 6b7a 6575 6720  import werkzeug 
+00001650: 2320 6e6f 7161 2045 3430 320a 0a66 726f  # noqa E402..fro
+00001660: 6d20 666c 6173 6b20 696d 706f 7274 206a  m flask import j
+00001670: 736f 6e20 2320 6e6f 7161 2045 3430 320a  son # noqa E402.
+00001680: 0a66 726f 6d20 2e20 696d 706f 7274 2073  .from . import s
+00001690: 746f 7261 6765 2023 206e 6f71 6120 4534  torage # noqa E4
+000016a0: 3032 0a0a 2320 4c6f 6164 2070 6f74 6c75  02..# Load potlu
+000016b0: 636b 206d 6f64 756c 6573 3a0a 696d 706f  ck modules:.impo
+000016c0: 7274 2070 6f74 6c75 636b 2e72 656e 6465  rt potluck.rende
+000016d0: 7220 2320 6e6f 7161 3a20 4534 3032 0a69  r # noqa: E402.i
+000016e0: 6d70 6f72 7420 706f 746c 7563 6b2e 6874  mport potluck.ht
+000016f0: 6d6c 5f74 6f6f 6c73 2023 206e 6f71 613a  ml_tools # noqa:
+00001700: 2045 3430 320a 696d 706f 7274 2070 6f74   E402.import pot
+00001710: 6c75 636b 2e74 696d 655f 7574 696c 7320  luck.time_utils 
+00001720: 2320 6e6f 7161 3a20 4534 3032 0a0a 0a23  # noqa: E402...#
+00001730: 204c 6f6f 6b20 666f 7220 7361 6665 5f6a   Look for safe_j
+00001740: 6f69 6e20 626f 7468 2069 6e20 666c 6173  oin both in flas
+00001750: 6b20 616e 6420 696e 2077 6572 6b7a 6575  k and in werkzeu
+00001760: 672e 2e2e 0a69 6620 6861 7361 7474 7228  g....if hasattr(
+00001770: 666c 6173 6b2c 2022 7361 6665 5f6a 6f69  flask, "safe_joi
+00001780: 6e22 293a 0a20 2020 2073 6166 655f 6a6f  n"):.    safe_jo
+00001790: 696e 203d 2066 6c61 736b 2e73 6166 655f  in = flask.safe_
+000017a0: 6a6f 696e 0a65 6c69 6620 6861 7361 7474  join.elif hasatt
+000017b0: 7228 7765 726b 7a65 7567 2e75 7469 6c73  r(werkzeug.utils
+000017c0: 2c20 2273 6166 655f 6a6f 696e 2229 3a0a  , "safe_join"):.
+000017d0: 2020 2020 7361 6665 5f6a 6f69 6e20 3d20      safe_join = 
+000017e0: 7765 726b 7a65 7567 2e75 7469 6c73 2e73  werkzeug.utils.s
+000017f0: 6166 655f 6a6f 696e 0a65 6c73 653a 0a20  afe_join.else:. 
+00001800: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+00001810: 2020 2257 6172 6e69 6e67 3a20 7361 6665    "Warning: safe
+00001820: 5f6a 6f69 6e20 7761 7320 6e6f 7420 666f  _join was not fo
+00001830: 756e 6420 696e 2065 6974 6865 7220 666c  und in either fl
+00001840: 6173 6b20 4f52 220a 2020 2020 2020 2020  ask OR".        
+00001850: 2220 7765 726b 7a65 7567 2e75 7469 6c73  " werkzeug.utils
+00001860: 3b20 7573 696e 6720 616e 2075 6e73 6166  ; using an unsaf
+00001870: 6520 6675 6e63 7469 6f6e 2069 6e73 7465  e function inste
+00001880: 6164 2e22 0a20 2020 2029 0a20 2020 2073  ad.".    ).    s
+00001890: 6166 655f 6a6f 696e 203d 206c 616d 6264  afe_join = lambd
+000018a0: 6120 2a61 7267 733a 206f 732e 7061 7468  a *args: os.path
+000018b0: 2e6a 6f69 6e28 2a61 7267 7329 0a0a 0a23  .join(*args)...#
+000018c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d23 0a23  -------------#.#
+000018d0: 2053 6574 7570 2073 6574 7570 2023 0a23   Setup setup #.#
+000018e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d23 0a0a  -------------#..
+000018f0: 636c 6173 7320 496e 6974 4170 7028 666c  class InitApp(fl
+00001900: 6173 6b2e 466c 6173 6b29 3a0a 2020 2020  ask.Flask):.    
+00001910: 2222 220a 2020 2020 4120 466c 6173 6b20  """.    A Flask 
+00001920: 6170 7020 7375 6263 6c61 7373 2077 6869  app subclass whi
+00001930: 6368 2072 756e 7320 696e 6974 6961 6c69  ch runs initiali
+00001940: 7a61 7469 6f6e 2066 756e 6374 696f 6e73  zation functions
+00001950: 2072 6967 6874 0a20 2020 2062 6566 6f72   right.    befor
+00001960: 6520 6170 7020 7374 6172 7475 702e 0a20  e app startup.. 
+00001970: 2020 2022 2222 0a20 2020 2064 6566 205f     """.    def _
+00001980: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
+00001990: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+000019a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000019b0: 2020 2020 4172 6775 6d65 6e74 7320 6172      Arguments ar
+000019c0: 6520 7061 7373 6564 2074 6872 6f75 6768  e passed through
+000019d0: 2074 6f20 666c 6173 6b2e 466c 6173 6b2e   to flask.Flask.
+000019e0: 5f5f 696e 6974 5f5f 2e0a 2020 2020 2020  __init__..      
+000019f0: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
+00001a00: 6c66 2e61 6374 696f 6e73 203d 205b 5d0a  lf.actions = [].
+00001a10: 2020 2020 2020 2020 2320 4e6f 7465 3a20          # Note: 
+00001a20: 7765 2064 6f6e 2774 2075 7365 2073 7570  we don't use sup
+00001a30: 6572 2829 2068 6572 6520 7369 6e63 6520  er() here since 
+00001a40: 322f 3320 636f 6d70 6174 6962 696c 6974  2/3 compatibilit
+00001a50: 7920 6973 0a20 2020 2020 2020 2023 2074  y is.        # t
+00001a60: 6f6f 2068 6172 6420 746f 2066 6967 7572  oo hard to figur
+00001a70: 6520 6f75 740a 2020 2020 2020 2020 666c  e out.        fl
+00001a80: 6173 6b2e 466c 6173 6b2e 5f5f 696e 6974  ask.Flask.__init
+00001a90: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+00001aa0: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
+00001ab0: 6566 2069 6e69 7428 7365 6c66 2c20 6163  ef init(self, ac
+00001ac0: 7469 6f6e 293a 0a20 2020 2020 2020 2022  tion):.        "
+00001ad0: 2222 0a20 2020 2020 2020 2052 6567 6973  "".        Regis
+00001ae0: 7465 7273 2061 6e20 696e 6974 2061 6374  ters an init act
+00001af0: 696f 6e20 2861 2066 756e 6374 696f 6e20  ion (a function 
+00001b00: 7768 6963 6820 7769 6c6c 2062 6520 6769  which will be gi
+00001b10: 7665 6e20 7468 6520 6170 700a 2020 2020  ven the app.    
+00001b20: 2020 2020 6f62 6a65 6374 2061 7320 6974      object as it
+00001b30: 7320 6f6e 6c79 2061 7267 756d 656e 7429  s only argument)
+00001b40: 2e20 5468 6573 6520 6675 6e63 7469 6f6e  . These function
+00001b50: 7320 7769 6c6c 2065 6163 6820 6265 0a20  s will each be. 
+00001b60: 2020 2020 2020 2063 616c 6c65 642c 2069         called, i
+00001b70: 6e20 6f72 6465 7220 6f66 2072 6567 6973  n order of regis
+00001b80: 7472 6174 696f 6e2c 2072 6967 6874 2062  tration, right b
+00001b90: 6566 6f72 6520 7468 6520 6170 7020 7374  efore the app st
+00001ba0: 6172 7473 2c0a 2020 2020 2020 2020 7769  arts,.        wi
+00001bb0: 7468 6520 7468 6520 6170 705f 636f 6e74  the the app_cont
+00001bc0: 6578 7420 6163 7469 7665 2e20 5265 7475  ext active. Retu
+00001bd0: 726e 7320 7468 6520 6163 7469 6f6e 2066  rns the action f
+00001be0: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
+00001bf0: 7072 6f76 6964 6564 2c20 736f 2074 6861  provided, so tha
+00001c00: 7420 6974 2063 616e 2062 6520 7573 6564  t it can be used
+00001c10: 2061 7320 6120 6465 636f 7261 746f 722c   as a decorator,
+00001c20: 206c 696b 6520 736f 3a0a 0a20 2020 2020   like so:..     
+00001c30: 2020 2060 6060 7079 0a20 2020 2020 2020     ```py.       
+00001c40: 2040 6170 702e 696e 6974 0a20 2020 2020   @app.init.     
+00001c50: 2020 2064 6566 2073 6574 7570 5f73 6f6d     def setup_som
+00001c60: 655f 7374 7566 6628 6170 7029 3a0a 2020  e_stuff(app):.  
+00001c70: 2020 2020 2020 2020 2020 2e2e 2e0a 2020            ....  
+00001c80: 2020 2020 2020 6060 600a 2020 2020 2020        ```.      
+00001c90: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
+00001ca0: 6c66 2e61 6374 696f 6e73 2e61 7070 656e  lf.actions.appen
+00001cb0: 6428 6163 7469 6f6e 290a 2020 2020 2020  d(action).      
+00001cc0: 2020 7265 7475 726e 2061 6374 696f 6e0a    return action.
+00001cd0: 0a20 2020 2064 6566 2073 6574 7570 2873  .    def setup(s
+00001ce0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00001cf0: 220a 2020 2020 2020 2020 5275 6e73 2061  ".        Runs a
+00001d00: 6c6c 2072 6567 6973 7465 7265 6420 696e  ll registered in
+00001d10: 6974 6961 6c69 7a61 7469 6f6e 2061 6374  itialization act
+00001d20: 696f 6e73 2e20 4966 2079 6f75 2772 6520  ions. If you're 
+00001d30: 6e6f 7420 7275 6e6e 696e 670a 2020 2020  not running.    
+00001d40: 2020 2020 6120 6465 6275 6767 696e 6720      a debugging 
+00001d50: 7365 7475 7020 7669 6120 7468 6520 6072  setup via the `r
+00001d60: 756e 6020 6d65 7468 6f64 2c20 796f 7527  un` method, you'
+00001d70: 6c6c 206e 6565 6420 746f 2063 616c 6c20  ll need to call 
+00001d80: 7468 6973 0a20 2020 2020 2020 206d 6574  this.        met
+00001d90: 686f 6420 796f 7572 7365 6c66 2028 652e  hod yourself (e.
+00001da0: 672e 2c20 696e 2061 202e 7773 6769 2066  g., in a .wsgi f
+00001db0: 696c 6529 2e0a 2020 2020 2020 2020 2222  ile)..        ""
+00001dc0: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
+00001dd0: 656c 662e 6170 705f 636f 6e74 6578 7428  elf.app_context(
+00001de0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+00001df0: 6f72 2061 6374 696f 6e20 696e 2073 656c  or action in sel
+00001e00: 662e 6163 7469 6f6e 733a 0a20 2020 2020  f.actions:.     
+00001e10: 2020 2020 2020 2020 2020 2061 6374 696f             actio
+00001e20: 6e28 7365 6c66 290a 0a20 2020 2064 6566  n(self)..    def
+00001e30: 2072 756e 2873 656c 662c 202a 6172 6773   run(self, *args
+00001e40: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00001e50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00001e60: 204f 7665 7272 6964 6465 6e20 7275 6e20   Overridden run 
+00001e70: 6d65 7468 6f64 2072 756e 7320 6f75 7220  method runs our 
+00001e80: 6375 7374 6f6d 2069 6e69 7420 6163 7469  custom init acti
+00001e90: 6f6e 7320 7769 7468 2074 6865 2061 7070  ons with the app
+00001ea0: 0a20 2020 2020 2020 2063 6f6e 7465 7874  .        context
+00001eb0: 2066 6972 7374 2e0a 2020 2020 2020 2020   first..        
+00001ec0: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
+00001ed0: 2e73 6574 7570 2829 0a20 2020 2020 2020  .setup().       
+00001ee0: 2023 204e 6f74 653a 2077 6520 646f 6e27   # Note: we don'
+00001ef0: 7420 7573 6520 7375 7065 7228 2920 6865  t use super() he
+00001f00: 7265 2073 696e 6365 2032 2f33 2063 6f6d  re since 2/3 com
+00001f10: 7061 7469 6269 6c69 7479 2069 730a 2020  patibility is.  
+00001f20: 2020 2020 2020 2320 746f 6f20 6861 7264        # too hard
+00001f30: 2074 6f20 6669 6775 7265 206f 7574 0a20   to figure out. 
+00001f40: 2020 2020 2020 2066 6c61 736b 2e46 6c61         flask.Fla
+00001f50: 736b 2e72 756e 2873 656c 662c 202a 6172  sk.run(self, *ar
+00001f60: 6773 2c20 2a2a 6b77 6172 6773 290a 0a0a  gs, **kwargs)...
+00001f70: 232d 2d2d 2d2d 2d2d 230a 2320 5365 7475  #-------#.# Setu
+00001f80: 7020 230a 232d 2d2d 2d2d 2d2d 230a 0a23  p #.#-------#..#
+00001f90: 2043 7265 6174 6520 6f75 7220 6170 7020   Create our app 
+00001fa0: 6f62 6a65 6374 3a0a 6170 7020 3d20 496e  object:.app = In
+00001fb0: 6974 4170 7028 2270 6f74 6c75 636b 5f73  itApp("potluck_s
+00001fc0: 6572 7665 7222 290a 0a0a 2320 4465 6661  erver")...# Defa
+00001fd0: 756c 7420 636f 6e66 6967 7572 6174 696f  ult configuratio
+00001fe0: 6e20 7661 6c75 6573 2069 6620 7765 2072  n values if we r
+00001ff0: 6561 6c6c 7920 6361 6e27 7420 6669 6e64  eally can't find
+00002000: 2061 2063 6f6e 6669 6720 6669 6c65 0a44   a config file.D
+00002010: 4546 4155 4c54 5f43 4f4e 4649 4720 3d20  EFAULT_CONFIG = 
+00002020: 7b0a 2020 2020 2245 5641 4c55 4154 494f  {.    "EVALUATIO
+00002030: 4e5f 4241 5345 223a 2027 2e27 2c0a 2020  N_BASE": '.',.  
+00002040: 2020 2250 4f54 4c55 434b 5f45 5641 4c5f    "POTLUCK_EVAL_
+00002050: 5059 5448 4f4e 223a 204e 6f6e 652c 0a20  PYTHON": None,. 
+00002060: 2020 2022 504f 544c 5543 4b5f 4556 414c     "POTLUCK_EVAL
+00002070: 5f53 4352 4950 5422 3a20 4e6f 6e65 2c0a  _SCRIPT": None,.
+00002080: 2020 2020 2250 4f54 4c55 434b 5f45 5641      "POTLUCK_EVA
+00002090: 4c5f 494d 504f 5254 5f46 524f 4d22 3a20  L_IMPORT_FROM": 
+000020a0: 4e6f 6e65 2c0a 2020 2020 2243 4f55 5253  None,.    "COURS
+000020b0: 455f 4e41 4d45 5322 3a20 7b20 2774 6573  E_NAMES": { 'tes
+000020c0: 745f 636f 7572 7365 273a 2027 5445 5354  t_course': 'TEST
+000020d0: 2043 4f55 5253 4527 207d 2c0a 2020 2020   COURSE' },.    
+000020e0: 2244 4546 4155 4c54 5f43 4f55 5253 4522  "DEFAULT_COURSE"
+000020f0: 3a20 2774 6573 745f 636f 7572 7365 272c  : 'test_course',
+00002100: 0a20 2020 2022 4445 4641 554c 545f 5345  .    "DEFAULT_SE
+00002110: 4d45 5354 4552 223a 2027 6661 6c6c 3230  MESTER": 'fall20
+00002120: 3231 272c 0a20 2020 2022 5355 5050 4f52  21',.    "SUPPOR
+00002130: 545f 454d 4149 4c22 3a20 2775 7365 726e  T_EMAIL": 'usern
+00002140: 616d 6540 6578 616d 706c 652e 636f 6d27  ame@example.com'
+00002150: 2c0a 2020 2020 2253 5550 504f 5254 5f4c  ,.    "SUPPORT_L
+00002160: 494e 4b22 3a20 273c 6120 6872 6566 3d22  INK": '<a href="
+00002170: 6d61 696c 746f 3a75 7365 726e 616d 6540  mailto:username@
+00002180: 6578 616d 706c 652e 636f 6d22 3e55 7365  example.com">Use
+00002190: 7220 4e61 6d65 3c2f 613e 272c 0a20 2020  r Name</a>',.   
+000021a0: 2022 4e4f 5f44 4542 5547 5f53 534c 223a   "NO_DEBUG_SSL":
+000021b0: 2046 616c 7365 2c0a 2020 2020 2243 4153   False,.    "CAS
+000021c0: 5f53 4552 5645 5222 3a20 2768 7474 7073  _SERVER": 'https
+000021d0: 3a2f 2f6c 6f67 696e 2e65 7861 6d70 6c65  ://login.example
+000021e0: 2e63 6f6d 3a34 3433 272c 0a20 2020 2022  .com:443',.    "
+000021f0: 4341 535f 4146 5445 525f 4c4f 4749 4e22  CAS_AFTER_LOGIN"
+00002200: 3a20 2764 6173 6862 6f61 7264 272c 0a20  : 'dashboard',. 
+00002210: 2020 2022 4341 535f 4c4f 4749 4e5f 524f     "CAS_LOGIN_RO
+00002220: 5554 4522 3a20 272f 6d6f 6475 6c65 2e70  UTE": '/module.p
+00002230: 6870 2f63 6173 7365 7276 6572 2f63 6173  hp/casserver/cas
+00002240: 2e70 6870 2f6c 6f67 696e 272c 0a20 2020  .php/login',.   
+00002250: 2022 4341 535f 4c4f 474f 5554 5f52 4f55   "CAS_LOGOUT_ROU
+00002260: 5445 223a 2027 2f6d 6f64 756c 652e 7068  TE": '/module.ph
+00002270: 702f 6361 7373 6572 7665 722f 6361 732e  p/casserver/cas.
+00002280: 7068 702f 6c6f 676f 7574 272c 0a20 2020  php/logout',.   
+00002290: 2022 4341 535f 4146 5445 525f 4c4f 474f   "CAS_AFTER_LOGO
+000022a0: 5554 223a 2027 6874 7470 733a 2f2f 6578  UT": 'https://ex
+000022b0: 616d 706c 652e 636f 6d2f 706f 746c 7563  ample.com/potluc
+000022c0: 6b27 2c0a 2020 2020 2243 4153 5f56 414c  k',.    "CAS_VAL
+000022d0: 4944 4154 455f 524f 5554 4522 3a20 272f  IDATE_ROUTE": '/
+000022e0: 6d6f 6475 6c65 2e70 6870 2f63 6173 7365  module.php/casse
+000022f0: 7276 6572 2f73 6572 7669 6365 5661 6c69  rver/serviceVali
+00002300: 6461 7465 2e70 6870 272c 0a20 2020 2022  date.php',.    "
+00002310: 5053 4554 5f55 524c 5322 3a20 7b0a 2020  PSET_URLS": {.  
+00002320: 2020 2020 2020 2774 6573 745f 636f 7572        'test_cour
+00002330: 7365 273a 2028 0a20 2020 2020 2020 2020  se': (.         
+00002340: 2020 2027 6874 7470 733a 2f2f 6578 616d     'https://exam
+00002350: 706c 652e 636f 6d2f 6172 6368 6976 652f  ple.com/archive/
+00002360: 7465 7374 5f63 6f75 7273 655f 7b73 656d  test_course_{sem
+00002370: 6573 7465 727d 2f27 0a20 2020 2020 2020  ester}/'.       
+00002380: 2020 2020 2027 7075 626c 6963 5f68 746d       'public_htm
+00002390: 6c2f 7073 6574 732f 7b70 7365 747d 270a  l/psets/{pset}'.
+000023a0: 2020 2020 2020 2020 290a 2020 2020 7d2c          ).    },
+000023b0: 0a20 2020 2022 5441 534b 5f55 524c 5322  .    "TASK_URLS"
+000023c0: 3a20 7b0a 2020 2020 2020 2020 2774 6573  : {.        'tes
+000023d0: 745f 636f 7572 7365 273a 2028 0a20 2020  t_course': (.   
+000023e0: 2020 2020 2020 2020 2027 6874 7470 733a           'https:
+000023f0: 2f2f 6578 616d 706c 652e 636f 6d2f 6172  //example.com/ar
+00002400: 6368 6976 652f 7465 7374 5f63 6f75 7273  chive/test_cours
+00002410: 655f 7b73 656d 6573 7465 727d 2f27 0a20  e_{semester}/'. 
+00002420: 2020 2020 2020 2020 2020 2027 7075 626c             'publ
+00002430: 6963 5f68 746d 6c2f 7073 6574 732f 7b70  ic_html/psets/{p
+00002440: 7365 747d 2f7b 7461 736b 7d27 0a20 2020  set}/{task}'.   
+00002450: 2020 2020 2029 0a20 2020 207d 2c0a 2020       ).    },.  
+00002460: 2020 2245 5845 5243 4953 455f 5552 4c53    "EXERCISE_URLS
+00002470: 223a 207b 0a20 2020 2020 2020 2027 7465  ": {.        'te
+00002480: 7374 5f63 6f75 7273 6527 3a20 7b0a 2020  st_course': {.  
+00002490: 2020 2020 2020 2020 2020 276c 6563 273a            'lec':
+000024a0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+000024b0: 2020 2027 6874 7470 733a 2f2f 6578 616d     'https://exam
+000024c0: 706c 652e 636f 6d2f 6172 6368 6976 652f  ple.com/archive/
+000024d0: 7465 7374 5f63 6f75 7273 655f 7b73 656d  test_course_{sem
+000024e0: 6573 7465 727d 2f27 0a20 2020 2020 2020  ester}/'.       
+000024f0: 2020 2020 2020 2020 2027 7075 626c 6963           'public
+00002500: 5f68 746d 6c2f 6c65 6374 7572 6573 2f7b  _html/lectures/{
+00002510: 6772 6f75 707d 270a 2020 2020 2020 2020  group}'.        
+00002520: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+00002530: 2020 2027 6c61 6227 3a20 280a 2020 2020     'lab': (.    
+00002540: 2020 2020 2020 2020 2020 2020 2768 7474              'htt
+00002550: 7073 3a2f 2f65 7861 6d70 6c65 2e63 6f6d  ps://example.com
+00002560: 2f61 7263 6869 7665 2f74 6573 745f 636f  /archive/test_co
+00002570: 7572 7365 5f7b 7365 6d65 7374 6572 7d2f  urse_{semester}/
+00002580: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00002590: 2020 2770 7562 6c69 635f 6874 6d6c 2f6c    'public_html/l
+000025a0: 6162 732f 7b67 726f 7570 7d27 0a20 2020  abs/{group}'.   
+000025b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000025c0: 2020 207d 0a20 2020 207d 2c0a 2020 2020     }.    },.    
+000025d0: 2254 4153 4b5f 494e 464f 5f46 494c 4522  "TASK_INFO_FILE"
+000025e0: 3a20 2774 6173 6b73 2e6a 736f 6e27 2c0a  : 'tasks.json',.
+000025f0: 2020 2020 2243 4f4e 4345 5054 535f 4649      "CONCEPTS_FI
+00002600: 4c45 223a 2027 636f 6e63 6570 7473 2e6a  LE": 'concepts.j
+00002610: 736f 6e27 2c0a 2020 2020 2241 444d 494e  son',.    "ADMIN
+00002620: 5f49 4e46 4f5f 4649 4c45 223a 2027 706f  _INFO_FILE": 'po
+00002630: 746c 7563 6b2d 6164 6d69 6e2e 6a73 6f6e  tluck-admin.json
+00002640: 272c 0a20 2020 2022 524f 5354 4552 5f46  ',.    "ROSTER_F
+00002650: 494c 4522 3a20 2772 6f73 7465 722e 6373  ILE": 'roster.cs
+00002660: 7627 2c0a 2020 2020 2253 5455 4445 4e54  v',.    "STUDENT
+00002670: 5f49 4e46 4f5f 4649 4c45 223a 2027 7374  _INFO_FILE": 'st
+00002680: 7564 656e 742d 696e 666f 2e74 7376 272c  udent-info.tsv',
+00002690: 0a20 2020 2022 5359 4e43 5f50 4f52 5422  .    "SYNC_PORT"
+000026a0: 3a20 3531 3732 332c 0a20 2020 2022 4649  : 51723,.    "FI
+000026b0: 4e41 4c5f 4556 414c 5f54 494d 454f 5554  NAL_EVAL_TIMEOUT
+000026c0: 223a 2036 302c 0a20 2020 2022 5553 455f  ": 60,.    "USE_
+000026d0: 5856 4642 223a 2046 616c 7365 2c0a 2020  XVFB": False,.  
+000026e0: 2020 2258 5646 425f 5345 5256 4552 5f41    "XVFB_SERVER_A
+000026f0: 5247 5322 3a20 222d 7363 7265 656e 2030  RGS": "-screen 0
+00002700: 2031 3032 3478 3736 3878 3234 222c 0a20   1024x768x24",. 
+00002710: 2020 2022 5245 4d41 505f 5354 5544 454e     "REMAP_STUDEN
+00002720: 545f 494e 464f 223a 207b 7d2c 0a20 2020  T_INFO": {},.   
+00002730: 2022 5343 4f52 455f 4241 5349 5322 3a20   "SCORE_BASIS": 
+00002740: 3130 302c 0a20 2020 2022 524f 554e 445f  100,.    "ROUND_
+00002750: 5343 4f52 4553 5f54 4f22 3a20 302c 0a20  SCORES_TO": 0,. 
+00002760: 2020 2022 4556 414c 5541 5449 4f4e 5f53     "EVALUATION_S
+00002770: 434f 5245 5322 3a20 7b0a 2020 2020 2020  CORES": {.      
+00002780: 2020 2265 7863 656c 6c65 6e74 223a 2031    "excellent": 1
+00002790: 3030 2c0a 2020 2020 2020 2020 2263 6f6d  00,.        "com
+000027a0: 706c 6574 6522 3a20 3130 302c 0a20 2020  plete": 100,.   
+000027b0: 2020 2020 2022 616c 6d6f 7374 2063 6f6d       "almost com
+000027c0: 706c 6574 6522 3a20 3835 2c0a 2020 2020  plete": 85,.    
+000027d0: 2020 2020 2270 6172 7469 616c 6c79 2063      "partially c
+000027e0: 6f6d 706c 6574 6522 3a20 3735 2c0a 2020  omplete": 75,.  
+000027f0: 2020 2020 2020 2269 6e63 6f6d 706c 6574        "incomplet
+00002800: 6522 3a20 302c 0a20 2020 2020 2020 2022  e": 0,.        "
+00002810: 5f5f 6f74 6865 725f 5f22 3a20 4e6f 6e65  __other__": None
+00002820: 0a20 2020 207d 2c0a 2020 2020 2252 4556  .    },.    "REV
+00002830: 4953 494f 4e5f 4d41 585f 5343 4f52 4522  ISION_MAX_SCORE"
+00002840: 3a20 3130 302c 0a20 2020 2022 4245 4c41  : 100,.    "BELA
+00002850: 5445 445f 4d41 585f 5343 4f52 4522 3a20  TED_MAX_SCORE": 
+00002860: 3835 2c0a 2020 2020 2254 494d 454c 494e  85,.    "TIMELIN
+00002870: 4553 535f 504f 494e 5453 223a 2031 302c  ESS_POINTS": 10,
+00002880: 0a20 2020 2022 5449 4d45 4c49 4e45 5353  .    "TIMELINESS
+00002890: 5f41 5454 454d 5054 5f54 4852 4553 484f  _ATTEMPT_THRESHO
+000028a0: 4c44 223a 2037 352c 0a20 2020 2022 5449  LD": 75,.    "TI
+000028b0: 4d45 4c49 4e45 5353 5f43 4f4d 504c 4554  MELINESS_COMPLET
+000028c0: 455f 5448 5245 5348 4f4c 4422 3a20 3835  E_THRESHOLD": 85
+000028d0: 2c0a 2020 2020 2254 4153 4b5f 5745 4947  ,.    "TASK_WEIG
+000028e0: 4854 223a 2032 2c0a 2020 2020 2245 5845  HT": 2,.    "EXE
+000028f0: 5243 4953 455f 5745 4947 4854 223a 2031  RCISE_WEIGHT": 1
+00002900: 2c0a 2020 2020 224f 5554 434f 4d45 5f57  ,.    "OUTCOME_W
+00002910: 4549 4748 5422 3a20 302e 3235 2c0a 2020  EIGHT": 0.25,.  
+00002920: 2020 2245 5845 5243 4953 455f 4752 4f55    "EXERCISE_GROU
+00002930: 505f 5448 5245 5348 4f4c 4422 3a20 302e  P_THRESHOLD": 0.
+00002940: 3739 352c 0a20 2020 2022 4558 4552 4349  795,.    "EXERCI
+00002950: 5345 5f47 524f 5550 5f50 4152 5449 414c  SE_GROUP_PARTIAL
+00002960: 5f54 4852 4553 484f 4c44 223a 2030 2e33  _THRESHOLD": 0.3
+00002970: 3935 2c0a 2020 2020 2245 5845 5243 4953  95,.    "EXERCIS
+00002980: 455f 4752 4f55 505f 4352 4544 4954 5f42  E_GROUP_CREDIT_B
+00002990: 554d 5022 3a20 302e 312c 0a20 2020 2022  UMP": 0.1,.    "
+000029a0: 4c41 5445 5f45 5845 5243 4953 455f 4352  LATE_EXERCISE_CR
+000029b0: 4544 4954 5f46 5241 4354 494f 4e22 3a20  EDIT_FRACTION": 
+000029c0: 302e 352c 0a20 2020 2022 4752 4144 455f  0.5,.    "GRADE_
+000029d0: 5448 5245 5348 4f4c 4453 223a 207b 0a20  THRESHOLDS": {. 
+000029e0: 2020 2020 2020 2022 6c6f 7722 3a20 3735         "low": 75
+000029f0: 2c0a 2020 2020 2020 2020 226d 6964 223a  ,.        "mid":
+00002a00: 2039 300a 2020 2020 7d0a 7d0a 0a23 204c   90.    }.}..# L
+00002a10: 6f61 6473 2063 6f6e 6669 6775 7261 7469  oads configurati
+00002a20: 6f6e 2066 726f 6d20 6669 6c65 2060 7073  on from file `ps
+00002a30: 5f63 6f6e 6669 672e 7079 602e 2049 6620  _config.py`. If 
+00002a40: 7468 6174 2066 696c 6520 6973 6e27 740a  that file isn't.
+00002a50: 2320 7072 6573 656e 7420 6275 7420 6070  # present but `p
+00002a60: 735f 636f 6e66 6967 2e70 792e 6578 616d  s_config.py.exam
+00002a70: 706c 6560 2069 732c 2063 6f70 6965 7320  ple` is, copies 
+00002a80: 7468 6520 6c61 7474 6572 2061 7320 7468  the latter as th
+00002a90: 6520 666f 726d 6572 0a23 2066 6972 7374  e former.# first
+00002aa0: 2e20 4e6f 7465 2074 6861 7420 7468 6973  . Note that this
+00002ab0: 2043 414e 4e4f 5420 6265 2072 756e 2061   CANNOT be run a
+00002ac0: 7320 616e 2069 6e69 7469 616c 697a 6174  s an initializat
+00002ad0: 696f 6e20 7061 7373 2c20 7369 6e63 650a  ion pass, since.
+00002ae0: 2320 7468 6520 726f 7574 6520 6465 6669  # the route defi
+00002af0: 6e69 7469 6f6e 7320 6265 6c6f 7720 7265  nitions below re
+00002b00: 7175 6972 6520 6120 776f 726b 696e 6720  quire a working 
+00002b10: 636f 6e66 6967 7572 6174 696f 6e2e 0a74  configuration..t
+00002b20: 7279 3a0a 2020 2020 7379 732e 7061 7468  ry:.    sys.path
+00002b30: 2e61 7070 656e 6428 272e 2729 0a20 2020  .append('.').   
+00002b40: 2061 7070 2e63 6f6e 6669 672e 6672 6f6d   app.config.from
+00002b50: 5f6f 626a 6563 7428 2770 735f 636f 6e66  _object('ps_conf
+00002b60: 6967 2729 0a65 7863 6570 7420 4578 6365  ig').except Exce
+00002b70: 7074 696f 6e20 6173 2065 3a20 2320 7472  ption as e: # tr
+00002b80: 7920 636f 7079 696e 6720 7468 6520 2e65  y copying the .e
+00002b90: 7861 6d70 6c65 2066 696c 653f 0a20 2020  xample file?.   
+00002ba0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+00002bb0: 7473 2827 7073 5f63 6f6e 6669 672e 7079  ts('ps_config.py
+00002bc0: 2e65 7861 6d70 6c65 2729 3a0a 2020 2020  .example'):.    
+00002bd0: 2020 2020 7072 696e 7428 2243 7265 6174      print("Creat
+00002be0: 696e 6720 6e65 7720 2770 735f 636f 6e66  ing new 'ps_conf
+00002bf0: 6967 2e70 7927 2066 726f 6d20 2770 735f  ig.py' from 'ps_
+00002c00: 636f 6e66 6967 2e70 792e 6578 616d 706c  config.py.exampl
+00002c10: 6527 2e22 290a 2020 2020 2020 2020 7368  e'.").        sh
+00002c20: 7574 696c 2e63 6f70 7966 696c 6528 2770  util.copyfile('p
+00002c30: 735f 636f 6e66 6967 2e70 792e 6578 616d  s_config.py.exam
+00002c40: 706c 6527 2c20 2770 735f 636f 6e66 6967  ple', 'ps_config
+00002c50: 2e70 7927 290a 2020 2020 2020 2020 6170  .py').        ap
+00002c60: 702e 636f 6e66 6967 2e66 726f 6d5f 6f62  p.config.from_ob
+00002c70: 6a65 6374 2827 7073 5f63 6f6e 6669 6727  ject('ps_config'
+00002c80: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+00002c90: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+00002ca0: 2020 2020 2020 2022 4e65 6974 6865 7220         "Neither 
+00002cb0: 2770 735f 636f 6e66 6967 2e70 7927 206e  'ps_config.py' n
+00002cc0: 6f72 2027 7073 5f63 6f6e 6669 672e 7079  or 'ps_config.py
+00002cd0: 2e65 7861 6d70 6c65 2720 6973 220a 2020  .example' is".  
+00002ce0: 2020 2020 2020 2020 2020 2220 6176 6169            " avai
+00002cf0: 6c61 626c 652c 206f 7220 7468 6572 6520  lable, or there 
+00002d00: 7761 7320 616e 2065 7272 6f72 2069 6e20  was an error in 
+00002d10: 7061 7273 696e 6720 7468 656d 2c20 736f  parsing them, so
+00002d20: 220a 2020 2020 2020 2020 2020 2020 2220  ".            " 
+00002d30: 6465 6661 756c 7420 636f 6e66 6967 7572  default configur
+00002d40: 6174 696f 6e20 7769 6c6c 2062 6520 7573  ation will be us
+00002d50: 6564 2e22 0a20 2020 2020 2020 2029 0a20  ed.".        ). 
+00002d60: 2020 2020 2020 2070 7269 6e74 2822 4357         print("CW
+00002d70: 4420 6973 3a22 2c20 6f73 2e67 6574 6377  D is:", os.getcw
+00002d80: 6428 2929 0a20 2020 2020 2020 2070 7269  d()).        pri
+00002d90: 6e74 2822 4572 726f 7220 6c6f 6164 696e  nt("Error loadin
+00002da0: 6720 2770 735f 636f 6e66 6967 2e70 7927  g 'ps_config.py'
+00002db0: 2077 6173 3a22 2c20 7374 7228 6529 290a   was:", str(e)).
+00002dc0: 2020 2020 2020 2020 6170 702e 636f 6e66          app.conf
+00002dd0: 6967 2e66 726f 6d5f 6d61 7070 696e 6728  ig.from_mapping(
+00002de0: 4445 4641 554c 545f 434f 4e46 4947 290a  DEFAULT_CONFIG).
+00002df0: 6669 6e61 6c6c 793a 0a20 2020 2073 7973  finally:.    sys
+00002e00: 2e70 6174 682e 706f 7028 2920 2320 6e6f  .path.pop() # no
+00002e10: 206c 6f6e 6765 7220 6e65 6564 2027 2e27   longer need '.'
+00002e20: 206f 6e20 7061 7468 2e2e 2e0a 0a0a 4061   on path......@a
+00002e30: 7070 2e69 6e69 740a 6465 6620 7365 7475  pp.init.def setu
+00002e40: 705f 6a69 6e6a 615f 6c6f 6164 6572 2861  p_jinja_loader(a
+00002e50: 7070 293a 0a20 2020 2022 2222 0a20 2020  pp):.    """.   
+00002e60: 2053 6574 2075 7020 7465 6d70 6c61 7469   Set up templati
+00002e70: 6e67 2077 6974 6820 6120 6375 7374 6f6d  ng with a custom
+00002e80: 206c 6f61 6465 7220 7468 6174 206c 6f61   loader that loa
+00002e90: 6473 2074 656d 706c 6174 6573 2066 726f  ds templates fro
+00002ea0: 6d20 7468 650a 2020 2020 706f 746c 7563  m the.    potluc
+00002eb0: 6b20 7061 636b 6167 6520 6966 2069 7420  k package if it 
+00002ec0: 6361 6e27 7420 6669 6e64 2074 6865 6d20  can't find them 
+00002ed0: 696e 2074 6869 7320 7061 636b 6167 652e  in this package.
+00002ee0: 2054 6869 7320 6973 2068 6f77 0a20 2020   This is how.   
+00002ef0: 2077 6520 7368 6172 6520 7468 6520 7265   we share the re
+00002f00: 706f 7274 2074 656d 706c 6174 6520 6265  port template be
+00002f10: 7477 6565 6e20 706f 746c 7563 6b5f 7365  tween potluck_se
+00002f20: 7276 6572 2061 6e64 2070 6f74 6c75 636b  rver and potluck
+00002f30: 2e0a 2020 2020 2222 220a 2020 2020 6170  ..    """.    ap
+00002f40: 702e 6a69 6e6a 615f 6c6f 6164 6572 203d  p.jinja_loader =
+00002f50: 206a 696e 6a61 322e 4368 6f69 6365 4c6f   jinja2.ChoiceLo
+00002f60: 6164 6572 285b 0a20 2020 2020 2020 206a  ader([.        j
+00002f70: 696e 6a61 322e 5061 636b 6167 654c 6f61  inja2.PackageLoa
+00002f80: 6465 7228 2270 6f74 6c75 636b 5f73 6572  der("potluck_ser
+00002f90: 7665 7222 2c20 2274 656d 706c 6174 6573  ver", "templates
+00002fa0: 2229 2c0a 2020 2020 2020 2020 6a69 6e6a  "),.        jinj
+00002fb0: 6132 2e50 6163 6b61 6765 4c6f 6164 6572  a2.PackageLoader
+00002fc0: 2822 706f 746c 7563 6b22 2c20 2274 656d  ("potluck", "tem
+00002fd0: 706c 6174 6573 2229 0a20 2020 205d 290a  plates").    ]).
+00002fe0: 0a0a 4061 7070 2e69 6e69 740a 6465 6620  ..@app.init.def 
+00002ff0: 656e 6162 6c65 5f43 4153 2861 7070 293a  enable_CAS(app):
+00003000: 0a20 2020 2022 2222 0a20 2020 2045 6e61  .    """.    Ena
+00003010: 626c 6520 6175 7468 656e 7469 6361 7469  ble authenticati
+00003020: 6f6e 2076 6961 2061 2043 656e 7472 616c  on via a Central
+00003030: 2041 7574 6865 6e74 6963 6174 696f 6e20   Authentication 
+00003040: 5365 7276 6572 2e0a 2020 2020 2222 220a  Server..    """.
+00003050: 2020 2020 676c 6f62 616c 2063 6173 0a20      global cas. 
+00003060: 2020 2063 6173 203d 2066 6c61 736b 5f63     cas = flask_c
+00003070: 6173 2e43 4153 2861 7070 290a 0a0a 4061  as.CAS(app)...@a
+00003080: 7070 2e69 6e69 740a 6465 6620 7365 7475  pp.init.def setu
+00003090: 705f 706f 746c 7563 6b5f 7265 706f 7274  p_potluck_report
+000030a0: 696e 6728 6170 7029 3a0a 2020 2020 2222  ing(app):.    ""
+000030b0: 220a 2020 2020 5365 7475 7020 666f 7220  ".    Setup for 
+000030c0: 7468 6520 706f 746c 7563 6b2e 7265 6e64  the potluck.rend
+000030d0: 6572 206d 6f64 756c 6520 2875 7365 7320  er module (uses 
+000030e0: 6465 6661 756c 7473 292e 0a20 2020 2022  defaults)..    "
+000030f0: 2222 0a20 2020 2070 6f74 6c75 636b 2e72  "".    potluck.r
+00003100: 656e 6465 722e 7365 7475 7028 290a 0a0a  ender.setup()...
+00003110: 4061 7070 2e69 6e69 740a 6465 6620 6372  @app.init.def cr
+00003120: 6561 7465 5f73 6563 7265 745f 6b65 7928  eate_secret_key(
+00003130: 6170 7029 3a0a 2020 2020 2222 220a 2020  app):.    """.  
+00003140: 2020 5365 7420 7365 6372 6574 206b 6579    Set secret key
+00003150: 2066 726f 6d20 7365 6372 6574 2066 696c   from secret fil
+00003160: 652c 206f 7220 6372 6561 7465 2061 206e  e, or create a n
+00003170: 6577 2073 6563 7265 7420 6b65 7920 616e  ew secret key an
+00003180: 640a 2020 2020 7772 6974 6520 6974 2069  d.    write it i
+00003190: 6e74 6f20 7468 6520 7365 6372 6574 2066  nto the secret f
+000031a0: 696c 652e 0a20 2020 2022 2222 0a20 2020  ile..    """.   
+000031b0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+000031c0: 7473 2822 7365 6372 6574 2229 3a0a 2020  ts("secret"):.  
+000031d0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+000031e0: 2273 6563 7265 7422 2c20 2772 6227 2920  "secret", 'rb') 
+000031f0: 6173 2066 696e 3a0a 2020 2020 2020 2020  as fin:.        
+00003200: 2020 2020 6170 702e 7365 6372 6574 5f6b      app.secret_k
+00003210: 6579 203d 2066 696e 2e72 6561 6428 290a  ey = fin.read().
+00003220: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00003230: 2020 7072 696e 7428 2243 7265 6174 696e    print("Creatin
+00003240: 6720 6e65 7720 7365 6372 6574 206b 6579  g new secret key
+00003250: 2066 696c 6520 2773 6563 7265 7427 2e22   file 'secret'."
+00003260: 290a 2020 2020 2020 2020 6170 702e 7365  ).        app.se
+00003270: 6372 6574 5f6b 6579 203d 206f 732e 7572  cret_key = os.ur
+00003280: 616e 646f 6d28 3136 290a 2020 2020 2020  andom(16).      
+00003290: 2020 7769 7468 206f 7065 6e28 2273 6563    with open("sec
+000032a0: 7265 7422 2c20 2777 6227 2920 6173 2066  ret", 'wb') as f
+000032b0: 6f75 743a 0a20 2020 2020 2020 2020 2020  out:.           
+000032c0: 2066 6f75 742e 7772 6974 6528 6170 702e   fout.write(app.
+000032d0: 7365 6372 6574 5f6b 6579 290a 0a0a 4061  secret_key)...@a
+000032e0: 7070 2e69 6e69 740a 6465 6620 696e 6974  pp.init.def init
+000032f0: 6961 6c69 7a65 5f73 746f 7261 6765 5f6d  ialize_storage_m
+00003300: 6f64 756c 6528 6170 7029 3a0a 2020 2020  odule(app):.    
+00003310: 2222 220a 2020 2020 496e 6974 6961 6c69  """.    Initiali
+00003320: 7a65 2066 696c 6520 6163 6365 7373 2061  ze file access a
+00003330: 6e64 2073 746f 7261 6765 2073 7973 7465  nd storage syste
+00003340: 6d2e 0a20 2020 2022 2222 0a20 2020 2073  m..    """.    s
+00003350: 746f 7261 6765 2e69 6e69 7428 6170 702e  torage.init(app.
+00003360: 636f 6e66 6967 290a 0a0a 4061 7070 2e69  config)...@app.i
+00003370: 6e69 740a 6465 6620 656e 7375 7265 5f72  nit.def ensure_r
+00003380: 6571 7569 7265 645f 666f 6c64 6572 7328  equired_folders(
+00003390: 6170 7029 3a0a 2020 2020 2222 220a 2020  app):.    """.  
+000033a0: 2020 456e 7375 7265 7320 7265 7175 6972    Ensures requir
+000033b0: 6564 2066 6f6c 6465 7273 2066 6f72 2074  ed folders for t
+000033c0: 6865 2064 6566 6175 6c74 2063 6f75 7273  he default cours
+000033d0: 652f 7365 6d65 7374 6572 2e0a 2020 2020  e/semester..    
+000033e0: 544f 444f 3a20 5768 6174 2061 626f 7574  TODO: What about
+000033f0: 206e 6f6e 2d64 6566 6175 6c74 2063 6f75   non-default cou
+00003400: 7273 6573 2f73 656d 6573 7465 7273 3f20  rses/semesters? 
+00003410: 4966 2074 6865 7927 7265 2066 696e 652c  If they're fine,
+00003420: 2069 730a 2020 2020 7468 6973 2065 7665   is.    this eve
+00003430: 6e20 6e65 6365 7373 6172 793f 0a20 2020  n necessary?.   
+00003440: 2022 2222 0a20 2020 2074 6869 735f 636f   """.    this_co
+00003450: 7572 7365 203d 2061 7070 2e63 6f6e 6669  urse = app.confi
+00003460: 672e 6765 7428 2244 4546 4155 4c54 5f43  g.get("DEFAULT_C
+00003470: 4f55 5253 4522 2c20 2775 6e6b 6e6f 776e  OURSE", 'unknown
+00003480: 2729 0a20 2020 2074 6869 735f 7365 6d65  ').    this_seme
+00003490: 7374 6572 203d 2061 7070 2e63 6f6e 6669  ster = app.confi
+000034a0: 672e 6765 7428 2244 4546 4155 4c54 5f53  g.get("DEFAULT_S
+000034b0: 454d 4553 5445 5222 2c20 2775 6e6b 6e6f  EMESTER", 'unkno
+000034c0: 776e 2729 0a20 2020 2073 746f 7261 6765  wn').    storage
+000034d0: 2e65 6e73 7572 655f 6469 7265 6374 6f72  .ensure_director
+000034e0: 7928 0a20 2020 2020 2020 2073 746f 7261  y(.        stora
+000034f0: 6765 2e65 7661 6c75 6174 696f 6e5f 6469  ge.evaluation_di
+00003500: 7265 6374 6f72 7928 7468 6973 5f63 6f75  rectory(this_cou
+00003510: 7273 652c 2074 6869 735f 7365 6d65 7374  rse, this_semest
+00003520: 6572 290a 2020 2020 290a 2020 2020 7374  er).    ).    st
+00003530: 6f72 6167 652e 656e 7375 7265 5f64 6972  orage.ensure_dir
+00003540: 6563 746f 7279 280a 2020 2020 2020 2020  ectory(.        
+00003550: 7374 6f72 6167 652e 7375 626d 6973 7369  storage.submissi
+00003560: 6f6e 735f 666f 6c64 6572 2874 6869 735f  ons_folder(this_
+00003570: 636f 7572 7365 2c20 7468 6973 5f73 656d  course, this_sem
+00003580: 6573 7465 7229 0a20 2020 2029 0a0a 0a23  ester).    )...#
+00003590: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000035a0: 230a 2320 5365 6375 7269 7479 2073 6574  #.# Security set
+000035b0: 7570 2023 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  up #.#----------
+000035c0: 2d2d 2d2d 2d2d 230a 0a4e 4f41 5554 4820  ------#..NOAUTH 
+000035d0: 3d20 4661 6c73 650a 5553 455f 5441 4c49  = False.USE_TALI
+000035e0: 534d 414e 203d 2054 7275 650a 6966 205f  SMAN = True.if _
+000035f0: 5f6e 616d 655f 5f20 3d3d 2022 5f5f 6d61  _name__ == "__ma
+00003600: 696e 5f5f 223a 0a20 2020 2023 2050 7269  in__":.    # Pri
+00003610: 6e74 2069 6e74 726f 2068 6572 652e 2e2e  nt intro here...
+00003620: 0a20 2020 2070 7269 6e74 2822 5468 6973  .    print("This
+00003630: 2069 7320 706f 746c 7563 6b5f 7365 7276   is potluck_serv
+00003640: 6572 2076 6572 7369 6f6e 207b 7d22 2e66  er version {}".f
+00003650: 6f72 6d61 7428 5f5f 7665 7273 696f 6e5f  ormat(__version_
+00003660: 5f29 290a 0a20 2020 2070 7269 6e74 2822  _))..    print("
+00003670: 5741 524e 494e 473a 2052 756e 6e69 6e67  WARNING: Running
+00003680: 2069 6e20 6465 6275 6720 6d6f 6465 2057   in debug mode W
+00003690: 4954 484f 5554 2041 5554 4845 4e54 4943  ITHOUT AUTHENTIC
+000036a0: 4154 494f 4e21 2229 0a20 2020 2069 6e70  ATION!").    inp
+000036b0: 7574 2822 5072 6573 7320 656e 7465 7220  ut("Press enter 
+000036c0: 746f 2063 6f6e 7469 6e75 6520 696e 2064  to continue in d
+000036d0: 6562 7567 206d 6f64 652e 2229 0a20 2020  ebug mode.").   
+000036e0: 2023 2044 6973 6162 6c65 206c 6f67 696e   # Disable login
+000036f0: 5f72 6571 7569 7265 640a 2020 2020 666c  _required.    fl
+00003700: 6173 6b5f 6361 732e 6c6f 6769 6e5f 7265  ask_cas.login_re
+00003710: 7175 6972 6564 203d 206c 616d 6264 6120  quired = lambda 
+00003720: 663a 2066 0a20 2020 2023 2053 6574 2075  f: f.    # Set u
+00003730: 7020 7573 6572 6e61 6d65 2077 6f72 6b61  p username worka
+00003740: 726f 756e 640a 2020 2020 4e4f 4155 5448  round.    NOAUTH
+00003750: 203d 2054 7275 650a 0a20 2020 2023 2049   = True..    # I
+00003760: 6620 4f70 656e 5353 4c20 6973 2061 7661  f OpenSSL is ava
+00003770: 696c 6162 6c65 2c20 7765 2063 616e 2075  ilable, we can u
+00003780: 7365 2074 616c 6973 6d61 6e20 6576 656e  se talisman even
+00003790: 2069 6620 7275 6e6e 696e 6720 696e 0a20   if running in. 
+000037a0: 2020 2023 206c 6f63 616c 2064 6562 7567     # local debug
+000037b0: 6769 6e67 206d 6f64 653b 206f 7468 6572  ging mode; other
+000037c0: 7769 7365 2077 6520 6e65 6564 2074 6f20  wise we need to 
+000037d0: 6469 7361 626c 6520 7461 6c69 736d 616e  disable talisman
+000037e0: 2e0a 2020 2020 7472 793a 0a20 2020 2020  ..    try:.     
+000037f0: 2020 2069 6d70 6f72 7420 4f70 656e 5353     import OpenSS
+00003800: 4c0a 2020 2020 6578 6365 7074 204d 6f64  L.    except Mod
+00003810: 756c 654e 6f74 466f 756e 645f 6f72 5f49  uleNotFound_or_I
+00003820: 6d70 6f72 745f 4572 726f 723a 0a20 2020  mport_Error:.   
+00003830: 2020 2020 2055 5345 5f54 414c 4953 4d41       USE_TALISMA
+00003840: 4e20 3d20 4661 6c73 650a 0a20 2020 2023  N = False..    #
+00003850: 2043 6f6e 6669 6720 6d61 7920 6469 7361   Config may disa
+00003860: 626c 6520 7461 6c69 736d 616e 0a20 2020  ble talisman.   
+00003870: 2069 6620 6170 702e 636f 6e66 6967 2e67   if app.config.g
+00003880: 6574 2827 4e4f 5f44 4542 5547 5f53 534c  et('NO_DEBUG_SSL
+00003890: 2729 3a0a 2020 2020 2020 2020 5553 455f  '):.        USE_
+000038a0: 5441 4c49 534d 414e 203d 2046 616c 7365  TALISMAN = False
+000038b0: 0a0a 0a40 6170 702e 696e 6974 0a64 6566  ...@app.init.def
+000038c0: 2065 6e61 626c 655f 7461 6c69 736d 616e   enable_talisman
+000038d0: 2861 7070 293a 0a20 2020 2022 2222 0a20  (app):.    """. 
+000038e0: 2020 2045 6e61 626c 6520 7461 6c69 736d     Enable talism
+000038f0: 616e 2066 6f72 6365 642d 4854 5450 5320  an forced-HTTPS 
+00003900: 616e 6420 6f74 6865 7220 7365 6375 7269  and other securi
+00003910: 7479 2068 6561 6465 7273 2069 660a 2020  ty headers if.  
+00003920: 2020 6066 6c61 736b 5f74 616c 6973 6d61    `flask_talisma
+00003930: 6e60 2069 7320 6176 6169 6c61 626c 6520  n` is available 
+00003940: 616e 6420 6974 2077 6f6e 2774 2069 6e74  and it won't int
+00003950: 6572 6665 7265 2077 6974 6820 6465 6275  erfere with debu
+00003960: 6767 696e 672e 0a20 2020 2022 2222 0a20  gging..    """. 
+00003970: 2020 2074 616c 6973 6d61 6e5f 656e 6162     talisman_enab
+00003980: 6c65 6420 3d20 4661 6c73 650a 2020 2020  led = False.    
+00003990: 6966 2055 5345 5f54 414c 4953 4d41 4e3a  if USE_TALISMAN:
+000039a0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000039b0: 2020 2020 2020 2020 2020 696d 706f 7274            import
+000039c0: 2066 6c61 736b 5f74 616c 6973 6d61 6e0a   flask_talisman.
+000039d0: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+000039e0: 6e74 656e 742d 7365 6375 7269 7479 2070  ntent-security p
+000039f0: 6f6c 6963 7920 7365 7474 696e 6773 0a20  olicy settings. 
+00003a00: 2020 2020 2020 2020 2020 2063 7370 203d             csp =
+00003a10: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00003a20: 2020 2027 6465 6661 756c 742d 7372 6327     'default-src'
+00003a30: 3a20 2227 7365 6c66 2722 2c0a 2020 2020  : "'self'",.    
+00003a40: 2020 2020 2020 2020 2020 2020 2773 6372              'scr
+00003a50: 6970 742d 7372 6327 3a20 2227 7365 6c66  ipt-src': "'self
+00003a60: 2720 2772 6570 6f72 742d 7361 6d70 6c65  ' 'report-sample
+00003a70: 2722 2c0a 2020 2020 2020 2020 2020 2020  '",.            
+00003a80: 2020 2020 2773 7479 6c65 2d73 7263 273a      'style-src':
+00003a90: 2022 2773 656c 6627 222c 0a20 2020 2020   "'self'",.     
+00003aa0: 2020 2020 2020 2020 2020 2027 696d 672d             'img-
+00003ab0: 7372 6327 3a20 2227 7365 6c66 2720 6461  src': "'self' da
+00003ac0: 7461 3a22 0a20 2020 2020 2020 2020 2020  ta:".           
+00003ad0: 207d 0a20 2020 2020 2020 2020 2020 2066   }.            f
+00003ae0: 6c61 736b 5f74 616c 6973 6d61 6e2e 5461  lask_talisman.Ta
+00003af0: 6c69 736d 616e 280a 2020 2020 2020 2020  lisman(.        
+00003b00: 2020 2020 2020 2020 6170 702c 0a20 2020          app,.   
+00003b10: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00003b20: 7465 6e74 5f73 6563 7572 6974 795f 706f  tent_security_po
+00003b30: 6c69 6379 3d63 7370 2c0a 2020 2020 2020  licy=csp,.      
+00003b40: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
+00003b50: 745f 7365 6375 7269 7479 5f70 6f6c 6963  t_security_polic
+00003b60: 795f 6e6f 6e63 655f 696e 3d5b 0a20 2020  y_nonce_in=[.   
+00003b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b80: 2027 7363 7269 7074 2d73 7263 272c 0a20   'script-src',. 
+00003b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ba0: 2020 2027 7374 796c 652d 7372 6327 0a20     'style-src'. 
+00003bb0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00003bc0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00003bd0: 2020 2020 2020 2020 2020 2074 616c 6973             talis
+00003be0: 6d61 6e5f 656e 6162 6c65 6420 3d20 5472  man_enabled = Tr
+00003bf0: 7565 0a20 2020 2020 2020 2065 7863 6570  ue.        excep
+00003c00: 7420 4d6f 6475 6c65 4e6f 7446 6f75 6e64  t ModuleNotFound
+00003c10: 5f6f 725f 496d 706f 7274 5f45 7272 6f72  _or_Import_Error
+00003c20: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00003c30: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+00003c40: 2020 2020 2022 5761 726e 696e 673a 206d       "Warning: m
+00003c50: 6f64 756c 6520 666c 6173 6b5f 7461 6c69  odule flask_tali
+00003c60: 736d 616e 2069 7320 6e6f 7420 6176 6169  sman is not avai
+00003c70: 6c61 626c 653b 220a 2020 2020 2020 2020  lable;".        
+00003c80: 2020 2020 2020 2020 2220 7365 6375 7269          " securi
+00003c90: 7479 2068 6561 6465 7273 2077 696c 6c20  ty headers will 
+00003ca0: 6e6f 7420 6265 2073 6574 2e22 0a20 2020  not be set.".   
+00003cb0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00003cc0: 6966 2074 616c 6973 6d61 6e5f 656e 6162  if talisman_enab
+00003cd0: 6c65 643a 0a20 2020 2020 2020 2070 7269  led:.        pri
+00003ce0: 6e74 2822 5461 6c69 736d 616e 2069 7320  nt("Talisman is 
+00003cf0: 656e 6162 6c65 642e 2229 0a20 2020 2065  enabled.").    e
+00003d00: 6c73 653a 0a20 2020 2020 2020 2070 7269  lse:.        pri
+00003d10: 6e74 2822 5461 6c69 736d 616e 2069 7320  nt("Talisman is 
+00003d20: 4e4f 5420 656e 6162 6c65 642e 2229 0a20  NOT enabled."). 
+00003d30: 2020 2020 2020 2023 2041 6464 2063 7370         # Add csp
+00003d40: 5f6e 6f6e 6365 2067 6c6f 6261 6c20 6475  _nonce global du
+00003d50: 6d6d 7920 7369 6e63 6520 666c 6173 6b5f  mmy since flask_
+00003d60: 7461 6c69 736d 616e 2064 6964 6e27 740a  talisman didn't.
+00003d70: 2020 2020 2020 2020 6170 702e 6164 645f          app.add_
+00003d80: 7465 6d70 6c61 7465 5f67 6c6f 6261 6c28  template_global(
+00003d90: 0a20 2020 2020 2020 2020 2020 206c 616d  .            lam
+00003da0: 6264 613a 2022 2d6e 6f6e 6365 2d64 6973  bda: "-nonce-dis
+00003db0: 6162 6c65 642d 222c 0a20 2020 2020 2020  abled-",.       
+00003dc0: 2020 2020 206e 616d 653d 2763 7370 5f6e       name='csp_n
+00003dd0: 6f6e 6365 270a 2020 2020 2020 2020 290a  once'.        ).
+00003de0: 0a0a 4061 7070 2e69 6e69 740a 6465 6620  ..@app.init.def 
+00003df0: 7365 7475 705f 7365 6173 7572 6628 6170  setup_seasurf(ap
+00003e00: 7029 3a0a 2020 2020 2222 220a 2020 2020  p):.    """.    
+00003e10: 5365 7473 2075 7020 6066 6c61 736b 5f73  Sets up `flask_s
+00003e20: 6561 7375 7266 6020 746f 2063 6f6d 6261  easurf` to comba
+00003e30: 7420 6372 6f73 732d 7369 7465 2072 6571  t cross-site req
+00003e40: 7565 7374 2066 6f72 6765 7279 2c20 6966  uest forgery, if
+00003e50: 0a20 2020 2074 6861 7420 6d6f 6475 6c65  .    that module
+00003e60: 2069 7320 6176 6169 6c61 626c 652e 0a0a   is available...
+00003e70: 2020 2020 4e6f 7465 2074 6861 7420 6072      Note that `r
+00003e80: 6f75 7465 5f64 656c 6976 6572 6020 6973  oute_deliver` is
+00003e90: 2065 7865 6d70 7420 6672 6f6d 2043 5352   exempt from CSR
+00003ea0: 4620 7665 7269 6669 6361 7469 6f6e 2e0a  F verification..
+00003eb0: 2020 2020 2222 220a 2020 2020 676c 6f62      """.    glob
+00003ec0: 616c 2072 6f75 7465 5f64 656c 6976 6572  al route_deliver
+00003ed0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+00003ee0: 2020 696d 706f 7274 2066 6c61 736b 5f73    import flask_s
+00003ef0: 6561 7375 7266 0a20 2020 2020 2020 2063  easurf.        c
+00003f00: 7372 6620 3d20 666c 6173 6b5f 7365 6173  srf = flask_seas
+00003f10: 7572 662e 5365 6153 7572 6628 6170 7029  urf.SeaSurf(app)
+00003f20: 2023 206e 6f71 6120 4638 3431 0a20 2020   # noqa F841.   
+00003f30: 2020 2020 2072 6f75 7465 5f64 656c 6976       route_deliv
+00003f40: 6572 203d 2063 7372 662e 6578 656d 7074  er = csrf.exempt
+00003f50: 2872 6f75 7465 5f64 656c 6976 6572 290a  (route_deliver).
+00003f60: 2020 2020 6578 6365 7074 204d 6f64 756c      except Modul
+00003f70: 654e 6f74 466f 756e 645f 6f72 5f49 6d70  eNotFound_or_Imp
+00003f80: 6f72 745f 4572 726f 723a 0a20 2020 2020  ort_Error:.     
+00003f90: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
+00003fa0: 2020 2020 2020 2257 6172 6e69 6e67 3a20        "Warning: 
+00003fb0: 6d6f 6475 6c65 2066 6c61 736b 5f73 6561  module flask_sea
+00003fc0: 7375 7266 2069 7320 6e6f 7420 6176 6169  surf is not avai
+00003fd0: 6c61 626c 653b 2043 5352 4622 0a20 2020  lable; CSRF".   
+00003fe0: 2020 2020 2020 2020 2022 2070 726f 7465           " prote
+00003ff0: 6374 696f 6e20 7769 6c6c 206e 6f74 2062  ction will not b
+00004000: 6520 656e 6162 6c65 642e 220a 2020 2020  e enabled.".    
+00004010: 2020 2020 290a 2020 2020 2020 2020 2320      ).        # 
+00004020: 4164 6420 6373 7266 5f74 6f6b 656e 2067  Add csrf_token g
+00004030: 6c6f 6261 6c20 6475 6d6d 7920 7369 6e63  lobal dummy sinc
+00004040: 6520 666c 6173 6b5f 7365 6173 7572 6620  e flask_seasurf 
+00004050: 6973 6e27 7420 6176 6169 6c61 626c 650a  isn't available.
+00004060: 2020 2020 2020 2020 6170 702e 6164 645f          app.add_
+00004070: 7465 6d70 6c61 7465 5f67 6c6f 6261 6c28  template_global(
+00004080: 6c61 6d62 6461 3a20 222d 6469 7361 626c  lambda: "-disabl
+00004090: 6564 2d22 2c20 6e61 6d65 3d27 6373 7266  ed-", name='csrf
+000040a0: 5f74 6f6b 656e 2729 0a0a 0a23 2d2d 2d2d  _token')...#----
+000040b0: 2d2d 2d2d 2d23 0a23 2048 656c 7065 7273  -----#.# Helpers
+000040c0: 2023 0a23 2d2d 2d2d 2d2d 2d2d 2d23 0a0a   #.#---------#..
+000040d0: 6465 6620 6175 676d 656e 745f 6172 6775  def augment_argu
+000040e0: 6d65 6e74 7328 726f 7574 655f 6675 6e63  ments(route_func
+000040f0: 7469 6f6e 293a 0a20 2020 2022 2222 0a20  tion):.    """. 
+00004100: 2020 2041 2064 6563 6f72 6174 6f72 2074     A decorator t
+00004110: 6861 7420 6d6f 6469 6669 6573 2061 2072  hat modifies a r
+00004120: 6f75 7465 2066 756e 6374 696f 6e20 746f  oute function to
+00004130: 2073 7570 706c 7920 6075 7365 726e 616d   supply `usernam
+00004140: 6560 2c0a 2020 2020 6069 735f 6164 6d69  e`,.    `is_admi
+00004150: 6e60 2c20 606d 6173 7175 6572 6164 655f  n`, `masquerade_
+00004160: 6173 602c 2060 6566 6665 6374 6976 655f  as`, `effective_
+00004170: 7573 6572 602c 2061 6e64 2060 7461 736b  user`, and `task
+00004180: 5f69 6e66 6f60 0a20 2020 206b 6579 776f  _info`.    keywo
+00004190: 7264 2061 7267 756d 656e 7473 2061 6c6f  rd arguments alo
+000041a0: 6e67 2077 6974 6820 7468 6520 6f74 6865  ng with the othe
+000041b0: 7220 6172 6775 6d65 6e74 7320 7468 6520  r arguments the 
+000041c0: 726f 7574 6520 7265 6365 6976 6573 2e0a  route receives..
+000041d0: 2020 2020 4d75 7374 2062 6520 6170 706c      Must be appl
+000041e0: 6965 6420 6265 666f 7265 2061 7070 2e72  ied before app.r
+000041f0: 6f75 7465 2c20 616e 6420 7468 6520 6669  oute, and the fi
+00004200: 7273 7420 7477 6f20 7061 7261 6d65 7465  rst two paramete
+00004210: 7273 2074 6f20 7468 650a 2020 2020 6675  rs to the.    fu
+00004220: 6e63 7469 6f6e 206d 7573 7420 6265 2074  nction must be t
+00004230: 6865 2063 6f75 7273 6520 616e 6420 7365  he course and se
+00004240: 6d65 7374 6572 2e0a 0a20 2020 2042 6563  mester...    Bec
+00004250: 6175 7365 2066 6c61 736b 2f77 6572 6b7a  ause flask/werkz
+00004260: 6575 6720 726f 7574 696e 6720 7265 7175  eug routing requ
+00004270: 6972 6573 2066 756e 6374 696f 6e20 7369  ires function si
+00004280: 676e 6174 7572 6573 2074 6f20 6265 0a20  gnatures to be. 
+00004290: 2020 2070 7265 7365 7276 6564 2c20 7765     preserved, we
+000042a0: 2064 6f20 736f 6d65 2064 6972 7479 2077   do some dirty w
+000042b0: 6f72 6b20 7769 7468 2063 6f6d 7069 6c65  ork with compile
+000042c0: 2061 6e64 2065 7661 6c2e 2e2e 2041 7320   and eval... As 
+000042d0: 610a 2020 2020 7265 7375 6c74 2c20 7468  a.    result, th
+000042e0: 6973 2066 756e 6374 696f 6e20 6361 6e20  is function can 
+000042f0: 6f6e 6c79 2073 6166 656c 7920 6265 2075  only safely be u
+00004300: 7365 6420 746f 2064 6563 6f72 6174 6520  sed to decorate 
+00004310: 6675 6e63 7469 6f6e 730a 2020 2020 7468  functions.    th
+00004320: 6174 2064 6f6e 2774 2068 6176 6520 616e  at don't have an
+00004330: 7920 6b65 7977 6f72 6420 6172 6775 6d65  y keyword argume
+00004340: 6e74 732e 2046 7572 7468 6572 6d6f 7265  nts. Furthermore
+00004350: 2c20 7468 6520 3520 6175 676d 656e 7465  , the 5 augmente
+00004360: 640a 2020 2020 6172 6775 6d65 6e74 7320  d.    arguments 
+00004370: 6d75 7374 2062 6520 7468 6520 6c61 7374  must be the last
+00004380: 2035 2061 7267 756d 656e 7473 2074 6861   5 arguments tha
+00004390: 7420 7468 6520 6675 6e63 7469 6f6e 2061  t the function a
+000043a0: 6363 6570 7473 2e0a 2020 2020 2222 220a  ccepts..    """.
+000043b0: 2020 2020 6465 6620 7769 7468 5f65 7874      def with_ext
+000043c0: 7261 5f61 7267 756d 656e 7473 282a 6172  ra_arguments(*ar
+000043d0: 6773 2c20 2a2a 6b77 6172 6773 293a 0a20  gs, **kwargs):. 
+000043e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000043f0: 2020 2041 2064 6563 6f72 6174 6564 2072     A decorated r
+00004400: 6f75 7465 2066 756e 6374 696f 6e20 7768  oute function wh
+00004410: 6963 6820 7769 6c6c 2062 6520 7375 7070  ich will be supp
+00004420: 6c69 6564 2077 6974 6820 7573 6572 6e61  lied with userna
+00004430: 6d65 2c0a 2020 2020 2020 2020 6973 5f61  me,.        is_a
+00004440: 646d 696e 2c20 6d61 7371 7565 7261 6465  dmin, masquerade
+00004450: 5f61 732c 2065 6666 6563 7469 7665 5f75  _as, effective_u
+00004460: 7365 722c 2061 6e64 2074 6173 6b5f 696e  ser, and task_in
+00004470: 666f 2070 6172 616d 6574 6572 730a 2020  fo parameters.  
+00004480: 2020 2020 2020 6173 206b 6579 776f 7264        as keyword
+00004490: 2061 7267 756d 656e 7473 2061 6674 6572   arguments after
+000044a0: 206f 7468 6572 2061 7267 756d 656e 7473   other arguments
+000044b0: 2068 6176 6520 6265 656e 2073 7570 706c   have been suppl
+000044c0: 6965 642e 0a20 2020 2020 2020 2022 2222  ied..        """
+000044d0: 0a20 2020 2020 2020 2023 2047 6574 2075  .        # Get u
+000044e0: 7365 726e 616d 650a 2020 2020 2020 2020  sername.        
+000044f0: 6966 204e 4f41 5554 483a 0a20 2020 2020  if NOAUTH:.     
+00004500: 2020 2020 2020 2075 7365 726e 616d 6520         username 
+00004510: 3d20 2274 6573 7422 0a20 2020 2020 2020  = "test".       
+00004520: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00004530: 2020 2075 7365 726e 616d 6520 3d20 6361     username = ca
+00004540: 732e 7573 6572 6e61 6d65 0a0a 2020 2020  s.username..    
+00004550: 2020 2020 2320 4772 6162 2063 6f75 7273      # Grab cours
+00004560: 6520 2b20 7365 6d65 7374 6572 2076 616c  e + semester val
+00004570: 7565 730a 2020 2020 2020 2020 636f 7572  ues.        cour
+00004580: 7365 203d 206b 7761 7267 732e 6765 7428  se = kwargs.get(
+00004590: 2763 6f75 7273 6527 2c20 6172 6773 5b30  'course', args[0
+000045a0: 5d20 6966 206c 656e 2861 7267 7329 203e  ] if len(args) >
+000045b0: 2030 2065 6c73 6520 4e6f 6e65 290a 2020   0 else None).  
+000045c0: 2020 2020 2020 7365 6d65 7374 6572 203d        semester =
+000045d0: 206b 7761 7267 732e 6765 7428 0a20 2020   kwargs.get(.   
+000045e0: 2020 2020 2020 2020 2027 7365 6d65 7374           'semest
+000045f0: 6572 272c 0a20 2020 2020 2020 2020 2020  er',.           
+00004600: 2061 7267 735b 3120 6966 2027 636f 7572   args[1 if 'cour
+00004610: 7365 2720 6e6f 7420 696e 206b 7761 7267  se' not in kwarg
+00004620: 7320 656c 7365 2030 5d0a 2020 2020 2020  s else 0].      
+00004630: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00004640: 2861 7267 7329 203e 2030 2065 6c73 6520  (args) > 0 else 
+00004650: 4e6f 6e65 0a20 2020 2020 2020 2029 0a0a  None.        )..
+00004660: 2020 2020 2020 2020 6966 2063 6f75 7273          if cours
+00004670: 6520 6973 204e 6f6e 6520 6f72 2073 656d  e is None or sem
+00004680: 6573 7465 7220 6973 204e 6f6e 653a 0a20  ester is None:. 
+00004690: 2020 2020 2020 2020 2020 2066 6c61 736b             flask
+000046a0: 2e66 6c61 7368 280a 2020 2020 2020 2020  .flash(.        
+000046b0: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
+000046c0: 2020 2020 2020 2020 2020 2020 2020 2245                "E
+000046d0: 7272 6f72 3a20 556e 6162 6c65 2074 6f20  rror: Unable to 
+000046e0: 6765 7420 636f 7572 7365 2061 6e64 2f6f  get course and/o
+000046f0: 7220 7365 6d65 7374 6572 2e20 436f 7572  r semester. Cour
+00004700: 7365 220a 2020 2020 2020 2020 2020 2020  se".            
+00004710: 2020 2020 2020 2020 2220 6973 207b 7d20          " is {} 
+00004720: 616e 6420 7365 6d65 7374 6572 2069 7320  and semester is 
+00004730: 7b7d 2e22 0a20 2020 2020 2020 2020 2020  {}.".           
+00004740: 2020 2020 2029 2e66 6f72 6d61 7428 7265       ).format(re
+00004750: 7072 2863 6f75 7273 6529 2c20 7265 7072  pr(course), repr
+00004760: 2873 656d 6573 7465 7229 290a 2020 2020  (semester)).    
+00004770: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00004780: 2020 2020 2020 7265 7475 726e 2065 7272        return err
+00004790: 6f72 5f72 6573 706f 6e73 6528 0a20 2020  or_response(.   
+000047a0: 2020 2020 2020 2020 2020 2020 2063 6f75               cou
+000047b0: 7273 652c 0a20 2020 2020 2020 2020 2020  rse,.           
+000047c0: 2020 2020 2073 656d 6573 7465 722c 0a20       semester,. 
+000047d0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000047e0: 7365 726e 616d 652c 0a20 2020 2020 2020  sername,.       
+000047f0: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
+00004800: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00004810: 4661 696c 6564 2074 6f20 6163 6365 7373  Failed to access
+00004820: 203c 636f 6465 3e63 6f75 7273 653c 2f63   <code>course</c
+00004830: 6f64 653e 2061 6e64 2f6f 7222 0a20 2020  ode> and/or".   
+00004840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004850: 2022 203c 636f 6465 3e73 656d 6573 7465   " <code>semeste
+00004860: 723c 2f63 6f64 653e 2076 616c 7565 732e  r</code> values.
+00004870: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00004880: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00004890: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
+000048a0: 2061 646d 696e 2069 6e66 6f0a 2020 2020   admin info.    
+000048b0: 2020 2020 6164 6d69 6e5f 696e 666f 203d      admin_info =
+000048c0: 2073 746f 7261 6765 2e67 6574 5f61 646d   storage.get_adm
+000048d0: 696e 5f69 6e66 6f28 636f 7572 7365 2c20  in_info(course, 
+000048e0: 7365 6d65 7374 6572 290a 2020 2020 2020  semester).      
+000048f0: 2020 6966 2061 646d 696e 5f69 6e66 6f20    if admin_info 
+00004900: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00004910: 2020 2020 2066 6c61 736b 2e66 6c61 7368       flask.flash
+00004920: 2822 4572 726f 7220 6c6f 6164 696e 6720  ("Error loading 
+00004930: 6164 6d69 6e20 696e 666f 2122 290a 2020  admin info!").  
+00004940: 2020 2020 2020 2020 2020 6164 6d69 6e5f            admin_
+00004950: 696e 666f 203d 207b 7d0a 0a20 2020 2020  info = {}..     
+00004960: 2020 2023 2043 6865 636b 2075 7365 7220     # Check user 
+00004970: 7072 6976 696c 6567 6573 0a20 2020 2020  privileges.     
+00004980: 2020 2069 735f 6164 6d69 6e2c 206d 6173     is_admin, mas
+00004990: 7175 6572 6164 655f 6173 203d 2063 6865  querade_as = che
+000049a0: 636b 5f75 7365 725f 7072 6976 696c 6567  ck_user_privileg
+000049b0: 6573 2861 646d 696e 5f69 6e66 6f2c 2075  es(admin_info, u
+000049c0: 7365 726e 616d 6529 0a0a 2020 2020 2020  sername)..      
+000049d0: 2020 2320 4566 6665 6374 6976 6520 7573    # Effective us
+000049e0: 6572 6e61 6d65 0a20 2020 2020 2020 2065  ername.        e
+000049f0: 6666 6563 7469 7665 5f75 7365 7220 3d20  ffective_user = 
+00004a00: 6d61 7371 7565 7261 6465 5f61 7320 6f72  masquerade_as or
+00004a10: 2075 7365 726e 616d 650a 0a20 2020 2020   username..     
+00004a20: 2020 2023 2047 6574 2062 6173 6963 2069     # Get basic i
+00004a30: 6e66 6f20 6f6e 2061 6c6c 2070 7365 7473  nfo on all psets
+00004a40: 2f74 6173 6b73 0a20 2020 2020 2020 2074  /tasks.        t
+00004a50: 6173 6b5f 696e 666f 203d 2073 746f 7261  ask_info = stora
+00004a60: 6765 2e67 6574 5f74 6173 6b5f 696e 666f  ge.get_task_info
+00004a70: 2863 6f75 7273 652c 2073 656d 6573 7465  (course, semeste
+00004a80: 7229 0a20 2020 2020 2020 2069 6620 7461  r).        if ta
+00004a90: 736b 5f69 6e66 6f20 6973 204e 6f6e 653a  sk_info is None:
+00004aa0: 2023 2065 7272 6f72 206c 6f61 6469 6e67   # error loading
+00004ab0: 2074 6173 6b20 696e 666f 0a20 2020 2020   task info.     
+00004ac0: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
+00004ad0: 7368 2822 4572 726f 7220 6c6f 6164 696e  sh("Error loadin
+00004ae0: 6720 7461 736b 2069 6e66 6f21 2229 0a20  g task info!"). 
+00004af0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00004b00: 6e20 6572 726f 725f 7265 7370 6f6e 7365  n error_response
+00004b10: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00004b20: 2020 636f 7572 7365 2c0a 2020 2020 2020    course,.      
+00004b30: 2020 2020 2020 2020 2020 7365 6d65 7374            semest
+00004b40: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00004b50: 2020 2020 7573 6572 6e61 6d65 2c0a 2020      username,.  
+00004b60: 2020 2020 2020 2020 2020 2020 2020 2246                "F
+00004b70: 6169 6c65 6420 746f 206c 6f61 6420 3c63  ailed to load <c
+00004b80: 6f64 653e 7461 736b 732e 6a73 6f6e 3c2f  ode>tasks.json</
+00004b90: 636f 6465 3e2e 220a 2020 2020 2020 2020  code>.".        
+00004ba0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+00004bb0: 2053 6574 2070 6175 7365 2074 696d 6520   Set pause time 
+00004bc0: 666f 7220 7468 6520 7461 736b 2069 6e66  for the task inf
+00004bd0: 6f0a 2020 2020 2020 2020 7365 745f 7061  o.        set_pa
+00004be0: 7573 655f 7469 6d65 2861 646d 696e 5f69  use_time(admin_i
+00004bf0: 6e66 6f2c 2074 6173 6b5f 696e 666f 2c20  nfo, task_info, 
+00004c00: 7573 6572 6e61 6d65 2c20 6d61 7371 7565  username, masque
+00004c10: 7261 6465 5f61 7329 0a0a 2020 2020 2020  rade_as)..      
+00004c20: 2020 2320 5570 6461 7465 2074 6865 206b    # Update the k
+00004c30: 7761 7267 730a 2020 2020 2020 2020 6b77  wargs.        kw
+00004c40: 6172 6773 5b22 7573 6572 6e61 6d65 225d  args["username"]
+00004c50: 203d 2075 7365 726e 616d 650a 2020 2020   = username.    
+00004c60: 2020 2020 6b77 6172 6773 5b22 6973 5f61      kwargs["is_a
+00004c70: 646d 696e 225d 203d 2069 735f 6164 6d69  dmin"] = is_admi
+00004c80: 6e0a 2020 2020 2020 2020 6b77 6172 6773  n.        kwargs
+00004c90: 5b22 6d61 7371 7565 7261 6465 5f61 7322  ["masquerade_as"
+00004ca0: 5d20 3d20 6d61 7371 7565 7261 6465 5f61  ] = masquerade_a
+00004cb0: 730a 2020 2020 2020 2020 6b77 6172 6773  s.        kwargs
+00004cc0: 5b22 6566 6665 6374 6976 655f 7573 6572  ["effective_user
+00004cd0: 225d 203d 2065 6666 6563 7469 7665 5f75  "] = effective_u
+00004ce0: 7365 720a 2020 2020 2020 2020 6b77 6172  ser.        kwar
+00004cf0: 6773 5b22 7461 736b 5f69 6e66 6f22 5d20  gs["task_info"] 
+00004d00: 3d20 7461 736b 5f69 6e66 6f0a 0a20 2020  = task_info..   
+00004d10: 2020 2020 2023 2043 616c 6c20 7468 6520       # Call the 
+00004d20: 6465 636f 7261 7465 6420 6675 6e63 7469  decorated functi
+00004d30: 6f6e 2077 2f20 7468 6520 6578 7472 6120  on w/ the extra 
+00004d40: 7061 7261 6d65 7465 7273 2077 6527 7665  parameters we've
+00004d50: 0a20 2020 2020 2020 2023 2064 6564 7563  .        # deduc
+00004d60: 6564 2e0a 2020 2020 2020 2020 7265 7475  ed..        retu
+00004d70: 726e 2072 6f75 7465 5f66 756e 6374 696f  rn route_functio
+00004d80: 6e28 2a61 7267 732c 202a 2a6b 7761 7267  n(*args, **kwarg
+00004d90: 7329 0a0a 2020 2020 2320 4772 6162 2069  s)..    # Grab i
+00004da0: 6e66 6f20 6f6e 206f 7269 6769 6e61 6c20  nfo on original 
+00004db0: 6675 6e63 7469 6f6e 2073 6967 6e61 7475  function signatu
+00004dc0: 7265 0a20 2020 2066 6e61 6d65 203d 2072  re.    fname = r
+00004dd0: 6f75 7465 5f66 756e 6374 696f 6e2e 5f5f  oute_function.__
+00004de0: 6e61 6d65 5f5f 0a20 2020 206e 6172 6773  name__.    nargs
+00004df0: 203d 2072 6f75 7465 5f66 756e 6374 696f   = route_functio
+00004e00: 6e2e 5f5f 636f 6465 5f5f 2e63 6f5f 6172  n.__code__.co_ar
+00004e10: 6763 6f75 6e74 0a20 2020 2061 7267 6e61  gcount.    argna
+00004e20: 6d65 7320 3d20 726f 7574 655f 6675 6e63  mes = route_func
+00004e30: 7469 6f6e 2e5f 5f63 6f64 655f 5f2e 636f  tion.__code__.co
+00004e40: 5f76 6172 6e61 6d65 735b 3a6e 6172 6773  _varnames[:nargs
+00004e50: 202d 2035 5d0a 0a20 2020 2023 2043 7265   - 5]..    # Cre
+00004e60: 6174 6520 6120 6675 6e63 7469 6f6e 2077  ate a function w
+00004e70: 6974 6820 7468 6520 7361 6d65 2073 6967  ith the same sig
+00004e80: 6e61 7475 7265 3a0a 2020 2020 636f 6465  nature:.    code
+00004e90: 203d 2022 2222 5c0a 6465 6620 7b6e 616d   = """\.def {nam
+00004ea0: 657d 287b 6172 6773 7d29 3a0a 2020 2020  e}({args}):.    
+00004eb0: 7265 7475 726e 2077 6974 685f 6578 7472  return with_extr
+00004ec0: 615f 6172 6775 6d65 6e74 7328 7b61 7267  a_arguments({arg
+00004ed0: 737d 290a 2222 222e 666f 726d 6174 286e  s}).""".format(n
+00004ee0: 616d 653d 666e 616d 652c 2061 7267 733d  ame=fname, args=
+00004ef0: 272c 2027 2e6a 6f69 6e28 6172 676e 616d  ', '.join(argnam
+00004f00: 6573 2929 0a20 2020 2065 6e76 203d 207b  es)).    env = {
+00004f10: 2277 6974 685f 6578 7472 615f 6172 6775  "with_extra_argu
+00004f20: 6d65 6e74 7322 3a20 7769 7468 5f65 7874  ments": with_ext
+00004f30: 7261 5f61 7267 756d 656e 7473 7d0a 2020  ra_arguments}.  
+00004f40: 2020 2320 322f 3320 636f 6d70 6174 6962    # 2/3 compatib
+00004f50: 696c 6974 7920 6174 7465 6d70 742e 2e2e  ility attempt...
+00004f60: 0a20 2020 2069 6620 7379 732e 7665 7273  .    if sys.vers
+00004f70: 696f 6e5f 696e 666f 5b30 5d20 3c20 333a  ion_info[0] < 3:
+00004f80: 0a20 2020 2020 2020 2065 7865 6328 636f  .        exec(co
+00004f90: 6465 2920 696e 2065 6e76 2c20 656e 760a  de) in env, env.
+00004fa0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00004fb0: 2020 6578 6563 2863 6f64 652c 2065 6e76    exec(code, env
+00004fc0: 2c20 656e 7629 2069 6e20 656e 762c 2065  , env) in env, e
+00004fd0: 6e76 0a20 2020 2072 6573 756c 7420 3d20  nv.    result = 
+00004fe0: 656e 765b 666e 616d 655d 0a0a 2020 2020  env[fname]..    
+00004ff0: 2320 5072 6573 6572 7665 2064 6f63 7374  # Preserve docst
+00005000: 7269 6e67 0a20 2020 2072 6573 756c 742e  ring.    result.
+00005010: 5f5f 646f 635f 5f20 3d20 726f 7574 655f  __doc__ = route_
+00005020: 6675 6e63 7469 6f6e 2e5f 5f64 6f63 5f5f  function.__doc__
+00005030: 0a0a 2020 2020 2320 5265 7475 726e 206f  ..    # Return o
+00005040: 7572 2073 796e 7468 6574 6963 2066 756e  ur synthetic fun
+00005050: 6374 696f 6e2e 2e2e 0a20 2020 2072 6574  ction....    ret
+00005060: 7572 6e20 7265 7375 6c74 0a0a 0a64 6566  urn result...def
+00005070: 2067 6f62 6163 6b28 636f 7572 7365 2c20   goback(course, 
+00005080: 7365 6d65 7374 6572 293a 0a20 2020 2022  semester):.    "
+00005090: 2222 0a20 2020 2052 6574 7572 6e73 2061  "".    Returns a
+000050a0: 2066 6c61 736b 2072 6564 6972 6563 7420   flask redirect 
+000050b0: 6169 6d65 6420 6174 2065 6974 6865 7220  aimed at either 
+000050c0: 7468 6520 7061 6765 2074 6861 7420 7468  the page that th
+000050d0: 6520 7573 6572 2063 616d 650a 2020 2020  e user came.    
+000050e0: 6672 6f6d 2c20 6f72 2074 6865 2064 6173  from, or the das
+000050f0: 6862 6f61 7264 2069 6620 7468 6174 2069  hboard if that i
+00005100: 6e66 6f72 6d61 7469 6f6e 2069 736e 2774  nformation isn't
+00005110: 2061 7661 696c 6162 6c65 2e0a 2020 2020   available..    
+00005120: 2222 220a 2020 2020 6966 2066 6c61 736b  """.    if flask
+00005130: 2e72 6571 7565 7374 2e72 6566 6572 7265  .request.referre
+00005140: 723a 0a20 2020 2020 2020 2023 2049 6620  r:.        # If 
+00005150: 7765 206b 6e6f 7720 7768 6572 6520 796f  we know where yo
+00005160: 7520 6361 6d65 2066 726f 6d2c 2073 656e  u came from, sen
+00005170: 6420 796f 7520 6261 636b 2074 6865 7265  d you back there
+00005180: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00005190: 666c 6173 6b2e 7265 6469 7265 6374 2866  flask.redirect(f
+000051a0: 6c61 736b 2e72 6571 7565 7374 2e72 6566  lask.request.ref
+000051b0: 6572 7265 7229 0a20 2020 2065 6c73 653a  errer).    else:
+000051c0: 0a20 2020 2020 2020 2023 204f 7468 6572  .        # Other
+000051d0: 7769 7365 2062 6163 6b20 746f 2074 6865  wise back to the
+000051e0: 2064 6173 6862 6f61 7264 0a20 2020 2020   dashboard.     
+000051f0: 2020 2072 6574 7572 6e20 666c 6173 6b2e     return flask.
+00005200: 7265 6469 7265 6374 280a 2020 2020 2020  redirect(.      
+00005210: 2020 2020 2020 666c 6173 6b2e 7572 6c5f        flask.url_
+00005220: 666f 7228 2772 6f75 7465 5f64 6173 6827  for('route_dash'
+00005230: 2c20 636f 7572 7365 3d63 6f75 7273 652c  , course=course,
+00005240: 2073 656d 6573 7465 723d 7365 6d65 7374   semester=semest
+00005250: 6572 290a 2020 2020 2020 2020 290a 0a0a  er).        )...
+00005260: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
+00005270: 2d2d 230a 2320 526f 7574 6520 6675 6e63  --#.# Route func
+00005280: 7469 6f6e 7320 230a 232d 2d2d 2d2d 2d2d  tions #.#-------
+00005290: 2d2d 2d2d 2d2d 2d2d 2d2d 230a 0a40 6170  ----------#..@ap
+000052a0: 702e 726f 7574 6528 272f 2729 0a64 6566  p.route('/').def
+000052b0: 2072 6f75 7465 5f69 6e64 6578 2829 3a0a   route_index():.
+000052c0: 2020 2020 2222 220a 2020 2020 4368 6563      """.    Chec
+000052d0: 6b73 2061 7574 6865 6e74 6963 6174 696f  ks authenticatio
+000052e0: 6e20 616e 6420 7265 6469 7265 6374 7320  n and redirects 
+000052f0: 746f 206c 6f67 696e 2070 6167 6520 6f72  to login page or
+00005300: 2074 6f20 6461 7368 626f 6172 642e 0a20   to dashboard.. 
+00005310: 2020 2022 2222 0a20 2020 2069 6620 4e4f     """.    if NO
+00005320: 4155 5448 206f 7220 6361 732e 7573 6572  AUTH or cas.user
+00005330: 6e61 6d65 3a0a 2020 2020 2020 2020 7265  name:.        re
+00005340: 7475 726e 2066 6c61 736b 2e72 6564 6972  turn flask.redir
+00005350: 6563 7428 666c 6173 6b2e 7572 6c5f 666f  ect(flask.url_fo
+00005360: 7228 2772 6f75 7465 5f64 6566 6175 6c74  r('route_default
+00005370: 5f64 6173 6827 2929 0a20 2020 2065 6c73  _dash')).    els
+00005380: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
+00005390: 6e20 666c 6173 6b2e 7265 6469 7265 6374  n flask.redirect
+000053a0: 2866 6c61 736b 2e75 726c 5f66 6f72 2827  (flask.url_for('
+000053b0: 6361 732e 6c6f 6769 6e27 2929 0a0a 0a40  cas.login'))...@
+000053c0: 6170 702e 726f 7574 6528 272f 6461 7368  app.route('/dash
+000053d0: 626f 6172 6427 290a 4066 6c61 736b 5f63  board').@flask_c
+000053e0: 6173 2e6c 6f67 696e 5f72 6571 7569 7265  as.login_require
+000053f0: 640a 6465 6620 726f 7574 655f 6465 6661  d.def route_defa
+00005400: 756c 745f 6461 7368 2829 3a0a 2020 2020  ult_dash():.    
+00005410: 2222 220a 2020 2020 5265 6469 7265 6374  """.    Redirect
+00005420: 7320 746f 2064 6173 6862 6f61 7264 2077  s to dashboard w
+00005430: 2f20 6465 6661 756c 7420 636c 6173 732f  / default class/
+00005440: 7365 6d65 7374 6572 2e0a 2020 2020 2222  semester..    ""
+00005450: 220a 2020 2020 7265 7475 726e 2066 6c61  ".    return fla
+00005460: 736b 2e72 6564 6972 6563 7428 0a20 2020  sk.redirect(.   
+00005470: 2020 2020 2066 6c61 736b 2e75 726c 5f66       flask.url_f
+00005480: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00005490: 2772 6f75 7465 5f64 6173 6827 2c0a 2020  'route_dash',.  
+000054a0: 2020 2020 2020 2020 2020 636f 7572 7365            course
+000054b0: 3d61 7070 2e63 6f6e 6669 672e 6765 7428  =app.config.get(
+000054c0: 2244 4546 4155 4c54 5f43 4f55 5253 4522  "DEFAULT_COURSE"
+000054d0: 2c20 2275 6e6b 6e6f 776e 2229 2c0a 2020  , "unknown"),.  
+000054e0: 2020 2020 2020 2020 2020 7365 6d65 7374            semest
+000054f0: 6572 3d61 7070 2e63 6f6e 6669 672e 6765  er=app.config.ge
+00005500: 7428 2244 4546 4155 4c54 5f53 454d 4553  t("DEFAULT_SEMES
+00005510: 5445 5222 2c20 2275 6e6b 6e6f 776e 2229  TER", "unknown")
+00005520: 0a20 2020 2020 2020 2029 0a20 2020 2029  .        ).    )
+00005530: 0a0a 0a40 6170 702e 726f 7574 6528 272f  ...@app.route('/
+00005540: 3c63 6f75 7273 653e 2f3c 7365 6d65 7374  <course>/<semest
+00005550: 6572 3e2f 6461 7368 626f 6172 6427 290a  er>/dashboard').
+00005560: 4066 6c61 736b 5f63 6173 2e6c 6f67 696e  @flask_cas.login
+00005570: 5f72 6571 7569 7265 640a 4061 7567 6d65  _required.@augme
+00005580: 6e74 5f61 7267 756d 656e 7473 0a64 6566  nt_arguments.def
+00005590: 2072 6f75 7465 5f64 6173 6828 0a20 2020   route_dash(.   
+000055a0: 2063 6f75 7273 652c 0a20 2020 2073 656d   course,.    sem
+000055b0: 6573 7465 722c 0a20 2020 2023 2041 7567  ester,.    # Aug
+000055c0: 6d65 6e74 6564 2061 7267 756d 656e 7473  mented arguments
+000055d0: 0a20 2020 2075 7365 726e 616d 652c 0a20  .    username,. 
+000055e0: 2020 2069 735f 6164 6d69 6e2c 0a20 2020     is_admin,.   
+000055f0: 206d 6173 7175 6572 6164 655f 6173 2c0a   masquerade_as,.
+00005600: 2020 2020 6566 6665 6374 6976 655f 7573      effective_us
+00005610: 6572 2c0a 2020 2020 7461 736b 5f69 6e66  er,.    task_inf
+00005620: 6f0a 293a 0a20 2020 2022 2222 0a20 2020  o.):.    """.   
+00005630: 2044 6973 706c 6179 7320 6461 7368 626f   Displays dashbo
+00005640: 6172 6420 772f 206c 696e 6b73 2066 6f72  ard w/ links for
+00005650: 2073 7562 6d69 7474 696e 6720 6561 6368   submitting each
+00005660: 2070 7365 742f 7461 736b 2026 2073 756d   pset/task & sum
+00005670: 6d61 7279 0a20 2020 2069 6e66 6f72 6d61  mary.    informa
+00005680: 7469 6f6e 206f 6620 7461 736b 2067 7261  tion of task gra
+00005690: 6465 732e 2041 6c73 6f20 696e 636c 7564  des. Also includ
+000056a0: 6573 2069 6e66 6f20 6f6e 2073 7562 6d69  es info on submi
+000056b0: 7474 6564 0a20 2020 2065 7865 7263 6973  tted.    exercis
+000056c0: 6573 2e0a 2020 2020 2222 220a 0a20 2020  es..    """..   
+000056d0: 2023 2041 6464 2070 7365 7420 7374 6174   # Add pset stat
+000056e0: 7573 2061 6e64 2074 6173 6b20 6665 6564  us and task feed
+000056f0: 6261 636b 2073 756d 6d61 7269 6573 2074  back summaries t
+00005700: 6f20 7461 736b 2069 6e66 6f0a 2020 2020  o task info.    
+00005710: 616d 656e 645f 7461 736b 5f69 6e66 6f28  amend_task_info(
+00005720: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
+00005730: 2c20 7461 736b 5f69 6e66 6f2c 2065 6666  , task_info, eff
+00005740: 6563 7469 7665 5f75 7365 7229 0a0a 2020  ective_user)..  
+00005750: 2020 2320 4765 7420 636f 6e63 6570 7473    # Get concepts
+00005760: 2069 6e66 6f0a 2020 2020 636f 6e63 6570   info.    concep
+00005770: 7473 203d 2073 746f 7261 6765 2e67 6574  ts = storage.get
+00005780: 5f63 6f6e 6365 7074 7328 636f 7572 7365  _concepts(course
+00005790: 2c20 7365 6d65 7374 6572 290a 2020 2020  , semester).    
+000057a0: 6966 2063 6f6e 6365 7074 7320 6973 204e  if concepts is N
+000057b0: 6f6e 653a 0a20 2020 2020 2020 2066 6c61  one:.        fla
+000057c0: 736b 2e66 6c61 7368 2822 5761 726e 696e  sk.flash("Warnin
+000057d0: 673a 2063 6f6e 6365 7074 7320 6e6f 7420  g: concepts not 
+000057e0: 7370 6563 6966 6965 642f 6176 6169 6c61  specified/availa
+000057f0: 626c 652e 2229 0a20 2020 2020 2020 2063  ble.").        c
+00005800: 6f6e 6365 7074 7320 3d20 5b5d 0a0a 2020  oncepts = []..  
+00005810: 2020 2320 4772 6162 206c 6174 6573 742d    # Grab latest-
+00005820: 6f75 7463 6f6d 6573 2069 6e66 6f20 666f  outcomes info fo
+00005830: 7220 6578 6572 6369 7365 730a 2020 2020  r exercises.    
+00005840: 6f75 7463 6f6d 6573 203d 2073 746f 7261  outcomes = stora
+00005850: 6765 2e66 6574 6368 5f62 6573 745f 6f75  ge.fetch_best_ou
+00005860: 7463 6f6d 6573 2863 6f75 7273 652c 2073  tcomes(course, s
+00005870: 656d 6573 7465 722c 2065 6666 6563 7469  emester, effecti
+00005880: 7665 5f75 7365 7229 0a0a 2020 2020 2320  ve_user)..    # 
+00005890: 416d 656e 6420 6578 6572 6369 7365 2073  Amend exercise s
+000058a0: 7461 7475 7365 730a 2020 2020 616d 656e  tatuses.    amen
+000058b0: 645f 6578 6572 6369 7365 7328 636f 7572  d_exercises(cour
+000058c0: 7365 2c20 7365 6d65 7374 6572 2c20 7461  se, semester, ta
+000058d0: 736b 5f69 6e66 6f2c 206f 7574 636f 6d65  sk_info, outcome
+000058e0: 732c 2065 6666 6563 7469 7665 5f75 7365  s, effective_use
+000058f0: 7229 0a0a 2020 2020 2320 4175 676d 656e  r)..    # Augmen
+00005900: 7420 7468 6520 636f 6e63 6570 7473 2073  t the concepts s
+00005910: 7472 7563 7475 7265 2074 6f20 696e 636c  tructure to incl
+00005920: 7564 6520 7265 616c 206f 626a 6563 740a  ude real object.
+00005930: 2020 2020 2320 7265 6665 7265 6e63 6573      # references
+00005940: 0a20 2020 2061 7567 6d65 6e74 5f63 6f6e  .    augment_con
+00005950: 6365 7074 7328 636f 6e63 6570 7473 290a  cepts(concepts).
+00005960: 0a20 2020 2023 2055 7064 6174 6520 636f  .    # Update co
+00005970: 6e63 6570 7473 206c 6973 7420 7769 7468  ncepts list with
+00005980: 2073 7461 7475 7365 7320 6261 7365 6420   statuses based 
+00005990: 6f6e 2065 7865 7263 6973 6520 6f75 7463  on exercise outc
+000059a0: 6f6d 6573 0a20 2020 2023 2061 6e64 2061  omes.    # and a
+000059b0: 6d65 6e64 6564 2074 6173 6b20 696e 666f  mended task info
+000059c0: 2e0a 2020 2020 7365 745f 636f 6e63 6570  ..    set_concep
+000059d0: 745f 7374 6174 7573 6573 2863 6f6e 6365  t_statuses(conce
+000059e0: 7074 732c 2074 6173 6b5f 696e 666f 2c20  pts, task_info, 
+000059f0: 6f75 7463 6f6d 6573 290a 0a20 2020 2023  outcomes)..    #
+00005a00: 2052 656e 6465 7220 6461 7368 626f 6172   Render dashboar
+00005a10: 6420 7465 6d70 6c61 7465 0a20 2020 2072  d template.    r
+00005a20: 6574 7572 6e20 666c 6173 6b2e 7265 6e64  eturn flask.rend
+00005a30: 6572 5f74 656d 706c 6174 6528 0a20 2020  er_template(.   
+00005a40: 2020 2020 2027 6461 7368 626f 6172 642e       'dashboard.
+00005a50: 6a32 272c 0a20 2020 2020 2020 2063 6f75  j2',.        cou
+00005a60: 7273 655f 6e61 6d65 3d61 7070 2e63 6f6e  rse_name=app.con
+00005a70: 6669 672e 6765 7428 2243 4f55 5253 455f  fig.get("COURSE_
+00005a80: 4e41 4d45 5322 2c20 7b7d 292e 6765 7428  NAMES", {}).get(
+00005a90: 636f 7572 7365 2c20 636f 7572 7365 292c  course, course),
+00005aa0: 0a20 2020 2020 2020 2063 6f75 7273 653d  .        course=
+00005ab0: 636f 7572 7365 2c0a 2020 2020 2020 2020  course,.        
+00005ac0: 7365 6d65 7374 6572 3d73 656d 6573 7465  semester=semeste
+00005ad0: 722c 0a20 2020 2020 2020 2075 7365 726e  r,.        usern
+00005ae0: 616d 653d 7573 6572 6e61 6d65 2c0a 2020  ame=username,.  
+00005af0: 2020 2020 2020 6973 5f61 646d 696e 3d69        is_admin=i
+00005b00: 735f 6164 6d69 6e2c 0a20 2020 2020 2020  s_admin,.       
+00005b10: 206d 6173 7175 6572 6164 655f 6173 3d6d   masquerade_as=m
+00005b20: 6173 7175 6572 6164 655f 6173 2c0a 2020  asquerade_as,.  
+00005b30: 2020 2020 2020 6566 6665 6374 6976 655f        effective_
+00005b40: 7573 6572 3d65 6666 6563 7469 7665 5f75  user=effective_u
+00005b50: 7365 722c 0a20 2020 2020 2020 2074 6173  ser,.        tas
+00005b60: 6b5f 696e 666f 3d74 6173 6b5f 696e 666f  k_info=task_info
+00005b70: 2c0a 2020 2020 2020 2020 6f75 7463 6f6d  ,.        outcom
+00005b80: 6573 3d6f 7574 636f 6d65 732c 2023 2054  es=outcomes, # T
+00005b90: 4f44 4f3a 2055 5345 2054 4849 530a 2020  ODO: USE THIS.  
+00005ba0: 2020 2020 2020 636f 6e63 6570 7473 3d63        concepts=c
+00005bb0: 6f6e 6365 7074 7320 2320 544f 444f 3a20  oncepts # TODO: 
+00005bc0: 5553 4520 5448 4953 0a20 2020 2029 0a0a  USE THIS.    )..
+00005bd0: 0a40 6170 702e 726f 7574 6528 0a20 2020  .@app.route(.   
+00005be0: 2027 2f3c 636f 7572 7365 3e2f 3c73 656d   '/<course>/<sem
+00005bf0: 6573 7465 723e 2f66 6565 6462 6163 6b2f  ester>/feedback/
+00005c00: 3c74 6172 6765 745f 7573 6572 3e2f 3c70  <target_user>/<p
+00005c10: 6861 7365 3e2f 3c70 7369 643e 2f3c 7461  hase>/<psid>/<ta
+00005c20: 736b 6964 3e27 0a29 0a40 666c 6173 6b5f  skid>'.).@flask_
+00005c30: 6361 732e 6c6f 6769 6e5f 7265 7175 6972  cas.login_requir
+00005c40: 6564 0a40 6175 676d 656e 745f 6172 6775  ed.@augment_argu
+00005c50: 6d65 6e74 730a 6465 6620 726f 7574 655f  ments.def route_
+00005c60: 6665 6564 6261 636b 280a 2020 2020 636f  feedback(.    co
+00005c70: 7572 7365 2c0a 2020 2020 7365 6d65 7374  urse,.    semest
+00005c80: 6572 2c0a 2020 2020 7461 7267 6574 5f75  er,.    target_u
+00005c90: 7365 722c 0a20 2020 2070 6861 7365 2c0a  ser,.    phase,.
+00005ca0: 2020 2020 7073 6964 2c0a 2020 2020 7461      psid,.    ta
+00005cb0: 736b 6964 2c0a 2020 2020 2320 4175 676d  skid,.    # Augm
+00005cc0: 656e 7465 6420 6172 6775 6d65 6e74 730a  ented arguments.
+00005cd0: 2020 2020 7573 6572 6e61 6d65 2c0a 2020      username,.  
+00005ce0: 2020 6973 5f61 646d 696e 2c0a 2020 2020    is_admin,.    
+00005cf0: 6d61 7371 7565 7261 6465 5f61 732c 0a20  masquerade_as,. 
+00005d00: 2020 2065 6666 6563 7469 7665 5f75 7365     effective_use
+00005d10: 722c 0a20 2020 2074 6173 6b5f 696e 666f  r,.    task_info
+00005d20: 0a29 3a0a 2020 2020 2222 220a 2020 2020  .):.    """.    
+00005d30: 4469 7370 6c61 7973 2066 6565 6462 6163  Displays feedbac
+00005d40: 6b20 6f6e 2061 2070 6172 7469 6375 6c61  k on a particula
+00005d50: 7220 7461 736b 206f 6620 6120 7061 7274  r task of a part
+00005d60: 6963 756c 6172 2070 726f 626c 656d 2073  icular problem s
+00005d70: 6574 2c0a 2020 2020 666f 7220 6569 7468  et,.    for eith
+00005d80: 6572 2074 6865 2027 696e 6974 6961 6c27  er the 'initial'
+00005d90: 206f 7220 2772 6576 6973 696f 6e27 2070   or 'revision' p
+00005da0: 6861 7365 2e0a 2020 2020 2222 220a 2020  hase..    """.  
+00005db0: 2020 6966 2074 6172 6765 745f 7573 6572    if target_user
+00005dc0: 2021 3d20 6566 6665 6374 6976 655f 7573   != effective_us
+00005dd0: 6572 2061 6e64 206e 6f74 2069 735f 6164  er and not is_ad
+00005de0: 6d69 6e3a 0a20 2020 2020 2020 2072 6574  min:.        ret
+00005df0: 7572 6e20 6572 726f 725f 7265 7370 6f6e  urn error_respon
+00005e00: 7365 280a 2020 2020 2020 2020 2020 2020  se(.            
+00005e10: 636f 7572 7365 2c0a 2020 2020 2020 2020  course,.        
+00005e20: 2020 2020 7365 6d65 7374 6572 2c0a 2020      semester,.  
+00005e30: 2020 2020 2020 2020 2020 7573 6572 6e61            userna
+00005e40: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00005e50: 2259 6f75 2061 7265 206e 6f74 2061 6c6c  "You are not all
+00005e60: 6f77 6564 2074 6f20 7669 6577 2066 6565  owed to view fee
+00005e70: 6462 6163 6b20 666f 7220 7b7d 2e22 2e66  dback for {}.".f
+00005e80: 6f72 6d61 7428 7461 7267 6574 5f75 7365  ormat(target_use
+00005e90: 7229 0a20 2020 2020 2020 2029 0a20 2020  r).        ).   
+00005ea0: 2065 6c69 6620 7461 7267 6574 5f75 7365   elif target_use
+00005eb0: 7220 213d 2065 6666 6563 7469 7665 5f75  r != effective_u
+00005ec0: 7365 723a 0a20 2020 2020 2020 2066 6c61  ser:.        fla
+00005ed0: 736b 2e66 6c61 7368 2822 5669 6577 696e  sk.flash("Viewin
+00005ee0: 6720 6665 6564 6261 636b 2066 6f72 207b  g feedback for {
+00005ef0: 7d2e 222e 666f 726d 6174 2874 6172 6765  }.".format(targe
+00005f00: 745f 7573 6572 2929 0a0a 2020 2020 2320  t_user))..    # 
+00005f10: 4672 6f6d 2068 6572 6520 6f6e 2077 6520  From here on we 
+00005f20: 7472 6561 7420 7468 6520 6566 6665 6374  treat the effect
+00005f30: 6976 6520 7573 6572 2061 7320 7468 6520  ive user as the 
+00005f40: 7461 7267 6574 2075 7365 720a 2020 2020  target user.    
+00005f50: 6566 6665 6374 6976 655f 7573 6572 203d  effective_user =
+00005f60: 2074 6172 6765 745f 7573 6572 0a0a 2020   target_user..  
+00005f70: 2020 2320 4368 6563 6b20 726f 7374 6572    # Check roster
+00005f80: 2061 6e64 2066 6c61 7368 2061 2077 6172   and flash a war
+00005f90: 6e69 6e67 2069 6620 7765 2772 6520 7669  ning if we're vi
+00005fa0: 6577 696e 6720 6665 6564 6261 636b 2066  ewing feedback f
+00005fb0: 6f72 2061 0a20 2020 2023 2075 7365 7220  or a.    # user 
+00005fc0: 7768 6f20 6973 206e 6f74 206f 6e20 7468  who is not on th
+00005fd0: 6520 726f 7374 6572 2e2e 2e0a 2020 2020  e roster....    
+00005fe0: 7472 793a 0a20 2020 2020 2020 2072 6f73  try:.        ros
+00005ff0: 7465 7220 3d20 7374 6f72 6167 652e 6765  ter = storage.ge
+00006000: 745f 726f 7374 6572 2863 6f75 7273 652c  t_roster(course,
+00006010: 2073 656d 6573 7465 7229 0a20 2020 2065   semester).    e
+00006020: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00006030: 6173 2065 3a0a 2020 2020 2020 2020 666c  as e:.        fl
+00006040: 6173 6b2e 666c 6173 6828 7374 7228 6529  ask.flash(str(e)
+00006050: 290a 2020 2020 2020 2020 726f 7374 6572  ).        roster
+00006060: 203d 204e 6f6e 650a 0a20 2020 2069 6620   = None..    if 
+00006070: 726f 7374 6572 2069 7320 4e6f 6e65 3a0a  roster is None:.
+00006080: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
+00006090: 6173 6828 0a20 2020 2020 2020 2020 2020  ash(.           
+000060a0: 2022 5761 726e 696e 673a 2063 6f75 6c64   "Warning: could
+000060b0: 206e 6f74 2066 6574 6368 2072 6f73 7465   not fetch roste
+000060c0: 7220 746f 2063 6865 636b 2069 6620 7468  r to check if th
+000060d0: 6973 2075 7365 7220 6973 206f 6e22 0a20  is user is on". 
+000060e0: 2020 2020 2020 2020 2020 2022 2069 742e             " it.
+000060f0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+00006100: 656c 6966 2065 6666 6563 7469 7665 5f75  elif effective_u
+00006110: 7365 7220 6e6f 7420 696e 2072 6f73 7465  ser not in roste
+00006120: 723a 0a20 2020 2020 2020 2066 6c61 736b  r:.        flask
+00006130: 2e66 6c61 7368 2822 5761 726e 696e 673a  .flash("Warning:
+00006140: 2074 6869 7320 7573 6572 2069 7320 6e6f   this user is no
+00006150: 7420 6f6e 2074 6865 2072 6f73 7465 7221  t on the roster!
+00006160: 2229 0a0a 2020 2020 2320 4765 7420 6675  ")..    # Get fu
+00006170: 6c6c 2066 6565 6462 6163 6b2d 7265 6164  ll feedback-read
+00006180: 7920 7073 6574 2061 6e64 2074 6173 6b20  y pset and task 
+00006190: 6f62 6a65 6374 730a 2020 2020 7073 5f61  objects.    ps_a
+000061a0: 6e64 5f74 6173 6b20 3d20 6765 745f 6665  nd_task = get_fe
+000061b0: 6564 6261 636b 5f70 735f 616e 645f 7461  edback_ps_and_ta
+000061c0: 736b 280a 2020 2020 2020 2020 7461 736b  sk(.        task
+000061d0: 5f69 6e66 6f2c 0a20 2020 2020 2020 2063  _info,.        c
+000061e0: 6f75 7273 652c 0a20 2020 2020 2020 2073  ourse,.        s
+000061f0: 656d 6573 7465 722c 0a20 2020 2020 2020  emester,.       
+00006200: 2074 6172 6765 745f 7573 6572 2c0a 2020   target_user,.  
+00006210: 2020 2020 2020 7068 6173 652c 0a20 2020        phase,.   
+00006220: 2020 2020 2070 7369 642c 0a20 2020 2020       psid,.     
+00006230: 2020 2074 6173 6b69 640a 2020 2020 290a     taskid.    ).
+00006240: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00006250: 6528 7073 5f61 6e64 5f74 6173 6b2c 2056  e(ps_and_task, V
+00006260: 616c 7565 4572 726f 7229 3a0a 2020 2020  alueError):.    
+00006270: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
+00006280: 7374 7228 7073 5f61 6e64 5f74 6173 6b29  str(ps_and_task)
+00006290: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000062a0: 2067 6f62 6163 6b28 636f 7572 7365 2c20   goback(course, 
+000062b0: 7365 6d65 7374 6572 290a 2020 2020 656c  semester).    el
+000062c0: 7365 3a0a 2020 2020 2020 2020 7073 2c20  se:.        ps, 
+000062d0: 7461 736b 203d 2070 735f 616e 645f 7461  task = ps_and_ta
+000062e0: 736b 0a0a 2020 2020 6966 2074 6173 6b5b  sk..    if task[
+000062f0: 2265 7661 6c5f 7374 6174 7573 225d 206e  "eval_status"] n
+00006300: 6f74 2069 6e20 280a 2020 2020 2020 2020  ot in (.        
+00006310: 4e6f 6e65 2c0a 2020 2020 2020 2020 2275  None,.        "u
+00006320: 6e6b 6e6f 776e 222c 0a20 2020 2020 2020  nknown",.       
+00006330: 2022 696e 6974 6961 6c22 2c0a 2020 2020   "initial",.    
+00006340: 2020 2020 2269 6e5f 7072 6f67 7265 7373      "in_progress
+00006350: 222c 0a20 2020 2020 2020 2022 6572 726f  ",.        "erro
+00006360: 7222 2c0a 2020 2020 2020 2020 2265 7870  r",.        "exp
+00006370: 6972 6564 222c 0a20 2020 2020 2020 2022  ired",.        "
+00006380: 636f 6d70 6c65 7465 6422 0a20 2020 2029  completed".    )
+00006390: 3a0a 2020 2020 2020 2020 6d73 6720 3d20  :.        msg = 
+000063a0: 2249 6e76 616c 6964 2065 7661 6c75 6174  "Invalid evaluat
+000063b0: 696f 6e20 7374 6174 7573 203c 636f 6465  ion status <code
+000063c0: 3e7b 7d3c 2f63 6f64 653e 2e22 2e66 6f72  >{}</code>.".for
+000063d0: 6d61 7428 0a20 2020 2020 2020 2020 2020  mat(.           
+000063e0: 2074 6173 6b5b 2265 7661 6c5f 7374 6174   task["eval_stat
+000063f0: 7573 225d 0a20 2020 2020 2020 2029 0a20  us"].        ). 
+00006400: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
+00006410: 7368 286d 7367 290a 2020 2020 2020 2020  sh(msg).        
+00006420: 7265 7475 726e 2065 7272 6f72 5f72 6573  return error_res
+00006430: 706f 6e73 6528 636f 7572 7365 2c20 7365  ponse(course, se
+00006440: 6d65 7374 6572 2c20 7573 6572 6e61 6d65  mester, username
+00006450: 2c20 6d73 6729 0a0a 2020 2020 2320 5365  , msg)..    # Se
+00006460: 7420 6175 746f 2d72 6566 7265 7368 2062  t auto-refresh b
+00006470: 6173 6564 206f 6e20 6576 616c 7561 7469  ased on evaluati
+00006480: 6f6e 2073 7461 7475 730a 2020 2020 6966  on status.    if
+00006490: 2074 6173 6b5b 2265 7661 6c5f 7374 6174   task["eval_stat
+000064a0: 7573 225d 2069 6e20 2822 756e 6b6e 6f77  us"] in ("unknow
+000064b0: 6e22 2c20 2269 6e5f 7072 6f67 7265 7373  n", "in_progress
+000064c0: 222c 2022 6572 726f 7222 293a 0a20 2020  ", "error"):.   
+000064d0: 2020 2020 2072 6566 7265 7368 203d 2032       refresh = 2
+000064e0: 300a 2020 2020 2020 2020 666c 6173 6b2e  0.        flask.
+000064f0: 666c 6173 6828 2222 225c 0a54 6869 7320  flash("""\.This 
+00006500: 7061 6765 2073 686f 756c 6420 7265 6672  page should refr
+00006510: 6573 6820 6974 7365 6c66 207b 7265 6672  esh itself {refr
+00006520: 6573 687d 2073 6563 6f6e 6473 2061 6674  esh} seconds aft
+00006530: 6572 206c 6f61 6469 6e67 0a3c 7370 616e  er loading.<span
+00006540: 0a20 726f 6c65 3d22 7469 6d65 7222 0a20  . role="timer". 
+00006550: 6172 6961 2d6c 6976 653d 226f 6666 220a  aria-live="off".
+00006560: 2063 6c61 7373 3d22 7469 6d65 7222 0a20   class="timer". 
+00006570: 6461 7461 2d74 696d 653d 227b 7265 6672  data-time="{refr
+00006580: 6573 687d 220a 3e0a 2020 7b72 6566 7265  esh}".>.  {refre
+00006590: 7368 7d0a 3c2f 7370 616e 3e2e 2222 222e  sh}.</span>.""".
+000065a0: 666f 726d 6174 2872 6566 7265 7368 3d72  format(refresh=r
+000065b0: 6566 7265 7368 2929 0a20 2020 2065 6c73  efresh)).    els
+000065c0: 653a 0a20 2020 2020 2020 2072 6566 7265  e:.        refre
+000065d0: 7368 203d 204e 6f6e 650a 0a20 2020 2072  sh = None..    r
+000065e0: 6574 7572 6e20 666c 6173 6b2e 7265 6e64  eturn flask.rend
+000065f0: 6572 5f74 656d 706c 6174 6528 0a20 2020  er_template(.   
+00006600: 2020 2020 2027 6665 6564 6261 636b 2e6a       'feedback.j
+00006610: 3227 2c0a 2020 2020 2020 2020 636f 7572  2',.        cour
+00006620: 7365 5f6e 616d 653d 6170 702e 636f 6e66  se_name=app.conf
+00006630: 6967 2e67 6574 2822 434f 5552 5345 5f4e  ig.get("COURSE_N
+00006640: 414d 4553 222c 207b 7d29 2e67 6574 2863  AMES", {}).get(c
+00006650: 6f75 7273 652c 2063 6f75 7273 6529 2c0a  ourse, course),.
+00006660: 2020 2020 2020 2020 636f 7572 7365 3d63          course=c
+00006670: 6f75 7273 652c 0a20 2020 2020 2020 2073  ourse,.        s
+00006680: 656d 6573 7465 723d 7365 6d65 7374 6572  emester=semester
+00006690: 2c0a 2020 2020 2020 2020 7573 6572 6e61  ,.        userna
+000066a0: 6d65 3d75 7365 726e 616d 652c 0a20 2020  me=username,.   
+000066b0: 2020 2020 2069 735f 6164 6d69 6e3d 6973       is_admin=is
+000066c0: 5f61 646d 696e 2c0a 2020 2020 2020 2020  _admin,.        
+000066d0: 6d61 7371 7565 7261 6465 5f61 733d 6d61  masquerade_as=ma
+000066e0: 7371 7565 7261 6465 5f61 732c 0a20 2020  squerade_as,.   
+000066f0: 2020 2020 2065 6666 6563 7469 7665 5f75       effective_u
+00006700: 7365 723d 6566 6665 6374 6976 655f 7573  ser=effective_us
+00006710: 6572 2c0a 2020 2020 2020 2020 7461 7267  er,.        targ
+00006720: 6574 5f75 7365 723d 7461 7267 6574 5f75  et_user=target_u
+00006730: 7365 722c 0a20 2020 2020 2020 2070 6861  ser,.        pha
+00006740: 7365 3d70 6861 7365 2c0a 2020 2020 2020  se=phase,.      
+00006750: 2020 7073 3d70 732c 0a20 2020 2020 2020    ps=ps,.       
+00006760: 2074 6173 6b3d 7461 736b 2c0a 2020 2020   task=task,.    
+00006770: 2020 2020 7461 736b 5f69 6e66 6f3d 7461      task_info=ta
+00006780: 736b 5f69 6e66 6f2c 0a20 2020 2020 2020  sk_info,.       
+00006790: 2066 625f 6373 733d 706f 746c 7563 6b2e   fb_css=potluck.
+000067a0: 7265 6e64 6572 2e67 6574 5f63 7373 2829  render.get_css()
+000067b0: 2c0a 2020 2020 2020 2020 6662 5f6a 733d  ,.        fb_js=
+000067c0: 706f 746c 7563 6b2e 7265 6e64 6572 2e67  potluck.render.g
+000067d0: 6574 5f6a 7328 292c 0a20 2020 2020 2020  et_js(),.       
+000067e0: 2073 7570 706f 7274 5f6c 696e 6b3d 6170   support_link=ap
+000067f0: 702e 636f 6e66 6967 5b22 5355 5050 4f52  p.config["SUPPOR
+00006800: 545f 4c49 4e4b 225d 2c0a 2020 2020 2020  T_LINK"],.      
+00006810: 2020 7265 6672 6573 683d 7265 6672 6573    refresh=refres
+00006820: 680a 2020 2020 290a 0a0a 4061 7070 2e72  h.    )...@app.r
+00006830: 6f75 7465 280a 2020 2020 272f 3c63 6f75  oute(.    '/<cou
+00006840: 7273 653e 2f3c 7365 6d65 7374 6572 3e2f  rse>/<semester>/
+00006850: 7375 626d 6974 2f3c 7073 6964 3e2f 3c74  submit/<psid>/<t
+00006860: 6173 6b69 643e 272c 0a20 2020 206d 6574  askid>',.    met
+00006870: 686f 6473 3d5b 2750 4f53 5427 5d0a 290a  hods=['POST'].).
+00006880: 4066 6c61 736b 5f63 6173 2e6c 6f67 696e  @flask_cas.login
+00006890: 5f72 6571 7569 7265 640a 4061 7567 6d65  _required.@augme
+000068a0: 6e74 5f61 7267 756d 656e 7473 0a64 6566  nt_arguments.def
+000068b0: 2072 6f75 7465 5f73 7562 6d69 7428 0a20   route_submit(. 
+000068c0: 2020 2063 6f75 7273 652c 0a20 2020 2073     course,.    s
+000068d0: 656d 6573 7465 722c 0a20 2020 2070 7369  emester,.    psi
+000068e0: 642c 0a20 2020 2074 6173 6b69 642c 0a20  d,.    taskid,. 
+000068f0: 2020 2023 2041 7567 6d65 6e74 6564 2061     # Augmented a
+00006900: 7267 756d 656e 7473 0a20 2020 2075 7365  rguments.    use
+00006910: 726e 616d 652c 0a20 2020 2069 735f 6164  rname,.    is_ad
+00006920: 6d69 6e2c 0a20 2020 206d 6173 7175 6572  min,.    masquer
+00006930: 6164 655f 6173 2c0a 2020 2020 6566 6665  ade_as,.    effe
+00006940: 6374 6976 655f 7573 6572 2c0a 2020 2020  ctive_user,.    
+00006950: 7461 736b 5f69 6e66 6f0a 293a 0a20 2020  task_info.):.   
+00006960: 2022 2222 0a20 2020 2041 6363 6570 7473   """.    Accepts
+00006970: 2061 2066 696c 6520 7375 626d 6973 7369   a file submissi
+00006980: 6f6e 2066 6f72 2061 2074 6173 6b20 616e  on for a task an
+00006990: 6420 696e 6974 6961 7465 7320 616e 2065  d initiates an e
+000069a0: 7661 6c75 6174 696f 6e0a 2020 2020 7072  valuation.    pr
+000069b0: 6f63 6573 7320 666f 7220 7468 6174 2066  ocess for that f
+000069c0: 696c 652e 2046 6967 7572 6573 206f 7574  ile. Figures out
+000069d0: 2073 7562 6d69 7373 696f 6e20 7068 6173   submission phas
+000069e0: 6520 6175 746f 6d61 7469 6361 6c6c 790a  e automatically.
+000069f0: 2020 2020 6261 7365 6420 6f6e 2074 6173      based on tas
+00006a00: 6b20 696e 666f 2c20 616e 6420 6173 7375  k info, and assu
+00006a10: 6d65 7320 7468 6174 2074 6865 2073 7562  mes that the sub
+00006a20: 6d69 7373 696f 6e20 6265 6c6f 6e67 7320  mission belongs 
+00006a30: 746f 2074 6865 0a20 2020 2061 7574 6865  to the.    authe
+00006a40: 6e74 6963 6174 6564 2075 7365 722e 2048  nticated user. H
+00006a50: 6f77 6576 6572 2c20 6966 2074 6865 2061  owever, if the a
+00006a60: 7574 6865 6e74 6963 6174 6564 2075 7365  uthenticated use
+00006a70: 7220 6973 2061 6e20 6164 6d69 6e2c 0a20  r is an admin,. 
+00006a80: 2020 2074 6865 2022 7068 6173 6522 2061     the "phase" a
+00006a90: 6e64 2022 7461 7267 6574 5f75 7365 7222  nd "target_user"
+00006aa0: 2066 6f72 6d20 7661 6c75 6573 2063 616e   form values can
+00006ab0: 206f 7665 7272 6964 6520 7468 6573 650a   override these.
+00006ac0: 2020 2020 6173 7375 6d70 7469 6f6e 732e      assumptions.
+00006ad0: 2052 6564 6972 6563 7473 2074 6f20 7468   Redirects to th
+00006ae0: 6520 6665 6564 6261 636b 2070 6167 6520  e feedback page 
+00006af0: 666f 7220 7468 6520 7375 626d 6974 7465  for the submitte
+00006b00: 6420 7461 736b 2c0a 2020 2020 6f72 2074  d task,.    or t
+00006b10: 6f20 7468 6520 6576 616c 7561 7469 6f6e  o the evaluation
+00006b20: 2070 6167 6520 6966 2074 6865 2075 7365   page if the use
+00006b30: 7220 6973 2061 6e20 6164 6d69 6e20 616e  r is an admin an
+00006b40: 6420 6973 206e 6f74 2074 6865 0a20 2020  d is not the.   
+00006b50: 2074 6172 6765 7420 7573 6572 2e0a 0a20   target user... 
+00006b60: 2020 204e 6f74 653a 2074 6865 7265 2061     Note: there a
+00006b70: 7265 2070 726f 6261 626c 7920 736f 6d65  re probably some
+00006b80: 206e 6173 7479 2072 6163 6520 636f 6e64   nasty race cond
+00006b90: 6974 696f 6e73 2069 6620 7468 6520 7361  itions if the sa
+00006ba0: 6d65 2075 7365 720a 2020 2020 7375 626d  me user.    subm
+00006bb0: 6974 7320 7468 6520 7361 6d65 2074 6173  its the same tas
+00006bc0: 6b20 7369 6d75 6c74 616e 656f 7573 6c79  k simultaneously
+00006bd0: 2076 6961 206d 756c 7469 706c 6520 7265   via multiple re
+00006be0: 7175 6573 7473 2e20 5765 2073 696d 706c  quests. We simpl
+00006bf0: 790a 2020 2020 686f 7065 2074 6861 7420  y.    hope that 
+00006c00: 7468 6174 2064 6f65 7320 6e6f 7420 6861  that does not ha
+00006c10: 7070 656e 2e0a 2020 2020 2222 220a 2020  ppen..    """.  
+00006c20: 2020 7472 793a 0a20 2020 2020 2020 2070    try:.        p
+00006c30: 7320 3d20 6765 745f 7073 5f6f 626a 2874  s = get_ps_obj(t
+00006c40: 6173 6b5f 696e 666f 2c20 7073 6964 290a  ask_info, psid).
+00006c50: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
+00006c60: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+00006c70: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
+00006c80: 7374 7228 6529 290a 2020 2020 2020 2020  str(e)).        
+00006c90: 7265 7475 726e 2067 6f62 6163 6b28 636f  return goback(co
+00006ca0: 7572 7365 2c20 7365 6d65 7374 6572 290a  urse, semester).
+00006cb0: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+00006cc0: 2020 7461 736b 203d 2067 6574 5f74 6173    task = get_tas
+00006cd0: 6b5f 6f62 6a28 7461 736b 5f69 6e66 6f2c  k_obj(task_info,
+00006ce0: 2070 732c 2074 6173 6b69 6429 0a20 2020   ps, taskid).   
+00006cf0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+00006d00: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+00006d10: 2066 6c61 736b 2e66 6c61 7368 2873 7472   flask.flash(str
+00006d20: 2865 2929 0a20 2020 2020 2020 2072 6574  (e)).        ret
+00006d30: 7572 6e20 676f 6261 636b 2863 6f75 7273  urn goback(cours
+00006d40: 652c 2073 656d 6573 7465 7229 0a0a 2020  e, semester)..  
+00006d50: 2020 2320 4164 6420 7374 6174 7573 2026    # Add status &
+00006d60: 2074 696d 6520 7265 6d61 696e 696e 6720   time remaining 
+00006d70: 696e 666f 2074 6f20 7073 6574 0a20 2020  info to pset.   
+00006d80: 2061 6d65 6e64 5f70 7365 7428 636f 7572   amend_pset(cour
+00006d90: 7365 2c20 7365 6d65 7374 6572 2c20 7461  se, semester, ta
+00006da0: 736b 5f69 6e66 6f2c 2070 732c 2065 6666  sk_info, ps, eff
+00006db0: 6563 7469 7665 5f75 7365 7229 0a0a 2020  ective_user)..  
+00006dc0: 2020 2320 4368 6563 6b20 666f 7220 7068    # Check for ph
+00006dd0: 6173 6520 616e 642f 6f72 2074 6172 6765  ase and/or targe
+00006de0: 745f 7573 6572 206f 7665 7272 6964 6573  t_user overrides
+00006df0: 2069 6e20 7468 6520 666f 726d 2064 6174   in the form dat
+00006e00: 6120 6966 0a20 2020 2023 2074 6865 2061  a if.    # the a
+00006e10: 7574 6865 6e74 6963 6174 6564 2075 7365  uthenticated use
+00006e20: 7220 6973 2061 6e20 6164 6d69 6e0a 2020  r is an admin.  
+00006e30: 2020 7461 7267 6574 5f75 7365 7220 3d20    target_user = 
+00006e40: 6566 6665 6374 6976 655f 7573 6572 0a20  effective_user. 
+00006e50: 2020 2070 6861 7365 203d 204e 6f6e 650a     phase = None.
+00006e60: 2020 2020 6465 7374 696e 6174 696f 6e5f      destination_
+00006e70: 726f 7574 6520 3d20 2772 6f75 7465 5f66  route = 'route_f
+00006e80: 6565 6462 6163 6b27 0a20 2020 2069 6620  eedback'.    if 
+00006e90: 6973 5f61 646d 696e 3a0a 2020 2020 2020  is_admin:.      
+00006ea0: 2020 7461 7267 6574 5f66 726f 6d5f 666f    target_from_fo
+00006eb0: 726d 203d 2066 6c61 736b 2e72 6571 7565  rm = flask.reque
+00006ec0: 7374 2e66 6f72 6d2e 6765 7428 2274 6172  st.form.get("tar
+00006ed0: 6765 745f 7573 6572 2229 0a20 2020 2020  get_user").     
+00006ee0: 2020 2069 6620 7461 7267 6574 5f66 726f     if target_fro
+00006ef0: 6d5f 666f 726d 206e 6f74 2069 6e20 2822  m_form not in ("
+00006f00: 222c 2022 6175 746f 2229 3a0a 2020 2020  ", "auto"):.    
+00006f10: 2020 2020 2020 2020 7461 7267 6574 5f75          target_u
+00006f20: 7365 7220 3d20 7461 7267 6574 5f66 726f  ser = target_fro
+00006f30: 6d5f 666f 726d 0a20 2020 2020 2020 2070  m_form.        p
+00006f40: 6861 7365 5f66 726f 6d5f 666f 726d 203d  hase_from_form =
+00006f50: 2066 6c61 736b 2e72 6571 7565 7374 2e66   flask.request.f
+00006f60: 6f72 6d2e 6765 7428 2270 6861 7365 2229  orm.get("phase")
+00006f70: 0a20 2020 2020 2020 2069 6620 7068 6173  .        if phas
+00006f80: 655f 6672 6f6d 5f66 6f72 6d20 213d 2022  e_from_form != "
+00006f90: 6175 746f 223a 0a20 2020 2020 2020 2020  auto":.         
+00006fa0: 2020 2070 6861 7365 203d 2070 6861 7365     phase = phase
+00006fb0: 5f66 726f 6d5f 666f 726d 0a0a 2020 2020  _from_form..    
+00006fc0: 2020 2020 2320 5365 6e64 2061 646d 696e      # Send admin
+00006fd0: 7320 746f 2027 726f 7574 655f 6576 616c  s to 'route_eval
+00006fe0: 7561 7465 2720 696e 7374 6561 6420 6f66  uate' instead of
+00006ff0: 2027 726f 7574 655f 6665 6564 6261 636b   'route_feedback
+00007000: 2720 6966 0a20 2020 2020 2020 2023 2074  ' if.        # t
+00007010: 6865 2074 6172 6765 7420 7573 6572 2069  he target user i
+00007020: 7320 6e6f 7420 7468 6520 7361 6d65 2061  s not the same a
+00007030: 7320 7468 6520 6163 7475 616c 2075 7365  s the actual use
+00007040: 722c 2077 6865 7468 6572 0a20 2020 2020  r, whether.     
+00007050: 2020 2023 2062 6563 6175 7365 206f 6620     # because of 
+00007060: 6120 6d61 7371 7565 7261 6465 206f 7220  a masquerade or 
+00007070: 6265 6361 7573 6520 6f66 2061 6e20 6578  because of an ex
+00007080: 706c 6963 6974 2074 6172 6765 7420 7573  plicit target us
+00007090: 6572 2e0a 2020 2020 2020 2020 6966 2074  er..        if t
+000070a0: 6172 6765 745f 7573 6572 2021 3d20 7573  arget_user != us
+000070b0: 6572 6e61 6d65 3a0a 2020 2020 2020 2020  ername:.        
+000070c0: 2020 2020 6465 7374 696e 6174 696f 6e5f      destination_
+000070d0: 726f 7574 6520 3d20 2772 6f75 7465 5f65  route = 'route_e
+000070e0: 7661 6c75 6174 6527 0a0a 2020 2020 2320  valuate'..    # 
+000070f0: 4465 7465 726d 696e 6520 7468 6520 7068  Determine the ph
+00007100: 6173 6520 6672 6f6d 2074 6865 2070 7365  ase from the pse
+00007110: 7420 7374 6174 6520 6966 2077 6520 6e65  t state if we ne
+00007120: 6564 2074 6f0a 2020 2020 6966 2070 6861  ed to.    if pha
+00007130: 7365 2069 7320 4e6f 6e65 3a0a 2020 2020  se is None:.    
+00007140: 2020 2020 7073 5f73 7461 7465 203d 2070      ps_state = p
+00007150: 735b 2773 7461 7475 7327 5d5b 2773 7461  s['status']['sta
+00007160: 7465 275d 0a20 2020 2020 2020 2069 6620  te'].        if 
+00007170: 7073 5f73 7461 7465 203d 3d20 2275 6e6b  ps_state == "unk
+00007180: 6e6f 776e 223a 0a20 2020 2020 2020 2020  nown":.         
+00007190: 2020 206d 7367 203d 2022 7b7d 2068 6173     msg = "{} has
+000071a0: 206e 6f20 6465 6164 6c69 6e65 2e22 2e66   no deadline.".f
+000071b0: 6f72 6d61 7428 7073 6964 290a 2020 2020  ormat(psid).    
+000071c0: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
+000071d0: 6173 6828 6d73 6729 0a20 2020 2020 2020  ash(msg).       
+000071e0: 2020 2020 2072 6574 7572 6e20 6572 726f       return erro
+000071f0: 725f 7265 7370 6f6e 7365 2863 6f75 7273  r_response(cours
+00007200: 652c 2073 656d 6573 7465 722c 2075 7365  e, semester, use
+00007210: 726e 616d 652c 206d 7367 290a 2020 2020  rname, msg).    
+00007220: 2020 2020 656c 6966 2070 735f 7374 6174      elif ps_stat
+00007230: 6520 696e 2028 2275 6e72 656c 6561 7365  e in ("unrelease
+00007240: 6422 2c20 2272 656c 6561 7365 6422 293a  d", "released"):
+00007250: 0a20 2020 2020 2020 2020 2020 2070 6861  .            pha
+00007260: 7365 203d 2022 696e 6974 6961 6c22 0a20  se = "initial". 
+00007270: 2020 2020 2020 2065 6c69 6620 7073 5f73         elif ps_s
+00007280: 7461 7465 2069 6e20 2822 756e 6465 725f  tate in ("under_
+00007290: 7265 7669 6577 222c 2022 7265 7669 7361  review", "revisa
+000072a0: 626c 6522 293a 0a20 2020 2020 2020 2020  ble"):.         
+000072b0: 2020 2070 6861 7365 203d 2022 7265 7669     phase = "revi
+000072c0: 7369 6f6e 220a 2020 2020 2020 2020 2020  sion".          
+000072d0: 2020 2369 6620 7073 5f73 7461 7465 203d    #if ps_state =
+000072e0: 3d20 2275 6e64 6572 5f72 6576 6965 7722  = "under_review"
+000072f0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00007300: 2020 2066 6c61 736b 2e66 6c61 7368 280a     flask.flash(.
+00007310: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00007320: 2020 2020 2022 596f 7520 7368 6f75 6c64       "You should
+00007330: 2070 726f 6261 626c 7920 7761 6974 2075   probably wait u
+00007340: 6e74 696c 2074 6865 2072 6576 6965 7720  ntil the review 
+00007350: 7065 7269 6f64 2069 7322 0a20 2020 2020  period is".     
+00007360: 2020 2020 2020 2023 2020 2020 2020 2b20         #      + 
+00007370: 2220 6f76 6572 2061 6e64 2076 6965 7720  " over and view 
+00007380: 6665 6564 6261 636b 206f 6e20 796f 7572  feedback on your
+00007390: 2069 6e69 7469 616c 2073 7562 6d69 7373   initial submiss
+000073a0: 696f 6e22 0a20 2020 2020 2020 2020 2020  ion".           
+000073b0: 2023 2020 2020 2020 2b20 2220 6265 666f   #      + " befo
+000073c0: 7265 2073 7562 6d69 7474 696e 6720 6120  re submitting a 
+000073d0: 7265 7669 7369 6f6e 2e22 0a20 2020 2020  revision.".     
+000073e0: 2020 2020 2020 2023 2020 2020 290a 2020         #    ).  
+000073f0: 2020 2020 2020 656c 6966 2070 735f 7374        elif ps_st
+00007400: 6174 6520 3d3d 2022 6669 6e61 6c22 3a0a  ate == "final":.
+00007410: 2020 2020 2020 2020 2020 2020 666c 6173              flas
+00007420: 6b2e 666c 6173 6828 0a20 2020 2020 2020  k.flash(.       
+00007430: 2020 2020 2020 2020 2022 5765 2061 7265           "We are
+00007440: 206e 6f20 6c6f 6e67 6572 2061 6363 6570   no longer accep
+00007450: 7469 6e67 206e 6577 2073 7562 6d69 7373  ting new submiss
+00007460: 696f 6e73 2066 6f72 207b 7d2e 222e 666f  ions for {}.".fo
+00007470: 726d 6174 280a 2020 2020 2020 2020 2020  rmat(.          
+00007480: 2020 2020 2020 2020 2020 7073 6964 0a20            psid. 
+00007490: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000074a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000074b0: 2020 2020 2020 2020 2020 2070 6861 7365             phase
+000074c0: 203d 2022 6265 6c61 7465 6422 0a0a 2020   = "belated"..  
+000074d0: 2020 2320 456e 7375 7265 2074 6861 7420    # Ensure that 
+000074e0: 7468 6572 6527 7320 6120 6669 6c65 2062  there's a file b
+000074f0: 6569 6e67 2073 7562 6d69 7474 6564 0a20  eing submitted. 
+00007500: 2020 2066 696c 6573 203d 2066 6c61 736b     files = flask
+00007510: 2e72 6571 7565 7374 2e66 696c 6573 0a20  .request.files. 
+00007520: 2020 2069 6620 2827 7570 6c6f 6164 2720     if ('upload' 
+00007530: 6e6f 7420 696e 2066 696c 6573 206f 7220  not in files or 
+00007540: 6669 6c65 735b 2775 706c 6f61 6427 5d2e  files['upload'].
+00007550: 6669 6c65 6e61 6d65 203d 3d20 2727 293a  filename == ''):
+00007560: 0a20 2020 2020 2020 2066 6c61 736b 2e66  .        flask.f
+00007570: 6c61 7368 2822 596f 7520 6d75 7374 2063  lash("You must c
+00007580: 686f 6f73 6520 6120 6669 6c65 2074 6f20  hoose a file to 
+00007590: 7375 626d 6974 2e22 290a 2020 2020 2020  submit.").      
+000075a0: 2020 7265 7475 726e 2067 6f62 6163 6b28    return goback(
+000075b0: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
+000075c0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+000075d0: 2020 2020 7570 6c6f 6164 6564 203d 2066      uploaded = f
+000075e0: 696c 6573 5b27 7570 6c6f 6164 275d 0a0a  iles['upload']..
+000075f0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00007600: 666f 7220 616e 2069 6e2d 666c 6967 6874  for an in-flight
+00007610: 2067 7261 6469 6e67 2070 726f 6365 7373   grading process
+00007620: 2066 6f72 2074 6869 7320 7461 736b 0a20   for this task. 
+00007630: 2020 2020 2020 2074 732c 205f 2c20 5f2c         ts, _, _,
+00007640: 2073 7461 7475 7320 3d20 7374 6f72 6167   status = storag
+00007650: 652e 6765 745f 696e 666c 6967 6874 280a  e.get_inflight(.
+00007660: 2020 2020 2020 2020 2020 2020 636f 7572              cour
+00007670: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00007680: 7365 6d65 7374 6572 2c0a 2020 2020 2020  semester,.      
+00007690: 2020 2020 2020 6566 6665 6374 6976 655f        effective_
+000076a0: 7573 6572 2c0a 2020 2020 2020 2020 2020  user,.          
+000076b0: 2020 7068 6173 652c 0a20 2020 2020 2020    phase,.       
+000076c0: 2020 2020 2070 7369 642c 0a20 2020 2020       psid,.     
+000076d0: 2020 2020 2020 2074 6173 6b69 640a 2020         taskid.  
+000076e0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000076f0: 2023 2049 6620 7468 6520 7375 626d 6973   # If the submis
+00007700: 7369 6f6e 2069 7320 616c 7265 6164 7920  sion is already 
+00007710: 6265 696e 6720 6576 616c 7561 7465 642c  being evaluated,
+00007720: 206f 7220 6966 2077 6520 636f 756c 646e   or if we couldn
+00007730: 2774 0a20 2020 2020 2020 2023 2066 6967  't.        # fig
+00007740: 7572 6520 6f75 7420 7768 6574 6865 7220  ure out whether 
+00007750: 7468 6174 2077 6173 2074 6865 2063 6173  that was the cas
+00007760: 652c 2077 6520 6361 6e27 7420 7374 6172  e, we can't star
+00007770: 7420 616e 6f74 6865 720a 2020 2020 2020  t another.      
+00007780: 2020 2320 6576 616c 7561 7469 6f6e 2070    # evaluation p
+00007790: 726f 6365 7373 210a 2020 2020 2020 2020  rocess!.        
+000077a0: 6966 2074 7320 3d3d 2022 6572 726f 7222  if ts == "error"
+000077b0: 3a0a 2020 2020 2020 2020 2020 2020 666c  :.            fl
+000077c0: 6173 6b2e 666c 6173 6828 0a20 2020 2020  ask.flash(.     
+000077d0: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
 000077e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077f0: 2020 2073 656d 6573 7465 723d 7365 6d65     semester=seme
-00007800: 7374 6572 2c0a 2020 2020 2020 2020 2020  ster,.          
-00007810: 2020 2020 2020 2020 2020 7461 7267 6574            target
-00007820: 5f75 7365 723d 6566 6665 6374 6976 655f  _user=effective_
-00007830: 7573 6572 2c0a 2020 2020 2020 2020 2020  user,.          
-00007840: 2020 2020 2020 2020 2020 7068 6173 653d            phase=
-00007850: 7068 6173 652c 0a20 2020 2020 2020 2020  phase,.         
-00007860: 2020 2020 2020 2020 2020 2070 7369 643d             psid=
-00007870: 7073 6964 2c0a 2020 2020 2020 2020 2020  psid,.          
-00007880: 2020 2020 2020 2020 2020 7461 736b 6964            taskid
-00007890: 3d74 6173 6b69 640a 2020 2020 2020 2020  =taskid.        
-000078a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000078b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000078c0: 656c 6966 2073 7461 7475 7320 696e 2028  elif status in (
-000078d0: 2269 6e69 7469 616c 222c 2022 696e 5f70  "initial", "in_p
-000078e0: 726f 6772 6573 7322 293a 0a20 2020 2020  rogress"):.     
-000078f0: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
-00007900: 7368 280a 2020 2020 2020 2020 2020 2020  sh(.            
-00007910: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
-00007920: 2020 2020 2020 2020 2020 2245 5252 4f52            "ERROR
-00007930: 3a20 5461 736b 207b 7461 736b 6964 7d20  : Task {taskid} 
-00007940: 666f 7220 7073 6574 207b 7073 6964 7d20  for pset {psid} 
-00007950: 6973 2063 7572 7265 6e74 6c79 2062 6569  is currently bei
-00007960: 6e67 220a 2020 2020 2020 2020 2020 2020  ng".            
-00007970: 2020 2020 2020 2b20 2220 6576 616c 7561        + " evalua
-00007980: 7465 642e 2059 6f75 206d 7573 7420 7761  ted. You must wa
-00007990: 6974 2075 6e74 696c 2074 6861 7420 7072  it until that pr
-000079a0: 6f63 6573 7320 6973 220a 2020 2020 2020  ocess is".      
-000079b0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-000079c0: 636f 6d70 6c65 7465 2062 6566 6f72 6520  complete before 
-000079d0: 7570 6c6f 6164 696e 6720 6120 7265 7669  uploading a revi
-000079e0: 7365 6420 7375 626d 6973 7369 6f6e 2e20  sed submission. 
-000079f0: 5468 6973 220a 2020 2020 2020 2020 2020  This".          
-00007a00: 2020 2020 2020 2020 2b20 2220 7368 6f75          + " shou
-00007a10: 6c64 2074 616b 6520 6e6f 206c 6f6e 6765  ld take no longe
-00007a20: 7220 7468 616e 220a 2020 2020 2020 2020  r than".        
-00007a30: 2020 2020 2020 2020 2020 2b20 2220 7b74            + " {t
-00007a40: 696d 656f 7574 7d20 7365 636f 6e64 732e  imeout} seconds.
-00007a50: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00007a60: 2020 292e 666f 726d 6174 280a 2020 2020    ).format(.    
-00007a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a80: 7461 736b 6964 3d74 6173 6b69 642c 0a20  taskid=taskid,. 
-00007a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007aa0: 2020 2070 7369 643d 7073 6964 2c0a 2020     psid=psid,.  
-00007ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ac0: 2020 7469 6d65 6f75 743d 6170 702e 636f    timeout=app.co
-00007ad0: 6e66 6967 5b27 4649 4e41 4c5f 4556 414c  nfig['FINAL_EVAL
-00007ae0: 5f54 494d 454f 5554 275d 0a20 2020 2020  _TIMEOUT'].     
-00007af0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00007b00: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00007b10: 2020 2020 2020 2072 6574 7572 6e20 666c         return fl
-00007b20: 6173 6b2e 7265 6469 7265 6374 280a 2020  ask.redirect(.  
-00007b30: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-00007b40: 6173 6b2e 7572 6c5f 666f 7228 0a20 2020  ask.url_for(.   
-00007b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b60: 2064 6573 7469 6e61 7469 6f6e 5f72 6f75   destination_rou
-00007b70: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
-00007b80: 2020 2020 2020 2020 636f 7572 7365 3d63          course=c
-00007b90: 6f75 7273 652c 0a20 2020 2020 2020 2020  ourse,.         
-00007ba0: 2020 2020 2020 2020 2020 2073 656d 6573             semes
-00007bb0: 7465 723d 7365 6d65 7374 6572 2c0a 2020  ter=semester,.  
-00007bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007bd0: 2020 7461 7267 6574 5f75 7365 723d 6566    target_user=ef
-00007be0: 6665 6374 6976 655f 7573 6572 2c0a 2020  fective_user,.  
-00007bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c00: 2020 7068 6173 653d 7068 6173 652c 0a20    phase=phase,. 
+000077f0: 2022 4552 524f 523a 2046 6169 6c65 6420   "ERROR: Failed 
+00007800: 746f 2063 6865 636b 2065 7661 6c75 6174  to check evaluat
+00007810: 696f 6e20 7374 6174 7573 2e20 5472 7922  ion status. Try"
+00007820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007830: 2020 202b 2022 2072 6566 7265 7368 696e     + " refreshin
+00007840: 6720 7468 6973 2070 6167 652c 2061 6e64  g this page, and
+00007850: 2069 6620 7468 6520 7072 6f62 6c65 6d20   if the problem 
+00007860: 7065 7273 6973 7473 2c22 0a20 2020 2020  persists,".     
+00007870: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+00007880: 2063 6f6e 7461 6374 207b 7d2e 220a 2020   contact {}.".  
+00007890: 2020 2020 2020 2020 2020 2020 2020 292e                ).
+000078a0: 666f 726d 6174 2861 7070 2e63 6f6e 6669  format(app.confi
+000078b0: 675b 2253 5550 504f 5254 5f4c 494e 4b22  g["SUPPORT_LINK"
+000078c0: 5d29 0a20 2020 2020 2020 2020 2020 2029  ]).            )
+000078d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000078e0: 7572 6e20 666c 6173 6b2e 7265 6469 7265  urn flask.redire
+000078f0: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
+00007900: 2020 2020 666c 6173 6b2e 7572 6c5f 666f      flask.url_fo
+00007910: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00007920: 2020 2020 2020 2064 6573 7469 6e61 7469         destinati
+00007930: 6f6e 5f72 6f75 7465 2c0a 2020 2020 2020  on_route,.      
+00007940: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00007950: 7572 7365 3d63 6f75 7273 652c 0a20 2020  urse=course,.   
+00007960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007970: 2073 656d 6573 7465 723d 7365 6d65 7374   semester=semest
+00007980: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00007990: 2020 2020 2020 2020 7461 7267 6574 5f75          target_u
+000079a0: 7365 723d 6566 6665 6374 6976 655f 7573  ser=effective_us
+000079b0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+000079c0: 2020 2020 2020 2020 7068 6173 653d 7068          phase=ph
+000079d0: 6173 652c 0a20 2020 2020 2020 2020 2020  ase,.           
+000079e0: 2020 2020 2020 2020 2070 7369 643d 7073           psid=ps
+000079f0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
+00007a00: 2020 2020 2020 2020 7461 736b 6964 3d74          taskid=t
+00007a10: 6173 6b69 640a 2020 2020 2020 2020 2020  askid.          
+00007a20: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00007a30: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+00007a40: 6966 2073 7461 7475 7320 696e 2028 2269  if status in ("i
+00007a50: 6e69 7469 616c 222c 2022 696e 5f70 726f  nitial", "in_pro
+00007a60: 6772 6573 7322 293a 0a20 2020 2020 2020  gress"):.       
+00007a70: 2020 2020 2066 6c61 736b 2e66 6c61 7368       flask.flash
+00007a80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00007a90: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+00007aa0: 2020 2020 2020 2020 2245 5252 4f52 3a20          "ERROR: 
+00007ab0: 5461 736b 207b 7461 736b 6964 7d20 666f  Task {taskid} fo
+00007ac0: 7220 7073 6574 207b 7073 6964 7d20 6973  r pset {psid} is
+00007ad0: 2063 7572 7265 6e74 6c79 2062 6569 6e67   currently being
+00007ae0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00007af0: 2020 2020 2b20 2220 6576 616c 7561 7465      + " evaluate
+00007b00: 642e 2059 6f75 206d 7573 7420 7761 6974  d. You must wait
+00007b10: 2075 6e74 696c 2074 6861 7420 7072 6f63   until that proc
+00007b20: 6573 7320 6973 220a 2020 2020 2020 2020  ess is".        
+00007b30: 2020 2020 2020 2020 2020 2b20 2220 636f            + " co
+00007b40: 6d70 6c65 7465 2062 6566 6f72 6520 7570  mplete before up
+00007b50: 6c6f 6164 696e 6720 6120 7265 7669 7365  loading a revise
+00007b60: 6420 7375 626d 6973 7369 6f6e 2e20 5468  d submission. Th
+00007b70: 6973 220a 2020 2020 2020 2020 2020 2020  is".            
+00007b80: 2020 2020 2020 2b20 2220 7368 6f75 6c64        + " should
+00007b90: 2074 616b 6520 6e6f 206c 6f6e 6765 7220   take no longer 
+00007ba0: 7468 616e 220a 2020 2020 2020 2020 2020  than".          
+00007bb0: 2020 2020 2020 2020 2b20 2220 7b74 696d          + " {tim
+00007bc0: 656f 7574 7d20 7365 636f 6e64 732e 220a  eout} seconds.".
+00007bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007be0: 292e 666f 726d 6174 280a 2020 2020 2020  ).format(.      
+00007bf0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+00007c00: 736b 6964 3d74 6173 6b69 642c 0a20 2020  skid=taskid,.   
 00007c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c20: 2020 2070 7369 643d 7073 6964 2c0a 2020     psid=psid,.  
+00007c20: 2070 7369 643d 7073 6964 2c0a 2020 2020   psid=psid,.    
 00007c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c40: 2020 7461 736b 6964 3d74 6173 6b69 640a    taskid=taskid.
-00007c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c60: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-00007c70: 2020 2020 2020 2020 2320 656c 7365 2077          # else w
-00007c80: 6520 6173 7375 6d65 2074 6865 2073 7461  e assume the sta
-00007c90: 7475 7320 6973 2073 6f6d 6520 6669 6e61  tus is some fina
-00007ca0: 6c20 7374 6174 7573 206f 7220 4e6f 6e65  l status or None
-00007cb0: 206d 6561 6e69 6e67 0a20 2020 2020 2020   meaning.       
-00007cc0: 2023 2074 6869 7320 6973 2074 6865 2066   # this is the f
-00007cd0: 6972 7374 2073 7562 6d69 7373 696f 6e0a  irst submission.
-00007ce0: 0a20 2020 2020 2020 2023 2052 6563 6f72  .        # Recor
-00007cf0: 6420 7468 6520 7469 6d65 2073 7065 6e74  d the time spent
-00007d00: 2076 616c 7565 0a20 2020 2020 2020 2069   value.        i
-00007d10: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00007d20: 2774 696d 655f 7370 656e 7427 206e 6f74  'time_spent' not
-00007d30: 2069 6e20 666c 6173 6b2e 7265 7175 6573   in flask.reques
-00007d40: 742e 666f 726d 0a20 2020 2020 2020 2020  t.form.         
-00007d50: 6f72 2066 6c61 736b 2e72 6571 7565 7374  or flask.request
-00007d60: 2e66 6f72 6d5b 2274 696d 655f 7370 656e  .form["time_spen
-00007d70: 7422 5d20 3d3d 2022 220a 2020 2020 2020  t"] == "".      
-00007d80: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00007d90: 2066 6c61 736b 2e66 6c61 7368 280a 2020   flask.flash(.  
-00007da0: 2020 2020 2020 2020 2020 2020 2020 2259                "Y
-00007db0: 6f75 2064 6964 206e 6f74 2067 6976 6520  ou did not give 
-00007dc0: 7573 2061 6e20 6573 7469 6d61 7465 206f  us an estimate o
-00007dd0: 6620 686f 7720 6d75 6368 2074 696d 6520  f how much time 
-00007de0: 7468 6973 220a 2020 2020 2020 2020 2020  this".          
-00007df0: 2020 2020 2b20 2220 7461 736b 2074 6f6f      + " task too
-00007e00: 6b20 796f 752e 2050 6c65 6173 6520 7265  k you. Please re
-00007e10: 2d73 7562 6d69 7420 616e 6420 656e 7465  -submit and ente
-00007e20: 7220 6120 7469 6d65 2073 7065 6e74 220a  r a time spent".
-00007e30: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00007e40: 2220 7661 6c75 6520 736f 2074 6861 7420  " value so that 
-00007e50: 7765 2063 616e 2068 656c 7020 6164 7669  we can help advi
-00007e60: 7365 2066 7574 7572 6520 7374 7564 656e  se future studen
-00007e70: 7473 2061 626f 7574 220a 2020 2020 2020  ts about".      
-00007e80: 2020 2020 2020 2020 2b20 2220 686f 7720          + " how 
-00007e90: 6c6f 6e67 2074 6869 7320 7461 736b 2077  long this task w
-00007ea0: 696c 6c20 7461 6b65 2074 6865 6d2e 220a  ill take them.".
-00007eb0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00007ec0: 2020 2020 2020 2020 2020 7469 6d65 5f73            time_s
-00007ed0: 7065 6e74 203d 2022 220a 2020 2020 2020  pent = "".      
-00007ee0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00007ef0: 2020 2020 7469 6d65 5f73 7065 6e74 203d      time_spent =
-00007f00: 2066 6c61 736b 2e72 6571 7565 7374 2e66   flask.request.f
-00007f10: 6f72 6d5b 2274 696d 655f 7370 656e 7422  orm["time_spent"
-00007f20: 5d0a 0a20 2020 2020 2020 2073 746f 7261  ]..        stora
-00007f30: 6765 2e72 6563 6f72 645f 7469 6d65 5f73  ge.record_time_s
-00007f40: 7065 6e74 280a 2020 2020 2020 2020 2020  pent(.          
-00007f50: 2020 636f 7572 7365 2c0a 2020 2020 2020    course,.      
-00007f60: 2020 2020 2020 7365 6d65 7374 6572 2c0a        semester,.
-00007f70: 2020 2020 2020 2020 2020 2020 7461 7267              targ
-00007f80: 6574 5f75 7365 722c 0a20 2020 2020 2020  et_user,.       
-00007f90: 2020 2020 2070 6861 7365 2c0a 2020 2020       phase,.    
-00007fa0: 2020 2020 2020 2020 7073 6964 2c0a 2020          psid,.  
-00007fb0: 2020 2020 2020 2020 2020 7461 736b 6964            taskid
-00007fc0: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
-00007fd0: 6d65 5f73 7065 6e74 0a20 2020 2020 2020  me_spent.       
-00007fe0: 2029 0a0a 2020 2020 2020 2020 2320 5361   )..        # Sa
-00007ff0: 7665 2074 6865 2066 696c 6520 7769 7468  ve the file with
-00008000: 2074 6865 2063 6f72 7265 6374 2066 696c   the correct fil
-00008010: 656e 616d 652c 2069 676e 6f72 696e 6720  ename, ignoring 
-00008020: 7468 6520 6e61 6d65 2074 6861 740a 2020  the name that.  
-00008030: 2020 2020 2020 2320 7468 6520 7573 6572        # the user
-00008040: 2075 706c 6f61 6465 642e 0a20 2020 2020   uploaded..     
-00008050: 2020 2074 6172 6765 7420 3d20 6765 745f     target = get_
-00008060: 7375 626d 6973 7369 6f6e 5f66 696c 656e  submission_filen
-00008070: 616d 6528 0a20 2020 2020 2020 2020 2020  ame(.           
-00008080: 2063 6f75 7273 652c 0a20 2020 2020 2020   course,.       
-00008090: 2020 2020 2073 656d 6573 7465 722c 0a20       semester,. 
-000080a0: 2020 2020 2020 2020 2020 2074 6173 6b5f             task_
-000080b0: 696e 666f 2c0a 2020 2020 2020 2020 2020  info,.          
-000080c0: 2020 7461 7267 6574 5f75 7365 722c 0a20    target_user,. 
-000080d0: 2020 2020 2020 2020 2020 2070 6861 7365             phase
-000080e0: 2c0a 2020 2020 2020 2020 2020 2020 7073  ,.            ps
-000080f0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-00008100: 7461 736b 6964 0a20 2020 2020 2020 2029  taskid.        )
-00008110: 0a20 2020 2020 2020 2064 6573 7464 6972  .        destdir
-00008120: 2c20 5f20 3d20 6f73 2e70 6174 682e 7370  , _ = os.path.sp
-00008130: 6c69 7428 7461 7267 6574 290a 2020 2020  lit(target).    
-00008140: 2020 2020 7374 6f72 6167 652e 656e 7375      storage.ensu
-00008150: 7265 5f64 6972 6563 746f 7279 2864 6573  re_directory(des
-00008160: 7464 6972 290a 2020 2020 2020 2020 7374  tdir).        st
-00008170: 6f72 6167 652e 6d61 6b65 5f77 6179 5f66  orage.make_way_f
-00008180: 6f72 2874 6172 6765 7429 0a20 2020 2020  or(target).     
-00008190: 2020 2075 706c 6f61 6465 642e 7361 7665     uploaded.save
-000081a0: 2874 6172 6765 7429 0a20 2020 2020 2020  (target).       
-000081b0: 2023 2054 4f44 4f3a 2046 6c61 7368 2063   # TODO: Flash c
-000081c0: 6174 6567 6f72 6965 730a 2020 2020 2020  ategories.      
-000081d0: 2020 6966 2070 6861 7365 203d 3d20 2262    if phase == "b
-000081e0: 656c 6174 6564 223a 0a20 2020 2020 2020  elated":.       
-000081f0: 2020 2020 2066 6c61 736b 2e66 6c61 7368       flask.flash
-00008200: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00008210: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-00008220: 2020 2020 2020 2020 2255 706c 6f61 6465          "Uploade
-00008230: 6420 4c41 5445 2027 7b66 696c 656e 616d  d LATE '{filenam
-00008240: 657d 2720 666f 7220 7b70 7369 647d 207b  e}' for {psid} {
-00008250: 7461 736b 6964 7d2e 220a 2020 2020 2020  taskid}.".      
-00008260: 2020 2020 2020 2020 2020 292e 666f 726d            ).form
-00008270: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
-00008280: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
-00008290: 3d75 706c 6f61 6465 642e 6669 6c65 6e61  =uploaded.filena
-000082a0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-000082b0: 2020 2020 2020 2020 7073 6964 3d70 7369          psid=psi
-000082c0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-000082d0: 2020 2020 2020 2074 6173 6b69 643d 7461         taskid=ta
-000082e0: 736b 6964 0a20 2020 2020 2020 2020 2020  skid.           
-000082f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00008300: 2020 2029 0a20 2020 2020 2020 2065 6c73     ).        els
-00008310: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
-00008320: 6c61 736b 2e66 6c61 7368 280a 2020 2020  lask.flash(.    
-00008330: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-00008340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008350: 2020 2253 7563 6365 7373 6675 6c6c 7920    "Successfully 
-00008360: 7570 6c6f 6164 6564 207b 7068 6173 657d  uploaded {phase}
-00008370: 2073 7562 6d69 7373 696f 6e22 0a20 2020   submission".   
-00008380: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00008390: 2022 2027 7b66 696c 656e 616d 657d 2720   " '{filename}' 
-000083a0: 666f 7220 7b70 7369 647d 207b 7461 736b  for {psid} {task
-000083b0: 6964 7d2e 220a 2020 2020 2020 2020 2020  id}.".          
-000083c0: 2020 2020 2020 292e 666f 726d 6174 280a        ).format(.
-000083d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000083e0: 2020 2020 7068 6173 653d 7068 6173 652c      phase=phase,
-000083f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008400: 2020 2020 2066 696c 656e 616d 653d 7570       filename=up
-00008410: 6c6f 6164 6564 2e66 696c 656e 616d 652c  loaded.filename,
-00008420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008430: 2020 2020 2070 7369 643d 7073 6964 2c0a       psid=psid,.
-00008440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008450: 2020 2020 7461 736b 6964 3d74 6173 6b69      taskid=taski
-00008460: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00008470: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00008480: 290a 0a20 2020 2020 2020 2023 2046 6c61  )..        # Fla
-00008490: 7368 2061 2077 6172 6e69 6e67 2069 6620  sh a warning if 
-000084a0: 7468 6520 7570 6c6f 6164 6564 2066 696c  the uploaded fil
-000084b0: 656e 616d 6520 7365 656d 7320 7772 6f6e  ename seems wron
-000084c0: 670a 2020 2020 2020 2020 6966 2075 706c  g.        if upl
-000084d0: 6f61 6465 642e 6669 6c65 6e61 6d65 2021  oaded.filename !
-000084e0: 3d20 7461 736b 5b22 7461 7267 6574 225d  = task["target"]
-000084f0: 3a0a 2020 2020 2020 2020 2020 2020 666c  :.            fl
-00008500: 6173 6b2e 666c 6173 6828 0a20 2020 2020  ask.flash(.     
-00008510: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
-00008520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008530: 2022 5761 726e 696e 673a 2079 6f75 2075   "Warning: you u
-00008540: 706c 6f61 6465 6420 6120 6669 6c65 206e  ploaded a file n
-00008550: 616d 6564 2027 7b66 696c 656e 616d 657d  amed '{filename}
-00008560: 272c 220a 2020 2020 2020 2020 2020 2020  ',".            
-00008570: 2020 2020 2020 2b20 2220 6275 7420 7b74        + " but {t
-00008580: 6173 6b69 647d 2069 6e20 7b70 7369 647d  askid} in {psid}
-00008590: 2072 6571 7569 7265 7320 6120 6669 6c65   requires a file
-000085a0: 206e 616d 6564 220a 2020 2020 2020 2020   named".        
-000085b0: 2020 2020 2020 2020 2020 2b20 2220 277b            + " '{
-000085c0: 7265 716e 616d 657d 272e 2041 7265 2079  reqname}'. Are y
-000085d0: 6f75 2073 7572 6520 796f 7520 7570 6c6f  ou sure you uplo
-000085e0: 6164 6564 2074 6865 220a 2020 2020 2020  aded the".      
-000085f0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-00008600: 636f 7272 6563 7420 6669 6c65 3f22 0a20  correct file?". 
-00008610: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00008620: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
-00008630: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00008640: 656e 616d 653d 7570 6c6f 6164 6564 2e66  ename=uploaded.f
-00008650: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
-00008660: 2020 2020 2020 2020 2020 2020 2070 7369               psi
-00008670: 643d 7073 6964 2c0a 2020 2020 2020 2020  d=psid,.        
-00008680: 2020 2020 2020 2020 2020 2020 7461 736b              task
-00008690: 6964 3d74 6173 6b69 642c 0a20 2020 2020  id=taskid,.     
-000086a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000086b0: 6571 6e61 6d65 3d74 6173 6b5b 2274 6172  eqname=task["tar
-000086c0: 6765 7422 5d0a 2020 2020 2020 2020 2020  get"].          
-000086d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000086e0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-000086f0: 204c 6f67 2073 6574 7570 0a20 2020 2020   Log setup.     
-00008700: 2020 2074 732c 206c 6f67 6669 6c65 2c20     ts, logfile, 
-00008710: 7265 706f 7274 6669 6c65 2c20 5f20 3d20  reportfile, _ = 
-00008720: 7374 6f72 6167 652e 7075 745f 696e 666c  storage.put_infl
-00008730: 6967 6874 280a 2020 2020 2020 2020 2020  ight(.          
-00008740: 2020 636f 7572 7365 2c0a 2020 2020 2020    course,.      
-00008750: 2020 2020 2020 7365 6d65 7374 6572 2c0a        semester,.
-00008760: 2020 2020 2020 2020 2020 2020 7461 7267              targ
-00008770: 6574 5f75 7365 722c 0a20 2020 2020 2020  et_user,.       
-00008780: 2020 2020 2070 6861 7365 2c0a 2020 2020       phase,.    
-00008790: 2020 2020 2020 2020 7073 6964 2c0a 2020          psid,.  
-000087a0: 2020 2020 2020 2020 2020 7461 736b 6964            taskid
-000087b0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000087c0: 2020 2020 6966 2074 7320 3d3d 2022 6572      if ts == "er
-000087d0: 726f 7222 3a0a 2020 2020 2020 2020 2020  ror":.          
-000087e0: 2020 666c 6173 6b2e 666c 6173 6828 0a20    flask.flash(. 
-000087f0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00008800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008810: 2020 2020 2022 4552 524f 523a 2046 6169       "ERROR: Fai
-00008820: 6c65 6420 746f 2063 6865 636b 2065 7661  led to check eva
-00008830: 6c75 6174 696f 6e20 7374 6174 7573 2e20  luation status. 
-00008840: 5472 7922 0a20 2020 2020 2020 2020 2020  Try".           
-00008850: 2020 2020 2020 202b 2022 2072 6566 7265         + " refre
-00008860: 7368 696e 6720 7468 6973 2070 6167 652c  shing this page,
-00008870: 2061 6e64 2069 6620 7468 6520 7072 6f62   and if the prob
-00008880: 6c65 6d20 7065 7273 6973 7473 2c22 0a20  lem persists,". 
-00008890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088a0: 202b 2022 2063 6f6e 7461 6374 207b 7d2e   + " contact {}.
-000088b0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000088c0: 2020 292e 666f 726d 6174 2861 7070 2e63    ).format(app.c
-000088d0: 6f6e 6669 675b 2253 5550 504f 5254 5f4c  onfig["SUPPORT_L
-000088e0: 494e 4b22 5d29 0a20 2020 2020 2020 2020  INK"]).         
-000088f0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00008900: 2072 6574 7572 6e20 666c 6173 6b2e 7265   return flask.re
-00008910: 6469 7265 6374 280a 2020 2020 2020 2020  direct(.        
-00008920: 2020 2020 2020 2020 666c 6173 6b2e 7572          flask.ur
-00008930: 6c5f 666f 7228 0a20 2020 2020 2020 2020  l_for(.         
-00008940: 2020 2020 2020 2020 2020 2064 6573 7469             desti
-00008950: 6e61 7469 6f6e 5f72 6f75 7465 2c0a 2020  nation_route,.  
-00008960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008970: 2020 636f 7572 7365 3d63 6f75 7273 652c    course=course,
-00008980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008990: 2020 2020 2073 656d 6573 7465 723d 7365       semester=se
-000089a0: 6d65 7374 6572 2c0a 2020 2020 2020 2020  mester,.        
-000089b0: 2020 2020 2020 2020 2020 2020 7461 7267              targ
-000089c0: 6574 5f75 7365 723d 7461 7267 6574 5f75  et_user=target_u
-000089d0: 7365 722c 0a20 2020 2020 2020 2020 2020  ser,.           
-000089e0: 2020 2020 2020 2020 2070 6861 7365 3d70           phase=p
-000089f0: 6861 7365 2c0a 2020 2020 2020 2020 2020  hase,.          
-00008a00: 2020 2020 2020 2020 2020 7073 6964 3d70            psid=p
-00008a10: 7369 642c 0a20 2020 2020 2020 2020 2020  sid,.           
-00008a20: 2020 2020 2020 2020 2074 6173 6b69 643d           taskid=
-00008a30: 7461 736b 6964 0a20 2020 2020 2020 2020  taskid.         
-00008a40: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00008a50: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-00008a60: 6c69 6620 7473 2069 7320 4e6f 6e65 3a20  lif ts is None: 
-00008a70: 2320 616e 6f74 6865 7220 6772 6164 696e  # another gradin
-00008a80: 6720 7072 6f63 6573 7320 6973 2061 6c72  g process is alr
-00008a90: 6561 6479 2069 6e2d 666c 6967 6874 0a20  eady in-flight. 
-00008aa0: 2020 2020 2020 2020 2020 2066 6c61 736b             flask
-00008ab0: 2e66 6c61 7368 280a 2020 2020 2020 2020  .flash(.        
-00008ac0: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
-00008ad0: 2020 2020 2020 2020 2020 2020 2020 2245                "E
-00008ae0: 5252 4f52 3a20 5461 736b 207b 7461 736b  RROR: Task {task
-00008af0: 6964 7d20 666f 7220 7073 6574 207b 7073  id} for pset {ps
-00008b00: 6964 7d20 6973 2063 7572 7265 6e74 6c79  id} is currently
-00008b10: 2062 6569 6e67 220a 2020 2020 2020 2020   being".        
-00008b20: 2020 2020 2020 2020 2020 2b20 2220 6576            + " ev
-00008b30: 616c 7561 7465 642e 2059 6f75 206d 7573  aluated. You mus
-00008b40: 7420 7761 6974 2075 6e74 696c 2074 6861  t wait until tha
-00008b50: 7420 7072 6f63 6573 7320 6973 220a 2020  t process is".  
-00008b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008b70: 2b20 2220 636f 6d70 6c65 7465 2062 6566  + " complete bef
-00008b80: 6f72 6520 7570 6c6f 6164 696e 6720 616e  ore uploading an
-00008b90: 6f74 6865 7220 7375 626d 6973 7369 6f6e  other submission
-00008ba0: 2e20 5468 6973 220a 2020 2020 2020 2020  . This".        
-00008bb0: 2020 2020 2020 2020 2020 2b20 2220 7368            + " sh
-00008bc0: 6f75 6c64 2074 616b 6520 6e6f 206c 6f6e  ould take no lon
-00008bd0: 6765 7220 7468 616e 207b 7469 6d65 6f75  ger than {timeou
-00008be0: 747d 2073 6563 6f6e 6473 2e22 0a20 2020  t} seconds.".   
-00008bf0: 2020 2020 2020 2020 2020 2020 2029 2e66               ).f
-00008c00: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
-00008c10: 2020 2020 2020 2020 2020 2070 7369 643d             psid=
-00008c20: 7073 6964 2c0a 2020 2020 2020 2020 2020  psid,.          
-00008c30: 2020 2020 2020 2020 2020 7461 736b 6964            taskid
-00008c40: 3d74 6173 6b69 642c 0a20 2020 2020 2020  =taskid,.       
-00008c50: 2020 2020 2020 2020 2020 2020 2074 696d               tim
-00008c60: 656f 7574 3d61 7070 2e63 6f6e 6669 675b  eout=app.config[
-00008c70: 2746 494e 414c 5f45 5641 4c5f 5449 4d45  'FINAL_EVAL_TIME
-00008c80: 4f55 5427 5d0a 2020 2020 2020 2020 2020  OUT'].          
-00008c90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00008ca0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00008cb0: 2020 7265 7475 726e 2066 6c61 736b 2e72    return flask.r
-00008cc0: 6564 6972 6563 7428 0a20 2020 2020 2020  edirect(.       
-00008cd0: 2020 2020 2020 2020 2066 6c61 736b 2e75           flask.u
-00008ce0: 726c 5f66 6f72 280a 2020 2020 2020 2020  rl_for(.        
-00008cf0: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-00008d00: 696e 6174 696f 6e5f 726f 7574 652c 0a20  ination_route,. 
-00008d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d20: 2020 2063 6f75 7273 653d 636f 7572 7365     course=course
-00008d30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00008d40: 2020 2020 2020 7365 6d65 7374 6572 3d73        semester=s
-00008d50: 656d 6573 7465 722c 0a20 2020 2020 2020  emester,.       
-00008d60: 2020 2020 2020 2020 2020 2020 2074 6172               tar
-00008d70: 6765 745f 7573 6572 3d74 6172 6765 745f  get_user=target_
-00008d80: 7573 6572 2c0a 2020 2020 2020 2020 2020  user,.          
-00008d90: 2020 2020 2020 2020 2020 7068 6173 653d            phase=
-00008da0: 7068 6173 652c 0a20 2020 2020 2020 2020  phase,.         
-00008db0: 2020 2020 2020 2020 2020 2070 7369 643d             psid=
-00008dc0: 7073 6964 2c0a 2020 2020 2020 2020 2020  psid,.          
-00008dd0: 2020 2020 2020 2020 2020 7461 736b 6964            taskid
-00008de0: 3d74 6173 6b69 640a 2020 2020 2020 2020  =taskid.        
-00008df0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00008e00: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00008e10: 2023 2053 7461 7274 2074 6865 2065 7661   # Start the eva
-00008e20: 6c75 6174 696f 6e20 7072 6f63 6573 7320  luation process 
-00008e30: 2877 6520 646f 6e27 7420 7761 6974 2066  (we don't wait f
-00008e40: 6f72 2069 7429 0a20 2020 2020 2020 206c  or it).        l
-00008e50: 6175 6e63 685f 706f 746c 7563 6b28 0a20  aunch_potluck(. 
-00008e60: 2020 2020 2020 2020 2020 2063 6f75 7273             cours
-00008e70: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-00008e80: 656d 6573 7465 722c 0a20 2020 2020 2020  emester,.       
-00008e90: 2020 2020 2074 6172 6765 745f 7573 6572       target_user
-00008ea0: 2c0a 2020 2020 2020 2020 2020 2020 7461  ,.            ta
-00008eb0: 736b 6964 2c0a 2020 2020 2020 2020 2020  skid,.          
-00008ec0: 2020 7461 7267 6574 2c0a 2020 2020 2020    target,.      
-00008ed0: 2020 2020 2020 6c6f 6766 696c 652c 0a20        logfile,. 
-00008ee0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00008ef0: 7466 696c 650a 2020 2020 2020 2020 290a  tfile.        ).
-00008f00: 0a20 2020 2072 6574 7572 6e20 666c 6173  .    return flas
-00008f10: 6b2e 7265 6469 7265 6374 280a 2020 2020  k.redirect(.    
-00008f20: 2020 2020 666c 6173 6b2e 7572 6c5f 666f      flask.url_fo
-00008f30: 7228 0a20 2020 2020 2020 2020 2020 2064  r(.            d
-00008f40: 6573 7469 6e61 7469 6f6e 5f72 6f75 7465  estination_route
-00008f50: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00008f60: 7572 7365 3d63 6f75 7273 652c 0a20 2020  urse=course,.   
-00008f70: 2020 2020 2020 2020 2073 656d 6573 7465           semeste
-00008f80: 723d 7365 6d65 7374 6572 2c0a 2020 2020  r=semester,.    
-00008f90: 2020 2020 2020 2020 7461 7267 6574 5f75          target_u
-00008fa0: 7365 723d 7461 7267 6574 5f75 7365 722c  ser=target_user,
-00008fb0: 0a20 2020 2020 2020 2020 2020 2070 6861  .            pha
-00008fc0: 7365 3d70 6861 7365 2c0a 2020 2020 2020  se=phase,.      
-00008fd0: 2020 2020 2020 7073 6964 3d70 7369 642c        psid=psid,
-00008fe0: 0a20 2020 2020 2020 2020 2020 2074 6173  .            tas
-00008ff0: 6b69 643d 7461 736b 6964 0a20 2020 2020  kid=taskid.     
-00009000: 2020 2029 0a20 2020 2029 0a0a 0a64 6566     ).    )...def
-00009010: 2077 6869 6368 5f65 7865 2874 6172 6765   which_exe(targe
-00009020: 742c 2063 7764 3d27 2e27 293a 0a20 2020  t, cwd='.'):.   
-00009030: 2022 2222 0a20 2020 2073 6875 7469 6c2e   """.    shutil.
-00009040: 7768 6963 6820 322f 3320 7368 696d 2e20  which 2/3 shim. 
-00009050: 5072 6570 656e 6473 2063 7764 2074 6f20  Prepends cwd to 
-00009060: 6375 7272 656e 7420 5041 5448 2e0a 2020  current PATH..  
-00009070: 2020 2222 220a 2020 2020 6966 2073 7973    """.    if sys
-00009080: 2e76 6572 7369 6f6e 5f69 6e66 6f5b 305d  .version_info[0]
-00009090: 203c 2033 3a0a 2020 2020 2020 2020 6669   < 3:.        fi
-000090a0: 6e64 6572 203d 2073 7562 7072 6f63 6573  nder = subproces
-000090b0: 732e 506f 7065 6e28 0a20 2020 2020 2020  s.Popen(.       
-000090c0: 2020 2020 205b 2027 7768 6963 6827 2c20       [ 'which', 
-000090d0: 7461 7267 6574 205d 2c0a 2020 2020 2020  target ],.      
-000090e0: 2020 2020 2020 6377 643d 6377 642c 0a20        cwd=cwd,. 
-000090f0: 2020 2020 2020 2020 2020 2073 7464 6f75             stdou
-00009100: 743d 7375 6270 726f 6365 7373 2e50 4950  t=subprocess.PIP
-00009110: 450a 2020 2020 2020 2020 290a 2020 2020  E.        ).    
-00009120: 2020 2020 6f75 742c 2065 7272 203d 2066      out, err = f
-00009130: 696e 6465 722e 636f 6d6d 756e 6963 6174  inder.communicat
-00009140: 6528 290a 2020 2020 2020 2020 7265 7475  e().        retu
-00009150: 726e 206f 7574 2e73 7472 6970 2829 0a20  rn out.strip(). 
-00009160: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00009170: 2072 6574 7572 6e20 7368 7574 696c 2e77   return shutil.w
-00009180: 6869 6368 280a 2020 2020 2020 2020 2020  hich(.          
-00009190: 2020 2270 6f74 6c75 636b 5f65 7661 6c22    "potluck_eval"
-000091a0: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-000091b0: 7468 3d63 7764 202b 2027 3a27 202b 206f  th=cwd + ':' + o
-000091c0: 732e 6765 7465 6e76 2822 5041 5448 2229  s.getenv("PATH")
-000091d0: 0a20 2020 2020 2020 2029 0a0a 0a64 6566  .        )...def
-000091e0: 206c 6175 6e63 685f 706f 746c 7563 6b28   launch_potluck(
-000091f0: 0a20 2020 2063 6f75 7273 652c 0a20 2020  .    course,.   
-00009200: 2073 656d 6573 7465 722c 0a20 2020 2075   semester,.    u
-00009210: 7365 726e 616d 652c 0a20 2020 2074 6173  sername,.    tas
-00009220: 6b69 642c 0a20 2020 2074 6172 6765 745f  kid,.    target_
-00009230: 6669 6c65 2c0a 2020 2020 6c6f 6766 696c  file,.    logfil
-00009240: 652c 0a20 2020 2072 6570 6f72 7466 696c  e,.    reportfil
-00009250: 652c 0a20 2020 2077 6169 743d 4661 6c73  e,.    wait=Fals
-00009260: 650a 293a 0a20 2020 2022 2222 0a20 2020  e.):.    """.   
-00009270: 204c 6175 6e63 6865 7320 7468 6520 6576   Launches the ev
-00009280: 616c 7561 7469 6f6e 2070 726f 6365 7373  aluation process
-00009290: 2e20 4279 2064 6566 6175 6c74 2074 6869  . By default thi
-000092a0: 7320 6973 2066 6972 652d 616e 642d 666f  s is fire-and-fo
-000092b0: 7267 6574 3b0a 2020 2020 7765 276c 6c20  rget;.    we'll 
-000092c0: 6c6f 6f6b 2066 6f72 2074 6865 206f 7574  look for the out
-000092d0: 7075 7420 6669 6c65 2074 6f20 6465 7465  put file to dete
-000092e0: 726d 696e 6520 7768 6574 6865 7220 6974  rmine whether it
-000092f0: 2773 2066 696e 6973 6865 6420 6f72 0a20  's finished or. 
-00009300: 2020 206e 6f74 2e20 486f 7765 7665 722c     not. However,
-00009310: 2062 7920 7061 7373 696e 6720 7761 6974   by passing wait
-00009320: 3d54 7275 6520 796f 7520 6361 6e20 6861  =True you can ha
-00009330: 7665 2074 6865 2066 756e 6374 696f 6e20  ve the function 
-00009340: 7761 6974 2066 6f72 0a20 2020 2074 6865  wait for.    the
-00009350: 2070 726f 6365 7373 2074 6f20 7465 726d   process to term
-00009360: 696e 6174 6520 6265 666f 7265 2072 6574  inate before ret
-00009370: 7572 6e69 6e67 2e0a 2020 2020 2222 220a  urning..    """.
-00009380: 2020 2020 6576 616c 5f64 6972 203d 2073      eval_dir = s
-00009390: 746f 7261 6765 2e65 7661 6c75 6174 696f  torage.evaluatio
-000093a0: 6e5f 6469 7265 6374 6f72 7928 636f 7572  n_directory(cour
-000093b0: 7365 2c20 7365 6d65 7374 6572 290a 0a20  se, semester).. 
-000093c0: 2020 2069 6620 6170 702e 636f 6e66 6967     if app.config
-000093d0: 2e67 6574 2822 504f 544c 5543 4b5f 4556  .get("POTLUCK_EV
-000093e0: 414c 5f50 5954 484f 4e22 2920 6973 204e  AL_PYTHON") is N
-000093f0: 6f6e 653a 0a20 2020 2020 2020 2070 7974  one:.        pyt
-00009400: 686f 6e20 3d20 5b5d 0a20 2020 2065 6c73  hon = [].    els
-00009410: 653a 0a20 2020 2020 2020 2070 7974 686f  e:.        pytho
-00009420: 6e20 3d20 5b20 6170 702e 636f 6e66 6967  n = [ app.config
-00009430: 5b22 504f 544c 5543 4b5f 4556 414c 5f50  ["POTLUCK_EVAL_P
-00009440: 5954 484f 4e22 5d20 5d0a 0a20 2020 2069  YTHON"] ]..    i
-00009450: 6620 6170 702e 636f 6e66 6967 5b22 504f  f app.config["PO
-00009460: 544c 5543 4b5f 4556 414c 5f53 4352 4950  TLUCK_EVAL_SCRIP
-00009470: 5422 5d20 6973 204e 6f6e 653a 0a20 2020  T"] is None:.   
-00009480: 2020 2020 2070 6f74 6c75 636b 5f65 7865       potluck_exe
-00009490: 203d 2077 6869 6368 5f65 7865 2822 706f   = which_exe("po
-000094a0: 746c 7563 6b5f 6576 616c 222c 2065 7661  tluck_eval", eva
-000094b0: 6c5f 6469 7229 0a20 2020 2065 6c73 653a  l_dir).    else:
-000094c0: 0a20 2020 2020 2020 2070 6f74 6c75 636b  .        potluck
-000094d0: 5f65 7865 203d 206f 732e 7061 7468 2e6a  _exe = os.path.j
-000094e0: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
-000094f0: 206f 732e 6765 7463 7764 2829 2c0a 2020   os.getcwd(),.  
-00009500: 2020 2020 2020 2020 2020 6170 702e 636f            app.co
-00009510: 6e66 6967 5b22 504f 544c 5543 4b5f 4556  nfig["POTLUCK_EV
-00009520: 414c 5f53 4352 4950 5422 5d0a 2020 2020  AL_SCRIPT"].    
-00009530: 2020 2020 290a 0a20 2020 2070 6f74 6c75      )..    potlu
-00009540: 636b 5f61 7267 7320 3d20 5b0a 2020 2020  ck_args = [.    
-00009550: 2020 2020 222d 2d74 6173 6b22 2c20 7461      "--task", ta
-00009560: 736b 6964 2c0a 2020 2020 2020 2020 222d  skid,.        "-
-00009570: 2d75 7365 7222 2c20 7573 6572 6e61 6d65  -user", username
-00009580: 2c0a 2020 2020 2020 2020 222d 2d74 6172  ,.        "--tar
-00009590: 6765 7422 2c20 6f73 2e70 6174 682e 6162  get", os.path.ab
-000095a0: 7370 6174 6828 7461 7267 6574 5f66 696c  spath(target_fil
-000095b0: 6529 2c0a 2020 2020 2020 2020 222d 2d6f  e),.        "--o
-000095c0: 7574 6669 6c65 222c 206f 732e 7061 7468  utfile", os.path
-000095d0: 2e61 6273 7061 7468 2872 6570 6f72 7466  .abspath(reportf
-000095e0: 696c 6529 2c0a 2020 2020 2020 2020 222d  ile),.        "-
-000095f0: 2d63 6c65 616e 222c 0a20 2020 205d 0a0a  -clean",.    ]..
-00009600: 2020 2020 6966 2061 7070 2e63 6f6e 6669      if app.confi
-00009610: 675b 2250 4f54 4c55 434b 5f45 5641 4c5f  g["POTLUCK_EVAL_
-00009620: 494d 504f 5254 5f46 524f 4d22 5d20 6973  IMPORT_FROM"] is
-00009630: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00009640: 2020 2069 6d70 6f72 745f 6469 7220 3d20     import_dir = 
-00009650: 6f73 2e70 6174 682e 6a6f 696e 280a 2020  os.path.join(.  
-00009660: 2020 2020 2020 2020 2020 6f73 2e67 6574            os.get
-00009670: 6377 6428 292c 0a20 2020 2020 2020 2020  cwd(),.         
-00009680: 2020 2061 7070 2e63 6f6e 6669 675b 2250     app.config["P
-00009690: 4f54 4c55 434b 5f45 5641 4c5f 494d 504f  OTLUCK_EVAL_IMPO
-000096a0: 5254 5f46 524f 4d22 5d0a 2020 2020 2020  RT_FROM"].      
-000096b0: 2020 290a 2020 2020 2020 2020 706f 746c    ).        potl
-000096c0: 7563 6b5f 6172 6773 2e65 7874 656e 6428  uck_args.extend(
-000096d0: 5b22 2d2d 696d 706f 7274 2d66 726f 6d22  ["--import-from"
-000096e0: 2c20 696d 706f 7274 5f64 6972 5d29 0a20  , import_dir]). 
-000096f0: 2020 2077 6974 6820 6f70 656e 286c 6f67     with open(log
-00009700: 6669 6c65 2c20 2777 6227 2920 6173 206c  file, 'wb') as l
-00009710: 6f67 3a0a 2020 2020 2020 2020 6966 2061  og:.        if a
-00009720: 7070 2e63 6f6e 6669 675b 2255 5345 5f58  pp.config["USE_X
-00009730: 5646 4222 5d3a 0a20 2020 2020 2020 2020  VFB"]:.         
-00009740: 2020 2023 2056 6972 7475 616c 6973 6520     # Virtualise 
-00009750: 6672 616d 6520 6275 6666 6572 2066 6f72  frame buffer for
-00009760: 2070 726f 6772 616d 7320 7769 7468 2067   programs with g
-00009770: 7261 7068 6963 732c 2073 6f0a 2020 2020  raphics, so.    
-00009780: 2020 2020 2020 2020 2320 7468 6579 2064          # they d
-00009790: 6f6e 2774 206e 6565 6420 746f 2063 7265  on't need to cre
-000097a0: 6174 6520 5877 696e 646f 7720 7769 6e64  ate Xwindow wind
-000097b0: 6f77 730a 2020 2020 2020 2020 2020 2020  ows.            
-000097c0: 2320 272d 2d61 7574 6f2d 7365 7276 6572  # '--auto-server
-000097d0: 6e75 6d27 2c20 2320 6372 6561 7465 2061  num', # create a
-000097e0: 206e 6577 2073 6572 7665 723f 3f0a 2020   new server??.  
-000097f0: 2020 2020 2020 2020 2020 2320 272d 2d61            # '--a
-00009800: 7574 6f2d 6469 7370 6c61 7927 2c0a 2020  uto-display',.  
-00009810: 2020 2020 2020 2020 2020 2320 5b32 3031            # [201
-00009820: 392f 3032 2f30 385d 2050 6574 6572 3a20  9/02/08] Peter: 
-00009830: 7472 7920 7468 6973 2069 6e73 7465 6164  try this instead
-00009840: 2070 6572 2063 6f6d 6d65 6e74 2069 6e20   per comment in 
-00009850: 2d68 3f0a 2020 2020 2020 2020 2020 2020  -h?.            
-00009860: 7876 6662 5f65 7272 5f6c 6f67 203d 206f  xvfb_err_log = o
-00009870: 732e 7061 7468 2e73 706c 6974 6578 7428  s.path.splitext(
-00009880: 6c6f 6766 696c 6529 5b30 5d20 2b20 222e  logfile)[0] + ".
-00009890: 7876 6662 5f65 7272 6f72 732e 6c6f 6722  xvfb_errors.log"
-000098a0: 0a20 2020 2020 2020 2020 2020 2066 756c  .            ful
-000098b0: 6c5f 6172 6773 203d 2028 0a20 2020 2020  l_args = (.     
-000098c0: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-000098d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098e0: 2027 7876 6662 2d72 756e 272c 0a20 2020   'xvfb-run',.   
-000098f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009900: 2027 2d64 272c 0a20 2020 2020 2020 2020   '-d',.         
-00009910: 2020 2020 2020 2020 2020 2023 205b 3230             # [20
-00009920: 3139 2f30 322f 3131 5d20 4c79 6e3a 202d  19/02/11] Lyn: -
-00009930: 2d61 7574 6f2d 6469 7370 6c61 7920 646f  -auto-display do
-00009940: 6573 6e27 7420 776f 726b 2062 7574 202d  esn't work but -
-00009950: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00009960: 2020 2020 2020 2320 646f 6573 2028 676f        # does (go
-00009970: 2066 6967 7572 652c 2073 696e 6365 2074   figure, since t
-00009980: 6865 7927 7265 2073 7570 706f 7365 6420  hey're supposed 
-00009990: 746f 2062 650a 2020 2020 2020 2020 2020  to be.          
-000099a0: 2020 2020 2020 2020 2020 2320 7379 6e6f            # syno
-000099b0: 6e79 6d73 2129 0a20 2020 2020 2020 2020  nyms!).         
-000099c0: 2020 2020 2020 2020 2020 2027 2d65 272c             '-e',
-000099d0: 2023 202d 2d65 7272 6f72 2d66 696c 6520   # --error-file 
-000099e0: 646f 6573 6e27 7420 776f 726b 0a20 2020  doesn't work.   
-000099f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a00: 2078 7666 625f 6572 725f 6c6f 672c 0a20   xvfb_err_log,. 
-00009a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a20: 2020 2027 2d2d 7365 7276 6572 2d61 7267     '--server-arg
-00009a30: 7327 2c0a 2020 2020 2020 2020 2020 2020  s',.            
-00009a40: 2020 2020 2020 2020 6170 702e 636f 6e66          app.conf
-00009a50: 6967 5b22 5856 4642 5f53 4552 5645 525f  ig["XVFB_SERVER_
-00009a60: 4152 4753 225d 2c20 2320 7363 7265 656e  ARGS"], # screen
-00009a70: 2070 726f 7065 7274 6965 730a 2020 2020   properties.    
-00009a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a90: 272d 2d27 2c0a 2020 2020 2020 2020 2020  '--',.          
-00009aa0: 2020 2020 2020 5d20 2b20 7079 7468 6f6e        ] + python
-00009ab0: 202b 205b 0a20 2020 2020 2020 2020 2020   + [.           
-00009ac0: 2020 2020 2020 2020 2070 6f74 6c75 636b           potluck
-00009ad0: 5f65 7865 2c0a 2020 2020 2020 2020 2020  _exe,.          
-00009ae0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00009af0: 2020 2020 2020 2b20 706f 746c 7563 6b5f        + potluck_
-00009b00: 6172 6773 0a20 2020 2020 2020 2020 2020  args.           
-00009b10: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
-00009b20: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
-00009b30: 6177 2070 6f74 6c75 636b 206c 6175 6e63  aw potluck launc
-00009b40: 6820 7769 7468 6f75 7420 5856 4642 0a20  h without XVFB. 
-00009b50: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
-00009b60: 6172 6773 203d 2070 7974 686f 6e20 2b20  args = python + 
-00009b70: 5b20 706f 746c 7563 6b5f 6578 6520 5d20  [ potluck_exe ] 
-00009b80: 2b20 706f 746c 7563 6b5f 6172 6773 0a0a  + potluck_args..
-00009b90: 2020 2020 2020 2020 6c6f 672e 7772 6974          log.writ
-00009ba0: 6528 0a20 2020 2020 2020 2020 2020 2028  e(.            (
-00009bb0: 2246 756c 6c20 6172 6773 3a20 2220 2b20  "Full args: " + 
-00009bc0: 7265 7072 2866 756c 6c5f 6172 6773 2920  repr(full_args) 
-00009bd0: 2b20 275c 6e27 292e 656e 636f 6465 2822  + '\n').encode("
-00009be0: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
-00009bf0: 290a 2020 2020 2020 2020 6c6f 672e 666c  ).        log.fl
-00009c00: 7573 6828 290a 0a20 2020 2020 2020 2070  ush()..        p
-00009c10: 203d 2073 7562 7072 6f63 6573 732e 506f   = subprocess.Po
-00009c20: 7065 6e28 0a20 2020 2020 2020 2020 2020  pen(.           
-00009c30: 2066 756c 6c5f 6172 6773 2c0a 2020 2020   full_args,.    
-00009c40: 2020 2020 2020 2020 6377 643d 6576 616c          cwd=eval
-00009c50: 5f64 6972 2c0a 2020 2020 2020 2020 2020  _dir,.          
-00009c60: 2020 7374 646f 7574 3d6c 6f67 2c0a 2020    stdout=log,.  
-00009c70: 2020 2020 2020 2020 2020 7374 6465 7272            stderr
-00009c80: 3d6c 6f67 2c0a 2020 2020 2020 2020 290a  =log,.        ).
-00009c90: 0a20 2020 2020 2020 2069 6620 7761 6974  .        if wait
-00009ca0: 3a0a 2020 2020 2020 2020 2020 2020 702e  :.            p.
-00009cb0: 7761 6974 2829 0a0a 0a40 6170 702e 726f  wait()...@app.ro
-00009cc0: 7574 6528 272f 3c63 6f75 7273 653e 2f3c  ute('/<course>/<
-00009cd0: 7365 6d65 7374 6572 3e2f 6578 7465 6e73  semester>/extens
-00009ce0: 696f 6e2f 3c70 7369 643e 272c 206d 6574  ion/<psid>', met
-00009cf0: 686f 6473 3d5b 2747 4554 275d 290a 4066  hods=['GET']).@f
-00009d00: 6c61 736b 5f63 6173 2e6c 6f67 696e 5f72  lask_cas.login_r
-00009d10: 6571 7569 7265 640a 4061 7567 6d65 6e74  equired.@augment
-00009d20: 5f61 7267 756d 656e 7473 0a64 6566 2072  _arguments.def r
-00009d30: 6f75 7465 5f65 7874 656e 7369 6f6e 280a  oute_extension(.
-00009d40: 2020 2020 636f 7572 7365 2c0a 2020 2020      course,.    
-00009d50: 7365 6d65 7374 6572 2c0a 2020 2020 7073  semester,.    ps
-00009d60: 6964 2c0a 2020 2020 2320 4175 676d 656e  id,.    # Augmen
-00009d70: 7465 6420 6172 6775 6d65 6e74 730a 2020  ted arguments.  
-00009d80: 2020 7573 6572 6e61 6d65 2c0a 2020 2020    username,.    
-00009d90: 6973 5f61 646d 696e 2c0a 2020 2020 6d61  is_admin,.    ma
-00009da0: 7371 7565 7261 6465 5f61 732c 0a20 2020  squerade_as,.   
-00009db0: 2065 6666 6563 7469 7665 5f75 7365 722c   effective_user,
-00009dc0: 0a20 2020 2074 6173 6b5f 696e 666f 0a29  .    task_info.)
-00009dd0: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
-00009de0: 7175 6573 7473 2028 616e 6420 6175 746f  quests (and auto
-00009df0: 6d61 7469 6361 6c6c 7920 6772 616e 7473  matically grants
-00009e00: 2920 7468 6520 6465 6661 756c 7420 6578  ) the default ex
-00009e10: 7465 6e73 696f 6e20 6f6e 2074 6865 0a20  tension on the. 
-00009e20: 2020 2067 6976 656e 2070 726f 626c 656d     given problem
-00009e30: 2073 6574 2e20 5468 6520 6578 7465 6e73   set. The extens
-00009e40: 696f 6e20 6973 2061 7070 6c69 6564 2074  ion is applied t
-00009e50: 6f20 7468 6520 696e 6974 6961 6c20 7068  o the initial ph
-00009e60: 6173 650a 2020 2020 6f6e 6c79 2e20 466f  ase.    only. Fo
-00009e70: 7220 6e6f 772c 206e 6f6e 7374 616e 6461  r now, nonstanda
-00009e80: 7264 2065 7874 656e 7369 6f6e 7320 616e  rd extensions an
-00009e90: 6420 7265 7669 7369 6f6e 2065 7874 656e  d revision exten
-00009ea0: 7369 6f6e 7320 6d75 7374 2062 650a 2020  sions must be.  
-00009eb0: 2020 6170 706c 6965 6420 6279 2068 616e    applied by han
-00009ec0: 642d 6564 6974 696e 6720 4a53 4f4e 2066  d-editing JSON f
-00009ed0: 696c 6573 2069 6e20 7468 6520 6065 7874  iles in the `ext
-00009ee0: 656e 7369 6f6e 732f 6020 6469 7265 6374  ensions/` direct
-00009ef0: 6f72 792e 0a20 2020 2022 2222 0a20 2020  ory..    """.   
-00009f00: 2074 7279 3a0a 2020 2020 2020 2020 7073   try:.        ps
-00009f10: 203d 2067 6574 5f70 735f 6f62 6a28 7461   = get_ps_obj(ta
-00009f20: 736b 5f69 6e66 6f2c 2070 7369 6429 0a20  sk_info, psid). 
-00009f30: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-00009f40: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-00009f50: 2020 2066 6c61 736b 2e66 6c61 7368 2873     flask.flash(s
-00009f60: 7472 2865 2929 0a20 2020 2020 2020 2072  tr(e)).        r
-00009f70: 6574 7572 6e20 676f 6261 636b 2863 6f75  eturn goback(cou
-00009f80: 7273 652c 2073 656d 6573 7465 7229 0a0a  rse, semester)..
-00009f90: 2020 2020 2320 4164 6420 7374 6174 7573      # Add status
-00009fa0: 2026 2074 696d 6520 7265 6d61 696e 696e   & time remainin
-00009fb0: 6720 696e 666f 2074 6f20 7073 6574 0a20  g info to pset. 
-00009fc0: 2020 2061 6d65 6e64 5f70 7365 7428 636f     amend_pset(co
-00009fd0: 7572 7365 2c20 7365 6d65 7374 6572 2c20  urse, semester, 
-00009fe0: 7461 736b 5f69 6e66 6f2c 2070 732c 2065  task_info, ps, e
-00009ff0: 6666 6563 7469 7665 5f75 7365 7229 0a20  ffective_user). 
-0000a000: 2020 2023 2054 4f44 4f3a 2074 7269 706c     # TODO: tripl
-0000a010: 652d 6368 6563 6b20 7468 6520 706f 7373  e-check the poss
-0000a020: 6962 696c 6974 7920 6f66 2072 6571 7565  ibility of reque
-0000a030: 7374 696e 6720 616e 2065 7874 656e 7369  sting an extensi
-0000a040: 6f6e 0a20 2020 2023 2064 7572 696e 6720  on.    # during 
-0000a050: 7468 6520 7065 7269 6f64 2061 6e20 6578  the period an ex
-0000a060: 7465 6e73 696f 6e20 776f 756c 6420 6772  tension would gr
-0000a070: 616e 7420 796f 7520 6275 7420 6166 7465  ant you but afte
-0000a080: 7220 7468 650a 2020 2020 2320 696e 6974  r the.    # init
-0000a090: 6961 6c20 6465 6164 6c69 6e65 3f0a 0a20  ial deadline?.. 
-0000a0a0: 2020 2023 2047 7261 6e74 2074 6865 2065     # Grant the e
-0000a0b0: 7874 656e 7369 6f6e 0a20 2020 2069 6620  xtension.    if 
-0000a0c0: 280a 2020 2020 2020 2020 7073 5b22 7374  (.        ps["st
-0000a0d0: 6174 7573 225d 5b22 7374 6174 6522 5d20  atus"]["state"] 
-0000a0e0: 696e 2028 2275 6e72 656c 6561 7365 6422  in ("unreleased"
-0000a0f0: 2c20 2272 656c 6561 7365 6422 290a 2020  , "released").  
-0000a100: 2020 616e 6420 7073 5b22 7374 6174 7573    and ps["status
-0000a110: 225d 5b22 696e 6974 6961 6c5f 6578 7465  "]["initial_exte
-0000a120: 6e73 696f 6e22 5d20 3d3d 2030 0a20 2020  nsion"] == 0.   
-0000a130: 2029 3a0a 2020 2020 2020 2020 7375 6363   ):.        succ
-0000a140: 6565 6465 6420 3d20 7374 6f72 6167 652e  eeded = storage.
-0000a150: 7365 745f 6578 7465 6e73 696f 6e28 0a20  set_extension(. 
-0000a160: 2020 2020 2020 2020 2020 2063 6f75 7273             cours
-0000a170: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-0000a180: 656d 6573 7465 722c 0a20 2020 2020 2020  emester,.       
-0000a190: 2020 2020 2065 6666 6563 7469 7665 5f75       effective_u
-0000a1a0: 7365 722c 0a20 2020 2020 2020 2020 2020  ser,.           
-0000a1b0: 2070 7369 642c 0a20 2020 2020 2020 2020   psid,.         
-0000a1c0: 2020 2022 696e 6974 6961 6c22 0a20 2020     "initial".   
-0000a1d0: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
-0000a1e0: 6620 7375 6363 6565 6465 643a 0a20 2020  f succeeded:.   
-0000a1f0: 2020 2020 2020 2020 2066 6c61 736b 2e66           flask.f
-0000a200: 6c61 7368 2822 4578 7465 6e73 696f 6e20  lash("Extension 
-0000a210: 6772 616e 7465 6420 666f 7220 7b7d 2e22  granted for {}."
-0000a220: 2e66 6f72 6d61 7428 7073 6964 2929 0a20  .format(psid)). 
-0000a230: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000a240: 2020 2020 2020 2020 2066 6c61 736b 2e66           flask.f
-0000a250: 6c61 7368 2822 4661 696c 6564 2074 6f20  lash("Failed to 
-0000a260: 6772 616e 7420 6578 7465 6e73 696f 6e20  grant extension 
-0000a270: 666f 7220 7b7d 2e22 2e66 6f72 6d61 7428  for {}.".format(
-0000a280: 7073 6964 2929 0a20 2020 2065 6c69 6620  psid)).    elif 
-0000a290: 7073 5b22 7374 6174 7573 225d 5b22 7374  ps["status"]["st
-0000a2a0: 6174 6522 5d20 6e6f 7420 696e 2028 2275  ate"] not in ("u
-0000a2b0: 6e72 656c 6561 7365 6422 2c20 2272 656c  nreleased", "rel
-0000a2c0: 6561 7365 6422 293a 0a20 2020 2020 2020  eased"):.       
-0000a2d0: 2066 6c61 736b 2e66 6c61 7368 280a 2020   flask.flash(.  
-0000a2e0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-0000a2f0: 2020 2020 2020 2020 2020 2020 2249 7420              "It 
-0000a300: 6973 2074 6f6f 206c 6174 6520 746f 2072  is too late to r
-0000a310: 6571 7565 7374 2061 6e20 6578 7465 6e73  equest an extens
-0000a320: 696f 6e20 666f 7220 7b7d 2e20 596f 7520  ion for {}. You 
-0000a330: 6d75 7374 220a 2020 2020 2020 2020 2020  must".          
-0000a340: 2020 2020 2020 2220 7265 7175 6573 7420        " request 
-0000a350: 6578 7465 6e73 696f 6e73 2062 6566 6f72  extensions befor
-0000a360: 6520 7468 6520 6465 6164 6c69 6e65 2066  e the deadline f
-0000a370: 6f72 2065 6163 6820 7073 6574 2e22 0a20  or each pset.". 
-0000a380: 2020 2020 2020 2020 2020 2029 2e66 6f72             ).for
-0000a390: 6d61 7428 7073 6964 290a 2020 2020 2020  mat(psid).      
-0000a3a0: 2020 290a 2020 2020 656c 6966 2070 735b    ).    elif ps[
-0000a3b0: 2273 7461 7475 7322 5d5b 2269 6e69 7469  "status"]["initi
-0000a3c0: 616c 5f65 7874 656e 7369 6f6e 225d 2021  al_extension"] !
-0000a3d0: 3d20 303a 0a20 2020 2020 2020 2066 6c61  = 0:.        fla
-0000a3e0: 736b 2e66 6c61 7368 280a 2020 2020 2020  sk.flash(.      
-0000a3f0: 2020 2020 2020 2259 6f75 2068 6176 6520        "You have 
-0000a400: 616c 7265 6164 7920 6265 656e 2067 7261  already been gra
-0000a410: 6e74 6564 2061 6e20 6578 7465 6e73 696f  nted an extensio
-0000a420: 6e20 6f6e 207b 7d2e 222e 666f 726d 6174  n on {}.".format
-0000a430: 2870 7369 6429 0a20 2020 2020 2020 2029  (psid).        )
-0000a440: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-0000a450: 2020 2066 6c61 736b 2e66 6c61 7368 280a     flask.flash(.
-0000a460: 2020 2020 2020 2020 2020 2020 2259 6f75              "You
-0000a470: 2063 616e 6e6f 7420 7461 6b65 2061 6e20   cannot take an 
-0000a480: 6578 7465 6e73 696f 6e20 6f6e 207b 7d2e  extension on {}.
-0000a490: 222e 666f 726d 6174 2870 7369 6429 0a20  ".format(psid). 
-0000a4a0: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
-0000a4b0: 5365 6e64 2074 6865 6d20 6261 636b 2074  Send them back t
-0000a4c0: 6f20 7468 6520 6461 7368 626f 6172 6420  o the dashboard 
-0000a4d0: 6f72 2077 6865 7265 7665 7220 7468 6579  or wherever they
-0000a4e0: 2063 616d 6520 6672 6f6d 0a20 2020 2072   came from.    r
-0000a4f0: 6574 7572 6e20 676f 6261 636b 2863 6f75  eturn goback(cou
-0000a500: 7273 652c 2073 656d 6573 7465 7229 0a0a  rse, semester)..
-0000a510: 0a40 6170 702e 726f 7574 6528 0a20 2020  .@app.route(.   
-0000a520: 2027 2f3c 636f 7572 7365 3e2f 3c73 656d   '/<course>/<sem
-0000a530: 6573 7465 723e 2f73 6574 5f65 7874 656e  ester>/set_exten
-0000a540: 7369 6f6e 732f 3c74 6172 6765 745f 7573  sions/<target_us
-0000a550: 6572 3e2f 3c70 7369 643e 272c 0a20 2020  er>/<psid>',.   
-0000a560: 206d 6574 686f 6473 3d5b 2750 4f53 5427   methods=['POST'
-0000a570: 5d0a 290a 4066 6c61 736b 5f63 6173 2e6c  ].).@flask_cas.l
-0000a580: 6f67 696e 5f72 6571 7569 7265 640a 4061  ogin_required.@a
-0000a590: 7567 6d65 6e74 5f61 7267 756d 656e 7473  ugment_arguments
-0000a5a0: 0a64 6566 2072 6f75 7465 5f73 6574 5f65  .def route_set_e
-0000a5b0: 7874 656e 7369 6f6e 7328 0a20 2020 2063  xtensions(.    c
-0000a5c0: 6f75 7273 652c 0a20 2020 2073 656d 6573  ourse,.    semes
-0000a5d0: 7465 722c 0a20 2020 2074 6172 6765 745f  ter,.    target_
-0000a5e0: 7573 6572 2c0a 2020 2020 7073 6964 2c0a  user,.    psid,.
-0000a5f0: 2020 2020 2320 4175 676d 656e 7465 6420      # Augmented 
-0000a600: 6172 6775 6d65 6e74 730a 2020 2020 7573  arguments.    us
-0000a610: 6572 6e61 6d65 2c0a 2020 2020 6973 5f61  ername,.    is_a
-0000a620: 646d 696e 2c0a 2020 2020 6d61 7371 7565  dmin,.    masque
-0000a630: 7261 6465 5f61 732c 0a20 2020 2065 6666  rade_as,.    eff
-0000a640: 6563 7469 7665 5f75 7365 722c 0a20 2020  ective_user,.   
-0000a650: 2074 6173 6b5f 696e 666f 0a29 3a0a 2020   task_info.):.  
-0000a660: 2020 2222 220a 2020 2020 466f 726d 2074    """.    Form t
-0000a670: 6172 6765 7420 666f 7220 6564 6974 696e  arget for editin
-0000a680: 6720 6578 7465 6e73 696f 6e73 2066 6f72  g extensions for
-0000a690: 2061 2070 6172 7469 6375 6c61 7220 7573   a particular us
-0000a6a0: 6572 2f70 7365 742e 204f 6e6c 790a 2020  er/pset. Only.  
-0000a6b0: 2020 6164 6d69 6e73 2063 616e 2075 7365    admins can use
-0000a6c0: 2074 6869 7320 726f 7574 652e 2043 616e   this route. Can
-0000a6d0: 2062 6520 7573 6564 2074 6f20 7365 7420   be used to set 
-0000a6e0: 6375 7374 6f6d 2065 7874 656e 7369 6f6e  custom extension
-0000a6f0: 2076 616c 7565 730a 2020 2020 666f 7220   values.    for 
-0000a700: 626f 7468 2069 6e69 7469 616c 2061 6e64  both initial and
-0000a710: 2072 6576 6973 6564 2064 6561 646c 696e   revised deadlin
-0000a720: 6573 2e0a 2020 2020 2222 220a 2020 2020  es..    """.    
-0000a730: 6966 206e 6f74 2069 735f 6164 6d69 6e3a  if not is_admin:
-0000a740: 0a20 2020 2020 2020 2066 6c61 736b 2e66  .        flask.f
-0000a750: 6c61 7368 2822 4f6e 6c79 2061 646d 696e  lash("Only admin
-0000a760: 7320 6361 6e20 6772 616e 7420 6578 7465  s can grant exte
-0000a770: 6e73 696f 6e73 2e22 290a 2020 2020 2020  nsions.").      
-0000a780: 2020 7265 7475 726e 2067 6f62 6163 6b28    return goback(
-0000a790: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
-0000a7a0: 290a 0a20 2020 2023 2047 6574 2069 6e69  )..    # Get ini
-0000a7b0: 7469 616c 2f72 6576 6973 696f 6e20 6578  tial/revision ex
-0000a7c0: 7465 6e73 696f 6e20 7661 6c75 6573 2066  tension values f
-0000a7d0: 726f 6d20 7375 626d 6974 7465 6420 666f  rom submitted fo
-0000a7e0: 726d 2076 616c 7565 730a 2020 2020 7472  rm values.    tr
-0000a7f0: 793a 0a20 2020 2020 2020 2069 6e69 7469  y:.        initi
-0000a800: 616c 203d 2069 6e74 2866 6c61 736b 2e72  al = int(flask.r
-0000a810: 6571 7565 7374 2e66 6f72 6d5b 2269 6e69  equest.form["ini
-0000a820: 7469 616c 225d 290a 2020 2020 6578 6365  tial"]).    exce
-0000a830: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-0000a840: 2020 2020 2020 696e 6974 6961 6c20 3d20        initial = 
-0000a850: 4e6f 6e65 0a0a 2020 2020 7472 793a 0a20  None..    try:. 
-0000a860: 2020 2020 2020 2072 6576 6973 696f 6e20         revision 
-0000a870: 3d20 696e 7428 666c 6173 6b2e 7265 7175  = int(flask.requ
-0000a880: 6573 742e 666f 726d 5b22 7265 7669 7369  est.form["revisi
-0000a890: 6f6e 225d 290a 2020 2020 6578 6365 7074  on"]).    except
-0000a8a0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-0000a8b0: 2020 2020 7265 7669 7369 6f6e 203d 204e      revision = N
-0000a8c0: 6f6e 650a 0a20 2020 2023 2041 7420 6c65  one..    # At le
-0000a8d0: 6173 7420 6f6e 6520 6f72 2074 6865 206f  ast one or the o
-0000a8e0: 7468 6572 206e 6565 6473 2074 6f20 6265  ther needs to be
-0000a8f0: 2076 616c 6964 0a20 2020 2069 6620 696e   valid.    if in
-0000a900: 6974 6961 6c20 6973 204e 6f6e 6520 616e  itial is None an
-0000a910: 6420 7265 7669 7369 6f6e 2069 7320 4e6f  d revision is No
-0000a920: 6e65 3a0a 2020 2020 2020 2020 666c 6173  ne:.        flas
-0000a930: 6b2e 666c 6173 6828 0a20 2020 2020 2020  k.flash(.       
-0000a940: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-0000a950: 2020 2020 2020 2022 546f 2073 6574 2065         "To set e
-0000a960: 7874 656e 7369 6f6e 732c 2079 6f75 206d  xtensions, you m
-0000a970: 7573 7420 7370 6563 6966 7920 6569 7468  ust specify eith
-0000a980: 6572 2061 6e20 696e 6974 6961 6c22 0a20  er an initial". 
-0000a990: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000a9a0: 206f 7220 6120 7265 7669 7369 6f6e 2076   or a revision v
-0000a9b0: 616c 7565 2c20 616e 6420 626f 7468 2076  alue, and both v
-0000a9c0: 616c 7565 7320 6d75 7374 2062 6520 696e  alues must be in
-0000a9d0: 7465 6765 7273 2e22 0a20 2020 2020 2020  tegers.".       
-0000a9e0: 2020 2020 2029 0a20 2020 2020 2020 2029       ).        )
-0000a9f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000aa00: 676f 6261 636b 2863 6f75 7273 652c 2073  goback(course, s
-0000aa10: 656d 6573 7465 7229 0a0a 2020 2020 2320  emester)..    # 
-0000aa20: 4772 616e 7420 7468 6520 6578 7465 6e73  Grant the extens
-0000aa30: 696f 6e28 7329 0a20 2020 2069 6620 696e  ion(s).    if in
-0000aa40: 6974 6961 6c20 6973 206e 6f74 204e 6f6e  itial is not Non
-0000aa50: 653a 0a20 2020 2020 2020 2023 2054 4f44  e:.        # TOD
-0000aa60: 4f3a 2055 7365 206f 6e6c 795f 6672 6f6d  O: Use only_from
-0000aa70: 2068 6572 6520 746f 2068 656c 7020 7072   here to help pr
-0000aa80: 6576 656e 7420 7261 6365 2063 6f6e 6469  event race condi
-0000aa90: 7469 6f6e 7320 6f6e 0a20 2020 2020 2020  tions on.       
-0000aaa0: 2023 206c 6f61 6469 6e67 2074 6865 2048   # loading the H
-0000aab0: 544d 4c20 7061 6765 2074 6861 7420 6469  TML page that di
-0000aac0: 7370 6c61 7973 2074 6865 2065 7874 656e  splays the exten
-0000aad0: 7369 6f6e 2076 616c 7565 730a 2020 2020  sion values.    
-0000aae0: 2020 2020 7375 6363 6565 6465 6420 3d20      succeeded = 
-0000aaf0: 7374 6f72 6167 652e 7365 745f 6578 7465  storage.set_exte
-0000ab00: 6e73 696f 6e28 0a20 2020 2020 2020 2020  nsion(.         
-0000ab10: 2020 2063 6f75 7273 652c 0a20 2020 2020     course,.     
-0000ab20: 2020 2020 2020 2073 656d 6573 7465 722c         semester,
-0000ab30: 0a20 2020 2020 2020 2020 2020 2074 6172  .            tar
-0000ab40: 6765 745f 7573 6572 2c0a 2020 2020 2020  get_user,.      
-0000ab50: 2020 2020 2020 7073 6964 2c0a 2020 2020        psid,.    
-0000ab60: 2020 2020 2020 2020 2269 6e69 7469 616c          "initial
-0000ab70: 222c 0a20 2020 2020 2020 2020 2020 2069  ",.            i
-0000ab80: 6e69 7469 616c 0a20 2020 2020 2020 2029  nitial.        )
-0000ab90: 0a20 2020 2020 2020 2069 6620 7375 6363  .        if succ
-0000aba0: 6565 6465 643a 0a20 2020 2020 2020 2020  eeded:.         
-0000abb0: 2020 2066 6c61 736b 2e66 6c61 7368 280a     flask.flash(.
-0000abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abd0: 2253 6574 207b 7d68 2069 6e69 7469 616c  "Set {}h initial
-0000abe0: 2065 7874 656e 7369 6f6e 2066 6f72 207b   extension for {
-0000abf0: 7d20 6f6e 207b 7d2e 222e 666f 726d 6174  } on {}.".format
-0000ac00: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ac10: 2020 2020 2020 696e 6974 6961 6c2c 0a20        initial,. 
-0000ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac30: 2020 2074 6172 6765 745f 7573 6572 2c0a     target_user,.
-0000ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac50: 2020 2020 7073 6964 0a20 2020 2020 2020      psid.       
-0000ac60: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000ac70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000ac80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000ac90: 2020 2066 6c61 736b 2e66 6c61 7368 280a     flask.flash(.
-0000aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acb0: 2246 6169 6c65 6420 746f 2067 7261 6e74  "Failed to grant
-0000acc0: 2069 6e69 7469 616c 2065 7874 656e 7369   initial extensi
-0000acd0: 6f6e 2066 6f72 207b 7d20 6f6e 207b 7d20  on for {} on {} 
-0000ace0: 2874 7279 2061 6761 696e 3f29 2e22 0a20  (try again?).". 
-0000acf0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
-0000ad00: 666f 726d 6174 2874 6172 6765 745f 7573  format(target_us
-0000ad10: 6572 2c20 7073 6964 290a 2020 2020 2020  er, psid).      
-0000ad20: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
-0000ad30: 7265 7669 7369 6f6e 2069 7320 6e6f 7420  revision is not 
-0000ad40: 4e6f 6e65 3a0a 2020 2020 2020 2020 7375  None:.        su
-0000ad50: 6363 6565 6465 6420 3d20 7374 6f72 6167  cceeded = storag
-0000ad60: 652e 7365 745f 6578 7465 6e73 696f 6e28  e.set_extension(
-0000ad70: 0a20 2020 2020 2020 2020 2020 2063 6f75  .            cou
-0000ad80: 7273 652c 0a20 2020 2020 2020 2020 2020  rse,.           
-0000ad90: 2073 656d 6573 7465 722c 0a20 2020 2020   semester,.     
-0000ada0: 2020 2020 2020 2074 6172 6765 745f 7573         target_us
-0000adb0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-0000adc0: 7073 6964 2c0a 2020 2020 2020 2020 2020  psid,.          
-0000add0: 2020 2272 6576 6973 696f 6e22 2c0a 2020    "revision",.  
-0000ade0: 2020 2020 2020 2020 2020 7265 7669 7369            revisi
-0000adf0: 6f6e 0a20 2020 2020 2020 2029 0a20 2020  on.        ).   
-0000ae00: 2020 2020 2069 6620 7375 6363 6565 6465       if succeede
-0000ae10: 643a 0a20 2020 2020 2020 2020 2020 2066  d:.            f
-0000ae20: 6c61 736b 2e66 6c61 7368 280a 2020 2020  lask.flash(.    
-0000ae30: 2020 2020 2020 2020 2020 2020 2253 6574              "Set
-0000ae40: 207b 7d68 2072 6576 6973 696f 6e20 6578   {}h revision ex
-0000ae50: 7465 6e73 696f 6e20 666f 7220 7b7d 206f  tension for {} o
-0000ae60: 6e20 7b7d 2e22 2e66 6f72 6d61 7428 0a20  n {}.".format(. 
-0000ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae80: 2020 2072 6576 6973 696f 6e2c 0a20 2020     revision,.   
-0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aea0: 2074 6172 6765 745f 7573 6572 2c0a 2020   target_user,.  
-0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aec0: 2020 7073 6964 0a20 2020 2020 2020 2020    psid.         
-0000aed0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000aee0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-0000aef0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000af00: 2066 6c61 736b 2e66 6c61 7368 280a 2020   flask.flash(.  
-0000af10: 2020 2020 2020 2020 2020 2020 2020 2246                "F
-0000af20: 6169 6c65 6420 746f 2067 7261 6e74 2072  ailed to grant r
-0000af30: 6576 6973 696f 6e20 6578 7465 6e73 696f  evision extensio
-0000af40: 6e20 666f 7220 7b7d 206f 6e20 7b7d 2028  n for {} on {} (
-0000af50: 7472 7920 6167 6169 6e3f 292e 220a 2020  try again?).".  
-0000af60: 2020 2020 2020 2020 2020 2020 2020 2e66                .f
-0000af70: 6f72 6d61 7428 7461 7267 6574 5f75 7365  ormat(target_use
-0000af80: 722c 2070 7369 6429 0a20 2020 2020 2020  r, psid).       
-0000af90: 2020 2020 2029 0a0a 2020 2020 2320 5365       )..    # Se
-0000afa0: 6e64 2074 6865 6d20 6261 636b 2074 6f20  nd them back to 
-0000afb0: 7468 6520 6461 7368 626f 6172 6420 6f72  the dashboard or
-0000afc0: 2077 6865 7265 7665 7220 7468 6579 2063   wherever they c
-0000afd0: 616d 6520 6672 6f6d 0a20 2020 2072 6574  ame from.    ret
-0000afe0: 7572 6e20 676f 6261 636b 2863 6f75 7273  urn goback(cours
-0000aff0: 652c 2073 656d 6573 7465 7229 0a0a 0a40  e, semester)...@
-0000b000: 6170 702e 726f 7574 6528 0a20 2020 2027  app.route(.    '
-0000b010: 2f3c 636f 7572 7365 3e2f 3c73 656d 6573  /<course>/<semes
-0000b020: 7465 723e 2f6d 616e 6167 655f 6578 7465  ter>/manage_exte
-0000b030: 6e73 696f 6e73 2f3c 7461 7267 6574 5f75  nsions/<target_u
-0000b040: 7365 723e 272c 0a20 2020 206d 6574 686f  ser>',.    metho
-0000b050: 6473 3d5b 2747 4554 275d 0a29 0a40 666c  ds=['GET'].).@fl
-0000b060: 6173 6b5f 6361 732e 6c6f 6769 6e5f 7265  ask_cas.login_re
-0000b070: 7175 6972 6564 0a40 6175 676d 656e 745f  quired.@augment_
-0000b080: 6172 6775 6d65 6e74 730a 6465 6620 726f  arguments.def ro
-0000b090: 7574 655f 6d61 6e61 6765 5f65 7874 656e  ute_manage_exten
-0000b0a0: 7369 6f6e 7328 0a20 2020 2063 6f75 7273  sions(.    cours
-0000b0b0: 652c 0a20 2020 2073 656d 6573 7465 722c  e,.    semester,
-0000b0c0: 0a20 2020 2074 6172 6765 745f 7573 6572  .    target_user
-0000b0d0: 2c0a 2020 2020 2320 4175 676d 656e 7465  ,.    # Augmente
-0000b0e0: 6420 6172 6775 6d65 6e74 730a 2020 2020  d arguments.    
-0000b0f0: 7573 6572 6e61 6d65 2c0a 2020 2020 6973  username,.    is
-0000b100: 5f61 646d 696e 2c0a 2020 2020 6d61 7371  _admin,.    masq
-0000b110: 7565 7261 6465 5f61 732c 0a20 2020 2065  uerade_as,.    e
-0000b120: 6666 6563 7469 7665 5f75 7365 722c 0a20  ffective_user,. 
-0000b130: 2020 2074 6173 6b5f 696e 666f 0a29 3a0a     task_info.):.
-0000b140: 2020 2020 2222 220a 2020 2020 4164 6d69      """.    Admi
-0000b150: 6e2d 6f6e 6c79 2072 6f75 7465 2074 6861  n-only route tha
-0000b160: 7420 6469 7370 6c61 7973 2061 206c 6973  t displays a lis
-0000b170: 7420 6f66 2066 6f72 6d73 2066 6f72 2065  t of forms for e
-0000b180: 6163 6820 7073 6574 2073 686f 7769 6e67  ach pset showing
-0000b190: 0a20 2020 2063 7572 7265 6e74 2065 7874  .    current ext
-0000b1a0: 656e 7369 6f6e 2076 616c 7565 7320 616e  ension values an
-0000b1b0: 6420 616c 6c6f 7769 6e67 2074 6865 2075  d allowing the u
-0000b1c0: 7365 7220 746f 2065 6469 7420 7468 656d  ser to edit them
-0000b1d0: 2061 6e64 2070 7265 7373 0a20 2020 2061   and press.    a
-0000b1e0: 2062 7574 746f 6e20 746f 2075 7064 6174   button to updat
-0000b1f0: 6520 7468 656d 2e0a 2020 2020 2222 220a  e them..    """.
-0000b200: 2020 2020 6966 206e 6f74 2069 735f 6164      if not is_ad
-0000b210: 6d69 6e3a 0a20 2020 2020 2020 2066 6c61  min:.        fla
-0000b220: 736b 2e66 6c61 7368 2822 4f6e 6c79 2061  sk.flash("Only a
-0000b230: 646d 696e 7320 6361 6e20 6772 616e 7420  dmins can grant 
-0000b240: 6578 7465 6e73 696f 6e73 2e22 290a 2020  extensions.").  
-0000b250: 2020 2020 2020 7265 7475 726e 2067 6f62        return gob
-0000b260: 6163 6b28 636f 7572 7365 2c20 7365 6d65  ack(course, seme
-0000b270: 7374 6572 290a 0a20 2020 2023 2047 6574  ster)..    # Get
-0000b280: 2065 7874 656e 7369 6f6e 7320 696e 666f   extensions info
-0000b290: 2066 6f72 2074 6865 2074 6172 6765 7420   for the target 
-0000b2a0: 7573 6572 2066 6f72 2061 6c6c 2070 7365  user for all pse
-0000b2b0: 7473 0a20 2020 2061 6d65 6e64 5f74 6173  ts.    amend_tas
-0000b2c0: 6b5f 696e 666f 2863 6f75 7273 652c 2073  k_info(course, s
-0000b2d0: 656d 6573 7465 722c 2074 6173 6b5f 696e  emester, task_in
-0000b2e0: 666f 2c20 7461 7267 6574 5f75 7365 7229  fo, target_user)
-0000b2f0: 0a0a 2020 2020 7265 7475 726e 2066 6c61  ..    return fla
-0000b300: 736b 2e72 656e 6465 725f 7465 6d70 6c61  sk.render_templa
-0000b310: 7465 280a 2020 2020 2020 2020 2765 7874  te(.        'ext
-0000b320: 656e 7369 6f6e 5f6d 616e 6167 6572 2e6a  ension_manager.j
-0000b330: 3227 2c0a 2020 2020 2020 2020 636f 7572  2',.        cour
-0000b340: 7365 5f6e 616d 653d 6170 702e 636f 6e66  se_name=app.conf
-0000b350: 6967 2e67 6574 2822 434f 5552 5345 5f4e  ig.get("COURSE_N
-0000b360: 414d 4553 222c 207b 7d29 2e67 6574 2863  AMES", {}).get(c
-0000b370: 6f75 7273 652c 2063 6f75 7273 6529 2c0a  ourse, course),.
-0000b380: 2020 2020 2020 2020 636f 7572 7365 3d63          course=c
-0000b390: 6f75 7273 652c 0a20 2020 2020 2020 2073  ourse,.        s
-0000b3a0: 656d 6573 7465 723d 7365 6d65 7374 6572  emester=semester
-0000b3b0: 2c0a 2020 2020 2020 2020 7573 6572 6e61  ,.        userna
-0000b3c0: 6d65 3d75 7365 726e 616d 652c 0a20 2020  me=username,.   
-0000b3d0: 2020 2020 2069 735f 6164 6d69 6e3d 6973       is_admin=is
-0000b3e0: 5f61 646d 696e 2c0a 2020 2020 2020 2020  _admin,.        
-0000b3f0: 6d61 7371 7565 7261 6465 5f61 733d 6d61  masquerade_as=ma
-0000b400: 7371 7565 7261 6465 5f61 732c 0a20 2020  squerade_as,.   
-0000b410: 2020 2020 2074 6173 6b5f 696e 666f 3d74       task_info=t
-0000b420: 6173 6b5f 696e 666f 2c0a 2020 2020 2020  ask_info,.      
-0000b430: 2020 7461 7267 6574 5f75 7365 723d 7461    target_user=ta
-0000b440: 7267 6574 5f75 7365 720a 2020 2020 290a  rget_user.    ).
-0000b450: 0a0a 4061 7070 2e72 6f75 7465 280a 2020  ..@app.route(.  
-0000b460: 2020 272f 3c63 6f75 7273 653e 2f3c 7365    '/<course>/<se
-0000b470: 6d65 7374 6572 3e2f 7365 745f 6576 616c  mester>/set_eval
-0000b480: 2f3c 7461 7267 6574 5f75 7365 723e 2f3c  /<target_user>/<
-0000b490: 7068 6173 653e 2f3c 7073 6964 3e2f 3c74  phase>/<psid>/<t
-0000b4a0: 6173 6b69 643e 272c 0a20 2020 206d 6574  askid>',.    met
-0000b4b0: 686f 6473 3d5b 2750 4f53 5427 5d0a 290a  hods=['POST'].).
-0000b4c0: 4066 6c61 736b 5f63 6173 2e6c 6f67 696e  @flask_cas.login
-0000b4d0: 5f72 6571 7569 7265 640a 4061 7567 6d65  _required.@augme
-0000b4e0: 6e74 5f61 7267 756d 656e 7473 0a64 6566  nt_arguments.def
-0000b4f0: 2072 6f75 7465 5f73 6574 5f65 7661 6c75   route_set_evalu
-0000b500: 6174 696f 6e28 0a20 2020 2063 6f75 7273  ation(.    cours
-0000b510: 652c 0a20 2020 2073 656d 6573 7465 722c  e,.    semester,
-0000b520: 0a20 2020 2074 6172 6765 745f 7573 6572  .    target_user
-0000b530: 2c0a 2020 2020 7068 6173 652c 0a20 2020  ,.    phase,.   
-0000b540: 2070 7369 642c 0a20 2020 2074 6173 6b69   psid,.    taski
-0000b550: 642c 0a20 2020 2023 2041 7567 6d65 6e74  d,.    # Augment
-0000b560: 6564 2061 7267 756d 656e 7473 0a20 2020  ed arguments.   
-0000b570: 2075 7365 726e 616d 652c 0a20 2020 2069   username,.    i
-0000b580: 735f 6164 6d69 6e2c 0a20 2020 206d 6173  s_admin,.    mas
-0000b590: 7175 6572 6164 655f 6173 2c0a 2020 2020  querade_as,.    
-0000b5a0: 6566 6665 6374 6976 655f 7573 6572 2c0a  effective_user,.
-0000b5b0: 2020 2020 7461 736b 5f69 6e66 6f0a 293a      task_info.):
-0000b5c0: 0a20 2020 2022 2222 0a20 2020 2046 6f72  .    """.    For
-0000b5d0: 6d20 7461 7267 6574 2066 6f72 2065 6469  m target for edi
-0000b5e0: 7469 6e67 2063 7573 746f 6d20 6576 616c  ting custom eval
-0000b5f0: 7561 7469 6f6e 2069 6e66 6f20 666f 7220  uation info for 
-0000b600: 6120 7061 7274 6963 756c 6172 0a20 2020  a particular.   
-0000b610: 2075 7365 722f 7073 6574 2e20 4f6e 6c79   user/pset. Only
-0000b620: 2061 646d 696e 7320 6361 6e20 7573 6520   admins can use 
-0000b630: 7468 6973 2072 6f75 7465 2e20 4361 6e20  this route. Can 
-0000b640: 6265 2075 7365 6420 746f 2073 6574 2063  be used to set c
-0000b650: 7573 746f 6d0a 2020 2020 6e6f 7465 7320  ustom.    notes 
-0000b660: 616e 642f 6f72 2061 2067 7261 6465 206f  and/or a grade o
-0000b670: 7665 7272 6964 6520 666f 7220 6120 7061  verride for a pa
-0000b680: 7274 6963 756c 6172 2075 7365 722f 7068  rticular user/ph
-0000b690: 6173 652f 7073 6574 2f74 6173 6b2e 0a20  ase/pset/task.. 
-0000b6a0: 2020 2022 2222 0a20 2020 2069 6620 6e6f     """.    if no
-0000b6b0: 7420 6973 5f61 646d 696e 3a0a 2020 2020  t is_admin:.    
-0000b6c0: 2020 2020 2320 544f 444f 3a20 4772 6164      # TODO: Grad
-0000b6d0: 6572 2072 6f6c 6521 0a20 2020 2020 2020  er role!.       
-0000b6e0: 2066 6c61 736b 2e66 6c61 7368 2822 4f6e   flask.flash("On
-0000b6f0: 6c79 2061 646d 696e 7320 6361 6e20 6564  ly admins can ed
-0000b700: 6974 2065 7661 6c75 6174 696f 6e73 2e22  it evaluations."
-0000b710: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000b720: 2067 6f62 6163 6b28 636f 7572 7365 2c20   goback(course, 
-0000b730: 7365 6d65 7374 6572 290a 0a20 2020 2023  semester)..    #
-0000b740: 2047 6574 206e 6f74 6573 2026 206f 7665   Get notes & ove
-0000b750: 7272 6964 6573 2066 726f 6d20 666f 726d  rrides from form
-0000b760: 2076 616c 7565 730a 2020 2020 7472 793a   values.    try:
-0000b770: 0a20 2020 2020 2020 206e 6f74 6573 203d  .        notes =
-0000b780: 2066 6c61 736b 2e72 6571 7565 7374 2e66   flask.request.f
-0000b790: 6f72 6d5b 226e 6f74 6573 5f6d 6422 5d0a  orm["notes_md"].
-0000b7a0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0000b7b0: 7469 6f6e 3a0a 2020 2020 2020 2020 6e6f  tion:.        no
-0000b7c0: 7465 7320 3d20 4e6f 6e65 0a0a 2020 2020  tes = None..    
-0000b7d0: 7472 793a 0a20 2020 2020 2020 206f 7665  try:.        ove
-0000b7e0: 7272 6964 6520 3d20 666c 6173 6b2e 7265  rride = flask.re
-0000b7f0: 7175 6573 742e 666f 726d 5b22 6f76 6572  quest.form["over
-0000b800: 7269 6465 225d 0a20 2020 2065 7863 6570  ride"].    excep
-0000b810: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
-0000b820: 2020 2020 206f 7665 7272 6964 6520 3d20       override = 
-0000b830: 4e6f 6e65 0a0a 2020 2020 2320 4174 7465  None..    # Atte
-0000b840: 6d70 7420 746f 2063 6f6e 7665 7274 2074  mpt to convert t
-0000b850: 6f20 6120 6e75 6d62 6572 0a20 2020 2069  o a number.    i
-0000b860: 6620 6f76 6572 7269 6465 2069 7320 6e6f  f override is no
-0000b870: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000b880: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000b890: 206f 7665 7272 6964 6520 3d20 666c 6f61   override = floa
-0000b8a0: 7428 6f76 6572 7269 6465 290a 2020 2020  t(override).    
-0000b8b0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0000b8c0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-0000b8d0: 2020 7061 7373 0a0a 2020 2020 7472 793a    pass..    try:
-0000b8e0: 0a20 2020 2020 2020 2074 696d 656c 696e  .        timelin
-0000b8f0: 6573 7320 3d20 666c 6173 6b2e 7265 7175  ess = flask.requ
-0000b900: 6573 742e 666f 726d 5b22 7469 6d65 6c69  est.form["timeli
-0000b910: 6e65 7373 5f6f 7665 7272 6964 6522 5d0a  ness_override"].
-0000b920: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0000b930: 7469 6f6e 3a0a 2020 2020 2020 2020 7469  tion:.        ti
-0000b940: 6d65 6c69 6e65 7373 203d 204e 6f6e 650a  meliness = None.
-0000b950: 0a20 2020 2023 2041 7474 656d 7074 2074  .    # Attempt t
-0000b960: 6f20 636f 6e76 6572 7420 746f 2061 206e  o convert to a n
-0000b970: 756d 6265 720a 2020 2020 6966 2074 696d  umber.    if tim
-0000b980: 656c 696e 6573 7320 6973 206e 6f74 204e  eliness is not N
-0000b990: 6f6e 653a 0a20 2020 2020 2020 2074 7279  one:.        try
-0000b9a0: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
-0000b9b0: 6d65 6c69 6e65 7373 203d 2066 6c6f 6174  meliness = float
-0000b9c0: 2874 696d 656c 696e 6573 7329 0a20 2020  (timeliness).   
-0000b9d0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-0000b9e0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-0000b9f0: 2020 2070 6173 730a 0a20 2020 2023 2041     pass..    # A
-0000ba00: 7420 6c65 6173 7420 6f6e 6520 6f66 2074  t least one of t
-0000ba10: 6865 6d20 6e65 6564 7320 746f 2062 6520  hem needs to be 
-0000ba20: 7661 6c69 640a 2020 2020 6966 206e 6f74  valid.    if not
-0000ba30: 6573 2069 7320 4e6f 6e65 2061 6e64 206f  es is None and o
-0000ba40: 7665 7272 6964 6520 6973 204e 6f6e 6520  verride is None 
-0000ba50: 616e 6420 7469 6d65 6c69 6e65 7373 2069  and timeliness i
-0000ba60: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000ba70: 666c 6173 6b2e 666c 6173 6828 0a20 2020  flask.flash(.   
-0000ba80: 2020 2020 2020 2020 2022 546f 2073 6574           "To set
-0000ba90: 2061 6e20 6576 616c 7561 7469 6f6e 2c20   an evaluation, 
-0000baa0: 796f 7520 6d75 7374 2073 7065 6369 6679  you must specify
-0000bab0: 2061 7420 6c65 6173 7420 6f6e 6520 6f66   at least one of
-0000bac0: 3a20 6122 0a20 2020 2020 2020 2020 2020  : a".           
-0000bad0: 2022 206e 6f74 6573 2073 7472 696e 672c   " notes string,
-0000bae0: 2061 2067 7261 6465 206f 7665 7272 6964   a grade overrid
-0000baf0: 652c 206f 7220 6120 7469 6d65 6c69 6e65  e, or a timeline
-0000bb00: 7373 206f 7665 7272 6964 652e 220a 2020  ss override.".  
-0000bb10: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000bb20: 7265 7475 726e 2067 6f62 6163 6b28 636f  return goback(co
-0000bb30: 7572 7365 2c20 7365 6d65 7374 6572 290a  urse, semester).
-0000bb40: 0a20 2020 2023 2054 7572 6e20 4e6f 6e65  .    # Turn None
-0000bb50: 7320 696e 746f 2065 6d70 7479 2073 7472  s into empty str
-0000bb60: 696e 6773 3a0a 2020 2020 6966 206e 6f74  ings:.    if not
-0000bb70: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-0000bb80: 2020 2020 6e6f 7465 7320 3d20 2727 0a0a      notes = ''..
-0000bb90: 2020 2020 6966 206f 7665 7272 6964 6520      if override 
-0000bba0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000bbb0: 206f 7665 7272 6964 6520 3d20 2727 0a0a   override = ''..
-0000bbc0: 2020 2020 6966 2074 696d 656c 696e 6573      if timelines
-0000bbd0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-0000bbe0: 2020 2074 696d 656c 696e 6573 7320 3d20     timeliness = 
-0000bbf0: 2727 0a0a 2020 2020 2320 544f 444f 3a20  ''..    # TODO: 
-0000bc00: 4372 6561 7465 2061 6e64 2075 7365 2061  Create and use a
-0000bc10: 6e20 6f6e 6c79 5f66 726f 6d20 6d65 6368  n only_from mech
-0000bc20: 616e 6973 6d20 6865 7265 2074 6f20 6865  anism here to he
-0000bc30: 6c70 0a20 2020 2023 2070 7265 7665 6e74  lp.    # prevent
-0000bc40: 2072 6163 6520 636f 6e64 6974 696f 6e73   race conditions
-0000bc50: 206f 6e20 6c6f 6164 696e 6720 7468 6520   on loading the 
-0000bc60: 4854 4d4c 2070 6167 6520 7468 6174 2064  HTML page that d
-0000bc70: 6973 706c 6179 730a 2020 2020 2320 7468  isplays.    # th
-0000bc80: 6520 6f6c 6420 6576 616c 7561 7469 6f6e  e old evaluation
-0000bc90: 2076 616c 7565 733f 0a20 2020 2073 7563   values?.    suc
-0000bca0: 6365 6564 6564 203d 2073 746f 7261 6765  ceeded = storage
-0000bcb0: 2e73 6574 5f65 7661 6c75 6174 696f 6e28  .set_evaluation(
-0000bcc0: 0a20 2020 2020 2020 2063 6f75 7273 652c  .        course,
-0000bcd0: 0a20 2020 2020 2020 2073 656d 6573 7465  .        semeste
-0000bce0: 722c 0a20 2020 2020 2020 2074 6172 6765  r,.        targe
-0000bcf0: 745f 7573 6572 2c0a 2020 2020 2020 2020  t_user,.        
-0000bd00: 7068 6173 652c 0a20 2020 2020 2020 2070  phase,.        p
-0000bd10: 7369 642c 0a20 2020 2020 2020 2074 6173  sid,.        tas
-0000bd20: 6b69 642c 0a20 2020 2020 2020 206e 6f74  kid,.        not
-0000bd30: 6573 2c0a 2020 2020 2020 2020 6f76 6572  es,.        over
-0000bd40: 7269 6465 2c0a 2020 2020 2020 2020 7469  ride,.        ti
-0000bd50: 6d65 6c69 6e65 7373 0a20 2020 2029 0a20  meliness.    ). 
-0000bd60: 2020 2069 6620 7375 6363 6565 6465 643a     if succeeded:
-0000bd70: 0a20 2020 2020 2020 2066 6c61 736b 2e66  .        flask.f
-0000bd80: 6c61 7368 280a 2020 2020 2020 2020 2020  lash(.          
-0000bd90: 2020 2255 7064 6174 6564 2065 7661 6c75    "Updated evalu
-0000bda0: 6174 696f 6e20 666f 7220 7b7d 206f 6e20  ation for {} on 
-0000bdb0: 7b7d 207b 7d20 7b7d 2073 7562 6d69 7373  {} {} {} submiss
-0000bdc0: 696f 6e2e 222e 666f 726d 6174 280a 2020  ion.".format(.  
-0000bdd0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-0000bde0: 7267 6574 5f75 7365 722c 0a20 2020 2020  rget_user,.     
-0000bdf0: 2020 2020 2020 2020 2020 2070 7369 642c             psid,
-0000be00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000be10: 2074 6173 6b69 642c 0a20 2020 2020 2020   taskid,.       
-0000be20: 2020 2020 2020 2020 2070 6861 7365 0a20           phase. 
-0000be30: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000be40: 2020 2020 2029 0a20 2020 2065 6c73 653a       ).    else:
-0000be50: 0a20 2020 2020 2020 2066 6c61 736b 2e66  .        flask.f
-0000be60: 6c61 7368 280a 2020 2020 2020 2020 2020  lash(.          
-0000be70: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-0000be80: 2020 2020 2246 6169 6c65 6420 746f 2075      "Failed to u
-0000be90: 7064 6174 6520 6576 616c 7561 7469 6f6e  pdate evaluation
-0000bea0: 2066 6f72 207b 7d20 6f6e 207b 7d20 7b7d   for {} on {} {}
-0000beb0: 207b 7d22 0a20 2020 2020 2020 2020 2020   {}".           
-0000bec0: 2020 2020 2022 2073 7562 6d69 7373 696f       " submissio
-0000bed0: 6e2e 220a 2020 2020 2020 2020 2020 2020  n.".            
-0000bee0: 292e 666f 726d 6174 280a 2020 2020 2020  ).format(.      
-0000bef0: 2020 2020 2020 2020 2020 7461 7267 6574            target
-0000bf00: 5f75 7365 722c 0a20 2020 2020 2020 2020  _user,.         
-0000bf10: 2020 2020 2020 2070 7369 642c 0a20 2020         psid,.   
-0000bf20: 2020 2020 2020 2020 2020 2020 2074 6173               tas
-0000bf30: 6b69 642c 0a20 2020 2020 2020 2020 2020  kid,.           
-0000bf40: 2020 2020 2070 6861 7365 0a20 2020 2020       phase.     
-0000bf50: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000bf60: 2029 0a0a 2020 2020 2320 5365 6e64 2074   )..    # Send t
-0000bf70: 6865 6d20 746f 2074 6865 2065 7661 6c75  hem to the evalu
-0000bf80: 6174 696f 6e2d 6564 6974 696e 6720 7061  ation-editing pa
-0000bf90: 6765 0a20 2020 2072 6574 7572 6e20 666c  ge.    return fl
-0000bfa0: 6173 6b2e 7265 6469 7265 6374 280a 2020  ask.redirect(.  
-0000bfb0: 2020 2020 2020 666c 6173 6b2e 7572 6c5f        flask.url_
-0000bfc0: 666f 7228 0a20 2020 2020 2020 2020 2020  for(.           
-0000bfd0: 2027 726f 7574 655f 6576 616c 7561 7465   'route_evaluate
-0000bfe0: 272c 0a20 2020 2020 2020 2020 2020 2063  ',.            c
-0000bff0: 6f75 7273 653d 636f 7572 7365 2c0a 2020  ourse=course,.  
-0000c000: 2020 2020 2020 2020 2020 7365 6d65 7374            semest
-0000c010: 6572 3d73 656d 6573 7465 722c 0a20 2020  er=semester,.   
-0000c020: 2020 2020 2020 2020 2074 6172 6765 745f           target_
-0000c030: 7573 6572 3d74 6172 6765 745f 7573 6572  user=target_user
-0000c040: 2c0a 2020 2020 2020 2020 2020 2020 7068  ,.            ph
-0000c050: 6173 653d 7068 6173 652c 0a20 2020 2020  ase=phase,.     
-0000c060: 2020 2020 2020 2070 7369 643d 7073 6964         psid=psid
-0000c070: 2c0a 2020 2020 2020 2020 2020 2020 7461  ,.            ta
-0000c080: 736b 6964 3d74 6173 6b69 640a 2020 2020  skid=taskid.    
-0000c090: 2020 2020 290a 2020 2020 290a 0a0a 4061      ).    )...@a
-0000c0a0: 7070 2e72 6f75 7465 280a 2020 2020 272f  pp.route(.    '/
-0000c0b0: 3c63 6f75 7273 653e 2f3c 7365 6d65 7374  <course>/<semest
-0000c0c0: 6572 3e2f 6576 616c 7561 7465 2f3c 7461  er>/evaluate/<ta
-0000c0d0: 7267 6574 5f75 7365 723e 2f3c 7068 6173  rget_user>/<phas
-0000c0e0: 653e 2f3c 7073 6964 3e2f 3c74 6173 6b69  e>/<psid>/<taski
-0000c0f0: 643e 272c 0a20 2020 206d 6574 686f 6473  d>',.    methods
-0000c100: 3d5b 2747 4554 275d 0a29 0a40 666c 6173  =['GET'].).@flas
-0000c110: 6b5f 6361 732e 6c6f 6769 6e5f 7265 7175  k_cas.login_requ
-0000c120: 6972 6564 0a40 6175 676d 656e 745f 6172  ired.@augment_ar
-0000c130: 6775 6d65 6e74 730a 6465 6620 726f 7574  guments.def rout
-0000c140: 655f 6576 616c 7561 7465 280a 2020 2020  e_evaluate(.    
-0000c150: 636f 7572 7365 2c0a 2020 2020 7365 6d65  course,.    seme
-0000c160: 7374 6572 2c0a 2020 2020 7461 7267 6574  ster,.    target
-0000c170: 5f75 7365 722c 0a20 2020 2070 6861 7365  _user,.    phase
-0000c180: 2c0a 2020 2020 7073 6964 2c0a 2020 2020  ,.    psid,.    
-0000c190: 7461 736b 6964 2c0a 2020 2020 2320 4175  taskid,.    # Au
-0000c1a0: 676d 656e 7465 6420 6172 6775 6d65 6e74  gmented argument
-0000c1b0: 730a 2020 2020 7573 6572 6e61 6d65 2c0a  s.    username,.
-0000c1c0: 2020 2020 6973 5f61 646d 696e 2c0a 2020      is_admin,.  
-0000c1d0: 2020 6d61 7371 7565 7261 6465 5f61 732c    masquerade_as,
-0000c1e0: 0a20 2020 2065 6666 6563 7469 7665 5f75  .    effective_u
-0000c1f0: 7365 722c 0a20 2020 2074 6173 6b5f 696e  ser,.    task_in
-0000c200: 666f 0a29 3a0a 2020 2020 2222 220a 2020  fo.):.    """.  
-0000c210: 2020 4469 7370 6c61 7973 2073 7475 6465    Displays stude
-0000c220: 6e74 2066 6565 6462 6163 6b20 616e 6420  nt feedback and 
-0000c230: 616c 736f 2069 6e63 6c75 6465 7320 6120  also includes a 
-0000c240: 666f 726d 2061 7420 7468 6520 746f 7020  form at the top 
-0000c250: 666f 720a 2020 2020 6164 6469 6e67 2061  for.    adding a
-0000c260: 2063 7573 746f 6d20 6e6f 7465 2061 6e64   custom note and
-0000c270: 2f6f 7220 6f76 6572 7269 6469 6e67 2074  /or overriding t
-0000c280: 6865 2067 7261 6465 2e0a 2020 2020 2222  he grade..    ""
-0000c290: 220a 2020 2020 6966 206e 6f74 2069 735f  ".    if not is_
-0000c2a0: 6164 6d69 6e3a 0a20 2020 2020 2020 2023  admin:.        #
-0000c2b0: 2054 4f44 4f3a 2047 7261 6465 7220 726f   TODO: Grader ro
-0000c2c0: 6c65 210a 2020 2020 2020 2020 666c 6173  le!.        flas
-0000c2d0: 6b2e 666c 6173 6828 224f 6e6c 7920 6164  k.flash("Only ad
-0000c2e0: 6d69 6e73 2063 616e 2065 7661 6c75 6174  mins can evaluat
-0000c2f0: 6520 7375 626d 6973 7369 6f6e 732e 2229  e submissions.")
-0000c300: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000c310: 676f 6261 636b 2863 6f75 7273 652c 2073  goback(course, s
-0000c320: 656d 6573 7465 7229 0a0a 2020 2020 2320  emester)..    # 
-0000c330: 4368 6563 6b20 726f 7374 6572 2061 6e64  Check roster and
-0000c340: 2066 6c61 7368 2061 2077 6172 6e69 6e67   flash a warning
-0000c350: 2069 6620 7765 2772 6520 7669 6577 696e   if we're viewin
-0000c360: 6720 6665 6564 6261 636b 2066 6f72 2061  g feedback for a
-0000c370: 0a20 2020 2023 2075 7365 7220 7768 6f20  .    # user who 
-0000c380: 6973 206e 6f74 206f 6e20 7468 6520 726f  is not on the ro
-0000c390: 7374 6572 2e2e 2e0a 2020 2020 7472 793a  ster....    try:
-0000c3a0: 0a20 2020 2020 2020 2072 6f73 7465 7220  .        roster 
-0000c3b0: 3d20 7374 6f72 6167 652e 6765 745f 726f  = storage.get_ro
-0000c3c0: 7374 6572 2863 6f75 7273 652c 2073 656d  ster(course, sem
-0000c3d0: 6573 7465 7229 0a20 2020 2065 7863 6570  ester).    excep
-0000c3e0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-0000c3f0: 3a0a 2020 2020 2020 2020 666c 6173 6b2e  :.        flask.
-0000c400: 666c 6173 6828 7374 7228 6529 290a 2020  flash(str(e)).  
-0000c410: 2020 2020 2020 726f 7374 6572 203d 204e        roster = N
-0000c420: 6f6e 650a 0a20 2020 2069 6620 726f 7374  one..    if rost
-0000c430: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-0000c440: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
-0000c450: 0a20 2020 2020 2020 2020 2020 2022 5761  .            "Wa
-0000c460: 726e 696e 673a 2063 6f75 6c64 206e 6f74  rning: could not
-0000c470: 2066 6574 6368 2072 6f73 7465 7220 746f   fetch roster to
-0000c480: 2063 6865 636b 2069 6620 7468 6973 2075   check if this u
-0000c490: 7365 7220 6973 206f 6e22 0a20 2020 2020  ser is on".     
-0000c4a0: 2020 2020 2020 2022 2069 742e 220a 2020         " it.".  
-0000c4b0: 2020 2020 2020 290a 2020 2020 656c 6966        ).    elif
-0000c4c0: 2074 6172 6765 745f 7573 6572 206e 6f74   target_user not
-0000c4d0: 2069 6e20 726f 7374 6572 3a0a 2020 2020   in roster:.    
-0000c4e0: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
-0000c4f0: 2257 6172 6e69 6e67 3a20 7468 6973 2075  "Warning: this u
-0000c500: 7365 7220 6973 206e 6f74 206f 6e20 7468  ser is not on th
-0000c510: 6520 726f 7374 6572 2122 290a 0a20 2020  e roster!")..   
-0000c520: 2023 2047 6574 2066 756c 6c20 6665 6564   # Get full feed
-0000c530: 6261 636b 2069 6e66 6f0a 2020 2020 7073  back info.    ps
-0000c540: 5f61 6e64 5f74 6173 6b20 3d20 6765 745f  _and_task = get_
-0000c550: 6665 6564 6261 636b 5f70 735f 616e 645f  feedback_ps_and_
-0000c560: 7461 736b 280a 2020 2020 2020 2020 7461  task(.        ta
-0000c570: 736b 5f69 6e66 6f2c 0a20 2020 2020 2020  sk_info,.       
-0000c580: 2063 6f75 7273 652c 0a20 2020 2020 2020   course,.       
-0000c590: 2073 656d 6573 7465 722c 0a20 2020 2020   semester,.     
-0000c5a0: 2020 2074 6172 6765 745f 7573 6572 2c0a     target_user,.
-0000c5b0: 2020 2020 2020 2020 7068 6173 652c 0a20          phase,. 
-0000c5c0: 2020 2020 2020 2070 7369 642c 0a20 2020         psid,.   
-0000c5d0: 2020 2020 2074 6173 6b69 640a 2020 2020       taskid.    
-0000c5e0: 290a 2020 2020 6966 2069 7369 6e73 7461  ).    if isinsta
-0000c5f0: 6e63 6528 7073 5f61 6e64 5f74 6173 6b2c  nce(ps_and_task,
-0000c600: 2056 616c 7565 4572 726f 7229 3a0a 2020   ValueError):.  
-0000c610: 2020 2020 2020 666c 6173 6b2e 666c 6173        flask.flas
-0000c620: 6828 7374 7228 7073 5f61 6e64 5f74 6173  h(str(ps_and_tas
-0000c630: 6b29 290a 2020 2020 2020 2020 7265 7475  k)).        retu
-0000c640: 726e 2067 6f62 6163 6b28 636f 7572 7365  rn goback(course
-0000c650: 2c20 7365 6d65 7374 6572 290a 2020 2020  , semester).    
-0000c660: 656c 7365 3a0a 2020 2020 2020 2020 7073  else:.        ps
-0000c670: 2c20 7461 736b 203d 2070 735f 616e 645f  , task = ps_and_
-0000c680: 7461 736b 0a0a 2020 2020 7265 7475 726e  task..    return
-0000c690: 2066 6c61 736b 2e72 656e 6465 725f 7465   flask.render_te
-0000c6a0: 6d70 6c61 7465 280a 2020 2020 2020 2020  mplate(.        
-0000c6b0: 2765 7661 6c75 6174 652e 6a32 272c 0a20  'evaluate.j2',. 
-0000c6c0: 2020 2020 2020 2063 6f75 7273 655f 6e61         course_na
-0000c6d0: 6d65 3d61 7070 2e63 6f6e 6669 672e 6765  me=app.config.ge
-0000c6e0: 7428 2243 4f55 5253 455f 4e41 4d45 5322  t("COURSE_NAMES"
-0000c6f0: 2c20 7b7d 292e 6765 7428 636f 7572 7365  , {}).get(course
-0000c700: 2c20 636f 7572 7365 292c 0a20 2020 2020  , course),.     
-0000c710: 2020 2063 6f75 7273 653d 636f 7572 7365     course=course
-0000c720: 2c0a 2020 2020 2020 2020 7365 6d65 7374  ,.        semest
-0000c730: 6572 3d73 656d 6573 7465 722c 0a20 2020  er=semester,.   
-0000c740: 2020 2020 2075 7365 726e 616d 653d 7573       username=us
-0000c750: 6572 6e61 6d65 2c0a 2020 2020 2020 2020  ername,.        
-0000c760: 6973 5f61 646d 696e 3d69 735f 6164 6d69  is_admin=is_admi
-0000c770: 6e2c 0a20 2020 2020 2020 206d 6173 7175  n,.        masqu
-0000c780: 6572 6164 655f 6173 3d6d 6173 7175 6572  erade_as=masquer
-0000c790: 6164 655f 6173 2c0a 2020 2020 2020 2020  ade_as,.        
-0000c7a0: 6566 6665 6374 6976 655f 7573 6572 3d65  effective_user=e
-0000c7b0: 6666 6563 7469 7665 5f75 7365 722c 0a20  ffective_user,. 
-0000c7c0: 2020 2020 2020 2074 6172 6765 745f 7573         target_us
-0000c7d0: 6572 3d74 6172 6765 745f 7573 6572 2c0a  er=target_user,.
-0000c7e0: 2020 2020 2020 2020 7068 6173 653d 7068          phase=ph
-0000c7f0: 6173 652c 0a20 2020 2020 2020 2070 733d  ase,.        ps=
-0000c800: 7073 2c0a 2020 2020 2020 2020 7461 736b  ps,.        task
-0000c810: 3d74 6173 6b2c 0a20 2020 2020 2020 2074  =task,.        t
-0000c820: 6173 6b5f 696e 666f 3d74 6173 6b5f 696e  ask_info=task_in
-0000c830: 666f 2c0a 2020 2020 2020 2020 6662 5f63  fo,.        fb_c
-0000c840: 7373 3d70 6f74 6c75 636b 2e72 656e 6465  ss=potluck.rende
-0000c850: 722e 6765 745f 6373 7328 292c 0a20 2020  r.get_css(),.   
-0000c860: 2020 2020 2066 625f 6a73 3d70 6f74 6c75       fb_js=potlu
-0000c870: 636b 2e72 656e 6465 722e 6765 745f 6a73  ck.render.get_js
-0000c880: 2829 2c0a 2020 2020 2020 2020 7375 7070  (),.        supp
-0000c890: 6f72 745f 6c69 6e6b 3d61 7070 2e63 6f6e  ort_link=app.con
-0000c8a0: 6669 675b 2253 5550 504f 5254 5f4c 494e  fig["SUPPORT_LIN
-0000c8b0: 4b22 5d0a 2020 2020 290a 0a0a 4061 7070  K"].    )...@app
-0000c8c0: 2e72 6f75 7465 2827 2f3c 636f 7572 7365  .route('/<course
-0000c8d0: 3e2f 3c73 656d 6573 7465 723e 2f73 6f6c  >/<semester>/sol
-0000c8e0: 7574 696f 6e2f 3c70 7369 643e 2f3c 7461  ution/<psid>/<ta
-0000c8f0: 736b 6964 3e27 2c20 6d65 7468 6f64 733d  skid>', methods=
-0000c900: 5b27 4745 5427 5d29 0a40 666c 6173 6b5f  ['GET']).@flask_
-0000c910: 6361 732e 6c6f 6769 6e5f 7265 7175 6972  cas.login_requir
-0000c920: 6564 0a40 6175 676d 656e 745f 6172 6775  ed.@augment_argu
-0000c930: 6d65 6e74 730a 6465 6620 726f 7574 655f  ments.def route_
-0000c940: 736f 6c75 7469 6f6e 280a 2020 2020 636f  solution(.    co
-0000c950: 7572 7365 2c0a 2020 2020 7365 6d65 7374  urse,.    semest
-0000c960: 6572 2c0a 2020 2020 7073 6964 2c0a 2020  er,.    psid,.  
-0000c970: 2020 7461 736b 6964 2c0a 2020 2020 2320    taskid,.    # 
-0000c980: 4175 676d 656e 7465 6420 6172 6775 6d65  Augmented argume
-0000c990: 6e74 730a 2020 2020 7573 6572 6e61 6d65  nts.    username
-0000c9a0: 2c0a 2020 2020 6973 5f61 646d 696e 2c0a  ,.    is_admin,.
-0000c9b0: 2020 2020 6d61 7371 7565 7261 6465 5f61      masquerade_a
-0000c9c0: 732c 0a20 2020 2065 6666 6563 7469 7665  s,.    effective
-0000c9d0: 5f75 7365 722c 0a20 2020 2074 6173 6b5f  _user,.    task_
-0000c9e0: 696e 666f 0a29 3a0a 2020 2020 2222 220a  info.):.    """.
-0000c9f0: 2020 2020 5669 7369 626c 6520 6f6e 6c79      Visible only
-0000ca00: 206f 6e63 6520 6120 7461 736b 2773 2073   once a task's s
-0000ca10: 7461 7475 7320 6973 2066 696e 616c 2c20  tatus is final, 
-0000ca20: 6163 636f 756e 7469 6e67 2066 6f72 2061  accounting for a
-0000ca30: 6c6c 0a20 2020 2065 7874 656e 7369 6f6e  ll.    extension
-0000ca40: 732c 2061 6e64 2069 6620 7468 6520 6163  s, and if the ac
-0000ca50: 7469 7665 2075 7365 7220 6861 7320 616e  tive user has an
-0000ca60: 2065 7661 6c75 6174 6564 2073 7562 6d69   evaluated submi
-0000ca70: 7373 696f 6e20 666f 720a 2020 2020 7468  ssion for.    th
-0000ca80: 6520 7461 736b 2c20 6f72 2061 6e6f 7468  e task, or anoth
-0000ca90: 6572 2074 6173 6b20 696e 2074 6865 2073  er task in the s
-0000caa0: 616d 6520 706f 6f6c 2028 6f72 2069 6620  ame pool (or if 
-0000cab0: 7468 6579 2772 6520 616e 2061 646d 696e  they're an admin
-0000cac0: 292e 0a20 2020 2053 686f 7773 2074 6865  )..    Shows the
-0000cad0: 2073 6f6c 7574 696f 6e20 636f 6465 2066   solution code f
-0000cae0: 6f72 2061 2070 6172 7469 6375 6c61 7220  or a particular 
-0000caf0: 7461 736b 2c20 696e 636c 7564 696e 6720  task, including 
-0000cb00: 6120 666f 726d 6174 7465 640a 2020 2020  a formatted.    
-0000cb10: 7665 7273 696f 6e20 616e 6420 6120 6c69  version and a li
-0000cb20: 6e6b 2074 6f20 646f 776e 6c6f 6164 2074  nk to download t
-0000cb30: 6865 202e 7079 2066 696c 652e 0a20 2020  he .py file..   
-0000cb40: 2022 2222 0a20 2020 2074 7279 3a0a 2020   """.    try:.  
-0000cb50: 2020 2020 2020 7073 203d 2067 6574 5f70        ps = get_p
-0000cb60: 735f 6f62 6a28 7461 736b 5f69 6e66 6f2c  s_obj(task_info,
-0000cb70: 2070 7369 6429 0a20 2020 2065 7863 6570   psid).    excep
-0000cb80: 7420 5661 6c75 6545 7272 6f72 2061 7320  t ValueError as 
-0000cb90: 653a 0a20 2020 2020 2020 2066 6c61 736b  e:.        flask
-0000cba0: 2e66 6c61 7368 2822 5661 6c75 6545 7272  .flash("ValueErr
-0000cbb0: 6f72 3a20 2220 2b20 7374 7228 6529 290a  or: " + str(e)).
-0000cbc0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
-0000cbd0: 6f62 6163 6b28 636f 7572 7365 2c20 7365  oback(course, se
-0000cbe0: 6d65 7374 6572 290a 0a20 2020 2023 2041  mester)..    # A
-0000cbf0: 6464 2073 7461 7475 7320 2620 7469 6d65  dd status & time
-0000cc00: 2072 656d 6169 6e69 6e67 2069 6e66 6f20   remaining info 
-0000cc10: 746f 2070 7365 7420 616e 6420 6f62 6a65  to pset and obje
-0000cc20: 6374 730a 2020 2020 616d 656e 645f 7073  cts.    amend_ps
-0000cc30: 6574 2863 6f75 7273 652c 2073 656d 6573  et(course, semes
-0000cc40: 7465 722c 2074 6173 6b5f 696e 666f 2c20  ter, task_info, 
-0000cc50: 7073 2c20 6566 6665 6374 6976 655f 7573  ps, effective_us
-0000cc60: 6572 290a 0a20 2020 2023 2047 7261 6220  er)..    # Grab 
-0000cc70: 7461 736b 206f 626a 6563 7420 666f 7220  task object for 
-0000cc80: 7468 6973 2074 6173 6b0a 2020 2020 7472  this task.    tr
-0000cc90: 793a 0a20 2020 2020 2020 2074 6173 6b20  y:.        task 
-0000cca0: 3d20 6765 745f 7461 736b 5f6f 626a 2874  = get_task_obj(t
-0000ccb0: 6173 6b5f 696e 666f 2c20 7073 2c20 7461  ask_info, ps, ta
-0000ccc0: 736b 6964 290a 2020 2020 6578 6365 7074  skid).    except
-0000ccd0: 2056 616c 7565 4572 726f 7220 6173 2065   ValueError as e
-0000cce0: 3a0a 2020 2020 2020 2020 666c 6173 6b2e  :.        flask.
-0000ccf0: 666c 6173 6828 2256 616c 7565 4572 726f  flash("ValueErro
-0000cd00: 723a 2022 202b 2073 7472 2865 2929 0a20  r: " + str(e)). 
-0000cd10: 2020 2020 2020 2072 6574 7572 6e20 676f         return go
-0000cd20: 6261 636b 2863 6f75 7273 652c 2073 656d  back(course, sem
-0000cd30: 6573 7465 7229 0a0a 2020 2020 2320 4669  ester)..    # Fi
-0000cd40: 6e64 2074 6173 6b73 2069 6e20 7468 6520  nd tasks in the 
-0000cd50: 7361 6d65 2070 6f6f 6c20 6173 2074 6869  same pool as thi
-0000cd60: 7320 6f6e 653a 0a20 2020 2069 6620 2270  s one:.    if "p
-0000cd70: 6f6f 6c22 2069 6e20 7461 736b 3a0a 2020  ool" in task:.  
-0000cd80: 2020 2020 2020 7461 736b 735f 696e 5f70        tasks_in_p
-0000cd90: 6f6f 6c20 3d20 5b0a 2020 2020 2020 2020  ool = [.        
-0000cda0: 2020 2020 7465 6e74 7279 5b22 6964 225d      tentry["id"]
-0000cdb0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000cdc0: 2074 656e 7472 7920 696e 2070 735b 2274   tentry in ps["t
-0000cdd0: 6173 6b73 225d 0a20 2020 2020 2020 2020  asks"].         
-0000cde0: 2020 2069 6620 7465 6e74 7279 2e67 6574     if tentry.get
-0000cdf0: 2822 706f 6f6c 2229 203d 3d20 7461 736b  ("pool") == task
-0000ce00: 5b22 706f 6f6c 225d 0a20 2020 2020 2020  ["pool"].       
-0000ce10: 205d 0a20 2020 2065 6c73 653a 0a20 2020   ].    else:.   
-0000ce20: 2020 2020 2074 6173 6b73 5f69 6e5f 706f       tasks_in_po
-0000ce30: 6f6c 203d 205b 2074 6173 6b5b 2269 6422  ol = [ task["id"
-0000ce40: 5d20 5d0a 0a20 2020 2023 2047 7261 6220  ] ]..    # Grab 
-0000ce50: 7461 736b 206f 626a 6563 7473 2066 6f72  task objects for
-0000ce60: 2065 6163 6820 7461 736b 2069 6e20 6f75   each task in ou
-0000ce70: 7220 706f 6f6c 2061 6e64 2061 6d65 6e64  r pool and amend
-0000ce80: 2074 6865 6d3a 0a20 2020 2073 7562 6d69   them:.    submi
-0000ce90: 7474 6564 5f74 6f5f 706f 6f6c 203d 2046  tted_to_pool = F
-0000cea0: 616c 7365 0a20 2020 2066 6f72 2074 6173  alse.    for tas
-0000ceb0: 6b69 6420 696e 2074 6173 6b73 5f69 6e5f  kid in tasks_in_
-0000cec0: 706f 6f6c 3a0a 2020 2020 2020 2020 7472  pool:.        tr
-0000ced0: 793a 0a20 2020 2020 2020 2020 2020 2074  y:.            t
-0000cee0: 6f62 6a20 3d20 6765 745f 7461 736b 5f6f  obj = get_task_o
-0000cef0: 626a 2874 6173 6b5f 696e 666f 2c20 7073  bj(task_info, ps
-0000cf00: 2c20 7461 736b 6964 290a 2020 2020 2020  , taskid).      
-0000cf10: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
-0000cf20: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
-0000cf30: 2020 2020 2020 666c 6173 6b2e 666c 6173        flask.flas
-0000cf40: 6828 2256 616c 7565 4572 726f 723a 2022  h("ValueError: "
-0000cf50: 202b 2073 7472 2865 2929 0a20 2020 2020   + str(e)).     
-0000cf60: 2020 2020 2020 2072 6574 7572 6e20 676f         return go
-0000cf70: 6261 636b 2863 6f75 7273 652c 2073 656d  back(course, sem
-0000cf80: 6573 7465 7229 0a0a 2020 2020 2020 2020  ester)..        
-0000cf90: 696e 6974 6961 6c20 3d20 746f 626a 0a20  initial = tobj. 
-0000cfa0: 2020 2020 2020 2072 6576 6973 6564 203d         revised =
-0000cfb0: 2063 6f70 792e 6465 6570 636f 7079 2874   copy.deepcopy(t
-0000cfc0: 6f62 6a29 0a0a 2020 2020 2020 2020 616d  obj)..        am
-0000cfd0: 656e 645f 7461 736b 280a 2020 2020 2020  end_task(.      
-0000cfe0: 2020 2020 2020 636f 7572 7365 2c0a 2020        course,.  
-0000cff0: 2020 2020 2020 2020 2020 7365 6d65 7374            semest
-0000d000: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-0000d010: 7461 736b 5f69 6e66 6f2c 0a20 2020 2020  task_info,.     
-0000d020: 2020 2020 2020 2070 7369 642c 0a20 2020         psid,.   
-0000d030: 2020 2020 2020 2020 2069 6e69 7469 616c           initial
-0000d040: 2c0a 2020 2020 2020 2020 2020 2020 6566  ,.            ef
-0000d050: 6665 6374 6976 655f 7573 6572 2c0a 2020  fective_user,.  
-0000d060: 2020 2020 2020 2020 2020 2269 6e69 7469            "initi
-0000d070: 616c 220a 2020 2020 2020 2020 290a 2020  al".        ).  
-0000d080: 2020 2020 2020 6966 2069 6e69 7469 616c        if initial
-0000d090: 2e67 6574 2822 7375 626d 6974 7465 6422  .get("submitted"
-0000d0a0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000d0b0: 7562 6d69 7474 6564 5f74 6f5f 706f 6f6c  ubmitted_to_pool
-0000d0c0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0000d0d0: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
-0000d0e0: 2020 2061 6d65 6e64 5f74 6173 6b28 0a20     amend_task(. 
-0000d0f0: 2020 2020 2020 2020 2020 2063 6f75 7273             cours
-0000d100: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-0000d110: 656d 6573 7465 722c 0a20 2020 2020 2020  emester,.       
-0000d120: 2020 2020 2074 6173 6b5f 696e 666f 2c0a       task_info,.
-0000d130: 2020 2020 2020 2020 2020 2020 7073 6964              psid
-0000d140: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
-0000d150: 7669 7365 642c 0a20 2020 2020 2020 2020  vised,.         
-0000d160: 2020 2065 6666 6563 7469 7665 5f75 7365     effective_use
-0000d170: 722c 0a20 2020 2020 2020 2020 2020 2022  r,.            "
-0000d180: 7265 7669 7369 6f6e 220a 2020 2020 2020  revision".      
-0000d190: 2020 290a 2020 2020 2020 2020 6966 2072    ).        if r
-0000d1a0: 6576 6973 6564 2e67 6574 2822 7375 626d  evised.get("subm
-0000d1b0: 6974 7465 6422 293a 0a20 2020 2020 2020  itted"):.       
-0000d1c0: 2020 2020 2073 7562 6d69 7474 6564 5f74       submitted_t
-0000d1d0: 6f5f 706f 6f6c 203d 2054 7275 650a 2020  o_pool = True.  
-0000d1e0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-0000d1f0: 0a20 2020 2023 2043 6865 636b 2072 6f73  .    # Check ros
-0000d200: 7465 7220 736f 2074 6861 7420 6f6e 6c79  ter so that only
-0000d210: 2073 7475 6465 6e74 7320 6f6e 2074 6865   students on the
-0000d220: 2072 6f73 7465 7220 6361 6e20 7669 6577   roster can view
-0000d230: 2073 6f6c 7574 696f 6e73 0a20 2020 2023   solutions.    #
-0000d240: 2028 7765 2064 6f6e 2774 2077 616e 7420   (we don't want 
-0000d250: 6675 7475 7265 2d73 656d 6573 7465 7220  future-semester 
-0000d260: 7374 7564 656e 7473 2076 6965 7769 6e67  students viewing
-0000d270: 2070 7265 7669 6f75 732d 7365 6d65 7374   previous-semest
-0000d280: 6572 0a20 2020 2023 2073 6f6c 7574 696f  er.    # solutio
-0000d290: 6e73 2129 2e0a 2020 2020 7472 793a 0a20  ns!)..    try:. 
-0000d2a0: 2020 2020 2020 2072 6f73 7465 7220 3d20         roster = 
-0000d2b0: 7374 6f72 6167 652e 6765 745f 726f 7374  storage.get_rost
-0000d2c0: 6572 2863 6f75 7273 652c 2073 656d 6573  er(course, semes
-0000d2d0: 7465 7229 0a20 2020 2065 7863 6570 7420  ter).    except 
-0000d2e0: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-0000d2f0: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
-0000d300: 6173 6828 7374 7228 6529 290a 2020 2020  ash(str(e)).    
-0000d310: 2020 2020 726f 7374 6572 203d 204e 6f6e      roster = Non
-0000d320: 650a 0a20 2020 2069 6620 726f 7374 6572  e..    if roster
-0000d330: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000d340: 2020 6d73 6720 3d20 2246 6169 6c65 6420    msg = "Failed 
-0000d350: 746f 206c 6f61 6420 3c63 6f64 653e 726f  to load <code>ro
-0000d360: 7374 6572 2e63 7376 3c2f 636f 6465 3e2e  ster.csv</code>.
-0000d370: 220a 2020 2020 2020 2020 666c 6173 6b2e  ".        flask.
-0000d380: 666c 6173 6828 6d73 6729 0a20 2020 2020  flash(msg).     
-0000d390: 2020 2072 6574 7572 6e20 6572 726f 725f     return error_
-0000d3a0: 7265 7370 6f6e 7365 2863 6f75 7273 652c  response(course,
-0000d3b0: 2073 656d 6573 7465 722c 2075 7365 726e   semester, usern
-0000d3c0: 616d 652c 206d 7367 290a 0a20 2020 2069  ame, msg)..    i
-0000d3d0: 6620 7073 5b22 7374 6174 7573 225d 5b22  f ps["status"]["
-0000d3e0: 7374 6174 6522 5d20 213d 2022 6669 6e61  state"] != "fina
-0000d3f0: 6c22 3a0a 2020 2020 2020 2020 6966 2069  l":.        if i
-0000d400: 735f 6164 6d69 6e3a 0a20 2020 2020 2020  s_admin:.       
-0000d410: 2020 2020 2066 6c61 736b 2e66 6c61 7368       flask.flash
-0000d420: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d430: 2020 2256 6965 7769 6e67 2073 6f6c 7574    "Viewing solut
-0000d440: 696f 6e20 636f 6465 2061 7320 6164 6d69  ion code as admi
-0000d450: 6e3b 2073 6f6c 7574 696f 6e20 6973 206e  n; solution is n
-0000d460: 6f74 220a 2020 2020 2020 2020 2020 2020  ot".            
-0000d470: 2020 2b20 2220 7669 7369 626c 6520 746f    + " visible to
-0000d480: 2073 7475 6465 6e74 7320 756e 7469 6c20   students until 
-0000d490: 7265 7669 7369 6f6e 2070 6572 696f 6420  revision period 
-0000d4a0: 6973 206f 7665 722e 220a 2020 2020 2020  is over.".      
-0000d4b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000d4c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000d4d0: 2020 666c 6173 6b2e 666c 6173 6828 0a20    flask.flash(. 
-0000d4e0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000d4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d500: 2020 2020 2022 596f 7520 6361 6e6e 6f74       "You cannot
-0000d510: 2076 6965 7720 7468 6520 736f 6c75 7469   view the soluti
-0000d520: 6f6e 7320 666f 7220 7b70 7365 747d 207b  ons for {pset} {
-0000d530: 7461 736b 7d22 0a20 2020 2020 2020 2020  task}".         
-0000d540: 2020 2020 2020 2020 202b 2022 2075 6e74           + " unt
-0000d550: 696c 2074 6865 2072 6576 6973 696f 6e20  il the revision 
-0000d560: 7065 7269 6f64 2069 7320 6f76 6572 2e22  period is over."
-0000d570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d580: 2029 2e66 6f72 6d61 7428 7073 6574 3d70   ).format(pset=p
-0000d590: 7369 642c 2074 6173 6b3d 7461 736b 6964  sid, task=taskid
-0000d5a0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-0000d5b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d5c0: 726e 2067 6f62 6163 6b28 636f 7572 7365  rn goback(course
-0000d5d0: 2c20 7365 6d65 7374 6572 290a 0a20 2020  , semester)..   
-0000d5e0: 2065 6c69 6620 6566 6665 6374 6976 655f   elif effective_
-0000d5f0: 7573 6572 206e 6f74 2069 6e20 726f 7374  user not in rost
-0000d600: 6572 3a20 2320 6e6f 7420 6f6e 2074 6865  er: # not on the
-0000d610: 2072 6f73 7465 720a 2020 2020 2020 2020   roster.        
-0000d620: 6966 2069 735f 6164 6d69 6e3a 0a20 2020  if is_admin:.   
-0000d630: 2020 2020 2020 2020 2066 6c61 736b 2e66           flask.f
-0000d640: 6c61 7368 280a 2020 2020 2020 2020 2020  lash(.          
-0000d650: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-0000d660: 2020 2020 2020 2020 2020 2020 2256 6965              "Vie
-0000d670: 7769 6e67 2073 6f6c 7574 696f 6e20 636f  wing solution co
-0000d680: 6465 2061 7320 6164 6d69 6e3b 2073 6f6c  de as admin; sol
-0000d690: 7574 696f 6e20 6973 206e 6f74 220a 2020  ution is not".  
-0000d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6b0: 2b20 2220 7669 7369 626c 6520 746f 2075  + " visible to u
-0000d6c0: 7365 7220 7b7d 2061 7320 7468 6579 2061  ser {} as they a
-0000d6d0: 7265 206e 6f74 206f 6e20 7468 6520 726f  re not on the ro
-0000d6e0: 7374 6572 220a 2020 2020 2020 2020 2020  ster".          
-0000d6f0: 2020 2020 2020 2020 2b20 2220 666f 7220          + " for 
-0000d700: 7468 6973 2063 6f75 7273 652f 7365 6d65  this course/seme
-0000d710: 7374 6572 2e22 0a20 2020 2020 2020 2020  ster.".         
-0000d720: 2020 2020 2020 2029 2e66 6f72 6d61 7428         ).format(
-0000d730: 6566 6665 6374 6976 655f 7573 6572 290a  effective_user).
-0000d740: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000d750: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000d760: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
-0000d770: 6173 6828 0a20 2020 2020 2020 2020 2020  ash(.           
-0000d780: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-0000d790: 2020 2020 2020 2020 2020 2022 596f 7520             "You 
-0000d7a0: 6361 6e6e 6f74 2076 6965 7720 736f 6c75  cannot view solu
-0000d7b0: 7469 6f6e 7320 666f 7220 7b63 6f75 7273  tions for {cours
-0000d7c0: 657d 207b 7365 6d65 7374 6572 7d22 0a20  e} {semester}". 
-0000d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7e0: 202b 2022 2062 6563 6175 7365 2079 6f75   + " because you
-0000d7f0: 2061 7265 206e 6f74 206f 6e20 7468 6520   are not on the 
-0000d800: 726f 7374 6572 2066 6f72 2074 6861 7420  roster for that 
-0000d810: 636c 6173 732e 220a 2020 2020 2020 2020  class.".        
-0000d820: 2020 2020 2020 2020 292e 666f 726d 6174          ).format
-0000d830: 2863 6f75 7273 653d 636f 7572 7365 2c20  (course=course, 
-0000d840: 7365 6d65 7374 6572 3d73 656d 6573 7465  semester=semeste
-0000d850: 7229 0a20 2020 2020 2020 2020 2020 2029  r).            )
-0000d860: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000d870: 7572 6e20 676f 6261 636b 2863 6f75 7273  urn goback(cours
-0000d880: 652c 2073 656d 6573 7465 7229 0a0a 2020  e, semester)..  
-0000d890: 2020 656c 6966 206e 6f74 2028 0a20 2020    elif not (.   
-0000d8a0: 2020 2020 2061 7070 2e63 6f6e 6669 672e       app.config.
-0000d8b0: 6765 7428 2244 4953 504c 4159 5f55 4e53  get("DISPLAY_UNS
-0000d8c0: 5542 4d49 5454 4544 5f53 4f4c 5554 494f  UBMITTED_SOLUTIO
-0000d8d0: 4e53 2229 0a20 2020 2020 6f72 2073 7562  NS").     or sub
-0000d8e0: 6d69 7474 6564 5f74 6f5f 706f 6f6c 0a20  mitted_to_pool. 
-0000d8f0: 2020 2029 3a0a 2020 2020 2020 2020 2320     ):.        # 
-0000d900: 5468 6973 2075 7365 7220 6861 736e 2774  This user hasn't
-0000d910: 2073 7562 6d69 7474 6564 2074 6869 7320   submitted this 
-0000d920: 7461 736b 2c20 736f 2077 6527 6420 6c69  task, so we'd li
-0000d930: 6b65 2074 6f20 6d61 6b65 2069 740a 2020  ke to make it.  
-0000d940: 2020 2020 2020 2320 706f 7373 6962 6c65        # possible
-0000d950: 2066 6f72 2074 6865 6d20 746f 2067 6574   for them to get
-0000d960: 2061 6e20 6578 7465 6e73 696f 6e20 6c61   an extension la
-0000d970: 7465 7220 7769 7468 6f75 7420 776f 7272  ter without worr
-0000d980: 7969 6e67 2061 626f 7574 0a20 2020 2020  ying about.     
-0000d990: 2020 2023 2077 6865 7468 6572 2074 6865     # whether the
-0000d9a0: 7927 7665 2061 6363 6573 7365 6420 736f  y've accessed so
-0000d9b0: 6c75 7469 6f6e 2063 6f64 6520 696e 2074  lution code in t
-0000d9c0: 6865 206d 6561 6e20 7469 6d65 2e0a 2020  he mean time..  
-0000d9d0: 2020 2020 2020 6966 2069 735f 6164 6d69        if is_admi
-0000d9e0: 6e3a 0a20 2020 2020 2020 2020 2020 2066  n:.            f
-0000d9f0: 6c61 736b 2e66 6c61 7368 280a 2020 2020  lask.flash(.    
-0000da00: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-0000da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da20: 2020 2256 6965 7769 6e67 2073 6f6c 7574    "Viewing solut
-0000da30: 696f 6e20 636f 6465 2061 7320 6164 6d69  ion code as admi
-0000da40: 6e3b 2073 6f6c 7574 696f 6e20 6973 206e  n; solution is n
-0000da50: 6f74 220a 2020 2020 2020 2020 2020 2020  ot".            
-0000da60: 2020 2020 2020 2b20 2220 7669 7369 626c        + " visibl
-0000da70: 6520 746f 2075 7365 7220 7b7d 2061 7320  e to user {} as 
-0000da80: 7468 6579 2064 6f6e 2774 2068 6176 6520  they don't have 
-0000da90: 6120 7375 626d 6973 7369 6f6e 220a 2020  a submission".  
-0000daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dab0: 2b20 2220 666f 7220 7468 6973 2074 6173  + " for this tas
-0000dac0: 6b20 6f72 2061 6e6f 7468 6572 2074 6173  k or another tas
-0000dad0: 6b20 696e 2074 6869 7320 706f 6f6c 2e22  k in this pool."
-0000dae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000daf0: 2029 2e66 6f72 6d61 7428 6566 6665 6374   ).format(effect
-0000db00: 6976 655f 7573 6572 290a 2020 2020 2020  ive_user).      
-0000db10: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000db20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000db30: 2020 666c 6173 6b2e 666c 6173 6828 0a20    flask.flash(. 
-0000db40: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000db50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000db60: 2020 2020 2022 596f 7520 6361 6e6e 6f74       "You cannot
-0000db70: 2076 6965 7720 7468 6520 736f 6c75 7469   view the soluti
-0000db80: 6f6e 2066 6f72 207b 7d20 7b7d 2062 6563  on for {} {} bec
-0000db90: 7561 7365 2079 6f75 220a 2020 2020 2020  uase you".      
-0000dba0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-0000dbb0: 6861 7665 6e27 7420 7375 626d 6974 7465  haven't submitte
-0000dbc0: 6420 7468 6174 2074 6173 6b20 6f72 2061  d that task or a
-0000dbd0: 6e79 2074 6173 6b20 696e 2074 6865 220a  ny task in the".
-0000dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbf0: 2020 2020 2220 7361 6d65 2070 6f6f 6c2e      " same pool.
-0000dc00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000dc10: 2020 292e 666f 726d 6174 2870 7369 642c    ).format(psid,
-0000dc20: 2074 6173 6b69 6429 0a20 2020 2020 2020   taskid).       
-0000dc30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000dc40: 2020 2072 6574 7572 6e20 676f 6261 636b     return goback
-0000dc50: 2863 6f75 7273 652c 2073 656d 6573 7465  (course, semeste
-0000dc60: 7229 0a0a 2020 2020 2320 4174 2074 6869  r)..    # At thi
-0000dc70: 7320 706f 696e 742c 2077 6527 7665 2076  s point, we've v
-0000dc80: 6572 6966 6965 6420 6974 2773 206f 6b61  erified it's oka
-0000dc90: 7920 746f 2064 6973 706c 6179 2074 6865  y to display the
-0000dca0: 2073 6f6c 7574 696f 6e3a 0a20 2020 2023   solution:.    #
-0000dcb0: 2074 6865 2070 7365 7420 6973 2066 696e   the pset is fin
-0000dcc0: 616c 697a 6564 2c20 616e 6420 7468 6520  alized, and the 
-0000dcd0: 7573 6572 2069 7320 616e 2061 646d 696e  user is an admin
-0000dce0: 206f 7220 6174 206c 6561 7374 206f 6e20   or at least on 
-0000dcf0: 7468 650a 2020 2020 2320 726f 7374 6572  the.    # roster
-0000dd00: 2066 6f72 2074 6869 7320 7061 7274 6963   for this partic
-0000dd10: 756c 6172 2063 6f75 7273 652f 7365 6d65  ular course/seme
-0000dd20: 7374 6572 2c20 616e 6420 7468 6520 7573  ster, and the us
-0000dd30: 6572 2068 6173 2061 0a20 2020 2023 2073  er has a.    # s
-0000dd40: 7562 6d69 7373 696f 6e20 666f 7220 7468  ubmission for th
-0000dd50: 6973 2074 6173 6b2c 206f 7220 6174 206c  is task, or at l
-0000dd60: 6561 7374 2074 6f20 616e 6f74 6865 7220  east to another 
-0000dd70: 7461 736b 2069 6e20 7468 6520 7361 6d65  task in the same
-0000dd80: 0a20 2020 2023 2070 6f6f 6c2e 0a0a 2020  .    # pool...  
-0000dd90: 2020 2320 5765 2764 206c 696b 6520 7468    # We'd like th
-0000dda0: 6520 6665 6564 6261 636b 2043 5353 2026  e feedback CSS &
-0000ddb0: 204a 5320 6265 6361 7573 6520 7765 2772   JS because we'r
-0000ddc0: 6520 676f 696e 6720 746f 2072 656e 6465  e going to rende
-0000ddd0: 7220 636f 6465 0a20 2020 2023 2061 7320  r code.    # as 
-0000dde0: 4854 4d4c 2075 7369 6e67 2070 6f74 6c75  HTML using potlu
-0000ddf0: 636b 2e0a 2020 2020 6662 5f63 7373 203d  ck..    fb_css =
-0000de00: 2070 6f74 6c75 636b 2e72 656e 6465 722e   potluck.render.
-0000de10: 6765 745f 6373 7328 290a 2020 2020 6662  get_css().    fb
-0000de20: 5f6a 7320 3d20 706f 746c 7563 6b2e 7265  _js = potluck.re
-0000de30: 6e64 6572 2e67 6574 5f6a 7328 290a 0a20  nder.get_js().. 
-0000de40: 2020 2023 2054 4f44 4f3a 2054 6869 7320     # TODO: This 
-0000de50: 6665 656c 7320 6120 6269 7420 6861 7264  feels a bit hard
-0000de60: 636f 6465 642e 2e2e 2063 616e 2077 6520  coded... can we 
-0000de70: 646f 2062 6574 7465 723f 0a20 2020 2023  do better?.    #
-0000de80: 2054 4f44 4f3a 204d 756c 7469 2d66 696c   TODO: Multi-fil
-0000de90: 6520 7374 7566 6621 0a20 2020 2073 6f6c  e stuff!.    sol
-0000dea0: 6e5f 6669 6c65 6e61 6d65 203d 206f 732e  n_filename = os.
-0000deb0: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
-0000dec0: 2020 2073 746f 7261 6765 2e65 7661 6c75     storage.evalu
-0000ded0: 6174 696f 6e5f 6469 7265 6374 6f72 7928  ation_directory(
-0000dee0: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
-0000def0: 292c 0a20 2020 2020 2020 2022 7370 6563  ),.        "spec
-0000df00: 7322 2c0a 2020 2020 2020 2020 7461 736b  s",.        task
-0000df10: 5b22 6964 225d 2c0a 2020 2020 2020 2020  ["id"],.        
-0000df20: 2273 6f6c 6e22 2c0a 2020 2020 2020 2020  "soln",.        
-0000df30: 7461 736b 5b22 7461 7267 6574 225d 0a20  task["target"]. 
-0000df40: 2020 2029 0a0a 2020 2020 7769 7468 206f     )..    with o
-0000df50: 7065 6e28 736f 6c6e 5f66 696c 656e 616d  pen(soln_filenam
-0000df60: 652c 2027 7227 2920 6173 2066 696e 3a0a  e, 'r') as fin:.
-0000df70: 2020 2020 2020 2020 736f 6c6e 5f63 6f64          soln_cod
-0000df80: 6520 3d20 6669 6e2e 7265 6164 2829 0a0a  e = fin.read()..
-0000df90: 2020 2020 736f 6c6e 5f63 6f64 655f 6874      soln_code_ht
-0000dfa0: 6d6c 203d 2070 6f74 6c75 636b 2e72 656e  ml = potluck.ren
-0000dfb0: 6465 722e 7265 6e64 6572 5f63 6f64 6528  der.render_code(
-0000dfc0: 0a20 2020 2020 2020 2074 6173 6b69 642c  .        taskid,
-0000dfd0: 0a20 2020 2020 2020 2073 6f6c 6e5f 6669  .        soln_fi
-0000dfe0: 6c65 6e61 6d65 2c0a 2020 2020 2020 2020  lename,.        
-0000dff0: 736f 6c6e 5f63 6f64 650a 2020 2020 290a  soln_code.    ).
-0000e000: 0a20 2020 2072 6574 7572 6e20 666c 6173  .    return flas
-0000e010: 6b2e 7265 6e64 6572 5f74 656d 706c 6174  k.render_templat
-0000e020: 6528 0a20 2020 2020 2020 2027 736f 6c75  e(.        'solu
-0000e030: 7469 6f6e 2e6a 3227 2c0a 2020 2020 2020  tion.j2',.      
-0000e040: 2020 636f 7572 7365 5f6e 616d 653d 6170    course_name=ap
-0000e050: 702e 636f 6e66 6967 2e67 6574 2822 434f  p.config.get("CO
-0000e060: 5552 5345 5f4e 414d 4553 222c 207b 7d29  URSE_NAMES", {})
-0000e070: 2e67 6574 2863 6f75 7273 652c 2063 6f75  .get(course, cou
-0000e080: 7273 6529 2c0a 2020 2020 2020 2020 636f  rse),.        co
-0000e090: 7572 7365 3d63 6f75 7273 652c 0a20 2020  urse=course,.   
-0000e0a0: 2020 2020 2073 656d 6573 7465 723d 7365       semester=se
-0000e0b0: 6d65 7374 6572 2c0a 2020 2020 2020 2020  mester,.        
-0000e0c0: 7573 6572 6e61 6d65 3d75 7365 726e 616d  username=usernam
-0000e0d0: 652c 0a20 2020 2020 2020 2069 735f 6164  e,.        is_ad
-0000e0e0: 6d69 6e3d 6973 5f61 646d 696e 2c0a 2020  min=is_admin,.  
-0000e0f0: 2020 2020 2020 6d61 7371 7565 7261 6465        masquerade
-0000e100: 5f61 733d 6d61 7371 7565 7261 6465 5f61  _as=masquerade_a
-0000e110: 732c 0a20 2020 2020 2020 2065 6666 6563  s,.        effec
-0000e120: 7469 7665 5f75 7365 723d 6566 6665 6374  tive_user=effect
-0000e130: 6976 655f 7573 6572 2c0a 2020 2020 2020  ive_user,.      
-0000e140: 2020 7073 3d70 732c 0a20 2020 2020 2020    ps=ps,.       
-0000e150: 2074 6173 6b3d 7461 736b 2c0a 2020 2020   task=task,.    
-0000e160: 2020 2020 7461 736b 5f69 6e66 6f3d 7461      task_info=ta
-0000e170: 736b 5f69 6e66 6f2c 0a20 2020 2020 2020  sk_info,.       
-0000e180: 2073 6f6c 6e5f 636f 6465 3d73 6f6c 6e5f   soln_code=soln_
-0000e190: 636f 6465 2c0a 2020 2020 2020 2020 7265  code,.        re
-0000e1a0: 6e64 6572 6564 5f73 6f6c 6e3d 736f 6c6e  ndered_soln=soln
-0000e1b0: 5f63 6f64 655f 6874 6d6c 2c0a 2020 2020  _code_html,.    
-0000e1c0: 2020 2020 6662 5f63 7373 3d66 625f 6373      fb_css=fb_cs
-0000e1d0: 732c 0a20 2020 2020 2020 2066 625f 6a73  s,.        fb_js
-0000e1e0: 3d66 625f 6a73 2c0a 2020 2020 2020 2020  =fb_js,.        
-0000e1f0: 7375 7070 6f72 745f 6c69 6e6b 3d61 7070  support_link=app
-0000e200: 2e63 6f6e 6669 675b 2253 5550 504f 5254  .config["SUPPORT
-0000e210: 5f4c 494e 4b22 5d0a 2020 2020 290a 0a0a  _LINK"].    )...
-0000e220: 4061 7070 2e72 6f75 7465 280a 2020 2020  @app.route(.    
-0000e230: 272f 3c63 6f75 7273 653e 2f3c 7365 6d65  '/<course>/<seme
-0000e240: 7374 6572 3e2f 7374 6172 7465 722f 3c74  ster>/starter/<t
-0000e250: 6173 6b69 643e 2e7a 6970 272c 0a20 2020  askid>.zip',.   
-0000e260: 206d 6574 686f 6473 3d5b 2747 4554 275d   methods=['GET']
-0000e270: 0a29 0a40 666c 6173 6b5f 6361 732e 6c6f  .).@flask_cas.lo
-0000e280: 6769 6e5f 7265 7175 6972 6564 0a64 6566  gin_required.def
-0000e290: 2072 6f75 7465 5f73 7461 7274 6572 5f7a   route_starter_z
-0000e2a0: 6970 2863 6f75 7273 652c 2073 656d 6573  ip(course, semes
-0000e2b0: 7465 722c 2074 6173 6b69 6429 3a0a 2020  ter, taskid):.  
-0000e2c0: 2020 2222 220a 2020 2020 466f 7220 6561    """.    For ea
-0000e2d0: 6368 2074 6173 6b2c 2073 6572 7665 7320  ch task, serves 
-0000e2e0: 6120 6361 6368 6564 2063 6f70 7920 6f66  a cached copy of
-0000e2f0: 2061 207a 6970 2066 696c 6520 7468 6174   a zip file that
-0000e300: 2069 6e63 6c75 6465 7320 616c 6c0a 2020   includes all.  
-0000e310: 2020 6669 6c65 7320 696e 2074 6861 7420    files in that 
-0000e320: 7461 736b 2773 2073 7461 7274 6572 2064  task's starter d
-0000e330: 6972 6563 746f 7279 2028 2b20 7375 6264  irectory (+ subd
-0000e340: 6972 6563 746f 7269 6573 2c20 696e 636c  irectories, incl
-0000e350: 7564 696e 670a 2020 2020 6f6e 6573 2074  uding.    ones t
-0000e360: 6861 7420 6172 6520 7379 6d6c 696e 6b73  hat are symlinks
-0000e370: 292e 2049 6620 7468 6520 6361 6368 6564  ). If the cached
-0000e380: 207a 6970 2064 6f65 7320 6e6f 7420 6578   zip does not ex
-0000e390: 6973 742c 206f 7220 6966 2069 7427 730a  ist, or if it's.
-0000e3a0: 2020 2020 6f6c 6465 7220 7468 616e 2061      older than a
-0000e3b0: 6e79 206f 6620 7468 6520 6669 6c65 7320  ny of the files 
-0000e3c0: 6974 206e 6565 6473 2074 6f20 696e 636c  it needs to incl
-0000e3d0: 7564 652c 2069 7420 7769 6c6c 2062 650a  ude, it will be.
-0000e3e0: 2020 2020 6765 6e65 7261 7465 642e 0a0a      generated...
-0000e3f0: 2020 2020 605f 5f70 7963 6163 6865 5f5f      `__pycache__
-0000e400: 6020 6469 7265 6374 6f72 6965 7320 616e  ` directories an
-0000e410: 6420 616e 7920 6669 6c65 7320 7468 6579  d any files they
-0000e420: 2063 6f6e 7461 696e 2077 696c 6c20 6e6f   contain will no
-0000e430: 7420 6265 0a20 2020 2069 6e63 6c75 6465  t be.    include
-0000e440: 6420 696e 2074 6865 207a 6970 2066 696c  d in the zip fil
-0000e450: 652e 2054 6865 7265 2069 7320 6120 636f  e. There is a co
-0000e460: 6e66 6967 7572 6162 6c65 206d 6178 696d  nfigurable maxim
-0000e470: 756d 206e 756d 6265 7220 6f66 0a20 2020  um number of.   
-0000e480: 2066 696c 6573 2c20 746f 2068 656c 7020   files, to help 
-0000e490: 6465 7465 6374 2069 7373 7565 7320 6361  detect issues ca
-0000e4a0: 7573 6564 2062 7920 6379 636c 6963 2073  used by cyclic s
-0000e4b0: 796d 626f 6c69 6320 6c69 6e6b 733b 2073  ymbolic links; s
-0000e4c0: 6574 0a20 2020 2060 4d41 585f 5354 4152  et.    `MAX_STAR
-0000e4d0: 5445 525f 4649 4c45 5360 2074 6f20 6d6f  TER_FILES` to mo
-0000e4e0: 6469 6679 2074 6869 7320 6672 6f6d 2074  dify this from t
-0000e4f0: 6865 2064 6566 6175 6c74 206f 6620 3130  he default of 10
-0000e500: 3030 3030 2028 7768 6963 680a 2020 2020  0000 (which.    
-0000e510: 6973 2070 726f 6261 626c 7920 616c 7265  is probably alre
-0000e520: 6164 7920 656e 6f75 6768 2074 6861 7420  ady enough that 
-0000e530: 756e 7a69 7070 696e 6720 776f 756c 6420  unzipping would 
-0000e540: 6265 2070 726f 626c 656d 6174 6963 3f29  be problematic?)
-0000e550: 2e0a 0a20 2020 2052 6169 7365 7320 616e  ...    Raises an
-0000e560: 2060 4f53 4572 726f 7260 2069 6620 746f   `OSError` if to
-0000e570: 6f20 6d61 6e79 2066 696c 6573 2061 7265  o many files are
-0000e580: 2070 7265 7365 6e74 2e0a 2020 2020 2222   present..    ""
-0000e590: 220a 2020 2020 2320 544f 444f 3a20 5468  ".    # TODO: Th
-0000e5a0: 6973 2066 6565 6c73 2061 2062 6974 2068  is feels a bit h
-0000e5b0: 6172 6463 6f64 6564 2e2e 2e20 6361 6e20  ardcoded... can 
-0000e5c0: 7765 2064 6f20 6265 7474 6572 3f0a 2020  we do better?.  
-0000e5d0: 2020 2320 436f 6d70 7574 6520 6669 6c65    # Compute file
-0000e5e0: 6e61 6d65 7320 616e 6420 6469 7265 6374  names and direct
-0000e5f0: 6f72 6965 730a 2020 2020 7374 6172 7465  ories.    starte
-0000e600: 725f 6469 7220 3d20 6f73 2e70 6174 682e  r_dir = os.path.
-0000e610: 6a6f 696e 280a 2020 2020 2020 2020 7374  join(.        st
-0000e620: 6f72 6167 652e 6576 616c 7561 7469 6f6e  orage.evaluation
-0000e630: 5f64 6972 6563 746f 7279 2863 6f75 7273  _directory(cours
-0000e640: 652c 2073 656d 6573 7465 7229 2c0a 2020  e, semester),.  
-0000e650: 2020 2020 2020 2273 7065 6373 222c 0a20        "specs",. 
-0000e660: 2020 2020 2020 2074 6173 6b69 642c 0a20         taskid,. 
-0000e670: 2020 2020 2020 2022 7374 6172 7465 7222         "starter"
-0000e680: 0a20 2020 2029 0a0a 2020 2020 2320 5765  .    )..    # We
-0000e690: 2027 6465 7465 6374 2720 7379 6d6c 696e   'detect' symlin
-0000e6a0: 6b20 6c6f 6f70 7320 7769 7468 6f75 7420  k loops without 
-0000e6b0: 646f 696e 6720 736f 6d65 7468 696e 6720  doing something 
-0000e6c0: 6c69 6b65 2073 7461 7469 6e67 2065 6163  like stating eac
-0000e6d0: 680a 2020 2020 2320 6469 7265 6374 6f72  h.    # director
-0000e6e0: 7920 616c 6f6e 6720 7468 6520 7761 7920  y along the way 
-0000e6f0: 6279 2075 7369 6e67 2061 206d 6178 2023  by using a max #
-0000e700: 206f 6620 6669 6c65 7320 2874 6865 207a   of files (the z
-0000e710: 6970 2077 6f75 6c64 0a20 2020 2023 2062  ip would.    # b
-0000e720: 6563 6f6d 6520 756e 6d61 6e61 6765 6162  ecome unmanageab
-0000e730: 6c65 2061 7420 736f 6d65 2070 6f69 6e74  le at some point
-0000e740: 2061 6e79 7761 7973 0a20 2020 206d 6178   anyways.    max
-0000e750: 5f73 7461 7274 6572 5f66 696c 6573 203d  _starter_files =
-0000e760: 2061 7070 2e63 6f6e 6669 672e 6765 7428   app.config.get(
-0000e770: 224d 4158 5f53 5441 5254 4552 5f46 494c  "MAX_STARTER_FIL
-0000e780: 4553 222c 2031 3030 3030 3029 0a0a 2020  ES", 100000)..  
-0000e790: 2020 2320 4e6f 7465 3a20 6120 7379 6d6c    # Note: a syml
-0000e7a0: 696e 6b2d 746f 2d61 6e2d 616e 6365 7374  ink-to-an-ancest
-0000e7b0: 6f72 2077 696c 6c20 6361 7573 6520 616e  or will cause an
-0000e7c0: 2069 6e66 696e 6974 6520 6c6f 6f70 2068   infinite loop h
-0000e7d0: 6572 652e 0a20 2020 2073 7461 7274 6572  ere..    starter
-0000e7e0: 5f66 696c 6573 203d 205b 5d0a 2020 2020  _files = [].    
-0000e7f0: 666f 7220 6469 7270 6174 682c 2064 6972  for dirpath, dir
-0000e800: 6e61 6d65 732c 2066 696c 656e 616d 6573  names, filenames
-0000e810: 2069 6e20 6f73 2e77 616c 6b28 0a20 2020   in os.walk(.   
-0000e820: 2020 2020 2073 7461 7274 6572 5f64 6972       starter_dir
-0000e830: 2c0a 2020 2020 2020 2020 666f 6c6c 6f77  ,.        follow
-0000e840: 6c69 6e6b 733d 5472 7565 0a20 2020 2029  links=True.    )
-0000e850: 3a0a 2020 2020 2020 2020 2320 446f 6e27  :.        # Don'
-0000e860: 7420 696e 636c 7564 6520 5f5f 7079 6361  t include __pyca
-0000e870: 6368 655f 5f20 6469 7265 6374 6f72 6965  che__ directorie
-0000e880: 730a 2020 2020 2020 2020 6966 2027 5f5f  s.        if '__
-0000e890: 7079 6361 6368 655f 5f27 2069 6e20 6469  pycache__' in di
-0000e8a0: 726e 616d 6573 3a0a 2020 2020 2020 2020  rnames:.        
-0000e8b0: 2020 2020 6469 726e 616d 6573 2e72 656d      dirnames.rem
-0000e8c0: 6f76 6528 275f 5f70 7963 6163 6865 5f5f  ove('__pycache__
-0000e8d0: 2729 0a0a 2020 2020 2020 2020 666f 7220  ')..        for 
-0000e8e0: 6669 6c65 6e61 6d65 2069 6e20 6669 6c65  filename in file
-0000e8f0: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
-0000e900: 2020 2073 7461 7274 6572 5f66 696c 6573     starter_files
-0000e910: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
-0000e920: 2020 2020 2020 2020 206f 732e 7061 7468           os.path
-0000e930: 2e72 656c 7061 7468 286f 732e 7061 7468  .relpath(os.path
-0000e940: 2e6a 6f69 6e28 6469 7270 6174 682c 2066  .join(dirpath, f
-0000e950: 696c 656e 616d 6529 2c20 7374 6172 7465  ilename), starte
-0000e960: 725f 6469 7229 0a20 2020 2020 2020 2020  r_dir).         
-0000e970: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000e980: 2069 6620 6c65 6e28 7374 6172 7465 725f   if len(starter_
-0000e990: 6669 6c65 7329 203e 206d 6178 5f73 7461  files) > max_sta
-0000e9a0: 7274 6572 5f66 696c 6573 3a0a 2020 2020  rter_files:.    
-0000e9b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000e9c0: 6520 4f53 4572 726f 7228 0a20 2020 2020  e OSError(.     
-0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000e9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e9f0: 2020 2020 2020 2020 2022 5765 2776 6520           "We've 
-0000ea00: 666f 756e 6420 6d6f 7265 2074 6861 6e20  found more than 
-0000ea10: 7b6d 6178 5f73 7461 7274 6572 5f66 696c  {max_starter_fil
-0000ea20: 6573 7d22 0a20 2020 2020 2020 2020 2020  es}".           
-0000ea30: 2020 2020 2020 2020 2020 2020 2022 2073               " s
-0000ea40: 7461 7274 6572 2066 696c 6573 3b20 6974  tarter files; it
-0000ea50: 2773 206c 696b 656c 7920 7468 6174 2079  's likely that y
-0000ea60: 6f75 2068 6176 6520 6122 0a20 2020 2020  ou have a".     
-0000ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea80: 2020 2022 2073 796d 626f 6c69 6320 6c69     " symbolic li
-0000ea90: 6e6b 206c 6f6f 702e 2041 626f 7274 696e  nk loop. Abortin
-0000eaa0: 672e 2e2e 220a 2020 2020 2020 2020 2020  g...".          
-0000eab0: 2020 2020 2020 2020 2020 292e 666f 726d            ).form
-0000eac0: 6174 286d 6178 5f73 7461 7274 6572 5f66  at(max_starter_f
-0000ead0: 696c 6573 3d6d 6178 5f73 7461 7274 6572  iles=max_starter
-0000eae0: 5f66 696c 6573 290a 2020 2020 2020 2020  _files).        
-0000eaf0: 2020 2020 2020 2020 290a 0a20 2020 2073          )..    s
-0000eb00: 7461 7274 6572 5f7a 6970 203d 206f 732e  tarter_zip = os.
-0000eb10: 7061 7468 2e6a 6f69 6e28 0a20 2020 2020  path.join(.     
-0000eb20: 2020 2073 746f 7261 6765 2e65 7661 6c75     storage.evalu
-0000eb30: 6174 696f 6e5f 6469 7265 6374 6f72 7928  ation_directory(
-0000eb40: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
-0000eb50: 292c 0a20 2020 2020 2020 2022 7370 6563  ),.        "spec
-0000eb60: 7322 2c0a 2020 2020 2020 2020 7461 736b  s",.        task
-0000eb70: 6964 2c0a 2020 2020 2020 2020 7461 736b  id,.        task
-0000eb80: 6964 202b 2022 2e7a 6970 220a 2020 2020  id + ".zip".    
-0000eb90: 290a 0a20 2020 2023 2043 6f6d 7075 7465  )..    # Compute
-0000eba0: 206d 6f73 742d 7265 6365 6e74 2d6d 6f64   most-recent-mod
-0000ebb0: 6966 6963 6174 696f 6e20 7469 6d65 2066  ification time f
-0000ebc0: 6f72 2061 6e79 2073 7461 7274 6572 2066  or any starter f
-0000ebd0: 696c 650a 2020 2020 7570 6461 7465 645f  ile.    updated_
-0000ebe0: 6174 203d 204e 6f6e 650a 2020 2020 666f  at = None.    fo
-0000ebf0: 7220 6669 6c65 2069 6e20 7374 6172 7465  r file in starte
-0000ec00: 725f 6669 6c65 733a 0a20 2020 2020 2020  r_files:.       
-0000ec10: 2066 756c 6c5f 7061 7468 203d 206f 732e   full_path = os.
-0000ec20: 7061 7468 2e6a 6f69 6e28 7374 6172 7465  path.join(starte
-0000ec30: 725f 6469 722c 2066 696c 6529 0a20 2020  r_dir, file).   
-0000ec40: 2020 2020 206d 7469 6d65 203d 206f 732e       mtime = os.
-0000ec50: 7374 6174 2866 756c 6c5f 7061 7468 292e  stat(full_path).
-0000ec60: 7374 5f6d 7469 6d65 0a20 2020 2020 2020  st_mtime.       
-0000ec70: 2069 6620 7570 6461 7465 645f 6174 2069   if updated_at i
-0000ec80: 7320 4e6f 6e65 206f 7220 7570 6461 7465  s None or update
-0000ec90: 645f 6174 203c 206d 7469 6d65 3a0a 2020  d_at < mtime:.  
-0000eca0: 2020 2020 2020 2020 2020 7570 6461 7465            update
-0000ecb0: 645f 6174 203d 206d 7469 6d65 0a0a 2020  d_at = mtime..  
-0000ecc0: 2020 2320 4368 6563 6b20 666f 7220 6672    # Check for fr
-0000ecd0: 6573 686e 6573 730a 2020 2020 6966 2028  eshness.    if (
-0000ece0: 0a20 2020 2020 2020 206e 6f74 206f 732e  .        not os.
-0000ecf0: 7061 7468 2e65 7869 7374 7328 7374 6172  path.exists(star
-0000ed00: 7465 725f 7a69 7029 0a20 2020 2020 6f72  ter_zip).     or
-0000ed10: 206f 732e 7374 6174 2873 7461 7274 6572   os.stat(starter
-0000ed20: 5f7a 6970 292e 7374 5f6d 7469 6d65 203c  _zip).st_mtime <
-0000ed30: 2075 7064 6174 6564 5f61 740a 2020 2020   updated_at.    
-0000ed40: 293a 0a20 2020 2020 2020 2023 205a 6970  ):.        # Zip
-0000ed50: 2075 7020 616c 6c20 7468 6520 7374 6172   up all the star
-0000ed60: 7465 7220 6669 6c65 732c 2065 7261 7369  ter files, erasi
-0000ed70: 6e67 2061 6e64 206f 7665 7277 7269 7469  ng and overwriti
-0000ed80: 6e67 2074 6865 206f 6c64 0a20 2020 2020  ng the old.     
-0000ed90: 2020 2023 207a 6970 2066 696c 6520 6966     # zip file if
-0000eda0: 2069 7420 7761 7320 7468 6572 6520 6265   it was there be
-0000edb0: 666f 7265 0a20 2020 2020 2020 2077 6974  fore.        wit
-0000edc0: 6820 7a69 7066 696c 652e 5a69 7046 696c  h zipfile.ZipFil
-0000edd0: 6528 7374 6172 7465 725f 7a69 702c 2027  e(starter_zip, '
-0000ede0: 7727 2c20 7a69 7066 696c 652e 5a49 505f  w', zipfile.ZIP_
-0000edf0: 4445 464c 4154 4544 2920 6173 207a 6f75  DEFLATED) as zou
-0000ee00: 743a 0a20 2020 2020 2020 2020 2020 2066  t:.            f
-0000ee10: 6f72 2066 696c 6520 696e 2073 7461 7274  or file in start
-0000ee20: 6572 5f66 696c 6573 3a0a 2020 2020 2020  er_files:.      
-0000ee30: 2020 2020 2020 2020 2020 6675 6c6c 5f70            full_p
-0000ee40: 6174 6820 3d20 6f73 2e70 6174 682e 6a6f  ath = os.path.jo
-0000ee50: 696e 2873 7461 7274 6572 5f64 6972 2c20  in(starter_dir, 
-0000ee60: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
-0000ee70: 2020 2020 2020 7a6f 7574 2e77 7269 7465        zout.write
-0000ee80: 2866 756c 6c5f 7061 7468 2c20 7461 736b  (full_path, task
-0000ee90: 6964 202b 2027 2f27 202b 2066 696c 6529  id + '/' + file)
-0000eea0: 0a0a 2020 2020 7769 7468 206f 7065 6e28  ..    with open(
-0000eeb0: 7374 6172 7465 725f 7a69 702c 2027 7262  starter_zip, 'rb
-0000eec0: 2729 2061 7320 6669 6e3a 0a20 2020 2020  ') as fin:.     
-0000eed0: 2020 2072 6177 5f62 7974 6573 203d 2066     raw_bytes = f
-0000eee0: 696e 2e72 6561 6428 290a 0a20 2020 2072  in.read()..    r
-0000eef0: 6574 7572 6e20 666c 6173 6b2e 5265 7370  eturn flask.Resp
-0000ef00: 6f6e 7365 2872 6177 5f62 7974 6573 2c20  onse(raw_bytes, 
-0000ef10: 6d69 6d65 7479 7065 3d27 6170 706c 6963  mimetype='applic
-0000ef20: 6174 696f 6e2f 7a69 7027 290a 0a0a 4061  ation/zip')...@a
-0000ef30: 7070 2e72 6f75 7465 2827 2f3c 636f 7572  pp.route('/<cour
-0000ef40: 7365 3e2f 3c73 656d 6573 7465 723e 2f67  se>/<semester>/g
-0000ef50: 7261 6465 7368 6565 742f 3c70 7369 643e  radesheet/<psid>
-0000ef60: 272c 206d 6574 686f 6473 3d5b 2747 4554  ', methods=['GET
-0000ef70: 275d 290a 4066 6c61 736b 5f63 6173 2e6c  ']).@flask_cas.l
-0000ef80: 6f67 696e 5f72 6571 7569 7265 640a 4061  ogin_required.@a
-0000ef90: 7567 6d65 6e74 5f61 7267 756d 656e 7473  ugment_arguments
-0000efa0: 0a64 6566 2072 6f75 7465 5f67 7261 6465  .def route_grade
-0000efb0: 7368 6565 7428 0a20 2020 2063 6f75 7273  sheet(.    cours
-0000efc0: 652c 0a20 2020 2073 656d 6573 7465 722c  e,.    semester,
-0000efd0: 0a20 2020 2070 7369 642c 0a20 2020 2023  .    psid,.    #
-0000efe0: 2041 7567 6d65 6e74 6564 2061 7267 756d   Augmented argum
-0000eff0: 656e 7473 0a20 2020 2075 7365 726e 616d  ents.    usernam
-0000f000: 652c 0a20 2020 2069 735f 6164 6d69 6e2c  e,.    is_admin,
-0000f010: 0a20 2020 206d 6173 7175 6572 6164 655f  .    masquerade_
-0000f020: 6173 2c0a 2020 2020 6566 6665 6374 6976  as,.    effectiv
-0000f030: 655f 7573 6572 2c0a 2020 2020 7461 736b  e_user,.    task
-0000f040: 5f69 6e66 6f0a 293a 0a20 2020 2022 2222  _info.):.    """
-0000f050: 0a20 2020 2056 6973 6962 6c65 2062 7920  .    Visible by 
-0000f060: 6164 6d69 6e73 206f 6e6c 792c 2074 6869  admins only, thi
-0000f070: 7320 726f 7574 6520 6469 7370 6c61 7973  s route displays
-0000f080: 2061 6e20 6f76 6572 7669 6577 206f 6620   an overview of 
-0000f090: 7468 6520 7374 6174 7573 0a20 2020 206f  the status.    o
-0000f0a0: 6620 6576 6572 7920 7374 7564 656e 7420  f every student 
-0000f0b0: 6f6e 2074 6865 2072 6f73 7465 722c 2077  on the roster, w
-0000f0c0: 6974 6820 6c69 6e6b 7320 746f 2074 6865  ith links to the
-0000f0d0: 2066 6565 6462 6163 6b20 7669 6577 7320   feedback views 
-0000f0e0: 666f 720a 2020 2020 6561 6368 2073 7475  for.    each stu
-0000f0f0: 6465 6e74 2f70 7365 742f 7068 6173 652f  dent/pset/phase/
-0000f100: 7461 736b 2e0a 2020 2020 2222 220a 2020  task..    """.  
-0000f110: 2020 6966 206e 6f74 2069 735f 6164 6d69    if not is_admi
-0000f120: 6e3a 0a20 2020 2020 2020 2066 6c61 736b  n:.        flask
-0000f130: 2e66 6c61 7368 2822 596f 7520 646f 206e  .flash("You do n
-0000f140: 6f74 2068 6176 6520 7065 726d 6973 7369  ot have permissi
-0000f150: 6f6e 2074 6f20 7669 6577 2074 6865 2067  on to view the g
-0000f160: 7261 6465 7368 6565 742e 2229 0a20 2020  radesheet.").   
-0000f170: 2020 2020 2072 6574 7572 6e20 676f 6261       return goba
-0000f180: 636b 2863 6f75 7273 652c 2073 656d 6573  ck(course, semes
-0000f190: 7465 7229 0a0a 2020 2020 2320 4372 6561  ter)..    # Crea
-0000f1a0: 7465 2062 6173 6520 7461 736b 2069 6e66  te base task inf
-0000f1b0: 6f20 6672 6f6d 206c 6f67 6765 642d 696e  o from logged-in
-0000f1c0: 2075 7365 7227 7320 7065 7273 7065 6374   user's perspect
-0000f1d0: 6976 650a 2020 2020 6261 7365 5f74 6173  ive.    base_tas
-0000f1e0: 6b5f 696e 666f 203d 2063 6f70 792e 6465  k_info = copy.de
-0000f1f0: 6570 636f 7079 2874 6173 6b5f 696e 666f  epcopy(task_info
-0000f200: 290a 2020 2020 616d 656e 645f 7461 736b  ).    amend_task
-0000f210: 5f69 6e66 6f28 636f 7572 7365 2c20 7365  _info(course, se
-0000f220: 6d65 7374 6572 2c20 6261 7365 5f74 6173  mester, base_tas
-0000f230: 6b5f 696e 666f 2c20 7573 6572 6e61 6d65  k_info, username
-0000f240: 290a 0a20 2020 2074 7279 3a0a 2020 2020  )..    try:.    
-0000f250: 2020 2020 7073 203d 2067 6574 5f70 735f      ps = get_ps_
-0000f260: 6f62 6a28 6261 7365 5f74 6173 6b5f 696e  obj(base_task_in
-0000f270: 666f 2c20 7073 6964 290a 2020 2020 6578  fo, psid).    ex
-0000f280: 6365 7074 2056 616c 7565 4572 726f 7220  cept ValueError 
-0000f290: 6173 2065 3a0a 2020 2020 2020 2020 666c  as e:.        fl
-0000f2a0: 6173 6b2e 666c 6173 6828 7374 7228 6529  ask.flash(str(e)
-0000f2b0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000f2c0: 2067 6f62 6163 6b28 636f 7572 7365 2c20   goback(course, 
-0000f2d0: 7365 6d65 7374 6572 290a 0a20 2020 2023  semester)..    #
-0000f2e0: 2047 6574 2074 6865 2072 6f73 7465 720a   Get the roster.
-0000f2f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000f300: 2072 6f73 7465 7220 3d20 7374 6f72 6167   roster = storag
-0000f310: 652e 6765 745f 726f 7374 6572 2863 6f75  e.get_roster(cou
-0000f320: 7273 652c 2073 656d 6573 7465 7229 0a20  rse, semester). 
-0000f330: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0000f340: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-0000f350: 2020 666c 6173 6b2e 666c 6173 6828 7374    flask.flash(st
-0000f360: 7228 6529 290a 2020 2020 2020 2020 726f  r(e)).        ro
-0000f370: 7374 6572 203d 204e 6f6e 650a 0a20 2020  ster = None..   
-0000f380: 2069 6620 726f 7374 6572 2069 7320 4e6f   if roster is No
-0000f390: 6e65 3a0a 2020 2020 2020 2020 6d73 6720  ne:.        msg 
-0000f3a0: 3d20 2246 6169 6c65 6420 746f 206c 6f61  = "Failed to loa
-0000f3b0: 6420 3c63 6f64 653e 726f 7374 6572 2e63  d <code>roster.c
-0000f3c0: 7376 3c2f 636f 6465 3e2e 220a 2020 2020  sv</code>.".    
-0000f3d0: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
-0000f3e0: 6d73 6729 0a20 2020 2020 2020 2072 6574  msg).        ret
-0000f3f0: 7572 6e20 6572 726f 725f 7265 7370 6f6e  urn error_respon
-0000f400: 7365 2863 6f75 7273 652c 2073 656d 6573  se(course, semes
-0000f410: 7465 722c 2075 7365 726e 616d 652c 206d  ter, username, m
-0000f420: 7367 290a 0a20 2020 2069 6e69 7469 616c  sg)..    initial
-0000f430: 5f74 6173 6b5f 7469 6d65 7320 3d20 7b7d  _task_times = {}
-0000f440: 0a20 2020 2072 6576 6973 696f 6e5f 7461  .    revision_ta
-0000f450: 736b 5f74 696d 6573 203d 207b 7d0a 2020  sk_times = {}.  
-0000f460: 2020 726f 7773 203d 205b 5d0a 2020 2020    rows = [].    
-0000f470: 666f 7220 7374 6964 2069 6e20 736f 7274  for stid in sort
-0000f480: 6564 280a 2020 2020 2020 2020 726f 7374  ed(.        rost
-0000f490: 6572 2c0a 2020 2020 2020 2020 6b65 793d  er,.        key=
-0000f4a0: 6c61 6d62 6461 2073 7469 643a 2028 0a20  lambda stid: (. 
-0000f4b0: 2020 2020 2020 2020 2020 2072 6f73 7465             roste
-0000f4c0: 725b 7374 6964 5d5b 2263 6f75 7273 655f  r[stid]["course_
-0000f4d0: 7365 6374 696f 6e22 5d2c 0a20 2020 2020  section"],.     
-0000f4e0: 2020 2020 2020 2072 6f73 7465 725b 7374         roster[st
-0000f4f0: 6964 5d5b 2273 6f72 746e 616d 6522 5d0a  id]["sortname"].
-0000f500: 2020 2020 2020 2020 290a 2020 2020 293a          ).    ):
-0000f510: 0a20 2020 2020 2020 2072 6f77 203d 2072  .        row = r
-0000f520: 6f73 7465 725b 7374 6964 5d0a 2020 2020  oster[stid].    
-0000f530: 2020 2020 726f 775f 696e 666f 203d 2063      row_info = c
-0000f540: 6f70 792e 6465 6570 636f 7079 2874 6173  opy.deepcopy(tas
-0000f550: 6b5f 696e 666f 290a 2020 2020 2020 2020  k_info).        
-0000f560: 726f 775b 2274 6173 6b5f 696e 666f 225d  row["task_info"]
-0000f570: 203d 2072 6f77 5f69 6e66 6f0a 2020 2020   = row_info.    
-0000f580: 2020 2020 7073 6f62 6a20 3d20 6765 745f      psobj = get_
-0000f590: 7073 5f6f 626a 2872 6f77 5f69 6e66 6f2c  ps_obj(row_info,
-0000f5a0: 2070 7369 6429 0a20 2020 2020 2020 2072   psid).        r
-0000f5b0: 6f77 5b22 7468 6973 5f70 7365 7422 5d20  ow["this_pset"] 
-0000f5c0: 3d20 7073 6f62 6a0a 0a20 2020 2020 2020  = psobj..       
-0000f5d0: 2061 6d65 6e64 5f70 7365 745f 616e 645f   amend_pset_and_
-0000f5e0: 7461 736b 7328 0a20 2020 2020 2020 2020  tasks(.         
-0000f5f0: 2020 2063 6f75 7273 652c 0a20 2020 2020     course,.     
-0000f600: 2020 2020 2020 2073 656d 6573 7465 722c         semester,
-0000f610: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
-0000f620: 5f69 6e66 6f2c 0a20 2020 2020 2020 2020  _info,.         
-0000f630: 2020 2070 736f 626a 2c0a 2020 2020 2020     psobj,.      
-0000f640: 2020 2020 2020 726f 775b 2275 7365 726e        row["usern
-0000f650: 616d 6522 5d0a 2020 2020 2020 2020 290a  ame"].        ).
-0000f660: 0a20 2020 2020 2020 2070 736f 626a 5b22  .        psobj["
-0000f670: 746f 7461 6c5f 7469 6d65 225d 203d 2030  total_time"] = 0
-0000f680: 0a0a 2020 2020 2020 2020 666f 7220 7461  ..        for ta
-0000f690: 736b 6f62 6a20 696e 2070 736f 626a 5b22  skobj in psobj["
-0000f6a0: 7461 736b 7322 5d3a 0a20 2020 2020 2020  tasks"]:.       
-0000f6b0: 2020 2020 2074 6173 6b69 6420 3d20 7461       taskid = ta
-0000f6c0: 736b 6f62 6a5b 2269 6422 5d0a 2020 2020  skobj["id"].    
-0000f6d0: 2020 2020 2020 2020 7469 6d65 5f73 7065          time_spe
-0000f6e0: 6e74 203d 2074 6173 6b6f 626a 5b22 7469  nt = taskobj["ti
-0000f6f0: 6d65 5f73 7065 6e74 225d 0a20 2020 2020  me_spent"].     
-0000f700: 2020 2020 2020 2069 6620 7469 6d65 5f73         if time_s
-0000f710: 7065 6e74 2069 7320 6e6f 7420 4e6f 6e65  pent is not None
-0000f720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f730: 2020 7469 6d65 5f76 616c 203d 2074 696d    time_val = tim
-0000f740: 655f 7370 656e 745b 2274 696d 655f 7370  e_spent["time_sp
-0000f750: 656e 7422 5d0a 2020 2020 2020 2020 2020  ent"].          
-0000f760: 2020 2020 2020 6966 2074 6173 6b69 6420        if taskid 
-0000f770: 6e6f 7420 696e 2069 6e69 7469 616c 5f74  not in initial_t
-0000f780: 6173 6b5f 7469 6d65 733a 0a20 2020 2020  ask_times:.     
-0000f790: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000f7a0: 6e69 7469 616c 5f74 6173 6b5f 7469 6d65  nitial_task_time
-0000f7b0: 735b 7461 736b 6964 5d20 3d20 7b7d 0a0a  s[taskid] = {}..
-0000f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7d0: 6966 2069 7369 6e73 7461 6e63 6528 7469  if isinstance(ti
-0000f7e0: 6d65 5f76 616c 2c20 2866 6c6f 6174 2c20  me_val, (float, 
-0000f7f0: 696e 7429 293a 0a20 2020 2020 2020 2020  int)):.         
-0000f800: 2020 2020 2020 2020 2020 2069 6e69 7469             initi
-0000f810: 616c 5f74 6173 6b5f 7469 6d65 735b 7461  al_task_times[ta
-0000f820: 736b 6964 5d5b 726f 775b 2275 7365 726e  skid][row["usern
-0000f830: 616d 6522 5d5d 203d 2074 696d 655f 7661  ame"]] = time_va
-0000f840: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-0000f850: 2020 2020 2020 7461 736b 6f62 6a5b 2269        taskobj["i
-0000f860: 6e69 7469 616c 5f74 696d 655f 7661 6c22  nitial_time_val"
-0000f870: 5d20 3d20 7469 6d65 5f76 616c 0a20 2020  ] = time_val.   
-0000f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f890: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
-0000f8a0: 736f 626a 5b22 746f 7461 6c5f 7469 6d65  sobj["total_time
-0000f8b0: 225d 2c20 2869 6e74 2c20 666c 6f61 7429  "], (int, float)
-0000f8c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000f8d0: 2020 2020 2020 2020 2020 2070 736f 626a             psobj
-0000f8e0: 5b22 746f 7461 6c5f 7469 6d65 225d 202b  ["total_time"] +
-0000f8f0: 3d20 7469 6d65 5f76 616c 0a20 2020 2020  = time_val.     
-0000f900: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000f910: 6973 696e 7374 616e 6365 2874 696d 655f  isinstance(time_
-0000f920: 7661 6c2c 2073 7472 2920 616e 6420 7469  val, str) and ti
-0000f930: 6d65 5f76 616c 2021 3d20 2222 3a0a 2020  me_val != "":.  
-0000f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f950: 2020 7461 736b 6f62 6a5b 2269 6e69 7469    taskobj["initi
-0000f960: 616c 5f74 696d 655f 7661 6c22 5d20 3d20  al_time_val"] = 
-0000f970: 7469 6d65 5f76 616c 0a20 2020 2020 2020  time_val.       
-0000f980: 2020 2020 2020 2020 2020 2020 2070 736f               pso
-0000f990: 626a 5b22 746f 7461 6c5f 7469 6d65 225d  bj["total_time"]
-0000f9a0: 203d 2022 3f22 0a20 2020 2020 2020 2020   = "?".         
-0000f9b0: 2020 2020 2020 2065 6c73 653a 2023 2065         else: # e
-0000f9c0: 6d70 7479 2073 7472 696e 6720 6f72 204e  mpty string or N
-0000f9d0: 6f6e 6520 6f72 2074 6865 206c 696b 650a  one or the like.
-0000f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9f0: 2020 2020 7461 736b 6f62 6a5b 2269 6e69      taskobj["ini
-0000fa00: 7469 616c 5f74 696d 655f 7661 6c22 5d20  tial_time_val"] 
-0000fa10: 3d20 223f 220a 2020 2020 2020 2020 2020  = "?".          
-0000fa20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000fa30: 2020 2020 2020 2020 7461 736b 6f62 6a5b          taskobj[
-0000fa40: 2269 6e69 7469 616c 5f74 696d 655f 7661  "initial_time_va
-0000fa50: 6c22 5d20 3d20 300a 0a20 2020 2020 2020  l"] = 0..       
-0000fa60: 2020 2020 2072 6576 5f74 696d 655f 7370       rev_time_sp
-0000fa70: 656e 7420 3d20 7461 736b 6f62 6a2e 6765  ent = taskobj.ge
-0000fa80: 7428 2272 6576 6973 696f 6e22 2c20 7b7d  t("revision", {}
-0000fa90: 292e 6765 7428 2274 696d 655f 7370 656e  ).get("time_spen
-0000faa0: 7422 290a 2020 2020 2020 2020 2020 2020  t").            
-0000fab0: 6966 2072 6576 5f74 696d 655f 7370 656e  if rev_time_spen
-0000fac0: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
-0000fad0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000fae0: 6576 5f74 696d 655f 7661 6c20 3d20 7265  ev_time_val = re
-0000faf0: 765f 7469 6d65 5f73 7065 6e74 5b22 7469  v_time_spent["ti
-0000fb00: 6d65 5f73 7065 6e74 225d 0a20 2020 2020  me_spent"].     
-0000fb10: 2020 2020 2020 2020 2020 2069 6620 7461             if ta
-0000fb20: 736b 6964 206e 6f74 2069 6e20 7265 7669  skid not in revi
-0000fb30: 7369 6f6e 5f74 6173 6b5f 7469 6d65 733a  sion_task_times:
-0000fb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fb50: 2020 2020 2072 6576 6973 696f 6e5f 7461       revision_ta
-0000fb60: 736b 5f74 696d 6573 5b74 6173 6b69 645d  sk_times[taskid]
-0000fb70: 203d 207b 7d0a 0a20 2020 2020 2020 2020   = {}..         
-0000fb80: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0000fb90: 616e 6365 2872 6576 5f74 696d 655f 7661  ance(rev_time_va
-0000fba0: 6c2c 2028 666c 6f61 742c 2069 6e74 2929  l, (float, int))
+00007c40: 7469 6d65 6f75 743d 6170 702e 636f 6e66  timeout=app.conf
+00007c50: 6967 5b27 4649 4e41 4c5f 4556 414c 5f54  ig['FINAL_EVAL_T
+00007c60: 494d 454f 5554 275d 0a20 2020 2020 2020  IMEOUT'].       
+00007c70: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00007c80: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00007c90: 2020 2020 2072 6574 7572 6e20 666c 6173       return flas
+00007ca0: 6b2e 7265 6469 7265 6374 280a 2020 2020  k.redirect(.    
+00007cb0: 2020 2020 2020 2020 2020 2020 666c 6173              flas
+00007cc0: 6b2e 7572 6c5f 666f 7228 0a20 2020 2020  k.url_for(.     
+00007cd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00007ce0: 6573 7469 6e61 7469 6f6e 5f72 6f75 7465  estination_route
+00007cf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007d00: 2020 2020 2020 636f 7572 7365 3d63 6f75        course=cou
+00007d10: 7273 652c 0a20 2020 2020 2020 2020 2020  rse,.           
+00007d20: 2020 2020 2020 2020 2073 656d 6573 7465           semeste
+00007d30: 723d 7365 6d65 7374 6572 2c0a 2020 2020  r=semester,.    
+00007d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007d50: 7461 7267 6574 5f75 7365 723d 6566 6665  target_user=effe
+00007d60: 6374 6976 655f 7573 6572 2c0a 2020 2020  ctive_user,.    
+00007d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007d80: 7068 6173 653d 7068 6173 652c 0a20 2020  phase=phase,.   
+00007d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007da0: 2070 7369 643d 7073 6964 2c0a 2020 2020   psid=psid,.    
+00007db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007dc0: 7461 736b 6964 3d74 6173 6b69 640a 2020  taskid=taskid.  
+00007dd0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00007de0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00007df0: 2020 2020 2020 2320 656c 7365 2077 6520        # else we 
+00007e00: 6173 7375 6d65 2074 6865 2073 7461 7475  assume the statu
+00007e10: 7320 6973 2073 6f6d 6520 6669 6e61 6c20  s is some final 
+00007e20: 7374 6174 7573 206f 7220 4e6f 6e65 206d  status or None m
+00007e30: 6561 6e69 6e67 0a20 2020 2020 2020 2023  eaning.        #
+00007e40: 2074 6869 7320 6973 2074 6865 2066 6972   this is the fir
+00007e50: 7374 2073 7562 6d69 7373 696f 6e0a 0a20  st submission.. 
+00007e60: 2020 2020 2020 2023 2052 6563 6f72 6420         # Record 
+00007e70: 7468 6520 7469 6d65 2073 7065 6e74 2076  the time spent v
+00007e80: 616c 7565 0a20 2020 2020 2020 2069 6620  alue.        if 
+00007e90: 280a 2020 2020 2020 2020 2020 2020 2774  (.            't
+00007ea0: 696d 655f 7370 656e 7427 206e 6f74 2069  ime_spent' not i
+00007eb0: 6e20 666c 6173 6b2e 7265 7175 6573 742e  n flask.request.
+00007ec0: 666f 726d 0a20 2020 2020 2020 2020 6f72  form.         or
+00007ed0: 2066 6c61 736b 2e72 6571 7565 7374 2e66   flask.request.f
+00007ee0: 6f72 6d5b 2274 696d 655f 7370 656e 7422  orm["time_spent"
+00007ef0: 5d20 3d3d 2022 220a 2020 2020 2020 2020  ] == "".        
+00007f00: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+00007f10: 6c61 736b 2e66 6c61 7368 280a 2020 2020  lask.flash(.    
+00007f20: 2020 2020 2020 2020 2020 2020 2259 6f75              "You
+00007f30: 2064 6964 206e 6f74 2067 6976 6520 7573   did not give us
+00007f40: 2061 6e20 6573 7469 6d61 7465 206f 6620   an estimate of 
+00007f50: 686f 7720 6d75 6368 2074 696d 6520 7468  how much time th
+00007f60: 6973 220a 2020 2020 2020 2020 2020 2020  is".            
+00007f70: 2020 2b20 2220 7461 736b 2074 6f6f 6b20    + " task took 
+00007f80: 796f 752e 2050 6c65 6173 6520 7265 2d73  you. Please re-s
+00007f90: 7562 6d69 7420 616e 6420 656e 7465 7220  ubmit and enter 
+00007fa0: 6120 7469 6d65 2073 7065 6e74 220a 2020  a time spent".  
+00007fb0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+00007fc0: 7661 6c75 6520 736f 2074 6861 7420 7765  value so that we
+00007fd0: 2063 616e 2068 656c 7020 6164 7669 7365   can help advise
+00007fe0: 2066 7574 7572 6520 7374 7564 656e 7473   future students
+00007ff0: 2061 626f 7574 220a 2020 2020 2020 2020   about".        
+00008000: 2020 2020 2020 2b20 2220 686f 7720 6c6f        + " how lo
+00008010: 6e67 2074 6869 7320 7461 736b 2077 696c  ng this task wil
+00008020: 6c20 7461 6b65 2074 6865 6d2e 220a 2020  l take them.".  
+00008030: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00008040: 2020 2020 2020 2020 7469 6d65 5f73 7065          time_spe
+00008050: 6e74 203d 2022 220a 2020 2020 2020 2020  nt = "".        
+00008060: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008070: 2020 7469 6d65 5f73 7065 6e74 203d 2066    time_spent = f
+00008080: 6c61 736b 2e72 6571 7565 7374 2e66 6f72  lask.request.for
+00008090: 6d5b 2274 696d 655f 7370 656e 7422 5d0a  m["time_spent"].
+000080a0: 0a20 2020 2020 2020 2073 746f 7261 6765  .        storage
+000080b0: 2e72 6563 6f72 645f 7469 6d65 5f73 7065  .record_time_spe
+000080c0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+000080d0: 636f 7572 7365 2c0a 2020 2020 2020 2020  course,.        
+000080e0: 2020 2020 7365 6d65 7374 6572 2c0a 2020      semester,.  
+000080f0: 2020 2020 2020 2020 2020 7461 7267 6574            target
+00008100: 5f75 7365 722c 0a20 2020 2020 2020 2020  _user,.         
+00008110: 2020 2070 6861 7365 2c0a 2020 2020 2020     phase,.      
+00008120: 2020 2020 2020 7073 6964 2c0a 2020 2020        psid,.    
+00008130: 2020 2020 2020 2020 7461 736b 6964 2c0a          taskid,.
+00008140: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+00008150: 5f73 7065 6e74 0a20 2020 2020 2020 2029  _spent.        )
+00008160: 0a0a 2020 2020 2020 2020 2320 5361 7665  ..        # Save
+00008170: 2074 6865 2066 696c 6520 7769 7468 2074   the file with t
+00008180: 6865 2063 6f72 7265 6374 2066 696c 656e  he correct filen
+00008190: 616d 652c 2069 676e 6f72 696e 6720 7468  ame, ignoring th
+000081a0: 6520 6e61 6d65 2074 6861 740a 2020 2020  e name that.    
+000081b0: 2020 2020 2320 7468 6520 7573 6572 2075      # the user u
+000081c0: 706c 6f61 6465 642e 0a20 2020 2020 2020  ploaded..       
+000081d0: 2074 6172 6765 7420 3d20 6765 745f 7375   target = get_su
+000081e0: 626d 6973 7369 6f6e 5f66 696c 656e 616d  bmission_filenam
+000081f0: 6528 0a20 2020 2020 2020 2020 2020 2063  e(.            c
+00008200: 6f75 7273 652c 0a20 2020 2020 2020 2020  ourse,.         
+00008210: 2020 2073 656d 6573 7465 722c 0a20 2020     semester,.   
+00008220: 2020 2020 2020 2020 2074 6173 6b5f 696e           task_in
+00008230: 666f 2c0a 2020 2020 2020 2020 2020 2020  fo,.            
+00008240: 7461 7267 6574 5f75 7365 722c 0a20 2020  target_user,.   
+00008250: 2020 2020 2020 2020 2070 6861 7365 2c0a           phase,.
+00008260: 2020 2020 2020 2020 2020 2020 7073 6964              psid
+00008270: 2c0a 2020 2020 2020 2020 2020 2020 7461  ,.            ta
+00008280: 736b 6964 0a20 2020 2020 2020 2029 0a20  skid.        ). 
+00008290: 2020 2020 2020 2064 6573 7464 6972 2c20         destdir, 
+000082a0: 5f20 3d20 6f73 2e70 6174 682e 7370 6c69  _ = os.path.spli
+000082b0: 7428 7461 7267 6574 290a 2020 2020 2020  t(target).      
+000082c0: 2020 7374 6f72 6167 652e 656e 7375 7265    storage.ensure
+000082d0: 5f64 6972 6563 746f 7279 2864 6573 7464  _directory(destd
+000082e0: 6972 290a 2020 2020 2020 2020 7374 6f72  ir).        stor
+000082f0: 6167 652e 6d61 6b65 5f77 6179 5f66 6f72  age.make_way_for
+00008300: 2874 6172 6765 7429 0a20 2020 2020 2020  (target).       
+00008310: 2075 706c 6f61 6465 642e 7361 7665 2874   uploaded.save(t
+00008320: 6172 6765 7429 0a20 2020 2020 2020 2023  arget).        #
+00008330: 2054 4f44 4f3a 2046 6c61 7368 2063 6174   TODO: Flash cat
+00008340: 6567 6f72 6965 730a 2020 2020 2020 2020  egories.        
+00008350: 6966 2070 6861 7365 203d 3d20 2262 656c  if phase == "bel
+00008360: 6174 6564 223a 0a20 2020 2020 2020 2020  ated":.         
+00008370: 2020 2066 6c61 736b 2e66 6c61 7368 280a     flask.flash(.
+00008380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008390: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000083a0: 2020 2020 2020 2255 706c 6f61 6465 6420        "Uploaded 
+000083b0: 4c41 5445 2027 7b66 696c 656e 616d 657d  LATE '{filename}
+000083c0: 2720 666f 7220 7b70 7369 647d 207b 7461  ' for {psid} {ta
+000083d0: 736b 6964 7d2e 220a 2020 2020 2020 2020  skid}.".        
+000083e0: 2020 2020 2020 2020 292e 666f 726d 6174          ).format
+000083f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00008400: 2020 2020 2020 6669 6c65 6e61 6d65 3d75        filename=u
+00008410: 706c 6f61 6465 642e 6669 6c65 6e61 6d65  ploaded.filename
+00008420: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008430: 2020 2020 2020 7073 6964 3d70 7369 642c        psid=psid,
+00008440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008450: 2020 2020 2074 6173 6b69 643d 7461 736b       taskid=task
+00008460: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
+00008470: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00008480: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+00008490: 0a20 2020 2020 2020 2020 2020 2066 6c61  .            fla
+000084a0: 736b 2e66 6c61 7368 280a 2020 2020 2020  sk.flash(.      
+000084b0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+000084c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000084d0: 2253 7563 6365 7373 6675 6c6c 7920 7570  "Successfully up
+000084e0: 6c6f 6164 6564 207b 7068 6173 657d 2073  loaded {phase} s
+000084f0: 7562 6d69 7373 696f 6e22 0a20 2020 2020  ubmission".     
+00008500: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+00008510: 2027 7b66 696c 656e 616d 657d 2720 666f   '{filename}' fo
+00008520: 7220 7b70 7369 647d 207b 7461 736b 6964  r {psid} {taskid
+00008530: 7d2e 220a 2020 2020 2020 2020 2020 2020  }.".            
+00008540: 2020 2020 292e 666f 726d 6174 280a 2020      ).format(.  
+00008550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008560: 2020 7068 6173 653d 7068 6173 652c 0a20    phase=phase,. 
+00008570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008580: 2020 2066 696c 656e 616d 653d 7570 6c6f     filename=uplo
+00008590: 6164 6564 2e66 696c 656e 616d 652c 0a20  aded.filename,. 
+000085a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000085b0: 2020 2070 7369 643d 7073 6964 2c0a 2020     psid=psid,.  
+000085c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000085d0: 2020 7461 736b 6964 3d74 6173 6b69 640a    taskid=taskid.
+000085e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000085f0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+00008600: 0a20 2020 2020 2020 2023 2046 6c61 7368  .        # Flash
+00008610: 2061 2077 6172 6e69 6e67 2069 6620 7468   a warning if th
+00008620: 6520 7570 6c6f 6164 6564 2066 696c 656e  e uploaded filen
+00008630: 616d 6520 7365 656d 7320 7772 6f6e 670a  ame seems wrong.
+00008640: 2020 2020 2020 2020 6966 2075 706c 6f61          if uploa
+00008650: 6465 642e 6669 6c65 6e61 6d65 2021 3d20  ded.filename != 
+00008660: 7461 736b 5b22 7461 7267 6574 225d 3a0a  task["target"]:.
+00008670: 2020 2020 2020 2020 2020 2020 666c 6173              flas
+00008680: 6b2e 666c 6173 6828 0a20 2020 2020 2020  k.flash(.       
+00008690: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
+000086a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000086b0: 5761 726e 696e 673a 2079 6f75 2075 706c  Warning: you upl
+000086c0: 6f61 6465 6420 6120 6669 6c65 206e 616d  oaded a file nam
+000086d0: 6564 2027 7b66 696c 656e 616d 657d 272c  ed '{filename}',
+000086e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000086f0: 2020 2020 2b20 2220 6275 7420 7b74 6173      + " but {tas
+00008700: 6b69 647d 2069 6e20 7b70 7369 647d 2072  kid} in {psid} r
+00008710: 6571 7569 7265 7320 6120 6669 6c65 206e  equires a file n
+00008720: 616d 6564 220a 2020 2020 2020 2020 2020  amed".          
+00008730: 2020 2020 2020 2020 2b20 2220 277b 7265          + " '{re
+00008740: 716e 616d 657d 272e 2041 7265 2079 6f75  qname}'. Are you
+00008750: 2073 7572 6520 796f 7520 7570 6c6f 6164   sure you upload
+00008760: 6564 2074 6865 220a 2020 2020 2020 2020  ed the".        
+00008770: 2020 2020 2020 2020 2020 2b20 2220 636f            + " co
+00008780: 7272 6563 7420 6669 6c65 3f22 0a20 2020  rrect file?".   
+00008790: 2020 2020 2020 2020 2020 2020 2029 2e66               ).f
+000087a0: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
+000087b0: 2020 2020 2020 2020 2020 2066 696c 656e             filen
+000087c0: 616d 653d 7570 6c6f 6164 6564 2e66 696c  ame=uploaded.fil
+000087d0: 656e 616d 652c 0a20 2020 2020 2020 2020  ename,.         
+000087e0: 2020 2020 2020 2020 2020 2070 7369 643d             psid=
+000087f0: 7073 6964 2c0a 2020 2020 2020 2020 2020  psid,.          
+00008800: 2020 2020 2020 2020 2020 7461 736b 6964            taskid
+00008810: 3d74 6173 6b69 642c 0a20 2020 2020 2020  =taskid,.       
+00008820: 2020 2020 2020 2020 2020 2020 2072 6571               req
+00008830: 6e61 6d65 3d74 6173 6b5b 2274 6172 6765  name=task["targe
+00008840: 7422 5d0a 2020 2020 2020 2020 2020 2020  t"].            
+00008850: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00008860: 2020 290a 0a20 2020 2020 2020 2023 204c    )..        # L
+00008870: 6f67 2073 6574 7570 0a20 2020 2020 2020  og setup.       
+00008880: 2074 732c 206c 6f67 6669 6c65 2c20 7265   ts, logfile, re
+00008890: 706f 7274 6669 6c65 2c20 5f20 3d20 7374  portfile, _ = st
+000088a0: 6f72 6167 652e 7075 745f 696e 666c 6967  orage.put_inflig
+000088b0: 6874 280a 2020 2020 2020 2020 2020 2020  ht(.            
+000088c0: 636f 7572 7365 2c0a 2020 2020 2020 2020  course,.        
+000088d0: 2020 2020 7365 6d65 7374 6572 2c0a 2020      semester,.  
+000088e0: 2020 2020 2020 2020 2020 7461 7267 6574            target
+000088f0: 5f75 7365 722c 0a20 2020 2020 2020 2020  _user,.         
+00008900: 2020 2070 6861 7365 2c0a 2020 2020 2020     phase,.      
+00008910: 2020 2020 2020 7073 6964 2c0a 2020 2020        psid,.    
+00008920: 2020 2020 2020 2020 7461 736b 6964 0a20          taskid. 
+00008930: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00008940: 2020 6966 2074 7320 3d3d 2022 6572 726f    if ts == "erro
+00008950: 7222 3a0a 2020 2020 2020 2020 2020 2020  r":.            
+00008960: 666c 6173 6b2e 666c 6173 6828 0a20 2020  flask.flash(.   
+00008970: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
+00008980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008990: 2020 2022 4552 524f 523a 2046 6169 6c65     "ERROR: Faile
+000089a0: 6420 746f 2063 6865 636b 2065 7661 6c75  d to check evalu
+000089b0: 6174 696f 6e20 7374 6174 7573 2e20 5472  ation status. Tr
+000089c0: 7922 0a20 2020 2020 2020 2020 2020 2020  y".             
+000089d0: 2020 2020 202b 2022 2072 6566 7265 7368       + " refresh
+000089e0: 696e 6720 7468 6973 2070 6167 652c 2061  ing this page, a
+000089f0: 6e64 2069 6620 7468 6520 7072 6f62 6c65  nd if the proble
+00008a00: 6d20 7065 7273 6973 7473 2c22 0a20 2020  m persists,".   
+00008a10: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00008a20: 2022 2063 6f6e 7461 6374 207b 7d2e 220a   " contact {}.".
+00008a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a40: 292e 666f 726d 6174 2861 7070 2e63 6f6e  ).format(app.con
+00008a50: 6669 675b 2253 5550 504f 5254 5f4c 494e  fig["SUPPORT_LIN
+00008a60: 4b22 5d29 0a20 2020 2020 2020 2020 2020  K"]).           
+00008a70: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+00008a80: 6574 7572 6e20 666c 6173 6b2e 7265 6469  eturn flask.redi
+00008a90: 7265 6374 280a 2020 2020 2020 2020 2020  rect(.          
+00008aa0: 2020 2020 2020 666c 6173 6b2e 7572 6c5f        flask.url_
+00008ab0: 666f 7228 0a20 2020 2020 2020 2020 2020  for(.           
+00008ac0: 2020 2020 2020 2020 2064 6573 7469 6e61           destina
+00008ad0: 7469 6f6e 5f72 6f75 7465 2c0a 2020 2020  tion_route,.    
+00008ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008af0: 636f 7572 7365 3d63 6f75 7273 652c 0a20  course=course,. 
+00008b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b10: 2020 2073 656d 6573 7465 723d 7365 6d65     semester=seme
+00008b20: 7374 6572 2c0a 2020 2020 2020 2020 2020  ster,.          
+00008b30: 2020 2020 2020 2020 2020 7461 7267 6574            target
+00008b40: 5f75 7365 723d 7461 7267 6574 5f75 7365  _user=target_use
+00008b50: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00008b60: 2020 2020 2020 2070 6861 7365 3d70 6861         phase=pha
+00008b70: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00008b80: 2020 2020 2020 2020 7073 6964 3d70 7369          psid=psi
+00008b90: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00008ba0: 2020 2020 2020 2074 6173 6b69 643d 7461         taskid=ta
+00008bb0: 736b 6964 0a20 2020 2020 2020 2020 2020  skid.           
+00008bc0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00008bd0: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
+00008be0: 6620 7473 2069 7320 4e6f 6e65 3a20 2320  f ts is None: # 
+00008bf0: 616e 6f74 6865 7220 6772 6164 696e 6720  another grading 
+00008c00: 7072 6f63 6573 7320 6973 2061 6c72 6561  process is alrea
+00008c10: 6479 2069 6e2d 666c 6967 6874 0a20 2020  dy in-flight.   
+00008c20: 2020 2020 2020 2020 2066 6c61 736b 2e66           flask.f
+00008c30: 6c61 7368 280a 2020 2020 2020 2020 2020  lash(.          
+00008c40: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
+00008c50: 2020 2020 2020 2020 2020 2020 2245 5252              "ERR
+00008c60: 4f52 3a20 5461 736b 207b 7461 736b 6964  OR: Task {taskid
+00008c70: 7d20 666f 7220 7073 6574 207b 7073 6964  } for pset {psid
+00008c80: 7d20 6973 2063 7572 7265 6e74 6c79 2062  } is currently b
+00008c90: 6569 6e67 220a 2020 2020 2020 2020 2020  eing".          
+00008ca0: 2020 2020 2020 2020 2b20 2220 6576 616c          + " eval
+00008cb0: 7561 7465 642e 2059 6f75 206d 7573 7420  uated. You must 
+00008cc0: 7761 6974 2075 6e74 696c 2074 6861 7420  wait until that 
+00008cd0: 7072 6f63 6573 7320 6973 220a 2020 2020  process is".    
+00008ce0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00008cf0: 2220 636f 6d70 6c65 7465 2062 6566 6f72  " complete befor
+00008d00: 6520 7570 6c6f 6164 696e 6720 616e 6f74  e uploading anot
+00008d10: 6865 7220 7375 626d 6973 7369 6f6e 2e20  her submission. 
+00008d20: 5468 6973 220a 2020 2020 2020 2020 2020  This".          
+00008d30: 2020 2020 2020 2020 2b20 2220 7368 6f75          + " shou
+00008d40: 6c64 2074 616b 6520 6e6f 206c 6f6e 6765  ld take no longe
+00008d50: 7220 7468 616e 207b 7469 6d65 6f75 747d  r than {timeout}
+00008d60: 2073 6563 6f6e 6473 2e22 0a20 2020 2020   seconds.".     
+00008d70: 2020 2020 2020 2020 2020 2029 2e66 6f72             ).for
+00008d80: 6d61 7428 0a20 2020 2020 2020 2020 2020  mat(.           
+00008d90: 2020 2020 2020 2020 2070 7369 643d 7073           psid=ps
+00008da0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
+00008db0: 2020 2020 2020 2020 7461 736b 6964 3d74          taskid=t
+00008dc0: 6173 6b69 642c 0a20 2020 2020 2020 2020  askid,.         
+00008dd0: 2020 2020 2020 2020 2020 2074 696d 656f             timeo
+00008de0: 7574 3d61 7070 2e63 6f6e 6669 675b 2746  ut=app.config['F
+00008df0: 494e 414c 5f45 5641 4c5f 5449 4d45 4f55  INAL_EVAL_TIMEOU
+00008e00: 5427 5d0a 2020 2020 2020 2020 2020 2020  T'].            
+00008e10: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00008e20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00008e30: 7265 7475 726e 2066 6c61 736b 2e72 6564  return flask.red
+00008e40: 6972 6563 7428 0a20 2020 2020 2020 2020  irect(.         
+00008e50: 2020 2020 2020 2066 6c61 736b 2e75 726c         flask.url
+00008e60: 5f66 6f72 280a 2020 2020 2020 2020 2020  _for(.          
+00008e70: 2020 2020 2020 2020 2020 6465 7374 696e            destin
+00008e80: 6174 696f 6e5f 726f 7574 652c 0a20 2020  ation_route,.   
+00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ea0: 2063 6f75 7273 653d 636f 7572 7365 2c0a   course=course,.
+00008eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ec0: 2020 2020 7365 6d65 7374 6572 3d73 656d      semester=sem
+00008ed0: 6573 7465 722c 0a20 2020 2020 2020 2020  ester,.         
+00008ee0: 2020 2020 2020 2020 2020 2074 6172 6765             targe
+00008ef0: 745f 7573 6572 3d74 6172 6765 745f 7573  t_user=target_us
+00008f00: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00008f10: 2020 2020 2020 2020 7068 6173 653d 7068          phase=ph
+00008f20: 6173 652c 0a20 2020 2020 2020 2020 2020  ase,.           
+00008f30: 2020 2020 2020 2020 2070 7369 643d 7073           psid=ps
+00008f40: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
+00008f50: 2020 2020 2020 2020 7461 736b 6964 3d74          taskid=t
+00008f60: 6173 6b69 640a 2020 2020 2020 2020 2020  askid.          
+00008f70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00008f80: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+00008f90: 2053 7461 7274 2074 6865 2065 7661 6c75   Start the evalu
+00008fa0: 6174 696f 6e20 7072 6f63 6573 7320 2877  ation process (w
+00008fb0: 6520 646f 6e27 7420 7761 6974 2066 6f72  e don't wait for
+00008fc0: 2069 7429 0a20 2020 2020 2020 206c 6175   it).        lau
+00008fd0: 6e63 685f 706f 746c 7563 6b28 0a20 2020  nch_potluck(.   
+00008fe0: 2020 2020 2020 2020 2063 6f75 7273 652c           course,
+00008ff0: 0a20 2020 2020 2020 2020 2020 2073 656d  .            sem
+00009000: 6573 7465 722c 0a20 2020 2020 2020 2020  ester,.         
+00009010: 2020 2074 6172 6765 745f 7573 6572 2c0a     target_user,.
+00009020: 2020 2020 2020 2020 2020 2020 7461 736b              task
+00009030: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
+00009040: 7461 7267 6574 2c0a 2020 2020 2020 2020  target,.        
+00009050: 2020 2020 6c6f 6766 696c 652c 0a20 2020      logfile,.   
+00009060: 2020 2020 2020 2020 2072 6570 6f72 7466           reportf
+00009070: 696c 650a 2020 2020 2020 2020 290a 0a20  ile.        ).. 
+00009080: 2020 2072 6574 7572 6e20 666c 6173 6b2e     return flask.
+00009090: 7265 6469 7265 6374 280a 2020 2020 2020  redirect(.      
+000090a0: 2020 666c 6173 6b2e 7572 6c5f 666f 7228    flask.url_for(
+000090b0: 0a20 2020 2020 2020 2020 2020 2064 6573  .            des
+000090c0: 7469 6e61 7469 6f6e 5f72 6f75 7465 2c0a  tination_route,.
+000090d0: 2020 2020 2020 2020 2020 2020 636f 7572              cour
+000090e0: 7365 3d63 6f75 7273 652c 0a20 2020 2020  se=course,.     
+000090f0: 2020 2020 2020 2073 656d 6573 7465 723d         semester=
+00009100: 7365 6d65 7374 6572 2c0a 2020 2020 2020  semester,.      
+00009110: 2020 2020 2020 7461 7267 6574 5f75 7365        target_use
+00009120: 723d 7461 7267 6574 5f75 7365 722c 0a20  r=target_user,. 
+00009130: 2020 2020 2020 2020 2020 2070 6861 7365             phase
+00009140: 3d70 6861 7365 2c0a 2020 2020 2020 2020  =phase,.        
+00009150: 2020 2020 7073 6964 3d70 7369 642c 0a20      psid=psid,. 
+00009160: 2020 2020 2020 2020 2020 2074 6173 6b69             taski
+00009170: 643d 7461 736b 6964 0a20 2020 2020 2020  d=taskid.       
+00009180: 2029 0a20 2020 2029 0a0a 0a64 6566 2077   ).    )...def w
+00009190: 6869 6368 5f65 7865 2874 6172 6765 742c  hich_exe(target,
+000091a0: 2063 7764 3d27 2e27 293a 0a20 2020 2022   cwd='.'):.    "
+000091b0: 2222 0a20 2020 2073 6875 7469 6c2e 7768  "".    shutil.wh
+000091c0: 6963 6820 322f 3320 7368 696d 2e20 5072  ich 2/3 shim. Pr
+000091d0: 6570 656e 6473 2063 7764 2074 6f20 6375  epends cwd to cu
+000091e0: 7272 656e 7420 5041 5448 2e0a 2020 2020  rrent PATH..    
+000091f0: 2222 220a 2020 2020 6966 2073 7973 2e76  """.    if sys.v
+00009200: 6572 7369 6f6e 5f69 6e66 6f5b 305d 203c  ersion_info[0] <
+00009210: 2033 3a0a 2020 2020 2020 2020 6669 6e64   3:.        find
+00009220: 6572 203d 2073 7562 7072 6f63 6573 732e  er = subprocess.
+00009230: 506f 7065 6e28 0a20 2020 2020 2020 2020  Popen(.         
+00009240: 2020 205b 2027 7768 6963 6827 2c20 7461     [ 'which', ta
+00009250: 7267 6574 205d 2c0a 2020 2020 2020 2020  rget ],.        
+00009260: 2020 2020 6377 643d 6377 642c 0a20 2020      cwd=cwd,.   
+00009270: 2020 2020 2020 2020 2073 7464 6f75 743d           stdout=
+00009280: 7375 6270 726f 6365 7373 2e50 4950 450a  subprocess.PIPE.
+00009290: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000092a0: 2020 6f75 742c 2065 7272 203d 2066 696e    out, err = fin
+000092b0: 6465 722e 636f 6d6d 756e 6963 6174 6528  der.communicate(
+000092c0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000092d0: 206f 7574 2e73 7472 6970 2829 0a20 2020   out.strip().   
+000092e0: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
+000092f0: 6574 7572 6e20 7368 7574 696c 2e77 6869  eturn shutil.whi
+00009300: 6368 280a 2020 2020 2020 2020 2020 2020  ch(.            
+00009310: 2270 6f74 6c75 636b 5f65 7661 6c22 2c0a  "potluck_eval",.
+00009320: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00009330: 3d63 7764 202b 2027 3a27 202b 206f 732e  =cwd + ':' + os.
+00009340: 6765 7465 6e76 2822 5041 5448 2229 0a20  getenv("PATH"). 
+00009350: 2020 2020 2020 2029 0a0a 0a64 6566 206c         )...def l
+00009360: 6175 6e63 685f 706f 746c 7563 6b28 0a20  aunch_potluck(. 
+00009370: 2020 2063 6f75 7273 652c 0a20 2020 2073     course,.    s
+00009380: 656d 6573 7465 722c 0a20 2020 2075 7365  emester,.    use
+00009390: 726e 616d 652c 0a20 2020 2074 6173 6b69  rname,.    taski
+000093a0: 642c 0a20 2020 2074 6172 6765 745f 6669  d,.    target_fi
+000093b0: 6c65 2c0a 2020 2020 6c6f 6766 696c 652c  le,.    logfile,
+000093c0: 0a20 2020 2072 6570 6f72 7466 696c 652c  .    reportfile,
+000093d0: 0a20 2020 2077 6169 743d 4661 6c73 650a  .    wait=False.
+000093e0: 293a 0a20 2020 2022 2222 0a20 2020 204c  ):.    """.    L
+000093f0: 6175 6e63 6865 7320 7468 6520 6576 616c  aunches the eval
+00009400: 7561 7469 6f6e 2070 726f 6365 7373 2e20  uation process. 
+00009410: 4279 2064 6566 6175 6c74 2074 6869 7320  By default this 
+00009420: 6973 2066 6972 652d 616e 642d 666f 7267  is fire-and-forg
+00009430: 6574 3b0a 2020 2020 7765 276c 6c20 6c6f  et;.    we'll lo
+00009440: 6f6b 2066 6f72 2074 6865 206f 7574 7075  ok for the outpu
+00009450: 7420 6669 6c65 2074 6f20 6465 7465 726d  t file to determ
+00009460: 696e 6520 7768 6574 6865 7220 6974 2773  ine whether it's
+00009470: 2066 696e 6973 6865 6420 6f72 0a20 2020   finished or.   
+00009480: 206e 6f74 2e20 486f 7765 7665 722c 2062   not. However, b
+00009490: 7920 7061 7373 696e 6720 7761 6974 3d54  y passing wait=T
+000094a0: 7275 6520 796f 7520 6361 6e20 6861 7665  rue you can have
+000094b0: 2074 6865 2066 756e 6374 696f 6e20 7761   the function wa
+000094c0: 6974 2066 6f72 0a20 2020 2074 6865 2070  it for.    the p
+000094d0: 726f 6365 7373 2074 6f20 7465 726d 696e  rocess to termin
+000094e0: 6174 6520 6265 666f 7265 2072 6574 7572  ate before retur
+000094f0: 6e69 6e67 2e0a 2020 2020 2222 220a 2020  ning..    """.  
+00009500: 2020 6576 616c 5f64 6972 203d 2073 746f    eval_dir = sto
+00009510: 7261 6765 2e65 7661 6c75 6174 696f 6e5f  rage.evaluation_
+00009520: 6469 7265 6374 6f72 7928 636f 7572 7365  directory(course
+00009530: 2c20 7365 6d65 7374 6572 290a 0a20 2020  , semester)..   
+00009540: 2069 6620 6170 702e 636f 6e66 6967 2e67   if app.config.g
+00009550: 6574 2822 504f 544c 5543 4b5f 4556 414c  et("POTLUCK_EVAL
+00009560: 5f50 5954 484f 4e22 2920 6973 204e 6f6e  _PYTHON") is Non
+00009570: 653a 0a20 2020 2020 2020 2070 7974 686f  e:.        pytho
+00009580: 6e20 3d20 5b5d 0a20 2020 2065 6c73 653a  n = [].    else:
+00009590: 0a20 2020 2020 2020 2070 7974 686f 6e20  .        python 
+000095a0: 3d20 5b20 6170 702e 636f 6e66 6967 5b22  = [ app.config["
+000095b0: 504f 544c 5543 4b5f 4556 414c 5f50 5954  POTLUCK_EVAL_PYT
+000095c0: 484f 4e22 5d20 5d0a 0a20 2020 2069 6620  HON"] ]..    if 
+000095d0: 6170 702e 636f 6e66 6967 5b22 504f 544c  app.config["POTL
+000095e0: 5543 4b5f 4556 414c 5f53 4352 4950 5422  UCK_EVAL_SCRIPT"
+000095f0: 5d20 6973 204e 6f6e 653a 0a20 2020 2020  ] is None:.     
+00009600: 2020 2070 6f74 6c75 636b 5f65 7865 203d     potluck_exe =
+00009610: 2077 6869 6368 5f65 7865 2822 706f 746c   which_exe("potl
+00009620: 7563 6b5f 6576 616c 222c 2065 7661 6c5f  uck_eval", eval_
+00009630: 6469 7229 0a20 2020 2065 6c73 653a 0a20  dir).    else:. 
+00009640: 2020 2020 2020 2070 6f74 6c75 636b 5f65         potluck_e
+00009650: 7865 203d 206f 732e 7061 7468 2e6a 6f69  xe = os.path.joi
+00009660: 6e28 0a20 2020 2020 2020 2020 2020 206f  n(.            o
+00009670: 732e 6765 7463 7764 2829 2c0a 2020 2020  s.getcwd(),.    
+00009680: 2020 2020 2020 2020 6170 702e 636f 6e66          app.conf
+00009690: 6967 5b22 504f 544c 5543 4b5f 4556 414c  ig["POTLUCK_EVAL
+000096a0: 5f53 4352 4950 5422 5d0a 2020 2020 2020  _SCRIPT"].      
+000096b0: 2020 290a 0a20 2020 2070 6f74 6c75 636b    )..    potluck
+000096c0: 5f61 7267 7320 3d20 5b0a 2020 2020 2020  _args = [.      
+000096d0: 2020 222d 2d74 6173 6b22 2c20 7461 736b    "--task", task
+000096e0: 6964 2c0a 2020 2020 2020 2020 222d 2d75  id,.        "--u
+000096f0: 7365 7222 2c20 7573 6572 6e61 6d65 2c0a  ser", username,.
+00009700: 2020 2020 2020 2020 222d 2d74 6172 6765          "--targe
+00009710: 7422 2c20 6f73 2e70 6174 682e 6162 7370  t", os.path.absp
+00009720: 6174 6828 7461 7267 6574 5f66 696c 6529  ath(target_file)
+00009730: 2c0a 2020 2020 2020 2020 222d 2d6f 7574  ,.        "--out
+00009740: 6669 6c65 222c 206f 732e 7061 7468 2e61  file", os.path.a
+00009750: 6273 7061 7468 2872 6570 6f72 7466 696c  bspath(reportfil
+00009760: 6529 2c0a 2020 2020 2020 2020 222d 2d63  e),.        "--c
+00009770: 6c65 616e 222c 0a20 2020 205d 0a0a 2020  lean",.    ]..  
+00009780: 2020 6966 2061 7070 2e63 6f6e 6669 675b    if app.config[
+00009790: 2250 4f54 4c55 434b 5f45 5641 4c5f 494d  "POTLUCK_EVAL_IM
+000097a0: 504f 5254 5f46 524f 4d22 5d20 6973 206e  PORT_FROM"] is n
+000097b0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000097c0: 2069 6d70 6f72 745f 6469 7220 3d20 6f73   import_dir = os
+000097d0: 2e70 6174 682e 6a6f 696e 280a 2020 2020  .path.join(.    
+000097e0: 2020 2020 2020 2020 6f73 2e67 6574 6377          os.getcw
+000097f0: 6428 292c 0a20 2020 2020 2020 2020 2020  d(),.           
+00009800: 2061 7070 2e63 6f6e 6669 675b 2250 4f54   app.config["POT
+00009810: 4c55 434b 5f45 5641 4c5f 494d 504f 5254  LUCK_EVAL_IMPORT
+00009820: 5f46 524f 4d22 5d0a 2020 2020 2020 2020  _FROM"].        
+00009830: 290a 2020 2020 2020 2020 706f 746c 7563  ).        potluc
+00009840: 6b5f 6172 6773 2e65 7874 656e 6428 5b22  k_args.extend(["
+00009850: 2d2d 696d 706f 7274 2d66 726f 6d22 2c20  --import-from", 
+00009860: 696d 706f 7274 5f64 6972 5d29 0a20 2020  import_dir]).   
+00009870: 2077 6974 6820 6f70 656e 286c 6f67 6669   with open(logfi
+00009880: 6c65 2c20 2777 6227 2920 6173 206c 6f67  le, 'wb') as log
+00009890: 3a0a 2020 2020 2020 2020 6966 2061 7070  :.        if app
+000098a0: 2e63 6f6e 6669 675b 2255 5345 5f58 5646  .config["USE_XVF
+000098b0: 4222 5d3a 0a20 2020 2020 2020 2020 2020  B"]:.           
+000098c0: 2023 2056 6972 7475 616c 6973 6520 6672   # Virtualise fr
+000098d0: 616d 6520 6275 6666 6572 2066 6f72 2070  ame buffer for p
+000098e0: 726f 6772 616d 7320 7769 7468 2067 7261  rograms with gra
+000098f0: 7068 6963 732c 2073 6f0a 2020 2020 2020  phics, so.      
+00009900: 2020 2020 2020 2320 7468 6579 2064 6f6e        # they don
+00009910: 2774 206e 6565 6420 746f 2063 7265 6174  't need to creat
+00009920: 6520 5877 696e 646f 7720 7769 6e64 6f77  e Xwindow window
+00009930: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
+00009940: 272d 2d61 7574 6f2d 7365 7276 6572 6e75  '--auto-servernu
+00009950: 6d27 2c20 2320 6372 6561 7465 2061 206e  m', # create a n
+00009960: 6577 2073 6572 7665 723f 3f0a 2020 2020  ew server??.    
+00009970: 2020 2020 2020 2020 2320 272d 2d61 7574          # '--aut
+00009980: 6f2d 6469 7370 6c61 7927 2c0a 2020 2020  o-display',.    
+00009990: 2020 2020 2020 2020 2320 5b32 3031 392f          # [2019/
+000099a0: 3032 2f30 385d 2050 6574 6572 3a20 7472  02/08] Peter: tr
+000099b0: 7920 7468 6973 2069 6e73 7465 6164 2070  y this instead p
+000099c0: 6572 2063 6f6d 6d65 6e74 2069 6e20 2d68  er comment in -h
+000099d0: 3f0a 2020 2020 2020 2020 2020 2020 7876  ?.            xv
+000099e0: 6662 5f65 7272 5f6c 6f67 203d 206f 732e  fb_err_log = os.
+000099f0: 7061 7468 2e73 706c 6974 6578 7428 6c6f  path.splitext(lo
+00009a00: 6766 696c 6529 5b30 5d20 2b20 222e 7876  gfile)[0] + ".xv
+00009a10: 6662 5f65 7272 6f72 732e 6c6f 6722 0a20  fb_errors.log". 
+00009a20: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
+00009a30: 6172 6773 203d 2028 0a20 2020 2020 2020  args = (.       
+00009a40: 2020 2020 2020 2020 205b 0a20 2020 2020           [.     
+00009a50: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00009a60: 7876 6662 2d72 756e 272c 0a20 2020 2020  xvfb-run',.     
+00009a70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00009a80: 2d64 272c 0a20 2020 2020 2020 2020 2020  -d',.           
+00009a90: 2020 2020 2020 2020 2023 205b 3230 3139           # [2019
+00009aa0: 2f30 322f 3131 5d20 4c79 6e3a 202d 2d61  /02/11] Lyn: --a
+00009ab0: 7574 6f2d 6469 7370 6c61 7920 646f 6573  uto-display does
+00009ac0: 6e27 7420 776f 726b 2062 7574 202d 640a  n't work but -d.
+00009ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ae0: 2020 2020 2320 646f 6573 2028 676f 2066      # does (go f
+00009af0: 6967 7572 652c 2073 696e 6365 2074 6865  igure, since the
+00009b00: 7927 7265 2073 7570 706f 7365 6420 746f  y're supposed to
+00009b10: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
+00009b20: 2020 2020 2020 2020 2320 7379 6e6f 6e79          # synony
+00009b30: 6d73 2129 0a20 2020 2020 2020 2020 2020  ms!).           
+00009b40: 2020 2020 2020 2020 2027 2d65 272c 2023           '-e', #
+00009b50: 202d 2d65 7272 6f72 2d66 696c 6520 646f   --error-file do
+00009b60: 6573 6e27 7420 776f 726b 0a20 2020 2020  esn't work.     
+00009b70: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00009b80: 7666 625f 6572 725f 6c6f 672c 0a20 2020  vfb_err_log,.   
+00009b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ba0: 2027 2d2d 7365 7276 6572 2d61 7267 7327   '--server-args'
+00009bb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009bc0: 2020 2020 2020 6170 702e 636f 6e66 6967        app.config
+00009bd0: 5b22 5856 4642 5f53 4552 5645 525f 4152  ["XVFB_SERVER_AR
+00009be0: 4753 225d 2c20 2320 7363 7265 656e 2070  GS"], # screen p
+00009bf0: 726f 7065 7274 6965 730a 2020 2020 2020  roperties.      
+00009c00: 2020 2020 2020 2020 2020 2020 2020 272d                '-
+00009c10: 2d27 2c0a 2020 2020 2020 2020 2020 2020  -',.            
+00009c20: 2020 2020 5d20 2b20 7079 7468 6f6e 202b      ] + python +
+00009c30: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+00009c40: 2020 2020 2020 2070 6f74 6c75 636b 5f65         potluck_e
+00009c50: 7865 2c0a 2020 2020 2020 2020 2020 2020  xe,.            
+00009c60: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
+00009c70: 2020 2020 2b20 706f 746c 7563 6b5f 6172      + potluck_ar
+00009c80: 6773 0a20 2020 2020 2020 2020 2020 2029  gs.            )
+00009c90: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00009ca0: 2020 2020 2020 2020 2020 2023 2052 6177             # Raw
+00009cb0: 2070 6f74 6c75 636b 206c 6175 6e63 6820   potluck launch 
+00009cc0: 7769 7468 6f75 7420 5856 4642 0a20 2020  without XVFB.   
+00009cd0: 2020 2020 2020 2020 2066 756c 6c5f 6172           full_ar
+00009ce0: 6773 203d 2070 7974 686f 6e20 2b20 5b20  gs = python + [ 
+00009cf0: 706f 746c 7563 6b5f 6578 6520 5d20 2b20  potluck_exe ] + 
+00009d00: 706f 746c 7563 6b5f 6172 6773 0a0a 2020  potluck_args..  
+00009d10: 2020 2020 2020 6c6f 672e 7772 6974 6528        log.write(
+00009d20: 0a20 2020 2020 2020 2020 2020 2028 2246  .            ("F
+00009d30: 756c 6c20 6172 6773 3a20 2220 2b20 7265  ull args: " + re
+00009d40: 7072 2866 756c 6c5f 6172 6773 2920 2b20  pr(full_args) + 
+00009d50: 275c 6e27 292e 656e 636f 6465 2822 7574  '\n').encode("ut
+00009d60: 662d 3822 290a 2020 2020 2020 2020 290a  f-8").        ).
+00009d70: 2020 2020 2020 2020 6c6f 672e 666c 7573          log.flus
+00009d80: 6828 290a 0a20 2020 2020 2020 2070 203d  h()..        p =
+00009d90: 2073 7562 7072 6f63 6573 732e 506f 7065   subprocess.Pope
+00009da0: 6e28 0a20 2020 2020 2020 2020 2020 2066  n(.            f
+00009db0: 756c 6c5f 6172 6773 2c0a 2020 2020 2020  ull_args,.      
+00009dc0: 2020 2020 2020 6377 643d 6576 616c 5f64        cwd=eval_d
+00009dd0: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+00009de0: 7374 646f 7574 3d6c 6f67 2c0a 2020 2020  stdout=log,.    
+00009df0: 2020 2020 2020 2020 7374 6465 7272 3d6c          stderr=l
+00009e00: 6f67 2c0a 2020 2020 2020 2020 290a 0a20  og,.        ).. 
+00009e10: 2020 2020 2020 2069 6620 7761 6974 3a0a         if wait:.
+00009e20: 2020 2020 2020 2020 2020 2020 702e 7761              p.wa
+00009e30: 6974 2829 0a0a 0a40 6170 702e 726f 7574  it()...@app.rout
+00009e40: 6528 272f 3c63 6f75 7273 653e 2f3c 7365  e('/<course>/<se
+00009e50: 6d65 7374 6572 3e2f 6578 7465 6e73 696f  mester>/extensio
+00009e60: 6e2f 3c70 7369 643e 272c 206d 6574 686f  n/<psid>', metho
+00009e70: 6473 3d5b 2747 4554 275d 290a 4066 6c61  ds=['GET']).@fla
+00009e80: 736b 5f63 6173 2e6c 6f67 696e 5f72 6571  sk_cas.login_req
+00009e90: 7569 7265 640a 4061 7567 6d65 6e74 5f61  uired.@augment_a
+00009ea0: 7267 756d 656e 7473 0a64 6566 2072 6f75  rguments.def rou
+00009eb0: 7465 5f65 7874 656e 7369 6f6e 280a 2020  te_extension(.  
+00009ec0: 2020 636f 7572 7365 2c0a 2020 2020 7365    course,.    se
+00009ed0: 6d65 7374 6572 2c0a 2020 2020 7073 6964  mester,.    psid
+00009ee0: 2c0a 2020 2020 2320 4175 676d 656e 7465  ,.    # Augmente
+00009ef0: 6420 6172 6775 6d65 6e74 730a 2020 2020  d arguments.    
+00009f00: 7573 6572 6e61 6d65 2c0a 2020 2020 6973  username,.    is
+00009f10: 5f61 646d 696e 2c0a 2020 2020 6d61 7371  _admin,.    masq
+00009f20: 7565 7261 6465 5f61 732c 0a20 2020 2065  uerade_as,.    e
+00009f30: 6666 6563 7469 7665 5f75 7365 722c 0a20  ffective_user,. 
+00009f40: 2020 2074 6173 6b5f 696e 666f 0a29 3a0a     task_info.):.
+00009f50: 2020 2020 2222 220a 2020 2020 5265 7175      """.    Requ
+00009f60: 6573 7473 2028 616e 6420 6175 746f 6d61  ests (and automa
+00009f70: 7469 6361 6c6c 7920 6772 616e 7473 2920  tically grants) 
+00009f80: 7468 6520 6465 6661 756c 7420 6578 7465  the default exte
+00009f90: 6e73 696f 6e20 6f6e 2074 6865 0a20 2020  nsion on the.   
+00009fa0: 2067 6976 656e 2070 726f 626c 656d 2073   given problem s
+00009fb0: 6574 2e20 5468 6520 6578 7465 6e73 696f  et. The extensio
+00009fc0: 6e20 6973 2061 7070 6c69 6564 2074 6f20  n is applied to 
+00009fd0: 7468 6520 696e 6974 6961 6c20 7068 6173  the initial phas
+00009fe0: 650a 2020 2020 6f6e 6c79 2e20 466f 7220  e.    only. For 
+00009ff0: 6e6f 772c 206e 6f6e 7374 616e 6461 7264  now, nonstandard
+0000a000: 2065 7874 656e 7369 6f6e 7320 616e 6420   extensions and 
+0000a010: 7265 7669 7369 6f6e 2065 7874 656e 7369  revision extensi
+0000a020: 6f6e 7320 6d75 7374 2062 650a 2020 2020  ons must be.    
+0000a030: 6170 706c 6965 6420 6279 2068 616e 642d  applied by hand-
+0000a040: 6564 6974 696e 6720 4a53 4f4e 2066 696c  editing JSON fil
+0000a050: 6573 2069 6e20 7468 6520 6065 7874 656e  es in the `exten
+0000a060: 7369 6f6e 732f 6020 6469 7265 6374 6f72  sions/` director
+0000a070: 792e 0a20 2020 2022 2222 0a20 2020 2074  y..    """.    t
+0000a080: 7279 3a0a 2020 2020 2020 2020 7073 203d  ry:.        ps =
+0000a090: 2067 6574 5f70 735f 6f62 6a28 7461 736b   get_ps_obj(task
+0000a0a0: 5f69 6e66 6f2c 2070 7369 6429 0a20 2020  _info, psid).   
+0000a0b0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+0000a0c0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+0000a0d0: 2066 6c61 736b 2e66 6c61 7368 2873 7472   flask.flash(str
+0000a0e0: 2865 2929 0a20 2020 2020 2020 2072 6574  (e)).        ret
+0000a0f0: 7572 6e20 676f 6261 636b 2863 6f75 7273  urn goback(cours
+0000a100: 652c 2073 656d 6573 7465 7229 0a0a 2020  e, semester)..  
+0000a110: 2020 2320 4164 6420 7374 6174 7573 2026    # Add status &
+0000a120: 2074 696d 6520 7265 6d61 696e 696e 6720   time remaining 
+0000a130: 696e 666f 2074 6f20 7073 6574 0a20 2020  info to pset.   
+0000a140: 2061 6d65 6e64 5f70 7365 7428 636f 7572   amend_pset(cour
+0000a150: 7365 2c20 7365 6d65 7374 6572 2c20 7461  se, semester, ta
+0000a160: 736b 5f69 6e66 6f2c 2070 732c 2065 6666  sk_info, ps, eff
+0000a170: 6563 7469 7665 5f75 7365 7229 0a20 2020  ective_user).   
+0000a180: 2023 2054 4f44 4f3a 2074 7269 706c 652d   # TODO: triple-
+0000a190: 6368 6563 6b20 7468 6520 706f 7373 6962  check the possib
+0000a1a0: 696c 6974 7920 6f66 2072 6571 7565 7374  ility of request
+0000a1b0: 696e 6720 616e 2065 7874 656e 7369 6f6e  ing an extension
+0000a1c0: 0a20 2020 2023 2064 7572 696e 6720 7468  .    # during th
+0000a1d0: 6520 7065 7269 6f64 2061 6e20 6578 7465  e period an exte
+0000a1e0: 6e73 696f 6e20 776f 756c 6420 6772 616e  nsion would gran
+0000a1f0: 7420 796f 7520 6275 7420 6166 7465 7220  t you but after 
+0000a200: 7468 650a 2020 2020 2320 696e 6974 6961  the.    # initia
+0000a210: 6c20 6465 6164 6c69 6e65 3f0a 0a20 2020  l deadline?..   
+0000a220: 2023 2047 7261 6e74 2074 6865 2065 7874   # Grant the ext
+0000a230: 656e 7369 6f6e 0a20 2020 2069 6620 280a  ension.    if (.
+0000a240: 2020 2020 2020 2020 7073 5b22 7374 6174          ps["stat
+0000a250: 7573 225d 5b22 7374 6174 6522 5d20 696e  us"]["state"] in
+0000a260: 2028 2275 6e72 656c 6561 7365 6422 2c20   ("unreleased", 
+0000a270: 2272 656c 6561 7365 6422 290a 2020 2020  "released").    
+0000a280: 616e 6420 7073 5b22 7374 6174 7573 225d  and ps["status"]
+0000a290: 5b22 696e 6974 6961 6c5f 6578 7465 6e73  ["initial_extens
+0000a2a0: 696f 6e22 5d20 3d3d 2030 0a20 2020 2029  ion"] == 0.    )
+0000a2b0: 3a0a 2020 2020 2020 2020 7375 6363 6565  :.        succee
+0000a2c0: 6465 6420 3d20 7374 6f72 6167 652e 7365  ded = storage.se
+0000a2d0: 745f 6578 7465 6e73 696f 6e28 0a20 2020  t_extension(.   
+0000a2e0: 2020 2020 2020 2020 2063 6f75 7273 652c           course,
+0000a2f0: 0a20 2020 2020 2020 2020 2020 2073 656d  .            sem
+0000a300: 6573 7465 722c 0a20 2020 2020 2020 2020  ester,.         
+0000a310: 2020 2065 6666 6563 7469 7665 5f75 7365     effective_use
+0000a320: 722c 0a20 2020 2020 2020 2020 2020 2070  r,.            p
+0000a330: 7369 642c 0a20 2020 2020 2020 2020 2020  sid,.           
+0000a340: 2022 696e 6974 6961 6c22 0a20 2020 2020   "initial".     
+0000a350: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+0000a360: 7375 6363 6565 6465 643a 0a20 2020 2020  succeeded:.     
+0000a370: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
+0000a380: 7368 2822 4578 7465 6e73 696f 6e20 6772  sh("Extension gr
+0000a390: 616e 7465 6420 666f 7220 7b7d 2e22 2e66  anted for {}.".f
+0000a3a0: 6f72 6d61 7428 7073 6964 2929 0a20 2020  ormat(psid)).   
+0000a3b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000a3c0: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
+0000a3d0: 7368 2822 4661 696c 6564 2074 6f20 6772  sh("Failed to gr
+0000a3e0: 616e 7420 6578 7465 6e73 696f 6e20 666f  ant extension fo
+0000a3f0: 7220 7b7d 2e22 2e66 6f72 6d61 7428 7073  r {}.".format(ps
+0000a400: 6964 2929 0a20 2020 2065 6c69 6620 7073  id)).    elif ps
+0000a410: 5b22 7374 6174 7573 225d 5b22 7374 6174  ["status"]["stat
+0000a420: 6522 5d20 6e6f 7420 696e 2028 2275 6e72  e"] not in ("unr
+0000a430: 656c 6561 7365 6422 2c20 2272 656c 6561  eleased", "relea
+0000a440: 7365 6422 293a 0a20 2020 2020 2020 2066  sed"):.        f
+0000a450: 6c61 736b 2e66 6c61 7368 280a 2020 2020  lask.flash(.    
+0000a460: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
+0000a470: 2020 2020 2020 2020 2020 2249 7420 6973            "It is
+0000a480: 2074 6f6f 206c 6174 6520 746f 2072 6571   too late to req
+0000a490: 7565 7374 2061 6e20 6578 7465 6e73 696f  uest an extensio
+0000a4a0: 6e20 666f 7220 7b7d 2e20 596f 7520 6d75  n for {}. You mu
+0000a4b0: 7374 220a 2020 2020 2020 2020 2020 2020  st".            
+0000a4c0: 2020 2020 2220 7265 7175 6573 7420 6578      " request ex
+0000a4d0: 7465 6e73 696f 6e73 2062 6566 6f72 6520  tensions before 
+0000a4e0: 7468 6520 6465 6164 6c69 6e65 2066 6f72  the deadline for
+0000a4f0: 2065 6163 6820 7073 6574 2e22 0a20 2020   each pset.".   
+0000a500: 2020 2020 2020 2020 2029 2e66 6f72 6d61           ).forma
+0000a510: 7428 7073 6964 290a 2020 2020 2020 2020  t(psid).        
+0000a520: 290a 2020 2020 656c 6966 2070 735b 2273  ).    elif ps["s
+0000a530: 7461 7475 7322 5d5b 2269 6e69 7469 616c  tatus"]["initial
+0000a540: 5f65 7874 656e 7369 6f6e 225d 2021 3d20  _extension"] != 
+0000a550: 303a 0a20 2020 2020 2020 2066 6c61 736b  0:.        flask
+0000a560: 2e66 6c61 7368 280a 2020 2020 2020 2020  .flash(.        
+0000a570: 2020 2020 2259 6f75 2068 6176 6520 616c      "You have al
+0000a580: 7265 6164 7920 6265 656e 2067 7261 6e74  ready been grant
+0000a590: 6564 2061 6e20 6578 7465 6e73 696f 6e20  ed an extension 
+0000a5a0: 6f6e 207b 7d2e 222e 666f 726d 6174 2870  on {}.".format(p
+0000a5b0: 7369 6429 0a20 2020 2020 2020 2029 0a20  sid).        ). 
+0000a5c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000a5d0: 2066 6c61 736b 2e66 6c61 7368 280a 2020   flask.flash(.  
+0000a5e0: 2020 2020 2020 2020 2020 2259 6f75 2063            "You c
+0000a5f0: 616e 6e6f 7420 7461 6b65 2061 6e20 6578  annot take an ex
+0000a600: 7465 6e73 696f 6e20 6f6e 207b 7d2e 222e  tension on {}.".
+0000a610: 666f 726d 6174 2870 7369 6429 0a20 2020  format(psid).   
+0000a620: 2020 2020 2029 0a0a 2020 2020 2320 5365       )..    # Se
+0000a630: 6e64 2074 6865 6d20 6261 636b 2074 6f20  nd them back to 
+0000a640: 7468 6520 6461 7368 626f 6172 6420 6f72  the dashboard or
+0000a650: 2077 6865 7265 7665 7220 7468 6579 2063   wherever they c
+0000a660: 616d 6520 6672 6f6d 0a20 2020 2072 6574  ame from.    ret
+0000a670: 7572 6e20 676f 6261 636b 2863 6f75 7273  urn goback(cours
+0000a680: 652c 2073 656d 6573 7465 7229 0a0a 0a40  e, semester)...@
+0000a690: 6170 702e 726f 7574 6528 0a20 2020 2027  app.route(.    '
+0000a6a0: 2f3c 636f 7572 7365 3e2f 3c73 656d 6573  /<course>/<semes
+0000a6b0: 7465 723e 2f73 6574 5f65 7874 656e 7369  ter>/set_extensi
+0000a6c0: 6f6e 732f 3c74 6172 6765 745f 7573 6572  ons/<target_user
+0000a6d0: 3e2f 3c70 7369 643e 272c 0a20 2020 206d  >/<psid>',.    m
+0000a6e0: 6574 686f 6473 3d5b 2750 4f53 5427 5d0a  ethods=['POST'].
+0000a6f0: 290a 4066 6c61 736b 5f63 6173 2e6c 6f67  ).@flask_cas.log
+0000a700: 696e 5f72 6571 7569 7265 640a 4061 7567  in_required.@aug
+0000a710: 6d65 6e74 5f61 7267 756d 656e 7473 0a64  ment_arguments.d
+0000a720: 6566 2072 6f75 7465 5f73 6574 5f65 7874  ef route_set_ext
+0000a730: 656e 7369 6f6e 7328 0a20 2020 2063 6f75  ensions(.    cou
+0000a740: 7273 652c 0a20 2020 2073 656d 6573 7465  rse,.    semeste
+0000a750: 722c 0a20 2020 2074 6172 6765 745f 7573  r,.    target_us
+0000a760: 6572 2c0a 2020 2020 7073 6964 2c0a 2020  er,.    psid,.  
+0000a770: 2020 2320 4175 676d 656e 7465 6420 6172    # Augmented ar
+0000a780: 6775 6d65 6e74 730a 2020 2020 7573 6572  guments.    user
+0000a790: 6e61 6d65 2c0a 2020 2020 6973 5f61 646d  name,.    is_adm
+0000a7a0: 696e 2c0a 2020 2020 6d61 7371 7565 7261  in,.    masquera
+0000a7b0: 6465 5f61 732c 0a20 2020 2065 6666 6563  de_as,.    effec
+0000a7c0: 7469 7665 5f75 7365 722c 0a20 2020 2074  tive_user,.    t
+0000a7d0: 6173 6b5f 696e 666f 0a29 3a0a 2020 2020  ask_info.):.    
+0000a7e0: 2222 220a 2020 2020 466f 726d 2074 6172  """.    Form tar
+0000a7f0: 6765 7420 666f 7220 6564 6974 696e 6720  get for editing 
+0000a800: 6578 7465 6e73 696f 6e73 2066 6f72 2061  extensions for a
+0000a810: 2070 6172 7469 6375 6c61 7220 7573 6572   particular user
+0000a820: 2f70 7365 742e 204f 6e6c 790a 2020 2020  /pset. Only.    
+0000a830: 6164 6d69 6e73 2063 616e 2075 7365 2074  admins can use t
+0000a840: 6869 7320 726f 7574 652e 2043 616e 2062  his route. Can b
+0000a850: 6520 7573 6564 2074 6f20 7365 7420 6375  e used to set cu
+0000a860: 7374 6f6d 2065 7874 656e 7369 6f6e 2076  stom extension v
+0000a870: 616c 7565 730a 2020 2020 666f 7220 626f  alues.    for bo
+0000a880: 7468 2069 6e69 7469 616c 2061 6e64 2072  th initial and r
+0000a890: 6576 6973 6564 2064 6561 646c 696e 6573  evised deadlines
+0000a8a0: 2e0a 0a20 2020 204e 6f74 6520 7468 6174  ...    Note that
+0000a8b0: 2066 6f72 206e 6f77 2c20 7765 2772 6520   for now, we're 
+0000a8c0: 616c 736f 2075 7369 6e67 2069 7420 666f  also using it fo
+0000a8d0: 7220 6578 6572 6369 7365 2065 7874 656e  r exercise exten
+0000a8e0: 7369 6f6e 732e 0a20 2020 2054 4f44 4f3a  sions..    TODO:
+0000a8f0: 2046 6978 2074 6861 742c 2073 696e 6365   Fix that, since
+0000a900: 2069 7420 6d65 616e 7320 7468 6174 2069   it means that i
+0000a910: 6620 616e 2065 7865 7263 6973 6520 6861  f an exercise ha
+0000a920: 7320 7468 6520 7361 6d65 2049 440a 2020  s the same ID.  
+0000a930: 2020 6173 2061 2070 7365 742c 2074 6865    as a pset, the
+0000a940: 6972 2065 7874 656e 7369 6f6e 7320 7769  ir extensions wi
+0000a950: 6c6c 206f 7665 7277 7269 7465 2065 6163  ll overwrite eac
+0000a960: 6820 6f74 6865 7221 2121 0a20 2020 2022  h other!!!.    "
+0000a970: 2222 0a20 2020 2069 6620 6e6f 7420 6973  "".    if not is
+0000a980: 5f61 646d 696e 3a0a 2020 2020 2020 2020  _admin:.        
+0000a990: 666c 6173 6b2e 666c 6173 6828 224f 6e6c  flask.flash("Onl
+0000a9a0: 7920 6164 6d69 6e73 2063 616e 2067 7261  y admins can gra
+0000a9b0: 6e74 2065 7874 656e 7369 6f6e 732e 2229  nt extensions.")
+0000a9c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000a9d0: 676f 6261 636b 2863 6f75 7273 652c 2073  goback(course, s
+0000a9e0: 656d 6573 7465 7229 0a0a 2020 2020 2320  emester)..    # 
+0000a9f0: 4765 7420 696e 6974 6961 6c2f 7265 7669  Get initial/revi
+0000aa00: 7369 6f6e 2065 7874 656e 7369 6f6e 2076  sion extension v
+0000aa10: 616c 7565 7320 6672 6f6d 2073 7562 6d69  alues from submi
+0000aa20: 7474 6564 2066 6f72 6d20 7661 6c75 6573  tted form values
+0000aa30: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
+0000aa40: 2020 696e 6974 6961 6c20 3d20 696e 7428    initial = int(
+0000aa50: 666c 6173 6b2e 7265 7175 6573 742e 666f  flask.request.fo
+0000aa60: 726d 5b22 696e 6974 6961 6c22 5d29 0a20  rm["initial"]). 
+0000aa70: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+0000aa80: 696f 6e3a 0a20 2020 2020 2020 2069 6e69  ion:.        ini
+0000aa90: 7469 616c 203d 204e 6f6e 650a 0a20 2020  tial = None..   
+0000aaa0: 2074 7279 3a0a 2020 2020 2020 2020 7265   try:.        re
+0000aab0: 7669 7369 6f6e 203d 2069 6e74 2866 6c61  vision = int(fla
+0000aac0: 736b 2e72 6571 7565 7374 2e66 6f72 6d5b  sk.request.form[
+0000aad0: 2272 6576 6973 696f 6e22 5d29 0a20 2020  "revision"]).   
+0000aae0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+0000aaf0: 6e3a 0a20 2020 2020 2020 2072 6576 6973  n:.        revis
+0000ab00: 696f 6e20 3d20 4e6f 6e65 0a0a 2020 2020  ion = None..    
+0000ab10: 2320 4174 206c 6561 7374 206f 6e65 206f  # At least one o
+0000ab20: 7220 7468 6520 6f74 6865 7220 6e65 6564  r the other need
+0000ab30: 7320 746f 2062 6520 7661 6c69 640a 2020  s to be valid.  
+0000ab40: 2020 6966 2069 6e69 7469 616c 2069 7320    if initial is 
+0000ab50: 4e6f 6e65 2061 6e64 2072 6576 6973 696f  None and revisio
+0000ab60: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
+0000ab70: 2020 2066 6c61 736b 2e66 6c61 7368 280a     flask.flash(.
+0000ab80: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
+0000ab90: 2020 2020 2020 2020 2020 2020 2020 2254                "T
+0000aba0: 6f20 7365 7420 6578 7465 6e73 696f 6e73  o set extensions
+0000abb0: 2c20 796f 7520 6d75 7374 2073 7065 6369  , you must speci
+0000abc0: 6679 2065 6974 6865 7220 616e 2069 6e69  fy either an ini
+0000abd0: 7469 616c 220a 2020 2020 2020 2020 2020  tial".          
+0000abe0: 2020 2020 2020 2220 6f72 2061 2072 6576        " or a rev
+0000abf0: 6973 696f 6e20 7661 6c75 652c 2061 6e64  ision value, and
+0000ac00: 2062 6f74 6820 7661 6c75 6573 206d 7573   both values mus
+0000ac10: 7420 6265 2069 6e74 6567 6572 732e 220a  t be integers.".
+0000ac20: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000ac30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000ac40: 7265 7475 726e 2067 6f62 6163 6b28 636f  return goback(co
+0000ac50: 7572 7365 2c20 7365 6d65 7374 6572 290a  urse, semester).
+0000ac60: 0a20 2020 2023 2047 7261 6e74 2074 6865  .    # Grant the
+0000ac70: 2065 7874 656e 7369 6f6e 2873 290a 2020   extension(s).  
+0000ac80: 2020 6966 2069 6e69 7469 616c 2069 7320    if initial is 
+0000ac90: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000aca0: 2020 2320 544f 444f 3a20 5573 6520 6f6e    # TODO: Use on
+0000acb0: 6c79 5f66 726f 6d20 6865 7265 2074 6f20  ly_from here to 
+0000acc0: 6865 6c70 2070 7265 7665 6e74 2072 6163  help prevent rac
+0000acd0: 6520 636f 6e64 6974 696f 6e73 206f 6e0a  e conditions on.
+0000ace0: 2020 2020 2020 2020 2320 6c6f 6164 696e          # loadin
+0000acf0: 6720 7468 6520 4854 4d4c 2070 6167 6520  g the HTML page 
+0000ad00: 7468 6174 2064 6973 706c 6179 7320 7468  that displays th
+0000ad10: 6520 6578 7465 6e73 696f 6e20 7661 6c75  e extension valu
+0000ad20: 6573 0a20 2020 2020 2020 2073 7563 6365  es.        succe
+0000ad30: 6564 6564 203d 2073 746f 7261 6765 2e73  eded = storage.s
+0000ad40: 6574 5f65 7874 656e 7369 6f6e 280a 2020  et_extension(.  
+0000ad50: 2020 2020 2020 2020 2020 636f 7572 7365            course
+0000ad60: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+0000ad70: 6d65 7374 6572 2c0a 2020 2020 2020 2020  mester,.        
+0000ad80: 2020 2020 7461 7267 6574 5f75 7365 722c      target_user,
+0000ad90: 0a20 2020 2020 2020 2020 2020 2070 7369  .            psi
+0000ada0: 642c 0a20 2020 2020 2020 2020 2020 2022  d,.            "
+0000adb0: 696e 6974 6961 6c22 2c0a 2020 2020 2020  initial",.      
+0000adc0: 2020 2020 2020 696e 6974 6961 6c0a 2020        initial.  
+0000add0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000ade0: 6966 2073 7563 6365 6564 6564 3a0a 2020  if succeeded:.  
+0000adf0: 2020 2020 2020 2020 2020 666c 6173 6b2e            flask.
+0000ae00: 666c 6173 6828 0a20 2020 2020 2020 2020  flash(.         
+0000ae10: 2020 2020 2020 2022 5365 7420 7b7d 6820         "Set {}h 
+0000ae20: 696e 6974 6961 6c20 6578 7465 6e73 696f  initial extensio
+0000ae30: 6e20 666f 7220 7b7d 206f 6e20 7b7d 2e22  n for {} on {}."
+0000ae40: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
+0000ae50: 2020 2020 2020 2020 2020 2020 2069 6e69               ini
+0000ae60: 7469 616c 2c0a 2020 2020 2020 2020 2020  tial,.          
+0000ae70: 2020 2020 2020 2020 2020 7461 7267 6574            target
+0000ae80: 5f75 7365 722c 0a20 2020 2020 2020 2020  _user,.         
+0000ae90: 2020 2020 2020 2020 2020 2070 7369 640a             psid.
+0000aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aeb0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+0000aec0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000aed0: 2020 2020 2020 2020 2020 666c 6173 6b2e            flask.
+0000aee0: 666c 6173 6828 0a20 2020 2020 2020 2020  flash(.         
+0000aef0: 2020 2020 2020 2022 4661 696c 6564 2074         "Failed t
+0000af00: 6f20 6772 616e 7420 696e 6974 6961 6c20  o grant initial 
+0000af10: 6578 7465 6e73 696f 6e20 666f 7220 7b7d  extension for {}
+0000af20: 206f 6e20 7b7d 2028 7472 7920 6167 6169   on {} (try agai
+0000af30: 6e3f 292e 220a 2020 2020 2020 2020 2020  n?).".          
+0000af40: 2020 2020 2020 2e66 6f72 6d61 7428 7461        .format(ta
+0000af50: 7267 6574 5f75 7365 722c 2070 7369 6429  rget_user, psid)
+0000af60: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+0000af70: 2020 2020 6966 2072 6576 6973 696f 6e20      if revision 
+0000af80: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000af90: 2020 2020 2073 7563 6365 6564 6564 203d       succeeded =
+0000afa0: 2073 746f 7261 6765 2e73 6574 5f65 7874   storage.set_ext
+0000afb0: 656e 7369 6f6e 280a 2020 2020 2020 2020  ension(.        
+0000afc0: 2020 2020 636f 7572 7365 2c0a 2020 2020      course,.    
+0000afd0: 2020 2020 2020 2020 7365 6d65 7374 6572          semester
+0000afe0: 2c0a 2020 2020 2020 2020 2020 2020 7461  ,.            ta
+0000aff0: 7267 6574 5f75 7365 722c 0a20 2020 2020  rget_user,.     
+0000b000: 2020 2020 2020 2070 7369 642c 0a20 2020         psid,.   
+0000b010: 2020 2020 2020 2020 2022 7265 7669 7369           "revisi
+0000b020: 6f6e 222c 0a20 2020 2020 2020 2020 2020  on",.           
+0000b030: 2072 6576 6973 696f 6e0a 2020 2020 2020   revision.      
+0000b040: 2020 290a 2020 2020 2020 2020 6966 2073    ).        if s
+0000b050: 7563 6365 6564 6564 3a0a 2020 2020 2020  ucceeded:.      
+0000b060: 2020 2020 2020 666c 6173 6b2e 666c 6173        flask.flas
+0000b070: 6828 0a20 2020 2020 2020 2020 2020 2020  h(.             
+0000b080: 2020 2022 5365 7420 7b7d 6820 7265 7669     "Set {}h revi
+0000b090: 7369 6f6e 2065 7874 656e 7369 6f6e 2066  sion extension f
+0000b0a0: 6f72 207b 7d20 6f6e 207b 7d2e 222e 666f  or {} on {}.".fo
+0000b0b0: 726d 6174 280a 2020 2020 2020 2020 2020  rmat(.          
+0000b0c0: 2020 2020 2020 2020 2020 7265 7669 7369            revisi
+0000b0d0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0000b0e0: 2020 2020 2020 2020 7461 7267 6574 5f75          target_u
+0000b0f0: 7365 722c 0a20 2020 2020 2020 2020 2020  ser,.           
+0000b100: 2020 2020 2020 2020 2070 7369 640a 2020           psid.  
+0000b110: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000b120: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000b130: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000b140: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
+0000b150: 6173 6828 0a20 2020 2020 2020 2020 2020  ash(.           
+0000b160: 2020 2020 2022 4661 696c 6564 2074 6f20       "Failed to 
+0000b170: 6772 616e 7420 7265 7669 7369 6f6e 2065  grant revision e
+0000b180: 7874 656e 7369 6f6e 2066 6f72 207b 7d20  xtension for {} 
+0000b190: 6f6e 207b 7d20 2874 7279 2061 6761 696e  on {} (try again
+0000b1a0: 3f29 2e22 0a20 2020 2020 2020 2020 2020  ?).".           
+0000b1b0: 2020 2020 202e 666f 726d 6174 2874 6172       .format(tar
+0000b1c0: 6765 745f 7573 6572 2c20 7073 6964 290a  get_user, psid).
+0000b1d0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000b1e0: 2020 2023 2053 656e 6420 7468 656d 2062     # Send them b
+0000b1f0: 6163 6b20 746f 2074 6865 2064 6173 6862  ack to the dashb
+0000b200: 6f61 7264 206f 7220 7768 6572 6576 6572  oard or wherever
+0000b210: 2074 6865 7920 6361 6d65 2066 726f 6d0a   they came from.
+0000b220: 2020 2020 7265 7475 726e 2067 6f62 6163      return gobac
+0000b230: 6b28 636f 7572 7365 2c20 7365 6d65 7374  k(course, semest
+0000b240: 6572 290a 0a0a 4061 7070 2e72 6f75 7465  er)...@app.route
+0000b250: 280a 2020 2020 272f 3c63 6f75 7273 653e  (.    '/<course>
+0000b260: 2f3c 7365 6d65 7374 6572 3e2f 6d61 6e61  /<semester>/mana
+0000b270: 6765 5f65 7874 656e 7369 6f6e 732f 3c74  ge_extensions/<t
+0000b280: 6172 6765 745f 7573 6572 3e27 2c0a 2020  arget_user>',.  
+0000b290: 2020 6d65 7468 6f64 733d 5b27 4745 5427    methods=['GET'
+0000b2a0: 5d0a 290a 4066 6c61 736b 5f63 6173 2e6c  ].).@flask_cas.l
+0000b2b0: 6f67 696e 5f72 6571 7569 7265 640a 4061  ogin_required.@a
+0000b2c0: 7567 6d65 6e74 5f61 7267 756d 656e 7473  ugment_arguments
+0000b2d0: 0a64 6566 2072 6f75 7465 5f6d 616e 6167  .def route_manag
+0000b2e0: 655f 6578 7465 6e73 696f 6e73 280a 2020  e_extensions(.  
+0000b2f0: 2020 636f 7572 7365 2c0a 2020 2020 7365    course,.    se
+0000b300: 6d65 7374 6572 2c0a 2020 2020 7461 7267  mester,.    targ
+0000b310: 6574 5f75 7365 722c 0a20 2020 2023 2041  et_user,.    # A
+0000b320: 7567 6d65 6e74 6564 2061 7267 756d 656e  ugmented argumen
+0000b330: 7473 0a20 2020 2075 7365 726e 616d 652c  ts.    username,
+0000b340: 0a20 2020 2069 735f 6164 6d69 6e2c 0a20  .    is_admin,. 
+0000b350: 2020 206d 6173 7175 6572 6164 655f 6173     masquerade_as
+0000b360: 2c0a 2020 2020 6566 6665 6374 6976 655f  ,.    effective_
+0000b370: 7573 6572 2c0a 2020 2020 7461 736b 5f69  user,.    task_i
+0000b380: 6e66 6f0a 293a 0a20 2020 2022 2222 0a20  nfo.):.    """. 
+0000b390: 2020 2041 646d 696e 2d6f 6e6c 7920 726f     Admin-only ro
+0000b3a0: 7574 6520 7468 6174 2064 6973 706c 6179  ute that display
+0000b3b0: 7320 6120 6c69 7374 206f 6620 666f 726d  s a list of form
+0000b3c0: 7320 666f 7220 6561 6368 2070 7365 7420  s for each pset 
+0000b3d0: 7368 6f77 696e 670a 2020 2020 6375 7272  showing.    curr
+0000b3e0: 656e 7420 6578 7465 6e73 696f 6e20 7661  ent extension va
+0000b3f0: 6c75 6573 2061 6e64 2061 6c6c 6f77 696e  lues and allowin
+0000b400: 6720 7468 6520 7573 6572 2074 6f20 6564  g the user to ed
+0000b410: 6974 2074 6865 6d20 616e 6420 7072 6573  it them and pres
+0000b420: 730a 2020 2020 6120 6275 7474 6f6e 2074  s.    a button t
+0000b430: 6f20 7570 6461 7465 2074 6865 6d2e 0a20  o update them.. 
+0000b440: 2020 2022 2222 0a20 2020 2069 6620 6e6f     """.    if no
+0000b450: 7420 6973 5f61 646d 696e 3a0a 2020 2020  t is_admin:.    
+0000b460: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
+0000b470: 224f 6e6c 7920 6164 6d69 6e73 2063 616e  "Only admins can
+0000b480: 2067 7261 6e74 2065 7874 656e 7369 6f6e   grant extension
+0000b490: 732e 2229 0a20 2020 2020 2020 2072 6574  s.").        ret
+0000b4a0: 7572 6e20 676f 6261 636b 2863 6f75 7273  urn goback(cours
+0000b4b0: 652c 2073 656d 6573 7465 7229 0a0a 2020  e, semester)..  
+0000b4c0: 2020 2320 4765 7420 6578 7465 6e73 696f    # Get extensio
+0000b4d0: 6e73 2069 6e66 6f20 666f 7220 7468 6520  ns info for the 
+0000b4e0: 7461 7267 6574 2075 7365 7220 666f 7220  target user for 
+0000b4f0: 616c 6c20 7073 6574 730a 2020 2020 616d  all psets.    am
+0000b500: 656e 645f 7461 736b 5f69 6e66 6f28 636f  end_task_info(co
+0000b510: 7572 7365 2c20 7365 6d65 7374 6572 2c20  urse, semester, 
+0000b520: 7461 736b 5f69 6e66 6f2c 2074 6172 6765  task_info, targe
+0000b530: 745f 7573 6572 290a 0a20 2020 2023 2041  t_user)..    # A
+0000b540: 6d65 6e64 2065 7865 7263 6973 6520 7374  mend exercise st
+0000b550: 6174 7573 6573 2028 7573 696e 6720 626c  atuses (using bl
+0000b560: 616e 6b20 6f75 7463 6f6d 6573 2073 696e  ank outcomes sin
+0000b570: 6365 2077 6527 7265 206f 6e6c 790a 2020  ce we're only.  
+0000b580: 2020 2320 7573 696e 6720 7468 6520 6578    # using the ex
+0000b590: 7465 6e73 696f 6e20 696e 666f 290a 2020  tension info).  
+0000b5a0: 2020 616d 656e 645f 6578 6572 6369 7365    amend_exercise
+0000b5b0: 7328 636f 7572 7365 2c20 7365 6d65 7374  s(course, semest
+0000b5c0: 6572 2c20 7461 736b 5f69 6e66 6f2c 207b  er, task_info, {
+0000b5d0: 7d2c 2065 6666 6563 7469 7665 5f75 7365  }, effective_use
+0000b5e0: 7229 0a0a 2020 2020 7265 7475 726e 2066  r)..    return f
+0000b5f0: 6c61 736b 2e72 656e 6465 725f 7465 6d70  lask.render_temp
+0000b600: 6c61 7465 280a 2020 2020 2020 2020 2765  late(.        'e
+0000b610: 7874 656e 7369 6f6e 5f6d 616e 6167 6572  xtension_manager
+0000b620: 2e6a 3227 2c0a 2020 2020 2020 2020 636f  .j2',.        co
+0000b630: 7572 7365 5f6e 616d 653d 6170 702e 636f  urse_name=app.co
+0000b640: 6e66 6967 2e67 6574 2822 434f 5552 5345  nfig.get("COURSE
+0000b650: 5f4e 414d 4553 222c 207b 7d29 2e67 6574  _NAMES", {}).get
+0000b660: 2863 6f75 7273 652c 2063 6f75 7273 6529  (course, course)
+0000b670: 2c0a 2020 2020 2020 2020 636f 7572 7365  ,.        course
+0000b680: 3d63 6f75 7273 652c 0a20 2020 2020 2020  =course,.       
+0000b690: 2073 656d 6573 7465 723d 7365 6d65 7374   semester=semest
+0000b6a0: 6572 2c0a 2020 2020 2020 2020 7573 6572  er,.        user
+0000b6b0: 6e61 6d65 3d75 7365 726e 616d 652c 0a20  name=username,. 
+0000b6c0: 2020 2020 2020 2069 735f 6164 6d69 6e3d         is_admin=
+0000b6d0: 6973 5f61 646d 696e 2c0a 2020 2020 2020  is_admin,.      
+0000b6e0: 2020 6d61 7371 7565 7261 6465 5f61 733d    masquerade_as=
+0000b6f0: 6d61 7371 7565 7261 6465 5f61 732c 0a20  masquerade_as,. 
+0000b700: 2020 2020 2020 2074 6173 6b5f 696e 666f         task_info
+0000b710: 3d74 6173 6b5f 696e 666f 2c0a 2020 2020  =task_info,.    
+0000b720: 2020 2020 7461 7267 6574 5f75 7365 723d      target_user=
+0000b730: 7461 7267 6574 5f75 7365 720a 2020 2020  target_user.    
+0000b740: 290a 0a0a 4061 7070 2e72 6f75 7465 280a  )...@app.route(.
+0000b750: 2020 2020 272f 3c63 6f75 7273 653e 2f3c      '/<course>/<
+0000b760: 7365 6d65 7374 6572 3e2f 7365 745f 6576  semester>/set_ev
+0000b770: 616c 2f3c 7461 7267 6574 5f75 7365 723e  al/<target_user>
+0000b780: 2f3c 7068 6173 653e 2f3c 7073 6964 3e2f  /<phase>/<psid>/
+0000b790: 3c74 6173 6b69 643e 272c 0a20 2020 206d  <taskid>',.    m
+0000b7a0: 6574 686f 6473 3d5b 2750 4f53 5427 5d0a  ethods=['POST'].
+0000b7b0: 290a 4066 6c61 736b 5f63 6173 2e6c 6f67  ).@flask_cas.log
+0000b7c0: 696e 5f72 6571 7569 7265 640a 4061 7567  in_required.@aug
+0000b7d0: 6d65 6e74 5f61 7267 756d 656e 7473 0a64  ment_arguments.d
+0000b7e0: 6566 2072 6f75 7465 5f73 6574 5f65 7661  ef route_set_eva
+0000b7f0: 6c75 6174 696f 6e28 0a20 2020 2063 6f75  luation(.    cou
+0000b800: 7273 652c 0a20 2020 2073 656d 6573 7465  rse,.    semeste
+0000b810: 722c 0a20 2020 2074 6172 6765 745f 7573  r,.    target_us
+0000b820: 6572 2c0a 2020 2020 7068 6173 652c 0a20  er,.    phase,. 
+0000b830: 2020 2070 7369 642c 0a20 2020 2074 6173     psid,.    tas
+0000b840: 6b69 642c 0a20 2020 2023 2041 7567 6d65  kid,.    # Augme
+0000b850: 6e74 6564 2061 7267 756d 656e 7473 0a20  nted arguments. 
+0000b860: 2020 2075 7365 726e 616d 652c 0a20 2020     username,.   
+0000b870: 2069 735f 6164 6d69 6e2c 0a20 2020 206d   is_admin,.    m
+0000b880: 6173 7175 6572 6164 655f 6173 2c0a 2020  asquerade_as,.  
+0000b890: 2020 6566 6665 6374 6976 655f 7573 6572    effective_user
+0000b8a0: 2c0a 2020 2020 7461 736b 5f69 6e66 6f0a  ,.    task_info.
+0000b8b0: 293a 0a20 2020 2022 2222 0a20 2020 2046  ):.    """.    F
+0000b8c0: 6f72 6d20 7461 7267 6574 2066 6f72 2065  orm target for e
+0000b8d0: 6469 7469 6e67 2063 7573 746f 6d20 6576  diting custom ev
+0000b8e0: 616c 7561 7469 6f6e 2069 6e66 6f20 666f  aluation info fo
+0000b8f0: 7220 6120 7061 7274 6963 756c 6172 0a20  r a particular. 
+0000b900: 2020 2075 7365 722f 7073 6574 2e20 4f6e     user/pset. On
+0000b910: 6c79 2061 646d 696e 7320 6361 6e20 7573  ly admins can us
+0000b920: 6520 7468 6973 2072 6f75 7465 2e20 4361  e this route. Ca
+0000b930: 6e20 6265 2075 7365 6420 746f 2073 6574  n be used to set
+0000b940: 2063 7573 746f 6d0a 2020 2020 6e6f 7465   custom.    note
+0000b950: 7320 616e 642f 6f72 2061 2067 7261 6465  s and/or a grade
+0000b960: 206f 7665 7272 6964 6520 666f 7220 6120   override for a 
+0000b970: 7061 7274 6963 756c 6172 2075 7365 722f  particular user/
+0000b980: 7068 6173 652f 7073 6574 2f74 6173 6b2e  phase/pset/task.
+0000b990: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+0000b9a0: 6e6f 7420 6973 5f61 646d 696e 3a0a 2020  not is_admin:.  
+0000b9b0: 2020 2020 2020 2320 544f 444f 3a20 4772        # TODO: Gr
+0000b9c0: 6164 6572 2072 6f6c 6521 0a20 2020 2020  ader role!.     
+0000b9d0: 2020 2066 6c61 736b 2e66 6c61 7368 2822     flask.flash("
+0000b9e0: 4f6e 6c79 2061 646d 696e 7320 6361 6e20  Only admins can 
+0000b9f0: 6564 6974 2065 7661 6c75 6174 696f 6e73  edit evaluations
+0000ba00: 2e22 290a 2020 2020 2020 2020 7265 7475  .").        retu
+0000ba10: 726e 2067 6f62 6163 6b28 636f 7572 7365  rn goback(course
+0000ba20: 2c20 7365 6d65 7374 6572 290a 0a20 2020  , semester)..   
+0000ba30: 2023 2047 6574 206e 6f74 6573 2026 206f   # Get notes & o
+0000ba40: 7665 7272 6964 6573 2066 726f 6d20 666f  verrides from fo
+0000ba50: 726d 2076 616c 7565 730a 2020 2020 7472  rm values.    tr
+0000ba60: 793a 0a20 2020 2020 2020 206e 6f74 6573  y:.        notes
+0000ba70: 203d 2066 6c61 736b 2e72 6571 7565 7374   = flask.request
+0000ba80: 2e66 6f72 6d5b 226e 6f74 6573 5f6d 6422  .form["notes_md"
+0000ba90: 5d0a 2020 2020 6578 6365 7074 2045 7863  ].    except Exc
+0000baa0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+0000bab0: 6e6f 7465 7320 3d20 4e6f 6e65 0a0a 2020  notes = None..  
+0000bac0: 2020 7472 793a 0a20 2020 2020 2020 206f    try:.        o
+0000bad0: 7665 7272 6964 6520 3d20 666c 6173 6b2e  verride = flask.
+0000bae0: 7265 7175 6573 742e 666f 726d 5b22 6f76  request.form["ov
+0000baf0: 6572 7269 6465 225d 0a20 2020 2065 7863  erride"].    exc
+0000bb00: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+0000bb10: 2020 2020 2020 206f 7665 7272 6964 6520         override 
+0000bb20: 3d20 4e6f 6e65 0a0a 2020 2020 2320 4174  = None..    # At
+0000bb30: 7465 6d70 7420 746f 2063 6f6e 7665 7274  tempt to convert
+0000bb40: 2074 6f20 6120 6e75 6d62 6572 0a20 2020   to a number.   
+0000bb50: 2069 6620 6f76 6572 7269 6465 2069 7320   if override is 
+0000bb60: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000bb70: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000bb80: 2020 206f 7665 7272 6964 6520 3d20 666c     override = fl
+0000bb90: 6f61 7428 6f76 6572 7269 6465 290a 2020  oat(override).  
+0000bba0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0000bbb0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+0000bbc0: 2020 2020 7061 7373 0a0a 2020 2020 7472      pass..    tr
+0000bbd0: 793a 0a20 2020 2020 2020 2074 696d 656c  y:.        timel
+0000bbe0: 696e 6573 7320 3d20 666c 6173 6b2e 7265  iness = flask.re
+0000bbf0: 7175 6573 742e 666f 726d 5b22 7469 6d65  quest.form["time
+0000bc00: 6c69 6e65 7373 5f6f 7665 7272 6964 6522  liness_override"
+0000bc10: 5d0a 2020 2020 6578 6365 7074 2045 7863  ].    except Exc
+0000bc20: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+0000bc30: 7469 6d65 6c69 6e65 7373 203d 204e 6f6e  timeliness = Non
+0000bc40: 650a 0a20 2020 2023 2041 7474 656d 7074  e..    # Attempt
+0000bc50: 2074 6f20 636f 6e76 6572 7420 746f 2061   to convert to a
+0000bc60: 206e 756d 6265 720a 2020 2020 6966 2074   number.    if t
+0000bc70: 696d 656c 696e 6573 7320 6973 206e 6f74  imeliness is not
+0000bc80: 204e 6f6e 653a 0a20 2020 2020 2020 2074   None:.        t
+0000bc90: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000bca0: 7469 6d65 6c69 6e65 7373 203d 2066 6c6f  timeliness = flo
+0000bcb0: 6174 2874 696d 656c 696e 6573 7329 0a20  at(timeliness). 
+0000bcc0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0000bcd0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+0000bce0: 2020 2020 2070 6173 730a 0a20 2020 2023       pass..    #
+0000bcf0: 2041 7420 6c65 6173 7420 6f6e 6520 6f66   At least one of
+0000bd00: 2074 6865 6d20 6e65 6564 7320 746f 2062   them needs to b
+0000bd10: 6520 7661 6c69 640a 2020 2020 6966 206e  e valid.    if n
+0000bd20: 6f74 6573 2069 7320 4e6f 6e65 2061 6e64  otes is None and
+0000bd30: 206f 7665 7272 6964 6520 6973 204e 6f6e   override is Non
+0000bd40: 6520 616e 6420 7469 6d65 6c69 6e65 7373  e and timeliness
+0000bd50: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000bd60: 2020 666c 6173 6b2e 666c 6173 6828 0a20    flask.flash(. 
+0000bd70: 2020 2020 2020 2020 2020 2022 546f 2073             "To s
+0000bd80: 6574 2061 6e20 6576 616c 7561 7469 6f6e  et an evaluation
+0000bd90: 2c20 796f 7520 6d75 7374 2073 7065 6369  , you must speci
+0000bda0: 6679 2061 7420 6c65 6173 7420 6f6e 6520  fy at least one 
+0000bdb0: 6f66 3a20 6122 0a20 2020 2020 2020 2020  of: a".         
+0000bdc0: 2020 2022 206e 6f74 6573 2073 7472 696e     " notes strin
+0000bdd0: 672c 2061 2067 7261 6465 206f 7665 7272  g, a grade overr
+0000bde0: 6964 652c 206f 7220 6120 7469 6d65 6c69  ide, or a timeli
+0000bdf0: 6e65 7373 206f 7665 7272 6964 652e 220a  ness override.".
+0000be00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000be10: 2020 7265 7475 726e 2067 6f62 6163 6b28    return goback(
+0000be20: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
+0000be30: 290a 0a20 2020 2023 2054 7572 6e20 4e6f  )..    # Turn No
+0000be40: 6e65 7320 696e 746f 2065 6d70 7479 2073  nes into empty s
+0000be50: 7472 696e 6773 3a0a 2020 2020 6966 206e  trings:.    if n
+0000be60: 6f74 6573 2069 7320 4e6f 6e65 3a0a 2020  otes is None:.  
+0000be70: 2020 2020 2020 6e6f 7465 7320 3d20 2727        notes = ''
+0000be80: 0a0a 2020 2020 6966 206f 7665 7272 6964  ..    if overrid
+0000be90: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+0000bea0: 2020 206f 7665 7272 6964 6520 3d20 2727     override = ''
+0000beb0: 0a0a 2020 2020 6966 2074 696d 656c 696e  ..    if timelin
+0000bec0: 6573 7320 6973 204e 6f6e 653a 0a20 2020  ess is None:.   
+0000bed0: 2020 2020 2074 696d 656c 696e 6573 7320       timeliness 
+0000bee0: 3d20 2727 0a0a 2020 2020 2320 544f 444f  = ''..    # TODO
+0000bef0: 3a20 4372 6561 7465 2061 6e64 2075 7365  : Create and use
+0000bf00: 2061 6e20 6f6e 6c79 5f66 726f 6d20 6d65   an only_from me
+0000bf10: 6368 616e 6973 6d20 6865 7265 2074 6f20  chanism here to 
+0000bf20: 6865 6c70 0a20 2020 2023 2070 7265 7665  help.    # preve
+0000bf30: 6e74 2072 6163 6520 636f 6e64 6974 696f  nt race conditio
+0000bf40: 6e73 206f 6e20 6c6f 6164 696e 6720 7468  ns on loading th
+0000bf50: 6520 4854 4d4c 2070 6167 6520 7468 6174  e HTML page that
+0000bf60: 2064 6973 706c 6179 730a 2020 2020 2320   displays.    # 
+0000bf70: 7468 6520 6f6c 6420 6576 616c 7561 7469  the old evaluati
+0000bf80: 6f6e 2076 616c 7565 733f 0a20 2020 2073  on values?.    s
+0000bf90: 7563 6365 6564 6564 203d 2073 746f 7261  ucceeded = stora
+0000bfa0: 6765 2e73 6574 5f65 7661 6c75 6174 696f  ge.set_evaluatio
+0000bfb0: 6e28 0a20 2020 2020 2020 2063 6f75 7273  n(.        cours
+0000bfc0: 652c 0a20 2020 2020 2020 2073 656d 6573  e,.        semes
+0000bfd0: 7465 722c 0a20 2020 2020 2020 2074 6172  ter,.        tar
+0000bfe0: 6765 745f 7573 6572 2c0a 2020 2020 2020  get_user,.      
+0000bff0: 2020 7068 6173 652c 0a20 2020 2020 2020    phase,.       
+0000c000: 2070 7369 642c 0a20 2020 2020 2020 2074   psid,.        t
+0000c010: 6173 6b69 642c 0a20 2020 2020 2020 206e  askid,.        n
+0000c020: 6f74 6573 2c0a 2020 2020 2020 2020 6f76  otes,.        ov
+0000c030: 6572 7269 6465 2c0a 2020 2020 2020 2020  erride,.        
+0000c040: 7469 6d65 6c69 6e65 7373 0a20 2020 2029  timeliness.    )
+0000c050: 0a20 2020 2069 6620 7375 6363 6565 6465  .    if succeede
+0000c060: 643a 0a20 2020 2020 2020 2066 6c61 736b  d:.        flask
+0000c070: 2e66 6c61 7368 280a 2020 2020 2020 2020  .flash(.        
+0000c080: 2020 2020 2255 7064 6174 6564 2065 7661      "Updated eva
+0000c090: 6c75 6174 696f 6e20 666f 7220 7b7d 206f  luation for {} o
+0000c0a0: 6e20 7b7d 207b 7d20 7b7d 2073 7562 6d69  n {} {} {} submi
+0000c0b0: 7373 696f 6e2e 222e 666f 726d 6174 280a  ssion.".format(.
+0000c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0d0: 7461 7267 6574 5f75 7365 722c 0a20 2020  target_user,.   
+0000c0e0: 2020 2020 2020 2020 2020 2020 2070 7369               psi
+0000c0f0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0000c100: 2020 2074 6173 6b69 642c 0a20 2020 2020     taskid,.     
+0000c110: 2020 2020 2020 2020 2020 2070 6861 7365             phase
+0000c120: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000c130: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
+0000c140: 653a 0a20 2020 2020 2020 2066 6c61 736b  e:.        flask
+0000c150: 2e66 6c61 7368 280a 2020 2020 2020 2020  .flash(.        
+0000c160: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+0000c170: 2020 2020 2020 2246 6169 6c65 6420 746f        "Failed to
+0000c180: 2075 7064 6174 6520 6576 616c 7561 7469   update evaluati
+0000c190: 6f6e 2066 6f72 207b 7d20 6f6e 207b 7d20  on for {} on {} 
+0000c1a0: 7b7d 207b 7d22 0a20 2020 2020 2020 2020  {} {}".         
+0000c1b0: 2020 2020 2020 2022 2073 7562 6d69 7373         " submiss
+0000c1c0: 696f 6e2e 220a 2020 2020 2020 2020 2020  ion.".          
+0000c1d0: 2020 292e 666f 726d 6174 280a 2020 2020    ).format(.    
+0000c1e0: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+0000c1f0: 6574 5f75 7365 722c 0a20 2020 2020 2020  et_user,.       
+0000c200: 2020 2020 2020 2020 2070 7369 642c 0a20           psid,. 
+0000c210: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000c220: 6173 6b69 642c 0a20 2020 2020 2020 2020  askid,.         
+0000c230: 2020 2020 2020 2070 6861 7365 0a20 2020         phase.   
+0000c240: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000c250: 2020 2029 0a0a 2020 2020 2320 5365 6e64     )..    # Send
+0000c260: 2074 6865 6d20 746f 2074 6865 2065 7661   them to the eva
+0000c270: 6c75 6174 696f 6e2d 6564 6974 696e 6720  luation-editing 
+0000c280: 7061 6765 0a20 2020 2072 6574 7572 6e20  page.    return 
+0000c290: 666c 6173 6b2e 7265 6469 7265 6374 280a  flask.redirect(.
+0000c2a0: 2020 2020 2020 2020 666c 6173 6b2e 7572          flask.ur
+0000c2b0: 6c5f 666f 7228 0a20 2020 2020 2020 2020  l_for(.         
+0000c2c0: 2020 2027 726f 7574 655f 6576 616c 7561     'route_evalua
+0000c2d0: 7465 272c 0a20 2020 2020 2020 2020 2020  te',.           
+0000c2e0: 2063 6f75 7273 653d 636f 7572 7365 2c0a   course=course,.
+0000c2f0: 2020 2020 2020 2020 2020 2020 7365 6d65              seme
+0000c300: 7374 6572 3d73 656d 6573 7465 722c 0a20  ster=semester,. 
+0000c310: 2020 2020 2020 2020 2020 2074 6172 6765             targe
+0000c320: 745f 7573 6572 3d74 6172 6765 745f 7573  t_user=target_us
+0000c330: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+0000c340: 7068 6173 653d 7068 6173 652c 0a20 2020  phase=phase,.   
+0000c350: 2020 2020 2020 2020 2070 7369 643d 7073           psid=ps
+0000c360: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
+0000c370: 7461 736b 6964 3d74 6173 6b69 640a 2020  taskid=taskid.  
+0000c380: 2020 2020 2020 290a 2020 2020 290a 0a0a        ).    )...
+0000c390: 4061 7070 2e72 6f75 7465 280a 2020 2020  @app.route(.    
+0000c3a0: 272f 3c63 6f75 7273 653e 2f3c 7365 6d65  '/<course>/<seme
+0000c3b0: 7374 6572 3e2f 6576 616c 7561 7465 2f3c  ster>/evaluate/<
+0000c3c0: 7461 7267 6574 5f75 7365 723e 2f3c 7068  target_user>/<ph
+0000c3d0: 6173 653e 2f3c 7073 6964 3e2f 3c74 6173  ase>/<psid>/<tas
+0000c3e0: 6b69 643e 272c 0a20 2020 206d 6574 686f  kid>',.    metho
+0000c3f0: 6473 3d5b 2747 4554 275d 0a29 0a40 666c  ds=['GET'].).@fl
+0000c400: 6173 6b5f 6361 732e 6c6f 6769 6e5f 7265  ask_cas.login_re
+0000c410: 7175 6972 6564 0a40 6175 676d 656e 745f  quired.@augment_
+0000c420: 6172 6775 6d65 6e74 730a 6465 6620 726f  arguments.def ro
+0000c430: 7574 655f 6576 616c 7561 7465 280a 2020  ute_evaluate(.  
+0000c440: 2020 636f 7572 7365 2c0a 2020 2020 7365    course,.    se
+0000c450: 6d65 7374 6572 2c0a 2020 2020 7461 7267  mester,.    targ
+0000c460: 6574 5f75 7365 722c 0a20 2020 2070 6861  et_user,.    pha
+0000c470: 7365 2c0a 2020 2020 7073 6964 2c0a 2020  se,.    psid,.  
+0000c480: 2020 7461 736b 6964 2c0a 2020 2020 2320    taskid,.    # 
+0000c490: 4175 676d 656e 7465 6420 6172 6775 6d65  Augmented argume
+0000c4a0: 6e74 730a 2020 2020 7573 6572 6e61 6d65  nts.    username
+0000c4b0: 2c0a 2020 2020 6973 5f61 646d 696e 2c0a  ,.    is_admin,.
+0000c4c0: 2020 2020 6d61 7371 7565 7261 6465 5f61      masquerade_a
+0000c4d0: 732c 0a20 2020 2065 6666 6563 7469 7665  s,.    effective
+0000c4e0: 5f75 7365 722c 0a20 2020 2074 6173 6b5f  _user,.    task_
+0000c4f0: 696e 666f 0a29 3a0a 2020 2020 2222 220a  info.):.    """.
+0000c500: 2020 2020 4469 7370 6c61 7973 2073 7475      Displays stu
+0000c510: 6465 6e74 2066 6565 6462 6163 6b20 616e  dent feedback an
+0000c520: 6420 616c 736f 2069 6e63 6c75 6465 7320  d also includes 
+0000c530: 6120 666f 726d 2061 7420 7468 6520 746f  a form at the to
+0000c540: 7020 666f 720a 2020 2020 6164 6469 6e67  p for.    adding
+0000c550: 2061 2063 7573 746f 6d20 6e6f 7465 2061   a custom note a
+0000c560: 6e64 2f6f 7220 6f76 6572 7269 6469 6e67  nd/or overriding
+0000c570: 2074 6865 2067 7261 6465 2e0a 2020 2020   the grade..    
+0000c580: 2222 220a 2020 2020 6966 206e 6f74 2069  """.    if not i
+0000c590: 735f 6164 6d69 6e3a 0a20 2020 2020 2020  s_admin:.       
+0000c5a0: 2023 2054 4f44 4f3a 2047 7261 6465 7220   # TODO: Grader 
+0000c5b0: 726f 6c65 210a 2020 2020 2020 2020 666c  role!.        fl
+0000c5c0: 6173 6b2e 666c 6173 6828 224f 6e6c 7920  ask.flash("Only 
+0000c5d0: 6164 6d69 6e73 2063 616e 2065 7661 6c75  admins can evalu
+0000c5e0: 6174 6520 7375 626d 6973 7369 6f6e 732e  ate submissions.
+0000c5f0: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
+0000c600: 6e20 676f 6261 636b 2863 6f75 7273 652c  n goback(course,
+0000c610: 2073 656d 6573 7465 7229 0a0a 2020 2020   semester)..    
+0000c620: 2320 4368 6563 6b20 726f 7374 6572 2061  # Check roster a
+0000c630: 6e64 2066 6c61 7368 2061 2077 6172 6e69  nd flash a warni
+0000c640: 6e67 2069 6620 7765 2772 6520 7669 6577  ng if we're view
+0000c650: 696e 6720 6665 6564 6261 636b 2066 6f72  ing feedback for
+0000c660: 2061 0a20 2020 2023 2075 7365 7220 7768   a.    # user wh
+0000c670: 6f20 6973 206e 6f74 206f 6e20 7468 6520  o is not on the 
+0000c680: 726f 7374 6572 2e2e 2e0a 2020 2020 7472  roster....    tr
+0000c690: 793a 0a20 2020 2020 2020 2072 6f73 7465  y:.        roste
+0000c6a0: 7220 3d20 7374 6f72 6167 652e 6765 745f  r = storage.get_
+0000c6b0: 726f 7374 6572 2863 6f75 7273 652c 2073  roster(course, s
+0000c6c0: 656d 6573 7465 7229 0a20 2020 2065 7863  emester).    exc
+0000c6d0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+0000c6e0: 2065 3a0a 2020 2020 2020 2020 666c 6173   e:.        flas
+0000c6f0: 6b2e 666c 6173 6828 7374 7228 6529 290a  k.flash(str(e)).
+0000c700: 2020 2020 2020 2020 726f 7374 6572 203d          roster =
+0000c710: 204e 6f6e 650a 0a20 2020 2069 6620 726f   None..    if ro
+0000c720: 7374 6572 2069 7320 4e6f 6e65 3a0a 2020  ster is None:.  
+0000c730: 2020 2020 2020 666c 6173 6b2e 666c 6173        flask.flas
+0000c740: 6828 0a20 2020 2020 2020 2020 2020 2022  h(.            "
+0000c750: 5761 726e 696e 673a 2063 6f75 6c64 206e  Warning: could n
+0000c760: 6f74 2066 6574 6368 2072 6f73 7465 7220  ot fetch roster 
+0000c770: 746f 2063 6865 636b 2069 6620 7468 6973  to check if this
+0000c780: 2075 7365 7220 6973 206f 6e22 0a20 2020   user is on".   
+0000c790: 2020 2020 2020 2020 2022 2069 742e 220a           " it.".
+0000c7a0: 2020 2020 2020 2020 290a 2020 2020 656c          ).    el
+0000c7b0: 6966 2074 6172 6765 745f 7573 6572 206e  if target_user n
+0000c7c0: 6f74 2069 6e20 726f 7374 6572 3a0a 2020  ot in roster:.  
+0000c7d0: 2020 2020 2020 666c 6173 6b2e 666c 6173        flask.flas
+0000c7e0: 6828 2257 6172 6e69 6e67 3a20 7468 6973  h("Warning: this
+0000c7f0: 2075 7365 7220 6973 206e 6f74 206f 6e20   user is not on 
+0000c800: 7468 6520 726f 7374 6572 2122 290a 0a20  the roster!").. 
+0000c810: 2020 2023 2047 6574 2066 756c 6c20 6665     # Get full fe
+0000c820: 6564 6261 636b 2069 6e66 6f0a 2020 2020  edback info.    
+0000c830: 7073 5f61 6e64 5f74 6173 6b20 3d20 6765  ps_and_task = ge
+0000c840: 745f 6665 6564 6261 636b 5f70 735f 616e  t_feedback_ps_an
+0000c850: 645f 7461 736b 280a 2020 2020 2020 2020  d_task(.        
+0000c860: 7461 736b 5f69 6e66 6f2c 0a20 2020 2020  task_info,.     
+0000c870: 2020 2063 6f75 7273 652c 0a20 2020 2020     course,.     
+0000c880: 2020 2073 656d 6573 7465 722c 0a20 2020     semester,.   
+0000c890: 2020 2020 2074 6172 6765 745f 7573 6572       target_user
+0000c8a0: 2c0a 2020 2020 2020 2020 7068 6173 652c  ,.        phase,
+0000c8b0: 0a20 2020 2020 2020 2070 7369 642c 0a20  .        psid,. 
+0000c8c0: 2020 2020 2020 2074 6173 6b69 640a 2020         taskid.  
+0000c8d0: 2020 290a 2020 2020 6966 2069 7369 6e73    ).    if isins
+0000c8e0: 7461 6e63 6528 7073 5f61 6e64 5f74 6173  tance(ps_and_tas
+0000c8f0: 6b2c 2056 616c 7565 4572 726f 7229 3a0a  k, ValueError):.
+0000c900: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
+0000c910: 6173 6828 7374 7228 7073 5f61 6e64 5f74  ash(str(ps_and_t
+0000c920: 6173 6b29 290a 2020 2020 2020 2020 7265  ask)).        re
+0000c930: 7475 726e 2067 6f62 6163 6b28 636f 7572  turn goback(cour
+0000c940: 7365 2c20 7365 6d65 7374 6572 290a 2020  se, semester).  
+0000c950: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000c960: 7073 2c20 7461 736b 203d 2070 735f 616e  ps, task = ps_an
+0000c970: 645f 7461 736b 0a0a 2020 2020 7265 7475  d_task..    retu
+0000c980: 726e 2066 6c61 736b 2e72 656e 6465 725f  rn flask.render_
+0000c990: 7465 6d70 6c61 7465 280a 2020 2020 2020  template(.      
+0000c9a0: 2020 2765 7661 6c75 6174 652e 6a32 272c    'evaluate.j2',
+0000c9b0: 0a20 2020 2020 2020 2063 6f75 7273 655f  .        course_
+0000c9c0: 6e61 6d65 3d61 7070 2e63 6f6e 6669 672e  name=app.config.
+0000c9d0: 6765 7428 2243 4f55 5253 455f 4e41 4d45  get("COURSE_NAME
+0000c9e0: 5322 2c20 7b7d 292e 6765 7428 636f 7572  S", {}).get(cour
+0000c9f0: 7365 2c20 636f 7572 7365 292c 0a20 2020  se, course),.   
+0000ca00: 2020 2020 2063 6f75 7273 653d 636f 7572       course=cour
+0000ca10: 7365 2c0a 2020 2020 2020 2020 7365 6d65  se,.        seme
+0000ca20: 7374 6572 3d73 656d 6573 7465 722c 0a20  ster=semester,. 
+0000ca30: 2020 2020 2020 2075 7365 726e 616d 653d         username=
+0000ca40: 7573 6572 6e61 6d65 2c0a 2020 2020 2020  username,.      
+0000ca50: 2020 6973 5f61 646d 696e 3d69 735f 6164    is_admin=is_ad
+0000ca60: 6d69 6e2c 0a20 2020 2020 2020 206d 6173  min,.        mas
+0000ca70: 7175 6572 6164 655f 6173 3d6d 6173 7175  querade_as=masqu
+0000ca80: 6572 6164 655f 6173 2c0a 2020 2020 2020  erade_as,.      
+0000ca90: 2020 6566 6665 6374 6976 655f 7573 6572    effective_user
+0000caa0: 3d65 6666 6563 7469 7665 5f75 7365 722c  =effective_user,
+0000cab0: 0a20 2020 2020 2020 2074 6172 6765 745f  .        target_
+0000cac0: 7573 6572 3d74 6172 6765 745f 7573 6572  user=target_user
+0000cad0: 2c0a 2020 2020 2020 2020 7068 6173 653d  ,.        phase=
+0000cae0: 7068 6173 652c 0a20 2020 2020 2020 2070  phase,.        p
+0000caf0: 733d 7073 2c0a 2020 2020 2020 2020 7461  s=ps,.        ta
+0000cb00: 736b 3d74 6173 6b2c 0a20 2020 2020 2020  sk=task,.       
+0000cb10: 2074 6173 6b5f 696e 666f 3d74 6173 6b5f   task_info=task_
+0000cb20: 696e 666f 2c0a 2020 2020 2020 2020 6662  info,.        fb
+0000cb30: 5f63 7373 3d70 6f74 6c75 636b 2e72 656e  _css=potluck.ren
+0000cb40: 6465 722e 6765 745f 6373 7328 292c 0a20  der.get_css(),. 
+0000cb50: 2020 2020 2020 2066 625f 6a73 3d70 6f74         fb_js=pot
+0000cb60: 6c75 636b 2e72 656e 6465 722e 6765 745f  luck.render.get_
+0000cb70: 6a73 2829 2c0a 2020 2020 2020 2020 7375  js(),.        su
+0000cb80: 7070 6f72 745f 6c69 6e6b 3d61 7070 2e63  pport_link=app.c
+0000cb90: 6f6e 6669 675b 2253 5550 504f 5254 5f4c  onfig["SUPPORT_L
+0000cba0: 494e 4b22 5d0a 2020 2020 290a 0a0a 4061  INK"].    )...@a
+0000cbb0: 7070 2e72 6f75 7465 2827 2f3c 636f 7572  pp.route('/<cour
+0000cbc0: 7365 3e2f 3c73 656d 6573 7465 723e 2f73  se>/<semester>/s
+0000cbd0: 6f6c 7574 696f 6e2f 3c70 7369 643e 2f3c  olution/<psid>/<
+0000cbe0: 7461 736b 6964 3e27 2c20 6d65 7468 6f64  taskid>', method
+0000cbf0: 733d 5b27 4745 5427 5d29 0a40 666c 6173  s=['GET']).@flas
+0000cc00: 6b5f 6361 732e 6c6f 6769 6e5f 7265 7175  k_cas.login_requ
+0000cc10: 6972 6564 0a40 6175 676d 656e 745f 6172  ired.@augment_ar
+0000cc20: 6775 6d65 6e74 730a 6465 6620 726f 7574  guments.def rout
+0000cc30: 655f 736f 6c75 7469 6f6e 280a 2020 2020  e_solution(.    
+0000cc40: 636f 7572 7365 2c0a 2020 2020 7365 6d65  course,.    seme
+0000cc50: 7374 6572 2c0a 2020 2020 7073 6964 2c0a  ster,.    psid,.
+0000cc60: 2020 2020 7461 736b 6964 2c0a 2020 2020      taskid,.    
+0000cc70: 2320 4175 676d 656e 7465 6420 6172 6775  # Augmented argu
+0000cc80: 6d65 6e74 730a 2020 2020 7573 6572 6e61  ments.    userna
+0000cc90: 6d65 2c0a 2020 2020 6973 5f61 646d 696e  me,.    is_admin
+0000cca0: 2c0a 2020 2020 6d61 7371 7565 7261 6465  ,.    masquerade
+0000ccb0: 5f61 732c 0a20 2020 2065 6666 6563 7469  _as,.    effecti
+0000ccc0: 7665 5f75 7365 722c 0a20 2020 2074 6173  ve_user,.    tas
+0000ccd0: 6b5f 696e 666f 0a29 3a0a 2020 2020 2222  k_info.):.    ""
+0000cce0: 220a 2020 2020 5669 7369 626c 6520 6f6e  ".    Visible on
+0000ccf0: 6c79 206f 6e63 6520 6120 7461 736b 2773  ly once a task's
+0000cd00: 2073 7461 7475 7320 6973 2066 696e 616c   status is final
+0000cd10: 2c20 6163 636f 756e 7469 6e67 2066 6f72  , accounting for
+0000cd20: 2061 6c6c 0a20 2020 2065 7874 656e 7369   all.    extensi
+0000cd30: 6f6e 732c 2061 6e64 2069 6620 7468 6520  ons, and if the 
+0000cd40: 6163 7469 7665 2075 7365 7220 6861 7320  active user has 
+0000cd50: 616e 2065 7661 6c75 6174 6564 2073 7562  an evaluated sub
+0000cd60: 6d69 7373 696f 6e20 666f 720a 2020 2020  mission for.    
+0000cd70: 7468 6520 7461 736b 2c20 6f72 2061 6e6f  the task, or ano
+0000cd80: 7468 6572 2074 6173 6b20 696e 2074 6865  ther task in the
+0000cd90: 2073 616d 6520 706f 6f6c 2028 6f72 2069   same pool (or i
+0000cda0: 6620 7468 6579 2772 6520 616e 2061 646d  f they're an adm
+0000cdb0: 696e 292e 0a20 2020 2053 686f 7773 2074  in)..    Shows t
+0000cdc0: 6865 2073 6f6c 7574 696f 6e20 636f 6465  he solution code
+0000cdd0: 2066 6f72 2061 2070 6172 7469 6375 6c61   for a particula
+0000cde0: 7220 7461 736b 2c20 696e 636c 7564 696e  r task, includin
+0000cdf0: 6720 6120 666f 726d 6174 7465 640a 2020  g a formatted.  
+0000ce00: 2020 7665 7273 696f 6e20 616e 6420 6120    version and a 
+0000ce10: 6c69 6e6b 2074 6f20 646f 776e 6c6f 6164  link to download
+0000ce20: 2074 6865 202e 7079 2066 696c 652e 0a20   the .py file.. 
+0000ce30: 2020 2022 2222 0a20 2020 2074 7279 3a0a     """.    try:.
+0000ce40: 2020 2020 2020 2020 7073 203d 2067 6574          ps = get
+0000ce50: 5f70 735f 6f62 6a28 7461 736b 5f69 6e66  _ps_obj(task_inf
+0000ce60: 6f2c 2070 7369 6429 0a20 2020 2065 7863  o, psid).    exc
+0000ce70: 6570 7420 5661 6c75 6545 7272 6f72 2061  ept ValueError a
+0000ce80: 7320 653a 0a20 2020 2020 2020 2066 6c61  s e:.        fla
+0000ce90: 736b 2e66 6c61 7368 2822 5661 6c75 6545  sk.flash("ValueE
+0000cea0: 7272 6f72 3a20 2220 2b20 7374 7228 6529  rror: " + str(e)
+0000ceb0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000cec0: 2067 6f62 6163 6b28 636f 7572 7365 2c20   goback(course, 
+0000ced0: 7365 6d65 7374 6572 290a 0a20 2020 2023  semester)..    #
+0000cee0: 2041 6464 2073 7461 7475 7320 2620 7469   Add status & ti
+0000cef0: 6d65 2072 656d 6169 6e69 6e67 2069 6e66  me remaining inf
+0000cf00: 6f20 746f 2070 7365 7420 616e 6420 6f62  o to pset and ob
+0000cf10: 6a65 6374 730a 2020 2020 616d 656e 645f  jects.    amend_
+0000cf20: 7073 6574 2863 6f75 7273 652c 2073 656d  pset(course, sem
+0000cf30: 6573 7465 722c 2074 6173 6b5f 696e 666f  ester, task_info
+0000cf40: 2c20 7073 2c20 6566 6665 6374 6976 655f  , ps, effective_
+0000cf50: 7573 6572 290a 0a20 2020 2023 2047 7261  user)..    # Gra
+0000cf60: 6220 7461 736b 206f 626a 6563 7420 666f  b task object fo
+0000cf70: 7220 7468 6973 2074 6173 6b0a 2020 2020  r this task.    
+0000cf80: 7472 793a 0a20 2020 2020 2020 2074 6173  try:.        tas
+0000cf90: 6b20 3d20 6765 745f 7461 736b 5f6f 626a  k = get_task_obj
+0000cfa0: 2874 6173 6b5f 696e 666f 2c20 7073 2c20  (task_info, ps, 
+0000cfb0: 7461 736b 6964 290a 2020 2020 6578 6365  taskid).    exce
+0000cfc0: 7074 2056 616c 7565 4572 726f 7220 6173  pt ValueError as
+0000cfd0: 2065 3a0a 2020 2020 2020 2020 666c 6173   e:.        flas
+0000cfe0: 6b2e 666c 6173 6828 2256 616c 7565 4572  k.flash("ValueEr
+0000cff0: 726f 723a 2022 202b 2073 7472 2865 2929  ror: " + str(e))
+0000d000: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000d010: 676f 6261 636b 2863 6f75 7273 652c 2073  goback(course, s
+0000d020: 656d 6573 7465 7229 0a0a 2020 2020 2320  emester)..    # 
+0000d030: 4669 6e64 2074 6173 6b73 2069 6e20 7468  Find tasks in th
+0000d040: 6520 7361 6d65 2070 6f6f 6c20 6173 2074  e same pool as t
+0000d050: 6869 7320 6f6e 653a 0a20 2020 2069 6620  his one:.    if 
+0000d060: 2270 6f6f 6c22 2069 6e20 7461 736b 3a0a  "pool" in task:.
+0000d070: 2020 2020 2020 2020 7461 736b 735f 696e          tasks_in
+0000d080: 5f70 6f6f 6c20 3d20 5b0a 2020 2020 2020  _pool = [.      
+0000d090: 2020 2020 2020 7465 6e74 7279 5b22 6964        tentry["id
+0000d0a0: 225d 0a20 2020 2020 2020 2020 2020 2066  "].            f
+0000d0b0: 6f72 2074 656e 7472 7920 696e 2070 735b  or tentry in ps[
+0000d0c0: 2274 6173 6b73 225d 0a20 2020 2020 2020  "tasks"].       
+0000d0d0: 2020 2020 2069 6620 7465 6e74 7279 2e67       if tentry.g
+0000d0e0: 6574 2822 706f 6f6c 2229 203d 3d20 7461  et("pool") == ta
+0000d0f0: 736b 5b22 706f 6f6c 225d 0a20 2020 2020  sk["pool"].     
+0000d100: 2020 205d 0a20 2020 2065 6c73 653a 0a20     ].    else:. 
+0000d110: 2020 2020 2020 2074 6173 6b73 5f69 6e5f         tasks_in_
+0000d120: 706f 6f6c 203d 205b 2074 6173 6b5b 2269  pool = [ task["i
+0000d130: 6422 5d20 5d0a 0a20 2020 2023 2047 7261  d"] ]..    # Gra
+0000d140: 6220 7461 736b 206f 626a 6563 7473 2066  b task objects f
+0000d150: 6f72 2065 6163 6820 7461 736b 2069 6e20  or each task in 
+0000d160: 6f75 7220 706f 6f6c 2061 6e64 2061 6d65  our pool and ame
+0000d170: 6e64 2074 6865 6d3a 0a20 2020 2073 7562  nd them:.    sub
+0000d180: 6d69 7474 6564 5f74 6f5f 706f 6f6c 203d  mitted_to_pool =
+0000d190: 2046 616c 7365 0a20 2020 2066 6f72 2074   False.    for t
+0000d1a0: 6173 6b69 6420 696e 2074 6173 6b73 5f69  askid in tasks_i
+0000d1b0: 6e5f 706f 6f6c 3a0a 2020 2020 2020 2020  n_pool:.        
+0000d1c0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000d1d0: 2074 6f62 6a20 3d20 6765 745f 7461 736b   tobj = get_task
+0000d1e0: 5f6f 626a 2874 6173 6b5f 696e 666f 2c20  _obj(task_info, 
+0000d1f0: 7073 2c20 7461 736b 6964 290a 2020 2020  ps, taskid).    
+0000d200: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
+0000d210: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+0000d220: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
+0000d230: 6173 6828 2256 616c 7565 4572 726f 723a  ash("ValueError:
+0000d240: 2022 202b 2073 7472 2865 2929 0a20 2020   " + str(e)).   
+0000d250: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000d260: 676f 6261 636b 2863 6f75 7273 652c 2073  goback(course, s
+0000d270: 656d 6573 7465 7229 0a0a 2020 2020 2020  emester)..      
+0000d280: 2020 696e 6974 6961 6c20 3d20 746f 626a    initial = tobj
+0000d290: 0a20 2020 2020 2020 2072 6576 6973 6564  .        revised
+0000d2a0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+0000d2b0: 2874 6f62 6a29 0a0a 2020 2020 2020 2020  (tobj)..        
+0000d2c0: 616d 656e 645f 7461 736b 280a 2020 2020  amend_task(.    
+0000d2d0: 2020 2020 2020 2020 636f 7572 7365 2c0a          course,.
+0000d2e0: 2020 2020 2020 2020 2020 2020 7365 6d65              seme
+0000d2f0: 7374 6572 2c0a 2020 2020 2020 2020 2020  ster,.          
+0000d300: 2020 7461 736b 5f69 6e66 6f2c 0a20 2020    task_info,.   
+0000d310: 2020 2020 2020 2020 2070 7369 642c 0a20           psid,. 
+0000d320: 2020 2020 2020 2020 2020 2069 6e69 7469             initi
+0000d330: 616c 2c0a 2020 2020 2020 2020 2020 2020  al,.            
+0000d340: 6566 6665 6374 6976 655f 7573 6572 2c0a  effective_user,.
+0000d350: 2020 2020 2020 2020 2020 2020 2269 6e69              "ini
+0000d360: 7469 616c 220a 2020 2020 2020 2020 290a  tial".        ).
+0000d370: 2020 2020 2020 2020 6966 2069 6e69 7469          if initi
+0000d380: 616c 2e67 6574 2822 7375 626d 6974 7465  al.get("submitte
+0000d390: 6422 293a 0a20 2020 2020 2020 2020 2020  d"):.           
+0000d3a0: 2073 7562 6d69 7474 6564 5f74 6f5f 706f   submitted_to_po
+0000d3b0: 6f6c 203d 2054 7275 650a 2020 2020 2020  ol = True.      
+0000d3c0: 2020 2020 2020 6272 6561 6b0a 0a20 2020        break..   
+0000d3d0: 2020 2020 2061 6d65 6e64 5f74 6173 6b28       amend_task(
+0000d3e0: 0a20 2020 2020 2020 2020 2020 2063 6f75  .            cou
+0000d3f0: 7273 652c 0a20 2020 2020 2020 2020 2020  rse,.           
+0000d400: 2073 656d 6573 7465 722c 0a20 2020 2020   semester,.     
+0000d410: 2020 2020 2020 2074 6173 6b5f 696e 666f         task_info
+0000d420: 2c0a 2020 2020 2020 2020 2020 2020 7073  ,.            ps
+0000d430: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
+0000d440: 7265 7669 7365 642c 0a20 2020 2020 2020  revised,.       
+0000d450: 2020 2020 2065 6666 6563 7469 7665 5f75       effective_u
+0000d460: 7365 722c 0a20 2020 2020 2020 2020 2020  ser,.           
+0000d470: 2022 7265 7669 7369 6f6e 220a 2020 2020   "revision".    
+0000d480: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+0000d490: 2072 6576 6973 6564 2e67 6574 2822 7375   revised.get("su
+0000d4a0: 626d 6974 7465 6422 293a 0a20 2020 2020  bmitted"):.     
+0000d4b0: 2020 2020 2020 2073 7562 6d69 7474 6564         submitted
+0000d4c0: 5f74 6f5f 706f 6f6c 203d 2054 7275 650a  _to_pool = True.
+0000d4d0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0000d4e0: 6b0a 0a20 2020 2023 2043 6865 636b 2072  k..    # Check r
+0000d4f0: 6f73 7465 7220 736f 2074 6861 7420 6f6e  oster so that on
+0000d500: 6c79 2073 7475 6465 6e74 7320 6f6e 2074  ly students on t
+0000d510: 6865 2072 6f73 7465 7220 6361 6e20 7669  he roster can vi
+0000d520: 6577 2073 6f6c 7574 696f 6e73 0a20 2020  ew solutions.   
+0000d530: 2023 2028 7765 2064 6f6e 2774 2077 616e   # (we don't wan
+0000d540: 7420 6675 7475 7265 2d73 656d 6573 7465  t future-semeste
+0000d550: 7220 7374 7564 656e 7473 2076 6965 7769  r students viewi
+0000d560: 6e67 2070 7265 7669 6f75 732d 7365 6d65  ng previous-seme
+0000d570: 7374 6572 0a20 2020 2023 2073 6f6c 7574  ster.    # solut
+0000d580: 696f 6e73 2129 2e0a 2020 2020 7472 793a  ions!)..    try:
+0000d590: 0a20 2020 2020 2020 2072 6f73 7465 7220  .        roster 
+0000d5a0: 3d20 7374 6f72 6167 652e 6765 745f 726f  = storage.get_ro
+0000d5b0: 7374 6572 2863 6f75 7273 652c 2073 656d  ster(course, sem
+0000d5c0: 6573 7465 7229 0a20 2020 2065 7863 6570  ester).    excep
+0000d5d0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+0000d5e0: 3a0a 2020 2020 2020 2020 666c 6173 6b2e  :.        flask.
+0000d5f0: 666c 6173 6828 7374 7228 6529 290a 2020  flash(str(e)).  
+0000d600: 2020 2020 2020 726f 7374 6572 203d 204e        roster = N
+0000d610: 6f6e 650a 0a20 2020 2069 6620 726f 7374  one..    if rost
+0000d620: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
+0000d630: 2020 2020 6d73 6720 3d20 2246 6169 6c65      msg = "Faile
+0000d640: 6420 746f 206c 6f61 6420 3c63 6f64 653e  d to load <code>
+0000d650: 726f 7374 6572 2e63 7376 3c2f 636f 6465  roster.csv</code
+0000d660: 3e2e 220a 2020 2020 2020 2020 666c 6173  >.".        flas
+0000d670: 6b2e 666c 6173 6828 6d73 6729 0a20 2020  k.flash(msg).   
+0000d680: 2020 2020 2072 6574 7572 6e20 6572 726f       return erro
+0000d690: 725f 7265 7370 6f6e 7365 2863 6f75 7273  r_response(cours
+0000d6a0: 652c 2073 656d 6573 7465 722c 2075 7365  e, semester, use
+0000d6b0: 726e 616d 652c 206d 7367 290a 0a20 2020  rname, msg)..   
+0000d6c0: 2069 6620 7073 5b22 7374 6174 7573 225d   if ps["status"]
+0000d6d0: 5b22 7374 6174 6522 5d20 213d 2022 6669  ["state"] != "fi
+0000d6e0: 6e61 6c22 3a0a 2020 2020 2020 2020 6966  nal":.        if
+0000d6f0: 2069 735f 6164 6d69 6e3a 0a20 2020 2020   is_admin:.     
+0000d700: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
+0000d710: 7368 280a 2020 2020 2020 2020 2020 2020  sh(.            
+0000d720: 2020 2020 2256 6965 7769 6e67 2073 6f6c      "Viewing sol
+0000d730: 7574 696f 6e20 636f 6465 2061 7320 6164  ution code as ad
+0000d740: 6d69 6e3b 2073 6f6c 7574 696f 6e20 6973  min; solution is
+0000d750: 206e 6f74 220a 2020 2020 2020 2020 2020   not".          
+0000d760: 2020 2020 2b20 2220 7669 7369 626c 6520      + " visible 
+0000d770: 746f 2073 7475 6465 6e74 7320 756e 7469  to students unti
+0000d780: 6c20 7265 7669 7369 6f6e 2070 6572 696f  l revision perio
+0000d790: 6420 6973 206f 7665 722e 220a 2020 2020  d is over.".    
+0000d7a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000d7b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000d7c0: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
+0000d7d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d7e0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000d7f0: 2020 2020 2020 2022 596f 7520 6361 6e6e         "You cann
+0000d800: 6f74 2076 6965 7720 7468 6520 736f 6c75  ot view the solu
+0000d810: 7469 6f6e 7320 666f 7220 7b70 7365 747d  tions for {pset}
+0000d820: 207b 7461 736b 7d22 0a20 2020 2020 2020   {task}".       
+0000d830: 2020 2020 2020 2020 2020 202b 2022 2075             + " u
+0000d840: 6e74 696c 2074 6865 2072 6576 6973 696f  ntil the revisio
+0000d850: 6e20 7065 7269 6f64 2069 7320 6f76 6572  n period is over
+0000d860: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+0000d870: 2020 2029 2e66 6f72 6d61 7428 7073 6574     ).format(pset
+0000d880: 3d70 7369 642c 2074 6173 6b3d 7461 736b  =psid, task=task
+0000d890: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
+0000d8a0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000d8b0: 7475 726e 2067 6f62 6163 6b28 636f 7572  turn goback(cour
+0000d8c0: 7365 2c20 7365 6d65 7374 6572 290a 0a20  se, semester).. 
+0000d8d0: 2020 2065 6c69 6620 6566 6665 6374 6976     elif effectiv
+0000d8e0: 655f 7573 6572 206e 6f74 2069 6e20 726f  e_user not in ro
+0000d8f0: 7374 6572 3a20 2320 6e6f 7420 6f6e 2074  ster: # not on t
+0000d900: 6865 2072 6f73 7465 720a 2020 2020 2020  he roster.      
+0000d910: 2020 6966 2069 735f 6164 6d69 6e3a 0a20    if is_admin:. 
+0000d920: 2020 2020 2020 2020 2020 2066 6c61 736b             flask
+0000d930: 2e66 6c61 7368 280a 2020 2020 2020 2020  .flash(.        
+0000d940: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
+0000d950: 2020 2020 2020 2020 2020 2020 2020 2256                "V
+0000d960: 6965 7769 6e67 2073 6f6c 7574 696f 6e20  iewing solution 
+0000d970: 636f 6465 2061 7320 6164 6d69 6e3b 2073  code as admin; s
+0000d980: 6f6c 7574 696f 6e20 6973 206e 6f74 220a  olution is not".
+0000d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9a0: 2020 2b20 2220 7669 7369 626c 6520 746f    + " visible to
+0000d9b0: 2075 7365 7220 7b7d 2061 7320 7468 6579   user {} as they
+0000d9c0: 2061 7265 206e 6f74 206f 6e20 7468 6520   are not on the 
+0000d9d0: 726f 7374 6572 220a 2020 2020 2020 2020  roster".        
+0000d9e0: 2020 2020 2020 2020 2020 2b20 2220 666f            + " fo
+0000d9f0: 7220 7468 6973 2063 6f75 7273 652f 7365  r this course/se
+0000da00: 6d65 7374 6572 2e22 0a20 2020 2020 2020  mester.".       
+0000da10: 2020 2020 2020 2020 2029 2e66 6f72 6d61           ).forma
+0000da20: 7428 6566 6665 6374 6976 655f 7573 6572  t(effective_user
+0000da30: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+0000da40: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000da50: 2020 2020 2020 2020 2020 666c 6173 6b2e            flask.
+0000da60: 666c 6173 6828 0a20 2020 2020 2020 2020  flash(.         
+0000da70: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+0000da80: 2020 2020 2020 2020 2020 2020 2022 596f               "Yo
+0000da90: 7520 6361 6e6e 6f74 2076 6965 7720 736f  u cannot view so
+0000daa0: 6c75 7469 6f6e 7320 666f 7220 7b63 6f75  lutions for {cou
+0000dab0: 7273 657d 207b 7365 6d65 7374 6572 7d22  rse} {semester}"
+0000dac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dad0: 2020 202b 2022 2062 6563 6175 7365 2079     + " because y
+0000dae0: 6f75 2061 7265 206e 6f74 206f 6e20 7468  ou are not on th
+0000daf0: 6520 726f 7374 6572 2066 6f72 2074 6861  e roster for tha
+0000db00: 7420 636c 6173 732e 220a 2020 2020 2020  t class.".      
+0000db10: 2020 2020 2020 2020 2020 292e 666f 726d            ).form
+0000db20: 6174 2863 6f75 7273 653d 636f 7572 7365  at(course=course
+0000db30: 2c20 7365 6d65 7374 6572 3d73 656d 6573  , semester=semes
+0000db40: 7465 7229 0a20 2020 2020 2020 2020 2020  ter).           
+0000db50: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+0000db60: 6574 7572 6e20 676f 6261 636b 2863 6f75  eturn goback(cou
+0000db70: 7273 652c 2073 656d 6573 7465 7229 0a0a  rse, semester)..
+0000db80: 2020 2020 656c 6966 206e 6f74 2028 0a20      elif not (. 
+0000db90: 2020 2020 2020 2061 7070 2e63 6f6e 6669         app.confi
+0000dba0: 672e 6765 7428 2244 4953 504c 4159 5f55  g.get("DISPLAY_U
+0000dbb0: 4e53 5542 4d49 5454 4544 5f53 4f4c 5554  NSUBMITTED_SOLUT
+0000dbc0: 494f 4e53 2229 0a20 2020 2020 6f72 2073  IONS").     or s
+0000dbd0: 7562 6d69 7474 6564 5f74 6f5f 706f 6f6c  ubmitted_to_pool
+0000dbe0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+0000dbf0: 2320 5468 6973 2075 7365 7220 6861 736e  # This user hasn
+0000dc00: 2774 2073 7562 6d69 7474 6564 2074 6869  't submitted thi
+0000dc10: 7320 7461 736b 2c20 736f 2077 6527 6420  s task, so we'd 
+0000dc20: 6c69 6b65 2074 6f20 6d61 6b65 2069 740a  like to make it.
+0000dc30: 2020 2020 2020 2020 2320 706f 7373 6962          # possib
+0000dc40: 6c65 2066 6f72 2074 6865 6d20 746f 2067  le for them to g
+0000dc50: 6574 2061 6e20 6578 7465 6e73 696f 6e20  et an extension 
+0000dc60: 6c61 7465 7220 7769 7468 6f75 7420 776f  later without wo
+0000dc70: 7272 7969 6e67 2061 626f 7574 0a20 2020  rrying about.   
+0000dc80: 2020 2020 2023 2077 6865 7468 6572 2074       # whether t
+0000dc90: 6865 7927 7665 2061 6363 6573 7365 6420  hey've accessed 
+0000dca0: 736f 6c75 7469 6f6e 2063 6f64 6520 696e  solution code in
+0000dcb0: 2074 6865 206d 6561 6e20 7469 6d65 2e0a   the mean time..
+0000dcc0: 2020 2020 2020 2020 6966 2069 735f 6164          if is_ad
+0000dcd0: 6d69 6e3a 0a20 2020 2020 2020 2020 2020  min:.           
+0000dce0: 2066 6c61 736b 2e66 6c61 7368 280a 2020   flask.flash(.  
+0000dcf0: 2020 2020 2020 2020 2020 2020 2020 280a                (.
+0000dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd10: 2020 2020 2256 6965 7769 6e67 2073 6f6c      "Viewing sol
+0000dd20: 7574 696f 6e20 636f 6465 2061 7320 6164  ution code as ad
+0000dd30: 6d69 6e3b 2073 6f6c 7574 696f 6e20 6973  min; solution is
+0000dd40: 206e 6f74 220a 2020 2020 2020 2020 2020   not".          
+0000dd50: 2020 2020 2020 2020 2b20 2220 7669 7369          + " visi
+0000dd60: 626c 6520 746f 2075 7365 7220 7b7d 2061  ble to user {} a
+0000dd70: 7320 7468 6579 2064 6f6e 2774 2068 6176  s they don't hav
+0000dd80: 6520 6120 7375 626d 6973 7369 6f6e 220a  e a submission".
+0000dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dda0: 2020 2b20 2220 666f 7220 7468 6973 2074    + " for this t
+0000ddb0: 6173 6b20 6f72 2061 6e6f 7468 6572 2074  ask or another t
+0000ddc0: 6173 6b20 696e 2074 6869 7320 706f 6f6c  ask in this pool
+0000ddd0: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+0000dde0: 2020 2029 2e66 6f72 6d61 7428 6566 6665     ).format(effe
+0000ddf0: 6374 6976 655f 7573 6572 290a 2020 2020  ctive_user).    
+0000de00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000de10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000de20: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
+0000de30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de40: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000de50: 2020 2020 2020 2022 596f 7520 6361 6e6e         "You cann
+0000de60: 6f74 2076 6965 7720 7468 6520 736f 6c75  ot view the solu
+0000de70: 7469 6f6e 2066 6f72 207b 7d20 7b7d 2062  tion for {} {} b
+0000de80: 6563 7561 7365 2079 6f75 220a 2020 2020  ecuase you".    
+0000de90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dea0: 2220 6861 7665 6e27 7420 7375 626d 6974  " haven't submit
+0000deb0: 7465 6420 7468 6174 2074 6173 6b20 6f72  ted that task or
+0000dec0: 2061 6e79 2074 6173 6b20 696e 2074 6865   any task in the
+0000ded0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000dee0: 2020 2020 2020 2220 7361 6d65 2070 6f6f        " same poo
+0000def0: 6c2e 220a 2020 2020 2020 2020 2020 2020  l.".            
+0000df00: 2020 2020 292e 666f 726d 6174 2870 7369      ).format(psi
+0000df10: 642c 2074 6173 6b69 6429 0a20 2020 2020  d, taskid).     
+0000df20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000df30: 2020 2020 2072 6574 7572 6e20 676f 6261       return goba
+0000df40: 636b 2863 6f75 7273 652c 2073 656d 6573  ck(course, semes
+0000df50: 7465 7229 0a0a 2020 2020 2320 4174 2074  ter)..    # At t
+0000df60: 6869 7320 706f 696e 742c 2077 6527 7665  his point, we've
+0000df70: 2076 6572 6966 6965 6420 6974 2773 206f   verified it's o
+0000df80: 6b61 7920 746f 2064 6973 706c 6179 2074  kay to display t
+0000df90: 6865 2073 6f6c 7574 696f 6e3a 0a20 2020  he solution:.   
+0000dfa0: 2023 2074 6865 2070 7365 7420 6973 2066   # the pset is f
+0000dfb0: 696e 616c 697a 6564 2c20 616e 6420 7468  inalized, and th
+0000dfc0: 6520 7573 6572 2069 7320 616e 2061 646d  e user is an adm
+0000dfd0: 696e 206f 7220 6174 206c 6561 7374 206f  in or at least o
+0000dfe0: 6e20 7468 650a 2020 2020 2320 726f 7374  n the.    # rost
+0000dff0: 6572 2066 6f72 2074 6869 7320 7061 7274  er for this part
+0000e000: 6963 756c 6172 2063 6f75 7273 652f 7365  icular course/se
+0000e010: 6d65 7374 6572 2c20 616e 6420 7468 6520  mester, and the 
+0000e020: 7573 6572 2068 6173 2061 0a20 2020 2023  user has a.    #
+0000e030: 2073 7562 6d69 7373 696f 6e20 666f 7220   submission for 
+0000e040: 7468 6973 2074 6173 6b2c 206f 7220 6174  this task, or at
+0000e050: 206c 6561 7374 2074 6f20 616e 6f74 6865   least to anothe
+0000e060: 7220 7461 736b 2069 6e20 7468 6520 7361  r task in the sa
+0000e070: 6d65 0a20 2020 2023 2070 6f6f 6c2e 0a0a  me.    # pool...
+0000e080: 2020 2020 2320 5765 2764 206c 696b 6520      # We'd like 
+0000e090: 7468 6520 6665 6564 6261 636b 2043 5353  the feedback CSS
+0000e0a0: 2026 204a 5320 6265 6361 7573 6520 7765   & JS because we
+0000e0b0: 2772 6520 676f 696e 6720 746f 2072 656e  're going to ren
+0000e0c0: 6465 7220 636f 6465 0a20 2020 2023 2061  der code.    # a
+0000e0d0: 7320 4854 4d4c 2075 7369 6e67 2070 6f74  s HTML using pot
+0000e0e0: 6c75 636b 2e0a 2020 2020 6662 5f63 7373  luck..    fb_css
+0000e0f0: 203d 2070 6f74 6c75 636b 2e72 656e 6465   = potluck.rende
+0000e100: 722e 6765 745f 6373 7328 290a 2020 2020  r.get_css().    
+0000e110: 6662 5f6a 7320 3d20 706f 746c 7563 6b2e  fb_js = potluck.
+0000e120: 7265 6e64 6572 2e67 6574 5f6a 7328 290a  render.get_js().
+0000e130: 0a20 2020 2023 2054 4f44 4f3a 2054 6869  .    # TODO: Thi
+0000e140: 7320 6665 656c 7320 6120 6269 7420 6861  s feels a bit ha
+0000e150: 7264 636f 6465 642e 2e2e 2063 616e 2077  rdcoded... can w
+0000e160: 6520 646f 2062 6574 7465 723f 0a20 2020  e do better?.   
+0000e170: 2023 2054 4f44 4f3a 204d 756c 7469 2d66   # TODO: Multi-f
+0000e180: 696c 6520 7374 7566 6621 0a20 2020 2073  ile stuff!.    s
+0000e190: 6f6c 6e5f 6669 6c65 6e61 6d65 203d 206f  oln_filename = o
+0000e1a0: 732e 7061 7468 2e6a 6f69 6e28 0a20 2020  s.path.join(.   
+0000e1b0: 2020 2020 2073 746f 7261 6765 2e65 7661       storage.eva
+0000e1c0: 6c75 6174 696f 6e5f 6469 7265 6374 6f72  luation_director
+0000e1d0: 7928 636f 7572 7365 2c20 7365 6d65 7374  y(course, semest
+0000e1e0: 6572 292c 0a20 2020 2020 2020 2022 7370  er),.        "sp
+0000e1f0: 6563 7322 2c0a 2020 2020 2020 2020 7461  ecs",.        ta
+0000e200: 736b 5b22 6964 225d 2c0a 2020 2020 2020  sk["id"],.      
+0000e210: 2020 2273 6f6c 6e22 2c0a 2020 2020 2020    "soln",.      
+0000e220: 2020 7461 736b 5b22 7461 7267 6574 225d    task["target"]
+0000e230: 0a20 2020 2029 0a0a 2020 2020 7769 7468  .    )..    with
+0000e240: 206f 7065 6e28 736f 6c6e 5f66 696c 656e   open(soln_filen
+0000e250: 616d 652c 2027 7227 2920 6173 2066 696e  ame, 'r') as fin
+0000e260: 3a0a 2020 2020 2020 2020 736f 6c6e 5f63  :.        soln_c
+0000e270: 6f64 6520 3d20 6669 6e2e 7265 6164 2829  ode = fin.read()
+0000e280: 0a0a 2020 2020 736f 6c6e 5f63 6f64 655f  ..    soln_code_
+0000e290: 6874 6d6c 203d 2070 6f74 6c75 636b 2e72  html = potluck.r
+0000e2a0: 656e 6465 722e 7265 6e64 6572 5f63 6f64  ender.render_cod
+0000e2b0: 6528 0a20 2020 2020 2020 2074 6173 6b69  e(.        taski
+0000e2c0: 642c 0a20 2020 2020 2020 2073 6f6c 6e5f  d,.        soln_
+0000e2d0: 6669 6c65 6e61 6d65 2c0a 2020 2020 2020  filename,.      
+0000e2e0: 2020 736f 6c6e 5f63 6f64 650a 2020 2020    soln_code.    
+0000e2f0: 290a 0a20 2020 2072 6574 7572 6e20 666c  )..    return fl
+0000e300: 6173 6b2e 7265 6e64 6572 5f74 656d 706c  ask.render_templ
+0000e310: 6174 6528 0a20 2020 2020 2020 2027 736f  ate(.        'so
+0000e320: 6c75 7469 6f6e 2e6a 3227 2c0a 2020 2020  lution.j2',.    
+0000e330: 2020 2020 636f 7572 7365 5f6e 616d 653d      course_name=
+0000e340: 6170 702e 636f 6e66 6967 2e67 6574 2822  app.config.get("
+0000e350: 434f 5552 5345 5f4e 414d 4553 222c 207b  COURSE_NAMES", {
+0000e360: 7d29 2e67 6574 2863 6f75 7273 652c 2063  }).get(course, c
+0000e370: 6f75 7273 6529 2c0a 2020 2020 2020 2020  ourse),.        
+0000e380: 636f 7572 7365 3d63 6f75 7273 652c 0a20  course=course,. 
+0000e390: 2020 2020 2020 2073 656d 6573 7465 723d         semester=
+0000e3a0: 7365 6d65 7374 6572 2c0a 2020 2020 2020  semester,.      
+0000e3b0: 2020 7573 6572 6e61 6d65 3d75 7365 726e    username=usern
+0000e3c0: 616d 652c 0a20 2020 2020 2020 2069 735f  ame,.        is_
+0000e3d0: 6164 6d69 6e3d 6973 5f61 646d 696e 2c0a  admin=is_admin,.
+0000e3e0: 2020 2020 2020 2020 6d61 7371 7565 7261          masquera
+0000e3f0: 6465 5f61 733d 6d61 7371 7565 7261 6465  de_as=masquerade
+0000e400: 5f61 732c 0a20 2020 2020 2020 2065 6666  _as,.        eff
+0000e410: 6563 7469 7665 5f75 7365 723d 6566 6665  ective_user=effe
+0000e420: 6374 6976 655f 7573 6572 2c0a 2020 2020  ctive_user,.    
+0000e430: 2020 2020 7073 3d70 732c 0a20 2020 2020      ps=ps,.     
+0000e440: 2020 2074 6173 6b3d 7461 736b 2c0a 2020     task=task,.  
+0000e450: 2020 2020 2020 7461 736b 5f69 6e66 6f3d        task_info=
+0000e460: 7461 736b 5f69 6e66 6f2c 0a20 2020 2020  task_info,.     
+0000e470: 2020 2073 6f6c 6e5f 636f 6465 3d73 6f6c     soln_code=sol
+0000e480: 6e5f 636f 6465 2c0a 2020 2020 2020 2020  n_code,.        
+0000e490: 7265 6e64 6572 6564 5f73 6f6c 6e3d 736f  rendered_soln=so
+0000e4a0: 6c6e 5f63 6f64 655f 6874 6d6c 2c0a 2020  ln_code_html,.  
+0000e4b0: 2020 2020 2020 6662 5f63 7373 3d66 625f        fb_css=fb_
+0000e4c0: 6373 732c 0a20 2020 2020 2020 2066 625f  css,.        fb_
+0000e4d0: 6a73 3d66 625f 6a73 2c0a 2020 2020 2020  js=fb_js,.      
+0000e4e0: 2020 7375 7070 6f72 745f 6c69 6e6b 3d61    support_link=a
+0000e4f0: 7070 2e63 6f6e 6669 675b 2253 5550 504f  pp.config["SUPPO
+0000e500: 5254 5f4c 494e 4b22 5d0a 2020 2020 290a  RT_LINK"].    ).
+0000e510: 0a0a 4061 7070 2e72 6f75 7465 280a 2020  ..@app.route(.  
+0000e520: 2020 272f 3c63 6f75 7273 653e 2f3c 7365    '/<course>/<se
+0000e530: 6d65 7374 6572 3e2f 7374 6172 7465 722f  mester>/starter/
+0000e540: 3c74 6173 6b69 643e 2e7a 6970 272c 0a20  <taskid>.zip',. 
+0000e550: 2020 206d 6574 686f 6473 3d5b 2747 4554     methods=['GET
+0000e560: 275d 0a29 0a40 666c 6173 6b5f 6361 732e  '].).@flask_cas.
+0000e570: 6c6f 6769 6e5f 7265 7175 6972 6564 0a64  login_required.d
+0000e580: 6566 2072 6f75 7465 5f73 7461 7274 6572  ef route_starter
+0000e590: 5f7a 6970 2863 6f75 7273 652c 2073 656d  _zip(course, sem
+0000e5a0: 6573 7465 722c 2074 6173 6b69 6429 3a0a  ester, taskid):.
+0000e5b0: 2020 2020 2222 220a 2020 2020 466f 7220      """.    For 
+0000e5c0: 6561 6368 2074 6173 6b2c 2073 6572 7665  each task, serve
+0000e5d0: 7320 6120 6361 6368 6564 2063 6f70 7920  s a cached copy 
+0000e5e0: 6f66 2061 207a 6970 2066 696c 6520 7468  of a zip file th
+0000e5f0: 6174 2069 6e63 6c75 6465 7320 616c 6c0a  at includes all.
+0000e600: 2020 2020 6669 6c65 7320 696e 2074 6861      files in tha
+0000e610: 7420 7461 736b 2773 2073 7461 7274 6572  t task's starter
+0000e620: 2064 6972 6563 746f 7279 2028 2b20 7375   directory (+ su
+0000e630: 6264 6972 6563 746f 7269 6573 2c20 696e  bdirectories, in
+0000e640: 636c 7564 696e 670a 2020 2020 6f6e 6573  cluding.    ones
+0000e650: 2074 6861 7420 6172 6520 7379 6d6c 696e   that are symlin
+0000e660: 6b73 292e 2049 6620 7468 6520 6361 6368  ks). If the cach
+0000e670: 6564 207a 6970 2064 6f65 7320 6e6f 7420  ed zip does not 
+0000e680: 6578 6973 742c 206f 7220 6966 2069 7427  exist, or if it'
+0000e690: 730a 2020 2020 6f6c 6465 7220 7468 616e  s.    older than
+0000e6a0: 2061 6e79 206f 6620 7468 6520 6669 6c65   any of the file
+0000e6b0: 7320 6974 206e 6565 6473 2074 6f20 696e  s it needs to in
+0000e6c0: 636c 7564 652c 2069 7420 7769 6c6c 2062  clude, it will b
+0000e6d0: 650a 2020 2020 6765 6e65 7261 7465 642e  e.    generated.
+0000e6e0: 0a0a 2020 2020 605f 5f70 7963 6163 6865  ..    `__pycache
+0000e6f0: 5f5f 6020 6469 7265 6374 6f72 6965 7320  __` directories 
+0000e700: 616e 6420 616e 7920 6669 6c65 7320 7468  and any files th
+0000e710: 6579 2063 6f6e 7461 696e 2077 696c 6c20  ey contain will 
+0000e720: 6e6f 7420 6265 0a20 2020 2069 6e63 6c75  not be.    inclu
+0000e730: 6465 6420 696e 2074 6865 207a 6970 2066  ded in the zip f
+0000e740: 696c 652e 2054 6865 7265 2069 7320 6120  ile. There is a 
+0000e750: 636f 6e66 6967 7572 6162 6c65 206d 6178  configurable max
+0000e760: 696d 756d 206e 756d 6265 7220 6f66 0a20  imum number of. 
+0000e770: 2020 2066 696c 6573 2c20 746f 2068 656c     files, to hel
+0000e780: 7020 6465 7465 6374 2069 7373 7565 7320  p detect issues 
+0000e790: 6361 7573 6564 2062 7920 6379 636c 6963  caused by cyclic
+0000e7a0: 2073 796d 626f 6c69 6320 6c69 6e6b 733b   symbolic links;
+0000e7b0: 2073 6574 0a20 2020 2060 4d41 585f 5354   set.    `MAX_ST
+0000e7c0: 4152 5445 525f 4649 4c45 5360 2074 6f20  ARTER_FILES` to 
+0000e7d0: 6d6f 6469 6679 2074 6869 7320 6672 6f6d  modify this from
+0000e7e0: 2074 6865 2064 6566 6175 6c74 206f 6620   the default of 
+0000e7f0: 3130 3030 3030 2028 7768 6963 680a 2020  100000 (which.  
+0000e800: 2020 6973 2070 726f 6261 626c 7920 616c    is probably al
+0000e810: 7265 6164 7920 656e 6f75 6768 2074 6861  ready enough tha
+0000e820: 7420 756e 7a69 7070 696e 6720 776f 756c  t unzipping woul
+0000e830: 6420 6265 2070 726f 626c 656d 6174 6963  d be problematic
+0000e840: 3f29 2e0a 0a20 2020 2052 6169 7365 7320  ?)...    Raises 
+0000e850: 616e 2060 4f53 4572 726f 7260 2069 6620  an `OSError` if 
+0000e860: 746f 6f20 6d61 6e79 2066 696c 6573 2061  too many files a
+0000e870: 7265 2070 7265 7365 6e74 2e0a 2020 2020  re present..    
+0000e880: 2222 220a 2020 2020 2320 544f 444f 3a20  """.    # TODO: 
+0000e890: 5468 6973 2066 6565 6c73 2061 2062 6974  This feels a bit
+0000e8a0: 2068 6172 6463 6f64 6564 2e2e 2e20 6361   hardcoded... ca
+0000e8b0: 6e20 7765 2064 6f20 6265 7474 6572 3f0a  n we do better?.
+0000e8c0: 2020 2020 2320 436f 6d70 7574 6520 6669      # Compute fi
+0000e8d0: 6c65 6e61 6d65 7320 616e 6420 6469 7265  lenames and dire
+0000e8e0: 6374 6f72 6965 730a 2020 2020 7374 6172  ctories.    star
+0000e8f0: 7465 725f 6469 7220 3d20 6f73 2e70 6174  ter_dir = os.pat
+0000e900: 682e 6a6f 696e 280a 2020 2020 2020 2020  h.join(.        
+0000e910: 7374 6f72 6167 652e 6576 616c 7561 7469  storage.evaluati
+0000e920: 6f6e 5f64 6972 6563 746f 7279 2863 6f75  on_directory(cou
+0000e930: 7273 652c 2073 656d 6573 7465 7229 2c0a  rse, semester),.
+0000e940: 2020 2020 2020 2020 2273 7065 6373 222c          "specs",
+0000e950: 0a20 2020 2020 2020 2074 6173 6b69 642c  .        taskid,
+0000e960: 0a20 2020 2020 2020 2022 7374 6172 7465  .        "starte
+0000e970: 7222 0a20 2020 2029 0a0a 2020 2020 2320  r".    )..    # 
+0000e980: 5765 2027 6465 7465 6374 2720 7379 6d6c  We 'detect' syml
+0000e990: 696e 6b20 6c6f 6f70 7320 7769 7468 6f75  ink loops withou
+0000e9a0: 7420 646f 696e 6720 736f 6d65 7468 696e  t doing somethin
+0000e9b0: 6720 6c69 6b65 2073 7461 7469 6e67 2065  g like stating e
+0000e9c0: 6163 680a 2020 2020 2320 6469 7265 6374  ach.    # direct
+0000e9d0: 6f72 7920 616c 6f6e 6720 7468 6520 7761  ory along the wa
+0000e9e0: 7920 6279 2075 7369 6e67 2061 206d 6178  y by using a max
+0000e9f0: 2023 206f 6620 6669 6c65 7320 2874 6865   # of files (the
+0000ea00: 207a 6970 2077 6f75 6c64 0a20 2020 2023   zip would.    #
+0000ea10: 2062 6563 6f6d 6520 756e 6d61 6e61 6765   become unmanage
+0000ea20: 6162 6c65 2061 7420 736f 6d65 2070 6f69  able at some poi
+0000ea30: 6e74 2061 6e79 7761 7973 0a20 2020 206d  nt anyways.    m
+0000ea40: 6178 5f73 7461 7274 6572 5f66 696c 6573  ax_starter_files
+0000ea50: 203d 2061 7070 2e63 6f6e 6669 672e 6765   = app.config.ge
+0000ea60: 7428 224d 4158 5f53 5441 5254 4552 5f46  t("MAX_STARTER_F
+0000ea70: 494c 4553 222c 2031 3030 3030 3029 0a0a  ILES", 100000)..
+0000ea80: 2020 2020 2320 4e6f 7465 3a20 6120 7379      # Note: a sy
+0000ea90: 6d6c 696e 6b2d 746f 2d61 6e2d 616e 6365  mlink-to-an-ance
+0000eaa0: 7374 6f72 2077 696c 6c20 6361 7573 6520  stor will cause 
+0000eab0: 616e 2069 6e66 696e 6974 6520 6c6f 6f70  an infinite loop
+0000eac0: 2068 6572 652e 0a20 2020 2073 7461 7274   here..    start
+0000ead0: 6572 5f66 696c 6573 203d 205b 5d0a 2020  er_files = [].  
+0000eae0: 2020 666f 7220 6469 7270 6174 682c 2064    for dirpath, d
+0000eaf0: 6972 6e61 6d65 732c 2066 696c 656e 616d  irnames, filenam
+0000eb00: 6573 2069 6e20 6f73 2e77 616c 6b28 0a20  es in os.walk(. 
+0000eb10: 2020 2020 2020 2073 7461 7274 6572 5f64         starter_d
+0000eb20: 6972 2c0a 2020 2020 2020 2020 666f 6c6c  ir,.        foll
+0000eb30: 6f77 6c69 6e6b 733d 5472 7565 0a20 2020  owlinks=True.   
+0000eb40: 2029 3a0a 2020 2020 2020 2020 2320 446f   ):.        # Do
+0000eb50: 6e27 7420 696e 636c 7564 6520 5f5f 7079  n't include __py
+0000eb60: 6361 6368 655f 5f20 6469 7265 6374 6f72  cache__ director
+0000eb70: 6965 730a 2020 2020 2020 2020 6966 2027  ies.        if '
+0000eb80: 5f5f 7079 6361 6368 655f 5f27 2069 6e20  __pycache__' in 
+0000eb90: 6469 726e 616d 6573 3a0a 2020 2020 2020  dirnames:.      
+0000eba0: 2020 2020 2020 6469 726e 616d 6573 2e72        dirnames.r
+0000ebb0: 656d 6f76 6528 275f 5f70 7963 6163 6865  emove('__pycache
+0000ebc0: 5f5f 2729 0a0a 2020 2020 2020 2020 666f  __')..        fo
+0000ebd0: 7220 6669 6c65 6e61 6d65 2069 6e20 6669  r filename in fi
+0000ebe0: 6c65 6e61 6d65 733a 0a20 2020 2020 2020  lenames:.       
+0000ebf0: 2020 2020 2073 7461 7274 6572 5f66 696c       starter_fil
+0000ec00: 6573 2e61 7070 656e 6428 0a20 2020 2020  es.append(.     
+0000ec10: 2020 2020 2020 2020 2020 206f 732e 7061             os.pa
+0000ec20: 7468 2e72 656c 7061 7468 286f 732e 7061  th.relpath(os.pa
+0000ec30: 7468 2e6a 6f69 6e28 6469 7270 6174 682c  th.join(dirpath,
+0000ec40: 2066 696c 656e 616d 6529 2c20 7374 6172   filename), star
+0000ec50: 7465 725f 6469 7229 0a20 2020 2020 2020  ter_dir).       
+0000ec60: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000ec70: 2020 2069 6620 6c65 6e28 7374 6172 7465     if len(starte
+0000ec80: 725f 6669 6c65 7329 203e 206d 6178 5f73  r_files) > max_s
+0000ec90: 7461 7274 6572 5f66 696c 6573 3a0a 2020  tarter_files:.  
+0000eca0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000ecb0: 6973 6520 4f53 4572 726f 7228 0a20 2020  ise OSError(.   
+0000ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecd0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000ece0: 2020 2020 2020 2020 2020 2022 5765 2776             "We'v
+0000ecf0: 6520 666f 756e 6420 6d6f 7265 2074 6861  e found more tha
+0000ed00: 6e20 7b6d 6178 5f73 7461 7274 6572 5f66  n {max_starter_f
+0000ed10: 696c 6573 7d22 0a20 2020 2020 2020 2020  iles}".         
+0000ed20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000ed30: 2073 7461 7274 6572 2066 696c 6573 3b20   starter files; 
+0000ed40: 6974 2773 206c 696b 656c 7920 7468 6174  it's likely that
+0000ed50: 2079 6f75 2068 6176 6520 6122 0a20 2020   you have a".   
+0000ed60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed70: 2020 2020 2022 2073 796d 626f 6c69 6320       " symbolic 
+0000ed80: 6c69 6e6b 206c 6f6f 702e 2041 626f 7274  link loop. Abort
+0000ed90: 696e 672e 2e2e 220a 2020 2020 2020 2020  ing...".        
+0000eda0: 2020 2020 2020 2020 2020 2020 292e 666f              ).fo
+0000edb0: 726d 6174 286d 6178 5f73 7461 7274 6572  rmat(max_starter
+0000edc0: 5f66 696c 6573 3d6d 6178 5f73 7461 7274  _files=max_start
+0000edd0: 6572 5f66 696c 6573 290a 2020 2020 2020  er_files).      
+0000ede0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000edf0: 2073 7461 7274 6572 5f7a 6970 203d 206f   starter_zip = o
+0000ee00: 732e 7061 7468 2e6a 6f69 6e28 0a20 2020  s.path.join(.   
+0000ee10: 2020 2020 2073 746f 7261 6765 2e65 7661       storage.eva
+0000ee20: 6c75 6174 696f 6e5f 6469 7265 6374 6f72  luation_director
+0000ee30: 7928 636f 7572 7365 2c20 7365 6d65 7374  y(course, semest
+0000ee40: 6572 292c 0a20 2020 2020 2020 2022 7370  er),.        "sp
+0000ee50: 6563 7322 2c0a 2020 2020 2020 2020 7461  ecs",.        ta
+0000ee60: 736b 6964 2c0a 2020 2020 2020 2020 7461  skid,.        ta
+0000ee70: 736b 6964 202b 2022 2e7a 6970 220a 2020  skid + ".zip".  
+0000ee80: 2020 290a 0a20 2020 2023 2043 6f6d 7075    )..    # Compu
+0000ee90: 7465 206d 6f73 742d 7265 6365 6e74 2d6d  te most-recent-m
+0000eea0: 6f64 6966 6963 6174 696f 6e20 7469 6d65  odification time
+0000eeb0: 2066 6f72 2061 6e79 2073 7461 7274 6572   for any starter
+0000eec0: 2066 696c 650a 2020 2020 7570 6461 7465   file.    update
+0000eed0: 645f 6174 203d 204e 6f6e 650a 2020 2020  d_at = None.    
+0000eee0: 666f 7220 6669 6c65 2069 6e20 7374 6172  for file in star
+0000eef0: 7465 725f 6669 6c65 733a 0a20 2020 2020  ter_files:.     
+0000ef00: 2020 2066 756c 6c5f 7061 7468 203d 206f     full_path = o
+0000ef10: 732e 7061 7468 2e6a 6f69 6e28 7374 6172  s.path.join(star
+0000ef20: 7465 725f 6469 722c 2066 696c 6529 0a20  ter_dir, file). 
+0000ef30: 2020 2020 2020 206d 7469 6d65 203d 206f         mtime = o
+0000ef40: 732e 7374 6174 2866 756c 6c5f 7061 7468  s.stat(full_path
+0000ef50: 292e 7374 5f6d 7469 6d65 0a20 2020 2020  ).st_mtime.     
+0000ef60: 2020 2069 6620 7570 6461 7465 645f 6174     if updated_at
+0000ef70: 2069 7320 4e6f 6e65 206f 7220 7570 6461   is None or upda
+0000ef80: 7465 645f 6174 203c 206d 7469 6d65 3a0a  ted_at < mtime:.
+0000ef90: 2020 2020 2020 2020 2020 2020 7570 6461              upda
+0000efa0: 7465 645f 6174 203d 206d 7469 6d65 0a0a  ted_at = mtime..
+0000efb0: 2020 2020 2320 4368 6563 6b20 666f 7220      # Check for 
+0000efc0: 6672 6573 686e 6573 730a 2020 2020 6966  freshness.    if
+0000efd0: 2028 0a20 2020 2020 2020 206e 6f74 206f   (.        not o
+0000efe0: 732e 7061 7468 2e65 7869 7374 7328 7374  s.path.exists(st
+0000eff0: 6172 7465 725f 7a69 7029 0a20 2020 2020  arter_zip).     
+0000f000: 6f72 206f 732e 7374 6174 2873 7461 7274  or os.stat(start
+0000f010: 6572 5f7a 6970 292e 7374 5f6d 7469 6d65  er_zip).st_mtime
+0000f020: 203c 2075 7064 6174 6564 5f61 740a 2020   < updated_at.  
+0000f030: 2020 293a 0a20 2020 2020 2020 2023 205a    ):.        # Z
+0000f040: 6970 2075 7020 616c 6c20 7468 6520 7374  ip up all the st
+0000f050: 6172 7465 7220 6669 6c65 732c 2065 7261  arter files, era
+0000f060: 7369 6e67 2061 6e64 206f 7665 7277 7269  sing and overwri
+0000f070: 7469 6e67 2074 6865 206f 6c64 0a20 2020  ting the old.   
+0000f080: 2020 2020 2023 207a 6970 2066 696c 6520       # zip file 
+0000f090: 6966 2069 7420 7761 7320 7468 6572 6520  if it was there 
+0000f0a0: 6265 666f 7265 0a20 2020 2020 2020 2077  before.        w
+0000f0b0: 6974 6820 7a69 7066 696c 652e 5a69 7046  ith zipfile.ZipF
+0000f0c0: 696c 6528 7374 6172 7465 725f 7a69 702c  ile(starter_zip,
+0000f0d0: 2027 7727 2c20 7a69 7066 696c 652e 5a49   'w', zipfile.ZI
+0000f0e0: 505f 4445 464c 4154 4544 2920 6173 207a  P_DEFLATED) as z
+0000f0f0: 6f75 743a 0a20 2020 2020 2020 2020 2020  out:.           
+0000f100: 2066 6f72 2066 696c 6520 696e 2073 7461   for file in sta
+0000f110: 7274 6572 5f66 696c 6573 3a0a 2020 2020  rter_files:.    
+0000f120: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
+0000f130: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
+0000f140: 6a6f 696e 2873 7461 7274 6572 5f64 6972  join(starter_dir
+0000f150: 2c20 6669 6c65 290a 2020 2020 2020 2020  , file).        
+0000f160: 2020 2020 2020 2020 7a6f 7574 2e77 7269          zout.wri
+0000f170: 7465 2866 756c 6c5f 7061 7468 2c20 7461  te(full_path, ta
+0000f180: 736b 6964 202b 2027 2f27 202b 2066 696c  skid + '/' + fil
+0000f190: 6529 0a0a 2020 2020 7769 7468 206f 7065  e)..    with ope
+0000f1a0: 6e28 7374 6172 7465 725f 7a69 702c 2027  n(starter_zip, '
+0000f1b0: 7262 2729 2061 7320 6669 6e3a 0a20 2020  rb') as fin:.   
+0000f1c0: 2020 2020 2072 6177 5f62 7974 6573 203d       raw_bytes =
+0000f1d0: 2066 696e 2e72 6561 6428 290a 0a20 2020   fin.read()..   
+0000f1e0: 2072 6574 7572 6e20 666c 6173 6b2e 5265   return flask.Re
+0000f1f0: 7370 6f6e 7365 2872 6177 5f62 7974 6573  sponse(raw_bytes
+0000f200: 2c20 6d69 6d65 7479 7065 3d27 6170 706c  , mimetype='appl
+0000f210: 6963 6174 696f 6e2f 7a69 7027 290a 0a0a  ication/zip')...
+0000f220: 4061 7070 2e72 6f75 7465 2827 2f3c 636f  @app.route('/<co
+0000f230: 7572 7365 3e2f 3c73 656d 6573 7465 723e  urse>/<semester>
+0000f240: 2f67 7261 6465 7368 6565 742f 3c70 7369  /gradesheet/<psi
+0000f250: 643e 272c 206d 6574 686f 6473 3d5b 2747  d>', methods=['G
+0000f260: 4554 275d 290a 4066 6c61 736b 5f63 6173  ET']).@flask_cas
+0000f270: 2e6c 6f67 696e 5f72 6571 7569 7265 640a  .login_required.
+0000f280: 4061 7567 6d65 6e74 5f61 7267 756d 656e  @augment_argumen
+0000f290: 7473 0a64 6566 2072 6f75 7465 5f67 7261  ts.def route_gra
+0000f2a0: 6465 7368 6565 7428 0a20 2020 2063 6f75  desheet(.    cou
+0000f2b0: 7273 652c 0a20 2020 2073 656d 6573 7465  rse,.    semeste
+0000f2c0: 722c 0a20 2020 2070 7369 642c 0a20 2020  r,.    psid,.   
+0000f2d0: 2023 2041 7567 6d65 6e74 6564 2061 7267   # Augmented arg
+0000f2e0: 756d 656e 7473 0a20 2020 2075 7365 726e  uments.    usern
+0000f2f0: 616d 652c 0a20 2020 2069 735f 6164 6d69  ame,.    is_admi
+0000f300: 6e2c 0a20 2020 206d 6173 7175 6572 6164  n,.    masquerad
+0000f310: 655f 6173 2c0a 2020 2020 6566 6665 6374  e_as,.    effect
+0000f320: 6976 655f 7573 6572 2c0a 2020 2020 7461  ive_user,.    ta
+0000f330: 736b 5f69 6e66 6f0a 293a 0a20 2020 2022  sk_info.):.    "
+0000f340: 2222 0a20 2020 2056 6973 6962 6c65 2062  "".    Visible b
+0000f350: 7920 6164 6d69 6e73 206f 6e6c 792c 2074  y admins only, t
+0000f360: 6869 7320 726f 7574 6520 6469 7370 6c61  his route displa
+0000f370: 7973 2061 6e20 6f76 6572 7669 6577 206f  ys an overview o
+0000f380: 6620 7468 6520 7374 6174 7573 0a20 2020  f the status.   
+0000f390: 206f 6620 6576 6572 7920 7374 7564 656e   of every studen
+0000f3a0: 7420 6f6e 2074 6865 2072 6f73 7465 722c  t on the roster,
+0000f3b0: 2077 6974 6820 6c69 6e6b 7320 746f 2074   with links to t
+0000f3c0: 6865 2066 6565 6462 6163 6b20 7669 6577  he feedback view
+0000f3d0: 7320 666f 720a 2020 2020 6561 6368 2073  s for.    each s
+0000f3e0: 7475 6465 6e74 2f70 7365 742f 7068 6173  tudent/pset/phas
+0000f3f0: 652f 7461 736b 2e0a 2020 2020 2222 220a  e/task..    """.
+0000f400: 2020 2020 6966 206e 6f74 2069 735f 6164      if not is_ad
+0000f410: 6d69 6e3a 0a20 2020 2020 2020 2066 6c61  min:.        fla
+0000f420: 736b 2e66 6c61 7368 2822 596f 7520 646f  sk.flash("You do
+0000f430: 206e 6f74 2068 6176 6520 7065 726d 6973   not have permis
+0000f440: 7369 6f6e 2074 6f20 7669 6577 2067 7261  sion to view gra
+0000f450: 6465 7368 6565 7473 2e22 290a 2020 2020  desheets.").    
+0000f460: 2020 2020 7265 7475 726e 2067 6f62 6163      return gobac
+0000f470: 6b28 636f 7572 7365 2c20 7365 6d65 7374  k(course, semest
+0000f480: 6572 290a 0a20 2020 2023 2043 7265 6174  er)..    # Creat
+0000f490: 6520 6261 7365 2074 6173 6b20 696e 666f  e base task info
+0000f4a0: 2066 726f 6d20 6c6f 6767 6564 2d69 6e20   from logged-in 
+0000f4b0: 7573 6572 2773 2070 6572 7370 6563 7469  user's perspecti
+0000f4c0: 7665 0a20 2020 2062 6173 655f 7461 736b  ve.    base_task
+0000f4d0: 5f69 6e66 6f20 3d20 636f 7079 2e64 6565  _info = copy.dee
+0000f4e0: 7063 6f70 7928 7461 736b 5f69 6e66 6f29  pcopy(task_info)
+0000f4f0: 0a20 2020 2061 6d65 6e64 5f74 6173 6b5f  .    amend_task_
+0000f500: 696e 666f 2863 6f75 7273 652c 2073 656d  info(course, sem
+0000f510: 6573 7465 722c 2062 6173 655f 7461 736b  ester, base_task
+0000f520: 5f69 6e66 6f2c 2075 7365 726e 616d 6529  _info, username)
+0000f530: 0a0a 2020 2020 7472 793a 0a20 2020 2020  ..    try:.     
+0000f540: 2020 2070 7320 3d20 6765 745f 7073 5f6f     ps = get_ps_o
+0000f550: 626a 2862 6173 655f 7461 736b 5f69 6e66  bj(base_task_inf
+0000f560: 6f2c 2070 7369 6429 0a20 2020 2065 7863  o, psid).    exc
+0000f570: 6570 7420 5661 6c75 6545 7272 6f72 2061  ept ValueError a
+0000f580: 7320 653a 0a20 2020 2020 2020 2066 6c61  s e:.        fla
+0000f590: 736b 2e66 6c61 7368 2873 7472 2865 2929  sk.flash(str(e))
+0000f5a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f5b0: 676f 6261 636b 2863 6f75 7273 652c 2073  goback(course, s
+0000f5c0: 656d 6573 7465 7229 0a0a 2020 2020 2320  emester)..    # 
+0000f5d0: 4765 7420 7468 6520 726f 7374 6572 0a20  Get the roster. 
+0000f5e0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000f5f0: 726f 7374 6572 203d 2073 746f 7261 6765  roster = storage
+0000f600: 2e67 6574 5f72 6f73 7465 7228 636f 7572  .get_roster(cour
+0000f610: 7365 2c20 7365 6d65 7374 6572 290a 2020  se, semester).  
+0000f620: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0000f630: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+0000f640: 2066 6c61 736b 2e66 6c61 7368 2873 7472   flask.flash(str
+0000f650: 2865 2929 0a20 2020 2020 2020 2072 6f73  (e)).        ros
+0000f660: 7465 7220 3d20 4e6f 6e65 0a0a 2020 2020  ter = None..    
+0000f670: 6966 2072 6f73 7465 7220 6973 204e 6f6e  if roster is Non
+0000f680: 653a 0a20 2020 2020 2020 206d 7367 203d  e:.        msg =
+0000f690: 2022 4661 696c 6564 2074 6f20 6c6f 6164   "Failed to load
+0000f6a0: 203c 636f 6465 3e72 6f73 7465 722e 6373   <code>roster.cs
+0000f6b0: 763c 2f63 6f64 653e 2e22 0a20 2020 2020  v</code>.".     
+0000f6c0: 2020 2066 6c61 736b 2e66 6c61 7368 286d     flask.flash(m
+0000f6d0: 7367 290a 2020 2020 2020 2020 7265 7475  sg).        retu
+0000f6e0: 726e 2065 7272 6f72 5f72 6573 706f 6e73  rn error_respons
+0000f6f0: 6528 636f 7572 7365 2c20 7365 6d65 7374  e(course, semest
+0000f700: 6572 2c20 7573 6572 6e61 6d65 2c20 6d73  er, username, ms
+0000f710: 6729 0a0a 2020 2020 696e 6974 6961 6c5f  g)..    initial_
+0000f720: 7461 736b 5f74 696d 6573 203d 207b 7d0a  task_times = {}.
+0000f730: 2020 2020 7265 7669 7369 6f6e 5f74 6173      revision_tas
+0000f740: 6b5f 7469 6d65 7320 3d20 7b7d 0a20 2020  k_times = {}.   
+0000f750: 2072 6f77 7320 3d20 5b5d 0a20 2020 2066   rows = [].    f
+0000f760: 6f72 2073 7469 6420 696e 2073 6f72 7465  or stid in sorte
+0000f770: 6428 0a20 2020 2020 2020 2072 6f73 7465  d(.        roste
+0000f780: 722c 0a20 2020 2020 2020 206b 6579 3d6c  r,.        key=l
+0000f790: 616d 6264 6120 7374 6964 3a20 280a 2020  ambda stid: (.  
+0000f7a0: 2020 2020 2020 2020 2020 726f 7374 6572            roster
+0000f7b0: 5b73 7469 645d 5b22 636f 7572 7365 5f73  [stid]["course_s
+0000f7c0: 6563 7469 6f6e 225d 2c0a 2020 2020 2020  ection"],.      
+0000f7d0: 2020 2020 2020 726f 7374 6572 5b73 7469        roster[sti
+0000f7e0: 645d 5b22 736f 7274 6e61 6d65 225d 0a20  d]["sortname"]. 
+0000f7f0: 2020 2020 2020 2029 0a20 2020 2029 3a0a         ).    ):.
+0000f800: 2020 2020 2020 2020 726f 7720 3d20 726f          row = ro
+0000f810: 7374 6572 5b73 7469 645d 0a20 2020 2020  ster[stid].     
+0000f820: 2020 2072 6f77 5f69 6e66 6f20 3d20 636f     row_info = co
+0000f830: 7079 2e64 6565 7063 6f70 7928 7461 736b  py.deepcopy(task
+0000f840: 5f69 6e66 6f29 0a20 2020 2020 2020 2072  _info).        r
+0000f850: 6f77 5b22 7461 736b 5f69 6e66 6f22 5d20  ow["task_info"] 
+0000f860: 3d20 726f 775f 696e 666f 0a20 2020 2020  = row_info.     
+0000f870: 2020 2070 736f 626a 203d 2067 6574 5f70     psobj = get_p
+0000f880: 735f 6f62 6a28 726f 775f 696e 666f 2c20  s_obj(row_info, 
+0000f890: 7073 6964 290a 2020 2020 2020 2020 726f  psid).        ro
+0000f8a0: 775b 2274 6869 735f 7073 6574 225d 203d  w["this_pset"] =
+0000f8b0: 2070 736f 626a 0a0a 2020 2020 2020 2020   psobj..        
+0000f8c0: 616d 656e 645f 7073 6574 5f61 6e64 5f74  amend_pset_and_t
+0000f8d0: 6173 6b73 280a 2020 2020 2020 2020 2020  asks(.          
+0000f8e0: 2020 636f 7572 7365 2c0a 2020 2020 2020    course,.      
+0000f8f0: 2020 2020 2020 7365 6d65 7374 6572 2c0a        semester,.
+0000f900: 2020 2020 2020 2020 2020 2020 726f 775f              row_
+0000f910: 696e 666f 2c0a 2020 2020 2020 2020 2020  info,.          
+0000f920: 2020 7073 6f62 6a2c 0a20 2020 2020 2020    psobj,.       
+0000f930: 2020 2020 2072 6f77 5b22 7573 6572 6e61       row["userna
+0000f940: 6d65 225d 0a20 2020 2020 2020 2029 0a0a  me"].        )..
+0000f950: 2020 2020 2020 2020 7073 6f62 6a5b 2274          psobj["t
+0000f960: 6f74 616c 5f74 696d 6522 5d20 3d20 300a  otal_time"] = 0.
+0000f970: 0a20 2020 2020 2020 2066 6f72 2074 6173  .        for tas
+0000f980: 6b6f 626a 2069 6e20 7073 6f62 6a5b 2274  kobj in psobj["t
+0000f990: 6173 6b73 225d 3a0a 2020 2020 2020 2020  asks"]:.        
+0000f9a0: 2020 2020 7461 736b 6964 203d 2074 6173      taskid = tas
+0000f9b0: 6b6f 626a 5b22 6964 225d 0a20 2020 2020  kobj["id"].     
+0000f9c0: 2020 2020 2020 2074 696d 655f 7370 656e         time_spen
+0000f9d0: 7420 3d20 7461 736b 6f62 6a5b 2274 696d  t = taskobj["tim
+0000f9e0: 655f 7370 656e 7422 5d0a 2020 2020 2020  e_spent"].      
+0000f9f0: 2020 2020 2020 6966 2074 696d 655f 7370        if time_sp
+0000fa00: 656e 7420 6973 206e 6f74 204e 6f6e 653a  ent is not None:
+0000fa10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fa20: 2074 696d 655f 7661 6c20 3d20 7469 6d65   time_val = time
+0000fa30: 5f73 7065 6e74 5b22 7469 6d65 5f73 7065  _spent["time_spe
+0000fa40: 6e74 225d 0a20 2020 2020 2020 2020 2020  nt"].           
+0000fa50: 2020 2020 2069 6620 7461 736b 6964 206e       if taskid n
+0000fa60: 6f74 2069 6e20 696e 6974 6961 6c5f 7461  ot in initial_ta
+0000fa70: 736b 5f74 696d 6573 3a0a 2020 2020 2020  sk_times:.      
+0000fa80: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000fa90: 6974 6961 6c5f 7461 736b 5f74 696d 6573  itial_task_times
+0000faa0: 5b74 6173 6b69 645d 203d 207b 7d0a 0a20  [taskid] = {}.. 
+0000fab0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000fac0: 6620 6973 696e 7374 616e 6365 2874 696d  f isinstance(tim
+0000fad0: 655f 7661 6c2c 2028 666c 6f61 742c 2069  e_val, (float, i
+0000fae0: 6e74 2929 3a0a 2020 2020 2020 2020 2020  nt)):.          
+0000faf0: 2020 2020 2020 2020 2020 696e 6974 6961            initia
+0000fb00: 6c5f 7461 736b 5f74 696d 6573 5b74 6173  l_task_times[tas
+0000fb10: 6b69 645d 5b72 6f77 5b22 7573 6572 6e61  kid][row["userna
+0000fb20: 6d65 225d 5d20 3d20 7469 6d65 5f76 616c  me"]] = time_val
+0000fb30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fb40: 2020 2020 2074 6173 6b6f 626a 5b22 696e       taskobj["in
+0000fb50: 6974 6961 6c5f 7469 6d65 5f76 616c 225d  itial_time_val"]
+0000fb60: 203d 2074 696d 655f 7661 6c0a 2020 2020   = time_val.    
+0000fb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb80: 6966 2069 7369 6e73 7461 6e63 6528 7073  if isinstance(ps
+0000fb90: 6f62 6a5b 2274 6f74 616c 5f74 696d 6522  obj["total_time"
+0000fba0: 5d2c 2028 696e 742c 2066 6c6f 6174 2929  ], (int, float))
 0000fbb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fbc0: 2020 2020 2020 7265 7669 7369 6f6e 5f74        revision_t
-0000fbd0: 6173 6b5f 7469 6d65 735b 7461 736b 6964  ask_times[taskid
-0000fbe0: 5d5b 726f 775b 2275 7365 726e 616d 6522  ][row["username"
-0000fbf0: 5d5d 203d 2072 6576 5f74 696d 655f 7661  ]] = rev_time_va
-0000fc00: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-0000fc10: 2020 2020 2020 7461 736b 6f62 6a5b 2272        taskobj["r
-0000fc20: 6576 6973 696f 6e5f 7469 6d65 5f76 616c  evision_time_val
-0000fc30: 225d 203d 2072 6576 5f74 696d 655f 7661  "] = rev_time_va
-0000fc40: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-0000fc50: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0000fc60: 6e63 6528 7073 6f62 6a5b 2274 6f74 616c  nce(psobj["total
-0000fc70: 5f74 696d 6522 5d2c 2028 696e 742c 2066  _time"], (int, f
-0000fc80: 6c6f 6174 2929 3a0a 2020 2020 2020 2020  loat)):.        
-0000fc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fca0: 7073 6f62 6a5b 2274 6f74 616c 5f74 696d  psobj["total_tim
-0000fcb0: 6522 5d20 2b3d 2072 6576 5f74 696d 655f  e"] += rev_time_
-0000fcc0: 7661 6c0a 2020 2020 2020 2020 2020 2020  val.            
-0000fcd0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000fce0: 7461 6e63 6528 7461 736b 6f62 6a5b 2269  tance(taskobj["i
-0000fcf0: 6e69 7469 616c 5f74 696d 655f 7661 6c22  nitial_time_val"
-0000fd00: 5d2c 2028 696e 742c 2066 6c6f 6174 2929  ], (int, float))
-0000fd10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fd20: 2020 2020 2020 2020 2020 7461 736b 6f62            taskob
-0000fd30: 6a5b 2263 6f6d 6269 6e65 645f 7469 6d65  j["combined_time
-0000fd40: 5f76 616c 225d 203d 2028 0a20 2020 2020  _val"] = (.     
-0000fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd60: 2020 2020 2020 2074 6173 6b6f 626a 5b22         taskobj["
-0000fd70: 696e 6974 6961 6c5f 7469 6d65 5f76 616c  initial_time_val
-0000fd80: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-0000fd90: 2020 2020 2020 2020 2020 2020 202b 2072               + r
-0000fda0: 6576 5f74 696d 655f 7661 6c0a 2020 2020  ev_time_val.    
-0000fdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdc0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000fdd0: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
-0000fde0: 2023 2069 6e69 7469 616c 2077 6173 2061   # initial was a
-0000fdf0: 206e 6f6e 2d65 6d70 7479 2073 7472 696e   non-empty strin
-0000fe00: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-0000fe10: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
-0000fe20: 616e 6365 2874 6173 6b6f 626a 5b22 696e  ance(taskobj["in
-0000fe30: 6974 6961 6c5f 7469 6d65 5f76 616c 225d  itial_time_val"]
-0000fe40: 2c20 7374 7229 0a20 2020 2020 2020 2020  , str).         
-0000fe50: 2020 2020 2020 2020 2020 2061 6e64 2074             and t
-0000fe60: 6173 6b6f 626a 5b22 696e 6974 6961 6c5f  askobj["initial_
-0000fe70: 7469 6d65 5f76 616c 225d 206e 6f74 2069  time_val"] not i
-0000fe80: 6e20 2822 222c 2022 3f22 290a 2020 2020  n ("", "?").    
-0000fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fea0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000feb0: 2020 2020 2020 2020 2020 2074 6173 6b6f             tasko
-0000fec0: 626a 5b22 636f 6d62 696e 6564 5f74 696d  bj["combined_tim
-0000fed0: 655f 7661 6c22 5d20 3d20 223f 220a 2020  e_val"] = "?".  
-0000fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fef0: 2020 656c 7365 3a20 2320 656d 7074 7920    else: # empty 
-0000ff00: 7374 7269 6e67 206f 7220 4e6f 6e65 206f  string or None o
-0000ff10: 7220 7468 6520 6c69 6b65 0a20 2020 2020  r the like.     
-0000ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff30: 2020 2074 6173 6b6f 626a 5b22 636f 6d62     taskobj["comb
-0000ff40: 696e 6564 5f74 696d 655f 7661 6c22 5d20  ined_time_val"] 
-0000ff50: 3d20 7265 765f 7469 6d65 5f76 616c 0a0a  = rev_time_val..
-0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff70: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0000ff80: 7265 765f 7469 6d65 5f76 616c 2c20 7374  rev_time_val, st
-0000ff90: 7229 2061 6e64 2072 6576 5f74 696d 655f  r) and rev_time_
-0000ffa0: 7661 6c20 213d 2022 223a 0a20 2020 2020  val != "":.     
-0000ffb0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000ffc0: 6173 6b6f 626a 5b22 7265 7669 7369 6f6e  askobj["revision
-0000ffd0: 5f74 696d 655f 7661 6c22 5d20 3d20 7265  _time_val"] = re
-0000ffe0: 765f 7469 6d65 5f76 616c 0a20 2020 2020  v_time_val.     
-0000fff0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00010000: 736f 626a 5b22 746f 7461 6c5f 7469 6d65  sobj["total_time
-00010010: 225d 203d 2022 3f22 0a20 2020 2020 2020  "] = "?".       
-00010020: 2020 2020 2020 2020 2020 2020 2074 6173               tas
-00010030: 6b6f 626a 5b22 636f 6d62 696e 6564 5f74  kobj["combined_t
-00010040: 696d 655f 7661 6c22 5d20 3d20 223f 220a  ime_val"] = "?".
-00010050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010060: 2065 6c73 653a 2023 2065 6d70 7479 2073   else: # empty s
-00010070: 7472 696e 6720 6f72 204e 6f6e 6520 6f72  tring or None or
-00010080: 2074 6865 206c 696b 650a 2020 2020 2020   the like.      
-00010090: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-000100a0: 736b 6f62 6a5b 2272 6576 6973 696f 6e5f  skobj["revision_
-000100b0: 7469 6d65 5f76 616c 225d 203d 2022 3f22  time_val"] = "?"
-000100c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000100d0: 2020 2020 2074 6173 6b6f 626a 5b22 636f       taskobj["co
-000100e0: 6d62 696e 6564 5f74 696d 655f 7661 6c22  mbined_time_val"
-000100f0: 5d20 3d20 7461 736b 6f62 6a5b 2269 6e69  ] = taskobj["ini
-00010100: 7469 616c 5f74 696d 655f 7661 6c22 5d0a  tial_time_val"].
-00010110: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00010120: 653a 2023 206e 6f20 7265 7620 7469 6d65  e: # no rev time
-00010130: 2073 7065 6e74 0a20 2020 2020 2020 2020   spent.         
-00010140: 2020 2020 2020 2074 6173 6b6f 626a 5b22         taskobj["
-00010150: 7265 7669 7369 6f6e 5f74 696d 655f 7661  revision_time_va
-00010160: 6c22 5d20 3d20 223f 220a 2020 2020 2020  l"] = "?".      
-00010170: 2020 2020 2020 2020 2020 7461 736b 6f62            taskob
-00010180: 6a5b 2263 6f6d 6269 6e65 645f 7469 6d65  j["combined_time
-00010190: 5f76 616c 225d 203d 2074 6173 6b6f 626a  _val"] = taskobj
-000101a0: 5b22 696e 6974 6961 6c5f 7469 6d65 5f76  ["initial_time_v
-000101b0: 616c 225d 0a0a 2020 2020 2020 2020 726f  al"]..        ro
-000101c0: 7773 2e61 7070 656e 6428 726f 7729 0a0a  ws.append(row)..
-000101d0: 2020 2020 6167 6772 6567 6174 655f 7469      aggregate_ti
-000101e0: 6d65 7320 3d20 7b0a 2020 2020 2020 2020  mes = {.        
-000101f0: 7068 6173 653a 207b 0a20 2020 2020 2020  phase: {.       
-00010200: 2020 2020 2022 6176 6572 6167 6522 3a20       "average": 
-00010210: 7b20 2270 7365 7422 3a20 3020 7d2c 0a20  { "pset": 0 },. 
-00010220: 2020 2020 2020 2020 2020 2022 6d65 6469             "medi
-00010230: 616e 223a 207b 2022 7073 6574 223a 2030  an": { "pset": 0
-00010240: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-00010250: 2237 3574 6822 3a20 7b20 2270 7365 7422  "75th": { "pset"
-00010260: 3a20 3020 7d2c 0a20 2020 2020 2020 207d  : 0 },.        }
-00010270: 0a20 2020 2020 2020 2066 6f72 2070 6861  .        for pha
-00010280: 7365 2069 6e20 2822 696e 6974 6961 6c22  se in ("initial"
-00010290: 2c20 2272 6576 6973 696f 6e22 290a 2020  , "revision").  
-000102a0: 2020 7d0a 2020 2020 6167 6772 6567 6174    }.    aggregat
-000102b0: 655f 7469 6d65 735b 2261 6c6c 225d 203d  e_times["all"] =
-000102c0: 207b 7d0a 2020 2020 666f 7220 7068 6173   {}.    for phas
-000102d0: 652c 2074 696d 6573 5f67 726f 7570 2069  e, times_group i
-000102e0: 6e20 5b0a 2020 2020 2020 2020 2822 696e  n [.        ("in
-000102f0: 6974 6961 6c22 2c20 696e 6974 6961 6c5f  itial", initial_
-00010300: 7461 736b 5f74 696d 6573 292c 0a20 2020  task_times),.   
-00010310: 2020 2020 2028 2272 6576 6973 696f 6e22       ("revision"
-00010320: 2c20 7265 7669 7369 6f6e 5f74 6173 6b5f  , revision_task_
-00010330: 7469 6d65 7329 0a20 2020 205d 3a0a 2020  times).    ]:.  
-00010340: 2020 2020 2020 666f 7220 7461 736b 6964        for taskid
-00010350: 2069 6e20 7469 6d65 735f 6772 6f75 703a   in times_group:
-00010360: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-00010370: 6573 203d 206c 6973 7428 7469 6d65 735f  es = list(times_
-00010380: 6772 6f75 705b 7461 736b 6964 5d2e 7661  group[taskid].va
-00010390: 6c75 6573 2829 290a 2020 2020 2020 2020  lues()).        
-000103a0: 2020 2020 6966 206c 656e 2874 696d 6573      if len(times
-000103b0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-000103c0: 2020 2020 2020 2020 6176 6720 3d20 4e6f          avg = No
-000103d0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-000103e0: 2020 206d 6564 203d 204e 6f6e 650a 2020     med = None.  
-000103f0: 2020 2020 2020 2020 2020 2020 2020 7172                qr
-00010400: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
-00010410: 2020 2020 2065 6c69 6620 6c65 6e28 7469       elif len(ti
-00010420: 6d65 7329 203d 3d20 313a 0a20 2020 2020  mes) == 1:.     
-00010430: 2020 2020 2020 2020 2020 2061 7667 203d             avg =
-00010440: 2074 696d 6573 5b30 5d0a 2020 2020 2020   times[0].      
-00010450: 2020 2020 2020 2020 2020 6d65 6420 3d20            med = 
-00010460: 7469 6d65 735b 305d 0a20 2020 2020 2020  times[0].       
-00010470: 2020 2020 2020 2020 2071 7274 203d 2074           qrt = t
-00010480: 696d 6573 5b30 5d0a 2020 2020 2020 2020  imes[0].        
-00010490: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000104a0: 2020 2020 2020 2020 2020 6176 6720 3d20            avg = 
-000104b0: 7375 6d28 7469 6d65 7329 202f 206c 656e  sum(times) / len
-000104c0: 2874 696d 6573 290a 2020 2020 2020 2020  (times).        
-000104d0: 2020 2020 2020 2020 6d65 6420 3d20 7065          med = pe
-000104e0: 7263 656e 7469 6c65 2874 696d 6573 2c20  rcentile(times, 
-000104f0: 3530 290a 2020 2020 2020 2020 2020 2020  50).            
-00010500: 2020 2020 7172 7420 3d20 7065 7263 656e      qrt = percen
-00010510: 7469 6c65 2874 696d 6573 2c20 3735 290a  tile(times, 75).
-00010520: 0a20 2020 2020 2020 2020 2020 2061 6767  .            agg
-00010530: 7265 6761 7465 5f74 696d 6573 5b70 6861  regate_times[pha
-00010540: 7365 5d5b 2261 7665 7261 6765 225d 5b74  se]["average"][t
-00010550: 6173 6b69 645d 203d 2061 7667 0a20 2020  askid] = avg.   
-00010560: 2020 2020 2020 2020 2061 6767 7265 6761           aggrega
-00010570: 7465 5f74 696d 6573 5b70 6861 7365 5d5b  te_times[phase][
-00010580: 226d 6564 6961 6e22 5d5b 7461 736b 6964  "median"][taskid
-00010590: 5d20 3d20 6d65 640a 2020 2020 2020 2020  ] = med.        
-000105a0: 2020 2020 6167 6772 6567 6174 655f 7469      aggregate_ti
-000105b0: 6d65 735b 7068 6173 655d 5b22 3735 7468  mes[phase]["75th
-000105c0: 225d 5b74 6173 6b69 645d 203d 2071 7274  "][taskid] = qrt
-000105d0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000105e0: 2061 7667 2069 7320 6e6f 7420 4e6f 6e65   avg is not None
-000105f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010600: 2020 6167 6772 6567 6174 655f 7469 6d65    aggregate_time
-00010610: 735b 7068 6173 655d 5b22 6176 6572 6167  s[phase]["averag
-00010620: 6522 5d5b 2270 7365 7422 5d20 2b3d 2061  e"]["pset"] += a
-00010630: 7667 0a20 2020 2020 2020 2020 2020 2020  vg.             
-00010640: 2020 2061 6767 7265 6761 7465 5f74 696d     aggregate_tim
-00010650: 6573 5b70 6861 7365 5d5b 226d 6564 6961  es[phase]["media
-00010660: 6e22 5d5b 2270 7365 7422 5d20 2b3d 206d  n"]["pset"] += m
-00010670: 6564 0a20 2020 2020 2020 2020 2020 2020  ed.             
-00010680: 2020 2061 6767 7265 6761 7465 5f74 696d     aggregate_tim
-00010690: 6573 5b70 6861 7365 5d5b 2237 3574 6822  es[phase]["75th"
-000106a0: 5d5b 2270 7365 7422 5d20 2b3d 2071 7274  ]["pset"] += qrt
-000106b0: 0a0a 2020 2020 2320 436f 6d70 7574 6520  ..    # Compute 
-000106c0: 746f 7461 6c20 7469 6d65 7320 7461 6b69  total times taki
-000106d0: 6e67 207a 6572 6f2d 7265 7669 7369 6f6e  ng zero-revision
-000106e0: 2d74 696d 6573 2069 6e74 6f20 6163 636f  -times into acco
-000106f0: 756e 740a 2020 2020 746f 7461 6c5f 7469  unt.    total_ti
-00010700: 6d65 7370 656e 745f 7661 6c75 6573 203d  mespent_values =
-00010710: 205b 5d0a 2020 2020 666f 7220 7374 7564   [].    for stud
-00010720: 656e 7420 696e 205b 726f 775b 2275 7365  ent in [row["use
-00010730: 726e 616d 6522 5d20 666f 7220 726f 7720  rname"] for row 
-00010740: 696e 2072 6f73 7465 722e 7661 6c75 6573  in roster.values
-00010750: 2829 5d3a 0a20 2020 2020 2020 2074 6f74  ()]:.        tot
-00010760: 616c 5f74 696d 6573 7065 6e74 203d 2030  al_timespent = 0
-00010770: 0a20 2020 2020 2020 2066 6f72 2074 6173  .        for tas
-00010780: 6b6f 626a 2069 6e20 7073 6f62 6a5b 2274  kobj in psobj["t
-00010790: 6173 6b73 225d 3a0a 2020 2020 2020 2020  asks"]:.        
-000107a0: 2020 2020 7461 736b 6964 203d 2074 6173      taskid = tas
-000107b0: 6b6f 626a 5b22 6964 225d 0a20 2020 2020  kobj["id"].     
-000107c0: 2020 2020 2020 2074 6869 735f 7461 736b         this_task
-000107d0: 5f69 6e69 7469 616c 5f74 696d 6573 203d  _initial_times =
-000107e0: 2069 6e69 7469 616c 5f74 6173 6b5f 7469   initial_task_ti
-000107f0: 6d65 732e 6765 7428 7461 736b 6964 2c20  mes.get(taskid, 
-00010800: 7b7d 290a 2020 2020 2020 2020 2020 2020  {}).            
-00010810: 7468 6973 5f74 6173 6b5f 7265 7669 7369  this_task_revisi
-00010820: 6f6e 5f74 696d 6573 203d 2072 6576 6973  on_times = revis
-00010830: 696f 6e5f 7461 736b 5f74 696d 6573 2e67  ion_task_times.g
-00010840: 6574 2874 6173 6b69 642c 207b 7d29 0a20  et(taskid, {}). 
-00010850: 2020 2020 2020 2020 2020 2069 6620 7374             if st
-00010860: 7564 656e 7420 696e 2074 6869 735f 7461  udent in this_ta
-00010870: 736b 5f69 6e69 7469 616c 5f74 696d 6573  sk_initial_times
-00010880: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010890: 2020 746f 7461 6c5f 7469 6d65 7370 656e    total_timespen
-000108a0: 7420 2b3d 2074 6869 735f 7461 736b 5f69  t += this_task_i
-000108b0: 6e69 7469 616c 5f74 696d 6573 5b73 7475  nitial_times[stu
-000108c0: 6465 6e74 5d0a 2020 2020 2020 2020 2020  dent].          
-000108d0: 2020 6966 2073 7475 6465 6e74 2069 6e20    if student in 
-000108e0: 7468 6973 5f74 6173 6b5f 7265 7669 7369  this_task_revisi
-000108f0: 6f6e 5f74 696d 6573 3a0a 2020 2020 2020  on_times:.      
-00010900: 2020 2020 2020 2020 2020 746f 7461 6c5f            total_
-00010910: 7469 6d65 7370 656e 7420 2b3d 2074 6869  timespent += thi
-00010920: 735f 7461 736b 5f72 6576 6973 696f 6e5f  s_task_revision_
-00010930: 7469 6d65 735b 7374 7564 656e 745d 0a20  times[student]. 
-00010940: 2020 2020 2020 2069 6620 746f 7461 6c5f         if total_
-00010950: 7469 6d65 7370 656e 7420 3e20 303a 0a20  timespent > 0:. 
-00010960: 2020 2020 2020 2020 2020 2074 6f74 616c             total
-00010970: 5f74 696d 6573 7065 6e74 5f76 616c 7565  _timespent_value
-00010980: 732e 6170 7065 6e64 2874 6f74 616c 5f74  s.append(total_t
-00010990: 696d 6573 7065 6e74 290a 0a20 2020 2069  imespent)..    i
-000109a0: 6620 6c65 6e28 746f 7461 6c5f 7469 6d65  f len(total_time
-000109b0: 7370 656e 745f 7661 6c75 6573 2920 3d3d  spent_values) ==
-000109c0: 2030 3a0a 2020 2020 2020 2020 6176 6720   0:.        avg 
-000109d0: 3d20 300a 2020 2020 2020 2020 6d65 6420  = 0.        med 
-000109e0: 3d20 300a 2020 2020 2020 2020 7172 7420  = 0.        qrt 
-000109f0: 3d20 300a 2020 2020 656c 6966 206c 656e  = 0.    elif len
-00010a00: 2874 6f74 616c 5f74 696d 6573 7065 6e74  (total_timespent
-00010a10: 5f76 616c 7565 7329 203d 3d20 313a 0a20  _values) == 1:. 
-00010a20: 2020 2020 2020 2061 7667 203d 2074 6f74         avg = tot
-00010a30: 616c 5f74 696d 6573 7065 6e74 5f76 616c  al_timespent_val
-00010a40: 7565 735b 305d 0a20 2020 2020 2020 206d  ues[0].        m
-00010a50: 6564 203d 2074 6f74 616c 5f74 696d 6573  ed = total_times
-00010a60: 7065 6e74 5f76 616c 7565 735b 305d 0a20  pent_values[0]. 
-00010a70: 2020 2020 2020 2071 7274 203d 2074 6f74         qrt = tot
-00010a80: 616c 5f74 696d 6573 7065 6e74 5f76 616c  al_timespent_val
-00010a90: 7565 735b 305d 0a20 2020 2065 6c73 653a  ues[0].    else:
-00010aa0: 0a20 2020 2020 2020 2061 7667 203d 2073  .        avg = s
-00010ab0: 756d 2874 6f74 616c 5f74 696d 6573 7065  um(total_timespe
-00010ac0: 6e74 5f76 616c 7565 7329 202f 206c 656e  nt_values) / len
-00010ad0: 2874 6f74 616c 5f74 696d 6573 7065 6e74  (total_timespent
-00010ae0: 5f76 616c 7565 7329 0a20 2020 2020 2020  _values).       
-00010af0: 206d 6564 203d 2070 6572 6365 6e74 696c   med = percentil
-00010b00: 6528 746f 7461 6c5f 7469 6d65 7370 656e  e(total_timespen
-00010b10: 745f 7661 6c75 6573 2c20 3530 290a 2020  t_values, 50).  
-00010b20: 2020 2020 2020 7172 7420 3d20 7065 7263        qrt = perc
-00010b30: 656e 7469 6c65 2874 6f74 616c 5f74 696d  entile(total_tim
-00010b40: 6573 7065 6e74 5f76 616c 7565 732c 2037  espent_values, 7
-00010b50: 3529 0a0a 2020 2020 6167 6772 6567 6174  5)..    aggregat
-00010b60: 655f 7469 6d65 735b 2261 6c6c 225d 5b22  e_times["all"]["
-00010b70: 6176 6572 6167 6522 5d20 3d20 6176 670a  average"] = avg.
-00010b80: 2020 2020 6167 6772 6567 6174 655f 7469      aggregate_ti
-00010b90: 6d65 735b 2261 6c6c 225d 5b22 6d65 6469  mes["all"]["medi
-00010ba0: 616e 225d 203d 206d 6564 0a20 2020 2061  an"] = med.    a
-00010bb0: 6767 7265 6761 7465 5f74 696d 6573 5b22  ggregate_times["
-00010bc0: 616c 6c22 5d5b 2237 3574 6822 5d20 3d20  all"]["75th"] = 
-00010bd0: 7172 740a 0a20 2020 2023 2047 6574 2074  qrt..    # Get t
-00010be0: 6865 2073 7475 6465 6e74 2069 6e66 6f0a  he student info.
-00010bf0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00010c00: 2073 7475 6465 6e74 5f69 6e66 6f20 3d20   student_info = 
-00010c10: 7374 6f72 6167 652e 6765 745f 7374 7564  storage.get_stud
-00010c20: 656e 745f 696e 666f 2863 6f75 7273 652c  ent_info(course,
-00010c30: 2073 656d 6573 7465 7229 0a20 2020 2065   semester).    e
-00010c40: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00010c50: 6173 2065 3a0a 2020 2020 2020 2020 666c  as e:.        fl
-00010c60: 6173 6b2e 666c 6173 6828 7374 7228 6529  ask.flash(str(e)
-00010c70: 290a 2020 2020 2020 2020 7374 7564 656e  ).        studen
-00010c80: 745f 696e 666f 203d 204e 6f6e 650a 0a20  t_info = None.. 
-00010c90: 2020 2072 6574 7572 6e20 666c 6173 6b2e     return flask.
-00010ca0: 7265 6e64 6572 5f74 656d 706c 6174 6528  render_template(
-00010cb0: 0a20 2020 2020 2020 2027 6772 6164 6573  .        'grades
-00010cc0: 6865 6574 2e6a 3227 2c0a 2020 2020 2020  heet.j2',.      
-00010cd0: 2020 636f 7572 7365 5f6e 616d 653d 6170    course_name=ap
-00010ce0: 702e 636f 6e66 6967 2e67 6574 2822 434f  p.config.get("CO
-00010cf0: 5552 5345 5f4e 414d 4553 222c 207b 7d29  URSE_NAMES", {})
-00010d00: 2e67 6574 2863 6f75 7273 652c 2063 6f75  .get(course, cou
-00010d10: 7273 6529 2c0a 2020 2020 2020 2020 636f  rse),.        co
-00010d20: 7572 7365 3d63 6f75 7273 652c 0a20 2020  urse=course,.   
-00010d30: 2020 2020 2073 656d 6573 7465 723d 7365       semester=se
-00010d40: 6d65 7374 6572 2c0a 2020 2020 2020 2020  mester,.        
-00010d50: 7573 6572 6e61 6d65 3d75 7365 726e 616d  username=usernam
-00010d60: 652c 0a20 2020 2020 2020 2069 735f 6164  e,.        is_ad
-00010d70: 6d69 6e3d 6973 5f61 646d 696e 2c0a 2020  min=is_admin,.  
-00010d80: 2020 2020 2020 6d61 7371 7565 7261 6465        masquerade
-00010d90: 5f61 733d 6d61 7371 7565 7261 6465 5f61  _as=masquerade_a
-00010da0: 732c 0a20 2020 2020 2020 2074 6173 6b5f  s,.        task_
-00010db0: 696e 666f 3d74 6173 6b5f 696e 666f 2c0a  info=task_info,.
-00010dc0: 2020 2020 2020 2020 7073 3d70 732c 0a20          ps=ps,. 
-00010dd0: 2020 2020 2020 2072 6f73 7465 723d 726f         roster=ro
-00010de0: 7773 2c0a 2020 2020 2020 2020 7374 7564  ws,.        stud
-00010df0: 656e 745f 696e 666f 3d73 7475 6465 6e74  ent_info=student
-00010e00: 5f69 6e66 6f2c 0a20 2020 2020 2020 2061  _info,.        a
-00010e10: 6767 7265 6761 7465 5f74 696d 6573 3d61  ggregate_times=a
-00010e20: 6767 7265 6761 7465 5f74 696d 6573 0a20  ggregate_times. 
-00010e30: 2020 2029 0a0a 0a40 6170 702e 726f 7574     )...@app.rout
-00010e40: 6528 272f 3c63 6f75 7273 653e 2f3c 7365  e('/<course>/<se
-00010e50: 6d65 7374 6572 3e2f 6465 6c69 7665 7227  mester>/deliver'
-00010e60: 2c20 6d65 7468 6f64 733d 5b27 4745 5427  , methods=['GET'
-00010e70: 2c20 2750 4f53 5427 5d29 0a64 6566 2072  , 'POST']).def r
-00010e80: 6f75 7465 5f64 656c 6976 6572 2863 6f75  oute_deliver(cou
-00010e90: 7273 652c 2073 656d 6573 7465 7229 3a0a  rse, semester):.
-00010ea0: 2020 2020 2222 220a 2020 2020 5468 6973      """.    This
-00010eb0: 2072 6f75 7465 2069 7320 6163 6365 7373   route is access
-00010ec0: 6962 6c65 2062 7920 616e 796f 6e65 2077  ible by anyone w
-00010ed0: 6974 686f 7574 206c 6f67 696e 2c20 6265  ithout login, be
-00010ee0: 6361 7573 6520 6974 2069 730a 2020 2020  cause it is.    
-00010ef0: 676f 696e 6720 746f 2062 6520 706f 7374  going to be post
-00010f00: 6564 2074 6f20 6672 6f6d 2050 7974 686f  ed to from Pytho
-00010f10: 6e20 7363 7269 7074 7320 2873 6565 2074  n scripts (see t
-00010f20: 6865 2060 706f 746c 7563 6b44 656c 6976  he `potluckDeliv
-00010f30: 6572 7960 0a20 2020 206d 6f64 756c 6529  ery`.    module)
-00010f40: 2e20 5765 2077 696c 6c20 6f6e 6c79 2061  . We will only a
-00010f50: 6363 6570 7420 7375 626d 6973 7369 6f6e  ccept submission
-00010f60: 7320 6672 6f6d 2075 7365 7273 206f 6e20  s from users on 
-00010f70: 7468 6520 726f 7374 6572 0a20 2020 2066  the roster.    f
-00010f80: 6f72 2074 6865 2073 7065 6369 6669 6564  or the specified
-00010f90: 2063 6f75 7273 652f 7365 6d65 7374 6572   course/semester
-00010fa0: 2c20 616c 7468 6f75 6768 2062 6563 6175  , although becau
-00010fb0: 7365 2074 6865 7265 2773 206e 6f0a 2020  se there's no.  
-00010fc0: 2020 7665 7269 6669 6361 7469 6f6e 206f    verification o
-00010fd0: 6620 7573 6572 2049 4473 2c20 616e 796f  f user IDs, anyo
-00010fe0: 6e65 2063 6f75 6c64 2062 6520 7365 6e64  ne could be send
-00010ff0: 696e 6720 7375 626d 6973 7369 6f6e 7320  ing submissions 
-00011000: 2854 4f44 4f3a 0a20 2020 2046 6978 2074  (TODO:.    Fix t
-00011010: 6861 7420 7573 696e 6720 746f 6b65 6e2d  hat using token-
-00011020: 6261 7365 6420 7665 7269 6669 6361 7469  based verificati
-00011030: 6f6e 2129 2e20 416c 736f 2c20 7375 626d  on!). Also, subm
-00011040: 6973 7369 6f6e 7320 6d61 790a 2020 2020  issions may.    
-00011050: 696e 636c 7564 6520 6d75 6c74 6970 6c65  include multiple
-00011060: 2061 7574 686f 7273 2028 652e 672e 2077   authors (e.g. w
-00011070: 6865 6e20 7061 6972 2070 726f 6772 616d  hen pair program
-00011080: 6d69 6e67 292e 0a0a 2020 2020 5375 626d  ming)...    Subm
-00011090: 6974 7465 6420 666f 726d 2064 6174 6120  itted form data 
-000110a0: 7368 6f75 6c64 2068 6176 6520 7468 6520  should have the 
-000110b0: 666f 6c6c 6f77 696e 6720 736c 6f74 732c  following slots,
-000110c0: 2077 6974 6820 616c 6c0a 2020 2020 7374   with all.    st
-000110d0: 7269 6e67 7320 656e 636f 6465 6420 7573  rings encoded us
-000110e0: 696e 6720 7574 662d 383a 0a0a 2020 2020  ing utf-8:..    
-000110f0: 2d20 2765 7865 7263 6973 6527 3a20 5468  - 'exercise': Th
-00011100: 6520 4944 206f 6620 7468 6520 6578 6572  e ID of the exer
-00011110: 6369 7365 2062 6569 6e67 2073 7562 6d69  cise being submi
-00011120: 7474 6564 2e0a 2020 2020 2d20 2761 7574  tted..    - 'aut
-00011130: 686f 7273 273a 2041 204a 534f 4e2d 656e  hors': A JSON-en
-00011140: 636f 6465 6420 6c69 7374 206f 6620 7573  coded list of us
-00011150: 6572 6e61 6d65 7320 7468 6174 2074 6865  ernames that the
-00011160: 2073 7562 6d69 7373 696f 6e0a 2020 2020   submission.    
-00011170: 2020 2020 7368 6f75 6c64 2062 6520 6173      should be as
-00011180: 7369 676e 6564 2074 6f2e 0a20 2020 202d  signed to..    -
-00011190: 2027 6f75 7463 6f6d 6573 273a 2041 204a   'outcomes': A J
-000111a0: 534f 4e2d 656e 636f 6465 6420 6c69 7374  SON-encoded list
-000111b0: 206f 6620 606f 7074 696d 6973 6d60 206f   of `optimism` o
-000111c0: 7574 636f 6d65 2d74 7269 706c 6573 2c0a  utcome-triples,.
-000111d0: 2020 2020 2020 2020 6561 6368 2063 6f6e          each con
-000111e0: 7461 696e 696e 6720 6120 626f 6f6c 6561  taining a boolea
-000111f0: 6e20 696e 6469 6361 7469 6e67 2073 7563  n indicating suc
-00011200: 6365 7373 2f66 6169 6c75 7265 2c20 666f  cess/failure, fo
-00011210: 6c6c 6f77 6564 0a20 2020 2020 2020 2062  llowed.        b
-00011220: 7920 6120 7461 6720 7374 7269 6e67 2069  y a tag string i
-00011230: 6e64 6963 6174 696e 6720 7468 6520 6669  ndicating the fi
-00011240: 6c65 202b 206c 696e 6520 6e75 6d62 6572  le + line number
-00011250: 206f 6620 7468 6520 6368 6563 6b0a 2020   of the check.  
-00011260: 2020 2020 2020 616e 6420 6120 7365 636f        and a seco
-00011270: 6e64 2073 7472 696e 6720 7769 7468 2074  nd string with t
-00011280: 6865 206d 6573 7361 6765 2064 6573 6372  he message descr
-00011290: 6962 696e 6720 7468 6520 6f75 7463 6f6d  ibing the outcom
-000112a0: 6520 6f66 0a20 2020 2020 2020 2074 6865  e of.        the
-000112b0: 2063 6865 636b 2e0a 2020 2020 2d20 2763   check..    - 'c
-000112c0: 6f64 6527 3a20 4120 4a53 4f4e 2d65 6e63  ode': A JSON-enc
-000112d0: 6f64 6564 206c 6973 7420 6f66 2032 2d65  oded list of 2-e
-000112e0: 6c65 6d65 6e74 206c 6973 7473 2c20 6561  lement lists, ea
-000112f0: 6368 206f 6620 7768 6963 6820 6861 730a  ch of which has.
-00011300: 2020 2020 2020 2020 6120 6669 6c65 6e61          a filena
-00011310: 6d65 2028 6f72 206f 7468 6572 2063 6f64  me (or other cod
-00011320: 652d 736f 7572 6365 2d69 6465 6e74 6966  e-source-identif
-00011330: 7969 6e67 2d73 7472 696e 6729 2061 6e64  ying-string) and
-00011340: 2061 2063 6f64 650a 2020 2020 2020 2020   a code.        
-00011350: 626c 6f63 6b20 2861 7320 6120 7374 7269  block (as a stri
-00011360: 6e67 292e 0a0a 2020 2020 4966 2073 6f6d  ng)...    If som
-00011370: 6520 6f66 2074 6865 2064 6174 6120 6973  e of the data is
-00011380: 6e27 7420 696e 2074 6865 2066 6f72 6d61  n't in the forma
-00011390: 7473 2073 7065 6369 6669 6564 2061 626f  ts specified abo
-000113a0: 7665 2c20 6120 3430 3020 6572 726f 720a  ve, a 400 error.
-000113b0: 2020 2020 7769 6c6c 2062 6520 7265 7475      will be retu
-000113c0: 726e 6564 2077 6974 6820 6120 7374 7269  rned with a stri
-000113d0: 6e67 2064 6573 6372 6962 696e 6720 7768  ng describing wh
-000113e0: 6174 2773 2077 726f 6e67 2e0a 2020 2020  at's wrong..    
-000113f0: 2222 220a 2020 2020 2320 5468 6520 706f  """.    # The po
-00011400: 746c 7563 6b44 656c 6976 6572 7920 7363  tluckDelivery sc
-00011410: 7269 7074 2070 7269 6e74 7320 7468 6520  ript prints the 
-00011420: 6465 6c69 7665 7279 2055 524c 2c20 7768  delivery URL, wh
-00011430: 6963 6820 6d61 7920 6265 0a20 2020 2023  ich may be.    #
-00011440: 2073 7479 6c65 6420 6173 2061 206c 696e   styled as a lin
-00011450: 6b2e 2053 6f20 7765 2072 6564 6972 6563  k. So we redirec
-00011460: 7420 616e 796f 6e65 2061 6363 6573 7369  t anyone accessi
-00011470: 6e67 2074 6869 7320 726f 7574 6520 7769  ng this route wi
-00011480: 7468 0a20 2020 2023 2061 2047 4554 206d  th.    # a GET m
-00011490: 6574 686f 6420 746f 2074 6865 2064 6173  ethod to the das
-000114a0: 6862 6f61 7264 2e0a 2020 2020 6966 2066  hboard..    if f
-000114b0: 6c61 736b 2e72 6571 7565 7374 2e6d 6574  lask.request.met
-000114c0: 686f 6420 3d3d 2022 4745 5422 3a0a 2020  hod == "GET":.  
-000114d0: 2020 2020 2020 7265 7475 726e 2066 6c61        return fla
-000114e0: 736b 2e72 6564 6972 6563 7428 0a20 2020  sk.redirect(.   
-000114f0: 2020 2020 2020 2020 2066 6c61 736b 2e75           flask.u
-00011500: 726c 5f66 6f72 2827 726f 7574 655f 6461  rl_for('route_da
-00011510: 7368 272c 2063 6f75 7273 653d 636f 7572  sh', course=cour
-00011520: 7365 2c20 7365 6d65 7374 6572 3d73 656d  se, semester=sem
-00011530: 6573 7465 7229 0a20 2020 2020 2020 2029  ester).        )
-00011540: 0a0a 2020 2020 2320 5072 6f63 6573 7320  ..    # Process 
-00011550: 504f 5354 2069 6e66 6f2e 2e2e 0a20 2020  POST info....   
-00011560: 2066 6f72 6d20 3d20 666c 6173 6b2e 7265   form = flask.re
-00011570: 7175 6573 742e 666f 726d 0a0a 2020 2020  quest.form..    
-00011580: 2320 4765 7420 6578 6572 6369 7365 2049  # Get exercise I
-00011590: 440a 2020 2020 6578 6572 6369 7365 203d  D.    exercise =
-000115a0: 2066 6f72 6d2e 6765 7428 2265 7865 7263   form.get("exerc
-000115b0: 6973 6522 2c20 2222 290a 2020 2020 6966  ise", "").    if
-000115c0: 2065 7865 7263 6973 6520 3d3d 2022 223a   exercise == "":
-000115d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000115e0: 2822 4465 6c69 7665 7279 2064 6964 206e  ("Delivery did n
-000115f0: 6f74 2073 7065 6369 6679 2061 6e20 6578  ot specify an ex
-00011600: 6572 6369 7365 2e22 2c20 3430 3029 0a0a  ercise.", 400)..
-00011610: 2020 2020 2320 4765 7420 6175 7468 6f72      # Get author
-00011620: 7320 6c69 7374 2c20 6465 636f 6465 2074  s list, decode t
-00011630: 6865 204a 534f 4e2c 2061 6e64 2065 6e73  he JSON, and ens
-00011640: 7572 6520 6974 2773 2061 206c 6973 7420  ure it's a list 
-00011650: 6f66 0a20 2020 2023 2073 7472 696e 6773  of.    # strings
-00011660: 2e0a 2020 2020 6175 7468 6f72 7353 7472  ..    authorsStr
-00011670: 696e 6720 3d20 666f 726d 2e67 6574 2822  ing = form.get("
-00011680: 6175 7468 6f72 7322 2c20 2222 290a 2020  authors", "").  
-00011690: 2020 6966 2061 7574 686f 7273 5374 7269    if authorsStri
-000116a0: 6e67 203d 3d20 2222 3a0a 2020 2020 2020  ng == "":.      
-000116b0: 2020 7265 7475 726e 2028 2244 656c 6976    return ("Deliv
-000116c0: 6572 7920 6469 6420 6e6f 7420 7370 6563  ery did not spec
-000116d0: 6966 7920 6175 7468 6f72 732e 222c 2034  ify authors.", 4
-000116e0: 3030 290a 0a20 2020 2074 7279 3a0a 2020  00)..    try:.  
-000116f0: 2020 2020 2020 6175 7468 6f72 7320 3d20        authors = 
-00011700: 6a73 6f6e 2e6c 6f61 6473 2861 7574 686f  json.loads(autho
-00011710: 7273 5374 7269 6e67 290a 2020 2020 6578  rsString).    ex
-00011720: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-00011730: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00011740: 2253 7065 6369 6669 6564 2061 7574 686f  "Specified autho
-00011750: 7273 206c 6973 7420 7761 7320 6e6f 7420  rs list was not 
-00011760: 7661 6c69 6420 4a53 4f4e 2e22 2c20 3430  valid JSON.", 40
-00011770: 3029 0a0a 2020 2020 6966 2028 0a20 2020  0)..    if (.   
-00011780: 2020 2020 206e 6f74 2069 7369 6e73 7461       not isinsta
-00011790: 6e63 6528 6175 7468 6f72 732c 206c 6973  nce(authors, lis
-000117a0: 7429 0a20 2020 2020 6f72 2061 6e79 286e  t).     or any(n
-000117b0: 6f74 2069 7369 6e73 7461 6e63 6528 6175  ot isinstance(au
-000117c0: 7468 6f72 2c20 616e 7973 7472 2920 666f  thor, anystr) fo
-000117d0: 7220 6175 7468 6f72 2069 6e20 6175 7468  r author in auth
-000117e0: 6f72 7329 0a20 2020 2029 3a0a 2020 2020  ors).    ):.    
-000117f0: 2020 2020 7265 7475 726e 2028 2253 7065      return ("Spe
-00011800: 6369 6669 6564 2061 7574 686f 7273 206c  cified authors l
-00011810: 6973 7420 7761 7320 6e6f 7420 6120 6c69  ist was not a li
-00011820: 7374 206f 6620 7374 7269 6e67 732e 222c  st of strings.",
-00011830: 2034 3030 290a 0a20 2020 2023 2047 6574   400)..    # Get
-00011840: 206f 7574 636f 6d65 7320 6c69 7374 2c20   outcomes list, 
-00011850: 6465 636f 6465 2074 6865 204a 534f 4e2c  decode the JSON,
-00011860: 2061 6e64 2065 6e73 7572 6520 6974 2773   and ensure it's
-00011870: 2061 206c 6973 7420 6f66 0a20 2020 2023   a list of.    #
-00011880: 2033 2d65 6c65 6d65 6e74 206c 6973 7473   3-element lists
-00011890: 2065 6163 6820 636f 6e74 6169 6e69 6e67   each containing
-000118a0: 2061 2062 6f6f 6c65 616e 2061 6e64 2074   a boolean and t
-000118b0: 776f 2073 7472 696e 6773 2e0a 2020 2020  wo strings..    
-000118c0: 2320 416e 2065 6d70 7479 206c 6973 7420  # An empty list 
-000118d0: 6f66 206f 7574 636f 6d65 7320 6973 206e  of outcomes is n
-000118e0: 6f74 2061 6c6c 6f77 6564 2e0a 2020 2020  ot allowed..    
-000118f0: 6f75 7463 6f6d 6573 5374 7269 6e67 203d  outcomesString =
-00011900: 2066 6f72 6d2e 6765 7428 226f 7574 636f   form.get("outco
-00011910: 6d65 7322 2c20 2222 290a 2020 2020 6966  mes", "").    if
-00011920: 206f 7574 636f 6d65 7353 7472 696e 6720   outcomesString 
-00011930: 3d3d 2022 223a 0a20 2020 2020 2020 2072  == "":.        r
-00011940: 6574 7572 6e20 2822 4465 6c69 7665 7279  eturn ("Delivery
-00011950: 2064 6964 206e 6f74 2073 7065 6369 6679   did not specify
-00011960: 2061 6e79 206f 7574 636f 6d65 732e 222c   any outcomes.",
-00011970: 2034 3030 290a 0a20 2020 2074 7279 3a0a   400)..    try:.
-00011980: 2020 2020 2020 2020 6f75 7463 6f6d 6573          outcomes
-00011990: 203d 206a 736f 6e2e 6c6f 6164 7328 6f75   = json.loads(ou
-000119a0: 7463 6f6d 6573 5374 7269 6e67 290a 2020  tcomesString).  
-000119b0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-000119c0: 6f6e 3a0a 2020 2020 2020 2020 7265 7475  on:.        retu
-000119d0: 726e 2028 2253 7065 6369 6669 6564 206f  rn ("Specified o
-000119e0: 7574 636f 6d65 7320 6c69 7374 2077 6173  utcomes list was
-000119f0: 206e 6f74 2076 616c 6964 204a 534f 4e2e   not valid JSON.
-00011a00: 222c 2034 3030 290a 0a20 2020 2069 6620  ", 400)..    if 
-00011a10: 6e6f 7420 6973 696e 7374 616e 6365 286f  not isinstance(o
-00011a20: 7574 636f 6d65 732c 206c 6973 7429 3a0a  utcomes, list):.
-00011a30: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00011a40: 224f 7574 636f 6d65 7320 6f62 6a65 6374  "Outcomes object
-00011a50: 2077 6173 206e 6f74 2061 206c 6973 742e   was not a list.
-00011a60: 222c 2034 3030 290a 0a20 2020 2066 6f72  ", 400)..    for
-00011a70: 2069 2c20 6f75 7463 6f6d 6520 696e 2065   i, outcome in e
-00011a80: 6e75 6d65 7261 7465 286f 7574 636f 6d65  numerate(outcome
-00011a90: 7329 3a0a 2020 2020 2020 2020 6966 2028  s):.        if (
-00011aa0: 0a20 2020 2020 2020 2020 2020 206e 6f74  .            not
-00011ab0: 2069 7369 6e73 7461 6e63 6528 6f75 7463   isinstance(outc
-00011ac0: 6f6d 652c 206c 6973 7429 0a20 2020 2020  ome, list).     
-00011ad0: 2020 2020 6f72 206c 656e 286f 7574 636f      or len(outco
-00011ae0: 6d65 2920 213d 2033 0a20 2020 2020 2020  me) != 3.       
-00011af0: 2020 6f72 206e 6f74 2069 7369 6e73 7461    or not isinsta
-00011b00: 6e63 6528 6f75 7463 6f6d 655b 305d 2c20  nce(outcome[0], 
-00011b10: 626f 6f6c 290a 2020 2020 2020 2020 206f  bool).         o
-00011b20: 7220 6e6f 7420 6973 696e 7374 616e 6365  r not isinstance
-00011b30: 286f 7574 636f 6d65 5b31 5d2c 2061 6e79  (outcome[1], any
-00011b40: 7374 7229 0a20 2020 2020 2020 2020 6f72  str).         or
-00011b50: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00011b60: 6f75 7463 6f6d 655b 325d 2c20 616e 7973  outcome[2], anys
-00011b70: 7472 290a 2020 2020 2020 2020 293a 0a20  tr).        ):. 
-00011b80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00011b90: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-00011ba0: 2020 2020 224f 7574 636f 6d65 207b 7d20      "Outcome {} 
-00011bb0: 7761 7320 696e 7661 6c69 6420 2865 6163  was invalid (eac
-00011bc0: 6820 6f75 7463 6f6d 6520 6d75 7374 2062  h outcome must b
-00011bd0: 6520 6120 6c69 7374 220a 2020 2020 2020  e a list".      
-00011be0: 2020 2020 2020 2020 2020 2220 636f 6e74            " cont
-00011bf0: 6169 6e69 6e67 2061 2062 6f6f 6c65 616e  aining a boolean
-00011c00: 2061 6e64 2074 776f 2073 7472 696e 6773   and two strings
-00011c10: 292e 220a 2020 2020 2020 2020 2020 2020  ).".            
-00011c20: 292e 666f 726d 6174 2869 290a 0a20 2020  ).format(i)..   
-00011c30: 2023 2047 6574 2063 6f64 6520 626c 6f63   # Get code bloc
-00011c40: 6b73 2c20 6465 636f 6465 204a 534f 4e2c  ks, decode JSON,
-00011c50: 2061 6e64 2065 6e73 7572 6520 6974 2773   and ensure it's
-00011c60: 2061 206c 6973 7420 6f66 2070 6169 7273   a list of pairs
-00011c70: 206f 660a 2020 2020 2320 7374 7269 6e67   of.    # string
-00011c80: 732e 0a20 2020 2063 6f64 6553 7472 696e  s..    codeStrin
-00011c90: 6720 3d20 666f 726d 2e67 6574 2822 636f  g = form.get("co
-00011ca0: 6465 222c 2022 2229 0a20 2020 2069 6620  de", "").    if 
-00011cb0: 636f 6465 5374 7269 6e67 203d 3d20 2222  codeString == ""
-00011cc0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00011cd0: 2028 2244 656c 6976 6572 7920 6469 6420   ("Delivery did 
-00011ce0: 6e6f 7420 7370 6563 6966 7920 616e 7920  not specify any 
-00011cf0: 636f 6465 2e22 2c20 3430 3029 0a0a 2020  code.", 400)..  
-00011d00: 2020 7472 793a 0a20 2020 2020 2020 2063    try:.        c
-00011d10: 6f64 6542 6c6f 636b 7320 3d20 6a73 6f6e  odeBlocks = json
-00011d20: 2e6c 6f61 6473 2863 6f64 6553 7472 696e  .loads(codeStrin
-00011d30: 6729 0a20 2020 2065 7863 6570 7420 4578  g).    except Ex
-00011d40: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00011d50: 2072 6574 7572 6e20 2822 5370 6563 6966   return ("Specif
-00011d60: 6965 6420 636f 6465 206c 6973 7420 7761  ied code list wa
-00011d70: 7320 6e6f 7420 7661 6c69 6420 4a53 4f4e  s not valid JSON
-00011d80: 2e22 2c20 3430 3029 0a0a 2020 2020 6966  .", 400)..    if
-00011d90: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00011da0: 636f 6465 426c 6f63 6b73 2c20 6c69 7374  codeBlocks, list
-00011db0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00011dc0: 6e20 2822 436f 6465 206f 626a 6563 7420  n ("Code object 
-00011dd0: 7761 7320 6e6f 7420 6120 6c69 7374 2e22  was not a list."
-00011de0: 2c20 3430 3029 0a0a 2020 2020 666f 7220  , 400)..    for 
-00011df0: 692c 2062 6c6f 636b 2069 6e20 656e 756d  i, block in enum
-00011e00: 6572 6174 6528 636f 6465 426c 6f63 6b73  erate(codeBlocks
-00011e10: 293a 0a20 2020 2020 2020 2069 6620 280a  ):.        if (.
-00011e20: 2020 2020 2020 2020 2020 2020 6e6f 7420              not 
-00011e30: 6973 696e 7374 616e 6365 2862 6c6f 636b  isinstance(block
-00011e40: 2c20 6c69 7374 290a 2020 2020 2020 2020  , list).        
-00011e50: 206f 7220 6c65 6e28 626c 6f63 6b29 2021   or len(block) !
-00011e60: 3d20 320a 2020 2020 2020 2020 206f 7220  = 2.         or 
-00011e70: 6e6f 7420 616c 6c28 6973 696e 7374 616e  not all(isinstan
-00011e80: 6365 2870 6172 742c 2061 6e79 7374 7229  ce(part, anystr)
-00011e90: 2066 6f72 2070 6172 7420 696e 2062 6c6f   for part in blo
-00011ea0: 636b 290a 2020 2020 2020 2020 293a 0a20  ck).        ):. 
-00011eb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00011ec0: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-00011ed0: 2020 2020 2243 6f64 6520 626c 6f63 6b20      "Code block 
-00011ee0: 7b7d 2077 6173 2069 6e76 616c 6964 2028  {} was invalid (
-00011ef0: 6561 6368 2063 6f64 6520 626c 6f63 6b20  each code block 
-00011f00: 6d75 7374 2062 6520 6122 0a20 2020 2020  must be a".     
-00011f10: 2020 2020 2020 2020 2020 2022 206c 6973             " lis
-00011f20: 7420 636f 6e74 6169 6e69 6e67 2074 776f  t containing two
-00011f30: 2073 7472 696e 6773 292e 220a 2020 2020   strings).".    
-00011f40: 2020 2020 2020 2020 292e 666f 726d 6174          ).format
-00011f50: 2869 290a 0a20 2020 2023 2043 6865 636b  (i)..    # Check
-00011f60: 2061 7574 686f 7273 2061 6761 696e 7374   authors against
-00011f70: 2072 6f73 7465 720a 2020 2020 7472 793a   roster.    try:
-00011f80: 0a20 2020 2020 2020 2072 6f73 7465 7220  .        roster 
-00011f90: 3d20 7374 6f72 6167 652e 6765 745f 726f  = storage.get_ro
-00011fa0: 7374 6572 2863 6f75 7273 652c 2073 656d  ster(course, sem
-00011fb0: 6573 7465 7229 0a20 2020 2065 7863 6570  ester).    excep
-00011fc0: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
-00011fd0: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
-00011fe0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-00011ff0: 2020 2020 2020 2020 2020 2020 2243 6f75              "Cou
-00012000: 6c64 206e 6f74 2066 6574 6368 2072 6f73  ld not fetch ros
-00012010: 7465 7220 666f 7220 636f 7572 7365 207b  ter for course {
-00012020: 7d20 7b7d 2e22 0a20 2020 2020 2020 2020  } {}.".         
-00012030: 2020 2029 2e66 6f72 6d61 7428 636f 7572     ).format(cour
-00012040: 7365 2c20 7365 6d65 7374 6572 292c 0a20  se, semester),. 
-00012050: 2020 2020 2020 2020 2020 2034 3030 0a20             400. 
-00012060: 2020 2020 2020 2029 0a0a 2020 2020 6966         )..    if
-00012070: 2072 6f73 7465 7220 6973 204e 6f6e 653a   roster is None:
-00012080: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012090: 280a 2020 2020 2020 2020 2020 2020 280a  (.            (.
-000120a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120b0: 2254 6865 7265 2069 7320 6e6f 2072 6f73  "There is no ros
-000120c0: 7465 7220 666f 7220 636f 7572 7365 207b  ter for course {
-000120d0: 7d20 7b7d 2e22 0a20 2020 2020 2020 2020  } {}.".         
-000120e0: 2020 2029 2e66 6f72 6d61 7428 636f 7572     ).format(cour
-000120f0: 7365 2c20 7365 6d65 7374 6572 292c 0a20  se, semester),. 
-00012100: 2020 2020 2020 2020 2020 2034 3030 0a20             400. 
-00012110: 2020 2020 2020 2029 0a0a 2020 2020 666f         )..    fo
-00012120: 7220 6175 7468 6f72 2069 6e20 6175 7468  r author in auth
-00012130: 6f72 733a 0a20 2020 2020 2020 2069 6620  ors:.        if 
-00012140: 6175 7468 6f72 206e 6f74 2069 6e20 726f  author not in ro
-00012150: 7374 6572 3a0a 2020 2020 2020 2020 2020  ster:.          
-00012160: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-00012170: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
-00012180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012190: 2022 4175 7468 6f72 2027 7b7d 2720 6973   "Author '{}' is
-000121a0: 206e 6f74 206f 6e20 7468 6520 726f 7374   not on the rost
-000121b0: 6572 2066 6f72 207b 7d20 7b7d 2e20 596f  er for {} {}. Yo
-000121c0: 7522 0a20 2020 2020 2020 2020 2020 2020  u".             
-000121d0: 2020 2020 2020 2022 206d 7573 7420 7573         " must us
-000121e0: 6520 796f 7572 2075 7365 726e 616d 6520  e your username 
-000121f0: 7768 656e 2073 7065 6369 6679 696e 6720  when specifying 
-00012200: 616e 2061 7574 686f 722e 220a 2020 2020  an author.".    
-00012210: 2020 2020 2020 2020 2020 2020 292e 666f              ).fo
-00012220: 726d 6174 2861 7574 686f 722c 2063 6f75  rmat(author, cou
-00012230: 7273 652c 2073 656d 6573 7465 7229 2c0a  rse, semester),.
-00012240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012250: 3430 300a 2020 2020 2020 2020 2020 2020  400.            
-00012260: 290a 0a20 2020 2023 2047 6574 2065 7865  )..    # Get exe
-00012270: 7263 6973 6520 696e 666f 2073 6f20 7765  rcise info so we
-00012280: 2063 616e 2061 6374 7561 6c6c 7920 6669   can actually fi
-00012290: 6775 7265 206f 7574 2077 6861 7420 7468  gure out what th
-000122a0: 650a 2020 2020 2320 6576 616c 7561 7469  e.    # evaluati
-000122b0: 6f6e 2077 6f75 6c64 2062 6520 666f 7220  on would be for 
-000122c0: 7468 6573 6520 6f75 7463 6f6d 6573 2e0a  these outcomes..
-000122d0: 2020 2020 7461 736b 5f69 6e66 6f20 3d20      task_info = 
-000122e0: 7374 6f72 6167 652e 6765 745f 7461 736b  storage.get_task
-000122f0: 5f69 6e66 6f28 636f 7572 7365 2c20 7365  _info(course, se
-00012300: 6d65 7374 6572 290a 2020 2020 6966 2074  mester).    if t
-00012310: 6173 6b5f 696e 666f 2069 7320 4e6f 6e65  ask_info is None
-00012320: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00012330: 2028 0a20 2020 2020 2020 2020 2020 2022   (.            "
-00012340: 4661 696c 6564 2074 6f20 6c6f 6164 2074  Failed to load t
-00012350: 6173 6b73 2e6a 736f 6e20 666f 7220 7b7d  asks.json for {}
-00012360: 207b 7d2e 222e 666f 726d 6174 280a 2020   {}.".format(.  
-00012370: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00012380: 7572 7365 2c0a 2020 2020 2020 2020 2020  urse,.          
-00012390: 2020 2020 2020 7365 6d65 7374 6572 0a20        semester. 
-000123a0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-000123b0: 2020 2020 2020 2020 2020 3430 300a 2020            400.  
-000123c0: 2020 2020 2020 290a 0a20 2020 2065 696e        )..    ein
-000123d0: 666f 203d 204e 6f6e 650a 2020 2020 666f  fo = None.    fo
-000123e0: 7220 6772 6f75 7020 696e 2074 6173 6b5f  r group in task_
-000123f0: 696e 666f 2e67 6574 2822 6578 6572 6369  info.get("exerci
-00012400: 7365 7322 2c20 5b5d 293a 0a20 2020 2020  ses", []):.     
-00012410: 2020 2065 6c69 7374 203d 2067 726f 7570     elist = group
-00012420: 5b22 6578 6572 6369 7365 7322 5d0a 0a20  ["exercises"].. 
-00012430: 2020 2020 2020 2023 204d 616b 6520 616c         # Make al
-00012440: 6c6f 7761 6e63 6573 2066 6f72 206f 6c64  lowances for old
-00012450: 2066 6f72 6d61 740a 2020 2020 2020 2020   format.        
-00012460: 6966 2069 7369 6e73 7461 6e63 6528 656c  if isinstance(el
-00012470: 6973 742c 2064 6963 7429 3a0a 2020 2020  ist, dict):.    
-00012480: 2020 2020 2020 2020 666f 7220 6569 6420          for eid 
-00012490: 696e 2065 6c69 7374 3a0a 2020 2020 2020  in elist:.      
-000124a0: 2020 2020 2020 2020 2020 656c 6973 745b            elist[
-000124b0: 6569 645d 5b27 6964 275d 203d 2065 6964  eid]['id'] = eid
-000124c0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000124d0: 7374 203d 206c 6973 7428 656c 6973 742e  st = list(elist.
-000124e0: 7661 6c75 6573 2829 290a 0a20 2020 2020  values())..     
-000124f0: 2020 2066 6f72 2065 7820 696e 2065 6c69     for ex in eli
-00012500: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00012510: 6966 2065 7865 7263 6973 6520 3d3d 2065  if exercise == e
-00012520: 785b 2769 6427 5d3a 0a20 2020 2020 2020  x['id']:.       
-00012530: 2020 2020 2020 2020 2065 696e 666f 203d           einfo =
-00012540: 2065 780a 2020 2020 2020 2020 2020 2020   ex.            
-00012550: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-00012560: 2020 6966 2065 696e 666f 2069 7320 6e6f    if einfo is no
-00012570: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00012580: 2020 2020 6272 6561 6b0a 0a20 2020 2069      break..    i
-00012590: 6620 6569 6e66 6f20 6973 204e 6f6e 653a  f einfo is None:
-000125a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000125b0: 280a 2020 2020 2020 2020 2020 2020 2245  (.            "E
-000125c0: 7865 7263 6973 6520 277b 7d27 2069 7320  xercise '{}' is 
-000125d0: 6e6f 7420 6c69 7374 6564 2069 6e20 7b7d  not listed in {}
-000125e0: 207b 7d2e 222e 666f 726d 6174 280a 2020   {}.".format(.  
-000125f0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00012600: 6572 6369 7365 2c0a 2020 2020 2020 2020  ercise,.        
-00012610: 2020 2020 2020 2020 636f 7572 7365 2c0a          course,.
-00012620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012630: 7365 6d65 7374 6572 0a20 2020 2020 2020  semester.       
-00012640: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-00012650: 2020 2020 3430 300a 2020 2020 2020 2020      400.        
-00012660: 290a 0a20 2020 2073 7461 7475 732c 2065  )..    status, e
-00012670: 6372 6564 6974 2c20 5f20 3d20 6578 6572  credit, _ = exer
-00012680: 6369 7365 5f63 7265 6469 7428 6569 6e66  cise_credit(einf
-00012690: 6f2c 206f 7574 636f 6d65 7329 0a0a 2020  o, outcomes)..  
-000126a0: 2020 2320 5265 636f 7264 2074 6865 206f    # Record the o
-000126b0: 7574 636f 6d65 7320 6c69 7374 2066 6f72  utcomes list for
-000126c0: 2065 6163 6820 6175 7468 6f72 0a20 2020   each author.   
-000126d0: 2066 6f72 2061 7574 686f 7220 696e 2061   for author in a
-000126e0: 7574 686f 7273 3a0a 2020 2020 2020 2020  uthors:.        
-000126f0: 7374 6f72 6167 652e 7361 7665 5f6f 7574  storage.save_out
-00012700: 636f 6d65 7328 0a20 2020 2020 2020 2020  comes(.         
-00012710: 2020 2063 6f75 7273 652c 0a20 2020 2020     course,.     
-00012720: 2020 2020 2020 2073 656d 6573 7465 722c         semester,
-00012730: 0a20 2020 2020 2020 2020 2020 2061 7574  .            aut
-00012740: 686f 722c 0a20 2020 2020 2020 2020 2020  hor,.           
-00012750: 2065 7865 7263 6973 652c 0a20 2020 2020   exercise,.     
-00012760: 2020 2020 2020 2061 7574 686f 7273 2c0a         authors,.
-00012770: 2020 2020 2020 2020 2020 2020 6f75 7463              outc
-00012780: 6f6d 6573 2c0a 2020 2020 2020 2020 2020  omes,.          
-00012790: 2020 636f 6465 426c 6f63 6b73 2c0a 2020    codeBlocks,.  
-000127a0: 2020 2020 2020 2020 2020 7374 6174 7573            status
-000127b0: 2c0a 2020 2020 2020 2020 2020 2020 6563  ,.            ec
-000127c0: 7265 6469 740a 2020 2020 2020 2020 290a  redit.        ).
-000127d0: 0a20 2020 206d 6573 7361 6765 203d 2028  .    message = (
-000127e0: 0a20 2020 2020 2020 2022 5375 626d 6973  .        "Submis
-000127f0: 7369 6f6e 2061 6363 6570 7465 643a 207b  sion accepted: {
-00012800: 7d2f 7b7d 2063 6865 636b 7320 7061 7373  }/{} checks pass
-00012810: 6564 2061 6e64 2073 7461 7475 7320 6973  ed and status is
-00012820: 207b 7d2e 220a 2020 2020 292e 666f 726d   {}.".    ).form
-00012830: 6174 286c 656e 285b 7820 666f 7220 7820  at(len([x for x 
-00012840: 696e 206f 7574 636f 6d65 7320 6966 2078  in outcomes if x
-00012850: 5b30 5d5d 292c 206c 656e 286f 7574 636f  [0]]), len(outco
-00012860: 6d65 7329 2c20 7374 6174 7573 290a 2020  mes), status).  
-00012870: 2020 6966 2073 7461 7475 7320 213d 2022    if status != "
-00012880: 636f 6d70 6c65 7465 223a 0a20 2020 2020  complete":.     
-00012890: 2020 206d 6573 7361 6765 202b 3d20 225c     message += "\
-000128a0: 6e4e 6f74 653a 2074 6869 7320 7375 626d  nNote: this subm
-000128b0: 6973 7369 6f6e 2069 7320 4e4f 5420 636f  ission is NOT co
-000128c0: 6d70 6c65 7465 2e22 0a0a 2020 2020 7265  mplete."..    re
-000128d0: 7475 726e 206d 6573 7361 6765 0a0a 0a40  turn message...@
-000128e0: 6170 702e 726f 7574 6528 0a20 2020 2027  app.route(.    '
-000128f0: 2f3c 636f 7572 7365 3e2f 3c73 656d 6573  /<course>/<semes
-00012900: 7465 723e 2f65 7865 7263 6973 652f 3c74  ter>/exercise/<t
-00012910: 6172 6765 745f 7573 6572 3e2f 3c65 6964  arget_user>/<eid
-00012920: 3e27 2c0a 2020 2020 6d65 7468 6f64 733d  >',.    methods=
-00012930: 5b27 4745 5427 5d0a 290a 4066 6c61 736b  ['GET'].).@flask
-00012940: 5f63 6173 2e6c 6f67 696e 5f72 6571 7569  _cas.login_requi
-00012950: 7265 640a 4061 7567 6d65 6e74 5f61 7267  red.@augment_arg
-00012960: 756d 656e 7473 0a64 6566 2072 6f75 7465  uments.def route
-00012970: 5f65 7865 7263 6973 6528 0a20 2020 2063  _exercise(.    c
-00012980: 6f75 7273 652c 0a20 2020 2073 656d 6573  ourse,.    semes
-00012990: 7465 722c 0a20 2020 2074 6172 6765 745f  ter,.    target_
-000129a0: 7573 6572 2c0a 2020 2020 6569 642c 0a20  user,.    eid,. 
-000129b0: 2020 2023 2041 7567 6d65 6e74 6564 2061     # Augmented a
-000129c0: 7267 756d 656e 7473 0a20 2020 2075 7365  rguments.    use
-000129d0: 726e 616d 652c 0a20 2020 2069 735f 6164  rname,.    is_ad
-000129e0: 6d69 6e2c 0a20 2020 206d 6173 7175 6572  min,.    masquer
-000129f0: 6164 655f 6173 2c0a 2020 2020 6566 6665  ade_as,.    effe
-00012a00: 6374 6976 655f 7573 6572 2c0a 2020 2020  ctive_user,.    
-00012a10: 7461 736b 5f69 6e66 6f0a 293a 0a20 2020  task_info.):.   
-00012a20: 2023 2043 6865 636b 2076 6965 7720 7065   # Check view pe
-00012a30: 726d 6973 7369 6f6e 0a20 2020 2069 6620  rmission.    if 
-00012a40: 7461 7267 6574 5f75 7365 7220 213d 2065  target_user != e
-00012a50: 6666 6563 7469 7665 5f75 7365 7220 616e  ffective_user an
-00012a60: 6420 6e6f 7420 6973 5f61 646d 696e 3a0a  d not is_admin:.
-00012a70: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00012a80: 7272 6f72 5f72 6573 706f 6e73 6528 0a20  rror_response(. 
-00012a90: 2020 2020 2020 2020 2020 2063 6f75 7273             cours
-00012aa0: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-00012ab0: 656d 6573 7465 722c 0a20 2020 2020 2020  emester,.       
-00012ac0: 2020 2020 2075 7365 726e 616d 652c 0a20       username,. 
-00012ad0: 2020 2020 2020 2020 2020 2022 596f 7520             "You 
-00012ae0: 6172 6520 6e6f 7420 616c 6c6f 7765 6420  are not allowed 
-00012af0: 746f 2076 6965 7720 6578 6572 6369 7365  to view exercise
-00012b00: 7320 666f 7220 7b7d 2e22 2e66 6f72 6d61  s for {}.".forma
-00012b10: 7428 7461 7267 6574 5f75 7365 7229 0a20  t(target_user). 
-00012b20: 2020 2020 2020 2029 0a20 2020 2065 6c69         ).    eli
-00012b30: 6620 7461 7267 6574 5f75 7365 7220 213d  f target_user !=
-00012b40: 2065 6666 6563 7469 7665 5f75 7365 723a   effective_user:
-00012b50: 0a20 2020 2020 2020 2066 6c61 736b 2e66  .        flask.f
-00012b60: 6c61 7368 2822 5669 6577 696e 6720 6578  lash("Viewing ex
-00012b70: 6572 6369 7365 2066 6f72 207b 7d2e 222e  ercise for {}.".
-00012b80: 666f 726d 6174 2874 6172 6765 745f 7573  format(target_us
-00012b90: 6572 2929 0a0a 2020 2020 2320 4672 6f6d  er))..    # From
-00012ba0: 2068 6572 6520 6f6e 2077 6520 7472 6561   here on we trea
-00012bb0: 7420 7468 6520 6566 6665 6374 6976 6520  t the effective 
-00012bc0: 7573 6572 2061 7320 7468 6520 7461 7267  user as the targ
-00012bd0: 6574 2075 7365 720a 2020 2020 6566 6665  et user.    effe
-00012be0: 6374 6976 655f 7573 6572 203d 2074 6172  ctive_user = tar
-00012bf0: 6765 745f 7573 6572 0a0a 2020 2020 2320  get_user..    # 
-00012c00: 4368 6563 6b20 726f 7374 6572 2061 6e64  Check roster and
-00012c10: 2066 6c61 7368 2061 2077 6172 6e69 6e67   flash a warning
-00012c20: 2069 6620 7765 2772 6520 7669 6577 696e   if we're viewin
-00012c30: 6720 6665 6564 6261 636b 2066 6f72 2061  g feedback for a
-00012c40: 0a20 2020 2023 2075 7365 7220 7768 6f20  .    # user who 
-00012c50: 6973 206e 6f74 206f 6e20 7468 6520 726f  is not on the ro
-00012c60: 7374 6572 2e2e 2e0a 2020 2020 7472 793a  ster....    try:
-00012c70: 0a20 2020 2020 2020 2072 6f73 7465 7220  .        roster 
-00012c80: 3d20 7374 6f72 6167 652e 6765 745f 726f  = storage.get_ro
-00012c90: 7374 6572 2863 6f75 7273 652c 2073 656d  ster(course, sem
-00012ca0: 6573 7465 7229 0a20 2020 2065 7863 6570  ester).    excep
-00012cb0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00012cc0: 3a0a 2020 2020 2020 2020 666c 6173 6b2e  :.        flask.
-00012cd0: 666c 6173 6828 7374 7228 6529 290a 2020  flash(str(e)).  
-00012ce0: 2020 2020 2020 726f 7374 6572 203d 204e        roster = N
-00012cf0: 6f6e 650a 0a20 2020 2069 6620 726f 7374  one..    if rost
-00012d00: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-00012d10: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
-00012d20: 0a20 2020 2020 2020 2020 2020 2022 5761  .            "Wa
-00012d30: 726e 696e 673a 2063 6f75 6c64 206e 6f74  rning: could not
-00012d40: 2066 6574 6368 2072 6f73 7465 7220 746f   fetch roster to
-00012d50: 2063 6865 636b 2069 6620 7468 6973 2075   check if this u
-00012d60: 7365 7220 6973 206f 6e22 0a20 2020 2020  ser is on".     
-00012d70: 2020 2020 2020 2022 2069 742e 220a 2020         " it.".  
-00012d80: 2020 2020 2020 290a 2020 2020 656c 6966        ).    elif
-00012d90: 2065 6666 6563 7469 7665 5f75 7365 7220   effective_user 
-00012da0: 6e6f 7420 696e 2072 6f73 7465 723a 0a20  not in roster:. 
-00012db0: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
-00012dc0: 7368 2822 5761 726e 696e 673a 2074 6869  sh("Warning: thi
-00012dd0: 7320 7573 6572 2069 7320 6e6f 7420 6f6e  s user is not on
-00012de0: 2074 6865 2072 6f73 7465 7221 2229 0a0a   the roster!")..
-00012df0: 2020 2020 2320 4765 7420 6578 6572 6369      # Get exerci
-00012e00: 7365 2069 6e66 6f3a 0a20 2020 2065 696e  se info:.    ein
-00012e10: 666f 203d 204e 6f6e 650a 2020 2020 6769  fo = None.    gi
-00012e20: 6e66 6f20 3d20 4e6f 6e65 0a20 2020 2066  nfo = None.    f
-00012e30: 6f72 2067 726f 7570 2069 6e20 7461 736b  or group in task
-00012e40: 5f69 6e66 6f2e 6765 7428 2265 7865 7263  _info.get("exerc
-00012e50: 6973 6573 222c 205b 5d29 3a0a 2020 2020  ises", []):.    
-00012e60: 2020 2020 656c 6973 7420 3d20 6772 6f75      elist = grou
-00012e70: 705b 2265 7865 7263 6973 6573 225d 0a0a  p["exercises"]..
-00012e80: 2020 2020 2020 2020 2320 4d61 6b65 2061          # Make a
-00012e90: 6c6c 6f77 616e 6365 7320 666f 7220 6f6c  llowances for ol
-00012ea0: 6420 666f 726d 6174 0a20 2020 2020 2020  d format.       
-00012eb0: 2069 6620 6973 696e 7374 616e 6365 2865   if isinstance(e
-00012ec0: 6c69 7374 2c20 6469 6374 293a 0a20 2020  list, dict):.   
-00012ed0: 2020 2020 2020 2020 2066 6f72 2065 6964           for eid
-00012ee0: 2069 6e20 656c 6973 743a 0a20 2020 2020   in elist:.     
-00012ef0: 2020 2020 2020 2020 2020 2065 6c69 7374             elist
-00012f00: 5b65 6964 5d5b 2769 6427 5d20 3d20 6569  [eid]['id'] = ei
-00012f10: 640a 2020 2020 2020 2020 2020 2020 656c  d.            el
-00012f20: 6973 7420 3d20 6c69 7374 2865 6c69 7374  ist = list(elist
-00012f30: 2e76 616c 7565 7328 2929 0a0a 2020 2020  .values())..    
-00012f40: 2020 2020 666f 7220 6578 2069 6e20 656c      for ex in el
-00012f50: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-00012f60: 2069 6620 6569 6420 3d3d 2065 785b 2769   if eid == ex['i
-00012f70: 6427 5d3a 0a20 2020 2020 2020 2020 2020  d']:.           
-00012f80: 2020 2020 2067 696e 666f 203d 2067 726f       ginfo = gro
-00012f90: 7570 0a20 2020 2020 2020 2020 2020 2020  up.             
-00012fa0: 2020 2065 696e 666f 203d 2065 780a 2020     einfo = ex.  
-00012fb0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00012fc0: 6561 6b0a 2020 2020 2020 2020 6966 2065  eak.        if e
-00012fd0: 696e 666f 2069 7320 6e6f 7420 4e6f 6e65  info is not None
-00012fe0: 3a0a 2020 2020 2020 2020 2020 2020 6272  :.            br
-00012ff0: 6561 6b0a 0a20 2020 2023 2047 6574 206f  eak..    # Get o
-00013000: 7574 636f 6d65 2069 6e66 6f20 666f 7220  utcome info for 
-00013010: 7468 6973 2065 7865 7263 6973 650a 2020  this exercise.  
-00013020: 2020 6f75 7463 6f6d 6573 203d 2073 746f    outcomes = sto
-00013030: 7261 6765 2e66 6574 6368 5f62 6573 745f  rage.fetch_best_
-00013040: 6f75 7463 6f6d 6573 2863 6f75 7273 652c  outcomes(course,
-00013050: 2073 656d 6573 7465 722c 2075 7365 726e   semester, usern
-00013060: 616d 6529 0a20 2020 2072 6573 756c 7473  ame).    results
-00013070: 203d 206f 7574 636f 6d65 732e 6765 7428   = outcomes.get(
-00013080: 0a20 2020 2020 2020 2065 6964 2c0a 2020  .        eid,.  
-00013090: 2020 2020 2020 7b20 2023 2064 6566 6175        {  # defau
-000130a0: 6c74 2077 6865 6e20 6578 6572 6369 7365  lt when exercise
-000130b0: 2068 6173 6e27 7420 6265 656e 2073 7562   hasn't been sub
-000130c0: 6d69 7474 6564 0a20 2020 2020 2020 2020  mitted.         
-000130d0: 2020 2022 7375 626d 6974 7465 645f 6174     "submitted_at
-000130e0: 223a 204e 6f6e 652c 0a20 2020 2020 2020  ": None,.       
-000130f0: 2020 2020 2022 6175 7468 6f72 7322 3a20       "authors": 
-00013100: 5b5d 2c0a 2020 2020 2020 2020 2020 2020  [],.            
-00013110: 226f 7574 636f 6d65 7322 3a20 5b5d 2c0a  "outcomes": [],.
-00013120: 2020 2020 2020 2020 2020 2020 2263 6f64              "cod
-00013130: 6522 3a20 5b5d 2c0a 2020 2020 2020 2020  e": [],.        
-00013140: 2020 2020 2273 7461 7475 7322 3a20 2275      "status": "u
-00013150: 6e73 7562 6d69 7474 6564 222c 0a20 2020  nsubmitted",.   
-00013160: 2020 2020 2020 2020 2022 6372 6564 6974           "credit
-00013170: 223a 204e 6f6e 650a 2020 2020 2020 2020  ": None.        
-00013180: 7d0a 2020 2020 290a 0a20 2020 2072 6574  }.    )..    ret
-00013190: 7572 6e20 666c 6173 6b2e 7265 6e64 6572  urn flask.render
-000131a0: 5f74 656d 706c 6174 6528 0a20 2020 2020  _template(.     
-000131b0: 2020 2027 6578 6572 6369 7365 2e6a 3227     'exercise.j2'
-000131c0: 2c0a 2020 2020 2020 2020 636f 7572 7365  ,.        course
-000131d0: 5f6e 616d 653d 6170 702e 636f 6e66 6967  _name=app.config
-000131e0: 2e67 6574 2822 434f 5552 5345 5f4e 414d  .get("COURSE_NAM
-000131f0: 4553 222c 207b 7d29 2e67 6574 2863 6f75  ES", {}).get(cou
-00013200: 7273 652c 2063 6f75 7273 6529 2c0a 2020  rse, course),.  
-00013210: 2020 2020 2020 636f 7572 7365 3d63 6f75        course=cou
-00013220: 7273 652c 0a20 2020 2020 2020 2073 656d  rse,.        sem
-00013230: 6573 7465 723d 7365 6d65 7374 6572 2c0a  ester=semester,.
-00013240: 2020 2020 2020 2020 7573 6572 6e61 6d65          username
-00013250: 3d75 7365 726e 616d 652c 0a20 2020 2020  =username,.     
-00013260: 2020 2069 735f 6164 6d69 6e3d 6973 5f61     is_admin=is_a
-00013270: 646d 696e 2c0a 2020 2020 2020 2020 6d61  dmin,.        ma
-00013280: 7371 7565 7261 6465 5f61 733d 6d61 7371  squerade_as=masq
-00013290: 7565 7261 6465 5f61 732c 0a20 2020 2020  uerade_as,.     
-000132a0: 2020 2074 6172 6765 745f 7573 6572 3d74     target_user=t
-000132b0: 6172 6765 745f 7573 6572 2c0a 2020 2020  arget_user,.    
-000132c0: 2020 2020 7461 736b 5f69 6e66 6f3d 7461      task_info=ta
-000132d0: 736b 5f69 6e66 6f2c 0a20 2020 2020 2020  sk_info,.       
-000132e0: 2065 6964 3d65 6964 2c0a 2020 2020 2020   eid=eid,.      
-000132f0: 2020 6769 6e66 6f3d 6769 6e66 6f2c 0a20    ginfo=ginfo,. 
-00013300: 2020 2020 2020 2065 696e 666f 3d65 696e         einfo=ein
-00013310: 666f 2c0a 2020 2020 2020 2020 7265 7375  fo,.        resu
-00013320: 6c74 733d 7265 7375 6c74 730a 2020 2020  lts=results.    
-00013330: 290a 0a0a 232d 2d2d 2d2d 2d2d 2d2d 230a  )...#---------#.
-00013340: 2320 4865 6c70 6572 7320 230a 232d 2d2d  # Helpers #.#---
-00013350: 2d2d 2d2d 2d2d 230a 0a64 6566 2065 7272  ------#..def err
-00013360: 6f72 5f72 6573 706f 6e73 6528 636f 7572  or_response(cour
-00013370: 7365 2c20 7365 6d65 7374 6572 2c20 7573  se, semester, us
-00013380: 6572 6e61 6d65 2c20 6361 7573 6529 3a0a  ername, cause):.
-00013390: 2020 2020 2222 220a 2020 2020 5368 6f72      """.    Shor
-000133a0: 7463 7574 2066 6f72 2064 6973 706c 6179  tcut for display
-000133b0: 696e 6720 6d61 6a6f 7220 6572 726f 7273  ing major errors
-000133c0: 2074 6f20 7468 6520 7573 6572 7320 736f   to the users so
-000133d0: 2074 6861 7420 7468 6579 2063 616e 0a20   that they can. 
-000133e0: 2020 2062 7567 2074 6865 2073 7570 706f     bug the suppo
-000133f0: 7274 206c 696e 6520 696e 7374 6561 6420  rt line instead 
-00013400: 6f66 206a 7573 7420 6765 7474 696e 6720  of just getting 
-00013410: 6120 7075 7265 2034 3034 2e0a 2020 2020  a pure 404..    
-00013420: 2222 220a 2020 2020 7265 7475 726e 2066  """.    return f
-00013430: 6c61 736b 2e72 656e 6465 725f 7465 6d70  lask.render_temp
-00013440: 6c61 7465 280a 2020 2020 2020 2020 2765  late(.        'e
-00013450: 7272 6f72 2e6a 3227 2c0a 2020 2020 2020  rror.j2',.      
-00013460: 2020 636f 7572 7365 5f6e 616d 653d 6170    course_name=ap
-00013470: 702e 636f 6e66 6967 2e67 6574 2822 434f  p.config.get("CO
-00013480: 5552 5345 5f4e 414d 4553 222c 207b 7d29  URSE_NAMES", {})
-00013490: 2e67 6574 2863 6f75 7273 652c 2063 6f75  .get(course, cou
-000134a0: 7273 6529 2c0a 2020 2020 2020 2020 636f  rse),.        co
-000134b0: 7572 7365 3d63 6f75 7273 652c 0a20 2020  urse=course,.   
-000134c0: 2020 2020 2073 656d 6573 7465 723d 7365       semester=se
-000134d0: 6d65 7374 6572 2c0a 2020 2020 2020 2020  mester,.        
-000134e0: 7573 6572 6e61 6d65 3d75 7365 726e 616d  username=usernam
-000134f0: 652c 0a20 2020 2020 2020 2061 6e6e 6f75  e,.        annou
-00013500: 6e63 656d 656e 7473 3d22 222c 0a20 2020  ncements="",.   
-00013510: 2020 2020 2073 7570 706f 7274 5f6c 696e       support_lin
-00013520: 6b3d 6170 702e 636f 6e66 6967 5b22 5355  k=app.config["SU
-00013530: 5050 4f52 545f 4c49 4e4b 225d 2c0a 2020  PPORT_LINK"],.  
-00013540: 2020 2020 2020 6572 726f 723d 6361 7573        error=caus
-00013550: 652c 0a20 2020 2020 2020 2074 6173 6b5f  e,.        task_
-00013560: 696e 666f 3d7b 7d0a 2020 2020 290a 0a0a  info={}.    )...
-00013570: 6465 6620 6765 745f 7073 5f6f 626a 2874  def get_ps_obj(t
-00013580: 6173 6b5f 696e 666f 2c20 7073 6964 293a  ask_info, psid):
-00013590: 0a20 2020 2022 2222 0a20 2020 2047 6574  .    """.    Get
-000135a0: 7320 7468 6520 7073 6574 206f 626a 6563  s the pset objec
-000135b0: 7420 7769 7468 2074 6865 2067 6976 656e  t with the given
-000135c0: 2049 442e 2052 6169 7365 7320 6120 5661   ID. Raises a Va
-000135d0: 6c75 6545 7272 6f72 2069 6620 7468 6572  lueError if ther
-000135e0: 650a 2020 2020 6973 206e 6f20 7375 6368  e.    is no such
-000135f0: 2070 7365 7420 6f62 6a65 6374 2c20 6f72   pset object, or
-00013600: 2069 6620 7468 6572 6520 6172 6520 6d75   if there are mu
-00013610: 6c74 6970 6c65 206d 6174 6368 6573 2e0a  ltiple matches..
-00013620: 2020 2020 2222 220a 2020 2020 7073 6d61      """.    psma
-00013630: 7463 6865 7320 3d20 5b70 7320 666f 7220  tches = [ps for 
-00013640: 7073 2069 6e20 7461 736b 5f69 6e66 6f5b  ps in task_info[
-00013650: 2270 7365 7473 225d 2069 6620 7073 5b22  "psets"] if ps["
-00013660: 6964 225d 203d 3d20 7073 6964 5d0a 2020  id"] == psid].  
-00013670: 2020 6966 206c 656e 2870 736d 6174 6368    if len(psmatch
-00013680: 6573 2920 3d3d 2030 3a0a 2020 2020 2020  es) == 0:.      
-00013690: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000136a0: 6f72 2822 556e 6b6e 6f77 6e20 7072 6f62  or("Unknown prob
-000136b0: 6c65 6d20 7365 7420 277b 7d27 222e 666f  lem set '{}'".fo
-000136c0: 726d 6174 2870 7369 6429 290a 2020 2020  rmat(psid)).    
-000136d0: 656c 6966 206c 656e 2870 736d 6174 6368  elif len(psmatch
-000136e0: 6573 2920 3e20 313a 0a20 2020 2020 2020  es) > 1:.       
-000136f0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00013700: 7228 224d 756c 7469 706c 6520 7072 6f62  r("Multiple prob
-00013710: 6c65 6d20 7365 7473 2077 6974 6820 4944  lem sets with ID
-00013720: 2027 7b7d 2721 222e 666f 726d 6174 2870   '{}'!".format(p
-00013730: 7369 6429 290a 2020 2020 656c 7365 3a0a  sid)).    else:.
-00013740: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00013750: 736d 6174 6368 6573 5b30 5d0a 0a0a 6465  smatches[0]...de
-00013760: 6620 6765 745f 7461 736b 5f6f 626a 2874  f get_task_obj(t
-00013770: 6173 6b5f 696e 666f 2c20 7073 5f6f 626a  ask_info, ps_obj
-00013780: 2c20 7461 736b 6964 2c20 7265 6469 7265  , taskid, redire
-00013790: 6374 3d45 7863 6570 7469 6f6e 293a 0a20  ct=Exception):. 
-000137a0: 2020 2022 2222 0a20 2020 2045 7874 7261     """.    Extra
-000137b0: 6374 7320 6120 7461 736b 206f 626a 6563  cts a task objec
-000137c0: 7420 7769 7468 2074 6865 2067 6976 656e  t with the given
-000137d0: 2049 4420 6672 6f6d 2074 6865 2067 6976   ID from the giv
-000137e0: 656e 2074 6173 6b20 696e 666f 2061 6e64  en task info and
-000137f0: 0a20 2020 2070 7365 7420 6f62 6a65 6374  .    pset object
-00013800: 732c 206d 6572 6769 6e67 2070 7365 742d  s, merging pset-
-00013810: 7370 6563 6966 6963 2066 6965 6c64 7320  specific fields 
-00013820: 7769 7468 2075 6e69 7665 7273 616c 2074  with universal t
-00013830: 6173 6b0a 2020 2020 6669 656c 6473 2e20  ask.    fields. 
-00013840: 5261 6973 6573 2061 2056 616c 7565 4572  Raises a ValueEr
-00013850: 726f 7220 6966 2074 6865 7265 2069 7320  ror if there is 
-00013860: 6e6f 206d 6174 6368 696e 6720 7461 736b  no matching task
-00013870: 206f 626a 6563 7420 6f72 2069 660a 2020   object or if.  
-00013880: 2020 7468 6572 6520 6172 6520 6d75 6c74    there are mult
-00013890: 6970 6c65 206d 6174 6368 6573 2e0a 2020  iple matches..  
-000138a0: 2020 2222 220a 2020 2020 756e 6976 6572    """.    univer
-000138b0: 7361 6c20 3d20 7461 736b 5f69 6e66 6f5b  sal = task_info[
-000138c0: 2274 6173 6b73 225d 2e67 6574 2874 6173  "tasks"].get(tas
-000138d0: 6b69 642c 204e 6f6e 6529 0a20 2020 2074  kid, None).    t
-000138e0: 6173 6b6d 6174 6368 6573 203d 205b 7461  askmatches = [ta
-000138f0: 736b 2066 6f72 2074 6173 6b20 696e 2070  sk for task in p
-00013900: 735f 6f62 6a5b 2274 6173 6b73 225d 2069  s_obj["tasks"] i
-00013910: 6620 7461 736b 5b22 6964 225d 203d 3d20  f task["id"] == 
-00013920: 7461 736b 6964 5d0a 2020 2020 6966 206c  taskid].    if l
-00013930: 656e 2874 6173 6b6d 6174 6368 6573 2920  en(taskmatches) 
-00013940: 3d3d 2030 3a0a 2020 2020 2020 2020 7261  == 0:.        ra
-00013950: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-00013960: 2020 2020 2020 2020 2020 2020 2250 726f              "Pro
-00013970: 626c 656d 2073 6574 207b 7d20 6861 7320  blem set {} has 
-00013980: 6e6f 2074 6173 6b20 277b 7d27 222e 666f  no task '{}'".fo
-00013990: 726d 6174 2870 735f 6f62 6a5b 2269 6422  rmat(ps_obj["id"
-000139a0: 5d2c 2074 6173 6b69 6429 0a20 2020 2020  ], taskid).     
-000139b0: 2020 2029 0a20 2020 2065 6c69 6620 756e     ).    elif un
-000139c0: 6976 6572 7361 6c20 6973 204e 6f6e 653a  iversal is None:
-000139d0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-000139e0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-000139f0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
-00013a00: 2020 2020 2020 2020 2022 5072 6f62 6c65           "Proble
-00013a10: 6d20 7365 7420 7b7d 2068 6173 2061 2074  m set {} has a t
-00013a20: 6173 6b20 277b 7d27 2062 7574 2074 6861  ask '{}' but tha
-00013a30: 7420 7461 736b 2068 6173 206e 6f22 0a20  t task has no". 
-00013a40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00013a50: 2075 6e69 7665 7273 616c 2073 7065 6369   universal speci
-00013a60: 6669 6361 7469 6f6e 2e22 0a20 2020 2020  fication.".     
-00013a70: 2020 2020 2020 2029 2e66 6f72 6d61 7428         ).format(
-00013a80: 7073 5f6f 626a 5b22 6964 225d 2c20 7461  ps_obj["id"], ta
-00013a90: 736b 6964 290a 2020 2020 2020 2020 290a  skid).        ).
-00013aa0: 2020 2020 656c 6966 206c 656e 2874 6173      elif len(tas
-00013ab0: 6b6d 6174 6368 6573 2920 3e20 313a 0a20  kmatches) > 1:. 
-00013ac0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00013ad0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00013ae0: 2020 2020 2022 4d75 6c74 6970 6c65 2074       "Multiple t
-00013af0: 6173 6b73 2069 6e20 7072 6f62 6c65 6d20  asks in problem 
-00013b00: 7365 7420 7b7d 2077 6974 6820 4944 2027  set {} with ID '
-00013b10: 7b7d 2721 222e 666f 726d 6174 280a 2020  {}'!".format(.  
-00013b20: 2020 2020 2020 2020 2020 2020 2020 7073                ps
-00013b30: 5f6f 626a 5b22 6964 225d 2c0a 2020 2020  _obj["id"],.    
-00013b40: 2020 2020 2020 2020 2020 2020 7461 736b              task
-00013b50: 6964 0a20 2020 2020 2020 2020 2020 2029  id.            )
-00013b60: 0a20 2020 2020 2020 2029 0a20 2020 2065  .        ).    e
-00013b70: 6c73 653a 0a20 2020 2020 2020 2072 6573  lse:.        res
-00013b80: 756c 7420 3d20 7b7d 0a20 2020 2020 2020  ult = {}.       
-00013b90: 2072 6573 756c 742e 7570 6461 7465 2875   result.update(u
-00013ba0: 6e69 7665 7273 616c 290a 2020 2020 2020  niversal).      
-00013bb0: 2020 7265 7375 6c74 2e75 7064 6174 6528    result.update(
-00013bc0: 7461 736b 6d61 7463 6865 735b 305d 290a  taskmatches[0]).
-00013bd0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00013be0: 6573 756c 740a 0a0a 6465 6620 6368 6563  esult...def chec
-00013bf0: 6b5f 7573 6572 5f70 7269 7669 6c65 6765  k_user_privilege
-00013c00: 7328 6164 6d69 6e5f 696e 666f 2c20 7573  s(admin_info, us
-00013c10: 6572 6e61 6d65 293a 0a20 2020 2022 2222  ername):.    """
-00013c20: 0a20 2020 2052 6574 7572 6e73 2061 2070  .    Returns a p
-00013c30: 6169 7220 636f 6e74 6169 6e69 6e67 2061  air containing a
-00013c40: 2062 6f6f 6c65 616e 2069 6e64 6963 6174   boolean indicat
-00013c50: 696e 6720 7768 6574 6865 7220 6120 7573  ing whether a us
-00013c60: 6572 2069 7320 616e 0a20 2020 2061 646d  er is an.    adm
-00013c70: 696e 206f 7220 6e6f 742c 2061 6e64 2065  in or not, and e
-00013c80: 6974 6865 7220 4e6f 6e65 2c20 6f72 2061  ither None, or a
-00013c90: 2073 7472 696e 6720 696e 6469 6361 7469   string indicati
-00013ca0: 6e67 2074 6865 2075 7365 726e 616d 650a  ng the username.
-00013cb0: 2020 2020 7468 6174 2074 6865 2067 6976      that the giv
-00013cc0: 656e 2075 7365 7220 6973 206d 6173 7175  en user is masqu
-00013cd0: 6572 6164 696e 6720 6173 2e0a 0a20 2020  erading as...   
-00013ce0: 2052 6571 7569 7265 7320 6164 6d69 6e20   Requires admin 
-00013cf0: 696e 666f 2061 7320 7265 7475 726e 6564  info as returned
-00013d00: 2062 7920 6765 745f 6164 6d69 6e5f 696e   by get_admin_in
-00013d10: 666f 2e0a 2020 2020 2222 220a 2020 2020  fo..    """.    
-00013d20: 6164 6d69 6e73 203d 2061 646d 696e 5f69  admins = admin_i
-00013d30: 6e66 6f2e 6765 7428 2261 646d 696e 7322  nfo.get("admins"
-00013d40: 2c20 5b5d 290a 2020 2020 6973 5f61 646d  , []).    is_adm
-00013d50: 696e 203d 2075 7365 726e 616d 6520 696e  in = username in
-00013d60: 2061 646d 696e 730a 0a20 2020 206d 6173   admins..    mas
-00013d70: 7175 6572 6164 655f 6173 203d 204e 6f6e  querade_as = Non
-00013d80: 650a 2020 2020 2320 4f6e 6c79 2061 646d  e.    # Only adm
-00013d90: 696e 7320 6361 6e20 706f 7373 6962 6c79  ins can possibly
-00013da0: 206d 6173 7175 6572 6164 650a 2020 2020   masquerade.    
-00013db0: 6966 2069 735f 6164 6d69 6e3a 0a20 2020  if is_admin:.   
-00013dc0: 2020 2020 206d 6173 7175 6572 6164 655f       masquerade_
-00013dd0: 6173 203d 2061 646d 696e 5f69 6e66 6f2e  as = admin_info.
-00013de0: 6765 7428 224d 4153 5155 4552 4144 4522  get("MASQUERADE"
-00013df0: 2c20 7b7d 292e 6765 7428 7573 6572 6e61  , {}).get(userna
-00013e00: 6d65 290a 2020 2020 2020 2020 2320 596f  me).        # Yo
-00013e10: 7520 6361 6e6e 6f74 206d 6173 7175 6572  u cannot masquer
-00013e20: 6164 6520 6173 2061 6e20 6164 6d69 6e0a  ade as an admin.
-00013e30: 2020 2020 2020 2020 6966 206d 6173 7175          if masqu
-00013e40: 6572 6164 655f 6173 2069 6e20 6164 6d69  erade_as in admi
-00013e50: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-00013e60: 666c 6173 6b2e 666c 6173 6828 2245 7272  flask.flash("Err
-00013e70: 6f72 3a20 596f 7520 6361 6e6e 6f74 206d  or: You cannot m
-00013e80: 6173 7175 6572 6164 6520 6173 2061 6e6f  asquerade as ano
-00013e90: 7468 6572 2061 646d 696e 2122 290a 2020  ther admin!").  
-00013ea0: 2020 2020 2020 2020 2020 6d61 7371 7565            masque
-00013eb0: 7261 6465 5f61 7320 3d20 4e6f 6e65 0a20  rade_as = None. 
-00013ec0: 2020 2065 6c69 6620 6164 6d69 6e5f 696e     elif admin_in
-00013ed0: 666f 2e67 6574 2822 4d41 5351 5545 5241  fo.get("MASQUERA
-00013ee0: 4445 222c 207b 7d29 2e67 6574 2875 7365  DE", {}).get(use
-00013ef0: 726e 616d 6529 3a0a 2020 2020 2020 2020  rname):.        
-00013f00: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00013f10: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
-00013f20: 2020 2020 2022 5761 726e 696e 673a 2055       "Warning: U
-00013f30: 7365 7220 277b 7d27 2063 616e 6e6f 7420  ser '{}' cannot 
-00013f40: 6d61 7371 7565 7261 6465 2062 6563 6175  masquerade becau
-00013f50: 7365 2074 6865 7920 6172 6522 0a20 2020  se they are".   
-00013f60: 2020 2020 2020 2020 2020 202b 2022 6e6f             + "no
-00013f70: 7420 616e 2061 646d 696e 2e22 0a20 2020  t an admin.".   
-00013f80: 2020 2020 2020 2020 2029 2e66 6f72 6d61           ).forma
-00013f90: 7428 7573 6572 6e61 6d65 290a 2020 2020  t(username).    
-00013fa0: 2020 2020 290a 0a20 2020 2072 6574 7572      )..    retur
-00013fb0: 6e20 2869 735f 6164 6d69 6e2c 206d 6173  n (is_admin, mas
-00013fc0: 7175 6572 6164 655f 6173 290a 0a0a 6465  querade_as)...de
-00013fd0: 6620 7365 745f 7061 7573 655f 7469 6d65  f set_pause_time
-00013fe0: 2861 646d 696e 5f69 6e66 6f2c 2074 6173  (admin_info, tas
-00013ff0: 6b5f 696e 666f 2c20 7573 6572 6e61 6d65  k_info, username
-00014000: 2c20 6d61 7371 7565 7261 6465 5f61 733d  , masquerade_as=
-00014010: 4e6f 6e65 293a 0a20 2020 2022 2222 0a20  None):.    """. 
-00014020: 2020 2053 6574 7320 7468 6520 5041 5553     Sets the PAUS
-00014030: 455f 4154 2076 616c 7565 2069 6e20 7468  E_AT value in th
-00014040: 6520 6769 7665 6e20 7461 736b 5f69 6e66  e given task_inf
-00014050: 6f20 6f62 6a65 6374 2062 6173 6564 206f  o object based o
-00014060: 6e20 616e 790a 2020 2020 5041 5553 455f  n any.    PAUSE_
-00014070: 5553 4552 5320 656e 7472 6965 7320 666f  USERS entries fo
-00014080: 7220 6569 7468 6572 2074 6865 2067 6976  r either the giv
-00014090: 656e 2074 7275 6520 7573 6572 6e61 6d65  en true username
-000140a0: 206f 7220 7468 6520 6769 7665 6e0a 2020   or the given.  
-000140b0: 2020 6d61 7371 7565 7261 6465 2075 7365    masquerade use
-000140c0: 726e 616d 652e 2054 6865 2070 6175 7365  rname. The pause
-000140d0: 2076 616c 7565 2066 6f72 2074 6865 2075   value for the u
-000140e0: 7365 726e 616d 6520 6f76 6572 7269 6465  sername override
-000140f0: 7320 7468 650a 2020 2020 7661 6c75 6520  s the.    value 
-00014100: 666f 7220 7468 6520 6d61 7371 7565 7261  for the masquera
-00014110: 6465 6420 7573 6572 2c20 736f 2074 6861  ded user, so tha
-00014120: 7420 6279 2073 6574 7469 6e67 2050 4155  t by setting PAU
-00014130: 5345 5f41 5420 666f 7220 616e 0a20 2020  SE_AT for an.   
-00014140: 2061 646d 696e 2061 6363 6f75 6e74 2070   admin account p
-00014150: 6c75 7320 6372 6561 7469 6e67 2061 206d  lus creating a m
-00014160: 6173 7175 6572 6164 6520 656e 7472 792c  asquerade entry,
-00014170: 2079 6f75 2063 616e 2061 6374 2061 7320   you can act as 
-00014180: 616e 790a 2020 2020 7573 6572 2061 7420  any.    user at 
-00014190: 616e 7920 706f 696e 7420 696e 2074 696d  any point in tim
-000141a0: 652e 0a20 2020 2022 2222 0a20 2020 2070  e..    """.    p
-000141b0: 7520 3d20 6164 6d69 6e5f 696e 666f 2e67  u = admin_info.g
-000141c0: 6574 2822 5041 5553 455f 5553 4552 5322  et("PAUSE_USERS"
-000141d0: 2c20 7b7d 290a 2020 2020 6966 2075 7365  , {}).    if use
-000141e0: 726e 616d 6520 696e 2070 753a 0a20 2020  rname in pu:.   
-000141f0: 2020 2020 2074 6173 6b5f 696e 666f 5b22       task_info["
-00014200: 5041 5553 455f 4154 225d 203d 2070 755b  PAUSE_AT"] = pu[
-00014210: 7573 6572 6e61 6d65 5d0a 2020 2020 656c  username].    el
-00014220: 6966 206d 6173 7175 6572 6164 655f 6173  if masquerade_as
-00014230: 2069 6e20 7075 3a0a 2020 2020 2020 2020   in pu:.        
-00014240: 7461 736b 5f69 6e66 6f5b 2250 4155 5345  task_info["PAUSE
-00014250: 5f41 5422 5d20 3d20 7075 5b6d 6173 7175  _AT"] = pu[masqu
-00014260: 6572 6164 655f 6173 5d0a 2020 2020 656c  erade_as].    el
-00014270: 6966 2022 5041 5553 455f 4154 2220 696e  if "PAUSE_AT" in
-00014280: 2061 646d 696e 5f69 6e66 6f3a 0a20 2020   admin_info:.   
-00014290: 2020 2020 2074 6173 6b5f 696e 666f 5b22       task_info["
-000142a0: 5041 5553 455f 4154 225d 203d 2061 646d  PAUSE_AT"] = adm
-000142b0: 696e 5f69 6e66 6f5b 2250 4155 5345 5f41  in_info["PAUSE_A
-000142c0: 5422 5d0a 2020 2020 2320 656c 7365 2077  T"].    # else w
-000142d0: 6520 646f 6e27 7420 7365 7420 5041 5553  e don't set PAUS
-000142e0: 455f 4154 2061 7420 616c 6c0a 0a0a 6465  E_AT at all...de
-000142f0: 6620 616d 656e 645f 7461 736b 5f69 6e66  f amend_task_inf
-00014300: 6f28 636f 7572 7365 2c20 7365 6d65 7374  o(course, semest
-00014310: 6572 2c20 7461 736b 5f69 6e66 6f2c 2075  er, task_info, u
-00014320: 7365 726e 616d 6529 3a0a 2020 2020 2222  sername):.    ""
-00014330: 220a 2020 2020 416d 656e 6473 2074 6173  ".    Amends tas
-00014340: 6b20 696e 666f 206f 626a 6563 7420 7769  k info object wi
-00014350: 7468 2065 7874 7261 206b 6579 7320 696e  th extra keys in
-00014360: 2065 6163 6820 7073 6574 2074 6f20 696e   each pset to in
-00014370: 6469 6361 7465 2070 7365 740a 2020 2020  dicate pset.    
-00014380: 7374 6174 652e 2041 6c73 6f20 6164 6473  state. Also adds
-00014390: 2073 756d 6d61 7279 2069 6e66 6f72 6d61   summary informa
-000143a0: 7469 6f6e 2074 6f20 6561 6368 2074 6173  tion to each tas
-000143b0: 6b20 6f66 2074 6865 2070 7365 7420 6261  k of the pset ba
-000143c0: 7365 640a 2020 2020 6f6e 2075 7365 7220  sed.    on user 
-000143d0: 6665 6564 6261 636b 2067 656e 6572 6174  feedback generat
-000143e0: 6564 2073 6f20 6661 722e 2041 6c73 6f20  ed so far. Also 
-000143f0: 6368 6563 6b73 2070 6f74 6c75 636b 2069  checks potluck i
-00014400: 6e66 6c69 6768 740a 2020 2020 7374 6174  nflight.    stat
-00014410: 7573 2061 6e64 2061 6464 7320 6120 2273  us and adds a "s
-00014420: 7562 6d69 7474 6564 2220 6b65 7920 746f  ubmitted" key to
-00014430: 2065 6163 6820 7461 736b 2077 6865 7265   each task where
-00014440: 2061 7070 726f 7072 6961 7465 2e0a 2020   appropriate..  
-00014450: 2020 5465 6d70 6c61 7465 2063 6f64 6520    Template code 
-00014460: 7368 6f75 6c64 2062 6520 6361 7265 6675  should be carefu
-00014470: 6c20 6e6f 7420 746f 2072 6576 6561 6c20  l not to reveal 
-00014480: 6665 6564 6261 636b 2069 6e66 6f20 6e6f  feedback info no
-00014490: 740a 2020 2020 7761 7272 616e 7465 6420  t.    warranted 
-000144a0: 6279 2074 6865 2063 7572 7265 6e74 2070  by the current p
-000144b0: 7365 7420 7374 6174 652e 0a20 2020 2022  set state..    "
-000144c0: 2222 0a20 2020 2066 6f72 2070 7365 7420  "".    for pset 
-000144d0: 696e 2074 6173 6b5f 696e 666f 5b22 7073  in task_info["ps
-000144e0: 6574 7322 5d3a 0a20 2020 2020 2020 2023  ets"]:.        #
-000144f0: 2041 6464 2073 7461 7475 7320 696e 666f   Add status info
-00014500: 2074 6f20 7468 6520 7073 6574 206f 626a   to the pset obj
-00014510: 6563 743a 0a20 2020 2020 2020 2061 6d65  ect:.        ame
-00014520: 6e64 5f70 7365 745f 616e 645f 7461 736b  nd_pset_and_task
-00014530: 7328 636f 7572 7365 2c20 7365 6d65 7374  s(course, semest
-00014540: 6572 2c20 7461 736b 5f69 6e66 6f2c 2070  er, task_info, p
-00014550: 7365 742c 2075 7365 726e 616d 6529 0a0a  set, username)..
-00014560: 0a64 6566 2061 6d65 6e64 5f70 7365 745f  .def amend_pset_
-00014570: 616e 645f 7461 736b 7328 0a20 2020 2063  and_tasks(.    c
-00014580: 6f75 7273 652c 0a20 2020 2073 656d 6573  ourse,.    semes
-00014590: 7465 722c 0a20 2020 2074 6173 6b5f 696e  ter,.    task_in
-000145a0: 666f 2c0a 2020 2020 7073 6574 5f6f 626a  fo,.    pset_obj
-000145b0: 2c0a 2020 2020 7573 6572 6e61 6d65 0a29  ,.    username.)
-000145c0: 3a0a 2020 2020 2222 220a 2020 2020 4361  :.    """.    Ca
-000145d0: 6c6c 7320 616d 656e 645f 7073 6574 206f  lls amend_pset o
-000145e0: 6e20 7468 6520 6769 7665 6e20 7073 6574  n the given pset
-000145f0: 206f 626a 6563 742c 2061 6e64 2074 6865   object, and the
-00014600: 6e20 616d 656e 645f 7461 736b 206f 6e0a  n amend_task on.
-00014610: 2020 2020 6561 6368 2074 6173 6b20 696e      each task in
-00014620: 2069 742c 2061 6464 696e 6720 2272 6576   it, adding "rev
-00014630: 6973 696f 6e22 2065 6e74 7269 6573 2074  ision" entries t
-00014640: 6f20 6561 6368 2074 6173 6b20 772f 2061  o each task w/ a
-00014650: 6d65 6e64 6564 0a20 2020 2072 6576 6973  mended.    revis
-00014660: 696f 6e20 696e 666f 2e0a 0a20 2020 2041  ion info...    A
-00014670: 6c73 6f20 6164 6473 2022 706f 6f6c 5f73  lso adds "pool_s
-00014680: 7461 7475 7322 206b 6579 7320 746f 2065  tatus" keys to e
-00014690: 6163 6820 7461 736b 2069 6e64 6963 6174  ach task indicat
-000146a0: 696e 6720 7468 6520 6265 7374 2073 7461  ing the best sta
-000146b0: 7475 730a 2020 2020 6f66 2061 6e79 2074  tus.    of any t
-000146c0: 6173 6b20 7468 6174 2773 2070 6f6f 6c65  ask that's poole
-000146d0: 6420 7769 7468 2074 6861 7420 6f6e 652e  d with that one.
-000146e0: 2054 6861 7420 7769 6c6c 2062 6520 2763   That will be 'c
-000146f0: 6f6d 706c 6574 6527 2069 660a 2020 2020  omplete' if.    
-00014700: 7468 6572 6527 7320 6120 636f 6d70 6c65  there's a comple
-00014710: 7465 2074 6173 6b20 696e 2074 6865 2070  te task in the p
-00014720: 6f6f 6c2c 2027 736f 6d65 5f73 7562 6d69  ool, 'some_submi
-00014730: 7373 696f 6e27 2069 6620 7468 6572 6527  ssion' if there'
-00014740: 730a 2020 2020 616e 7920 756e 7375 626d  s.    any unsubm
-00014750: 6974 7465 6420 7461 736b 2069 6e20 7468  itted task in th
-00014760: 6520 706f 6f6c 2c20 616e 2027 756e 7375  e pool, an 'unsu
-00014770: 626d 6974 7465 6427 2069 6620 7468 6572  bmitted' if ther
-00014780: 6520 6172 6520 6e6f 0a20 2020 2073 7562  e are no.    sub
-00014790: 6d69 7474 6564 2074 6173 6b73 2069 6e20  mitted tasks in 
-000147a0: 7468 6520 706f 6f6c 2e0a 2020 2020 2222  the pool..    ""
-000147b0: 220a 2020 2020 616d 656e 645f 7073 6574  ".    amend_pset
-000147c0: 2863 6f75 7273 652c 2073 656d 6573 7465  (course, semeste
-000147d0: 722c 2074 6173 6b5f 696e 666f 2c20 7073  r, task_info, ps
-000147e0: 6574 5f6f 626a 2c20 7573 6572 6e61 6d65  et_obj, username
-000147f0: 290a 2020 2020 2320 4164 6420 7375 6d6d  ).    # Add summ
-00014800: 6172 7920 696e 666f 2074 6f20 6561 6368  ary info to each
-00014810: 2074 6173 6b2c 2061 6e64 2064 7570 6c69   task, and dupli
-00014820: 6361 7465 2066 6f72 2072 6576 6973 696f  cate for revisio
-00014830: 6e73 2061 6e64 0a20 2020 2023 2062 656c  ns and.    # bel
-00014840: 6174 6564 2076 6572 7369 6f6e 730a 2020  ated versions.  
-00014850: 2020 666f 7220 7461 736b 2069 6e20 7073    for task in ps
-00014860: 6574 5f6f 626a 5b22 7461 736b 7322 5d3a  et_obj["tasks"]:
-00014870: 0a20 2020 2020 2020 2072 6576 5f74 6173  .        rev_tas
-00014880: 6b20 3d20 636f 7079 2e64 6565 7063 6f70  k = copy.deepcop
-00014890: 7928 7461 736b 290a 2020 2020 2020 2020  y(task).        
-000148a0: 6265 6c61 7465 645f 7461 736b 203d 2063  belated_task = c
-000148b0: 6f70 792e 6465 6570 636f 7079 2874 6173  opy.deepcopy(tas
-000148c0: 6b29 0a20 2020 2020 2020 2061 6d65 6e64  k).        amend
-000148d0: 5f74 6173 6b28 0a20 2020 2020 2020 2020  _task(.         
-000148e0: 2020 2063 6f75 7273 652c 0a20 2020 2020     course,.     
-000148f0: 2020 2020 2020 2073 656d 6573 7465 722c         semester,
-00014900: 0a20 2020 2020 2020 2020 2020 2074 6173  .            tas
-00014910: 6b5f 696e 666f 2c0a 2020 2020 2020 2020  k_info,.        
-00014920: 2020 2020 7073 6574 5f6f 626a 5b22 6964      pset_obj["id
-00014930: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-00014940: 7265 765f 7461 736b 2c0a 2020 2020 2020  rev_task,.      
-00014950: 2020 2020 2020 7573 6572 6e61 6d65 2c0a        username,.
-00014960: 2020 2020 2020 2020 2020 2020 2272 6576              "rev
-00014970: 6973 696f 6e22 0a20 2020 2020 2020 2029  ision".        )
-00014980: 0a20 2020 2020 2020 2074 6173 6b5b 2272  .        task["r
-00014990: 6576 6973 696f 6e22 5d20 3d20 7265 765f  evision"] = rev_
-000149a0: 7461 736b 0a0a 2020 2020 2020 2020 616d  task..        am
-000149b0: 656e 645f 7461 736b 280a 2020 2020 2020  end_task(.      
-000149c0: 2020 2020 2020 636f 7572 7365 2c0a 2020        course,.  
-000149d0: 2020 2020 2020 2020 2020 7365 6d65 7374            semest
-000149e0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-000149f0: 7461 736b 5f69 6e66 6f2c 0a20 2020 2020  task_info,.     
-00014a00: 2020 2020 2020 2070 7365 745f 6f62 6a5b         pset_obj[
-00014a10: 2269 6422 5d2c 0a20 2020 2020 2020 2020  "id"],.         
-00014a20: 2020 2062 656c 6174 6564 5f74 6173 6b2c     belated_task,
-00014a30: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
-00014a40: 726e 616d 652c 0a20 2020 2020 2020 2020  rname,.         
-00014a50: 2020 2022 6265 6c61 7465 6422 0a20 2020     "belated".   
-00014a60: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
-00014a70: 6173 6b5b 2262 656c 6174 6564 225d 203d  ask["belated"] =
-00014a80: 2062 656c 6174 6564 5f74 6173 6b0a 0a20   belated_task.. 
-00014a90: 2020 2020 2020 2061 6d65 6e64 5f74 6173         amend_tas
-00014aa0: 6b28 0a20 2020 2020 2020 2020 2020 2063  k(.            c
-00014ab0: 6f75 7273 652c 0a20 2020 2020 2020 2020  ourse,.         
-00014ac0: 2020 2073 656d 6573 7465 722c 0a20 2020     semester,.   
-00014ad0: 2020 2020 2020 2020 2074 6173 6b5f 696e           task_in
-00014ae0: 666f 2c0a 2020 2020 2020 2020 2020 2020  fo,.            
-00014af0: 7073 6574 5f6f 626a 5b22 6964 225d 2c0a  pset_obj["id"],.
-00014b00: 2020 2020 2020 2020 2020 2020 7461 736b              task
-00014b10: 2c0a 2020 2020 2020 2020 2020 2020 7573  ,.            us
-00014b20: 6572 6e61 6d65 2c0a 2020 2020 2020 2020  ername,.        
-00014b30: 2020 2020 2269 6e69 7469 616c 220a 2020      "initial".  
-00014b40: 2020 2020 2020 290a 0a20 2020 2023 2046        )..    # F
-00014b50: 6967 7572 6520 6f75 7420 6265 7374 2073  igure out best s
-00014b60: 7461 7475 7320 696e 2065 6163 6820 706f  tatus in each po
-00014b70: 6f6c 0a20 2020 2070 6f6f 6c5f 7374 6174  ol.    pool_stat
-00014b80: 7573 6573 203d 207b 7d0a 2020 2020 666f  uses = {}.    fo
-00014b90: 7220 7461 736b 2069 6e20 7073 6574 5f6f  r task in pset_o
-00014ba0: 626a 5b22 7461 736b 7322 5d3a 0a20 2020  bj["tasks"]:.   
-00014bb0: 2020 2020 2023 2047 6574 2073 7562 6d69       # Get submi
-00014bc0: 7373 696f 6e20 7374 6174 7573 0a20 2020  ssion status.   
-00014bd0: 2020 2020 2073 7461 7475 7320 3d20 7461       status = ta
-00014be0: 736b 5b22 7375 626d 6973 7369 6f6e 5f73  sk["submission_s
-00014bf0: 7461 7475 7322 5d0a 2020 2020 2020 2020  tatus"].        
-00014c00: 6966 2073 7461 7475 7320 6e6f 7420 696e  if status not in
-00014c10: 2028 2275 6e73 7562 6d69 7474 6564 222c   ("unsubmitted",
-00014c20: 2022 636f 6d70 6c65 7465 2229 3a0a 2020   "complete"):.  
-00014c30: 2020 2020 2020 2020 2020 7374 6174 7573            status
-00014c40: 203d 2022 736f 6d65 5f73 7562 6d69 7373   = "some_submiss
-00014c50: 696f 6e22 0a0a 2020 2020 2020 2020 7265  ion"..        re
-00014c60: 765f 7374 6174 7573 203d 2074 6173 6b2e  v_status = task.
-00014c70: 6765 7428 2272 6576 6973 696f 6e22 2c20  get("revision", 
-00014c80: 7b7d 292e 6765 7428 0a20 2020 2020 2020  {}).get(.       
-00014c90: 2020 2020 2022 7375 626d 6973 7369 6f6e       "submission
-00014ca0: 5f73 7461 7475 7322 2c0a 2020 2020 2020  _status",.      
-00014cb0: 2020 2020 2020 2275 6e73 7562 6d69 7474        "unsubmitt
-00014cc0: 6564 220a 2020 2020 2020 2020 290a 2020  ed".        ).  
-00014cd0: 2020 2020 2020 6966 2072 6576 5f73 7461        if rev_sta
-00014ce0: 7475 7320 6e6f 7420 696e 2028 2275 6e73  tus not in ("uns
-00014cf0: 7562 6d69 7474 6564 222c 2022 636f 6d70  ubmitted", "comp
-00014d00: 6c65 7465 2229 3a0a 2020 2020 2020 2020  lete"):.        
-00014d10: 2020 2020 7265 765f 7374 6174 7573 203d      rev_status =
-00014d20: 2022 736f 6d65 5f73 7562 6d69 7373 696f   "some_submissio
-00014d30: 6e22 0a20 2020 2020 2020 2062 656c 5f73  n".        bel_s
-00014d40: 7461 7475 7320 3d20 7461 736b 2e67 6574  tatus = task.get
-00014d50: 2822 6265 6c61 7465 6422 2c20 7b7d 292e  ("belated", {}).
-00014d60: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
-00014d70: 2022 7375 626d 6973 7369 6f6e 5f73 7461   "submission_sta
-00014d80: 7475 7322 2c0a 2020 2020 2020 2020 2020  tus",.          
-00014d90: 2020 2275 6e73 7562 6d69 7474 6564 220a    "unsubmitted".
-00014da0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00014db0: 2020 6966 2062 656c 5f73 7461 7475 7320    if bel_status 
-00014dc0: 6e6f 7420 696e 2028 2275 6e73 7562 6d69  not in ("unsubmi
-00014dd0: 7474 6564 222c 2022 636f 6d70 6c65 7465  tted", "complete
-00014de0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00014df0: 6265 6c5f 7374 6174 7573 203d 2022 736f  bel_status = "so
-00014e00: 6d65 5f73 7562 6d69 7373 696f 6e22 0a0a  me_submission"..
-00014e10: 2020 2020 2020 2020 2320 4669 6775 7265          # Figure
-00014e20: 206f 7574 2062 6573 7420 7374 6174 7573   out best status
-00014e30: 2061 6372 6f73 7320 7265 7669 7369 6f6e   across revision
-00014e40: 2f62 656c 6174 6564 2070 6861 7365 730a  /belated phases.
-00014e50: 2020 2020 2020 2020 706f 696e 7473 203d          points =
-00014e60: 206d 6170 280a 2020 2020 2020 2020 2020   map(.          
-00014e70: 2020 6c61 6d62 6461 2078 3a20 7b0a 2020    lambda x: {.  
-00014e80: 2020 2020 2020 2020 2020 2020 2020 2275                "u
-00014e90: 6e73 7562 6d69 7474 6564 223a 2030 2c0a  nsubmitted": 0,.
-00014ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014eb0: 2273 6f6d 655f 7375 626d 6973 7369 6f6e  "some_submission
-00014ec0: 223a 2031 2c0a 2020 2020 2020 2020 2020  ": 1,.          
-00014ed0: 2020 2020 2020 2263 6f6d 706c 6574 6522        "complete"
-00014ee0: 3a20 320a 2020 2020 2020 2020 2020 2020  : 2.            
-00014ef0: 7d5b 785d 2c0a 2020 2020 2020 2020 2020  }[x],.          
-00014f00: 2020 5b73 7461 7475 732c 2072 6576 5f73    [status, rev_s
-00014f10: 7461 7475 732c 2062 656c 5f73 7461 7475  tatus, bel_statu
-00014f20: 735d 0a20 2020 2020 2020 2029 0a20 2020  s].        ).   
-00014f30: 2020 2020 2073 7461 7475 7320 3d20 7b0a       status = {.
-00014f40: 2020 2020 2020 2020 2020 2020 303a 2022              0: "
-00014f50: 756e 7375 626d 6974 7465 6422 2c0a 2020  unsubmitted",.  
-00014f60: 2020 2020 2020 2020 2020 313a 2022 736f            1: "so
-00014f70: 6d65 5f73 7562 6d69 7373 696f 6e22 2c0a  me_submission",.
-00014f80: 2020 2020 2020 2020 2020 2020 323a 2022              2: "
-00014f90: 636f 6d70 6c65 7465 220a 2020 2020 2020  complete".      
-00014fa0: 2020 7d5b 6d61 7828 706f 696e 7473 295d    }[max(points)]
-00014fb0: 0a0a 2020 2020 2020 2020 2320 4669 6775  ..        # Figu
-00014fc0: 7265 206f 7574 2074 6869 7320 7461 736b  re out this task
-00014fd0: 2773 2070 6f6f 6c20 616e 6420 7570 6461  's pool and upda
-00014fe0: 7465 2074 6865 2073 636f 7265 2066 6f72  te the score for
-00014ff0: 2074 6861 7420 706f 6f6c 0a20 2020 2020   that pool.     
-00015000: 2020 2070 6f6f 6c20 3d20 7461 736b 5f70     pool = task_p
-00015010: 6f6f 6c28 7461 736b 290a 0a20 2020 2020  ool(task)..     
-00015020: 2020 2070 7265 765f 7374 6174 7573 203d     prev_status =
-00015030: 2070 6f6f 6c5f 7374 6174 7573 6573 2e67   pool_statuses.g
-00015040: 6574 2870 6f6f 6c29 0a20 2020 2020 2020  et(pool).       
-00015050: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-00015060: 2020 7072 6576 5f73 7461 7475 7320 6973    prev_status is
-00015070: 204e 6f6e 650a 2020 2020 2020 2020 206f   None.         o
-00015080: 7220 7072 6576 5f73 7461 7475 7320 3d3d  r prev_status ==
-00015090: 2022 756e 7375 626d 6974 7465 6422 0a20   "unsubmitted". 
-000150a0: 2020 2020 2020 2020 6f72 2070 7265 765f          or prev_
-000150b0: 7374 6174 7573 203d 3d20 2273 6f6d 655f  status == "some_
-000150c0: 7375 626d 6973 7369 6f6e 2220 616e 6420  submission" and 
-000150d0: 7374 6174 7573 203d 3d20 2263 6f6d 706c  status == "compl
-000150e0: 6574 6522 0a20 2020 2020 2020 2029 3a0a  ete".        ):.
-000150f0: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
-00015100: 5f73 7461 7475 7365 735b 706f 6f6c 5d20  _statuses[pool] 
-00015110: 3d20 7374 6174 7573 0a0a 2020 2020 2320  = status..    # 
-00015120: 4e6f 7720 6173 7369 676e 2070 6f6f 6c5f  Now assign pool_
-00015130: 7374 6174 7573 2073 6c6f 7473 2074 6f20  status slots to 
-00015140: 6561 6368 2074 6173 6b0a 2020 2020 666f  each task.    fo
-00015150: 7220 7461 736b 2069 6e20 7073 6574 5f6f  r task in pset_o
-00015160: 626a 5b22 7461 736b 7322 5d3a 0a20 2020  bj["tasks"]:.   
-00015170: 2020 2020 2070 6f6f 6c20 3d20 7461 736b       pool = task
-00015180: 5f70 6f6f 6c28 7461 736b 290a 2020 2020  _pool(task).    
-00015190: 2020 2020 7461 736b 5b22 706f 6f6c 5f73      task["pool_s
-000151a0: 7461 7475 7322 5d20 3d20 706f 6f6c 5f73  tatus"] = pool_s
-000151b0: 7461 7475 7365 735b 706f 6f6c 5d0a 0a0a  tatuses[pool]...
-000151c0: 6465 6620 616d 656e 645f 7073 6574 2863  def amend_pset(c
-000151d0: 6f75 7273 652c 2073 656d 6573 7465 722c  ourse, semester,
-000151e0: 2074 6173 6b5f 696e 666f 2c20 7073 6574   task_info, pset
-000151f0: 5f6f 626a 2c20 7573 6572 6e61 6d65 293a  _obj, username):
-00015200: 0a20 2020 2022 2222 0a20 2020 2041 6464  .    """.    Add
-00015210: 7320 6120 2273 7461 7475 7322 206b 6579  s a "status" key
-00015220: 2074 6f20 7468 6520 6769 7665 6e20 7072   to the given pr
-00015230: 6f62 6c65 6d20 7365 7420 6f62 6a65 6374  oblem set object
-00015240: 2028 7768 6963 6820 7368 6f75 6c64 2062   (which should b
-00015250: 650a 2020 2020 7061 7274 206f 6620 7468  e.    part of th
-00015260: 6520 6769 7665 6e20 7461 736b 2069 6e66  e given task inf
-00015270: 6f29 2e20 5468 6520 7573 6572 6e61 6d65  o). The username
-00015280: 2069 7320 7573 6564 2074 6f20 6c6f 6f6b   is used to look
-00015290: 2075 700a 2020 2020 6578 7465 6e73 696f   up.    extensio
-000152a0: 6e20 696e 666f 726d 6174 696f 6e2e 0a20  n information.. 
-000152b0: 2020 2022 2222 0a20 2020 2069 6e69 7469     """.    initi
-000152c0: 616c 5f65 7874 203d 2073 746f 7261 6765  al_ext = storage
-000152d0: 2e67 6574 5f65 7874 656e 7369 6f6e 280a  .get_extension(.
-000152e0: 2020 2020 2020 2020 636f 7572 7365 2c0a          course,.
-000152f0: 2020 2020 2020 2020 7365 6d65 7374 6572          semester
-00015300: 2c0a 2020 2020 2020 2020 7573 6572 6e61  ,.        userna
-00015310: 6d65 2c0a 2020 2020 2020 2020 7073 6574  me,.        pset
-00015320: 5f6f 626a 5b22 6964 225d 2c0a 2020 2020  _obj["id"],.    
-00015330: 2020 2020 2269 6e69 7469 616c 220a 2020      "initial".  
-00015340: 2020 290a 2020 2020 6966 2069 6e69 7469    ).    if initi
-00015350: 616c 5f65 7874 2069 7320 4e6f 6e65 3a0a  al_ext is None:.
-00015360: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
-00015370: 6173 6828 0a20 2020 2020 2020 2020 2020  ash(.           
-00015380: 2022 4572 726f 7220 6665 7463 6869 6e67   "Error fetching
-00015390: 2069 6e69 7469 616c 2065 7874 656e 7369   initial extensi
-000153a0: 6f6e 2069 6e66 6f20 2874 7265 6174 696e  on info (treatin
-000153b0: 6720 6173 2030 292e 220a 2020 2020 2020  g as 0).".      
-000153c0: 2020 290a 2020 2020 2020 2020 696e 6974    ).        init
-000153d0: 6961 6c5f 6578 7420 3d20 300a 0a20 2020  ial_ext = 0..   
-000153e0: 2072 6576 6973 696f 6e5f 6578 7420 3d20   revision_ext = 
-000153f0: 7374 6f72 6167 652e 6765 745f 6578 7465  storage.get_exte
-00015400: 6e73 696f 6e28 0a20 2020 2020 2020 2063  nsion(.        c
-00015410: 6f75 7273 652c 0a20 2020 2020 2020 2073  ourse,.        s
-00015420: 656d 6573 7465 722c 0a20 2020 2020 2020  emester,.       
-00015430: 2075 7365 726e 616d 652c 0a20 2020 2020   username,.     
-00015440: 2020 2070 7365 745f 6f62 6a5b 2269 6422     pset_obj["id"
-00015450: 5d2c 0a20 2020 2020 2020 2022 7265 7669  ],.        "revi
-00015460: 7369 6f6e 220a 2020 2020 290a 2020 2020  sion".    ).    
-00015470: 6966 2072 6576 6973 696f 6e5f 6578 7420  if revision_ext 
-00015480: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00015490: 2066 6c61 736b 2e66 6c61 7368 280a 2020   flask.flash(.  
-000154a0: 2020 2020 2020 2020 2020 2245 7272 6f72            "Error
-000154b0: 2066 6574 6368 696e 6720 7265 7669 7369   fetching revisi
-000154c0: 6f6e 2065 7874 656e 7369 6f6e 2069 6e66  on extension inf
-000154d0: 6f20 2874 7265 6174 696e 6720 6173 2030  o (treating as 0
-000154e0: 292e 220a 2020 2020 2020 2020 290a 2020  ).".        ).  
-000154f0: 2020 2020 2020 7265 7669 7369 6f6e 5f65        revision_e
-00015500: 7874 203d 2030 0a0a 2020 2020 7073 6574  xt = 0..    pset
-00015510: 5f6f 626a 5b22 7374 6174 7573 225d 203d  _obj["status"] =
-00015520: 2070 7365 745f 7374 6174 7573 5f6e 6f77   pset_status_now
-00015530: 280a 2020 2020 2020 2020 7573 6572 6e61  (.        userna
-00015540: 6d65 2c0a 2020 2020 2020 2020 7461 736b  me,.        task
-00015550: 5f69 6e66 6f2c 0a20 2020 2020 2020 2070  _info,.        p
-00015560: 7365 745f 6f62 6a2c 0a20 2020 2020 2020  set_obj,.       
-00015570: 2065 7874 656e 7369 6f6e 733d 5b69 6e69   extensions=[ini
-00015580: 7469 616c 5f65 7874 2c20 7265 7669 7369  tial_ext, revisi
-00015590: 6f6e 5f65 7874 5d0a 2020 2020 290a 0a0a  on_ext].    )...
-000155a0: 6465 6620 616d 656e 645f 7461 736b 2863  def amend_task(c
-000155b0: 6f75 7273 652c 2073 656d 6573 7465 722c  ourse, semester,
-000155c0: 2074 6173 6b5f 696e 666f 2c20 7073 6964   task_info, psid
-000155d0: 2c20 7461 736b 2c20 7573 6572 6e61 6d65  , task, username
-000155e0: 2c20 7068 6173 6529 3a0a 2020 2020 2222  , phase):.    ""
-000155f0: 220a 2020 2020 4164 6473 2074 6173 6b2d  ".    Adds task-
-00015600: 7374 6174 652d 7265 6c61 7465 6420 6b65  state-related ke
-00015610: 7973 2074 6f20 7468 6520 6769 7665 6e20  ys to the given 
-00015620: 7461 736b 206f 626a 6563 742e 2054 6865  task object. The
-00015630: 2066 6f6c 6c6f 7769 6e67 0a20 2020 206b   following.    k
-00015640: 6579 7320 6172 6520 6164 6465 643a 0a0a  eys are added:..
-00015650: 2020 2020 2d20 2266 6565 6462 6163 6b5f      - "feedback_
-00015660: 7375 6d6d 6172 7922 3a20 4120 6665 6564  summary": A feed
-00015670: 6261 636b 2073 756d 6d61 7279 206f 626a  back summary obj
-00015680: 6563 7420 2873 6565 0a20 2020 2020 2020  ect (see.       
-00015690: 2060 6765 745f 6665 6564 6261 636b 5f73   `get_feedback_s
-000156a0: 756d 6d61 7279 6029 2e0a 2020 2020 2d20  ummary`)..    - 
-000156b0: 2274 696d 655f 7370 656e 7422 3a20 5468  "time_spent": Th
-000156c0: 6520 7469 6d65 2073 7065 6e74 2069 6e66  e time spent inf
-000156d0: 6f20 7468 6174 2074 6865 2075 7365 7220  o that the user 
-000156e0: 656e 7465 7265 6420 666f 7220 7469 6d65  entered for time
-000156f0: 0a20 2020 2020 2020 2073 7065 6e74 2077  .        spent w
-00015700: 6865 6e20 7375 626d 6974 7469 6e67 2074  hen submitting t
-00015710: 6865 2074 6173 6b20 2873 6565 0a20 2020  he task (see.   
-00015720: 2020 2020 2060 706f 746c 7563 6b5f 6170       `potluck_ap
-00015730: 702e 7374 6f72 6167 652e 6665 7463 685f  p.storage.fetch_
-00015740: 7469 6d65 5f73 7065 6e74 6020 666f 7220  time_spent` for 
-00015750: 7468 6520 666f 726d 6174 292e 2057 696c  the format). Wil
-00015760: 6c20 6265 0a20 2020 2020 2020 204e 6f6e  l be.        Non
-00015770: 6520 6966 2074 6861 7420 696e 666f 2069  e if that info i
-00015780: 736e 2774 2061 7661 696c 6162 6c65 2e0a  sn't available..
-00015790: 2020 2020 2d20 2273 7562 6d69 7474 6564      - "submitted
-000157a0: 223a 2054 7275 6520 6966 2074 6865 2075  ": True if the u
-000157b0: 7365 7220 6861 7320 6174 7465 6d70 7465  ser has attempte
-000157c0: 6420 7375 626d 6973 7369 6f6e 2028 6576  d submission (ev
-000157d0: 656e 2069 660a 2020 2020 2020 2020 7468  en if.        th
-000157e0: 6572 6520 7765 7265 2070 726f 626c 656d  ere were problem
-000157f0: 7329 206f 7220 6966 2077 6520 6861 7665  s) or if we have
-00015800: 2066 6565 6462 6163 6b20 666f 7220 7468   feedback for th
-00015810: 656d 2028 7265 6761 7264 6c65 7373 0a20  em (regardless. 
-00015820: 2020 2020 2020 206f 6620 616e 7974 6869         of anythi
-00015830: 6e67 2065 6c73 6529 2e0a 2020 2020 2d20  ng else)..    - 
-00015840: 2273 7562 6d69 7474 6564 5f61 7422 3a20  "submitted_at": 
-00015850: 4120 6064 6174 6574 696d 652e 6461 7465  A `datetime.date
-00015860: 7469 6d65 6020 6f62 6a65 6374 2072 6570  time` object rep
-00015870: 7265 7365 6e74 696e 6720 7768 656e 0a20  resenting when. 
-00015880: 2020 2020 2020 2074 6865 2073 7562 6d69         the submi
-00015890: 7373 696f 6e20 7761 7320 7265 6365 6976  ssion was receiv
-000158a0: 6564 2c20 6f72 204e 6f6e 6520 6966 2074  ed, or None if t
-000158b0: 6865 7265 2069 7320 6e6f 2072 6563 6f72  here is no recor
-000158c0: 6465 640a 2020 2020 2020 2020 7375 626d  ded.        subm
-000158d0: 6973 7369 6f6e 2e0a 2020 2020 2d20 2265  ission..    - "e
-000158e0: 7661 6c5f 656c 6170 7365 6422 3a20 4120  val_elapsed": A 
-000158f0: 6064 6174 6574 696d 652e 7469 6d65 6465  `datetime.timede
-00015900: 6c74 6160 2074 6861 7420 7265 7072 6573  lta` that repres
-00015910: 656e 7473 2074 6865 2074 696d 650a 2020  ents the time.  
-00015920: 2020 2020 2020 656c 6170 7365 6420 7369        elapsed si
-00015930: 6e63 6520 6576 616c 7561 7469 6f6e 2077  nce evaluation w
-00015940: 6173 2073 7461 7274 6564 2066 6f72 2074  as started for t
-00015950: 6865 2073 7562 6d69 7373 696f 6e20 2869  he submission (i
-00015960: 6e0a 2020 2020 2020 2020 706f 7373 6962  n.        possib
-00015970: 6c79 2066 7261 6374 696f 6e61 6c20 7365  ly fractional se
-00015980: 636f 6e64 7329 2e0a 2020 2020 2d20 2265  conds)..    - "e
-00015990: 7661 6c5f 7469 6d65 6f75 7422 3a20 4120  val_timeout": A 
-000159a0: 6064 6174 6574 696d 652e 7469 6d65 6465  `datetime.timede
-000159b0: 6c74 6160 2072 6570 7265 7365 6e74 696e  lta` representin
-000159c0: 6720 7468 6520 6e75 6d62 6572 0a20 2020  g the number.   
-000159d0: 2020 2020 206f 6620 7365 636f 6e64 7320       of seconds 
-000159e0: 6265 666f 7265 2074 6865 2065 7661 6c75  before the evalu
-000159f0: 6174 696f 6e20 7072 6f63 6573 7320 7368  ation process sh
-00015a00: 6f75 6c64 2074 696d 6520 6f75 742e 0a20  ould time out.. 
-00015a10: 2020 202d 2022 6576 616c 5f73 7461 7475     - "eval_statu
-00015a20: 7322 3a20 5468 6520 7374 6174 7573 206f  s": The status o
-00015a30: 6620 7468 6520 6576 616c 7561 7469 6f6e  f the evaluation
-00015a40: 2070 726f 6365 7373 2028 7365 650a 2020   process (see.  
-00015a50: 2020 2020 2020 6067 6574 5f69 6e66 6c69        `get_infli
-00015a60: 6768 7460 292e 0a20 2020 202d 2022 7375  ght`)..    - "su
-00015a70: 626d 6973 7369 6f6e 5f73 7461 7475 7322  bmission_status"
-00015a80: 3a20 4120 7374 7269 6e67 2072 6570 7265  : A string repre
-00015a90: 7365 6e74 696e 6720 7468 6520 7374 6174  senting the stat
-00015aa0: 7573 206f 6620 7468 650a 2020 2020 2020  us of the.      
-00015ab0: 2020 7375 626d 6973 7369 6f6e 206f 7665    submission ove
-00015ac0: 7261 6c6c 2e20 4f6e 6520 6f66 3a0a 2020  rall. One of:.  
-00015ad0: 2020 2020 2020 2d20 2275 6e73 7562 6d69        - "unsubmi
-00015ae0: 7474 6564 223a 206e 6f20 7375 626d 6973  tted": no submis
-00015af0: 7369 6f6e 2079 6574 2e0a 2020 2020 2020  sion yet..      
-00015b00: 2020 2d20 2269 6e66 6c69 6768 7422 3a20    - "inflight": 
-00015b10: 6861 7320 6265 656e 2073 7562 6d69 7474  has been submitt
-00015b20: 6564 3b20 7374 696c 6c20 6265 696e 6720  ed; still being 
-00015b30: 6576 616c 7561 7465 642e 0a20 2020 2020  evaluated..     
-00015b40: 2020 202d 2022 756e 7072 6f63 6573 7365     - "unprocesse
-00015b50: 6422 3a20 6576 616c 7561 7465 6420 6275  d": evaluated bu
-00015b60: 7420 7468 6572 6527 7320 616e 2069 7373  t there's an iss
-00015b70: 7565 2028 6576 616c 7561 7469 6f6e 0a20  ue (evaluation. 
-00015b80: 2020 2020 2020 2020 2020 2063 7261 7368             crash
-00015b90: 6564 206f 7220 656c 7365 686f 7720 6661  ed or elsehow fa
-00015ba0: 696c 6564 2074 6f20 6765 6e65 7261 7465  iled to generate
-00015bb0: 2066 6565 6462 6163 6b29 2e0a 2020 2020   feedback)..    
-00015bc0: 2020 2020 2d20 2269 7373 7565 223a 2065      - "issue": e
-00015bd0: 7661 6c75 6174 6564 2062 7574 2074 6865  valuated but the
-00015be0: 7265 2773 2061 6e20 6973 7375 6520 2865  re's an issue (e
-00015bf0: 7661 6c75 6174 696f 6e20 7761 726e 696e  valuation warnin
-00015c00: 6720 6f72 0a20 2020 2020 2020 2020 2020  g or.           
-00015c10: 2027 696e 636f 6d70 6c65 7465 2720 6576   'incomplete' ev
-00015c20: 616c 7561 7469 6f6e 2072 6573 756c 742e  aluation result.
-00015c30: 290a 2020 2020 2020 2020 2d20 2263 6f6d  ).        - "com
-00015c40: 706c 6574 6522 3a20 4576 616c 7561 7465  plete": Evaluate
-00015c50: 6420 616e 6420 7468 6572 6527 7320 6e6f  d and there's no
-00015c60: 206d 616a 6f72 2069 7373 7565 2028 6772   major issue (gr
-00015c70: 6164 6520 6d61 7920 6f72 0a20 2020 2020  ade may or.     
-00015c80: 2020 2020 2020 206d 6179 206e 6f74 2062         may not b
-00015c90: 6520 7065 7266 6563 742c 2062 7574 2069  e perfect, but i
-00015ca0: 7420 6265 7474 6572 2074 6861 6e20 2269  t better than "i
-00015cb0: 6e63 6f6d 706c 6574 6522 292e 0a20 2020  ncomplete")..   
-00015cc0: 202d 2022 7375 626d 6973 7369 6f6e 5f69   - "submission_i
-00015cd0: 636f 6e22 3a20 4120 6f6e 652d 6368 6172  con": A one-char
-00015ce0: 6163 7465 7220 7374 7269 6e67 2075 7365  acter string use
-00015cf0: 6420 746f 2072 6570 7265 7365 6e74 2074  d to represent t
-00015d00: 6865 0a20 2020 2020 2020 2073 7562 6d69  he.        submi
-00015d10: 7373 696f 6e20 7374 6174 7573 2e0a 2020  ssion status..  
-00015d20: 2020 2d20 2273 7562 6d69 7373 696f 6e5f    - "submission_
-00015d30: 6465 7363 223a 2041 2062 7269 6566 2068  desc": A brief h
-00015d40: 756d 616e 2d72 6561 6461 626c 6520 7665  uman-readable ve
-00015d50: 7273 696f 6e20 6f66 2074 6865 0a20 2020  rsion of the.   
-00015d60: 2020 2020 2073 7562 6d69 7373 696f 6e20       submission 
-00015d70: 7374 6174 7573 2e0a 2020 2020 2d20 2267  status..    - "g
-00015d80: 7261 6465 223a 2041 206e 756d 6572 6963  rade": A numeric
-00015d90: 616c 2067 7261 6465 2076 616c 7565 2c20  al grade value, 
-00015da0: 6465 7269 7665 6420 6672 6f6d 2074 6865  derived from the
-00015db0: 2065 7661 6c75 6174 696f 6e20 7669 610a   evaluation via.
-00015dc0: 2020 2020 2020 2020 7468 6520 4556 414c          the EVAL
-00015dd0: 5541 5449 4f4e 5f53 434f 5245 5320 6469  UATION_SCORES di
-00015de0: 6374 696f 6e61 7279 2064 6566 696e 6564  ctionary defined
-00015df0: 2069 6e20 7468 6520 636f 6e66 6967 2066   in the config f
-00015e00: 696c 652e 2049 660a 2020 2020 2020 2020  ile. If.        
-00015e10: 6e6f 2067 7261 6465 2068 6173 2062 6565  no grade has bee
-00015e20: 6e20 6173 7369 676e 6564 2c20 6974 2077  n assigned, it w
-00015e30: 696c 6c20 6265 2074 6865 2073 7472 696e  ill be the strin
-00015e40: 6720 273f 2720 696e 7374 6561 6420 6f66  g '?' instead of
-00015e50: 0a20 2020 2020 2020 2061 206e 756d 6265  .        a numbe
-00015e60: 722e 2047 7261 6465 206f 7665 7272 6964  r. Grade overrid
-00015e70: 6573 2061 7265 2066 6163 746f 7265 6420  es are factored 
-00015e80: 696e 2069 6620 7072 6573 656e 742e 0a20  in if present.. 
-00015e90: 2020 202d 2022 6772 6164 655f 6f76 6572     - "grade_over
-00015ea0: 7269 6464 656e 223a 2041 2062 6f6f 6c65  ridden": A boole
-00015eb0: 616e 2069 6e64 6963 6174 696e 6720 7768  an indicating wh
-00015ec0: 6574 6865 7220 7468 6520 6772 6164 6520  ether the grade 
-00015ed0: 7761 730a 2020 2020 2020 2020 6f76 6572  was.        over
-00015ee0: 7269 6464 656e 206f 7220 6e6f 742e 2057  ridden or not. W
-00015ef0: 696c 6c20 6265 2074 7275 6520 7768 656e  ill be true when
-00015f00: 2074 6865 7265 2773 2061 6e20 6f76 6572   there's an over
-00015f10: 7269 6465 2061 6374 6976 650a 2020 2020  ride active.    
-00015f20: 2020 2020 6576 656e 2069 6620 7468 6520      even if the 
-00015f30: 6f76 6572 7269 6465 2069 6e64 6963 6174  override indicat
-00015f40: 6573 2074 6865 2073 616d 6520 7363 6f72  es the same scor
-00015f50: 6520 6173 2074 6865 2061 7574 6f6d 6174  e as the automat
-00015f60: 6963 0a20 2020 2020 2020 2067 7261 6465  ic.        grade
-00015f70: 2e0a 2020 2020 2d20 2274 696d 656c 696e  ..    - "timelin
-00015f80: 6573 7322 3a20 4120 6e75 6d65 7269 6361  ess": A numerica
-00015f90: 6c20 7363 6f72 6520 7661 6c75 6520 666f  l score value fo
-00015fa0: 7220 7469 6d65 6c69 6e65 7373 2070 6f69  r timeliness poi
-00015fb0: 6e74 732c 206f 6e6c 790a 2020 2020 2020  nts, only.      
-00015fc0: 2020 7072 6573 656e 7420 7768 656e 2061    present when a
-00015fd0: 6e20 6f76 6572 7269 6465 2068 6173 2062  n override has b
-00015fe0: 6565 6e20 6973 7375 6564 2e20 4e6f 726d  een issued. Norm
-00015ff0: 616c 6c79 2c20 7469 6d65 6c69 6e65 7373  ally, timeliness
-00016000: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
-00016010: 6172 6520 636f 6d70 7574 6564 2066 6f72  are computed for
-00016020: 2061 6e20 616c 7265 6164 792d 6175 676d   an already-augm
-00016030: 656e 7465 6420 7461 736b 2062 6173 6564  ented task based
-00016040: 206f 6e20 7468 650a 2020 2020 2020 2020   on the.        
-00016050: 696e 6974 6961 6c2f 7265 7669 7365 642f  initial/revised/
-00016060: 6265 6c61 7465 6420 7375 626d 6973 7369  belated submissi
-00016070: 6f6e 2073 7461 7475 7365 732e 0a20 2020  on statuses..   
-00016080: 202d 2022 7469 6d65 6c69 6e65 7373 5f6f   - "timeliness_o
-00016090: 7665 7272 6964 6465 6e22 3a20 4120 626f  verridden": A bo
-000160a0: 6f6c 6561 6e20 696e 6469 6361 7469 6e67  olean indicating
-000160b0: 2077 6865 7468 6572 2074 6865 0a20 2020   whether the.   
-000160c0: 2020 2020 2074 696d 656c 696e 6573 7320       timeliness 
-000160d0: 7363 6f72 6520 7761 7320 6f76 6572 7269  score was overri
-000160e0: 6464 656e 206f 7220 6e6f 742e 0a20 2020  dden or not..   
-000160f0: 202d 2022 6e6f 7465 7322 3a20 4120 7374   - "notes": A st
-00016100: 7269 6e67 2069 6e64 6963 6174 696e 6720  ring indicating 
-00016110: 7468 6520 6d61 726b 646f 776e 2073 6f75  the markdown sou
-00016120: 7263 6520 666f 7220 6375 7374 6f6d 206e  rce for custom n
-00016130: 6f74 6573 0a20 2020 2020 2020 2061 7070  otes.        app
-00016140: 6c69 6564 2074 6f20 7468 6520 7461 736b  lied to the task
-00016150: 2062 7920 616e 2065 7661 6c75 6174 6f72   by an evaluator
-00016160: 2e0a 2020 2020 2d20 226e 6f74 6573 5f68  ..    - "notes_h
-00016170: 746d 6c22 3a20 4120 7374 7269 6e67 206f  tml": A string o
-00016180: 6620 4854 4d4c 2063 6f64 6520 7265 6e64  f HTML code rend
-00016190: 6572 6564 2066 726f 6d20 7468 6520 6e6f  ered from the no
-000161a0: 7465 730a 2020 2020 2020 2020 6d61 726b  tes.        mark
-000161b0: 646f 776e 2e0a 2020 2020 2d20 226d 6178  down..    - "max
-000161c0: 5f73 636f 7265 223a 2041 206e 756d 6265  _score": A numbe
-000161d0: 7220 7265 7072 6573 656e 7469 6e67 2074  r representing t
-000161e0: 6865 206d 6178 696d 756d 2073 636f 7265  he maximum score
-000161f0: 2070 6f73 7369 626c 650a 2020 2020 2020   possible.      
-00016200: 2020 6261 7365 6420 6f6e 2074 6865 2070    based on the p
-00016210: 6861 7365 206f 6620 7468 6520 7375 626d  hase of the subm
-00016220: 6973 7369 6f6e 2c20 6569 7468 6572 2053  ission, either S
-00016230: 434f 5245 5f42 4153 4953 2066 6f72 0a20  CORE_BASIS for. 
-00016240: 2020 2020 2020 2069 6e69 7469 616c 2073         initial s
-00016250: 7562 6d69 7373 696f 6e73 2c20 5245 5649  ubmissions, REVI
-00016260: 5349 4f4e 5f4d 4158 5f53 434f 5245 2066  SION_MAX_SCORE f
-00016270: 6f72 2072 6576 6973 696f 6e73 2c20 6f72  or revisions, or
-00016280: 0a20 2020 2020 2020 2042 454c 4154 4544  .        BELATED
-00016290: 5f4d 4158 5f53 434f 5245 2066 6f72 2062  _MAX_SCORE for b
-000162a0: 656c 6174 6564 2073 7562 6d69 7373 696f  elated submissio
-000162b0: 6e73 2e0a 2020 2020 2d20 226d 6178 5f72  ns..    - "max_r
-000162c0: 6576 6973 696f 6e5f 7363 6f72 6522 3a20  evision_score": 
-000162d0: 4120 6e75 6d62 6572 2072 6570 7265 7365  A number represe
-000162e0: 6e74 696e 6720 7468 6520 6d61 7820 7363  nting the max sc
-000162f0: 6f72 6520 706f 7373 6962 6c65 0a20 2020  ore possible.   
-00016300: 2020 2020 206f 6e20 6120 7265 7669 7369       on a revisi
-00016310: 6f6e 206f 6620 7468 6973 2074 6173 6b20  on of this task 
-00016320: 2872 6567 6172 646c 6573 7320 6f66 2077  (regardless of w
-00016330: 6865 7468 6572 2074 6869 7320 6973 2061  hether this is a
-00016340: 6e0a 2020 2020 2020 2020 696e 6974 6961  n.        initia
-00016350: 6c20 6f72 2072 6576 6973 6564 2073 7562  l or revised sub
-00016360: 6d69 7373 696f 6e29 0a20 2020 202d 2022  mission).    - "
-00016370: 6d61 785f 6265 6c61 7465 645f 7363 6f72  max_belated_scor
-00016380: 6522 3a20 4120 6e75 6d62 6572 2072 6570  e": A number rep
-00016390: 7265 7365 6e74 696e 6720 7468 6520 6d61  resenting the ma
-000163a0: 7820 7363 6f72 6520 706f 7373 6962 6c65  x score possible
-000163b0: 0a20 2020 2020 2020 206f 6e20 6120 6265  .        on a be
-000163c0: 6c61 7465 6420 7375 626d 6973 7369 6f6e  lated submission
-000163d0: 206f 6620 7468 6973 2074 6173 6b20 2872   of this task (r
-000163e0: 6567 6172 646c 6573 7320 6f66 2077 6865  egardless of whe
-000163f0: 7468 6572 2074 6869 730a 2020 2020 2020  ther this.      
-00016400: 2020 6973 2061 6e20 696e 6974 6961 6c2c    is an initial,
-00016410: 2072 6576 6973 6564 2c20 6f72 2062 656c   revised, or bel
-00016420: 6174 6564 2073 7562 6d69 7373 696f 6e29  ated submission)
-00016430: 0a20 2020 2022 2222 0a20 2020 2023 2046  .    """.    # F
-00016440: 6574 6368 2062 6173 6963 2069 6e66 6f0a  etch basic info.
-00016450: 2020 2020 7461 736b 5b22 6665 6564 6261      task["feedba
-00016460: 636b 5f73 756d 6d61 7279 225d 203d 2073  ck_summary"] = s
-00016470: 746f 7261 6765 2e67 6574 5f66 6565 6462  torage.get_feedb
-00016480: 6163 6b5f 7375 6d6d 6172 7928 0a20 2020  ack_summary(.   
-00016490: 2020 2020 2063 6f75 7273 652c 0a20 2020       course,.   
-000164a0: 2020 2020 2073 656d 6573 7465 722c 0a20       semester,. 
-000164b0: 2020 2020 2020 2074 6173 6b5f 696e 666f         task_info
-000164c0: 2c0a 2020 2020 2020 2020 7573 6572 6e61  ,.        userna
-000164d0: 6d65 2c0a 2020 2020 2020 2020 7068 6173  me,.        phas
-000164e0: 652c 0a20 2020 2020 2020 2070 7369 642c  e,.        psid,
-000164f0: 0a20 2020 2020 2020 2074 6173 6b5b 2269  .        task["i
-00016500: 6422 5d0a 2020 2020 290a 2020 2020 7461  d"].    ).    ta
-00016510: 736b 5b22 7469 6d65 5f73 7065 6e74 225d  sk["time_spent"]
-00016520: 203d 2073 746f 7261 6765 2e66 6574 6368   = storage.fetch
-00016530: 5f74 696d 655f 7370 656e 7428 0a20 2020  _time_spent(.   
-00016540: 2020 2020 2063 6f75 7273 652c 0a20 2020       course,.   
-00016550: 2020 2020 2073 656d 6573 7465 722c 0a20       semester,. 
-00016560: 2020 2020 2020 2075 7365 726e 616d 652c         username,
-00016570: 0a20 2020 2020 2020 2070 6861 7365 2c0a  .        phase,.
-00016580: 2020 2020 2020 2020 7073 6964 2c0a 2020          psid,.  
-00016590: 2020 2020 2020 7461 736b 5b22 6964 225d        task["id"]
-000165a0: 0a20 2020 2029 0a0a 2020 2020 2320 4765  .    )..    # Ge
-000165b0: 7420 7375 626d 6974 7465 6420 7661 6c75  t submitted valu
-000165c0: 650a 2020 2020 2320 4e6f 7465 2074 6861  e.    # Note tha
-000165d0: 7420 7765 2068 6564 6765 2068 6572 6520  t we hedge here 
-000165e0: 6167 6169 6e73 7420 7468 6520 706f 7373  against the poss
-000165f0: 6962 696c 6974 7920 7468 6174 2074 6865  ibility that the
-00016600: 2066 6565 6462 6163 6b0a 2020 2020 2320   feedback.    # 
-00016610: 7375 6d6d 6172 7920 6973 6e27 7420 7265  summary isn't re
-00016620: 6164 6162 6c65 2073 696e 6365 2073 6f6d  adable since som
-00016630: 6520 6b69 6e64 7320 6f66 2062 6164 2063  e kinds of bad c
-00016640: 7261 7368 6573 206f 6620 7468 650a 2020  rashes of the.  
-00016650: 2020 2320 6576 616c 7561 746f 7220 6361    # evaluator ca
-00016660: 6e20 6361 7573 6520 7468 6174 2074 6f20  n cause that to 
-00016670: 6861 7070 656e 2028 652e 672e 2c20 7374  happen (e.g., st
-00016680: 7564 656e 7420 6163 6369 6465 6e74 616c  udent accidental
-00016690: 6c79 0a20 2020 2023 206d 6f6e 6b65 792d  ly.    # monkey-
-000166a0: 7061 7463 6865 7320 6a73 6f6e 2e64 756d  patches json.dum
-000166b0: 7020 736f 2074 6861 7420 6e6f 2072 6570  p so that no rep
-000166c0: 6f72 7420 6361 6e20 6265 2077 7269 7474  ort can be writt
-000166d0: 656e 292e 0a20 2020 2074 6173 6b5b 2273  en)..    task["s
-000166e0: 7562 6d69 7474 6564 225d 203d 2028 7461  ubmitted"] = (ta
-000166f0: 736b 2e67 6574 2822 6665 6564 6261 636b  sk.get("feedback
-00016700: 5f73 756d 6d61 7279 2229 206f 7220 7b7d  _summary") or {}
-00016710: 292e 6765 7428 2273 7562 6d69 7474 6564  ).get("submitted
-00016720: 2229 0a0a 2020 2020 2320 4765 7420 696e  ")..    # Get in
-00016730: 666c 6967 6874 2069 6e66 6f20 736f 2077  flight info so w
-00016740: 6520 6b6e 6f77 2061 626f 7574 2074 696d  e know about tim
-00016750: 656f 7574 730a 2020 2020 7473 2c20 6c6f  eouts.    ts, lo
-00016760: 6766 696c 652c 2072 6570 6f72 7466 696c  gfile, reportfil
-00016770: 652c 2073 7461 7475 7320 3d20 7374 6f72  e, status = stor
-00016780: 6167 652e 6765 745f 696e 666c 6967 6874  age.get_inflight
-00016790: 280a 2020 2020 2020 2020 636f 7572 7365  (.        course
-000167a0: 2c0a 2020 2020 2020 2020 7365 6d65 7374  ,.        semest
-000167b0: 6572 2c0a 2020 2020 2020 2020 7573 6572  er,.        user
-000167c0: 6e61 6d65 2c0a 2020 2020 2020 2020 7068  name,.        ph
-000167d0: 6173 652c 0a20 2020 2020 2020 2070 7369  ase,.        psi
-000167e0: 642c 0a20 2020 2020 2020 2074 6173 6b5b  d,.        task[
-000167f0: 2269 6422 5d0a 2020 2020 290a 0a20 2020  "id"].    )..   
-00016800: 2023 2047 6574 2063 7572 7265 6e74 2074   # Get current t
-00016810: 696d 6520 2849 4e20 5554 4329 0a20 2020  ime (IN UTC).   
-00016820: 206e 6f77 203d 2070 6f74 6c75 636b 2e74   now = potluck.t
-00016830: 696d 655f 7574 696c 732e 6e6f 7728 290a  ime_utils.now().
-00016840: 0a20 2020 2023 2054 696d 6520 7375 626d  .    # Time subm
-00016850: 6974 7465 6420 616e 6420 7469 6d65 2065  itted and time e
-00016860: 6c61 7073 6564 2073 696e 6365 2073 7562  lapsed since sub
-00016870: 6d69 7373 696f 6e0a 2020 2020 6966 2074  mission.    if t
-00016880: 7320 3d3d 2022 6572 726f 7222 3a0a 2020  s == "error":.  
-00016890: 2020 2020 2020 7461 736b 5b22 7375 626d        task["subm
-000168a0: 6974 7465 645f 6174 225d 203d 2022 756e  itted_at"] = "un
-000168b0: 6b6e 6f77 6e22 0a20 2020 2020 2020 2074  known".        t
-000168c0: 6173 6b5b 2265 7661 6c5f 656c 6170 7365  ask["eval_elapse
-000168d0: 6422 5d20 3d20 2275 6e6b 6e6f 776e 220a  d"] = "unknown".
-000168e0: 2020 2020 656c 6966 2074 7320 6973 206e      elif ts is n
-000168f0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00016900: 2073 7562 6d69 745f 7469 6d65 203d 2070   submit_time = p
-00016910: 6f74 6c75 636b 2e74 696d 655f 7574 696c  otluck.time_util
-00016920: 732e 6c6f 6361 6c5f 7469 6d65 280a 2020  s.local_time(.  
-00016930: 2020 2020 2020 2020 2020 7461 736b 5f69            task_i
-00016940: 6e66 6f2c 0a20 2020 2020 2020 2020 2020  nfo,.           
-00016950: 2070 6f74 6c75 636b 2e74 696d 655f 7574   potluck.time_ut
-00016960: 696c 732e 7469 6d65 5f66 726f 6d5f 7469  ils.time_from_ti
-00016970: 6d65 7374 7269 6e67 2874 7329 0a20 2020  mestring(ts).   
-00016980: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
-00016990: 6173 6b5b 2273 7562 6d69 7474 6564 5f61  ask["submitted_a
-000169a0: 7422 5d20 3d20 7375 626d 6974 5f74 696d  t"] = submit_tim
-000169b0: 650a 2020 2020 2020 2020 7461 736b 5b22  e.        task["
-000169c0: 6576 616c 5f65 6c61 7073 6564 225d 203d  eval_elapsed"] =
-000169d0: 206e 6f77 202d 2073 7562 6d69 745f 7469   now - submit_ti
-000169e0: 6d65 0a20 2020 2065 6c73 653a 0a20 2020  me.    else:.   
-000169f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00016a00: 2020 2020 2020 7375 626d 6974 5f74 696d        submit_tim
-00016a10: 6520 3d20 706f 746c 7563 6b2e 7469 6d65  e = potluck.time
-00016a20: 5f75 7469 6c73 2e6c 6f63 616c 5f74 696d  _utils.local_tim
-00016a30: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00016a40: 2020 2074 6173 6b5f 696e 666f 2c0a 2020     task_info,.  
-00016a50: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00016a60: 746c 7563 6b2e 7469 6d65 5f75 7469 6c73  tluck.time_utils
-00016a70: 2e74 696d 655f 6672 6f6d 5f74 696d 6573  .time_from_times
-00016a80: 7472 696e 6728 0a20 2020 2020 2020 2020  tring(.         
-00016a90: 2020 2020 2020 2020 2020 2074 6173 6b5b             task[
-00016aa0: 2266 6565 6462 6163 6b5f 7375 6d6d 6172  "feedback_summar
-00016ab0: 7922 5d5b 2274 696d 6573 7461 6d70 225d  y"]["timestamp"]
-00016ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ad0: 2029 0a20 2020 2020 2020 2020 2020 2029   ).            )
-00016ae0: 0a20 2020 2020 2020 2020 2020 2074 6173  .            tas
-00016af0: 6b5b 2273 7562 6d69 7474 6564 5f61 7422  k["submitted_at"
-00016b00: 5d20 3d20 7375 626d 6974 5f74 696d 650a  ] = submit_time.
-00016b10: 2020 2020 2020 2020 2020 2020 7461 736b              task
-00016b20: 5b22 6576 616c 5f65 6c61 7073 6564 225d  ["eval_elapsed"]
-00016b30: 203d 206e 6f77 202d 2073 7562 6d69 745f   = now - submit_
-00016b40: 7469 6d65 0a20 2020 2020 2020 2065 7863  time.        exc
-00016b50: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00016b60: 2020 2020 2020 2020 2020 2074 6173 6b5b             task[
-00016b70: 2273 7562 6d69 7474 6564 5f61 7422 5d20  "submitted_at"] 
-00016b80: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-00016b90: 2020 2074 6173 6b5b 2265 7661 6c5f 656c     task["eval_el
-00016ba0: 6170 7365 6422 5d20 3d20 4e6f 6e65 0a0a  apsed"] = None..
-00016bb0: 2020 2020 7461 736b 5b22 6576 616c 5f74      task["eval_t
-00016bc0: 696d 656f 7574 225d 203d 2064 6174 6574  imeout"] = datet
-00016bd0: 696d 652e 7469 6d65 6465 6c74 6128 0a20  ime.timedelta(. 
-00016be0: 2020 2020 2020 2073 6563 6f6e 6473 3d61         seconds=a
-00016bf0: 7070 2e63 6f6e 6669 675b 2246 494e 414c  pp.config["FINAL
-00016c00: 5f45 5641 4c5f 5449 4d45 4f55 5422 5d0a  _EVAL_TIMEOUT"].
-00016c10: 2020 2020 290a 0a20 2020 2023 2053 6574      )..    # Set
-00016c20: 2065 7661 6c5f 7374 6174 7573 0a20 2020   eval_status.   
-00016c30: 2069 6620 7473 203d 3d20 2265 7272 6f72   if ts == "error
-00016c40: 223a 0a20 2020 2020 2020 2074 6173 6b5b  ":.        task[
-00016c50: 2265 7661 6c5f 7374 6174 7573 225d 203d  "eval_status"] =
-00016c60: 2022 756e 6b6e 6f77 6e22 0a20 2020 2065   "unknown".    e
-00016c70: 6c73 653a 0a20 2020 2020 2020 2074 6173  lse:.        tas
-00016c80: 6b5b 2265 7661 6c5f 7374 6174 7573 225d  k["eval_status"]
-00016c90: 203d 2073 7461 7475 730a 0a20 2020 2023   = status..    #
-00016ca0: 204f 7665 7272 6964 6520 7375 626d 6974   Override submit
-00016cb0: 7465 6420 7661 6c75 650a 2020 2020 6966  ted value.    if
-00016cc0: 2073 7461 7475 7320 6973 206e 6f74 204e   status is not N
-00016cd0: 6f6e 653a 0a20 2020 2020 2020 2074 6173  one:.        tas
-00016ce0: 6b5b 2273 7562 6d69 7474 6564 225d 203d  k["submitted"] =
-00016cf0: 2054 7275 650a 0a20 2020 2023 2041 6464   True..    # Add
-00016d00: 206d 6178 2073 636f 7265 2069 6e66 6f0a   max score info.
-00016d10: 2020 2020 6d61 785f 7363 6f72 6520 3d20      max_score = 
-00016d20: 6170 702e 636f 6e66 6967 2e67 6574 2822  app.config.get("
-00016d30: 5343 4f52 455f 4241 5349 5322 2c20 3130  SCORE_BASIS", 10
-00016d40: 3029 0a20 2020 2072 6576 6973 696f 6e5f  0).    revision_
-00016d50: 6d61 7820 3d20 6170 702e 636f 6e66 6967  max = app.config
-00016d60: 2e67 6574 2822 5245 5649 5349 4f4e 5f4d  .get("REVISION_M
-00016d70: 4158 5f53 434f 5245 222c 2031 3030 290a  AX_SCORE", 100).
-00016d80: 2020 2020 6265 6c61 7465 645f 6d61 7820      belated_max 
-00016d90: 3d20 6170 702e 636f 6e66 6967 2e67 6574  = app.config.get
-00016da0: 2822 4245 4c41 5445 445f 4d41 585f 5343  ("BELATED_MAX_SC
-00016db0: 4f52 4522 2c20 3835 290a 2020 2020 6966  ORE", 85).    if
-00016dc0: 2070 6861 7365 203d 3d20 2272 6576 6973   phase == "revis
-00016dd0: 696f 6e22 3a0a 2020 2020 2020 2020 7461  ion":.        ta
-00016de0: 736b 5b22 6d61 785f 7363 6f72 6522 5d20  sk["max_score"] 
-00016df0: 3d20 7265 7669 7369 6f6e 5f6d 6178 0a20  = revision_max. 
-00016e00: 2020 2065 6c69 6620 7068 6173 6520 3d3d     elif phase ==
-00016e10: 2022 6265 6c61 7465 6422 3a0a 2020 2020   "belated":.    
-00016e20: 2020 2020 7461 736b 5b22 6d61 785f 7363      task["max_sc
-00016e30: 6f72 6522 5d20 3d20 6265 6c61 7465 645f  ore"] = belated_
-00016e40: 6d61 780a 2020 2020 656c 7365 3a0a 2020  max.    else:.  
-00016e50: 2020 2020 2020 7461 736b 5b22 6d61 785f        task["max_
-00016e60: 7363 6f72 6522 5d20 3d20 6d61 785f 7363  score"] = max_sc
-00016e70: 6f72 650a 2020 2020 7461 736b 5b22 6d61  ore.    task["ma
-00016e80: 785f 7265 7669 7369 6f6e 5f73 636f 7265  x_revision_score
-00016e90: 225d 203d 2072 6576 6973 696f 6e5f 6d61  "] = revision_ma
-00016ea0: 780a 2020 2020 7461 736b 5b22 6d61 785f  x.    task["max_
-00016eb0: 6265 6c61 7465 645f 7363 6f72 6522 5d20  belated_score"] 
-00016ec0: 3d20 6265 6c61 7465 645f 6d61 780a 0a20  = belated_max.. 
-00016ed0: 2020 2023 2041 6464 2067 7261 6465 2069     # Add grade i
-00016ee0: 6e66 6f0a 2020 2020 6966 2074 6173 6b5b  nfo.    if task[
-00016ef0: 2265 7661 6c5f 7374 6174 7573 225d 2069  "eval_status"] i
-00016f00: 6e20 2822 756e 6b6e 6f77 6e22 2c20 2269  n ("unknown", "i
-00016f10: 6e69 7469 616c 222c 2022 696e 5f70 726f  nitial", "in_pro
-00016f20: 6772 6573 7322 293a 0a20 2020 2020 2020  gress"):.       
-00016f30: 2074 6173 6b5b 2267 7261 6465 225d 203d   task["grade"] =
-00016f40: 2022 3f22 0a20 2020 2065 6c69 6620 7461   "?".    elif ta
-00016f50: 736b 5b22 6576 616c 5f73 7461 7475 7322  sk["eval_status"
-00016f60: 5d20 696e 2028 2265 7272 6f72 222c 2022  ] in ("error", "
-00016f70: 6578 7069 7265 6422 293a 0a20 2020 2020  expired"):.     
-00016f80: 2020 2074 6173 6b5b 2267 7261 6465 225d     task["grade"]
-00016f90: 203d 2030 0a20 2020 2065 6c69 6620 7461   = 0.    elif ta
-00016fa0: 736b 5b22 6576 616c 5f73 7461 7475 7322  sk["eval_status"
-00016fb0: 5d20 3d3d 2022 636f 6d70 6c65 7465 6422  ] == "completed"
-00016fc0: 206f 7220 7461 736b 5b22 7375 626d 6974   or task["submit
-00016fd0: 7465 6422 5d3a 0a20 2020 2020 2020 2074  ted"]:.        t
-00016fe0: 6173 6b5b 2267 7261 6465 225d 203d 2061  ask["grade"] = a
-00016ff0: 7070 2e63 6f6e 6669 675b 2245 5641 4c55  pp.config["EVALU
-00017000: 4154 494f 4e5f 5343 4f52 4553 225d 2e67  ATION_SCORES"].g
-00017010: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
-00017020: 7461 736b 5b22 6665 6564 6261 636b 5f73  task["feedback_s
-00017030: 756d 6d61 7279 225d 5b22 6576 616c 7561  ummary"]["evalua
-00017040: 7469 6f6e 225d 2c0a 2020 2020 2020 2020  tion"],.        
-00017050: 2020 2020 6170 702e 636f 6e66 6967 5b22      app.config["
-00017060: 4556 414c 5541 5449 4f4e 5f53 434f 5245  EVALUATION_SCORE
-00017070: 5322 5d2e 6765 7428 225f 5f6f 7468 6572  S"].get("__other
-00017080: 5f5f 222c 2022 3f3f 3f22 290a 2020 2020  __", "???").    
-00017090: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-000170a0: 2074 6173 6b5b 2267 7261 6465 225d 203d   task["grade"] =
-000170b0: 3d20 223f 3f3f 223a 0a20 2020 2020 2020  = "???":.       
-000170c0: 2020 2020 2066 6c61 736b 2e66 6c61 7368       flask.flash
-000170d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000170e0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-000170f0: 2020 2020 2020 2020 2257 6172 6e69 6e67          "Warning
-00017100: 3a20 6576 616c 7561 7469 6f6e 2027 7b7d  : evaluation '{}
-00017110: 2720 6861 7320 6e6f 7420 6265 656e 2061  ' has not been a
-00017120: 7373 6967 6e65 6420 6122 0a20 2020 2020  ssigned a".     
-00017130: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-00017140: 2067 7261 6465 2076 616c 7565 2122 0a20   grade value!". 
-00017150: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00017160: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
-00017170: 2020 2020 2020 2020 2020 2020 2074 6173               tas
-00017180: 6b5b 2266 6565 6462 6163 6b5f 7375 6d6d  k["feedback_summ
-00017190: 6172 7922 5d5b 2265 7661 6c75 6174 696f  ary"]["evaluatio
-000171a0: 6e22 5d0a 2020 2020 2020 2020 2020 2020  n"].            
-000171b0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000171c0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000171d0: 7461 736b 5b22 6772 6164 6522 5d20 3d20  task["grade"] = 
-000171e0: 4e6f 6e65 0a20 2020 2065 6c73 653a 0a20  None.    else:. 
-000171f0: 2020 2020 2020 2074 6173 6b5b 2267 7261         task["gra
-00017200: 6465 225d 203d 204e 6f6e 650a 0a20 2020  de"] = None..   
-00017210: 2023 2043 6865 636b 2066 6f72 2061 2067   # Check for a g
-00017220: 7261 6465 206f 7665 7272 6964 6520 616e  rade override an
-00017230: 6420 6772 6164 696e 6720 6e6f 7465 0a20  d grading note. 
-00017240: 2020 206e 6f74 6573 2c20 6e6f 7465 735f     notes, notes_
-00017250: 6874 6d6c 2c20 6f76 6572 7269 6465 2c20  html, override, 
-00017260: 7469 6d65 6c69 6e65 7373 5f6f 7665 7272  timeliness_overr
-00017270: 6964 6520 3d20 6765 745f 6576 616c 7561  ide = get_evalua
-00017280: 7469 6f6e 5f69 6e66 6f28 0a20 2020 2020  tion_info(.     
-00017290: 2020 2063 6f75 7273 652c 0a20 2020 2020     course,.     
-000172a0: 2020 2073 656d 6573 7465 722c 0a20 2020     semester,.   
-000172b0: 2020 2020 2075 7365 726e 616d 652c 0a20       username,. 
-000172c0: 2020 2020 2020 2070 6861 7365 2c0a 2020         phase,.  
-000172d0: 2020 2020 2020 7073 6964 2c0a 2020 2020        psid,.    
-000172e0: 2020 2020 7461 736b 5b22 6964 225d 0a20      task["id"]. 
-000172f0: 2020 2029 0a20 2020 2074 6173 6b5b 226e     ).    task["n
-00017300: 6f74 6573 225d 203d 206e 6f74 6573 0a20  otes"] = notes. 
-00017310: 2020 2074 6173 6b5b 226e 6f74 6573 5f68     task["notes_h
-00017320: 746d 6c22 5d20 3d20 6e6f 7465 735f 6874  tml"] = notes_ht
-00017330: 6d6c 0a20 2020 2069 6620 6f76 6572 7269  ml.    if overri
-00017340: 6465 203d 3d20 2727 3a0a 2020 2020 2020  de == '':.      
-00017350: 2020 7461 736b 5b22 6772 6164 655f 6f76    task["grade_ov
-00017360: 6572 7269 6464 656e 225d 203d 2046 616c  erridden"] = Fal
-00017370: 7365 0a20 2020 2065 6c73 653a 0a20 2020  se.    else:.   
-00017380: 2020 2020 2074 6173 6b5b 2267 7261 6465       task["grade
-00017390: 5f6f 7665 7272 6964 6465 6e22 5d20 3d20  _overridden"] = 
-000173a0: 5472 7565 0a20 2020 2020 2020 2074 6173  True.        tas
-000173b0: 6b5b 2267 7261 6465 225d 203d 206f 7665  k["grade"] = ove
-000173c0: 7272 6964 650a 0a20 2020 2069 6620 7469  rride..    if ti
-000173d0: 6d65 6c69 6e65 7373 5f6f 7665 7272 6964  meliness_overrid
-000173e0: 6520 3d3d 2027 273a 0a20 2020 2020 2020  e == '':.       
-000173f0: 2074 6173 6b5b 2274 696d 656c 696e 6573   task["timelines
-00017400: 735f 6f76 6572 7269 6464 656e 225d 203d  s_overridden"] =
-00017410: 2046 616c 7365 0a20 2020 2020 2020 2023   False.        #
-00017420: 204e 6f20 7469 6d65 6c69 6e65 7373 2073   No timeliness s
-00017430: 6c6f 7420 6174 2061 6c6c 0a20 2020 2065  lot at all.    e
-00017440: 6c73 653a 0a20 2020 2020 2020 2069 6620  lse:.        if 
-00017450: 7068 6173 6520 213d 2027 696e 6974 6961  phase != 'initia
-00017460: 6c27 3a0a 2020 2020 2020 2020 2020 2020  l':.            
-00017470: 666c 6173 6b2e 666c 6173 6828 0a20 2020  flask.flash(.   
-00017480: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
-00017490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174a0: 2020 2022 5761 726e 696e 673a 2074 696d     "Warning: tim
-000174b0: 656c 696e 6573 7320 6f76 6572 7269 6465  eliness override
-000174c0: 207b 7d20 666f 7220 7b7d 207b 7d20 696e   {} for {} {} in
-000174d0: 2070 6861 7365 220a 2020 2020 2020 2020   phase".        
-000174e0: 2020 2020 2020 2020 2020 2020 2220 7b7d              " {}
-000174f0: 2077 696c 6c20 6265 2069 676e 6f72 6564   will be ignored
-00017500: 3a20 6f6e 6c79 206f 7665 7272 6964 6573  : only overrides
-00017510: 2066 6f72 2074 6865 220a 2020 2020 2020   for the".      
-00017520: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00017530: 696e 6974 6961 6c20 7068 6173 6520 6172  initial phase ar
-00017540: 6520 6170 706c 6965 642e 220a 2020 2020  e applied.".    
-00017550: 2020 2020 2020 2020 2020 2020 292e 666f              ).fo
-00017560: 726d 6174 2874 696d 656c 696e 6573 735f  rmat(timeliness_
-00017570: 6f76 6572 7269 6465 2c20 7073 6964 2c20  override, psid, 
-00017580: 7461 736b 5b22 6964 225d 2c20 7068 6173  task["id"], phas
-00017590: 6529 0a20 2020 2020 2020 2020 2020 2029  e).            )
-000175a0: 0a20 2020 2020 2020 2074 6173 6b5b 2274  .        task["t
-000175b0: 696d 656c 696e 6573 735f 6f76 6572 7269  imeliness_overri
-000175c0: 6464 656e 225d 203d 2054 7275 650a 2020  dden"] = True.  
-000175d0: 2020 2020 2020 7461 736b 5b22 7469 6d65        task["time
-000175e0: 6c69 6e65 7373 225d 203d 2074 696d 656c  liness"] = timel
-000175f0: 696e 6573 735f 6f76 6572 7269 6465 0a0a  iness_override..
-00017600: 2020 2020 2320 5365 7420 6465 7461 696c      # Set detail
-00017610: 6564 2073 7562 6d69 7373 696f 6e20 7374  ed submission st
-00017620: 6174 7573 2061 6c6f 6e67 2077 6974 6820  atus along with 
-00017630: 6963 6f6e 2061 6e64 2064 6573 6372 6970  icon and descrip
-00017640: 7469 6f6e 0a20 2020 2069 6620 7461 736b  tion.    if task
-00017650: 5b22 6576 616c 5f73 7461 7475 7322 5d20  ["eval_status"] 
-00017660: 3d3d 2022 756e 6b6e 6f77 6e22 3a0a 2020  == "unknown":.  
-00017670: 2020 2020 2020 7461 736b 5b22 7375 626d        task["subm
-00017680: 6973 7369 6f6e 5f73 7461 7475 7322 5d20  ission_status"] 
-00017690: 3d20 2269 6e66 6c69 6768 7422 0a20 2020  = "inflight".   
-000176a0: 2020 2020 2074 6173 6b5b 2273 7562 6d69       task["submi
-000176b0: 7373 696f 6e5f 6963 6f6e 225d 203d 2022  ssion_icon"] = "
-000176c0: e280 bd22 0a20 2020 2020 2020 2074 6173  ...".        tas
-000176d0: 6b5b 2273 7562 6d69 7373 696f 6e5f 6465  k["submission_de
-000176e0: 7363 225d 203d 2022 7374 6174 7573 2075  sc"] = "status u
-000176f0: 6e6b 6e6f 776e 220a 2020 2020 6966 2074  nknown".    if t
-00017700: 6173 6b5b 2265 7661 6c5f 7374 6174 7573  ask["eval_status
-00017710: 225d 2069 6e20 2822 696e 6974 6961 6c22  "] in ("initial"
-00017720: 2c20 2269 6e5f 7072 6f67 7265 7373 2229  , "in_progress")
-00017730: 3a0a 2020 2020 2020 2020 7461 736b 5b22  :.        task["
-00017740: 7375 626d 6973 7369 6f6e 5f73 7461 7475  submission_statu
-00017750: 7322 5d20 3d20 2269 6e66 6c69 6768 7422  s"] = "inflight"
-00017760: 0a20 2020 2020 2020 2074 6173 6b5b 2273  .        task["s
-00017770: 7562 6d69 7373 696f 6e5f 6963 6f6e 225d  ubmission_icon"]
-00017780: 203d 2022 3f22 0a20 2020 2020 2020 2074   = "?".        t
-00017790: 6173 6b5b 2273 7562 6d69 7373 696f 6e5f  ask["submission_
-000177a0: 6465 7363 225d 203d 2022 6576 616c 7561  desc"] = "evalua
-000177b0: 7469 6f6e 2069 6e20 7072 6f67 7265 7373  tion in progress
-000177c0: 220a 2020 2020 656c 6966 2074 6173 6b5b  ".    elif task[
-000177d0: 2265 7661 6c5f 7374 6174 7573 225d 2069  "eval_status"] i
-000177e0: 6e20 2822 6572 726f 7222 2c20 2265 7870  n ("error", "exp
-000177f0: 6972 6564 2229 3a0a 2020 2020 2020 2020  ired"):.        
-00017800: 7461 736b 5b22 7375 626d 6973 7369 6f6e  task["submission
-00017810: 5f73 7461 7475 7322 5d20 3d20 2275 6e70  _status"] = "unp
-00017820: 726f 6365 7373 6564 220a 2020 2020 2020  rocessed".      
-00017830: 2020 7461 736b 5b22 7375 626d 6973 7369    task["submissi
-00017840: 6f6e 5f69 636f 6e22 5d20 3d20 22e2 98b9  on_icon"] = "...
-00017850: 220a 2020 2020 2020 2020 7461 736b 5b22  ".        task["
-00017860: 7375 626d 6973 7369 6f6e 5f64 6573 6322  submission_desc"
-00017870: 5d20 3d20 2270 726f 6365 7373 696e 6720  ] = "processing 
-00017880: 6572 726f 7222 0a20 2020 2065 6c69 6620  error".    elif 
-00017890: 7461 736b 5b22 6576 616c 5f73 7461 7475  task["eval_statu
-000178a0: 7322 5d20 3d3d 2022 636f 6d70 6c65 7465  s"] == "complete
-000178b0: 6422 206f 7220 7461 736b 5b22 7375 626d  d" or task["subm
-000178c0: 6974 7465 6422 5d3a 0a20 2020 2020 2020  itted"]:.       
-000178d0: 2072 6570 6f72 7420 3d20 7461 736b 5b22   report = task["
-000178e0: 6665 6564 6261 636b 5f73 756d 6d61 7279  feedback_summary
-000178f0: 225d 0a20 2020 2020 2020 2069 6620 7265  "].        if re
-00017900: 706f 7274 5b22 7761 726e 696e 6773 225d  port["warnings"]
-00017910: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
-00017920: 736b 5b22 7375 626d 6973 7369 6f6e 5f73  sk["submission_s
-00017930: 7461 7475 7322 5d20 3d20 2269 7373 7565  tatus"] = "issue
-00017940: 220a 2020 2020 2020 2020 2020 2020 7461  ".            ta
-00017950: 736b 5b22 7375 626d 6973 7369 6f6e 5f69  sk["submission_i
-00017960: 636f 6e22 5d20 3d20 22e2 9c97 220a 2020  con"] = "...".  
-00017970: 2020 2020 2020 2020 2020 7461 736b 5b22            task["
-00017980: 7375 626d 6973 7369 6f6e 5f64 6573 6322  submission_desc"
-00017990: 5d20 3d20 226d 616a 6f72 2069 7373 7565  ] = "major issue
-000179a0: 220a 2020 2020 2020 2020 656c 6966 2072  ".        elif r
-000179b0: 6570 6f72 745b 2265 7661 6c75 6174 696f  eport["evaluatio
-000179c0: 6e22 5d20 3d3d 2022 696e 636f 6d70 6c65  n"] == "incomple
-000179d0: 7465 223a 0a20 2020 2020 2020 2020 2020  te":.           
-000179e0: 2074 6173 6b5b 2273 7562 6d69 7373 696f   task["submissio
-000179f0: 6e5f 7374 6174 7573 225d 203d 2022 6973  n_status"] = "is
-00017a00: 7375 6522 0a20 2020 2020 2020 2020 2020  sue".           
-00017a10: 2074 6173 6b5b 2273 7562 6d69 7373 696f   task["submissio
-00017a20: 6e5f 6963 6f6e 225d 203d 2022 e29c 9722  n_icon"] = "..."
-00017a30: 0a20 2020 2020 2020 2020 2020 2074 6173  .            tas
-00017a40: 6b5b 2273 7562 6d69 7373 696f 6e5f 6465  k["submission_de
-00017a50: 7363 225d 203d 2022 696e 636f 6d70 6c65  sc"] = "incomple
-00017a60: 7465 2073 7562 6d69 7373 696f 6e22 0a20  te submission". 
-00017a70: 2020 2020 2020 2065 6c69 6620 7265 706f         elif repo
-00017a80: 7274 5b22 6576 616c 7561 7469 6f6e 225d  rt["evaluation"]
-00017a90: 203d 3d20 226e 6f74 2065 7661 6c75 6174   == "not evaluat
-00017aa0: 6564 223a 0a20 2020 2020 2020 2020 2020  ed":.           
-00017ab0: 2074 6173 6b5b 2273 7562 6d69 7373 696f   task["submissio
-00017ac0: 6e5f 7374 6174 7573 225d 203d 2022 756e  n_status"] = "un
-00017ad0: 7072 6f63 6573 7365 6422 0a20 2020 2020  processed".     
-00017ae0: 2020 2020 2020 2074 6173 6b5b 2273 7562         task["sub
-00017af0: 6d69 7373 696f 6e5f 6963 6f6e 225d 203d  mission_icon"] =
-00017b00: 2022 e298 b922 0a20 2020 2020 2020 2020   "...".         
-00017b10: 2020 2074 6173 6b5b 2273 7562 6d69 7373     task["submiss
-00017b20: 696f 6e5f 6465 7363 225d 203d 2022 7375  ion_desc"] = "su
-00017b30: 626d 6973 7369 6f6e 206e 6f74 2065 7661  bmission not eva
-00017b40: 6c75 6174 6564 220a 2020 2020 2020 2020  luated".        
-00017b50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00017b60: 2020 7461 736b 5b22 7375 626d 6973 7369    task["submissi
-00017b70: 6f6e 5f73 7461 7475 7322 5d20 3d20 2263  on_status"] = "c
-00017b80: 6f6d 706c 6574 6522 0a20 2020 2020 2020  omplete".       
-00017b90: 2020 2020 2074 6173 6b5b 2273 7562 6d69       task["submi
-00017ba0: 7373 696f 6e5f 6963 6f6e 225d 203d 2022  ssion_icon"] = "
-00017bb0: e29c 9322 0a20 2020 2020 2020 2020 2020  ...".           
-00017bc0: 2074 6173 6b5b 2273 7562 6d69 7373 696f   task["submissio
-00017bd0: 6e5f 6465 7363 225d 203d 2022 7375 626d  n_desc"] = "subm
-00017be0: 6974 7465 6422 0a20 2020 2065 6c73 653a  itted".    else:
-00017bf0: 0a20 2020 2020 2020 2074 6173 6b5b 2273  .        task["s
-00017c00: 7562 6d69 7373 696f 6e5f 7374 6174 7573  ubmission_status
-00017c10: 225d 203d 2022 756e 7375 626d 6974 7465  "] = "unsubmitte
-00017c20: 6422 0a20 2020 2020 2020 2074 6173 6b5b  d".        task[
-00017c30: 2273 7562 6d69 7373 696f 6e5f 6963 6f6e  "submission_icon
-00017c40: 225d 203d 2022 e280 a622 0a20 2020 2020  "] = "...".     
-00017c50: 2020 2074 6173 6b5b 2273 7562 6d69 7373     task["submiss
-00017c60: 696f 6e5f 6465 7363 225d 203d 2022 6e6f  ion_desc"] = "no
-00017c70: 7420 7965 7420 7375 626d 6974 7465 6422  t yet submitted"
-00017c80: 0a0a 0a64 6566 2065 7865 7263 6973 655f  ...def exercise_
-00017c90: 6372 6564 6974 2865 7865 7263 6973 655f  credit(exercise_
-00017ca0: 696e 666f 2c20 6f75 7463 6f6d 6573 293a  info, outcomes):
-00017cb0: 0a20 2020 2022 2222 0a20 2020 2052 6574  .    """.    Ret
-00017cc0: 7572 6e73 2061 2074 7269 706c 6520 636f  urns a triple co
-00017cd0: 6e74 6169 6e69 6e67 2061 2073 7562 6d69  ntaining a submi
-00017ce0: 7373 696f 6e20 7374 6174 7573 2073 7472  ssion status str
-00017cf0: 696e 672c 2061 206e 756d 6265 7220 666f  ing, a number fo
-00017d00: 720a 2020 2020 6578 6572 6369 7365 2063  r.    exercise c
-00017d10: 7265 6469 7420 286f 7220 4e6f 6e65 292c  redit (or None),
-00017d20: 2061 6e64 2061 206e 756d 6265 7220 666f   and a number fo
-00017d30: 7220 6772 6f75 7020 6372 6564 6974 2028  r group credit (
-00017d40: 706f 7373 6962 6c79 0a20 2020 2030 292e  possibly.    0).
-00017d50: 2054 6865 7365 2061 7265 2062 6173 6564   These are based
-00017d60: 206f 6e20 7768 6574 6865 7220 7468 6520   on whether the 
-00017d70: 6769 7665 6e20 6f75 7463 6f6d 6573 206c  given outcomes l
-00017d80: 6973 7420 6d61 7463 6865 7320 7468 650a  ist matches the.
-00017d90: 2020 2020 6578 7065 6374 6564 206f 7574      expected out
-00017da0: 636f 6d65 7320 666f 7220 7468 6520 6769  comes for the gi
-00017db0: 7665 6e20 6578 6572 6369 7365 2069 6e66  ven exercise inf
-00017dc0: 6f20 2873 686f 756c 6420 6265 2061 6e0a  o (should be an.
-00017dd0: 2020 2020 696e 6469 7669 6475 616c 2065      individual e
-00017de0: 7865 7263 6973 6520 6469 6374 696f 6e61  xercise dictiona
-00017df0: 7279 292e 0a0a 2020 2020 5468 6520 7374  ry)...    The st
-00017e00: 6174 7573 2073 7472 696e 6720 7769 6c6c  atus string will
-00017e10: 2062 6520 6f6e 6520 6f66 3a0a 0a20 2020   be one of:..   
-00017e20: 202d 2022 636f 6d70 6c65 7465 2220 6966   - "complete" if
-00017e30: 2061 6c6c 206f 7574 636f 6d65 7320 6172   all outcomes ar
-00017e40: 6520 7375 6363 6573 7366 756c 2e0a 2020  e successful..  
-00017e50: 2020 2d20 2270 6172 7469 616c 2220 6966    - "partial" if
-00017e60: 2073 6f6d 6520 6f75 7463 6f6d 6520 6661   some outcome fa
-00017e70: 696c 6564 2c20 6275 7420 6174 206c 6561  iled, but at lea
-00017e80: 7374 206f 6e65 206e 6f6e 2d70 6173 7369  st one non-passi
-00017e90: 7665 0a20 2020 2020 2020 206f 7574 636f  ve.        outco
-00017ea0: 6d65 2073 7563 6365 6564 6564 2028 7061  me succeeded (pa
-00017eb0: 7373 6976 6520 6f75 7463 6f6d 6573 2061  ssive outcomes a
-00017ec0: 7265 2074 686f 7365 2065 7870 6563 7465  re those expecte
-00017ed0: 6420 746f 2073 7563 6365 6564 0a20 2020  d to succeed.   
-00017ee0: 2020 2020 2065 7665 6e20 7768 656e 206e       even when n
-00017ef0: 6f20 636f 6465 2069 7320 7772 6974 7465  o code is writte
-00017f00: 6e20 6265 796f 6e64 2074 6865 2073 7461  n beyond the sta
-00017f10: 7274 6572 2063 6f64 652c 2062 7574 2077  rter code, but w
-00017f20: 6869 6368 0a20 2020 2020 2020 206d 6179  hich.        may
-00017f30: 2066 6169 6c20 6966 2062 6164 2063 6f64   fail if bad cod
-00017f40: 6520 6973 2077 7269 7474 656e 292e 0a20  e is written).. 
-00017f50: 2020 202d 2022 696e 636f 6d70 6c65 7465     - "incomplete
-00017f60: 2220 6966 206e 6f74 2065 6e6f 7567 6820  " if not enough 
-00017f70: 6f75 7463 6f6d 6573 2061 7265 2073 7563  outcomes are suc
-00017f80: 6365 7373 6675 6c20 666f 7220 7061 7274  cessful for part
-00017f90: 6961 6c0a 2020 2020 2020 2020 636f 6d70  ial.        comp
-00017fa0: 6c65 7465 6e65 7373 2c20 6f72 2069 6620  leteness, or if 
-00017fb0: 7468 6572 6527 7320 616e 2069 7373 7565  there's an issue
-00017fc0: 206c 696b 6520 7468 6520 7772 6f6e 6720   like the wrong 
-00017fd0: 6e75 6d62 6572 206f 660a 2020 2020 2020  number of.      
-00017fe0: 2020 6f75 7463 6f6d 6573 2062 6569 6e67    outcomes being
-00017ff0: 2072 6570 6f72 7465 642e 0a0a 2020 2020   reported...    
-00018000: 5468 6973 2066 756e 6374 696f 6e20 776f  This function wo
-00018010: 6e27 7420 7265 7475 726e 2069 742c 2062  n't return it, b
-00018020: 7574 2022 756e 7375 626d 6974 7465 6422  ut "unsubmitted"
-00018030: 2069 7320 616e 6f74 6865 7220 706f 7373   is another poss
-00018040: 6962 6c65 0a20 2020 2073 7461 7475 7320  ible.    status 
-00018050: 7374 7269 6e67 2075 7365 6420 656c 7365  string used else
-00018060: 7768 6572 652e 0a20 2020 2022 2222 0a20  where..    """. 
-00018070: 2020 2067 726f 7570 5f63 7265 6469 7420     group_credit 
-00018080: 3d20 300a 2020 2020 6578 6572 6369 7365  = 0.    exercise
-00018090: 5f63 7265 6469 7420 3d20 4e6f 6e65 0a20  _credit = None. 
-000180a0: 2020 206e 5f6f 7574 636f 6d65 7320 3d20     n_outcomes = 
-000180b0: 6c65 6e28 6f75 7463 6f6d 6573 290a 0a20  len(outcomes).. 
-000180c0: 2020 2065 7870 5f6f 7574 636f 6d65 7320     exp_outcomes 
-000180d0: 3d20 6578 6572 6369 7365 5f69 6e66 6f2e  = exercise_info.
-000180e0: 6765 7428 2763 6f75 6e74 2729 0a20 2020  get('count').   
-000180f0: 2069 6620 6578 705f 6f75 7463 6f6d 6573   if exp_outcomes
-00018100: 2069 7320 4e6f 6e65 2061 6e64 2027 7065   is None and 'pe
-00018110: 725f 6f75 7463 6f6d 6527 2069 6e20 6578  r_outcome' in ex
-00018120: 6572 6369 7365 5f69 6e66 6f3a 0a20 2020  ercise_info:.   
-00018130: 2020 2020 2065 7870 5f6f 7574 636f 6d65       exp_outcome
-00018140: 7320 3d20 6c65 6e28 6578 6572 6369 7365  s = len(exercise
-00018150: 5f69 6e66 6f5b 2770 6572 5f6f 7574 636f  _info['per_outco
-00018160: 6d65 275d 290a 0a20 2020 2069 6620 6578  me'])..    if ex
-00018170: 705f 6f75 7463 6f6d 6573 2069 7320 4e6f  p_outcomes is No
-00018180: 6e65 3a0a 2020 2020 2020 2020 2320 5769  ne:.        # Wi
-00018190: 7468 6f75 7420 696e 666f 206f 6e20 686f  thout info on ho
-000181a0: 7720 6d61 6e79 206f 7574 636f 6d65 7320  w many outcomes 
-000181b0: 7765 2772 6520 6578 7065 6374 696e 672c  we're expecting,
-000181c0: 2077 6520 6375 7272 656e 746c 790a 2020   we currently.  
-000181d0: 2020 2020 2020 2320 646f 6e27 7420 6861        # don't ha
-000181e0: 7665 2061 2077 6179 2074 6f20 6b6e 6f77  ve a way to know
-000181f0: 2069 6620 616e 206f 7574 636f 6d65 2069   if an outcome i
-00018200: 7320 7061 7373 6976 6520 286f 7220 7768  s passive (or wh
-00018210: 6963 680a 2020 2020 2020 2020 2320 636f  ich.        # co
-00018220: 6e63 6570 7428 7329 2069 7420 6d69 6768  ncept(s) it migh
-00018230: 7420 6465 616c 2077 6974 6829 2e0a 2020  t deal with)..  
-00018240: 2020 2020 2020 2320 544f 444f 3a20 4c65        # TODO: Le
-00018250: 7373 2066 7261 6769 6c65 2077 6179 2074  ss fragile way t
-00018260: 6f20 6173 736f 6369 6174 6520 6f75 7463  o associate outc
-00018270: 6f6d 6573 2077 2f20 636f 6e63 6570 7473  omes w/ concepts
-00018280: 210a 0a20 2020 2020 2020 2023 2049 6e20  !..        # In 
-00018290: 7468 6973 2063 6173 652c 2061 7420 6c65  this case, at le
-000182a0: 6173 7420 6f6e 6520 6f75 7463 6f6d 6520  ast one outcome 
-000182b0: 6973 2072 6571 7569 7265 6421 0a20 2020  is required!.   
-000182c0: 2020 2020 2069 6620 6c65 6e28 6f75 7463       if len(outc
-000182d0: 6f6d 6573 2920 3d3d 2030 3a0a 2020 2020  omes) == 0:.    
-000182e0: 2020 2020 2020 2020 7375 626d 6973 7369          submissi
-000182f0: 6f6e 5f73 7461 7475 7320 3d20 2269 6e63  on_status = "inc
-00018300: 6f6d 706c 6574 6522 0a20 2020 2020 2020  omplete".       
-00018310: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00018320: 2020 2023 204f 7468 6572 7769 7365 2c20     # Otherwise, 
-00018330: 616c 6c2d 7375 6363 6573 7320 2d3e 2063  all-success -> c
-00018340: 6f6d 706c 6574 653b 206f 6e65 2b20 7375  omplete; one+ su
-00018350: 6363 6573 7320 2d3e 2070 6172 7469 616c  ccess -> partial
-00018360: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-00018370: 7365 6420 3d20 5b6f 7574 636f 6d65 2066  sed = [outcome f
-00018380: 6f72 206f 7574 636f 6d65 2069 6e20 6f75  or outcome in ou
-00018390: 7463 6f6d 6573 2069 6620 6f75 7463 6f6d  tcomes if outcom
-000183a0: 655b 305d 5d0a 2020 2020 2020 2020 2020  e[0]].          
-000183b0: 2020 6966 206c 656e 2870 6173 7365 6429    if len(passed)
-000183c0: 203d 3d20 6c65 6e28 6f75 7463 6f6d 6573   == len(outcomes
-000183d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000183e0: 2020 2073 7562 6d69 7373 696f 6e5f 7374     submission_st
-000183f0: 6174 7573 203d 2022 636f 6d70 6c65 7465  atus = "complete
-00018400: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00018410: 2020 6578 6572 6369 7365 5f63 7265 6469    exercise_credi
-00018420: 7420 3d20 310a 2020 2020 2020 2020 2020  t = 1.          
-00018430: 2020 656c 6966 206c 656e 2870 6173 7365    elif len(passe
-00018440: 6429 203e 2030 3a0a 2020 2020 2020 2020  d) > 0:.        
-00018450: 2020 2020 2020 2020 7375 626d 6973 7369          submissi
-00018460: 6f6e 5f73 7461 7475 7320 3d20 2270 6172  on_status = "par
-00018470: 7469 616c 220a 2020 2020 2020 2020 2020  tial".          
-00018480: 2020 2020 2020 6578 6572 6369 7365 5f63        exercise_c
-00018490: 7265 6469 7420 3d20 302e 350a 2020 2020  redit = 0.5.    
-000184a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000184b0: 2020 2020 2020 2020 2020 2020 2020 7375                su
-000184c0: 626d 6973 7369 6f6e 5f73 7461 7475 7320  bmission_status 
-000184d0: 3d20 2269 6e63 6f6d 706c 6574 6522 0a20  = "incomplete". 
-000184e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000184f0: 7865 7263 6973 655f 6372 6564 6974 203d  xercise_credit =
-00018500: 2030 0a20 2020 2020 2020 2020 2020 2023   0.            #
-00018510: 2041 6363 756d 756c 6174 6520 6372 6564   Accumulate cred
-00018520: 6974 0a20 2020 2020 2020 2020 2020 2067  it.            g
-00018530: 726f 7570 5f63 7265 6469 7420 2b3d 2065  roup_credit += e
-00018540: 7865 7263 6973 655f 6372 6564 6974 0a20  xercise_credit. 
-00018550: 2020 2065 6c69 6620 6e5f 6f75 7463 6f6d     elif n_outcom
-00018560: 6573 2021 3d20 6578 705f 6f75 7463 6f6d  es != exp_outcom
-00018570: 6573 3a0a 2020 2020 2020 2020 2320 4966  es:.        # If
-00018580: 2077 6520 6861 7665 2061 6e20 6578 7065   we have an expe
-00018590: 6374 6174 696f 6e20 666f 7220 7468 6520  ctation for the 
-000185a0: 6e75 6d62 6572 206f 6620 6f75 7463 6f6d  number of outcom
-000185b0: 6573 2061 6e64 2074 6865 0a20 2020 2020  es and the.     
-000185c0: 2020 2023 2061 6374 7561 6c20 6e75 6d62     # actual numb
-000185d0: 6572 2064 6f65 736e 2774 206d 6174 6368  er doesn't match
-000185e0: 2074 6861 742c 2077 6520 776f 6e27 7420   that, we won't 
-000185f0: 6b6e 6f77 2077 6869 6368 206f 7574 636f  know which outco
-00018600: 6d65 730a 2020 2020 2020 2020 2320 6d69  mes.        # mi
-00018610: 6768 7420 6265 2070 6173 7369 7665 2076  ght be passive v
-00018620: 732e 2061 6374 6976 652c 2061 6e64 2077  s. active, and w
-00018630: 6520 646f 6e27 7420 6b6e 6f77 2068 6f77  e don't know how
-00018640: 2074 6f20 6d61 700a 2020 2020 2020 2020   to map.        
-00018650: 2320 6f75 7463 6f6d 6573 206f 6e74 6f20  # outcomes onto 
-00018660: 7065 722d 6f75 7463 6f6d 6520 636f 6e63  per-outcome conc
-00018670: 6570 7473 2e2e 2e20 736f 2077 6520 6a75  epts... so we ju
-00018680: 7374 2069 676e 6f72 6520 7468 650a 2020  st ignore the.  
-00018690: 2020 2020 2020 2320 7768 6f6c 6520 6578        # whole ex
-000186a0: 6572 6369 7365 2061 6e64 2063 6f75 6e74  ercise and count
-000186b0: 2069 7420 6173 206e 6f74 2d79 6574 2d73   it as not-yet-s
-000186c0: 7562 6d69 7474 6564 2e0a 2020 2020 2020  ubmitted..      
-000186d0: 2020 2320 544f 444f 3a20 4c65 7373 2066    # TODO: Less f
-000186e0: 7261 6769 6c65 2077 6179 2074 6f20 6173  ragile way to as
-000186f0: 736f 6369 6174 6520 6f75 7463 6f6d 6573  sociate outcomes
-00018700: 2077 2f20 636f 6e63 6570 7473 210a 2020   w/ concepts!.  
-00018710: 2020 2020 2020 7375 626d 6973 7369 6f6e        submission
-00018720: 5f73 7461 7475 7320 3d20 2269 6e63 6f6d  _status = "incom
-00018730: 706c 6574 6522 0a20 2020 2020 2020 2023  plete".        #
-00018740: 204e 6f20 6772 6f75 7020 6372 6564 6974   No group credit
-00018750: 2061 6363 7275 6573 2069 6e20 7468 6973   accrues in this
-00018760: 2063 6173 650a 2020 2020 656c 6966 206c   case.    elif l
-00018770: 656e 286f 7574 636f 6d65 7329 203d 3d20  en(outcomes) == 
-00018780: 303a 0a20 2020 2020 2020 2023 2074 6869  0:.        # thi
-00018790: 7320 6578 6572 6369 7365 2064 6f65 736e  s exercise doesn
-000187a0: 2774 2063 6f6e 7472 6962 7574 6520 746f  't contribute to
-000187b0: 2061 6e79 2063 6f6e 6365 7074 0a20 2020   any concept.   
-000187c0: 2020 2020 2023 2073 7461 7475 7365 732c       # statuses,
-000187d0: 2061 6e64 2074 6861 7427 7320 696e 7465   and that's inte
-000187e0: 6e74 696f 6e61 6c2e 2053 696e 6365 2069  ntional. Since i
-000187f0: 7420 646f 6573 6e27 740a 2020 2020 2020  t doesn't.      
-00018800: 2020 2320 6861 7665 206f 7574 636f 6d65    # have outcome
-00018810: 732c 2061 6e79 2073 7562 6d69 7373 696f  s, any submissio
-00018820: 6e20 636f 756e 7473 2061 7320 636f 6d70  n counts as comp
-00018830: 6c65 7465 2e0a 2020 2020 2020 2020 7375  lete..        su
-00018840: 626d 6973 7369 6f6e 5f73 7461 7475 7320  bmission_status 
-00018850: 3d20 2263 6f6d 706c 6574 6522 0a20 2020  = "complete".   
-00018860: 2020 2020 2023 2048 6572 6520 7765 2064       # Here we d
-00018870: 6972 6563 746c 7920 6164 6420 746f 2067  irectly add to g
-00018880: 726f 7570 2063 7265 6469 7420 6275 7420  roup credit but 
-00018890: 6c65 6176 650a 2020 2020 2020 2020 2320  leave.        # 
-000188a0: 6578 6572 6369 7365 5f63 7265 6469 7420  exercise_credit 
-000188b0: 6173 204e 6f6e 652e 0a20 2020 2020 2020  as None..       
-000188c0: 2067 726f 7570 5f63 7265 6469 7420 2b3d   group_credit +=
-000188d0: 2031 0a20 2020 2065 6c73 653a 0a20 2020   1.    else:.   
-000188e0: 2020 2020 2023 2047 6574 206c 6973 7420       # Get list 
-000188f0: 6f66 206f 7574 636f 6d65 2069 6e64 6963  of outcome indic
-00018900: 6573 2066 6f72 2073 7563 6365 7373 6573  es for successes
-00018910: 0a20 2020 2020 2020 2070 6173 7365 6420  .        passed 
-00018920: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-00018930: 690a 2020 2020 2020 2020 2020 2020 666f  i.            fo
-00018940: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-00018950: 286f 7574 636f 6d65 7329 290a 2020 2020  (outcomes)).    
-00018960: 2020 2020 2020 2020 6966 206f 7574 636f          if outco
-00018970: 6d65 735b 695d 5b30 5d0a 2020 2020 2020  mes[i][0].      
-00018980: 2020 5d0a 2020 2020 2020 2020 2320 4765    ].        # Ge
-00018990: 7420 6c69 7374 206f 6620 7768 6963 6820  t list of which 
-000189a0: 6f75 7463 6f6d 6573 2061 7265 2070 6173  outcomes are pas
-000189b0: 7369 7665 0a20 2020 2020 2020 2070 6173  sive.        pas
-000189c0: 7369 7665 7320 3d20 6578 6572 6369 7365  sives = exercise
-000189d0: 5f69 6e66 6f2e 6765 7428 2270 6173 7369  _info.get("passi
-000189e0: 7665 222c 205b 5d29 0a20 2020 2020 2020  ve", []).       
-000189f0: 2069 6620 6c65 6e28 7061 7373 6564 2920   if len(passed) 
-00018a00: 3d3d 206e 5f6f 7574 636f 6d65 733a 0a20  == n_outcomes:. 
-00018a10: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-00018a20: 6576 6572 7974 6869 6e67 2070 6173 7365  everything passe
-00018a30: 642c 2074 6865 206f 7665 7261 6c6c 2069  d, the overall i
-00018a40: 7320 6120 7061 7373 0a20 2020 2020 2020  s a pass.       
-00018a50: 2020 2020 2065 7865 7263 6973 655f 6372       exercise_cr
-00018a60: 6564 6974 203d 2031 0a20 2020 2020 2020  edit = 1.       
-00018a70: 2020 2020 2073 7562 6d69 7373 696f 6e5f       submission_
-00018a80: 7374 6174 7573 203d 2022 636f 6d70 6c65  status = "comple
-00018a90: 7465 220a 2020 2020 2020 2020 656c 6966  te".        elif
-00018aa0: 2061 6e79 2869 206e 6f74 2069 6e20 7061   any(i not in pa
-00018ab0: 7373 6976 6573 2066 6f72 2069 2069 6e20  ssives for i in 
-00018ac0: 7061 7373 6564 293a 0a20 2020 2020 2020  passed):.       
-00018ad0: 2020 2020 2023 2061 7420 6c65 6173 7420       # at least 
-00018ae0: 6f6e 6520 6e6f 6e2d 7061 7373 6976 6520  one non-passive 
-00018af0: 7061 7373 6564 202d 3e20 7061 7274 6961  passed -> partia
-00018b00: 6c0a 2020 2020 2020 2020 2020 2020 6578  l.            ex
-00018b10: 6572 6369 7365 5f63 7265 6469 7420 3d20  ercise_credit = 
-00018b20: 302e 350a 2020 2020 2020 2020 2020 2020  0.5.            
-00018b30: 7375 626d 6973 7369 6f6e 5f73 7461 7475  submission_statu
-00018b40: 7320 3d20 2270 6172 7469 616c 220a 2020  s = "partial".  
-00018b50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00018b60: 2020 2020 2020 2020 2320 6f6e 6c79 2070          # only p
-00018b70: 6173 7369 6e67 2074 6573 7473 2077 6572  assing tests wer
-00018b80: 6520 7061 7274 6961 6c20 2620 6174 206c  e partial & at l
-00018b90: 6561 7374 206f 6e65 0a20 2020 2020 2020  east one.       
-00018ba0: 2020 2020 2023 2066 6169 6c65 6420 2d3e       # failed ->
-00018bb0: 206e 6f20 6372 6564 6974 0a20 2020 2020   no credit.     
-00018bc0: 2020 2020 2020 2065 7865 7263 6973 655f         exercise_
-00018bd0: 6372 6564 6974 203d 2030 0a20 2020 2020  credit = 0.     
-00018be0: 2020 2020 2020 2073 7562 6d69 7373 696f         submissio
-00018bf0: 6e5f 7374 6174 7573 203d 2022 696e 636f  n_status = "inco
-00018c00: 6d70 6c65 7465 220a 0a20 2020 2020 2020  mplete"..       
-00018c10: 2023 2041 6363 756d 756c 6174 6520 6372   # Accumulate cr
-00018c20: 6564 6974 0a20 2020 2020 2020 2067 726f  edit.        gro
-00018c30: 7570 5f63 7265 6469 7420 2b3d 2065 7865  up_credit += exe
-00018c40: 7263 6973 655f 6372 6564 6974 0a0a 2020  rcise_credit..  
-00018c50: 2020 7265 7475 726e 2028 7375 626d 6973    return (submis
-00018c60: 7369 6f6e 5f73 7461 7475 732c 2065 7865  sion_status, exe
-00018c70: 7263 6973 655f 6372 6564 6974 2c20 6772  rcise_credit, gr
-00018c80: 6f75 705f 6372 6564 6974 290a 0a0a 6465  oup_credit)...de
-00018c90: 6620 7365 745f 636f 6e63 6570 745f 7374  f set_concept_st
-00018ca0: 6174 7573 6573 2863 6f6e 6365 7074 732c  atuses(concepts,
-00018cb0: 2074 6173 6b5f 696e 666f 2c20 6f75 7463   task_info, outc
-00018cc0: 6f6d 6573 293a 0a20 2020 2022 2222 0a20  omes):.    """. 
-00018cd0: 2020 2055 7064 6174 6573 2074 6865 2070     Updates the p
-00018ce0: 726f 7669 6465 6420 636f 6e63 6570 7473  rovided concepts
-00018cf0: 206c 6973 7420 2877 686f 7365 2065 6c65   list (whose ele
-00018d00: 6d65 6e74 7320 6172 6520 636f 6e63 6570  ments are concep
-00018d10: 740a 2020 2020 6469 6374 696f 6e61 7269  t.    dictionari
-00018d20: 6573 2077 6869 6368 206d 6967 6874 2068  es which might h
-00018d30: 6176 6520 2266 6163 6574 7322 2073 6c6f  ave "facets" slo
-00018d40: 7473 2074 6861 7420 6861 7665 2073 7562  ts that have sub
-00018d50: 2d63 6f6e 6365 7074 730a 2020 2020 696e  -concepts.    in
-00018d60: 2074 6865 6d29 2077 6974 6820 7374 6174   them) with stat
-00018d70: 7573 2069 6e66 6f20 6261 7365 6420 6f6e  us info based on
-00018d80: 2074 6865 2067 6976 656e 2028 616d 656e   the given (amen
-00018d90: 6465 6429 2074 6173 6b20 696e 666f 2061  ded) task info a
-00018da0: 6e64 0a20 2020 2065 7865 7263 6973 6520  nd.    exercise 
-00018db0: 6f75 7463 6f6d 6573 2070 726f 7669 6465  outcomes provide
-00018dc0: 642e 2041 6c73 6f20 7570 6461 7465 7320  d. Also updates 
-00018dd0: 7468 6520 7461 736b 2069 6e66 6f20 7769  the task info wi
-00018de0: 7468 2074 696d 6520 2b0a 2020 2020 7375  th time +.    su
-00018df0: 626d 6973 7369 6f6e 2073 7461 7475 7365  bmission statuse
-00018e00: 7320 666f 7220 6561 6368 2065 7865 7263  s for each exerc
-00018e10: 6973 652e 0a0a 2020 2020 5468 6520 636f  ise...    The co
-00018e20: 6e63 6570 7473 2064 6963 7469 6f6e 6172  ncepts dictionar
-00018e30: 7920 6973 2064 6972 6563 746c 7920 6175  y is directly au
-00018e40: 676d 656e 7465 6420 736f 2074 6861 7420  gmented so that 
-00018e50: 6561 6368 2063 6f6e 6365 7074 0a20 2020  each concept.   
-00018e60: 2068 6173 2074 6865 2066 6f6c 6c6f 7769   has the followi
-00018e70: 6e67 2073 6c6f 7473 3a0a 2020 2020 2d20  ng slots:.    - 
-00018e80: 2273 7461 7475 7322 2068 6f6c 6469 6e67  "status" holding
-00018e90: 2061 6e20 6167 6772 6567 6174 6520 7374   an aggregate st
-00018ea0: 6174 7573 2073 7472 696e 670a 2020 2020  atus string.    
-00018eb0: 2d20 226f 7574 636f 6d65 7322 2068 6f6c  - "outcomes" hol
-00018ec0: 6469 6e67 2061 206c 6973 7420 6f66 2072  ding a list of r
-00018ed0: 656c 6576 616e 7420 6f75 7463 6f6d 6573  elevant outcomes
-00018ee0: 2074 7570 6c65 7320 4561 6368 206f 7574   tuples Each out
-00018ef0: 636f 6d65 0a20 2020 2020 2020 2074 7570  come.        tup
-00018f00: 6c65 2068 6173 2061 6e20 6578 6572 6369  le has an exerci
-00018f10: 7365 2f74 6173 6b2d 6964 2c20 6120 6e75  se/task-id, a nu
-00018f20: 6d65 7269 6320 2830 2d31 2920 6f75 7463  meric (0-1) outc
-00018f30: 6f6d 6520 7661 6c75 652c 0a20 2020 2020  ome value,.     
-00018f40: 2020 2061 6e64 2073 7472 696e 6720 2827     and string ('
-00018f50: 7461 736b 272c 2027 6578 6572 6369 7365  task', 'exercise
-00018f60: 272c 206f 7220 276f 7574 636f 6d65 2729  ', or 'outcome')
-00018f70: 2073 7065 6369 6679 696e 6720 7768 6574   specifying whet
-00018f80: 6865 720a 2020 2020 2020 2020 6974 2773  her.        it's
-00018f90: 2061 6e20 696e 6469 7669 6475 616c 206f   an individual o
-00018fa0: 7574 636f 6d65 206f 7220 616e 2061 6767  utcome or an agg
-00018fb0: 7265 6761 7465 206f 7574 636f 6d65 2066  regate outcome f
-00018fc0: 726f 6d20 6120 7461 736b 0a20 2020 2020  rom a task.     
-00018fd0: 2020 206f 7220 6578 6572 6369 7365 2e0a     or exercise..
-00018fe0: 2020 2020 2d20 2265 7865 7263 6973 6573      - "exercises
-00018ff0: 2220 686f 6c64 696e 6720 6120 6469 6374  " holding a dict
-00019000: 696f 6e61 7279 206d 6170 7069 6e67 2065  ionary mapping e
-00019010: 7865 7263 6973 6520 4944 7320 746f 0a20  xercise IDs to. 
-00019020: 2020 2020 2020 2070 6861 7365 2f73 7461         phase/sta
-00019030: 7475 7320 7374 7269 6e67 2070 6169 7273  tus string pairs
-00019040: 2066 6f72 2065 7865 7263 6973 6573 2077   for exercises w
-00019050: 6869 6368 2061 7265 2072 656c 6576 616e  hich are relevan
-00019060: 7420 746f 0a20 2020 2020 2020 2074 6869  t to.        thi
-00019070: 7320 636f 6e63 6570 742e 2054 6865 2066  s concept. The f
-00019080: 6972 7374 2073 7472 696e 6720 7265 7072  irst string repr
-00019090: 6573 656e 7473 2070 6861 7365 2061 7320  esents phase as 
-000190a0: 6f6e 6520 6f66 0a20 2020 2020 2020 2022  one of.        "
-000190b0: 7072 6572 656c 6561 7365 222c 2022 7265  prerelease", "re
-000190c0: 6c65 6173 6564 222c 206f 7220 2264 7565  leased", or "due
-000190d0: 2220 746f 2073 7065 6369 6679 2074 6865  " to specify the
-000190e0: 2065 7865 7263 6973 6527 730a 2020 2020   exercise's.    
-000190f0: 2020 2020 7265 6c65 6173 6520 7374 6174      release stat
-00019100: 7573 2c20 616e 6420 7468 6520 7365 636f  us, and the seco
-00019110: 6e64 2069 7320 6f6e 6520 6f66 2022 636f  nd is one of "co
-00019120: 6d70 6c65 7465 222c 2022 7061 7274 6961  mplete", "partia
-00019130: 6c22 2c0a 2020 2020 2020 2020 2269 6e63  l",.        "inc
-00019140: 6f6d 706c 6574 6522 2c20 6f72 2022 756e  omplete", or "un
-00019150: 7375 626d 6974 7465 6422 2074 6f20 7370  submitted" to sp
-00019160: 6563 6966 7920 7468 6520 6578 6572 6369  ecify the exerci
-00019170: 7365 2773 0a20 2020 2020 2020 2073 7562  se's.        sub
-00019180: 6d69 7373 696f 6e20 7374 6174 7573 2e20  mission status. 
-00019190: 4578 6572 6369 7365 2049 4473 2077 6f6e  Exercise IDs won
-000191a0: 2774 2065 7665 6e20 6265 2069 6e20 7468  't even be in th
-000191b0: 6973 206c 6973 7420 6966 0a20 2020 2020  is list if.     
-000191c0: 2020 2074 6865 7920 6861 7665 6e27 7420     they haven't 
-000191d0: 6265 656e 2073 7562 6d69 7474 6564 2079  been submitted y
-000191e0: 6574 2e0a 0a20 2020 2049 6e20 7468 6520  et...    In the 
-000191f0: 7461 736b 2069 6e66 6f2c 2065 6163 6820  task info, each 
-00019200: 6578 6572 6369 7365 2067 726f 7570 2077  exercise group w
-00019210: 696c 6c20 6761 696e 2061 2022 7068 6173  ill gain a "phas
-00019220: 6522 2073 6c6f 7420 7769 7468 0a20 2020  e" slot with.   
-00019230: 2061 2073 7472 696e 6720 696e 6469 6361   a string indica
-00019240: 7469 6e67 2077 6869 6368 2074 696d 6520  ting which time 
-00019250: 7068 6173 6520 6974 2773 2069 6e20 2873  phase it's in (s
-00019260: 6565 2074 6865 2022 6578 6572 6369 7365  ee the "exercise
-00019270: 7322 0a20 2020 2065 6e74 7279 2061 626f  s".    entry abo
-00019280: 7665 292e 2041 6c73 6f2c 2065 6163 6820  ve). Also, each 
-00019290: 696e 6469 7669 6475 616c 2065 7865 7263  individual exerc
-000192a0: 6973 6520 7768 6963 6820 6861 7320 6265  ise which has be
-000192b0: 656e 2073 7562 6d69 7474 6564 0a20 2020  en submitted.   
-000192c0: 2077 696c 6c20 6761 696e 2061 2022 7374   will gain a "st
-000192d0: 6174 7573 2220 736c 6f74 2077 6974 6820  atus" slot with 
-000192e0: 6120 7375 626d 6973 7369 6f6e 2073 7461  a submission sta
-000192f0: 7475 7320 7374 7269 6e67 2028 616c 736f  tus string (also
-00019300: 2073 6565 0a20 2020 2061 626f 7665 292e   see.    above).
-00019310: 2046 696e 616c 6c79 2c20 7468 6520 6578   Finally, the ex
-00019320: 6572 6369 7365 2067 726f 7570 7320 7769  ercise groups wi
-00019330: 6c6c 2067 6169 6e20 6120 2273 7461 7475  ll gain a "statu
-00019340: 7322 2073 6c6f 740a 2020 2020 6167 6772  s" slot.    aggr
-00019350: 6567 6174 696e 6720 7468 6520 7374 6174  egating the stat
-00019360: 7573 6573 206f 6620 6974 7320 636f 6d70  uses of its comp
-00019370: 6f6e 656e 7473 2c20 6465 7065 6e64 696e  onents, dependin
-00019380: 6720 6f6e 2069 7473 2070 6861 7365 2e0a  g on its phase..
-00019390: 2020 2020 5468 6973 2067 726f 7570 2073      This group s
-000193a0: 7461 7475 7320 6973 2064 6574 6572 6d69  tatus is determi
-000193b0: 6e65 6420 6173 2066 6f6c 6c6f 7773 3a0a  ned as follows:.
-000193c0: 0a20 2020 2031 2e20 4966 2061 6c6c 206f  .    1. If all o
-000193d0: 6620 7468 6520 6578 6572 6369 7365 7320  f the exercises 
-000193e0: 696e 2074 6865 2067 726f 7570 2061 7265  in the group are
-000193f0: 2063 6f6d 706c 6574 652c 2069 7420 636f   complete, it co
-00019400: 756e 7473 2061 730a 2020 2020 2020 2020  unts as.        
-00019410: 2270 6572 6665 6374 222e 0a20 2020 2032  "perfect"..    2
-00019420: 2e20 4966 2061 7420 6c65 6173 7420 3830  . If at least 80
-00019430: 2520 2863 6f6e 6669 6775 7261 626c 6520  % (configurable 
-00019440: 6173 2060 4558 4552 4349 5345 5f47 524f  as `EXERCISE_GRO
-00019450: 5550 5f54 4852 4553 484f 4c44 6029 206f  UP_THRESHOLD`) o
-00019460: 660a 2020 2020 2020 2020 7468 6520 6578  f.        the ex
-00019470: 6572 6369 7365 7320 696e 2074 6865 2067  ercises in the g
-00019480: 726f 7570 2061 7265 2063 6f6d 706c 6574  roup are complet
-00019490: 6520 2863 6f75 6e74 696e 670a 2020 2020  e (counting.    
-000194a0: 2020 2020 7061 7274 6961 6c6c 792d 636f      partially-co
-000194b0: 6d70 6c65 7465 2065 7865 7263 6973 6573  mplete exercises
-000194c0: 2061 7320 312f 3229 2074 6865 6e20 7468   as 1/2) then th
-000194d0: 6520 6772 6f75 7020 636f 756e 7473 2061  e group counts a
-000194e0: 730a 2020 2020 2020 2020 2263 6f6d 706c  s.        "compl
-000194f0: 6574 6522 2e0a 2020 2020 332e 2049 6620  ete"..    3. If 
-00019500: 6174 206c 6561 7374 2060 4558 4552 4349  at least `EXERCI
-00019510: 5345 5f47 524f 5550 5f50 4152 5449 414c  SE_GROUP_PARTIAL
-00019520: 5f54 4852 4553 484f 4c44 6020 2864 6566  _THRESHOLD` (def
-00019530: 6175 6c74 2032 2f35 2920 6275 740a 2020  ault 2/5) but.  
-00019540: 2020 2020 2020 6c65 7373 2074 6861 6e20        less than 
-00019550: 7468 6520 6045 5845 5243 4953 455f 4752  the `EXERCISE_GR
-00019560: 4f55 505f 5448 5245 5348 4f4c 4460 2066  OUP_THRESHOLD` f
-00019570: 7261 6374 696f 6e20 6f66 2074 6865 0a20  raction of the. 
-00019580: 2020 2020 2020 2065 7865 7263 6973 6573         exercises
-00019590: 2061 7265 2063 6f6d 706c 6574 652c 2061   are complete, a
-000195a0: 6e64 2074 6865 2070 6861 7365 2069 7320  nd the phase is 
-000195b0: 2264 7565 2220 7468 656e 2074 6865 2073  "due" then the s
-000195c0: 7461 7475 730a 2020 2020 2020 2020 7769  tatus.        wi
-000195d0: 6c6c 2062 6520 2270 6172 7469 616c 222e  ll be "partial".
-000195e0: 0a20 2020 2034 2e20 4966 2061 2073 6d61  .    4. If a sma
-000195f0: 6c6c 6572 2066 7261 6374 696f 6e20 7468  ller fraction th
-00019600: 616e 2060 4558 4552 4349 5345 5f47 524f  an `EXERCISE_GRO
-00019610: 5550 5f50 4152 5449 414c 5f54 4852 4553  UP_PARTIAL_THRES
-00019620: 484f 4c44 6020 6f66 0a20 2020 2020 2020  HOLD` of.       
-00019630: 2074 6865 2065 7865 7263 6973 6573 2061   the exercises a
-00019640: 7265 2063 6f6d 706c 6574 6520 2873 7469  re complete (sti
-00019650: 6c6c 2063 6f75 6e74 696e 6720 7061 7274  ll counting part
-00019660: 6961 6c20 636f 6d70 6c65 7469 6f6e 730a  ial completions.
-00019670: 2020 2020 2020 2020 6173 2031 2f32 2920          as 1/2) 
-00019680: 616e 6420 7468 6520 7068 6173 6520 6973  and the phase is
-00019690: 2022 6475 6522 2074 6865 6e20 7468 6520   "due" then the 
-000196a0: 7374 6174 7573 2077 696c 6c20 6265 0a20  status will be. 
-000196b0: 2020 2020 2020 2022 696e 636f 6d70 6c65         "incomple
-000196c0: 7465 222e 0a20 2020 2035 2e20 4966 2074  te"..    5. If t
-000196d0: 6865 2073 7461 7475 7320 776f 756c 6420  he status would 
-000196e0: 6265 206c 6573 7320 7468 616e 2022 636f  be less than "co
-000196f0: 6d70 6c65 7465 2220 6275 7420 7468 6520  mplete" but the 
-00019700: 7068 6173 6520 6973 0a20 2020 2020 2020  phase is.       
-00019710: 2022 7265 6c65 6173 6564 2220 696e 7374   "released" inst
-00019720: 6561 6420 6f66 2022 6475 6522 2074 6865  ead of "due" the
-00019730: 6e20 7468 6520 7374 6174 7573 2077 696c  n the status wil
-00019740: 6c20 6265 2022 7065 6e64 696e 6722 0a20  l be "pending". 
-00019750: 2020 2020 2020 2028 696e 636c 7564 696e         (includin
-00019760: 6720 7768 656e 207a 6572 6f20 6578 6572  g when zero exer
-00019770: 6369 7365 7320 6861 7665 2062 6565 6e20  cises have been 
-00019780: 7375 626d 6974 7465 6420 7965 7429 2e0a  submitted yet)..
-00019790: 2020 2020 362e 2049 6620 7468 6520 7068      6. If the ph
-000197a0: 6173 6520 6973 2022 7072 6572 656c 6561  ase is "prerelea
-000197b0: 7365 2220 7468 656e 2074 6865 2073 7461  se" then the sta
-000197c0: 7475 7320 7769 6c6c 2062 6520 2275 6e72  tus will be "unr
-000197d0: 656c 6561 7365 6422 0a20 2020 2020 2020  eleased".       
-000197e0: 2075 6e6c 6573 7320 7375 626d 6973 7369   unless submissi
-000197f0: 6f6e 7320 746f 206f 6e65 206f 7220 6d6f  ons to one or mo
-00019800: 7265 2065 7865 7263 6973 6573 2068 6176  re exercises hav
-00019810: 6520 616c 7265 6164 790a 2020 2020 2020  e already.      
-00019820: 2020 6861 7070 656e 6564 2c20 696e 2077    happened, in w
-00019830: 6869 6368 2063 6173 6520 6974 7320 7374  hich case its st
-00019840: 6174 7573 2077 696c 6c20 6265 206f 6e65  atus will be one
-00019850: 206f 6620 2270 656e 6469 6e67 222c 0a20   of "pending",. 
-00019860: 2020 2020 2020 2022 636f 6d70 6c65 7465         "complete
-00019870: 222c 206f 7220 2270 6572 6665 6374 2220  ", or "perfect" 
-00019880: 6465 7065 6e64 696e 6720 6f6e 2068 6f77  depending on how
-00019890: 206d 616e 7920 6578 6572 6369 7365 7320   many exercises 
-000198a0: 6172 650a 2020 2020 2020 2020 636f 6d70  are.        comp
-000198b0: 6c65 7465 2e0a 0a20 2020 2054 6865 2063  lete...    The c
-000198c0: 6f6e 6365 7074 7320 6c69 7374 206d 7573  oncepts list mus
-000198d0: 7420 616c 7265 6164 7920 6265 2061 7567  t already be aug
-000198e0: 6d65 6e74 6564 2076 6961 2060 6175 676d  mented via `augm
-000198f0: 656e 745f 636f 6e63 6570 7473 602e 0a20  ent_concepts`.. 
-00019900: 2020 2022 2222 0a20 2020 2023 2047 6574     """.    # Get
-00019910: 2063 7572 7265 6e74 2074 696d 653a 0a20   current time:. 
-00019920: 2020 2069 6620 2250 4155 5345 5f41 5422     if "PAUSE_AT"
-00019930: 2069 6e20 7461 736b 5f69 6e66 6f20 616e   in task_info an
-00019940: 6420 7461 736b 5f69 6e66 6f5b 2250 4155  d task_info["PAU
-00019950: 5345 5f41 5422 5d3a 0a20 2020 2020 2020  SE_AT"]:.       
-00019960: 206e 6f77 203d 2070 6f74 6c75 636b 2e74   now = potluck.t
-00019970: 696d 655f 7574 696c 732e 7461 736b 5f74  ime_utils.task_t
-00019980: 696d 655f 5f74 696d 6528 0a20 2020 2020  ime__time(.     
-00019990: 2020 2020 2020 2074 6173 6b5f 696e 666f         task_info
-000199a0: 2c0a 2020 2020 2020 2020 2020 2020 7461  ,.            ta
-000199b0: 736b 5f69 6e66 6f5b 2250 4155 5345 5f41  sk_info["PAUSE_A
-000199c0: 5422 5d0a 2020 2020 2020 2020 290a 2020  T"].        ).  
-000199d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000199e0: 6e6f 7720 3d20 706f 746c 7563 6b2e 7469  now = potluck.ti
-000199f0: 6d65 5f75 7469 6c73 2e6e 6f77 2829 0a0a  me_utils.now()..
-00019a00: 2020 2020 2320 4174 7461 6368 206f 7574      # Attach out
-00019a10: 636f 6d65 7320 746f 2063 6f6e 6365 7074  comes to concept
-00019a20: 7320 6261 7365 6420 6f6e 2065 7865 7263  s based on exerc
-00019a30: 6973 6520 696e 666f 0a20 2020 2066 6f72  ise info.    for
-00019a40: 2067 726f 7570 2069 6e20 7461 736b 5f69   group in task_i
-00019a50: 6e66 6f2e 6765 7428 2265 7865 7263 6973  nfo.get("exercis
-00019a60: 6573 222c 205b 5d29 3a0a 2020 2020 2020  es", []):.      
-00019a70: 2020 2320 4765 7420 7265 6c65 6173 6520    # Get release 
-00019a80: 2b20 7469 6d65 6c79 2074 696d 6573 0a20  + timely times. 
-00019a90: 2020 2020 2020 2072 656c 6561 7365 5f61         release_a
-00019aa0: 7420 3d20 706f 746c 7563 6b2e 7469 6d65  t = potluck.time
-00019ab0: 5f75 7469 6c73 2e74 6173 6b5f 7469 6d65  _utils.task_time
-00019ac0: 5f5f 7469 6d65 280a 2020 2020 2020 2020  __time(.        
-00019ad0: 2020 2020 7461 736b 5f69 6e66 6f2c 0a20      task_info,. 
-00019ae0: 2020 2020 2020 2020 2020 2067 726f 7570             group
-00019af0: 5b22 7265 6c65 6173 6522 5d2c 0a20 2020  ["release"],.   
-00019b00: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00019b10: 5f74 696d 655f 6f66 5f64 6179 3d74 6173  _time_of_day=tas
-00019b20: 6b5f 696e 666f 2e67 6574 280a 2020 2020  k_info.get(.    
-00019b30: 2020 2020 2020 2020 2020 2020 2264 6566              "def
-00019b40: 6175 6c74 5f72 656c 6561 7365 5f74 696d  ault_release_tim
-00019b50: 655f 6f66 5f64 6179 222c 0a20 2020 2020  e_of_day",.     
-00019b60: 2020 2020 2020 2020 2020 2022 3233 3a35             "23:5
-00019b70: 3922 0a20 2020 2020 2020 2020 2020 2029  9".            )
-00019b80: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00019b90: 2020 2074 696d 656c 795f 6279 203d 2070     timely_by = p
-00019ba0: 6f74 6c75 636b 2e74 696d 655f 7574 696c  otluck.time_util
-00019bb0: 732e 7461 736b 5f74 696d 655f 5f74 696d  s.task_time__tim
-00019bc0: 6528 0a20 2020 2020 2020 2020 2020 2074  e(.            t
-00019bd0: 6173 6b5f 696e 666f 2c0a 2020 2020 2020  ask_info,.      
-00019be0: 2020 2020 2020 6772 6f75 705b 2274 696d        group["tim
-00019bf0: 656c 7922 5d2c 0a20 2020 2020 2020 2020  ely"],.         
-00019c00: 2020 2064 6566 6175 6c74 5f74 696d 655f     default_time_
-00019c10: 6f66 5f64 6179 3d74 6173 6b5f 696e 666f  of_day=task_info
-00019c20: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
-00019c30: 2020 2020 2020 2264 6566 6175 6c74 5f72        "default_r
-00019c40: 656c 6561 7365 5f74 696d 655f 6f66 5f64  elease_time_of_d
-00019c50: 6179 222c 0a20 2020 2020 2020 2020 2020  ay",.           
-00019c60: 2020 2020 2022 3233 3a35 3922 0a20 2020       "23:59".   
-00019c70: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00019c80: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00019c90: 4669 6775 7265 206f 7574 2061 6e64 2061  Figure out and a
-00019ca0: 7070 6c79 2074 696d 6520 7068 6173 6520  pply time phase 
-00019cb0: 746f 2067 726f 7570 0a20 2020 2020 2020  to group.       
-00019cc0: 2069 6620 6e6f 7720 3c20 7265 6c65 6173   if now < releas
-00019cd0: 655f 6174 3a0a 2020 2020 2020 2020 2020  e_at:.          
-00019ce0: 2020 7068 6173 6520 3d20 2270 7265 7265    phase = "prere
-00019cf0: 6c65 6173 6522 0a20 2020 2020 2020 2065  lease".        e
-00019d00: 6c69 6620 6e6f 7720 3c20 7469 6d65 6c79  lif now < timely
-00019d10: 5f62 793a 0a20 2020 2020 2020 2020 2020  _by:.           
-00019d20: 2070 6861 7365 203d 2022 7265 6c65 6173   phase = "releas
-00019d30: 6564 220a 2020 2020 2020 2020 656c 7365  ed".        else
-00019d40: 3a0a 2020 2020 2020 2020 2020 2020 7068  :.            ph
-00019d50: 6173 6520 3d20 2264 7565 220a 2020 2020  ase = "due".    
-00019d60: 2020 2020 6772 6f75 705b 2270 6861 7365      group["phase
-00019d70: 225d 203d 2070 6861 7365 0a0a 2020 2020  "] = phase..    
-00019d80: 2020 2020 2320 5472 6163 6b73 2065 7865      # Tracks exe
-00019d90: 7263 6973 6520 6372 6564 6974 2026 206d  rcise credit & m
-00019da0: 6178 2066 6f72 2061 6c6c 2065 7865 7263  ax for all exerc
-00019db0: 6973 6573 2069 6e20 7468 6520 6772 6f75  ises in the grou
-00019dc0: 700a 2020 2020 2020 2020 6772 6f75 705f  p.        group_
-00019dd0: 6372 6564 6974 203d 2030 0a20 2020 2020  credit = 0.     
-00019de0: 2020 2067 726f 7570 5f6d 6178 203d 2030     group_max = 0
-00019df0: 0a0a 2020 2020 2020 2020 2320 4d61 6b65  ..        # Make
-00019e00: 2061 6c6c 6f77 616e 6365 7320 666f 7220   allowances for 
-00019e10: 6f6c 6420 666f 726d 6174 0a20 2020 2020  old format.     
-00019e20: 2020 2065 6c69 7374 203d 2067 726f 7570     elist = group
-00019e30: 5b22 6578 6572 6369 7365 7322 5d0a 2020  ["exercises"].  
-00019e40: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00019e50: 6e63 6528 656c 6973 742c 2064 6963 7429  nce(elist, dict)
-00019e60: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00019e70: 7220 6569 6420 696e 2065 6c69 7374 3a0a  r eid in elist:.
-00019e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e90: 656c 6973 745b 6569 645d 5b27 6964 275d  elist[eid]['id']
-00019ea0: 203d 2065 6964 0a20 2020 2020 2020 2020   = eid.         
-00019eb0: 2020 2065 6c69 7374 203d 206c 6973 7428     elist = list(
-00019ec0: 656c 6973 742e 7661 6c75 6573 2829 290a  elist.values()).
-00019ed0: 0a20 2020 2020 2020 2023 2043 6f6e 7369  .        # Consi
-00019ee0: 6465 7220 6561 6368 2069 6e64 6976 6964  der each individ
-00019ef0: 7561 6c20 6578 6572 6369 7365 2069 6e20  ual exercise in 
-00019f00: 7468 6520 6772 6f75 700a 2020 2020 2020  the group.      
-00019f10: 2020 666f 7220 6569 6e66 6f20 696e 2065    for einfo in e
-00019f20: 6c69 7374 3a0a 2020 2020 2020 2020 2020  list:.          
-00019f30: 2020 6569 6420 3d20 6569 6e66 6f5b 2769    eid = einfo['i
-00019f40: 6427 5d0a 2020 2020 2020 2020 2020 2020  d'].            
-00019f50: 2320 4164 6420 746f 206d 6178 2063 7265  # Add to max cre
-00019f60: 6469 740a 2020 2020 2020 2020 2020 2020  dit.            
-00019f70: 6772 6f75 705f 6d61 7820 2b3d 2031 0a20  group_max += 1. 
-00019f80: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
-00019f90: 2069 6e66 6f2c 2074 6167 2c20 616e 6420   info, tag, and 
-00019fa0: 6f75 7463 6f6d 6573 0a20 2020 2020 2020  outcomes.       
-00019fb0: 2020 2020 2065 7461 6720 3d20 227b 7d3a       etag = "{}:
-00019fc0: 7b7d 222e 666f 726d 6174 2867 726f 7570  {}".format(group
-00019fd0: 2c20 6569 6429 0a20 2020 2020 2020 2020  , eid).         
-00019fe0: 2020 206f 7574 636f 6d65 735f 6865 7265     outcomes_here
-00019ff0: 203d 206f 7574 636f 6d65 732e 6765 7428   = outcomes.get(
-0001a000: 6569 642c 207b 7d29 2e67 6574 2827 6f75  eid, {}).get('ou
-0001a010: 7463 6f6d 6573 272c 204e 6f6e 6529 0a0a  tcomes', None)..
-0001a020: 2020 2020 2020 2020 2020 2020 2320 5472              # Tr
-0001a030: 6163 6b20 6372 6564 6974 2028 6675 6c6c  ack credit (full
-0001a040: 2f70 6172 7469 616c 2920 666f 7220 7468  /partial) for th
-0001a050: 6973 2065 7865 7263 6973 650a 2020 2020  is exercise.    
-0001a060: 2020 2020 2020 2020 6563 7265 6469 7420          ecredit 
-0001a070: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
-0001a080: 2020 2020 2320 4966 2069 7420 6861 736e      # If it hasn
-0001a090: 2774 2062 6565 6e20 7375 626d 6974 7465  't been submitte
-0001a0a0: 642c 206e 6f74 6520 7468 6174 0a20 2020  d, note that.   
-0001a0b0: 2020 2020 2020 2020 2069 6620 6f75 7463           if outc
-0001a0c0: 6f6d 6573 5f68 6572 6520 6973 204e 6f6e  omes_here is Non
-0001a0d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001a0e0: 2020 2073 7562 6d69 7373 696f 6e5f 7374     submission_st
-0001a0f0: 6174 7573 203d 2022 756e 7375 626d 6974  atus = "unsubmit
-0001a100: 7465 6422 0a20 2020 2020 2020 2020 2020  ted".           
-0001a110: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001a120: 2020 2020 2020 2023 2047 6574 2073 7562         # Get sub
-0001a130: 6d69 7373 696f 6e20 7374 6174 7573 2026  mission status &
-0001a140: 2065 7865 7263 6973 6520 6372 6564 6974   exercise credit
-0001a150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a160: 2073 7562 6d69 7373 696f 6e5f 7374 6174   submission_stat
-0001a170: 7573 2c20 6563 7265 6469 742c 2067 6372  us, ecredit, gcr
-0001a180: 6564 6974 203d 2065 7865 7263 6973 655f  edit = exercise_
-0001a190: 6372 6564 6974 280a 2020 2020 2020 2020  credit(.        
-0001a1a0: 2020 2020 2020 2020 2020 2020 6569 6e66              einf
-0001a1b0: 6f2c 0a20 2020 2020 2020 2020 2020 2020  o,.             
-0001a1c0: 2020 2020 2020 206f 7574 636f 6d65 735f         outcomes_
-0001a1d0: 6865 7265 0a20 2020 2020 2020 2020 2020  here.           
-0001a1e0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001a1f0: 2020 2020 2020 2023 2041 6363 756d 756c         # Accumul
-0001a200: 6174 6520 6772 6f75 7020 6372 6564 6974  ate group credit
-0001a210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a220: 2067 726f 7570 5f63 7265 6469 7420 2b3d   group_credit +=
-0001a230: 2067 6372 6564 6974 0a0a 2020 2020 2020   gcredit..      
-0001a240: 2020 2020 2020 2320 4e6f 7465 2073 7562        # Note sub
-0001a250: 6d69 7373 696f 6e20 7374 6174 7573 0a20  mission status. 
-0001a260: 2020 2020 2020 2020 2020 2065 696e 666f             einfo
-0001a270: 5b22 7374 6174 7573 225d 203d 2073 7562  ["status"] = sub
-0001a280: 6d69 7373 696f 6e5f 7374 6174 7573 0a0a  mission_status..
-0001a290: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
-0001a2a0: 7273 7420 6170 706c 7920 6269 6e61 7279  rst apply binary
-0001a2b0: 2063 7265 6469 7420 746f 2065 6163 6820   credit to each 
-0001a2c0: 636f 6e63 6570 7420 666f 7220 7065 722d  concept for per-
-0001a2d0: 6f75 7463 6f6d 650a 2020 2020 2020 2020  outcome.        
-0001a2e0: 2020 2020 2320 636f 6e63 6570 7473 2c20      # concepts, 
-0001a2f0: 616e 6420 6173 736f 6369 6174 6520 7065  and associate pe
-0001a300: 722d 6f75 7463 6f6d 6520 6578 6572 6369  r-outcome exerci
-0001a310: 7365 2073 7461 7475 7365 7320 6173 0a20  se statuses as. 
-0001a320: 2020 2020 2020 2020 2020 2023 2077 656c             # wel
-0001a330: 6c2e 0a20 2020 2020 2020 2020 2020 2066  l..            f
-0001a340: 6f72 2069 2c20 656e 7472 7920 696e 2065  or i, entry in e
-0001a350: 6e75 6d65 7261 7465 2865 696e 666f 2e67  numerate(einfo.g
-0001a360: 6574 2822 7065 725f 6f75 7463 6f6d 6522  et("per_outcome"
-0001a370: 2c20 5b5d 2929 3a0a 2020 2020 2020 2020  , [])):.        
-0001a380: 2020 2020 2020 2020 2320 4174 7461 6368          # Attach
-0001a390: 2069 6e64 6976 6964 7561 6c20 6f75 7463   individual outc
-0001a3a0: 6f6d 6573 2074 6f20 6173 736f 6369 6174  omes to associat
-0001a3b0: 6564 2070 6572 2d6f 7574 636f 6d65 0a20  ed per-outcome. 
-0001a3c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a3d0: 2063 6f6e 6365 7074 730a 2020 2020 2020   concepts.      
-0001a3e0: 2020 2020 2020 2020 2020 6966 2065 6372            if ecr
-0001a3f0: 6564 6974 2069 7320 6e6f 7420 4e6f 6e65  edit is not None
-0001a400: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a410: 2020 2020 2020 2320 5265 706c 6163 6520        # Replace 
-0001a420: 5472 7565 2f46 616c 7365 2077 6974 6820  True/False with 
-0001a430: 312f 303a 0a20 2020 2020 2020 2020 2020  1/0:.           
-0001a440: 2020 2020 2020 2020 206f 7574 636f 6d65           outcome
-0001a450: 203d 206f 7574 636f 6d65 735f 6865 7265   = outcomes_here
-0001a460: 5b69 5d5b 3a5d 0a20 2020 2020 2020 2020  [i][:].         
-0001a470: 2020 2020 2020 2020 2020 206f 7574 636f             outco
-0001a480: 6d65 5b30 5d20 3d20 3120 6966 206f 7574  me[0] = 1 if out
-0001a490: 636f 6d65 5b30 5d20 656c 7365 2030 0a20  come[0] else 0. 
-0001a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4b0: 2020 206f 696e 666f 203d 2028 0a20 2020     oinfo = (.   
-0001a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4d0: 2020 2020 2027 7b7d 237b 7d27 2e66 6f72       '{}#{}'.for
-0001a4e0: 6d61 7428 6574 6167 2c20 6929 2c0a 2020  mat(etag, i),.  
-0001a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a500: 2020 2020 2020 3120 6966 206f 7574 636f        1 if outco
-0001a510: 6d65 5b30 5d20 656c 7365 2030 2c0a 2020  me[0] else 0,.  
-0001a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a530: 2020 2020 2020 226f 7574 636f 6d65 220a        "outcome".
-0001a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a550: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001a560: 2020 2020 2020 2020 2020 2320 4174 7461            # Atta
-0001a570: 6368 206f 7574 636f 6d65 0a20 2020 2020  ch outcome.     
-0001a580: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001a590: 7474 6163 685f 6f75 7463 6f6d 6528 636f  ttach_outcome(co
-0001a5a0: 6e63 6570 7473 2c20 6f69 6e66 6f2c 2065  ncepts, oinfo, e
-0001a5b0: 6e74 7279 290a 2020 2020 2020 2020 2020  ntry).          
-0001a5c0: 2020 2020 2020 2020 2020 6f75 7463 6f6d            outcom
-0001a5d0: 655f 7374 6174 7573 203d 2028 0a20 2020  e_status = (.   
-0001a5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5f0: 2020 2020 2022 636f 6d70 6c65 7465 220a       "complete".
-0001a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a610: 2020 2020 2020 2020 6966 206f 7574 636f          if outco
-0001a620: 6d65 5b30 5d0a 2020 2020 2020 2020 2020  me[0].          
-0001a630: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001a640: 7365 2022 696e 636f 6d70 6c65 7465 220a  se "incomplete".
-0001a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a660: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001a670: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a690: 6f75 7463 6f6d 655f 7374 6174 7573 203d  outcome_status =
-0001a6a0: 2073 7562 6d69 7373 696f 6e5f 7374 6174   submission_stat
-0001a6b0: 7573 0a0a 2020 2020 2020 2020 2020 2020  us..            
-0001a6c0: 2020 2020 2320 4e6f 7465 2065 7865 7263      # Note exerc
-0001a6d0: 6973 6520 7374 6174 7573 2066 6f72 2074  ise status for t
-0001a6e0: 6865 7365 2063 6f6e 6365 7074 7320 6173  hese concepts as
-0001a6f0: 2077 656c 6c2c 2062 7574 0a20 2020 2020   well, but.     
-0001a700: 2020 2020 2020 2020 2020 2023 2077 6974             # wit
-0001a710: 6820 7375 6363 6573 732f 6661 696c 7572  h success/failur
-0001a720: 6520 6261 7365 6420 6f6e 2069 6e64 6976  e based on indiv
-0001a730: 6964 7561 6c20 6f75 7463 6f6d 6573 0a20  idual outcomes. 
-0001a740: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001a750: 6f74 655f 6578 6572 6369 7365 5f73 7461  ote_exercise_sta
-0001a760: 7475 7328 0a20 2020 2020 2020 2020 2020  tus(.           
-0001a770: 2020 2020 2020 2020 2063 6f6e 6365 7074           concept
-0001a780: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0001a790: 2020 2020 2020 2065 6964 2c0a 2020 2020         eid,.    
-0001a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7b0: 2870 6861 7365 2c20 6f75 7463 6f6d 655f  (phase, outcome_
-0001a7c0: 7374 6174 7573 292c 0a20 2020 2020 2020  status),.       
-0001a7d0: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-0001a7e0: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
-0001a7f0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-0001a800: 2020 2320 4e6f 7720 6170 706c 7920 7468    # Now apply th
-0001a810: 6520 6578 6572 6369 7365 2063 7265 6469  e exercise credi
-0001a820: 7420 6173 2061 6e20 6f75 7463 6f6d 6520  t as an outcome 
-0001a830: 746f 2065 6163 680a 2020 2020 2020 2020  to each.        
-0001a840: 2020 2020 2320 636f 6e63 6570 7420 7468      # concept th
-0001a850: 6174 2773 2073 6574 2061 7420 7468 6520  at's set at the 
-0001a860: 6578 6572 6369 7365 206c 6576 656c 2c20  exercise level, 
-0001a870: 706c 7573 2061 7070 6c79 0a20 2020 2020  plus apply.     
-0001a880: 2020 2020 2020 2023 2069 6e64 6976 6964         # individ
-0001a890: 7561 6c20 6f75 7463 6f6d 6573 2074 6f20  ual outcomes to 
-0001a8a0: 7468 6569 7220 6173 736f 6369 6174 6564  their associated
-0001a8b0: 2070 6572 2d6f 7574 636f 6d65 0a20 2020   per-outcome.   
-0001a8c0: 2020 2020 2020 2020 2023 2063 6f6e 6365           # conce
-0001a8d0: 7074 732e 0a20 2020 2020 2020 2020 2020  pts..           
-0001a8e0: 2066 6f72 2063 6f6e 6365 7074 5f70 6174   for concept_pat
-0001a8f0: 6820 696e 2065 696e 666f 2e67 6574 2822  h in einfo.get("
-0001a900: 636f 6e63 6570 7473 222c 205b 5d29 3a0a  concepts", []):.
-0001a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a920: 2320 4e6f 7465 2073 7461 7475 732c 2070  # Note status, p
-0001a930: 6f74 656e 7469 616c 6c79 206f 7665 7272  otentially overr
-0001a940: 6964 696e 6720 7065 722d 6f75 7463 6f6d  iding per-outcom
-0001a950: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001a960: 2020 2320 7374 6174 7573 6573 2074 6861    # statuses tha
-0001a970: 7420 6861 7665 2061 6c72 6561 6479 2062  t have already b
-0001a980: 6565 6e20 6174 7461 6368 6564 0a20 2020  een attached.   
-0001a990: 2020 2020 2020 2020 2020 2020 206e 6f74               not
-0001a9a0: 655f 6578 6572 6369 7365 5f73 7461 7475  e_exercise_statu
-0001a9b0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-0001a9c0: 2020 2020 2020 2063 6f6e 6365 7074 732c         concepts,
-0001a9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a9e0: 2020 2020 2065 6964 2c0a 2020 2020 2020       eid,.      
-0001a9f0: 2020 2020 2020 2020 2020 2020 2020 2870                (p
-0001aa00: 6861 7365 2c20 7375 626d 6973 7369 6f6e  hase, submission
-0001aa10: 5f73 7461 7475 7329 2c0a 2020 2020 2020  _status),.      
-0001aa20: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001aa30: 6e63 6570 745f 7061 7468 0a20 2020 2020  ncept_path.     
-0001aa40: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0001aa50: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001aa60: 4174 7461 6368 2065 7865 7263 6973 652d  Attach exercise-
-0001aa70: 6c65 7665 6c20 6f75 7463 6f6d 6520 746f  level outcome to
-0001aa80: 2065 7865 7263 6973 652d 6c65 7665 6c0a   exercise-level.
-0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aaa0: 2320 636f 6e63 6570 7473 0a20 2020 2020  # concepts.     
-0001aab0: 2020 2020 2020 2020 2020 2069 6620 6563             if ec
-0001aac0: 7265 6469 7420 6973 206e 6f74 204e 6f6e  redit is not Non
-0001aad0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001aae0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab00: 2020 2020 6174 7461 6368 5f6f 7574 636f      attach_outco
-0001ab10: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
-0001ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab30: 636f 6e63 6570 7473 2c0a 2020 2020 2020  concepts,.      
-0001ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab50: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-0001ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab70: 2020 2020 2020 2020 2265 7865 7263 6973          "exercis
-0001ab80: 6540 7b7d 222e 666f 726d 6174 2865 7461  e@{}".format(eta
-0001ab90: 6729 2c0a 2020 2020 2020 2020 2020 2020  g),.            
-0001aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abb0: 2020 2020 6563 7265 6469 742c 0a20 2020      ecredit,.   
-0001abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abd0: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
-0001abe0: 6572 6369 7365 220a 2020 2020 2020 2020  ercise".        
-0001abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac00: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-0001ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac20: 2020 2063 6f6e 6365 7074 5f70 6174 680a     concept_path.
-0001ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac40: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001ac50: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0001ac60: 6365 7074 2056 616c 7565 4572 726f 723a  cept ValueError:
-0001ac70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ac80: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0001ac90: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0001aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001acb0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
-0001acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001acd0: 2020 2020 2020 2020 2022 496e 2067 726f           "In gro
-0001ace0: 7570 2027 7b7d 2720 6578 6572 6369 7365  up '{}' exercise
-0001acf0: 2027 7b7d 2720 7265 6665 7265 6e63 6573   '{}' references
-0001ad00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad20: 2020 2220 636f 6e63 6570 7420 277b 7d27    " concept '{}'
-0001ad30: 2062 7574 2074 6861 7420 636f 6e63 6570   but that concep
-0001ad40: 7420 646f 6573 6e27 7422 0a20 2020 2020  t doesn't".     
-0001ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad60: 2020 2020 2020 2020 2020 2022 2065 7869             " exi
-0001ad70: 7374 2e22 0a20 2020 2020 2020 2020 2020  st.".           
-0001ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad90: 2029 2e66 6f72 6d61 7428 6772 6f75 705b   ).format(group[
-0001ada0: 2767 726f 7570 275d 2c20 6569 642c 2063  'group'], eid, c
-0001adb0: 6f6e 6365 7074 5f70 6174 6829 0a20 2020  oncept_path).   
-0001adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001add0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0001ade0: 2320 4e6f 7720 7468 6174 2077 6520 6b6e  # Now that we kn
-0001adf0: 6f77 2074 6865 2065 7865 7263 6973 6520  ow the exercise 
-0001ae00: 6f75 7463 6f6d 6573 2066 6f72 2065 6163  outcomes for eac
-0001ae10: 6820 6578 6572 6369 7365 2069 6e0a 2020  h exercise in.  
-0001ae20: 2020 2020 2020 2320 7468 6973 2067 726f        # this gro
-0001ae30: 7570 2c20 6361 6c63 756c 6174 6520 6120  up, calculate a 
-0001ae40: 6772 6f75 7020 7374 6174 7573 2062 6173  group status bas
-0001ae50: 6564 206f 6e20 7468 6520 6578 6572 6369  ed on the exerci
-0001ae60: 7365 0a20 2020 2020 2020 2023 206f 7574  se.        # out
-0001ae70: 636f 6d65 7320 616e 6420 7468 6520 6772  comes and the gr
-0001ae80: 6f75 7020 7068 6173 652e 0a20 2020 2020  oup phase..     
-0001ae90: 2020 2063 7265 6469 745f 6672 6163 7469     credit_fracti
-0001aea0: 6f6e 203d 2067 726f 7570 5f63 7265 6469  on = group_credi
-0001aeb0: 7420 2f20 666c 6f61 7428 6772 6f75 705f  t / float(group_
-0001aec0: 6d61 7829 0a20 2020 2020 2020 2069 6620  max).        if 
-0001aed0: 6372 6564 6974 5f66 7261 6374 696f 6e20  credit_fraction 
-0001aee0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-0001aef0: 2020 7374 6174 7573 203d 2022 7065 7266    status = "perf
-0001af00: 6563 7422 0a20 2020 2020 2020 2065 6c69  ect".        eli
-0001af10: 6620 6372 6564 6974 5f66 7261 6374 696f  f credit_fractio
-0001af20: 6e20 3e3d 2061 7070 2e63 6f6e 6669 672e  n >= app.config.
-0001af30: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
-0001af40: 2022 4558 4552 4349 5345 5f47 524f 5550   "EXERCISE_GROUP
-0001af50: 5f54 4852 4553 484f 4c44 222c 0a20 2020  _THRESHOLD",.   
-0001af60: 2020 2020 2020 2020 2030 2e38 0a20 2020           0.8.   
-0001af70: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-0001af80: 2020 2020 7374 6174 7573 203d 2022 636f      status = "co
-0001af90: 6d70 6c65 7465 220a 2020 2020 2020 2020  mplete".        
-0001afa0: 656c 6966 2063 7265 6469 745f 6672 6163  elif credit_frac
-0001afb0: 7469 6f6e 203e 3d20 6170 702e 636f 6e66  tion >= app.conf
-0001afc0: 6967 2e67 6574 280a 2020 2020 2020 2020  ig.get(.        
-0001afd0: 2020 2020 2245 5845 5243 4953 455f 4752      "EXERCISE_GR
-0001afe0: 4f55 505f 5041 5254 4941 4c5f 5448 5245  OUP_PARTIAL_THRE
-0001aff0: 5348 4f4c 4422 2c0a 2020 2020 2020 2020  SHOLD",.        
-0001b000: 2020 2020 302e 380a 2020 2020 2020 2020      0.8.        
-0001b010: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0001b020: 7461 7475 7320 3d20 2270 6172 7469 616c  tatus = "partial
-0001b030: 220a 2020 2020 2020 2020 656c 7365 3a0a  ".        else:.
-0001b040: 2020 2020 2020 2020 2020 2020 7374 6174              stat
-0001b050: 7573 203d 2022 696e 636f 6d70 6c65 7465  us = "incomplete
-0001b060: 220a 0a20 2020 2020 2020 2069 6620 280a  "..        if (.
-0001b070: 2020 2020 2020 2020 2020 2020 7068 6173              phas
-0001b080: 6520 696e 2028 2270 7265 7265 6c65 6173  e in ("prereleas
-0001b090: 6522 2c20 2272 656c 6561 7365 6422 290a  e", "released").
-0001b0a0: 2020 2020 2020 2020 616e 6420 7374 6174          and stat
-0001b0b0: 7573 206e 6f74 2069 6e20 2822 7065 7266  us not in ("perf
-0001b0c0: 6563 7422 2c20 2263 6f6d 706c 6574 6522  ect", "complete"
-0001b0d0: 290a 2020 2020 2020 2020 293a 0a20 2020  ).        ):.   
-0001b0e0: 2020 2020 2020 2020 2073 7461 7475 7320           status 
-0001b0f0: 3d20 2270 656e 6469 6e67 220a 0a20 2020  = "pending"..   
-0001b100: 2020 2020 2069 6620 7068 6173 6520 3d3d       if phase ==
-0001b110: 2022 7072 6572 656c 6561 7365 2220 616e   "prerelease" an
-0001b120: 6420 6772 6f75 705f 6372 6564 6974 203d  d group_credit =
-0001b130: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0001b140: 2073 7461 7475 7320 3d20 2275 6e72 656c   status = "unrel
-0001b150: 6561 7365 6422 0a0a 2020 2020 2020 2020  eased"..        
-0001b160: 6772 6f75 705b 2273 7461 7475 7322 5d20  group["status"] 
-0001b170: 3d20 7374 6174 7573 0a20 2020 2020 2020  = status.       
-0001b180: 2067 726f 7570 5b22 6372 6564 6974 5f66   group["credit_f
-0001b190: 7261 6374 696f 6e22 5d20 3d20 6372 6564  raction"] = cred
-0001b1a0: 6974 5f66 7261 6374 696f 6e0a 0a20 2020  it_fraction..   
-0001b1b0: 2023 2054 4f44 4f3a 2041 7474 6163 6820   # TODO: Attach 
-0001b1c0: 6f75 7463 6f6d 6573 2066 726f 6d20 7072  outcomes from pr
-0001b1d0: 6f6a 6563 7420 7461 736b 7321 0a0a 2020  oject tasks!..  
-0001b1e0: 2020 2320 5365 7420 636f 6e63 6570 7420    # Set concept 
-0001b1f0: 7374 6174 7573 6573 2062 6173 6564 206f  statuses based o
-0001b200: 6e20 6174 7461 6368 6564 206f 7574 636f  n attached outco
-0001b210: 6d65 730a 2020 2020 2320 544f 444f 3a20  mes.    # TODO: 
-0001b220: 5448 4953 0a0a 0a64 6566 2061 6c6c 5f70  THIS...def all_p
-0001b230: 6172 656e 7473 2863 6f6e 6365 7074 732c  arents(concepts,
-0001b240: 2063 6f6e 6365 7074 5f70 6174 6829 3a0a   concept_path):.
-0001b250: 2020 2020 2222 220a 2020 2020 5969 656c      """.    Yiel
-0001b260: 6473 2065 6163 6820 7061 7265 6e74 206f  ds each parent o
-0001b270: 6620 7468 6520 6769 7665 6e20 636f 6e63  f the given conc
-0001b280: 6570 7420 7061 7468 2c20 696e 636c 7564  ept path, includ
-0001b290: 696e 6720 7468 6520 7461 7267 6574 0a20  ing the target. 
-0001b2a0: 2020 2063 6f6e 6365 7074 2069 7473 656c     concept itsel
-0001b2b0: 662c 2069 6e20 6465 7074 682d 6669 7273  f, in depth-firs
-0001b2c0: 7420 6f72 6465 7220 616e 6420 7072 6f63  t order and proc
-0001b2d0: 6573 7369 6e67 2065 6163 6820 636f 6e63  essing each conc
-0001b2e0: 6570 740a 2020 2020 6f6e 6c79 206f 6e63  ept.    only onc
-0001b2f0: 6520 6576 656e 2069 6620 7061 7265 6e74  e even if parent
-0001b300: 2d6c 6f6f 7073 206f 6363 7572 2e0a 0a20  -loops occur... 
-0001b310: 2020 2052 6169 7365 7320 6120 6056 616c     Raises a `Val
-0001b320: 7565 4572 726f 7260 2069 6620 7468 6520  ueError` if the 
-0001b330: 7461 7267 6574 2063 6f6e 6365 7074 2063  target concept c
-0001b340: 616e 6e6f 7420 6265 2066 6f75 6e64 2e0a  annot be found..
-0001b350: 2020 2020 2222 220a 2020 2020 636f 6e63      """.    conc
-0001b360: 6570 7420 3d20 6c6f 6f6b 7570 5f63 6f6e  ept = lookup_con
-0001b370: 6365 7074 2863 6f6e 6365 7074 732c 2063  cept(concepts, c
-0001b380: 6f6e 6365 7074 5f70 6174 682e 7370 6c69  oncept_path.spli
-0001b390: 7428 273a 2729 290a 2020 2020 6966 2063  t(':')).    if c
-0001b3a0: 6f6e 6365 7074 2069 7320 4e6f 6e65 3a0a  oncept is None:.
-0001b3b0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0001b3c0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-0001b3d0: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-0001b3e0: 2020 2020 2020 2020 2243 6f75 6c64 6e27          "Couldn'
-0001b3f0: 7420 6669 6e64 2070 6172 656e 7473 206f  t find parents o
-0001b400: 6620 636f 6e63 6570 7420 277b 7d27 3a20  f concept '{}': 
-0001b410: 7468 6174 2063 6f6e 6365 7074 220a 2020  that concept".  
-0001b420: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-0001b430: 646f 6573 206e 6f74 2065 7869 7374 2e22  does not exist."
-0001b440: 0a20 2020 2020 2020 2020 2020 2029 2e66  .            ).f
-0001b450: 6f72 6d61 7428 636f 6e63 6570 745f 7061  ormat(concept_pa
-0001b460: 7468 290a 2020 2020 2020 2020 290a 0a20  th).        ).. 
-0001b470: 2020 2023 2050 726f 6365 7373 2061 6c6c     # Process all
-0001b480: 2070 6172 656e 7473 2075 7369 6e67 2061   parents using a
-0001b490: 2073 7461 636b 0a20 2020 2073 6565 6e20   stack.    seen 
-0001b4a0: 3d20 7365 7428 290a 2020 2020 7374 6163  = set().    stac
-0001b4b0: 6b20 3d20 5b20 636f 6e63 6570 7420 5d0a  k = [ concept ].
-0001b4c0: 2020 2020 7768 696c 6520 6c65 6e28 7374      while len(st
-0001b4d0: 6163 6b29 203e 2030 3a0a 2020 2020 2020  ack) > 0:.      
-0001b4e0: 2020 7468 6973 5f63 6f6e 6365 7074 203d    this_concept =
-0001b4f0: 2073 7461 636b 2e70 6f70 2829 0a0a 2020   stack.pop()..  
-0001b500: 2020 2020 2020 2320 536b 6970 2069 6620        # Skip if 
-0001b510: 7765 2776 6520 616c 7265 6164 7920 7072  we've already pr
-0001b520: 6f63 6573 7365 6420 7468 6973 2063 6f6e  ocessed this con
-0001b530: 6365 7074 0a20 2020 2020 2020 2069 6620  cept.        if 
-0001b540: 7468 6973 5f63 6f6e 6365 7074 5b22 7061  this_concept["pa
-0001b550: 7468 225d 2069 6e20 7365 656e 3a0a 2020  th"] in seen:.  
-0001b560: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001b570: 7565 0a0a 2020 2020 2020 2020 2320 4966  ue..        # If
-0001b580: 2077 6520 6469 646e 2774 2073 6b69 702c   we didn't skip,
-0001b590: 206e 6f74 6520 7468 6174 2077 6520 6172   note that we ar
-0001b5a0: 6520 676f 696e 6720 746f 2070 726f 6365  e going to proce
-0001b5b0: 7373 2069 740a 2020 2020 2020 2020 7365  ss it.        se
-0001b5c0: 656e 2e61 6464 2874 6869 735f 636f 6e63  en.add(this_conc
-0001b5d0: 6570 745b 2270 6174 6822 5d29 0a0a 2020  ept["path"])..  
-0001b5e0: 2020 2020 2020 2320 416e 6420 7969 656c        # And yiel
-0001b5f0: 6420 6974 0a20 2020 2020 2020 2079 6965  d it.        yie
-0001b600: 6c64 2074 6869 735f 636f 6e63 6570 740a  ld this_concept.
-0001b610: 0a20 2020 2020 2020 2023 2045 7874 656e  .        # Exten
-0001b620: 6420 7374 6163 6b20 746f 2069 6e63 6c75  d stack to inclu
-0001b630: 6465 2065 6163 6820 6e6f 6e2d 4e6f 6e65  de each non-None
-0001b640: 2070 6172 656e 7420 636f 6e63 6570 740a   parent concept.
-0001b650: 2020 2020 2020 2020 7374 6163 6b2e 6578          stack.ex
-0001b660: 7465 6e64 280a 2020 2020 2020 2020 2020  tend(.          
-0001b670: 2020 6669 6c74 6572 286c 616d 6264 6120    filter(lambda 
-0001b680: 783a 2078 2c20 7468 6973 5f63 6f6e 6365  x: x, this_conce
-0001b690: 7074 5b22 7061 7265 6e74 7322 5d2e 7661  pt["parents"].va
-0001b6a0: 6c75 6573 2829 290a 2020 2020 2020 2020  lues()).        
-0001b6b0: 290a 0a0a 6465 6620 6e6f 7465 5f65 7865  )...def note_exe
-0001b6c0: 7263 6973 655f 7374 6174 7573 2863 6f6e  rcise_status(con
-0001b6d0: 6365 7074 732c 2065 6964 2c20 6578 6572  cepts, eid, exer
-0001b6e0: 6369 7365 5f73 7461 7475 732c 2063 6f6e  cise_status, con
-0001b6f0: 6365 7074 5f70 6174 6829 3a0a 2020 2020  cept_path):.    
-0001b700: 2222 220a 2020 2020 5265 7175 6972 6573  """.    Requires
-0001b710: 2061 6e20 6175 676d 656e 7465 6420 636f   an augmented co
-0001b720: 6e63 6570 7473 206e 6574 776f 726b 2c20  ncepts network, 
-0001b730: 616e 2065 7865 7263 6973 6520 4944 2c20  an exercise ID, 
-0001b740: 616e 2065 7865 7263 6973 650a 2020 2020  an exercise.    
-0001b750: 7374 6174 7573 2070 6169 7220 2861 2074  status pair (a t
-0001b760: 7570 6c65 2063 6f6e 7461 696e 696e 6720  uple containing 
-0001b770: 6120 7469 6d65 2073 7461 7475 7320 616e  a time status an
-0001b780: 6420 6120 7375 626d 6973 7369 6f6e 0a20  d a submission. 
-0001b790: 2020 2073 7461 7475 7320 6173 2073 7472     status as str
-0001b7a0: 696e 6773 292c 2061 6e64 2061 2063 6f6e  ings), and a con
-0001b7b0: 6365 7074 2070 6174 682e 0a0a 2020 2020  cept path...    
-0001b7c0: 4164 6473 2074 6f20 7468 6520 2265 7865  Adds to the "exe
-0001b7d0: 7263 6973 6573 2220 736c 6f74 2066 6f72  rcises" slot for
-0001b7e0: 2074 6865 2073 7065 6369 6669 6564 2063   the specified c
-0001b7f0: 6f6e 6365 7074 2074 6f20 696e 636c 7564  oncept to includ
-0001b800: 650a 2020 2020 7468 6520 6769 7665 6e20  e.    the given 
-0001b810: 6578 6572 6369 7365 2073 7461 7475 7320  exercise status 
-0001b820: 756e 6465 7220 7468 6520 6769 7665 6e20  under the given 
-0001b830: 6578 6572 6369 7365 2049 442c 206f 7665  exercise ID, ove
-0001b840: 7277 7269 7469 6e67 0a20 2020 2061 6e79  rwriting.    any
-0001b850: 2070 7265 7669 6f75 736c 792d 7365 7420   previously-set 
-0001b860: 7374 6174 7573 2e0a 0a20 2020 2041 7070  status...    App
-0001b870: 6c69 6573 2074 6f20 7061 7265 6e74 2063  lies to parent c
-0001b880: 6f6e 6365 7074 7320 6173 2077 656c 6c2e  oncepts as well.
-0001b890: 0a0a 2020 2020 466c 6173 6865 7320 6120  ..    Flashes a 
-0001b8a0: 7761 726e 696e 6720 6966 2074 6865 2074  warning if the t
-0001b8b0: 6172 6765 7420 636f 6e63 6570 7420 6361  arget concept ca
-0001b8c0: 6e6e 6f74 2062 6520 666f 756e 642e 0a20  nnot be found.. 
-0001b8d0: 2020 2022 2222 0a20 2020 2074 7279 3a0a     """.    try:.
-0001b8e0: 2020 2020 2020 2020 7061 7265 6e74 7320          parents 
-0001b8f0: 3d20 6c69 7374 2861 6c6c 5f70 6172 656e  = list(all_paren
-0001b900: 7473 2863 6f6e 6365 7074 732c 2063 6f6e  ts(concepts, con
-0001b910: 6365 7074 5f70 6174 6829 290a 2020 2020  cept_path)).    
-0001b920: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
-0001b930: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0001b940: 666c 6173 6b2e 666c 6173 6828 0a20 2020  flask.flash(.   
-0001b950: 2020 2020 2020 2020 2022 4572 726f 7220           "Error 
-0001b960: 7265 636f 7264 696e 6720 6578 6572 6369  recording exerci
-0001b970: 7365 2073 7461 7475 733a 207b 7d22 2e66  se status: {}".f
-0001b980: 6f72 6d61 7428 6529 0a20 2020 2020 2020  ormat(e).       
-0001b990: 2029 0a20 2020 2020 2020 2070 6172 656e   ).        paren
-0001b9a0: 7473 203d 205b 5d0a 0a20 2020 2066 6f72  ts = []..    for
-0001b9b0: 2063 6f6e 6365 7074 2069 6e20 7061 7265   concept in pare
-0001b9c0: 6e74 733a 0a20 2020 2020 2020 2063 6f6e  nts:.        con
-0001b9d0: 6365 7074 2e73 6574 6465 6661 756c 7428  cept.setdefault(
-0001b9e0: 2265 7865 7263 6973 6573 222c 207b 7d29  "exercises", {})
-0001b9f0: 5b65 6964 5d20 3d20 6578 6572 6369 7365  [eid] = exercise
-0001ba00: 5f73 7461 7475 730a 0a0a 6465 6620 6174  _status...def at
-0001ba10: 7461 6368 5f6f 7574 636f 6d65 2863 6f6e  tach_outcome(con
-0001ba20: 6365 7074 732c 206f 7574 636f 6d65 5f69  cepts, outcome_i
-0001ba30: 6e66 6f2c 2063 6f6e 6365 7074 5f70 6174  nfo, concept_pat
-0001ba40: 6829 3a0a 2020 2020 2222 220a 2020 2020  h):.    """.    
-0001ba50: 5265 7175 6972 6573 2061 6e20 6175 676d  Requires an augm
-0001ba60: 656e 7465 6420 636f 6e63 6570 7473 206e  ented concepts n
-0001ba70: 6574 776f 726b 2061 6e64 2061 6e20 6f75  etwork and an ou
-0001ba80: 7463 6f6d 6520 696e 666f 2074 7570 6c65  tcome info tuple
-0001ba90: 2028 610a 2020 2020 7374 7269 6e67 206e   (a.    string n
-0001baa0: 616d 696e 6720 7468 6520 6f75 7463 6f6d  aming the outcom
-0001bab0: 6520 706c 7573 2061 206e 756d 6265 7220  e plus a number 
-0001bac0: 6672 6f6d 2030 2d31 2073 7065 6369 6679  from 0-1 specify
-0001bad0: 696e 6720 7768 6574 6865 720a 2020 2020  ing whether.    
-0001bae0: 7468 6520 6f75 7463 6f6d 6520 696e 6469  the outcome indi
-0001baf0: 6361 7465 7320 7375 6363 6573 732c 2066  cates success, f
-0001bb00: 6169 6c75 7265 2c20 6f72 2073 6f6d 6520  ailure, or some 
-0001bb10: 6b69 6e64 206f 6620 7061 7274 6961 6c0a  kind of partial.
-0001bb20: 2020 2020 7375 6363 6573 7329 2e0a 0a20      success)... 
-0001bb30: 2020 2041 6c73 6f20 6e65 6564 7320 6120     Also needs a 
-0001bb40: 636f 6e63 6570 7420 7061 7468 2073 7065  concept path spe
-0001bb50: 6369 6679 696e 6720 7468 6520 636f 6e63  cifying the conc
-0001bb60: 6570 7420 746f 2077 6869 6368 2074 6865  ept to which the
-0001bb70: 0a20 2020 206f 7574 636f 6d65 2061 7070  .    outcome app
-0001bb80: 6c69 6573 2e20 4164 6473 2074 6865 206f  lies. Adds the o
-0001bb90: 7574 636f 6d65 2074 6f20 7468 6520 6c69  utcome to the li
-0001bba0: 7374 206f 6620 6f75 7463 6f6d 6573 2072  st of outcomes r
-0001bbb0: 656c 6576 616e 740a 2020 2020 746f 2074  elevant.    to t
-0001bbc0: 6865 2074 6172 6765 7420 636f 6e63 6570  he target concep
-0001bbd0: 742c 2070 6c75 7320 7468 6520 6c69 7374  t, plus the list
-0001bbe0: 7320 666f 7220 6561 6368 2063 6f6e 6365  s for each conce
-0001bbf0: 7074 2074 6861 7427 7320 610a 2020 2020  pt that's a.    
-0001bc00: 7061 7265 6e74 206f 6620 7468 6520 7461  parent of the ta
-0001bc10: 7267 6574 2063 6f6e 6365 7074 2e0a 0a20  rget concept... 
-0001bc20: 2020 2046 6c61 7368 6573 2061 2077 6172     Flashes a war
-0001bc30: 6e69 6e67 206d 6573 7361 6765 2069 6620  ning message if 
-0001bc40: 7468 6520 7461 7267 6574 2063 6f6e 6365  the target conce
-0001bc50: 7074 2063 616e 6e6f 7420 6265 2066 6f75  pt cannot be fou
-0001bc60: 6e64 2e0a 2020 2020 2222 220a 2020 2020  nd..    """.    
-0001bc70: 7472 793a 0a20 2020 2020 2020 2070 6172  try:.        par
-0001bc80: 656e 7473 203d 206c 6973 7428 616c 6c5f  ents = list(all_
-0001bc90: 7061 7265 6e74 7328 636f 6e63 6570 7473  parents(concepts
-0001bca0: 2c20 636f 6e63 6570 745f 7061 7468 2929  , concept_path))
-0001bcb0: 0a20 2020 2065 7863 6570 7420 5661 6c75  .    except Valu
-0001bcc0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-0001bcd0: 2020 2020 2066 6c61 736b 2e66 6c61 7368       flask.flash
-0001bce0: 280a 2020 2020 2020 2020 2020 2020 2245  (.            "E
-0001bcf0: 7272 6f72 2061 7474 6163 6869 6e67 2065  rror attaching e
-0001bd00: 7865 7263 6973 6520 6f75 7463 6f6d 653a  xercise outcome:
-0001bd10: 207b 7d22 2e66 6f72 6d61 7428 6529 0a20   {}".format(e). 
-0001bd20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001bd30: 2070 6172 656e 7473 203d 205b 5d0a 0a20   parents = [].. 
-0001bd40: 2020 2066 6f72 2063 6f6e 6365 7074 2069     for concept i
-0001bd50: 6e20 7061 7265 6e74 733a 0a20 2020 2020  n parents:.     
-0001bd60: 2020 2023 2041 6464 2074 6869 7320 6f75     # Add this ou
-0001bd70: 7463 6f6d 6520 746f 2074 6865 206f 7574  tcome to the out
-0001bd80: 636f 6d65 7320 6c69 7374 2066 6f72 2074  comes list for t
-0001bd90: 6869 7320 636f 6e63 6570 742c 0a20 2020  his concept,.   
-0001bda0: 2020 2020 2023 2063 7265 6174 696e 6720       # creating 
-0001bdb0: 6974 2069 6620 6974 2068 6173 6e27 7420  it if it hasn't 
-0001bdc0: 616c 7265 6164 7920 6265 656e 2063 7265  already been cre
-0001bdd0: 6174 6564 2e0a 2020 2020 2020 2020 636f  ated..        co
-0001bde0: 6e63 6570 742e 7365 7464 6566 6175 6c74  ncept.setdefault
-0001bdf0: 2822 6f75 7463 6f6d 6573 222c 205b 5d29  ("outcomes", [])
-0001be00: 2e61 7070 656e 6428 6f75 7463 6f6d 655f  .append(outcome_
-0001be10: 696e 666f 290a 0a0a 6465 6620 6175 676d  info)...def augm
-0001be20: 656e 745f 636f 6e63 6570 7473 2863 6f6e  ent_concepts(con
-0001be30: 6365 7074 7329 3a0a 2020 2020 2222 220a  cepts):.    """.
-0001be40: 2020 2020 5461 6b65 7320 6120 636f 6e63      Takes a conc
-0001be50: 6570 7473 206c 6973 7420 2877 6865 7265  epts list (where
-0001be60: 2065 6163 6820 656e 7472 7920 6973 2061   each entry is a
-0001be70: 2063 6f6e 6365 7074 2064 6963 7469 6f6e   concept diction
-0001be80: 6172 7920 7769 7468 0a20 2020 2061 6e20  ary with.    an 
-0001be90: 2769 6427 2c20 6120 2764 6573 6327 2c20  'id', a 'desc', 
-0001bea0: 616e 6420 706f 7373 6962 6c79 2027 6661  and possibly 'fa
-0001beb0: 6365 7473 2720 636f 6e74 6169 6e69 6e67  cets' containing
-0001bec0: 2061 0a20 2020 2073 7562 2d63 6f6e 6365   a.    sub-conce
-0001bed0: 7074 732d 6c69 7374 2c20 4f52 2068 6173  pts-list, OR has
-0001bee0: 206a 7573 7420 6120 2772 6566 2720 6b65   just a 'ref' ke
-0001bef0: 7920 6e61 6d69 6e67 2074 6865 2069 642d  y naming the id-
-0001bf00: 7061 7468 2074 6f20 610a 2020 2020 6469  path to a.    di
-0001bf10: 6666 6572 656e 7420 636f 6e63 6570 7429  fferent concept)
-0001bf20: 2e20 4175 676d 656e 7473 2074 6861 7420  . Augments that 
-0001bf30: 636f 6e63 6570 7473 206c 6973 7420 6279  concepts list by
-0001bf40: 2072 6570 6c61 6369 6e67 2061 6c6c 0a20   replacing all. 
-0001bf50: 2020 2027 7265 6627 2065 6e74 7269 6573     'ref' entries
-0001bf60: 2077 6974 6820 6163 7475 616c 206f 626a   with actual obj
-0001bf70: 6563 7420 7265 6665 7265 6e63 6573 2074  ect references t
-0001bf80: 6f20 7468 6520 6e61 6d65 6420 636f 6e63  o the named conc
-0001bf90: 6570 742c 0a20 2020 2061 6e64 2062 7920  ept,.    and by 
-0001bfa0: 6164 6469 6e67 2074 6865 2066 6f6c 6c6f  adding the follo
-0001bfb0: 7769 6e67 206b 6579 7320 746f 2065 6163  wing keys to eac
-0001bfc0: 6820 6e6f 6e2d 7265 6665 7265 6e63 6520  h non-reference 
-0001bfd0: 636f 6e63 6570 743a 0a0a 2020 2020 2d20  concept:..    - 
-0001bfe0: 2770 6174 6827 3a20 5468 6520 6675 6c6c  'path': The full
-0001bff0: 2072 6566 6572 656e 6365 2070 6174 6820   reference path 
-0001c000: 666f 7220 7468 6973 2063 6f6e 6365 7074  for this concept
-0001c010: 2066 726f 6d20 6120 746f 702d 6c65 7665   from a top-leve
-0001c020: 6c0a 2020 2020 2020 2020 636f 6e63 6570  l.        concep
-0001c030: 742c 2075 7369 6e67 2068 6f6d 6520 636f  t, using home co
-0001c040: 6e63 6570 7473 206f 7665 7220 6f74 6865  ncepts over othe
-0001c050: 7220 7265 6665 7265 6e63 6573 2074 6f20  r references to 
-0001c060: 6669 6e64 2061 2077 6179 0a20 2020 2020  find a way.     
-0001c070: 2020 2074 6f20 7468 6520 746f 7020 6c65     to the top le
-0001c080: 7665 6c2e 0a20 2020 202d 2027 7061 7265  vel..    - 'pare
-0001c090: 6e74 7327 3a20 6120 6469 6374 696f 6e61  nts': a dictiona
-0001c0a0: 7279 206d 6170 7069 6e67 2066 756c 6c2d  ry mapping full-
-0001c0b0: 6964 2d70 6174 682d 7374 7269 6e67 7320  id-path-strings 
-0001c0c0: 746f 2061 6374 7561 6c0a 2020 2020 2020  to actual.      
-0001c0d0: 2020 636f 6e63 6570 7420 6469 6374 696f    concept dictio
-0001c0e0: 6e61 7269 6573 2c20 7769 7468 206f 6e65  naries, with one
-0001c0f0: 2065 6e74 7279 2066 6f72 2065 6163 6820   entry for each 
-0001c100: 636f 6e63 6570 7420 7468 6174 0a20 2020  concept that.   
-0001c110: 2020 2020 2069 6e63 6c75 6465 7320 7468       includes th
-0001c120: 6973 206f 6e65 2061 7320 6120 6661 6365  is one as a face
-0001c130: 742e 2057 696c 6c20 6265 2061 6e20 656d  t. Will be an em
-0001c140: 7074 7920 6469 6374 696f 6e61 7279 2066  pty dictionary f
-0001c150: 6f72 0a20 2020 2020 2020 2063 6f6e 6365  or.        conce
-0001c160: 7074 7320 6174 2074 6865 2074 6f70 2d6c  pts at the top-l
-0001c170: 6576 656c 2074 6861 7420 6172 656e 2774  evel that aren't
-0001c180: 2072 6566 6572 656e 6365 6420 616e 7977   referenced anyw
-0001c190: 6865 7265 2e20 4966 2061 0a20 2020 2020  here. If a.     
-0001c1a0: 2020 2063 6f6e 6365 7074 2069 7320 6174     concept is at
-0001c1b0: 2074 6865 2074 6f70 206c 6576 656c 206f   the top level o
-0001c1c0: 7220 7265 6665 7265 6e63 6564 2074 6865  r referenced the
-0001c1d0: 7265 2c20 7468 6973 2064 6963 7469 6f6e  re, this diction
-0001c1e0: 6172 790a 2020 2020 2020 2020 7769 6c6c  ary.        will
-0001c1f0: 2068 6176 6520 6120 7370 6563 6961 6c20   have a special 
-0001c200: 656e 7472 7920 7769 7468 206b 6579 2060  entry with key `
-0001c210: 4e6f 6e65 6020 616e 6420 7661 6c75 6520  None` and value 
-0001c220: 604e 6f6e 6560 2e0a 2020 2020 2d20 2768  `None`..    - 'h
-0001c230: 6f6d 6527 3a20 4120 636f 6e63 6570 7420  ome': A concept 
-0001c240: 6469 6374 696f 6e61 7279 2066 6f72 2074  dictionary for t
-0001c250: 6865 206e 6174 7572 616c 2070 6172 656e  he natural paren
-0001c260: 7420 6f66 2074 6869 730a 2020 2020 2020  t of this.      
-0001c270: 2020 636f 6e63 6570 743a 2074 6865 206f    concept: the o
-0001c280: 6e65 2070 6172 656e 7420 7768 6963 6820  ne parent which 
-0001c290: 696e 636c 7564 6564 2069 7420 6469 7265  included it dire
-0001c2a0: 6374 6c79 2069 6e73 7465 6164 206f 6620  ctly instead of 
-0001c2b0: 6173 0a20 2020 2020 2020 2061 2072 6566  as.        a ref
-0001c2c0: 6572 656e 6365 2e20 5769 6c6c 2062 6520  erence. Will be 
-0001c2d0: 604e 6f6e 6560 2066 6f72 2074 6f70 2d6c  `None` for top-l
-0001c2e0: 6576 656c 2063 6f6e 6365 7074 732c 2069  evel concepts, i
-0001c2f0: 6e63 6c75 6469 6e67 0a20 2020 2020 2020  ncluding.       
-0001c300: 206f 6e65 7320 7468 6174 2061 7265 2072   ones that are r
-0001c310: 6566 6572 656e 6365 6420 736f 6d65 7768  eferenced somewh
-0001c320: 6572 6520 2874 6f20 6176 6f69 6420 7468  ere (to avoid th
-0001c330: 6973 2c20 796f 7520 6361 6e20 6d61 6b65  is, you can make
-0001c340: 0a20 2020 2020 2020 2061 2072 6566 6572  .        a refer
-0001c350: 656e 6365 2061 7420 7468 6520 746f 7020  ence at the top 
-0001c360: 6c65 7665 6c20 616e 6420 706c 6163 6520  level and place 
-0001c370: 7468 6520 636f 6e63 6570 7420 796f 7520  the concept you 
-0001c380: 7761 6e74 2074 6f0a 2020 2020 2020 2020  want to.        
-0001c390: 7075 6c6c 2075 7020 7769 7468 696e 2074  pull up within t
-0001c3a0: 6865 2070 6c61 6365 2079 6f75 2764 206f  he place you'd o
-0001c3b0: 7468 6572 7769 7365 2072 6566 6572 656e  therwise referen
-0001c3c0: 6365 2069 7429 2e0a 0a20 2020 2049 6620  ce it)...    If 
-0001c3d0: 736f 6d65 7468 696e 6720 6973 2063 6f6e  something is con
-0001c3e0: 7472 6164 6963 746f 7279 2028 652e 672e  tradictory (e.g.
-0001c3f0: 2c20 6120 6e61 6d65 6420 7265 6665 7265  , a named refere
-0001c400: 6e63 6520 636f 6e63 6570 740a 2020 2020  nce concept.    
-0001c410: 646f 6573 6e27 7420 6578 6973 7429 2061  doesn't exist) a
-0001c420: 2060 5661 6c75 6545 7272 6f72 6020 7769   `ValueError` wi
-0001c430: 6c6c 2062 6520 7261 6973 6564 2e20 4e6f  ll be raised. No
-0001c440: 7465 2074 6861 7420 616c 6c0a 2020 2020  te that all.    
-0001c450: 7265 6665 7265 6e63 6573 206d 7573 7420  references must 
-0001c460: 7573 6520 6361 6e6f 6e69 6361 6c20 7061  use canonical pa
-0001c470: 7468 733b 2074 6865 7920 6361 6e6e 6f74  ths; they cannot
-0001c480: 2027 676f 2074 6872 6f75 6768 2720 6f74   'go through' ot
-0001c490: 6865 720a 2020 2020 7265 6665 7265 6e63  her.    referenc
-0001c4a0: 6573 2e0a 2020 2020 2222 220a 2020 2020  es..    """.    
-0001c4b0: 2320 4372 6561 7465 2061 2073 7461 636b  # Create a stack
-0001c4c0: 2066 6f72 2070 726f 6365 7373 696e 6720   for processing 
-0001c4d0: 7468 6520 7265 6375 7273 6976 6520 656e  the recursive en
-0001c4e0: 7472 6965 732e 2045 6163 6820 636f 6e63  tries. Each conc
-0001c4f0: 6570 740a 2020 2020 2320 656e 7472 7920  ept.    # entry 
-0001c500: 6973 2070 6169 7265 6420 7769 7468 2069  is paired with i
-0001c510: 7473 206e 6174 7572 616c 2070 6172 656e  ts natural paren
-0001c520: 7420 616e 6420 7468 6520 696e 6465 7820  t and the index 
-0001c530: 616d 6f6e 6720 7468 6174 0a20 2020 2023  among that.    #
-0001c540: 2070 6172 656e 7427 7320 6661 6365 7473   parent's facets
-0001c550: 2069 7420 6578 6973 7473 2061 742e 0a20   it exists at.. 
-0001c560: 2020 2073 7461 636b 203d 205b 2863 6f6e     stack = [(con
-0001c570: 6365 7074 2c20 4e6f 6e65 2c20 4e6f 6e65  cept, None, None
-0001c580: 2920 666f 7220 636f 6e63 6570 7420 696e  ) for concept in
-0001c590: 2063 6f6e 6365 7074 735d 0a0a 2020 2020   concepts]..    
-0001c5a0: 2320 436f 6e74 696e 7565 2075 6e74 696c  # Continue until
-0001c5b0: 2077 6520 7275 6e20 6f75 7420 6f66 2063   we run out of c
-0001c5c0: 6f6e 6365 7074 7320 746f 2070 726f 6365  oncepts to proce
-0001c5d0: 7373 0a20 2020 2077 6869 6c65 206c 656e  ss.    while len
-0001c5e0: 2873 7461 636b 2920 3e20 303a 0a20 2020  (stack) > 0:.   
-0001c5f0: 2020 2020 2023 2047 6574 2074 6865 2063       # Get the c
-0001c600: 6f6e 6365 7074 202b 2070 6172 656e 7420  oncept + parent 
-0001c610: 2b20 696e 6465 7820 636f 6d62 6f20 746f  + index combo to
-0001c620: 2070 726f 6365 7373 0a20 2020 2020 2020   process.       
-0001c630: 2028 636f 6e63 6570 742c 2068 6f6d 652c   (concept, home,
-0001c640: 2066 6163 6574 5f69 6e64 6578 2920 3d20   facet_index) = 
-0001c650: 7374 6163 6b2e 706f 7028 290a 0a20 2020  stack.pop()..   
-0001c660: 2020 2020 2023 2041 7265 2077 6520 6120       # Are we a 
-0001c670: 7265 6665 7265 6e63 653f 0a20 2020 2020  reference?.     
-0001c680: 2020 2069 6620 2772 6566 2720 6e6f 7420     if 'ref' not 
-0001c690: 696e 2063 6f6e 6365 7074 3a0a 2020 2020  in concept:.    
-0001c6a0: 2020 2020 2020 2020 2320 4e6f 7420 6120          # Not a 
-0001c6b0: 7265 6665 7265 6e63 653b 2061 7567 6d65  reference; augme
-0001c6c0: 6e74 2074 6869 6e67 7320 2620 7374 6163  nt things & stac
-0001c6d0: 6b20 7570 2066 6163 6574 730a 0a20 2020  k up facets..   
-0001c6e0: 2020 2020 2020 2020 2023 2053 6574 2074           # Set t
-0001c6f0: 6865 2068 6f6d 6520 666f 7220 7468 6973  he home for this
-0001c700: 2063 6f6e 6365 7074 0a20 2020 2020 2020   concept.       
-0001c710: 2020 2020 2063 6f6e 6365 7074 5b27 686f       concept['ho
-0001c720: 6d65 275d 203d 2068 6f6d 650a 0a20 2020  me'] = home..   
-0001c730: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
-0001c740: 6520 616e 2065 6d70 7479 2070 6172 656e  e an empty paren
-0001c750: 7473 2064 6963 7469 6f6e 6172 792c 206f  ts dictionary, o
-0001c760: 7220 7265 7472 6965 7665 2061 6e0a 2020  r retrieve an.  
-0001c770: 2020 2020 2020 2020 2020 2320 6578 6973            # exis
-0001c780: 7469 6e67 2064 6963 7469 6f6e 6172 7920  ting dictionary 
-0001c790: 2870 6f73 7369 626c 7920 6372 6561 7465  (possibly create
-0001c7a0: 6420 6475 6520 746f 2061 0a20 2020 2020  d due to a.     
-0001c7b0: 2020 2020 2020 2023 2070 7265 7669 6f75         # previou
-0001c7c0: 736c 792d 7072 6f63 6573 7365 6420 7265  sly-processed re
-0001c7d0: 6665 7265 6e63 6529 0a20 2020 2020 2020  ference).       
-0001c7e0: 2020 2020 2070 6172 656e 7473 203d 2063       parents = c
-0001c7f0: 6f6e 6365 7074 2e73 6574 6465 6661 756c  oncept.setdefaul
-0001c800: 7428 2770 6172 656e 7473 272c 207b 7d29  t('parents', {})
-0001c810: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0001c820: 5365 7420 7061 7468 2061 6e64 2075 7064  Set path and upd
-0001c830: 6174 6520 7061 7265 6e74 7320 6469 6666  ate parents diff
-0001c840: 6572 656e 746c 7920 6261 7365 6420 6f6e  erently based on
-0001c850: 2077 6865 7468 6572 0a20 2020 2020 2020   whether.       
-0001c860: 2020 2020 2023 2077 6527 7265 2061 7420       # we're at 
-0001c870: 7468 6520 746f 7020 6c65 7665 6c20 6f72  the top level or
-0001c880: 206e 6f74 0a20 2020 2020 2020 2020 2020   not.           
-0001c890: 2069 6620 686f 6d65 2069 7320 4e6f 6e65   if home is None
-0001c8a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c8b0: 2020 636f 6e63 6570 745b 2770 6174 6827    concept['path'
-0001c8c0: 5d20 3d20 636f 6e63 6570 745b 2269 6422  ] = concept["id"
-0001c8d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001c8e0: 2020 7061 7265 6e74 735b 4e6f 6e65 5d20    parents[None] 
-0001c8f0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-0001c900: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001c910: 2020 2020 2020 2020 2063 6f6e 6365 7074           concept
-0001c920: 5b27 7061 7468 275d 203d 2068 6f6d 655b  ['path'] = home[
-0001c930: 2270 6174 6822 5d20 2b20 273a 2720 2b20  "path"] + ':' + 
-0001c940: 636f 6e63 6570 745b 2269 6422 5d0a 2020  concept["id"].  
-0001c950: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0001c960: 7265 6e74 735b 686f 6d65 5b27 7061 7468  rents[home['path
-0001c970: 275d 5d20 3d20 686f 6d65 0a0a 2020 2020  ']] = home..    
-0001c980: 2020 2020 2020 2020 666f 7220 692c 2066          for i, f
-0001c990: 6163 6574 2069 6e20 656e 756d 6572 6174  acet in enumerat
-0001c9a0: 6528 636f 6e63 6570 742e 6765 7428 2766  e(concept.get('f
-0001c9b0: 6163 6574 7327 2c20 5b5d 2929 3a0a 2020  acets', [])):.  
-0001c9c0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001c9d0: 6163 6b2e 6170 7065 6e64 2828 6661 6365  ack.append((face
-0001c9e0: 742c 2063 6f6e 6365 7074 2c20 6929 290a  t, concept, i)).
-0001c9f0: 0a20 2020 2020 2020 2065 6c73 653a 2020  .        else:  
-0001ca00: 2320 6966 2077 6520 2a61 7265 2a20 6120  # if we *are* a 
-0001ca10: 7265 6665 7265 6e63 652e 2e2e 0a20 2020  reference....   
-0001ca20: 2020 2020 2020 2020 2072 6566 6572 656e           referen
-0001ca30: 7420 3d20 6c6f 6f6b 7570 5f63 6f6e 6365  t = lookup_conce
-0001ca40: 7074 2863 6f6e 6365 7074 732c 2063 6f6e  pt(concepts, con
-0001ca50: 6365 7074 5b27 7265 6627 5d2e 7370 6c69  cept['ref'].spli
-0001ca60: 7428 273a 2729 290a 0a20 2020 2020 2020  t(':'))..       
-0001ca70: 2020 2020 2069 6620 7265 6665 7265 6e74       if referent
-0001ca80: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001ca90: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001caa0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0001cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cac0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001cad0: 2020 2020 2020 2020 2020 2241 7420 277b            "At '{
-0001cae0: 7d27 2c20 6f6e 6520 6661 6365 7420 6973  }', one facet is
-0001caf0: 2061 2072 6566 6572 656e 6365 2074 6f20   a reference to 
-0001cb00: 277b 7d27 2c20 6275 7422 0a20 2020 2020  '{}', but".     
-0001cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb20: 2020 2022 2074 6861 7420 636f 6e63 6570     " that concep
-0001cb30: 7420 646f 6573 206e 6f74 2065 7869 7374  t does not exist
-0001cb40: 2e20 284e 6f74 653a 2061 6c6c 220a 2020  . (Note: all".  
-0001cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb60: 2020 2020 2020 2220 7265 6665 7265 6e63        " referenc
-0001cb70: 6573 206d 7573 7420 6265 2076 6961 2063  es must be via c
-0001cb80: 616e 6f6e 6963 616c 2070 6174 6873 2c20  anonical paths, 
-0001cb90: 692e 652e 2c22 0a20 2020 2020 2020 2020  i.e.,".         
-0001cba0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001cbb0: 2072 6566 6572 656e 6365 7320 6d61 7920   references may 
-0001cbc0: 6e6f 7420 676f 2074 6872 6f75 6768 206f  not go through o
-0001cbd0: 7468 6572 220a 2020 2020 2020 2020 2020  ther".          
-0001cbe0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-0001cbf0: 7265 6665 7265 6e63 6573 2e29 220a 2020  references.)".  
-0001cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc10: 2020 292e 666f 726d 6174 2868 6f6d 655b    ).format(home[
-0001cc20: 2770 6174 6827 5d2c 2063 6f6e 6365 7074  'path'], concept
-0001cc30: 5b27 7265 6627 5d29 0a20 2020 2020 2020  ['ref']).       
-0001cc40: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0001cc50: 2020 2020 2020 2020 2320 5765 206e 6565          # We nee
-0001cc60: 6420 746f 2072 6570 6c61 6365 206f 7572  d to replace our
-0001cc70: 7365 6c76 6573 2077 6974 6820 6120 7265  selves with a re
-0001cc80: 616c 206f 626a 6563 7420 7265 6665 7265  al object refere
-0001cc90: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
-0001cca0: 2023 2075 6e6c 6573 7320 7765 2772 6520   # unless we're 
-0001ccb0: 6174 2074 6865 2074 6f70 206c 6576 656c  at the top level
-0001ccc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001ccd0: 686f 6d65 2069 7320 6e6f 7420 4e6f 6e65  home is not None
-0001cce0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001ccf0: 2020 686f 6d65 5b27 6661 6365 7473 275d    home['facets']
-0001cd00: 5b66 6163 6574 5f69 6e64 6578 5d20 3d20  [facet_index] = 
-0001cd10: 7265 6665 7265 6e74 0a0a 2020 2020 2020  referent..      
-0001cd20: 2020 2020 2020 2020 2020 2320 5765 2061            # We a
-0001cd30: 6c73 6f20 6e65 6564 2074 6f20 7570 6461  lso need to upda
-0001cd40: 7465 2074 6865 2070 6172 656e 7473 2064  te the parents d
-0001cd50: 6963 7469 6f6e 6172 7920 6f66 2074 6865  ictionary of the
-0001cd60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cd70: 2023 2072 6566 6572 656e 7420 746f 2069   # referent to i
-0001cd80: 6e63 6c75 6465 2074 6865 2070 6172 656e  nclude the paren
-0001cd90: 7420 636f 6e63 6570 7420 6865 7265 2e0a  t concept here..
-0001cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdb0: 7265 6665 7265 6e74 2e73 6574 6465 6661  referent.setdefa
-0001cdc0: 756c 7428 2770 6172 656e 7473 272c 207b  ult('parents', {
-0001cdd0: 7d29 5b68 6f6d 655b 2770 6174 6827 5d5d  })[home['path']]
-0001cde0: 203d 2068 6f6d 650a 2020 2020 2020 2020   = home.        
-0001cdf0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001ce00: 2020 2020 2020 2020 2020 2320 4164 6420            # Add 
-0001ce10: 6120 274e 6f6e 6527 206b 6579 2069 6620  a 'None' key if 
-0001ce20: 7468 6973 2072 6566 6572 656e 6365 2069  this reference i
-0001ce30: 7320 6174 2074 6865 2074 6f70 206c 6576  s at the top lev
-0001ce40: 656c 0a20 2020 2020 2020 2020 2020 2020  el.             
-0001ce50: 2020 2072 6566 6572 656e 742e 7365 7464     referent.setd
-0001ce60: 6566 6175 6c74 2827 7061 7265 6e74 7327  efault('parents'
-0001ce70: 2c20 7b7d 295b 4e6f 6e65 5d20 3d20 4e6f  , {})[None] = No
-0001ce80: 6e65 0a0a 2020 2020 2020 2020 2020 2020  ne..            
-0001ce90: 2320 4e6f 7465 2074 6861 7420 7765 202a  # Note that we *
-0001cea0: 646f 6e27 742a 2061 6464 2066 6163 6574  don't* add facet
-0001ceb0: 7320 746f 2074 6865 2073 7461 636b 2068  s to the stack h
-0001cec0: 6572 6521 2054 6865 7927 6c6c 0a20 2020  ere! They'll.   
-0001ced0: 2020 2020 2020 2020 2023 2062 6520 6164           # be ad
-0001cee0: 6465 6420 6c61 7465 7220 6166 7465 7220  ded later after 
-0001cef0: 7468 6520 6e61 7475 7261 6c20 636f 7079  the natural copy
-0001cf00: 206f 6620 7468 6520 7265 6665 7265 6e74   of the referent
-0001cf10: 2069 730a 2020 2020 2020 2020 2020 2020   is.            
-0001cf20: 2320 7072 6f63 6573 7365 642e 0a0a 0a64  # processed....d
-0001cf30: 6566 206c 6f6f 6b75 705f 636f 6e63 6570  ef lookup_concep
-0001cf40: 7428 636f 6e63 6570 7473 2c20 636f 6e63  t(concepts, conc
-0001cf50: 6570 745f 6e61 6d65 7329 3a0a 2020 2020  ept_names):.    
-0001cf60: 2222 220a 2020 2020 4261 7365 6420 6f6e  """.    Based on
-0001cf70: 2061 2073 6571 7565 6e63 6520 6f66 2063   a sequence of c
-0001cf80: 6f6e 6365 7074 2d6e 616d 6520 7374 7269  oncept-name stri
-0001cf90: 6e67 732c 2072 6574 7572 6e73 2074 6865  ngs, returns the
-0001cfa0: 2061 7373 6f63 6961 7465 640a 2020 2020   associated.    
-0001cfb0: 636f 6e63 6570 7420 6469 6374 696f 6e61  concept dictiona
-0001cfc0: 7279 2066 726f 6d20 7468 6520 6769 7665  ry from the give
-0001cfd0: 6e20 746f 702d 6c65 7665 6c20 636f 6e63  n top-level conc
-0001cfe0: 6570 7473 206c 6973 742e 2054 6869 7320  epts list. This 
-0001cff0: 7769 6c6c 0a20 2020 206f 6e6c 7920 6265  will.    only be
-0001d000: 2061 626c 6520 746f 2066 696e 6420 636f   able to find co
-0001d010: 6e63 6570 7473 2076 6961 2074 6865 6972  ncepts via their
-0001d020: 206e 6174 7572 616c 2070 6172 656e 7473   natural parents
-0001d030: 2c20 756e 6c65 7373 2074 6865 0a20 2020  , unless the.   
-0001d040: 2063 6f6e 6365 7074 7320 6c69 7374 2068   concepts list h
-0001d050: 6173 2062 6565 6e20 6175 676d 656e 7465  as been augmente
-0001d060: 642e 0a0a 2020 2020 5265 7475 726e 7320  d...    Returns 
-0001d070: 604e 6f6e 6560 2069 6620 7468 6572 6520  `None` if there 
-0001d080: 6973 206e 6f20 7375 6368 2063 6f6e 6365  is no such conce
-0001d090: 7074 2e0a 2020 2020 2222 220a 2020 2020  pt..    """.    
-0001d0a0: 6669 7273 7420 3d20 636f 6e63 6570 745f  first = concept_
-0001d0b0: 6e61 6d65 735b 305d 0a20 2020 206d 6174  names[0].    mat
-0001d0c0: 6368 203d 204e 6f6e 650a 2020 2020 666f  ch = None.    fo
-0001d0d0: 7220 636f 6e63 6570 7420 696e 2063 6f6e  r concept in con
-0001d0e0: 6365 7074 733a 0a20 2020 2020 2020 2069  cepts:.        i
-0001d0f0: 6620 636f 6e63 6570 745b 2269 6422 5d20  f concept["id"] 
-0001d100: 3d3d 2066 6972 7374 3a0a 2020 2020 2020  == first:.      
-0001d110: 2020 2020 2020 6d61 7463 6820 3d20 636f        match = co
-0001d120: 6e63 6570 740a 2020 2020 2020 2020 2020  ncept.          
-0001d130: 2020 6272 6561 6b0a 0a20 2020 2069 6620    break..    if 
-0001d140: 6d61 7463 6820 6973 204e 6f6e 653a 0a20  match is None:. 
-0001d150: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0001d160: 6e65 0a20 2020 2065 6c69 6620 6c65 6e28  ne.    elif len(
-0001d170: 636f 6e63 6570 745f 6e61 6d65 7329 203d  concept_names) =
-0001d180: 3d20 313a 0a20 2020 2020 2020 2072 6574  = 1:.        ret
-0001d190: 7572 6e20 6d61 7463 680a 2020 2020 656c  urn match.    el
-0001d1a0: 7365 3a0a 2020 2020 2020 2020 7265 7475  se:.        retu
-0001d1b0: 726e 206c 6f6f 6b75 705f 636f 6e63 6570  rn lookup_concep
-0001d1c0: 7428 6d61 7463 682e 6765 7428 2766 6163  t(match.get('fac
-0001d1d0: 6574 7327 2c20 5b5d 292c 2063 6f6e 6365  ets', []), conce
-0001d1e0: 7074 5f6e 616d 6573 5b31 3a5d 290a 0a0a  pt_names[1:])...
-0001d1f0: 6465 6620 7065 7263 656e 7469 6c65 2864  def percentile(d
-0001d200: 6174 6173 6574 2c20 7063 7429 3a0a 2020  ataset, pct):.  
-0001d210: 2020 2222 220a 2020 2020 436f 6d70 7574    """.    Comput
-0001d220: 6573 2074 6865 206e 7468 2070 6572 6365  es the nth perce
-0001d230: 6e74 696c 6520 6f66 2074 6865 2064 6174  ntile of the dat
-0001d240: 6173 6574 2062 7920 6120 7765 6967 6874  aset by a weight
-0001d250: 6564 2061 7665 7261 6765 206f 660a 2020  ed average of.  
-0001d260: 2020 7468 6520 7477 6f20 6974 656d 7320    the two items 
-0001d270: 6f6e 2065 6974 6865 7220 7369 6465 206f  on either side o
-0001d280: 6620 7468 6174 2066 7261 6374 696f 6e61  f that fractiona
-0001d290: 6c20 696e 6465 7820 7769 7468 696e 2074  l index within t
-0001d2a0: 6865 0a20 2020 2064 6174 6173 6574 2e20  he.    dataset. 
-0001d2b0: 7063 7420 6d75 7374 2062 6520 6120 6e75  pct must be a nu
-0001d2c0: 6d62 6572 2062 6574 7765 656e 2030 2061  mber between 0 a
-0001d2d0: 6e64 2031 3030 2028 696e 636c 7573 6976  nd 100 (inclusiv
-0001d2e0: 6529 2e0a 0a20 2020 2052 6574 7572 6e73  e)...    Returns
-0001d2f0: 204e 6f6e 6520 7768 656e 2067 6976 656e   None when given
-0001d300: 2061 6e20 656d 7074 7920 6461 7461 7365   an empty datase
-0001d310: 742c 2061 6e64 2061 6c77 6179 7320 7265  t, and always re
-0001d320: 7475 726e 7320 7468 650a 2020 2020 7369  turns the.    si
-0001d330: 6e67 756c 6172 2069 7465 6d20 696e 2074  ngular item in t
-0001d340: 6865 2064 6174 6173 6574 2077 6865 6e20  he dataset when 
-0001d350: 6769 7665 6e20 6120 6461 7461 7365 7420  given a dataset 
-0001d360: 6f66 206c 656e 6774 6820 312e 0a20 2020  of length 1..   
-0001d370: 2022 2222 0a20 2020 2066 7220 3d20 7063   """.    fr = pc
-0001d380: 7420 2f20 3130 302e 300a 2020 2020 6966  t / 100.0.    if
-0001d390: 206c 656e 2864 6174 6173 6574 2920 3d3d   len(dataset) ==
-0001d3a0: 2031 3a0a 2020 2020 2020 2020 7265 7475   1:.        retu
-0001d3b0: 726e 2064 6174 6173 6574 5b30 5d0a 2020  rn dataset[0].  
-0001d3c0: 2020 656c 6966 206c 656e 2864 6174 6173    elif len(datas
-0001d3d0: 6574 2920 3d3d 2030 3a0a 2020 2020 2020  et) == 0:.      
-0001d3e0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
-0001d3f0: 2020 7372 7420 3d20 736f 7274 6564 2864    srt = sorted(d
-0001d400: 6174 6173 6574 290a 2020 2020 6672 6964  ataset).    frid
-0001d410: 7820 3d20 6672 202a 2028 6c65 6e28 7372  x = fr * (len(sr
-0001d420: 7429 202d 2031 290a 2020 2020 6964 7820  t) - 1).    idx 
-0001d430: 3d20 696e 7428 6672 6964 7829 0a20 2020  = int(fridx).   
-0001d440: 2069 6620 6964 7820 3d3d 2066 7269 6478   if idx == fridx
-0001d450: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001d460: 2073 7274 5b69 6478 5d20 2320 696e 7465   srt[idx] # inte
-0001d470: 6765 7220 696e 6465 7820 2d3e 206e 6f20  ger index -> no 
-0001d480: 6176 6572 6167 696e 670a 2020 2020 6c65  averaging.    le
-0001d490: 6674 6f76 6572 203d 2066 7269 6478 202d  ftover = fridx -
-0001d4a0: 2069 6478 0a20 2020 2066 6972 7374 203d   idx.    first =
-0001d4b0: 2073 7274 5b69 6478 5d0a 2020 2020 7365   srt[idx].    se
-0001d4c0: 636f 6e64 203d 2073 7274 5b69 6478 202b  cond = srt[idx +
-0001d4d0: 2031 5d20 2320 6c65 6761 6c20 696e 6465   1] # legal inde
-0001d4e0: 7820 6265 6361 7573 6520 7765 2063 616e  x because we can
-0001d4f0: 2774 2068 6176 6520 6869 7420 7468 6520  't have hit the 
-0001d500: 656e 640a 2020 2020 7265 7475 726e 2066  end.    return f
-0001d510: 6972 7374 202a 2028 3120 2d20 6c65 6674  irst * (1 - left
-0001d520: 6f76 6572 2920 2b20 7365 636f 6e64 202a  over) + second *
-0001d530: 206c 6566 746f 7665 720a 0a0a 6465 6620   leftover...def 
-0001d540: 6765 745f 6665 6564 6261 636b 5f70 735f  get_feedback_ps_
-0001d550: 616e 645f 7461 736b 280a 2020 2020 7461  and_task(.    ta
-0001d560: 736b 5f69 6e66 6f2c 0a20 2020 2063 6f75  sk_info,.    cou
-0001d570: 7273 652c 0a20 2020 2073 656d 6573 7465  rse,.    semeste
-0001d580: 722c 0a20 2020 2075 7365 722c 0a20 2020  r,.    user,.   
-0001d590: 2070 6861 7365 2c0a 2020 2020 7073 6964   phase,.    psid
-0001d5a0: 2c0a 2020 2020 7461 736b 6964 0a29 3a0a  ,.    taskid.):.
-0001d5b0: 2020 2020 2222 220a 2020 2020 4769 7665      """.    Give
-0001d5c0: 6e20 6120 7461 736b 5f69 6e66 6f20 6f62  n a task_info ob
-0001d5d0: 6a65 6374 2061 6e64 2061 2070 6172 7469  ject and a parti
-0001d5e0: 6375 6c61 720a 2020 2020 636f 7572 7365  cular.    course
-0001d5f0: 2f73 656d 6573 7465 722f 7573 6572 2f70  /semester/user/p
-0001d600: 6861 7365 2f70 7365 742f 7461 736b 2077  hase/pset/task w
-0001d610: 6527 7265 2069 6e74 6572 6573 7465 6420  e're interested 
-0001d620: 696e 2c20 6578 7472 6163 7473 0a20 2020  in, extracts.   
-0001d630: 2061 6e64 2061 7567 6d65 6e74 7320 7073   and augments ps
-0001d640: 2061 6e64 2074 6173 6b20 6f62 6a65 6374   and task object
-0001d650: 7320 746f 206d 616b 6520 7468 656d 2072  s to make them r
-0001d660: 6561 6479 2066 6f72 2072 656e 6465 7269  eady for renderi
-0001d670: 6e67 2061 730a 2020 2020 6665 6564 6261  ng as.    feedba
-0001d680: 636b 2c20 7265 7475 726e 696e 6720 6120  ck, returning a 
-0001d690: 7475 706c 6520 6f66 2062 6f74 682e 0a0a  tuple of both...
-0001d6a0: 2020 2020 5265 7475 726e 7320 6120 5661      Returns a Va
-0001d6b0: 6c75 6545 7272 6f72 206f 626a 6563 7420  lueError object 
-0001d6c0: 696e 2063 6173 6573 2077 6865 7265 2074  in cases where t
-0001d6d0: 6865 2072 6571 7565 7374 6564 2070 7365  he requested pse
-0001d6e0: 742f 7461 736b 0a20 2020 2064 6f65 736e  t/task.    doesn
-0001d6f0: 2774 2065 7869 7374 2e0a 2020 2020 2222  't exist..    ""
-0001d700: 220a 0a20 2020 2023 2045 7874 7261 6374  "..    # Extract
-0001d710: 2070 7320 2620 7461 736b 206f 626a 6563   ps & task objec
-0001d720: 7473 0a20 2020 2074 7279 3a0a 2020 2020  ts.    try:.    
-0001d730: 2020 2020 7073 203d 2067 6574 5f70 735f      ps = get_ps_
-0001d740: 6f62 6a28 7461 736b 5f69 6e66 6f2c 2070  obj(task_info, p
-0001d750: 7369 6429 0a20 2020 2065 7863 6570 7420  sid).    except 
-0001d760: 5661 6c75 6545 7272 6f72 2061 7320 653a  ValueError as e:
-0001d770: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001d780: 650a 0a20 2020 2074 7279 3a0a 2020 2020  e..    try:.    
-0001d790: 2020 2020 7461 736b 203d 2067 6574 5f74      task = get_t
-0001d7a0: 6173 6b5f 6f62 6a28 7461 736b 5f69 6e66  ask_obj(task_inf
-0001d7b0: 6f2c 2070 732c 2074 6173 6b69 6429 0a20  o, ps, taskid). 
-0001d7c0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-0001d7d0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-0001d7e0: 2020 2072 6574 7572 6e20 650a 0a20 2020     return e..   
-0001d7f0: 2023 2041 6464 2073 7461 7475 7320 2620   # Add status & 
-0001d800: 7469 6d65 2072 656d 6169 6e69 6e67 2069  time remaining i
-0001d810: 6e66 6f20 746f 2070 7365 7420 616e 6420  nfo to pset and 
-0001d820: 6f62 6a65 6374 730a 2020 2020 616d 656e  objects.    amen
-0001d830: 645f 7073 6574 2863 6f75 7273 652c 2073  d_pset(course, s
-0001d840: 656d 6573 7465 722c 2074 6173 6b5f 696e  emester, task_in
-0001d850: 666f 2c20 7073 2c20 7573 6572 290a 2020  fo, ps, user).  
-0001d860: 2020 616d 656e 645f 7461 736b 2863 6f75    amend_task(cou
-0001d870: 7273 652c 2073 656d 6573 7465 722c 2074  rse, semester, t
-0001d880: 6173 6b5f 696e 666f 2c20 7073 6964 2c20  ask_info, psid, 
-0001d890: 7461 736b 2c20 7573 6572 2c20 7068 6173  task, user, phas
-0001d8a0: 6529 0a0a 2020 2020 2320 4765 7420 6675  e)..    # Get fu
-0001d8b0: 6c6c 2066 6565 6462 6163 6b20 666f 7220  ll feedback for 
-0001d8c0: 7468 6520 7461 736b 2069 6e20 7175 6573  the task in ques
-0001d8d0: 7469 6f6e 2069 6620 6974 2773 2061 7661  tion if it's ava
-0001d8e0: 696c 6162 6c65 0a20 2020 2074 6173 6b5b  ilable.    task[
-0001d8f0: 2266 6565 6462 6163 6b22 5d20 3d20 7374  "feedback"] = st
-0001d900: 6f72 6167 652e 6765 745f 6665 6564 6261  orage.get_feedba
-0001d910: 636b 280a 2020 2020 2020 2020 636f 7572  ck(.        cour
-0001d920: 7365 2c0a 2020 2020 2020 2020 7365 6d65  se,.        seme
-0001d930: 7374 6572 2c0a 2020 2020 2020 2020 7461  ster,.        ta
-0001d940: 736b 5f69 6e66 6f2c 0a20 2020 2020 2020  sk_info,.       
-0001d950: 2075 7365 722c 0a20 2020 2020 2020 2070   user,.        p
-0001d960: 6861 7365 2c0a 2020 2020 2020 2020 7073  hase,.        ps
-0001d970: 5b22 6964 225d 2c0a 2020 2020 2020 2020  ["id"],.        
-0001d980: 7461 736b 5b22 6964 225d 0a20 2020 2029  task["id"].    )
-0001d990: 0a20 2020 2023 2047 6574 2048 544d 4c20  .    # Get HTML 
-0001d9a0: 6665 6564 6261 636b 2061 7320 7765 6c6c  feedback as well
-0001d9b0: 0a20 2020 2074 6173 6b5b 2266 6565 6462  .    task["feedb
-0001d9c0: 6163 6b5f 6874 6d6c 225d 203d 2073 746f  ack_html"] = sto
-0001d9d0: 7261 6765 2e67 6574 5f66 6565 6462 6163  rage.get_feedbac
-0001d9e0: 6b5f 6874 6d6c 280a 2020 2020 2020 2020  k_html(.        
-0001d9f0: 636f 7572 7365 2c0a 2020 2020 2020 2020  course,.        
-0001da00: 7365 6d65 7374 6572 2c0a 2020 2020 2020  semester,.      
-0001da10: 2020 7461 736b 5f69 6e66 6f2c 0a20 2020    task_info,.   
-0001da20: 2020 2020 2075 7365 722c 0a20 2020 2020       user,.     
-0001da30: 2020 2070 6861 7365 2c0a 2020 2020 2020     phase,.      
-0001da40: 2020 7073 5b22 6964 225d 2c0a 2020 2020    ps["id"],.    
-0001da50: 2020 2020 7461 736b 5b22 6964 225d 0a20      task["id"]. 
-0001da60: 2020 2029 0a20 2020 2069 6620 7461 736b     ).    if task
-0001da70: 5b22 6665 6564 6261 636b 225d 5b22 7374  ["feedback"]["st
-0001da80: 6174 7573 225d 2021 3d20 226d 6973 7369  atus"] != "missi
-0001da90: 6e67 223a 0a20 2020 2020 2020 2074 6173  ng":.        tas
-0001daa0: 6b5b 2273 7562 6d69 7474 6564 225d 203d  k["submitted"] =
-0001dab0: 2054 7275 650a 2020 2020 2020 2020 706f   True.        po
-0001dac0: 746c 7563 6b2e 7265 6e64 6572 2e61 7567  tluck.render.aug
-0001dad0: 6d65 6e74 5f72 6570 6f72 7428 7461 736b  ment_report(task
-0001dae0: 5b22 6665 6564 6261 636b 225d 290a 0a20  ["feedback"]).. 
-0001daf0: 2020 2072 6574 7572 6e20 7073 2c20 7461     return ps, ta
-0001db00: 736b 0a0a 0a64 6566 2067 6574 5f65 7661  sk...def get_eva
-0001db10: 6c75 6174 696f 6e5f 696e 666f 280a 2020  luation_info(.  
-0001db20: 2020 636f 7572 7365 2c0a 2020 2020 7365    course,.    se
-0001db30: 6d65 7374 6572 2c0a 2020 2020 7461 7267  mester,.    targ
-0001db40: 6574 5f75 7365 722c 0a20 2020 2070 6861  et_user,.    pha
-0001db50: 7365 2c0a 2020 2020 7073 6964 2c0a 2020  se,.    psid,.  
-0001db60: 2020 7461 736b 6964 0a29 3a0a 2020 2020    taskid.):.    
-0001db70: 2222 220a 2020 2020 4665 7463 6865 7320  """.    Fetches 
-0001db80: 6e6f 7465 7320 616e 6420 6f76 6572 7269  notes and overri
-0001db90: 6465 2069 6e66 6f20 666f 7220 7468 6520  de info for the 
-0001dba0: 6769 7665 6e20 7375 626d 6973 7369 6f6e  given submission
-0001dbb0: 2c20 616e 6420 7265 7475 726e 730a 2020  , and returns.  
-0001dbc0: 2020 6120 7475 706c 6520 696e 636c 7564    a tuple includ
-0001dbd0: 696e 6720 7468 6520 6e6f 7465 7320 6d61  ing the notes ma
-0001dbe0: 726b 646f 776e 2073 6f75 7263 652c 2074  rkdown source, t
-0001dbf0: 6865 206e 6f74 6573 2072 656e 6465 7265  he notes rendere
-0001dc00: 6420 4854 4d4c 2c0a 2020 2020 7468 6520  d HTML,.    the 
-0001dc10: 6772 6164 6520 6f76 6572 7269 6465 2076  grade override v
-0001dc20: 616c 7565 2c20 616e 6420 7468 6520 7469  alue, and the ti
-0001dc30: 6d65 6c69 6e65 7373 206f 7665 7272 6964  meliness overrid
-0001dc40: 6520 7661 6c75 652e 0a0a 2020 2020 5468  e value...    Th
-0001dc50: 6520 6772 6164 6520 6f76 6572 7269 6465  e grade override
-0001dc60: 2077 696c 6c20 6265 2061 6e20 656d 7074   will be an empt
-0001dc70: 7920 7374 7269 6e67 2069 6620 6e6f 206f  y string if no o
-0001dc80: 7665 7272 6964 6520 6973 2061 6374 6976  verride is activ
-0001dc90: 652c 0a20 2020 2061 6e64 2073 686f 756c  e,.    and shoul
-0001dca0: 6420 6265 2061 2066 6c6f 6174 696e 672d  d be a floating-
-0001dcb0: 706f 696e 7420 7661 6c75 6520 6f74 6865  point value othe
-0001dcc0: 7277 6973 6520 6578 6365 7074 2069 6e20  rwise except in 
-0001dcd0: 6361 7365 7320 7768 6572 650a 2020 2020  cases where.    
-0001dce0: 6120 6e6f 6e2d 6e75 6d65 7269 6320 7661  a non-numeric va
-0001dcf0: 6c75 6520 7761 7320 7365 742e 0a0a 2020  lue was set...  
-0001dd00: 2020 5468 6520 7469 6d65 6c69 6e65 7373    The timeliness
-0001dd10: 206f 7665 7272 6964 6520 6973 2073 696d   override is sim
-0001dd20: 696c 6172 2c20 616e 6420 7368 6f75 6c64  ilar, and should
-0001dd30: 206f 6e6c 7920 6576 6572 2062 6520 7365   only ever be se
-0001dd40: 7420 666f 720a 2020 2020 7468 6520 2769  t for.    the 'i
-0001dd50: 6e69 7469 616c 2720 7068 6173 652c 2073  nitial' phase, s
-0001dd60: 696e 6365 2069 7420 6170 706c 6965 7320  ince it applies 
-0001dd70: 6163 726f 7373 2061 6c6c 2070 6861 7365  across all phase
-0001dd80: 732e 0a0a 2020 2020 5468 6520 6e6f 7465  s...    The note
-0001dd90: 7320 616e 6420 6e6f 7465 7320 4854 4d4c  s and notes HTML
-0001dda0: 2073 7472 696e 6773 2077 696c 6c20 6265   strings will be
-0001ddb0: 2065 6d70 7479 2073 7472 696e 6773 2069   empty strings i
-0001ddc0: 6620 6e6f 206e 6f74 6573 0a20 2020 2068  f no notes.    h
-0001ddd0: 6176 6520 6265 656e 2073 6574 2e0a 2020  ave been set..  
-0001dde0: 2020 2222 220a 2020 2020 2320 4665 7463    """.    # Fetc
-0001ddf0: 6820 7261 7720 6576 616c 2069 6e66 6f20  h raw eval info 
-0001de00: 6469 6374 0a20 2020 2065 7661 6c75 6174  dict.    evaluat
-0001de10: 696f 6e20 3d20 7374 6f72 6167 652e 6665  ion = storage.fe
-0001de20: 7463 685f 6576 616c 7561 7469 6f6e 280a  tch_evaluation(.
-0001de30: 2020 2020 2020 2020 636f 7572 7365 2c0a          course,.
-0001de40: 2020 2020 2020 2020 7365 6d65 7374 6572          semester
-0001de50: 2c0a 2020 2020 2020 2020 7461 7267 6574  ,.        target
-0001de60: 5f75 7365 722c 0a20 2020 2020 2020 2070  _user,.        p
-0001de70: 6861 7365 2c0a 2020 2020 2020 2020 7073  hase,.        ps
-0001de80: 6964 2c0a 2020 2020 2020 2020 7461 736b  id,.        task
-0001de90: 6964 0a20 2020 2029 0a0a 2020 2020 6966  id.    )..    if
-0001dea0: 2065 7661 6c75 6174 696f 6e20 6973 204e   evaluation is N
-0001deb0: 6f6e 653a 0a20 2020 2020 2020 2072 6574  one:.        ret
-0001dec0: 7572 6e20 2727 2c20 2727 2c20 2727 2c20  urn '', '', '', 
-0001ded0: 2727 0a0a 2020 2020 2320 4578 7472 6163  ''..    # Extrac
-0001dee0: 7420 6e6f 7465 7320 616e 6420 6772 6164  t notes and grad
-0001def0: 6520 6f76 6572 7269 6465 2066 726f 6d20  e override from 
-0001df00: 7374 6f72 6564 2069 6e66 6f0a 2020 2020  stored info.    
-0001df10: 6e6f 7465 7320 3d20 6576 616c 7561 7469  notes = evaluati
-0001df20: 6f6e 2e67 6574 2822 6e6f 7465 7322 2c20  on.get("notes", 
-0001df30: 2222 290a 2020 2020 6f76 6572 7269 6465  "").    override
-0001df40: 203d 2065 7661 6c75 6174 696f 6e2e 6765   = evaluation.ge
-0001df50: 7428 226f 7665 7272 6964 6522 290a 2020  t("override").  
-0001df60: 2020 6966 206f 7665 7272 6964 6520 6973    if override is
-0001df70: 204e 6f6e 653a 0a20 2020 2020 2020 206f   None:.        o
-0001df80: 7665 7272 6964 6520 3d20 2222 0a20 2020  verride = "".   
-0001df90: 2065 6c73 653a 0a20 2020 2020 2020 2074   else:.        t
-0001dfa0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001dfb0: 6f76 6572 7269 6465 203d 2066 6c6f 6174  override = float
-0001dfc0: 286f 7665 7272 6964 6529 0a20 2020 2020  (override).     
-0001dfd0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0001dfe0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-0001dff0: 2070 6173 730a 0a20 2020 2074 696d 656c   pass..    timel
-0001e000: 696e 6573 7320 3d20 6576 616c 7561 7469  iness = evaluati
-0001e010: 6f6e 2e67 6574 2822 7469 6d65 6c69 6e65  on.get("timeline
-0001e020: 7373 2229 0a20 2020 2069 6620 7469 6d65  ss").    if time
-0001e030: 6c69 6e65 7373 2069 7320 4e6f 6e65 3a0a  liness is None:.
-0001e040: 2020 2020 2020 2020 7469 6d65 6c69 6e65          timeline
-0001e050: 7373 203d 2022 220a 2020 2020 656c 7365  ss = "".    else
-0001e060: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
-0001e070: 2020 2020 2020 2020 2020 2074 696d 656c             timel
-0001e080: 696e 6573 7320 3d20 666c 6f61 7428 7469  iness = float(ti
-0001e090: 6d65 6c69 6e65 7373 290a 2020 2020 2020  meliness).      
-0001e0a0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-0001e0b0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-0001e0c0: 7061 7373 0a0a 2020 2020 2320 5265 6e64  pass..    # Rend
-0001e0d0: 6572 206e 6f74 6573 2061 7320 4854 4d4c  er notes as HTML
-0001e0e0: 0a20 2020 206e 6f74 6573 5f68 746d 6c20  .    notes_html 
-0001e0f0: 3d20 706f 746c 7563 6b2e 7265 6e64 6572  = potluck.render
-0001e100: 2e72 656e 6465 725f 6d61 726b 646f 776e  .render_markdown
-0001e110: 286e 6f74 6573 290a 0a20 2020 2072 6574  (notes)..    ret
-0001e120: 7572 6e20 6e6f 7465 732c 206e 6f74 6573  urn notes, notes
-0001e130: 5f68 746d 6c2c 206f 7665 7272 6964 652c  _html, override,
-0001e140: 2074 696d 656c 696e 6573 730a 0a0a 232d   timeliness...#-
-0001e150: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d23  ---------------#
-0001e160: 0a23 2054 696d 6520 6675 6e63 7469 6f6e  .# Time function
-0001e170: 7320 230a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  s #.#-----------
-0001e180: 2d2d 2d2d 2d23 0a0a 4f4e 455f 4d49 4e55  -----#..ONE_MINU
-0001e190: 5445 203d 2036 300a 4f4e 455f 484f 5552  TE = 60.ONE_HOUR
-0001e1a0: 203d 204f 4e45 5f4d 494e 5554 4520 2a20   = ONE_MINUTE * 
-0001e1b0: 3630 0a4f 4e45 5f44 4159 203d 204f 4e45  60.ONE_DAY = ONE
-0001e1c0: 5f48 4f55 5220 2a20 3234 0a4f 4e45 5f57  _HOUR * 24.ONE_W
-0001e1d0: 4545 4b20 3d20 4f4e 455f 4441 5920 2a20  EEK = ONE_DAY * 
-0001e1e0: 370a 0a0a 6465 6620 7073 6574 5f73 7461  7...def pset_sta
-0001e1f0: 7475 735f 6e6f 7728 0a20 2020 2075 7365  tus_now(.    use
-0001e200: 726e 616d 652c 0a20 2020 2074 6173 6b5f  rname,.    task_
-0001e210: 696e 666f 2c0a 2020 2020 7073 6574 5f6f  info,.    pset_o
-0001e220: 626a 2c0a 2020 2020 6578 7465 6e73 696f  bj,.    extensio
-0001e230: 6e73 3d28 4661 6c73 652c 2046 616c 7365  ns=(False, False
-0001e240: 290a 293a 0a20 2020 2022 2222 0a20 2020  ).):.    """.   
-0001e250: 2052 6574 7572 6e73 2074 6865 2063 7572   Returns the cur
-0001e260: 7265 6e74 2073 7461 7465 206f 6620 7468  rent state of th
-0001e270: 6520 6769 7665 6e20 7073 6574 206f 626a  e given pset obj
-0001e280: 6563 7420 2861 6c73 6f20 6e65 6564 7320  ect (also needs 
-0001e290: 7468 650a 2020 2020 7461 736b 2069 6e66  the.    task inf
-0001e2a0: 6f20 6f62 6a65 6374 2061 6e64 2074 6865  o object and the
-0001e2b0: 2075 7365 726e 616d 6529 2e20 4966 2022   username). If "
-0001e2c0: 5041 5553 455f 4154 2220 6973 2073 6574  PAUSE_AT" is set
-0001e2d0: 2069 6e20 7468 6520 7461 736b 0a20 2020   in the task.   
-0001e2e0: 206f 626a 6563 7420 616e 6420 6e6f 6e2d   object and non-
-0001e2f0: 656d 7074 7920 2873 6565 2073 6574 5f70  empty (see set_p
-0001e300: 6175 7365 5f74 696d 6529 2c20 7468 6174  ause_time), that
-0001e310: 206d 6f6d 656e 742c 206e 6f74 2074 6865   moment, not the
-0001e320: 0a20 2020 2063 7572 7265 6e74 2074 696d  .    current tim
-0001e330: 652c 2077 696c 6c20 6265 2075 7365 642e  e, will be used.
-0001e340: 2045 7874 656e 7369 6f6e 7320 6d75 7374   Extensions must
-0001e350: 2063 6f6e 7461 696e 2074 776f 2076 616c   contain two val
-0001e360: 7565 7320 286f 6e65 0a20 2020 2066 6f72  ues (one.    for
-0001e370: 2074 6865 2069 6e69 7469 616c 2070 6861   the initial pha
-0001e380: 7365 2061 6e64 206f 6e65 2066 6f72 2074  se and one for t
-0001e390: 6865 2072 6576 6973 696f 6e20 7068 6173  he revision phas
-0001e3a0: 6529 2e20 5468 6579 206d 6179 2065 6163  e). They may eac
-0001e3b0: 680a 2020 2020 6265 2046 616c 7365 2066  h.    be False f
-0001e3c0: 6f72 206e 6f20 6578 7465 6e73 696f 6e2c  or no extension,
-0001e3d0: 2054 7275 6520 666f 7220 7468 6520 6465   True for the de
-0001e3e0: 6661 756c 7420 6578 7465 6e73 696f 6e2c  fault extension,
-0001e3f0: 206f 7220 616e 0a20 2020 2069 6e74 6567   or an.    integ
-0001e400: 6572 206e 756d 6265 7220 6f66 2068 6f75  er number of hou
-0001e410: 7273 2e20 5468 6f73 6520 686f 7572 7320  rs. Those hours 
-0001e420: 7769 6c6c 2062 6520 6164 6465 6420 746f  will be added to
-0001e430: 2074 6865 2065 6666 6563 7469 7665 0a20   the effective. 
-0001e440: 2020 2069 6e69 7469 616c 2061 6e64 2072     initial and r
-0001e450: 6576 6973 696f 6e20 6465 6164 6c69 6e65  evision deadline
-0001e460: 732e 0a0a 2020 2020 5265 7475 726e 7320  s...    Returns 
-0001e470: 6120 6469 6374 696f 6e61 7279 2077 6974  a dictionary wit
-0001e480: 6820 2773 7461 7465 272c 2027 696e 6974  h 'state', 'init
-0001e490: 6961 6c2d 6578 7465 6e73 696f 6e27 2c0a  ial-extension',.
-0001e4a0: 2020 2020 2772 6576 6973 696f 6e2d 6578      'revision-ex
-0001e4b0: 7465 6e73 696f 6e27 2c20 2772 656c 6561  tension', 'relea
-0001e4c0: 7365 272c 2027 6475 6527 2c20 2772 6576  se', 'due', 'rev
-0001e4d0: 6965 7765 6427 2c20 616e 6420 2766 696e  iewed', and 'fin
-0001e4e0: 616c 697a 6564 272c 0a20 2020 206b 6579  alized',.    key
-0001e4f0: 732e 2045 6163 6820 6f66 2074 6865 2027  s. Each of the '
-0001e500: 7265 6c65 6173 6527 2c20 2764 7565 272c  release', 'due',
-0001e510: 2027 7265 7669 6577 6564 272c 2061 6e64   'reviewed', and
-0001e520: 2027 6669 6e61 6c69 7a65 6427 206b 6579   'finalized' key
-0001e530: 730a 2020 2020 7769 6c6c 2062 6520 6120  s.    will be a 
-0001e540: 7375 622d 6469 6374 696f 6e61 7279 2077  sub-dictionary w
-0001e550: 6974 6820 7468 6520 666f 6c6c 6f77 696e  ith the followin
-0001e560: 6720 6b65 7973 3a0a 0a20 2020 202d 2027  g keys:..    - '
-0001e570: 6174 273a 2041 2064 6174 6569 6d74 652e  at': A dateimte.
-0001e580: 6461 7465 7469 6d65 206f 626a 6563 7420  datetime object 
-0001e590: 7370 6563 6966 7969 6e67 2061 6273 6f6c  specifying absol
-0001e5a0: 7574 6520 7469 6d69 6e67 2e0a 2020 2020  ute timing..    
-0001e5b0: 2d20 2761 745f 7374 7227 3a20 4120 7374  - 'at_str': A st
-0001e5c0: 7269 6e67 2072 6570 7265 7365 6e74 6174  ring representat
-0001e5d0: 696f 6e20 6f66 2074 6865 2061 626f 7665  ion of the above
-0001e5e0: 2e0a 2020 2020 2d20 2775 6e74 696c 273a  ..    - 'until':
-0001e5f0: 2041 2064 6174 6574 696d 652e 7469 6d65   A datetime.time
-0001e600: 6465 6c74 6120 7265 7072 6573 656e 7469  delta representi
-0001e610: 6e67 2074 696d 6520 756e 7469 6c20 7468  ng time until th
-0001e620: 6520 6576 656e 7420 2877 696c 6c0a 2020  e event (will.  
-0001e630: 2020 2020 2020 6265 206e 6567 6174 6976        be negativ
-0001e640: 6520 6166 7465 7277 6172 6473 292e 0a20  e afterwards).. 
-0001e650: 2020 202d 2027 756e 7469 6c5f 7374 7227     - 'until_str'
-0001e660: 3a20 4120 7374 7269 6e67 2072 6570 7265  : A string repre
-0001e670: 7365 6e74 6174 696f 6e20 6f66 2074 6865  sentation of the
-0001e680: 2061 626f 7665 2e0a 0a20 2020 2045 6163   above...    Eac
-0001e690: 6820 6f66 2074 6865 2073 7562 2d76 616c  h of the sub-val
-0001e6a0: 7565 7320 7769 6c6c 2062 6520 6e6f 6e65  ues will be none
-0001e6b0: 2069 6620 7468 6520 7073 6574 2064 6f65   if the pset doe
-0001e6c0: 736e 2774 2068 6176 6520 610a 2020 2020  sn't have a.    
-0001e6d0: 6465 6164 6c69 6e65 2073 6574 2e0a 0a20  deadline set... 
-0001e6e0: 2020 2054 6865 2027 7374 6174 6527 2076     The 'state' v
-0001e6f0: 616c 7565 2077 696c 6c20 6265 206f 6e65  alue will be one
-0001e700: 206f 663a 0a0a 2020 2020 2d20 2275 6e72   of:..    - "unr
-0001e710: 656c 6561 7365 6422 3a20 5468 6973 2070  eleased": This p
-0001e720: 7365 7420 6861 736e 2774 2079 6574 2062  set hasn't yet b
-0001e730: 6565 6e20 7265 6c65 6173 6564 3b20 646f  een released; do
-0001e740: 6e27 7420 6469 7370 6c61 790a 2020 2020  n't display.    
-0001e750: 2020 2020 616e 7920 696e 666f 2061 626f      any info abo
-0001e760: 7574 2069 742e 0a20 2020 202d 2022 7265  ut it..    - "re
-0001e770: 6c65 6173 6564 223a 2054 6869 7320 7073  leased": This ps
-0001e780: 6574 2068 6173 2062 6565 6e20 7265 6c65  et has been rele
-0001e790: 6173 6564 2061 6e64 2069 736e 2774 2064  ased and isn't d
-0001e7a0: 7565 2079 6574 2e0a 2020 2020 2d20 2275  ue yet..    - "u
-0001e7b0: 6e64 6572 5f72 6576 6965 7722 3a20 5468  nder_review": Th
-0001e7c0: 6973 2070 7365 7427 7320 6475 6520 7469  is pset's due ti
-0001e7d0: 6d65 2068 6173 2070 6173 7365 642c 2062  me has passed, b
-0001e7e0: 7574 2074 6865 2066 6565 6462 6163 6b0a  ut the feedback.
-0001e7f0: 2020 2020 2020 2020 7265 7669 6577 2070          review p
-0001e800: 6572 696f 6420 6861 736e 2774 2065 7870  eriod hasn't exp
-0001e810: 6972 6564 2079 6574 2e0a 2020 2020 2d20  ired yet..    - 
-0001e820: 2272 6576 6973 6162 6c65 223a 2054 6869  "revisable": Thi
-0001e830: 7320 7073 6574 2773 2064 7565 2074 696d  s pset's due tim
-0001e840: 6520 6973 2070 6173 742c 2061 6e64 2074  e is past, and t
-0001e850: 6865 2072 6576 6965 7720 7065 7269 6f64  he review period
-0001e860: 2068 6173 0a20 2020 2020 2020 2065 7870   has.        exp
-0001e870: 6972 6564 2c20 736f 2066 756c 6c20 6665  ired, so full fe
-0001e880: 6564 6261 636b 2073 686f 756c 6420 6265  edback should be
-0001e890: 2072 656c 6561 7365 642c 2062 7574 2072   released, but r
-0001e8a0: 6576 6973 696f 6e73 206d 6179 0a20 2020  evisions may.   
-0001e8b0: 2020 2020 2073 7469 6c6c 2062 6520 7375       still be su
-0001e8c0: 626d 6974 7465 642e 0a20 2020 202d 2022  bmitted..    - "
-0001e8d0: 6669 6e61 6c22 3a20 5468 6973 2070 7365  final": This pse
-0001e8e0: 7427 7320 6475 6520 7469 6d65 2069 7320  t's due time is 
-0001e8f0: 7061 7374 2c20 7468 6520 7265 7669 6577  past, the review
-0001e900: 2070 6572 696f 6420 6861 730a 2020 2020   period has.    
-0001e910: 2020 2020 6578 7069 7265 642c 2061 6e64      expired, and
-0001e920: 2074 6865 2072 6576 6973 696f 6e20 7065   the revision pe
-0001e930: 7269 6f64 2069 7320 616c 736f 206f 7665  riod is also ove
-0001e940: 722c 2073 6f20 6675 6c6c 2066 6565 6462  r, so full feedb
-0001e950: 6163 6b0a 2020 2020 2020 2020 6973 2061  ack.        is a
-0001e960: 7661 696c 6162 6c65 2c20 616e 6420 6e6f  vailable, and no
-0001e970: 206d 6f72 6520 7375 626d 6973 7369 6f6e   more submission
-0001e980: 7320 7769 6c6c 2062 6520 6163 6365 7074  s will be accept
-0001e990: 6564 2e0a 2020 2020 2d20 2275 6e6b 6e6f  ed..    - "unkno
-0001e9a0: 776e 223a 2054 6869 7320 7073 6574 2064  wn": This pset d
-0001e9b0: 6f65 736e 2774 2068 6176 6520 6120 6475  oesn't have a du
-0001e9c0: 6520 6461 7465 2e20 5468 650a 2020 2020  e date. The.    
-0001e9d0: 2020 2020 7365 636f 6e64 735f 7265 6d61      seconds_rema
-0001e9e0: 696e 696e 6720 7661 6c75 6520 7769 6c6c  ining value will
-0001e9f0: 2062 6520 4e6f 6e65 2e0a 0a20 2020 2054   be None...    T
-0001ea00: 6865 2027 696e 6974 6961 6c5f 6578 7465  he 'initial_exte
-0001ea10: 6e73 696f 6e27 2061 6e64 2027 7265 7669  nsion' and 'revi
-0001ea20: 7369 6f6e 5f65 7874 656e 7369 6f6e 2720  sion_extension' 
-0001ea30: 7769 6c6c 2062 6f74 6820 6265 206e 756d  will both be num
-0001ea40: 6265 7273 0a20 2020 2073 7065 6369 6679  bers.    specify
-0001ea50: 696e 6720 686f 7720 6d61 6e79 2068 6f75  ing how many hou
-0001ea60: 7273 206f 6620 6578 7465 6e73 696f 6e20  rs of extension 
-0001ea70: 7765 7265 2067 7261 6e74 6564 2028 7468  were granted (th
-0001ea80: 6573 6520 6e75 6d62 6572 730a 2020 2020  ese numbers.    
-0001ea90: 6172 6520 616c 7265 6164 7920 6661 6374  are already fact
-0001eaa0: 6f72 6564 2069 6e74 6f20 7468 6520 6465  ored into the de
-0001eab0: 6164 6c69 6e65 2069 6e66 6f72 6d61 7469  adline informati
-0001eac0: 6f6e 2074 6865 2073 7461 7475 730a 2020  on the status.  
-0001ead0: 2020 636f 6e74 6169 6e73 292e 2054 6865    contains). The
-0001eae0: 7365 206e 756d 6265 7273 2077 696c 6c20  se numbers will 
-0001eaf0: 6265 2030 2066 6f72 2073 7475 6465 6e74  be 0 for student
-0001eb00: 7320 7768 6f20 646f 6e27 7420 6861 7665  s who don't have
-0001eb10: 0a20 2020 2065 7874 656e 7369 6f6e 732e  .    extensions.
-0001eb20: 0a20 2020 2022 2222 0a20 2020 2023 2047  .    """.    # G
-0001eb30: 6574 2065 7874 656e 7369 6f6e 2f72 6576  et extension/rev
-0001eb40: 6973 696f 6e20 6475 7261 7469 6f6e 7320  ision durations 
-0001eb50: 616e 6420 6772 6163 6520 7065 7269 6f64  and grace period
-0001eb60: 2066 726f 6d20 7461 736b 2069 6e66 6f3a   from task info:
-0001eb70: 0a20 2020 2073 7461 6e64 6172 645f 6578  .    standard_ex
-0001eb80: 745f 6872 7320 3d20 7461 736b 5f69 6e66  t_hrs = task_inf
-0001eb90: 6f2e 6765 7428 2265 7874 656e 7369 6f6e  o.get("extension
-0001eba0: 5f68 6f75 7273 222c 2032 3429 0a20 2020  _hours", 24).   
-0001ebb0: 2072 6576 6965 775f 686f 7572 7320 3d20   review_hours = 
-0001ebc0: 7461 736b 5f69 6e66 6f2e 6765 7428 2272  task_info.get("r
-0001ebd0: 6576 6965 775f 686f 7572 7322 2c20 3234  eview_hours", 24
-0001ebe0: 290a 2020 2020 6772 6163 655f 6d69 6e73  ).    grace_mins
-0001ebf0: 203d 2074 6173 6b5f 696e 666f 2e67 6574   = task_info.get
-0001ec00: 2822 6772 6163 655f 6d69 6e75 7465 7322  ("grace_minutes"
-0001ec10: 2c20 3029 0a20 2020 2072 6576 6973 696f  , 0).    revisio
-0001ec20: 6e5f 686f 7572 7320 3d20 7461 736b 5f69  n_hours = task_i
-0001ec30: 6e66 6f2e 6765 7428 2272 6576 6973 696f  nfo.get("revisio
-0001ec40: 6e5f 686f 7572 7322 2c20 3732 290a 0a20  n_hours", 72).. 
-0001ec50: 2020 2023 2047 6574 2070 7365 742d 7370     # Get pset-sp
-0001ec60: 6563 6966 6963 2072 6576 6965 772f 6772  ecific review/gr
-0001ec70: 6163 652f 7265 7669 7369 6f6e 2069 6e66  ace/revision inf
-0001ec80: 6f20 6966 2069 7420 6578 6973 7473 0a20  o if it exists. 
-0001ec90: 2020 2072 6576 6965 775f 686f 7572 7320     review_hours 
-0001eca0: 3d20 7073 6574 5f6f 626a 2e67 6574 2822  = pset_obj.get("
-0001ecb0: 7265 7669 6577 5f68 6f75 7273 222c 2072  review_hours", r
-0001ecc0: 6576 6965 775f 686f 7572 7329 0a20 2020  eview_hours).   
-0001ecd0: 2067 7261 6365 5f6d 696e 7320 3d20 7073   grace_mins = ps
-0001ece0: 6574 5f6f 626a 2e67 6574 2822 6772 6163  et_obj.get("grac
-0001ecf0: 655f 6d69 6e75 7465 7322 2c20 6772 6163  e_minutes", grac
-0001ed00: 655f 6d69 6e73 290a 2020 2020 7265 7669  e_mins).    revi
-0001ed10: 7369 6f6e 5f68 6f75 7273 203d 2070 7365  sion_hours = pse
-0001ed20: 745f 6f62 6a2e 6765 7428 2272 6576 6973  t_obj.get("revis
-0001ed30: 696f 6e5f 686f 7572 7322 2c20 7265 7669  ion_hours", revi
-0001ed40: 7369 6f6e 5f68 6f75 7273 290a 0a20 2020  sion_hours)..   
-0001ed50: 2023 2046 6967 7572 6520 6f75 7420 6578   # Figure out ex
-0001ed60: 7465 6e73 696f 6e20 616d 6f75 6e74 730a  tension amounts.
-0001ed70: 2020 2020 696e 6974 6961 6c5f 6578 7465      initial_exte
-0001ed80: 6e73 696f 6e20 3d20 300a 2020 2020 6966  nsion = 0.    if
-0001ed90: 2065 7874 656e 7369 6f6e 735b 305d 2069   extensions[0] i
-0001eda0: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
-0001edb0: 696e 6974 6961 6c5f 6578 7465 6e73 696f  initial_extensio
-0001edc0: 6e20 3d20 7374 616e 6461 7264 5f65 7874  n = standard_ext
-0001edd0: 5f68 7273 0a20 2020 2065 6c69 6620 6973  _hrs.    elif is
-0001ede0: 696e 7374 616e 6365 2865 7874 656e 7369  instance(extensi
-0001edf0: 6f6e 735b 305d 2c20 2869 6e74 2c20 666c  ons[0], (int, fl
-0001ee00: 6f61 7429 293a 0a20 2020 2020 2020 2069  oat)):.        i
-0001ee10: 6e69 7469 616c 5f65 7874 656e 7369 6f6e  nitial_extension
-0001ee20: 203d 2065 7874 656e 7369 6f6e 735b 305d   = extensions[0]
-0001ee30: 0a20 2020 2065 6c69 6620 6578 7465 6e73  .    elif extens
-0001ee40: 696f 6e73 5b30 5d20 6973 206e 6f74 2046  ions[0] is not F
-0001ee50: 616c 7365 3a0a 2020 2020 2020 2020 666c  alse:.        fl
-0001ee60: 6173 6b2e 666c 6173 6828 0a20 2020 2020  ask.flash(.     
-0001ee70: 2020 2020 2020 2022 4967 6e6f 7269 6e67         "Ignoring
-0001ee80: 2069 6e76 616c 6964 2069 6e69 7469 616c   invalid initial
-0001ee90: 2065 7874 656e 7369 6f6e 2076 616c 7565   extension value
-0001eea0: 2027 7b7d 2722 2e66 6f72 6d61 7428 0a20   '{}'".format(. 
-0001eeb0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001eec0: 7874 656e 7369 6f6e 735b 305d 0a20 2020  xtensions[0].   
-0001eed0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001eee0: 2020 2029 0a0a 2020 2020 7265 7669 7369     )..    revisi
-0001eef0: 6f6e 5f65 7874 656e 7369 6f6e 203d 2030  on_extension = 0
-0001ef00: 0a20 2020 2069 6620 6578 7465 6e73 696f  .    if extensio
-0001ef10: 6e73 5b31 5d20 6973 2054 7275 653a 0a20  ns[1] is True:. 
-0001ef20: 2020 2020 2020 2072 6576 6973 696f 6e5f         revision_
-0001ef30: 6578 7465 6e73 696f 6e20 3d20 7374 616e  extension = stan
-0001ef40: 6461 7264 5f65 7874 5f68 7273 0a20 2020  dard_ext_hrs.   
-0001ef50: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0001ef60: 2865 7874 656e 7369 6f6e 735b 315d 2c20  (extensions[1], 
-0001ef70: 2869 6e74 2c20 666c 6f61 7429 293a 0a20  (int, float)):. 
-0001ef80: 2020 2020 2020 2072 6576 6973 696f 6e5f         revision_
-0001ef90: 6578 7465 6e73 696f 6e20 3d20 6578 7465  extension = exte
-0001efa0: 6e73 696f 6e73 5b31 5d0a 2020 2020 656c  nsions[1].    el
-0001efb0: 6966 2065 7874 656e 7369 6f6e 735b 315d  if extensions[1]
-0001efc0: 2069 7320 6e6f 7420 4661 6c73 653a 0a20   is not False:. 
-0001efd0: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
-0001efe0: 7368 280a 2020 2020 2020 2020 2020 2020  sh(.            
-0001eff0: 2249 676e 6f72 696e 6720 696e 7661 6c69  "Ignoring invali
-0001f000: 6420 7265 7669 7369 6f6e 2065 7874 656e  d revision exten
-0001f010: 7369 6f6e 2076 616c 7565 2027 7b7d 2722  sion value '{}'"
-0001f020: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
-0001f030: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
-0001f040: 6f6e 735b 315d 0a20 2020 2020 2020 2020  ons[1].         
-0001f050: 2020 2029 0a20 2020 2020 2020 2029 0a0a     ).        )..
-0001f060: 2020 2020 2320 5468 6520 6465 6661 756c      # The defaul
-0001f070: 7420 7265 7375 6c74 0a20 2020 2072 6573  t result.    res
-0001f080: 756c 7420 3d20 7b0a 2020 2020 2020 2020  ult = {.        
-0001f090: 2773 7461 7465 273a 2022 756e 6b6e 6f77  'state': "unknow
-0001f0a0: 6e22 2c0a 2020 2020 2020 2020 2772 656c  n",.        'rel
-0001f0b0: 6561 7365 273a 207b 0a20 2020 2020 2020  ease': {.       
-0001f0c0: 2020 2020 2027 6174 273a 204e 6f6e 652c       'at': None,
-0001f0d0: 0a20 2020 2020 2020 2020 2020 2027 6174  .            'at
-0001f0e0: 5f73 7472 273a 2027 756e 6b6e 6f77 6e27  _str': 'unknown'
-0001f0f0: 2c0a 2020 2020 2020 2020 2020 2020 2775  ,.            'u
-0001f100: 6e74 696c 273a 204e 6f6e 652c 0a20 2020  ntil': None,.   
-0001f110: 2020 2020 2020 2020 2027 756e 7469 6c5f           'until_
-0001f120: 7374 7227 3a20 2761 7420 736f 6d65 2070  str': 'at some p
-0001f130: 6f69 6e74 2028 6e6f 7420 7965 7420 7370  oint (not yet sp
-0001f140: 6563 6966 6965 6429 270a 2020 2020 2020  ecified)'.      
-0001f150: 2020 7d2c 0a20 2020 2020 2020 2027 6475    },.        'du
-0001f160: 6527 3a20 7b0a 2020 2020 2020 2020 2020  e': {.          
-0001f170: 2020 2761 7427 3a20 4e6f 6e65 2c0a 2020    'at': None,.  
-0001f180: 2020 2020 2020 2020 2020 2761 745f 7374            'at_st
-0001f190: 7227 3a20 2775 6e6b 6e6f 776e 272c 0a20  r': 'unknown',. 
-0001f1a0: 2020 2020 2020 2020 2020 2027 756e 7469             'unti
-0001f1b0: 6c27 3a20 4e6f 6e65 2c0a 2020 2020 2020  l': None,.      
-0001f1c0: 2020 2020 2020 2775 6e74 696c 5f73 7472        'until_str
-0001f1d0: 273a 2027 6174 2073 6f6d 6520 706f 696e  ': 'at some poin
-0001f1e0: 7420 286e 6f74 2079 6574 2073 7065 6369  t (not yet speci
-0001f1f0: 6669 6564 2927 0a20 2020 2020 2020 207d  fied)'.        }
-0001f200: 2c0a 2020 2020 2020 2020 2772 6576 6965  ,.        'revie
-0001f210: 7765 6427 3a20 7b0a 2020 2020 2020 2020  wed': {.        
-0001f220: 2020 2020 2761 7427 3a20 4e6f 6e65 2c0a      'at': None,.
-0001f230: 2020 2020 2020 2020 2020 2020 2761 745f              'at_
-0001f240: 7374 7227 3a20 2775 6e6b 6e6f 776e 272c  str': 'unknown',
-0001f250: 0a20 2020 2020 2020 2020 2020 2027 756e  .            'un
-0001f260: 7469 6c27 3a20 4e6f 6e65 2c0a 2020 2020  til': None,.    
-0001f270: 2020 2020 2020 2020 2775 6e74 696c 5f73          'until_s
-0001f280: 7472 273a 2027 6174 2073 6f6d 6520 706f  tr': 'at some po
-0001f290: 696e 7420 286e 6f74 2079 6574 2073 7065  int (not yet spe
-0001f2a0: 6369 6669 6564 2927 0a20 2020 2020 2020  cified)'.       
-0001f2b0: 207d 2c0a 2020 2020 2020 2020 2766 696e   },.        'fin
-0001f2c0: 616c 697a 6564 273a 207b 0a20 2020 2020  alized': {.     
-0001f2d0: 2020 2020 2020 2027 6174 273a 204e 6f6e         'at': Non
-0001f2e0: 652c 0a20 2020 2020 2020 2020 2020 2027  e,.            '
-0001f2f0: 6174 5f73 7472 273a 2027 756e 6b6e 6f77  at_str': 'unknow
-0001f300: 6e27 2c0a 2020 2020 2020 2020 2020 2020  n',.            
-0001f310: 2775 6e74 696c 273a 204e 6f6e 652c 0a20  'until': None,. 
-0001f320: 2020 2020 2020 2020 2020 2027 756e 7469             'unti
-0001f330: 6c5f 7374 7227 3a20 2761 7420 736f 6d65  l_str': 'at some
-0001f340: 2070 6f69 6e74 2028 6e6f 7420 7965 7420   point (not yet 
-0001f350: 7370 6563 6966 6965 6429 270a 2020 2020  specified)'.    
-0001f360: 2020 2020 7d2c 0a20 2020 2020 2020 2027      },.        '
-0001f370: 696e 6974 6961 6c5f 6578 7465 6e73 696f  initial_extensio
-0001f380: 6e27 3a20 302c 0a20 2020 2020 2020 2027  n': 0,.        '
-0001f390: 7265 7669 7369 6f6e 5f65 7874 656e 7369  revision_extensi
-0001f3a0: 6f6e 273a 2030 2c0a 2020 2020 7d0a 0a20  on': 0,.    }.. 
-0001f3b0: 2020 2023 2053 6176 6520 6578 7465 6e73     # Save extens
-0001f3c0: 696f 6e20 696e 666f 0a20 2020 2072 6573  ion info.    res
-0001f3d0: 756c 745b 2769 6e69 7469 616c 5f65 7874  ult['initial_ext
-0001f3e0: 656e 7369 6f6e 275d 203d 2069 6e69 7469  ension'] = initi
-0001f3f0: 616c 5f65 7874 656e 7369 6f6e 206f 7220  al_extension or 
-0001f400: 300a 2020 2020 7265 7375 6c74 5b27 7265  0.    result['re
-0001f410: 7669 7369 6f6e 5f65 7874 656e 7369 6f6e  vision_extension
-0001f420: 275d 203d 2072 6576 6973 696f 6e5f 6578  '] = revision_ex
-0001f430: 7465 6e73 696f 6e20 6f72 2030 0a0a 2020  tension or 0..  
-0001f440: 2020 2320 4765 7420 6375 7272 656e 7420    # Get current 
-0001f450: 7469 6d65 3a0a 2020 2020 6966 2022 5041  time:.    if "PA
-0001f460: 5553 455f 4154 2220 696e 2074 6173 6b5f  USE_AT" in task_
-0001f470: 696e 666f 2061 6e64 2074 6173 6b5f 696e  info and task_in
-0001f480: 666f 5b22 5041 5553 455f 4154 225d 3a0a  fo["PAUSE_AT"]:.
-0001f490: 2020 2020 2020 2020 6e6f 7720 3d20 706f          now = po
-0001f4a0: 746c 7563 6b2e 7469 6d65 5f75 7469 6c73  tluck.time_utils
-0001f4b0: 2e74 6173 6b5f 7469 6d65 5f5f 7469 6d65  .task_time__time
-0001f4c0: 280a 2020 2020 2020 2020 2020 2020 7461  (.            ta
-0001f4d0: 736b 5f69 6e66 6f2c 0a20 2020 2020 2020  sk_info,.       
-0001f4e0: 2020 2020 2074 6173 6b5f 696e 666f 5b22       task_info["
-0001f4f0: 5041 5553 455f 4154 225d 0a20 2020 2020  PAUSE_AT"].     
-0001f500: 2020 2029 0a20 2020 2065 6c73 653a 0a20     ).    else:. 
-0001f510: 2020 2020 2020 206e 6f77 203d 2070 6f74         now = pot
-0001f520: 6c75 636b 2e74 696d 655f 7574 696c 732e  luck.time_utils.
-0001f530: 6e6f 7728 290a 0a20 2020 2023 2047 6574  now()..    # Get
-0001f540: 2072 656c 6561 7365 2064 6174 652f 7469   release date/ti
-0001f550: 6d65 3a0a 2020 2020 7265 6c65 6173 655f  me:.    release_
-0001f560: 6174 203d 2070 7365 745f 6f62 6a2e 6765  at = pset_obj.ge
-0001f570: 7428 2272 656c 6561 7365 222c 204e 6f6e  t("release", Non
-0001f580: 6529 2023 2069 6620 4e6f 6e65 2c20 7765  e) # if None, we
-0001f590: 2061 7373 756d 6520 7265 6c65 6173 650a   assume release.
-0001f5a0: 2020 2020 6966 2072 656c 6561 7365 5f61      if release_a
-0001f5b0: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
-0001f5c0: 2020 2020 2020 2072 656c 6561 7365 5f61         release_a
-0001f5d0: 7420 3d20 706f 746c 7563 6b2e 7469 6d65  t = potluck.time
-0001f5e0: 5f75 7469 6c73 2e74 6173 6b5f 7469 6d65  _utils.task_time
-0001f5f0: 5f5f 7469 6d65 280a 2020 2020 2020 2020  __time(.        
-0001f600: 2020 2020 7461 736b 5f69 6e66 6f2c 0a20      task_info,. 
-0001f610: 2020 2020 2020 2020 2020 2072 656c 6561             relea
-0001f620: 7365 5f61 742c 0a20 2020 2020 2020 2020  se_at,.         
-0001f630: 2020 2064 6566 6175 6c74 5f74 696d 655f     default_time_
-0001f640: 6f66 5f64 6179 3d74 6173 6b5f 696e 666f  of_day=task_info
-0001f650: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
-0001f660: 2020 2020 2020 2264 6566 6175 6c74 5f72        "default_r
-0001f670: 656c 6561 7365 5f74 696d 655f 6f66 5f64  elease_time_of_d
-0001f680: 6179 222c 0a20 2020 2020 2020 2020 2020  ay",.           
-0001f690: 2020 2020 2022 3233 3a35 3922 0a20 2020       "23:59".   
-0001f6a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001f6b0: 2020 2029 0a20 2020 2020 2020 2023 2046     ).        # F
-0001f6c0: 696c 6c20 696e 2072 656c 6561 7365 2069  ill in release i
-0001f6d0: 6e66 6f0a 2020 2020 2020 2020 7265 7375  nfo.        resu
-0001f6e0: 6c74 5b27 7265 6c65 6173 6527 5d5b 2761  lt['release']['a
-0001f6f0: 7427 5d20 3d20 7265 6c65 6173 655f 6174  t'] = release_at
-0001f700: 0a20 2020 2020 2020 2072 6573 756c 745b  .        result[
-0001f710: 2772 656c 6561 7365 275d 5b27 6174 5f73  'release']['at_s
-0001f720: 7472 275d 203d 2070 6f74 6c75 636b 2e74  tr'] = potluck.t
-0001f730: 696d 655f 7574 696c 732e 666d 745f 6461  ime_utils.fmt_da
-0001f740: 7465 7469 6d65 280a 2020 2020 2020 2020  tetime(.        
-0001f750: 2020 2020 7265 6c65 6173 655f 6174 0a20      release_at. 
-0001f760: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001f770: 2075 6e74 696c 5f72 656c 6561 7365 203d   until_release =
-0001f780: 2072 656c 6561 7365 5f61 7420 2d20 6e6f   release_at - no
-0001f790: 770a 2020 2020 2020 2020 7265 7375 6c74  w.        result
-0001f7a0: 5b27 7265 6c65 6173 6527 5d5b 2775 6e74  ['release']['unt
-0001f7b0: 696c 275d 203d 2075 6e74 696c 5f72 656c  il'] = until_rel
-0001f7c0: 6561 7365 0a20 2020 2020 2020 2072 6573  ease.        res
-0001f7d0: 756c 745b 2772 656c 6561 7365 275d 5b27  ult['release']['
-0001f7e0: 756e 7469 6c5f 7374 7227 5d20 3d20 6675  until_str'] = fu
-0001f7f0: 7a7a 795f 7469 6d65 280a 2020 2020 2020  zzy_time(.      
-0001f800: 2020 2020 2020 756e 7469 6c5f 7265 6c65        until_rele
-0001f810: 6173 652e 746f 7461 6c5f 7365 636f 6e64  ase.total_second
-0001f820: 7328 290a 2020 2020 2020 2020 290a 0a20  s().        ).. 
-0001f830: 2020 2023 2047 6574 2064 7565 2064 6174     # Get due dat
-0001f840: 652f 7469 6d65 3a0a 2020 2020 6475 655f  e/time:.    due_
-0001f850: 6174 203d 2070 7365 745f 6f62 6a2e 6765  at = pset_obj.ge
-0001f860: 7428 2264 7565 222c 204e 6f6e 6529 0a20  t("due", None). 
-0001f870: 2020 2069 6620 6475 655f 6174 2069 7320     if due_at is 
-0001f880: 4e6f 6e65 3a0a 2020 2020 2020 2020 2320  None:.        # 
-0001f890: 5265 7475 726e 2065 6d70 7479 2072 6573  Return empty res
-0001f8a0: 756c 740a 2020 2020 2020 2020 7265 7475  ult.        retu
-0001f8b0: 726e 2072 6573 756c 740a 2020 2020 656c  rn result.    el
-0001f8c0: 7365 3a0a 2020 2020 2020 2020 6475 655f  se:.        due_
-0001f8d0: 6174 203d 2070 6f74 6c75 636b 2e74 696d  at = potluck.tim
-0001f8e0: 655f 7574 696c 732e 7461 736b 5f74 696d  e_utils.task_tim
-0001f8f0: 655f 5f74 696d 6528 0a20 2020 2020 2020  e__time(.       
-0001f900: 2020 2020 2074 6173 6b5f 696e 666f 2c0a       task_info,.
-0001f910: 2020 2020 2020 2020 2020 2020 6475 655f              due_
-0001f920: 6174 2c0a 2020 2020 2020 2020 2020 2020  at,.            
-0001f930: 6465 6661 756c 745f 7469 6d65 5f6f 665f  default_time_of_
-0001f940: 6461 793d 7461 736b 5f69 6e66 6f2e 6765  day=task_info.ge
-0001f950: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0001f960: 2020 2022 6465 6661 756c 745f 6475 655f     "default_due_
-0001f970: 7469 6d65 5f6f 665f 6461 7922 2c0a 2020  time_of_day",.  
-0001f980: 2020 2020 2020 2020 2020 2020 2020 2232                "2
-0001f990: 333a 3539 220a 2020 2020 2020 2020 2020  3:59".          
-0001f9a0: 2020 290a 2020 2020 2020 2020 290a 2020    ).        ).  
-0001f9b0: 2020 2020 2020 7265 7669 6577 5f65 6e64        review_end
-0001f9c0: 203d 2064 7565 5f61 7420 2b20 6461 7465   = due_at + date
-0001f9d0: 7469 6d65 2e74 696d 6564 656c 7461 2868  time.timedelta(h
-0001f9e0: 6f75 7273 3d72 6576 6965 775f 686f 7572  ours=review_hour
-0001f9f0: 7329 0a0a 2020 2020 6475 655f 7374 7269  s)..    due_stri
-0001fa00: 6e67 203d 2070 6f74 6c75 636b 2e74 696d  ng = potluck.tim
-0001fa10: 655f 7574 696c 732e 666d 745f 6461 7465  e_utils.fmt_date
-0001fa20: 7469 6d65 2864 7565 5f61 7429 0a0a 2020  time(due_at)..  
-0001fa30: 2020 6261 7365 5f64 6561 646c 696e 6520    base_deadline 
-0001fa40: 3d20 6475 655f 6174 0a0a 2020 2020 2320  = due_at..    # 
-0001fa50: 4164 6420 6578 7465 6e73 696f 6e20 686f  Add extension ho
-0001fa60: 7572 733a 0a20 2020 2069 6620 696e 6974  urs:.    if init
-0001fa70: 6961 6c5f 6578 7465 6e73 696f 6e20 3e20  ial_extension > 
-0001fa80: 303a 0a20 2020 2020 2020 2064 7565 5f61  0:.        due_a
-0001fa90: 7420 2b3d 2064 6174 6574 696d 652e 7469  t += datetime.ti
-0001faa0: 6d65 6465 6c74 6128 686f 7572 733d 696e  medelta(hours=in
-0001fab0: 6974 6961 6c5f 6578 7465 6e73 696f 6e29  itial_extension)
-0001fac0: 0a20 2020 2020 2020 2064 7565 5f73 7472  .        due_str
-0001fad0: 696e 6720 3d20 706f 746c 7563 6b2e 7469  ing = potluck.ti
-0001fae0: 6d65 5f75 7469 6c73 2e66 6d74 5f64 6174  me_utils.fmt_dat
-0001faf0: 6574 696d 6528 6475 655f 6174 2920 2b20  etime(due_at) + 
-0001fb00: 280a 2020 2020 2020 2020 2020 2020 2720  (.            ' 
-0001fb10: 3c73 7061 6e20 636c 6173 733d 2265 7874  <span class="ext
-0001fb20: 656e 7369 6f6e 5f74 616b 656e 223e 270a  ension_taken">'.
-0001fb30: 2020 2020 2020 2020 2020 2b20 2728 6166            + '(af
-0001fb40: 7465 7220 6163 636f 756e 7469 6e67 2066  ter accounting f
-0001fb50: 6f72 2079 6f75 7220 7b7d e280 9168 6f75  or your {}...hou
-0001fb60: 7220 6578 7465 6e73 696f 6e29 270a 2020  r extension)'.  
-0001fb70: 2020 2020 2020 2020 2b20 273c 2f73 7061          + '</spa
-0001fb80: 6e3e 270a 2020 2020 2020 2020 292e 666f  n>'.        ).fo
-0001fb90: 726d 6174 2869 6e69 7469 616c 5f65 7874  rmat(initial_ext
-0001fba0: 656e 7369 6f6e 290a 0a20 2020 2067 7261  ension)..    gra
-0001fbb0: 6365 5f64 6561 646c 696e 6520 3d20 6475  ce_deadline = du
-0001fbc0: 655f 6174 202b 2064 6174 6574 696d 652e  e_at + datetime.
-0001fbd0: 7469 6d65 6465 6c74 6128 6d69 6e75 7465  timedelta(minute
-0001fbe0: 733d 6772 6163 655f 6d69 6e73 290a 0a20  s=grace_mins).. 
-0001fbf0: 2020 2023 2046 696c 6c20 696e 2064 7565     # Fill in due
-0001fc00: 2069 6e66 6f0a 2020 2020 7265 7375 6c74   info.    result
-0001fc10: 5b27 6475 6527 5d5b 2761 7427 5d20 3d20  ['due']['at'] = 
-0001fc20: 6475 655f 6174 0a20 2020 2072 6573 756c  due_at.    resul
-0001fc30: 745b 2764 7565 275d 5b27 6174 5f73 7472  t['due']['at_str
-0001fc40: 275d 203d 2064 7565 5f73 7472 696e 670a  '] = due_string.
-0001fc50: 2020 2020 756e 7469 6c5f 6475 6520 3d20      until_due = 
-0001fc60: 6475 655f 6174 202d 206e 6f77 0a20 2020  due_at - now.   
-0001fc70: 2072 6573 756c 745b 2764 7565 275d 5b27   result['due']['
-0001fc80: 756e 7469 6c27 5d20 3d20 756e 7469 6c5f  until'] = until_
-0001fc90: 6475 650a 2020 2020 7265 7375 6c74 5b27  due.    result['
-0001fca0: 6475 6527 5d5b 2775 6e74 696c 5f73 7472  due']['until_str
-0001fcb0: 275d 203d 2066 757a 7a79 5f74 696d 6528  '] = fuzzy_time(
-0001fcc0: 756e 7469 6c5f 6475 652e 746f 7461 6c5f  until_due.total_
-0001fcd0: 7365 636f 6e64 7328 2929 0a0a 2020 2020  seconds())..    
-0001fce0: 2320 4669 6c6c 2069 6e20 7265 7669 6577  # Fill in review
-0001fcf0: 2069 6e66 6f0a 2020 2020 7265 7375 6c74   info.    result
-0001fd00: 5b27 7265 7669 6577 6564 275d 5b27 6174  ['reviewed']['at
-0001fd10: 275d 203d 2072 6576 6965 775f 656e 640a  '] = review_end.
-0001fd20: 2020 2020 7265 7375 6c74 5b27 7265 7669      result['revi
-0001fd30: 6577 6564 275d 5b27 6174 5f73 7472 275d  ewed']['at_str']
-0001fd40: 203d 2070 6f74 6c75 636b 2e74 696d 655f   = potluck.time_
-0001fd50: 7574 696c 732e 666d 745f 6461 7465 7469  utils.fmt_dateti
-0001fd60: 6d65 280a 2020 2020 2020 2020 7265 7669  me(.        revi
-0001fd70: 6577 5f65 6e64 0a20 2020 2029 0a20 2020  ew_end.    ).   
-0001fd80: 2075 6e74 696c 5f72 6576 6965 7765 6420   until_reviewed 
-0001fd90: 3d20 7265 7669 6577 5f65 6e64 202d 206e  = review_end - n
-0001fda0: 6f77 0a20 2020 2072 6573 756c 745b 2772  ow.    result['r
-0001fdb0: 6576 6965 7765 6427 5d5b 2775 6e74 696c  eviewed']['until
-0001fdc0: 275d 203d 2075 6e74 696c 5f72 6576 6965  '] = until_revie
-0001fdd0: 7765 640a 2020 2020 7265 7375 6c74 5b27  wed.    result['
-0001fde0: 7265 7669 6577 6564 275d 5b27 756e 7469  reviewed']['unti
-0001fdf0: 6c5f 7374 7227 5d20 3d20 6675 7a7a 795f  l_str'] = fuzzy_
-0001fe00: 7469 6d65 280a 2020 2020 2020 2020 756e  time(.        un
-0001fe10: 7469 6c5f 7265 7669 6577 6564 2e74 6f74  til_reviewed.tot
-0001fe20: 616c 5f73 6563 6f6e 6473 2829 0a20 2020  al_seconds().   
-0001fe30: 2029 0a0a 2020 2020 2320 4765 7420 6669   )..    # Get fi
-0001fe40: 6e61 6c20 6461 7465 2f74 696d 653a 0a20  nal date/time:. 
-0001fe50: 2020 2023 204e 6f74 653a 2061 6e79 2065     # Note: any e
-0001fe60: 7874 656e 7369 6f6e 2074 6f20 7468 6520  xtension to the 
-0001fe70: 696e 6974 6961 6c20 6465 6164 6c69 6e65  initial deadline
-0001fe80: 2069 7320 6967 6e6f 7265 642e 2041 2073   is ignored. A s
-0001fe90: 6570 6172 6174 650a 2020 2020 2320 7265  eparate.    # re
-0001fea0: 7669 7369 6f6e 2065 7874 656e 7369 6f6e  vision extension
-0001feb0: 2073 686f 756c 6420 6265 2069 7373 7565   should be issue
-0001fec0: 6420 7768 656e 2061 6e20 696e 6974 6961  d when an initia
-0001fed0: 6c20 6578 7465 6e73 696f 6e20 6561 7473  l extension eats
-0001fee0: 0a20 2020 2023 2075 7020 746f 6f20 6d75  .    # up too mu
-0001fef0: 6368 206f 6620 7468 6520 7265 7669 7369  ch of the revisi
-0001ff00: 6f6e 2070 6572 696f 642e 0a20 2020 2066  on period..    f
-0001ff10: 696e 616c 5f61 7420 3d20 6261 7365 5f64  inal_at = base_d
-0001ff20: 6561 646c 696e 6520 2b20 6461 7465 7469  eadline + dateti
-0001ff30: 6d65 2e74 696d 6564 656c 7461 280a 2020  me.timedelta(.  
-0001ff40: 2020 2020 2020 686f 7572 733d 7265 7669        hours=revi
-0001ff50: 6577 5f68 6f75 7273 202b 2072 6576 6973  ew_hours + revis
-0001ff60: 696f 6e5f 686f 7572 730a 2020 2020 290a  ion_hours.    ).
-0001ff70: 0a20 2020 2066 696e 616c 5f73 7472 696e  .    final_strin
-0001ff80: 6720 3d20 706f 746c 7563 6b2e 7469 6d65  g = potluck.time
-0001ff90: 5f75 7469 6c73 2e66 6d74 5f64 6174 6574  _utils.fmt_datet
-0001ffa0: 696d 6528 6669 6e61 6c5f 6174 290a 0a20  ime(final_at).. 
-0001ffb0: 2020 2023 2041 6464 2065 7874 656e 7369     # Add extensi
-0001ffc0: 6f6e 2068 6f75 7273 3a0a 2020 2020 6966  on hours:.    if
-0001ffd0: 2072 6576 6973 696f 6e5f 6578 7465 6e73   revision_extens
-0001ffe0: 696f 6e20 3e20 303a 0a20 2020 2020 2020  ion > 0:.       
-0001fff0: 2066 696e 616c 5f61 7420 2b3d 2064 6174   final_at += dat
-00020000: 6574 696d 652e 7469 6d65 6465 6c74 6128  etime.timedelta(
-00020010: 686f 7572 733d 7265 7669 7369 6f6e 5f65  hours=revision_e
-00020020: 7874 656e 7369 6f6e 290a 2020 2020 2020  xtension).      
-00020030: 2020 6669 6e61 6c5f 7374 7269 6e67 203d    final_string =
-00020040: 2070 6f74 6c75 636b 2e74 696d 655f 7574   potluck.time_ut
-00020050: 696c 732e 666d 745f 6461 7465 7469 6d65  ils.fmt_datetime
-00020060: 2866 696e 616c 5f61 7429 202b 2028 0a20  (final_at) + (. 
-00020070: 2020 2020 2020 2020 2020 2027 203c 7370             ' <sp
-00020080: 616e 2063 6c61 7373 3d22 6578 7465 6e73  an class="extens
-00020090: 696f 6e5f 7461 6b65 6e22 3e27 0a20 2020  ion_taken">'.   
-000200a0: 2020 2020 2020 202b 2027 2861 6674 6572         + '(after
-000200b0: 2061 6363 6f75 6e74 696e 6720 666f 7220   accounting for 
-000200c0: 796f 7572 207b 7de2 8091 686f 7572 2065  your {}...hour e
-000200d0: 7874 656e 7369 6f6e 2927 0a20 2020 2020  xtension)'.     
-000200e0: 2020 2020 202b 2027 3c2f 7370 616e 3e27       + '</span>'
-000200f0: 0a20 2020 2020 2020 2029 2e66 6f72 6d61  .        ).forma
-00020100: 7428 7265 7669 7369 6f6e 5f65 7874 656e  t(revision_exten
-00020110: 7369 6f6e 290a 0a20 2020 2067 7261 6365  sion)..    grace
-00020120: 5f66 696e 616c 203d 2066 696e 616c 5f61  _final = final_a
-00020130: 7420 2b20 6461 7465 7469 6d65 2e74 696d  t + datetime.tim
-00020140: 6564 656c 7461 286d 696e 7574 6573 3d67  edelta(minutes=g
-00020150: 7261 6365 5f6d 696e 7329 0a0a 2020 2020  race_mins)..    
-00020160: 2320 4669 6c6c 2069 6e20 6669 6e61 6c69  # Fill in finali
-00020170: 7a61 7469 6f6e 2069 6e66 6f0a 2020 2020  zation info.    
-00020180: 7265 7375 6c74 5b27 6669 6e61 6c69 7a65  result['finalize
-00020190: 6427 5d5b 2761 7427 5d20 3d20 6669 6e61  d']['at'] = fina
-000201a0: 6c5f 6174 0a20 2020 2072 6573 756c 745b  l_at.    result[
-000201b0: 2766 696e 616c 697a 6564 275d 5b27 6174  'finalized']['at
-000201c0: 5f73 7472 275d 203d 2066 696e 616c 5f73  _str'] = final_s
-000201d0: 7472 696e 670a 2020 2020 756e 7469 6c5f  tring.    until_
-000201e0: 6669 6e61 6c20 3d20 6669 6e61 6c5f 6174  final = final_at
-000201f0: 202d 206e 6f77 0a20 2020 2072 6573 756c   - now.    resul
-00020200: 745b 2766 696e 616c 697a 6564 275d 5b27  t['finalized']['
-00020210: 756e 7469 6c27 5d20 3d20 756e 7469 6c5f  until'] = until_
-00020220: 6669 6e61 6c0a 2020 2020 7265 7375 6c74  final.    result
-00020230: 5b27 6669 6e61 6c69 7a65 6427 5d5b 2775  ['finalized']['u
-00020240: 6e74 696c 5f73 7472 275d 203d 2066 757a  ntil_str'] = fuz
-00020250: 7a79 5f74 696d 6528 756e 7469 6c5f 6669  zy_time(until_fi
-00020260: 6e61 6c2e 746f 7461 6c5f 7365 636f 6e64  nal.total_second
-00020270: 7328 2929 0a0a 2020 2020 2320 4368 6563  s())..    # Chec
-00020280: 6b20 7265 6c65 6173 6520 7469 6d65 3a0a  k release time:.
-00020290: 2020 2020 6966 2072 656c 6561 7365 5f61      if release_a
-000202a0: 7420 616e 6420 6e6f 7720 3c20 7265 6c65  t and now < rele
-000202b0: 6173 655f 6174 3a0a 2020 2020 2020 2020  ase_at:.        
-000202c0: 7265 7375 6c74 5b27 7374 6174 6527 5d20  result['state'] 
-000202d0: 3d20 2275 6e72 656c 6561 7365 6422 0a20  = "unreleased". 
-000202e0: 2020 2023 2050 6173 7365 6420 7265 6c65     # Passed rele
-000202f0: 6173 655f 6174 2070 6f69 6e74 3a20 6368  ase_at point: ch
-00020300: 6563 6b20 6966 2069 7427 7320 6475 6520  eck if it's due 
-00020310: 6f72 206e 6f74 0a20 2020 2065 6c69 6620  or not.    elif 
-00020320: 6e6f 7720 3c20 6772 6163 655f 6465 6164  now < grace_dead
-00020330: 6c69 6e65 3a0a 2020 2020 2020 2020 2320  line:.        # 
-00020340: 4e6f 7465 2074 696d 652d 7265 6d61 696e  Note time-remain
-00020350: 696e 6720 6967 6e6f 7265 7320 6772 6163  ing ignores grac
-00020360: 6520 7065 7269 6f64 2061 6e64 206d 6179  e period and may
-00020370: 2062 6520 6e65 6761 7469 7665 0a20 2020   be negative.   
-00020380: 2020 2020 2072 6573 756c 745b 2773 7461       result['sta
-00020390: 7465 275d 203d 2022 7265 6c65 6173 6564  te'] = "released
-000203a0: 220a 2020 2020 2320 5061 7373 6564 2064  ".    # Passed d
-000203b0: 7565 5f61 7420 706f 696e 743b 2063 6865  ue_at point; che
-000203c0: 636b 2069 6620 6974 2773 2073 7469 6c6c  ck if it's still
-000203d0: 2075 6e64 6572 2072 6576 6965 773a 0a20   under review:. 
-000203e0: 2020 2065 6c69 6620 6e6f 7720 3c20 7265     elif now < re
-000203f0: 7669 6577 5f65 6e64 3a0a 2020 2020 2020  view_end:.      
-00020400: 2020 7265 7375 6c74 5b27 7374 6174 6527    result['state'
-00020410: 5d20 3d20 2275 6e64 6572 5f72 6576 6965  ] = "under_revie
-00020420: 7722 0a20 2020 2023 2050 6173 7365 6420  w".    # Passed 
-00020430: 7265 7669 6577 2070 6572 696f 643a 2061  review period: a
-00020440: 7265 2072 6576 6973 696f 6e73 2073 7469  re revisions sti
-00020450: 6c6c 2062 6569 6e67 2061 6363 6570 7465  ll being accepte
-00020460: 643f 0a20 2020 2065 6c69 6620 6e6f 7720  d?.    elif now 
-00020470: 3c20 6772 6163 655f 6669 6e61 6c3a 0a20  < grace_final:. 
-00020480: 2020 2020 2020 2072 6573 756c 745b 2773         result['s
-00020490: 7461 7465 275d 203d 2022 7265 7669 7361  tate'] = "revisa
-000204a0: 626c 6522 0a20 2020 2023 2050 6173 7365  ble".    # Passe
-000204b0: 6420 7265 7669 6577 2070 6572 696f 643a  d review period:
-000204c0: 2069 7427 7320 6669 6e61 6c0a 2020 2020   it's final.    
-000204d0: 656c 7365 3a0a 2020 2020 2020 2020 7265  else:.        re
-000204e0: 7375 6c74 5b27 7374 6174 6527 5d20 3d20  sult['state'] = 
-000204f0: 2266 696e 616c 220a 0a20 2020 2072 6574  "final"..    ret
-00020500: 7572 6e20 7265 7375 6c74 0a0a 0a23 2d2d  urn result...#--
-00020510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020520: 2d2d 230a 2320 4669 6c65 6e61 6d65 2066  --#.# Filename f
-00020530: 756e 6374 696f 6e73 2023 0a23 2d2d 2d2d  unctions #.#----
-00020540: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020550: 230a 0a64 6566 2067 6574 5f73 7562 6d69  #..def get_submi
-00020560: 7373 696f 6e5f 6669 6c65 6e61 6d65 280a  ssion_filename(.
-00020570: 2020 2020 636f 7572 7365 2c0a 2020 2020      course,.    
-00020580: 7365 6d65 7374 6572 2c0a 2020 2020 7461  semester,.    ta
-00020590: 736b 5f69 6e66 6f2c 0a20 2020 2075 7365  sk_info,.    use
-000205a0: 726e 616d 652c 0a20 2020 2070 6861 7365  rname,.    phase
-000205b0: 2c0a 2020 2020 7073 6964 2c0a 2020 2020  ,.    psid,.    
-000205c0: 7461 736b 6964 0a29 3a0a 2020 2020 2222  taskid.):.    ""
-000205d0: 220a 2020 2020 5265 7475 726e 7320 7468  ".    Returns th
-000205e0: 6520 6669 6c65 6e61 6d65 2066 6f72 2074  e filename for t
-000205f0: 6865 2075 7365 7227 7320 7375 626d 6973  he user's submis
-00020600: 7369 6f6e 2066 6f72 2061 2067 6976 656e  sion for a given
-00020610: 0a20 2020 2070 6861 7365 2f70 7365 742f  .    phase/pset/
-00020620: 7461 736b 2e20 5261 6973 6573 2061 2056  task. Raises a V
-00020630: 616c 7565 4572 726f 7220 6966 2074 6865  alueError if the
-00020640: 2070 7365 7420 6f72 2074 6173 6b20 646f   pset or task do
-00020650: 6573 6e27 740a 2020 2020 6578 6974 2e0a  esn't.    exit..
-00020660: 0a20 2020 2054 4f44 4f3a 2044 6f20 7765  .    TODO: Do we
-00020670: 206a 7573 7420 646f 207a 6970 2066 696c   just do zip fil
-00020680: 6573 2066 6f72 206d 756c 7469 2d66 696c  es for multi-fil
-00020690: 6520 7461 736b 733f 2048 6f77 2069 7320  e tasks? How is 
-000206a0: 7468 6174 0a20 2020 2068 616e 646c 6564  that.    handled
-000206b0: 3f0a 2020 2020 2222 220a 2020 2020 7073  ?.    """.    ps
-000206c0: 203d 2067 6574 5f70 735f 6f62 6a28 7461   = get_ps_obj(ta
-000206d0: 736b 5f69 6e66 6f2c 2070 7369 6429 0a20  sk_info, psid). 
-000206e0: 2020 2074 6173 6b20 3d20 6765 745f 7461     task = get_ta
-000206f0: 736b 5f6f 626a 2874 6173 6b5f 696e 666f  sk_obj(task_info
-00020700: 2c20 7073 2c20 7461 736b 6964 290a 0a20  , ps, taskid).. 
-00020710: 2020 2072 6574 7572 6e20 7361 6665 5f6a     return safe_j
-00020720: 6f69 6e28 0a20 2020 2020 2020 2073 746f  oin(.        sto
-00020730: 7261 6765 2e73 7562 6d69 7373 696f 6e73  rage.submissions
-00020740: 5f66 6f6c 6465 7228 636f 7572 7365 2c20  _folder(course, 
-00020750: 7365 6d65 7374 6572 292c 0a20 2020 2020  semester),.     
-00020760: 2020 2075 7365 726e 616d 652c 0a20 2020     username,.   
-00020770: 2020 2020 2022 7b7d 5f7b 7d5f 7b7d 222e       "{}_{}_{}".
-00020780: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
-00020790: 2020 2020 7073 6964 2c0a 2020 2020 2020      psid,.      
-000207a0: 2020 2020 2020 7068 6173 652c 0a20 2020        phase,.   
-000207b0: 2020 2020 2020 2020 2074 6173 6b5b 2274           task["t
-000207c0: 6172 6765 7422 5d0a 2020 2020 2020 2020  arget"].        
-000207d0: 290a 2020 2020 290a 0a0a 232d 2d2d 2d2d  ).    )...#-----
-000207e0: 2d2d 2d2d 2d2d 2d2d 2d2d 230a 2320 4a69  ----------#.# Ji
-000207f0: 6e6a 6120 7375 7070 6f72 7420 230a 232d  nja support #.#-
-00020800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 230a  --------------#.
-00020810: 0a5f 736f 7274 6564 203d 2073 6f72 7465  ._sorted = sorte
-00020820: 640a 0a0a 4061 7070 2e74 656d 706c 6174  d...@app.templat
-00020830: 655f 6669 6c74 6572 2829 0a64 6566 2073  e_filter().def s
-00020840: 6f72 7465 6428 2a61 7267 732c 202a 2a6b  orted(*args, **k
-00020850: 7761 7267 7329 3a0a 2020 2020 2222 220a  wargs):.    """.
-00020860: 2020 2020 5475 726e 2062 7569 6c74 696e      Turn builtin
-00020870: 2073 6f72 7465 6420 696e 746f 2061 2074   sorted into a t
-00020880: 656d 706c 6174 6520 6669 6c74 6572 2e2e  emplate filter..
-00020890: 2e0a 2020 2020 2222 220a 2020 2020 7265  ..    """.    re
-000208a0: 7475 726e 205f 736f 7274 6564 282a 6172  turn _sorted(*ar
-000208b0: 6773 2c20 2a2a 6b77 6172 6773 290a 0a0a  gs, **kwargs)...
-000208c0: 4061 7070 2e74 656d 706c 6174 655f 6669  @app.template_fi
-000208d0: 6c74 6572 2829 0a64 6566 2066 757a 7a79  lter().def fuzzy
-000208e0: 5f74 696d 6528 7365 636f 6e64 7329 3a0a  _time(seconds):.
-000208f0: 2020 2020 2222 220a 2020 2020 5461 6b65      """.    Take
-00020900: 7320 6120 6e75 6d62 6572 206f 6620 7365  s a number of se
-00020910: 636f 6e64 7320 616e 6420 7265 7475 726e  conds and return
-00020920: 7320 6120 6675 7a7a 7920 7469 6d65 2076  s a fuzzy time v
-00020930: 616c 7565 2074 6861 7420 7368 6966 7473  alue that shifts
-00020940: 0a20 2020 2075 6e69 7473 2028 7570 2074  .    units (up t
-00020950: 6f20 7765 656b 7329 2064 6570 656e 6469  o weeks) dependi
-00020960: 6e67 206f 6e20 686f 7720 6d61 6e79 2073  ng on how many s
-00020970: 6563 6f6e 6473 2074 6865 7265 2061 7265  econds there are
-00020980: 2e20 4967 6e6f 7265 730a 2020 2020 7468  . Ignores.    th
-00020990: 6520 7369 676e 206f 6620 7468 6520 7661  e sign of the va
-000209a0: 6c75 652e 0a20 2020 2022 2222 0a20 2020  lue..    """.   
-000209b0: 2069 6620 7365 636f 6e64 7320 3c20 303a   if seconds < 0:
-000209c0: 0a20 2020 2020 2020 2073 6563 6f6e 6473  .        seconds
-000209d0: 203d 202d 7365 636f 6e64 730a 0a20 2020   = -seconds..   
-000209e0: 2077 6565 6b73 203d 2073 6563 6f6e 6473   weeks = seconds
-000209f0: 202f 204f 4e45 5f57 4545 4b0a 2020 2020   / ONE_WEEK.    
-00020a00: 7365 636f 6e64 7320 253d 204f 4e45 5f57  seconds %= ONE_W
-00020a10: 4545 4b0a 2020 2020 6461 7973 203d 2073  EEK.    days = s
-00020a20: 6563 6f6e 6473 202f 204f 4e45 5f44 4159  econds / ONE_DAY
-00020a30: 0a20 2020 2073 6563 6f6e 6473 2025 3d20  .    seconds %= 
-00020a40: 4f4e 455f 4441 590a 2020 2020 686f 7572  ONE_DAY.    hour
-00020a50: 7320 3d20 7365 636f 6e64 7320 2f20 4f4e  s = seconds / ON
-00020a60: 455f 484f 5552 0a20 2020 2073 6563 6f6e  E_HOUR.    secon
-00020a70: 6473 2025 3d20 4f4e 455f 484f 5552 0a20  ds %= ONE_HOUR. 
-00020a80: 2020 206d 696e 7574 6573 203d 2073 6563     minutes = sec
-00020a90: 6f6e 6473 202f 204f 4e45 5f4d 494e 5554  onds / ONE_MINUT
-00020aa0: 450a 2020 2020 7365 636f 6e64 7320 253d  E.    seconds %=
-00020ab0: 204f 4e45 5f4d 494e 5554 450a 2020 2020   ONE_MINUTE.    
-00020ac0: 6966 2069 6e74 2877 6565 6b73 2920 3e20  if int(weeks) > 
-00020ad0: 313a 0a20 2020 2020 2020 2069 6620 7765  1:.        if we
-00020ae0: 656b 7320 2520 3120 3e20 302e 3735 3a0a  eks % 1 > 0.75:.
-00020af0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00020b00: 726e 2022 616c 6d6f 7374 207b 3a2e 3066  rn "almost {:.0f
-00020b10: 7d20 7765 656b 7322 2e66 6f72 6d61 7428  } weeks".format(
-00020b20: 7765 656b 7320 2b20 3129 0a20 2020 2020  weeks + 1).     
-00020b30: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00020b40: 2020 2020 2072 6574 7572 6e20 227b 3a2e       return "{:.
-00020b50: 3066 7d20 7765 656b 7322 2e66 6f72 6d61  0f} weeks".forma
-00020b60: 7428 7765 656b 7329 0a20 2020 2065 6c69  t(weeks).    eli
-00020b70: 6620 696e 7428 7765 656b 7329 203d 3d20  f int(weeks) == 
-00020b80: 313a 0a20 2020 2020 2020 2072 6574 7572  1:.        retur
-00020b90: 6e20 227b 3a2e 3066 7d20 6461 7973 222e  n "{:.0f} days".
-00020ba0: 666f 726d 6174 2837 202b 2064 6179 7329  format(7 + days)
-00020bb0: 0a20 2020 2065 6c69 6620 696e 7428 6461  .    elif int(da
-00020bc0: 7973 2920 3e20 313a 0a20 2020 2020 2020  ys) > 1:.       
-00020bd0: 2069 6620 6461 7973 2025 2031 203e 2030   if days % 1 > 0
-00020be0: 2e37 353a 0a20 2020 2020 2020 2020 2020  .75:.           
-00020bf0: 2072 6574 7572 6e20 2261 6c6d 6f73 7420   return "almost 
-00020c00: 7b3a 2e30 667d 2064 6179 7322 2e66 6f72  {:.0f} days".for
-00020c10: 6d61 7428 6461 7973 202b 2031 290a 2020  mat(days + 1).  
-00020c20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00020c30: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00020c40: 7b3a 2e30 667d 2064 6179 7322 2e66 6f72  {:.0f} days".for
-00020c50: 6d61 7428 6461 7973 290a 2020 2020 656c  mat(days).    el
-00020c60: 6966 2069 6e74 2864 6179 7329 203d 3d20  if int(days) == 
-00020c70: 313a 0a20 2020 2020 2020 2072 6574 7572  1:.        retur
-00020c80: 6e20 227b 3a2e 3066 7d20 686f 7572 7322  n "{:.0f} hours"
-00020c90: 2e66 6f72 6d61 7428 3234 202b 2068 6f75  .format(24 + hou
-00020ca0: 7273 290a 2020 2020 656c 6966 2068 6f75  rs).    elif hou
-00020cb0: 7273 203e 2034 3a0a 2020 2020 2020 2020  rs > 4:.        
-00020cc0: 6966 2068 6f75 7273 2025 2031 203e 2030  if hours % 1 > 0
-00020cd0: 2e37 353a 0a20 2020 2020 2020 2020 2020  .75:.           
-00020ce0: 2072 6574 7572 6e20 2261 6c6d 6f73 7420   return "almost 
-00020cf0: 7b3a 2e30 667d 2068 6f75 7273 222e 666f  {:.0f} hours".fo
-00020d00: 726d 6174 2868 6f75 7273 202b 2031 290a  rmat(hours + 1).
-00020d10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00020d20: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00020d30: 2022 7b3a 2e30 667d 2068 6f75 7273 222e   "{:.0f} hours".
-00020d40: 666f 726d 6174 2868 6f75 7273 290a 2020  format(hours).  
-00020d50: 2020 656c 6966 2069 6e74 2868 6f75 7273    elif int(hours
-00020d60: 2920 3e20 303a 0a20 2020 2020 2020 2072  ) > 0:.        r
-00020d70: 6574 7572 6e20 227b 3a2e 3066 7d68 207b  eturn "{:.0f}h {
-00020d80: 3a2e 3066 7d6d 222e 666f 726d 6174 2868  :.0f}m".format(h
-00020d90: 6f75 7273 2c20 6d69 6e75 7465 7329 0a20  ours, minutes). 
-00020da0: 2020 2065 6c69 6620 6d69 6e75 7465 7320     elif minutes 
-00020db0: 3e20 3330 3a0a 2020 2020 2020 2020 7265  > 30:.        re
-00020dc0: 7475 726e 2022 7b3a 2e30 667d 206d 696e  turn "{:.0f} min
-00020dd0: 7574 6573 222e 666f 726d 6174 286d 696e  utes".format(min
-00020de0: 7574 6573 290a 2020 2020 656c 7365 3a0a  utes).    else:.
-00020df0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00020e00: 7b3a 2e30 667d 6d20 7b3a 2e30 667d 7322  {:.0f}m {:.0f}s"
-00020e10: 2e66 6f72 6d61 7428 6d69 6e75 7465 732c  .format(minutes,
-00020e20: 2073 6563 6f6e 6473 290a 0a0a 4061 7070   seconds)...@app
-00020e30: 2e74 656d 706c 6174 655f 6669 6c74 6572  .template_filter
-00020e40: 2829 0a64 6566 2074 696d 6573 7461 6d70  ().def timestamp
-00020e50: 2876 616c 7565 293a 0a20 2020 2022 2222  (value):.    """
-00020e60: 0a20 2020 2041 2066 696c 7465 7220 746f  .    A filter to
-00020e70: 2064 6973 706c 6179 2061 2074 696d 6573   display a times
-00020e80: 7461 6d70 2e0a 2020 2020 2222 220a 2020  tamp..    """.  
-00020e90: 2020 6474 203d 2070 6f74 6c75 636b 2e74    dt = potluck.t
-00020ea0: 696d 655f 7574 696c 732e 7469 6d65 5f66  ime_utils.time_f
-00020eb0: 726f 6d5f 7469 6d65 7374 7269 6e67 2876  rom_timestring(v
-00020ec0: 616c 7565 290a 2020 2020 7265 7475 726e  alue).    return
-00020ed0: 2070 6f74 6c75 636b 2e74 696d 655f 7574   potluck.time_ut
-00020ee0: 696c 732e 666d 745f 6461 7465 7469 6d65  ils.fmt_datetime
-00020ef0: 2864 7429 0a0a 0a40 6170 702e 7465 6d70  (dt)...@app.temp
-00020f00: 6c61 7465 5f66 696c 7465 7228 290a 6465  late_filter().de
-00020f10: 6620 7365 636f 6e64 7328 7469 6d65 6465  f seconds(timede
-00020f20: 6c74 6129 3a0a 2020 2020 2222 220a 2020  lta):.    """.  
-00020f30: 2020 436f 6e76 6572 7473 2061 2074 696d    Converts a tim
-00020f40: 6564 656c 7461 2074 6f20 6120 666c 6f61  edelta to a floa
-00020f50: 7469 6e67 2d70 6f69 6e74 206e 756d 6265  ting-point numbe
-00020f60: 7220 6f66 2073 6563 6f6e 6473 2e0a 2020  r of seconds..  
-00020f70: 2020 2222 220a 2020 2020 7265 7475 726e    """.    return
-00020f80: 2074 696d 6564 656c 7461 2e74 6f74 616c   timedelta.total
-00020f90: 5f73 6563 6f6e 6473 2829 0a0a 0a40 6170  _seconds()...@ap
-00020fa0: 702e 7465 6d70 6c61 7465 5f66 696c 7465  p.template_filte
-00020fb0: 7228 290a 6465 6620 696e 7465 6765 7228  r().def integer(
-00020fc0: 7661 6c75 6529 3a0a 2020 2020 2222 220a  value):.    """.
-00020fd0: 2020 2020 4120 6669 6c74 6572 2074 6f20      A filter to 
-00020fe0: 6469 7370 6c61 7920 6120 6e75 6d62 6572  display a number
-00020ff0: 2061 7320 616e 2069 6e74 6567 6572 2e0a   as an integer..
-00021000: 2020 2020 2222 220a 2020 2020 6966 2069      """.    if i
-00021010: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
-00021020: 2028 666c 6f61 742c 2069 6e74 2929 3a0a   (float, int)):.
-00021030: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00021040: 7472 2872 6f75 6e64 2876 616c 7565 2929  tr(round(value))
-00021050: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00021060: 2020 2072 6574 7572 6e20 7374 7228 7661     return str(va
-00021070: 6c75 6529 0a0a 0a61 7070 2e61 6464 5f74  lue)...app.add_t
-00021080: 656d 706c 6174 655f 676c 6f62 616c 286d  emplate_global(m
-00021090: 696e 2c20 6e61 6d65 3d27 6d69 6e27 290a  in, name='min').
-000210a0: 6170 702e 6164 645f 7465 6d70 6c61 7465  app.add_template
-000210b0: 5f67 6c6f 6261 6c28 6d61 782c 206e 616d  _global(max, nam
-000210c0: 653d 276d 6178 2729 0a61 7070 2e61 6464  e='max').app.add
-000210d0: 5f74 656d 706c 6174 655f 676c 6f62 616c  _template_global
-000210e0: 2872 6f75 6e64 2c20 6e61 6d65 3d27 726f  (round, name='ro
-000210f0: 756e 6427 290a 6170 702e 6164 645f 7465  und').app.add_te
-00021100: 6d70 6c61 7465 5f67 6c6f 6261 6c28 7375  mplate_global(su
-00021110: 6d2c 206e 616d 653d 2773 756d 2729 0a0a  m, name='sum')..
-00021120: 2320 4375 7374 6f6d 2066 696c 656e 616d  # Custom filenam
-00021130: 652d 3e73 6c75 6720 6669 6c74 6572 2066  e->slug filter f
-00021140: 726f 6d20 706f 746c 7563 6b0a 6170 702e  rom potluck.app.
-00021150: 7465 6d70 6c61 7465 5f66 696c 7465 7228  template_filter(
-00021160: 2928 706f 746c 7563 6b2e 6874 6d6c 5f74  )(potluck.html_t
-00021170: 6f6f 6c73 2e66 696c 6573 6c75 6729 0a0a  ools.fileslug)..
-00021180: 2320 5469 6d65 2066 696c 7465 7273 2066  # Time filters f
-00021190: 726f 6d20 706f 746c 7563 6b0a 6170 702e  rom potluck.app.
-000211a0: 7465 6d70 6c61 7465 5f66 696c 7465 7228  template_filter(
-000211b0: 2928 706f 746c 7563 6b2e 7469 6d65 5f75  )(potluck.time_u
-000211c0: 7469 6c73 2e66 6d74 5f64 6174 6574 696d  tils.fmt_datetim
-000211d0: 6529 0a0a 0a40 6170 702e 7465 6d70 6c61  e)...@app.templa
-000211e0: 7465 5f66 696c 7465 7228 290a 6465 6620  te_filter().def 
-000211f0: 615f 616e 2868 293a 0a20 2020 2022 2222  a_an(h):.    """
-00021200: 0a20 2020 2052 6574 7572 6e73 2074 6865  .    Returns the
-00021210: 2073 7472 696e 6720 2761 2720 6f72 2027   string 'a' or '
-00021220: 616e 2720 7768 6572 6520 7468 6520 7573  an' where the us
-00021230: 6520 6f66 2027 612f 616e 2720 6465 7065  e of 'a/an' depe
-00021240: 6e64 7320 6f6e 2074 6865 0a20 2020 2066  nds on the.    f
-00021250: 6972 7374 206c 6574 7465 7220 6f66 2074  irst letter of t
-00021260: 6865 206e 616d 6520 6f66 2074 6865 2066  he name of the f
-00021270: 6972 7374 2064 6967 6974 206f 6620 7468  irst digit of th
-00021280: 6520 6769 7665 6e20 6e75 6d62 6572 2c20  e given number, 
-00021290: 6f72 0a20 2020 2074 6865 2066 6972 7374  or.    the first
-000212a0: 206c 6574 7465 7220 6f66 2074 6865 2067   letter of the g
-000212b0: 6976 656e 2073 7472 696e 672e 0a0a 2020  iven string...  
-000212c0: 2020 4361 6e27 7420 6861 6e64 6c65 2065    Can't handle e
-000212d0: 7665 7279 7468 696e 6720 6265 6361 7573  verything becaus
-000212e0: 6520 6974 2064 6f65 736e 2774 206b 6e6f  e it doesn't kno
-000212f0: 7720 7068 6f6e 6574 6963 7320 2865 2e67  w phonetics (e.g
-00021300: 2e2c 2027 610a 2020 2020 686f 7572 2720  ., 'a.    hour' 
-00021310: 6e6f 7420 2761 6e20 686f 7572 2720 6265  not 'an hour' be
-00021320: 6361 7573 6520 2768 2720 6973 206e 6f74  cause 'h' is not
-00021330: 2061 2076 6f77 656c 292e 0a20 2020 2022   a vowel)..    "
-00021340: 2222 0a20 2020 2064 6967 6974 7320 3d20  "".    digits = 
-00021350: 7374 7228 6829 0a20 2020 2066 6420 3d20  str(h).    fd = 
-00021360: 6469 6769 7473 5b30 5d0a 2020 2020 6966  digits[0].    if
-00021370: 2066 6420 696e 2022 3138 6165 696f 7522   fd in "18aeiou"
-00021380: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00021390: 2027 616e 270a 2020 2020 656c 7365 3a0a   'an'.    else:.
-000213a0: 2020 2020 2020 2020 7265 7475 726e 2027          return '
-000213b0: 6127 0a0a 0a40 6170 702e 7465 6d70 6c61  a'...@app.templa
-000213c0: 7465 5f66 696c 7465 7228 290a 6465 6620  te_filter().def 
-000213d0: 7073 6574 5f63 6f6d 6269 6e65 645f 6772  pset_combined_gr
-000213e0: 6164 6528 7073 6574 293a 0a20 2020 2022  ade(pset):.    "
-000213f0: 2222 0a20 2020 2045 7874 7261 6374 7320  "".    Extracts 
-00021400: 6120 6675 6c6c 2063 6f6d 6269 6e65 6420  a full combined 
-00021410: 6772 6164 6520 7661 6c75 6520 6672 6f6d  grade value from
-00021420: 2061 2070 7365 7420 6f62 6a65 6374 2e20   a pset object. 
-00021430: 5265 7370 6563 7473 0a20 2020 2074 6173  Respects.    tas
-00021440: 6b20 7765 6967 6874 733b 2066 696c 6c73  k weights; fills
-00021450: 2069 6e20 7a65 726f 6573 2066 6f72 2061   in zeroes for a
-00021460: 6e79 206d 6973 7369 6e67 2067 7261 6465  ny missing grade
-00021470: 732c 2061 6e64 2067 7261 6273 2074 6865  s, and grabs the
-00021480: 0a20 2020 2068 6967 6865 7374 2073 636f  .    highest sco
-00021490: 7265 2066 726f 6d20 6561 6368 2074 6173  re from each tas
-000214a0: 6b20 706f 6f6c 2e20 496e 636c 7564 6573  k pool. Includes
-000214b0: 2074 696d 656c 696e 6573 7320 706f 696e   timeliness poin
-000214c0: 7473 2061 6c6f 6e67 0a20 2020 2077 6974  ts along.    wit
-000214d0: 6820 7461 736b 2067 7261 6465 732c 2072  h task grades, r
-000214e0: 652d 6e6f 726d 616c 697a 696e 6720 746f  e-normalizing to
-000214f0: 2062 6520 6f75 7420 6f66 2074 6865 2060   be out of the `
-00021500: 5343 4f52 455f 4241 5349 5360 2e0a 2020  SCORE_BASIS`..  
-00021510: 2020 2222 220a 2020 2020 706f 6f6c 5f73    """.    pool_s
-00021520: 636f 7265 7320 3d20 7b7d 0a20 2020 2066  cores = {}.    f
-00021530: 6f72 2074 6173 6b20 696e 2070 7365 745b  or task in pset[
-00021540: 2274 6173 6b73 225d 3a0a 2020 2020 2020  "tasks"]:.      
-00021550: 2020 2320 4765 7420 6120 6772 6164 6520    # Get a grade 
-00021560: 2620 7765 6967 6874 0a20 2020 2020 2020  & weight.       
-00021570: 2063 6720 3d20 7461 736b 5f63 6f6d 6269   cg = task_combi
-00021580: 6e65 645f 6772 6164 6528 7461 736b 290a  ned_grade(task).
-00021590: 2020 2020 2020 2020 7470 203d 2074 6173          tp = tas
-000215a0: 6b5f 7469 6d65 6c69 6e65 7373 5f70 6f69  k_timeliness_poi
-000215b0: 6e74 7328 7461 736b 290a 2020 2020 2020  nts(task).      
-000215c0: 2020 7477 203d 2074 6173 6b2e 6765 7428    tw = task.get(
-000215d0: 2277 6569 6768 7422 2c20 3129 0a20 2020  "weight", 1).   
-000215e0: 2020 2020 2069 6620 6367 2069 7320 4e6f       if cg is No
-000215f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00021600: 6367 203d 2030 0a0a 2020 2020 2020 2020  cg = 0..        
-00021610: 2320 4669 6775 7265 206f 7574 2074 6869  # Figure out thi
-00021620: 7320 7461 736b 2773 2070 6f6f 6c20 616e  s task's pool an
-00021630: 6420 7570 6461 7465 2074 6865 2073 636f  d update the sco
-00021640: 7265 2066 6f72 2074 6861 7420 706f 6f6c  re for that pool
-00021650: 0a20 2020 2020 2020 2070 6f6f 6c20 3d20  .        pool = 
-00021660: 7461 736b 5f70 6f6f 6c28 7461 736b 290a  task_pool(task).
-00021670: 2020 2020 2020 2020 6966 2070 6f6f 6c20          if pool 
-00021680: 696e 2070 6f6f 6c5f 7363 6f72 6573 3a0a  in pool_scores:.
-00021690: 2020 2020 2020 2020 2020 2020 6f6c 645f              old_
-000216a0: 7363 6f72 652c 206f 6c64 5f77 6569 6768  score, old_weigh
-000216b0: 7420 3d20 706f 6f6c 5f73 636f 7265 735b  t = pool_scores[
-000216c0: 706f 6f6c 5d0a 2020 2020 2020 2020 2020  pool].          
-000216d0: 2020 6966 206f 6c64 5f77 6569 6768 7420    if old_weight 
-000216e0: 213d 2074 773a 0a20 2020 2020 2020 2020  != tw:.         
-000216f0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00021700: 7565 4572 726f 7228 2249 6e63 6f6e 7369  ueError("Inconsi
-00021710: 7374 656e 7420 7765 6967 6874 7320 666f  stent weights fo
-00021720: 7220 706f 6f6c 6564 2074 6173 6b73 2122  r pooled tasks!"
-00021730: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00021740: 206f 6c64 5f73 636f 7265 203c 2063 6720   old_score < cg 
-00021750: 2b20 7470 3a0a 2020 2020 2020 2020 2020  + tp:.          
-00021760: 2020 2020 2020 706f 6f6c 5f73 636f 7265        pool_score
-00021770: 735b 706f 6f6c 5d20 3d20 5b63 6720 2b20  s[pool] = [cg + 
-00021780: 7470 2c20 7477 5d0a 2020 2020 2020 2020  tp, tw].        
-00021790: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000217a0: 2020 706f 6f6c 5f73 636f 7265 735b 706f    pool_scores[po
-000217b0: 6f6c 5d20 3d20 5b63 6720 2b20 7470 2c20  ol] = [cg + tp, 
-000217c0: 7477 5d0a 0a20 2020 2073 636f 7265 5f62  tw]..    score_b
-000217d0: 6173 6973 203d 2061 7070 2e63 6f6e 6669  asis = app.confi
-000217e0: 672e 6765 7428 2253 434f 5245 5f42 4153  g.get("SCORE_BAS
-000217f0: 4953 222c 2031 3030 290a 2020 2020 6d61  IS", 100).    ma
-00021800: 785f 7363 6f72 6520 3d20 7363 6f72 655f  x_score = score_
-00021810: 6261 7369 7320 2b20 6170 702e 636f 6e66  basis + app.conf
-00021820: 6967 2e67 6574 2822 5449 4d45 4c49 4e45  ig.get("TIMELINE
-00021830: 5353 5f50 4f49 4e54 5322 2c20 3029 0a20  SS_POINTS", 0). 
-00021840: 2020 2077 6569 6768 7465 645f 7363 6f72     weighted_scor
-00021850: 6520 3d20 7375 6d28 0a20 2020 2020 2020  e = sum(.       
-00021860: 2028 6772 6164 6520 2f20 6d61 785f 7363   (grade / max_sc
-00021870: 6f72 6529 202a 2077 6569 6768 740a 2020  ore) * weight.  
-00021880: 2020 2020 2020 666f 7220 6772 6164 652c        for grade,
-00021890: 2077 6569 6768 7420 696e 2070 6f6f 6c5f   weight in pool_
-000218a0: 7363 6f72 6573 2e76 616c 7565 7328 290a  scores.values().
-000218b0: 2020 2020 290a 2020 2020 746f 7461 6c5f      ).    total_
-000218c0: 7765 6967 6874 203d 2073 756d 2877 6569  weight = sum(wei
-000218d0: 6768 7420 666f 7220 6772 6164 652c 2077  ght for grade, w
-000218e0: 6569 6768 7420 696e 2070 6f6f 6c5f 7363  eight in pool_sc
-000218f0: 6f72 6573 2e76 616c 7565 7328 2929 0a0a  ores.values())..
-00021900: 2020 2020 7265 7475 726e 2073 636f 7265      return score
-00021910: 5f62 6173 6973 202a 2077 6569 6768 7465  _basis * weighte
-00021920: 645f 7363 6f72 6520 2f20 666c 6f61 7428  d_score / float(
-00021930: 746f 7461 6c5f 7765 6967 6874 290a 0a0a  total_weight)...
-00021940: 4061 7070 2e74 656d 706c 6174 655f 6669  @app.template_fi
-00021950: 6c74 6572 2829 0a64 6566 2075 7365 735f  lter().def uses_
-00021960: 706f 6f6c 7328 7073 6574 293a 0a20 2020  pools(pset):.   
-00021970: 2022 2222 0a20 2020 2052 6574 7572 6e73   """.    Returns
-00021980: 2054 7275 6520 6966 2074 6865 2070 7365   True if the pse
-00021990: 7420 6861 7320 6174 206c 6561 7374 2074  t has at least t
-000219a0: 776f 2074 6173 6b73 2074 6861 7420 6172  wo tasks that ar
-000219b0: 6520 696e 2074 6865 2073 616d 650a 2020  e in the same.  
-000219c0: 2020 706f 6f6c 2c20 616e 6420 4661 6c73    pool, and Fals
-000219d0: 6520 6f74 6865 7277 6973 652e 0a20 2020  e otherwise..   
-000219e0: 2022 2222 0a20 2020 2070 6f6f 6c73 203d   """.    pools =
-000219f0: 2073 6574 2874 6173 6b5f 706f 6f6c 2874   set(task_pool(t
-00021a00: 6173 6b29 2066 6f72 2074 6173 6b20 696e  ask) for task in
-00021a10: 2070 7365 745b 2274 6173 6b73 225d 290a   pset["tasks"]).
-00021a20: 2020 2020 7265 7475 726e 206c 656e 2870      return len(p
-00021a30: 6f6f 6c73 2920 3c20 6c65 6e28 7073 6574  ools) < len(pset
-00021a40: 5b22 7461 736b 7322 5d29 0a0a 0a40 6170  ["tasks"])...@ap
-00021a50: 702e 7465 6d70 6c61 7465 5f66 696c 7465  p.template_filte
-00021a60: 7228 290a 6465 6620 7461 736b 5f70 6f6f  r().def task_poo
-00021a70: 6c28 7461 736b 293a 0a20 2020 2022 2222  l(task):.    """
-00021a80: 0a20 2020 2047 7261 6273 2074 6865 2070  .    Grabs the p
-00021a90: 6f6f 6c20 666f 7220 6120 7461 736b 2c20  ool for a task, 
-00021aa0: 7768 6963 6820 6465 6661 756c 7473 2074  which defaults t
-00021ab0: 6f20 7468 6520 7461 736b 2049 442e 0a20  o the task ID.. 
-00021ac0: 2020 2022 2222 0a20 2020 2072 6574 7572     """.    retur
-00021ad0: 6e20 7461 736b 2e67 6574 2822 706f 6f6c  n task.get("pool
-00021ae0: 222c 2074 6173 6b5b 2269 6422 5d29 0a0a  ", task["id"])..
-00021af0: 0a40 6170 702e 7465 6d70 6c61 7465 5f66  .@app.template_f
-00021b00: 696c 7465 7228 290a 6465 6620 7073 6574  ilter().def pset
-00021b10: 5f70 6f6f 6c73 2870 7365 7429 3a0a 2020  _pools(pset):.  
-00021b20: 2020 2222 220a 2020 2020 5265 7475 726e    """.    Return
-00021b30: 7320 6120 6c69 7374 206f 6620 7061 6972  s a list of pair
-00021b40: 732c 2065 6163 6820 636f 6e74 6169 6e69  s, each containi
-00021b50: 6e67 2061 2070 6f6f 6c20 4944 2061 6e64  ng a pool ID and
-00021b60: 2061 2063 6f6c 7370 616e 0a20 2020 2069   a colspan.    i
-00021b70: 6e74 6567 6572 2066 6f72 2074 6861 7420  nteger for that 
-00021b80: 706f 6f6c 2e0a 2020 2020 2222 220a 2020  pool..    """.  
-00021b90: 2020 7365 656e 203d 2073 6574 2829 0a20    seen = set(). 
-00021ba0: 2020 2072 6573 756c 7420 3d20 5b5d 0a20     result = []. 
-00021bb0: 2020 2066 6f72 2074 6173 6b20 696e 2070     for task in p
-00021bc0: 7365 745b 2274 6173 6b73 225d 3a0a 2020  set["tasks"]:.  
-00021bd0: 2020 2020 2020 706f 6f6c 203d 2074 6173        pool = tas
-00021be0: 6b5f 706f 6f6c 2874 6173 6b29 0a20 2020  k_pool(task).   
-00021bf0: 2020 2020 2069 6620 706f 6f6c 2069 6e20       if pool in 
-00021c00: 7365 656e 3a0a 2020 2020 2020 2020 2020  seen:.          
-00021c10: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00021c20: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00021c30: 2020 2020 2073 6565 6e2e 6164 6428 706f       seen.add(po
-00021c40: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
-00021c50: 7265 7375 6c74 2e61 7070 656e 6428 2870  result.append((p
-00021c60: 6f6f 6c2c 2070 6f6f 6c5f 636f 6c73 7061  ool, pool_colspa
-00021c70: 6e28 7073 6574 2c20 7461 736b 5b22 6964  n(pset, task["id
-00021c80: 225d 2929 290a 2020 2020 7265 7475 726e  "]))).    return
-00021c90: 2072 6573 756c 740a 0a0a 4061 7070 2e74   result...@app.t
-00021ca0: 656d 706c 6174 655f 6669 6c74 6572 2829  emplate_filter()
-00021cb0: 0a64 6566 2070 6f6f 6c5f 636f 6c73 7061  .def pool_colspa
-00021cc0: 6e28 7073 6574 2c20 7461 736b 6964 293a  n(pset, taskid):
-00021cd0: 0a20 2020 2022 2222 0a20 2020 2052 6574  .    """.    Ret
-00021ce0: 7572 6e73 2074 6865 2063 6f6c 756d 6e20  urns the column 
-00021cf0: 7370 616e 2066 6f72 2074 6865 2070 6f6f  span for the poo
-00021d00: 6c20 6f66 2074 6865 2067 6976 656e 2074  l of the given t
-00021d10: 6173 6b20 696e 2074 6865 2067 6976 656e  ask in the given
-00021d20: 0a20 2020 2070 7365 742c 2061 7373 756d  .    pset, assum
-00021d30: 696e 6720 7468 6174 2074 6865 2074 6173  ing that the tas
-00021d40: 6b73 206f 6620 7468 6520 7073 6574 2061  ks of the pset a
-00021d50: 7265 2064 6973 706c 6179 6564 2069 6e20  re displayed in 
-00021d60: 6f72 6465 722e 0a20 2020 2022 2222 0a20  order..    """. 
-00021d70: 2020 2073 7461 7274 5f61 7420 3d20 4e6f     start_at = No
-00021d80: 6e65 0a20 2020 2074 6869 735f 7461 736b  ne.    this_task
-00021d90: 203d 204e 6f6e 650a 2020 2020 666f 7220   = None.    for 
-00021da0: 6920 696e 2072 616e 6765 286c 656e 2870  i in range(len(p
-00021db0: 7365 745b 2274 6173 6b73 225d 2929 3a0a  set["tasks"])):.
-00021dc0: 2020 2020 2020 2020 6966 2070 7365 745b          if pset[
-00021dd0: 2274 6173 6b73 225d 5b69 5d5b 2269 6422  "tasks"][i]["id"
-00021de0: 5d20 3d3d 2074 6173 6b69 643a 0a20 2020  ] == taskid:.   
-00021df0: 2020 2020 2020 2020 2073 7461 7274 5f61           start_a
-00021e00: 7420 3d20 690a 2020 2020 2020 2020 2020  t = i.          
-00021e10: 2020 7468 6973 5f74 6173 6b20 3d20 7073    this_task = ps
-00021e20: 6574 5b22 7461 736b 7322 5d5b 695d 0a20  et["tasks"][i]. 
-00021e30: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00021e40: 0a0a 2020 2020 6966 2073 7461 7274 5f61  ..    if start_a
-00021e50: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
-00021e60: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00021e70: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00021e80: 2022 5073 6574 2027 7b7d 2720 646f 6573   "Pset '{}' does
-00021e90: 206e 6f74 2063 6f6e 7461 696e 2061 2074   not contain a t
-00021ea0: 6173 6b20 277b 7d27 2e22 2e66 6f72 6d61  ask '{}'.".forma
-00021eb0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00021ec0: 2020 2070 7365 745b 2269 6422 5d2c 0a20     pset["id"],. 
-00021ed0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00021ee0: 6173 6b69 640a 2020 2020 2020 2020 2020  askid.          
-00021ef0: 2020 290a 2020 2020 2020 2020 290a 0a20    ).        ).. 
-00021f00: 2020 2074 6869 735f 706f 6f6c 203d 2074     this_pool = t
-00021f10: 6173 6b5f 706f 6f6c 2874 6869 735f 7461  ask_pool(this_ta
-00021f20: 736b 290a 2020 2020 7370 616e 203d 2031  sk).    span = 1
-00021f30: 0a20 2020 2066 6f72 2074 6173 6b20 696e  .    for task in
-00021f40: 2070 7365 745b 2274 6173 6b73 225d 5b69   pset["tasks"][i
-00021f50: 202b 2031 3a5d 3a0a 2020 2020 2020 2020   + 1:]:.        
-00021f60: 6966 2074 6173 6b5f 706f 6f6c 2874 6173  if task_pool(tas
-00021f70: 6b29 203d 3d20 7468 6973 5f70 6f6f 6c3a  k) == this_pool:
-00021f80: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
-00021f90: 6e20 2b3d 2031 0a20 2020 2020 2020 2065  n += 1.        e
-00021fa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00021fb0: 2062 7265 616b 2023 2073 7061 6e20 6973   break # span is
-00021fc0: 206f 7665 720a 0a20 2020 2072 6574 7572   over..    retur
-00021fd0: 6e20 7370 616e 0a0a 0a40 6170 702e 7465  n span...@app.te
-00021fe0: 6d70 6c61 7465 5f66 696c 7465 7228 290a  mplate_filter().
-00021ff0: 6465 6620 7461 736b 5f63 6f6d 6269 6e65  def task_combine
-00022000: 645f 6772 6164 6528 7461 736b 293a 0a20  d_grade(task):. 
-00022010: 2020 2022 2222 0a20 2020 2045 7874 7261     """.    Extra
-00022020: 6374 7320 7468 6520 636f 6d62 696e 6564  cts the combined
-00022030: 2067 7261 6465 2076 616c 7565 2062 6574   grade value bet
-00022040: 7765 656e 2069 6e69 7469 616c 2f72 6576  ween initial/rev
-00022050: 6973 6564 2f62 656c 6174 6564 0a20 2020  ised/belated.   
-00022060: 2073 7562 6d69 7373 696f 6e73 2066 6f72   submissions for
-00022070: 2074 6865 2067 6976 656e 2074 6173 6b2e   the given task.
-00022080: 2052 6574 7572 6e73 2061 2070 6f69 6e74   Returns a point
-00022090: 206e 756d 6265 722c 206f 7220 4e6f 6e65   number, or None
-000220a0: 2069 660a 2020 2020 7468 6572 6520 6973   if.    there is
-000220b0: 206e 6f74 2065 6e6f 7567 6820 696e 666f   not enough info
-000220c0: 726d 6174 696f 6e20 746f 2065 7374 6162  rmation to estab
-000220d0: 6c69 7368 2061 2067 7261 6465 2e0a 0a20  lish a grade... 
-000220e0: 2020 2054 696d 656c 696e 6573 7320 706f     Timeliness po
-000220f0: 696e 7473 2061 7265 206e 6f74 2069 6e63  ints are not inc
-00022100: 6c75 6465 6420 2873 6565 2060 7461 736b  luded (see `task
-00022110: 5f74 696d 656c 696e 6573 735f 706f 696e  _timeliness_poin
-00022120: 7473 6029 2e0a 2020 2020 2222 220a 2020  ts`)..    """.  
-00022130: 2020 6261 7365 5f67 7261 6465 203d 2074    base_grade = t
-00022140: 6173 6b2e 6765 7428 2267 7261 6465 2229  ask.get("grade")
-00022150: 0a20 2020 206f 7074 696f 6e73 203d 205b  .    options = [
-00022160: 5d0a 2020 2020 6966 2062 6173 655f 6772  ].    if base_gr
-00022170: 6164 6520 6973 206e 6f74 204e 6f6e 6520  ade is not None 
-00022180: 616e 6420 6261 7365 5f67 7261 6465 2021  and base_grade !
-00022190: 3d20 223f 223a 0a20 2020 2020 2020 206f  = "?":.        o
-000221a0: 7074 696f 6e73 2e61 7070 656e 6428 666c  ptions.append(fl
-000221b0: 6f61 7428 6261 7365 5f67 7261 6465 2929  oat(base_grade))
-000221c0: 0a0a 2020 2020 7265 765f 7461 736b 203d  ..    rev_task =
-000221d0: 2074 6173 6b2e 6765 7428 2272 6576 6973   task.get("revis
-000221e0: 696f 6e22 2c20 7b7d 290a 2020 2020 7265  ion", {}).    re
-000221f0: 765f 6772 6164 6520 3d20 7265 765f 7461  v_grade = rev_ta
-00022200: 736b 2e67 6574 2822 6772 6164 6522 290a  sk.get("grade").
-00022210: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00022220: 6528 7265 765f 6772 6164 652c 2028 696e  e(rev_grade, (in
-00022230: 742c 2066 6c6f 6174 2929 3a0a 2020 2020  t, float)):.    
-00022240: 2020 2020 6f70 7469 6f6e 732e 6170 7065      options.appe
-00022250: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
-00022260: 6d69 6e28 0a20 2020 2020 2020 2020 2020  min(.           
-00022270: 2020 2020 2072 6576 5f67 7261 6465 2c0a       rev_grade,.
-00022280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022290: 7265 765f 7461 736b 2e67 6574 280a 2020  rev_task.get(.  
-000222a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000222b0: 2020 226d 6178 5f73 636f 7265 222c 0a20    "max_score",. 
-000222c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000222d0: 2020 2061 7070 2e63 6f6e 6669 672e 6765     app.config.ge
-000222e0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-000222f0: 2020 2020 2020 2020 2020 2022 5245 5649             "REVI
-00022300: 5349 4f4e 5f4d 4158 5f53 434f 5245 222c  SION_MAX_SCORE",
-00022310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022320: 2020 2020 2020 2020 2061 7070 2e63 6f6e           app.con
-00022330: 6669 672e 6765 7428 2253 434f 5245 5f42  fig.get("SCORE_B
-00022340: 4153 4953 222c 2031 3030 290a 2020 2020  ASIS", 100).    
-00022350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022360: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00022370: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00022380: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-00022390: 2062 656c 6174 6564 5f74 6173 6b20 3d20   belated_task = 
-000223a0: 7461 736b 2e67 6574 2822 6265 6c61 7465  task.get("belate
-000223b0: 6422 2c20 7b7d 290a 2020 2020 6265 6c61  d", {}).    bela
-000223c0: 7465 645f 6772 6164 6520 3d20 6265 6c61  ted_grade = bela
-000223d0: 7465 645f 7461 736b 2e67 6574 2822 6772  ted_task.get("gr
-000223e0: 6164 6522 290a 2020 2020 6966 2069 7369  ade").    if isi
-000223f0: 6e73 7461 6e63 6528 6265 6c61 7465 645f  nstance(belated_
-00022400: 6772 6164 652c 2028 696e 742c 2066 6c6f  grade, (int, flo
-00022410: 6174 2929 3a0a 2020 2020 2020 2020 6f70  at)):.        op
-00022420: 7469 6f6e 732e 6170 7065 6e64 280a 2020  tions.append(.  
-00022430: 2020 2020 2020 2020 2020 6d69 6e28 0a20            min(. 
-00022440: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00022450: 656c 6174 6564 5f67 7261 6465 2c0a 2020  elated_grade,.  
-00022460: 2020 2020 2020 2020 2020 2020 2020 6265                be
-00022470: 6c61 7465 645f 7461 736b 2e67 6574 280a  lated_task.get(.
-00022480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022490: 2020 2020 226d 6178 5f73 636f 7265 222c      "max_score",
-000224a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000224b0: 2020 2020 2061 7070 2e63 6f6e 6669 672e       app.config.
-000224c0: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
-000224d0: 2020 2020 2020 2020 2020 2020 2022 4245               "BE
-000224e0: 4c41 5445 445f 4d41 585f 5343 4f52 4522  LATED_MAX_SCORE"
-000224f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00022500: 2020 2020 2020 2020 2020 6170 702e 636f            app.co
-00022510: 6e66 6967 2e67 6574 2822 5343 4f52 455f  nfig.get("SCORE_
-00022520: 4241 5349 5322 2c20 3130 3029 0a20 2020  BASIS", 100).   
-00022530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022540: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00022550: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00022560: 2029 0a20 2020 2020 2020 2029 0a0a 2020   ).        )..  
-00022570: 2020 6966 206c 656e 286f 7074 696f 6e73    if len(options
-00022580: 2920 3e20 303a 0a20 2020 2020 2020 2072  ) > 0:.        r
-00022590: 6574 7572 6e20 6d61 7828 6f70 7469 6f6e  eturn max(option
-000225a0: 7329 0a20 2020 2065 6c73 653a 0a20 2020  s).    else:.   
-000225b0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-000225c0: 0a0a 0a40 6170 702e 7465 6d70 6c61 7465  ...@app.template
-000225d0: 5f66 696c 7465 7228 290a 6465 6620 7461  _filter().def ta
-000225e0: 736b 5f74 696d 656c 696e 6573 735f 706f  sk_timeliness_po
-000225f0: 696e 7473 2874 6173 6b29 3a0a 2020 2020  ints(task):.    
-00022600: 2222 220a 2020 2020 5265 7475 726e 7320  """.    Returns 
-00022610: 6120 6e75 6d62 6572 2069 6e64 6963 6174  a number indicat
-00022620: 696e 6720 686f 7720 6d61 6e79 2074 696d  ing how many tim
-00022630: 656c 696e 6573 7320 706f 696e 7473 2077  eliness points w
-00022640: 6572 6520 6561 726e 6564 0a20 2020 2066  ere earned.    f
-00022650: 6f72 2073 7562 6d69 7373 696f 6e73 2074  or submissions t
-00022660: 6f20 7468 6520 6769 7665 6e20 7461 736b  o the given task
-00022670: 2e20 5468 6520 6054 494d 454c 494e 4553  . The `TIMELINES
-00022680: 535f 504f 494e 5453 6020 7661 6c75 650a  S_POINTS` value.
-00022690: 2020 2020 6465 7465 726d 696e 6573 2068      determines h
-000226a0: 6f77 206d 616e 7920 706f 696e 7473 2061  ow many points a
-000226b0: 7265 2061 7661 696c 6162 6c65 2069 6e20  re available in 
-000226c0: 746f 7461 6c3b 2068 616c 6620 6f66 2074  total; half of t
-000226d0: 6865 7365 2061 7265 0a20 2020 2061 7761  hese are.    awa
-000226e0: 7264 6564 2069 6620 6120 7375 626d 6973  rded if a submis
-000226f0: 7369 6f6e 2069 7320 6d61 6465 2062 7920  sion is made by 
-00022700: 7468 6520 696e 6974 6961 6c20 6465 6164  the initial dead
-00022710: 6c69 6e65 2077 6869 6368 2065 6172 6e73  line which earns
-00022720: 0a20 2020 2061 7420 6c65 6173 7420 6054  .    at least `T
-00022730: 494d 454c 494e 4553 535f 4154 5445 4d50  IMELINESS_ATTEMP
-00022740: 545f 5448 5245 5348 4f4c 4460 2070 6f69  T_THRESHOLD` poi
-00022750: 6e74 732c 2061 6e64 2074 6865 206f 7468  nts, and the oth
-00022760: 6572 2068 616c 660a 2020 2020 6172 6520  er half.    are 
-00022770: 6561 726e 6564 2069 6620 6120 7375 626d  earned if a subm
-00022780: 6973 7369 6f6e 2069 7320 6d61 6465 2062  ission is made b
-00022790: 7920 7468 6520 7265 7669 7369 6f6e 2064  y the revision d
-000227a0: 6561 646c 696e 6520 7768 6963 680a 2020  eadline which.  
-000227b0: 2020 6561 726e 7320 6174 206c 6561 7374    earns at least
-000227c0: 2060 5449 4d45 4c49 4e45 5353 5f43 4f4d   `TIMELINESS_COM
-000227d0: 504c 4554 455f 5448 5245 5348 4f4c 4460  PLETE_THRESHOLD`
-000227e0: 2070 6f69 6e74 732e 0a0a 2020 2020 4120   points...    A 
-000227f0: 6d61 6e75 616c 206f 7665 7272 6964 6520  manual override 
-00022800: 6d61 7920 616c 736f 2068 6176 6520 6265  may also have be
-00022810: 656e 2070 726f 7669 6465 642c 2061 6e64  en provided, and
-00022820: 2069 7320 7573 6564 2069 6620 736f 2e0a   is used if so..
-00022830: 0a20 2020 2054 4f44 4f3a 2054 6869 7320  .    TODO: This 
-00022840: 7265 616c 6c79 206e 6565 6473 2074 6f20  really needs to 
-00022850: 6265 2075 7067 7261 6465 6420 6174 2073  be upgraded at s
-00022860: 6f6d 6520 706f 696e 7420 746f 2072 6573  ome point to res
-00022870: 7065 6374 2074 6865 0a20 2020 2062 6573  pect the.    bes
-00022880: 7420 7375 626d 6973 7369 6f6e 2069 6e20  t submission in 
-00022890: 6561 6368 2070 6861 7365 2c20 7261 7468  each phase, rath
-000228a0: 6572 2074 6861 6e20 6a75 7374 2074 6865  er than just the
-000228b0: 206c 6174 6573 742e 2053 7475 6465 6e74   latest. Student
-000228c0: 730a 2020 2020 7768 6f20 6163 6369 6465  s.    who accide
-000228d0: 6e74 616c 6c79 2064 6f77 6e67 7261 6465  ntally downgrade
-000228e0: 2074 6865 6972 2065 7661 6c75 6174 696f   their evaluatio
-000228f0: 6e20 6d61 7920 6c6f 7365 2074 696d 656c  n may lose timel
-00022900: 696e 6573 730a 2020 2020 706f 696e 7473  iness.    points
-00022910: 2074 6861 7420 7468 6579 2072 6561 6c6c   that they reall
-00022920: 7920 7368 6f75 6c64 2068 6176 6520 6561  y should have ea
-00022930: 726e 6564 210a 2020 2020 2222 220a 2020  rned!.    """.  
-00022940: 2020 6561 726e 6564 203d 2030 0a20 2020    earned = 0.   
-00022950: 2061 7661 696c 6162 6c65 203d 2061 7070   available = app
-00022960: 2e63 6f6e 6669 672e 6765 7428 2254 494d  .config.get("TIM
-00022970: 454c 494e 4553 535f 504f 494e 5453 222c  ELINESS_POINTS",
-00022980: 2030 290a 0a20 2020 2069 6620 7461 736b   0)..    if task
-00022990: 2e67 6574 2822 7469 6d65 6c69 6e65 7373  .get("timeliness
-000229a0: 5f6f 7665 7272 6964 6465 6e22 2920 616e  _overridden") an
-000229b0: 6420 2274 696d 656c 696e 6573 7322 2069  d "timeliness" i
-000229c0: 6e20 7461 736b 3a0a 2020 2020 2020 2020  n task:.        
-000229d0: 7265 7475 726e 2074 6173 6b5b 2274 696d  return task["tim
-000229e0: 656c 696e 6573 7322 5d0a 0a20 2020 2069  eliness"]..    i
-000229f0: 6e69 7469 616c 5f67 7261 6465 203d 2074  nitial_grade = t
-00022a00: 6173 6b2e 6765 7428 2267 7261 6465 2229  ask.get("grade")
-00022a10: 0a20 2020 2069 6620 696e 6974 6961 6c5f  .    if initial_
-00022a20: 6772 6164 6520 3d3d 2022 3f22 3a0a 2020  grade == "?":.  
-00022a30: 2020 2020 2020 696e 6974 6961 6c5f 6772        initial_gr
-00022a40: 6164 6520 3d20 4e6f 6e65 0a20 2020 2065  ade = None.    e
-00022a50: 6c69 6620 696e 6974 6961 6c5f 6772 6164  lif initial_grad
-00022a60: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00022a70: 2020 2020 2020 2069 6e69 7469 616c 5f67         initial_g
-00022a80: 7261 6465 203d 2066 6c6f 6174 2869 6e69  rade = float(ini
-00022a90: 7469 616c 5f67 7261 6465 290a 2020 2020  tial_grade).    
-00022aa0: 2020 2020 6966 2069 6e69 7469 616c 5f67      if initial_g
-00022ab0: 7261 6465 203e 3d20 6170 702e 636f 6e66  rade >= app.conf
-00022ac0: 6967 2e67 6574 280a 2020 2020 2020 2020  ig.get(.        
-00022ad0: 2020 2020 2254 494d 454c 494e 4553 535f      "TIMELINESS_
-00022ae0: 4154 5445 4d50 545f 5448 5245 5348 4f4c  ATTEMPT_THRESHOL
-00022af0: 4422 2c0a 2020 2020 2020 2020 2020 2020  D",.            
-00022b00: 6170 702e 636f 6e66 6967 2e67 6574 280a  app.config.get(.
-00022b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022b20: 2245 5641 4c55 4154 494f 4e5f 5343 4f52  "EVALUATION_SCOR
-00022b30: 4553 222c 0a20 2020 2020 2020 2020 2020  ES",.           
-00022b40: 2020 2020 207b 7d0a 2020 2020 2020 2020       {}.        
-00022b50: 2020 2020 292e 6765 7428 2270 6172 7469      ).get("parti
-00022b60: 616c 6c79 2063 6f6d 706c 6574 6522 2c20  ally complete", 
-00022b70: 3735 290a 2020 2020 2020 2020 293a 0a20  75).        ):. 
-00022b80: 2020 2020 2020 2020 2020 2065 6172 6e65             earne
-00022b90: 6420 2b3d 2061 7661 696c 6162 6c65 202f  d += available /
-00022ba0: 2032 0a0a 2020 2020 7265 765f 7461 736b   2..    rev_task
-00022bb0: 203d 2074 6173 6b2e 6765 7428 2272 6576   = task.get("rev
-00022bc0: 6973 696f 6e22 290a 2020 2020 6861 735f  ision").    has_
-00022bd0: 7265 765f 6772 6164 6520 3d20 280a 2020  rev_grade = (.  
-00022be0: 2020 2020 2020 7265 765f 7461 736b 0a20        rev_task. 
-00022bf0: 2020 2061 6e64 2022 6772 6164 6522 2069     and "grade" i
-00022c00: 6e20 7265 765f 7461 736b 0a20 2020 2061  n rev_task.    a
-00022c10: 6e64 2072 6576 5f74 6173 6b5b 2267 7261  nd rev_task["gra
-00022c20: 6465 225d 206e 6f74 2069 6e20 284e 6f6e  de"] not in (Non
-00022c30: 652c 2022 3f22 290a 2020 2020 290a 0a20  e, "?").    ).. 
-00022c40: 2020 2063 6f6d 706c 6574 696f 6e5f 7468     completion_th
-00022c50: 7265 7368 6f6c 6420 3d20 6170 702e 636f  reshold = app.co
-00022c60: 6e66 6967 2e67 6574 280a 2020 2020 2020  nfig.get(.      
-00022c70: 2020 2254 494d 454c 494e 4553 535f 434f    "TIMELINESS_CO
-00022c80: 4d50 4c45 5445 5f54 4852 4553 484f 4c44  MPLETE_THRESHOLD
-00022c90: 222c 0a20 2020 2020 2020 2061 7070 2e63  ",.        app.c
-00022ca0: 6f6e 6669 672e 6765 7428 0a20 2020 2020  onfig.get(.     
-00022cb0: 2020 2020 2020 2022 4556 414c 5541 5449         "EVALUATI
-00022cc0: 4f4e 5f53 434f 5245 5322 2c0a 2020 2020  ON_SCORES",.    
-00022cd0: 2020 2020 2020 2020 7b7d 0a20 2020 2020          {}.     
-00022ce0: 2020 2029 2e67 6574 2822 616c 6d6f 7374     ).get("almost
-00022cf0: 2063 6f6d 706c 6574 6522 2c20 3835 290a   complete", 85).
-00022d00: 2020 2020 290a 2020 2020 6966 2028 0a20      ).    if (. 
-00022d10: 2020 2020 2020 2028 696e 6974 6961 6c5f         (initial_
-00022d20: 6772 6164 6520 6973 206e 6f74 204e 6f6e  grade is not Non
-00022d30: 6520 616e 6420 696e 6974 6961 6c5f 6772  e and initial_gr
-00022d40: 6164 6520 3e3d 2063 6f6d 706c 6574 696f  ade >= completio
-00022d50: 6e5f 7468 7265 7368 6f6c 6429 0a20 2020  n_threshold).   
-00022d60: 2020 6f72 2028 6861 735f 7265 765f 6772    or (has_rev_gr
-00022d70: 6164 6520 616e 6420 666c 6f61 7428 7265  ade and float(re
-00022d80: 765f 7461 736b 5b22 6772 6164 6522 5d29  v_task["grade"])
-00022d90: 203e 3d20 636f 6d70 6c65 7469 6f6e 5f74   >= completion_t
-00022da0: 6872 6573 686f 6c64 290a 2020 2020 293a  hreshold).    ):
-00022db0: 0a20 2020 2020 2020 2065 6172 6e65 6420  .        earned 
-00022dc0: 2b3d 2061 7661 696c 6162 6c65 202f 2032  += available / 2
-00022dd0: 0a0a 2020 2020 7265 7475 726e 2065 6172  ..    return ear
-00022de0: 6e65 640a 0a0a 4061 7070 2e74 656d 706c  ned...@app.templ
-00022df0: 6174 655f 6669 6c74 6572 2829 0a64 6566  ate_filter().def
-00022e00: 2067 7261 6465 5f73 7472 696e 6728 6772   grade_string(gr
-00022e10: 6164 655f 7661 6c75 6529 3a0a 2020 2020  ade_value):.    
-00022e20: 2222 220a 2020 2020 5475 726e 7320 6120  """.    Turns a 
-00022e30: 6772 6164 6520 7661 6c75 6520 284e 6f6e  grade value (Non
-00022e40: 652c 206f 7220 6120 6e75 6d62 6572 2920  e, or a number) 
-00022e50: 696e 746f 2061 2067 7261 6465 2073 7472  into a grade str
-00022e60: 696e 6720 2861 6e20 4854 4d4c 0a20 2020  ing (an HTML.   
-00022e70: 2073 7472 696e 6720 772f 2061 2064 656e   string w/ a den
-00022e80: 6f6d 696e 6174 6f72 2c20 6f72 2027 756e  ominator, or 'un
-00022e90: 6b6e 6f77 6e27 292e 0a20 2020 2022 2222  known')..    """
-00022ea0: 0a20 2020 2069 6620 6772 6164 655f 7661  .    if grade_va
-00022eb0: 6c75 6520 6973 204e 6f6e 6520 6f72 206e  lue is None or n
-00022ec0: 6f74 2069 7369 6e73 7461 6e63 6528 6772  ot isinstance(gr
-00022ed0: 6164 655f 7661 6c75 652c 2028 696e 742c  ade_value, (int,
-00022ee0: 2066 6c6f 6174 2929 3a0a 2020 2020 2020   float)):.      
-00022ef0: 2020 7265 7475 726e 2022 756e 6b6e 6f77    return "unknow
-00022f00: 6e22 0a20 2020 2065 6c73 653a 0a20 2020  n".    else:.   
-00022f10: 2020 2020 2072 6f75 6e64 5f74 6f20 3d20       round_to = 
-00022f20: 6170 702e 636f 6e66 6967 5b22 524f 554e  app.config["ROUN
-00022f30: 445f 5343 4f52 4553 5f54 4f22 5d0a 2020  D_SCORES_TO"].  
-00022f40: 2020 2020 2020 726f 756e 6465 6420 3d20        rounded = 
-00022f50: 726f 756e 6428 6772 6164 655f 7661 6c75  round(grade_valu
-00022f60: 652c 2072 6f75 6e64 5f74 6f29 0a20 2020  e, round_to).   
-00022f70: 2020 2020 2072 6465 6e6f 6d20 3d20 726f       rdenom = ro
-00022f80: 756e 6428 6170 702e 636f 6e66 6967 5b22  und(app.config["
-00022f90: 5343 4f52 455f 4241 5349 5322 5d2c 2072  SCORE_BASIS"], r
-00022fa0: 6f75 6e64 5f74 6f29 0a20 2020 2020 2020  ound_to).       
-00022fb0: 2069 6620 696e 7428 726f 756e 6465 6429   if int(rounded)
-00022fc0: 203d 3d20 726f 756e 6465 643a 0a20 2020   == rounded:.   
-00022fd0: 2020 2020 2020 2020 2072 6f75 6e64 6564           rounded
-00022fe0: 203d 2069 6e74 2872 6f75 6e64 6564 290a   = int(rounded).
-00022ff0: 2020 2020 2020 2020 6966 2069 6e74 2872          if int(r
-00023000: 6465 6e6f 6d29 203d 3d20 7264 656e 6f6d  denom) == rdenom
-00023010: 3a0a 2020 2020 2020 2020 2020 2020 7264  :.            rd
-00023020: 656e 6f6d 203d 2069 6e74 2872 6465 6e6f  enom = int(rdeno
-00023030: 6d29 0a20 2020 2020 2020 2072 6574 7572  m).        retur
-00023040: 6e20 227b 7d26 6e62 7370 3b2f 266e 6273  n "{}&nbsp;/&nbs
-00023050: 703b 7b7d 222e 666f 726d 6174 2872 6f75  p;{}".format(rou
-00023060: 6e64 6564 2c20 7264 656e 6f6d 290a 0a0a  nded, rdenom)...
-00023070: 4061 7070 2e74 656d 706c 6174 655f 6669  @app.template_fi
-00023080: 6c74 6572 2829 0a64 6566 2074 696d 656c  lter().def timel
-00023090: 696e 6573 735f 7374 7269 6e67 2867 7261  iness_string(gra
-000230a0: 6465 5f76 616c 7565 293a 0a20 2020 2022  de_value):.    "
-000230b0: 2222 0a20 2020 2054 7572 6e73 2061 2074  "".    Turns a t
-000230c0: 696d 656c 696e 6573 7320 706f 696e 7473  imeliness points
-000230d0: 2076 616c 7565 2028 4e6f 6e65 2c20 6f72   value (None, or
-000230e0: 2061 206e 756d 6265 7229 2069 6e74 6f20   a number) into 
-000230f0: 6120 7469 6d65 6c69 6e65 7373 0a20 2020  a timeliness.   
-00023100: 2067 7261 6465 2073 7472 696e 6720 2861   grade string (a
-00023110: 6e20 4854 4d4c 2073 7472 696e 6720 772f  n HTML string w/
-00023120: 2061 2064 656e 6f6d 696e 6174 6f72 2c20   a denominator, 
-00023130: 6f72 2027 756e 6b6e 6f77 6e27 292e 0a20  or 'unknown').. 
-00023140: 2020 2022 2222 0a20 2020 2069 6620 6772     """.    if gr
-00023150: 6164 655f 7661 6c75 6520 6973 204e 6f6e  ade_value is Non
-00023160: 6520 6f72 206e 6f74 2069 7369 6e73 7461  e or not isinsta
-00023170: 6e63 6528 6772 6164 655f 7661 6c75 652c  nce(grade_value,
-00023180: 2028 696e 742c 2066 6c6f 6174 2929 3a0a   (int, float)):.
-00023190: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-000231a0: 756e 6b6e 6f77 6e22 0a20 2020 2065 6c73  unknown".    els
-000231b0: 653a 0a20 2020 2020 2020 2072 6f75 6e64  e:.        round
-000231c0: 5f74 6f20 3d20 6170 702e 636f 6e66 6967  _to = app.config
-000231d0: 5b22 524f 554e 445f 5343 4f52 4553 5f54  ["ROUND_SCORES_T
-000231e0: 4f22 5d0a 2020 2020 2020 2020 726f 756e  O"].        roun
-000231f0: 6465 6420 3d20 726f 756e 6428 6772 6164  ded = round(grad
-00023200: 655f 7661 6c75 652c 2072 6f75 6e64 5f74  e_value, round_t
-00023210: 6f29 0a20 2020 2020 2020 2072 6465 6e6f  o).        rdeno
-00023220: 6d20 3d20 726f 756e 6428 6170 702e 636f  m = round(app.co
-00023230: 6e66 6967 2e67 6574 2822 5449 4d45 4c49  nfig.get("TIMELI
-00023240: 4e45 5353 5f50 4f49 4e54 5322 2c20 3029  NESS_POINTS", 0)
-00023250: 2c20 726f 756e 645f 746f 290a 2020 2020  , round_to).    
-00023260: 2020 2020 6966 2069 6e74 2872 6f75 6e64      if int(round
-00023270: 6564 2920 3d3d 2072 6f75 6e64 6564 3a0a  ed) == rounded:.
-00023280: 2020 2020 2020 2020 2020 2020 726f 756e              roun
-00023290: 6465 6420 3d20 696e 7428 726f 756e 6465  ded = int(rounde
-000232a0: 6429 0a20 2020 2020 2020 2069 6620 696e  d).        if in
-000232b0: 7428 7264 656e 6f6d 2920 3d3d 2072 6465  t(rdenom) == rde
-000232c0: 6e6f 6d3a 0a20 2020 2020 2020 2020 2020  nom:.           
-000232d0: 2072 6465 6e6f 6d20 3d20 696e 7428 7264   rdenom = int(rd
-000232e0: 656e 6f6d 290a 2020 2020 2020 2020 7265  enom).        re
-000232f0: 7475 726e 2022 7b7d 266e 6273 703b 2f26  turn "{}&nbsp;/&
-00023300: 6e62 7370 3b7b 7d22 2e66 6f72 6d61 7428  nbsp;{}".format(
-00023310: 726f 756e 6465 642c 2072 6465 6e6f 6d29  rounded, rdenom)
-00023320: 0a0a 0a40 6170 702e 7465 6d70 6c61 7465  ...@app.template
-00023330: 5f66 696c 7465 7228 290a 6465 6620 7368  _filter().def sh
-00023340: 6f72 7465 725f 6772 6164 6528 6772 6164  orter_grade(grad
-00023350: 655f 7374 7269 6e67 293a 0a20 2020 2022  e_string):.    "
-00023360: 2222 0a20 2020 2053 686f 7274 656e 7320  "".    Shortens 
-00023370: 6120 6772 6164 6520 7374 7269 6e67 2e0a  a grade string..
-00023380: 2020 2020 2222 220a 2020 2020 6469 7669      """.    divi
-00023390: 7320 3d20 2226 6e62 7370 3b2f 266e 6273  s = "&nbsp;/&nbs
-000233a0: 703b 220a 2020 2020 6966 2064 6976 6973  p;".    if divis
-000233b0: 2069 6e20 6772 6164 655f 7374 7269 6e67   in grade_string
-000233c0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000233d0: 2067 7261 6465 5f73 7472 696e 675b 3a67   grade_string[:g
-000233e0: 7261 6465 5f73 7472 696e 672e 696e 6465  rade_string.inde
-000233f0: 7828 6469 7669 7329 5d0a 2020 2020 656c  x(divis)].    el
-00023400: 6966 2067 7261 6465 5f73 7472 696e 6720  if grade_string 
-00023410: 3d3d 2022 756e 6b6e 6f77 6e22 3a0a 2020  == "unknown":.  
-00023420: 2020 2020 2020 7265 7475 726e 2022 3f22        return "?"
-00023430: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00023440: 2020 2072 6574 7572 6e20 2221 220a 0a0a     return "!"...
-00023450: 4061 7070 2e74 656d 706c 6174 655f 6669  @app.template_fi
-00023460: 6c74 6572 2829 0a64 6566 2067 7261 6465  lter().def grade
-00023470: 5f63 6174 6567 6f72 7928 6772 6164 655f  _category(grade_
-00023480: 7661 6c75 6529 3a0a 2020 2020 2222 220a  value):.    """.
-00023490: 2020 2020 4361 7465 676f 7269 7a65 7320      Categorizes 
-000234a0: 6120 6772 6164 6520 7661 6c75 6520 2830  a grade value (0
-000234b0: 2d31 3030 206f 7220 4e6f 6e65 292e 0a20  -100 or None).. 
-000234c0: 2020 2022 2222 0a20 2020 2069 6620 6772     """.    if gr
-000234d0: 6164 655f 7661 6c75 6520 6973 204e 6f6e  ade_value is Non
-000234e0: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
-000234f0: 6e20 226d 6973 7369 6e67 220a 2020 2020  n "missing".    
-00023500: 656c 6966 2067 7261 6465 5f76 616c 7565  elif grade_value
-00023510: 203c 2061 7070 2e63 6f6e 6669 675b 2247   < app.config["G
-00023520: 5241 4445 5f54 4852 4553 484f 4c44 5322  RADE_THRESHOLDS"
-00023530: 5d5b 226c 6f77 225d 3a0a 2020 2020 2020  ]["low"]:.      
-00023540: 2020 7265 7475 726e 2022 6c6f 7722 0a20    return "low". 
-00023550: 2020 2065 6c69 6620 6772 6164 655f 7661     elif grade_va
-00023560: 6c75 6520 3c20 6170 702e 636f 6e66 6967  lue < app.config
-00023570: 5b22 4752 4144 455f 5448 5245 5348 4f4c  ["GRADE_THRESHOL
-00023580: 4453 225d 5b22 6d69 6422 5d3a 0a20 2020  DS"]["mid"]:.   
-00023590: 2020 2020 2072 6574 7572 6e20 226d 6964       return "mid
-000235a0: 220a 2020 2020 656c 7365 3a0a 2020 2020  ".    else:.    
-000235b0: 2020 2020 7265 7475 726e 2022 6869 6768      return "high
-000235c0: 220a 0a0a 4061 7070 2e74 656d 706c 6174  "...@app.templat
-000235d0: 655f 6669 6c74 6572 2829 0a64 6566 2074  e_filter().def t
-000235e0: 696d 6573 7065 6e74 2874 696d 655f 7370  imespent(time_sp
-000235f0: 656e 7429 3a0a 2020 2020 2222 220a 2020  ent):.    """.  
-00023600: 2020 4861 6e64 6c65 7320 6e75 6d65 7269    Handles numeri
-00023610: 6361 6c2d 6f72 2d73 7472 696e 672d 6f72  cal-or-string-or
-00023620: 2d4e 6f6e 6520 7469 6d65 2073 7065 6e74  -None time spent
-00023630: 2076 616c 7565 732e 0a20 2020 2022 2222   values..    """
-00023640: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00023650: 6365 2874 696d 655f 7370 656e 742c 2028  ce(time_spent, (
-00023660: 696e 742c 2066 6c6f 6174 2929 3a0a 2020  int, float)):.  
-00023670: 2020 2020 2020 6966 2074 696d 655f 7370        if time_sp
-00023680: 656e 7420 3d3d 2030 3a0a 2020 2020 2020  ent == 0:.      
-00023690: 2020 2020 2020 7265 7475 726e 2027 2d27        return '-'
-000236a0: 0a20 2020 2020 2020 2065 6c69 6620 696e  .        elif in
-000236b0: 7428 7469 6d65 5f73 7065 6e74 2920 3d3d  t(time_spent) ==
-000236c0: 2074 696d 655f 7370 656e 743a 0a20 2020   time_spent:.   
-000236d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000236e0: 227b 7d68 222e 666f 726d 6174 2869 6e74  "{}h".format(int
-000236f0: 2874 696d 655f 7370 656e 7429 290a 2020  (time_spent)).  
-00023700: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00023710: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00023720: 7b7d 6822 2e66 6f72 6d61 7428 726f 756e  {}h".format(roun
-00023730: 6428 7469 6d65 5f73 7065 6e74 2c20 3229  d(time_spent, 2)
-00023740: 290a 2020 2020 656c 6966 2069 7369 6e73  ).    elif isins
-00023750: 7461 6e63 6528 7469 6d65 5f73 7065 6e74  tance(time_spent
-00023760: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-00023770: 7265 7475 726e 2074 696d 655f 7370 656e  return time_spen
-00023780: 740a 2020 2020 656c 7365 3a0a 2020 2020  t.    else:.    
-00023790: 2020 2020 7265 7475 726e 2022 3f22 0a0a      return "?"..
-000237a0: 0a40 6170 702e 7465 6d70 6c61 7465 5f66  .@app.template_f
-000237b0: 696c 7465 7228 290a 6465 6620 696e 6974  ilter().def init
-000237c0: 6961 6c73 2866 756c 6c5f 7365 6374 696f  ials(full_sectio
-000237d0: 6e5f 7469 746c 6529 3a0a 2020 2020 2222  n_title):.    ""
-000237e0: 220a 2020 2020 5265 6475 6365 7320 6120  ".    Reduces a 
-000237f0: 6675 6c6c 2073 6563 7469 6f6e 2074 6974  full section tit
-00023800: 6c65 2070 6f74 656e 7469 616c 6c79 2069  le potentially i
-00023810: 6e63 6c75 6469 6e67 2074 696d 6520 696e  ncluding time in
-00023820: 666f 726d 6174 696f 6e0a 2020 2020 616e  formation.    an
-00023830: 6420 7468 6520 776f 7264 2027 5072 6f66  d the word 'Prof
-00023840: 2e27 206f 7220 2750 726f 6665 7373 6f72  .' or 'Professor
-00023850: 2720 746f 206a 7573 7420 6669 7273 7420  ' to just first 
-00023860: 696e 6974 6961 6c73 2e0a 2020 2020 2222  initials..    ""
-00023870: 220a 2020 2020 776f 7264 7320 3d20 6675  ".    words = fu
-00023880: 6c6c 5f73 6563 7469 6f6e 5f74 6974 6c65  ll_section_title
-00023890: 2e73 706c 6974 2829 0a20 2020 2069 6620  .split().    if 
-000238a0: 6c65 6e28 776f 7264 7329 203e 2031 3a0a  len(words) > 1:.
-000238b0: 2020 2020 2020 2020 6966 2077 6f72 6473          if words
-000238c0: 5b30 5d20 696e 2028 2750 726f 6627 2c20  [0] in ('Prof', 
-000238d0: 2750 726f 662e 272c 2027 5072 6f66 6573  'Prof.', 'Profes
-000238e0: 736f 7227 293a 0a20 2020 2020 2020 2020  sor'):.         
-000238f0: 2020 2077 6f72 6473 2e70 6f70 2830 290a     words.pop(0).
-00023900: 2020 2020 2020 2020 7265 7475 726e 2077          return w
-00023910: 6f72 6473 5b30 5d5b 305d 202b 2077 6f72  ords[0][0] + wor
-00023920: 6473 5b31 5d5b 305d 0a20 2020 2065 6c73  ds[1][0].    els
-00023930: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
-00023940: 6e20 6675 6c6c 5f73 6563 7469 6f6e 5f74  n full_section_t
-00023950: 6974 6c65 0a0a 0a40 6170 702e 7465 6d70  itle...@app.temp
-00023960: 6c61 7465 5f66 696c 7465 7228 290a 6465  late_filter().de
-00023970: 6620 7072 6f6e 6f75 6e28 7072 6f6e 6f75  f pronoun(pronou
-00023980: 6e73 293a 0a20 2020 2022 2222 0a20 2020  ns):.    """.   
-00023990: 2052 6564 7563 6573 2070 726f 6e6f 756e   Reduces pronoun
-000239a0: 2069 6e66 6f20 746f 2061 2073 696e 676c   info to a singl
-000239b0: 6520 7072 6f6e 6f75 6e2e 0a20 2020 2022  e pronoun..    "
-000239c0: 2222 0a20 2020 2074 6573 7420 3d20 272f  "".    test = '/
-000239d0: 272e 6a6f 696e 2872 652e 7370 6c69 7428  '.join(re.split(
-000239e0: 7222 5b5e 412d 5a61 2d7a 5d2b 222c 2070  r"[^A-Za-z]+", p
-000239f0: 726f 6e6f 756e 732e 6c6f 7765 7228 2929  ronouns.lower())
-00023a00: 290a 2020 2020 6966 2074 6573 7420 696e  ).    if test in
-00023a10: 2028 0a20 2020 2020 2020 2022 7368 6522   (.        "she"
-00023a20: 2c0a 2020 2020 2020 2020 2273 6865 2f68  ,.        "she/h
-00023a30: 6572 222c 0a20 2020 2020 2020 2022 7368  er",.        "sh
-00023a40: 652f 6865 7273 222c 0a20 2020 2020 2020  e/hers",.       
-00023a50: 2022 7368 652f 6865 722f 6865 7273 220a   "she/her/hers".
-00023a60: 2020 2020 293a 0a20 2020 2020 2020 2072      ):.        r
-00023a70: 6574 7572 6e20 2273 6865 220a 2020 2020  eturn "she".    
-00023a80: 656c 6966 2074 6573 7420 696e 2028 0a20  elif test in (. 
-00023a90: 2020 2020 2020 2022 6865 222c 0a20 2020         "he",.   
-00023aa0: 2020 2020 2022 6865 2f68 696d 222c 0a20       "he/him",. 
-00023ab0: 2020 2020 2020 2022 6865 2f68 6973 222c         "he/his",
-00023ac0: 0a20 2020 2020 2020 2022 6865 2f68 696d  .        "he/him
-00023ad0: 2f68 6973 220a 2020 2020 293a 0a20 2020  /his".    ):.   
-00023ae0: 2020 2020 2072 6574 7572 6e20 2268 6522       return "he"
-00023af0: 0a20 2020 2065 6c69 6620 7465 7374 2069  .    elif test i
-00023b00: 6e20 280a 2020 2020 2020 2020 2274 6865  n (.        "the
-00023b10: 7922 2c0a 2020 2020 2020 2020 2274 6865  y",.        "the
-00023b20: 792f 7468 656d 222c 0a20 2020 2020 2020  y/them",.       
-00023b30: 2022 7468 656d 2f74 6865 6d2f 7468 6569   "them/them/thei
-00023b40: 7222 0a20 2020 2029 3a0a 2020 2020 2020  r".    ):.      
-00023b50: 2020 7265 7475 726e 2022 7468 6579 220a    return "they".
-00023b60: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00023b70: 2020 7265 7475 726e 2070 726f 6e6f 756e    return pronoun
-00023b80: 730a 0a0a 2320 4368 6172 6163 7465 7273  s...# Characters
-00023b90: 2074 6861 7420 6e65 6564 2072 6570 6c61   that need repla
-00023ba0: 6369 6e67 2074 6f20 6176 6f69 6420 6272  cing to avoid br
-00023bb0: 6561 6b69 6e67 2073 7472 696e 6773 2069  eaking strings i
-00023bc0: 6e20 4a53 2073 6372 6970 740a 2320 7461  n JS script.# ta
-00023bd0: 6773 0a5f 4a53 5f45 5343 4150 4553 203d  gs._JS_ESCAPES =
-00023be0: 205b 2023 2061 6c6c 2063 6861 7261 6374   [ # all charact
-00023bf0: 6572 7320 7769 7468 206f 7264 2829 203c  ers with ord() <
-00023c00: 2033 320a 2020 2020 6368 7228 7a29 2066   32.    chr(z) f
-00023c10: 6f72 207a 2069 6e20 7261 6e67 6528 3332  or z in range(32
-00023c20: 290a 5d20 2b20 5b0a 2020 2020 275c 5c27  ).] + [.    '\\'
-00023c30: 2c0a 2020 2020 2227 222c 0a20 2020 2027  ,.    "'",.    '
-00023c40: 2227 2c0a 2020 2020 273e 272c 0a20 2020  "',.    '>',.   
-00023c50: 2027 3c27 2c0a 2020 2020 2726 272c 0a20   '<',.    '&',. 
-00023c60: 2020 2027 3d27 2c0a 2020 2020 272d 272c     '=',.    '-',
-00023c70: 0a20 2020 2027 3b27 2c0a 2020 2020 7527  .    ';',.    u'
-00023c80: 5c75 3230 3238 272c 2023 204c 494e 455f  \u2028', # LINE_
-00023c90: 5345 5041 5241 544f 520a 2020 2020 7527  SEPARATOR.    u'
-00023ca0: 5c75 3230 3239 272c 2023 2050 4152 4147  \u2029', # PARAG
-00023cb0: 5241 5048 5f53 4550 4152 4154 4f52 0a5d  RAPH_SEPARATOR.]
-00023cc0: 0a0a 0a40 6170 702e 7465 6d70 6c61 7465  ...@app.template
-00023cd0: 5f66 696c 7465 7228 290a 6465 6620 6573  _filter().def es
-00023ce0: 6361 7065 6a73 2876 616c 7565 293a 0a20  capejs(value):. 
-00023cf0: 2020 2022 2222 0a20 2020 204d 6f64 6966     """.    Modif
-00023d00: 6965 6420 6672 6f6d 3a0a 0a20 2020 2068  ied from:..    h
-00023d10: 7474 7073 3a2f 2f73 7461 636b 6f76 6572  ttps://stackover
-00023d20: 666c 6f77 2e63 6f6d 2f71 7565 7374 696f  flow.com/questio
-00023d30: 6e73 2f31 3233 3339 3830 362f 6573 6361  ns/12339806/esca
-00023d40: 7065 2d73 7472 696e 6773 2d66 6f72 2d6a  pe-strings-for-j
-00023d50: 6176 6173 6372 6970 742d 7573 696e 672d  avascript-using-
-00023d60: 6a69 6e6a 6132 0a0a 2020 2020 4573 6361  jinja2..    Esca
-00023d70: 7065 7320 7374 7269 6e67 2076 616c 7565  pes string value
-00023d80: 7320 736f 2074 6861 7420 7468 6579 2063  s so that they c
-00023d90: 616e 2061 7070 6561 7220 696e 7369 6465  an appear inside
-00023da0: 206f 6620 7175 6f74 6573 2069 6e20 610a   of quotes in a.
-00023db0: 2020 2020 266c 743b 7363 7269 7074 2667      &lt;script&g
-00023dc0: 743b 2074 6167 2061 6e64 2074 6865 7920  t; tag and they 
-00023dd0: 776f 6e27 7420 656e 6420 7468 6520 7175  won't end the qu
-00023de0: 6f74 6573 206f 7220 6361 7573 6520 616e  otes or cause an
-00023df0: 7920 6f74 6865 720a 2020 2020 7472 6f75  y other.    trou
-00023e00: 626c 652e 0a20 2020 2022 2222 0a20 2020  ble..    """.   
-00023e10: 2072 6574 7661 6c20 3d20 5b5d 0a20 2020   retval = [].   
-00023e20: 2066 6f72 2063 6861 7220 696e 2076 616c   for char in val
-00023e30: 7565 3a0a 2020 2020 2020 2020 6966 2063  ue:.        if c
-00023e40: 6861 7220 696e 205f 4a53 5f45 5343 4150  har in _JS_ESCAP
-00023e50: 4553 3a0a 2020 2020 2020 2020 2020 2020  ES:.            
-00023e60: 7265 7476 616c 2e61 7070 656e 6428 7227  retval.append(r'
-00023e70: 5c75 7b3a 3034 587d 272e 666f 726d 6174  \u{:04X}'.format
-00023e80: 286f 7264 2863 6861 7229 2929 0a20 2020  (ord(char))).   
-00023e90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00023ea0: 2020 2020 2020 2072 6574 7661 6c2e 6170         retval.ap
-00023eb0: 7065 6e64 2863 6861 7229 0a0a 2020 2020  pend(char)..    
-00023ec0: 7265 7475 726e 206a 696e 6a61 322e 4d61  return jinja2.Ma
-00023ed0: 726b 7570 2875 2222 2e6a 6f69 6e28 7265  rkup(u"".join(re
-00023ee0: 7476 616c 2929 0a0a 0a23 2d2d 2d2d 2d2d  tval))...#------
-00023ef0: 2d2d 2d2d 2d23 0a23 204d 6169 6e20 636f  -----#.# Main co
-00023f00: 6465 2023 0a23 2d2d 2d2d 2d2d 2d2d 2d2d  de #.#----------
-00023f10: 2d23 0a0a 6966 205f 5f6e 616d 655f 5f20  -#..if __name__ 
-00023f20: 3d3d 2022 5f5f 6d61 696e 5f5f 223a 0a20  == "__main__":. 
-00023f30: 2020 2075 7365 5f73 736c 203d 2054 7275     use_ssl = Tru
-00023f40: 650a 2020 2020 6966 2061 7070 2e63 6f6e  e.    if app.con
-00023f50: 6669 672e 6765 7428 224e 4f5f 4445 4255  fig.get("NO_DEBU
-00023f60: 475f 5353 4c22 293a 0a20 2020 2020 2020  G_SSL"):.       
-00023f70: 2075 7365 5f73 736c 203d 2046 616c 7365   use_ssl = False
-00023f80: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00023f90: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00023fa0: 2020 2020 696d 706f 7274 204f 7065 6e53      import OpenS
-00023fb0: 534c 2023 206e 6f71 6120 4638 3131 2c20  SL # noqa F811, 
-00023fc0: 4634 3031 0a20 2020 2020 2020 2065 7863  F401.        exc
-00023fd0: 6570 7420 4d6f 6475 6c65 4e6f 7446 6f75  ept ModuleNotFou
-00023fe0: 6e64 5f6f 725f 496d 706f 7274 5f45 7272  nd_or_Import_Err
-00023ff0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00024000: 7573 655f 7373 6c20 3d20 4661 6c73 650a  use_ssl = False.
-00024010: 0a20 2020 2069 6620 7573 655f 7373 6c3a  .    if use_ssl:
-00024020: 0a20 2020 2020 2020 2023 2052 756e 2077  .        # Run w
-00024030: 6974 6820 616e 2061 642d 686f 6320 5353  ith an ad-hoc SS
-00024040: 4c20 636f 6e74 6578 7420 7369 6e63 6520  L context since 
-00024050: 4f70 656e 5353 4c20 6973 2061 7661 696c  OpenSSL is avail
-00024060: 6162 6c65 0a20 2020 2020 2020 2070 7269  able.        pri
-00024070: 6e74 2822 5275 6e6e 696e 6720 7769 7468  nt("Running with
-00024080: 2073 656c 662d 7369 676e 6564 2053 534c   self-signed SSL
-00024090: 2e22 290a 2020 2020 2020 2020 6170 702e  .").        app.
-000240a0: 7275 6e28 276c 6f63 616c 686f 7374 272c  run('localhost',
-000240b0: 2038 3738 372c 2064 6562 7567 3d46 616c   8787, debug=Fal
-000240c0: 7365 2c20 7373 6c5f 636f 6e74 6578 743d  se, ssl_context=
-000240d0: 2761 6468 6f63 2729 0a20 2020 2065 6c73  'adhoc').    els
-000240e0: 653a 0a20 2020 2020 2020 2023 2052 756e  e:.        # Run
-000240f0: 2077 6974 686f 7574 2061 6e20 5353 4c20   without an SSL 
-00024100: 636f 6e74 6578 7420 284e 6f20 4f70 656e  context (No Open
-00024110: 5353 4c29 0a20 2020 2020 2020 2070 7269  SSL).        pri
-00024120: 6e74 2822 5275 6e6e 696e 6720 7769 7468  nt("Running with
-00024130: 6f75 7420 5353 4c2e 2229 0a20 2020 2020  out SSL.").     
-00024140: 2020 2061 7070 2e72 756e 2827 6c6f 6361     app.run('loca
-00024150: 6c68 6f73 7427 2c20 3837 3837 2c20 6465  lhost', 8787, de
-00024160: 6275 673d 4661 6c73 6529 0a20 2020 2020  bug=False).     
-00024170: 2020 2023 204e 6f74 653a 2063 616e 2774     # Note: can't
-00024180: 2065 6e61 626c 6520 6465 6275 6767 696e   enable debuggin
-00024190: 6720 6265 6361 7573 6520 6974 2064 6f65  g because it doe
-000241a0: 736e 2774 2073 6574 205f 5f70 6163 6b61  sn't set __packa
-000241b0: 6765 5f5f 0a20 2020 2020 2020 2023 2077  ge__.        # w
-000241c0: 6865 6e20 7265 7374 6172 7469 6e67 2061  hen restarting a
-000241d0: 6e64 2073 6f20 7265 6c61 7469 7665 2069  nd so relative i
-000241e0: 6d70 6f72 7473 2062 7265 616b 2069 6e20  mports break in 
-000241f0: 332e 780a                                3.x.
+0000fbc0: 2020 2020 2020 2020 2020 7073 6f62 6a5b            psobj[
+0000fbd0: 2274 6f74 616c 5f74 696d 6522 5d20 2b3d  "total_time"] +=
+0000fbe0: 2074 696d 655f 7661 6c0a 2020 2020 2020   time_val.      
+0000fbf0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+0000fc00: 7369 6e73 7461 6e63 6528 7469 6d65 5f76  sinstance(time_v
+0000fc10: 616c 2c20 7374 7229 2061 6e64 2074 696d  al, str) and tim
+0000fc20: 655f 7661 6c20 213d 2022 223a 0a20 2020  e_val != "":.   
+0000fc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc40: 2074 6173 6b6f 626a 5b22 696e 6974 6961   taskobj["initia
+0000fc50: 6c5f 7469 6d65 5f76 616c 225d 203d 2074  l_time_val"] = t
+0000fc60: 696d 655f 7661 6c0a 2020 2020 2020 2020  ime_val.        
+0000fc70: 2020 2020 2020 2020 2020 2020 7073 6f62              psob
+0000fc80: 6a5b 2274 6f74 616c 5f74 696d 6522 5d20  j["total_time"] 
+0000fc90: 3d20 223f 220a 2020 2020 2020 2020 2020  = "?".          
+0000fca0: 2020 2020 2020 656c 7365 3a20 2320 656d        else: # em
+0000fcb0: 7074 7920 7374 7269 6e67 206f 7220 4e6f  pty string or No
+0000fcc0: 6e65 206f 7220 7468 6520 6c69 6b65 0a20  ne or the like. 
+0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fce0: 2020 2074 6173 6b6f 626a 5b22 696e 6974     taskobj["init
+0000fcf0: 6961 6c5f 7469 6d65 5f76 616c 225d 203d  ial_time_val"] =
+0000fd00: 2022 3f22 0a20 2020 2020 2020 2020 2020   "?".           
+0000fd10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000fd20: 2020 2020 2020 2074 6173 6b6f 626a 5b22         taskobj["
+0000fd30: 696e 6974 6961 6c5f 7469 6d65 5f76 616c  initial_time_val
+0000fd40: 225d 203d 2030 0a0a 2020 2020 2020 2020  "] = 0..        
+0000fd50: 2020 2020 7265 765f 7469 6d65 5f73 7065      rev_time_spe
+0000fd60: 6e74 203d 2074 6173 6b6f 626a 2e67 6574  nt = taskobj.get
+0000fd70: 2822 7265 7669 7369 6f6e 222c 207b 7d29  ("revision", {})
+0000fd80: 2e67 6574 2822 7469 6d65 5f73 7065 6e74  .get("time_spent
+0000fd90: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+0000fda0: 6620 7265 765f 7469 6d65 5f73 7065 6e74  f rev_time_spent
+0000fdb0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000fdc0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000fdd0: 765f 7469 6d65 5f76 616c 203d 2072 6576  v_time_val = rev
+0000fde0: 5f74 696d 655f 7370 656e 745b 2274 696d  _time_spent["tim
+0000fdf0: 655f 7370 656e 7422 5d0a 2020 2020 2020  e_spent"].      
+0000fe00: 2020 2020 2020 2020 2020 6966 2074 6173            if tas
+0000fe10: 6b69 6420 6e6f 7420 696e 2072 6576 6973  kid not in revis
+0000fe20: 696f 6e5f 7461 736b 5f74 696d 6573 3a0a  ion_task_times:.
+0000fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe40: 2020 2020 7265 7669 7369 6f6e 5f74 6173      revision_tas
+0000fe50: 6b5f 7469 6d65 735b 7461 736b 6964 5d20  k_times[taskid] 
+0000fe60: 3d20 7b7d 0a0a 2020 2020 2020 2020 2020  = {}..          
+0000fe70: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000fe80: 6e63 6528 7265 765f 7469 6d65 5f76 616c  nce(rev_time_val
+0000fe90: 2c20 2866 6c6f 6174 2c20 696e 7429 293a  , (float, int)):
+0000fea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000feb0: 2020 2020 2072 6576 6973 696f 6e5f 7461       revision_ta
+0000fec0: 736b 5f74 696d 6573 5b74 6173 6b69 645d  sk_times[taskid]
+0000fed0: 5b72 6f77 5b22 7573 6572 6e61 6d65 225d  [row["username"]
+0000fee0: 5d20 3d20 7265 765f 7469 6d65 5f76 616c  ] = rev_time_val
+0000fef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ff00: 2020 2020 2074 6173 6b6f 626a 5b22 7265       taskobj["re
+0000ff10: 7669 7369 6f6e 5f74 696d 655f 7661 6c22  vision_time_val"
+0000ff20: 5d20 3d20 7265 765f 7469 6d65 5f76 616c  ] = rev_time_val
+0000ff30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ff40: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000ff50: 6365 2870 736f 626a 5b22 746f 7461 6c5f  ce(psobj["total_
+0000ff60: 7469 6d65 225d 2c20 2869 6e74 2c20 666c  time"], (int, fl
+0000ff70: 6f61 7429 293a 0a20 2020 2020 2020 2020  oat)):.         
+0000ff80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000ff90: 736f 626a 5b22 746f 7461 6c5f 7469 6d65  sobj["total_time
+0000ffa0: 225d 202b 3d20 7265 765f 7469 6d65 5f76  "] += rev_time_v
+0000ffb0: 616c 0a20 2020 2020 2020 2020 2020 2020  al.             
+0000ffc0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000ffd0: 616e 6365 2874 6173 6b6f 626a 5b22 696e  ance(taskobj["in
+0000ffe0: 6974 6961 6c5f 7469 6d65 5f76 616c 225d  itial_time_val"]
+0000fff0: 2c20 2869 6e74 2c20 666c 6f61 7429 293a  , (int, float)):
+00010000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010010: 2020 2020 2020 2020 2074 6173 6b6f 626a           taskobj
+00010020: 5b22 636f 6d62 696e 6564 5f74 696d 655f  ["combined_time_
+00010030: 7661 6c22 5d20 3d20 280a 2020 2020 2020  val"] = (.      
+00010040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010050: 2020 2020 2020 7461 736b 6f62 6a5b 2269        taskobj["i
+00010060: 6e69 7469 616c 5f74 696d 655f 7661 6c22  nitial_time_val"
+00010070: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00010080: 2020 2020 2020 2020 2020 2020 2b20 7265              + re
+00010090: 765f 7469 6d65 5f76 616c 0a20 2020 2020  v_time_val.     
+000100a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100b0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000100c0: 2020 2020 2020 2020 2065 6c69 6620 2820           elif ( 
+000100d0: 2320 696e 6974 6961 6c20 7761 7320 6120  # initial was a 
+000100e0: 6e6f 6e2d 656d 7074 7920 7374 7269 6e67  non-empty string
+000100f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010100: 2020 2020 2020 2020 2069 7369 6e73 7461           isinsta
+00010110: 6e63 6528 7461 736b 6f62 6a5b 2269 6e69  nce(taskobj["ini
+00010120: 7469 616c 5f74 696d 655f 7661 6c22 5d2c  tial_time_val"],
+00010130: 2073 7472 290a 2020 2020 2020 2020 2020   str).          
+00010140: 2020 2020 2020 2020 2020 616e 6420 7461            and ta
+00010150: 736b 6f62 6a5b 2269 6e69 7469 616c 5f74  skobj["initial_t
+00010160: 696d 655f 7661 6c22 5d20 6e6f 7420 696e  ime_val"] not in
+00010170: 2028 2222 2c20 223f 2229 0a20 2020 2020   ("", "?").     
+00010180: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00010190: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000101a0: 2020 2020 2020 2020 2020 7461 736b 6f62            taskob
+000101b0: 6a5b 2263 6f6d 6269 6e65 645f 7469 6d65  j["combined_time
+000101c0: 5f76 616c 225d 203d 2022 3f22 0a20 2020  _val"] = "?".   
+000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101e0: 2065 6c73 653a 2023 2065 6d70 7479 2073   else: # empty s
+000101f0: 7472 696e 6720 6f72 204e 6f6e 6520 6f72  tring or None or
+00010200: 2074 6865 206c 696b 650a 2020 2020 2020   the like.      
+00010210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010220: 2020 7461 736b 6f62 6a5b 2263 6f6d 6269    taskobj["combi
+00010230: 6e65 645f 7469 6d65 5f76 616c 225d 203d  ned_time_val"] =
+00010240: 2072 6576 5f74 696d 655f 7661 6c0a 0a20   rev_time_val.. 
+00010250: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00010260: 6c69 6620 6973 696e 7374 616e 6365 2872  lif isinstance(r
+00010270: 6576 5f74 696d 655f 7661 6c2c 2073 7472  ev_time_val, str
+00010280: 2920 616e 6420 7265 765f 7469 6d65 5f76  ) and rev_time_v
+00010290: 616c 2021 3d20 2222 3a0a 2020 2020 2020  al != "":.      
+000102a0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+000102b0: 736b 6f62 6a5b 2272 6576 6973 696f 6e5f  skobj["revision_
+000102c0: 7469 6d65 5f76 616c 225d 203d 2072 6576  time_val"] = rev
+000102d0: 5f74 696d 655f 7661 6c0a 2020 2020 2020  _time_val.      
+000102e0: 2020 2020 2020 2020 2020 2020 2020 7073                ps
+000102f0: 6f62 6a5b 2274 6f74 616c 5f74 696d 6522  obj["total_time"
+00010300: 5d20 3d20 223f 220a 2020 2020 2020 2020  ] = "?".        
+00010310: 2020 2020 2020 2020 2020 2020 7461 736b              task
+00010320: 6f62 6a5b 2263 6f6d 6269 6e65 645f 7469  obj["combined_ti
+00010330: 6d65 5f76 616c 225d 203d 2022 3f22 0a0a  me_val"] = "?"..
+00010340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010350: 656c 7365 3a20 2320 656d 7074 7920 7374  else: # empty st
+00010360: 7269 6e67 206f 7220 4e6f 6e65 206f 7220  ring or None or 
+00010370: 7468 6520 6c69 6b65 0a20 2020 2020 2020  the like.       
+00010380: 2020 2020 2020 2020 2020 2020 2074 6173               tas
+00010390: 6b6f 626a 5b22 7265 7669 7369 6f6e 5f74  kobj["revision_t
+000103a0: 696d 655f 7661 6c22 5d20 3d20 223f 220a  ime_val"] = "?".
+000103b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103c0: 2020 2020 7461 736b 6f62 6a5b 2263 6f6d      taskobj["com
+000103d0: 6269 6e65 645f 7469 6d65 5f76 616c 225d  bined_time_val"]
+000103e0: 203d 2074 6173 6b6f 626a 5b22 696e 6974   = taskobj["init
+000103f0: 6961 6c5f 7469 6d65 5f76 616c 225d 0a0a  ial_time_val"]..
+00010400: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00010410: 3a20 2320 6e6f 2072 6576 2074 696d 6520  : # no rev time 
+00010420: 7370 656e 740a 2020 2020 2020 2020 2020  spent.          
+00010430: 2020 2020 2020 7461 736b 6f62 6a5b 2272        taskobj["r
+00010440: 6576 6973 696f 6e5f 7469 6d65 5f76 616c  evision_time_val
+00010450: 225d 203d 2022 3f22 0a20 2020 2020 2020  "] = "?".       
+00010460: 2020 2020 2020 2020 2074 6173 6b6f 626a           taskobj
+00010470: 5b22 636f 6d62 696e 6564 5f74 696d 655f  ["combined_time_
+00010480: 7661 6c22 5d20 3d20 7461 736b 6f62 6a5b  val"] = taskobj[
+00010490: 2269 6e69 7469 616c 5f74 696d 655f 7661  "initial_time_va
+000104a0: 6c22 5d0a 0a20 2020 2020 2020 2072 6f77  l"]..        row
+000104b0: 732e 6170 7065 6e64 2872 6f77 290a 0a20  s.append(row).. 
+000104c0: 2020 2061 6767 7265 6761 7465 5f74 696d     aggregate_tim
+000104d0: 6573 203d 207b 0a20 2020 2020 2020 2070  es = {.        p
+000104e0: 6861 7365 3a20 7b0a 2020 2020 2020 2020  hase: {.        
+000104f0: 2020 2020 2261 7665 7261 6765 223a 207b      "average": {
+00010500: 2022 7073 6574 223a 2030 207d 2c0a 2020   "pset": 0 },.  
+00010510: 2020 2020 2020 2020 2020 226d 6564 6961            "media
+00010520: 6e22 3a20 7b20 2270 7365 7422 3a20 3020  n": { "pset": 0 
+00010530: 7d2c 0a20 2020 2020 2020 2020 2020 2022  },.            "
+00010540: 3735 7468 223a 207b 2022 7073 6574 223a  75th": { "pset":
+00010550: 2030 207d 2c0a 2020 2020 2020 2020 7d0a   0 },.        }.
+00010560: 2020 2020 2020 2020 666f 7220 7068 6173          for phas
+00010570: 6520 696e 2028 2269 6e69 7469 616c 222c  e in ("initial",
+00010580: 2022 7265 7669 7369 6f6e 2229 0a20 2020   "revision").   
+00010590: 207d 0a20 2020 2061 6767 7265 6761 7465   }.    aggregate
+000105a0: 5f74 696d 6573 5b22 616c 6c22 5d20 3d20  _times["all"] = 
+000105b0: 7b7d 0a20 2020 2066 6f72 2070 6861 7365  {}.    for phase
+000105c0: 2c20 7469 6d65 735f 6772 6f75 7020 696e  , times_group in
+000105d0: 205b 0a20 2020 2020 2020 2028 2269 6e69   [.        ("ini
+000105e0: 7469 616c 222c 2069 6e69 7469 616c 5f74  tial", initial_t
+000105f0: 6173 6b5f 7469 6d65 7329 2c0a 2020 2020  ask_times),.    
+00010600: 2020 2020 2822 7265 7669 7369 6f6e 222c      ("revision",
+00010610: 2072 6576 6973 696f 6e5f 7461 736b 5f74   revision_task_t
+00010620: 696d 6573 290a 2020 2020 5d3a 0a20 2020  imes).    ]:.   
+00010630: 2020 2020 2066 6f72 2074 6173 6b69 6420       for taskid 
+00010640: 696e 2074 696d 6573 5f67 726f 7570 3a0a  in times_group:.
+00010650: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+00010660: 7320 3d20 6c69 7374 2874 696d 6573 5f67  s = list(times_g
+00010670: 726f 7570 5b74 6173 6b69 645d 2e76 616c  roup[taskid].val
+00010680: 7565 7328 2929 0a20 2020 2020 2020 2020  ues()).         
+00010690: 2020 2069 6620 6c65 6e28 7469 6d65 7329     if len(times)
+000106a0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+000106b0: 2020 2020 2020 2061 7667 203d 204e 6f6e         avg = Non
+000106c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000106d0: 2020 6d65 6420 3d20 4e6f 6e65 0a20 2020    med = None.   
+000106e0: 2020 2020 2020 2020 2020 2020 2071 7274               qrt
+000106f0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00010700: 2020 2020 656c 6966 206c 656e 2874 696d      elif len(tim
+00010710: 6573 2920 3d3d 2031 3a0a 2020 2020 2020  es) == 1:.      
+00010720: 2020 2020 2020 2020 2020 6176 6720 3d20            avg = 
+00010730: 7469 6d65 735b 305d 0a20 2020 2020 2020  times[0].       
+00010740: 2020 2020 2020 2020 206d 6564 203d 2074           med = t
+00010750: 696d 6573 5b30 5d0a 2020 2020 2020 2020  imes[0].        
+00010760: 2020 2020 2020 2020 7172 7420 3d20 7469          qrt = ti
+00010770: 6d65 735b 305d 0a20 2020 2020 2020 2020  mes[0].         
+00010780: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00010790: 2020 2020 2020 2020 2061 7667 203d 2073           avg = s
+000107a0: 756d 2874 696d 6573 2920 2f20 6c65 6e28  um(times) / len(
+000107b0: 7469 6d65 7329 0a20 2020 2020 2020 2020  times).         
+000107c0: 2020 2020 2020 206d 6564 203d 2070 6572         med = per
+000107d0: 6365 6e74 696c 6528 7469 6d65 732c 2035  centile(times, 5
+000107e0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+000107f0: 2020 2071 7274 203d 2070 6572 6365 6e74     qrt = percent
+00010800: 696c 6528 7469 6d65 732c 2037 3529 0a0a  ile(times, 75)..
+00010810: 2020 2020 2020 2020 2020 2020 6167 6772              aggr
+00010820: 6567 6174 655f 7469 6d65 735b 7068 6173  egate_times[phas
+00010830: 655d 5b22 6176 6572 6167 6522 5d5b 7461  e]["average"][ta
+00010840: 736b 6964 5d20 3d20 6176 670a 2020 2020  skid] = avg.    
+00010850: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
+00010860: 655f 7469 6d65 735b 7068 6173 655d 5b22  e_times[phase]["
+00010870: 6d65 6469 616e 225d 5b74 6173 6b69 645d  median"][taskid]
+00010880: 203d 206d 6564 0a20 2020 2020 2020 2020   = med.         
+00010890: 2020 2061 6767 7265 6761 7465 5f74 696d     aggregate_tim
+000108a0: 6573 5b70 6861 7365 5d5b 2237 3574 6822  es[phase]["75th"
+000108b0: 5d5b 7461 736b 6964 5d20 3d20 7172 740a  ][taskid] = qrt.
+000108c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000108d0: 6176 6720 6973 206e 6f74 204e 6f6e 653a  avg is not None:
+000108e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000108f0: 2061 6767 7265 6761 7465 5f74 696d 6573   aggregate_times
+00010900: 5b70 6861 7365 5d5b 2261 7665 7261 6765  [phase]["average
+00010910: 225d 5b22 7073 6574 225d 202b 3d20 6176  "]["pset"] += av
+00010920: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+00010930: 2020 6167 6772 6567 6174 655f 7469 6d65    aggregate_time
+00010940: 735b 7068 6173 655d 5b22 6d65 6469 616e  s[phase]["median
+00010950: 225d 5b22 7073 6574 225d 202b 3d20 6d65  "]["pset"] += me
+00010960: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+00010970: 2020 6167 6772 6567 6174 655f 7469 6d65    aggregate_time
+00010980: 735b 7068 6173 655d 5b22 3735 7468 225d  s[phase]["75th"]
+00010990: 5b22 7073 6574 225d 202b 3d20 7172 740a  ["pset"] += qrt.
+000109a0: 0a20 2020 2023 2043 6f6d 7075 7465 2074  .    # Compute t
+000109b0: 6f74 616c 2074 696d 6573 2074 616b 696e  otal times takin
+000109c0: 6720 7a65 726f 2d72 6576 6973 696f 6e2d  g zero-revision-
+000109d0: 7469 6d65 7320 696e 746f 2061 6363 6f75  times into accou
+000109e0: 6e74 0a20 2020 2074 6f74 616c 5f74 696d  nt.    total_tim
+000109f0: 6573 7065 6e74 5f76 616c 7565 7320 3d20  espent_values = 
+00010a00: 5b5d 0a20 2020 2066 6f72 2073 7475 6465  [].    for stude
+00010a10: 6e74 2069 6e20 5b72 6f77 5b22 7573 6572  nt in [row["user
+00010a20: 6e61 6d65 225d 2066 6f72 2072 6f77 2069  name"] for row i
+00010a30: 6e20 726f 7374 6572 2e76 616c 7565 7328  n roster.values(
+00010a40: 295d 3a0a 2020 2020 2020 2020 746f 7461  )]:.        tota
+00010a50: 6c5f 7469 6d65 7370 656e 7420 3d20 300a  l_timespent = 0.
+00010a60: 2020 2020 2020 2020 666f 7220 7461 736b          for task
+00010a70: 6f62 6a20 696e 2070 736f 626a 5b22 7461  obj in psobj["ta
+00010a80: 736b 7322 5d3a 0a20 2020 2020 2020 2020  sks"]:.         
+00010a90: 2020 2074 6173 6b69 6420 3d20 7461 736b     taskid = task
+00010aa0: 6f62 6a5b 2269 6422 5d0a 2020 2020 2020  obj["id"].      
+00010ab0: 2020 2020 2020 7468 6973 5f74 6173 6b5f        this_task_
+00010ac0: 696e 6974 6961 6c5f 7469 6d65 7320 3d20  initial_times = 
+00010ad0: 696e 6974 6961 6c5f 7461 736b 5f74 696d  initial_task_tim
+00010ae0: 6573 2e67 6574 2874 6173 6b69 642c 207b  es.get(taskid, {
+00010af0: 7d29 0a20 2020 2020 2020 2020 2020 2074  }).            t
+00010b00: 6869 735f 7461 736b 5f72 6576 6973 696f  his_task_revisio
+00010b10: 6e5f 7469 6d65 7320 3d20 7265 7669 7369  n_times = revisi
+00010b20: 6f6e 5f74 6173 6b5f 7469 6d65 732e 6765  on_task_times.ge
+00010b30: 7428 7461 736b 6964 2c20 7b7d 290a 2020  t(taskid, {}).  
+00010b40: 2020 2020 2020 2020 2020 6966 2073 7475            if stu
+00010b50: 6465 6e74 2069 6e20 7468 6973 5f74 6173  dent in this_tas
+00010b60: 6b5f 696e 6974 6961 6c5f 7469 6d65 733a  k_initial_times:
+00010b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010b80: 2074 6f74 616c 5f74 696d 6573 7065 6e74   total_timespent
+00010b90: 202b 3d20 7468 6973 5f74 6173 6b5f 696e   += this_task_in
+00010ba0: 6974 6961 6c5f 7469 6d65 735b 7374 7564  itial_times[stud
+00010bb0: 656e 745d 0a20 2020 2020 2020 2020 2020  ent].           
+00010bc0: 2069 6620 7374 7564 656e 7420 696e 2074   if student in t
+00010bd0: 6869 735f 7461 736b 5f72 6576 6973 696f  his_task_revisio
+00010be0: 6e5f 7469 6d65 733a 0a20 2020 2020 2020  n_times:.       
+00010bf0: 2020 2020 2020 2020 2074 6f74 616c 5f74           total_t
+00010c00: 696d 6573 7065 6e74 202b 3d20 7468 6973  imespent += this
+00010c10: 5f74 6173 6b5f 7265 7669 7369 6f6e 5f74  _task_revision_t
+00010c20: 696d 6573 5b73 7475 6465 6e74 5d0a 2020  imes[student].  
+00010c30: 2020 2020 2020 6966 2074 6f74 616c 5f74        if total_t
+00010c40: 696d 6573 7065 6e74 203e 2030 3a0a 2020  imespent > 0:.  
+00010c50: 2020 2020 2020 2020 2020 746f 7461 6c5f            total_
+00010c60: 7469 6d65 7370 656e 745f 7661 6c75 6573  timespent_values
+00010c70: 2e61 7070 656e 6428 746f 7461 6c5f 7469  .append(total_ti
+00010c80: 6d65 7370 656e 7429 0a0a 2020 2020 6966  mespent)..    if
+00010c90: 206c 656e 2874 6f74 616c 5f74 696d 6573   len(total_times
+00010ca0: 7065 6e74 5f76 616c 7565 7329 203d 3d20  pent_values) == 
+00010cb0: 303a 0a20 2020 2020 2020 2061 7667 203d  0:.        avg =
+00010cc0: 2030 0a20 2020 2020 2020 206d 6564 203d   0.        med =
+00010cd0: 2030 0a20 2020 2020 2020 2071 7274 203d   0.        qrt =
+00010ce0: 2030 0a20 2020 2065 6c69 6620 6c65 6e28   0.    elif len(
+00010cf0: 746f 7461 6c5f 7469 6d65 7370 656e 745f  total_timespent_
+00010d00: 7661 6c75 6573 2920 3d3d 2031 3a0a 2020  values) == 1:.  
+00010d10: 2020 2020 2020 6176 6720 3d20 746f 7461        avg = tota
+00010d20: 6c5f 7469 6d65 7370 656e 745f 7661 6c75  l_timespent_valu
+00010d30: 6573 5b30 5d0a 2020 2020 2020 2020 6d65  es[0].        me
+00010d40: 6420 3d20 746f 7461 6c5f 7469 6d65 7370  d = total_timesp
+00010d50: 656e 745f 7661 6c75 6573 5b30 5d0a 2020  ent_values[0].  
+00010d60: 2020 2020 2020 7172 7420 3d20 746f 7461        qrt = tota
+00010d70: 6c5f 7469 6d65 7370 656e 745f 7661 6c75  l_timespent_valu
+00010d80: 6573 5b30 5d0a 2020 2020 656c 7365 3a0a  es[0].    else:.
+00010d90: 2020 2020 2020 2020 6176 6720 3d20 7375          avg = su
+00010da0: 6d28 746f 7461 6c5f 7469 6d65 7370 656e  m(total_timespen
+00010db0: 745f 7661 6c75 6573 2920 2f20 6c65 6e28  t_values) / len(
+00010dc0: 746f 7461 6c5f 7469 6d65 7370 656e 745f  total_timespent_
+00010dd0: 7661 6c75 6573 290a 2020 2020 2020 2020  values).        
+00010de0: 6d65 6420 3d20 7065 7263 656e 7469 6c65  med = percentile
+00010df0: 2874 6f74 616c 5f74 696d 6573 7065 6e74  (total_timespent
+00010e00: 5f76 616c 7565 732c 2035 3029 0a20 2020  _values, 50).   
+00010e10: 2020 2020 2071 7274 203d 2070 6572 6365       qrt = perce
+00010e20: 6e74 696c 6528 746f 7461 6c5f 7469 6d65  ntile(total_time
+00010e30: 7370 656e 745f 7661 6c75 6573 2c20 3735  spent_values, 75
+00010e40: 290a 0a20 2020 2061 6767 7265 6761 7465  )..    aggregate
+00010e50: 5f74 696d 6573 5b22 616c 6c22 5d5b 2261  _times["all"]["a
+00010e60: 7665 7261 6765 225d 203d 2061 7667 0a20  verage"] = avg. 
+00010e70: 2020 2061 6767 7265 6761 7465 5f74 696d     aggregate_tim
+00010e80: 6573 5b22 616c 6c22 5d5b 226d 6564 6961  es["all"]["media
+00010e90: 6e22 5d20 3d20 6d65 640a 2020 2020 6167  n"] = med.    ag
+00010ea0: 6772 6567 6174 655f 7469 6d65 735b 2261  gregate_times["a
+00010eb0: 6c6c 225d 5b22 3735 7468 225d 203d 2071  ll"]["75th"] = q
+00010ec0: 7274 0a0a 2020 2020 2320 4765 7420 7468  rt..    # Get th
+00010ed0: 6520 7374 7564 656e 7420 696e 666f 0a20  e student info. 
+00010ee0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00010ef0: 7374 7564 656e 745f 696e 666f 203d 2073  student_info = s
+00010f00: 746f 7261 6765 2e67 6574 5f73 7475 6465  torage.get_stude
+00010f10: 6e74 5f69 6e66 6f28 636f 7572 7365 2c20  nt_info(course, 
+00010f20: 7365 6d65 7374 6572 290a 2020 2020 6578  semester).    ex
+00010f30: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+00010f40: 7320 653a 0a20 2020 2020 2020 2066 6c61  s e:.        fla
+00010f50: 736b 2e66 6c61 7368 2873 7472 2865 2929  sk.flash(str(e))
+00010f60: 0a20 2020 2020 2020 2073 7475 6465 6e74  .        student
+00010f70: 5f69 6e66 6f20 3d20 4e6f 6e65 0a0a 2020  _info = None..  
+00010f80: 2020 7265 7475 726e 2066 6c61 736b 2e72    return flask.r
+00010f90: 656e 6465 725f 7465 6d70 6c61 7465 280a  ender_template(.
+00010fa0: 2020 2020 2020 2020 2767 7261 6465 7368          'gradesh
+00010fb0: 6565 742e 6a32 272c 0a20 2020 2020 2020  eet.j2',.       
+00010fc0: 2063 6f75 7273 655f 6e61 6d65 3d61 7070   course_name=app
+00010fd0: 2e63 6f6e 6669 672e 6765 7428 2243 4f55  .config.get("COU
+00010fe0: 5253 455f 4e41 4d45 5322 2c20 7b7d 292e  RSE_NAMES", {}).
+00010ff0: 6765 7428 636f 7572 7365 2c20 636f 7572  get(course, cour
+00011000: 7365 292c 0a20 2020 2020 2020 2063 6f75  se),.        cou
+00011010: 7273 653d 636f 7572 7365 2c0a 2020 2020  rse=course,.    
+00011020: 2020 2020 7365 6d65 7374 6572 3d73 656d      semester=sem
+00011030: 6573 7465 722c 0a20 2020 2020 2020 2075  ester,.        u
+00011040: 7365 726e 616d 653d 7573 6572 6e61 6d65  sername=username
+00011050: 2c0a 2020 2020 2020 2020 6973 5f61 646d  ,.        is_adm
+00011060: 696e 3d69 735f 6164 6d69 6e2c 0a20 2020  in=is_admin,.   
+00011070: 2020 2020 206d 6173 7175 6572 6164 655f       masquerade_
+00011080: 6173 3d6d 6173 7175 6572 6164 655f 6173  as=masquerade_as
+00011090: 2c0a 2020 2020 2020 2020 7461 736b 5f69  ,.        task_i
+000110a0: 6e66 6f3d 7461 736b 5f69 6e66 6f2c 0a20  nfo=task_info,. 
+000110b0: 2020 2020 2020 2070 733d 7073 2c0a 2020         ps=ps,.  
+000110c0: 2020 2020 2020 726f 7374 6572 3d72 6f77        roster=row
+000110d0: 732c 0a20 2020 2020 2020 2073 7475 6465  s,.        stude
+000110e0: 6e74 5f69 6e66 6f3d 7374 7564 656e 745f  nt_info=student_
+000110f0: 696e 666f 2c0a 2020 2020 2020 2020 6167  info,.        ag
+00011100: 6772 6567 6174 655f 7469 6d65 733d 6167  gregate_times=ag
+00011110: 6772 6567 6174 655f 7469 6d65 730a 2020  gregate_times.  
+00011120: 2020 290a 0a0a 4061 7070 2e72 6f75 7465    )...@app.route
+00011130: 2827 2f3c 636f 7572 7365 3e2f 3c73 656d  ('/<course>/<sem
+00011140: 6573 7465 723e 2f64 656c 6976 6572 272c  ester>/deliver',
+00011150: 206d 6574 686f 6473 3d5b 2747 4554 272c   methods=['GET',
+00011160: 2027 504f 5354 275d 290a 6465 6620 726f   'POST']).def ro
+00011170: 7574 655f 6465 6c69 7665 7228 636f 7572  ute_deliver(cour
+00011180: 7365 2c20 7365 6d65 7374 6572 293a 0a20  se, semester):. 
+00011190: 2020 2022 2222 0a20 2020 2054 6869 7320     """.    This 
+000111a0: 726f 7574 6520 6973 2061 6363 6573 7369  route is accessi
+000111b0: 626c 6520 6279 2061 6e79 6f6e 6520 7769  ble by anyone wi
+000111c0: 7468 6f75 7420 6c6f 6769 6e2c 2062 6563  thout login, bec
+000111d0: 6175 7365 2069 7420 6973 0a20 2020 2067  ause it is.    g
+000111e0: 6f69 6e67 2074 6f20 6265 2070 6f73 7465  oing to be poste
+000111f0: 6420 746f 2066 726f 6d20 5079 7468 6f6e  d to from Python
+00011200: 2073 6372 6970 7473 2028 7365 6520 7468   scripts (see th
+00011210: 6520 6070 6f74 6c75 636b 4465 6c69 7665  e `potluckDelive
+00011220: 7279 600a 2020 2020 6d6f 6475 6c65 292e  ry`.    module).
+00011230: 2057 6520 7769 6c6c 206f 6e6c 7920 6163   We will only ac
+00011240: 6365 7074 2073 7562 6d69 7373 696f 6e73  cept submissions
+00011250: 2066 726f 6d20 7573 6572 7320 6f6e 2074   from users on t
+00011260: 6865 2072 6f73 7465 720a 2020 2020 666f  he roster.    fo
+00011270: 7220 7468 6520 7370 6563 6966 6965 6420  r the specified 
+00011280: 636f 7572 7365 2f73 656d 6573 7465 722c  course/semester,
+00011290: 2061 6c74 686f 7567 6820 6265 6361 7573   although becaus
+000112a0: 6520 7468 6572 6527 7320 6e6f 0a20 2020  e there's no.   
+000112b0: 2076 6572 6966 6963 6174 696f 6e20 6f66   verification of
+000112c0: 2075 7365 7220 4944 732c 2061 6e79 6f6e   user IDs, anyon
+000112d0: 6520 636f 756c 6420 6265 2073 656e 6469  e could be sendi
+000112e0: 6e67 2073 7562 6d69 7373 696f 6e73 2028  ng submissions (
+000112f0: 544f 444f 3a0a 2020 2020 4669 7820 7468  TODO:.    Fix th
+00011300: 6174 2075 7369 6e67 2074 6f6b 656e 2d62  at using token-b
+00011310: 6173 6564 2076 6572 6966 6963 6174 696f  ased verificatio
+00011320: 6e21 292e 2041 6c73 6f2c 2073 7562 6d69  n!). Also, submi
+00011330: 7373 696f 6e73 206d 6179 0a20 2020 2069  ssions may.    i
+00011340: 6e63 6c75 6465 206d 756c 7469 706c 6520  nclude multiple 
+00011350: 6175 7468 6f72 7320 2865 2e67 2e20 7768  authors (e.g. wh
+00011360: 656e 2070 6169 7220 7072 6f67 7261 6d6d  en pair programm
+00011370: 696e 6729 2e0a 0a20 2020 2053 7562 6d69  ing)...    Submi
+00011380: 7474 6564 2066 6f72 6d20 6461 7461 2073  tted form data s
+00011390: 686f 756c 6420 6861 7665 2074 6865 2066  hould have the f
+000113a0: 6f6c 6c6f 7769 6e67 2073 6c6f 7473 2c20  ollowing slots, 
+000113b0: 7769 7468 2061 6c6c 0a20 2020 2073 7472  with all.    str
+000113c0: 696e 6773 2065 6e63 6f64 6564 2075 7369  ings encoded usi
+000113d0: 6e67 2075 7466 2d38 3a0a 0a20 2020 202d  ng utf-8:..    -
+000113e0: 2027 6578 6572 6369 7365 273a 2054 6865   'exercise': The
+000113f0: 2049 4420 6f66 2074 6865 2065 7865 7263   ID of the exerc
+00011400: 6973 6520 6265 696e 6720 7375 626d 6974  ise being submit
+00011410: 7465 642e 0a20 2020 202d 2027 6175 7468  ted..    - 'auth
+00011420: 6f72 7327 3a20 4120 4a53 4f4e 2d65 6e63  ors': A JSON-enc
+00011430: 6f64 6564 206c 6973 7420 6f66 2075 7365  oded list of use
+00011440: 726e 616d 6573 2074 6861 7420 7468 6520  rnames that the 
+00011450: 7375 626d 6973 7369 6f6e 0a20 2020 2020  submission.     
+00011460: 2020 2073 686f 756c 6420 6265 2061 7373     should be ass
+00011470: 6967 6e65 6420 746f 2e0a 2020 2020 2d20  igned to..    - 
+00011480: 276f 7574 636f 6d65 7327 3a20 4120 4a53  'outcomes': A JS
+00011490: 4f4e 2d65 6e63 6f64 6564 206c 6973 7420  ON-encoded list 
+000114a0: 6f66 2060 6f70 7469 6d69 736d 6020 6f75  of `optimism` ou
+000114b0: 7463 6f6d 652d 7472 6970 6c65 732c 0a20  tcome-triples,. 
+000114c0: 2020 2020 2020 2065 6163 6820 636f 6e74         each cont
+000114d0: 6169 6e69 6e67 2061 2062 6f6f 6c65 616e  aining a boolean
+000114e0: 2069 6e64 6963 6174 696e 6720 7375 6363   indicating succ
+000114f0: 6573 732f 6661 696c 7572 652c 2066 6f6c  ess/failure, fol
+00011500: 6c6f 7765 640a 2020 2020 2020 2020 6279  lowed.        by
+00011510: 2061 2074 6167 2073 7472 696e 6720 696e   a tag string in
+00011520: 6469 6361 7469 6e67 2074 6865 2066 696c  dicating the fil
+00011530: 6520 2b20 6c69 6e65 206e 756d 6265 7220  e + line number 
+00011540: 6f66 2074 6865 2063 6865 636b 0a20 2020  of the check.   
+00011550: 2020 2020 2061 6e64 2061 2073 6563 6f6e       and a secon
+00011560: 6420 7374 7269 6e67 2077 6974 6820 7468  d string with th
+00011570: 6520 6d65 7373 6167 6520 6465 7363 7269  e message descri
+00011580: 6269 6e67 2074 6865 206f 7574 636f 6d65  bing the outcome
+00011590: 206f 660a 2020 2020 2020 2020 7468 6520   of.        the 
+000115a0: 6368 6563 6b2e 0a20 2020 202d 2027 636f  check..    - 'co
+000115b0: 6465 273a 2041 204a 534f 4e2d 656e 636f  de': A JSON-enco
+000115c0: 6465 6420 6c69 7374 206f 6620 322d 656c  ded list of 2-el
+000115d0: 656d 656e 7420 6c69 7374 732c 2065 6163  ement lists, eac
+000115e0: 6820 6f66 2077 6869 6368 2068 6173 0a20  h of which has. 
+000115f0: 2020 2020 2020 2061 2066 696c 656e 616d         a filenam
+00011600: 6520 286f 7220 6f74 6865 7220 636f 6465  e (or other code
+00011610: 2d73 6f75 7263 652d 6964 656e 7469 6679  -source-identify
+00011620: 696e 672d 7374 7269 6e67 2920 616e 6420  ing-string) and 
+00011630: 6120 636f 6465 0a20 2020 2020 2020 2062  a code.        b
+00011640: 6c6f 636b 2028 6173 2061 2073 7472 696e  lock (as a strin
+00011650: 6729 2e0a 0a20 2020 2049 6620 736f 6d65  g)...    If some
+00011660: 206f 6620 7468 6520 6461 7461 2069 736e   of the data isn
+00011670: 2774 2069 6e20 7468 6520 666f 726d 6174  't in the format
+00011680: 7320 7370 6563 6966 6965 6420 6162 6f76  s specified abov
+00011690: 652c 2061 2034 3030 2065 7272 6f72 0a20  e, a 400 error. 
+000116a0: 2020 2077 696c 6c20 6265 2072 6574 7572     will be retur
+000116b0: 6e65 6420 7769 7468 2061 2073 7472 696e  ned with a strin
+000116c0: 6720 6465 7363 7269 6269 6e67 2077 6861  g describing wha
+000116d0: 7427 7320 7772 6f6e 672e 0a20 2020 2022  t's wrong..    "
+000116e0: 2222 0a20 2020 2023 2054 6865 2070 6f74  "".    # The pot
+000116f0: 6c75 636b 4465 6c69 7665 7279 2073 6372  luckDelivery scr
+00011700: 6970 7420 7072 696e 7473 2074 6865 2064  ipt prints the d
+00011710: 656c 6976 6572 7920 5552 4c2c 2077 6869  elivery URL, whi
+00011720: 6368 206d 6179 2062 650a 2020 2020 2320  ch may be.    # 
+00011730: 7374 796c 6564 2061 7320 6120 6c69 6e6b  styled as a link
+00011740: 2e20 536f 2077 6520 7265 6469 7265 6374  . So we redirect
+00011750: 2061 6e79 6f6e 6520 6163 6365 7373 696e   anyone accessin
+00011760: 6720 7468 6973 2072 6f75 7465 2077 6974  g this route wit
+00011770: 680a 2020 2020 2320 6120 4745 5420 6d65  h.    # a GET me
+00011780: 7468 6f64 2074 6f20 7468 6520 6461 7368  thod to the dash
+00011790: 626f 6172 642e 0a20 2020 2069 6620 666c  board..    if fl
+000117a0: 6173 6b2e 7265 7175 6573 742e 6d65 7468  ask.request.meth
+000117b0: 6f64 203d 3d20 2247 4554 223a 0a20 2020  od == "GET":.   
+000117c0: 2020 2020 2072 6574 7572 6e20 666c 6173       return flas
+000117d0: 6b2e 7265 6469 7265 6374 280a 2020 2020  k.redirect(.    
+000117e0: 2020 2020 2020 2020 666c 6173 6b2e 7572          flask.ur
+000117f0: 6c5f 666f 7228 2772 6f75 7465 5f64 6173  l_for('route_das
+00011800: 6827 2c20 636f 7572 7365 3d63 6f75 7273  h', course=cours
+00011810: 652c 2073 656d 6573 7465 723d 7365 6d65  e, semester=seme
+00011820: 7374 6572 290a 2020 2020 2020 2020 290a  ster).        ).
+00011830: 0a20 2020 2023 2050 726f 6365 7373 2050  .    # Process P
+00011840: 4f53 5420 696e 666f 2e2e 2e0a 2020 2020  OST info....    
+00011850: 666f 726d 203d 2066 6c61 736b 2e72 6571  form = flask.req
+00011860: 7565 7374 2e66 6f72 6d0a 0a20 2020 2023  uest.form..    #
+00011870: 2047 6574 2065 7865 7263 6973 6520 4944   Get exercise ID
+00011880: 0a20 2020 2065 7865 7263 6973 6520 3d20  .    exercise = 
+00011890: 666f 726d 2e67 6574 2822 6578 6572 6369  form.get("exerci
+000118a0: 7365 222c 2022 2229 0a20 2020 2069 6620  se", "").    if 
+000118b0: 6578 6572 6369 7365 203d 3d20 2222 3a0a  exercise == "":.
+000118c0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+000118d0: 2244 656c 6976 6572 7920 6469 6420 6e6f  "Delivery did no
+000118e0: 7420 7370 6563 6966 7920 616e 2065 7865  t specify an exe
+000118f0: 7263 6973 652e 222c 2034 3030 290a 0a20  rcise.", 400).. 
+00011900: 2020 2023 2047 6574 2061 7574 686f 7273     # Get authors
+00011910: 206c 6973 742c 2064 6563 6f64 6520 7468   list, decode th
+00011920: 6520 4a53 4f4e 2c20 616e 6420 656e 7375  e JSON, and ensu
+00011930: 7265 2069 7427 7320 6120 6c69 7374 206f  re it's a list o
+00011940: 660a 2020 2020 2320 7374 7269 6e67 732e  f.    # strings.
+00011950: 0a20 2020 2061 7574 686f 7273 5374 7269  .    authorsStri
+00011960: 6e67 203d 2066 6f72 6d2e 6765 7428 2261  ng = form.get("a
+00011970: 7574 686f 7273 222c 2022 2229 0a20 2020  uthors", "").   
+00011980: 2069 6620 6175 7468 6f72 7353 7472 696e   if authorsStrin
+00011990: 6720 3d3d 2022 223a 0a20 2020 2020 2020  g == "":.       
+000119a0: 2072 6574 7572 6e20 2822 4465 6c69 7665   return ("Delive
+000119b0: 7279 2064 6964 206e 6f74 2073 7065 6369  ry did not speci
+000119c0: 6679 2061 7574 686f 7273 2e22 2c20 3430  fy authors.", 40
+000119d0: 3029 0a0a 2020 2020 7472 793a 0a20 2020  0)..    try:.   
+000119e0: 2020 2020 2061 7574 686f 7273 203d 206a       authors = j
+000119f0: 736f 6e2e 6c6f 6164 7328 6175 7468 6f72  son.loads(author
+00011a00: 7353 7472 696e 6729 0a20 2020 2065 7863  sString).    exc
+00011a10: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00011a20: 2020 2020 2020 2072 6574 7572 6e20 2822         return ("
+00011a30: 5370 6563 6966 6965 6420 6175 7468 6f72  Specified author
+00011a40: 7320 6c69 7374 2077 6173 206e 6f74 2076  s list was not v
+00011a50: 616c 6964 204a 534f 4e2e 222c 2034 3030  alid JSON.", 400
+00011a60: 290a 0a20 2020 2069 6620 280a 2020 2020  )..    if (.    
+00011a70: 2020 2020 6e6f 7420 6973 696e 7374 616e      not isinstan
+00011a80: 6365 2861 7574 686f 7273 2c20 6c69 7374  ce(authors, list
+00011a90: 290a 2020 2020 206f 7220 616e 7928 6e6f  ).     or any(no
+00011aa0: 7420 6973 696e 7374 616e 6365 2861 7574  t isinstance(aut
+00011ab0: 686f 722c 2061 6e79 7374 7229 2066 6f72  hor, anystr) for
+00011ac0: 2061 7574 686f 7220 696e 2061 7574 686f   author in autho
+00011ad0: 7273 290a 2020 2020 293a 0a20 2020 2020  rs).    ):.     
+00011ae0: 2020 2072 6574 7572 6e20 2822 5370 6563     return ("Spec
+00011af0: 6966 6965 6420 6175 7468 6f72 7320 6c69  ified authors li
+00011b00: 7374 2077 6173 206e 6f74 2061 206c 6973  st was not a lis
+00011b10: 7420 6f66 2073 7472 696e 6773 2e22 2c20  t of strings.", 
+00011b20: 3430 3029 0a0a 2020 2020 2320 4765 7420  400)..    # Get 
+00011b30: 6f75 7463 6f6d 6573 206c 6973 742c 2064  outcomes list, d
+00011b40: 6563 6f64 6520 7468 6520 4a53 4f4e 2c20  ecode the JSON, 
+00011b50: 616e 6420 656e 7375 7265 2069 7427 7320  and ensure it's 
+00011b60: 6120 6c69 7374 206f 660a 2020 2020 2320  a list of.    # 
+00011b70: 332d 656c 656d 656e 7420 6c69 7374 7320  3-element lists 
+00011b80: 6561 6368 2063 6f6e 7461 696e 696e 6720  each containing 
+00011b90: 6120 626f 6f6c 6561 6e20 616e 6420 7477  a boolean and tw
+00011ba0: 6f20 7374 7269 6e67 732e 0a20 2020 2023  o strings..    #
+00011bb0: 2041 6e20 656d 7074 7920 6c69 7374 206f   An empty list o
+00011bc0: 6620 6f75 7463 6f6d 6573 2069 7320 6e6f  f outcomes is no
+00011bd0: 7420 616c 6c6f 7765 642e 0a20 2020 206f  t allowed..    o
+00011be0: 7574 636f 6d65 7353 7472 696e 6720 3d20  utcomesString = 
+00011bf0: 666f 726d 2e67 6574 2822 6f75 7463 6f6d  form.get("outcom
+00011c00: 6573 222c 2022 2229 0a20 2020 2069 6620  es", "").    if 
+00011c10: 6f75 7463 6f6d 6573 5374 7269 6e67 203d  outcomesString =
+00011c20: 3d20 2222 3a0a 2020 2020 2020 2020 7265  = "":.        re
+00011c30: 7475 726e 2028 2244 656c 6976 6572 7920  turn ("Delivery 
+00011c40: 6469 6420 6e6f 7420 7370 6563 6966 7920  did not specify 
+00011c50: 616e 7920 6f75 7463 6f6d 6573 2e22 2c20  any outcomes.", 
+00011c60: 3430 3029 0a0a 2020 2020 7472 793a 0a20  400)..    try:. 
+00011c70: 2020 2020 2020 206f 7574 636f 6d65 7320         outcomes 
+00011c80: 3d20 6a73 6f6e 2e6c 6f61 6473 286f 7574  = json.loads(out
+00011c90: 636f 6d65 7353 7472 696e 6729 0a20 2020  comesString).   
+00011ca0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00011cb0: 6e3a 0a20 2020 2020 2020 2072 6574 7572  n:.        retur
+00011cc0: 6e20 2822 5370 6563 6966 6965 6420 6f75  n ("Specified ou
+00011cd0: 7463 6f6d 6573 206c 6973 7420 7761 7320  tcomes list was 
+00011ce0: 6e6f 7420 7661 6c69 6420 4a53 4f4e 2e22  not valid JSON."
+00011cf0: 2c20 3430 3029 0a0a 2020 2020 6966 206e  , 400)..    if n
+00011d00: 6f74 2069 7369 6e73 7461 6e63 6528 6f75  ot isinstance(ou
+00011d10: 7463 6f6d 6573 2c20 6c69 7374 293a 0a20  tcomes, list):. 
+00011d20: 2020 2020 2020 2072 6574 7572 6e20 2822         return ("
+00011d30: 4f75 7463 6f6d 6573 206f 626a 6563 7420  Outcomes object 
+00011d40: 7761 7320 6e6f 7420 6120 6c69 7374 2e22  was not a list."
+00011d50: 2c20 3430 3029 0a0a 2020 2020 666f 7220  , 400)..    for 
+00011d60: 692c 206f 7574 636f 6d65 2069 6e20 656e  i, outcome in en
+00011d70: 756d 6572 6174 6528 6f75 7463 6f6d 6573  umerate(outcomes
+00011d80: 293a 0a20 2020 2020 2020 2069 6620 280a  ):.        if (.
+00011d90: 2020 2020 2020 2020 2020 2020 6e6f 7420              not 
+00011da0: 6973 696e 7374 616e 6365 286f 7574 636f  isinstance(outco
+00011db0: 6d65 2c20 6c69 7374 290a 2020 2020 2020  me, list).      
+00011dc0: 2020 206f 7220 6c65 6e28 6f75 7463 6f6d     or len(outcom
+00011dd0: 6529 2021 3d20 330a 2020 2020 2020 2020  e) != 3.        
+00011de0: 206f 7220 6e6f 7420 6973 696e 7374 616e   or not isinstan
+00011df0: 6365 286f 7574 636f 6d65 5b30 5d2c 2062  ce(outcome[0], b
+00011e00: 6f6f 6c29 0a20 2020 2020 2020 2020 6f72  ool).         or
+00011e10: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00011e20: 6f75 7463 6f6d 655b 315d 2c20 616e 7973  outcome[1], anys
+00011e30: 7472 290a 2020 2020 2020 2020 206f 7220  tr).         or 
+00011e40: 6e6f 7420 6973 696e 7374 616e 6365 286f  not isinstance(o
+00011e50: 7574 636f 6d65 5b32 5d2c 2061 6e79 7374  utcome[2], anyst
+00011e60: 7229 0a20 2020 2020 2020 2029 3a0a 2020  r).        ):.  
+00011e70: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00011e80: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00011e90: 2020 2022 4f75 7463 6f6d 6520 7b7d 2077     "Outcome {} w
+00011ea0: 6173 2069 6e76 616c 6964 2028 6561 6368  as invalid (each
+00011eb0: 206f 7574 636f 6d65 206d 7573 7420 6265   outcome must be
+00011ec0: 2061 206c 6973 7422 0a20 2020 2020 2020   a list".       
+00011ed0: 2020 2020 2020 2020 2022 2063 6f6e 7461           " conta
+00011ee0: 696e 696e 6720 6120 626f 6f6c 6561 6e20  ining a boolean 
+00011ef0: 616e 6420 7477 6f20 7374 7269 6e67 7329  and two strings)
+00011f00: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
+00011f10: 2e66 6f72 6d61 7428 6929 0a0a 2020 2020  .format(i)..    
+00011f20: 2320 4765 7420 636f 6465 2062 6c6f 636b  # Get code block
+00011f30: 732c 2064 6563 6f64 6520 4a53 4f4e 2c20  s, decode JSON, 
+00011f40: 616e 6420 656e 7375 7265 2069 7427 7320  and ensure it's 
+00011f50: 6120 6c69 7374 206f 6620 7061 6972 7320  a list of pairs 
+00011f60: 6f66 0a20 2020 2023 2073 7472 696e 6773  of.    # strings
+00011f70: 2e20 4974 202a 6973 2a20 616c 6c6f 7765  . It *is* allowe
+00011f80: 6420 746f 2062 6520 616e 2065 6d70 7479  d to be an empty
+00011f90: 206c 6973 742e 0a20 2020 2063 6f64 6553   list..    codeS
+00011fa0: 7472 696e 6720 3d20 666f 726d 2e67 6574  tring = form.get
+00011fb0: 2822 636f 6465 222c 2022 2229 0a20 2020  ("code", "").   
+00011fc0: 2069 6620 636f 6465 5374 7269 6e67 203d   if codeString =
+00011fd0: 3d20 2222 3a0a 2020 2020 2020 2020 7265  = "":.        re
+00011fe0: 7475 726e 2028 2244 656c 6976 6572 7920  turn ("Delivery 
+00011ff0: 6469 6420 6e6f 7420 7370 6563 6966 7920  did not specify 
+00012000: 616e 7920 636f 6465 2e22 2c20 3430 3029  any code.", 400)
+00012010: 0a0a 2020 2020 7472 793a 0a20 2020 2020  ..    try:.     
+00012020: 2020 2063 6f64 6542 6c6f 636b 7320 3d20     codeBlocks = 
+00012030: 6a73 6f6e 2e6c 6f61 6473 2863 6f64 6553  json.loads(codeS
+00012040: 7472 696e 6729 0a20 2020 2065 7863 6570  tring).    excep
+00012050: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
+00012060: 2020 2020 2072 6574 7572 6e20 2822 5370       return ("Sp
+00012070: 6563 6966 6965 6420 636f 6465 206c 6973  ecified code lis
+00012080: 7420 7761 7320 6e6f 7420 7661 6c69 6420  t was not valid 
+00012090: 4a53 4f4e 2e22 2c20 3430 3029 0a0a 2020  JSON.", 400)..  
+000120a0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+000120b0: 6e63 6528 636f 6465 426c 6f63 6b73 2c20  nce(codeBlocks, 
+000120c0: 6c69 7374 293a 0a20 2020 2020 2020 2072  list):.        r
+000120d0: 6574 7572 6e20 2822 436f 6465 206f 626a  eturn ("Code obj
+000120e0: 6563 7420 7761 7320 6e6f 7420 6120 6c69  ect was not a li
+000120f0: 7374 2e22 2c20 3430 3029 0a0a 2020 2020  st.", 400)..    
+00012100: 666f 7220 692c 2062 6c6f 636b 2069 6e20  for i, block in 
+00012110: 656e 756d 6572 6174 6528 636f 6465 426c  enumerate(codeBl
+00012120: 6f63 6b73 293a 0a20 2020 2020 2020 2069  ocks):.        i
+00012130: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+00012140: 6e6f 7420 6973 696e 7374 616e 6365 2862  not isinstance(b
+00012150: 6c6f 636b 2c20 6c69 7374 290a 2020 2020  lock, list).    
+00012160: 2020 2020 206f 7220 6c65 6e28 626c 6f63       or len(bloc
+00012170: 6b29 2021 3d20 320a 2020 2020 2020 2020  k) != 2.        
+00012180: 206f 7220 6e6f 7420 616c 6c28 6973 696e   or not all(isin
+00012190: 7374 616e 6365 2870 6172 742c 2061 6e79  stance(part, any
+000121a0: 7374 7229 2066 6f72 2070 6172 7420 696e  str) for part in
+000121b0: 2062 6c6f 636b 290a 2020 2020 2020 2020   block).        
+000121c0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+000121d0: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+000121e0: 2020 2020 2020 2020 2243 6f64 6520 626c          "Code bl
+000121f0: 6f63 6b20 7b7d 2077 6173 2069 6e76 616c  ock {} was inval
+00012200: 6964 2028 6561 6368 2063 6f64 6520 626c  id (each code bl
+00012210: 6f63 6b20 6d75 7374 2062 6520 6122 0a20  ock must be a". 
+00012220: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00012230: 206c 6973 7420 636f 6e74 6169 6e69 6e67   list containing
+00012240: 2074 776f 2073 7472 696e 6773 292e 220a   two strings).".
+00012250: 2020 2020 2020 2020 2020 2020 292e 666f              ).fo
+00012260: 726d 6174 2869 290a 0a20 2020 2023 2043  rmat(i)..    # C
+00012270: 6865 636b 2061 7574 686f 7273 2061 6761  heck authors aga
+00012280: 696e 7374 2072 6f73 7465 720a 2020 2020  inst roster.    
+00012290: 7472 793a 0a20 2020 2020 2020 2072 6f73  try:.        ros
+000122a0: 7465 7220 3d20 7374 6f72 6167 652e 6765  ter = storage.ge
+000122b0: 745f 726f 7374 6572 2863 6f75 7273 652c  t_roster(course,
+000122c0: 2073 656d 6573 7465 7229 0a20 2020 2065   semester).    e
+000122d0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+000122e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000122f0: 280a 2020 2020 2020 2020 2020 2020 280a  (.            (.
+00012300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012310: 2243 6f75 6c64 206e 6f74 2066 6574 6368  "Could not fetch
+00012320: 2072 6f73 7465 7220 666f 7220 636f 7572   roster for cour
+00012330: 7365 207b 7d20 7b7d 2e22 0a20 2020 2020  se {} {}.".     
+00012340: 2020 2020 2020 2029 2e66 6f72 6d61 7428         ).format(
+00012350: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
+00012360: 292c 0a20 2020 2020 2020 2020 2020 2034  ),.            4
+00012370: 3030 0a20 2020 2020 2020 2029 0a0a 2020  00.        )..  
+00012380: 2020 6966 2072 6f73 7465 7220 6973 204e    if roster is N
+00012390: 6f6e 653a 0a20 2020 2020 2020 2072 6574  one:.        ret
+000123a0: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
+000123b0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+000123c0: 2020 2020 2254 6865 7265 2069 7320 6e6f      "There is no
+000123d0: 2072 6f73 7465 7220 666f 7220 636f 7572   roster for cour
+000123e0: 7365 207b 7d20 7b7d 2e22 0a20 2020 2020  se {} {}.".     
+000123f0: 2020 2020 2020 2029 2e66 6f72 6d61 7428         ).format(
+00012400: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
+00012410: 292c 0a20 2020 2020 2020 2020 2020 2034  ),.            4
+00012420: 3030 0a20 2020 2020 2020 2029 0a0a 2020  00.        )..  
+00012430: 2020 666f 7220 6175 7468 6f72 2069 6e20    for author in 
+00012440: 6175 7468 6f72 733a 0a20 2020 2020 2020  authors:.       
+00012450: 2069 6620 6175 7468 6f72 206e 6f74 2069   if author not i
+00012460: 6e20 726f 7374 6572 3a0a 2020 2020 2020  n roster:.      
+00012470: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
+00012480: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00012490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000124a0: 2020 2020 2022 4175 7468 6f72 2027 7b7d       "Author '{}
+000124b0: 2720 6973 206e 6f74 206f 6e20 7468 6520  ' is not on the 
+000124c0: 726f 7374 6572 2066 6f72 207b 7d20 7b7d  roster for {} {}
+000124d0: 2e20 596f 7522 0a20 2020 2020 2020 2020  . You".         
+000124e0: 2020 2020 2020 2020 2020 2022 206d 7573             " mus
+000124f0: 7420 7573 6520 796f 7572 2075 7365 726e  t use your usern
+00012500: 616d 6520 7768 656e 2073 7065 6369 6679  ame when specify
+00012510: 696e 6720 616e 2061 7574 686f 722e 220a  ing an author.".
+00012520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012530: 292e 666f 726d 6174 2861 7574 686f 722c  ).format(author,
+00012540: 2063 6f75 7273 652c 2073 656d 6573 7465   course, semeste
+00012550: 7229 2c0a 2020 2020 2020 2020 2020 2020  r),.            
+00012560: 2020 2020 3430 300a 2020 2020 2020 2020      400.        
+00012570: 2020 2020 290a 0a20 2020 2023 2047 7261      )..    # Gra
+00012580: 6220 7461 736b 2069 6e66 6f20 616e 6420  b task info and 
+00012590: 616d 656e 6420 6974 206a 7573 7420 746f  amend it just to
+000125a0: 2064 6574 6572 6d69 6e65 2065 6772 6f75   determine egrou
+000125b0: 7020 7068 6173 6573 0a20 2020 2074 6173  p phases.    tas
+000125c0: 6b5f 696e 666f 203d 2073 746f 7261 6765  k_info = storage
+000125d0: 2e67 6574 5f74 6173 6b5f 696e 666f 2863  .get_task_info(c
+000125e0: 6f75 7273 652c 2073 656d 6573 7465 7229  ourse, semester)
+000125f0: 0a0a 2020 2020 2320 5265 636f 7264 2074  ..    # Record t
+00012600: 6865 206f 7574 636f 6d65 7320 6c69 7374  he outcomes list
+00012610: 2066 6f72 2065 6163 6820 6175 7468 6f72   for each author
+00012620: 2028 6578 7465 6e73 696f 6e73 206d 6967   (extensions mig
+00012630: 6874 2062 650a 2020 2020 2320 6469 6666  ht be.    # diff
+00012640: 6572 656e 7420 736f 2063 7265 6469 7420  erent so credit 
+00012650: 6d69 6768 7420 6469 6666 6572 2070 6572  might differ per
+00012660: 2061 7574 686f 7229 0a20 2020 2073 6861   author).    sha
+00012670: 7265 645f 7374 6174 7573 203d 204e 6f6e  red_status = Non
+00012680: 650a 2020 2020 7374 6174 7573 6573 203d  e.    statuses =
+00012690: 207b 7d0a 2020 2020 666f 7220 6175 7468   {}.    for auth
+000126a0: 6f72 2069 6e20 6175 7468 6f72 733a 0a0a  or in authors:..
+000126b0: 2020 2020 2020 2020 2320 4765 7420 6578          # Get ex
+000126c0: 6572 6369 7365 2069 6e66 6f20 736f 2077  ercise info so w
+000126d0: 6520 6361 6e20 6163 7475 616c 6c79 2066  e can actually f
+000126e0: 6967 7572 6520 6f75 7420 7768 6174 2074  igure out what t
+000126f0: 6865 0a20 2020 2020 2020 2023 2065 7661  he.        # eva
+00012700: 6c75 6174 696f 6e20 776f 756c 6420 6265  luation would be
+00012710: 2066 6f72 2074 6865 7365 206f 7574 636f   for these outco
+00012720: 6d65 732e 0a20 2020 2020 2020 2069 6620  mes..        if 
+00012730: 7461 736b 5f69 6e66 6f20 6973 204e 6f6e  task_info is Non
+00012740: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00012750: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+00012760: 2020 2020 2020 2020 2246 6169 6c65 6420          "Failed 
+00012770: 746f 206c 6f61 6420 7461 736b 732e 6a73  to load tasks.js
+00012780: 6f6e 2066 6f72 207b 7d20 7b7d 2e22 2e66  on for {} {}.".f
+00012790: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
+000127a0: 2020 2020 2020 2020 2020 2063 6f75 7273             cours
+000127b0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+000127c0: 2020 2020 2020 2073 656d 6573 7465 720a         semester.
+000127d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127e0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+000127f0: 2020 2034 3030 0a20 2020 2020 2020 2020     400.         
+00012800: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00012810: 5065 722d 6175 7468 6f72 2070 6861 7365  Per-author phase
+00012820: 2f65 7874 656e 7369 6f6e 2069 6e66 6f0a  /extension info.
+00012830: 2020 2020 2020 2020 7468 6973 5f61 7574          this_aut
+00012840: 686f 725f 7461 736b 5f69 6e66 6f20 3d20  hor_task_info = 
+00012850: 636f 7079 2e64 6565 7063 6f70 7928 7461  copy.deepcopy(ta
+00012860: 736b 5f69 6e66 6f29 0a20 2020 2020 2020  sk_info).       
+00012870: 2061 6d65 6e64 5f65 7865 7263 6973 6573   amend_exercises
+00012880: 2863 6f75 7273 652c 2073 656d 6573 7465  (course, semeste
+00012890: 722c 2074 6869 735f 6175 7468 6f72 5f74  r, this_author_t
+000128a0: 6173 6b5f 696e 666f 2c20 7b7d 2c20 6175  ask_info, {}, au
+000128b0: 7468 6f72 290a 0a20 2020 2020 2020 2065  thor)..        e
+000128c0: 696e 666f 203d 204e 6f6e 650a 2020 2020  info = None.    
+000128d0: 2020 2020 7068 6173 6520 3d20 4e6f 6e65      phase = None
+000128e0: 0a20 2020 2020 2020 2066 6f72 2067 726f  .        for gro
+000128f0: 7570 2069 6e20 7468 6973 5f61 7574 686f  up in this_autho
+00012900: 725f 7461 736b 5f69 6e66 6f2e 6765 7428  r_task_info.get(
+00012910: 2265 7865 7263 6973 6573 222c 205b 5d29  "exercises", [])
+00012920: 3a0a 2020 2020 2020 2020 2020 2020 656c  :.            el
+00012930: 6973 7420 3d20 6772 6f75 705b 2265 7865  ist = group["exe
+00012940: 7263 6973 6573 225d 0a0a 2020 2020 2020  rcises"]..      
+00012950: 2020 2020 2020 2320 4d61 6b65 2061 6c6c        # Make all
+00012960: 6f77 616e 6365 7320 666f 7220 6f6c 6420  owances for old 
+00012970: 666f 726d 6174 0a20 2020 2020 2020 2020  format.         
+00012980: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00012990: 2865 6c69 7374 2c20 6469 6374 293a 0a20  (elist, dict):. 
+000129a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000129b0: 6f72 2065 6964 2069 6e20 656c 6973 743a  or eid in elist:
+000129c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000129d0: 2020 2020 2065 6c69 7374 5b65 6964 5d5b       elist[eid][
+000129e0: 2769 6427 5d20 3d20 6569 640a 2020 2020  'id'] = eid.    
+000129f0: 2020 2020 2020 2020 2020 2020 656c 6973              elis
+00012a00: 7420 3d20 6c69 7374 2865 6c69 7374 2e76  t = list(elist.v
+00012a10: 616c 7565 7328 2929 0a0a 2020 2020 2020  alues())..      
+00012a20: 2020 2020 2020 666f 7220 6578 2069 6e20        for ex in 
+00012a30: 656c 6973 743a 0a20 2020 2020 2020 2020  elist:.         
+00012a40: 2020 2020 2020 2069 6620 6578 6572 6369         if exerci
+00012a50: 7365 203d 3d20 6578 5b27 6964 275d 3a0a  se == ex['id']:.
+00012a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a70: 2020 2020 6569 6e66 6f20 3d20 6578 0a20      einfo = ex. 
+00012a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a90: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00012aa0: 2020 2020 2069 6620 6569 6e66 6f20 6973       if einfo is
+00012ab0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00012ac0: 2020 2020 2020 2020 2020 2070 6861 7365             phase
+00012ad0: 203d 2067 726f 7570 5b22 7068 6173 6522   = group["phase"
+00012ae0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00012af0: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
+00012b00: 2069 6620 6569 6e66 6f20 6973 204e 6f6e   if einfo is Non
+00012b10: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00012b20: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+00012b30: 2020 2020 2020 2020 2245 7865 7263 6973          "Exercis
+00012b40: 6520 277b 7d27 2069 7320 6e6f 7420 6c69  e '{}' is not li
+00012b50: 7374 6564 2069 6e20 7b7d 207b 7d2e 222e  sted in {} {}.".
+00012b60: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
+00012b70: 2020 2020 2020 2020 2020 2020 6578 6572              exer
+00012b80: 6369 7365 2c0a 2020 2020 2020 2020 2020  cise,.          
+00012b90: 2020 2020 2020 2020 2020 636f 7572 7365            course
+00012ba0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012bb0: 2020 2020 2020 7365 6d65 7374 6572 0a20        semester. 
+00012bc0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00012bd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012be0: 2020 3430 300a 2020 2020 2020 2020 2020    400.          
+00012bf0: 2020 290a 0a20 2020 2020 2020 206f 6e5f    )..        on_
+00012c00: 7469 6d65 203d 2070 6861 7365 2021 3d20  time = phase != 
+00012c10: 2264 7565 220a 2020 2020 2020 2020 7374  "due".        st
+00012c20: 6174 7573 2c20 6563 7265 6469 742c 2067  atus, ecredit, g
+00012c30: 6372 6564 6974 203d 2065 7865 7263 6973  credit = exercis
+00012c40: 655f 6372 6564 6974 280a 2020 2020 2020  e_credit(.      
+00012c50: 2020 2020 2020 6569 6e66 6f2c 0a20 2020        einfo,.   
+00012c60: 2020 2020 2020 2020 206f 6e5f 7469 6d65           on_time
+00012c70: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+00012c80: 7463 6f6d 6573 0a20 2020 2020 2020 2029  tcomes.        )
+00012c90: 0a20 2020 2020 2020 2073 7461 7475 7365  .        statuse
+00012ca0: 735b 6175 7468 6f72 5d20 3d20 7374 6174  s[author] = stat
+00012cb0: 7573 0a0a 2020 2020 2020 2020 6966 2073  us..        if s
+00012cc0: 6861 7265 645f 7374 6174 7573 2069 7320  hared_status is 
+00012cd0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00012ce0: 2020 7368 6172 6564 5f73 7461 7475 7320    shared_status 
+00012cf0: 3d20 7374 6174 7573 0a20 2020 2020 2020  = status.       
+00012d00: 2065 6c69 6620 7368 6172 6564 5f73 7461   elif shared_sta
+00012d10: 7475 7320 3d3d 2022 6d69 7865 6422 206f  tus == "mixed" o
+00012d20: 7220 7368 6172 6564 5f73 7461 7475 7320  r shared_status 
+00012d30: 213d 2073 7461 7475 733a 0a20 2020 2020  != status:.     
+00012d40: 2020 2020 2020 2073 6861 7265 645f 7374         shared_st
+00012d50: 6174 7573 203d 2022 6d69 7865 6422 0a20  atus = "mixed". 
+00012d60: 2020 2020 2020 2023 2065 6c73 6520 6974         # else it
+00012d70: 2072 656d 6169 6e73 2074 6865 2073 616d   remains the sam
+00012d80: 650a 0a20 2020 2020 2020 2073 746f 7261  e..        stora
+00012d90: 6765 2e73 6176 655f 6f75 7463 6f6d 6573  ge.save_outcomes
+00012da0: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
+00012db0: 7572 7365 2c0a 2020 2020 2020 2020 2020  urse,.          
+00012dc0: 2020 7365 6d65 7374 6572 2c0a 2020 2020    semester,.    
+00012dd0: 2020 2020 2020 2020 6175 7468 6f72 2c0a          author,.
+00012de0: 2020 2020 2020 2020 2020 2020 6578 6572              exer
+00012df0: 6369 7365 2c0a 2020 2020 2020 2020 2020  cise,.          
+00012e00: 2020 6175 7468 6f72 732c 0a20 2020 2020    authors,.     
+00012e10: 2020 2020 2020 206f 7574 636f 6d65 732c         outcomes,
+00012e20: 0a20 2020 2020 2020 2020 2020 2063 6f64  .            cod
+00012e30: 6542 6c6f 636b 732c 0a20 2020 2020 2020  eBlocks,.       
+00012e40: 2020 2020 2073 7461 7475 732c 0a20 2020       status,.   
+00012e50: 2020 2020 2020 2020 2065 6372 6564 6974           ecredit
+00012e60: 2c0a 2020 2020 2020 2020 2020 2020 6763  ,.            gc
+00012e70: 7265 6469 742c 0a20 2020 2020 2020 2020  redit,.         
+00012e80: 2020 206f 6e5f 7469 6d65 0a20 2020 2020     on_time.     
+00012e90: 2020 2029 0a0a 2020 2020 6966 2073 6861     )..    if sha
+00012ea0: 7265 645f 7374 6174 7573 203d 3d20 226d  red_status == "m
+00012eb0: 6978 6564 223a 0a20 2020 2020 2020 206d  ixed":.        m
+00012ec0: 6573 7361 6765 203d 2028 0a20 2020 2020  essage = (.     
+00012ed0: 2020 2020 2020 2022 5375 626d 6973 7369         "Submissi
+00012ee0: 6f6e 2061 6363 6570 7465 643a 207b 7d2f  on accepted: {}/
+00012ef0: 7b7d 2063 6865 636b 7320 7061 7373 6564  {} checks passed
+00012f00: 2c20 6275 7420 7374 6174 7573 2069 7322  , but status is"
+00012f10: 0a20 2020 2020 2020 2020 2020 2022 2064  .            " d
+00012f20: 6966 6665 7265 6e74 2066 6f72 2064 6966  ifferent for dif
+00012f30: 6665 7265 6e74 2061 7574 686f 7273 3a5c  ferent authors:\
+00012f40: 6e7b 7d22 0a20 2020 2020 2020 2029 2e66  n{}".        ).f
+00012f50: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
+00012f60: 2020 206c 656e 285b 7820 666f 7220 7820     len([x for x 
+00012f70: 696e 206f 7574 636f 6d65 7320 6966 2078  in outcomes if x
+00012f80: 5b30 5d5d 292c 0a20 2020 2020 2020 2020  [0]]),.         
+00012f90: 2020 206c 656e 286f 7574 636f 6d65 7329     len(outcomes)
+00012fa0: 2c0a 2020 2020 2020 2020 2020 2020 275c  ,.            '\
+00012fb0: 6e27 2e6a 6f69 6e28 0a20 2020 2020 2020  n'.join(.       
+00012fc0: 2020 2020 2020 2020 2022 2020 666f 7220           "  for 
+00012fd0: 7b7d 3a20 7b7d 222e 666f 726d 6174 2861  {}: {}".format(a
+00012fe0: 7574 686f 722c 2073 7461 7475 7329 0a20  uthor, status). 
+00012ff0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00013000: 6f72 2028 6175 7468 6f72 2c20 7374 6174  or (author, stat
+00013010: 7573 2920 696e 2073 7461 7475 7365 732e  us) in statuses.
+00013020: 6974 656d 7328 290a 2020 2020 2020 2020  items().        
+00013030: 2020 2020 290a 2020 2020 2020 2020 290a      ).        ).
+00013040: 2020 2020 2020 2020 6966 2061 6e79 2873          if any(s
+00013050: 7461 7475 7320 213d 2022 636f 6d70 6c65  tatus != "comple
+00013060: 7465 2220 666f 7220 7374 6174 7573 2069  te" for status i
+00013070: 6e20 7374 6174 7573 6573 2e76 616c 7565  n statuses.value
+00013080: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
+00013090: 2020 6d65 7373 6167 6520 2b3d 2028 0a20    message += (. 
+000130a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000130b0: 5c6e 4e6f 7465 3a20 7468 6973 2073 7562  \nNote: this sub
+000130c0: 6d69 7373 696f 6e20 6973 204e 4f54 2063  mission is NOT c
+000130d0: 6f6d 706c 6574 6520 666f 7220 616c 6c20  omplete for all 
+000130e0: 6175 7468 6f72 732e 220a 2020 2020 2020  authors.".      
+000130f0: 2020 2020 2020 290a 2020 2020 656c 7365        ).    else
+00013100: 3a0a 2020 2020 2020 2020 6d65 7373 6167  :.        messag
+00013110: 6520 3d20 280a 2020 2020 2020 2020 2020  e = (.          
+00013120: 2020 2253 7562 6d69 7373 696f 6e20 6163    "Submission ac
+00013130: 6365 7074 6564 3a20 7b7d 2f7b 7d20 6368  cepted: {}/{} ch
+00013140: 6563 6b73 2070 6173 7365 6420 616e 6420  ecks passed and 
+00013150: 7374 6174 7573 2069 7320 7b7d 2e22 0a20  status is {}.". 
+00013160: 2020 2020 2020 2029 2e66 6f72 6d61 7428         ).format(
+00013170: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
+00013180: 285b 7820 666f 7220 7820 696e 206f 7574  ([x for x in out
+00013190: 636f 6d65 7320 6966 2078 5b30 5d5d 292c  comes if x[0]]),
+000131a0: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
+000131b0: 286f 7574 636f 6d65 7329 2c0a 2020 2020  (outcomes),.    
+000131c0: 2020 2020 2020 2020 7368 6172 6564 5f73          shared_s
+000131d0: 7461 7475 730a 2020 2020 2020 2020 290a  tatus.        ).
+000131e0: 2020 2020 2020 2020 6966 2073 6861 7265          if share
+000131f0: 645f 7374 6174 7573 2021 3d20 2263 6f6d  d_status != "com
+00013200: 706c 6574 6522 3a0a 2020 2020 2020 2020  plete":.        
+00013210: 2020 2020 6d65 7373 6167 6520 2b3d 2022      message += "
+00013220: 5c6e 4e6f 7465 3a20 7468 6973 2073 7562  \nNote: this sub
+00013230: 6d69 7373 696f 6e20 6973 204e 4f54 2063  mission is NOT c
+00013240: 6f6d 706c 6574 652e 220a 0a20 2020 2072  omplete."..    r
+00013250: 6574 7572 6e20 6d65 7373 6167 650a 0a0a  eturn message...
+00013260: 4061 7070 2e72 6f75 7465 280a 2020 2020  @app.route(.    
+00013270: 272f 3c63 6f75 7273 653e 2f3c 7365 6d65  '/<course>/<seme
+00013280: 7374 6572 3e2f 6578 6572 6369 7365 2f3c  ster>/exercise/<
+00013290: 7461 7267 6574 5f75 7365 723e 2f3c 6569  target_user>/<ei
+000132a0: 643e 272c 0a20 2020 206d 6574 686f 6473  d>',.    methods
+000132b0: 3d5b 2747 4554 275d 0a29 0a40 666c 6173  =['GET'].).@flas
+000132c0: 6b5f 6361 732e 6c6f 6769 6e5f 7265 7175  k_cas.login_requ
+000132d0: 6972 6564 0a40 6175 676d 656e 745f 6172  ired.@augment_ar
+000132e0: 6775 6d65 6e74 730a 6465 6620 726f 7574  guments.def rout
+000132f0: 655f 6578 6572 6369 7365 280a 2020 2020  e_exercise(.    
+00013300: 636f 7572 7365 2c0a 2020 2020 7365 6d65  course,.    seme
+00013310: 7374 6572 2c0a 2020 2020 7461 7267 6574  ster,.    target
+00013320: 5f75 7365 722c 0a20 2020 2065 6964 2c0a  _user,.    eid,.
+00013330: 2020 2020 2320 4175 676d 656e 7465 6420      # Augmented 
+00013340: 6172 6775 6d65 6e74 730a 2020 2020 7573  arguments.    us
+00013350: 6572 6e61 6d65 2c0a 2020 2020 6973 5f61  ername,.    is_a
+00013360: 646d 696e 2c0a 2020 2020 6d61 7371 7565  dmin,.    masque
+00013370: 7261 6465 5f61 732c 0a20 2020 2065 6666  rade_as,.    eff
+00013380: 6563 7469 7665 5f75 7365 722c 0a20 2020  ective_user,.   
+00013390: 2074 6173 6b5f 696e 666f 0a29 3a0a 2020   task_info.):.  
+000133a0: 2020 2320 4368 6563 6b20 7669 6577 2070    # Check view p
+000133b0: 6572 6d69 7373 696f 6e0a 2020 2020 6966  ermission.    if
+000133c0: 2074 6172 6765 745f 7573 6572 2021 3d20   target_user != 
+000133d0: 6566 6665 6374 6976 655f 7573 6572 2061  effective_user a
+000133e0: 6e64 206e 6f74 2069 735f 6164 6d69 6e3a  nd not is_admin:
+000133f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013400: 6572 726f 725f 7265 7370 6f6e 7365 280a  error_response(.
+00013410: 2020 2020 2020 2020 2020 2020 636f 7572              cour
+00013420: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00013430: 7365 6d65 7374 6572 2c0a 2020 2020 2020  semester,.      
+00013440: 2020 2020 2020 7573 6572 6e61 6d65 2c0a        username,.
+00013450: 2020 2020 2020 2020 2020 2020 2259 6f75              "You
+00013460: 2061 7265 206e 6f74 2061 6c6c 6f77 6564   are not allowed
+00013470: 2074 6f20 7669 6577 2065 7865 7263 6973   to view exercis
+00013480: 6573 2066 6f72 207b 7d2e 222e 666f 726d  es for {}.".form
+00013490: 6174 2874 6172 6765 745f 7573 6572 290a  at(target_user).
+000134a0: 2020 2020 2020 2020 290a 2020 2020 656c          ).    el
+000134b0: 6966 2074 6172 6765 745f 7573 6572 2021  if target_user !
+000134c0: 3d20 6566 6665 6374 6976 655f 7573 6572  = effective_user
+000134d0: 3a0a 2020 2020 2020 2020 666c 6173 6b2e  :.        flask.
+000134e0: 666c 6173 6828 2256 6965 7769 6e67 2065  flash("Viewing e
+000134f0: 7865 7263 6973 6520 666f 7220 7b7d 2e22  xercise for {}."
+00013500: 2e66 6f72 6d61 7428 7461 7267 6574 5f75  .format(target_u
+00013510: 7365 7229 290a 0a20 2020 2023 2046 726f  ser))..    # Fro
+00013520: 6d20 6865 7265 206f 6e20 7765 2074 7265  m here on we tre
+00013530: 6174 2074 6865 2065 6666 6563 7469 7665  at the effective
+00013540: 2075 7365 7220 6173 2074 6865 2074 6172   user as the tar
+00013550: 6765 7420 7573 6572 0a20 2020 2065 6666  get user.    eff
+00013560: 6563 7469 7665 5f75 7365 7220 3d20 7461  ective_user = ta
+00013570: 7267 6574 5f75 7365 720a 0a20 2020 2023  rget_user..    #
+00013580: 2043 6865 636b 2072 6f73 7465 7220 616e   Check roster an
+00013590: 6420 666c 6173 6820 6120 7761 726e 696e  d flash a warnin
+000135a0: 6720 6966 2077 6527 7265 2076 6965 7769  g if we're viewi
+000135b0: 6e67 2066 6565 6462 6163 6b20 666f 7220  ng feedback for 
+000135c0: 610a 2020 2020 2320 7573 6572 2077 686f  a.    # user who
+000135d0: 2069 7320 6e6f 7420 6f6e 2074 6865 2072   is not on the r
+000135e0: 6f73 7465 722e 2e2e 0a20 2020 2074 7279  oster....    try
+000135f0: 3a0a 2020 2020 2020 2020 726f 7374 6572  :.        roster
+00013600: 203d 2073 746f 7261 6765 2e67 6574 5f72   = storage.get_r
+00013610: 6f73 7465 7228 636f 7572 7365 2c20 7365  oster(course, se
+00013620: 6d65 7374 6572 290a 2020 2020 6578 6365  mester).    exce
+00013630: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00013640: 653a 0a20 2020 2020 2020 2066 6c61 736b  e:.        flask
+00013650: 2e66 6c61 7368 2873 7472 2865 2929 0a20  .flash(str(e)). 
+00013660: 2020 2020 2020 2072 6f73 7465 7220 3d20         roster = 
+00013670: 4e6f 6e65 0a0a 2020 2020 6966 2072 6f73  None..    if ros
+00013680: 7465 7220 6973 204e 6f6e 653a 0a20 2020  ter is None:.   
+00013690: 2020 2020 2066 6c61 736b 2e66 6c61 7368       flask.flash
+000136a0: 280a 2020 2020 2020 2020 2020 2020 2257  (.            "W
+000136b0: 6172 6e69 6e67 3a20 636f 756c 6420 6e6f  arning: could no
+000136c0: 7420 6665 7463 6820 726f 7374 6572 2074  t fetch roster t
+000136d0: 6f20 6368 6563 6b20 6966 2074 6869 7320  o check if this 
+000136e0: 7573 6572 2069 7320 6f6e 220a 2020 2020  user is on".    
+000136f0: 2020 2020 2020 2020 2220 6974 2e22 0a20          " it.". 
+00013700: 2020 2020 2020 2029 0a20 2020 2065 6c69         ).    eli
+00013710: 6620 6566 6665 6374 6976 655f 7573 6572  f effective_user
+00013720: 206e 6f74 2069 6e20 726f 7374 6572 3a0a   not in roster:.
+00013730: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
+00013740: 6173 6828 2257 6172 6e69 6e67 3a20 7468  ash("Warning: th
+00013750: 6973 2075 7365 7220 6973 206e 6f74 206f  is user is not o
+00013760: 6e20 7468 6520 726f 7374 6572 2122 290a  n the roster!").
+00013770: 0a20 2020 2023 2047 6574 2065 7865 7263  .    # Get exerc
+00013780: 6973 6520 696e 666f 3a0a 2020 2020 6569  ise info:.    ei
+00013790: 6e66 6f20 3d20 4e6f 6e65 0a20 2020 2067  nfo = None.    g
+000137a0: 696e 666f 203d 204e 6f6e 650a 2020 2020  info = None.    
+000137b0: 666f 7220 6772 6f75 7020 696e 2074 6173  for group in tas
+000137c0: 6b5f 696e 666f 2e67 6574 2822 6578 6572  k_info.get("exer
+000137d0: 6369 7365 7322 2c20 5b5d 293a 0a20 2020  cises", []):.   
+000137e0: 2020 2020 2065 6c69 7374 203d 2067 726f       elist = gro
+000137f0: 7570 5b22 6578 6572 6369 7365 7322 5d0a  up["exercises"].
+00013800: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
+00013810: 616c 6c6f 7761 6e63 6573 2066 6f72 206f  allowances for o
+00013820: 6c64 2066 6f72 6d61 740a 2020 2020 2020  ld format.      
+00013830: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00013840: 656c 6973 742c 2064 6963 7429 3a0a 2020  elist, dict):.  
+00013850: 2020 2020 2020 2020 2020 666f 7220 6569            for ei
+00013860: 6420 696e 2065 6c69 7374 3a0a 2020 2020  d in elist:.    
+00013870: 2020 2020 2020 2020 2020 2020 656c 6973              elis
+00013880: 745b 6569 645d 5b27 6964 275d 203d 2065  t[eid]['id'] = e
+00013890: 6964 0a20 2020 2020 2020 2020 2020 2065  id.            e
+000138a0: 6c69 7374 203d 206c 6973 7428 656c 6973  list = list(elis
+000138b0: 742e 7661 6c75 6573 2829 290a 0a20 2020  t.values())..   
+000138c0: 2020 2020 2066 6f72 2065 7820 696e 2065       for ex in e
+000138d0: 6c69 7374 3a0a 2020 2020 2020 2020 2020  list:.          
+000138e0: 2020 6966 2065 6964 203d 3d20 6578 5b27    if eid == ex['
+000138f0: 6964 275d 3a0a 2020 2020 2020 2020 2020  id']:.          
+00013900: 2020 2020 2020 6769 6e66 6f20 3d20 6772        ginfo = gr
+00013910: 6f75 700a 2020 2020 2020 2020 2020 2020  oup.            
+00013920: 2020 2020 6569 6e66 6f20 3d20 6578 0a20      einfo = ex. 
+00013930: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00013940: 7265 616b 0a20 2020 2020 2020 2069 6620  reak.        if 
+00013950: 6569 6e66 6f20 6973 206e 6f74 204e 6f6e  einfo is not Non
+00013960: 653a 0a20 2020 2020 2020 2020 2020 2062  e:.            b
+00013970: 7265 616b 0a0a 2020 2020 2320 4765 7420  reak..    # Get 
+00013980: 6f75 7463 6f6d 6520 696e 666f 2066 6f72  outcome info for
+00013990: 2074 6869 7320 6578 6572 6369 7365 0a20   this exercise. 
+000139a0: 2020 206f 7574 636f 6d65 7320 3d20 7374     outcomes = st
+000139b0: 6f72 6167 652e 6665 7463 685f 6265 7374  orage.fetch_best
+000139c0: 5f6f 7574 636f 6d65 7328 636f 7572 7365  _outcomes(course
+000139d0: 2c20 7365 6d65 7374 6572 2c20 7461 7267  , semester, targ
+000139e0: 6574 5f75 7365 7229 0a0a 2020 2020 2320  et_user)..    # 
+000139f0: 416d 656e 6420 6578 6572 6369 7365 7320  Amend exercises 
+00013a00: 746f 2073 6574 2073 7461 7475 7365 730a  to set statuses.
+00013a10: 2020 2020 616d 656e 645f 6578 6572 6369      amend_exerci
+00013a20: 7365 7328 636f 7572 7365 2c20 7365 6d65  ses(course, seme
+00013a30: 7374 6572 2c20 7461 736b 5f69 6e66 6f2c  ster, task_info,
+00013a40: 206f 7574 636f 6d65 732c 2074 6172 6765   outcomes, targe
+00013a50: 745f 7573 6572 290a 0a20 2020 2023 2047  t_user)..    # G
+00013a60: 6574 2070 6172 7469 6375 6c61 7220 6f75  et particular ou
+00013a70: 7463 6f6d 650a 2020 2020 7265 7375 6c74  tcome.    result
+00013a80: 7320 3d20 6f75 7463 6f6d 6573 2e67 6574  s = outcomes.get
+00013a90: 280a 2020 2020 2020 2020 6569 642c 0a20  (.        eid,. 
+00013aa0: 2020 2020 2020 207b 2020 2320 6465 6661         {  # defa
+00013ab0: 756c 7420 7768 656e 2065 7865 7263 6973  ult when exercis
+00013ac0: 6520 6861 736e 2774 2062 6565 6e20 7375  e hasn't been su
+00013ad0: 626d 6974 7465 640a 2020 2020 2020 2020  bmitted.        
+00013ae0: 2020 2020 2273 7562 6d69 7474 6564 5f61      "submitted_a
+00013af0: 7422 3a20 4e6f 6e65 2c0a 2020 2020 2020  t": None,.      
+00013b00: 2020 2020 2020 226f 6e5f 7469 6d65 223a        "on_time":
+00013b10: 2054 7275 652c 0a20 2020 2020 2020 2020   True,.         
+00013b20: 2020 2022 6175 7468 6f72 7322 3a20 5b5d     "authors": []
+00013b30: 2c0a 2020 2020 2020 2020 2020 2020 226f  ,.            "o
+00013b40: 7574 636f 6d65 7322 3a20 5b5d 2c0a 2020  utcomes": [],.  
+00013b50: 2020 2020 2020 2020 2020 2263 6f64 6522            "code"
+00013b60: 3a20 5b5d 2c0a 2020 2020 2020 2020 2020  : [],.          
+00013b70: 2020 2273 7461 7475 7322 3a20 2275 6e73    "status": "uns
+00013b80: 7562 6d69 7474 6564 222c 0a20 2020 2020  ubmitted",.     
+00013b90: 2020 2020 2020 2022 6372 6564 6974 223a         "credit":
+00013ba0: 204e 6f6e 650a 2020 2020 2020 2020 7d0a   None.        }.
+00013bb0: 2020 2020 290a 0a20 2020 2072 6574 7572      )..    retur
+00013bc0: 6e20 666c 6173 6b2e 7265 6e64 6572 5f74  n flask.render_t
+00013bd0: 656d 706c 6174 6528 0a20 2020 2020 2020  emplate(.       
+00013be0: 2027 6578 6572 6369 7365 2e6a 3227 2c0a   'exercise.j2',.
+00013bf0: 2020 2020 2020 2020 636f 7572 7365 5f6e          course_n
+00013c00: 616d 653d 6170 702e 636f 6e66 6967 2e67  ame=app.config.g
+00013c10: 6574 2822 434f 5552 5345 5f4e 414d 4553  et("COURSE_NAMES
+00013c20: 222c 207b 7d29 2e67 6574 2863 6f75 7273  ", {}).get(cours
+00013c30: 652c 2063 6f75 7273 6529 2c0a 2020 2020  e, course),.    
+00013c40: 2020 2020 636f 7572 7365 3d63 6f75 7273      course=cours
+00013c50: 652c 0a20 2020 2020 2020 2073 656d 6573  e,.        semes
+00013c60: 7465 723d 7365 6d65 7374 6572 2c0a 2020  ter=semester,.  
+00013c70: 2020 2020 2020 7573 6572 6e61 6d65 3d75        username=u
+00013c80: 7365 726e 616d 652c 0a20 2020 2020 2020  sername,.       
+00013c90: 2069 735f 6164 6d69 6e3d 6973 5f61 646d   is_admin=is_adm
+00013ca0: 696e 2c0a 2020 2020 2020 2020 6d61 7371  in,.        masq
+00013cb0: 7565 7261 6465 5f61 733d 6d61 7371 7565  uerade_as=masque
+00013cc0: 7261 6465 5f61 732c 0a20 2020 2020 2020  rade_as,.       
+00013cd0: 2074 6172 6765 745f 7573 6572 3d74 6172   target_user=tar
+00013ce0: 6765 745f 7573 6572 2c0a 2020 2020 2020  get_user,.      
+00013cf0: 2020 7461 736b 5f69 6e66 6f3d 7461 736b    task_info=task
+00013d00: 5f69 6e66 6f2c 0a20 2020 2020 2020 2065  _info,.        e
+00013d10: 6964 3d65 6964 2c0a 2020 2020 2020 2020  id=eid,.        
+00013d20: 6769 6e66 6f3d 6769 6e66 6f2c 0a20 2020  ginfo=ginfo,.   
+00013d30: 2020 2020 2065 696e 666f 3d65 696e 666f       einfo=einfo
+00013d40: 2c0a 2020 2020 2020 2020 7265 7375 6c74  ,.        result
+00013d50: 733d 7265 7375 6c74 730a 2020 2020 290a  s=results.    ).
+00013d60: 0a0a 4061 7070 2e72 6f75 7465 2827 2f3c  ..@app.route('/<
+00013d70: 636f 7572 7365 3e2f 3c73 656d 6573 7465  course>/<semeste
+00013d80: 723e 2f65 785f 6772 6164 6573 6865 6574  r>/ex_gradesheet
+00013d90: 2f3c 6772 6f75 703e 272c 206d 6574 686f  /<group>', metho
+00013da0: 6473 3d5b 2747 4554 275d 290a 4066 6c61  ds=['GET']).@fla
+00013db0: 736b 5f63 6173 2e6c 6f67 696e 5f72 6571  sk_cas.login_req
+00013dc0: 7569 7265 640a 4061 7567 6d65 6e74 5f61  uired.@augment_a
+00013dd0: 7267 756d 656e 7473 0a64 6566 2072 6f75  rguments.def rou
+00013de0: 7465 5f65 785f 6772 6164 6573 6865 6574  te_ex_gradesheet
+00013df0: 280a 2020 2020 636f 7572 7365 2c0a 2020  (.    course,.  
+00013e00: 2020 7365 6d65 7374 6572 2c0a 2020 2020    semester,.    
+00013e10: 6772 6f75 702c 0a20 2020 2023 2041 7567  group,.    # Aug
+00013e20: 6d65 6e74 6564 2061 7267 756d 656e 7473  mented arguments
+00013e30: 0a20 2020 2075 7365 726e 616d 652c 0a20  .    username,. 
+00013e40: 2020 2069 735f 6164 6d69 6e2c 0a20 2020     is_admin,.   
+00013e50: 206d 6173 7175 6572 6164 655f 6173 2c0a   masquerade_as,.
+00013e60: 2020 2020 6566 6665 6374 6976 655f 7573      effective_us
+00013e70: 6572 2c0a 2020 2020 7461 736b 5f69 6e66  er,.    task_inf
+00013e80: 6f0a 293a 0a20 2020 2022 2222 0a20 2020  o.):.    """.   
+00013e90: 2056 6973 6962 6c65 2062 7920 6164 6d69   Visible by admi
+00013ea0: 6e73 206f 6e6c 792c 2074 6869 7320 726f  ns only, this ro
+00013eb0: 7574 6520 6469 7370 6c61 7973 2061 6e20  ute displays an 
+00013ec0: 6f76 6572 7669 6577 206f 6620 7468 6520  overview of the 
+00013ed0: 7374 6174 7573 0a20 2020 206f 6620 6576  status.    of ev
+00013ee0: 6572 7920 7374 7564 656e 7420 6f6e 2074  ery student on t
+00013ef0: 6865 2072 6f73 7465 722c 2077 6974 6820  he roster, with 
+00013f00: 6c69 6e6b 7320 746f 2074 6865 2065 7874  links to the ext
+00013f10: 656e 7369 6f6e 7320 6d61 6e61 6765 720a  ensions manager.
+00013f20: 2020 2020 616e 6420 746f 2066 6565 6462      and to feedb
+00013f30: 6163 6b20 7669 6577 7320 666f 7220 6561  ack views for ea
+00013f40: 6368 2073 7475 6465 6e74 2e0a 2020 2020  ch student..    
+00013f50: 2222 220a 2020 2020 6966 206e 6f74 2069  """.    if not i
+00013f60: 735f 6164 6d69 6e3a 0a20 2020 2020 2020  s_admin:.       
+00013f70: 2066 6c61 736b 2e66 6c61 7368 2822 596f   flask.flash("Yo
+00013f80: 7520 646f 206e 6f74 2068 6176 6520 7065  u do not have pe
+00013f90: 726d 6973 7369 6f6e 2074 6f20 7669 6577  rmission to view
+00013fa0: 2067 7261 6465 7368 6565 7473 2e22 290a   gradesheets.").
+00013fb0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+00013fc0: 6f62 6163 6b28 636f 7572 7365 2c20 7365  oback(course, se
+00013fd0: 6d65 7374 6572 290a 0a20 2020 2023 2043  mester)..    # C
+00013fe0: 7265 6174 6520 6261 7365 2074 6173 6b20  reate base task 
+00013ff0: 696e 666f 2066 726f 6d20 6c6f 6767 6564  info from logged
+00014000: 2d69 6e20 7573 6572 2773 2070 6572 7370  -in user's persp
+00014010: 6563 7469 7665 0a20 2020 2062 6173 655f  ective.    base_
+00014020: 7461 736b 5f69 6e66 6f20 3d20 636f 7079  task_info = copy
+00014030: 2e64 6565 7063 6f70 7928 7461 736b 5f69  .deepcopy(task_i
+00014040: 6e66 6f29 0a20 2020 2061 6d65 6e64 5f65  nfo).    amend_e
+00014050: 7865 7263 6973 6573 2863 6f75 7273 652c  xercises(course,
+00014060: 2073 656d 6573 7465 722c 2062 6173 655f   semester, base_
+00014070: 7461 736b 5f69 6e66 6f2c 207b 7d2c 2075  task_info, {}, u
+00014080: 7365 726e 616d 6529 0a0a 2020 2020 6567  sername)..    eg
+00014090: 726f 7570 7320 3d20 6261 7365 5f74 6173  roups = base_tas
+000140a0: 6b5f 696e 666f 2e67 6574 2822 6578 6572  k_info.get("exer
+000140b0: 6369 7365 7322 290a 2020 2020 6966 2065  cises").    if e
+000140c0: 6772 6f75 7073 2069 7320 4e6f 6e65 3a0a  groups is None:.
+000140d0: 2020 2020 2020 2020 6d73 6720 3d20 224e          msg = "N
+000140e0: 6f20 6578 6572 6369 7365 7320 6465 6669  o exercises defi
+000140f0: 6e65 6420 696e 2074 6173 6b73 2e6a 736f  ned in tasks.jso
+00014100: 6e2e 220a 2020 2020 2020 2020 666c 6173  n.".        flas
+00014110: 6b2e 666c 6173 6828 6d73 6729 0a20 2020  k.flash(msg).   
+00014120: 2020 2020 2072 6574 7572 6e20 6572 726f       return erro
+00014130: 725f 7265 7370 6f6e 7365 2863 6f75 7273  r_response(cours
+00014140: 652c 2073 656d 6573 7465 722c 2075 7365  e, semester, use
+00014150: 726e 616d 652c 206d 7367 290a 0a20 2020  rname, msg)..   
+00014160: 2023 2047 6574 2074 6865 2072 6f73 7465   # Get the roste
+00014170: 720a 2020 2020 7472 793a 0a20 2020 2020  r.    try:.     
+00014180: 2020 2072 6f73 7465 7220 3d20 7374 6f72     roster = stor
+00014190: 6167 652e 6765 745f 726f 7374 6572 2863  age.get_roster(c
+000141a0: 6f75 7273 652c 2073 656d 6573 7465 7229  ourse, semester)
+000141b0: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
+000141c0: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+000141d0: 2020 2020 666c 6173 6b2e 666c 6173 6828      flask.flash(
+000141e0: 7374 7228 6529 290a 2020 2020 2020 2020  str(e)).        
+000141f0: 726f 7374 6572 203d 204e 6f6e 650a 0a20  roster = None.. 
+00014200: 2020 2069 6620 726f 7374 6572 2069 7320     if roster is 
+00014210: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d73  None:.        ms
+00014220: 6720 3d20 2246 6169 6c65 6420 746f 206c  g = "Failed to l
+00014230: 6f61 6420 3c63 6f64 653e 726f 7374 6572  oad <code>roster
+00014240: 2e63 7376 3c2f 636f 6465 3e2e 220a 2020  .csv</code>.".  
+00014250: 2020 2020 2020 666c 6173 6b2e 666c 6173        flask.flas
+00014260: 6828 6d73 6729 0a20 2020 2020 2020 2072  h(msg).        r
+00014270: 6574 7572 6e20 6572 726f 725f 7265 7370  eturn error_resp
+00014280: 6f6e 7365 2863 6f75 7273 652c 2073 656d  onse(course, sem
+00014290: 6573 7465 722c 2075 7365 726e 616d 652c  ester, username,
+000142a0: 206d 7367 290a 0a20 2020 2023 2046 6967   msg)..    # Fig
+000142b0: 7572 6520 6f75 7420 7468 6520 696e 6465  ure out the inde
+000142c0: 7820 666f 7220 7468 6973 2067 726f 7570  x for this group
+000142d0: 0a20 2020 2067 726f 7570 5f69 6e64 6578  .    group_index
+000142e0: 203d 204e 6f6e 650a 2020 2020 6772 6f75   = None.    grou
+000142f0: 705f 6f62 6a20 3d20 4e6f 6e65 0a20 2020  p_obj = None.   
+00014300: 2066 6f72 2069 2c20 6772 6f75 705f 656e   for i, group_en
+00014310: 7472 7920 696e 2065 6e75 6d65 7261 7465  try in enumerate
+00014320: 2865 6772 6f75 7073 293a 0a20 2020 2020  (egroups):.     
+00014330: 2020 2069 6620 2274 696d 656c 795f 6279     if "timely_by
+00014340: 2220 6e6f 7420 696e 2067 726f 7570 5f65  " not in group_e
+00014350: 6e74 7279 3a0a 2020 2020 2020 2020 2020  ntry:.          
+00014360: 2020 7072 696e 7428 6772 6f75 705f 656e    print(group_en
+00014370: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
+00014380: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00014390: 7228 2248 4122 290a 2020 2020 2020 2020  r("HA").        
+000143a0: 6966 2067 726f 7570 5f65 6e74 7279 5b22  if group_entry["
+000143b0: 6772 6f75 7022 5d20 3d3d 2067 726f 7570  group"] == group
+000143c0: 3a0a 2020 2020 2020 2020 2020 2020 6772  :.            gr
+000143d0: 6f75 705f 696e 6465 7820 3d20 690a 2020  oup_index = i.  
+000143e0: 2020 2020 2020 2020 2020 6772 6f75 705f            group_
+000143f0: 6f62 6a20 3d20 6772 6f75 705f 656e 7472  obj = group_entr
+00014400: 790a 2020 2020 2020 2020 2020 2020 6272  y.            br
+00014410: 6561 6b0a 0a20 2020 2069 6620 6772 6f75  eak..    if grou
+00014420: 705f 696e 6465 7820 6973 204e 6f6e 653a  p_index is None:
+00014430: 0a20 2020 2020 2020 206d 7367 203d 2028  .        msg = (
+00014440: 0a20 2020 2020 2020 2020 2020 2022 4578  .            "Ex
+00014450: 6572 6369 7365 2067 726f 7570 2027 7b7d  ercise group '{}
+00014460: 2720 6e6f 7420 666f 756e 6420 666f 7220  ' not found for 
+00014470: 7468 6973 2063 6f75 7273 652f 7365 6d65  this course/seme
+00014480: 7374 6572 2e22 0a20 2020 2020 2020 2029  ster.".        )
+00014490: 2e66 6f72 6d61 7428 6772 6f75 7029 0a20  .format(group). 
+000144a0: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
+000144b0: 7368 286d 7367 290a 2020 2020 2020 2020  sh(msg).        
+000144c0: 7265 7475 726e 2065 7272 6f72 5f72 6573  return error_res
+000144d0: 706f 6e73 6528 636f 7572 7365 2c20 7365  ponse(course, se
+000144e0: 6d65 7374 6572 2c20 7573 6572 6e61 6d65  mester, username
+000144f0: 2c20 6d73 6729 0a0a 2020 2020 726f 7773  , msg)..    rows
+00014500: 203d 205b 5d0a 2020 2020 666f 7220 7374   = [].    for st
+00014510: 6964 2069 6e20 736f 7274 6564 280a 2020  id in sorted(.  
+00014520: 2020 2020 2020 726f 7374 6572 2c0a 2020        roster,.  
+00014530: 2020 2020 2020 6b65 793d 6c61 6d62 6461        key=lambda
+00014540: 2073 7469 643a 2028 0a20 2020 2020 2020   stid: (.       
+00014550: 2020 2020 2072 6f73 7465 725b 7374 6964       roster[stid
+00014560: 5d5b 2263 6f75 7273 655f 7365 6374 696f  ]["course_sectio
+00014570: 6e22 5d2c 0a20 2020 2020 2020 2020 2020  n"],.           
+00014580: 2072 6f73 7465 725b 7374 6964 5d5b 2273   roster[stid]["s
+00014590: 6f72 746e 616d 6522 5d0a 2020 2020 2020  ortname"].      
+000145a0: 2020 290a 2020 2020 293a 0a20 2020 2020    ).    ):.     
+000145b0: 2020 2072 6f77 203d 2072 6f73 7465 725b     row = roster[
+000145c0: 7374 6964 5d0a 2020 2020 2020 2020 726f  stid].        ro
+000145d0: 775f 696e 666f 203d 2063 6f70 792e 6465  w_info = copy.de
+000145e0: 6570 636f 7079 2874 6173 6b5f 696e 666f  epcopy(task_info
+000145f0: 290a 2020 2020 2020 2020 726f 775b 2274  ).        row["t
+00014600: 6173 6b5f 696e 666f 225d 203d 2072 6f77  ask_info"] = row
+00014610: 5f69 6e66 6f0a 0a20 2020 2020 2020 2023  _info..        #
+00014620: 2047 6574 2065 7865 7263 6973 6520 6f75   Get exercise ou
+00014630: 7463 6f6d 6573 2066 6f72 2074 6869 7320  tcomes for this 
+00014640: 7374 7564 656e 740a 2020 2020 2020 2020  student.        
+00014650: 726f 775f 6f75 7463 6f6d 6573 203d 2073  row_outcomes = s
+00014660: 746f 7261 6765 2e66 6574 6368 5f62 6573  torage.fetch_bes
+00014670: 745f 6f75 7463 6f6d 6573 2863 6f75 7273  t_outcomes(cours
+00014680: 652c 2073 656d 6573 7465 722c 2073 7469  e, semester, sti
+00014690: 6429 0a20 2020 2020 2020 2072 6f77 5b22  d).        row["
+000146a0: 6f75 7463 6f6d 6573 225d 203d 2072 6f77  outcomes"] = row
+000146b0: 5f6f 7574 636f 6d65 730a 0a20 2020 2020  _outcomes..     
+000146c0: 2020 2023 2041 6d65 6e64 2074 6869 7320     # Amend this 
+000146d0: 726f 7727 7320 6578 6572 6369 7365 7320  row's exercises 
+000146e0: 772f 2074 6869 7320 7374 7564 656e 7427  w/ this student'
+000146f0: 7320 6f75 7463 6f6d 6573 0a20 2020 2020  s outcomes.     
+00014700: 2020 2061 6d65 6e64 5f65 7865 7263 6973     amend_exercis
+00014710: 6573 2863 6f75 7273 652c 2073 656d 6573  es(course, semes
+00014720: 7465 722c 2072 6f77 5f69 6e66 6f2c 2072  ter, row_info, r
+00014730: 6f77 5f6f 7574 636f 6d65 732c 2073 7469  ow_outcomes, sti
+00014740: 6429 0a0a 2020 2020 2020 2020 2320 4665  d)..        # Fe
+00014750: 7463 6820 6772 6f75 7020 6672 6f6d 2061  tch group from a
+00014760: 6d65 6e64 6564 2074 6173 6b5f 696e 666f  mended task_info
+00014770: 2076 6961 2067 726f 7570 2069 6e64 6578   via group index
+00014780: 0a20 2020 2020 2020 2074 6869 735f 6772  .        this_gr
+00014790: 6f75 7020 3d20 726f 775f 696e 666f 5b22  oup = row_info["
+000147a0: 6578 6572 6369 7365 7322 5d5b 6772 6f75  exercises"][grou
+000147b0: 705f 696e 6465 785d 0a0a 2020 2020 2020  p_index]..      
+000147c0: 2020 726f 775b 2274 6869 735f 6772 6f75    row["this_grou
+000147d0: 7022 5d20 3d20 7468 6973 5f67 726f 7570  p"] = this_group
+000147e0: 0a0a 2020 2020 2020 2020 726f 7773 2e61  ..        rows.a
+000147f0: 7070 656e 6428 726f 7729 0a0a 2020 2020  ppend(row)..    
+00014800: 2320 4765 7420 7468 6520 7374 7564 656e  # Get the studen
+00014810: 7420 696e 666f 0a20 2020 2074 7279 3a0a  t info.    try:.
+00014820: 2020 2020 2020 2020 7374 7564 656e 745f          student_
+00014830: 696e 666f 203d 2073 746f 7261 6765 2e67  info = storage.g
+00014840: 6574 5f73 7475 6465 6e74 5f69 6e66 6f28  et_student_info(
+00014850: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
+00014860: 290a 2020 2020 6578 6365 7074 2045 7863  ).    except Exc
+00014870: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+00014880: 2020 2020 2066 6c61 736b 2e66 6c61 7368       flask.flash
+00014890: 2873 7472 2865 2929 0a20 2020 2020 2020  (str(e)).       
+000148a0: 2073 7475 6465 6e74 5f69 6e66 6f20 3d20   student_info = 
+000148b0: 4e6f 6e65 0a0a 2020 2020 7265 7475 726e  None..    return
+000148c0: 2066 6c61 736b 2e72 656e 6465 725f 7465   flask.render_te
+000148d0: 6d70 6c61 7465 280a 2020 2020 2020 2020  mplate(.        
+000148e0: 2765 7865 7263 6973 655f 6772 6164 6573  'exercise_grades
+000148f0: 6865 6574 2e6a 3227 2c0a 2020 2020 2020  heet.j2',.      
+00014900: 2020 636f 7572 7365 5f6e 616d 653d 6170    course_name=ap
+00014910: 702e 636f 6e66 6967 2e67 6574 2822 434f  p.config.get("CO
+00014920: 5552 5345 5f4e 414d 4553 222c 207b 7d29  URSE_NAMES", {})
+00014930: 2e67 6574 2863 6f75 7273 652c 2063 6f75  .get(course, cou
+00014940: 7273 6529 2c0a 2020 2020 2020 2020 636f  rse),.        co
+00014950: 7572 7365 3d63 6f75 7273 652c 0a20 2020  urse=course,.   
+00014960: 2020 2020 2073 656d 6573 7465 723d 7365       semester=se
+00014970: 6d65 7374 6572 2c0a 2020 2020 2020 2020  mester,.        
+00014980: 7573 6572 6e61 6d65 3d75 7365 726e 616d  username=usernam
+00014990: 652c 0a20 2020 2020 2020 2069 735f 6164  e,.        is_ad
+000149a0: 6d69 6e3d 6973 5f61 646d 696e 2c0a 2020  min=is_admin,.  
+000149b0: 2020 2020 2020 6d61 7371 7565 7261 6465        masquerade
+000149c0: 5f61 733d 6d61 7371 7565 7261 6465 5f61  _as=masquerade_a
+000149d0: 732c 0a20 2020 2020 2020 2074 6173 6b5f  s,.        task_
+000149e0: 696e 666f 3d74 6173 6b5f 696e 666f 2c0a  info=task_info,.
+000149f0: 2020 2020 2020 2020 6772 6f75 703d 6772          group=gr
+00014a00: 6f75 702c 0a20 2020 2020 2020 2067 726f  oup,.        gro
+00014a10: 7570 5f6f 626a 3d67 726f 7570 5f6f 626a  up_obj=group_obj
+00014a20: 2c0a 2020 2020 2020 2020 726f 7374 6572  ,.        roster
+00014a30: 3d72 6f77 732c 0a20 2020 2020 2020 2073  =rows,.        s
+00014a40: 7475 6465 6e74 5f69 6e66 6f3d 7374 7564  tudent_info=stud
+00014a50: 656e 745f 696e 666f 0a20 2020 2029 0a0a  ent_info.    )..
+00014a60: 0a23 2d2d 2d2d 2d2d 2d2d 2d23 0a23 2048  .#---------#.# H
+00014a70: 656c 7065 7273 2023 0a23 2d2d 2d2d 2d2d  elpers #.#------
+00014a80: 2d2d 2d23 0a0a 6465 6620 6572 726f 725f  ---#..def error_
+00014a90: 7265 7370 6f6e 7365 2863 6f75 7273 652c  response(course,
+00014aa0: 2073 656d 6573 7465 722c 2075 7365 726e   semester, usern
+00014ab0: 616d 652c 2063 6175 7365 293a 0a20 2020  ame, cause):.   
+00014ac0: 2022 2222 0a20 2020 2053 686f 7274 6375   """.    Shortcu
+00014ad0: 7420 666f 7220 6469 7370 6c61 7969 6e67  t for displaying
+00014ae0: 206d 616a 6f72 2065 7272 6f72 7320 746f   major errors to
+00014af0: 2074 6865 2075 7365 7273 2073 6f20 7468   the users so th
+00014b00: 6174 2074 6865 7920 6361 6e0a 2020 2020  at they can.    
+00014b10: 6275 6720 7468 6520 7375 7070 6f72 7420  bug the support 
+00014b20: 6c69 6e65 2069 6e73 7465 6164 206f 6620  line instead of 
+00014b30: 6a75 7374 2067 6574 7469 6e67 2061 2070  just getting a p
+00014b40: 7572 6520 3430 342e 0a20 2020 2022 2222  ure 404..    """
+00014b50: 0a20 2020 2072 6574 7572 6e20 666c 6173  .    return flas
+00014b60: 6b2e 7265 6e64 6572 5f74 656d 706c 6174  k.render_templat
+00014b70: 6528 0a20 2020 2020 2020 2027 6572 726f  e(.        'erro
+00014b80: 722e 6a32 272c 0a20 2020 2020 2020 2063  r.j2',.        c
+00014b90: 6f75 7273 655f 6e61 6d65 3d61 7070 2e63  ourse_name=app.c
+00014ba0: 6f6e 6669 672e 6765 7428 2243 4f55 5253  onfig.get("COURS
+00014bb0: 455f 4e41 4d45 5322 2c20 7b7d 292e 6765  E_NAMES", {}).ge
+00014bc0: 7428 636f 7572 7365 2c20 636f 7572 7365  t(course, course
+00014bd0: 292c 0a20 2020 2020 2020 2063 6f75 7273  ),.        cours
+00014be0: 653d 636f 7572 7365 2c0a 2020 2020 2020  e=course,.      
+00014bf0: 2020 7365 6d65 7374 6572 3d73 656d 6573    semester=semes
+00014c00: 7465 722c 0a20 2020 2020 2020 2075 7365  ter,.        use
+00014c10: 726e 616d 653d 7573 6572 6e61 6d65 2c0a  rname=username,.
+00014c20: 2020 2020 2020 2020 616e 6e6f 756e 6365          announce
+00014c30: 6d65 6e74 733d 2222 2c0a 2020 2020 2020  ments="",.      
+00014c40: 2020 7375 7070 6f72 745f 6c69 6e6b 3d61    support_link=a
+00014c50: 7070 2e63 6f6e 6669 675b 2253 5550 504f  pp.config["SUPPO
+00014c60: 5254 5f4c 494e 4b22 5d2c 0a20 2020 2020  RT_LINK"],.     
+00014c70: 2020 2065 7272 6f72 3d63 6175 7365 2c0a     error=cause,.
+00014c80: 2020 2020 2020 2020 7461 736b 5f69 6e66          task_inf
+00014c90: 6f3d 7b7d 0a20 2020 2029 0a0a 0a64 6566  o={}.    )...def
+00014ca0: 2067 6574 5f70 735f 6f62 6a28 7461 736b   get_ps_obj(task
+00014cb0: 5f69 6e66 6f2c 2070 7369 6429 3a0a 2020  _info, psid):.  
+00014cc0: 2020 2222 220a 2020 2020 4765 7473 2074    """.    Gets t
+00014cd0: 6865 2070 7365 7420 6f62 6a65 6374 2077  he pset object w
+00014ce0: 6974 6820 7468 6520 6769 7665 6e20 4944  ith the given ID
+00014cf0: 2e20 5261 6973 6573 2061 2056 616c 7565  . Raises a Value
+00014d00: 4572 726f 7220 6966 2074 6865 7265 0a20  Error if there. 
+00014d10: 2020 2069 7320 6e6f 2073 7563 6820 7073     is no such ps
+00014d20: 6574 206f 626a 6563 742c 206f 7220 6966  et object, or if
+00014d30: 2074 6865 7265 2061 7265 206d 756c 7469   there are multi
+00014d40: 706c 6520 6d61 7463 6865 732e 0a20 2020  ple matches..   
+00014d50: 2022 2222 0a20 2020 2070 736d 6174 6368   """.    psmatch
+00014d60: 6573 203d 205b 7073 2066 6f72 2070 7320  es = [ps for ps 
+00014d70: 696e 2074 6173 6b5f 696e 666f 5b22 7073  in task_info["ps
+00014d80: 6574 7322 5d20 6966 2070 735b 2269 6422  ets"] if ps["id"
+00014d90: 5d20 3d3d 2070 7369 645d 0a20 2020 2069  ] == psid].    i
+00014da0: 6620 6c65 6e28 7073 6d61 7463 6865 7329  f len(psmatches)
+00014db0: 203d 3d20 303a 0a20 2020 2020 2020 2072   == 0:.        r
+00014dc0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00014dd0: 2255 6e6b 6e6f 776e 2070 726f 626c 656d  "Unknown problem
+00014de0: 2073 6574 2027 7b7d 2722 2e66 6f72 6d61   set '{}'".forma
+00014df0: 7428 7073 6964 2929 0a20 2020 2065 6c69  t(psid)).    eli
+00014e00: 6620 6c65 6e28 7073 6d61 7463 6865 7329  f len(psmatches)
+00014e10: 203e 2031 3a0a 2020 2020 2020 2020 7261   > 1:.        ra
+00014e20: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00014e30: 4d75 6c74 6970 6c65 2070 726f 626c 656d  Multiple problem
+00014e40: 2073 6574 7320 7769 7468 2049 4420 277b   sets with ID '{
+00014e50: 7d27 2122 2e66 6f72 6d61 7428 7073 6964  }'!".format(psid
+00014e60: 2929 0a20 2020 2065 6c73 653a 0a20 2020  )).    else:.   
+00014e70: 2020 2020 2072 6574 7572 6e20 7073 6d61       return psma
+00014e80: 7463 6865 735b 305d 0a0a 0a64 6566 2067  tches[0]...def g
+00014e90: 6574 5f74 6173 6b5f 6f62 6a28 7461 736b  et_task_obj(task
+00014ea0: 5f69 6e66 6f2c 2070 735f 6f62 6a2c 2074  _info, ps_obj, t
+00014eb0: 6173 6b69 642c 2072 6564 6972 6563 743d  askid, redirect=
+00014ec0: 4578 6365 7074 696f 6e29 3a0a 2020 2020  Exception):.    
+00014ed0: 2222 220a 2020 2020 4578 7472 6163 7473  """.    Extracts
+00014ee0: 2061 2074 6173 6b20 6f62 6a65 6374 2077   a task object w
+00014ef0: 6974 6820 7468 6520 6769 7665 6e20 4944  ith the given ID
+00014f00: 2066 726f 6d20 7468 6520 6769 7665 6e20   from the given 
+00014f10: 7461 736b 2069 6e66 6f20 616e 640a 2020  task info and.  
+00014f20: 2020 7073 6574 206f 626a 6563 7473 2c20    pset objects, 
+00014f30: 6d65 7267 696e 6720 7073 6574 2d73 7065  merging pset-spe
+00014f40: 6369 6669 6320 6669 656c 6473 2077 6974  cific fields wit
+00014f50: 6820 756e 6976 6572 7361 6c20 7461 736b  h universal task
+00014f60: 0a20 2020 2066 6965 6c64 732e 2052 6169  .    fields. Rai
+00014f70: 7365 7320 6120 5661 6c75 6545 7272 6f72  ses a ValueError
+00014f80: 2069 6620 7468 6572 6520 6973 206e 6f20   if there is no 
+00014f90: 6d61 7463 6869 6e67 2074 6173 6b20 6f62  matching task ob
+00014fa0: 6a65 6374 206f 7220 6966 0a20 2020 2074  ject or if.    t
+00014fb0: 6865 7265 2061 7265 206d 756c 7469 706c  here are multipl
+00014fc0: 6520 6d61 7463 6865 732e 0a20 2020 2022  e matches..    "
+00014fd0: 2222 0a20 2020 2075 6e69 7665 7273 616c  "".    universal
+00014fe0: 203d 2074 6173 6b5f 696e 666f 5b22 7461   = task_info["ta
+00014ff0: 736b 7322 5d2e 6765 7428 7461 736b 6964  sks"].get(taskid
+00015000: 2c20 4e6f 6e65 290a 2020 2020 7461 736b  , None).    task
+00015010: 6d61 7463 6865 7320 3d20 5b74 6173 6b20  matches = [task 
+00015020: 666f 7220 7461 736b 2069 6e20 7073 5f6f  for task in ps_o
+00015030: 626a 5b22 7461 736b 7322 5d20 6966 2074  bj["tasks"] if t
+00015040: 6173 6b5b 2269 6422 5d20 3d3d 2074 6173  ask["id"] == tas
+00015050: 6b69 645d 0a20 2020 2069 6620 6c65 6e28  kid].    if len(
+00015060: 7461 736b 6d61 7463 6865 7329 203d 3d20  taskmatches) == 
+00015070: 303a 0a20 2020 2020 2020 2072 6169 7365  0:.        raise
+00015080: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00015090: 2020 2020 2020 2020 2022 5072 6f62 6c65           "Proble
+000150a0: 6d20 7365 7420 7b7d 2068 6173 206e 6f20  m set {} has no 
+000150b0: 7461 736b 2027 7b7d 2722 2e66 6f72 6d61  task '{}'".forma
+000150c0: 7428 7073 5f6f 626a 5b22 6964 225d 2c20  t(ps_obj["id"], 
+000150d0: 7461 736b 6964 290a 2020 2020 2020 2020  taskid).        
+000150e0: 290a 2020 2020 656c 6966 2075 6e69 7665  ).    elif unive
+000150f0: 7273 616c 2069 7320 4e6f 6e65 3a0a 2020  rsal is None:.  
+00015100: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00015110: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00015120: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+00015130: 2020 2020 2020 2250 726f 626c 656d 2073        "Problem s
+00015140: 6574 207b 7d20 6861 7320 6120 7461 736b  et {} has a task
+00015150: 2027 7b7d 2720 6275 7420 7468 6174 2074   '{}' but that t
+00015160: 6173 6b20 6861 7320 6e6f 220a 2020 2020  ask has no".    
+00015170: 2020 2020 2020 2020 2020 2020 2220 756e              " un
+00015180: 6976 6572 7361 6c20 7370 6563 6966 6963  iversal specific
+00015190: 6174 696f 6e2e 220a 2020 2020 2020 2020  ation.".        
+000151a0: 2020 2020 292e 666f 726d 6174 2870 735f      ).format(ps_
+000151b0: 6f62 6a5b 2269 6422 5d2c 2074 6173 6b69  obj["id"], taski
+000151c0: 6429 0a20 2020 2020 2020 2029 0a20 2020  d).        ).   
+000151d0: 2065 6c69 6620 6c65 6e28 7461 736b 6d61   elif len(taskma
+000151e0: 7463 6865 7329 203e 2031 3a0a 2020 2020  tches) > 1:.    
+000151f0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00015200: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00015210: 2020 224d 756c 7469 706c 6520 7461 736b    "Multiple task
+00015220: 7320 696e 2070 726f 626c 656d 2073 6574  s in problem set
+00015230: 207b 7d20 7769 7468 2049 4420 277b 7d27   {} with ID '{}'
+00015240: 2122 2e66 6f72 6d61 7428 0a20 2020 2020  !".format(.     
+00015250: 2020 2020 2020 2020 2020 2070 735f 6f62             ps_ob
+00015260: 6a5b 2269 6422 5d2c 0a20 2020 2020 2020  j["id"],.       
+00015270: 2020 2020 2020 2020 2074 6173 6b69 640a           taskid.
+00015280: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00015290: 2020 2020 2020 290a 2020 2020 656c 7365        ).    else
+000152a0: 3a0a 2020 2020 2020 2020 7265 7375 6c74  :.        result
+000152b0: 203d 207b 7d0a 2020 2020 2020 2020 7265   = {}.        re
+000152c0: 7375 6c74 2e75 7064 6174 6528 756e 6976  sult.update(univ
+000152d0: 6572 7361 6c29 0a20 2020 2020 2020 2072  ersal).        r
+000152e0: 6573 756c 742e 7570 6461 7465 2874 6173  esult.update(tas
+000152f0: 6b6d 6174 6368 6573 5b30 5d29 0a20 2020  kmatches[0]).   
+00015300: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+00015310: 6c74 0a0a 0a64 6566 2063 6865 636b 5f75  lt...def check_u
+00015320: 7365 725f 7072 6976 696c 6567 6573 2861  ser_privileges(a
+00015330: 646d 696e 5f69 6e66 6f2c 2075 7365 726e  dmin_info, usern
+00015340: 616d 6529 3a0a 2020 2020 2222 220a 2020  ame):.    """.  
+00015350: 2020 5265 7475 726e 7320 6120 7061 6972    Returns a pair
+00015360: 2063 6f6e 7461 696e 696e 6720 6120 626f   containing a bo
+00015370: 6f6c 6561 6e20 696e 6469 6361 7469 6e67  olean indicating
+00015380: 2077 6865 7468 6572 2061 2075 7365 7220   whether a user 
+00015390: 6973 2061 6e0a 2020 2020 6164 6d69 6e20  is an.    admin 
+000153a0: 6f72 206e 6f74 2c20 616e 6420 6569 7468  or not, and eith
+000153b0: 6572 204e 6f6e 652c 206f 7220 6120 7374  er None, or a st
+000153c0: 7269 6e67 2069 6e64 6963 6174 696e 6720  ring indicating 
+000153d0: 7468 6520 7573 6572 6e61 6d65 0a20 2020  the username.   
+000153e0: 2074 6861 7420 7468 6520 6769 7665 6e20   that the given 
+000153f0: 7573 6572 2069 7320 6d61 7371 7565 7261  user is masquera
+00015400: 6469 6e67 2061 732e 0a0a 2020 2020 5265  ding as...    Re
+00015410: 7175 6972 6573 2061 646d 696e 2069 6e66  quires admin inf
+00015420: 6f20 6173 2072 6574 7572 6e65 6420 6279  o as returned by
+00015430: 2067 6574 5f61 646d 696e 5f69 6e66 6f2e   get_admin_info.
+00015440: 0a20 2020 2022 2222 0a20 2020 2061 646d  .    """.    adm
+00015450: 696e 7320 3d20 6164 6d69 6e5f 696e 666f  ins = admin_info
+00015460: 2e67 6574 2822 6164 6d69 6e73 222c 205b  .get("admins", [
+00015470: 5d29 0a20 2020 2069 735f 6164 6d69 6e20  ]).    is_admin 
+00015480: 3d20 7573 6572 6e61 6d65 2069 6e20 6164  = username in ad
+00015490: 6d69 6e73 0a0a 2020 2020 6d61 7371 7565  mins..    masque
+000154a0: 7261 6465 5f61 7320 3d20 4e6f 6e65 0a20  rade_as = None. 
+000154b0: 2020 2023 204f 6e6c 7920 6164 6d69 6e73     # Only admins
+000154c0: 2063 616e 2070 6f73 7369 626c 7920 6d61   can possibly ma
+000154d0: 7371 7565 7261 6465 0a20 2020 2069 6620  squerade.    if 
+000154e0: 6973 5f61 646d 696e 3a0a 2020 2020 2020  is_admin:.      
+000154f0: 2020 6d61 7371 7565 7261 6465 5f61 7320    masquerade_as 
+00015500: 3d20 6164 6d69 6e5f 696e 666f 2e67 6574  = admin_info.get
+00015510: 2822 4d41 5351 5545 5241 4445 222c 207b  ("MASQUERADE", {
+00015520: 7d29 2e67 6574 2875 7365 726e 616d 6529  }).get(username)
+00015530: 0a20 2020 2020 2020 2023 2059 6f75 2063  .        # You c
+00015540: 616e 6e6f 7420 6d61 7371 7565 7261 6465  annot masquerade
+00015550: 2061 7320 616e 2061 646d 696e 0a20 2020   as an admin.   
+00015560: 2020 2020 2069 6620 6d61 7371 7565 7261       if masquera
+00015570: 6465 5f61 7320 696e 2061 646d 696e 733a  de_as in admins:
+00015580: 0a20 2020 2020 2020 2020 2020 2066 6c61  .            fla
+00015590: 736b 2e66 6c61 7368 2822 4572 726f 723a  sk.flash("Error:
+000155a0: 2059 6f75 2063 616e 6e6f 7420 6d61 7371   You cannot masq
+000155b0: 7565 7261 6465 2061 7320 616e 6f74 6865  uerade as anothe
+000155c0: 7220 6164 6d69 6e21 2229 0a20 2020 2020  r admin!").     
+000155d0: 2020 2020 2020 206d 6173 7175 6572 6164         masquerad
+000155e0: 655f 6173 203d 204e 6f6e 650a 2020 2020  e_as = None.    
+000155f0: 656c 6966 2061 646d 696e 5f69 6e66 6f2e  elif admin_info.
+00015600: 6765 7428 224d 4153 5155 4552 4144 4522  get("MASQUERADE"
+00015610: 2c20 7b7d 292e 6765 7428 7573 6572 6e61  , {}).get(userna
+00015620: 6d65 293a 0a20 2020 2020 2020 2070 7269  me):.        pri
+00015630: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00015640: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00015650: 2020 2257 6172 6e69 6e67 3a20 5573 6572    "Warning: User
+00015660: 2027 7b7d 2720 6361 6e6e 6f74 206d 6173   '{}' cannot mas
+00015670: 7175 6572 6164 6520 6265 6361 7573 6520  querade because 
+00015680: 7468 6579 2061 7265 220a 2020 2020 2020  they are".      
+00015690: 2020 2020 2020 2020 2b20 226e 6f74 2061          + "not a
+000156a0: 6e20 6164 6d69 6e2e 220a 2020 2020 2020  n admin.".      
+000156b0: 2020 2020 2020 292e 666f 726d 6174 2875        ).format(u
+000156c0: 7365 726e 616d 6529 0a20 2020 2020 2020  sername).       
+000156d0: 2029 0a0a 2020 2020 7265 7475 726e 2028   )..    return (
+000156e0: 6973 5f61 646d 696e 2c20 6d61 7371 7565  is_admin, masque
+000156f0: 7261 6465 5f61 7329 0a0a 0a64 6566 2073  rade_as)...def s
+00015700: 6574 5f70 6175 7365 5f74 696d 6528 6164  et_pause_time(ad
+00015710: 6d69 6e5f 696e 666f 2c20 7461 736b 5f69  min_info, task_i
+00015720: 6e66 6f2c 2075 7365 726e 616d 652c 206d  nfo, username, m
+00015730: 6173 7175 6572 6164 655f 6173 3d4e 6f6e  asquerade_as=Non
+00015740: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
+00015750: 5365 7473 2074 6865 2050 4155 5345 5f41  Sets the PAUSE_A
+00015760: 5420 7661 6c75 6520 696e 2074 6865 2067  T value in the g
+00015770: 6976 656e 2074 6173 6b5f 696e 666f 206f  iven task_info o
+00015780: 626a 6563 7420 6261 7365 6420 6f6e 2061  bject based on a
+00015790: 6e79 0a20 2020 2050 4155 5345 5f55 5345  ny.    PAUSE_USE
+000157a0: 5253 2065 6e74 7269 6573 2066 6f72 2065  RS entries for e
+000157b0: 6974 6865 7220 7468 6520 6769 7665 6e20  ither the given 
+000157c0: 7472 7565 2075 7365 726e 616d 6520 6f72  true username or
+000157d0: 2074 6865 2067 6976 656e 0a20 2020 206d   the given.    m
+000157e0: 6173 7175 6572 6164 6520 7573 6572 6e61  asquerade userna
+000157f0: 6d65 2e20 5468 6520 7061 7573 6520 7661  me. The pause va
+00015800: 6c75 6520 666f 7220 7468 6520 7573 6572  lue for the user
+00015810: 6e61 6d65 206f 7665 7272 6964 6573 2074  name overrides t
+00015820: 6865 0a20 2020 2076 616c 7565 2066 6f72  he.    value for
+00015830: 2074 6865 206d 6173 7175 6572 6164 6564   the masqueraded
+00015840: 2075 7365 722c 2073 6f20 7468 6174 2062   user, so that b
+00015850: 7920 7365 7474 696e 6720 5041 5553 455f  y setting PAUSE_
+00015860: 4154 2066 6f72 2061 6e0a 2020 2020 6164  AT for an.    ad
+00015870: 6d69 6e20 6163 636f 756e 7420 706c 7573  min account plus
+00015880: 2063 7265 6174 696e 6720 6120 6d61 7371   creating a masq
+00015890: 7565 7261 6465 2065 6e74 7279 2c20 796f  uerade entry, yo
+000158a0: 7520 6361 6e20 6163 7420 6173 2061 6e79  u can act as any
+000158b0: 0a20 2020 2075 7365 7220 6174 2061 6e79  .    user at any
+000158c0: 2070 6f69 6e74 2069 6e20 7469 6d65 2e0a   point in time..
+000158d0: 2020 2020 2222 220a 2020 2020 7075 203d      """.    pu =
+000158e0: 2061 646d 696e 5f69 6e66 6f2e 6765 7428   admin_info.get(
+000158f0: 2250 4155 5345 5f55 5345 5253 222c 207b  "PAUSE_USERS", {
+00015900: 7d29 0a20 2020 2069 6620 7573 6572 6e61  }).    if userna
+00015910: 6d65 2069 6e20 7075 3a0a 2020 2020 2020  me in pu:.      
+00015920: 2020 7461 736b 5f69 6e66 6f5b 2250 4155    task_info["PAU
+00015930: 5345 5f41 5422 5d20 3d20 7075 5b75 7365  SE_AT"] = pu[use
+00015940: 726e 616d 655d 0a20 2020 2065 6c69 6620  rname].    elif 
+00015950: 6d61 7371 7565 7261 6465 5f61 7320 696e  masquerade_as in
+00015960: 2070 753a 0a20 2020 2020 2020 2074 6173   pu:.        tas
+00015970: 6b5f 696e 666f 5b22 5041 5553 455f 4154  k_info["PAUSE_AT
+00015980: 225d 203d 2070 755b 6d61 7371 7565 7261  "] = pu[masquera
+00015990: 6465 5f61 735d 0a20 2020 2065 6c69 6620  de_as].    elif 
+000159a0: 2250 4155 5345 5f41 5422 2069 6e20 6164  "PAUSE_AT" in ad
+000159b0: 6d69 6e5f 696e 666f 3a0a 2020 2020 2020  min_info:.      
+000159c0: 2020 7461 736b 5f69 6e66 6f5b 2250 4155    task_info["PAU
+000159d0: 5345 5f41 5422 5d20 3d20 6164 6d69 6e5f  SE_AT"] = admin_
+000159e0: 696e 666f 5b22 5041 5553 455f 4154 225d  info["PAUSE_AT"]
+000159f0: 0a20 2020 2023 2065 6c73 6520 7765 2064  .    # else we d
+00015a00: 6f6e 2774 2073 6574 2050 4155 5345 5f41  on't set PAUSE_A
+00015a10: 5420 6174 2061 6c6c 0a0a 0a64 6566 2061  T at all...def a
+00015a20: 6d65 6e64 5f74 6173 6b5f 696e 666f 2863  mend_task_info(c
+00015a30: 6f75 7273 652c 2073 656d 6573 7465 722c  ourse, semester,
+00015a40: 2074 6173 6b5f 696e 666f 2c20 7573 6572   task_info, user
+00015a50: 6e61 6d65 293a 0a20 2020 2022 2222 0a20  name):.    """. 
+00015a60: 2020 2041 6d65 6e64 7320 7461 736b 2069     Amends task i
+00015a70: 6e66 6f20 6f62 6a65 6374 2077 6974 6820  nfo object with 
+00015a80: 6578 7472 6120 6b65 7973 2069 6e20 6561  extra keys in ea
+00015a90: 6368 2070 7365 7420 746f 2069 6e64 6963  ch pset to indic
+00015aa0: 6174 6520 7073 6574 0a20 2020 2073 7461  ate pset.    sta
+00015ab0: 7465 2e20 416c 736f 2061 6464 7320 7375  te. Also adds su
+00015ac0: 6d6d 6172 7920 696e 666f 726d 6174 696f  mmary informatio
+00015ad0: 6e20 746f 2065 6163 6820 7461 736b 206f  n to each task o
+00015ae0: 6620 7468 6520 7073 6574 2062 6173 6564  f the pset based
+00015af0: 0a20 2020 206f 6e20 7573 6572 2066 6565  .    on user fee
+00015b00: 6462 6163 6b20 6765 6e65 7261 7465 6420  dback generated 
+00015b10: 736f 2066 6172 2e20 416c 736f 2063 6865  so far. Also che
+00015b20: 636b 7320 706f 746c 7563 6b20 696e 666c  cks potluck infl
+00015b30: 6967 6874 0a20 2020 2073 7461 7475 7320  ight.    status 
+00015b40: 616e 6420 6164 6473 2061 2022 7375 626d  and adds a "subm
+00015b50: 6974 7465 6422 206b 6579 2074 6f20 6561  itted" key to ea
+00015b60: 6368 2074 6173 6b20 7768 6572 6520 6170  ch task where ap
+00015b70: 7072 6f70 7269 6174 652e 0a20 2020 2054  propriate..    T
+00015b80: 656d 706c 6174 6520 636f 6465 2073 686f  emplate code sho
+00015b90: 756c 6420 6265 2063 6172 6566 756c 206e  uld be careful n
+00015ba0: 6f74 2074 6f20 7265 7665 616c 2066 6565  ot to reveal fee
+00015bb0: 6462 6163 6b20 696e 666f 206e 6f74 0a20  dback info not. 
+00015bc0: 2020 2077 6172 7261 6e74 6564 2062 7920     warranted by 
+00015bd0: 7468 6520 6375 7272 656e 7420 7073 6574  the current pset
+00015be0: 2073 7461 7465 2e0a 2020 2020 2222 220a   state..    """.
+00015bf0: 2020 2020 666f 7220 7073 6574 2069 6e20      for pset in 
+00015c00: 7461 736b 5f69 6e66 6f5b 2270 7365 7473  task_info["psets
+00015c10: 225d 3a0a 2020 2020 2020 2020 2320 4164  "]:.        # Ad
+00015c20: 6420 7374 6174 7573 2069 6e66 6f20 746f  d status info to
+00015c30: 2074 6865 2070 7365 7420 6f62 6a65 6374   the pset object
+00015c40: 3a0a 2020 2020 2020 2020 616d 656e 645f  :.        amend_
+00015c50: 7073 6574 5f61 6e64 5f74 6173 6b73 2863  pset_and_tasks(c
+00015c60: 6f75 7273 652c 2073 656d 6573 7465 722c  ourse, semester,
+00015c70: 2074 6173 6b5f 696e 666f 2c20 7073 6574   task_info, pset
+00015c80: 2c20 7573 6572 6e61 6d65 290a 0a0a 6465  , username)...de
+00015c90: 6620 616d 656e 645f 7073 6574 5f61 6e64  f amend_pset_and
+00015ca0: 5f74 6173 6b73 280a 2020 2020 636f 7572  _tasks(.    cour
+00015cb0: 7365 2c0a 2020 2020 7365 6d65 7374 6572  se,.    semester
+00015cc0: 2c0a 2020 2020 7461 736b 5f69 6e66 6f2c  ,.    task_info,
+00015cd0: 0a20 2020 2070 7365 745f 6f62 6a2c 0a20  .    pset_obj,. 
+00015ce0: 2020 2075 7365 726e 616d 650a 293a 0a20     username.):. 
+00015cf0: 2020 2022 2222 0a20 2020 2043 616c 6c73     """.    Calls
+00015d00: 2061 6d65 6e64 5f70 7365 7420 6f6e 2074   amend_pset on t
+00015d10: 6865 2067 6976 656e 2070 7365 7420 6f62  he given pset ob
+00015d20: 6a65 6374 2c20 616e 6420 7468 656e 2061  ject, and then a
+00015d30: 6d65 6e64 5f74 6173 6b20 6f6e 0a20 2020  mend_task on.   
+00015d40: 2065 6163 6820 7461 736b 2069 6e20 6974   each task in it
+00015d50: 2c20 6164 6469 6e67 2022 7265 7669 7369  , adding "revisi
+00015d60: 6f6e 2220 656e 7472 6965 7320 746f 2065  on" entries to e
+00015d70: 6163 6820 7461 736b 2077 2f20 616d 656e  ach task w/ amen
+00015d80: 6465 640a 2020 2020 7265 7669 7369 6f6e  ded.    revision
+00015d90: 2069 6e66 6f2e 0a0a 2020 2020 416c 736f   info...    Also
+00015da0: 2061 6464 7320 2270 6f6f 6c5f 7374 6174   adds "pool_stat
+00015db0: 7573 2220 6b65 7973 2074 6f20 6561 6368  us" keys to each
+00015dc0: 2074 6173 6b20 696e 6469 6361 7469 6e67   task indicating
+00015dd0: 2074 6865 2062 6573 7420 7374 6174 7573   the best status
+00015de0: 0a20 2020 206f 6620 616e 7920 7461 736b  .    of any task
+00015df0: 2074 6861 7427 7320 706f 6f6c 6564 2077   that's pooled w
+00015e00: 6974 6820 7468 6174 206f 6e65 2e20 5468  ith that one. Th
+00015e10: 6174 2077 696c 6c20 6265 2027 636f 6d70  at will be 'comp
+00015e20: 6c65 7465 2720 6966 0a20 2020 2074 6865  lete' if.    the
+00015e30: 7265 2773 2061 2063 6f6d 706c 6574 6520  re's a complete 
+00015e40: 7461 736b 2069 6e20 7468 6520 706f 6f6c  task in the pool
+00015e50: 2c20 2773 6f6d 655f 7375 626d 6973 7369  , 'some_submissi
+00015e60: 6f6e 2720 6966 2074 6865 7265 2773 0a20  on' if there's. 
+00015e70: 2020 2061 6e79 2075 6e73 7562 6d69 7474     any unsubmitt
+00015e80: 6564 2074 6173 6b20 696e 2074 6865 2070  ed task in the p
+00015e90: 6f6f 6c2c 2061 6e20 2775 6e73 7562 6d69  ool, an 'unsubmi
+00015ea0: 7474 6564 2720 6966 2074 6865 7265 2061  tted' if there a
+00015eb0: 7265 206e 6f0a 2020 2020 7375 626d 6974  re no.    submit
+00015ec0: 7465 6420 7461 736b 7320 696e 2074 6865  ted tasks in the
+00015ed0: 2070 6f6f 6c2e 0a20 2020 2022 2222 0a20   pool..    """. 
+00015ee0: 2020 2061 6d65 6e64 5f70 7365 7428 636f     amend_pset(co
+00015ef0: 7572 7365 2c20 7365 6d65 7374 6572 2c20  urse, semester, 
+00015f00: 7461 736b 5f69 6e66 6f2c 2070 7365 745f  task_info, pset_
+00015f10: 6f62 6a2c 2075 7365 726e 616d 6529 0a20  obj, username). 
+00015f20: 2020 2023 2041 6464 2073 756d 6d61 7279     # Add summary
+00015f30: 2069 6e66 6f20 746f 2065 6163 6820 7461   info to each ta
+00015f40: 736b 2c20 616e 6420 6475 706c 6963 6174  sk, and duplicat
+00015f50: 6520 666f 7220 7265 7669 7369 6f6e 7320  e for revisions 
+00015f60: 616e 640a 2020 2020 2320 6265 6c61 7465  and.    # belate
+00015f70: 6420 7665 7273 696f 6e73 0a20 2020 2066  d versions.    f
+00015f80: 6f72 2074 6173 6b20 696e 2070 7365 745f  or task in pset_
+00015f90: 6f62 6a5b 2274 6173 6b73 225d 3a0a 2020  obj["tasks"]:.  
+00015fa0: 2020 2020 2020 7265 765f 7461 736b 203d        rev_task =
+00015fb0: 2063 6f70 792e 6465 6570 636f 7079 2874   copy.deepcopy(t
+00015fc0: 6173 6b29 0a20 2020 2020 2020 2062 656c  ask).        bel
+00015fd0: 6174 6564 5f74 6173 6b20 3d20 636f 7079  ated_task = copy
+00015fe0: 2e64 6565 7063 6f70 7928 7461 736b 290a  .deepcopy(task).
+00015ff0: 2020 2020 2020 2020 616d 656e 645f 7461          amend_ta
+00016000: 736b 280a 2020 2020 2020 2020 2020 2020  sk(.            
+00016010: 636f 7572 7365 2c0a 2020 2020 2020 2020  course,.        
+00016020: 2020 2020 7365 6d65 7374 6572 2c0a 2020      semester,.  
+00016030: 2020 2020 2020 2020 2020 7461 736b 5f69            task_i
+00016040: 6e66 6f2c 0a20 2020 2020 2020 2020 2020  nfo,.           
+00016050: 2070 7365 745f 6f62 6a5b 2269 6422 5d2c   pset_obj["id"],
+00016060: 0a20 2020 2020 2020 2020 2020 2072 6576  .            rev
+00016070: 5f74 6173 6b2c 0a20 2020 2020 2020 2020  _task,.         
+00016080: 2020 2075 7365 726e 616d 652c 0a20 2020     username,.   
+00016090: 2020 2020 2020 2020 2022 7265 7669 7369           "revisi
+000160a0: 6f6e 220a 2020 2020 2020 2020 290a 2020  on".        ).  
+000160b0: 2020 2020 2020 7461 736b 5b22 7265 7669        task["revi
+000160c0: 7369 6f6e 225d 203d 2072 6576 5f74 6173  sion"] = rev_tas
+000160d0: 6b0a 0a20 2020 2020 2020 2061 6d65 6e64  k..        amend
+000160e0: 5f74 6173 6b28 0a20 2020 2020 2020 2020  _task(.         
+000160f0: 2020 2063 6f75 7273 652c 0a20 2020 2020     course,.     
+00016100: 2020 2020 2020 2073 656d 6573 7465 722c         semester,
+00016110: 0a20 2020 2020 2020 2020 2020 2074 6173  .            tas
+00016120: 6b5f 696e 666f 2c0a 2020 2020 2020 2020  k_info,.        
+00016130: 2020 2020 7073 6574 5f6f 626a 5b22 6964      pset_obj["id
+00016140: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+00016150: 6265 6c61 7465 645f 7461 736b 2c0a 2020  belated_task,.  
+00016160: 2020 2020 2020 2020 2020 7573 6572 6e61            userna
+00016170: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00016180: 2262 656c 6174 6564 220a 2020 2020 2020  "belated".      
+00016190: 2020 290a 2020 2020 2020 2020 7461 736b    ).        task
+000161a0: 5b22 6265 6c61 7465 6422 5d20 3d20 6265  ["belated"] = be
+000161b0: 6c61 7465 645f 7461 736b 0a0a 2020 2020  lated_task..    
+000161c0: 2020 2020 616d 656e 645f 7461 736b 280a      amend_task(.
+000161d0: 2020 2020 2020 2020 2020 2020 636f 7572              cour
+000161e0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+000161f0: 7365 6d65 7374 6572 2c0a 2020 2020 2020  semester,.      
+00016200: 2020 2020 2020 7461 736b 5f69 6e66 6f2c        task_info,
+00016210: 0a20 2020 2020 2020 2020 2020 2070 7365  .            pse
+00016220: 745f 6f62 6a5b 2269 6422 5d2c 0a20 2020  t_obj["id"],.   
+00016230: 2020 2020 2020 2020 2074 6173 6b2c 0a20           task,. 
+00016240: 2020 2020 2020 2020 2020 2075 7365 726e             usern
+00016250: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00016260: 2022 696e 6974 6961 6c22 0a20 2020 2020   "initial".     
+00016270: 2020 2029 0a0a 2020 2020 2320 4669 6775     )..    # Figu
+00016280: 7265 206f 7574 2062 6573 7420 7374 6174  re out best stat
+00016290: 7573 2069 6e20 6561 6368 2070 6f6f 6c0a  us in each pool.
+000162a0: 2020 2020 706f 6f6c 5f73 7461 7475 7365      pool_statuse
+000162b0: 7320 3d20 7b7d 0a20 2020 2066 6f72 2074  s = {}.    for t
+000162c0: 6173 6b20 696e 2070 7365 745f 6f62 6a5b  ask in pset_obj[
+000162d0: 2274 6173 6b73 225d 3a0a 2020 2020 2020  "tasks"]:.      
+000162e0: 2020 2320 4765 7420 7375 626d 6973 7369    # Get submissi
+000162f0: 6f6e 2073 7461 7475 730a 2020 2020 2020  on status.      
+00016300: 2020 7374 6174 7573 203d 2074 6173 6b5b    status = task[
+00016310: 2273 7562 6d69 7373 696f 6e5f 7374 6174  "submission_stat
+00016320: 7573 225d 0a20 2020 2020 2020 2069 6620  us"].        if 
+00016330: 7374 6174 7573 206e 6f74 2069 6e20 2822  status not in ("
+00016340: 756e 7375 626d 6974 7465 6422 2c20 2263  unsubmitted", "c
+00016350: 6f6d 706c 6574 6522 293a 0a20 2020 2020  omplete"):.     
+00016360: 2020 2020 2020 2073 7461 7475 7320 3d20         status = 
+00016370: 2273 6f6d 655f 7375 626d 6973 7369 6f6e  "some_submission
+00016380: 220a 0a20 2020 2020 2020 2072 6576 5f73  "..        rev_s
+00016390: 7461 7475 7320 3d20 7461 736b 2e67 6574  tatus = task.get
+000163a0: 2822 7265 7669 7369 6f6e 222c 207b 7d29  ("revision", {})
+000163b0: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
+000163c0: 2020 2273 7562 6d69 7373 696f 6e5f 7374    "submission_st
+000163d0: 6174 7573 222c 0a20 2020 2020 2020 2020  atus",.         
+000163e0: 2020 2022 756e 7375 626d 6974 7465 6422     "unsubmitted"
+000163f0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00016400: 2020 2069 6620 7265 765f 7374 6174 7573     if rev_status
+00016410: 206e 6f74 2069 6e20 2822 756e 7375 626d   not in ("unsubm
+00016420: 6974 7465 6422 2c20 2263 6f6d 706c 6574  itted", "complet
+00016430: 6522 293a 0a20 2020 2020 2020 2020 2020  e"):.           
+00016440: 2072 6576 5f73 7461 7475 7320 3d20 2273   rev_status = "s
+00016450: 6f6d 655f 7375 626d 6973 7369 6f6e 220a  ome_submission".
+00016460: 2020 2020 2020 2020 6265 6c5f 7374 6174          bel_stat
+00016470: 7573 203d 2074 6173 6b2e 6765 7428 2262  us = task.get("b
+00016480: 656c 6174 6564 222c 207b 7d29 2e67 6574  elated", {}).get
+00016490: 280a 2020 2020 2020 2020 2020 2020 2273  (.            "s
+000164a0: 7562 6d69 7373 696f 6e5f 7374 6174 7573  ubmission_status
+000164b0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+000164c0: 756e 7375 626d 6974 7465 6422 0a20 2020  unsubmitted".   
+000164d0: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
+000164e0: 6620 6265 6c5f 7374 6174 7573 206e 6f74  f bel_status not
+000164f0: 2069 6e20 2822 756e 7375 626d 6974 7465   in ("unsubmitte
+00016500: 6422 2c20 2263 6f6d 706c 6574 6522 293a  d", "complete"):
+00016510: 0a20 2020 2020 2020 2020 2020 2062 656c  .            bel
+00016520: 5f73 7461 7475 7320 3d20 2273 6f6d 655f  _status = "some_
+00016530: 7375 626d 6973 7369 6f6e 220a 0a20 2020  submission"..   
+00016540: 2020 2020 2023 2046 6967 7572 6520 6f75       # Figure ou
+00016550: 7420 6265 7374 2073 7461 7475 7320 6163  t best status ac
+00016560: 726f 7373 2072 6576 6973 696f 6e2f 6265  ross revision/be
+00016570: 6c61 7465 6420 7068 6173 6573 0a20 2020  lated phases.   
+00016580: 2020 2020 2070 6f69 6e74 7320 3d20 6d61       points = ma
+00016590: 7028 0a20 2020 2020 2020 2020 2020 206c  p(.            l
+000165a0: 616d 6264 6120 783a 207b 0a20 2020 2020  ambda x: {.     
+000165b0: 2020 2020 2020 2020 2020 2022 756e 7375             "unsu
+000165c0: 626d 6974 7465 6422 3a20 302c 0a20 2020  bmitted": 0,.   
+000165d0: 2020 2020 2020 2020 2020 2020 2022 736f               "so
+000165e0: 6d65 5f73 7562 6d69 7373 696f 6e22 3a20  me_submission": 
+000165f0: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
+00016600: 2020 2022 636f 6d70 6c65 7465 223a 2032     "complete": 2
+00016610: 0a20 2020 2020 2020 2020 2020 207d 5b78  .            }[x
+00016620: 5d2c 0a20 2020 2020 2020 2020 2020 205b  ],.            [
+00016630: 7374 6174 7573 2c20 7265 765f 7374 6174  status, rev_stat
+00016640: 7573 2c20 6265 6c5f 7374 6174 7573 5d0a  us, bel_status].
+00016650: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00016660: 2020 7374 6174 7573 203d 207b 0a20 2020    status = {.   
+00016670: 2020 2020 2020 2020 2030 3a20 2275 6e73           0: "uns
+00016680: 7562 6d69 7474 6564 222c 0a20 2020 2020  ubmitted",.     
+00016690: 2020 2020 2020 2031 3a20 2273 6f6d 655f         1: "some_
+000166a0: 7375 626d 6973 7369 6f6e 222c 0a20 2020  submission",.   
+000166b0: 2020 2020 2020 2020 2032 3a20 2263 6f6d           2: "com
+000166c0: 706c 6574 6522 0a20 2020 2020 2020 207d  plete".        }
+000166d0: 5b6d 6178 2870 6f69 6e74 7329 5d0a 0a20  [max(points)].. 
+000166e0: 2020 2020 2020 2023 2046 6967 7572 6520         # Figure 
+000166f0: 6f75 7420 7468 6973 2074 6173 6b27 7320  out this task's 
+00016700: 706f 6f6c 2061 6e64 2075 7064 6174 6520  pool and update 
+00016710: 7468 6520 7363 6f72 6520 666f 7220 7468  the score for th
+00016720: 6174 2070 6f6f 6c0a 2020 2020 2020 2020  at pool.        
+00016730: 706f 6f6c 203d 2074 6173 6b5f 706f 6f6c  pool = task_pool
+00016740: 2874 6173 6b29 0a0a 2020 2020 2020 2020  (task)..        
+00016750: 7072 6576 5f73 7461 7475 7320 3d20 706f  prev_status = po
+00016760: 6f6c 5f73 7461 7475 7365 732e 6765 7428  ol_statuses.get(
+00016770: 706f 6f6c 290a 2020 2020 2020 2020 6966  pool).        if
+00016780: 2028 0a20 2020 2020 2020 2020 2020 2070   (.            p
+00016790: 7265 765f 7374 6174 7573 2069 7320 4e6f  rev_status is No
+000167a0: 6e65 0a20 2020 2020 2020 2020 6f72 2070  ne.         or p
+000167b0: 7265 765f 7374 6174 7573 203d 3d20 2275  rev_status == "u
+000167c0: 6e73 7562 6d69 7474 6564 220a 2020 2020  nsubmitted".    
+000167d0: 2020 2020 206f 7220 7072 6576 5f73 7461       or prev_sta
+000167e0: 7475 7320 3d3d 2022 736f 6d65 5f73 7562  tus == "some_sub
+000167f0: 6d69 7373 696f 6e22 2061 6e64 2073 7461  mission" and sta
+00016800: 7475 7320 3d3d 2022 636f 6d70 6c65 7465  tus == "complete
+00016810: 220a 2020 2020 2020 2020 293a 0a20 2020  ".        ):.   
+00016820: 2020 2020 2020 2020 2070 6f6f 6c5f 7374           pool_st
+00016830: 6174 7573 6573 5b70 6f6f 6c5d 203d 2073  atuses[pool] = s
+00016840: 7461 7475 730a 0a20 2020 2023 204e 6f77  tatus..    # Now
+00016850: 2061 7373 6967 6e20 706f 6f6c 5f73 7461   assign pool_sta
+00016860: 7475 7320 736c 6f74 7320 746f 2065 6163  tus slots to eac
+00016870: 6820 7461 736b 0a20 2020 2066 6f72 2074  h task.    for t
+00016880: 6173 6b20 696e 2070 7365 745f 6f62 6a5b  ask in pset_obj[
+00016890: 2274 6173 6b73 225d 3a0a 2020 2020 2020  "tasks"]:.      
+000168a0: 2020 706f 6f6c 203d 2074 6173 6b5f 706f    pool = task_po
+000168b0: 6f6c 2874 6173 6b29 0a20 2020 2020 2020  ol(task).       
+000168c0: 2074 6173 6b5b 2270 6f6f 6c5f 7374 6174   task["pool_stat
+000168d0: 7573 225d 203d 2070 6f6f 6c5f 7374 6174  us"] = pool_stat
+000168e0: 7573 6573 5b70 6f6f 6c5d 0a0a 0a64 6566  uses[pool]...def
+000168f0: 2061 6d65 6e64 5f70 7365 7428 636f 7572   amend_pset(cour
+00016900: 7365 2c20 7365 6d65 7374 6572 2c20 7461  se, semester, ta
+00016910: 736b 5f69 6e66 6f2c 2070 7365 745f 6f62  sk_info, pset_ob
+00016920: 6a2c 2075 7365 726e 616d 6529 3a0a 2020  j, username):.  
+00016930: 2020 2222 220a 2020 2020 4164 6473 2061    """.    Adds a
+00016940: 2022 7374 6174 7573 2220 6b65 7920 746f   "status" key to
+00016950: 2074 6865 2067 6976 656e 2070 726f 626c   the given probl
+00016960: 656d 2073 6574 206f 626a 6563 7420 2877  em set object (w
+00016970: 6869 6368 2073 686f 756c 6420 6265 0a20  hich should be. 
+00016980: 2020 2070 6172 7420 6f66 2074 6865 2067     part of the g
+00016990: 6976 656e 2074 6173 6b20 696e 666f 292e  iven task info).
+000169a0: 2054 6865 2075 7365 726e 616d 6520 6973   The username is
+000169b0: 2075 7365 6420 746f 206c 6f6f 6b20 7570   used to look up
+000169c0: 0a20 2020 2065 7874 656e 7369 6f6e 2069  .    extension i
+000169d0: 6e66 6f72 6d61 7469 6f6e 2e0a 2020 2020  nformation..    
+000169e0: 2222 220a 2020 2020 696e 6974 6961 6c5f  """.    initial_
+000169f0: 6578 7420 3d20 7374 6f72 6167 652e 6765  ext = storage.ge
+00016a00: 745f 6578 7465 6e73 696f 6e28 0a20 2020  t_extension(.   
+00016a10: 2020 2020 2063 6f75 7273 652c 0a20 2020       course,.   
+00016a20: 2020 2020 2073 656d 6573 7465 722c 0a20       semester,. 
+00016a30: 2020 2020 2020 2075 7365 726e 616d 652c         username,
+00016a40: 0a20 2020 2020 2020 2070 7365 745f 6f62  .        pset_ob
+00016a50: 6a5b 2269 6422 5d2c 0a20 2020 2020 2020  j["id"],.       
+00016a60: 2022 696e 6974 6961 6c22 0a20 2020 2029   "initial".    )
+00016a70: 0a20 2020 2069 6620 696e 6974 6961 6c5f  .    if initial_
+00016a80: 6578 7420 6973 204e 6f6e 653a 0a20 2020  ext is None:.   
+00016a90: 2020 2020 2066 6c61 736b 2e66 6c61 7368       flask.flash
+00016aa0: 280a 2020 2020 2020 2020 2020 2020 2245  (.            "E
+00016ab0: 7272 6f72 2066 6574 6368 696e 6720 696e  rror fetching in
+00016ac0: 6974 6961 6c20 6578 7465 6e73 696f 6e20  itial extension 
+00016ad0: 696e 666f 2028 7472 6561 7469 6e67 2061  info (treating a
+00016ae0: 7320 3029 2e22 0a20 2020 2020 2020 2029  s 0).".        )
+00016af0: 0a20 2020 2020 2020 2069 6e69 7469 616c  .        initial
+00016b00: 5f65 7874 203d 2030 0a0a 2020 2020 7265  _ext = 0..    re
+00016b10: 7669 7369 6f6e 5f65 7874 203d 2073 746f  vision_ext = sto
+00016b20: 7261 6765 2e67 6574 5f65 7874 656e 7369  rage.get_extensi
+00016b30: 6f6e 280a 2020 2020 2020 2020 636f 7572  on(.        cour
+00016b40: 7365 2c0a 2020 2020 2020 2020 7365 6d65  se,.        seme
+00016b50: 7374 6572 2c0a 2020 2020 2020 2020 7573  ster,.        us
+00016b60: 6572 6e61 6d65 2c0a 2020 2020 2020 2020  ername,.        
+00016b70: 7073 6574 5f6f 626a 5b22 6964 225d 2c0a  pset_obj["id"],.
+00016b80: 2020 2020 2020 2020 2272 6576 6973 696f          "revisio
+00016b90: 6e22 0a20 2020 2029 0a20 2020 2069 6620  n".    ).    if 
+00016ba0: 7265 7669 7369 6f6e 5f65 7874 2069 7320  revision_ext is 
+00016bb0: 4e6f 6e65 3a0a 2020 2020 2020 2020 666c  None:.        fl
+00016bc0: 6173 6b2e 666c 6173 6828 0a20 2020 2020  ask.flash(.     
+00016bd0: 2020 2020 2020 2022 4572 726f 7220 6665         "Error fe
+00016be0: 7463 6869 6e67 2072 6576 6973 696f 6e20  tching revision 
+00016bf0: 6578 7465 6e73 696f 6e20 696e 666f 2028  extension info (
+00016c00: 7472 6561 7469 6e67 2061 7320 3029 2e22  treating as 0)."
+00016c10: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00016c20: 2020 2072 6576 6973 696f 6e5f 6578 7420     revision_ext 
+00016c30: 3d20 300a 0a20 2020 2070 7365 745f 6f62  = 0..    pset_ob
+00016c40: 6a5b 2273 7461 7475 7322 5d20 3d20 7073  j["status"] = ps
+00016c50: 6574 5f73 7461 7475 735f 6e6f 7728 0a20  et_status_now(. 
+00016c60: 2020 2020 2020 2075 7365 726e 616d 652c         username,
+00016c70: 0a20 2020 2020 2020 2074 6173 6b5f 696e  .        task_in
+00016c80: 666f 2c0a 2020 2020 2020 2020 7073 6574  fo,.        pset
+00016c90: 5f6f 626a 2c0a 2020 2020 2020 2020 6578  _obj,.        ex
+00016ca0: 7465 6e73 696f 6e73 3d5b 696e 6974 6961  tensions=[initia
+00016cb0: 6c5f 6578 742c 2072 6576 6973 696f 6e5f  l_ext, revision_
+00016cc0: 6578 745d 0a20 2020 2029 0a0a 0a64 6566  ext].    )...def
+00016cd0: 2061 6d65 6e64 5f74 6173 6b28 636f 7572   amend_task(cour
+00016ce0: 7365 2c20 7365 6d65 7374 6572 2c20 7461  se, semester, ta
+00016cf0: 736b 5f69 6e66 6f2c 2070 7369 642c 2074  sk_info, psid, t
+00016d00: 6173 6b2c 2075 7365 726e 616d 652c 2070  ask, username, p
+00016d10: 6861 7365 293a 0a20 2020 2022 2222 0a20  hase):.    """. 
+00016d20: 2020 2041 6464 7320 7461 736b 2d73 7461     Adds task-sta
+00016d30: 7465 2d72 656c 6174 6564 206b 6579 7320  te-related keys 
+00016d40: 746f 2074 6865 2067 6976 656e 2074 6173  to the given tas
+00016d50: 6b20 6f62 6a65 6374 2e20 5468 6520 666f  k object. The fo
+00016d60: 6c6c 6f77 696e 670a 2020 2020 6b65 7973  llowing.    keys
+00016d70: 2061 7265 2061 6464 6564 3a0a 0a20 2020   are added:..   
+00016d80: 202d 2022 6665 6564 6261 636b 5f73 756d   - "feedback_sum
+00016d90: 6d61 7279 223a 2041 2066 6565 6462 6163  mary": A feedbac
+00016da0: 6b20 7375 6d6d 6172 7920 6f62 6a65 6374  k summary object
+00016db0: 2028 7365 650a 2020 2020 2020 2020 6067   (see.        `g
+00016dc0: 6574 5f66 6565 6462 6163 6b5f 7375 6d6d  et_feedback_summ
+00016dd0: 6172 7960 292e 0a20 2020 202d 2022 7469  ary`)..    - "ti
+00016de0: 6d65 5f73 7065 6e74 223a 2054 6865 2074  me_spent": The t
+00016df0: 696d 6520 7370 656e 7420 696e 666f 2074  ime spent info t
+00016e00: 6861 7420 7468 6520 7573 6572 2065 6e74  hat the user ent
+00016e10: 6572 6564 2066 6f72 2074 696d 650a 2020  ered for time.  
+00016e20: 2020 2020 2020 7370 656e 7420 7768 656e        spent when
+00016e30: 2073 7562 6d69 7474 696e 6720 7468 6520   submitting the 
+00016e40: 7461 736b 2028 7365 650a 2020 2020 2020  task (see.      
+00016e50: 2020 6070 6f74 6c75 636b 5f61 7070 2e73    `potluck_app.s
+00016e60: 746f 7261 6765 2e66 6574 6368 5f74 696d  torage.fetch_tim
+00016e70: 655f 7370 656e 7460 2066 6f72 2074 6865  e_spent` for the
+00016e80: 2066 6f72 6d61 7429 2e20 5769 6c6c 2062   format). Will b
+00016e90: 650a 2020 2020 2020 2020 4e6f 6e65 2069  e.        None i
+00016ea0: 6620 7468 6174 2069 6e66 6f20 6973 6e27  f that info isn'
+00016eb0: 7420 6176 6169 6c61 626c 652e 0a20 2020  t available..   
+00016ec0: 202d 2022 7375 626d 6974 7465 6422 3a20   - "submitted": 
+00016ed0: 5472 7565 2069 6620 7468 6520 7573 6572  True if the user
+00016ee0: 2068 6173 2061 7474 656d 7074 6564 2073   has attempted s
+00016ef0: 7562 6d69 7373 696f 6e20 2865 7665 6e20  ubmission (even 
+00016f00: 6966 0a20 2020 2020 2020 2074 6865 7265  if.        there
+00016f10: 2077 6572 6520 7072 6f62 6c65 6d73 2920   were problems) 
+00016f20: 6f72 2069 6620 7765 2068 6176 6520 6665  or if we have fe
+00016f30: 6564 6261 636b 2066 6f72 2074 6865 6d20  edback for them 
+00016f40: 2872 6567 6172 646c 6573 730a 2020 2020  (regardless.    
+00016f50: 2020 2020 6f66 2061 6e79 7468 696e 6720      of anything 
+00016f60: 656c 7365 292e 0a20 2020 202d 2022 7375  else)..    - "su
+00016f70: 626d 6974 7465 645f 6174 223a 2041 2060  bmitted_at": A `
+00016f80: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+00016f90: 6560 206f 626a 6563 7420 7265 7072 6573  e` object repres
+00016fa0: 656e 7469 6e67 2077 6865 6e0a 2020 2020  enting when.    
+00016fb0: 2020 2020 7468 6520 7375 626d 6973 7369      the submissi
+00016fc0: 6f6e 2077 6173 2072 6563 6569 7665 642c  on was received,
+00016fd0: 206f 7220 4e6f 6e65 2069 6620 7468 6572   or None if ther
+00016fe0: 6520 6973 206e 6f20 7265 636f 7264 6564  e is no recorded
+00016ff0: 0a20 2020 2020 2020 2073 7562 6d69 7373  .        submiss
+00017000: 696f 6e2e 0a20 2020 202d 2022 6576 616c  ion..    - "eval
+00017010: 5f65 6c61 7073 6564 223a 2041 2060 6461  _elapsed": A `da
+00017020: 7465 7469 6d65 2e74 696d 6564 656c 7461  tetime.timedelta
+00017030: 6020 7468 6174 2072 6570 7265 7365 6e74  ` that represent
+00017040: 7320 7468 6520 7469 6d65 0a20 2020 2020  s the time.     
+00017050: 2020 2065 6c61 7073 6564 2073 696e 6365     elapsed since
+00017060: 2065 7661 6c75 6174 696f 6e20 7761 7320   evaluation was 
+00017070: 7374 6172 7465 6420 666f 7220 7468 6520  started for the 
+00017080: 7375 626d 6973 7369 6f6e 2028 696e 0a20  submission (in. 
+00017090: 2020 2020 2020 2070 6f73 7369 626c 7920         possibly 
+000170a0: 6672 6163 7469 6f6e 616c 2073 6563 6f6e  fractional secon
+000170b0: 6473 292e 0a20 2020 202d 2022 6576 616c  ds)..    - "eval
+000170c0: 5f74 696d 656f 7574 223a 2041 2060 6461  _timeout": A `da
+000170d0: 7465 7469 6d65 2e74 696d 6564 656c 7461  tetime.timedelta
+000170e0: 6020 7265 7072 6573 656e 7469 6e67 2074  ` representing t
+000170f0: 6865 206e 756d 6265 720a 2020 2020 2020  he number.      
+00017100: 2020 6f66 2073 6563 6f6e 6473 2062 6566    of seconds bef
+00017110: 6f72 6520 7468 6520 6576 616c 7561 7469  ore the evaluati
+00017120: 6f6e 2070 726f 6365 7373 2073 686f 756c  on process shoul
+00017130: 6420 7469 6d65 206f 7574 2e0a 2020 2020  d time out..    
+00017140: 2d20 2265 7661 6c5f 7374 6174 7573 223a  - "eval_status":
+00017150: 2054 6865 2073 7461 7475 7320 6f66 2074   The status of t
+00017160: 6865 2065 7661 6c75 6174 696f 6e20 7072  he evaluation pr
+00017170: 6f63 6573 7320 2873 6565 0a20 2020 2020  ocess (see.     
+00017180: 2020 2060 6765 745f 696e 666c 6967 6874     `get_inflight
+00017190: 6029 2e0a 2020 2020 2d20 2273 7562 6d69  `)..    - "submi
+000171a0: 7373 696f 6e5f 7374 6174 7573 223a 2041  ssion_status": A
+000171b0: 2073 7472 696e 6720 7265 7072 6573 656e   string represen
+000171c0: 7469 6e67 2074 6865 2073 7461 7475 7320  ting the status 
+000171d0: 6f66 2074 6865 0a20 2020 2020 2020 2073  of the.        s
+000171e0: 7562 6d69 7373 696f 6e20 6f76 6572 616c  ubmission overal
+000171f0: 6c2e 204f 6e65 206f 663a 0a20 2020 2020  l. One of:.     
+00017200: 2020 202d 2022 756e 7375 626d 6974 7465     - "unsubmitte
+00017210: 6422 3a20 6e6f 2073 7562 6d69 7373 696f  d": no submissio
+00017220: 6e20 7965 742e 0a20 2020 2020 2020 202d  n yet..        -
+00017230: 2022 696e 666c 6967 6874 223a 2068 6173   "inflight": has
+00017240: 2062 6565 6e20 7375 626d 6974 7465 643b   been submitted;
+00017250: 2073 7469 6c6c 2062 6569 6e67 2065 7661   still being eva
+00017260: 6c75 6174 6564 2e0a 2020 2020 2020 2020  luated..        
+00017270: 2d20 2275 6e70 726f 6365 7373 6564 223a  - "unprocessed":
+00017280: 2065 7661 6c75 6174 6564 2062 7574 2074   evaluated but t
+00017290: 6865 7265 2773 2061 6e20 6973 7375 6520  here's an issue 
+000172a0: 2865 7661 6c75 6174 696f 6e0a 2020 2020  (evaluation.    
+000172b0: 2020 2020 2020 2020 6372 6173 6865 6420          crashed 
+000172c0: 6f72 2065 6c73 6568 6f77 2066 6169 6c65  or elsehow faile
+000172d0: 6420 746f 2067 656e 6572 6174 6520 6665  d to generate fe
+000172e0: 6564 6261 636b 292e 0a20 2020 2020 2020  edback)..       
+000172f0: 202d 2022 6973 7375 6522 3a20 6576 616c   - "issue": eval
+00017300: 7561 7465 6420 6275 7420 7468 6572 6527  uated but there'
+00017310: 7320 616e 2069 7373 7565 2028 6576 616c  s an issue (eval
+00017320: 7561 7469 6f6e 2077 6172 6e69 6e67 206f  uation warning o
+00017330: 720a 2020 2020 2020 2020 2020 2020 2769  r.            'i
+00017340: 6e63 6f6d 706c 6574 6527 2065 7661 6c75  ncomplete' evalu
+00017350: 6174 696f 6e20 7265 7375 6c74 2e29 0a20  ation result.). 
+00017360: 2020 2020 2020 202d 2022 636f 6d70 6c65         - "comple
+00017370: 7465 223a 2045 7661 6c75 6174 6564 2061  te": Evaluated a
+00017380: 6e64 2074 6865 7265 2773 206e 6f20 6d61  nd there's no ma
+00017390: 6a6f 7220 6973 7375 6520 2867 7261 6465  jor issue (grade
+000173a0: 206d 6179 206f 720a 2020 2020 2020 2020   may or.        
+000173b0: 2020 2020 6d61 7920 6e6f 7420 6265 2070      may not be p
+000173c0: 6572 6665 6374 2c20 6275 7420 6974 2062  erfect, but it b
+000173d0: 6574 7465 7220 7468 616e 2022 696e 636f  etter than "inco
+000173e0: 6d70 6c65 7465 2229 2e0a 2020 2020 2d20  mplete")..    - 
+000173f0: 2273 7562 6d69 7373 696f 6e5f 6963 6f6e  "submission_icon
+00017400: 223a 2041 206f 6e65 2d63 6861 7261 6374  ": A one-charact
+00017410: 6572 2073 7472 696e 6720 7573 6564 2074  er string used t
+00017420: 6f20 7265 7072 6573 656e 7420 7468 650a  o represent the.
+00017430: 2020 2020 2020 2020 7375 626d 6973 7369          submissi
+00017440: 6f6e 2073 7461 7475 732e 0a20 2020 202d  on status..    -
+00017450: 2022 7375 626d 6973 7369 6f6e 5f64 6573   "submission_des
+00017460: 6322 3a20 4120 6272 6965 6620 6875 6d61  c": A brief huma
+00017470: 6e2d 7265 6164 6162 6c65 2076 6572 7369  n-readable versi
+00017480: 6f6e 206f 6620 7468 650a 2020 2020 2020  on of the.      
+00017490: 2020 7375 626d 6973 7369 6f6e 2073 7461    submission sta
+000174a0: 7475 732e 0a20 2020 202d 2022 6772 6164  tus..    - "grad
+000174b0: 6522 3a20 4120 6e75 6d65 7269 6361 6c20  e": A numerical 
+000174c0: 6772 6164 6520 7661 6c75 652c 2064 6572  grade value, der
+000174d0: 6976 6564 2066 726f 6d20 7468 6520 6576  ived from the ev
+000174e0: 616c 7561 7469 6f6e 2076 6961 0a20 2020  aluation via.   
+000174f0: 2020 2020 2074 6865 2045 5641 4c55 4154       the EVALUAT
+00017500: 494f 4e5f 5343 4f52 4553 2064 6963 7469  ION_SCORES dicti
+00017510: 6f6e 6172 7920 6465 6669 6e65 6420 696e  onary defined in
+00017520: 2074 6865 2063 6f6e 6669 6720 6669 6c65   the config file
+00017530: 2e20 4966 0a20 2020 2020 2020 206e 6f20  . If.        no 
+00017540: 6772 6164 6520 6861 7320 6265 656e 2061  grade has been a
+00017550: 7373 6967 6e65 642c 2069 7420 7769 6c6c  ssigned, it will
+00017560: 2062 6520 7468 6520 7374 7269 6e67 2027   be the string '
+00017570: 3f27 2069 6e73 7465 6164 206f 660a 2020  ?' instead of.  
+00017580: 2020 2020 2020 6120 6e75 6d62 6572 2e20        a number. 
+00017590: 4772 6164 6520 6f76 6572 7269 6465 7320  Grade overrides 
+000175a0: 6172 6520 6661 6374 6f72 6564 2069 6e20  are factored in 
+000175b0: 6966 2070 7265 7365 6e74 2e0a 2020 2020  if present..    
+000175c0: 2d20 2267 7261 6465 5f6f 7665 7272 6964  - "grade_overrid
+000175d0: 6465 6e22 3a20 4120 626f 6f6c 6561 6e20  den": A boolean 
+000175e0: 696e 6469 6361 7469 6e67 2077 6865 7468  indicating wheth
+000175f0: 6572 2074 6865 2067 7261 6465 2077 6173  er the grade was
+00017600: 0a20 2020 2020 2020 206f 7665 7272 6964  .        overrid
+00017610: 6465 6e20 6f72 206e 6f74 2e20 5769 6c6c  den or not. Will
+00017620: 2062 6520 7472 7565 2077 6865 6e20 7468   be true when th
+00017630: 6572 6527 7320 616e 206f 7665 7272 6964  ere's an overrid
+00017640: 6520 6163 7469 7665 0a20 2020 2020 2020  e active.       
+00017650: 2065 7665 6e20 6966 2074 6865 206f 7665   even if the ove
+00017660: 7272 6964 6520 696e 6469 6361 7465 7320  rride indicates 
+00017670: 7468 6520 7361 6d65 2073 636f 7265 2061  the same score a
+00017680: 7320 7468 6520 6175 746f 6d61 7469 630a  s the automatic.
+00017690: 2020 2020 2020 2020 6772 6164 652e 0a20          grade.. 
+000176a0: 2020 202d 2022 7469 6d65 6c69 6e65 7373     - "timeliness
+000176b0: 223a 2041 206e 756d 6572 6963 616c 2073  ": A numerical s
+000176c0: 636f 7265 2076 616c 7565 2066 6f72 2074  core value for t
+000176d0: 696d 656c 696e 6573 7320 706f 696e 7473  imeliness points
+000176e0: 2c20 6f6e 6c79 0a20 2020 2020 2020 2070  , only.        p
+000176f0: 7265 7365 6e74 2077 6865 6e20 616e 206f  resent when an o
+00017700: 7665 7272 6964 6520 6861 7320 6265 656e  verride has been
+00017710: 2069 7373 7565 642e 204e 6f72 6d61 6c6c   issued. Normall
+00017720: 792c 2074 696d 656c 696e 6573 730a 2020  y, timeliness.  
+00017730: 2020 2020 2020 706f 696e 7473 2061 7265        points are
+00017740: 2063 6f6d 7075 7465 6420 666f 7220 616e   computed for an
+00017750: 2061 6c72 6561 6479 2d61 7567 6d65 6e74   already-augment
+00017760: 6564 2074 6173 6b20 6261 7365 6420 6f6e  ed task based on
+00017770: 2074 6865 0a20 2020 2020 2020 2069 6e69   the.        ini
+00017780: 7469 616c 2f72 6576 6973 6564 2f62 656c  tial/revised/bel
+00017790: 6174 6564 2073 7562 6d69 7373 696f 6e20  ated submission 
+000177a0: 7374 6174 7573 6573 2e0a 2020 2020 2d20  statuses..    - 
+000177b0: 2274 696d 656c 696e 6573 735f 6f76 6572  "timeliness_over
+000177c0: 7269 6464 656e 223a 2041 2062 6f6f 6c65  ridden": A boole
+000177d0: 616e 2069 6e64 6963 6174 696e 6720 7768  an indicating wh
+000177e0: 6574 6865 7220 7468 650a 2020 2020 2020  ether the.      
+000177f0: 2020 7469 6d65 6c69 6e65 7373 2073 636f    timeliness sco
+00017800: 7265 2077 6173 206f 7665 7272 6964 6465  re was overridde
+00017810: 6e20 6f72 206e 6f74 2e0a 2020 2020 2d20  n or not..    - 
+00017820: 226e 6f74 6573 223a 2041 2073 7472 696e  "notes": A strin
+00017830: 6720 696e 6469 6361 7469 6e67 2074 6865  g indicating the
+00017840: 206d 6172 6b64 6f77 6e20 736f 7572 6365   markdown source
+00017850: 2066 6f72 2063 7573 746f 6d20 6e6f 7465   for custom note
+00017860: 730a 2020 2020 2020 2020 6170 706c 6965  s.        applie
+00017870: 6420 746f 2074 6865 2074 6173 6b20 6279  d to the task by
+00017880: 2061 6e20 6576 616c 7561 746f 722e 0a20   an evaluator.. 
+00017890: 2020 202d 2022 6e6f 7465 735f 6874 6d6c     - "notes_html
+000178a0: 223a 2041 2073 7472 696e 6720 6f66 2048  ": A string of H
+000178b0: 544d 4c20 636f 6465 2072 656e 6465 7265  TML code rendere
+000178c0: 6420 6672 6f6d 2074 6865 206e 6f74 6573  d from the notes
+000178d0: 0a20 2020 2020 2020 206d 6172 6b64 6f77  .        markdow
+000178e0: 6e2e 0a20 2020 202d 2022 6d61 785f 7363  n..    - "max_sc
+000178f0: 6f72 6522 3a20 4120 6e75 6d62 6572 2072  ore": A number r
+00017900: 6570 7265 7365 6e74 696e 6720 7468 6520  epresenting the 
+00017910: 6d61 7869 6d75 6d20 7363 6f72 6520 706f  maximum score po
+00017920: 7373 6962 6c65 0a20 2020 2020 2020 2062  ssible.        b
+00017930: 6173 6564 206f 6e20 7468 6520 7068 6173  ased on the phas
+00017940: 6520 6f66 2074 6865 2073 7562 6d69 7373  e of the submiss
+00017950: 696f 6e2c 2065 6974 6865 7220 5343 4f52  ion, either SCOR
+00017960: 455f 4241 5349 5320 666f 720a 2020 2020  E_BASIS for.    
+00017970: 2020 2020 696e 6974 6961 6c20 7375 626d      initial subm
+00017980: 6973 7369 6f6e 732c 2052 4556 4953 494f  issions, REVISIO
+00017990: 4e5f 4d41 585f 5343 4f52 4520 666f 7220  N_MAX_SCORE for 
+000179a0: 7265 7669 7369 6f6e 732c 206f 720a 2020  revisions, or.  
+000179b0: 2020 2020 2020 4245 4c41 5445 445f 4d41        BELATED_MA
+000179c0: 585f 5343 4f52 4520 666f 7220 6265 6c61  X_SCORE for bela
+000179d0: 7465 6420 7375 626d 6973 7369 6f6e 732e  ted submissions.
+000179e0: 0a20 2020 202d 2022 6d61 785f 7265 7669  .    - "max_revi
+000179f0: 7369 6f6e 5f73 636f 7265 223a 2041 206e  sion_score": A n
+00017a00: 756d 6265 7220 7265 7072 6573 656e 7469  umber representi
+00017a10: 6e67 2074 6865 206d 6178 2073 636f 7265  ng the max score
+00017a20: 2070 6f73 7369 626c 650a 2020 2020 2020   possible.      
+00017a30: 2020 6f6e 2061 2072 6576 6973 696f 6e20    on a revision 
+00017a40: 6f66 2074 6869 7320 7461 736b 2028 7265  of this task (re
+00017a50: 6761 7264 6c65 7373 206f 6620 7768 6574  gardless of whet
+00017a60: 6865 7220 7468 6973 2069 7320 616e 0a20  her this is an. 
+00017a70: 2020 2020 2020 2069 6e69 7469 616c 206f         initial o
+00017a80: 7220 7265 7669 7365 6420 7375 626d 6973  r revised submis
+00017a90: 7369 6f6e 290a 2020 2020 2d20 226d 6178  sion).    - "max
+00017aa0: 5f62 656c 6174 6564 5f73 636f 7265 223a  _belated_score":
+00017ab0: 2041 206e 756d 6265 7220 7265 7072 6573   A number repres
+00017ac0: 656e 7469 6e67 2074 6865 206d 6178 2073  enting the max s
+00017ad0: 636f 7265 2070 6f73 7369 626c 650a 2020  core possible.  
+00017ae0: 2020 2020 2020 6f6e 2061 2062 656c 6174        on a belat
+00017af0: 6564 2073 7562 6d69 7373 696f 6e20 6f66  ed submission of
+00017b00: 2074 6869 7320 7461 736b 2028 7265 6761   this task (rega
+00017b10: 7264 6c65 7373 206f 6620 7768 6574 6865  rdless of whethe
+00017b20: 7220 7468 6973 0a20 2020 2020 2020 2069  r this.        i
+00017b30: 7320 616e 2069 6e69 7469 616c 2c20 7265  s an initial, re
+00017b40: 7669 7365 642c 206f 7220 6265 6c61 7465  vised, or belate
+00017b50: 6420 7375 626d 6973 7369 6f6e 290a 2020  d submission).  
+00017b60: 2020 2222 220a 2020 2020 2320 4665 7463    """.    # Fetc
+00017b70: 6820 6261 7369 6320 696e 666f 0a20 2020  h basic info.   
+00017b80: 2074 6173 6b5b 2266 6565 6462 6163 6b5f   task["feedback_
+00017b90: 7375 6d6d 6172 7922 5d20 3d20 7374 6f72  summary"] = stor
+00017ba0: 6167 652e 6765 745f 6665 6564 6261 636b  age.get_feedback
+00017bb0: 5f73 756d 6d61 7279 280a 2020 2020 2020  _summary(.      
+00017bc0: 2020 636f 7572 7365 2c0a 2020 2020 2020    course,.      
+00017bd0: 2020 7365 6d65 7374 6572 2c0a 2020 2020    semester,.    
+00017be0: 2020 2020 7461 736b 5f69 6e66 6f2c 0a20      task_info,. 
+00017bf0: 2020 2020 2020 2075 7365 726e 616d 652c         username,
+00017c00: 0a20 2020 2020 2020 2070 6861 7365 2c0a  .        phase,.
+00017c10: 2020 2020 2020 2020 7073 6964 2c0a 2020          psid,.  
+00017c20: 2020 2020 2020 7461 736b 5b22 6964 225d        task["id"]
+00017c30: 0a20 2020 2029 0a20 2020 2074 6173 6b5b  .    ).    task[
+00017c40: 2274 696d 655f 7370 656e 7422 5d20 3d20  "time_spent"] = 
+00017c50: 7374 6f72 6167 652e 6665 7463 685f 7469  storage.fetch_ti
+00017c60: 6d65 5f73 7065 6e74 280a 2020 2020 2020  me_spent(.      
+00017c70: 2020 636f 7572 7365 2c0a 2020 2020 2020    course,.      
+00017c80: 2020 7365 6d65 7374 6572 2c0a 2020 2020    semester,.    
+00017c90: 2020 2020 7573 6572 6e61 6d65 2c0a 2020      username,.  
+00017ca0: 2020 2020 2020 7068 6173 652c 0a20 2020        phase,.   
+00017cb0: 2020 2020 2070 7369 642c 0a20 2020 2020       psid,.     
+00017cc0: 2020 2074 6173 6b5b 2269 6422 5d0a 2020     task["id"].  
+00017cd0: 2020 290a 0a20 2020 2023 2047 6574 2073    )..    # Get s
+00017ce0: 7562 6d69 7474 6564 2076 616c 7565 0a20  ubmitted value. 
+00017cf0: 2020 2023 204e 6f74 6520 7468 6174 2077     # Note that w
+00017d00: 6520 6865 6467 6520 6865 7265 2061 6761  e hedge here aga
+00017d10: 696e 7374 2074 6865 2070 6f73 7369 6269  inst the possibi
+00017d20: 6c69 7479 2074 6861 7420 7468 6520 6665  lity that the fe
+00017d30: 6564 6261 636b 0a20 2020 2023 2073 756d  edback.    # sum
+00017d40: 6d61 7279 2069 736e 2774 2072 6561 6461  mary isn't reada
+00017d50: 626c 6520 7369 6e63 6520 736f 6d65 206b  ble since some k
+00017d60: 696e 6473 206f 6620 6261 6420 6372 6173  inds of bad cras
+00017d70: 6865 7320 6f66 2074 6865 0a20 2020 2023  hes of the.    #
+00017d80: 2065 7661 6c75 6174 6f72 2063 616e 2063   evaluator can c
+00017d90: 6175 7365 2074 6861 7420 746f 2068 6170  ause that to hap
+00017da0: 7065 6e20 2865 2e67 2e2c 2073 7475 6465  pen (e.g., stude
+00017db0: 6e74 2061 6363 6964 656e 7461 6c6c 790a  nt accidentally.
+00017dc0: 2020 2020 2320 6d6f 6e6b 6579 2d70 6174      # monkey-pat
+00017dd0: 6368 6573 206a 736f 6e2e 6475 6d70 2073  ches json.dump s
+00017de0: 6f20 7468 6174 206e 6f20 7265 706f 7274  o that no report
+00017df0: 2063 616e 2062 6520 7772 6974 7465 6e29   can be written)
+00017e00: 2e0a 2020 2020 7461 736b 5b22 7375 626d  ..    task["subm
+00017e10: 6974 7465 6422 5d20 3d20 2874 6173 6b2e  itted"] = (task.
+00017e20: 6765 7428 2266 6565 6462 6163 6b5f 7375  get("feedback_su
+00017e30: 6d6d 6172 7922 2920 6f72 207b 7d29 2e67  mmary") or {}).g
+00017e40: 6574 2822 7375 626d 6974 7465 6422 290a  et("submitted").
+00017e50: 0a20 2020 2023 2047 6574 2069 6e66 6c69  .    # Get infli
+00017e60: 6768 7420 696e 666f 2073 6f20 7765 206b  ght info so we k
+00017e70: 6e6f 7720 6162 6f75 7420 7469 6d65 6f75  now about timeou
+00017e80: 7473 0a20 2020 2074 732c 206c 6f67 6669  ts.    ts, logfi
+00017e90: 6c65 2c20 7265 706f 7274 6669 6c65 2c20  le, reportfile, 
+00017ea0: 7374 6174 7573 203d 2073 746f 7261 6765  status = storage
+00017eb0: 2e67 6574 5f69 6e66 6c69 6768 7428 0a20  .get_inflight(. 
+00017ec0: 2020 2020 2020 2063 6f75 7273 652c 0a20         course,. 
+00017ed0: 2020 2020 2020 2073 656d 6573 7465 722c         semester,
+00017ee0: 0a20 2020 2020 2020 2075 7365 726e 616d  .        usernam
+00017ef0: 652c 0a20 2020 2020 2020 2070 6861 7365  e,.        phase
+00017f00: 2c0a 2020 2020 2020 2020 7073 6964 2c0a  ,.        psid,.
+00017f10: 2020 2020 2020 2020 7461 736b 5b22 6964          task["id
+00017f20: 225d 0a20 2020 2029 0a0a 2020 2020 2320  "].    )..    # 
+00017f30: 4765 7420 6375 7272 656e 7420 7469 6d65  Get current time
+00017f40: 2028 494e 2055 5443 290a 2020 2020 6e6f   (IN UTC).    no
+00017f50: 7720 3d20 706f 746c 7563 6b2e 7469 6d65  w = potluck.time
+00017f60: 5f75 7469 6c73 2e6e 6f77 2829 0a0a 2020  _utils.now()..  
+00017f70: 2020 2320 5469 6d65 2073 7562 6d69 7474    # Time submitt
+00017f80: 6564 2061 6e64 2074 696d 6520 656c 6170  ed and time elap
+00017f90: 7365 6420 7369 6e63 6520 7375 626d 6973  sed since submis
+00017fa0: 7369 6f6e 0a20 2020 2069 6620 7473 203d  sion.    if ts =
+00017fb0: 3d20 2265 7272 6f72 223a 0a20 2020 2020  = "error":.     
+00017fc0: 2020 2074 6173 6b5b 2273 7562 6d69 7474     task["submitt
+00017fd0: 6564 5f61 7422 5d20 3d20 2275 6e6b 6e6f  ed_at"] = "unkno
+00017fe0: 776e 220a 2020 2020 2020 2020 7461 736b  wn".        task
+00017ff0: 5b22 6576 616c 5f65 6c61 7073 6564 225d  ["eval_elapsed"]
+00018000: 203d 2022 756e 6b6e 6f77 6e22 0a20 2020   = "unknown".   
+00018010: 2065 6c69 6620 7473 2069 7320 6e6f 7420   elif ts is not 
+00018020: 4e6f 6e65 3a0a 2020 2020 2020 2020 7375  None:.        su
+00018030: 626d 6974 5f74 696d 6520 3d20 706f 746c  bmit_time = potl
+00018040: 7563 6b2e 7469 6d65 5f75 7469 6c73 2e6c  uck.time_utils.l
+00018050: 6f63 616c 5f74 696d 6528 0a20 2020 2020  ocal_time(.     
+00018060: 2020 2020 2020 2074 6173 6b5f 696e 666f         task_info
+00018070: 2c0a 2020 2020 2020 2020 2020 2020 706f  ,.            po
+00018080: 746c 7563 6b2e 7469 6d65 5f75 7469 6c73  tluck.time_utils
+00018090: 2e74 696d 655f 6672 6f6d 5f74 696d 6573  .time_from_times
+000180a0: 7472 696e 6728 7473 290a 2020 2020 2020  tring(ts).      
+000180b0: 2020 290a 2020 2020 2020 2020 7461 736b    ).        task
+000180c0: 5b22 7375 626d 6974 7465 645f 6174 225d  ["submitted_at"]
+000180d0: 203d 2073 7562 6d69 745f 7469 6d65 0a20   = submit_time. 
+000180e0: 2020 2020 2020 2074 6173 6b5b 2265 7661         task["eva
+000180f0: 6c5f 656c 6170 7365 6422 5d20 3d20 6e6f  l_elapsed"] = no
+00018100: 7720 2d20 7375 626d 6974 5f74 696d 650a  w - submit_time.
+00018110: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00018120: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00018130: 2020 2073 7562 6d69 745f 7469 6d65 203d     submit_time =
+00018140: 2070 6f74 6c75 636b 2e74 696d 655f 7574   potluck.time_ut
+00018150: 696c 732e 6c6f 6361 6c5f 7469 6d65 280a  ils.local_time(.
+00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018170: 7461 736b 5f69 6e66 6f2c 0a20 2020 2020  task_info,.     
+00018180: 2020 2020 2020 2020 2020 2070 6f74 6c75             potlu
+00018190: 636b 2e74 696d 655f 7574 696c 732e 7469  ck.time_utils.ti
+000181a0: 6d65 5f66 726f 6d5f 7469 6d65 7374 7269  me_from_timestri
+000181b0: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
+000181c0: 2020 2020 2020 2020 7461 736b 5b22 6665          task["fe
+000181d0: 6564 6261 636b 5f73 756d 6d61 7279 225d  edback_summary"]
+000181e0: 5b22 7469 6d65 7374 616d 7022 5d0a 2020  ["timestamp"].  
+000181f0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00018200: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00018210: 2020 2020 2020 2020 2020 7461 736b 5b22            task["
+00018220: 7375 626d 6974 7465 645f 6174 225d 203d  submitted_at"] =
+00018230: 2073 7562 6d69 745f 7469 6d65 0a20 2020   submit_time.   
+00018240: 2020 2020 2020 2020 2074 6173 6b5b 2265           task["e
+00018250: 7661 6c5f 656c 6170 7365 6422 5d20 3d20  val_elapsed"] = 
+00018260: 6e6f 7720 2d20 7375 626d 6974 5f74 696d  now - submit_tim
+00018270: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+00018280: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+00018290: 2020 2020 2020 2020 7461 736b 5b22 7375          task["su
+000182a0: 626d 6974 7465 645f 6174 225d 203d 204e  bmitted_at"] = N
+000182b0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+000182c0: 7461 736b 5b22 6576 616c 5f65 6c61 7073  task["eval_elaps
+000182d0: 6564 225d 203d 204e 6f6e 650a 0a20 2020  ed"] = None..   
+000182e0: 2074 6173 6b5b 2265 7661 6c5f 7469 6d65   task["eval_time
+000182f0: 6f75 7422 5d20 3d20 6461 7465 7469 6d65  out"] = datetime
+00018300: 2e74 696d 6564 656c 7461 280a 2020 2020  .timedelta(.    
+00018310: 2020 2020 7365 636f 6e64 733d 6170 702e      seconds=app.
+00018320: 636f 6e66 6967 5b22 4649 4e41 4c5f 4556  config["FINAL_EV
+00018330: 414c 5f54 494d 454f 5554 225d 0a20 2020  AL_TIMEOUT"].   
+00018340: 2029 0a0a 2020 2020 2320 5365 7420 6576   )..    # Set ev
+00018350: 616c 5f73 7461 7475 730a 2020 2020 6966  al_status.    if
+00018360: 2074 7320 3d3d 2022 6572 726f 7222 3a0a   ts == "error":.
+00018370: 2020 2020 2020 2020 7461 736b 5b22 6576          task["ev
+00018380: 616c 5f73 7461 7475 7322 5d20 3d20 2275  al_status"] = "u
+00018390: 6e6b 6e6f 776e 220a 2020 2020 656c 7365  nknown".    else
+000183a0: 3a0a 2020 2020 2020 2020 7461 736b 5b22  :.        task["
+000183b0: 6576 616c 5f73 7461 7475 7322 5d20 3d20  eval_status"] = 
+000183c0: 7374 6174 7573 0a0a 2020 2020 2320 4f76  status..    # Ov
+000183d0: 6572 7269 6465 2073 7562 6d69 7474 6564  erride submitted
+000183e0: 2076 616c 7565 0a20 2020 2069 6620 7374   value.    if st
+000183f0: 6174 7573 2069 7320 6e6f 7420 4e6f 6e65  atus is not None
+00018400: 3a0a 2020 2020 2020 2020 7461 736b 5b22  :.        task["
+00018410: 7375 626d 6974 7465 6422 5d20 3d20 5472  submitted"] = Tr
+00018420: 7565 0a0a 2020 2020 2320 4164 6420 6d61  ue..    # Add ma
+00018430: 7820 7363 6f72 6520 696e 666f 0a20 2020  x score info.   
+00018440: 206d 6178 5f73 636f 7265 203d 2061 7070   max_score = app
+00018450: 2e63 6f6e 6669 672e 6765 7428 2253 434f  .config.get("SCO
+00018460: 5245 5f42 4153 4953 222c 2031 3030 290a  RE_BASIS", 100).
+00018470: 2020 2020 7265 7669 7369 6f6e 5f6d 6178      revision_max
+00018480: 203d 2061 7070 2e63 6f6e 6669 672e 6765   = app.config.ge
+00018490: 7428 2252 4556 4953 494f 4e5f 4d41 585f  t("REVISION_MAX_
+000184a0: 5343 4f52 4522 2c20 3130 3029 0a20 2020  SCORE", 100).   
+000184b0: 2062 656c 6174 6564 5f6d 6178 203d 2061   belated_max = a
+000184c0: 7070 2e63 6f6e 6669 672e 6765 7428 2242  pp.config.get("B
+000184d0: 454c 4154 4544 5f4d 4158 5f53 434f 5245  ELATED_MAX_SCORE
+000184e0: 222c 2038 3529 0a20 2020 2069 6620 7068  ", 85).    if ph
+000184f0: 6173 6520 3d3d 2022 7265 7669 7369 6f6e  ase == "revision
+00018500: 223a 0a20 2020 2020 2020 2074 6173 6b5b  ":.        task[
+00018510: 226d 6178 5f73 636f 7265 225d 203d 2072  "max_score"] = r
+00018520: 6576 6973 696f 6e5f 6d61 780a 2020 2020  evision_max.    
+00018530: 656c 6966 2070 6861 7365 203d 3d20 2262  elif phase == "b
+00018540: 656c 6174 6564 223a 0a20 2020 2020 2020  elated":.       
+00018550: 2074 6173 6b5b 226d 6178 5f73 636f 7265   task["max_score
+00018560: 225d 203d 2062 656c 6174 6564 5f6d 6178  "] = belated_max
+00018570: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00018580: 2020 2074 6173 6b5b 226d 6178 5f73 636f     task["max_sco
+00018590: 7265 225d 203d 206d 6178 5f73 636f 7265  re"] = max_score
+000185a0: 0a20 2020 2074 6173 6b5b 226d 6178 5f72  .    task["max_r
+000185b0: 6576 6973 696f 6e5f 7363 6f72 6522 5d20  evision_score"] 
+000185c0: 3d20 7265 7669 7369 6f6e 5f6d 6178 0a20  = revision_max. 
+000185d0: 2020 2074 6173 6b5b 226d 6178 5f62 656c     task["max_bel
+000185e0: 6174 6564 5f73 636f 7265 225d 203d 2062  ated_score"] = b
+000185f0: 656c 6174 6564 5f6d 6178 0a0a 2020 2020  elated_max..    
+00018600: 2320 4164 6420 6772 6164 6520 696e 666f  # Add grade info
+00018610: 0a20 2020 2069 6620 7461 736b 5b22 6576  .    if task["ev
+00018620: 616c 5f73 7461 7475 7322 5d20 696e 2028  al_status"] in (
+00018630: 2275 6e6b 6e6f 776e 222c 2022 696e 6974  "unknown", "init
+00018640: 6961 6c22 2c20 2269 6e5f 7072 6f67 7265  ial", "in_progre
+00018650: 7373 2229 3a0a 2020 2020 2020 2020 7461  ss"):.        ta
+00018660: 736b 5b22 6772 6164 6522 5d20 3d20 223f  sk["grade"] = "?
+00018670: 220a 2020 2020 656c 6966 2074 6173 6b5b  ".    elif task[
+00018680: 2265 7661 6c5f 7374 6174 7573 225d 2069  "eval_status"] i
+00018690: 6e20 2822 6572 726f 7222 2c20 2265 7870  n ("error", "exp
+000186a0: 6972 6564 2229 3a0a 2020 2020 2020 2020  ired"):.        
+000186b0: 7461 736b 5b22 6772 6164 6522 5d20 3d20  task["grade"] = 
+000186c0: 300a 2020 2020 656c 6966 2074 6173 6b5b  0.    elif task[
+000186d0: 2265 7661 6c5f 7374 6174 7573 225d 203d  "eval_status"] =
+000186e0: 3d20 2263 6f6d 706c 6574 6564 2220 6f72  = "completed" or
+000186f0: 2074 6173 6b5b 2273 7562 6d69 7474 6564   task["submitted
+00018700: 225d 3a0a 2020 2020 2020 2020 7461 736b  "]:.        task
+00018710: 5b22 6772 6164 6522 5d20 3d20 6170 702e  ["grade"] = app.
+00018720: 636f 6e66 6967 5b22 4556 414c 5541 5449  config["EVALUATI
+00018730: 4f4e 5f53 434f 5245 5322 5d2e 6765 7428  ON_SCORES"].get(
+00018740: 0a20 2020 2020 2020 2020 2020 2074 6173  .            tas
+00018750: 6b5b 2266 6565 6462 6163 6b5f 7375 6d6d  k["feedback_summ
+00018760: 6172 7922 5d5b 2265 7661 6c75 6174 696f  ary"]["evaluatio
+00018770: 6e22 5d2c 0a20 2020 2020 2020 2020 2020  n"],.           
+00018780: 2061 7070 2e63 6f6e 6669 675b 2245 5641   app.config["EVA
+00018790: 4c55 4154 494f 4e5f 5343 4f52 4553 225d  LUATION_SCORES"]
+000187a0: 2e67 6574 2822 5f5f 6f74 6865 725f 5f22  .get("__other__"
+000187b0: 2c20 223f 3f3f 2229 0a20 2020 2020 2020  , "???").       
+000187c0: 2029 0a20 2020 2020 2020 2069 6620 7461   ).        if ta
+000187d0: 736b 5b22 6772 6164 6522 5d20 3d3d 2022  sk["grade"] == "
+000187e0: 3f3f 3f22 3a0a 2020 2020 2020 2020 2020  ???":.          
+000187f0: 2020 666c 6173 6b2e 666c 6173 6828 0a20    flask.flash(. 
+00018800: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00018810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018820: 2020 2020 2022 5761 726e 696e 673a 2065       "Warning: e
+00018830: 7661 6c75 6174 696f 6e20 277b 7d27 2068  valuation '{}' h
+00018840: 6173 206e 6f74 2062 6565 6e20 6173 7369  as not been assi
+00018850: 676e 6564 2061 220a 2020 2020 2020 2020  gned a".        
+00018860: 2020 2020 2020 2020 2020 2b20 2220 6772            + " gr
+00018870: 6164 6520 7661 6c75 6521 220a 2020 2020  ade value!".    
+00018880: 2020 2020 2020 2020 2020 2020 292e 666f              ).fo
+00018890: 726d 6174 280a 2020 2020 2020 2020 2020  rmat(.          
+000188a0: 2020 2020 2020 2020 2020 7461 736b 5b22            task["
+000188b0: 6665 6564 6261 636b 5f73 756d 6d61 7279  feedback_summary
+000188c0: 225d 5b22 6576 616c 7561 7469 6f6e 225d  "]["evaluation"]
+000188d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000188e0: 2029 0a20 2020 2020 2020 2020 2020 2029   ).            )
+000188f0: 0a20 2020 2020 2020 2020 2020 2074 6173  .            tas
+00018900: 6b5b 2267 7261 6465 225d 203d 204e 6f6e  k["grade"] = Non
+00018910: 650a 2020 2020 656c 7365 3a0a 2020 2020  e.    else:.    
+00018920: 2020 2020 7461 736b 5b22 6772 6164 6522      task["grade"
+00018930: 5d20 3d20 4e6f 6e65 0a0a 2020 2020 2320  ] = None..    # 
+00018940: 4368 6563 6b20 666f 7220 6120 6772 6164  Check for a grad
+00018950: 6520 6f76 6572 7269 6465 2061 6e64 2067  e override and g
+00018960: 7261 6469 6e67 206e 6f74 650a 2020 2020  rading note.    
+00018970: 6e6f 7465 732c 206e 6f74 6573 5f68 746d  notes, notes_htm
+00018980: 6c2c 206f 7665 7272 6964 652c 2074 696d  l, override, tim
+00018990: 656c 696e 6573 735f 6f76 6572 7269 6465  eliness_override
+000189a0: 203d 2067 6574 5f65 7661 6c75 6174 696f   = get_evaluatio
+000189b0: 6e5f 696e 666f 280a 2020 2020 2020 2020  n_info(.        
+000189c0: 636f 7572 7365 2c0a 2020 2020 2020 2020  course,.        
+000189d0: 7365 6d65 7374 6572 2c0a 2020 2020 2020  semester,.      
+000189e0: 2020 7573 6572 6e61 6d65 2c0a 2020 2020    username,.    
+000189f0: 2020 2020 7068 6173 652c 0a20 2020 2020      phase,.     
+00018a00: 2020 2070 7369 642c 0a20 2020 2020 2020     psid,.       
+00018a10: 2074 6173 6b5b 2269 6422 5d0a 2020 2020   task["id"].    
+00018a20: 290a 2020 2020 7461 736b 5b22 6e6f 7465  ).    task["note
+00018a30: 7322 5d20 3d20 6e6f 7465 730a 2020 2020  s"] = notes.    
+00018a40: 7461 736b 5b22 6e6f 7465 735f 6874 6d6c  task["notes_html
+00018a50: 225d 203d 206e 6f74 6573 5f68 746d 6c0a  "] = notes_html.
+00018a60: 2020 2020 6966 206f 7665 7272 6964 6520      if override 
+00018a70: 3d3d 2027 273a 0a20 2020 2020 2020 2074  == '':.        t
+00018a80: 6173 6b5b 2267 7261 6465 5f6f 7665 7272  ask["grade_overr
+00018a90: 6964 6465 6e22 5d20 3d20 4661 6c73 650a  idden"] = False.
+00018aa0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00018ab0: 2020 7461 736b 5b22 6772 6164 655f 6f76    task["grade_ov
+00018ac0: 6572 7269 6464 656e 225d 203d 2054 7275  erridden"] = Tru
+00018ad0: 650a 2020 2020 2020 2020 7461 736b 5b22  e.        task["
+00018ae0: 6772 6164 6522 5d20 3d20 6f76 6572 7269  grade"] = overri
+00018af0: 6465 0a0a 2020 2020 6966 2074 696d 656c  de..    if timel
+00018b00: 696e 6573 735f 6f76 6572 7269 6465 203d  iness_override =
+00018b10: 3d20 2727 3a0a 2020 2020 2020 2020 7461  = '':.        ta
+00018b20: 736b 5b22 7469 6d65 6c69 6e65 7373 5f6f  sk["timeliness_o
+00018b30: 7665 7272 6964 6465 6e22 5d20 3d20 4661  verridden"] = Fa
+00018b40: 6c73 650a 2020 2020 2020 2020 2320 4e6f  lse.        # No
+00018b50: 2074 696d 656c 696e 6573 7320 736c 6f74   timeliness slot
+00018b60: 2061 7420 616c 6c0a 2020 2020 656c 7365   at all.    else
+00018b70: 3a0a 2020 2020 2020 2020 6966 2070 6861  :.        if pha
+00018b80: 7365 2021 3d20 2769 6e69 7469 616c 273a  se != 'initial':
+00018b90: 0a20 2020 2020 2020 2020 2020 2066 6c61  .            fla
+00018ba0: 736b 2e66 6c61 7368 280a 2020 2020 2020  sk.flash(.      
+00018bb0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+00018bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018bd0: 2257 6172 6e69 6e67 3a20 7469 6d65 6c69  "Warning: timeli
+00018be0: 6e65 7373 206f 7665 7272 6964 6520 7b7d  ness override {}
+00018bf0: 2066 6f72 207b 7d20 7b7d 2069 6e20 7068   for {} {} in ph
+00018c00: 6173 6522 0a20 2020 2020 2020 2020 2020  ase".           
+00018c10: 2020 2020 2020 2020 2022 207b 7d20 7769           " {} wi
+00018c20: 6c6c 2062 6520 6967 6e6f 7265 643a 206f  ll be ignored: o
+00018c30: 6e6c 7920 6f76 6572 7269 6465 7320 666f  nly overrides fo
+00018c40: 7220 7468 6522 0a20 2020 2020 2020 2020  r the".         
+00018c50: 2020 2020 2020 2020 2020 2022 2069 6e69             " ini
+00018c60: 7469 616c 2070 6861 7365 2061 7265 2061  tial phase are a
+00018c70: 7070 6c69 6564 2e22 0a20 2020 2020 2020  pplied.".       
+00018c80: 2020 2020 2020 2020 2029 2e66 6f72 6d61           ).forma
+00018c90: 7428 7469 6d65 6c69 6e65 7373 5f6f 7665  t(timeliness_ove
+00018ca0: 7272 6964 652c 2070 7369 642c 2074 6173  rride, psid, tas
+00018cb0: 6b5b 2269 6422 5d2c 2070 6861 7365 290a  k["id"], phase).
+00018cc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00018cd0: 2020 2020 2020 7461 736b 5b22 7469 6d65        task["time
+00018ce0: 6c69 6e65 7373 5f6f 7665 7272 6964 6465  liness_overridde
+00018cf0: 6e22 5d20 3d20 5472 7565 0a20 2020 2020  n"] = True.     
+00018d00: 2020 2074 6173 6b5b 2274 696d 656c 696e     task["timelin
+00018d10: 6573 7322 5d20 3d20 7469 6d65 6c69 6e65  ess"] = timeline
+00018d20: 7373 5f6f 7665 7272 6964 650a 0a20 2020  ss_override..   
+00018d30: 2023 2053 6574 2064 6574 6169 6c65 6420   # Set detailed 
+00018d40: 7375 626d 6973 7369 6f6e 2073 7461 7475  submission statu
+00018d50: 7320 616c 6f6e 6720 7769 7468 2069 636f  s along with ico
+00018d60: 6e20 616e 6420 6465 7363 7269 7074 696f  n and descriptio
+00018d70: 6e0a 2020 2020 6966 2074 6173 6b5b 2265  n.    if task["e
+00018d80: 7661 6c5f 7374 6174 7573 225d 203d 3d20  val_status"] == 
+00018d90: 2275 6e6b 6e6f 776e 223a 0a20 2020 2020  "unknown":.     
+00018da0: 2020 2074 6173 6b5b 2273 7562 6d69 7373     task["submiss
+00018db0: 696f 6e5f 7374 6174 7573 225d 203d 2022  ion_status"] = "
+00018dc0: 696e 666c 6967 6874 220a 2020 2020 2020  inflight".      
+00018dd0: 2020 7461 736b 5b22 7375 626d 6973 7369    task["submissi
+00018de0: 6f6e 5f69 636f 6e22 5d20 3d20 22e2 80bd  on_icon"] = "...
+00018df0: 220a 2020 2020 2020 2020 7461 736b 5b22  ".        task["
+00018e00: 7375 626d 6973 7369 6f6e 5f64 6573 6322  submission_desc"
+00018e10: 5d20 3d20 2273 7461 7475 7320 756e 6b6e  ] = "status unkn
+00018e20: 6f77 6e22 0a20 2020 2069 6620 7461 736b  own".    if task
+00018e30: 5b22 6576 616c 5f73 7461 7475 7322 5d20  ["eval_status"] 
+00018e40: 696e 2028 2269 6e69 7469 616c 222c 2022  in ("initial", "
+00018e50: 696e 5f70 726f 6772 6573 7322 293a 0a20  in_progress"):. 
+00018e60: 2020 2020 2020 2074 6173 6b5b 2273 7562         task["sub
+00018e70: 6d69 7373 696f 6e5f 7374 6174 7573 225d  mission_status"]
+00018e80: 203d 2022 696e 666c 6967 6874 220a 2020   = "inflight".  
+00018e90: 2020 2020 2020 7461 736b 5b22 7375 626d        task["subm
+00018ea0: 6973 7369 6f6e 5f69 636f 6e22 5d20 3d20  ission_icon"] = 
+00018eb0: 223f 220a 2020 2020 2020 2020 7461 736b  "?".        task
+00018ec0: 5b22 7375 626d 6973 7369 6f6e 5f64 6573  ["submission_des
+00018ed0: 6322 5d20 3d20 2265 7661 6c75 6174 696f  c"] = "evaluatio
+00018ee0: 6e20 696e 2070 726f 6772 6573 7322 0a20  n in progress". 
+00018ef0: 2020 2065 6c69 6620 7461 736b 5b22 6576     elif task["ev
+00018f00: 616c 5f73 7461 7475 7322 5d20 696e 2028  al_status"] in (
+00018f10: 2265 7272 6f72 222c 2022 6578 7069 7265  "error", "expire
+00018f20: 6422 293a 0a20 2020 2020 2020 2074 6173  d"):.        tas
+00018f30: 6b5b 2273 7562 6d69 7373 696f 6e5f 7374  k["submission_st
+00018f40: 6174 7573 225d 203d 2022 756e 7072 6f63  atus"] = "unproc
+00018f50: 6573 7365 6422 0a20 2020 2020 2020 2074  essed".        t
+00018f60: 6173 6b5b 2273 7562 6d69 7373 696f 6e5f  ask["submission_
+00018f70: 6963 6f6e 225d 203d 2022 e298 b922 0a20  icon"] = "...". 
+00018f80: 2020 2020 2020 2074 6173 6b5b 2273 7562         task["sub
+00018f90: 6d69 7373 696f 6e5f 6465 7363 225d 203d  mission_desc"] =
+00018fa0: 2022 7072 6f63 6573 7369 6e67 2065 7272   "processing err
+00018fb0: 6f72 220a 2020 2020 656c 6966 2074 6173  or".    elif tas
+00018fc0: 6b5b 2265 7661 6c5f 7374 6174 7573 225d  k["eval_status"]
+00018fd0: 203d 3d20 2263 6f6d 706c 6574 6564 2220   == "completed" 
+00018fe0: 6f72 2074 6173 6b5b 2273 7562 6d69 7474  or task["submitt
+00018ff0: 6564 225d 3a0a 2020 2020 2020 2020 7265  ed"]:.        re
+00019000: 706f 7274 203d 2074 6173 6b5b 2266 6565  port = task["fee
+00019010: 6462 6163 6b5f 7375 6d6d 6172 7922 5d0a  dback_summary"].
+00019020: 2020 2020 2020 2020 6966 2072 6570 6f72          if repor
+00019030: 745b 2277 6172 6e69 6e67 7322 5d3a 0a20  t["warnings"]:. 
+00019040: 2020 2020 2020 2020 2020 2074 6173 6b5b             task[
+00019050: 2273 7562 6d69 7373 696f 6e5f 7374 6174  "submission_stat
+00019060: 7573 225d 203d 2022 6973 7375 6522 0a20  us"] = "issue". 
+00019070: 2020 2020 2020 2020 2020 2074 6173 6b5b             task[
+00019080: 2273 7562 6d69 7373 696f 6e5f 6963 6f6e  "submission_icon
+00019090: 225d 203d 2022 e29c 9722 0a20 2020 2020  "] = "...".     
+000190a0: 2020 2020 2020 2074 6173 6b5b 2273 7562         task["sub
+000190b0: 6d69 7373 696f 6e5f 6465 7363 225d 203d  mission_desc"] =
+000190c0: 2022 6d61 6a6f 7220 6973 7375 6522 0a20   "major issue". 
+000190d0: 2020 2020 2020 2065 6c69 6620 7265 706f         elif repo
+000190e0: 7274 5b22 6576 616c 7561 7469 6f6e 225d  rt["evaluation"]
+000190f0: 203d 3d20 2269 6e63 6f6d 706c 6574 6522   == "incomplete"
+00019100: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
+00019110: 736b 5b22 7375 626d 6973 7369 6f6e 5f73  sk["submission_s
+00019120: 7461 7475 7322 5d20 3d20 2269 7373 7565  tatus"] = "issue
+00019130: 220a 2020 2020 2020 2020 2020 2020 7461  ".            ta
+00019140: 736b 5b22 7375 626d 6973 7369 6f6e 5f69  sk["submission_i
+00019150: 636f 6e22 5d20 3d20 22e2 9c97 220a 2020  con"] = "...".  
+00019160: 2020 2020 2020 2020 2020 7461 736b 5b22            task["
+00019170: 7375 626d 6973 7369 6f6e 5f64 6573 6322  submission_desc"
+00019180: 5d20 3d20 2269 6e63 6f6d 706c 6574 6520  ] = "incomplete 
+00019190: 7375 626d 6973 7369 6f6e 220a 2020 2020  submission".    
+000191a0: 2020 2020 656c 6966 2072 6570 6f72 745b      elif report[
+000191b0: 2265 7661 6c75 6174 696f 6e22 5d20 3d3d  "evaluation"] ==
+000191c0: 2022 6e6f 7420 6576 616c 7561 7465 6422   "not evaluated"
+000191d0: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
+000191e0: 736b 5b22 7375 626d 6973 7369 6f6e 5f73  sk["submission_s
+000191f0: 7461 7475 7322 5d20 3d20 2275 6e70 726f  tatus"] = "unpro
+00019200: 6365 7373 6564 220a 2020 2020 2020 2020  cessed".        
+00019210: 2020 2020 7461 736b 5b22 7375 626d 6973      task["submis
+00019220: 7369 6f6e 5f69 636f 6e22 5d20 3d20 22e2  sion_icon"] = ".
+00019230: 98b9 220a 2020 2020 2020 2020 2020 2020  ..".            
+00019240: 7461 736b 5b22 7375 626d 6973 7369 6f6e  task["submission
+00019250: 5f64 6573 6322 5d20 3d20 2273 7562 6d69  _desc"] = "submi
+00019260: 7373 696f 6e20 6e6f 7420 6576 616c 7561  ssion not evalua
+00019270: 7465 6422 0a20 2020 2020 2020 2065 6c73  ted".        els
+00019280: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+00019290: 6173 6b5b 2273 7562 6d69 7373 696f 6e5f  ask["submission_
+000192a0: 7374 6174 7573 225d 203d 2022 636f 6d70  status"] = "comp
+000192b0: 6c65 7465 220a 2020 2020 2020 2020 2020  lete".          
+000192c0: 2020 7461 736b 5b22 7375 626d 6973 7369    task["submissi
+000192d0: 6f6e 5f69 636f 6e22 5d20 3d20 22e2 9c93  on_icon"] = "...
+000192e0: 220a 2020 2020 2020 2020 2020 2020 7461  ".            ta
+000192f0: 736b 5b22 7375 626d 6973 7369 6f6e 5f64  sk["submission_d
+00019300: 6573 6322 5d20 3d20 2273 7562 6d69 7474  esc"] = "submitt
+00019310: 6564 220a 2020 2020 656c 7365 3a0a 2020  ed".    else:.  
+00019320: 2020 2020 2020 7461 736b 5b22 7375 626d        task["subm
+00019330: 6973 7369 6f6e 5f73 7461 7475 7322 5d20  ission_status"] 
+00019340: 3d20 2275 6e73 7562 6d69 7474 6564 220a  = "unsubmitted".
+00019350: 2020 2020 2020 2020 7461 736b 5b22 7375          task["su
+00019360: 626d 6973 7369 6f6e 5f69 636f 6e22 5d20  bmission_icon"] 
+00019370: 3d20 22e2 80a6 220a 2020 2020 2020 2020  = "...".        
+00019380: 7461 736b 5b22 7375 626d 6973 7369 6f6e  task["submission
+00019390: 5f64 6573 6322 5d20 3d20 226e 6f74 2079  _desc"] = "not y
+000193a0: 6574 2073 7562 6d69 7474 6564 220a 0a0a  et submitted"...
+000193b0: 6465 6620 6578 6572 6369 7365 5f63 7265  def exercise_cre
+000193c0: 6469 7428 6578 6572 6369 7365 5f69 6e66  dit(exercise_inf
+000193d0: 6f2c 206f 6e5f 7469 6d65 2c20 6f75 7463  o, on_time, outc
+000193e0: 6f6d 6573 293a 0a20 2020 2022 2222 0a20  omes):.    """. 
+000193f0: 2020 2052 6574 7572 6e73 2061 2074 7269     Returns a tri
+00019400: 706c 6520 636f 6e74 6169 6e69 6e67 2061  ple containing a
+00019410: 2073 7562 6d69 7373 696f 6e20 7374 6174   submission stat
+00019420: 7573 2073 7472 696e 672c 2061 206e 756d  us string, a num
+00019430: 6265 7220 666f 720a 2020 2020 6578 6572  ber for.    exer
+00019440: 6369 7365 2063 7265 6469 7420 286f 7220  cise credit (or 
+00019450: 4e6f 6e65 292c 2061 6e64 2061 206e 756d  None), and a num
+00019460: 6265 7220 666f 7220 6772 6f75 7020 6372  ber for group cr
+00019470: 6564 6974 2028 706f 7373 6962 6c79 0a20  edit (possibly. 
+00019480: 2020 2030 292e 2054 6865 7365 2061 7265     0). These are
+00019490: 2062 6173 6564 206f 6e20 7768 6574 6865   based on whethe
+000194a0: 7220 7468 6520 6769 7665 6e20 6f75 7463  r the given outc
+000194b0: 6f6d 6573 206c 6973 7420 6d61 7463 6865  omes list matche
+000194c0: 7320 7468 650a 2020 2020 6578 7065 6374  s the.    expect
+000194d0: 6564 206f 7574 636f 6d65 7320 666f 7220  ed outcomes for 
+000194e0: 7468 6520 6769 7665 6e20 6578 6572 6369  the given exerci
+000194f0: 7365 2069 6e66 6f20 2873 686f 756c 6420  se info (should 
+00019500: 6265 2061 6e0a 2020 2020 696e 6469 7669  be an.    indivi
+00019510: 6475 616c 2065 7865 7263 6973 6520 6469  dual exercise di
+00019520: 6374 696f 6e61 7279 292e 2054 6865 2060  ctionary). The `
+00019530: 6f6e 5f74 696d 6560 2076 616c 7565 2073  on_time` value s
+00019540: 686f 756c 6420 6265 2061 0a20 2020 2062  hould be a.    b
+00019550: 6f6f 6c65 616e 2069 6e64 6963 6174 696e  oolean indicatin
+00019560: 6720 7768 6574 6865 7220 6f72 206e 6f74  g whether or not
+00019570: 2074 6865 2065 7865 7263 6973 6520 6f75   the exercise ou
+00019580: 7463 6f6d 6573 2077 6572 650a 2020 2020  tcomes were.    
+00019590: 7375 626d 6974 7465 6420 6f6e 2d74 696d  submitted on-tim
+000195a0: 652e 2054 6865 2060 6f6e 5f74 696d 6560  e. The `on_time`
+000195b0: 2076 616c 7565 206f 6e6c 7920 6166 6665   value only affe
+000195c0: 6374 7320 7468 6520 6772 6f75 700a 2020  cts the group.  
+000195d0: 2020 6372 6564 6974 2c20 6e6f 7420 7468    credit, not th
+000195e0: 6520 6578 6572 6369 7365 2063 7265 6469  e exercise credi
+000195f0: 742c 2061 6363 6f72 6469 6e67 2074 6f20  t, according to 
+00019600: 7468 6520 636f 6e66 6967 7572 6174 696f  the configuratio
+00019610: 6e27 730a 2020 2020 604c 4154 455f 4558  n's.    `LATE_EX
+00019620: 4552 4349 5345 5f43 5245 4449 545f 4652  ERCISE_CREDIT_FR
+00019630: 4143 5449 4f4e 6020 7661 6c75 6520 7768  ACTION` value wh
+00019640: 656e 2069 7427 7320 6661 6c73 652e 0a0a  en it's false...
+00019650: 2020 2020 5468 6520 7374 6174 7573 2073      The status s
+00019660: 7472 696e 6720 7769 6c6c 2062 6520 6f6e  tring will be on
+00019670: 6520 6f66 3a0a 0a20 2020 202d 2022 636f  e of:..    - "co
+00019680: 6d70 6c65 7465 2220 6966 2061 6c6c 206f  mplete" if all o
+00019690: 7574 636f 6d65 7320 6172 6520 7375 6363  utcomes are succ
+000196a0: 6573 7366 756c 2e0a 2020 2020 2d20 2270  essful..    - "p
+000196b0: 6172 7469 616c 2220 6966 2073 6f6d 6520  artial" if some 
+000196c0: 6f75 7463 6f6d 6520 6661 696c 6564 2c20  outcome failed, 
+000196d0: 6275 7420 6174 206c 6561 7374 206f 6e65  but at least one
+000196e0: 206e 6f6e 2d70 6173 7369 7665 0a20 2020   non-passive.   
+000196f0: 2020 2020 206f 7574 636f 6d65 2073 7563       outcome suc
+00019700: 6365 6564 6564 2028 7061 7373 6976 6520  ceeded (passive 
+00019710: 6f75 7463 6f6d 6573 2061 7265 2074 686f  outcomes are tho
+00019720: 7365 2065 7870 6563 7465 6420 746f 2073  se expected to s
+00019730: 7563 6365 6564 0a20 2020 2020 2020 2065  ucceed.        e
+00019740: 7665 6e20 7768 656e 206e 6f20 636f 6465  ven when no code
+00019750: 2069 7320 7772 6974 7465 6e20 6265 796f   is written beyo
+00019760: 6e64 2074 6865 2073 7461 7274 6572 2063  nd the starter c
+00019770: 6f64 652c 2062 7574 2077 6869 6368 0a20  ode, but which. 
+00019780: 2020 2020 2020 206d 6179 2066 6169 6c20         may fail 
+00019790: 6966 2062 6164 2063 6f64 6520 6973 2077  if bad code is w
+000197a0: 7269 7474 656e 292e 0a20 2020 202d 2022  ritten)..    - "
+000197b0: 696e 636f 6d70 6c65 7465 2220 6966 206e  incomplete" if n
+000197c0: 6f74 2065 6e6f 7567 6820 6f75 7463 6f6d  ot enough outcom
+000197d0: 6573 2061 7265 2073 7563 6365 7373 6675  es are successfu
+000197e0: 6c20 666f 7220 7061 7274 6961 6c0a 2020  l for partial.  
+000197f0: 2020 2020 2020 636f 6d70 6c65 7465 6e65        completene
+00019800: 7373 2c20 6f72 2069 6620 7468 6572 6527  ss, or if there'
+00019810: 7320 616e 2069 7373 7565 206c 696b 6520  s an issue like 
+00019820: 7468 6520 7772 6f6e 6720 6e75 6d62 6572  the wrong number
+00019830: 206f 660a 2020 2020 2020 2020 6f75 7463   of.        outc
+00019840: 6f6d 6573 2062 6569 6e67 2072 6570 6f72  omes being repor
+00019850: 7465 642e 0a0a 2020 2020 5468 6973 2066  ted...    This f
+00019860: 756e 6374 696f 6e20 776f 6e27 7420 7265  unction won't re
+00019870: 7475 726e 2069 742c 2062 7574 2022 756e  turn it, but "un
+00019880: 7375 626d 6974 7465 6422 2069 7320 616e  submitted" is an
+00019890: 6f74 6865 7220 706f 7373 6962 6c65 0a20  other possible. 
+000198a0: 2020 2073 7461 7475 7320 7374 7269 6e67     status string
+000198b0: 2075 7365 6420 656c 7365 7768 6572 652e   used elsewhere.
+000198c0: 0a20 2020 2022 2222 0a20 2020 2067 726f  .    """.    gro
+000198d0: 7570 5f63 7265 6469 7420 3d20 300a 2020  up_credit = 0.  
+000198e0: 2020 6578 6572 6369 7365 5f63 7265 6469    exercise_credi
+000198f0: 7420 3d20 4e6f 6e65 0a20 2020 206e 5f6f  t = None.    n_o
+00019900: 7574 636f 6d65 7320 3d20 6c65 6e28 6f75  utcomes = len(ou
+00019910: 7463 6f6d 6573 290a 0a20 2020 2065 7870  tcomes)..    exp
+00019920: 5f6f 7574 636f 6d65 7320 3d20 6578 6572  _outcomes = exer
+00019930: 6369 7365 5f69 6e66 6f2e 6765 7428 2763  cise_info.get('c
+00019940: 6f75 6e74 2729 0a20 2020 2069 6620 6578  ount').    if ex
+00019950: 705f 6f75 7463 6f6d 6573 2069 7320 4e6f  p_outcomes is No
+00019960: 6e65 2061 6e64 2027 7065 725f 6f75 7463  ne and 'per_outc
+00019970: 6f6d 6527 2069 6e20 6578 6572 6369 7365  ome' in exercise
+00019980: 5f69 6e66 6f3a 0a20 2020 2020 2020 2065  _info:.        e
+00019990: 7870 5f6f 7574 636f 6d65 7320 3d20 6c65  xp_outcomes = le
+000199a0: 6e28 6578 6572 6369 7365 5f69 6e66 6f5b  n(exercise_info[
+000199b0: 2770 6572 5f6f 7574 636f 6d65 275d 290a  'per_outcome']).
+000199c0: 0a20 2020 2069 6620 6578 705f 6f75 7463  .    if exp_outc
+000199d0: 6f6d 6573 2069 7320 4e6f 6e65 3a0a 2020  omes is None:.  
+000199e0: 2020 2020 2020 2320 5769 7468 6f75 7420        # Without 
+000199f0: 696e 666f 206f 6e20 686f 7720 6d61 6e79  info on how many
+00019a00: 206f 7574 636f 6d65 7320 7765 2772 6520   outcomes we're 
+00019a10: 6578 7065 6374 696e 672c 2077 6520 6375  expecting, we cu
+00019a20: 7272 656e 746c 790a 2020 2020 2020 2020  rrently.        
+00019a30: 2320 646f 6e27 7420 6861 7665 2061 2077  # don't have a w
+00019a40: 6179 2074 6f20 6b6e 6f77 2069 6620 616e  ay to know if an
+00019a50: 206f 7574 636f 6d65 2069 7320 7061 7373   outcome is pass
+00019a60: 6976 6520 286f 7220 7768 6963 680a 2020  ive (or which.  
+00019a70: 2020 2020 2020 2320 636f 6e63 6570 7428        # concept(
+00019a80: 7329 2069 7420 6d69 6768 7420 6465 616c  s) it might deal
+00019a90: 2077 6974 6829 2e0a 2020 2020 2020 2020   with)..        
+00019aa0: 2320 544f 444f 3a20 4c65 7373 2066 7261  # TODO: Less fra
+00019ab0: 6769 6c65 2077 6179 2074 6f20 6173 736f  gile way to asso
+00019ac0: 6369 6174 6520 6f75 7463 6f6d 6573 2077  ciate outcomes w
+00019ad0: 2f20 636f 6e63 6570 7473 210a 0a20 2020  / concepts!..   
+00019ae0: 2020 2020 2023 2049 6e20 7468 6973 2063       # In this c
+00019af0: 6173 652c 2061 7420 6c65 6173 7420 6f6e  ase, at least on
+00019b00: 6520 6f75 7463 6f6d 6520 6973 2072 6571  e outcome is req
+00019b10: 7569 7265 6421 0a20 2020 2020 2020 2069  uired!.        i
+00019b20: 6620 6c65 6e28 6f75 7463 6f6d 6573 2920  f len(outcomes) 
+00019b30: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00019b40: 2020 7375 626d 6973 7369 6f6e 5f73 7461    submission_sta
+00019b50: 7475 7320 3d20 2269 6e63 6f6d 706c 6574  tus = "incomplet
+00019b60: 6522 0a20 2020 2020 2020 2065 6c73 653a  e".        else:
+00019b70: 0a20 2020 2020 2020 2020 2020 2023 204f  .            # O
+00019b80: 7468 6572 7769 7365 2c20 616c 6c2d 7375  therwise, all-su
+00019b90: 6363 6573 7320 2d3e 2063 6f6d 706c 6574  ccess -> complet
+00019ba0: 653b 206f 6e65 2b20 7375 6363 6573 7320  e; one+ success 
+00019bb0: 2d3e 2070 6172 7469 616c 0a20 2020 2020  -> partial.     
+00019bc0: 2020 2020 2020 2070 6173 7365 6420 3d20         passed = 
+00019bd0: 5b6f 7574 636f 6d65 2066 6f72 206f 7574  [outcome for out
+00019be0: 636f 6d65 2069 6e20 6f75 7463 6f6d 6573  come in outcomes
+00019bf0: 2069 6620 6f75 7463 6f6d 655b 305d 5d0a   if outcome[0]].
+00019c00: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00019c10: 656e 2870 6173 7365 6429 203d 3d20 6c65  en(passed) == le
+00019c20: 6e28 6f75 7463 6f6d 6573 293a 0a20 2020  n(outcomes):.   
+00019c30: 2020 2020 2020 2020 2020 2020 2073 7562               sub
+00019c40: 6d69 7373 696f 6e5f 7374 6174 7573 203d  mission_status =
+00019c50: 2022 636f 6d70 6c65 7465 220a 2020 2020   "complete".    
+00019c60: 2020 2020 2020 2020 2020 2020 6578 6572              exer
+00019c70: 6369 7365 5f63 7265 6469 7420 3d20 310a  cise_credit = 1.
+00019c80: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00019c90: 206c 656e 2870 6173 7365 6429 203e 2030   len(passed) > 0
+00019ca0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019cb0: 2020 7375 626d 6973 7369 6f6e 5f73 7461    submission_sta
+00019cc0: 7475 7320 3d20 2270 6172 7469 616c 220a  tus = "partial".
+00019cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ce0: 6578 6572 6369 7365 5f63 7265 6469 7420  exercise_credit 
+00019cf0: 3d20 302e 350a 2020 2020 2020 2020 2020  = 0.5.          
+00019d00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00019d10: 2020 2020 2020 2020 7375 626d 6973 7369          submissi
+00019d20: 6f6e 5f73 7461 7475 7320 3d20 2269 6e63  on_status = "inc
+00019d30: 6f6d 706c 6574 6522 0a20 2020 2020 2020  omplete".       
+00019d40: 2020 2020 2020 2020 2065 7865 7263 6973           exercis
+00019d50: 655f 6372 6564 6974 203d 2030 0a20 2020  e_credit = 0.   
+00019d60: 2020 2020 2020 2020 2023 2041 6363 756d           # Accum
+00019d70: 756c 6174 6520 6372 6564 6974 0a20 2020  ulate credit.   
+00019d80: 2020 2020 2020 2020 2067 726f 7570 5f63           group_c
+00019d90: 7265 6469 7420 3d20 6578 6572 6369 7365  redit = exercise
+00019da0: 5f63 7265 6469 740a 2020 2020 656c 6966  _credit.    elif
+00019db0: 206e 5f6f 7574 636f 6d65 7320 213d 2065   n_outcomes != e
+00019dc0: 7870 5f6f 7574 636f 6d65 733a 0a20 2020  xp_outcomes:.   
+00019dd0: 2020 2020 2023 2049 6620 7765 2068 6176       # If we hav
+00019de0: 6520 616e 2065 7870 6563 7461 7469 6f6e  e an expectation
+00019df0: 2066 6f72 2074 6865 206e 756d 6265 7220   for the number 
+00019e00: 6f66 206f 7574 636f 6d65 7320 616e 6420  of outcomes and 
+00019e10: 7468 650a 2020 2020 2020 2020 2320 6163  the.        # ac
+00019e20: 7475 616c 206e 756d 6265 7220 646f 6573  tual number does
+00019e30: 6e27 7420 6d61 7463 6820 7468 6174 2c20  n't match that, 
+00019e40: 7765 2077 6f6e 2774 206b 6e6f 7720 7768  we won't know wh
+00019e50: 6963 6820 6f75 7463 6f6d 6573 0a20 2020  ich outcomes.   
+00019e60: 2020 2020 2023 206d 6967 6874 2062 6520       # might be 
+00019e70: 7061 7373 6976 6520 7673 2e20 6163 7469  passive vs. acti
+00019e80: 7665 2c20 616e 6420 7765 2064 6f6e 2774  ve, and we don't
+00019e90: 206b 6e6f 7720 686f 7720 746f 206d 6170   know how to map
+00019ea0: 0a20 2020 2020 2020 2023 206f 7574 636f  .        # outco
+00019eb0: 6d65 7320 6f6e 746f 2070 6572 2d6f 7574  mes onto per-out
+00019ec0: 636f 6d65 2063 6f6e 6365 7074 732e 2e2e  come concepts...
+00019ed0: 2073 6f20 7765 206a 7573 7420 6967 6e6f   so we just igno
+00019ee0: 7265 2074 6865 0a20 2020 2020 2020 2023  re the.        #
+00019ef0: 2077 686f 6c65 2065 7865 7263 6973 6520   whole exercise 
+00019f00: 616e 6420 636f 756e 7420 6974 2061 7320  and count it as 
+00019f10: 6e6f 742d 7965 742d 7375 626d 6974 7465  not-yet-submitte
+00019f20: 642e 0a20 2020 2020 2020 2023 2054 4f44  d..        # TOD
+00019f30: 4f3a 204c 6573 7320 6672 6167 696c 6520  O: Less fragile 
+00019f40: 7761 7920 746f 2061 7373 6f63 6961 7465  way to associate
+00019f50: 206f 7574 636f 6d65 7320 772f 2063 6f6e   outcomes w/ con
+00019f60: 6365 7074 7321 0a20 2020 2020 2020 2073  cepts!.        s
+00019f70: 7562 6d69 7373 696f 6e5f 7374 6174 7573  ubmission_status
+00019f80: 203d 2022 696e 636f 6d70 6c65 7465 220a   = "incomplete".
+00019f90: 2020 2020 2020 2020 2320 4e6f 2067 726f          # No gro
+00019fa0: 7570 2063 7265 6469 7420 6163 6372 7565  up credit accrue
+00019fb0: 7320 696e 2074 6869 7320 6361 7365 0a20  s in this case. 
+00019fc0: 2020 2065 6c69 6620 6c65 6e28 6f75 7463     elif len(outc
+00019fd0: 6f6d 6573 2920 3d3d 2030 3a0a 2020 2020  omes) == 0:.    
+00019fe0: 2020 2020 2320 7468 6973 2065 7865 7263      # this exerc
+00019ff0: 6973 6520 646f 6573 6e27 7420 636f 6e74  ise doesn't cont
+0001a000: 7269 6275 7465 2074 6f20 616e 7920 636f  ribute to any co
+0001a010: 6e63 6570 740a 2020 2020 2020 2020 2320  ncept.        # 
+0001a020: 7374 6174 7573 6573 2c20 616e 6420 7468  statuses, and th
+0001a030: 6174 2773 2069 6e74 656e 7469 6f6e 616c  at's intentional
+0001a040: 2e20 5369 6e63 6520 6974 2064 6f65 736e  . Since it doesn
+0001a050: 2774 0a20 2020 2020 2020 2023 2068 6176  't.        # hav
+0001a060: 6520 6f75 7463 6f6d 6573 2c20 616e 7920  e outcomes, any 
+0001a070: 7375 626d 6973 7369 6f6e 2063 6f75 6e74  submission count
+0001a080: 7320 6173 2063 6f6d 706c 6574 652e 0a20  s as complete.. 
+0001a090: 2020 2020 2020 2073 7562 6d69 7373 696f         submissio
+0001a0a0: 6e5f 7374 6174 7573 203d 2022 636f 6d70  n_status = "comp
+0001a0b0: 6c65 7465 220a 2020 2020 2020 2020 2320  lete".        # 
+0001a0c0: 4865 7265 2077 6520 6469 7265 6374 6c79  Here we directly
+0001a0d0: 2061 6464 2074 6f20 6772 6f75 7020 6372   add to group cr
+0001a0e0: 6564 6974 2062 7574 206c 6561 7665 0a20  edit but leave. 
+0001a0f0: 2020 2020 2020 2023 2065 7865 7263 6973         # exercis
+0001a100: 655f 6372 6564 6974 2061 7320 4e6f 6e65  e_credit as None
+0001a110: 2e0a 2020 2020 2020 2020 6772 6f75 705f  ..        group_
+0001a120: 6372 6564 6974 203d 2031 0a20 2020 2065  credit = 1.    e
+0001a130: 6c73 653a 0a20 2020 2020 2020 2023 2047  lse:.        # G
+0001a140: 6574 206c 6973 7420 6f66 206f 7574 636f  et list of outco
+0001a150: 6d65 2069 6e64 6963 6573 2066 6f72 2073  me indices for s
+0001a160: 7563 6365 7373 6573 0a20 2020 2020 2020  uccesses.       
+0001a170: 2070 6173 7365 6420 3d20 5b0a 2020 2020   passed = [.    
+0001a180: 2020 2020 2020 2020 690a 2020 2020 2020          i.      
+0001a190: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+0001a1a0: 616e 6765 286c 656e 286f 7574 636f 6d65  ange(len(outcome
+0001a1b0: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
+0001a1c0: 6966 206f 7574 636f 6d65 735b 695d 5b30  if outcomes[i][0
+0001a1d0: 5d0a 2020 2020 2020 2020 5d0a 2020 2020  ].        ].    
+0001a1e0: 2020 2020 2320 4765 7420 6c69 7374 206f      # Get list o
+0001a1f0: 6620 7768 6963 6820 6f75 7463 6f6d 6573  f which outcomes
+0001a200: 2061 7265 2070 6173 7369 7665 0a20 2020   are passive.   
+0001a210: 2020 2020 2070 6173 7369 7665 7320 3d20       passives = 
+0001a220: 6578 6572 6369 7365 5f69 6e66 6f2e 6765  exercise_info.ge
+0001a230: 7428 2270 6173 7369 7665 222c 205b 5d29  t("passive", [])
+0001a240: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0001a250: 7061 7373 6564 2920 3d3d 206e 5f6f 7574  passed) == n_out
+0001a260: 636f 6d65 733a 0a20 2020 2020 2020 2020  comes:.         
+0001a270: 2020 2023 2049 6620 6576 6572 7974 6869     # If everythi
+0001a280: 6e67 2070 6173 7365 642c 2074 6865 206f  ng passed, the o
+0001a290: 7665 7261 6c6c 2069 7320 6120 7061 7373  verall is a pass
+0001a2a0: 0a20 2020 2020 2020 2020 2020 2065 7865  .            exe
+0001a2b0: 7263 6973 655f 6372 6564 6974 203d 2031  rcise_credit = 1
+0001a2c0: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
+0001a2d0: 6d69 7373 696f 6e5f 7374 6174 7573 203d  mission_status =
+0001a2e0: 2022 636f 6d70 6c65 7465 220a 2020 2020   "complete".    
+0001a2f0: 2020 2020 656c 6966 2061 6e79 2869 206e      elif any(i n
+0001a300: 6f74 2069 6e20 7061 7373 6976 6573 2066  ot in passives f
+0001a310: 6f72 2069 2069 6e20 7061 7373 6564 293a  or i in passed):
+0001a320: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
+0001a330: 7420 6c65 6173 7420 6f6e 6520 6e6f 6e2d  t least one non-
+0001a340: 7061 7373 6976 6520 7061 7373 6564 202d  passive passed -
+0001a350: 3e20 7061 7274 6961 6c0a 2020 2020 2020  > partial.      
+0001a360: 2020 2020 2020 6578 6572 6369 7365 5f63        exercise_c
+0001a370: 7265 6469 7420 3d20 302e 350a 2020 2020  redit = 0.5.    
+0001a380: 2020 2020 2020 2020 7375 626d 6973 7369          submissi
+0001a390: 6f6e 5f73 7461 7475 7320 3d20 2270 6172  on_status = "par
+0001a3a0: 7469 616c 220a 2020 2020 2020 2020 656c  tial".        el
+0001a3b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001a3c0: 2320 6f6e 6c79 2070 6173 7369 6e67 2074  # only passing t
+0001a3d0: 6573 7473 2077 6572 6520 7061 7274 6961  ests were partia
+0001a3e0: 6c20 2620 6174 206c 6561 7374 206f 6e65  l & at least one
+0001a3f0: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
+0001a400: 6169 6c65 6420 2d3e 206e 6f20 6372 6564  ailed -> no cred
+0001a410: 6974 0a20 2020 2020 2020 2020 2020 2065  it.            e
+0001a420: 7865 7263 6973 655f 6372 6564 6974 203d  xercise_credit =
+0001a430: 2030 0a20 2020 2020 2020 2020 2020 2073   0.            s
+0001a440: 7562 6d69 7373 696f 6e5f 7374 6174 7573  ubmission_status
+0001a450: 203d 2022 696e 636f 6d70 6c65 7465 220a   = "incomplete".
+0001a460: 0a20 2020 2020 2020 2023 2053 6574 2067  .        # Set g
+0001a470: 726f 7570 2063 7265 6469 740a 2020 2020  roup credit.    
+0001a480: 2020 2020 6772 6f75 705f 6372 6564 6974      group_credit
+0001a490: 203d 2065 7865 7263 6973 655f 6372 6564   = exercise_cred
+0001a4a0: 6974 0a0a 2020 2020 2320 4d6f 6469 6679  it..    # Modify
+0001a4b0: 2067 726f 7570 2063 7265 6469 7420 6966   group credit if
+0001a4c0: 2074 6869 7320 6973 206c 6174 650a 2020   this is late.  
+0001a4d0: 2020 6966 206e 6f74 206f 6e5f 7469 6d65    if not on_time
+0001a4e0: 3a0a 2020 2020 2020 2020 6772 6f75 705f  :.        group_
+0001a4f0: 6372 6564 6974 202a 3d20 6170 702e 636f  credit *= app.co
+0001a500: 6e66 6967 2e67 6574 2822 4c41 5445 5f45  nfig.get("LATE_E
+0001a510: 5845 5243 4953 455f 4352 4544 4954 5f46  XERCISE_CREDIT_F
+0001a520: 5241 4354 494f 4e22 2c20 302e 3529 0a0a  RACTION", 0.5)..
+0001a530: 2020 2020 7265 7475 726e 2028 7375 626d      return (subm
+0001a540: 6973 7369 6f6e 5f73 7461 7475 732c 2065  ission_status, e
+0001a550: 7865 7263 6973 655f 6372 6564 6974 2c20  xercise_credit, 
+0001a560: 6772 6f75 705f 6372 6564 6974 290a 0a0a  group_credit)...
+0001a570: 6465 6620 616d 656e 645f 6578 6572 6369  def amend_exerci
+0001a580: 7365 7328 636f 7572 7365 2c20 7365 6d65  ses(course, seme
+0001a590: 7374 6572 2c20 7461 736b 5f69 6e66 6f2c  ster, task_info,
+0001a5a0: 206f 7574 636f 6d65 732c 2075 7365 726e   outcomes, usern
+0001a5b0: 616d 6529 3a0a 2020 2020 2222 220a 2020  ame):.    """.  
+0001a5c0: 2020 416d 656e 6473 2074 6865 2065 7865    Amends the exe
+0001a5d0: 7263 6973 6573 2069 6e20 7468 6520 7072  rcises in the pr
+0001a5e0: 6f76 6964 6564 2074 6173 6b20 696e 666f  ovided task info
+0001a5f0: 2062 6173 6564 206f 6e20 7468 6520 6769   based on the gi
+0001a600: 7665 6e0a 2020 2020 6f75 7463 6f6d 6573  ven.    outcomes
+0001a610: 2e20 4974 2061 6464 7320 7469 6d65 202b  . It adds time +
+0001a620: 2073 7562 6d69 7373 696f 6e20 7374 6174   submission stat
+0001a630: 7573 6573 2066 6f72 2065 6163 6820 6578  uses for each ex
+0001a640: 6572 6369 7365 2c20 6173 0a20 2020 2077  ercise, as.    w
+0001a650: 656c 6c20 6173 2065 7874 656e 7369 6f6e  ell as extension
+0001a660: 2069 6e66 6f20 6261 7365 6420 6f6e 2074   info based on t
+0001a670: 6865 2070 726f 7669 6465 640a 2020 2020  he provided.    
+0001a680: 636f 7572 7365 2f73 656d 6573 7465 722f  course/semester/
+0001a690: 7573 6572 6e61 6d65 2e0a 0a20 2020 2045  username...    E
+0001a6a0: 6163 6820 6578 6572 6369 7365 2067 726f  ach exercise gro
+0001a6b0: 7570 2077 696c 6c20 6761 696e 2061 2022  up will gain a "
+0001a6c0: 7068 6173 6522 2073 6c6f 7420 7769 7468  phase" slot with
+0001a6d0: 2061 2073 7472 696e 670a 2020 2020 696e   a string.    in
+0001a6e0: 6469 6361 7469 6e67 2077 6869 6368 2074  dicating which t
+0001a6f0: 696d 6520 7068 6173 6520 6974 2773 2069  ime phase it's i
+0001a700: 6e20 2873 6565 2074 6865 2022 6578 6572  n (see the "exer
+0001a710: 6369 7365 7322 2065 6e74 7279 0a20 2020  cises" entry.   
+0001a720: 2061 626f 7665 292e 2045 6163 6820 6772   above). Each gr
+0001a730: 6f75 7020 7769 6c6c 2061 6c73 6f20 6761  oup will also ga
+0001a740: 696e 2061 6e20 2265 7874 656e 7369 6f6e  in an "extension
+0001a750: 2220 736c 6f74 2074 6861 7420 686f 6c64  " slot that hold
+0001a760: 7320 610a 2020 2020 6e75 6d62 6572 2073  s a.    number s
+0001a770: 7065 6369 6679 696e 6720 686f 7720 6d61  pecifying how ma
+0001a780: 6e79 2068 6f75 7273 206f 6620 6578 7465  ny hours of exte
+0001a790: 6e73 696f 6e20 7468 6520 7573 6572 2068  nsion the user h
+0001a7a0: 6173 2062 6565 6e0a 2020 2020 6772 616e  as been.    gran
+0001a7b0: 7465 6420 666f 7220 7468 6174 2065 7865  ted for that exe
+0001a7c0: 7263 6973 6520 6772 6f75 702c 2061 6e64  rcise group, and
+0001a7d0: 2061 2022 7469 6d65 6c79 5f62 7922 2073   a "timely_by" s
+0001a7e0: 6c6f 7420 7468 6174 2068 6f6c 6473 2061  lot that holds a
+0001a7f0: 0a20 2020 2064 6174 6574 696d 6520 6f62  .    datetime ob
+0001a800: 6a65 6374 2069 6e64 6963 6174 696e 6720  ject indicating 
+0001a810: 7468 6520 6465 6164 6c69 6e65 2077 6974  the deadline wit
+0001a820: 6820 616e 7920 6578 7465 6e73 696f 6e20  h any extension 
+0001a830: 6661 6374 6f72 6564 0a20 2020 2069 6e2e  factored.    in.
+0001a840: 0a0a 2020 2020 416c 736f 2c20 6561 6368  ..    Also, each
+0001a850: 2069 6e64 6976 6964 7561 6c20 6578 6572   individual exer
+0001a860: 6369 7365 2077 6869 6368 2068 6173 2062  cise which has b
+0001a870: 6565 6e20 7375 626d 6974 7465 6420 7769  een submitted wi
+0001a880: 6c6c 0a20 2020 2067 6169 6e20 7468 6520  ll.    gain the 
+0001a890: 666f 6c6c 6f77 696e 6720 736c 6f74 733a  following slots:
+0001a8a0: 0a0a 2020 2020 2d20 6120 2273 7461 7475  ..    - a "statu
+0001a8b0: 7322 2073 6c6f 7420 7769 7468 2061 2073  s" slot with a s
+0001a8c0: 7562 6d69 7373 696f 6e20 7374 6174 7573  ubmission status
+0001a8d0: 2073 7472 696e 6720 2861 6c73 6f20 7365   string (also se
+0001a8e0: 6520 6162 6f76 6529 2e0a 2020 2020 2d20  e above)..    - 
+0001a8f0: 6120 2263 7265 6469 7422 2073 6c6f 7420  a "credit" slot 
+0001a900: 7769 7468 2061 206e 756d 6572 6963 616c  with a numerical
+0001a910: 2063 7265 6469 7420 7661 6c75 652c 206f   credit value, o
+0001a920: 7220 4e6f 6e65 2066 6f72 0a20 2020 2020  r None for.     
+0001a930: 2020 2075 6e73 7562 6d69 7474 6564 2065     unsubmitted e
+0001a940: 7865 7263 6973 6573 2e0a 2020 2020 2d20  xercises..    - 
+0001a950: 6120 2267 726f 7570 5f63 7265 6469 7422  a "group_credit"
+0001a960: 2073 6c6f 7420 7769 7468 2061 206e 756d   slot with a num
+0001a970: 6572 6963 616c 2063 7265 6469 7420 7661  erical credit va
+0001a980: 6c75 6520 746f 7761 7264 7320 6772 6f75  lue towards grou
+0001a990: 700a 2020 2020 2020 2020 6372 6564 6974  p.        credit
+0001a9a0: 2c20 7768 6963 6820 6973 2075 7375 616c  , which is usual
+0001a9b0: 6c79 2074 6865 2073 616d 6520 6173 2022  ly the same as "
+0001a9c0: 6372 6564 6974 222e 0a0a 2020 2020 4669  credit"...    Fi
+0001a9d0: 6e61 6c6c 792c 2074 6865 2065 7865 7263  nally, the exerc
+0001a9e0: 6973 6520 6772 6f75 7073 2077 696c 6c20  ise groups will 
+0001a9f0: 6761 696e 2061 2022 6372 6564 6974 5f66  gain a "credit_f
+0001aa00: 7261 6374 696f 6e22 2073 6c6f 740a 2020  raction" slot.  
+0001aa10: 2020 696e 6469 6361 7469 6e67 2077 6861    indicating wha
+0001aa20: 7420 6672 6163 7469 6f6e 206f 6620 6372  t fraction of cr
+0001aa30: 6564 6974 2068 6173 2062 6565 6e20 7265  edit has been re
+0001aa40: 6365 6976 6564 2c20 616e 6420 6120 2273  ceived, and a "s
+0001aa50: 7461 7475 7322 0a20 2020 2073 6c6f 7420  tatus".    slot 
+0001aa60: 6167 6772 6567 6174 696e 6720 7468 6520  aggregating the 
+0001aa70: 7374 6174 7573 6573 206f 6620 6974 7320  statuses of its 
+0001aa80: 636f 6d70 6f6e 656e 7473 2c20 6465 7065  components, depe
+0001aa90: 6e64 696e 6720 6f6e 2069 7473 0a20 2020  nding on its.   
+0001aaa0: 2070 6861 7365 2e20 5468 6973 2067 726f   phase. This gro
+0001aab0: 7570 2073 7461 7475 7320 6973 2064 6574  up status is det
+0001aac0: 6572 6d69 6e65 6420 6173 2066 6f6c 6c6f  ermined as follo
+0001aad0: 7773 3a0a 0a20 2020 2031 2e20 4966 2061  ws:..    1. If a
+0001aae0: 6c6c 206f 6620 7468 6520 6578 6572 6369  ll of the exerci
+0001aaf0: 7365 7320 696e 2074 6865 2067 726f 7570  ses in the group
+0001ab00: 2061 7265 2063 6f6d 706c 6574 652c 2069   are complete, i
+0001ab10: 7420 636f 756e 7473 2061 730a 2020 2020  t counts as.    
+0001ab20: 2020 2020 2270 6572 6665 6374 222e 0a20      "perfect".. 
+0001ab30: 2020 2032 2e20 4966 2061 7420 6c65 6173     2. If at leas
+0001ab40: 7420 3830 2520 2863 6f6e 6669 6775 7261  t 80% (configura
+0001ab50: 626c 6520 6173 2060 4558 4552 4349 5345  ble as `EXERCISE
+0001ab60: 5f47 524f 5550 5f54 4852 4553 484f 4c44  _GROUP_THRESHOLD
+0001ab70: 6029 206f 660a 2020 2020 2020 2020 7468  `) of.        th
+0001ab80: 6520 6578 6572 6369 7365 7320 696e 2074  e exercises in t
+0001ab90: 6865 2067 726f 7570 2061 7265 2063 6f6d  he group are com
+0001aba0: 706c 6574 6520 2863 6f75 6e74 696e 670a  plete (counting.
+0001abb0: 2020 2020 2020 2020 7061 7274 6961 6c6c          partiall
+0001abc0: 792d 636f 6d70 6c65 7465 2065 7865 7263  y-complete exerc
+0001abd0: 6973 6573 2061 7320 312f 3229 2074 6865  ises as 1/2) the
+0001abe0: 6e20 7468 6520 6772 6f75 7020 636f 756e  n the group coun
+0001abf0: 7473 2061 730a 2020 2020 2020 2020 2263  ts as.        "c
+0001ac00: 6f6d 706c 6574 6522 2e0a 2020 2020 332e  omplete"..    3.
+0001ac10: 2049 6620 6174 206c 6561 7374 2060 4558   If at least `EX
+0001ac20: 4552 4349 5345 5f47 524f 5550 5f50 4152  ERCISE_GROUP_PAR
+0001ac30: 5449 414c 5f54 4852 4553 484f 4c44 6020  TIAL_THRESHOLD` 
+0001ac40: 2864 6566 6175 6c74 2032 2f35 2920 6275  (default 2/5) bu
+0001ac50: 740a 2020 2020 2020 2020 6c65 7373 2074  t.        less t
+0001ac60: 6861 6e20 7468 6520 6045 5845 5243 4953  han the `EXERCIS
+0001ac70: 455f 4752 4f55 505f 5448 5245 5348 4f4c  E_GROUP_THRESHOL
+0001ac80: 4460 2066 7261 6374 696f 6e20 6f66 2074  D` fraction of t
+0001ac90: 6865 0a20 2020 2020 2020 2065 7865 7263  he.        exerc
+0001aca0: 6973 6573 2061 7265 2063 6f6d 706c 6574  ises are complet
+0001acb0: 652c 2061 6e64 2074 6865 2070 6861 7365  e, and the phase
+0001acc0: 2069 7320 2264 7565 2220 7468 656e 2074   is "due" then t
+0001acd0: 6865 2073 7461 7475 730a 2020 2020 2020  he status.      
+0001ace0: 2020 7769 6c6c 2062 6520 2270 6172 7469    will be "parti
+0001acf0: 616c 222e 0a20 2020 2034 2e20 4966 2061  al"..    4. If a
+0001ad00: 2073 6d61 6c6c 6572 2066 7261 6374 696f   smaller fractio
+0001ad10: 6e20 7468 616e 2060 4558 4552 4349 5345  n than `EXERCISE
+0001ad20: 5f47 524f 5550 5f50 4152 5449 414c 5f54  _GROUP_PARTIAL_T
+0001ad30: 4852 4553 484f 4c44 6020 6f66 0a20 2020  HRESHOLD` of.   
+0001ad40: 2020 2020 2074 6865 2065 7865 7263 6973       the exercis
+0001ad50: 6573 2061 7265 2063 6f6d 706c 6574 6520  es are complete 
+0001ad60: 2873 7469 6c6c 2063 6f75 6e74 696e 6720  (still counting 
+0001ad70: 7061 7274 6961 6c20 636f 6d70 6c65 7469  partial completi
+0001ad80: 6f6e 730a 2020 2020 2020 2020 6173 2031  ons.        as 1
+0001ad90: 2f32 2920 616e 6420 7468 6520 7068 6173  /2) and the phas
+0001ada0: 6520 6973 2022 6475 6522 2074 6865 6e20  e is "due" then 
+0001adb0: 7468 6520 7374 6174 7573 2077 696c 6c20  the status will 
+0001adc0: 6265 0a20 2020 2020 2020 2022 696e 636f  be.        "inco
+0001add0: 6d70 6c65 7465 222e 0a20 2020 2035 2e20  mplete"..    5. 
+0001ade0: 4966 2074 6865 2073 7461 7475 7320 776f  If the status wo
+0001adf0: 756c 6420 6265 206c 6573 7320 7468 616e  uld be less than
+0001ae00: 2022 636f 6d70 6c65 7465 2220 6275 7420   "complete" but 
+0001ae10: 7468 6520 7068 6173 6520 6973 0a20 2020  the phase is.   
+0001ae20: 2020 2020 2022 7265 6c65 6173 6564 2220       "released" 
+0001ae30: 696e 7374 6561 6420 6f66 2022 6475 6522  instead of "due"
+0001ae40: 2074 6865 6e20 7468 6520 7374 6174 7573   then the status
+0001ae50: 2077 696c 6c20 6265 2022 7065 6e64 696e   will be "pendin
+0001ae60: 6722 0a20 2020 2020 2020 2028 696e 636c  g".        (incl
+0001ae70: 7564 696e 6720 7768 656e 207a 6572 6f20  uding when zero 
+0001ae80: 6578 6572 6369 7365 7320 6861 7665 2062  exercises have b
+0001ae90: 6565 6e20 7375 626d 6974 7465 6420 7965  een submitted ye
+0001aea0: 7429 2e0a 2020 2020 362e 2049 6620 7468  t)..    6. If th
+0001aeb0: 6520 7068 6173 6520 6973 2022 7072 6572  e phase is "prer
+0001aec0: 656c 6561 7365 2220 7468 656e 2074 6865  elease" then the
+0001aed0: 2073 7461 7475 7320 7769 6c6c 2062 6520   status will be 
+0001aee0: 2275 6e72 656c 6561 7365 6422 0a20 2020  "unreleased".   
+0001aef0: 2020 2020 2075 6e6c 6573 7320 7375 626d       unless subm
+0001af00: 6973 7369 6f6e 7320 746f 206f 6e65 206f  issions to one o
+0001af10: 7220 6d6f 7265 2065 7865 7263 6973 6573  r more exercises
+0001af20: 2068 6176 6520 616c 7265 6164 790a 2020   have already.  
+0001af30: 2020 2020 2020 6861 7070 656e 6564 2c20        happened, 
+0001af40: 696e 2077 6869 6368 2063 6173 6520 6974  in which case it
+0001af50: 7320 7374 6174 7573 2077 696c 6c20 6265  s status will be
+0001af60: 206f 6e65 206f 6620 2270 656e 6469 6e67   one of "pending
+0001af70: 222c 0a20 2020 2020 2020 2022 636f 6d70  ",.        "comp
+0001af80: 6c65 7465 222c 206f 7220 2270 6572 6665  lete", or "perfe
+0001af90: 6374 2220 6465 7065 6e64 696e 6720 6f6e  ct" depending on
+0001afa0: 2068 6f77 206d 616e 7920 6578 6572 6369   how many exerci
+0001afb0: 7365 7320 6172 650a 2020 2020 2020 2020  ses are.        
+0001afc0: 636f 6d70 6c65 7465 2e0a 0a20 2020 204e  complete...    N
+0001afd0: 6f74 653a 2061 6e20 656d 7074 7920 6f75  ote: an empty ou
+0001afe0: 7463 6f6d 6573 2064 6963 7469 6f6e 6172  tcomes dictionar
+0001aff0: 7920 6d61 7920 6265 2070 726f 7669 6465  y may be provide
+0001b000: 6420 6966 2079 6f75 206f 6e6c 7920 6361  d if you only ca
+0001b010: 7265 0a20 2020 2061 626f 7574 2073 6574  re.    about set
+0001b020: 7469 6e67 2067 726f 7570 2070 6861 7365  ting group phase
+0001b030: 2061 6e64 2065 7874 656e 7369 6f6e 2069   and extension i
+0001b040: 6e66 6f20 616e 6420 6172 6520 7769 6c6c  nfo and are will
+0001b050: 696e 6720 746f 206c 6574 0a20 2020 2063  ing to let.    c
+0001b060: 7265 6469 7420 696e 666f 2062 6520 696e  redit info be in
+0001b070: 6163 6375 7261 7465 2e0a 2020 2020 2222  accurate..    ""
+0001b080: 220a 2020 2020 2320 4765 7420 6375 7272  ".    # Get curr
+0001b090: 656e 7420 7469 6d65 3a0a 2020 2020 6966  ent time:.    if
+0001b0a0: 2022 5041 5553 455f 4154 2220 696e 2074   "PAUSE_AT" in t
+0001b0b0: 6173 6b5f 696e 666f 2061 6e64 2074 6173  ask_info and tas
+0001b0c0: 6b5f 696e 666f 5b22 5041 5553 455f 4154  k_info["PAUSE_AT
+0001b0d0: 225d 3a0a 2020 2020 2020 2020 6e6f 7720  "]:.        now 
+0001b0e0: 3d20 706f 746c 7563 6b2e 7469 6d65 5f75  = potluck.time_u
+0001b0f0: 7469 6c73 2e74 6173 6b5f 7469 6d65 5f5f  tils.task_time__
+0001b100: 7469 6d65 280a 2020 2020 2020 2020 2020  time(.          
+0001b110: 2020 7461 736b 5f69 6e66 6f2c 0a20 2020    task_info,.   
+0001b120: 2020 2020 2020 2020 2074 6173 6b5f 696e           task_in
+0001b130: 666f 5b22 5041 5553 455f 4154 225d 0a20  fo["PAUSE_AT"]. 
+0001b140: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
+0001b150: 653a 0a20 2020 2020 2020 206e 6f77 203d  e:.        now =
+0001b160: 2070 6f74 6c75 636b 2e74 696d 655f 7574   potluck.time_ut
+0001b170: 696c 732e 6e6f 7728 290a 0a20 2020 2023  ils.now()..    #
+0001b180: 2053 7461 6e64 6172 6420 6578 7465 6e73   Standard extens
+0001b190: 696f 6e20 686f 7572 730a 2020 2020 7374  ion hours.    st
+0001b1a0: 616e 6461 7264 5f65 7874 5f68 7273 203d  andard_ext_hrs =
+0001b1b0: 2074 6173 6b5f 696e 666f 2e67 6574 2822   task_info.get("
+0001b1c0: 6578 7465 6e73 696f 6e5f 686f 7572 7322  extension_hours"
+0001b1d0: 2c20 3234 290a 0a20 2020 2023 2041 6d65  , 24)..    # Ame
+0001b1e0: 6e64 2067 726f 7570 7320 616e 6420 6578  nd groups and ex
+0001b1f0: 6572 6369 7365 730a 2020 2020 666f 7220  ercises.    for 
+0001b200: 6772 6f75 7020 696e 2074 6173 6b5f 696e  group in task_in
+0001b210: 666f 2e67 6574 2822 6578 6572 6369 7365  fo.get("exercise
+0001b220: 7322 2c20 5b5d 293a 0a20 2020 2020 2020  s", []):.       
+0001b230: 2023 2047 6574 2065 7874 656e 7369 6f6e   # Get extension
+0001b240: 2076 616c 7565 0a20 2020 2020 2020 2065   value.        e
+0001b250: 7874 656e 7369 6f6e 203d 2073 746f 7261  xtension = stora
+0001b260: 6765 2e67 6574 5f65 7874 656e 7369 6f6e  ge.get_extension
+0001b270: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
+0001b280: 7572 7365 2c0a 2020 2020 2020 2020 2020  urse,.          
+0001b290: 2020 7365 6d65 7374 6572 2c0a 2020 2020    semester,.    
+0001b2a0: 2020 2020 2020 2020 7573 6572 6e61 6d65          username
+0001b2b0: 2c0a 2020 2020 2020 2020 2020 2020 6772  ,.            gr
+0001b2c0: 6f75 705b 2267 726f 7570 225d 2c0a 2020  oup["group"],.  
+0001b2d0: 2020 2020 2020 2020 2020 2269 6e69 7469            "initi
+0001b2e0: 616c 220a 2020 2020 2020 2020 290a 2020  al".        ).  
+0001b2f0: 2020 2020 2020 6966 2065 7874 656e 7369        if extensi
+0001b300: 6f6e 2069 7320 4e6f 6e65 3a0a 2020 2020  on is None:.    
+0001b310: 2020 2020 2020 2020 666c 6173 6b2e 666c          flask.fl
+0001b320: 6173 6828 0a20 2020 2020 2020 2020 2020  ash(.           
+0001b330: 2020 2020 2022 4572 726f 7220 6665 7463       "Error fetc
+0001b340: 6869 6e67 2065 7865 7263 6973 6520 6578  hing exercise ex
+0001b350: 7465 6e73 696f 6e20 696e 666f 2028 7472  tension info (tr
+0001b360: 6561 7469 6e67 2061 7320 3029 2e22 0a20  eating as 0).". 
+0001b370: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001b380: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0001b390: 6f6e 203d 2030 0a20 2020 2020 2020 2065  on = 0.        e
+0001b3a0: 6c69 6620 6578 7465 6e73 696f 6e20 6973  lif extension is
+0001b3b0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+0001b3c0: 2020 2065 7874 656e 7369 6f6e 203d 2073     extension = s
+0001b3d0: 7461 6e64 6172 645f 6578 745f 6872 730a  tandard_ext_hrs.
+0001b3e0: 2020 2020 2020 2020 656c 6966 2065 7874          elif ext
+0001b3f0: 656e 7369 6f6e 2069 7320 4661 6c73 653a  ension is False:
+0001b400: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
+0001b410: 656e 7369 6f6e 203d 2030 0a20 2020 2020  ension = 0.     
+0001b420: 2020 2065 6c69 6620 6e6f 7420 6973 696e     elif not isin
+0001b430: 7374 616e 6365 2865 7874 656e 7369 6f6e  stance(extension
+0001b440: 2c20 2869 6e74 2c20 666c 6f61 7429 293a  , (int, float)):
+0001b450: 0a20 2020 2020 2020 2020 2020 2066 6c61  .            fla
+0001b460: 736b 2e66 6c61 7368 280a 2020 2020 2020  sk.flash(.      
+0001b470: 2020 2020 2020 2020 2020 2249 676e 6f72            "Ignor
+0001b480: 696e 6720 696e 7661 6c69 6420 696e 6974  ing invalid init
+0001b490: 6961 6c20 6578 7465 6e73 696f 6e20 7661  ial extension va
+0001b4a0: 6c75 6520 277b 7d27 222e 666f 726d 6174  lue '{}'".format
+0001b4b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001b4c0: 2020 2020 2020 6578 7465 6e73 696f 6e0a        extension.
+0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4e0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+0001b4f0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+0001b500: 6e73 696f 6e20 3d20 300a 2020 2020 2020  nsion = 0.      
+0001b510: 2020 2320 4e6f 7720 2765 7874 656e 7369    # Now 'extensi
+0001b520: 6f6e 2720 6973 2061 206e 756d 6265 7220  on' is a number 
+0001b530: 736f 2077 6520 7374 6f72 6520 6974 0a20  so we store it. 
+0001b540: 2020 2020 2020 2067 726f 7570 5b22 6578         group["ex
+0001b550: 7465 6e73 696f 6e22 5d20 3d20 6578 7465  tension"] = exte
+0001b560: 6e73 696f 6e0a 0a20 2020 2020 2020 2023  nsion..        #
+0001b570: 2047 6574 2072 656c 6561 7365 202b 2074   Get release + t
+0001b580: 696d 656c 7920 7469 6d65 730a 2020 2020  imely times.    
+0001b590: 2020 2020 7265 6c65 6173 655f 6174 203d      release_at =
+0001b5a0: 2070 6f74 6c75 636b 2e74 696d 655f 7574   potluck.time_ut
+0001b5b0: 696c 732e 7461 736b 5f74 696d 655f 5f74  ils.task_time__t
+0001b5c0: 696d 6528 0a20 2020 2020 2020 2020 2020  ime(.           
+0001b5d0: 2074 6173 6b5f 696e 666f 2c0a 2020 2020   task_info,.    
+0001b5e0: 2020 2020 2020 2020 6772 6f75 705b 2272          group["r
+0001b5f0: 656c 6561 7365 225d 2c0a 2020 2020 2020  elease"],.      
+0001b600: 2020 2020 2020 6465 6661 756c 745f 7469        default_ti
+0001b610: 6d65 5f6f 665f 6461 793d 7461 736b 5f69  me_of_day=task_i
+0001b620: 6e66 6f2e 6765 7428 0a20 2020 2020 2020  nfo.get(.       
+0001b630: 2020 2020 2020 2020 2022 6465 6661 756c           "defaul
+0001b640: 745f 7265 6c65 6173 655f 7469 6d65 5f6f  t_release_time_o
+0001b650: 665f 6461 7922 2c0a 2020 2020 2020 2020  f_day",.        
+0001b660: 2020 2020 2020 2020 2232 333a 3539 220a          "23:59".
+0001b670: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001b680: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001b690: 7469 6d65 6c79 5f62 7920 3d20 706f 746c  timely_by = potl
+0001b6a0: 7563 6b2e 7469 6d65 5f75 7469 6c73 2e74  uck.time_utils.t
+0001b6b0: 6173 6b5f 7469 6d65 5f5f 7469 6d65 280a  ask_time__time(.
+0001b6c0: 2020 2020 2020 2020 2020 2020 7461 736b              task
+0001b6d0: 5f69 6e66 6f2c 0a20 2020 2020 2020 2020  _info,.         
+0001b6e0: 2020 2067 726f 7570 5b22 7469 6d65 6c79     group["timely
+0001b6f0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0001b700: 6465 6661 756c 745f 7469 6d65 5f6f 665f  default_time_of_
+0001b710: 6461 793d 7461 736b 5f69 6e66 6f2e 6765  day=task_info.ge
+0001b720: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+0001b730: 2020 2022 6465 6661 756c 745f 7265 6c65     "default_rele
+0001b740: 6173 655f 7469 6d65 5f6f 665f 6461 7922  ase_time_of_day"
+0001b750: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b760: 2020 2232 333a 3539 220a 2020 2020 2020    "23:59".      
+0001b770: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001b780: 290a 0a20 2020 2020 2020 2023 2041 7070  )..        # App
+0001b790: 6c79 2074 6865 2065 7874 656e 7369 6f6e  ly the extension
+0001b7a0: 0a20 2020 2020 2020 2074 696d 656c 795f  .        timely_
+0001b7b0: 6279 202b 3d20 6461 7465 7469 6d65 2e74  by += datetime.t
+0001b7c0: 696d 6564 656c 7461 2868 6f75 7273 3d65  imedelta(hours=e
+0001b7d0: 7874 656e 7369 6f6e 290a 0a20 2020 2020  xtension)..     
+0001b7e0: 2020 2023 2053 746f 7265 2063 616c 6375     # Store calcu
+0001b7f0: 6c61 7465 6420 6465 6164 6c69 6e65 0a20  lated deadline. 
+0001b800: 2020 2020 2020 2067 726f 7570 5b22 7469         group["ti
+0001b810: 6d65 6c79 5f62 7922 5d20 3d20 7469 6d65  mely_by"] = time
+0001b820: 6c79 5f62 790a 0a20 2020 2020 2020 2023  ly_by..        #
+0001b830: 2046 6967 7572 6520 6f75 7420 616e 6420   Figure out and 
+0001b840: 6170 706c 7920 7469 6d65 2070 6861 7365  apply time phase
+0001b850: 2074 6f20 6772 6f75 700a 2020 2020 2020   to group.      
+0001b860: 2020 6966 206e 6f77 203c 2072 656c 6561    if now < relea
+0001b870: 7365 5f61 743a 0a20 2020 2020 2020 2020  se_at:.         
+0001b880: 2020 2070 6861 7365 203d 2022 7072 6572     phase = "prer
+0001b890: 656c 6561 7365 220a 2020 2020 2020 2020  elease".        
+0001b8a0: 656c 6966 206e 6f77 203c 2074 696d 656c  elif now < timel
+0001b8b0: 795f 6279 3a0a 2020 2020 2020 2020 2020  y_by:.          
+0001b8c0: 2020 7068 6173 6520 3d20 2272 656c 6561    phase = "relea
+0001b8d0: 7365 6422 0a20 2020 2020 2020 2065 6c73  sed".        els
+0001b8e0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0001b8f0: 6861 7365 203d 2022 6475 6522 0a20 2020  hase = "due".   
+0001b900: 2020 2020 2067 726f 7570 5b22 7068 6173       group["phas
+0001b910: 6522 5d20 3d20 7068 6173 650a 0a20 2020  e"] = phase..   
+0001b920: 2020 2020 2023 2054 7261 636b 7320 6578       # Tracks ex
+0001b930: 6572 6369 7365 2063 7265 6469 7420 2620  ercise credit & 
+0001b940: 6d61 7820 666f 7220 616c 6c20 6578 6572  max for all exer
+0001b950: 6369 7365 7320 696e 2074 6865 2067 726f  cises in the gro
+0001b960: 7570 0a20 2020 2020 2020 2067 726f 7570  up.        group
+0001b970: 5f63 7265 6469 7420 3d20 300a 2020 2020  _credit = 0.    
+0001b980: 2020 2020 6772 6f75 705f 6d61 7820 3d20      group_max = 
+0001b990: 300a 0a20 2020 2020 2020 2023 204d 616b  0..        # Mak
+0001b9a0: 6520 616c 6c6f 7761 6e63 6573 2066 6f72  e allowances for
+0001b9b0: 206f 6c64 2066 6f72 6d61 740a 2020 2020   old format.    
+0001b9c0: 2020 2020 656c 6973 7420 3d20 6772 6f75      elist = grou
+0001b9d0: 705b 2265 7865 7263 6973 6573 225d 0a20  p["exercises"]. 
+0001b9e0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0001b9f0: 616e 6365 2865 6c69 7374 2c20 6469 6374  ance(elist, dict
+0001ba00: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+0001ba10: 6f72 2065 6964 2069 6e20 656c 6973 743a  or eid in elist:
+0001ba20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ba30: 2065 6c69 7374 5b65 6964 5d5b 2769 6427   elist[eid]['id'
+0001ba40: 5d20 3d20 6569 640a 2020 2020 2020 2020  ] = eid.        
+0001ba50: 2020 2020 656c 6973 7420 3d20 6c69 7374      elist = list
+0001ba60: 2865 6c69 7374 2e76 616c 7565 7328 2929  (elist.values())
+0001ba70: 0a0a 2020 2020 2020 2020 2320 436f 6e73  ..        # Cons
+0001ba80: 6964 6572 2065 6163 6820 696e 6469 7669  ider each indivi
+0001ba90: 6475 616c 2065 7865 7263 6973 6520 696e  dual exercise in
+0001baa0: 2074 6865 2067 726f 7570 0a20 2020 2020   the group.     
+0001bab0: 2020 2066 6f72 2065 696e 666f 2069 6e20     for einfo in 
+0001bac0: 656c 6973 743a 0a20 2020 2020 2020 2020  elist:.         
+0001bad0: 2020 2065 6964 203d 2065 696e 666f 5b27     eid = einfo['
+0001bae0: 6964 275d 0a20 2020 2020 2020 2020 2020  id'].           
+0001baf0: 2023 2041 6464 2074 6f20 6d61 7820 6372   # Add to max cr
+0001bb00: 6564 6974 0a20 2020 2020 2020 2020 2020  edit.           
+0001bb10: 2067 726f 7570 5f6d 6178 202b 3d20 310a   group_max += 1.
+0001bb20: 0a20 2020 2020 2020 2020 2020 2023 2047  .            # G
+0001bb30: 6574 2069 6e66 6f20 616e 6420 6f75 7463  et info and outc
+0001bb40: 6f6d 6573 0a20 2020 2020 2020 2020 2020  omes.           
+0001bb50: 206f 7574 636f 6d65 735f 6865 7265 203d   outcomes_here =
+0001bb60: 206f 7574 636f 6d65 732e 6765 7428 6569   outcomes.get(ei
+0001bb70: 642c 207b 7d29 0a20 2020 2020 2020 2020  d, {}).         
+0001bb80: 2020 2065 696e 666f 5b22 7374 6174 7573     einfo["status
+0001bb90: 225d 203d 206f 7574 636f 6d65 735f 6865  "] = outcomes_he
+0001bba0: 7265 2e67 6574 2827 7374 6174 7573 272c  re.get('status',
+0001bbb0: 2022 756e 7375 626d 6974 7465 6422 290a   "unsubmitted").
+0001bbc0: 2020 2020 2020 2020 2020 2020 6569 6e66              einf
+0001bbd0: 6f5b 226f 6e5f 7469 6d65 225d 203d 206f  o["on_time"] = o
+0001bbe0: 7574 636f 6d65 735f 6865 7265 2e67 6574  utcomes_here.get
+0001bbf0: 2827 6f6e 5f74 696d 6527 2c20 5472 7565  ('on_time', True
+0001bc00: 290a 2020 2020 2020 2020 2020 2020 6569  ).            ei
+0001bc10: 6e66 6f5b 2263 7265 6469 7422 5d20 3d20  nfo["credit"] = 
+0001bc20: 6f75 7463 6f6d 6573 5f68 6572 652e 6765  outcomes_here.ge
+0001bc30: 7428 2763 7265 6469 7427 2c20 4e6f 6e65  t('credit', None
+0001bc40: 290a 2020 2020 2020 2020 2020 2020 6569  ).            ei
+0001bc50: 6e66 6f5b 2267 726f 7570 5f63 7265 6469  nfo["group_credi
+0001bc60: 7422 5d20 3d20 6f75 7463 6f6d 6573 5f68  t"] = outcomes_h
+0001bc70: 6572 652e 6765 7428 0a20 2020 2020 2020  ere.get(.       
+0001bc80: 2020 2020 2020 2020 2027 6772 6f75 705f           'group_
+0001bc90: 6372 6564 6974 272c 0a20 2020 2020 2020  credit',.       
+0001bca0: 2020 2020 2020 2020 2023 2042 6163 6b75           # Backu
+0001bcb0: 7020 696e 2063 6173 6520 7765 2772 6520  p in case we're 
+0001bcc0: 6465 616c 696e 6720 7769 7468 206f 6c64  dealing with old
+0001bcd0: 6572 2064 6174 610a 2020 2020 2020 2020  er data.        
+0001bce0: 2020 2020 2020 2020 6f75 7463 6f6d 6573          outcomes
+0001bcf0: 5f68 6572 652e 6765 7428 2263 7265 6469  _here.get("credi
+0001bd00: 7422 2c20 3029 0a20 2020 2020 2020 2020  t", 0).         
+0001bd10: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0001bd20: 2020 2320 4163 6375 6d75 6c61 7465 2063    # Accumulate c
+0001bd30: 7265 6469 7420 6163 726f 7373 2074 6865  redit across the
+0001bd40: 2077 686f 6c65 2067 726f 7570 0a20 2020   whole group.   
+0001bd50: 2020 2020 2020 2020 2067 726f 7570 5f63           group_c
+0001bd60: 7265 6469 7420 2b3d 2065 696e 666f 5b22  redit += einfo["
+0001bd70: 6772 6f75 705f 6372 6564 6974 225d 0a0a  group_credit"]..
+0001bd80: 2020 2020 2020 2020 2320 4e6f 7720 7468          # Now th
+0001bd90: 6174 2077 6520 6b6e 6f77 2074 6865 2065  at we know the e
+0001bda0: 7865 7263 6973 6520 6f75 7463 6f6d 6573  xercise outcomes
+0001bdb0: 2066 6f72 2065 6163 6820 6578 6572 6369   for each exerci
+0001bdc0: 7365 2069 6e0a 2020 2020 2020 2020 2320  se in.        # 
+0001bdd0: 7468 6973 2067 726f 7570 2c20 6361 6c63  this group, calc
+0001bde0: 756c 6174 6520 6120 6772 6f75 7020 7374  ulate a group st
+0001bdf0: 6174 7573 2062 6173 6564 206f 6e20 7468  atus based on th
+0001be00: 6520 6578 6572 6369 7365 0a20 2020 2020  e exercise.     
+0001be10: 2020 2023 206f 7574 636f 6d65 7320 616e     # outcomes an
+0001be20: 6420 7468 6520 6772 6f75 7020 7068 6173  d the group phas
+0001be30: 652e 0a20 2020 2020 2020 2063 7265 6469  e..        credi
+0001be40: 745f 6672 6163 7469 6f6e 203d 2067 726f  t_fraction = gro
+0001be50: 7570 5f63 7265 6469 7420 2f20 666c 6f61  up_credit / floa
+0001be60: 7428 6772 6f75 705f 6d61 7829 0a20 2020  t(group_max).   
+0001be70: 2020 2020 2069 6620 6372 6564 6974 5f66       if credit_f
+0001be80: 7261 6374 696f 6e20 3d3d 2031 3a0a 2020  raction == 1:.  
+0001be90: 2020 2020 2020 2020 2020 7374 6174 7573            status
+0001bea0: 203d 2022 7065 7266 6563 7422 0a20 2020   = "perfect".   
+0001beb0: 2020 2020 2065 6c69 6620 6372 6564 6974       elif credit
+0001bec0: 5f66 7261 6374 696f 6e20 3e3d 2061 7070  _fraction >= app
+0001bed0: 2e63 6f6e 6669 672e 6765 7428 0a20 2020  .config.get(.   
+0001bee0: 2020 2020 2020 2020 2022 4558 4552 4349           "EXERCI
+0001bef0: 5345 5f47 524f 5550 5f54 4852 4553 484f  SE_GROUP_THRESHO
+0001bf00: 4c44 222c 0a20 2020 2020 2020 2020 2020  LD",.           
+0001bf10: 2030 2e38 0a20 2020 2020 2020 2029 3a0a   0.8.        ):.
+0001bf20: 2020 2020 2020 2020 2020 2020 7374 6174              stat
+0001bf30: 7573 203d 2022 636f 6d70 6c65 7465 220a  us = "complete".
+0001bf40: 2020 2020 2020 2020 656c 6966 2063 7265          elif cre
+0001bf50: 6469 745f 6672 6163 7469 6f6e 203e 3d20  dit_fraction >= 
+0001bf60: 6170 702e 636f 6e66 6967 2e67 6574 280a  app.config.get(.
+0001bf70: 2020 2020 2020 2020 2020 2020 2245 5845              "EXE
+0001bf80: 5243 4953 455f 4752 4f55 505f 5041 5254  RCISE_GROUP_PART
+0001bf90: 4941 4c5f 5448 5245 5348 4f4c 4422 2c0a  IAL_THRESHOLD",.
+0001bfa0: 2020 2020 2020 2020 2020 2020 302e 340a              0.4.
+0001bfb0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+0001bfc0: 2020 2020 2020 2073 7461 7475 7320 3d20         status = 
+0001bfd0: 2270 6172 7469 616c 220a 2020 2020 2020  "partial".      
+0001bfe0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001bff0: 2020 2020 7374 6174 7573 203d 2022 696e      status = "in
+0001c000: 636f 6d70 6c65 7465 220a 0a20 2020 2020  complete"..     
+0001c010: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
+0001c020: 2020 2020 7068 6173 6520 696e 2028 2270      phase in ("p
+0001c030: 7265 7265 6c65 6173 6522 2c20 2272 656c  rerelease", "rel
+0001c040: 6561 7365 6422 290a 2020 2020 2020 2020  eased").        
+0001c050: 616e 6420 7374 6174 7573 206e 6f74 2069  and status not i
+0001c060: 6e20 2822 7065 7266 6563 7422 2c20 2263  n ("perfect", "c
+0001c070: 6f6d 706c 6574 6522 290a 2020 2020 2020  omplete").      
+0001c080: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0001c090: 2073 7461 7475 7320 3d20 2270 656e 6469   status = "pendi
+0001c0a0: 6e67 220a 0a20 2020 2020 2020 2069 6620  ng"..        if 
+0001c0b0: 7068 6173 6520 3d3d 2022 7072 6572 656c  phase == "prerel
+0001c0c0: 6561 7365 2220 616e 6420 6772 6f75 705f  ease" and group_
+0001c0d0: 6372 6564 6974 203d 3d20 303a 0a20 2020  credit == 0:.   
+0001c0e0: 2020 2020 2020 2020 2073 7461 7475 7320           status 
+0001c0f0: 3d20 2275 6e72 656c 6561 7365 6422 0a0a  = "unreleased"..
+0001c100: 2020 2020 2020 2020 6772 6f75 705b 2273          group["s
+0001c110: 7461 7475 7322 5d20 3d20 7374 6174 7573  tatus"] = status
+0001c120: 0a20 2020 2020 2020 2067 726f 7570 5b22  .        group["
+0001c130: 6372 6564 6974 5f66 7261 6374 696f 6e22  credit_fraction"
+0001c140: 5d20 3d20 6372 6564 6974 5f66 7261 6374  ] = credit_fract
+0001c150: 696f 6e0a 0a0a 6465 6620 7365 745f 636f  ion...def set_co
+0001c160: 6e63 6570 745f 7374 6174 7573 6573 2863  ncept_statuses(c
+0001c170: 6f6e 6365 7074 732c 2074 6173 6b5f 696e  oncepts, task_in
+0001c180: 666f 2c20 6f75 7463 6f6d 6573 293a 0a20  fo, outcomes):. 
+0001c190: 2020 2022 2222 0a20 2020 2055 7064 6174     """.    Updat
+0001c1a0: 6573 2074 6865 2070 726f 7669 6465 6420  es the provided 
+0001c1b0: 636f 6e63 6570 7473 206c 6973 7420 2877  concepts list (w
+0001c1c0: 686f 7365 2065 6c65 6d65 6e74 7320 6172  hose elements ar
+0001c1d0: 6520 636f 6e63 6570 740a 2020 2020 6469  e concept.    di
+0001c1e0: 6374 696f 6e61 7269 6573 2077 6869 6368  ctionaries which
+0001c1f0: 206d 6967 6874 2068 6176 6520 2266 6163   might have "fac
+0001c200: 6574 7322 2073 6c6f 7473 2074 6861 7420  ets" slots that 
+0001c210: 6861 7665 2073 7562 2d63 6f6e 6365 7074  have sub-concept
+0001c220: 730a 2020 2020 696e 2074 6865 6d29 2077  s.    in them) w
+0001c230: 6974 6820 7374 6174 7573 2069 6e66 6f20  ith status info 
+0001c240: 6261 7365 6420 6f6e 2074 6865 2067 6976  based on the giv
+0001c250: 656e 2028 616d 656e 6465 6429 2074 6173  en (amended) tas
+0001c260: 6b20 696e 666f 2061 6e64 0a20 2020 2065  k info and.    e
+0001c270: 7865 7263 6973 6520 6f75 7463 6f6d 6573  xercise outcomes
+0001c280: 2070 726f 7669 6465 642e 2059 6f75 206d   provided. You m
+0001c290: 7573 7420 6361 6c6c 2060 616d 656e 645f  ust call `amend_
+0001c2a0: 7461 736b 5f69 6e66 6f60 2c0a 2020 2020  task_info`,.    
+0001c2b0: 6061 6d65 6e64 5f65 7865 7263 6973 6573  `amend_exercises
+0001c2c0: 602c 2061 6e64 2060 6175 676d 656e 745f  `, and `augment_
+0001c2d0: 636f 6e63 6570 7473 6020 6265 666f 7265  concepts` before
+0001c2e0: 2063 616c 6c69 6e67 2074 6869 730a 2020   calling this.  
+0001c2f0: 2020 6675 6e63 7469 6f6e 2e0a 0a20 2020    function...   
+0001c300: 2054 6865 2063 6f6e 6365 7074 7320 6469   The concepts di
+0001c310: 6374 696f 6e61 7279 2069 7320 6469 7265  ctionary is dire
+0001c320: 6374 6c79 2061 7567 6d65 6e74 6564 2073  ctly augmented s
+0001c330: 6f20 7468 6174 2065 6163 6820 636f 6e63  o that each conc
+0001c340: 6570 740a 2020 2020 6861 7320 7468 6520  ept.    has the 
+0001c350: 666f 6c6c 6f77 696e 6720 736c 6f74 733a  following slots:
+0001c360: 0a20 2020 202d 2022 7374 6174 7573 2220  .    - "status" 
+0001c370: 686f 6c64 696e 6720 616e 2061 6767 7265  holding an aggre
+0001c380: 6761 7465 2073 7461 7475 7320 7374 7269  gate status stri
+0001c390: 6e67 0a20 2020 202d 2022 6f75 7463 6f6d  ng.    - "outcom
+0001c3a0: 6573 2220 686f 6c64 696e 6720 6120 6c69  es" holding a li
+0001c3b0: 7374 206f 6620 7265 6c65 7661 6e74 206f  st of relevant o
+0001c3c0: 7574 636f 6d65 7320 7475 706c 6573 2045  utcomes tuples E
+0001c3d0: 6163 6820 6f75 7463 6f6d 650a 2020 2020  ach outcome.    
+0001c3e0: 2020 2020 7475 706c 6520 6861 7320 616e      tuple has an
+0001c3f0: 2065 7865 7263 6973 652f 7461 736b 2d69   exercise/task-i
+0001c400: 642c 2061 206e 756d 6572 6963 2028 302d  d, a numeric (0-
+0001c410: 3129 206f 7574 636f 6d65 2076 616c 7565  1) outcome value
+0001c420: 2c0a 2020 2020 2020 2020 616e 6420 7374  ,.        and st
+0001c430: 7269 6e67 2028 2774 6173 6b27 2c20 2765  ring ('task', 'e
+0001c440: 7865 7263 6973 6527 2c20 6f72 2027 6f75  xercise', or 'ou
+0001c450: 7463 6f6d 6527 2920 7370 6563 6966 7969  tcome') specifyi
+0001c460: 6e67 2077 6865 7468 6572 0a20 2020 2020  ng whether.     
+0001c470: 2020 2069 7427 7320 616e 2069 6e64 6976     it's an indiv
+0001c480: 6964 7561 6c20 6f75 7463 6f6d 6520 6f72  idual outcome or
+0001c490: 2061 6e20 6167 6772 6567 6174 6520 6f75   an aggregate ou
+0001c4a0: 7463 6f6d 6520 6672 6f6d 2061 2074 6173  tcome from a tas
+0001c4b0: 6b0a 2020 2020 2020 2020 6f72 2065 7865  k.        or exe
+0001c4c0: 7263 6973 652e 0a20 2020 202d 2022 6578  rcise..    - "ex
+0001c4d0: 6572 6369 7365 7322 2068 6f6c 6469 6e67  ercises" holding
+0001c4e0: 2061 2064 6963 7469 6f6e 6172 7920 6d61   a dictionary ma
+0001c4f0: 7070 696e 6720 6578 6572 6369 7365 2049  pping exercise I
+0001c500: 4473 2074 6f0a 2020 2020 2020 2020 7068  Ds to.        ph
+0001c510: 6173 652f 7374 6174 7573 2073 7472 696e  ase/status strin
+0001c520: 6720 7061 6972 7320 666f 7220 6578 6572  g pairs for exer
+0001c530: 6369 7365 7320 7768 6963 6820 6172 6520  cises which are 
+0001c540: 7265 6c65 7661 6e74 2074 6f0a 2020 2020  relevant to.    
+0001c550: 2020 2020 7468 6973 2063 6f6e 6365 7074      this concept
+0001c560: 2e20 5468 6520 6669 7273 7420 7374 7269  . The first stri
+0001c570: 6e67 2072 6570 7265 7365 6e74 7320 7068  ng represents ph
+0001c580: 6173 6520 6173 206f 6e65 206f 660a 2020  ase as one of.  
+0001c590: 2020 2020 2020 2270 7265 7265 6c65 6173        "prereleas
+0001c5a0: 6522 2c20 2272 656c 6561 7365 6422 2c20  e", "released", 
+0001c5b0: 6f72 2022 6475 6522 2074 6f20 7370 6563  or "due" to spec
+0001c5c0: 6966 7920 7468 6520 6578 6572 6369 7365  ify the exercise
+0001c5d0: 2773 0a20 2020 2020 2020 2072 656c 6561  's.        relea
+0001c5e0: 7365 2073 7461 7475 732c 2061 6e64 2074  se status, and t
+0001c5f0: 6865 2073 6563 6f6e 6420 6973 206f 6e65  he second is one
+0001c600: 206f 6620 2263 6f6d 706c 6574 6522 2c20   of "complete", 
+0001c610: 2270 6172 7469 616c 222c 0a20 2020 2020  "partial",.     
+0001c620: 2020 2022 696e 636f 6d70 6c65 7465 222c     "incomplete",
+0001c630: 206f 7220 2275 6e73 7562 6d69 7474 6564   or "unsubmitted
+0001c640: 2220 746f 2073 7065 6369 6679 2074 6865  " to specify the
+0001c650: 2065 7865 7263 6973 6527 730a 2020 2020   exercise's.    
+0001c660: 2020 2020 7375 626d 6973 7369 6f6e 2073      submission s
+0001c670: 7461 7475 732e 2045 7865 7263 6973 6520  tatus. Exercise 
+0001c680: 4944 7320 776f 6e27 7420 6576 656e 2062  IDs won't even b
+0001c690: 6520 696e 2074 6869 7320 6c69 7374 2069  e in this list i
+0001c6a0: 660a 2020 2020 2020 2020 7468 6579 2068  f.        they h
+0001c6b0: 6176 656e 2774 2062 6565 6e20 7375 626d  aven't been subm
+0001c6c0: 6974 7465 6420 7965 742e 0a20 2020 2022  itted yet..    "
+0001c6d0: 2222 0a0a 2020 2020 2320 4174 7461 6368  ""..    # Attach
+0001c6e0: 206f 7574 636f 6d65 7320 746f 2063 6f6e   outcomes to con
+0001c6f0: 6365 7074 7320 6261 7365 6420 6f6e 2065  cepts based on e
+0001c700: 7865 7263 6973 6520 696e 666f 0a20 2020  xercise info.   
+0001c710: 2066 6f72 2067 726f 7570 2069 6e20 7461   for group in ta
+0001c720: 736b 5f69 6e66 6f2e 6765 7428 2265 7865  sk_info.get("exe
+0001c730: 7263 6973 6573 222c 205b 5d29 3a0a 2020  rcises", []):.  
+0001c740: 2020 2020 2020 7068 6173 6520 3d20 6772        phase = gr
+0001c750: 6f75 705b 2270 6861 7365 225d 0a0a 2020  oup["phase"]..  
+0001c760: 2020 2020 2020 2320 4d61 6b65 2061 6c6c        # Make all
+0001c770: 6f77 616e 6365 7320 666f 7220 6f6c 6420  owances for old 
+0001c780: 666f 726d 6174 0a20 2020 2020 2020 2065  format.        e
+0001c790: 6c69 7374 203d 2067 726f 7570 5b22 6578  list = group["ex
+0001c7a0: 6572 6369 7365 7322 5d0a 2020 2020 2020  ercises"].      
+0001c7b0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001c7c0: 656c 6973 742c 2064 6963 7429 3a0a 2020  elist, dict):.  
+0001c7d0: 2020 2020 2020 2020 2020 666f 7220 6569            for ei
+0001c7e0: 6420 696e 2065 6c69 7374 3a0a 2020 2020  d in elist:.    
+0001c7f0: 2020 2020 2020 2020 2020 2020 656c 6973              elis
+0001c800: 745b 6569 645d 5b27 6964 275d 203d 2065  t[eid]['id'] = e
+0001c810: 6964 0a20 2020 2020 2020 2020 2020 2065  id.            e
+0001c820: 6c69 7374 203d 206c 6973 7428 656c 6973  list = list(elis
+0001c830: 742e 7661 6c75 6573 2829 290a 0a20 2020  t.values())..   
+0001c840: 2020 2020 2023 2043 6f6e 7369 6465 7220       # Consider 
+0001c850: 6561 6368 2069 6e64 6976 6964 7561 6c20  each individual 
+0001c860: 6578 6572 6369 7365 2069 6e20 7468 6520  exercise in the 
+0001c870: 6772 6f75 700a 2020 2020 2020 2020 666f  group.        fo
+0001c880: 7220 6569 6e66 6f20 696e 2065 6c69 7374  r einfo in elist
+0001c890: 3a0a 2020 2020 2020 2020 2020 2020 6569  :.            ei
+0001c8a0: 6420 3d20 6569 6e66 6f5b 2769 6427 5d0a  d = einfo['id'].
+0001c8b0: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
+0001c8c0: 7420 696e 666f 2c20 7461 672c 2061 6e64  t info, tag, and
+0001c8d0: 206f 7574 636f 6d65 730a 2020 2020 2020   outcomes.      
+0001c8e0: 2020 2020 2020 6574 6167 203d 2022 7b7d        etag = "{}
+0001c8f0: 3a7b 7d22 2e66 6f72 6d61 7428 6772 6f75  :{}".format(grou
+0001c900: 702c 2065 6964 290a 2020 2020 2020 2020  p, eid).        
+0001c910: 2020 2020 6f75 7463 6f6d 6573 5f68 6572      outcomes_her
+0001c920: 6520 3d20 6f75 7463 6f6d 6573 2e67 6574  e = outcomes.get
+0001c930: 2865 6964 2c20 7b7d 292e 6765 7428 276f  (eid, {}).get('o
+0001c940: 7574 636f 6d65 7327 2c20 4e6f 6e65 290a  utcomes', None).
+0001c950: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
+0001c960: 6d69 7373 696f 6e5f 7374 6174 7573 203d  mission_status =
+0001c970: 2065 696e 666f 5b22 7374 6174 7573 225d   einfo["status"]
+0001c980: 0a20 2020 2020 2020 2020 2020 2065 6372  .            ecr
+0001c990: 6564 6974 203d 2065 696e 666f 5b22 6372  edit = einfo["cr
+0001c9a0: 6564 6974 225d 0a0a 2020 2020 2020 2020  edit"]..        
+0001c9b0: 2020 2020 2320 4e6f 7465 2073 7562 6d69      # Note submi
+0001c9c0: 7373 696f 6e20 7374 6174 7573 0a20 2020  ssion status.   
+0001c9d0: 2020 2020 2020 2020 2065 696e 666f 5b22           einfo["
+0001c9e0: 7374 6174 7573 225d 203d 2073 7562 6d69  status"] = submi
+0001c9f0: 7373 696f 6e5f 7374 6174 7573 0a0a 2020  ssion_status..  
+0001ca00: 2020 2020 2020 2020 2020 2320 4669 7273            # Firs
+0001ca10: 7420 6170 706c 7920 6269 6e61 7279 2063  t apply binary c
+0001ca20: 7265 6469 7420 746f 2065 6163 6820 636f  redit to each co
+0001ca30: 6e63 6570 7420 666f 7220 7065 722d 6f75  ncept for per-ou
+0001ca40: 7463 6f6d 650a 2020 2020 2020 2020 2020  tcome.          
+0001ca50: 2020 2320 636f 6e63 6570 7473 2c20 616e    # concepts, an
+0001ca60: 6420 6173 736f 6369 6174 6520 7065 722d  d associate per-
+0001ca70: 6f75 7463 6f6d 6520 6578 6572 6369 7365  outcome exercise
+0001ca80: 2073 7461 7475 7365 7320 6173 0a20 2020   statuses as.   
+0001ca90: 2020 2020 2020 2020 2023 2077 656c 6c2e           # well.
+0001caa0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001cab0: 2069 2c20 656e 7472 7920 696e 2065 6e75   i, entry in enu
+0001cac0: 6d65 7261 7465 2865 696e 666f 2e67 6574  merate(einfo.get
+0001cad0: 2822 7065 725f 6f75 7463 6f6d 6522 2c20  ("per_outcome", 
+0001cae0: 5b5d 2929 3a0a 2020 2020 2020 2020 2020  [])):.          
+0001caf0: 2020 2020 2020 2320 4174 7461 6368 2069        # Attach i
+0001cb00: 6e64 6976 6964 7561 6c20 6f75 7463 6f6d  ndividual outcom
+0001cb10: 6573 2074 6f20 6173 736f 6369 6174 6564  es to associated
+0001cb20: 2070 6572 2d6f 7574 636f 6d65 0a20 2020   per-outcome.   
+0001cb30: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+0001cb40: 6f6e 6365 7074 730a 2020 2020 2020 2020  oncepts.        
+0001cb50: 2020 2020 2020 2020 6966 2065 6372 6564          if ecred
+0001cb60: 6974 2069 7320 6e6f 7420 4e6f 6e65 3a0a  it is not None:.
+0001cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb80: 2020 2020 2320 5265 706c 6163 6520 5472      # Replace Tr
+0001cb90: 7565 2f46 616c 7365 2077 6974 6820 312f  ue/False with 1/
+0001cba0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0001cbb0: 2020 2020 2020 206f 7574 636f 6d65 203d         outcome =
+0001cbc0: 206f 7574 636f 6d65 735f 6865 7265 5b69   outcomes_here[i
+0001cbd0: 5d5b 3a5d 0a20 2020 2020 2020 2020 2020  ][:].           
+0001cbe0: 2020 2020 2020 2020 206f 7574 636f 6d65           outcome
+0001cbf0: 5b30 5d20 3d20 3120 6966 206f 7574 636f  [0] = 1 if outco
+0001cc00: 6d65 5b30 5d20 656c 7365 2030 0a20 2020  me[0] else 0.   
+0001cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc20: 206f 696e 666f 203d 2028 0a20 2020 2020   oinfo = (.     
+0001cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc40: 2020 2027 7b7d 237b 7d27 2e66 6f72 6d61     '{}#{}'.forma
+0001cc50: 7428 6574 6167 2c20 6929 2c0a 2020 2020  t(etag, i),.    
+0001cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc70: 2020 2020 3120 6966 206f 7574 636f 6d65      1 if outcome
+0001cc80: 5b30 5d20 656c 7365 2030 2c0a 2020 2020  [0] else 0,.    
+0001cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cca0: 2020 2020 226f 7574 636f 6d65 220a 2020      "outcome".  
+0001ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccc0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0001ccd0: 2020 2020 2020 2020 2320 4174 7461 6368          # Attach
+0001cce0: 206f 7574 636f 6d65 0a20 2020 2020 2020   outcome.       
+0001ccf0: 2020 2020 2020 2020 2020 2020 2061 7474               att
+0001cd00: 6163 685f 6f75 7463 6f6d 6528 636f 6e63  ach_outcome(conc
+0001cd10: 6570 7473 2c20 6f69 6e66 6f2c 2065 6e74  epts, oinfo, ent
+0001cd20: 7279 290a 2020 2020 2020 2020 2020 2020  ry).            
+0001cd30: 2020 2020 2020 2020 6f75 7463 6f6d 655f          outcome_
+0001cd40: 7374 6174 7573 203d 2028 0a20 2020 2020  status = (.     
+0001cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd60: 2020 2022 636f 6d70 6c65 7465 220a 2020     "complete".  
+0001cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd80: 2020 2020 2020 6966 206f 7574 636f 6d65        if outcome
+0001cd90: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0001cda0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001cdb0: 2022 696e 636f 6d70 6c65 7465 220a 2020   "incomplete".  
+0001cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdd0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0001cde0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001cdf0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+0001ce00: 7463 6f6d 655f 7374 6174 7573 203d 2073  tcome_status = s
+0001ce10: 7562 6d69 7373 696f 6e5f 7374 6174 7573  ubmission_status
+0001ce20: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ce30: 2020 2320 4e6f 7465 2065 7865 7263 6973    # Note exercis
+0001ce40: 6520 7374 6174 7573 2066 6f72 2074 6865  e status for the
+0001ce50: 7365 2063 6f6e 6365 7074 7320 6173 2077  se concepts as w
+0001ce60: 656c 6c2c 2062 7574 0a20 2020 2020 2020  ell, but.       
+0001ce70: 2020 2020 2020 2020 2023 2077 6974 6820           # with 
+0001ce80: 7375 6363 6573 732f 6661 696c 7572 6520  success/failure 
+0001ce90: 6261 7365 6420 6f6e 2069 6e64 6976 6964  based on individ
+0001cea0: 7561 6c20 6f75 7463 6f6d 6573 0a20 2020  ual outcomes.   
+0001ceb0: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+0001cec0: 655f 6578 6572 6369 7365 5f73 7461 7475  e_exercise_statu
+0001ced0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+0001cee0: 2020 2020 2020 2063 6f6e 6365 7074 732c         concepts,
+0001cef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cf00: 2020 2020 2065 6964 2c0a 2020 2020 2020       eid,.      
+0001cf10: 2020 2020 2020 2020 2020 2020 2020 2870                (p
+0001cf20: 6861 7365 2c20 6f75 7463 6f6d 655f 7374  hase, outcome_st
+0001cf30: 6174 7573 292c 0a20 2020 2020 2020 2020  atus),.         
+0001cf40: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+0001cf50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cf60: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+0001cf70: 2320 4e6f 7720 6170 706c 7920 7468 6520  # Now apply the 
+0001cf80: 6578 6572 6369 7365 2063 7265 6469 7420  exercise credit 
+0001cf90: 6173 2061 6e20 6f75 7463 6f6d 6520 746f  as an outcome to
+0001cfa0: 2065 6163 680a 2020 2020 2020 2020 2020   each.          
+0001cfb0: 2020 2320 636f 6e63 6570 7420 7468 6174    # concept that
+0001cfc0: 2773 2073 6574 2061 7420 7468 6520 6578  's set at the ex
+0001cfd0: 6572 6369 7365 206c 6576 656c 2c20 706c  ercise level, pl
+0001cfe0: 7573 2061 7070 6c79 0a20 2020 2020 2020  us apply.       
+0001cff0: 2020 2020 2023 2069 6e64 6976 6964 7561       # individua
+0001d000: 6c20 6f75 7463 6f6d 6573 2074 6f20 7468  l outcomes to th
+0001d010: 6569 7220 6173 736f 6369 6174 6564 2070  eir associated p
+0001d020: 6572 2d6f 7574 636f 6d65 0a20 2020 2020  er-outcome.     
+0001d030: 2020 2020 2020 2023 2063 6f6e 6365 7074         # concept
+0001d040: 732e 0a20 2020 2020 2020 2020 2020 2066  s..            f
+0001d050: 6f72 2063 6f6e 6365 7074 5f70 6174 6820  or concept_path 
+0001d060: 696e 2065 696e 666f 2e67 6574 2822 636f  in einfo.get("co
+0001d070: 6e63 6570 7473 222c 205b 5d29 3a0a 2020  ncepts", []):.  
+0001d080: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001d090: 4e6f 7465 2073 7461 7475 732c 2070 6f74  Note status, pot
+0001d0a0: 656e 7469 616c 6c79 206f 7665 7272 6964  entially overrid
+0001d0b0: 696e 6720 7065 722d 6f75 7463 6f6d 650a  ing per-outcome.
+0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0d0: 2320 7374 6174 7573 6573 2074 6861 7420  # statuses that 
+0001d0e0: 6861 7665 2061 6c72 6561 6479 2062 6565  have already bee
+0001d0f0: 6e20 6174 7461 6368 6564 0a20 2020 2020  n attached.     
+0001d100: 2020 2020 2020 2020 2020 206e 6f74 655f             note_
+0001d110: 6578 6572 6369 7365 5f73 7461 7475 7328  exercise_status(
+0001d120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d130: 2020 2020 2063 6f6e 6365 7074 732c 0a20       concepts,. 
+0001d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d150: 2020 2065 6964 2c0a 2020 2020 2020 2020     eid,.        
+0001d160: 2020 2020 2020 2020 2020 2020 2870 6861              (pha
+0001d170: 7365 2c20 7375 626d 6973 7369 6f6e 5f73  se, submission_s
+0001d180: 7461 7475 7329 2c0a 2020 2020 2020 2020  tatus),.        
+0001d190: 2020 2020 2020 2020 2020 2020 636f 6e63              conc
+0001d1a0: 6570 745f 7061 7468 0a20 2020 2020 2020  ept_path.       
+0001d1b0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0001d1c0: 2020 2020 2020 2020 2020 2020 2320 4174              # At
+0001d1d0: 7461 6368 2065 7865 7263 6973 652d 6c65  tach exercise-le
+0001d1e0: 7665 6c20 6f75 7463 6f6d 6520 746f 2065  vel outcome to e
+0001d1f0: 7865 7263 6973 652d 6c65 7665 6c0a 2020  xercise-level.  
+0001d200: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001d210: 636f 6e63 6570 7473 0a20 2020 2020 2020  concepts.       
+0001d220: 2020 2020 2020 2020 2069 6620 6563 7265           if ecre
+0001d230: 6469 7420 6973 206e 6f74 204e 6f6e 653a  dit is not None:
+0001d240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d250: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d270: 2020 6174 7461 6368 5f6f 7574 636f 6d65    attach_outcome
+0001d280: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001d290: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001d2a0: 6e63 6570 7473 2c0a 2020 2020 2020 2020  ncepts,.        
+0001d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2c0: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+0001d2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2e0: 2020 2020 2020 2265 7865 7263 6973 6540        "exercise@
+0001d2f0: 7b7d 222e 666f 726d 6174 2865 7461 6729  {}".format(etag)
+0001d300: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d320: 2020 6563 7265 6469 742c 0a20 2020 2020    ecredit,.     
+0001d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d340: 2020 2020 2020 2020 2020 2022 6578 6572             "exer
+0001d350: 6369 7365 220a 2020 2020 2020 2020 2020  cise".          
+0001d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d370: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+0001d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d390: 2063 6f6e 6365 7074 5f70 6174 680a 2020   concept_path.  
+0001d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001d3c0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0001d3d0: 7074 2056 616c 7565 4572 726f 723a 0a20  pt ValueError:. 
+0001d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3f0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0001d400: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+0001d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d420: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+0001d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d440: 2020 2020 2020 2022 496e 2067 726f 7570         "In group
+0001d450: 2027 7b7d 2720 6578 6572 6369 7365 2027   '{}' exercise '
+0001d460: 7b7d 2720 7265 6665 7265 6e63 6573 220a  {}' references".
+0001d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d490: 2220 636f 6e63 6570 7420 277b 7d27 2062  " concept '{}' b
+0001d4a0: 7574 2074 6861 7420 636f 6e63 6570 7420  ut that concept 
+0001d4b0: 646f 6573 6e27 7422 0a20 2020 2020 2020  doesn't".       
+0001d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4d0: 2020 2020 2020 2020 2022 2065 7869 7374           " exist
+0001d4e0: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+0001d4f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001d500: 2e66 6f72 6d61 7428 6772 6f75 705b 2767  .format(group['g
+0001d510: 726f 7570 275d 2c20 6569 642c 2063 6f6e  roup'], eid, con
+0001d520: 6365 7074 5f70 6174 6829 0a20 2020 2020  cept_path).     
+0001d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d540: 2020 2029 0a0a 2020 2020 2320 544f 444f     )..    # TODO
+0001d550: 3a20 4174 7461 6368 206f 7574 636f 6d65  : Attach outcome
+0001d560: 7320 6672 6f6d 2070 726f 6a65 6374 2074  s from project t
+0001d570: 6173 6b73 210a 0a20 2020 2023 2053 6574  asks!..    # Set
+0001d580: 2063 6f6e 6365 7074 2073 7461 7475 7365   concept statuse
+0001d590: 7320 6261 7365 6420 6f6e 2061 7474 6163  s based on attac
+0001d5a0: 6865 6420 6f75 7463 6f6d 6573 0a20 2020  hed outcomes.   
+0001d5b0: 2023 2054 4f44 4f3a 2054 4849 530a 0a0a   # TODO: THIS...
+0001d5c0: 6465 6620 616c 6c5f 7061 7265 6e74 7328  def all_parents(
+0001d5d0: 636f 6e63 6570 7473 2c20 636f 6e63 6570  concepts, concep
+0001d5e0: 745f 7061 7468 293a 0a20 2020 2022 2222  t_path):.    """
+0001d5f0: 0a20 2020 2059 6965 6c64 7320 6561 6368  .    Yields each
+0001d600: 2070 6172 656e 7420 6f66 2074 6865 2067   parent of the g
+0001d610: 6976 656e 2063 6f6e 6365 7074 2070 6174  iven concept pat
+0001d620: 682c 2069 6e63 6c75 6469 6e67 2074 6865  h, including the
+0001d630: 2074 6172 6765 740a 2020 2020 636f 6e63   target.    conc
+0001d640: 6570 7420 6974 7365 6c66 2c20 696e 2064  ept itself, in d
+0001d650: 6570 7468 2d66 6972 7374 206f 7264 6572  epth-first order
+0001d660: 2061 6e64 2070 726f 6365 7373 696e 6720   and processing 
+0001d670: 6561 6368 2063 6f6e 6365 7074 0a20 2020  each concept.   
+0001d680: 206f 6e6c 7920 6f6e 6365 2065 7665 6e20   only once even 
+0001d690: 6966 2070 6172 656e 742d 6c6f 6f70 7320  if parent-loops 
+0001d6a0: 6f63 6375 722e 0a0a 2020 2020 5261 6973  occur...    Rais
+0001d6b0: 6573 2061 2060 5661 6c75 6545 7272 6f72  es a `ValueError
+0001d6c0: 6020 6966 2074 6865 2074 6172 6765 7420  ` if the target 
+0001d6d0: 636f 6e63 6570 7420 6361 6e6e 6f74 2062  concept cannot b
+0001d6e0: 6520 666f 756e 642e 0a20 2020 2022 2222  e found..    """
+0001d6f0: 0a20 2020 2063 6f6e 6365 7074 203d 206c  .    concept = l
+0001d700: 6f6f 6b75 705f 636f 6e63 6570 7428 636f  ookup_concept(co
+0001d710: 6e63 6570 7473 2c20 636f 6e63 6570 745f  ncepts, concept_
+0001d720: 7061 7468 2e73 706c 6974 2827 3a27 2929  path.split(':'))
+0001d730: 0a20 2020 2069 6620 636f 6e63 6570 7420  .    if concept 
+0001d740: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001d750: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0001d760: 7228 0a20 2020 2020 2020 2020 2020 2028  r(.            (
+0001d770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d780: 2022 436f 756c 646e 2774 2066 696e 6420   "Couldn't find 
+0001d790: 7061 7265 6e74 7320 6f66 2063 6f6e 6365  parents of conce
+0001d7a0: 7074 2027 7b7d 273a 2074 6861 7420 636f  pt '{}': that co
+0001d7b0: 6e63 6570 7422 0a20 2020 2020 2020 2020  ncept".         
+0001d7c0: 2020 2020 2020 2022 2064 6f65 7320 6e6f         " does no
+0001d7d0: 7420 6578 6973 742e 220a 2020 2020 2020  t exist.".      
+0001d7e0: 2020 2020 2020 292e 666f 726d 6174 2863        ).format(c
+0001d7f0: 6f6e 6365 7074 5f70 6174 6829 0a20 2020  oncept_path).   
+0001d800: 2020 2020 2029 0a0a 2020 2020 2320 5072       )..    # Pr
+0001d810: 6f63 6573 7320 616c 6c20 7061 7265 6e74  ocess all parent
+0001d820: 7320 7573 696e 6720 6120 7374 6163 6b0a  s using a stack.
+0001d830: 2020 2020 7365 656e 203d 2073 6574 2829      seen = set()
+0001d840: 0a20 2020 2073 7461 636b 203d 205b 2063  .    stack = [ c
+0001d850: 6f6e 6365 7074 205d 0a20 2020 2077 6869  oncept ].    whi
+0001d860: 6c65 206c 656e 2873 7461 636b 2920 3e20  le len(stack) > 
+0001d870: 303a 0a20 2020 2020 2020 2074 6869 735f  0:.        this_
+0001d880: 636f 6e63 6570 7420 3d20 7374 6163 6b2e  concept = stack.
+0001d890: 706f 7028 290a 0a20 2020 2020 2020 2023  pop()..        #
+0001d8a0: 2053 6b69 7020 6966 2077 6527 7665 2061   Skip if we've a
+0001d8b0: 6c72 6561 6479 2070 726f 6365 7373 6564  lready processed
+0001d8c0: 2074 6869 7320 636f 6e63 6570 740a 2020   this concept.  
+0001d8d0: 2020 2020 2020 6966 2074 6869 735f 636f        if this_co
+0001d8e0: 6e63 6570 745b 2270 6174 6822 5d20 696e  ncept["path"] in
+0001d8f0: 2073 6565 6e3a 0a20 2020 2020 2020 2020   seen:.         
+0001d900: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+0001d910: 2020 2020 2023 2049 6620 7765 2064 6964       # If we did
+0001d920: 6e27 7420 736b 6970 2c20 6e6f 7465 2074  n't skip, note t
+0001d930: 6861 7420 7765 2061 7265 2067 6f69 6e67  hat we are going
+0001d940: 2074 6f20 7072 6f63 6573 7320 6974 0a20   to process it. 
+0001d950: 2020 2020 2020 2073 6565 6e2e 6164 6428         seen.add(
+0001d960: 7468 6973 5f63 6f6e 6365 7074 5b22 7061  this_concept["pa
+0001d970: 7468 225d 290a 0a20 2020 2020 2020 2023  th"])..        #
+0001d980: 2041 6e64 2079 6965 6c64 2069 740a 2020   And yield it.  
+0001d990: 2020 2020 2020 7969 656c 6420 7468 6973        yield this
+0001d9a0: 5f63 6f6e 6365 7074 0a0a 2020 2020 2020  _concept..      
+0001d9b0: 2020 2320 4578 7465 6e64 2073 7461 636b    # Extend stack
+0001d9c0: 2074 6f20 696e 636c 7564 6520 6561 6368   to include each
+0001d9d0: 206e 6f6e 2d4e 6f6e 6520 7061 7265 6e74   non-None parent
+0001d9e0: 2063 6f6e 6365 7074 0a20 2020 2020 2020   concept.       
+0001d9f0: 2073 7461 636b 2e65 7874 656e 6428 0a20   stack.extend(. 
+0001da00: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+0001da10: 7228 6c61 6d62 6461 2078 3a20 782c 2074  r(lambda x: x, t
+0001da20: 6869 735f 636f 6e63 6570 745b 2270 6172  his_concept["par
+0001da30: 656e 7473 225d 2e76 616c 7565 7328 2929  ents"].values())
+0001da40: 0a20 2020 2020 2020 2029 0a0a 0a64 6566  .        )...def
+0001da50: 206e 6f74 655f 6578 6572 6369 7365 5f73   note_exercise_s
+0001da60: 7461 7475 7328 636f 6e63 6570 7473 2c20  tatus(concepts, 
+0001da70: 6569 642c 2065 7865 7263 6973 655f 7374  eid, exercise_st
+0001da80: 6174 7573 2c20 636f 6e63 6570 745f 7061  atus, concept_pa
+0001da90: 7468 293a 0a20 2020 2022 2222 0a20 2020  th):.    """.   
+0001daa0: 2052 6571 7569 7265 7320 616e 2061 7567   Requires an aug
+0001dab0: 6d65 6e74 6564 2063 6f6e 6365 7074 7320  mented concepts 
+0001dac0: 6e65 7477 6f72 6b2c 2061 6e20 6578 6572  network, an exer
+0001dad0: 6369 7365 2049 442c 2061 6e20 6578 6572  cise ID, an exer
+0001dae0: 6369 7365 0a20 2020 2073 7461 7475 7320  cise.    status 
+0001daf0: 7061 6972 2028 6120 7475 706c 6520 636f  pair (a tuple co
+0001db00: 6e74 6169 6e69 6e67 2061 2074 696d 6520  ntaining a time 
+0001db10: 7374 6174 7573 2061 6e64 2061 2073 7562  status and a sub
+0001db20: 6d69 7373 696f 6e0a 2020 2020 7374 6174  mission.    stat
+0001db30: 7573 2061 7320 7374 7269 6e67 7329 2c20  us as strings), 
+0001db40: 616e 6420 6120 636f 6e63 6570 7420 7061  and a concept pa
+0001db50: 7468 2e0a 0a20 2020 2041 6464 7320 746f  th...    Adds to
+0001db60: 2074 6865 2022 6578 6572 6369 7365 7322   the "exercises"
+0001db70: 2073 6c6f 7420 666f 7220 7468 6520 7370   slot for the sp
+0001db80: 6563 6966 6965 6420 636f 6e63 6570 7420  ecified concept 
+0001db90: 746f 2069 6e63 6c75 6465 0a20 2020 2074  to include.    t
+0001dba0: 6865 2067 6976 656e 2065 7865 7263 6973  he given exercis
+0001dbb0: 6520 7374 6174 7573 2075 6e64 6572 2074  e status under t
+0001dbc0: 6865 2067 6976 656e 2065 7865 7263 6973  he given exercis
+0001dbd0: 6520 4944 2c20 6f76 6572 7772 6974 696e  e ID, overwritin
+0001dbe0: 670a 2020 2020 616e 7920 7072 6576 696f  g.    any previo
+0001dbf0: 7573 6c79 2d73 6574 2073 7461 7475 732e  usly-set status.
+0001dc00: 0a0a 2020 2020 4170 706c 6965 7320 746f  ..    Applies to
+0001dc10: 2070 6172 656e 7420 636f 6e63 6570 7473   parent concepts
+0001dc20: 2061 7320 7765 6c6c 2e0a 0a20 2020 2046   as well...    F
+0001dc30: 6c61 7368 6573 2061 2077 6172 6e69 6e67  lashes a warning
+0001dc40: 2069 6620 7468 6520 7461 7267 6574 2063   if the target c
+0001dc50: 6f6e 6365 7074 2063 616e 6e6f 7420 6265  oncept cannot be
+0001dc60: 2066 6f75 6e64 2e0a 2020 2020 2222 220a   found..    """.
+0001dc70: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001dc80: 2070 6172 656e 7473 203d 206c 6973 7428   parents = list(
+0001dc90: 616c 6c5f 7061 7265 6e74 7328 636f 6e63  all_parents(conc
+0001dca0: 6570 7473 2c20 636f 6e63 6570 745f 7061  epts, concept_pa
+0001dcb0: 7468 2929 0a20 2020 2065 7863 6570 7420  th)).    except 
+0001dcc0: 5661 6c75 6545 7272 6f72 2061 7320 653a  ValueError as e:
+0001dcd0: 0a20 2020 2020 2020 2066 6c61 736b 2e66  .        flask.f
+0001dce0: 6c61 7368 280a 2020 2020 2020 2020 2020  lash(.          
+0001dcf0: 2020 2245 7272 6f72 2072 6563 6f72 6469    "Error recordi
+0001dd00: 6e67 2065 7865 7263 6973 6520 7374 6174  ng exercise stat
+0001dd10: 7573 3a20 7b7d 222e 666f 726d 6174 2865  us: {}".format(e
+0001dd20: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+0001dd30: 2020 2020 7061 7265 6e74 7320 3d20 5b5d      parents = []
+0001dd40: 0a0a 2020 2020 666f 7220 636f 6e63 6570  ..    for concep
+0001dd50: 7420 696e 2070 6172 656e 7473 3a0a 2020  t in parents:.  
+0001dd60: 2020 2020 2020 636f 6e63 6570 742e 7365        concept.se
+0001dd70: 7464 6566 6175 6c74 2822 6578 6572 6369  tdefault("exerci
+0001dd80: 7365 7322 2c20 7b7d 295b 6569 645d 203d  ses", {})[eid] =
+0001dd90: 2065 7865 7263 6973 655f 7374 6174 7573   exercise_status
+0001dda0: 0a0a 0a64 6566 2061 7474 6163 685f 6f75  ...def attach_ou
+0001ddb0: 7463 6f6d 6528 636f 6e63 6570 7473 2c20  tcome(concepts, 
+0001ddc0: 6f75 7463 6f6d 655f 696e 666f 2c20 636f  outcome_info, co
+0001ddd0: 6e63 6570 745f 7061 7468 293a 0a20 2020  ncept_path):.   
+0001dde0: 2022 2222 0a20 2020 2052 6571 7569 7265   """.    Require
+0001ddf0: 7320 616e 2061 7567 6d65 6e74 6564 2063  s an augmented c
+0001de00: 6f6e 6365 7074 7320 6e65 7477 6f72 6b20  oncepts network 
+0001de10: 616e 6420 616e 206f 7574 636f 6d65 2069  and an outcome i
+0001de20: 6e66 6f20 7475 706c 6520 2861 0a20 2020  nfo tuple (a.   
+0001de30: 2073 7472 696e 6720 6e61 6d69 6e67 2074   string naming t
+0001de40: 6865 206f 7574 636f 6d65 2070 6c75 7320  he outcome plus 
+0001de50: 6120 6e75 6d62 6572 2066 726f 6d20 302d  a number from 0-
+0001de60: 3120 7370 6563 6966 7969 6e67 2077 6865  1 specifying whe
+0001de70: 7468 6572 0a20 2020 2074 6865 206f 7574  ther.    the out
+0001de80: 636f 6d65 2069 6e64 6963 6174 6573 2073  come indicates s
+0001de90: 7563 6365 7373 2c20 6661 696c 7572 652c  uccess, failure,
+0001dea0: 206f 7220 736f 6d65 206b 696e 6420 6f66   or some kind of
+0001deb0: 2070 6172 7469 616c 0a20 2020 2073 7563   partial.    suc
+0001dec0: 6365 7373 292e 0a0a 2020 2020 416c 736f  cess)...    Also
+0001ded0: 206e 6565 6473 2061 2063 6f6e 6365 7074   needs a concept
+0001dee0: 2070 6174 6820 7370 6563 6966 7969 6e67   path specifying
+0001def0: 2074 6865 2063 6f6e 6365 7074 2074 6f20   the concept to 
+0001df00: 7768 6963 6820 7468 650a 2020 2020 6f75  which the.    ou
+0001df10: 7463 6f6d 6520 6170 706c 6965 732e 2041  tcome applies. A
+0001df20: 6464 7320 7468 6520 6f75 7463 6f6d 6520  dds the outcome 
+0001df30: 746f 2074 6865 206c 6973 7420 6f66 206f  to the list of o
+0001df40: 7574 636f 6d65 7320 7265 6c65 7661 6e74  utcomes relevant
+0001df50: 0a20 2020 2074 6f20 7468 6520 7461 7267  .    to the targ
+0001df60: 6574 2063 6f6e 6365 7074 2c20 706c 7573  et concept, plus
+0001df70: 2074 6865 206c 6973 7473 2066 6f72 2065   the lists for e
+0001df80: 6163 6820 636f 6e63 6570 7420 7468 6174  ach concept that
+0001df90: 2773 2061 0a20 2020 2070 6172 656e 7420  's a.    parent 
+0001dfa0: 6f66 2074 6865 2074 6172 6765 7420 636f  of the target co
+0001dfb0: 6e63 6570 742e 0a0a 2020 2020 466c 6173  ncept...    Flas
+0001dfc0: 6865 7320 6120 7761 726e 696e 6720 6d65  hes a warning me
+0001dfd0: 7373 6167 6520 6966 2074 6865 2074 6172  ssage if the tar
+0001dfe0: 6765 7420 636f 6e63 6570 7420 6361 6e6e  get concept cann
+0001dff0: 6f74 2062 6520 666f 756e 642e 0a20 2020  ot be found..   
+0001e000: 2022 2222 0a20 2020 2074 7279 3a0a 2020   """.    try:.  
+0001e010: 2020 2020 2020 7061 7265 6e74 7320 3d20        parents = 
+0001e020: 6c69 7374 2861 6c6c 5f70 6172 656e 7473  list(all_parents
+0001e030: 2863 6f6e 6365 7074 732c 2063 6f6e 6365  (concepts, conce
+0001e040: 7074 5f70 6174 6829 290a 2020 2020 6578  pt_path)).    ex
+0001e050: 6365 7074 2056 616c 7565 4572 726f 7220  cept ValueError 
+0001e060: 6173 2065 3a0a 2020 2020 2020 2020 666c  as e:.        fl
+0001e070: 6173 6b2e 666c 6173 6828 0a20 2020 2020  ask.flash(.     
+0001e080: 2020 2020 2020 2022 4572 726f 7220 6174         "Error at
+0001e090: 7461 6368 696e 6720 6578 6572 6369 7365  taching exercise
+0001e0a0: 206f 7574 636f 6d65 3a20 7b7d 222e 666f   outcome: {}".fo
+0001e0b0: 726d 6174 2865 290a 2020 2020 2020 2020  rmat(e).        
+0001e0c0: 290a 2020 2020 2020 2020 7061 7265 6e74  ).        parent
+0001e0d0: 7320 3d20 5b5d 0a0a 2020 2020 666f 7220  s = []..    for 
+0001e0e0: 636f 6e63 6570 7420 696e 2070 6172 656e  concept in paren
+0001e0f0: 7473 3a0a 2020 2020 2020 2020 2320 4164  ts:.        # Ad
+0001e100: 6420 7468 6973 206f 7574 636f 6d65 2074  d this outcome t
+0001e110: 6f20 7468 6520 6f75 7463 6f6d 6573 206c  o the outcomes l
+0001e120: 6973 7420 666f 7220 7468 6973 2063 6f6e  ist for this con
+0001e130: 6365 7074 2c0a 2020 2020 2020 2020 2320  cept,.        # 
+0001e140: 6372 6561 7469 6e67 2069 7420 6966 2069  creating it if i
+0001e150: 7420 6861 736e 2774 2061 6c72 6561 6479  t hasn't already
+0001e160: 2062 6565 6e20 6372 6561 7465 642e 0a20   been created.. 
+0001e170: 2020 2020 2020 2063 6f6e 6365 7074 2e73         concept.s
+0001e180: 6574 6465 6661 756c 7428 226f 7574 636f  etdefault("outco
+0001e190: 6d65 7322 2c20 5b5d 292e 6170 7065 6e64  mes", []).append
+0001e1a0: 286f 7574 636f 6d65 5f69 6e66 6f29 0a0a  (outcome_info)..
+0001e1b0: 0a64 6566 2061 7567 6d65 6e74 5f63 6f6e  .def augment_con
+0001e1c0: 6365 7074 7328 636f 6e63 6570 7473 293a  cepts(concepts):
+0001e1d0: 0a20 2020 2022 2222 0a20 2020 2054 616b  .    """.    Tak
+0001e1e0: 6573 2061 2063 6f6e 6365 7074 7320 6c69  es a concepts li
+0001e1f0: 7374 2028 7768 6572 6520 6561 6368 2065  st (where each e
+0001e200: 6e74 7279 2069 7320 6120 636f 6e63 6570  ntry is a concep
+0001e210: 7420 6469 6374 696f 6e61 7279 2077 6974  t dictionary wit
+0001e220: 680a 2020 2020 616e 2027 6964 272c 2061  h.    an 'id', a
+0001e230: 2027 6465 7363 272c 2061 6e64 2070 6f73   'desc', and pos
+0001e240: 7369 626c 7920 2766 6163 6574 7327 2063  sibly 'facets' c
+0001e250: 6f6e 7461 696e 696e 6720 610a 2020 2020  ontaining a.    
+0001e260: 7375 622d 636f 6e63 6570 7473 2d6c 6973  sub-concepts-lis
+0001e270: 742c 204f 5220 6861 7320 6a75 7374 2061  t, OR has just a
+0001e280: 2027 7265 6627 206b 6579 206e 616d 696e   'ref' key namin
+0001e290: 6720 7468 6520 6964 2d70 6174 6820 746f  g the id-path to
+0001e2a0: 2061 0a20 2020 2064 6966 6665 7265 6e74   a.    different
+0001e2b0: 2063 6f6e 6365 7074 292e 2041 7567 6d65   concept). Augme
+0001e2c0: 6e74 7320 7468 6174 2063 6f6e 6365 7074  nts that concept
+0001e2d0: 7320 6c69 7374 2062 7920 7265 706c 6163  s list by replac
+0001e2e0: 696e 6720 616c 6c0a 2020 2020 2772 6566  ing all.    'ref
+0001e2f0: 2720 656e 7472 6965 7320 7769 7468 2061  ' entries with a
+0001e300: 6374 7561 6c20 6f62 6a65 6374 2072 6566  ctual object ref
+0001e310: 6572 656e 6365 7320 746f 2074 6865 206e  erences to the n
+0001e320: 616d 6564 2063 6f6e 6365 7074 2c0a 2020  amed concept,.  
+0001e330: 2020 616e 6420 6279 2061 6464 696e 6720    and by adding 
+0001e340: 7468 6520 666f 6c6c 6f77 696e 6720 6b65  the following ke
+0001e350: 7973 2074 6f20 6561 6368 206e 6f6e 2d72  ys to each non-r
+0001e360: 6566 6572 656e 6365 2063 6f6e 6365 7074  eference concept
+0001e370: 3a0a 0a20 2020 202d 2027 7061 7468 273a  :..    - 'path':
+0001e380: 2054 6865 2066 756c 6c20 7265 6665 7265   The full refere
+0001e390: 6e63 6520 7061 7468 2066 6f72 2074 6869  nce path for thi
+0001e3a0: 7320 636f 6e63 6570 7420 6672 6f6d 2061  s concept from a
+0001e3b0: 2074 6f70 2d6c 6576 656c 0a20 2020 2020   top-level.     
+0001e3c0: 2020 2063 6f6e 6365 7074 2c20 7573 696e     concept, usin
+0001e3d0: 6720 686f 6d65 2063 6f6e 6365 7074 7320  g home concepts 
+0001e3e0: 6f76 6572 206f 7468 6572 2072 6566 6572  over other refer
+0001e3f0: 656e 6365 7320 746f 2066 696e 6420 6120  ences to find a 
+0001e400: 7761 790a 2020 2020 2020 2020 746f 2074  way.        to t
+0001e410: 6865 2074 6f70 206c 6576 656c 2e0a 2020  he top level..  
+0001e420: 2020 2d20 2770 6172 656e 7473 273a 2061    - 'parents': a
+0001e430: 2064 6963 7469 6f6e 6172 7920 6d61 7070   dictionary mapp
+0001e440: 696e 6720 6675 6c6c 2d69 642d 7061 7468  ing full-id-path
+0001e450: 2d73 7472 696e 6773 2074 6f20 6163 7475  -strings to actu
+0001e460: 616c 0a20 2020 2020 2020 2063 6f6e 6365  al.        conce
+0001e470: 7074 2064 6963 7469 6f6e 6172 6965 732c  pt dictionaries,
+0001e480: 2077 6974 6820 6f6e 6520 656e 7472 7920   with one entry 
+0001e490: 666f 7220 6561 6368 2063 6f6e 6365 7074  for each concept
+0001e4a0: 2074 6861 740a 2020 2020 2020 2020 696e   that.        in
+0001e4b0: 636c 7564 6573 2074 6869 7320 6f6e 6520  cludes this one 
+0001e4c0: 6173 2061 2066 6163 6574 2e20 5769 6c6c  as a facet. Will
+0001e4d0: 2062 6520 616e 2065 6d70 7479 2064 6963   be an empty dic
+0001e4e0: 7469 6f6e 6172 7920 666f 720a 2020 2020  tionary for.    
+0001e4f0: 2020 2020 636f 6e63 6570 7473 2061 7420      concepts at 
+0001e500: 7468 6520 746f 702d 6c65 7665 6c20 7468  the top-level th
+0001e510: 6174 2061 7265 6e27 7420 7265 6665 7265  at aren't refere
+0001e520: 6e63 6564 2061 6e79 7768 6572 652e 2049  nced anywhere. I
+0001e530: 6620 610a 2020 2020 2020 2020 636f 6e63  f a.        conc
+0001e540: 6570 7420 6973 2061 7420 7468 6520 746f  ept is at the to
+0001e550: 7020 6c65 7665 6c20 6f72 2072 6566 6572  p level or refer
+0001e560: 656e 6365 6420 7468 6572 652c 2074 6869  enced there, thi
+0001e570: 7320 6469 6374 696f 6e61 7279 0a20 2020  s dictionary.   
+0001e580: 2020 2020 2077 696c 6c20 6861 7665 2061       will have a
+0001e590: 2073 7065 6369 616c 2065 6e74 7279 2077   special entry w
+0001e5a0: 6974 6820 6b65 7920 604e 6f6e 6560 2061  ith key `None` a
+0001e5b0: 6e64 2076 616c 7565 2060 4e6f 6e65 602e  nd value `None`.
+0001e5c0: 0a20 2020 202d 2027 686f 6d65 273a 2041  .    - 'home': A
+0001e5d0: 2063 6f6e 6365 7074 2064 6963 7469 6f6e   concept diction
+0001e5e0: 6172 7920 666f 7220 7468 6520 6e61 7475  ary for the natu
+0001e5f0: 7261 6c20 7061 7265 6e74 206f 6620 7468  ral parent of th
+0001e600: 6973 0a20 2020 2020 2020 2063 6f6e 6365  is.        conce
+0001e610: 7074 3a20 7468 6520 6f6e 6520 7061 7265  pt: the one pare
+0001e620: 6e74 2077 6869 6368 2069 6e63 6c75 6465  nt which include
+0001e630: 6420 6974 2064 6972 6563 746c 7920 696e  d it directly in
+0001e640: 7374 6561 6420 6f66 2061 730a 2020 2020  stead of as.    
+0001e650: 2020 2020 6120 7265 6665 7265 6e63 652e      a reference.
+0001e660: 2057 696c 6c20 6265 2060 4e6f 6e65 6020   Will be `None` 
+0001e670: 666f 7220 746f 702d 6c65 7665 6c20 636f  for top-level co
+0001e680: 6e63 6570 7473 2c20 696e 636c 7564 696e  ncepts, includin
+0001e690: 670a 2020 2020 2020 2020 6f6e 6573 2074  g.        ones t
+0001e6a0: 6861 7420 6172 6520 7265 6665 7265 6e63  hat are referenc
+0001e6b0: 6564 2073 6f6d 6577 6865 7265 2028 746f  ed somewhere (to
+0001e6c0: 2061 766f 6964 2074 6869 732c 2079 6f75   avoid this, you
+0001e6d0: 2063 616e 206d 616b 650a 2020 2020 2020   can make.      
+0001e6e0: 2020 6120 7265 6665 7265 6e63 6520 6174    a reference at
+0001e6f0: 2074 6865 2074 6f70 206c 6576 656c 2061   the top level a
+0001e700: 6e64 2070 6c61 6365 2074 6865 2063 6f6e  nd place the con
+0001e710: 6365 7074 2079 6f75 2077 616e 7420 746f  cept you want to
+0001e720: 0a20 2020 2020 2020 2070 756c 6c20 7570  .        pull up
+0001e730: 2077 6974 6869 6e20 7468 6520 706c 6163   within the plac
+0001e740: 6520 796f 7527 6420 6f74 6865 7277 6973  e you'd otherwis
+0001e750: 6520 7265 6665 7265 6e63 6520 6974 292e  e reference it).
+0001e760: 0a0a 2020 2020 4966 2073 6f6d 6574 6869  ..    If somethi
+0001e770: 6e67 2069 7320 636f 6e74 7261 6469 6374  ng is contradict
+0001e780: 6f72 7920 2865 2e67 2e2c 2061 206e 616d  ory (e.g., a nam
+0001e790: 6564 2072 6566 6572 656e 6365 2063 6f6e  ed reference con
+0001e7a0: 6365 7074 0a20 2020 2064 6f65 736e 2774  cept.    doesn't
+0001e7b0: 2065 7869 7374 2920 6120 6056 616c 7565   exist) a `Value
+0001e7c0: 4572 726f 7260 2077 696c 6c20 6265 2072  Error` will be r
+0001e7d0: 6169 7365 642e 204e 6f74 6520 7468 6174  aised. Note that
+0001e7e0: 2061 6c6c 0a20 2020 2072 6566 6572 656e   all.    referen
+0001e7f0: 6365 7320 6d75 7374 2075 7365 2063 616e  ces must use can
+0001e800: 6f6e 6963 616c 2070 6174 6873 3b20 7468  onical paths; th
+0001e810: 6579 2063 616e 6e6f 7420 2767 6f20 7468  ey cannot 'go th
+0001e820: 726f 7567 6827 206f 7468 6572 0a20 2020  rough' other.   
+0001e830: 2072 6566 6572 656e 6365 732e 0a20 2020   references..   
+0001e840: 2022 2222 0a20 2020 2023 2043 7265 6174   """.    # Creat
+0001e850: 6520 6120 7374 6163 6b20 666f 7220 7072  e a stack for pr
+0001e860: 6f63 6573 7369 6e67 2074 6865 2072 6563  ocessing the rec
+0001e870: 7572 7369 7665 2065 6e74 7269 6573 2e20  ursive entries. 
+0001e880: 4561 6368 2063 6f6e 6365 7074 0a20 2020  Each concept.   
+0001e890: 2023 2065 6e74 7279 2069 7320 7061 6972   # entry is pair
+0001e8a0: 6564 2077 6974 6820 6974 7320 6e61 7475  ed with its natu
+0001e8b0: 7261 6c20 7061 7265 6e74 2061 6e64 2074  ral parent and t
+0001e8c0: 6865 2069 6e64 6578 2061 6d6f 6e67 2074  he index among t
+0001e8d0: 6861 740a 2020 2020 2320 7061 7265 6e74  hat.    # parent
+0001e8e0: 2773 2066 6163 6574 7320 6974 2065 7869  's facets it exi
+0001e8f0: 7374 7320 6174 2e0a 2020 2020 7374 6163  sts at..    stac
+0001e900: 6b20 3d20 5b28 636f 6e63 6570 742c 204e  k = [(concept, N
+0001e910: 6f6e 652c 204e 6f6e 6529 2066 6f72 2063  one, None) for c
+0001e920: 6f6e 6365 7074 2069 6e20 636f 6e63 6570  oncept in concep
+0001e930: 7473 5d0a 0a20 2020 2023 2043 6f6e 7469  ts]..    # Conti
+0001e940: 6e75 6520 756e 7469 6c20 7765 2072 756e  nue until we run
+0001e950: 206f 7574 206f 6620 636f 6e63 6570 7473   out of concepts
+0001e960: 2074 6f20 7072 6f63 6573 730a 2020 2020   to process.    
+0001e970: 7768 696c 6520 6c65 6e28 7374 6163 6b29  while len(stack)
+0001e980: 203e 2030 3a0a 2020 2020 2020 2020 2320   > 0:.        # 
+0001e990: 4765 7420 7468 6520 636f 6e63 6570 7420  Get the concept 
+0001e9a0: 2b20 7061 7265 6e74 202b 2069 6e64 6578  + parent + index
+0001e9b0: 2063 6f6d 626f 2074 6f20 7072 6f63 6573   combo to proces
+0001e9c0: 730a 2020 2020 2020 2020 2863 6f6e 6365  s.        (conce
+0001e9d0: 7074 2c20 686f 6d65 2c20 6661 6365 745f  pt, home, facet_
+0001e9e0: 696e 6465 7829 203d 2073 7461 636b 2e70  index) = stack.p
+0001e9f0: 6f70 2829 0a0a 2020 2020 2020 2020 2320  op()..        # 
+0001ea00: 4172 6520 7765 2061 2072 6566 6572 656e  Are we a referen
+0001ea10: 6365 3f0a 2020 2020 2020 2020 6966 2027  ce?.        if '
+0001ea20: 7265 6627 206e 6f74 2069 6e20 636f 6e63  ref' not in conc
+0001ea30: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0001ea40: 2023 204e 6f74 2061 2072 6566 6572 656e   # Not a referen
+0001ea50: 6365 3b20 6175 676d 656e 7420 7468 696e  ce; augment thin
+0001ea60: 6773 2026 2073 7461 636b 2075 7020 6661  gs & stack up fa
+0001ea70: 6365 7473 0a0a 2020 2020 2020 2020 2020  cets..          
+0001ea80: 2020 2320 5365 7420 7468 6520 686f 6d65    # Set the home
+0001ea90: 2066 6f72 2074 6869 7320 636f 6e63 6570   for this concep
+0001eaa0: 740a 2020 2020 2020 2020 2020 2020 636f  t.            co
+0001eab0: 6e63 6570 745b 2768 6f6d 6527 5d20 3d20  ncept['home'] = 
+0001eac0: 686f 6d65 0a0a 2020 2020 2020 2020 2020  home..          
+0001ead0: 2020 2320 4372 6561 7465 2061 6e20 656d    # Create an em
+0001eae0: 7074 7920 7061 7265 6e74 7320 6469 6374  pty parents dict
+0001eaf0: 696f 6e61 7279 2c20 6f72 2072 6574 7269  ionary, or retri
+0001eb00: 6576 6520 616e 0a20 2020 2020 2020 2020  eve an.         
+0001eb10: 2020 2023 2065 7869 7374 696e 6720 6469     # existing di
+0001eb20: 6374 696f 6e61 7279 2028 706f 7373 6962  ctionary (possib
+0001eb30: 6c79 2063 7265 6174 6564 2064 7565 2074  ly created due t
+0001eb40: 6f20 610a 2020 2020 2020 2020 2020 2020  o a.            
+0001eb50: 2320 7072 6576 696f 7573 6c79 2d70 726f  # previously-pro
+0001eb60: 6365 7373 6564 2072 6566 6572 656e 6365  cessed reference
+0001eb70: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+0001eb80: 7265 6e74 7320 3d20 636f 6e63 6570 742e  rents = concept.
+0001eb90: 7365 7464 6566 6175 6c74 2827 7061 7265  setdefault('pare
+0001eba0: 6e74 7327 2c20 7b7d 290a 0a20 2020 2020  nts', {})..     
+0001ebb0: 2020 2020 2020 2023 2053 6574 2070 6174         # Set pat
+0001ebc0: 6820 616e 6420 7570 6461 7465 2070 6172  h and update par
+0001ebd0: 656e 7473 2064 6966 6665 7265 6e74 6c79  ents differently
+0001ebe0: 2062 6173 6564 206f 6e20 7768 6574 6865   based on whethe
+0001ebf0: 720a 2020 2020 2020 2020 2020 2020 2320  r.            # 
+0001ec00: 7765 2772 6520 6174 2074 6865 2074 6f70  we're at the top
+0001ec10: 206c 6576 656c 206f 7220 6e6f 740a 2020   level or not.  
+0001ec20: 2020 2020 2020 2020 2020 6966 2068 6f6d            if hom
+0001ec30: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+0001ec40: 2020 2020 2020 2020 2020 2063 6f6e 6365             conce
+0001ec50: 7074 5b27 7061 7468 275d 203d 2063 6f6e  pt['path'] = con
+0001ec60: 6365 7074 5b22 6964 225d 0a20 2020 2020  cept["id"].     
+0001ec70: 2020 2020 2020 2020 2020 2070 6172 656e             paren
+0001ec80: 7473 5b4e 6f6e 655d 203d 204e 6f6e 650a  ts[None] = None.
+0001ec90: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001eca0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ecb0: 2020 636f 6e63 6570 745b 2770 6174 6827    concept['path'
+0001ecc0: 5d20 3d20 686f 6d65 5b22 7061 7468 225d  ] = home["path"]
+0001ecd0: 202b 2027 3a27 202b 2063 6f6e 6365 7074   + ':' + concept
+0001ece0: 5b22 6964 225d 0a20 2020 2020 2020 2020  ["id"].         
+0001ecf0: 2020 2020 2020 2070 6172 656e 7473 5b68         parents[h
+0001ed00: 6f6d 655b 2770 6174 6827 5d5d 203d 2068  ome['path']] = h
+0001ed10: 6f6d 650a 0a20 2020 2020 2020 2020 2020  ome..           
+0001ed20: 2066 6f72 2069 2c20 6661 6365 7420 696e   for i, facet in
+0001ed30: 2065 6e75 6d65 7261 7465 2863 6f6e 6365   enumerate(conce
+0001ed40: 7074 2e67 6574 2827 6661 6365 7473 272c  pt.get('facets',
+0001ed50: 205b 5d29 293a 0a20 2020 2020 2020 2020   [])):.         
+0001ed60: 2020 2020 2020 2073 7461 636b 2e61 7070         stack.app
+0001ed70: 656e 6428 2866 6163 6574 2c20 636f 6e63  end((facet, conc
+0001ed80: 6570 742c 2069 2929 0a0a 2020 2020 2020  ept, i))..      
+0001ed90: 2020 656c 7365 3a20 2023 2069 6620 7765    else:  # if we
+0001eda0: 202a 6172 652a 2061 2072 6566 6572 656e   *are* a referen
+0001edb0: 6365 2e2e 2e0a 2020 2020 2020 2020 2020  ce....          
+0001edc0: 2020 7265 6665 7265 6e74 203d 206c 6f6f    referent = loo
+0001edd0: 6b75 705f 636f 6e63 6570 7428 636f 6e63  kup_concept(conc
+0001ede0: 6570 7473 2c20 636f 6e63 6570 745b 2772  epts, concept['r
+0001edf0: 6566 275d 2e73 706c 6974 2827 3a27 2929  ef'].split(':'))
+0001ee00: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001ee10: 2072 6566 6572 656e 7420 6973 204e 6f6e   referent is Non
+0001ee20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001ee30: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0001ee40: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0001ee50: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
+0001ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee70: 2020 2022 4174 2027 7b7d 272c 206f 6e65     "At '{}', one
+0001ee80: 2066 6163 6574 2069 7320 6120 7265 6665   facet is a refe
+0001ee90: 7265 6e63 6520 746f 2027 7b7d 272c 2062  rence to '{}', b
+0001eea0: 7574 220a 2020 2020 2020 2020 2020 2020  ut".            
+0001eeb0: 2020 2020 2020 2020 2020 2020 2220 7468              " th
+0001eec0: 6174 2063 6f6e 6365 7074 2064 6f65 7320  at concept does 
+0001eed0: 6e6f 7420 6578 6973 742e 2028 4e6f 7465  not exist. (Note
+0001eee0: 3a20 616c 6c22 0a20 2020 2020 2020 2020  : all".         
+0001eef0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001ef00: 2072 6566 6572 656e 6365 7320 6d75 7374   references must
+0001ef10: 2062 6520 7669 6120 6361 6e6f 6e69 6361   be via canonica
+0001ef20: 6c20 7061 7468 732c 2069 2e65 2e2c 220a  l paths, i.e.,".
+0001ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef40: 2020 2020 2020 2020 2220 7265 6665 7265          " refere
+0001ef50: 6e63 6573 206d 6179 206e 6f74 2067 6f20  nces may not go 
+0001ef60: 7468 726f 7567 6820 6f74 6865 7222 0a20  through other". 
+0001ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef80: 2020 2020 2020 2022 2072 6566 6572 656e         " referen
+0001ef90: 6365 732e 2922 0a20 2020 2020 2020 2020  ces.)".         
+0001efa0: 2020 2020 2020 2020 2020 2029 2e66 6f72             ).for
+0001efb0: 6d61 7428 686f 6d65 5b27 7061 7468 275d  mat(home['path']
+0001efc0: 2c20 636f 6e63 6570 745b 2772 6566 275d  , concept['ref']
+0001efd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001efe0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+0001eff0: 2023 2057 6520 6e65 6564 2074 6f20 7265   # We need to re
+0001f000: 706c 6163 6520 6f75 7273 656c 7665 7320  place ourselves 
+0001f010: 7769 7468 2061 2072 6561 6c20 6f62 6a65  with a real obje
+0001f020: 6374 2072 6566 6572 656e 6365 2c0a 2020  ct reference,.  
+0001f030: 2020 2020 2020 2020 2020 2320 756e 6c65            # unle
+0001f040: 7373 2077 6527 7265 2061 7420 7468 6520  ss we're at the 
+0001f050: 746f 7020 6c65 7665 6c0a 2020 2020 2020  top level.      
+0001f060: 2020 2020 2020 6966 2068 6f6d 6520 6973        if home is
+0001f070: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0001f080: 2020 2020 2020 2020 2020 2068 6f6d 655b             home[
+0001f090: 2766 6163 6574 7327 5d5b 6661 6365 745f  'facets'][facet_
+0001f0a0: 696e 6465 785d 203d 2072 6566 6572 656e  index] = referen
+0001f0b0: 740a 0a20 2020 2020 2020 2020 2020 2020  t..             
+0001f0c0: 2020 2023 2057 6520 616c 736f 206e 6565     # We also nee
+0001f0d0: 6420 746f 2075 7064 6174 6520 7468 6520  d to update the 
+0001f0e0: 7061 7265 6e74 7320 6469 6374 696f 6e61  parents dictiona
+0001f0f0: 7279 206f 6620 7468 650a 2020 2020 2020  ry of the.      
+0001f100: 2020 2020 2020 2020 2020 2320 7265 6665            # refe
+0001f110: 7265 6e74 2074 6f20 696e 636c 7564 6520  rent to include 
+0001f120: 7468 6520 7061 7265 6e74 2063 6f6e 6365  the parent conce
+0001f130: 7074 2068 6572 652e 0a20 2020 2020 2020  pt here..       
+0001f140: 2020 2020 2020 2020 2072 6566 6572 656e           referen
+0001f150: 742e 7365 7464 6566 6175 6c74 2827 7061  t.setdefault('pa
+0001f160: 7265 6e74 7327 2c20 7b7d 295b 686f 6d65  rents', {})[home
+0001f170: 5b27 7061 7468 275d 5d20 3d20 686f 6d65  ['path']] = home
+0001f180: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0001f190: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001f1a0: 2020 2023 2041 6464 2061 2027 4e6f 6e65     # Add a 'None
+0001f1b0: 2720 6b65 7920 6966 2074 6869 7320 7265  ' key if this re
+0001f1c0: 6665 7265 6e63 6520 6973 2061 7420 7468  ference is at th
+0001f1d0: 6520 746f 7020 6c65 7665 6c0a 2020 2020  e top level.    
+0001f1e0: 2020 2020 2020 2020 2020 2020 7265 6665              refe
+0001f1f0: 7265 6e74 2e73 6574 6465 6661 756c 7428  rent.setdefault(
+0001f200: 2770 6172 656e 7473 272c 207b 7d29 5b4e  'parents', {})[N
+0001f210: 6f6e 655d 203d 204e 6f6e 650a 0a20 2020  one] = None..   
+0001f220: 2020 2020 2020 2020 2023 204e 6f74 6520           # Note 
+0001f230: 7468 6174 2077 6520 2a64 6f6e 2774 2a20  that we *don't* 
+0001f240: 6164 6420 6661 6365 7473 2074 6f20 7468  add facets to th
+0001f250: 6520 7374 6163 6b20 6865 7265 2120 5468  e stack here! Th
+0001f260: 6579 276c 6c0a 2020 2020 2020 2020 2020  ey'll.          
+0001f270: 2020 2320 6265 2061 6464 6564 206c 6174    # be added lat
+0001f280: 6572 2061 6674 6572 2074 6865 206e 6174  er after the nat
+0001f290: 7572 616c 2063 6f70 7920 6f66 2074 6865  ural copy of the
+0001f2a0: 2072 6566 6572 656e 7420 6973 0a20 2020   referent is.   
+0001f2b0: 2020 2020 2020 2020 2023 2070 726f 6365           # proce
+0001f2c0: 7373 6564 2e0a 0a0a 6465 6620 6c6f 6f6b  ssed....def look
+0001f2d0: 7570 5f63 6f6e 6365 7074 2863 6f6e 6365  up_concept(conce
+0001f2e0: 7074 732c 2063 6f6e 6365 7074 5f6e 616d  pts, concept_nam
+0001f2f0: 6573 293a 0a20 2020 2022 2222 0a20 2020  es):.    """.   
+0001f300: 2042 6173 6564 206f 6e20 6120 7365 7175   Based on a sequ
+0001f310: 656e 6365 206f 6620 636f 6e63 6570 742d  ence of concept-
+0001f320: 6e61 6d65 2073 7472 696e 6773 2c20 7265  name strings, re
+0001f330: 7475 726e 7320 7468 6520 6173 736f 6369  turns the associ
+0001f340: 6174 6564 0a20 2020 2063 6f6e 6365 7074  ated.    concept
+0001f350: 2064 6963 7469 6f6e 6172 7920 6672 6f6d   dictionary from
+0001f360: 2074 6865 2067 6976 656e 2074 6f70 2d6c   the given top-l
+0001f370: 6576 656c 2063 6f6e 6365 7074 7320 6c69  evel concepts li
+0001f380: 7374 2e20 5468 6973 2077 696c 6c0a 2020  st. This will.  
+0001f390: 2020 6f6e 6c79 2062 6520 6162 6c65 2074    only be able t
+0001f3a0: 6f20 6669 6e64 2063 6f6e 6365 7074 7320  o find concepts 
+0001f3b0: 7669 6120 7468 6569 7220 6e61 7475 7261  via their natura
+0001f3c0: 6c20 7061 7265 6e74 732c 2075 6e6c 6573  l parents, unles
+0001f3d0: 7320 7468 650a 2020 2020 636f 6e63 6570  s the.    concep
+0001f3e0: 7473 206c 6973 7420 6861 7320 6265 656e  ts list has been
+0001f3f0: 2061 7567 6d65 6e74 6564 2e0a 0a20 2020   augmented...   
+0001f400: 2052 6574 7572 6e73 2060 4e6f 6e65 6020   Returns `None` 
+0001f410: 6966 2074 6865 7265 2069 7320 6e6f 2073  if there is no s
+0001f420: 7563 6820 636f 6e63 6570 742e 0a20 2020  uch concept..   
+0001f430: 2022 2222 0a20 2020 2066 6972 7374 203d   """.    first =
+0001f440: 2063 6f6e 6365 7074 5f6e 616d 6573 5b30   concept_names[0
+0001f450: 5d0a 2020 2020 6d61 7463 6820 3d20 4e6f  ].    match = No
+0001f460: 6e65 0a20 2020 2066 6f72 2063 6f6e 6365  ne.    for conce
+0001f470: 7074 2069 6e20 636f 6e63 6570 7473 3a0a  pt in concepts:.
+0001f480: 2020 2020 2020 2020 6966 2063 6f6e 6365          if conce
+0001f490: 7074 5b22 6964 225d 203d 3d20 6669 7273  pt["id"] == firs
+0001f4a0: 743a 0a20 2020 2020 2020 2020 2020 206d  t:.            m
+0001f4b0: 6174 6368 203d 2063 6f6e 6365 7074 0a20  atch = concept. 
+0001f4c0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0001f4d0: 0a0a 2020 2020 6966 206d 6174 6368 2069  ..    if match i
+0001f4e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001f4f0: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
+0001f500: 656c 6966 206c 656e 2863 6f6e 6365 7074  elif len(concept
+0001f510: 5f6e 616d 6573 2920 3d3d 2031 3a0a 2020  _names) == 1:.  
+0001f520: 2020 2020 2020 7265 7475 726e 206d 6174        return mat
+0001f530: 6368 0a20 2020 2065 6c73 653a 0a20 2020  ch.    else:.   
+0001f540: 2020 2020 2072 6574 7572 6e20 6c6f 6f6b       return look
+0001f550: 7570 5f63 6f6e 6365 7074 286d 6174 6368  up_concept(match
+0001f560: 2e67 6574 2827 6661 6365 7473 272c 205b  .get('facets', [
+0001f570: 5d29 2c20 636f 6e63 6570 745f 6e61 6d65  ]), concept_name
+0001f580: 735b 313a 5d29 0a0a 0a64 6566 2070 6572  s[1:])...def per
+0001f590: 6365 6e74 696c 6528 6461 7461 7365 742c  centile(dataset,
+0001f5a0: 2070 6374 293a 0a20 2020 2022 2222 0a20   pct):.    """. 
+0001f5b0: 2020 2043 6f6d 7075 7465 7320 7468 6520     Computes the 
+0001f5c0: 6e74 6820 7065 7263 656e 7469 6c65 206f  nth percentile o
+0001f5d0: 6620 7468 6520 6461 7461 7365 7420 6279  f the dataset by
+0001f5e0: 2061 2077 6569 6768 7465 6420 6176 6572   a weighted aver
+0001f5f0: 6167 6520 6f66 0a20 2020 2074 6865 2074  age of.    the t
+0001f600: 776f 2069 7465 6d73 206f 6e20 6569 7468  wo items on eith
+0001f610: 6572 2073 6964 6520 6f66 2074 6861 7420  er side of that 
+0001f620: 6672 6163 7469 6f6e 616c 2069 6e64 6578  fractional index
+0001f630: 2077 6974 6869 6e20 7468 650a 2020 2020   within the.    
+0001f640: 6461 7461 7365 742e 2070 6374 206d 7573  dataset. pct mus
+0001f650: 7420 6265 2061 206e 756d 6265 7220 6265  t be a number be
+0001f660: 7477 6565 6e20 3020 616e 6420 3130 3020  tween 0 and 100 
+0001f670: 2869 6e63 6c75 7369 7665 292e 0a0a 2020  (inclusive)...  
+0001f680: 2020 5265 7475 726e 7320 4e6f 6e65 2077    Returns None w
+0001f690: 6865 6e20 6769 7665 6e20 616e 2065 6d70  hen given an emp
+0001f6a0: 7479 2064 6174 6173 6574 2c20 616e 6420  ty dataset, and 
+0001f6b0: 616c 7761 7973 2072 6574 7572 6e73 2074  always returns t
+0001f6c0: 6865 0a20 2020 2073 696e 6775 6c61 7220  he.    singular 
+0001f6d0: 6974 656d 2069 6e20 7468 6520 6461 7461  item in the data
+0001f6e0: 7365 7420 7768 656e 2067 6976 656e 2061  set when given a
+0001f6f0: 2064 6174 6173 6574 206f 6620 6c65 6e67   dataset of leng
+0001f700: 7468 2031 2e0a 2020 2020 2222 220a 2020  th 1..    """.  
+0001f710: 2020 6672 203d 2070 6374 202f 2031 3030    fr = pct / 100
+0001f720: 2e30 0a20 2020 2069 6620 6c65 6e28 6461  .0.    if len(da
+0001f730: 7461 7365 7429 203d 3d20 313a 0a20 2020  taset) == 1:.   
+0001f740: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
+0001f750: 7365 745b 305d 0a20 2020 2065 6c69 6620  set[0].    elif 
+0001f760: 6c65 6e28 6461 7461 7365 7429 203d 3d20  len(dataset) == 
+0001f770: 303a 0a20 2020 2020 2020 2072 6574 7572  0:.        retur
+0001f780: 6e20 4e6f 6e65 0a20 2020 2073 7274 203d  n None.    srt =
+0001f790: 2073 6f72 7465 6428 6461 7461 7365 7429   sorted(dataset)
+0001f7a0: 0a20 2020 2066 7269 6478 203d 2066 7220  .    fridx = fr 
+0001f7b0: 2a20 286c 656e 2873 7274 2920 2d20 3129  * (len(srt) - 1)
+0001f7c0: 0a20 2020 2069 6478 203d 2069 6e74 2866  .    idx = int(f
+0001f7d0: 7269 6478 290a 2020 2020 6966 2069 6478  ridx).    if idx
+0001f7e0: 203d 3d20 6672 6964 783a 0a20 2020 2020   == fridx:.     
+0001f7f0: 2020 2072 6574 7572 6e20 7372 745b 6964     return srt[id
+0001f800: 785d 2023 2069 6e74 6567 6572 2069 6e64  x] # integer ind
+0001f810: 6578 202d 3e20 6e6f 2061 7665 7261 6769  ex -> no averagi
+0001f820: 6e67 0a20 2020 206c 6566 746f 7665 7220  ng.    leftover 
+0001f830: 3d20 6672 6964 7820 2d20 6964 780a 2020  = fridx - idx.  
+0001f840: 2020 6669 7273 7420 3d20 7372 745b 6964    first = srt[id
+0001f850: 785d 0a20 2020 2073 6563 6f6e 6420 3d20  x].    second = 
+0001f860: 7372 745b 6964 7820 2b20 315d 2023 206c  srt[idx + 1] # l
+0001f870: 6567 616c 2069 6e64 6578 2062 6563 6175  egal index becau
+0001f880: 7365 2077 6520 6361 6e27 7420 6861 7665  se we can't have
+0001f890: 2068 6974 2074 6865 2065 6e64 0a20 2020   hit the end.   
+0001f8a0: 2072 6574 7572 6e20 6669 7273 7420 2a20   return first * 
+0001f8b0: 2831 202d 206c 6566 746f 7665 7229 202b  (1 - leftover) +
+0001f8c0: 2073 6563 6f6e 6420 2a20 6c65 6674 6f76   second * leftov
+0001f8d0: 6572 0a0a 0a64 6566 2067 6574 5f66 6565  er...def get_fee
+0001f8e0: 6462 6163 6b5f 7073 5f61 6e64 5f74 6173  dback_ps_and_tas
+0001f8f0: 6b28 0a20 2020 2074 6173 6b5f 696e 666f  k(.    task_info
+0001f900: 2c0a 2020 2020 636f 7572 7365 2c0a 2020  ,.    course,.  
+0001f910: 2020 7365 6d65 7374 6572 2c0a 2020 2020    semester,.    
+0001f920: 7573 6572 2c0a 2020 2020 7068 6173 652c  user,.    phase,
+0001f930: 0a20 2020 2070 7369 642c 0a20 2020 2074  .    psid,.    t
+0001f940: 6173 6b69 640a 293a 0a20 2020 2022 2222  askid.):.    """
+0001f950: 0a20 2020 2047 6976 656e 2061 2074 6173  .    Given a tas
+0001f960: 6b5f 696e 666f 206f 626a 6563 7420 616e  k_info object an
+0001f970: 6420 6120 7061 7274 6963 756c 6172 0a20  d a particular. 
+0001f980: 2020 2063 6f75 7273 652f 7365 6d65 7374     course/semest
+0001f990: 6572 2f75 7365 722f 7068 6173 652f 7073  er/user/phase/ps
+0001f9a0: 6574 2f74 6173 6b20 7765 2772 6520 696e  et/task we're in
+0001f9b0: 7465 7265 7374 6564 2069 6e2c 2065 7874  terested in, ext
+0001f9c0: 7261 6374 730a 2020 2020 616e 6420 6175  racts.    and au
+0001f9d0: 676d 656e 7473 2070 7320 616e 6420 7461  gments ps and ta
+0001f9e0: 736b 206f 626a 6563 7473 2074 6f20 6d61  sk objects to ma
+0001f9f0: 6b65 2074 6865 6d20 7265 6164 7920 666f  ke them ready fo
+0001fa00: 7220 7265 6e64 6572 696e 6720 6173 0a20  r rendering as. 
+0001fa10: 2020 2066 6565 6462 6163 6b2c 2072 6574     feedback, ret
+0001fa20: 7572 6e69 6e67 2061 2074 7570 6c65 206f  urning a tuple o
+0001fa30: 6620 626f 7468 2e0a 0a20 2020 2052 6574  f both...    Ret
+0001fa40: 7572 6e73 2061 2056 616c 7565 4572 726f  urns a ValueErro
+0001fa50: 7220 6f62 6a65 6374 2069 6e20 6361 7365  r object in case
+0001fa60: 7320 7768 6572 6520 7468 6520 7265 7175  s where the requ
+0001fa70: 6573 7465 6420 7073 6574 2f74 6173 6b0a  ested pset/task.
+0001fa80: 2020 2020 646f 6573 6e27 7420 6578 6973      doesn't exis
+0001fa90: 742e 0a20 2020 2022 2222 0a0a 2020 2020  t..    """..    
+0001faa0: 2320 4578 7472 6163 7420 7073 2026 2074  # Extract ps & t
+0001fab0: 6173 6b20 6f62 6a65 6374 730a 2020 2020  ask objects.    
+0001fac0: 7472 793a 0a20 2020 2020 2020 2070 7320  try:.        ps 
+0001fad0: 3d20 6765 745f 7073 5f6f 626a 2874 6173  = get_ps_obj(tas
+0001fae0: 6b5f 696e 666f 2c20 7073 6964 290a 2020  k_info, psid).  
+0001faf0: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
+0001fb00: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0001fb10: 2020 7265 7475 726e 2065 0a0a 2020 2020    return e..    
+0001fb20: 7472 793a 0a20 2020 2020 2020 2074 6173  try:.        tas
+0001fb30: 6b20 3d20 6765 745f 7461 736b 5f6f 626a  k = get_task_obj
+0001fb40: 2874 6173 6b5f 696e 666f 2c20 7073 2c20  (task_info, ps, 
+0001fb50: 7461 736b 6964 290a 2020 2020 6578 6365  taskid).    exce
+0001fb60: 7074 2056 616c 7565 4572 726f 7220 6173  pt ValueError as
+0001fb70: 2065 3a0a 2020 2020 2020 2020 7265 7475   e:.        retu
+0001fb80: 726e 2065 0a0a 2020 2020 2320 4164 6420  rn e..    # Add 
+0001fb90: 7374 6174 7573 2026 2074 696d 6520 7265  status & time re
+0001fba0: 6d61 696e 696e 6720 696e 666f 2074 6f20  maining info to 
+0001fbb0: 7073 6574 2061 6e64 206f 626a 6563 7473  pset and objects
+0001fbc0: 0a20 2020 2061 6d65 6e64 5f70 7365 7428  .    amend_pset(
+0001fbd0: 636f 7572 7365 2c20 7365 6d65 7374 6572  course, semester
+0001fbe0: 2c20 7461 736b 5f69 6e66 6f2c 2070 732c  , task_info, ps,
+0001fbf0: 2075 7365 7229 0a20 2020 2061 6d65 6e64   user).    amend
+0001fc00: 5f74 6173 6b28 636f 7572 7365 2c20 7365  _task(course, se
+0001fc10: 6d65 7374 6572 2c20 7461 736b 5f69 6e66  mester, task_inf
+0001fc20: 6f2c 2070 7369 642c 2074 6173 6b2c 2075  o, psid, task, u
+0001fc30: 7365 722c 2070 6861 7365 290a 0a20 2020  ser, phase)..   
+0001fc40: 2023 2047 6574 2066 756c 6c20 6665 6564   # Get full feed
+0001fc50: 6261 636b 2066 6f72 2074 6865 2074 6173  back for the tas
+0001fc60: 6b20 696e 2071 7565 7374 696f 6e20 6966  k in question if
+0001fc70: 2069 7427 7320 6176 6169 6c61 626c 650a   it's available.
+0001fc80: 2020 2020 7461 736b 5b22 6665 6564 6261      task["feedba
+0001fc90: 636b 225d 203d 2073 746f 7261 6765 2e67  ck"] = storage.g
+0001fca0: 6574 5f66 6565 6462 6163 6b28 0a20 2020  et_feedback(.   
+0001fcb0: 2020 2020 2063 6f75 7273 652c 0a20 2020       course,.   
+0001fcc0: 2020 2020 2073 656d 6573 7465 722c 0a20       semester,. 
+0001fcd0: 2020 2020 2020 2074 6173 6b5f 696e 666f         task_info
+0001fce0: 2c0a 2020 2020 2020 2020 7573 6572 2c0a  ,.        user,.
+0001fcf0: 2020 2020 2020 2020 7068 6173 652c 0a20          phase,. 
+0001fd00: 2020 2020 2020 2070 735b 2269 6422 5d2c         ps["id"],
+0001fd10: 0a20 2020 2020 2020 2074 6173 6b5b 2269  .        task["i
+0001fd20: 6422 5d0a 2020 2020 290a 2020 2020 2320  d"].    ).    # 
+0001fd30: 4765 7420 4854 4d4c 2066 6565 6462 6163  Get HTML feedbac
+0001fd40: 6b20 6173 2077 656c 6c0a 2020 2020 7461  k as well.    ta
+0001fd50: 736b 5b22 6665 6564 6261 636b 5f68 746d  sk["feedback_htm
+0001fd60: 6c22 5d20 3d20 7374 6f72 6167 652e 6765  l"] = storage.ge
+0001fd70: 745f 6665 6564 6261 636b 5f68 746d 6c28  t_feedback_html(
+0001fd80: 0a20 2020 2020 2020 2063 6f75 7273 652c  .        course,
+0001fd90: 0a20 2020 2020 2020 2073 656d 6573 7465  .        semeste
+0001fda0: 722c 0a20 2020 2020 2020 2074 6173 6b5f  r,.        task_
+0001fdb0: 696e 666f 2c0a 2020 2020 2020 2020 7573  info,.        us
+0001fdc0: 6572 2c0a 2020 2020 2020 2020 7068 6173  er,.        phas
+0001fdd0: 652c 0a20 2020 2020 2020 2070 735b 2269  e,.        ps["i
+0001fde0: 6422 5d2c 0a20 2020 2020 2020 2074 6173  d"],.        tas
+0001fdf0: 6b5b 2269 6422 5d0a 2020 2020 290a 2020  k["id"].    ).  
+0001fe00: 2020 6966 2074 6173 6b5b 2266 6565 6462    if task["feedb
+0001fe10: 6163 6b22 5d5b 2273 7461 7475 7322 5d20  ack"]["status"] 
+0001fe20: 213d 2022 6d69 7373 696e 6722 3a0a 2020  != "missing":.  
+0001fe30: 2020 2020 2020 7461 736b 5b22 7375 626d        task["subm
+0001fe40: 6974 7465 6422 5d20 3d20 5472 7565 0a20  itted"] = True. 
+0001fe50: 2020 2020 2020 2070 6f74 6c75 636b 2e72         potluck.r
+0001fe60: 656e 6465 722e 6175 676d 656e 745f 7265  ender.augment_re
+0001fe70: 706f 7274 2874 6173 6b5b 2266 6565 6462  port(task["feedb
+0001fe80: 6163 6b22 5d29 0a0a 2020 2020 7265 7475  ack"])..    retu
+0001fe90: 726e 2070 732c 2074 6173 6b0a 0a0a 6465  rn ps, task...de
+0001fea0: 6620 6765 745f 6576 616c 7561 7469 6f6e  f get_evaluation
+0001feb0: 5f69 6e66 6f28 0a20 2020 2063 6f75 7273  _info(.    cours
+0001fec0: 652c 0a20 2020 2073 656d 6573 7465 722c  e,.    semester,
+0001fed0: 0a20 2020 2074 6172 6765 745f 7573 6572  .    target_user
+0001fee0: 2c0a 2020 2020 7068 6173 652c 0a20 2020  ,.    phase,.   
+0001fef0: 2070 7369 642c 0a20 2020 2074 6173 6b69   psid,.    taski
+0001ff00: 640a 293a 0a20 2020 2022 2222 0a20 2020  d.):.    """.   
+0001ff10: 2046 6574 6368 6573 206e 6f74 6573 2061   Fetches notes a
+0001ff20: 6e64 206f 7665 7272 6964 6520 696e 666f  nd override info
+0001ff30: 2066 6f72 2074 6865 2067 6976 656e 2073   for the given s
+0001ff40: 7562 6d69 7373 696f 6e2c 2061 6e64 2072  ubmission, and r
+0001ff50: 6574 7572 6e73 0a20 2020 2061 2074 7570  eturns.    a tup
+0001ff60: 6c65 2069 6e63 6c75 6469 6e67 2074 6865  le including the
+0001ff70: 206e 6f74 6573 206d 6172 6b64 6f77 6e20   notes markdown 
+0001ff80: 736f 7572 6365 2c20 7468 6520 6e6f 7465  source, the note
+0001ff90: 7320 7265 6e64 6572 6564 2048 544d 4c2c  s rendered HTML,
+0001ffa0: 0a20 2020 2074 6865 2067 7261 6465 206f  .    the grade o
+0001ffb0: 7665 7272 6964 6520 7661 6c75 652c 2061  verride value, a
+0001ffc0: 6e64 2074 6865 2074 696d 656c 696e 6573  nd the timelines
+0001ffd0: 7320 6f76 6572 7269 6465 2076 616c 7565  s override value
+0001ffe0: 2e0a 0a20 2020 2054 6865 2067 7261 6465  ...    The grade
+0001fff0: 206f 7665 7272 6964 6520 7769 6c6c 2062   override will b
+00020000: 6520 616e 2065 6d70 7479 2073 7472 696e  e an empty strin
+00020010: 6720 6966 206e 6f20 6f76 6572 7269 6465  g if no override
+00020020: 2069 7320 6163 7469 7665 2c0a 2020 2020   is active,.    
+00020030: 616e 6420 7368 6f75 6c64 2062 6520 6120  and should be a 
+00020040: 666c 6f61 7469 6e67 2d70 6f69 6e74 2076  floating-point v
+00020050: 616c 7565 206f 7468 6572 7769 7365 2065  alue otherwise e
+00020060: 7863 6570 7420 696e 2063 6173 6573 2077  xcept in cases w
+00020070: 6865 7265 0a20 2020 2061 206e 6f6e 2d6e  here.    a non-n
+00020080: 756d 6572 6963 2076 616c 7565 2077 6173  umeric value was
+00020090: 2073 6574 2e0a 0a20 2020 2054 6865 2074   set...    The t
+000200a0: 696d 656c 696e 6573 7320 6f76 6572 7269  imeliness overri
+000200b0: 6465 2069 7320 7369 6d69 6c61 722c 2061  de is similar, a
+000200c0: 6e64 2073 686f 756c 6420 6f6e 6c79 2065  nd should only e
+000200d0: 7665 7220 6265 2073 6574 2066 6f72 0a20  ver be set for. 
+000200e0: 2020 2074 6865 2027 696e 6974 6961 6c27     the 'initial'
+000200f0: 2070 6861 7365 2c20 7369 6e63 6520 6974   phase, since it
+00020100: 2061 7070 6c69 6573 2061 6372 6f73 7320   applies across 
+00020110: 616c 6c20 7068 6173 6573 2e0a 0a20 2020  all phases...   
+00020120: 2054 6865 206e 6f74 6573 2061 6e64 206e   The notes and n
+00020130: 6f74 6573 2048 544d 4c20 7374 7269 6e67  otes HTML string
+00020140: 7320 7769 6c6c 2062 6520 656d 7074 7920  s will be empty 
+00020150: 7374 7269 6e67 7320 6966 206e 6f20 6e6f  strings if no no
+00020160: 7465 730a 2020 2020 6861 7665 2062 6565  tes.    have bee
+00020170: 6e20 7365 742e 0a20 2020 2022 2222 0a20  n set..    """. 
+00020180: 2020 2023 2046 6574 6368 2072 6177 2065     # Fetch raw e
+00020190: 7661 6c20 696e 666f 2064 6963 740a 2020  val info dict.  
+000201a0: 2020 6576 616c 7561 7469 6f6e 203d 2073    evaluation = s
+000201b0: 746f 7261 6765 2e66 6574 6368 5f65 7661  torage.fetch_eva
+000201c0: 6c75 6174 696f 6e28 0a20 2020 2020 2020  luation(.       
+000201d0: 2063 6f75 7273 652c 0a20 2020 2020 2020   course,.       
+000201e0: 2073 656d 6573 7465 722c 0a20 2020 2020   semester,.     
+000201f0: 2020 2074 6172 6765 745f 7573 6572 2c0a     target_user,.
+00020200: 2020 2020 2020 2020 7068 6173 652c 0a20          phase,. 
+00020210: 2020 2020 2020 2070 7369 642c 0a20 2020         psid,.   
+00020220: 2020 2020 2074 6173 6b69 640a 2020 2020       taskid.    
+00020230: 290a 0a20 2020 2069 6620 6576 616c 7561  )..    if evalua
+00020240: 7469 6f6e 2069 7320 4e6f 6e65 3a0a 2020  tion is None:.  
+00020250: 2020 2020 2020 7265 7475 726e 2027 272c        return '',
+00020260: 2027 272c 2027 272c 2027 270a 0a20 2020   '', '', ''..   
+00020270: 2023 2045 7874 7261 6374 206e 6f74 6573   # Extract notes
+00020280: 2061 6e64 2067 7261 6465 206f 7665 7272   and grade overr
+00020290: 6964 6520 6672 6f6d 2073 746f 7265 6420  ide from stored 
+000202a0: 696e 666f 0a20 2020 206e 6f74 6573 203d  info.    notes =
+000202b0: 2065 7661 6c75 6174 696f 6e2e 6765 7428   evaluation.get(
+000202c0: 226e 6f74 6573 222c 2022 2229 0a20 2020  "notes", "").   
+000202d0: 206f 7665 7272 6964 6520 3d20 6576 616c   override = eval
+000202e0: 7561 7469 6f6e 2e67 6574 2822 6f76 6572  uation.get("over
+000202f0: 7269 6465 2229 0a20 2020 2069 6620 6f76  ride").    if ov
+00020300: 6572 7269 6465 2069 7320 4e6f 6e65 3a0a  erride is None:.
+00020310: 2020 2020 2020 2020 6f76 6572 7269 6465          override
+00020320: 203d 2022 220a 2020 2020 656c 7365 3a0a   = "".    else:.
+00020330: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00020340: 2020 2020 2020 2020 206f 7665 7272 6964           overrid
+00020350: 6520 3d20 666c 6f61 7428 6f76 6572 7269  e = float(overri
+00020360: 6465 290a 2020 2020 2020 2020 6578 6365  de).        exce
+00020370: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
+00020380: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
+00020390: 2020 2020 7469 6d65 6c69 6e65 7373 203d      timeliness =
+000203a0: 2065 7661 6c75 6174 696f 6e2e 6765 7428   evaluation.get(
+000203b0: 2274 696d 656c 696e 6573 7322 290a 2020  "timeliness").  
+000203c0: 2020 6966 2074 696d 656c 696e 6573 7320    if timeliness 
+000203d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000203e0: 2074 696d 656c 696e 6573 7320 3d20 2222   timeliness = ""
+000203f0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00020400: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00020410: 2020 2020 7469 6d65 6c69 6e65 7373 203d      timeliness =
+00020420: 2066 6c6f 6174 2874 696d 656c 696e 6573   float(timelines
+00020430: 7329 0a20 2020 2020 2020 2065 7863 6570  s).        excep
+00020440: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
+00020450: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
+00020460: 2020 2023 2052 656e 6465 7220 6e6f 7465     # Render note
+00020470: 7320 6173 2048 544d 4c0a 2020 2020 6e6f  s as HTML.    no
+00020480: 7465 735f 6874 6d6c 203d 2070 6f74 6c75  tes_html = potlu
+00020490: 636b 2e72 656e 6465 722e 7265 6e64 6572  ck.render.render
+000204a0: 5f6d 6172 6b64 6f77 6e28 6e6f 7465 7329  _markdown(notes)
+000204b0: 0a0a 2020 2020 7265 7475 726e 206e 6f74  ..    return not
+000204c0: 6573 2c20 6e6f 7465 735f 6874 6d6c 2c20  es, notes_html, 
+000204d0: 6f76 6572 7269 6465 2c20 7469 6d65 6c69  override, timeli
+000204e0: 6e65 7373 0a0a 0a23 2d2d 2d2d 2d2d 2d2d  ness...#--------
+000204f0: 2d2d 2d2d 2d2d 2d2d 230a 2320 5469 6d65  --------#.# Time
+00020500: 2066 756e 6374 696f 6e73 2023 0a23 2d2d   functions #.#--
+00020510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 230a  --------------#.
+00020520: 0a4f 4e45 5f4d 494e 5554 4520 3d20 3630  .ONE_MINUTE = 60
+00020530: 0a4f 4e45 5f48 4f55 5220 3d20 4f4e 455f  .ONE_HOUR = ONE_
+00020540: 4d49 4e55 5445 202a 2036 300a 4f4e 455f  MINUTE * 60.ONE_
+00020550: 4441 5920 3d20 4f4e 455f 484f 5552 202a  DAY = ONE_HOUR *
+00020560: 2032 340a 4f4e 455f 5745 454b 203d 204f   24.ONE_WEEK = O
+00020570: 4e45 5f44 4159 202a 2037 0a0a 0a64 6566  NE_DAY * 7...def
+00020580: 2070 7365 745f 7374 6174 7573 5f6e 6f77   pset_status_now
+00020590: 280a 2020 2020 7573 6572 6e61 6d65 2c0a  (.    username,.
+000205a0: 2020 2020 7461 736b 5f69 6e66 6f2c 0a20      task_info,. 
+000205b0: 2020 2070 7365 745f 6f62 6a2c 0a20 2020     pset_obj,.   
+000205c0: 2065 7874 656e 7369 6f6e 733d 2846 616c   extensions=(Fal
+000205d0: 7365 2c20 4661 6c73 6529 0a29 3a0a 2020  se, False).):.  
+000205e0: 2020 2222 220a 2020 2020 5265 7475 726e    """.    Return
+000205f0: 7320 7468 6520 6375 7272 656e 7420 7374  s the current st
+00020600: 6174 6520 6f66 2074 6865 2067 6976 656e  ate of the given
+00020610: 2070 7365 7420 6f62 6a65 6374 2028 616c   pset object (al
+00020620: 736f 206e 6565 6473 2074 6865 0a20 2020  so needs the.   
+00020630: 2074 6173 6b20 696e 666f 206f 626a 6563   task info objec
+00020640: 7420 616e 6420 7468 6520 7573 6572 6e61  t and the userna
+00020650: 6d65 292e 2049 6620 2250 4155 5345 5f41  me). If "PAUSE_A
+00020660: 5422 2069 7320 7365 7420 696e 2074 6865  T" is set in the
+00020670: 2074 6173 6b0a 2020 2020 6f62 6a65 6374   task.    object
+00020680: 2061 6e64 206e 6f6e 2d65 6d70 7479 2028   and non-empty (
+00020690: 7365 6520 7365 745f 7061 7573 655f 7469  see set_pause_ti
+000206a0: 6d65 292c 2074 6861 7420 6d6f 6d65 6e74  me), that moment
+000206b0: 2c20 6e6f 7420 7468 650a 2020 2020 6375  , not the.    cu
+000206c0: 7272 656e 7420 7469 6d65 2c20 7769 6c6c  rrent time, will
+000206d0: 2062 6520 7573 6564 2e20 4578 7465 6e73   be used. Extens
+000206e0: 696f 6e73 206d 7573 7420 636f 6e74 6169  ions must contai
+000206f0: 6e20 7477 6f20 7661 6c75 6573 2028 6f6e  n two values (on
+00020700: 650a 2020 2020 666f 7220 7468 6520 696e  e.    for the in
+00020710: 6974 6961 6c20 7068 6173 6520 616e 6420  itial phase and 
+00020720: 6f6e 6520 666f 7220 7468 6520 7265 7669  one for the revi
+00020730: 7369 6f6e 2070 6861 7365 292e 2054 6865  sion phase). The
+00020740: 7920 6d61 7920 6561 6368 0a20 2020 2062  y may each.    b
+00020750: 6520 4661 6c73 6520 666f 7220 6e6f 2065  e False for no e
+00020760: 7874 656e 7369 6f6e 2c20 5472 7565 2066  xtension, True f
+00020770: 6f72 2074 6865 2064 6566 6175 6c74 2065  or the default e
+00020780: 7874 656e 7369 6f6e 2c20 6f72 2061 6e0a  xtension, or an.
+00020790: 2020 2020 696e 7465 6765 7220 6e75 6d62      integer numb
+000207a0: 6572 206f 6620 686f 7572 732e 2054 686f  er of hours. Tho
+000207b0: 7365 2068 6f75 7273 2077 696c 6c20 6265  se hours will be
+000207c0: 2061 6464 6564 2074 6f20 7468 6520 6566   added to the ef
+000207d0: 6665 6374 6976 650a 2020 2020 696e 6974  fective.    init
+000207e0: 6961 6c20 616e 6420 7265 7669 7369 6f6e  ial and revision
+000207f0: 2064 6561 646c 696e 6573 2e0a 0a20 2020   deadlines...   
+00020800: 2052 6574 7572 6e73 2061 2064 6963 7469   Returns a dicti
+00020810: 6f6e 6172 7920 7769 7468 2027 7374 6174  onary with 'stat
+00020820: 6527 2c20 2769 6e69 7469 616c 2d65 7874  e', 'initial-ext
+00020830: 656e 7369 6f6e 272c 0a20 2020 2027 7265  ension',.    're
+00020840: 7669 7369 6f6e 2d65 7874 656e 7369 6f6e  vision-extension
+00020850: 272c 2027 7265 6c65 6173 6527 2c20 2764  ', 'release', 'd
+00020860: 7565 272c 2027 7265 7669 6577 6564 272c  ue', 'reviewed',
+00020870: 2061 6e64 2027 6669 6e61 6c69 7a65 6427   and 'finalized'
+00020880: 2c0a 2020 2020 6b65 7973 2e20 4561 6368  ,.    keys. Each
+00020890: 206f 6620 7468 6520 2772 656c 6561 7365   of the 'release
+000208a0: 272c 2027 6475 6527 2c20 2772 6576 6965  ', 'due', 'revie
+000208b0: 7765 6427 2c20 616e 6420 2766 696e 616c  wed', and 'final
+000208c0: 697a 6564 2720 6b65 7973 0a20 2020 2077  ized' keys.    w
+000208d0: 696c 6c20 6265 2061 2073 7562 2d64 6963  ill be a sub-dic
+000208e0: 7469 6f6e 6172 7920 7769 7468 2074 6865  tionary with the
+000208f0: 2066 6f6c 6c6f 7769 6e67 206b 6579 733a   following keys:
+00020900: 0a0a 2020 2020 2d20 2761 7427 3a20 4120  ..    - 'at': A 
+00020910: 6461 7465 696d 7465 2e64 6174 6574 696d  dateimte.datetim
+00020920: 6520 6f62 6a65 6374 2073 7065 6369 6679  e object specify
+00020930: 696e 6720 6162 736f 6c75 7465 2074 696d  ing absolute tim
+00020940: 696e 672e 0a20 2020 202d 2027 6174 5f73  ing..    - 'at_s
+00020950: 7472 273a 2041 2073 7472 696e 6720 7265  tr': A string re
+00020960: 7072 6573 656e 7461 7469 6f6e 206f 6620  presentation of 
+00020970: 7468 6520 6162 6f76 652e 0a20 2020 202d  the above..    -
+00020980: 2027 756e 7469 6c27 3a20 4120 6461 7465   'until': A date
+00020990: 7469 6d65 2e74 696d 6564 656c 7461 2072  time.timedelta r
+000209a0: 6570 7265 7365 6e74 696e 6720 7469 6d65  epresenting time
+000209b0: 2075 6e74 696c 2074 6865 2065 7665 6e74   until the event
+000209c0: 2028 7769 6c6c 0a20 2020 2020 2020 2062   (will.        b
+000209d0: 6520 6e65 6761 7469 7665 2061 6674 6572  e negative after
+000209e0: 7761 7264 7329 2e0a 2020 2020 2d20 2775  wards)..    - 'u
+000209f0: 6e74 696c 5f73 7472 273a 2041 2073 7472  ntil_str': A str
+00020a00: 696e 6720 7265 7072 6573 656e 7461 7469  ing representati
+00020a10: 6f6e 206f 6620 7468 6520 6162 6f76 652e  on of the above.
+00020a20: 0a0a 2020 2020 4561 6368 206f 6620 7468  ..    Each of th
+00020a30: 6520 7375 622d 7661 6c75 6573 2077 696c  e sub-values wil
+00020a40: 6c20 6265 206e 6f6e 6520 6966 2074 6865  l be none if the
+00020a50: 2070 7365 7420 646f 6573 6e27 7420 6861   pset doesn't ha
+00020a60: 7665 2061 0a20 2020 2064 6561 646c 696e  ve a.    deadlin
+00020a70: 6520 7365 742e 0a0a 2020 2020 5468 6520  e set...    The 
+00020a80: 2773 7461 7465 2720 7661 6c75 6520 7769  'state' value wi
+00020a90: 6c6c 2062 6520 6f6e 6520 6f66 3a0a 0a20  ll be one of:.. 
+00020aa0: 2020 202d 2022 756e 7265 6c65 6173 6564     - "unreleased
+00020ab0: 223a 2054 6869 7320 7073 6574 2068 6173  ": This pset has
+00020ac0: 6e27 7420 7965 7420 6265 656e 2072 656c  n't yet been rel
+00020ad0: 6561 7365 643b 2064 6f6e 2774 2064 6973  eased; don't dis
+00020ae0: 706c 6179 0a20 2020 2020 2020 2061 6e79  play.        any
+00020af0: 2069 6e66 6f20 6162 6f75 7420 6974 2e0a   info about it..
+00020b00: 2020 2020 2d20 2272 656c 6561 7365 6422      - "released"
+00020b10: 3a20 5468 6973 2070 7365 7420 6861 7320  : This pset has 
+00020b20: 6265 656e 2072 656c 6561 7365 6420 616e  been released an
+00020b30: 6420 6973 6e27 7420 6475 6520 7965 742e  d isn't due yet.
+00020b40: 0a20 2020 202d 2022 756e 6465 725f 7265  .    - "under_re
+00020b50: 7669 6577 223a 2054 6869 7320 7073 6574  view": This pset
+00020b60: 2773 2064 7565 2074 696d 6520 6861 7320  's due time has 
+00020b70: 7061 7373 6564 2c20 6275 7420 7468 6520  passed, but the 
+00020b80: 6665 6564 6261 636b 0a20 2020 2020 2020  feedback.       
+00020b90: 2072 6576 6965 7720 7065 7269 6f64 2068   review period h
+00020ba0: 6173 6e27 7420 6578 7069 7265 6420 7965  asn't expired ye
+00020bb0: 742e 0a20 2020 202d 2022 7265 7669 7361  t..    - "revisa
+00020bc0: 626c 6522 3a20 5468 6973 2070 7365 7427  ble": This pset'
+00020bd0: 7320 6475 6520 7469 6d65 2069 7320 7061  s due time is pa
+00020be0: 7374 2c20 616e 6420 7468 6520 7265 7669  st, and the revi
+00020bf0: 6577 2070 6572 696f 6420 6861 730a 2020  ew period has.  
+00020c00: 2020 2020 2020 6578 7069 7265 642c 2073        expired, s
+00020c10: 6f20 6675 6c6c 2066 6565 6462 6163 6b20  o full feedback 
+00020c20: 7368 6f75 6c64 2062 6520 7265 6c65 6173  should be releas
+00020c30: 6564 2c20 6275 7420 7265 7669 7369 6f6e  ed, but revision
+00020c40: 7320 6d61 790a 2020 2020 2020 2020 7374  s may.        st
+00020c50: 696c 6c20 6265 2073 7562 6d69 7474 6564  ill be submitted
+00020c60: 2e0a 2020 2020 2d20 2266 696e 616c 223a  ..    - "final":
+00020c70: 2054 6869 7320 7073 6574 2773 2064 7565   This pset's due
+00020c80: 2074 696d 6520 6973 2070 6173 742c 2074   time is past, t
+00020c90: 6865 2072 6576 6965 7720 7065 7269 6f64  he review period
+00020ca0: 2068 6173 0a20 2020 2020 2020 2065 7870   has.        exp
+00020cb0: 6972 6564 2c20 616e 6420 7468 6520 7265  ired, and the re
+00020cc0: 7669 7369 6f6e 2070 6572 696f 6420 6973  vision period is
+00020cd0: 2061 6c73 6f20 6f76 6572 2c20 736f 2066   also over, so f
+00020ce0: 756c 6c20 6665 6564 6261 636b 0a20 2020  ull feedback.   
+00020cf0: 2020 2020 2069 7320 6176 6169 6c61 626c       is availabl
+00020d00: 652c 2061 6e64 206e 6f20 6d6f 7265 2073  e, and no more s
+00020d10: 7562 6d69 7373 696f 6e73 2077 696c 6c20  ubmissions will 
+00020d20: 6265 2061 6363 6570 7465 642e 0a20 2020  be accepted..   
+00020d30: 202d 2022 756e 6b6e 6f77 6e22 3a20 5468   - "unknown": Th
+00020d40: 6973 2070 7365 7420 646f 6573 6e27 7420  is pset doesn't 
+00020d50: 6861 7665 2061 2064 7565 2064 6174 652e  have a due date.
+00020d60: 2054 6865 0a20 2020 2020 2020 2073 6563   The.        sec
+00020d70: 6f6e 6473 5f72 656d 6169 6e69 6e67 2076  onds_remaining v
+00020d80: 616c 7565 2077 696c 6c20 6265 204e 6f6e  alue will be Non
+00020d90: 652e 0a0a 2020 2020 5468 6520 2769 6e69  e...    The 'ini
+00020da0: 7469 616c 5f65 7874 656e 7369 6f6e 2720  tial_extension' 
+00020db0: 616e 6420 2772 6576 6973 696f 6e5f 6578  and 'revision_ex
+00020dc0: 7465 6e73 696f 6e27 2077 696c 6c20 626f  tension' will bo
+00020dd0: 7468 2062 6520 6e75 6d62 6572 730a 2020  th be numbers.  
+00020de0: 2020 7370 6563 6966 7969 6e67 2068 6f77    specifying how
+00020df0: 206d 616e 7920 686f 7572 7320 6f66 2065   many hours of e
+00020e00: 7874 656e 7369 6f6e 2077 6572 6520 6772  xtension were gr
+00020e10: 616e 7465 6420 2874 6865 7365 206e 756d  anted (these num
+00020e20: 6265 7273 0a20 2020 2061 7265 2061 6c72  bers.    are alr
+00020e30: 6561 6479 2066 6163 746f 7265 6420 696e  eady factored in
+00020e40: 746f 2074 6865 2064 6561 646c 696e 6520  to the deadline 
+00020e50: 696e 666f 726d 6174 696f 6e20 7468 6520  information the 
+00020e60: 7374 6174 7573 0a20 2020 2063 6f6e 7461  status.    conta
+00020e70: 696e 7329 2e20 5468 6573 6520 6e75 6d62  ins). These numb
+00020e80: 6572 7320 7769 6c6c 2062 6520 3020 666f  ers will be 0 fo
+00020e90: 7220 7374 7564 656e 7473 2077 686f 2064  r students who d
+00020ea0: 6f6e 2774 2068 6176 650a 2020 2020 6578  on't have.    ex
+00020eb0: 7465 6e73 696f 6e73 2e0a 2020 2020 2222  tensions..    ""
+00020ec0: 220a 2020 2020 2320 4765 7420 6578 7465  ".    # Get exte
+00020ed0: 6e73 696f 6e2f 7265 7669 7369 6f6e 2064  nsion/revision d
+00020ee0: 7572 6174 696f 6e73 2061 6e64 2067 7261  urations and gra
+00020ef0: 6365 2070 6572 696f 6420 6672 6f6d 2074  ce period from t
+00020f00: 6173 6b20 696e 666f 3a0a 2020 2020 7374  ask info:.    st
+00020f10: 616e 6461 7264 5f65 7874 5f68 7273 203d  andard_ext_hrs =
+00020f20: 2074 6173 6b5f 696e 666f 2e67 6574 2822   task_info.get("
+00020f30: 6578 7465 6e73 696f 6e5f 686f 7572 7322  extension_hours"
+00020f40: 2c20 3234 290a 2020 2020 7265 7669 6577  , 24).    review
+00020f50: 5f68 6f75 7273 203d 2074 6173 6b5f 696e  _hours = task_in
+00020f60: 666f 2e67 6574 2822 7265 7669 6577 5f68  fo.get("review_h
+00020f70: 6f75 7273 222c 2032 3429 0a20 2020 2067  ours", 24).    g
+00020f80: 7261 6365 5f6d 696e 7320 3d20 7461 736b  race_mins = task
+00020f90: 5f69 6e66 6f2e 6765 7428 2267 7261 6365  _info.get("grace
+00020fa0: 5f6d 696e 7574 6573 222c 2030 290a 2020  _minutes", 0).  
+00020fb0: 2020 7265 7669 7369 6f6e 5f68 6f75 7273    revision_hours
+00020fc0: 203d 2074 6173 6b5f 696e 666f 2e67 6574   = task_info.get
+00020fd0: 2822 7265 7669 7369 6f6e 5f68 6f75 7273  ("revision_hours
+00020fe0: 222c 2037 3229 0a0a 2020 2020 2320 4765  ", 72)..    # Ge
+00020ff0: 7420 7073 6574 2d73 7065 6369 6669 6320  t pset-specific 
+00021000: 7265 7669 6577 2f67 7261 6365 2f72 6576  review/grace/rev
+00021010: 6973 696f 6e20 696e 666f 2069 6620 6974  ision info if it
+00021020: 2065 7869 7374 730a 2020 2020 7265 7669   exists.    revi
+00021030: 6577 5f68 6f75 7273 203d 2070 7365 745f  ew_hours = pset_
+00021040: 6f62 6a2e 6765 7428 2272 6576 6965 775f  obj.get("review_
+00021050: 686f 7572 7322 2c20 7265 7669 6577 5f68  hours", review_h
+00021060: 6f75 7273 290a 2020 2020 6772 6163 655f  ours).    grace_
+00021070: 6d69 6e73 203d 2070 7365 745f 6f62 6a2e  mins = pset_obj.
+00021080: 6765 7428 2267 7261 6365 5f6d 696e 7574  get("grace_minut
+00021090: 6573 222c 2067 7261 6365 5f6d 696e 7329  es", grace_mins)
+000210a0: 0a20 2020 2072 6576 6973 696f 6e5f 686f  .    revision_ho
+000210b0: 7572 7320 3d20 7073 6574 5f6f 626a 2e67  urs = pset_obj.g
+000210c0: 6574 2822 7265 7669 7369 6f6e 5f68 6f75  et("revision_hou
+000210d0: 7273 222c 2072 6576 6973 696f 6e5f 686f  rs", revision_ho
+000210e0: 7572 7329 0a0a 2020 2020 2320 4669 6775  urs)..    # Figu
+000210f0: 7265 206f 7574 2065 7874 656e 7369 6f6e  re out extension
+00021100: 2061 6d6f 756e 7473 0a20 2020 2069 6e69   amounts.    ini
+00021110: 7469 616c 5f65 7874 656e 7369 6f6e 203d  tial_extension =
+00021120: 2030 0a20 2020 2069 6620 6578 7465 6e73   0.    if extens
+00021130: 696f 6e73 5b30 5d20 6973 2054 7275 653a  ions[0] is True:
+00021140: 0a20 2020 2020 2020 2069 6e69 7469 616c  .        initial
+00021150: 5f65 7874 656e 7369 6f6e 203d 2073 7461  _extension = sta
+00021160: 6e64 6172 645f 6578 745f 6872 730a 2020  ndard_ext_hrs.  
+00021170: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00021180: 6528 6578 7465 6e73 696f 6e73 5b30 5d2c  e(extensions[0],
+00021190: 2028 696e 742c 2066 6c6f 6174 2929 3a0a   (int, float)):.
+000211a0: 2020 2020 2020 2020 696e 6974 6961 6c5f          initial_
+000211b0: 6578 7465 6e73 696f 6e20 3d20 6578 7465  extension = exte
+000211c0: 6e73 696f 6e73 5b30 5d0a 2020 2020 656c  nsions[0].    el
+000211d0: 6966 2065 7874 656e 7369 6f6e 735b 305d  if extensions[0]
+000211e0: 2069 7320 6e6f 7420 4661 6c73 653a 0a20   is not False:. 
+000211f0: 2020 2020 2020 2066 6c61 736b 2e66 6c61         flask.fla
+00021200: 7368 280a 2020 2020 2020 2020 2020 2020  sh(.            
+00021210: 2249 676e 6f72 696e 6720 696e 7661 6c69  "Ignoring invali
+00021220: 6420 696e 6974 6961 6c20 6578 7465 6e73  d initial extens
+00021230: 696f 6e20 7661 6c75 6520 277b 7d27 222e  ion value '{}'".
+00021240: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
+00021250: 2020 2020 2020 2020 6578 7465 6e73 696f          extensio
+00021260: 6e73 5b30 5d0a 2020 2020 2020 2020 2020  ns[0].          
+00021270: 2020 290a 2020 2020 2020 2020 290a 0a20    ).        ).. 
+00021280: 2020 2072 6576 6973 696f 6e5f 6578 7465     revision_exte
+00021290: 6e73 696f 6e20 3d20 300a 2020 2020 6966  nsion = 0.    if
+000212a0: 2065 7874 656e 7369 6f6e 735b 315d 2069   extensions[1] i
+000212b0: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
+000212c0: 7265 7669 7369 6f6e 5f65 7874 656e 7369  revision_extensi
+000212d0: 6f6e 203d 2073 7461 6e64 6172 645f 6578  on = standard_ex
+000212e0: 745f 6872 730a 2020 2020 656c 6966 2069  t_hrs.    elif i
+000212f0: 7369 6e73 7461 6e63 6528 6578 7465 6e73  sinstance(extens
+00021300: 696f 6e73 5b31 5d2c 2028 696e 742c 2066  ions[1], (int, f
+00021310: 6c6f 6174 2929 3a0a 2020 2020 2020 2020  loat)):.        
+00021320: 7265 7669 7369 6f6e 5f65 7874 656e 7369  revision_extensi
+00021330: 6f6e 203d 2065 7874 656e 7369 6f6e 735b  on = extensions[
+00021340: 315d 0a20 2020 2065 6c69 6620 6578 7465  1].    elif exte
+00021350: 6e73 696f 6e73 5b31 5d20 6973 206e 6f74  nsions[1] is not
+00021360: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
+00021370: 666c 6173 6b2e 666c 6173 6828 0a20 2020  flask.flash(.   
+00021380: 2020 2020 2020 2020 2022 4967 6e6f 7269           "Ignori
+00021390: 6e67 2069 6e76 616c 6964 2072 6576 6973  ng invalid revis
+000213a0: 696f 6e20 6578 7465 6e73 696f 6e20 7661  ion extension va
+000213b0: 6c75 6520 277b 7d27 222e 666f 726d 6174  lue '{}'".format
+000213c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000213d0: 2020 6578 7465 6e73 696f 6e73 5b31 5d0a    extensions[1].
+000213e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000213f0: 2020 2020 2020 290a 0a20 2020 2023 2054        )..    # T
+00021400: 6865 2064 6566 6175 6c74 2072 6573 756c  he default resul
+00021410: 740a 2020 2020 7265 7375 6c74 203d 207b  t.    result = {
+00021420: 0a20 2020 2020 2020 2027 7374 6174 6527  .        'state'
+00021430: 3a20 2275 6e6b 6e6f 776e 222c 0a20 2020  : "unknown",.   
+00021440: 2020 2020 2027 7265 6c65 6173 6527 3a20       'release': 
+00021450: 7b0a 2020 2020 2020 2020 2020 2020 2761  {.            'a
+00021460: 7427 3a20 4e6f 6e65 2c0a 2020 2020 2020  t': None,.      
+00021470: 2020 2020 2020 2761 745f 7374 7227 3a20        'at_str': 
+00021480: 2775 6e6b 6e6f 776e 272c 0a20 2020 2020  'unknown',.     
+00021490: 2020 2020 2020 2027 756e 7469 6c27 3a20         'until': 
+000214a0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+000214b0: 2020 2775 6e74 696c 5f73 7472 273a 2027    'until_str': '
+000214c0: 6174 2073 6f6d 6520 706f 696e 7420 286e  at some point (n
+000214d0: 6f74 2079 6574 2073 7065 6369 6669 6564  ot yet specified
+000214e0: 2927 0a20 2020 2020 2020 207d 2c0a 2020  )'.        },.  
+000214f0: 2020 2020 2020 2764 7565 273a 207b 0a20        'due': {. 
+00021500: 2020 2020 2020 2020 2020 2027 6174 273a             'at':
+00021510: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00021520: 2020 2027 6174 5f73 7472 273a 2027 756e     'at_str': 'un
+00021530: 6b6e 6f77 6e27 2c0a 2020 2020 2020 2020  known',.        
+00021540: 2020 2020 2775 6e74 696c 273a 204e 6f6e      'until': Non
+00021550: 652c 0a20 2020 2020 2020 2020 2020 2027  e,.            '
+00021560: 756e 7469 6c5f 7374 7227 3a20 2761 7420  until_str': 'at 
+00021570: 736f 6d65 2070 6f69 6e74 2028 6e6f 7420  some point (not 
+00021580: 7965 7420 7370 6563 6966 6965 6429 270a  yet specified)'.
+00021590: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+000215a0: 2020 2027 7265 7669 6577 6564 273a 207b     'reviewed': {
+000215b0: 0a20 2020 2020 2020 2020 2020 2027 6174  .            'at
+000215c0: 273a 204e 6f6e 652c 0a20 2020 2020 2020  ': None,.       
+000215d0: 2020 2020 2027 6174 5f73 7472 273a 2027       'at_str': '
+000215e0: 756e 6b6e 6f77 6e27 2c0a 2020 2020 2020  unknown',.      
+000215f0: 2020 2020 2020 2775 6e74 696c 273a 204e        'until': N
+00021600: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00021610: 2027 756e 7469 6c5f 7374 7227 3a20 2761   'until_str': 'a
+00021620: 7420 736f 6d65 2070 6f69 6e74 2028 6e6f  t some point (no
+00021630: 7420 7965 7420 7370 6563 6966 6965 6429  t yet specified)
+00021640: 270a 2020 2020 2020 2020 7d2c 0a20 2020  '.        },.   
+00021650: 2020 2020 2027 6669 6e61 6c69 7a65 6427       'finalized'
+00021660: 3a20 7b0a 2020 2020 2020 2020 2020 2020  : {.            
+00021670: 2761 7427 3a20 4e6f 6e65 2c0a 2020 2020  'at': None,.    
+00021680: 2020 2020 2020 2020 2761 745f 7374 7227          'at_str'
+00021690: 3a20 2775 6e6b 6e6f 776e 272c 0a20 2020  : 'unknown',.   
+000216a0: 2020 2020 2020 2020 2027 756e 7469 6c27           'until'
+000216b0: 3a20 4e6f 6e65 2c0a 2020 2020 2020 2020  : None,.        
+000216c0: 2020 2020 2775 6e74 696c 5f73 7472 273a      'until_str':
+000216d0: 2027 6174 2073 6f6d 6520 706f 696e 7420   'at some point 
+000216e0: 286e 6f74 2079 6574 2073 7065 6369 6669  (not yet specifi
+000216f0: 6564 2927 0a20 2020 2020 2020 207d 2c0a  ed)'.        },.
+00021700: 2020 2020 2020 2020 2769 6e69 7469 616c          'initial
+00021710: 5f65 7874 656e 7369 6f6e 273a 2030 2c0a  _extension': 0,.
+00021720: 2020 2020 2020 2020 2772 6576 6973 696f          'revisio
+00021730: 6e5f 6578 7465 6e73 696f 6e27 3a20 302c  n_extension': 0,
+00021740: 0a20 2020 207d 0a0a 2020 2020 2320 5361  .    }..    # Sa
+00021750: 7665 2065 7874 656e 7369 6f6e 2069 6e66  ve extension inf
+00021760: 6f0a 2020 2020 7265 7375 6c74 5b27 696e  o.    result['in
+00021770: 6974 6961 6c5f 6578 7465 6e73 696f 6e27  itial_extension'
+00021780: 5d20 3d20 696e 6974 6961 6c5f 6578 7465  ] = initial_exte
+00021790: 6e73 696f 6e20 6f72 2030 0a20 2020 2072  nsion or 0.    r
+000217a0: 6573 756c 745b 2772 6576 6973 696f 6e5f  esult['revision_
+000217b0: 6578 7465 6e73 696f 6e27 5d20 3d20 7265  extension'] = re
+000217c0: 7669 7369 6f6e 5f65 7874 656e 7369 6f6e  vision_extension
+000217d0: 206f 7220 300a 0a20 2020 2023 2047 6574   or 0..    # Get
+000217e0: 2063 7572 7265 6e74 2074 696d 653a 0a20   current time:. 
+000217f0: 2020 2069 6620 2250 4155 5345 5f41 5422     if "PAUSE_AT"
+00021800: 2069 6e20 7461 736b 5f69 6e66 6f20 616e   in task_info an
+00021810: 6420 7461 736b 5f69 6e66 6f5b 2250 4155  d task_info["PAU
+00021820: 5345 5f41 5422 5d3a 0a20 2020 2020 2020  SE_AT"]:.       
+00021830: 206e 6f77 203d 2070 6f74 6c75 636b 2e74   now = potluck.t
+00021840: 696d 655f 7574 696c 732e 7461 736b 5f74  ime_utils.task_t
+00021850: 696d 655f 5f74 696d 6528 0a20 2020 2020  ime__time(.     
+00021860: 2020 2020 2020 2074 6173 6b5f 696e 666f         task_info
+00021870: 2c0a 2020 2020 2020 2020 2020 2020 7461  ,.            ta
+00021880: 736b 5f69 6e66 6f5b 2250 4155 5345 5f41  sk_info["PAUSE_A
+00021890: 5422 5d0a 2020 2020 2020 2020 290a 2020  T"].        ).  
+000218a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000218b0: 6e6f 7720 3d20 706f 746c 7563 6b2e 7469  now = potluck.ti
+000218c0: 6d65 5f75 7469 6c73 2e6e 6f77 2829 0a0a  me_utils.now()..
+000218d0: 2020 2020 2320 4765 7420 7265 6c65 6173      # Get releas
+000218e0: 6520 6461 7465 2f74 696d 653a 0a20 2020  e date/time:.   
+000218f0: 2072 656c 6561 7365 5f61 7420 3d20 7073   release_at = ps
+00021900: 6574 5f6f 626a 2e67 6574 2822 7265 6c65  et_obj.get("rele
+00021910: 6173 6522 2c20 4e6f 6e65 2920 2320 6966  ase", None) # if
+00021920: 204e 6f6e 652c 2077 6520 6173 7375 6d65   None, we assume
+00021930: 2072 656c 6561 7365 0a20 2020 2069 6620   release.    if 
+00021940: 7265 6c65 6173 655f 6174 2069 7320 6e6f  release_at is no
+00021950: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00021960: 7265 6c65 6173 655f 6174 203d 2070 6f74  release_at = pot
+00021970: 6c75 636b 2e74 696d 655f 7574 696c 732e  luck.time_utils.
+00021980: 7461 736b 5f74 696d 655f 5f74 696d 6528  task_time__time(
+00021990: 0a20 2020 2020 2020 2020 2020 2074 6173  .            tas
+000219a0: 6b5f 696e 666f 2c0a 2020 2020 2020 2020  k_info,.        
+000219b0: 2020 2020 7265 6c65 6173 655f 6174 2c0a      release_at,.
+000219c0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+000219d0: 756c 745f 7469 6d65 5f6f 665f 6461 793d  ult_time_of_day=
+000219e0: 7461 736b 5f69 6e66 6f2e 6765 7428 0a20  task_info.get(. 
+000219f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00021a00: 6465 6661 756c 745f 7265 6c65 6173 655f  default_release_
+00021a10: 7469 6d65 5f6f 665f 6461 7922 2c0a 2020  time_of_day",.  
+00021a20: 2020 2020 2020 2020 2020 2020 2020 2232                "2
+00021a30: 333a 3539 220a 2020 2020 2020 2020 2020  3:59".          
+00021a40: 2020 290a 2020 2020 2020 2020 290a 2020    ).        ).  
+00021a50: 2020 2020 2020 2320 4669 6c6c 2069 6e20        # Fill in 
+00021a60: 7265 6c65 6173 6520 696e 666f 0a20 2020  release info.   
+00021a70: 2020 2020 2072 6573 756c 745b 2772 656c       result['rel
+00021a80: 6561 7365 275d 5b27 6174 275d 203d 2072  ease']['at'] = r
+00021a90: 656c 6561 7365 5f61 740a 2020 2020 2020  elease_at.      
+00021aa0: 2020 7265 7375 6c74 5b27 7265 6c65 6173    result['releas
+00021ab0: 6527 5d5b 2761 745f 7374 7227 5d20 3d20  e']['at_str'] = 
+00021ac0: 706f 746c 7563 6b2e 7469 6d65 5f75 7469  potluck.time_uti
+00021ad0: 6c73 2e66 6d74 5f64 6174 6574 696d 6528  ls.fmt_datetime(
+00021ae0: 0a20 2020 2020 2020 2020 2020 2072 656c  .            rel
+00021af0: 6561 7365 5f61 740a 2020 2020 2020 2020  ease_at.        
+00021b00: 290a 2020 2020 2020 2020 756e 7469 6c5f  ).        until_
+00021b10: 7265 6c65 6173 6520 3d20 7265 6c65 6173  release = releas
+00021b20: 655f 6174 202d 206e 6f77 0a20 2020 2020  e_at - now.     
+00021b30: 2020 2072 6573 756c 745b 2772 656c 6561     result['relea
+00021b40: 7365 275d 5b27 756e 7469 6c27 5d20 3d20  se']['until'] = 
+00021b50: 756e 7469 6c5f 7265 6c65 6173 650a 2020  until_release.  
+00021b60: 2020 2020 2020 7265 7375 6c74 5b27 7265        result['re
+00021b70: 6c65 6173 6527 5d5b 2775 6e74 696c 5f73  lease']['until_s
+00021b80: 7472 275d 203d 2066 757a 7a79 5f74 696d  tr'] = fuzzy_tim
+00021b90: 6528 0a20 2020 2020 2020 2020 2020 2075  e(.            u
+00021ba0: 6e74 696c 5f72 656c 6561 7365 2e74 6f74  ntil_release.tot
+00021bb0: 616c 5f73 6563 6f6e 6473 2829 0a20 2020  al_seconds().   
+00021bc0: 2020 2020 2029 0a0a 2020 2020 2320 4765       )..    # Ge
+00021bd0: 7420 6475 6520 6461 7465 2f74 696d 653a  t due date/time:
+00021be0: 0a20 2020 2064 7565 5f61 7420 3d20 7073  .    due_at = ps
+00021bf0: 6574 5f6f 626a 2e67 6574 2822 6475 6522  et_obj.get("due"
+00021c00: 2c20 4e6f 6e65 290a 2020 2020 6966 2064  , None).    if d
+00021c10: 7565 5f61 7420 6973 204e 6f6e 653a 0a20  ue_at is None:. 
+00021c20: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
+00021c30: 656d 7074 7920 7265 7375 6c74 0a20 2020  empty result.   
+00021c40: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+00021c50: 6c74 0a20 2020 2065 6c73 653a 0a20 2020  lt.    else:.   
+00021c60: 2020 2020 2064 7565 5f61 7420 3d20 706f       due_at = po
+00021c70: 746c 7563 6b2e 7469 6d65 5f75 7469 6c73  tluck.time_utils
+00021c80: 2e74 6173 6b5f 7469 6d65 5f5f 7469 6d65  .task_time__time
+00021c90: 280a 2020 2020 2020 2020 2020 2020 7461  (.            ta
+00021ca0: 736b 5f69 6e66 6f2c 0a20 2020 2020 2020  sk_info,.       
+00021cb0: 2020 2020 2064 7565 5f61 742c 0a20 2020       due_at,.   
+00021cc0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00021cd0: 5f74 696d 655f 6f66 5f64 6179 3d74 6173  _time_of_day=tas
+00021ce0: 6b5f 696e 666f 2e67 6574 280a 2020 2020  k_info.get(.    
+00021cf0: 2020 2020 2020 2020 2020 2020 2264 6566              "def
+00021d00: 6175 6c74 5f64 7565 5f74 696d 655f 6f66  ault_due_time_of
+00021d10: 5f64 6179 222c 0a20 2020 2020 2020 2020  _day",.         
+00021d20: 2020 2020 2020 2022 3233 3a35 3922 0a20         "23:59". 
+00021d30: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00021d40: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+00021d50: 6576 6965 775f 656e 6420 3d20 6475 655f  eview_end = due_
+00021d60: 6174 202b 2064 6174 6574 696d 652e 7469  at + datetime.ti
+00021d70: 6d65 6465 6c74 6128 686f 7572 733d 7265  medelta(hours=re
+00021d80: 7669 6577 5f68 6f75 7273 290a 0a20 2020  view_hours)..   
+00021d90: 2064 7565 5f73 7472 696e 6720 3d20 706f   due_string = po
+00021da0: 746c 7563 6b2e 7469 6d65 5f75 7469 6c73  tluck.time_utils
+00021db0: 2e66 6d74 5f64 6174 6574 696d 6528 6475  .fmt_datetime(du
+00021dc0: 655f 6174 290a 0a20 2020 2062 6173 655f  e_at)..    base_
+00021dd0: 6465 6164 6c69 6e65 203d 2064 7565 5f61  deadline = due_a
+00021de0: 740a 0a20 2020 2023 2041 6464 2065 7874  t..    # Add ext
+00021df0: 656e 7369 6f6e 2068 6f75 7273 3a0a 2020  ension hours:.  
+00021e00: 2020 6966 2069 6e69 7469 616c 5f65 7874    if initial_ext
+00021e10: 656e 7369 6f6e 203e 2030 3a0a 2020 2020  ension > 0:.    
+00021e20: 2020 2020 6475 655f 6174 202b 3d20 6461      due_at += da
+00021e30: 7465 7469 6d65 2e74 696d 6564 656c 7461  tetime.timedelta
+00021e40: 2868 6f75 7273 3d69 6e69 7469 616c 5f65  (hours=initial_e
+00021e50: 7874 656e 7369 6f6e 290a 2020 2020 2020  xtension).      
+00021e60: 2020 6475 655f 7374 7269 6e67 203d 2070    due_string = p
+00021e70: 6f74 6c75 636b 2e74 696d 655f 7574 696c  otluck.time_util
+00021e80: 732e 666d 745f 6461 7465 7469 6d65 2864  s.fmt_datetime(d
+00021e90: 7565 5f61 7429 202b 2028 0a20 2020 2020  ue_at) + (.     
+00021ea0: 2020 2020 2020 2027 203c 7370 616e 2063         ' <span c
+00021eb0: 6c61 7373 3d22 6578 7465 6e73 696f 6e5f  lass="extension_
+00021ec0: 7461 6b65 6e22 3e27 0a20 2020 2020 2020  taken">'.       
+00021ed0: 2020 202b 2027 2861 6674 6572 2061 6363     + '(after acc
+00021ee0: 6f75 6e74 696e 6720 666f 7220 796f 7572  ounting for your
+00021ef0: 207b 7de2 8091 686f 7572 2065 7874 656e   {}...hour exten
+00021f00: 7369 6f6e 2927 0a20 2020 2020 2020 2020  sion)'.         
+00021f10: 202b 2027 3c2f 7370 616e 3e27 0a20 2020   + '</span>'.   
+00021f20: 2020 2020 2029 2e66 6f72 6d61 7428 696e       ).format(in
+00021f30: 6974 6961 6c5f 6578 7465 6e73 696f 6e29  itial_extension)
+00021f40: 0a0a 2020 2020 6772 6163 655f 6465 6164  ..    grace_dead
+00021f50: 6c69 6e65 203d 2064 7565 5f61 7420 2b20  line = due_at + 
+00021f60: 6461 7465 7469 6d65 2e74 696d 6564 656c  datetime.timedel
+00021f70: 7461 286d 696e 7574 6573 3d67 7261 6365  ta(minutes=grace
+00021f80: 5f6d 696e 7329 0a0a 2020 2020 2320 4669  _mins)..    # Fi
+00021f90: 6c6c 2069 6e20 6475 6520 696e 666f 0a20  ll in due info. 
+00021fa0: 2020 2072 6573 756c 745b 2764 7565 275d     result['due']
+00021fb0: 5b27 6174 275d 203d 2064 7565 5f61 740a  ['at'] = due_at.
+00021fc0: 2020 2020 7265 7375 6c74 5b27 6475 6527      result['due'
+00021fd0: 5d5b 2761 745f 7374 7227 5d20 3d20 6475  ]['at_str'] = du
+00021fe0: 655f 7374 7269 6e67 0a20 2020 2075 6e74  e_string.    unt
+00021ff0: 696c 5f64 7565 203d 2064 7565 5f61 7420  il_due = due_at 
+00022000: 2d20 6e6f 770a 2020 2020 7265 7375 6c74  - now.    result
+00022010: 5b27 6475 6527 5d5b 2775 6e74 696c 275d  ['due']['until']
+00022020: 203d 2075 6e74 696c 5f64 7565 0a20 2020   = until_due.   
+00022030: 2072 6573 756c 745b 2764 7565 275d 5b27   result['due']['
+00022040: 756e 7469 6c5f 7374 7227 5d20 3d20 6675  until_str'] = fu
+00022050: 7a7a 795f 7469 6d65 2875 6e74 696c 5f64  zzy_time(until_d
+00022060: 7565 2e74 6f74 616c 5f73 6563 6f6e 6473  ue.total_seconds
+00022070: 2829 290a 0a20 2020 2023 2046 696c 6c20  ())..    # Fill 
+00022080: 696e 2072 6576 6965 7720 696e 666f 0a20  in review info. 
+00022090: 2020 2072 6573 756c 745b 2772 6576 6965     result['revie
+000220a0: 7765 6427 5d5b 2761 7427 5d20 3d20 7265  wed']['at'] = re
+000220b0: 7669 6577 5f65 6e64 0a20 2020 2072 6573  view_end.    res
+000220c0: 756c 745b 2772 6576 6965 7765 6427 5d5b  ult['reviewed'][
+000220d0: 2761 745f 7374 7227 5d20 3d20 706f 746c  'at_str'] = potl
+000220e0: 7563 6b2e 7469 6d65 5f75 7469 6c73 2e66  uck.time_utils.f
+000220f0: 6d74 5f64 6174 6574 696d 6528 0a20 2020  mt_datetime(.   
+00022100: 2020 2020 2072 6576 6965 775f 656e 640a       review_end.
+00022110: 2020 2020 290a 2020 2020 756e 7469 6c5f      ).    until_
+00022120: 7265 7669 6577 6564 203d 2072 6576 6965  reviewed = revie
+00022130: 775f 656e 6420 2d20 6e6f 770a 2020 2020  w_end - now.    
+00022140: 7265 7375 6c74 5b27 7265 7669 6577 6564  result['reviewed
+00022150: 275d 5b27 756e 7469 6c27 5d20 3d20 756e  ']['until'] = un
+00022160: 7469 6c5f 7265 7669 6577 6564 0a20 2020  til_reviewed.   
+00022170: 2072 6573 756c 745b 2772 6576 6965 7765   result['reviewe
+00022180: 6427 5d5b 2775 6e74 696c 5f73 7472 275d  d']['until_str']
+00022190: 203d 2066 757a 7a79 5f74 696d 6528 0a20   = fuzzy_time(. 
+000221a0: 2020 2020 2020 2075 6e74 696c 5f72 6576         until_rev
+000221b0: 6965 7765 642e 746f 7461 6c5f 7365 636f  iewed.total_seco
+000221c0: 6e64 7328 290a 2020 2020 290a 0a20 2020  nds().    )..   
+000221d0: 2023 2047 6574 2066 696e 616c 2064 6174   # Get final dat
+000221e0: 652f 7469 6d65 3a0a 2020 2020 2320 4e6f  e/time:.    # No
+000221f0: 7465 3a20 616e 7920 6578 7465 6e73 696f  te: any extensio
+00022200: 6e20 746f 2074 6865 2069 6e69 7469 616c  n to the initial
+00022210: 2064 6561 646c 696e 6520 6973 2069 676e   deadline is ign
+00022220: 6f72 6564 2e20 4120 7365 7061 7261 7465  ored. A separate
+00022230: 0a20 2020 2023 2072 6576 6973 696f 6e20  .    # revision 
+00022240: 6578 7465 6e73 696f 6e20 7368 6f75 6c64  extension should
+00022250: 2062 6520 6973 7375 6564 2077 6865 6e20   be issued when 
+00022260: 616e 2069 6e69 7469 616c 2065 7874 656e  an initial exten
+00022270: 7369 6f6e 2065 6174 730a 2020 2020 2320  sion eats.    # 
+00022280: 7570 2074 6f6f 206d 7563 6820 6f66 2074  up too much of t
+00022290: 6865 2072 6576 6973 696f 6e20 7065 7269  he revision peri
+000222a0: 6f64 2e0a 2020 2020 6669 6e61 6c5f 6174  od..    final_at
+000222b0: 203d 2062 6173 655f 6465 6164 6c69 6e65   = base_deadline
+000222c0: 202b 2064 6174 6574 696d 652e 7469 6d65   + datetime.time
+000222d0: 6465 6c74 6128 0a20 2020 2020 2020 2068  delta(.        h
+000222e0: 6f75 7273 3d72 6576 6965 775f 686f 7572  ours=review_hour
+000222f0: 7320 2b20 7265 7669 7369 6f6e 5f68 6f75  s + revision_hou
+00022300: 7273 0a20 2020 2029 0a0a 2020 2020 6669  rs.    )..    fi
+00022310: 6e61 6c5f 7374 7269 6e67 203d 2070 6f74  nal_string = pot
+00022320: 6c75 636b 2e74 696d 655f 7574 696c 732e  luck.time_utils.
+00022330: 666d 745f 6461 7465 7469 6d65 2866 696e  fmt_datetime(fin
+00022340: 616c 5f61 7429 0a0a 2020 2020 2320 4164  al_at)..    # Ad
+00022350: 6420 6578 7465 6e73 696f 6e20 686f 7572  d extension hour
+00022360: 733a 0a20 2020 2069 6620 7265 7669 7369  s:.    if revisi
+00022370: 6f6e 5f65 7874 656e 7369 6f6e 203e 2030  on_extension > 0
+00022380: 3a0a 2020 2020 2020 2020 6669 6e61 6c5f  :.        final_
+00022390: 6174 202b 3d20 6461 7465 7469 6d65 2e74  at += datetime.t
+000223a0: 696d 6564 656c 7461 2868 6f75 7273 3d72  imedelta(hours=r
+000223b0: 6576 6973 696f 6e5f 6578 7465 6e73 696f  evision_extensio
+000223c0: 6e29 0a20 2020 2020 2020 2066 696e 616c  n).        final
+000223d0: 5f73 7472 696e 6720 3d20 706f 746c 7563  _string = potluc
+000223e0: 6b2e 7469 6d65 5f75 7469 6c73 2e66 6d74  k.time_utils.fmt
+000223f0: 5f64 6174 6574 696d 6528 6669 6e61 6c5f  _datetime(final_
+00022400: 6174 2920 2b20 280a 2020 2020 2020 2020  at) + (.        
+00022410: 2020 2020 2720 3c73 7061 6e20 636c 6173      ' <span clas
+00022420: 733d 2265 7874 656e 7369 6f6e 5f74 616b  s="extension_tak
+00022430: 656e 223e 270a 2020 2020 2020 2020 2020  en">'.          
+00022440: 2b20 2728 6166 7465 7220 6163 636f 756e  + '(after accoun
+00022450: 7469 6e67 2066 6f72 2079 6f75 7220 7b7d  ting for your {}
+00022460: e280 9168 6f75 7220 6578 7465 6e73 696f  ...hour extensio
+00022470: 6e29 270a 2020 2020 2020 2020 2020 2b20  n)'.          + 
+00022480: 273c 2f73 7061 6e3e 270a 2020 2020 2020  '</span>'.      
+00022490: 2020 292e 666f 726d 6174 2872 6576 6973    ).format(revis
+000224a0: 696f 6e5f 6578 7465 6e73 696f 6e29 0a0a  ion_extension)..
+000224b0: 2020 2020 6772 6163 655f 6669 6e61 6c20      grace_final 
+000224c0: 3d20 6669 6e61 6c5f 6174 202b 2064 6174  = final_at + dat
+000224d0: 6574 696d 652e 7469 6d65 6465 6c74 6128  etime.timedelta(
+000224e0: 6d69 6e75 7465 733d 6772 6163 655f 6d69  minutes=grace_mi
+000224f0: 6e73 290a 0a20 2020 2023 2046 696c 6c20  ns)..    # Fill 
+00022500: 696e 2066 696e 616c 697a 6174 696f 6e20  in finalization 
+00022510: 696e 666f 0a20 2020 2072 6573 756c 745b  info.    result[
+00022520: 2766 696e 616c 697a 6564 275d 5b27 6174  'finalized']['at
+00022530: 275d 203d 2066 696e 616c 5f61 740a 2020  '] = final_at.  
+00022540: 2020 7265 7375 6c74 5b27 6669 6e61 6c69    result['finali
+00022550: 7a65 6427 5d5b 2761 745f 7374 7227 5d20  zed']['at_str'] 
+00022560: 3d20 6669 6e61 6c5f 7374 7269 6e67 0a20  = final_string. 
+00022570: 2020 2075 6e74 696c 5f66 696e 616c 203d     until_final =
+00022580: 2066 696e 616c 5f61 7420 2d20 6e6f 770a   final_at - now.
+00022590: 2020 2020 7265 7375 6c74 5b27 6669 6e61      result['fina
+000225a0: 6c69 7a65 6427 5d5b 2775 6e74 696c 275d  lized']['until']
+000225b0: 203d 2075 6e74 696c 5f66 696e 616c 0a20   = until_final. 
+000225c0: 2020 2072 6573 756c 745b 2766 696e 616c     result['final
+000225d0: 697a 6564 275d 5b27 756e 7469 6c5f 7374  ized']['until_st
+000225e0: 7227 5d20 3d20 6675 7a7a 795f 7469 6d65  r'] = fuzzy_time
+000225f0: 2875 6e74 696c 5f66 696e 616c 2e74 6f74  (until_final.tot
+00022600: 616c 5f73 6563 6f6e 6473 2829 290a 0a20  al_seconds()).. 
+00022610: 2020 2023 2043 6865 636b 2072 656c 6561     # Check relea
+00022620: 7365 2074 696d 653a 0a20 2020 2069 6620  se time:.    if 
+00022630: 7265 6c65 6173 655f 6174 2061 6e64 206e  release_at and n
+00022640: 6f77 203c 2072 656c 6561 7365 5f61 743a  ow < release_at:
+00022650: 0a20 2020 2020 2020 2072 6573 756c 745b  .        result[
+00022660: 2773 7461 7465 275d 203d 2022 756e 7265  'state'] = "unre
+00022670: 6c65 6173 6564 220a 2020 2020 2320 5061  leased".    # Pa
+00022680: 7373 6564 2072 656c 6561 7365 5f61 7420  ssed release_at 
+00022690: 706f 696e 743a 2063 6865 636b 2069 6620  point: check if 
+000226a0: 6974 2773 2064 7565 206f 7220 6e6f 740a  it's due or not.
+000226b0: 2020 2020 656c 6966 206e 6f77 203c 2067      elif now < g
+000226c0: 7261 6365 5f64 6561 646c 696e 653a 0a20  race_deadline:. 
+000226d0: 2020 2020 2020 2023 204e 6f74 6520 7469         # Note ti
+000226e0: 6d65 2d72 656d 6169 6e69 6e67 2069 676e  me-remaining ign
+000226f0: 6f72 6573 2067 7261 6365 2070 6572 696f  ores grace perio
+00022700: 6420 616e 6420 6d61 7920 6265 206e 6567  d and may be neg
+00022710: 6174 6976 650a 2020 2020 2020 2020 7265  ative.        re
+00022720: 7375 6c74 5b27 7374 6174 6527 5d20 3d20  sult['state'] = 
+00022730: 2272 656c 6561 7365 6422 0a20 2020 2023  "released".    #
+00022740: 2050 6173 7365 6420 6475 655f 6174 2070   Passed due_at p
+00022750: 6f69 6e74 3b20 6368 6563 6b20 6966 2069  oint; check if i
+00022760: 7427 7320 7374 696c 6c20 756e 6465 7220  t's still under 
+00022770: 7265 7669 6577 3a0a 2020 2020 656c 6966  review:.    elif
+00022780: 206e 6f77 203c 2072 6576 6965 775f 656e   now < review_en
+00022790: 643a 0a20 2020 2020 2020 2072 6573 756c  d:.        resul
+000227a0: 745b 2773 7461 7465 275d 203d 2022 756e  t['state'] = "un
+000227b0: 6465 725f 7265 7669 6577 220a 2020 2020  der_review".    
+000227c0: 2320 5061 7373 6564 2072 6576 6965 7720  # Passed review 
+000227d0: 7065 7269 6f64 3a20 6172 6520 7265 7669  period: are revi
+000227e0: 7369 6f6e 7320 7374 696c 6c20 6265 696e  sions still bein
+000227f0: 6720 6163 6365 7074 6564 3f0a 2020 2020  g accepted?.    
+00022800: 656c 6966 206e 6f77 203c 2067 7261 6365  elif now < grace
+00022810: 5f66 696e 616c 3a0a 2020 2020 2020 2020  _final:.        
+00022820: 7265 7375 6c74 5b27 7374 6174 6527 5d20  result['state'] 
+00022830: 3d20 2272 6576 6973 6162 6c65 220a 2020  = "revisable".  
+00022840: 2020 2320 5061 7373 6564 2072 6576 6965    # Passed revie
+00022850: 7720 7065 7269 6f64 3a20 6974 2773 2066  w period: it's f
+00022860: 696e 616c 0a20 2020 2065 6c73 653a 0a20  inal.    else:. 
+00022870: 2020 2020 2020 2072 6573 756c 745b 2773         result['s
+00022880: 7461 7465 275d 203d 2022 6669 6e61 6c22  tate'] = "final"
+00022890: 0a0a 2020 2020 7265 7475 726e 2072 6573  ..    return res
+000228a0: 756c 740a 0a0a 232d 2d2d 2d2d 2d2d 2d2d  ult...#---------
+000228b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d23 0a23 2046  -----------#.# F
+000228c0: 696c 656e 616d 6520 6675 6e63 7469 6f6e  ilename function
+000228d0: 7320 230a 232d 2d2d 2d2d 2d2d 2d2d 2d2d  s #.#-----------
+000228e0: 2d2d 2d2d 2d2d 2d2d 2d23 0a0a 6465 6620  ---------#..def 
+000228f0: 6765 745f 7375 626d 6973 7369 6f6e 5f66  get_submission_f
+00022900: 696c 656e 616d 6528 0a20 2020 2063 6f75  ilename(.    cou
+00022910: 7273 652c 0a20 2020 2073 656d 6573 7465  rse,.    semeste
+00022920: 722c 0a20 2020 2074 6173 6b5f 696e 666f  r,.    task_info
+00022930: 2c0a 2020 2020 7573 6572 6e61 6d65 2c0a  ,.    username,.
+00022940: 2020 2020 7068 6173 652c 0a20 2020 2070      phase,.    p
+00022950: 7369 642c 0a20 2020 2074 6173 6b69 640a  sid,.    taskid.
+00022960: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
+00022970: 6574 7572 6e73 2074 6865 2066 696c 656e  eturns the filen
+00022980: 616d 6520 666f 7220 7468 6520 7573 6572  ame for the user
+00022990: 2773 2073 7562 6d69 7373 696f 6e20 666f  's submission fo
+000229a0: 7220 6120 6769 7665 6e0a 2020 2020 7068  r a given.    ph
+000229b0: 6173 652f 7073 6574 2f74 6173 6b2e 2052  ase/pset/task. R
+000229c0: 6169 7365 7320 6120 5661 6c75 6545 7272  aises a ValueErr
+000229d0: 6f72 2069 6620 7468 6520 7073 6574 206f  or if the pset o
+000229e0: 7220 7461 736b 2064 6f65 736e 2774 0a20  r task doesn't. 
+000229f0: 2020 2065 7869 742e 0a0a 2020 2020 544f     exit...    TO
+00022a00: 444f 3a20 446f 2077 6520 6a75 7374 2064  DO: Do we just d
+00022a10: 6f20 7a69 7020 6669 6c65 7320 666f 7220  o zip files for 
+00022a20: 6d75 6c74 692d 6669 6c65 2074 6173 6b73  multi-file tasks
+00022a30: 3f20 486f 7720 6973 2074 6861 740a 2020  ? How is that.  
+00022a40: 2020 6861 6e64 6c65 643f 0a20 2020 2022    handled?.    "
+00022a50: 2222 0a20 2020 2070 7320 3d20 6765 745f  "".    ps = get_
+00022a60: 7073 5f6f 626a 2874 6173 6b5f 696e 666f  ps_obj(task_info
+00022a70: 2c20 7073 6964 290a 2020 2020 7461 736b  , psid).    task
+00022a80: 203d 2067 6574 5f74 6173 6b5f 6f62 6a28   = get_task_obj(
+00022a90: 7461 736b 5f69 6e66 6f2c 2070 732c 2074  task_info, ps, t
+00022aa0: 6173 6b69 6429 0a0a 2020 2020 7265 7475  askid)..    retu
+00022ab0: 726e 2073 6166 655f 6a6f 696e 280a 2020  rn safe_join(.  
+00022ac0: 2020 2020 2020 7374 6f72 6167 652e 7375        storage.su
+00022ad0: 626d 6973 7369 6f6e 735f 666f 6c64 6572  bmissions_folder
+00022ae0: 2863 6f75 7273 652c 2073 656d 6573 7465  (course, semeste
+00022af0: 7229 2c0a 2020 2020 2020 2020 7573 6572  r),.        user
+00022b00: 6e61 6d65 2c0a 2020 2020 2020 2020 227b  name,.        "{
+00022b10: 7d5f 7b7d 5f7b 7d22 2e66 6f72 6d61 7428  }_{}_{}".format(
+00022b20: 0a20 2020 2020 2020 2020 2020 2070 7369  .            psi
+00022b30: 642c 0a20 2020 2020 2020 2020 2020 2070  d,.            p
+00022b40: 6861 7365 2c0a 2020 2020 2020 2020 2020  hase,.          
+00022b50: 2020 7461 736b 5b22 7461 7267 6574 225d    task["target"]
+00022b60: 0a20 2020 2020 2020 2029 0a20 2020 2029  .        ).    )
+00022b70: 0a0a 0a23 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ...#------------
+00022b80: 2d2d 2d23 0a23 204a 696e 6a61 2073 7570  ---#.# Jinja sup
+00022b90: 706f 7274 2023 0a23 2d2d 2d2d 2d2d 2d2d  port #.#--------
+00022ba0: 2d2d 2d2d 2d2d 2d23 0a0a 5f73 6f72 7465  -------#.._sorte
+00022bb0: 6420 3d20 736f 7274 6564 0a0a 0a40 6170  d = sorted...@ap
+00022bc0: 702e 7465 6d70 6c61 7465 5f66 696c 7465  p.template_filte
+00022bd0: 7228 290a 6465 6620 736f 7274 6564 282a  r().def sorted(*
+00022be0: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+00022bf0: 0a20 2020 2022 2222 0a20 2020 2054 7572  .    """.    Tur
+00022c00: 6e20 6275 696c 7469 6e20 736f 7274 6564  n builtin sorted
+00022c10: 2069 6e74 6f20 6120 7465 6d70 6c61 7465   into a template
+00022c20: 2066 696c 7465 722e 2e2e 0a20 2020 2022   filter....    "
+00022c30: 2222 0a20 2020 2072 6574 7572 6e20 5f73  "".    return _s
+00022c40: 6f72 7465 6428 2a61 7267 732c 202a 2a6b  orted(*args, **k
+00022c50: 7761 7267 7329 0a0a 0a40 6170 702e 7465  wargs)...@app.te
+00022c60: 6d70 6c61 7465 5f66 696c 7465 7228 290a  mplate_filter().
+00022c70: 6465 6620 6675 7a7a 795f 7469 6d65 2873  def fuzzy_time(s
+00022c80: 6563 6f6e 6473 293a 0a20 2020 2022 2222  econds):.    """
+00022c90: 0a20 2020 2054 616b 6573 2061 206e 756d  .    Takes a num
+00022ca0: 6265 7220 6f66 2073 6563 6f6e 6473 2061  ber of seconds a
+00022cb0: 6e64 2072 6574 7572 6e73 2061 2066 757a  nd returns a fuz
+00022cc0: 7a79 2074 696d 6520 7661 6c75 6520 7468  zy time value th
+00022cd0: 6174 2073 6869 6674 730a 2020 2020 756e  at shifts.    un
+00022ce0: 6974 7320 2875 7020 746f 2077 6565 6b73  its (up to weeks
+00022cf0: 2920 6465 7065 6e64 696e 6720 6f6e 2068  ) depending on h
+00022d00: 6f77 206d 616e 7920 7365 636f 6e64 7320  ow many seconds 
+00022d10: 7468 6572 6520 6172 652e 2049 676e 6f72  there are. Ignor
+00022d20: 6573 0a20 2020 2074 6865 2073 6967 6e20  es.    the sign 
+00022d30: 6f66 2074 6865 2076 616c 7565 2e0a 2020  of the value..  
+00022d40: 2020 2222 220a 2020 2020 6966 2073 6563    """.    if sec
+00022d50: 6f6e 6473 203c 2030 3a0a 2020 2020 2020  onds < 0:.      
+00022d60: 2020 7365 636f 6e64 7320 3d20 2d73 6563    seconds = -sec
+00022d70: 6f6e 6473 0a0a 2020 2020 7765 656b 7320  onds..    weeks 
+00022d80: 3d20 7365 636f 6e64 7320 2f20 4f4e 455f  = seconds / ONE_
+00022d90: 5745 454b 0a20 2020 2073 6563 6f6e 6473  WEEK.    seconds
+00022da0: 2025 3d20 4f4e 455f 5745 454b 0a20 2020   %= ONE_WEEK.   
+00022db0: 2064 6179 7320 3d20 7365 636f 6e64 7320   days = seconds 
+00022dc0: 2f20 4f4e 455f 4441 590a 2020 2020 7365  / ONE_DAY.    se
+00022dd0: 636f 6e64 7320 253d 204f 4e45 5f44 4159  conds %= ONE_DAY
+00022de0: 0a20 2020 2068 6f75 7273 203d 2073 6563  .    hours = sec
+00022df0: 6f6e 6473 202f 204f 4e45 5f48 4f55 520a  onds / ONE_HOUR.
+00022e00: 2020 2020 7365 636f 6e64 7320 253d 204f      seconds %= O
+00022e10: 4e45 5f48 4f55 520a 2020 2020 6d69 6e75  NE_HOUR.    minu
+00022e20: 7465 7320 3d20 7365 636f 6e64 7320 2f20  tes = seconds / 
+00022e30: 4f4e 455f 4d49 4e55 5445 0a20 2020 2073  ONE_MINUTE.    s
+00022e40: 6563 6f6e 6473 2025 3d20 4f4e 455f 4d49  econds %= ONE_MI
+00022e50: 4e55 5445 0a20 2020 2069 6620 696e 7428  NUTE.    if int(
+00022e60: 7765 656b 7329 203e 2031 3a0a 2020 2020  weeks) > 1:.    
+00022e70: 2020 2020 6966 2077 6565 6b73 2025 2031      if weeks % 1
+00022e80: 203e 2030 2e37 353a 0a20 2020 2020 2020   > 0.75:.       
+00022e90: 2020 2020 2072 6574 7572 6e20 2261 6c6d       return "alm
+00022ea0: 6f73 7420 7b3a 2e30 667d 2077 6565 6b73  ost {:.0f} weeks
+00022eb0: 222e 666f 726d 6174 2877 6565 6b73 202b  ".format(weeks +
+00022ec0: 2031 290a 2020 2020 2020 2020 656c 7365   1).        else
+00022ed0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00022ee0: 7475 726e 2022 7b3a 2e30 667d 2077 6565  turn "{:.0f} wee
+00022ef0: 6b73 222e 666f 726d 6174 2877 6565 6b73  ks".format(weeks
+00022f00: 290a 2020 2020 656c 6966 2069 6e74 2877  ).    elif int(w
+00022f10: 6565 6b73 2920 3d3d 2031 3a0a 2020 2020  eeks) == 1:.    
+00022f20: 2020 2020 7265 7475 726e 2022 7b3a 2e30      return "{:.0
+00022f30: 667d 2064 6179 7322 2e66 6f72 6d61 7428  f} days".format(
+00022f40: 3720 2b20 6461 7973 290a 2020 2020 656c  7 + days).    el
+00022f50: 6966 2069 6e74 2864 6179 7329 203e 2031  if int(days) > 1
+00022f60: 3a0a 2020 2020 2020 2020 6966 2064 6179  :.        if day
+00022f70: 7320 2520 3120 3e20 302e 3735 3a0a 2020  s % 1 > 0.75:.  
+00022f80: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00022f90: 2022 616c 6d6f 7374 207b 3a2e 3066 7d20   "almost {:.0f} 
+00022fa0: 6461 7973 222e 666f 726d 6174 2864 6179  days".format(day
+00022fb0: 7320 2b20 3129 0a20 2020 2020 2020 2065  s + 1).        e
+00022fc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00022fd0: 2072 6574 7572 6e20 227b 3a2e 3066 7d20   return "{:.0f} 
+00022fe0: 6461 7973 222e 666f 726d 6174 2864 6179  days".format(day
+00022ff0: 7329 0a20 2020 2065 6c69 6620 696e 7428  s).    elif int(
+00023000: 6461 7973 2920 3d3d 2031 3a0a 2020 2020  days) == 1:.    
+00023010: 2020 2020 7265 7475 726e 2022 7b3a 2e30      return "{:.0
+00023020: 667d 2068 6f75 7273 222e 666f 726d 6174  f} hours".format
+00023030: 2832 3420 2b20 686f 7572 7329 0a20 2020  (24 + hours).   
+00023040: 2065 6c69 6620 686f 7572 7320 3e20 343a   elif hours > 4:
+00023050: 0a20 2020 2020 2020 2069 6620 686f 7572  .        if hour
+00023060: 7320 2520 3120 3e20 302e 3735 3a0a 2020  s % 1 > 0.75:.  
+00023070: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00023080: 2022 616c 6d6f 7374 207b 3a2e 3066 7d20   "almost {:.0f} 
+00023090: 686f 7572 7322 2e66 6f72 6d61 7428 686f  hours".format(ho
+000230a0: 7572 7320 2b20 3129 0a20 2020 2020 2020  urs + 1).       
+000230b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000230c0: 2020 2072 6574 7572 6e20 227b 3a2e 3066     return "{:.0f
+000230d0: 7d20 686f 7572 7322 2e66 6f72 6d61 7428  } hours".format(
+000230e0: 686f 7572 7329 0a20 2020 2065 6c69 6620  hours).    elif 
+000230f0: 696e 7428 686f 7572 7329 203e 2030 3a0a  int(hours) > 0:.
+00023100: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+00023110: 7b3a 2e30 667d 6820 7b3a 2e30 667d 6d22  {:.0f}h {:.0f}m"
+00023120: 2e66 6f72 6d61 7428 686f 7572 732c 206d  .format(hours, m
+00023130: 696e 7574 6573 290a 2020 2020 656c 6966  inutes).    elif
+00023140: 206d 696e 7574 6573 203e 2033 303a 0a20   minutes > 30:. 
+00023150: 2020 2020 2020 2072 6574 7572 6e20 227b         return "{
+00023160: 3a2e 3066 7d20 6d69 6e75 7465 7322 2e66  :.0f} minutes".f
+00023170: 6f72 6d61 7428 6d69 6e75 7465 7329 0a20  ormat(minutes). 
+00023180: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00023190: 2072 6574 7572 6e20 227b 3a2e 3066 7d6d   return "{:.0f}m
+000231a0: 207b 3a2e 3066 7d73 222e 666f 726d 6174   {:.0f}s".format
+000231b0: 286d 696e 7574 6573 2c20 7365 636f 6e64  (minutes, second
+000231c0: 7329 0a0a 0a40 6170 702e 7465 6d70 6c61  s)...@app.templa
+000231d0: 7465 5f66 696c 7465 7228 290a 6465 6620  te_filter().def 
+000231e0: 7469 6d65 7374 616d 7028 7661 6c75 6529  timestamp(value)
+000231f0: 3a0a 2020 2020 2222 220a 2020 2020 4120  :.    """.    A 
+00023200: 6669 6c74 6572 2074 6f20 6469 7370 6c61  filter to displa
+00023210: 7920 6120 7469 6d65 7374 616d 702e 0a20  y a timestamp.. 
+00023220: 2020 2022 2222 0a20 2020 2064 7420 3d20     """.    dt = 
+00023230: 706f 746c 7563 6b2e 7469 6d65 5f75 7469  potluck.time_uti
+00023240: 6c73 2e74 696d 655f 6672 6f6d 5f74 696d  ls.time_from_tim
+00023250: 6573 7472 696e 6728 7661 6c75 6529 0a20  estring(value). 
+00023260: 2020 2072 6574 7572 6e20 706f 746c 7563     return potluc
+00023270: 6b2e 7469 6d65 5f75 7469 6c73 2e66 6d74  k.time_utils.fmt
+00023280: 5f64 6174 6574 696d 6528 6474 290a 0a0a  _datetime(dt)...
+00023290: 4061 7070 2e74 656d 706c 6174 655f 6669  @app.template_fi
+000232a0: 6c74 6572 2829 0a64 6566 2073 6563 6f6e  lter().def secon
+000232b0: 6473 2874 696d 6564 656c 7461 293a 0a20  ds(timedelta):. 
+000232c0: 2020 2022 2222 0a20 2020 2043 6f6e 7665     """.    Conve
+000232d0: 7274 7320 6120 7469 6d65 6465 6c74 6120  rts a timedelta 
+000232e0: 746f 2061 2066 6c6f 6174 696e 672d 706f  to a floating-po
+000232f0: 696e 7420 6e75 6d62 6572 206f 6620 7365  int number of se
+00023300: 636f 6e64 732e 0a20 2020 2022 2222 0a20  conds..    """. 
+00023310: 2020 2072 6574 7572 6e20 7469 6d65 6465     return timede
+00023320: 6c74 612e 746f 7461 6c5f 7365 636f 6e64  lta.total_second
+00023330: 7328 290a 0a0a 4061 7070 2e74 656d 706c  s()...@app.templ
+00023340: 6174 655f 6669 6c74 6572 2829 0a64 6566  ate_filter().def
+00023350: 2069 6e74 6567 6572 2876 616c 7565 293a   integer(value):
+00023360: 0a20 2020 2022 2222 0a20 2020 2041 2066  .    """.    A f
+00023370: 696c 7465 7220 746f 2064 6973 706c 6179  ilter to display
+00023380: 2061 206e 756d 6265 7220 6173 2061 6e20   a number as an 
+00023390: 696e 7465 6765 722e 0a20 2020 2022 2222  integer..    """
+000233a0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+000233b0: 6365 2876 616c 7565 2c20 2866 6c6f 6174  ce(value, (float
+000233c0: 2c20 696e 7429 293a 0a20 2020 2020 2020  , int)):.       
+000233d0: 2072 6574 7572 6e20 7374 7228 726f 756e   return str(roun
+000233e0: 6428 7661 6c75 6529 290a 2020 2020 656c  d(value)).    el
+000233f0: 7365 3a0a 2020 2020 2020 2020 7265 7475  se:.        retu
+00023400: 726e 2073 7472 2876 616c 7565 290a 0a0a  rn str(value)...
+00023410: 6170 702e 6164 645f 7465 6d70 6c61 7465  app.add_template
+00023420: 5f67 6c6f 6261 6c28 6d69 6e2c 206e 616d  _global(min, nam
+00023430: 653d 276d 696e 2729 0a61 7070 2e61 6464  e='min').app.add
+00023440: 5f74 656d 706c 6174 655f 676c 6f62 616c  _template_global
+00023450: 286d 6178 2c20 6e61 6d65 3d27 6d61 7827  (max, name='max'
+00023460: 290a 6170 702e 6164 645f 7465 6d70 6c61  ).app.add_templa
+00023470: 7465 5f67 6c6f 6261 6c28 726f 756e 642c  te_global(round,
+00023480: 206e 616d 653d 2772 6f75 6e64 2729 0a61   name='round').a
+00023490: 7070 2e61 6464 5f74 656d 706c 6174 655f  pp.add_template_
+000234a0: 676c 6f62 616c 2873 756d 2c20 6e61 6d65  global(sum, name
+000234b0: 3d27 7375 6d27 290a 6170 702e 6164 645f  ='sum').app.add_
+000234c0: 7465 6d70 6c61 7465 5f67 6c6f 6261 6c28  template_global(
+000234d0: 656e 756d 6572 6174 652c 206e 616d 653d  enumerate, name=
+000234e0: 2765 6e75 6d65 7261 7465 2729 0a61 7070  'enumerate').app
+000234f0: 2e61 6464 5f74 656d 706c 6174 655f 676c  .add_template_gl
+00023500: 6f62 616c 2870 6f74 6c75 636b 2e74 696d  obal(potluck.tim
+00023510: 655f 7574 696c 732e 6e6f 772c 206e 616d  e_utils.now, nam
+00023520: 653d 276e 6f77 2729 0a0a 2320 4375 7374  e='now')..# Cust
+00023530: 6f6d 2066 696c 656e 616d 652d 3e73 6c75  om filename->slu
+00023540: 6720 6669 6c74 6572 2066 726f 6d20 706f  g filter from po
+00023550: 746c 7563 6b0a 6170 702e 7465 6d70 6c61  tluck.app.templa
+00023560: 7465 5f66 696c 7465 7228 2928 706f 746c  te_filter()(potl
+00023570: 7563 6b2e 6874 6d6c 5f74 6f6f 6c73 2e66  uck.html_tools.f
+00023580: 696c 6573 6c75 6729 0a0a 2320 5469 6d65  ileslug)..# Time
+00023590: 2066 696c 7465 7273 2066 726f 6d20 706f   filters from po
+000235a0: 746c 7563 6b0a 6170 702e 7465 6d70 6c61  tluck.app.templa
+000235b0: 7465 5f66 696c 7465 7228 2928 706f 746c  te_filter()(potl
+000235c0: 7563 6b2e 7469 6d65 5f75 7469 6c73 2e66  uck.time_utils.f
+000235d0: 6d74 5f64 6174 6574 696d 6529 0a0a 0a40  mt_datetime)...@
+000235e0: 6170 702e 7465 6d70 6c61 7465 5f66 696c  app.template_fil
+000235f0: 7465 7228 290a 6465 6620 615f 616e 2868  ter().def a_an(h
+00023600: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
+00023610: 6574 7572 6e73 2074 6865 2073 7472 696e  eturns the strin
+00023620: 6720 2761 2720 6f72 2027 616e 2720 7768  g 'a' or 'an' wh
+00023630: 6572 6520 7468 6520 7573 6520 6f66 2027  ere the use of '
+00023640: 612f 616e 2720 6465 7065 6e64 7320 6f6e  a/an' depends on
+00023650: 2074 6865 0a20 2020 2066 6972 7374 206c   the.    first l
+00023660: 6574 7465 7220 6f66 2074 6865 206e 616d  etter of the nam
+00023670: 6520 6f66 2074 6865 2066 6972 7374 2064  e of the first d
+00023680: 6967 6974 206f 6620 7468 6520 6769 7665  igit of the give
+00023690: 6e20 6e75 6d62 6572 2c20 6f72 0a20 2020  n number, or.   
+000236a0: 2074 6865 2066 6972 7374 206c 6574 7465   the first lette
+000236b0: 7220 6f66 2074 6865 2067 6976 656e 2073  r of the given s
+000236c0: 7472 696e 672e 0a0a 2020 2020 4361 6e27  tring...    Can'
+000236d0: 7420 6861 6e64 6c65 2065 7665 7279 7468  t handle everyth
+000236e0: 696e 6720 6265 6361 7573 6520 6974 2064  ing because it d
+000236f0: 6f65 736e 2774 206b 6e6f 7720 7068 6f6e  oesn't know phon
+00023700: 6574 6963 7320 2865 2e67 2e2c 2027 610a  etics (e.g., 'a.
+00023710: 2020 2020 686f 7572 2720 6e6f 7420 2761      hour' not 'a
+00023720: 6e20 686f 7572 2720 6265 6361 7573 6520  n hour' because 
+00023730: 2768 2720 6973 206e 6f74 2061 2076 6f77  'h' is not a vow
+00023740: 656c 292e 0a20 2020 2022 2222 0a20 2020  el)..    """.   
+00023750: 2064 6967 6974 7320 3d20 7374 7228 6829   digits = str(h)
+00023760: 0a20 2020 2066 6420 3d20 6469 6769 7473  .    fd = digits
+00023770: 5b30 5d0a 2020 2020 6966 2066 6420 696e  [0].    if fd in
+00023780: 2022 3138 6165 696f 7522 3a0a 2020 2020   "18aeiou":.    
+00023790: 2020 2020 7265 7475 726e 2027 616e 270a      return 'an'.
+000237a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000237b0: 2020 7265 7475 726e 2027 6127 0a0a 0a40    return 'a'...@
+000237c0: 6170 702e 7465 6d70 6c61 7465 5f66 696c  app.template_fil
+000237d0: 7465 7228 290a 6465 6620 7073 6574 5f63  ter().def pset_c
+000237e0: 6f6d 6269 6e65 645f 6772 6164 6528 7073  ombined_grade(ps
+000237f0: 6574 293a 0a20 2020 2022 2222 0a20 2020  et):.    """.   
+00023800: 2045 7874 7261 6374 7320 6120 6675 6c6c   Extracts a full
+00023810: 2063 6f6d 6269 6e65 6420 6772 6164 6520   combined grade 
+00023820: 7661 6c75 6520 6672 6f6d 2061 2070 7365  value from a pse
+00023830: 7420 6f62 6a65 6374 2e20 5265 7370 6563  t object. Respec
+00023840: 7473 0a20 2020 2074 6173 6b20 7765 6967  ts.    task weig
+00023850: 6874 733b 2066 696c 6c73 2069 6e20 7a65  hts; fills in ze
+00023860: 726f 6573 2066 6f72 2061 6e79 206d 6973  roes for any mis
+00023870: 7369 6e67 2067 7261 6465 732c 2061 6e64  sing grades, and
+00023880: 2067 7261 6273 2074 6865 0a20 2020 2068   grabs the.    h
+00023890: 6967 6865 7374 2073 636f 7265 2066 726f  ighest score fro
+000238a0: 6d20 6561 6368 2074 6173 6b20 706f 6f6c  m each task pool
+000238b0: 2e20 496e 636c 7564 6573 2074 696d 656c  . Includes timel
+000238c0: 696e 6573 7320 706f 696e 7473 2061 6c6f  iness points alo
+000238d0: 6e67 0a20 2020 2077 6974 6820 7461 736b  ng.    with task
+000238e0: 2067 7261 6465 732c 2072 652d 6e6f 726d   grades, re-norm
+000238f0: 616c 697a 696e 6720 746f 2062 6520 6f75  alizing to be ou
+00023900: 7420 6f66 2074 6865 2060 5343 4f52 455f  t of the `SCORE_
+00023910: 4241 5349 5360 2e0a 2020 2020 2222 220a  BASIS`..    """.
+00023920: 2020 2020 706f 6f6c 5f73 636f 7265 7320      pool_scores 
+00023930: 3d20 7b7d 0a20 2020 2066 6f72 2074 6173  = {}.    for tas
+00023940: 6b20 696e 2070 7365 745b 2274 6173 6b73  k in pset["tasks
+00023950: 225d 3a0a 2020 2020 2020 2020 2320 4765  "]:.        # Ge
+00023960: 7420 6120 6772 6164 6520 2620 7765 6967  t a grade & weig
+00023970: 6874 0a20 2020 2020 2020 2063 6720 3d20  ht.        cg = 
+00023980: 7461 736b 5f63 6f6d 6269 6e65 645f 6772  task_combined_gr
+00023990: 6164 6528 7461 736b 290a 2020 2020 2020  ade(task).      
+000239a0: 2020 7470 203d 2074 6173 6b5f 7469 6d65    tp = task_time
+000239b0: 6c69 6e65 7373 5f70 6f69 6e74 7328 7461  liness_points(ta
+000239c0: 736b 290a 2020 2020 2020 2020 7477 203d  sk).        tw =
+000239d0: 2074 6173 6b2e 6765 7428 2277 6569 6768   task.get("weigh
+000239e0: 7422 2c20 3129 0a20 2020 2020 2020 2069  t", 1).        i
+000239f0: 6620 6367 2069 7320 4e6f 6e65 3a0a 2020  f cg is None:.  
+00023a00: 2020 2020 2020 2020 2020 6367 203d 2030            cg = 0
+00023a10: 0a0a 2020 2020 2020 2020 2320 4669 6775  ..        # Figu
+00023a20: 7265 206f 7574 2074 6869 7320 7461 736b  re out this task
+00023a30: 2773 2070 6f6f 6c20 616e 6420 7570 6461  's pool and upda
+00023a40: 7465 2074 6865 2073 636f 7265 2066 6f72  te the score for
+00023a50: 2074 6861 7420 706f 6f6c 0a20 2020 2020   that pool.     
+00023a60: 2020 2070 6f6f 6c20 3d20 7461 736b 5f70     pool = task_p
+00023a70: 6f6f 6c28 7461 736b 290a 2020 2020 2020  ool(task).      
+00023a80: 2020 6966 2070 6f6f 6c20 696e 2070 6f6f    if pool in poo
+00023a90: 6c5f 7363 6f72 6573 3a0a 2020 2020 2020  l_scores:.      
+00023aa0: 2020 2020 2020 6f6c 645f 7363 6f72 652c        old_score,
+00023ab0: 206f 6c64 5f77 6569 6768 7420 3d20 706f   old_weight = po
+00023ac0: 6f6c 5f73 636f 7265 735b 706f 6f6c 5d0a  ol_scores[pool].
+00023ad0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00023ae0: 6c64 5f77 6569 6768 7420 213d 2074 773a  ld_weight != tw:
+00023af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023b00: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00023b10: 7228 2249 6e63 6f6e 7369 7374 656e 7420  r("Inconsistent 
+00023b20: 7765 6967 6874 7320 666f 7220 706f 6f6c  weights for pool
+00023b30: 6564 2074 6173 6b73 2122 290a 2020 2020  ed tasks!").    
+00023b40: 2020 2020 2020 2020 6966 206f 6c64 5f73          if old_s
+00023b50: 636f 7265 203c 2063 6720 2b20 7470 3a0a  core < cg + tp:.
+00023b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b70: 706f 6f6c 5f73 636f 7265 735b 706f 6f6c  pool_scores[pool
+00023b80: 5d20 3d20 5b63 6720 2b20 7470 2c20 7477  ] = [cg + tp, tw
+00023b90: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
+00023ba0: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+00023bb0: 5f73 636f 7265 735b 706f 6f6c 5d20 3d20  _scores[pool] = 
+00023bc0: 5b63 6720 2b20 7470 2c20 7477 5d0a 0a20  [cg + tp, tw].. 
+00023bd0: 2020 2073 636f 7265 5f62 6173 6973 203d     score_basis =
+00023be0: 2061 7070 2e63 6f6e 6669 672e 6765 7428   app.config.get(
+00023bf0: 2253 434f 5245 5f42 4153 4953 222c 2031  "SCORE_BASIS", 1
+00023c00: 3030 290a 2020 2020 6d61 785f 7363 6f72  00).    max_scor
+00023c10: 6520 3d20 7363 6f72 655f 6261 7369 7320  e = score_basis 
+00023c20: 2b20 6170 702e 636f 6e66 6967 2e67 6574  + app.config.get
+00023c30: 2822 5449 4d45 4c49 4e45 5353 5f50 4f49  ("TIMELINESS_POI
+00023c40: 4e54 5322 2c20 3029 0a20 2020 2077 6569  NTS", 0).    wei
+00023c50: 6768 7465 645f 7363 6f72 6520 3d20 7375  ghted_score = su
+00023c60: 6d28 0a20 2020 2020 2020 2028 6772 6164  m(.        (grad
+00023c70: 6520 2f20 6d61 785f 7363 6f72 6529 202a  e / max_score) *
+00023c80: 2077 6569 6768 740a 2020 2020 2020 2020   weight.        
+00023c90: 666f 7220 6772 6164 652c 2077 6569 6768  for grade, weigh
+00023ca0: 7420 696e 2070 6f6f 6c5f 7363 6f72 6573  t in pool_scores
+00023cb0: 2e76 616c 7565 7328 290a 2020 2020 290a  .values().    ).
+00023cc0: 2020 2020 746f 7461 6c5f 7765 6967 6874      total_weight
+00023cd0: 203d 2073 756d 2877 6569 6768 7420 666f   = sum(weight fo
+00023ce0: 7220 6772 6164 652c 2077 6569 6768 7420  r grade, weight 
+00023cf0: 696e 2070 6f6f 6c5f 7363 6f72 6573 2e76  in pool_scores.v
+00023d00: 616c 7565 7328 2929 0a0a 2020 2020 7265  alues())..    re
+00023d10: 7475 726e 2073 636f 7265 5f62 6173 6973  turn score_basis
+00023d20: 202a 2077 6569 6768 7465 645f 7363 6f72   * weighted_scor
+00023d30: 6520 2f20 666c 6f61 7428 746f 7461 6c5f  e / float(total_
+00023d40: 7765 6967 6874 290a 0a0a 4061 7070 2e74  weight)...@app.t
+00023d50: 656d 706c 6174 655f 6669 6c74 6572 2829  emplate_filter()
+00023d60: 0a64 6566 2075 7365 735f 706f 6f6c 7328  .def uses_pools(
+00023d70: 7073 6574 293a 0a20 2020 2022 2222 0a20  pset):.    """. 
+00023d80: 2020 2052 6574 7572 6e73 2054 7275 6520     Returns True 
+00023d90: 6966 2074 6865 2070 7365 7420 6861 7320  if the pset has 
+00023da0: 6174 206c 6561 7374 2074 776f 2074 6173  at least two tas
+00023db0: 6b73 2074 6861 7420 6172 6520 696e 2074  ks that are in t
+00023dc0: 6865 2073 616d 650a 2020 2020 706f 6f6c  he same.    pool
+00023dd0: 2c20 616e 6420 4661 6c73 6520 6f74 6865  , and False othe
+00023de0: 7277 6973 652e 0a20 2020 2022 2222 0a20  rwise..    """. 
+00023df0: 2020 2070 6f6f 6c73 203d 2073 6574 2874     pools = set(t
+00023e00: 6173 6b5f 706f 6f6c 2874 6173 6b29 2066  ask_pool(task) f
+00023e10: 6f72 2074 6173 6b20 696e 2070 7365 745b  or task in pset[
+00023e20: 2274 6173 6b73 225d 290a 2020 2020 7265  "tasks"]).    re
+00023e30: 7475 726e 206c 656e 2870 6f6f 6c73 2920  turn len(pools) 
+00023e40: 3c20 6c65 6e28 7073 6574 5b22 7461 736b  < len(pset["task
+00023e50: 7322 5d29 0a0a 0a40 6170 702e 7465 6d70  s"])...@app.temp
+00023e60: 6c61 7465 5f66 696c 7465 7228 290a 6465  late_filter().de
+00023e70: 6620 7461 736b 5f70 6f6f 6c28 7461 736b  f task_pool(task
+00023e80: 293a 0a20 2020 2022 2222 0a20 2020 2047  ):.    """.    G
+00023e90: 7261 6273 2074 6865 2070 6f6f 6c20 666f  rabs the pool fo
+00023ea0: 7220 6120 7461 736b 2c20 7768 6963 6820  r a task, which 
+00023eb0: 6465 6661 756c 7473 2074 6f20 7468 6520  defaults to the 
+00023ec0: 7461 736b 2049 442e 0a20 2020 2022 2222  task ID..    """
+00023ed0: 0a20 2020 2072 6574 7572 6e20 7461 736b  .    return task
+00023ee0: 2e67 6574 2822 706f 6f6c 222c 2074 6173  .get("pool", tas
+00023ef0: 6b5b 2269 6422 5d29 0a0a 0a40 6170 702e  k["id"])...@app.
+00023f00: 7465 6d70 6c61 7465 5f66 696c 7465 7228  template_filter(
+00023f10: 290a 6465 6620 7073 6574 5f70 6f6f 6c73  ).def pset_pools
+00023f20: 2870 7365 7429 3a0a 2020 2020 2222 220a  (pset):.    """.
+00023f30: 2020 2020 5265 7475 726e 7320 6120 6c69      Returns a li
+00023f40: 7374 206f 6620 7061 6972 732c 2065 6163  st of pairs, eac
+00023f50: 6820 636f 6e74 6169 6e69 6e67 2061 2070  h containing a p
+00023f60: 6f6f 6c20 4944 2061 6e64 2061 2063 6f6c  ool ID and a col
+00023f70: 7370 616e 0a20 2020 2069 6e74 6567 6572  span.    integer
+00023f80: 2066 6f72 2074 6861 7420 706f 6f6c 2e0a   for that pool..
+00023f90: 2020 2020 2222 220a 2020 2020 7365 656e      """.    seen
+00023fa0: 203d 2073 6574 2829 0a20 2020 2072 6573   = set().    res
+00023fb0: 756c 7420 3d20 5b5d 0a20 2020 2066 6f72  ult = [].    for
+00023fc0: 2074 6173 6b20 696e 2070 7365 745b 2274   task in pset["t
+00023fd0: 6173 6b73 225d 3a0a 2020 2020 2020 2020  asks"]:.        
+00023fe0: 706f 6f6c 203d 2074 6173 6b5f 706f 6f6c  pool = task_pool
+00023ff0: 2874 6173 6b29 0a20 2020 2020 2020 2069  (task).        i
+00024000: 6620 706f 6f6c 2069 6e20 7365 656e 3a0a  f pool in seen:.
+00024010: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00024020: 696e 7565 0a20 2020 2020 2020 2065 6c73  inue.        els
+00024030: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00024040: 6565 6e2e 6164 6428 706f 6f6c 290a 2020  een.add(pool).  
+00024050: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00024060: 2e61 7070 656e 6428 2870 6f6f 6c2c 2070  .append((pool, p
+00024070: 6f6f 6c5f 636f 6c73 7061 6e28 7073 6574  ool_colspan(pset
+00024080: 2c20 7461 736b 5b22 6964 225d 2929 290a  , task["id"]))).
+00024090: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+000240a0: 740a 0a0a 4061 7070 2e74 656d 706c 6174  t...@app.templat
+000240b0: 655f 6669 6c74 6572 2829 0a64 6566 2070  e_filter().def p
+000240c0: 6f6f 6c5f 636f 6c73 7061 6e28 7073 6574  ool_colspan(pset
+000240d0: 2c20 7461 736b 6964 293a 0a20 2020 2022  , taskid):.    "
+000240e0: 2222 0a20 2020 2052 6574 7572 6e73 2074  "".    Returns t
+000240f0: 6865 2063 6f6c 756d 6e20 7370 616e 2066  he column span f
+00024100: 6f72 2074 6865 2070 6f6f 6c20 6f66 2074  or the pool of t
+00024110: 6865 2067 6976 656e 2074 6173 6b20 696e  he given task in
+00024120: 2074 6865 2067 6976 656e 0a20 2020 2070   the given.    p
+00024130: 7365 742c 2061 7373 756d 696e 6720 7468  set, assuming th
+00024140: 6174 2074 6865 2074 6173 6b73 206f 6620  at the tasks of 
+00024150: 7468 6520 7073 6574 2061 7265 2064 6973  the pset are dis
+00024160: 706c 6179 6564 2069 6e20 6f72 6465 722e  played in order.
+00024170: 0a20 2020 2022 2222 0a20 2020 2073 7461  .    """.    sta
+00024180: 7274 5f61 7420 3d20 4e6f 6e65 0a20 2020  rt_at = None.   
+00024190: 2074 6869 735f 7461 736b 203d 204e 6f6e   this_task = Non
+000241a0: 650a 2020 2020 666f 7220 6920 696e 2072  e.    for i in r
+000241b0: 616e 6765 286c 656e 2870 7365 745b 2274  ange(len(pset["t
+000241c0: 6173 6b73 225d 2929 3a0a 2020 2020 2020  asks"])):.      
+000241d0: 2020 6966 2070 7365 745b 2274 6173 6b73    if pset["tasks
+000241e0: 225d 5b69 5d5b 2269 6422 5d20 3d3d 2074  "][i]["id"] == t
+000241f0: 6173 6b69 643a 0a20 2020 2020 2020 2020  askid:.         
+00024200: 2020 2073 7461 7274 5f61 7420 3d20 690a     start_at = i.
+00024210: 2020 2020 2020 2020 2020 2020 7468 6973              this
+00024220: 5f74 6173 6b20 3d20 7073 6574 5b22 7461  _task = pset["ta
+00024230: 736b 7322 5d5b 695d 0a20 2020 2020 2020  sks"][i].       
+00024240: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
+00024250: 6966 2073 7461 7274 5f61 7420 6973 204e  if start_at is N
+00024260: 6f6e 653a 0a20 2020 2020 2020 2072 6169  one:.        rai
+00024270: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00024280: 2020 2020 2020 2020 2020 2022 5073 6574             "Pset
+00024290: 2027 7b7d 2720 646f 6573 206e 6f74 2063   '{}' does not c
+000242a0: 6f6e 7461 696e 2061 2074 6173 6b20 277b  ontain a task '{
+000242b0: 7d27 2e22 2e66 6f72 6d61 7428 0a20 2020  }'.".format(.   
+000242c0: 2020 2020 2020 2020 2020 2020 2070 7365               pse
+000242d0: 745b 2269 6422 5d2c 0a20 2020 2020 2020  t["id"],.       
+000242e0: 2020 2020 2020 2020 2074 6173 6b69 640a           taskid.
+000242f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00024300: 2020 2020 2020 290a 0a20 2020 2074 6869        )..    thi
+00024310: 735f 706f 6f6c 203d 2074 6173 6b5f 706f  s_pool = task_po
+00024320: 6f6c 2874 6869 735f 7461 736b 290a 2020  ol(this_task).  
+00024330: 2020 7370 616e 203d 2031 0a20 2020 2066    span = 1.    f
+00024340: 6f72 2074 6173 6b20 696e 2070 7365 745b  or task in pset[
+00024350: 2274 6173 6b73 225d 5b69 202b 2031 3a5d  "tasks"][i + 1:]
+00024360: 3a0a 2020 2020 2020 2020 6966 2074 6173  :.        if tas
+00024370: 6b5f 706f 6f6c 2874 6173 6b29 203d 3d20  k_pool(task) == 
+00024380: 7468 6973 5f70 6f6f 6c3a 0a20 2020 2020  this_pool:.     
+00024390: 2020 2020 2020 2073 7061 6e20 2b3d 2031         span += 1
+000243a0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000243b0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+000243c0: 2023 2073 7061 6e20 6973 206f 7665 720a   # span is over.
+000243d0: 0a20 2020 2072 6574 7572 6e20 7370 616e  .    return span
+000243e0: 0a0a 0a40 6170 702e 7465 6d70 6c61 7465  ...@app.template
+000243f0: 5f66 696c 7465 7228 290a 6465 6620 7461  _filter().def ta
+00024400: 736b 5f63 6f6d 6269 6e65 645f 6772 6164  sk_combined_grad
+00024410: 6528 7461 736b 293a 0a20 2020 2022 2222  e(task):.    """
+00024420: 0a20 2020 2045 7874 7261 6374 7320 7468  .    Extracts th
+00024430: 6520 636f 6d62 696e 6564 2067 7261 6465  e combined grade
+00024440: 2076 616c 7565 2062 6574 7765 656e 2069   value between i
+00024450: 6e69 7469 616c 2f72 6576 6973 6564 2f62  nitial/revised/b
+00024460: 656c 6174 6564 0a20 2020 2073 7562 6d69  elated.    submi
+00024470: 7373 696f 6e73 2066 6f72 2074 6865 2067  ssions for the g
+00024480: 6976 656e 2074 6173 6b2e 2052 6574 7572  iven task. Retur
+00024490: 6e73 2061 2070 6f69 6e74 206e 756d 6265  ns a point numbe
+000244a0: 722c 206f 7220 4e6f 6e65 2069 660a 2020  r, or None if.  
+000244b0: 2020 7468 6572 6520 6973 206e 6f74 2065    there is not e
+000244c0: 6e6f 7567 6820 696e 666f 726d 6174 696f  nough informatio
+000244d0: 6e20 746f 2065 7374 6162 6c69 7368 2061  n to establish a
+000244e0: 2067 7261 6465 2e0a 0a20 2020 2054 696d   grade...    Tim
+000244f0: 656c 696e 6573 7320 706f 696e 7473 2061  eliness points a
+00024500: 7265 206e 6f74 2069 6e63 6c75 6465 6420  re not included 
+00024510: 2873 6565 2060 7461 736b 5f74 696d 656c  (see `task_timel
+00024520: 696e 6573 735f 706f 696e 7473 6029 2e0a  iness_points`)..
+00024530: 2020 2020 2222 220a 2020 2020 6261 7365      """.    base
+00024540: 5f67 7261 6465 203d 2074 6173 6b2e 6765  _grade = task.ge
+00024550: 7428 2267 7261 6465 2229 0a20 2020 206f  t("grade").    o
+00024560: 7074 696f 6e73 203d 205b 5d0a 2020 2020  ptions = [].    
+00024570: 6966 2062 6173 655f 6772 6164 6520 6973  if base_grade is
+00024580: 206e 6f74 204e 6f6e 6520 616e 6420 6261   not None and ba
+00024590: 7365 5f67 7261 6465 2021 3d20 223f 223a  se_grade != "?":
+000245a0: 0a20 2020 2020 2020 206f 7074 696f 6e73  .        options
+000245b0: 2e61 7070 656e 6428 666c 6f61 7428 6261  .append(float(ba
+000245c0: 7365 5f67 7261 6465 2929 0a0a 2020 2020  se_grade))..    
+000245d0: 7265 765f 7461 736b 203d 2074 6173 6b2e  rev_task = task.
+000245e0: 6765 7428 2272 6576 6973 696f 6e22 2c20  get("revision", 
+000245f0: 7b7d 290a 2020 2020 7265 765f 6772 6164  {}).    rev_grad
+00024600: 6520 3d20 7265 765f 7461 736b 2e67 6574  e = rev_task.get
+00024610: 2822 6772 6164 6522 290a 2020 2020 6966  ("grade").    if
+00024620: 2069 7369 6e73 7461 6e63 6528 7265 765f   isinstance(rev_
+00024630: 6772 6164 652c 2028 696e 742c 2066 6c6f  grade, (int, flo
+00024640: 6174 2929 3a0a 2020 2020 2020 2020 6f70  at)):.        op
+00024650: 7469 6f6e 732e 6170 7065 6e64 280a 2020  tions.append(.  
+00024660: 2020 2020 2020 2020 2020 6d69 6e28 0a20            min(. 
+00024670: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00024680: 6576 5f67 7261 6465 2c0a 2020 2020 2020  ev_grade,.      
+00024690: 2020 2020 2020 2020 2020 7265 765f 7461            rev_ta
+000246a0: 736b 2e67 6574 280a 2020 2020 2020 2020  sk.get(.        
+000246b0: 2020 2020 2020 2020 2020 2020 226d 6178              "max
+000246c0: 5f73 636f 7265 222c 0a20 2020 2020 2020  _score",.       
+000246d0: 2020 2020 2020 2020 2020 2020 2061 7070               app
+000246e0: 2e63 6f6e 6669 672e 6765 7428 0a20 2020  .config.get(.   
+000246f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024700: 2020 2020 2022 5245 5649 5349 4f4e 5f4d       "REVISION_M
+00024710: 4158 5f53 434f 5245 222c 0a20 2020 2020  AX_SCORE",.     
+00024720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024730: 2020 2061 7070 2e63 6f6e 6669 672e 6765     app.config.ge
+00024740: 7428 2253 434f 5245 5f42 4153 4953 222c  t("SCORE_BASIS",
+00024750: 2031 3030 290a 2020 2020 2020 2020 2020   100).          
+00024760: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00024770: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00024780: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00024790: 2020 2020 290a 0a20 2020 2062 656c 6174      )..    belat
+000247a0: 6564 5f74 6173 6b20 3d20 7461 736b 2e67  ed_task = task.g
+000247b0: 6574 2822 6265 6c61 7465 6422 2c20 7b7d  et("belated", {}
+000247c0: 290a 2020 2020 6265 6c61 7465 645f 6772  ).    belated_gr
+000247d0: 6164 6520 3d20 6265 6c61 7465 645f 7461  ade = belated_ta
+000247e0: 736b 2e67 6574 2822 6772 6164 6522 290a  sk.get("grade").
+000247f0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00024800: 6528 6265 6c61 7465 645f 6772 6164 652c  e(belated_grade,
+00024810: 2028 696e 742c 2066 6c6f 6174 2929 3a0a   (int, float)):.
+00024820: 2020 2020 2020 2020 6f70 7469 6f6e 732e          options.
+00024830: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
+00024840: 2020 2020 6d69 6e28 0a20 2020 2020 2020      min(.       
+00024850: 2020 2020 2020 2020 2062 656c 6174 6564           belated
+00024860: 5f67 7261 6465 2c0a 2020 2020 2020 2020  _grade,.        
+00024870: 2020 2020 2020 2020 6265 6c61 7465 645f          belated_
+00024880: 7461 736b 2e67 6574 280a 2020 2020 2020  task.get(.      
+00024890: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+000248a0: 6178 5f73 636f 7265 222c 0a20 2020 2020  ax_score",.     
+000248b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000248c0: 7070 2e63 6f6e 6669 672e 6765 7428 0a20  pp.config.get(. 
+000248d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000248e0: 2020 2020 2020 2022 4245 4c41 5445 445f         "BELATED_
+000248f0: 4d41 585f 5343 4f52 4522 2c0a 2020 2020  MAX_SCORE",.    
+00024900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024910: 2020 2020 6170 702e 636f 6e66 6967 2e67      app.config.g
+00024920: 6574 2822 5343 4f52 455f 4241 5349 5322  et("SCORE_BASIS"
+00024930: 2c20 3130 3029 0a20 2020 2020 2020 2020  , 100).         
+00024940: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00024950: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00024960: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00024970: 2020 2020 2029 0a0a 2020 2020 6966 206c       )..    if l
+00024980: 656e 286f 7074 696f 6e73 2920 3e20 303a  en(options) > 0:
+00024990: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000249a0: 6d61 7828 6f70 7469 6f6e 7329 0a20 2020  max(options).   
+000249b0: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
+000249c0: 6574 7572 6e20 4e6f 6e65 0a0a 0a40 6170  eturn None...@ap
+000249d0: 702e 7465 6d70 6c61 7465 5f66 696c 7465  p.template_filte
+000249e0: 7228 290a 6465 6620 7461 736b 5f74 696d  r().def task_tim
+000249f0: 656c 696e 6573 735f 706f 696e 7473 2874  eliness_points(t
+00024a00: 6173 6b29 3a0a 2020 2020 2222 220a 2020  ask):.    """.  
+00024a10: 2020 5265 7475 726e 7320 6120 6e75 6d62    Returns a numb
+00024a20: 6572 2069 6e64 6963 6174 696e 6720 686f  er indicating ho
+00024a30: 7720 6d61 6e79 2074 696d 656c 696e 6573  w many timelines
+00024a40: 7320 706f 696e 7473 2077 6572 6520 6561  s points were ea
+00024a50: 726e 6564 0a20 2020 2066 6f72 2073 7562  rned.    for sub
+00024a60: 6d69 7373 696f 6e73 2074 6f20 7468 6520  missions to the 
+00024a70: 6769 7665 6e20 7461 736b 2e20 5468 6520  given task. The 
+00024a80: 6054 494d 454c 494e 4553 535f 504f 494e  `TIMELINESS_POIN
+00024a90: 5453 6020 7661 6c75 650a 2020 2020 6465  TS` value.    de
+00024aa0: 7465 726d 696e 6573 2068 6f77 206d 616e  termines how man
+00024ab0: 7920 706f 696e 7473 2061 7265 2061 7661  y points are ava
+00024ac0: 696c 6162 6c65 2069 6e20 746f 7461 6c3b  ilable in total;
+00024ad0: 2068 616c 6620 6f66 2074 6865 7365 2061   half of these a
+00024ae0: 7265 0a20 2020 2061 7761 7264 6564 2069  re.    awarded i
+00024af0: 6620 6120 7375 626d 6973 7369 6f6e 2069  f a submission i
+00024b00: 7320 6d61 6465 2062 7920 7468 6520 696e  s made by the in
+00024b10: 6974 6961 6c20 6465 6164 6c69 6e65 2077  itial deadline w
+00024b20: 6869 6368 2065 6172 6e73 0a20 2020 2061  hich earns.    a
+00024b30: 7420 6c65 6173 7420 6054 494d 454c 494e  t least `TIMELIN
+00024b40: 4553 535f 4154 5445 4d50 545f 5448 5245  ESS_ATTEMPT_THRE
+00024b50: 5348 4f4c 4460 2070 6f69 6e74 732c 2061  SHOLD` points, a
+00024b60: 6e64 2074 6865 206f 7468 6572 2068 616c  nd the other hal
+00024b70: 660a 2020 2020 6172 6520 6561 726e 6564  f.    are earned
+00024b80: 2069 6620 6120 7375 626d 6973 7369 6f6e   if a submission
+00024b90: 2069 7320 6d61 6465 2062 7920 7468 6520   is made by the 
+00024ba0: 7265 7669 7369 6f6e 2064 6561 646c 696e  revision deadlin
+00024bb0: 6520 7768 6963 680a 2020 2020 6561 726e  e which.    earn
+00024bc0: 7320 6174 206c 6561 7374 2060 5449 4d45  s at least `TIME
+00024bd0: 4c49 4e45 5353 5f43 4f4d 504c 4554 455f  LINESS_COMPLETE_
+00024be0: 5448 5245 5348 4f4c 4460 2070 6f69 6e74  THRESHOLD` point
+00024bf0: 732e 0a0a 2020 2020 4120 6d61 6e75 616c  s...    A manual
+00024c00: 206f 7665 7272 6964 6520 6d61 7920 616c   override may al
+00024c10: 736f 2068 6176 6520 6265 656e 2070 726f  so have been pro
+00024c20: 7669 6465 642c 2061 6e64 2069 7320 7573  vided, and is us
+00024c30: 6564 2069 6620 736f 2e0a 0a20 2020 2054  ed if so...    T
+00024c40: 4f44 4f3a 2054 6869 7320 7265 616c 6c79  ODO: This really
+00024c50: 206e 6565 6473 2074 6f20 6265 2075 7067   needs to be upg
+00024c60: 7261 6465 6420 6174 2073 6f6d 6520 706f  raded at some po
+00024c70: 696e 7420 746f 2072 6573 7065 6374 2074  int to respect t
+00024c80: 6865 0a20 2020 2062 6573 7420 7375 626d  he.    best subm
+00024c90: 6973 7369 6f6e 2069 6e20 6561 6368 2070  ission in each p
+00024ca0: 6861 7365 2c20 7261 7468 6572 2074 6861  hase, rather tha
+00024cb0: 6e20 6a75 7374 2074 6865 206c 6174 6573  n just the lates
+00024cc0: 742e 2053 7475 6465 6e74 730a 2020 2020  t. Students.    
+00024cd0: 7768 6f20 6163 6369 6465 6e74 616c 6c79  who accidentally
+00024ce0: 2064 6f77 6e67 7261 6465 2074 6865 6972   downgrade their
+00024cf0: 2065 7661 6c75 6174 696f 6e20 6d61 7920   evaluation may 
+00024d00: 6c6f 7365 2074 696d 656c 696e 6573 730a  lose timeliness.
+00024d10: 2020 2020 706f 696e 7473 2074 6861 7420      points that 
+00024d20: 7468 6579 2072 6561 6c6c 7920 7368 6f75  they really shou
+00024d30: 6c64 2068 6176 6520 6561 726e 6564 210a  ld have earned!.
+00024d40: 2020 2020 2222 220a 2020 2020 6561 726e      """.    earn
+00024d50: 6564 203d 2030 0a20 2020 2061 7661 696c  ed = 0.    avail
+00024d60: 6162 6c65 203d 2061 7070 2e63 6f6e 6669  able = app.confi
+00024d70: 672e 6765 7428 2254 494d 454c 494e 4553  g.get("TIMELINES
+00024d80: 535f 504f 494e 5453 222c 2030 290a 2020  S_POINTS", 0).  
+00024d90: 2020 6174 7465 6d70 745f 706f 696e 7473    attempt_points
+00024da0: 203d 2061 7661 696c 6162 6c65 202f 2032   = available / 2
+00024db0: 0a20 2020 2069 6620 6174 7465 6d70 745f  .    if attempt_
+00024dc0: 706f 696e 7473 203d 3d20 303a 0a20 2020  points == 0:.   
+00024dd0: 2020 2020 2061 7474 656d 7074 5f70 6f69       attempt_poi
+00024de0: 6e74 7320 3d20 6176 6169 6c61 626c 6520  nts = available 
+00024df0: 2f20 322e 300a 2020 2020 636f 6d70 6c65  / 2.0.    comple
+00024e00: 7469 6f6e 5f70 6f69 6e74 7320 3d20 6176  tion_points = av
+00024e10: 6169 6c61 626c 6520 2d20 6174 7465 6d70  ailable - attemp
+00024e20: 745f 706f 696e 7473 0a0a 2020 2020 6966  t_points..    if
+00024e30: 2074 6173 6b2e 6765 7428 2274 696d 656c   task.get("timel
+00024e40: 696e 6573 735f 6f76 6572 7269 6464 656e  iness_overridden
+00024e50: 2229 2061 6e64 2022 7469 6d65 6c69 6e65  ") and "timeline
+00024e60: 7373 2220 696e 2074 6173 6b3a 0a20 2020  ss" in task:.   
+00024e70: 2020 2020 2072 6574 7572 6e20 7461 736b       return task
+00024e80: 5b22 7469 6d65 6c69 6e65 7373 225d 0a0a  ["timeliness"]..
+00024e90: 2020 2020 696e 6974 6961 6c5f 6772 6164      initial_grad
+00024ea0: 6520 3d20 7461 736b 2e67 6574 2822 6772  e = task.get("gr
+00024eb0: 6164 6522 290a 2020 2020 6966 2069 6e69  ade").    if ini
+00024ec0: 7469 616c 5f67 7261 6465 203d 3d20 223f  tial_grade == "?
+00024ed0: 223a 0a20 2020 2020 2020 2069 6e69 7469  ":.        initi
+00024ee0: 616c 5f67 7261 6465 203d 204e 6f6e 650a  al_grade = None.
+00024ef0: 2020 2020 656c 6966 2069 6e69 7469 616c      elif initial
+00024f00: 5f67 7261 6465 2069 7320 6e6f 7420 4e6f  _grade is not No
+00024f10: 6e65 3a0a 2020 2020 2020 2020 696e 6974  ne:.        init
+00024f20: 6961 6c5f 6772 6164 6520 3d20 666c 6f61  ial_grade = floa
+00024f30: 7428 696e 6974 6961 6c5f 6772 6164 6529  t(initial_grade)
+00024f40: 0a20 2020 2020 2020 2069 6620 696e 6974  .        if init
+00024f50: 6961 6c5f 6772 6164 6520 3e3d 2061 7070  ial_grade >= app
+00024f60: 2e63 6f6e 6669 672e 6765 7428 0a20 2020  .config.get(.   
+00024f70: 2020 2020 2020 2020 2022 5449 4d45 4c49           "TIMELI
+00024f80: 4e45 5353 5f41 5454 454d 5054 5f54 4852  NESS_ATTEMPT_THR
+00024f90: 4553 484f 4c44 222c 0a20 2020 2020 2020  ESHOLD",.       
+00024fa0: 2020 2020 2061 7070 2e63 6f6e 6669 672e       app.config.
+00024fb0: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
+00024fc0: 2020 2020 2022 4556 414c 5541 5449 4f4e       "EVALUATION
+00024fd0: 5f53 434f 5245 5322 2c0a 2020 2020 2020  _SCORES",.      
+00024fe0: 2020 2020 2020 2020 2020 7b7d 0a20 2020            {}.   
+00024ff0: 2020 2020 2020 2020 2029 2e67 6574 2822           ).get("
+00025000: 7061 7274 6961 6c6c 7920 636f 6d70 6c65  partially comple
+00025010: 7465 222c 2037 3529 0a20 2020 2020 2020  te", 75).       
+00025020: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00025030: 6561 726e 6564 202b 3d20 6174 7465 6d70  earned += attemp
+00025040: 745f 706f 696e 7473 0a0a 2020 2020 7265  t_points..    re
+00025050: 765f 7461 736b 203d 2074 6173 6b2e 6765  v_task = task.ge
+00025060: 7428 2272 6576 6973 696f 6e22 290a 2020  t("revision").  
+00025070: 2020 6861 735f 7265 765f 6772 6164 6520    has_rev_grade 
+00025080: 3d20 280a 2020 2020 2020 2020 7265 765f  = (.        rev_
+00025090: 7461 736b 0a20 2020 2061 6e64 2022 6772  task.    and "gr
+000250a0: 6164 6522 2069 6e20 7265 765f 7461 736b  ade" in rev_task
+000250b0: 0a20 2020 2061 6e64 2072 6576 5f74 6173  .    and rev_tas
+000250c0: 6b5b 2267 7261 6465 225d 206e 6f74 2069  k["grade"] not i
+000250d0: 6e20 284e 6f6e 652c 2022 3f22 290a 2020  n (None, "?").  
+000250e0: 2020 290a 0a20 2020 2063 6f6d 706c 6574    )..    complet
+000250f0: 696f 6e5f 7468 7265 7368 6f6c 6420 3d20  ion_threshold = 
+00025100: 6170 702e 636f 6e66 6967 2e67 6574 280a  app.config.get(.
+00025110: 2020 2020 2020 2020 2254 494d 454c 494e          "TIMELIN
+00025120: 4553 535f 434f 4d50 4c45 5445 5f54 4852  ESS_COMPLETE_THR
+00025130: 4553 484f 4c44 222c 0a20 2020 2020 2020  ESHOLD",.       
+00025140: 2061 7070 2e63 6f6e 6669 672e 6765 7428   app.config.get(
+00025150: 0a20 2020 2020 2020 2020 2020 2022 4556  .            "EV
+00025160: 414c 5541 5449 4f4e 5f53 434f 5245 5322  ALUATION_SCORES"
+00025170: 2c0a 2020 2020 2020 2020 2020 2020 7b7d  ,.            {}
+00025180: 0a20 2020 2020 2020 2029 2e67 6574 2822  .        ).get("
+00025190: 616c 6d6f 7374 2063 6f6d 706c 6574 6522  almost complete"
+000251a0: 2c20 3835 290a 2020 2020 290a 2020 2020  , 85).    ).    
+000251b0: 6966 2028 0a20 2020 2020 2020 2028 696e  if (.        (in
+000251c0: 6974 6961 6c5f 6772 6164 6520 6973 206e  itial_grade is n
+000251d0: 6f74 204e 6f6e 6520 616e 6420 696e 6974  ot None and init
+000251e0: 6961 6c5f 6772 6164 6520 3e3d 2063 6f6d  ial_grade >= com
+000251f0: 706c 6574 696f 6e5f 7468 7265 7368 6f6c  pletion_threshol
+00025200: 6429 0a20 2020 2020 6f72 2028 6861 735f  d).     or (has_
+00025210: 7265 765f 6772 6164 6520 616e 6420 666c  rev_grade and fl
+00025220: 6f61 7428 7265 765f 7461 736b 5b22 6772  oat(rev_task["gr
+00025230: 6164 6522 5d29 203e 3d20 636f 6d70 6c65  ade"]) >= comple
+00025240: 7469 6f6e 5f74 6872 6573 686f 6c64 290a  tion_threshold).
+00025250: 2020 2020 293a 0a20 2020 2020 2020 2065      ):.        e
+00025260: 6172 6e65 6420 2b3d 2063 6f6d 706c 6574  arned += complet
+00025270: 696f 6e5f 706f 696e 7473 0a0a 2020 2020  ion_points..    
+00025280: 7265 7475 726e 2065 6172 6e65 640a 0a0a  return earned...
+00025290: 4061 7070 2e74 656d 706c 6174 655f 6669  @app.template_fi
+000252a0: 6c74 6572 2829 0a64 6566 2065 785f 636f  lter().def ex_co
+000252b0: 6d62 696e 6564 5f67 7261 6465 2865 6772  mbined_grade(egr
+000252c0: 6f75 7029 3a0a 2020 2020 2222 220a 2020  oup):.    """.  
+000252d0: 2020 4578 7472 6163 7473 2061 2066 756c    Extracts a ful
+000252e0: 6c20 636f 6d62 696e 6564 2067 7261 6465  l combined grade
+000252f0: 2076 616c 7565 2066 726f 6d20 616e 2061   value from an a
+00025300: 6d65 6e64 6564 2065 7865 7263 6973 6520  mended exercise 
+00025310: 6772 6f75 700a 2020 2020 6f62 6a65 6374  group.    object
+00025320: 2e20 5573 6573 2074 6865 2070 7265 2d63  . Uses the pre-c
+00025330: 616c 6375 6c61 7465 6420 6372 6564 6974  alculated credit
+00025340: 2d66 7261 6374 696f 6e20 616e 6420 6164  -fraction and ad
+00025350: 6473 2062 6f6e 7573 0a20 2020 2070 6f69  ds bonus.    poi
+00025360: 6e74 7320 666f 7220 7265 6163 6869 6e67  nts for reaching
+00025370: 2070 6172 7469 616c 2f63 6f6d 706c 6574   partial/complet
+00025380: 6520 7468 7265 7368 6f6c 6473 2e0a 0a20  e thresholds... 
+00025390: 2020 2053 636f 7265 7320 6172 6520 6e6f     Scores are no
+000253a0: 7420 726f 756e 6465 6420 2875 7365 2060  t rounded (use `
+000253b0: 6772 6164 655f 7374 7269 6e67 6020 6f72  grade_string` or
+000253c0: 2074 6865 206c 696b 6529 2e0a 2020 2020   the like)..    
+000253d0: 2222 220a 2020 2020 6672 6163 7469 6f6e  """.    fraction
+000253e0: 203d 2065 6772 6f75 705b 2263 7265 6469   = egroup["credi
+000253f0: 745f 6672 6163 7469 6f6e 225d 0a0a 2020  t_fraction"]..  
+00025400: 2020 2320 6672 6565 2063 7265 6469 7420    # free credit 
+00025410: 6275 6d70 2066 6f72 2068 6974 7469 6e67  bump for hitting
+00025420: 2065 6163 6820 7468 7265 7368 6f6c 640a   each threshold.
+00025430: 2020 2020 6275 6d70 203d 2061 7070 2e63      bump = app.c
+00025440: 6f6e 6669 672e 6765 7428 2245 5845 5243  onfig.get("EXERC
+00025450: 4953 455f 4752 4f55 505f 4352 4544 4954  ISE_GROUP_CREDIT
+00025460: 5f42 554d 5022 2c20 302e 3129 0a20 2020  _BUMP", 0.1).   
+00025470: 2069 6620 6672 6163 7469 6f6e 203e 3d20   if fraction >= 
+00025480: 6170 702e 636f 6e66 6967 2e67 6574 2822  app.config.get("
+00025490: 4558 4552 4349 5345 5f47 524f 5550 5f50  EXERCISE_GROUP_P
+000254a0: 4152 5449 414c 5f54 4852 4553 484f 4c44  ARTIAL_THRESHOLD
+000254b0: 2229 3a0a 2020 2020 2020 2020 6672 6163  "):.        frac
+000254c0: 7469 6f6e 202b 3d20 6275 6d70 0a20 2020  tion += bump.   
+000254d0: 2069 6620 6672 6163 7469 6f6e 203e 3d20   if fraction >= 
+000254e0: 6170 702e 636f 6e66 6967 2e67 6574 2822  app.config.get("
+000254f0: 4558 4552 4349 5345 5f47 524f 5550 5f54  EXERCISE_GROUP_T
+00025500: 4852 4553 484f 4c44 2229 3a0a 2020 2020  HRESHOLD"):.    
+00025510: 2020 2020 6672 6163 7469 6f6e 202b 3d20      fraction += 
+00025520: 6275 6d70 0a0a 2020 2020 6261 7369 7320  bump..    basis 
+00025530: 3d20 6170 702e 636f 6e66 6967 2e67 6574  = app.config.get
+00025540: 2822 5343 4f52 455f 4241 5349 5322 2c20  ("SCORE_BASIS", 
+00025550: 3130 3029 0a20 2020 2023 206e 6f20 6578  100).    # no ex
+00025560: 7472 6120 6372 6564 6974 0a20 2020 2072  tra credit.    r
+00025570: 6574 7572 6e20 6d69 6e28 6261 7369 732c  eturn min(basis,
+00025580: 2062 6173 6973 202a 2066 7261 6374 696f   basis * fractio
+00025590: 6e29 0a0a 0a40 6170 702e 7465 6d70 6c61  n)...@app.templa
+000255a0: 7465 5f66 696c 7465 7228 290a 6465 6620  te_filter().def 
+000255b0: 6772 6164 655f 7374 7269 6e67 2867 7261  grade_string(gra
+000255c0: 6465 5f76 616c 7565 293a 0a20 2020 2022  de_value):.    "
+000255d0: 2222 0a20 2020 2054 7572 6e73 2061 2067  "".    Turns a g
+000255e0: 7261 6465 2076 616c 7565 2028 4e6f 6e65  rade value (None
+000255f0: 2c20 6f72 2061 206e 756d 6265 7229 2069  , or a number) i
+00025600: 6e74 6f20 6120 6772 6164 6520 7374 7269  nto a grade stri
+00025610: 6e67 2028 616e 2048 544d 4c0a 2020 2020  ng (an HTML.    
+00025620: 7374 7269 6e67 2077 2f20 6120 6465 6e6f  string w/ a deno
+00025630: 6d69 6e61 746f 722c 206f 7220 2775 6e6b  minator, or 'unk
+00025640: 6e6f 776e 2729 2e0a 2020 2020 2222 220a  nown')..    """.
+00025650: 2020 2020 6966 2067 7261 6465 5f76 616c      if grade_val
+00025660: 7565 2069 7320 4e6f 6e65 206f 7220 6e6f  ue is None or no
+00025670: 7420 6973 696e 7374 616e 6365 2867 7261  t isinstance(gra
+00025680: 6465 5f76 616c 7565 2c20 2869 6e74 2c20  de_value, (int, 
+00025690: 666c 6f61 7429 293a 0a20 2020 2020 2020  float)):.       
+000256a0: 2072 6574 7572 6e20 2275 6e6b 6e6f 776e   return "unknown
+000256b0: 220a 2020 2020 656c 7365 3a0a 2020 2020  ".    else:.    
+000256c0: 2020 2020 726f 756e 645f 746f 203d 2061      round_to = a
+000256d0: 7070 2e63 6f6e 6669 675b 2252 4f55 4e44  pp.config["ROUND
+000256e0: 5f53 434f 5245 535f 544f 225d 0a20 2020  _SCORES_TO"].   
+000256f0: 2020 2020 2072 6f75 6e64 6564 203d 2072       rounded = r
+00025700: 6f75 6e64 2867 7261 6465 5f76 616c 7565  ound(grade_value
+00025710: 2c20 726f 756e 645f 746f 290a 2020 2020  , round_to).    
+00025720: 2020 2020 7264 656e 6f6d 203d 2072 6f75      rdenom = rou
+00025730: 6e64 2861 7070 2e63 6f6e 6669 675b 2253  nd(app.config["S
+00025740: 434f 5245 5f42 4153 4953 225d 2c20 726f  CORE_BASIS"], ro
+00025750: 756e 645f 746f 290a 2020 2020 2020 2020  und_to).        
+00025760: 6966 2069 6e74 2872 6f75 6e64 6564 2920  if int(rounded) 
+00025770: 3d3d 2072 6f75 6e64 6564 3a0a 2020 2020  == rounded:.    
+00025780: 2020 2020 2020 2020 726f 756e 6465 6420          rounded 
+00025790: 3d20 696e 7428 726f 756e 6465 6429 0a20  = int(rounded). 
+000257a0: 2020 2020 2020 2069 6620 696e 7428 7264         if int(rd
+000257b0: 656e 6f6d 2920 3d3d 2072 6465 6e6f 6d3a  enom) == rdenom:
+000257c0: 0a20 2020 2020 2020 2020 2020 2072 6465  .            rde
+000257d0: 6e6f 6d20 3d20 696e 7428 7264 656e 6f6d  nom = int(rdenom
+000257e0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000257f0: 2022 7b7d 266e 6273 703b 2f26 6e62 7370   "{}&nbsp;/&nbsp
+00025800: 3b7b 7d22 2e66 6f72 6d61 7428 726f 756e  ;{}".format(roun
+00025810: 6465 642c 2072 6465 6e6f 6d29 0a0a 0a40  ded, rdenom)...@
+00025820: 6170 702e 7465 6d70 6c61 7465 5f66 696c  app.template_fil
+00025830: 7465 7228 290a 6465 6620 7469 6d65 6c69  ter().def timeli
+00025840: 6e65 7373 5f73 7472 696e 6728 6772 6164  ness_string(grad
+00025850: 655f 7661 6c75 6529 3a0a 2020 2020 2222  e_value):.    ""
+00025860: 220a 2020 2020 5475 726e 7320 6120 7469  ".    Turns a ti
+00025870: 6d65 6c69 6e65 7373 2070 6f69 6e74 7320  meliness points 
+00025880: 7661 6c75 6520 284e 6f6e 652c 206f 7220  value (None, or 
+00025890: 6120 6e75 6d62 6572 2920 696e 746f 2061  a number) into a
+000258a0: 2074 696d 656c 696e 6573 730a 2020 2020   timeliness.    
+000258b0: 6772 6164 6520 7374 7269 6e67 2028 616e  grade string (an
+000258c0: 2048 544d 4c20 7374 7269 6e67 2077 2f20   HTML string w/ 
+000258d0: 6120 6465 6e6f 6d69 6e61 746f 722c 206f  a denominator, o
+000258e0: 7220 2775 6e6b 6e6f 776e 2729 2e0a 2020  r 'unknown')..  
+000258f0: 2020 2222 220a 2020 2020 6966 2067 7261    """.    if gra
+00025900: 6465 5f76 616c 7565 2069 7320 4e6f 6e65  de_value is None
+00025910: 206f 7220 6e6f 7420 6973 696e 7374 616e   or not isinstan
+00025920: 6365 2867 7261 6465 5f76 616c 7565 2c20  ce(grade_value, 
+00025930: 2869 6e74 2c20 666c 6f61 7429 293a 0a20  (int, float)):. 
+00025940: 2020 2020 2020 2072 6574 7572 6e20 2275         return "u
+00025950: 6e6b 6e6f 776e 220a 2020 2020 656c 7365  nknown".    else
+00025960: 3a0a 2020 2020 2020 2020 726f 756e 645f  :.        round_
+00025970: 746f 203d 2061 7070 2e63 6f6e 6669 675b  to = app.config[
+00025980: 2252 4f55 4e44 5f53 434f 5245 535f 544f  "ROUND_SCORES_TO
+00025990: 225d 0a20 2020 2020 2020 2072 6f75 6e64  "].        round
+000259a0: 6564 203d 2072 6f75 6e64 2867 7261 6465  ed = round(grade
+000259b0: 5f76 616c 7565 2c20 726f 756e 645f 746f  _value, round_to
+000259c0: 290a 2020 2020 2020 2020 7264 656e 6f6d  ).        rdenom
+000259d0: 203d 2072 6f75 6e64 2861 7070 2e63 6f6e   = round(app.con
+000259e0: 6669 672e 6765 7428 2254 494d 454c 494e  fig.get("TIMELIN
+000259f0: 4553 535f 504f 494e 5453 222c 2030 292c  ESS_POINTS", 0),
+00025a00: 2072 6f75 6e64 5f74 6f29 0a20 2020 2020   round_to).     
+00025a10: 2020 2069 6620 696e 7428 726f 756e 6465     if int(rounde
+00025a20: 6429 203d 3d20 726f 756e 6465 643a 0a20  d) == rounded:. 
+00025a30: 2020 2020 2020 2020 2020 2072 6f75 6e64             round
+00025a40: 6564 203d 2069 6e74 2872 6f75 6e64 6564  ed = int(rounded
+00025a50: 290a 2020 2020 2020 2020 6966 2069 6e74  ).        if int
+00025a60: 2872 6465 6e6f 6d29 203d 3d20 7264 656e  (rdenom) == rden
+00025a70: 6f6d 3a0a 2020 2020 2020 2020 2020 2020  om:.            
+00025a80: 7264 656e 6f6d 203d 2069 6e74 2872 6465  rdenom = int(rde
+00025a90: 6e6f 6d29 0a20 2020 2020 2020 2072 6574  nom).        ret
+00025aa0: 7572 6e20 227b 7d26 6e62 7370 3b2f 266e  urn "{}&nbsp;/&n
+00025ab0: 6273 703b 7b7d 222e 666f 726d 6174 2872  bsp;{}".format(r
+00025ac0: 6f75 6e64 6564 2c20 7264 656e 6f6d 290a  ounded, rdenom).
+00025ad0: 0a0a 4061 7070 2e74 656d 706c 6174 655f  ..@app.template_
+00025ae0: 6669 6c74 6572 2829 0a64 6566 2073 686f  filter().def sho
+00025af0: 7274 6572 5f67 7261 6465 2867 7261 6465  rter_grade(grade
+00025b00: 5f73 7472 696e 6729 3a0a 2020 2020 2222  _string):.    ""
+00025b10: 220a 2020 2020 5368 6f72 7465 6e73 2061  ".    Shortens a
+00025b20: 2067 7261 6465 2073 7472 696e 672e 0a20   grade string.. 
+00025b30: 2020 2022 2222 0a20 2020 2064 6976 6973     """.    divis
+00025b40: 203d 2022 266e 6273 703b 2f26 6e62 7370   = "&nbsp;/&nbsp
+00025b50: 3b22 0a20 2020 2069 6620 6469 7669 7320  ;".    if divis 
+00025b60: 696e 2067 7261 6465 5f73 7472 696e 673a  in grade_string:
+00025b70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00025b80: 6772 6164 655f 7374 7269 6e67 5b3a 6772  grade_string[:gr
+00025b90: 6164 655f 7374 7269 6e67 2e69 6e64 6578  ade_string.index
+00025ba0: 2864 6976 6973 295d 0a20 2020 2065 6c69  (divis)].    eli
+00025bb0: 6620 6772 6164 655f 7374 7269 6e67 203d  f grade_string =
+00025bc0: 3d20 2275 6e6b 6e6f 776e 223a 0a20 2020  = "unknown":.   
+00025bd0: 2020 2020 2072 6574 7572 6e20 223f 220a       return "?".
+00025be0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00025bf0: 2020 7265 7475 726e 2022 2122 0a0a 0a40    return "!"...@
+00025c00: 6170 702e 7465 6d70 6c61 7465 5f66 696c  app.template_fil
+00025c10: 7465 7228 290a 6465 6620 6772 6164 655f  ter().def grade_
+00025c20: 6361 7465 676f 7279 2867 7261 6465 5f76  category(grade_v
+00025c30: 616c 7565 293a 0a20 2020 2022 2222 0a20  alue):.    """. 
+00025c40: 2020 2043 6174 6567 6f72 697a 6573 2061     Categorizes a
+00025c50: 2067 7261 6465 2076 616c 7565 2028 302d   grade value (0-
+00025c60: 3130 3020 6f72 204e 6f6e 6529 2e0a 2020  100 or None)..  
+00025c70: 2020 2222 220a 2020 2020 6966 2067 7261    """.    if gra
+00025c80: 6465 5f76 616c 7565 2069 7320 4e6f 6e65  de_value is None
+00025c90: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00025ca0: 2022 6d69 7373 696e 6722 0a20 2020 2065   "missing".    e
+00025cb0: 6c69 6620 6772 6164 655f 7661 6c75 6520  lif grade_value 
+00025cc0: 3c20 6170 702e 636f 6e66 6967 5b22 4752  < app.config["GR
+00025cd0: 4144 455f 5448 5245 5348 4f4c 4453 225d  ADE_THRESHOLDS"]
+00025ce0: 5b22 6c6f 7722 5d3a 0a20 2020 2020 2020  ["low"]:.       
+00025cf0: 2072 6574 7572 6e20 226c 6f77 220a 2020   return "low".  
+00025d00: 2020 656c 6966 2067 7261 6465 5f76 616c    elif grade_val
+00025d10: 7565 203c 2061 7070 2e63 6f6e 6669 675b  ue < app.config[
+00025d20: 2247 5241 4445 5f54 4852 4553 484f 4c44  "GRADE_THRESHOLD
+00025d30: 5322 5d5b 226d 6964 225d 3a0a 2020 2020  S"]["mid"]:.    
+00025d40: 2020 2020 7265 7475 726e 2022 6d69 6422      return "mid"
+00025d50: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00025d60: 2020 2072 6574 7572 6e20 2268 6967 6822     return "high"
+00025d70: 0a0a 0a40 6170 702e 7465 6d70 6c61 7465  ...@app.template
+00025d80: 5f66 696c 7465 7228 290a 6465 6620 7469  _filter().def ti
+00025d90: 6d65 7370 656e 7428 7469 6d65 5f73 7065  mespent(time_spe
+00025da0: 6e74 293a 0a20 2020 2022 2222 0a20 2020  nt):.    """.   
+00025db0: 2048 616e 646c 6573 206e 756d 6572 6963   Handles numeric
+00025dc0: 616c 2d6f 722d 7374 7269 6e67 2d6f 722d  al-or-string-or-
+00025dd0: 4e6f 6e65 2074 696d 6520 7370 656e 7420  None time spent 
+00025de0: 7661 6c75 6573 2e0a 2020 2020 2222 220a  values..    """.
+00025df0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00025e00: 6528 7469 6d65 5f73 7065 6e74 2c20 2869  e(time_spent, (i
+00025e10: 6e74 2c20 666c 6f61 7429 293a 0a20 2020  nt, float)):.   
+00025e20: 2020 2020 2069 6620 7469 6d65 5f73 7065       if time_spe
+00025e30: 6e74 203d 3d20 303a 0a20 2020 2020 2020  nt == 0:.       
+00025e40: 2020 2020 2072 6574 7572 6e20 272d 270a       return '-'.
+00025e50: 2020 2020 2020 2020 656c 6966 2069 6e74          elif int
+00025e60: 2874 696d 655f 7370 656e 7429 203d 3d20  (time_spent) == 
+00025e70: 7469 6d65 5f73 7065 6e74 3a0a 2020 2020  time_spent:.    
+00025e80: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+00025e90: 7b7d 6822 2e66 6f72 6d61 7428 696e 7428  {}h".format(int(
+00025ea0: 7469 6d65 5f73 7065 6e74 2929 0a20 2020  time_spent)).   
+00025eb0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00025ec0: 2020 2020 2020 2072 6574 7572 6e20 227b         return "{
+00025ed0: 7d68 222e 666f 726d 6174 2872 6f75 6e64  }h".format(round
+00025ee0: 2874 696d 655f 7370 656e 742c 2032 2929  (time_spent, 2))
+00025ef0: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
+00025f00: 616e 6365 2874 696d 655f 7370 656e 742c  ance(time_spent,
+00025f10: 2073 7472 293a 0a20 2020 2020 2020 2072   str):.        r
+00025f20: 6574 7572 6e20 7469 6d65 5f73 7065 6e74  eturn time_spent
+00025f30: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00025f40: 2020 2072 6574 7572 6e20 223f 220a 0a0a     return "?"...
+00025f50: 4061 7070 2e74 656d 706c 6174 655f 6669  @app.template_fi
+00025f60: 6c74 6572 2829 0a64 6566 2069 6e69 7469  lter().def initi
+00025f70: 616c 7328 6675 6c6c 5f73 6563 7469 6f6e  als(full_section
+00025f80: 5f74 6974 6c65 293a 0a20 2020 2022 2222  _title):.    """
+00025f90: 0a20 2020 2052 6564 7563 6573 2061 2066  .    Reduces a f
+00025fa0: 756c 6c20 7365 6374 696f 6e20 7469 746c  ull section titl
+00025fb0: 6520 706f 7465 6e74 6961 6c6c 7920 696e  e potentially in
+00025fc0: 636c 7564 696e 6720 7469 6d65 2069 6e66  cluding time inf
+00025fd0: 6f72 6d61 7469 6f6e 0a20 2020 2061 6e64  ormation.    and
+00025fe0: 2074 6865 2077 6f72 6420 2750 726f 662e   the word 'Prof.
+00025ff0: 2720 6f72 2027 5072 6f66 6573 736f 7227  ' or 'Professor'
+00026000: 2074 6f20 6a75 7374 2066 6972 7374 2069   to just first i
+00026010: 6e69 7469 616c 732e 0a0a 2020 2020 5265  nitials...    Re
+00026020: 7475 726e 7320 273f 2720 6966 2074 6865  turns '?' if the
+00026030: 2069 6e70 7574 2076 616c 7565 2069 7320   input value is 
+00026040: 604e 6f6e 6560 2e0a 2020 2020 2222 220a  `None`..    """.
+00026050: 2020 2020 6966 2066 756c 6c5f 7365 6374      if full_sect
+00026060: 696f 6e5f 7469 746c 6520 6973 204e 6f6e  ion_title is Non
+00026070: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
+00026080: 6e20 273f 270a 2020 2020 776f 7264 7320  n '?'.    words 
+00026090: 3d20 6675 6c6c 5f73 6563 7469 6f6e 5f74  = full_section_t
+000260a0: 6974 6c65 2e73 706c 6974 2829 0a20 2020  itle.split().   
+000260b0: 2069 6620 6c65 6e28 776f 7264 7329 203e   if len(words) >
+000260c0: 2031 3a0a 2020 2020 2020 2020 6966 2077   1:.        if w
+000260d0: 6f72 6473 5b30 5d20 696e 2028 2750 726f  ords[0] in ('Pro
+000260e0: 6627 2c20 2750 726f 662e 272c 2027 5072  f', 'Prof.', 'Pr
+000260f0: 6f66 6573 736f 7227 293a 0a20 2020 2020  ofessor'):.     
+00026100: 2020 2020 2020 2077 6f72 6473 2e70 6f70         words.pop
+00026110: 2830 290a 2020 2020 2020 2020 7265 7475  (0).        retu
+00026120: 726e 2077 6f72 6473 5b30 5d5b 305d 202b  rn words[0][0] +
+00026130: 2077 6f72 6473 5b31 5d5b 305d 0a20 2020   words[1][0].   
+00026140: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
+00026150: 6574 7572 6e20 6675 6c6c 5f73 6563 7469  eturn full_secti
+00026160: 6f6e 5f74 6974 6c65 0a0a 0a40 6170 702e  on_title...@app.
+00026170: 7465 6d70 6c61 7465 5f66 696c 7465 7228  template_filter(
+00026180: 290a 6465 6620 7072 6f6e 6f75 6e28 7072  ).def pronoun(pr
+00026190: 6f6e 6f75 6e73 293a 0a20 2020 2022 2222  onouns):.    """
+000261a0: 0a20 2020 2052 6564 7563 6573 2070 726f  .    Reduces pro
+000261b0: 6e6f 756e 2069 6e66 6f20 746f 2061 2073  noun info to a s
+000261c0: 696e 676c 6520 7072 6f6e 6f75 6e2e 0a20  ingle pronoun.. 
+000261d0: 2020 2022 2222 0a20 2020 2074 6573 7420     """.    test 
+000261e0: 3d20 272f 272e 6a6f 696e 2872 652e 7370  = '/'.join(re.sp
+000261f0: 6c69 7428 7222 5b5e 412d 5a61 2d7a 5d2b  lit(r"[^A-Za-z]+
+00026200: 222c 2070 726f 6e6f 756e 732e 6c6f 7765  ", pronouns.lowe
+00026210: 7228 2929 290a 2020 2020 6966 2074 6573  r())).    if tes
+00026220: 7420 696e 2028 0a20 2020 2020 2020 2022  t in (.        "
+00026230: 7368 6522 2c0a 2020 2020 2020 2020 2273  she",.        "s
+00026240: 6865 2f68 6572 222c 0a20 2020 2020 2020  he/her",.       
+00026250: 2022 7368 652f 6865 7273 222c 0a20 2020   "she/hers",.   
+00026260: 2020 2020 2022 7368 652f 6865 722f 6865       "she/her/he
+00026270: 7273 220a 2020 2020 293a 0a20 2020 2020  rs".    ):.     
+00026280: 2020 2072 6574 7572 6e20 2273 6865 220a     return "she".
+00026290: 2020 2020 656c 6966 2074 6573 7420 696e      elif test in
+000262a0: 2028 0a20 2020 2020 2020 2022 6865 222c   (.        "he",
+000262b0: 0a20 2020 2020 2020 2022 6865 2f68 696d  .        "he/him
+000262c0: 222c 0a20 2020 2020 2020 2022 6865 2f68  ",.        "he/h
+000262d0: 6973 222c 0a20 2020 2020 2020 2022 6865  is",.        "he
+000262e0: 2f68 696d 2f68 6973 220a 2020 2020 293a  /him/his".    ):
+000262f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00026300: 2268 6522 0a20 2020 2065 6c69 6620 7465  "he".    elif te
+00026310: 7374 2069 6e20 280a 2020 2020 2020 2020  st in (.        
+00026320: 2274 6865 7922 2c0a 2020 2020 2020 2020  "they",.        
+00026330: 2274 6865 792f 7468 656d 222c 0a20 2020  "they/them",.   
+00026340: 2020 2020 2022 7468 656d 2f74 6865 6d2f       "them/them/
+00026350: 7468 6569 7222 0a20 2020 2029 3a0a 2020  their".    ):.  
+00026360: 2020 2020 2020 7265 7475 726e 2022 7468        return "th
+00026370: 6579 220a 2020 2020 656c 7365 3a0a 2020  ey".    else:.  
+00026380: 2020 2020 2020 7265 7475 726e 2070 726f        return pro
+00026390: 6e6f 756e 730a 0a0a 2320 4368 6172 6163  nouns...# Charac
+000263a0: 7465 7273 2074 6861 7420 6e65 6564 2072  ters that need r
+000263b0: 6570 6c61 6369 6e67 2074 6f20 6176 6f69  eplacing to avoi
+000263c0: 6420 6272 6561 6b69 6e67 2073 7472 696e  d breaking strin
+000263d0: 6773 2069 6e20 4a53 2073 6372 6970 740a  gs in JS script.
+000263e0: 2320 7461 6773 0a5f 4a53 5f45 5343 4150  # tags._JS_ESCAP
+000263f0: 4553 203d 205b 2023 2061 6c6c 2063 6861  ES = [ # all cha
+00026400: 7261 6374 6572 7320 7769 7468 206f 7264  racters with ord
+00026410: 2829 203c 2033 320a 2020 2020 6368 7228  () < 32.    chr(
+00026420: 7a29 2066 6f72 207a 2069 6e20 7261 6e67  z) for z in rang
+00026430: 6528 3332 290a 5d20 2b20 5b0a 2020 2020  e(32).] + [.    
+00026440: 275c 5c27 2c0a 2020 2020 2227 222c 0a20  '\\',.    "'",. 
+00026450: 2020 2027 2227 2c0a 2020 2020 273e 272c     '"',.    '>',
+00026460: 0a20 2020 2027 3c27 2c0a 2020 2020 2726  .    '<',.    '&
+00026470: 272c 0a20 2020 2027 3d27 2c0a 2020 2020  ',.    '=',.    
+00026480: 272d 272c 0a20 2020 2027 3b27 2c0a 2020  '-',.    ';',.  
+00026490: 2020 7527 5c75 3230 3238 272c 2023 204c    u'\u2028', # L
+000264a0: 494e 455f 5345 5041 5241 544f 520a 2020  INE_SEPARATOR.  
+000264b0: 2020 7527 5c75 3230 3239 272c 2023 2050    u'\u2029', # P
+000264c0: 4152 4147 5241 5048 5f53 4550 4152 4154  ARAGRAPH_SEPARAT
+000264d0: 4f52 0a5d 0a0a 0a40 6170 702e 7465 6d70  OR.]...@app.temp
+000264e0: 6c61 7465 5f66 696c 7465 7228 290a 6465  late_filter().de
+000264f0: 6620 6573 6361 7065 6a73 2876 616c 7565  f escapejs(value
+00026500: 293a 0a20 2020 2022 2222 0a20 2020 204d  ):.    """.    M
+00026510: 6f64 6966 6965 6420 6672 6f6d 3a0a 0a20  odified from:.. 
+00026520: 2020 2068 7474 7073 3a2f 2f73 7461 636b     https://stack
+00026530: 6f76 6572 666c 6f77 2e63 6f6d 2f71 7565  overflow.com/que
+00026540: 7374 696f 6e73 2f31 3233 3339 3830 362f  stions/12339806/
+00026550: 6573 6361 7065 2d73 7472 696e 6773 2d66  escape-strings-f
+00026560: 6f72 2d6a 6176 6173 6372 6970 742d 7573  or-javascript-us
+00026570: 696e 672d 6a69 6e6a 6132 0a0a 2020 2020  ing-jinja2..    
+00026580: 4573 6361 7065 7320 7374 7269 6e67 2076  Escapes string v
+00026590: 616c 7565 7320 736f 2074 6861 7420 7468  alues so that th
+000265a0: 6579 2063 616e 2061 7070 6561 7220 696e  ey can appear in
+000265b0: 7369 6465 206f 6620 7175 6f74 6573 2069  side of quotes i
+000265c0: 6e20 610a 2020 2020 266c 743b 7363 7269  n a.    &lt;scri
+000265d0: 7074 2667 743b 2074 6167 2061 6e64 2074  pt&gt; tag and t
+000265e0: 6865 7920 776f 6e27 7420 656e 6420 7468  hey won't end th
+000265f0: 6520 7175 6f74 6573 206f 7220 6361 7573  e quotes or caus
+00026600: 6520 616e 7920 6f74 6865 720a 2020 2020  e any other.    
+00026610: 7472 6f75 626c 652e 0a20 2020 2022 2222  trouble..    """
+00026620: 0a20 2020 2072 6574 7661 6c20 3d20 5b5d  .    retval = []
+00026630: 0a20 2020 2066 6f72 2063 6861 7220 696e  .    for char in
+00026640: 2076 616c 7565 3a0a 2020 2020 2020 2020   value:.        
+00026650: 6966 2063 6861 7220 696e 205f 4a53 5f45  if char in _JS_E
+00026660: 5343 4150 4553 3a0a 2020 2020 2020 2020  SCAPES:.        
+00026670: 2020 2020 7265 7476 616c 2e61 7070 656e      retval.appen
+00026680: 6428 7227 5c75 7b3a 3034 587d 272e 666f  d(r'\u{:04X}'.fo
+00026690: 726d 6174 286f 7264 2863 6861 7229 2929  rmat(ord(char)))
+000266a0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000266b0: 2020 2020 2020 2020 2020 2072 6574 7661             retva
+000266c0: 6c2e 6170 7065 6e64 2863 6861 7229 0a0a  l.append(char)..
+000266d0: 2020 2020 7265 7475 726e 206a 696e 6a61      return jinja
+000266e0: 322e 4d61 726b 7570 2875 2222 2e6a 6f69  2.Markup(u"".joi
+000266f0: 6e28 7265 7476 616c 2929 0a0a 0a23 2d2d  n(retval))...#--
+00026700: 2d2d 2d2d 2d2d 2d2d 2d23 0a23 204d 6169  ---------#.# Mai
+00026710: 6e20 636f 6465 2023 0a23 2d2d 2d2d 2d2d  n code #.#------
+00026720: 2d2d 2d2d 2d23 0a0a 6966 205f 5f6e 616d  -----#..if __nam
+00026730: 655f 5f20 3d3d 2022 5f5f 6d61 696e 5f5f  e__ == "__main__
+00026740: 223a 0a20 2020 2075 7365 5f73 736c 203d  ":.    use_ssl =
+00026750: 2054 7275 650a 2020 2020 6966 2061 7070   True.    if app
+00026760: 2e63 6f6e 6669 672e 6765 7428 224e 4f5f  .config.get("NO_
+00026770: 4445 4255 475f 5353 4c22 293a 0a20 2020  DEBUG_SSL"):.   
+00026780: 2020 2020 2075 7365 5f73 736c 203d 2046       use_ssl = F
+00026790: 616c 7365 0a20 2020 2065 6c73 653a 0a20  alse.    else:. 
+000267a0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+000267b0: 2020 2020 2020 2020 696d 706f 7274 204f          import O
+000267c0: 7065 6e53 534c 2023 206e 6f71 6120 4638  penSSL # noqa F8
+000267d0: 3131 2c20 4634 3031 0a20 2020 2020 2020  11, F401.       
+000267e0: 2065 7863 6570 7420 4d6f 6475 6c65 4e6f   except ModuleNo
+000267f0: 7446 6f75 6e64 5f6f 725f 496d 706f 7274  tFound_or_Import
+00026800: 5f45 7272 6f72 3a0a 2020 2020 2020 2020  _Error:.        
+00026810: 2020 2020 7573 655f 7373 6c20 3d20 4661      use_ssl = Fa
+00026820: 6c73 650a 0a20 2020 2069 6620 7573 655f  lse..    if use_
+00026830: 7373 6c3a 0a20 2020 2020 2020 2023 2052  ssl:.        # R
+00026840: 756e 2077 6974 6820 616e 2061 642d 686f  un with an ad-ho
+00026850: 6320 5353 4c20 636f 6e74 6578 7420 7369  c SSL context si
+00026860: 6e63 6520 4f70 656e 5353 4c20 6973 2061  nce OpenSSL is a
+00026870: 7661 696c 6162 6c65 0a20 2020 2020 2020  vailable.       
+00026880: 2070 7269 6e74 2822 5275 6e6e 696e 6720   print("Running 
+00026890: 7769 7468 2073 656c 662d 7369 676e 6564  with self-signed
+000268a0: 2053 534c 2e22 290a 2020 2020 2020 2020   SSL.").        
+000268b0: 6170 702e 7275 6e28 276c 6f63 616c 686f  app.run('localho
+000268c0: 7374 272c 2038 3738 372c 2064 6562 7567  st', 8787, debug
+000268d0: 3d46 616c 7365 2c20 7373 6c5f 636f 6e74  =False, ssl_cont
+000268e0: 6578 743d 2761 6468 6f63 2729 0a20 2020  ext='adhoc').   
+000268f0: 2065 6c73 653a 0a20 2020 2020 2020 2023   else:.        #
+00026900: 2052 756e 2077 6974 686f 7574 2061 6e20   Run without an 
+00026910: 5353 4c20 636f 6e74 6578 7420 284e 6f20  SSL context (No 
+00026920: 4f70 656e 5353 4c29 0a20 2020 2020 2020  OpenSSL).       
+00026930: 2070 7269 6e74 2822 5275 6e6e 696e 6720   print("Running 
+00026940: 7769 7468 6f75 7420 5353 4c2e 2229 0a20  without SSL."). 
+00026950: 2020 2020 2020 2061 7070 2e72 756e 2827         app.run('
+00026960: 6c6f 6361 6c68 6f73 7427 2c20 3837 3837  localhost', 8787
+00026970: 2c20 6465 6275 673d 4661 6c73 6529 0a20  , debug=False). 
+00026980: 2020 2020 2020 2023 204e 6f74 653a 2063         # Note: c
+00026990: 616e 2774 2065 6e61 626c 6520 6465 6275  an't enable debu
+000269a0: 6767 696e 6720 6265 6361 7573 6520 6974  gging because it
+000269b0: 2064 6f65 736e 2774 2073 6574 205f 5f70   doesn't set __p
+000269c0: 6163 6b61 6765 5f5f 0a20 2020 2020 2020  ackage__.       
+000269d0: 2023 2077 6865 6e20 7265 7374 6172 7469   # when restarti
+000269e0: 6e67 2061 6e64 2073 6f20 7265 6c61 7469  ng and so relati
+000269f0: 7665 2069 6d70 6f72 7473 2062 7265 616b  ve imports break
+00026a00: 2069 6e20 332e 780a                       in 3.x.
```

### Comparing `potluck-eval-1.2.8/potluck_server/rundir/potluck-redis.conf` & `potluck-eval-1.2.9/potluck_server/rundir/potluck-redis.conf`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck_server/rundir/ps_config.py.example` & `potluck-eval-1.2.9/potluck_server/rundir/ps_config.py.example`

 * *Files 2% similar despite different names*

```diff
@@ -159,14 +159,17 @@
 # Thresholds for completeness and partial completeness of exercise groups
 # based on how many of their exercises are (fully or partially) complete.
 # Set it to just below the percentage point you want to avoid floating
 # point rounding issues.
 EXERCISE_GROUP_THRESHOLD = 0.795
 EXERCISE_GROUP_PARTIAL_THRESHOLD = 0.395
 
+# Multiplier for group credit from late exercises
+LATE_EXERCISE_CREDIT_FRACTION = 0.75
+
 # Thresholds for grade categories for gradesheet coloring
 GRADE_THRESHOLDS = {
     "low": 75,
     "mid": 90
 }
 
 # Max number of starter files before we abort assuming a symbolic link
```

### Comparing `potluck-eval-1.2.8/potluck_server/static/pot_icon.png` & `potluck-eval-1.2.9/potluck_server/static/pot_icon.png`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck_server/static/potluck.css` & `potluck-eval-1.2.9/potluck_server/static/potluck.css`

 * *Files 3% similar despite different names*

```diff
@@ -208,33 +208,33 @@
     flex-flow: row wrap;
     align-items: start;
     padding: 5pt;
     border-radius: 4pt;
     margin: 8pt 4pt 18pt 8pt;
     background-color: var(--offwhite);
     border-left: 3pt solid var(--div-color);
-    max-height: 16rem;
+    max-height: 24rem;
     overflow: auto;
 }
 
 .exercises .egroup {
     border-radius: 4pt;
     padding: 5pt;
     border-left: 4pt solid black;
     border-top: 4pt solid black;
     margin: 4pt;
     background: white;
-    width: 2rem;
+    /* width: 2rem; */
     max-height: 3rem;
     text-align: center;
 }
 
 .exercises .egroup[open] {
     width: 100%;
-    max-height: 12rem;
+    max-height: 16rem;
     overflow: auto;
     text-align: left;
 }
 
 .exercises .egroup summary {
     list-style-type: none;
     display: inline-block;
@@ -322,14 +322,18 @@
 }
 
 .egroup ul li.status-complete {
     background-color: var(--accomplished-bg);
     border-color: var(--accomplished-fg);
 }
 
+.exercise sub {
+    font-size: 8pt;
+}
+
 .psets {
     list-style-type: none;
     margin: 0pt 0pt 0pt 4pt;
     padding: 0pt 0pt 0pt 0pt;
 }
 
 .pset {
@@ -596,14 +600,40 @@
 .status.complete {
     background: var(--accomplished-bg);
     color: var(--accomplished-fg);
     border-color: var(--accomplished-fg);
 }
 .status.complete:before { content: " "; }
 
+.status.perfect {
+    background: var(--accomplished-bg);
+    color: var(--accomplished-fg);
+    border-color: var(--accomplished-fg);
+}
+.status.perfect:before { content: "+ "; }
+
+.timely {
+    display: inline-block;
+    padding: 0pt 2pt;
+    border-radius: 2pt;
+    border: 1pt solid #999;
+}
+
+.timely.on_time {
+    background: var(--accomplished-bg);
+    color: var(--accomplished-fg);
+    border-color: var(--accomplished-fg);
+}
+
+.timely.late {
+    background: var(--partial-bg);
+    color: var(--partial-fg);
+    border-color: var(--partial-fg);
+}
+
 ul.outcomes {
     list-style-type: none;
 }
 
 ul.outcomes li {
     padding: 3pt;
     border-radius: 2pt;
@@ -639,14 +669,64 @@
  * Extensions *
  * ---------- */
 
 .extensions_form {
     margin: 8pt 0pt;
 }
 
+.has-extension {
+    background: var(--inflight-bg);
+    border-color: var(--inflight-border);
+}
+
+ul.exercise_extensions {
+    list-style-type: none;
+}
+
+ul.pset_extensions {
+    list-style-type: none;
+}
+
+.exercise_extensions li {
+    padding: 5pt;
+    border-radius: 4pt;
+    margin: 8pt 4pt 18pt 4pt;
+    background-color: var(--offwhite);
+    border-left: 3pt solid var(--div-color);
+}
+
+.extension-hours-input {
+    width: 3rem;
+}
+
+.gradesheet .exercise.unsubmitted {
+    background: var(--unknown-bg);
+    color: var(--unknown-fg);
+}
+
+.gradesheet .exercise.incomplete {
+    background: var(--failed-bg);
+    color: var(--failed-fg);
+}
+
+.gradesheet .exercise.partial {
+    background: var(--partial-bg);
+    color: var(--partial-fg);
+}
+
+.gradesheet .exercise.complete {
+    background: var(--accomplished-bg);
+    color: var(--accomplished-fg);
+}
+
+.gradesheet .exercise.perfect {
+    background: var(--accomplished-bg);
+    color: var(--accomplished-fg);
+}
+
 
 /* ---------- *
  * Gradesheet *
  * ---------- */
 
 .grade_table,
 .timing_table {
```

### Comparing `potluck-eval-1.2.8/potluck_server/static/potluck.js` & `potluck-eval-1.2.9/potluck_server/static/potluck.js`

 * *Files 10% similar despite different names*

#### js-beautify {}

```diff
@@ -291,8 +291,66 @@
             for (
                 let task_form of document.querySelectorAll("form.task_submit")
             ) {
                 validate_task_submit(task_form);
             }
         }
     );
+}
+
+/*----------------------*
+ * Extension Management *
+ *----------------------*/
+
+/*
+ * Adds 24 to the numeric value of a text input with a certain ID. Emits
+ * a warning if the value isn't numeric or the input can't be found.
+ */
+function add24(id) {
+    let target = document.getElementById(id);
+    if (target == undefined) {
+        console.warn("Can't add 24 to nonexistent element '" + id + "'.");
+        return;
+    }
+    let old = parseFloat(target.value);
+    if (isNaN(old)) {
+        console.warn(
+            "Can't add 24 to non-numeric value '" + target.value + "'."
+        );
+        return;
+    }
+    target.value = "" + (old + 24);
+}
+
+/*
+ * Like add24 but subtracts. Doesn't subtract below 0.
+ */
+function subtract24(id) {
+    let target = document.getElementById(id);
+    if (target == undefined) {
+        console.warn(
+            "Can't subtract 24 from nonexistent element '" + id + "'."
+        );
+        return;
+    }
+    let old = parseFloat(target.value);
+    if (isNaN(old)) {
+        console.warn(
+            "Can't subtract 24 from non-numeric value '" + target.value + "'."
+        );
+        return;
+    }
+    target.value = "" + Math.max(0, (old - 24));
+}
+
+/* Attach add/subtract 24 to the appropriate buttons */
+for (let button of document.querySelectorAll("input.add24")) {
+    button.addEventListener("click", function() {
+        add24(this.getAttribute("data-target"));
+    });
+}
+
+for (let button of document.querySelectorAll("input.subtract24")) {
+    button.addEventListener("click", function() {
+        subtract24(this.getAttribute("data-target"));
+    });
 }
```

### Comparing `potluck-eval-1.2.8/potluck_server/storage.py` & `potluck-eval-1.2.9/potluck_server/storage.py`

 * *Files 0% similar despite different names*

```diff
@@ -628,15 +628,15 @@
     given pset (in the given course/semester). May be an integer number
     of hours, or just True (the default) for the standard extension
     (whatever is listed in tasks.json). Set to False to remove any
     previously granted extension.
 
     If only_from is provided, the operation will fail when the extension
     value being updated isn't set to that value (may be a number of
-    hours, or True for the standared extension, or False for unset). In
+    hours, or True for the standard extension, or False for unset). In
     that case, this function will return False if it fails. Set
     only_from to None to unconditionally update the extension.
     """
     key = extension_key(course, semester, username, psid, phase)
     task_info = get_task_info(course, semester)
     ext_hours = task_info.get("extension_hours", 24)
 
@@ -1429,14 +1429,16 @@
     Fetches the best outcomes-list information for all exercises for the
     given user/course/semester. The result will be a dictionary which
     maps exercise IDs to dictionaries each with the following keys:
 
     - "submitted_at" - A time string (see
         `potluck.time_utils.timestring`) indicating when the list of
         outcomes was submitted.
+    - "on_time" - A boolean indicating whether the submission came in on
+        time or not.
     - "authors" - A list of usernames for participating authors.
     - "outcomes" - A list of 3-tuple outcomes, which contain a boolean
         for success/failure followed by tag and message strings (see
         `optimism.listOutcomesInSuite`)
     - "code" - A list of filename/code-string pairs indicating any code
         blocks attached to the submission.
     - "status" - A status string describing the exercise status based on
@@ -1497,42 +1499,48 @@
     semester,
     username,
     exercise,
     authors,
     outcomes,
     codeBlocks,
     status,
-    credit
+    credit,
+    group_credit,
+    on_time
 ):
     """
     Saves a list of outcomes for a specific exercise submitted by a
     particular user who is taking a course in a certain semester. The
     outcomes list should be a list of 3-tuples each consisting of a
     boolean, a tag string, and a message string (e.g., the return value
     from `optimism.listOutcomesInSuite`). The authors value should be a
     list of username strings listing all authors who contributed. The
     `codeBlocks` value should be a list of pairs, each of which has a
     filename string and a code string (the filename could also elsehow
     identify the source code was derived from). The `status` value should
     be a string describing the status of the submission, while the credit
     value should be a number where a higher number indicates a better
     submission (to be stored preferentially as the "best" submission so
-    far if it's better than the old one).
+    far if it's better than the old one). The `on_time` value should be a
+    boolean indicating whether the outcomes should count as 'on-time' or
+    not.
 
     The list of outcomes and associated code blocks is added to the
     record of all such lists submitted for that exercise by that user, as
     a dictionary with the following slots:
 
     - "submitted_at": the current time, as a string (see
         `potluck.time_utils.timestring`).
+    - "on_time": The `on_time` boolean provided.
     - "authors": The list of authors.
     - "outcomes": The list of outcomes.
     - "code": The list of filename/code-string pairs.
     - "status": The status string.
     - "credit": The credit number.
+    - "group_credit": The credit number for counting group credit.
 
     It will also replace any old outcomes list which is listed in the
     best-outcomes-per-exercise info for the submitting user if it's
     better than or the same as (in terms of credit) the best one
     previously recorded there. If `credit` is set to None, it will count
     as -1 for this purpose.
 
@@ -1554,19 +1562,21 @@
     )
     if recorded_outcomes is None:
         recorded_outcomes = []
 
     # Here's the info we store
     info = {
         "submitted_at": timestring,
+        "on_time": on_time,
         "authors": authors,
         "outcomes": outcomes,
         "code": codeBlocks,
         "status": status,
-        "credit": credit
+        "credit": credit,
+        "group_credit": group_credit
     }
 
     recorded_outcomes.append(info)
 
     new_encoded = json.dumps(recorded_outcomes)
 
     try:
@@ -1592,34 +1602,38 @@
     # fails!
     try:
         old_json = _REDIS.hget(best_key, exercise)
         if old_json is None:
             old_credit = -1
         else:
             old_best = json.loads(old_json)
-            old_credit = old_best.get("credit", -1)
+            old_credit = old_best.get(
+                "group_credit",
+                # for older data, group_credit isn't present
+                old_best.get("credit", -1)
+            )
     except Exception:
         flask.flash("Failed to read best-outcomes info!")
         tb = potluck.html_tools.string_traceback()
         print(
             "Failed to read best-outcomes info at '{}':\n{}".format(
                 best_key,
                 tb
             ),
             file=sys.stderr
         )
         return False
 
     # Missing credit value counts as -1 credit.
-    if credit is None:
-        credit = -1
+    if group_credit is None:
+        group_credit = -1
 
     # Only record a new best-outcome-for-this-exercise if the current
-    # credit value is >= the old one.
-    if credit >= old_credit:
+    # group credit value is >= the old one.
+    if group_credit >= old_credit:
         try:
             _REDIS.hset(best_key, exercise, json.dumps(info))
         except Exception:
             flask.flash("Failed to write best-outcomes info!")
             tb = potluck.html_tools.string_traceback()
             print(
                 "Failed to write best-outcomes info at '{}':\n{}".format(
```

### Comparing `potluck-eval-1.2.8/potluck_server/sync.py` & `potluck-eval-1.2.9/potluck_server/sync.py`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck_server/templates/base.j2` & `potluck-eval-1.2.9/potluck_server/templates/base.j2`

 * *Files 12% similar despite different names*

```diff
@@ -21,14 +21,40 @@
    src="{{url_for('static', filename='potluck.js')}}"
   >
   </script>
   {% block head_stuff %} {% endblock %}
 </head>
 <body {% block body_attrs %} {%endblock %}>
 
+{% macro simple_countdown(timedelta) -%}
+{% set cd_seconds = timedelta|seconds %}
+{% set cd_fuzzy = cd_seconds|fuzzy_time %}
+<div
+ role="timer"
+ aria-live="off"
+ class="timer"
+ data-time="{{cd_seconds}}"
+>
+  {% if cd_seconds < 0 %}
+    ({{cd_fuzzy}} ago)
+  {% else %}
+    ({{cd_fuzzy}} from&nbsp;now)
+  {% endif %}
+</div>
+{%- endmacro %}
+
+{% macro simple_due_at(when) -%}
+{% set timedelta = when - now() %}
+<div class="due">
+  Due
+  <span class="due" data-remaining="{{timedelta|seconds}}">
+    {{when|fmt_datetime|safe}}
+  </span>
+{%- endmacro %}
+
 {% macro countdown(status) -%}
 {% if status['state'] == 'unreleased' %}
   {% set which = 'release' %}
 {% elif status['state'] == 'released' %}
   {% set which = 'due' %}
 {% elif status['state'] == 'under_review' %}
   {% set which = 'reviewed' %}
```

#### html2text {}

```diff
@@ -1,19 +1,26 @@
 {# vim: set shiftwidth=2 tabstop=2 syntax=html: #}
 
 
 
  {% block head_stuff %} {% endblock %}
-% block body_attrs %} {%endblock %}> {% macro countdown(status) -%} {% if
-status['state'] == 'unreleased' %} {% set which = 'release' %} {% elif status
-['state'] == 'released' %} {% set which = 'due' %} {% elif status['state'] ==
-'under_review' %} {% set which = 'reviewed' %} {% elif status['state'] ==
-'revisable' %} {% set which = 'finalized' %} {% elif status['state'] == 'final'
-%} {% set which = 'finalized' %} {% else %} {% set which = 'due' %}  {% endif
-%}
+% block body_attrs %} {%endblock %}> {% macro simple_countdown(timedelta) -%}
+{% set cd_seconds = timedelta|seconds %} {% set cd_fuzzy =
+cd_seconds|fuzzy_time %}
+{% if cd_seconds < 0 %} ({{cd_fuzzy}} ago) {% else %} ({{cd_fuzzy}} fromnow)
+{% endif %}
+{%- endmacro %} {% macro simple_due_at(when) -%} {% set timedelta = when - now
+() %}
+Due  {{when|fmt_datetime|safe}}  {%- endmacro %} {% macro countdown(status) -%}
+{% if status['state'] == 'unreleased' %} {% set which = 'release' %} {% elif
+status['state'] == 'released' %} {% set which = 'due' %} {% elif status
+['state'] == 'under_review' %} {% set which = 'reviewed' %} {% elif status
+['state'] == 'revisable' %} {% set which = 'finalized' %} {% elif status
+['state'] == 'final' %} {% set which = 'finalized' %} {% else %} {% set which =
+'due' %}  {% endif %}
 {% if status[which]['until']|seconds < 0 %} ({{status[which]
 ['until_str']|safe}} ago) {% else %} ({{status[which]['until_str']|safe}}
 fromnow) {% endif %}
 {%- endmacro %} {% macro due_at(status) -%} {% if status['state'] ==
 'unreleased' %} {% set which = 'release' %} {% set desc = 'Will be released' %}
 {% elif status['state'] == 'released' %} {% set which = 'due' %} {% set desc =
 'Due' %} {% elif status['state'] == 'under_review' %} {% set which = 'reviewed'
```

### Comparing `potluck-eval-1.2.8/potluck_server/templates/dashboard.j2` & `potluck-eval-1.2.9/potluck_server/templates/dashboard.j2`

 * *Files 2% similar despite different names*

```diff
@@ -28,14 +28,15 @@
 <div class="exercises">
   {% for egroup in task_info.exercises %}
     {% set pct = (egroup.credit_fraction * 100)|int %}
     <details class="egroup phase-{{egroup.phase}} status-{{egroup.status}}">
       <summary
        title="{{egroup.group}} is {{egroup.status}} (click to show details)"
       >
+        {{egroup.group}}:
         {% if egroup.status == "unreleased" %}
           
         {% elif egroup.status == "pending" %}
           {% if pct == 100 %}{% else %}{{pct}}%{% endif %}
         {% elif egroup.status == "incomplete" %}
           
         {% elif egroup.status == "partial" %}
@@ -43,69 +44,90 @@
         {% elif egroup.status == "complete" %}
           
         {% elif egroup.status == "perfect" %}
           
         {% endif %}
       </summary>
       {{egroup.desc}}
+      <br>
+      This group is {{pct}}% complete.<br>
+      Your score is {{egroup|ex_combined_grade|grade_string}}.
       {% if egroup.status != "unreleased" %}
+        <br>
         <a target="blank" href="{{egroup.url}}">
-          (show me the {{egroup.group}} exercises)
+          Show me the {{egroup.group}} exercises.
         </a>
       {% endif %}
-      <br>
-      This group is {{pct}}% complete.
       {% if egroup.phase == "due" %}
         <br>
         {% if egroup.status in ("complete", "perfect") %}
           <a target="blank" href="{{egroup.soln_url}}">
             Show me the {{egroup.group}} solutions.
           </a>
         {% else %}
           Solutions will become available once you complete these
           exercises.
         {% endif %}
       {% endif %}
+      {% if is_admin %}
+        <br>
+        <a target="blank" href="{{url_for(
+            'route_ex_gradesheet',
+            course=course,
+            semester=semester,
+            group=egroup.group
+         )}}">
+          Show me the {{egroup.group}} gradesheet.
+        </a>
+      {% endif %}
       <ul>
         {% for exercise in egroup.exercises %}
           {% set eid = exercise['id'] %}
+          {% if exercise.status == "complete" %}
+            {% set status_indicator='' %}
+          {% elif exercise.status == "partial" %}
+            {% set status_indicator='~' %}
+          {% elif exercise.status == "incomplete" %}
+            {% set status_indicator='' %}
+          {% elif exercise.status == "unsubmitted" %}
+            {% set status_indicator='.' %}
+          {% else %}
+            {% set status_indicator='?' %}
+          {% endif %}
+          {% if not exercise.on_time %}
+            {% set late='<sub>L</sub>' %}
+          {% else %}
+            {% set late='' %}
+          {% endif %}
           <li
-           class="exercise status-{{exercise.status}}"
+           class="exercise status-{{exercise.status}}{% if not exercise.on_time %} late{% endif%}"
           >
             <a
              href="{{url_for(
                'route_exercise',
                course=course,
                semester=semester,
                target_user=effective_user,
                eid=eid
              )}}"
              target="blank"
              title="{{eid}} is {{exercise.status}} (click for detailed results)"
             >
-              {% if exercise.status == "complete" %}
-                
-              {% elif exercise.status == "partial" %}
-                
-              {% elif exercise.status == "incomplete" %}
-                
-              {% elif exercise.status == "unsubmitted" %}
-                .
-              {% endif %}
+              {{status_indicator}}{{late}}
             </a>
           </li>
         {% endfor %}
       </ul>
     </details>
   {% endfor %}
 </div>
 
 <h3>Projects (submit using these forms)</h3>
 <ul class="psets">
-  {% for pset in task_info.psets %}
+  {% for pset in task_info.psets if not pset.get("hide") %}
     {% set ps_state = pset.status.state %}
     {% if ps_state in ("unreleased", "released") %}
       {% set sub_phase="initial" %}
     {% elif ps_state in ("under_review", "revisable") %}
       {% set sub_phase="revision" %}
     {% elif ps_state == "final" %}
       {% set sub_phase="belated" %}
```

#### html2text {}

```diff
@@ -2,37 +2,46 @@
 block main_content %}
 ***** Dashboard *****
 Quick links: {% for pset in task_info.psets%} {{pset.id}} {% if not loop.last
 %}|{% endif %} {% endfor %}
  * Validate inputs (turn off only if necessary)
 **** Exercises (submit by running test code; click to expand) ****
 {% for egroup in task_info.exercises %} {% set pct = (egroup.credit_fraction *
-100)|int %}   {% if egroup.status == "unreleased" %}  {% elif egroup.status
-== "pending" %} {% if pct == 100 %}{% else %}{{pct}}%{% endif %} {% elif
-egroup.status == "incomplete" %}  {% elif egroup.status == "partial" %} ~ {%
-elif egroup.status == "complete" %}  {% elif egroup.status == "perfect" %}
- {% endif %}  {{egroup.desc}} {% if egroup.status != "unreleased" %} (show
-me_the_{{egroup.group}}_exercises) {% endif %}
-This group is {{pct}}% complete. {% if egroup.phase == "due" %}
+100)|int %}   {{egroup.group}}: {% if egroup.status == "unreleased" %}  {%
+elif egroup.status == "pending" %} {% if pct == 100 %}{% else %}{{pct}}%{%
+endif %} {% elif egroup.status == "incomplete" %}  {% elif egroup.status ==
+"partial" %} ~ {% elif egroup.status == "complete" %}  {% elif egroup.status
+== "perfect" %}  {% endif %}  {{egroup.desc}}
+This group is {{pct}}% complete.
+Your score is {{egroup|ex_combined_grade|grade_string}}. {% if egroup.status !=
+"unreleased" %}
+Show_me_the_{{egroup.group}}_exercises. {% endif %} {% if egroup.phase == "due"
+%}
 {% if egroup.status in ("complete", "perfect") %} Show_me_the_{{egroup.group}}
 solutions. {% else %} Solutions will become available once you complete these
-exercises. {% endif %} {% endif %}
-    * {% for exercise in egroup.exercises %} {% set eid = exercise['id'] %}
-    * {%_if_exercise.status_==_"complete"_%}__{%_elif_exercise.status_==
-      "partial"_%}__{%_elif_exercise.status_==_"incomplete"_%}__{%_elif
-      exercise.status_==_"unsubmitted"_%}_._{%_endif_%}
+exercises. {% endif %} {% endif %} {% if is_admin %}
+Show_me_the_{{egroup.group}}_gradesheet. {% endif %}
+    * {% for exercise in egroup.exercises %} {% set eid = exercise['id'] %} {%
+      if exercise.status == "complete" %} {% set status_indicator='' %} {%
+      elif exercise.status == "partial" %} {% set status_indicator='~' %} {%
+      elif exercise.status == "incomplete" %} {% set status_indicator='' %}
+      {% elif exercise.status == "unsubmitted" %} {% set status_indicator='.'
+      %} {% else %} {% set status_indicator='?' %} {% endif %} {% if not
+      exercise.on_time %} {% set late='L' %} {% else %} {% set late='' %} {%
+      endif %}
+    * {{status_indicator}}{{late}}
     * {% endfor %}
  {% endfor %}
 **** Projects (submit using these forms) ****
-    * {% for pset in task_info.psets %} {% set ps_state = pset.status.state %}
-      {% if ps_state in ("unreleased", "released") %} {% set
-      sub_phase="initial" %} {% elif ps_state in ("under_review", "revisable")
-      %} {% set sub_phase="revision" %} {% elif ps_state == "final" %} {% set
-      sub_phase="belated" %} {% else %} {# "unknown", etc. #} {% set
-      sub_phase="invalid" %} {% endif %}
+    * {% for pset in task_info.psets if not pset.get("hide") %} {% set ps_state
+      = pset.status.state %} {% if ps_state in ("unreleased", "released") %} {%
+      set sub_phase="initial" %} {% elif ps_state in ("under_review",
+      "revisable") %} {% set sub_phase="revision" %} {% elif ps_state ==
+      "final" %} {% set sub_phase="belated" %} {% else %} {# "unknown", etc. #}
+      {% set sub_phase="invalid" %} {% endif %}
     * % if ps_state != "unreleased" %} href="{{pset.url}}" title="Click to view
       the {{pset.id}} instructions" {% else %} title="{{pset.id}}" {% endif %}
       tabindex="0" aria-describedby="{{pset.id}}-timing" >{{pset.id}}
  {% if is_admin %} Gradesheet {% endif %}
 {{ due_at(pset.status) }} {{ countdown(pset.status) }}
 {% if ps_state in ("unreleased", "released") %} {% if
 pset.status.initial_extension != 0 %}  (You have {
```

### Comparing `potluck-eval-1.2.8/potluck_server/templates/error.j2` & `potluck-eval-1.2.9/potluck_server/templates/error.j2`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck_server/templates/evaluate.j2` & `potluck-eval-1.2.9/potluck_server/templates/evaluate.j2`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck_server/templates/exercise.j2` & `potluck-eval-1.2.9/potluck_server/templates/exercise.j2`

 * *Files 13% similar despite different names*

```diff
@@ -49,17 +49,29 @@
           attempt generates an error before the submission can happen.
           Look for a line in the output that says "Traceback" when you
           run the tests.)
         {% endif %}
       </p>
     {% endif %}
 
+    {% if results.on_time %}
+      {% set timely="on time" %}
+      {% set timely_class="on_time" %}
+    {% else %}
+      {% set timely="late" %}
+      {% set timely_class="late" %}
+    {% endif %}
+
     <p>
     The status for this exercise is:
     <a class="status {{results.status}}">{{results.status}}</a><br>
+    {% if results.status != "unsubmitted" %}
+      This exercise was submitted
+      <a class="timely {{timely_class}}">{{timely}}</a><br>
+    {% endif %}
     The full authors list was: {{', '.join(results.authors)}}
     </p>
 
     {% if results.outcomes|length > 0 %}
       Outcomes for this exercise:
 
       <ul
```

#### html2text {}

```diff
@@ -11,17 +11,20 @@
 was received {{results.submitted_at|timestamp}}
 (More recent submissions are not shown if they have worse outcomes; check the
 messages printed when submitting for more info on why.) {% else %} You have not
 yet submitted this exercise.
 (If you have attempted it, one reason might be that your attempt generates an
 error before the submission can happen. Look for a line in the output that says
 "Traceback" when you run the tests.) {% endif %}
-{% endif %}
+{% endif %} {% if results.on_time %} {% set timely="on time" %} {% set
+timely_class="on_time" %} {% else %} {% set timely="late" %} {% set
+timely_class="late" %} {% endif %}
 The status for this exercise is: {{results.status}}
-The full authors list was: {{', '.join(results.authors)}}
+{% if results.status != "unsubmitted" %} This exercise was submitted {{timely}}
+{% endif %} The full authors list was: {{', '.join(results.authors)}}
 {% if results.outcomes|length > 0 %} Outcomes for this exercise:
     * {% for outcome in results.outcomes %} {% if outcome[0] %} {% set cls =
       "success" %} {% else %} {% set cls = "failure" %} {% endif %}
     * {{outcome[2]}}
     * {% endfor %}
 {% else %}
 There were no test outcomes for this exercise.
```

### Comparing `potluck-eval-1.2.8/potluck_server/templates/feedback.j2` & `potluck-eval-1.2.9/potluck_server/templates/feedback.j2`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck_server/templates/gradesheet.j2` & `potluck-eval-1.2.9/potluck_server/templates/gradesheet.j2`

 * *Files 0% similar despite different names*

```diff
@@ -184,15 +184,15 @@
           {% set eclass = "long-experience" %}
         {% else %}
           {% set estr = exp %}
           {% set eclass = "unknown-experience" %}
         {% endif %}
         <td
          class="experience groupend {{eclass}}"
-         title="{{sinfo["experience_description"] or ""|escape}}"
+         title="{{(sinfo["experience_description"] or "")|escape}}"
         >
           {{estr|safe}}
         </td>
         {% if student["this_pset"] == None %}
           <td colspan="3" class="pset_grade missing groupend">
             missing
           </td>
```

### Comparing `potluck-eval-1.2.8/potluck_server/templates/pset_extensions_form.j2` & `potluck-eval-1.2.9/potluck_server/templates/exercise_extensions_form.j2`

 * *Files 24% similar despite different names*

```diff
@@ -1,43 +1,50 @@
 {# vim: set shiftwidth=2 tabstop=2 syntax=html: #}
 <form
  action="{{url_for(
    'route_set_extensions',
    course=course,
    semester=semester,
    target_user=target_user,
-   psid=ps['id']
+   psid=egroup['group']
  )}}"
  method="POST"
  class="extensions_form"
 >
   {# CSRF token for flask_seasurf #}
   <input
    type="hidden"
    name="_csrf_token"
    value="{{csrf_token()}}"
   >
-  Extensions for {{target_user}} on {{ps.id}}:<br>
-  <label for="{{ps.id}}-initial-extension">
-    initial extension:
+  Extensions for {{target_user}} on {{egroup.group}} exercises:<br>
+  <label for="{{egroup.group}}-extension">
+    extension:
     <input
      class="extension-hours-input"
-     id="{{ps.id}}-initial-extension"
+     id="{{egroup.group}}-extension"
      name="initial"
      type="text"
-     value="{{ ps.status.initial_extension }}"
+     value="{{ egroup.extension }}"
     >
     hours
-  </label><br>
-  <label for="{{ps.id}}-revision-extension">
-    revision extension:
-    <input
-     class="extension-hours-input"
-     id="{{ps.id}}-revision-extension"
-     name="revision"
-     type="text"
-     value="{{ ps.status.revision_extension }}"
-    >
-    hours
-  </label><br>
-  <input type="submit" value="Update {{target_user}}'s {{ps.id}} extensions">
+  </label>
+  <input
+   type="button"
+   class="add24"
+   title="Add 24 hours to the extension for {{egroup.group}}."
+   value="+24h"
+   data-target="{{egroup.group}}-extension"
+  >
+  <input
+   type="button"
+   class="subtract24"
+   title="Subtract 24 hours to the extension for {{egroup.group}}."
+   value="-24h"
+   data-target="{{egroup.group}}-extension"
+  >
+  <br>
+  <input
+   type="submit"
+   value="Update {{target_user}}'s {{egroup.group}} exercises extensions"
+  >
 </form>
```

### Comparing `potluck-eval-1.2.8/potluck_server/templates/pset_submission_form.j2` & `potluck-eval-1.2.9/potluck_server/templates/pset_submission_form.j2`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/potluck_server/templates/solution.j2` & `potluck-eval-1.2.9/potluck_server/templates/solution.j2`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/scripts/potluck_eval` & `potluck-eval-1.2.9/scripts/potluck_eval`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/scripts/potluck_tool` & `potluck-eval-1.2.9/scripts/potluck_tool`

 * *Files identical despite different names*

### Comparing `potluck-eval-1.2.8/setup.py` & `potluck-eval-1.2.9/setup.py`

 * *Files 11% similar despite different names*

```diff
@@ -10,15 +10,15 @@
     "beautifulsoup4",
     "importlib_resources",
     "python_dateutil"
 ]
 
 setuptools.setup(
     name="potluck-eval",
-    version="1.2.8",
+    version="1.2.9",
     requires=reqs,
     install_requires=reqs,
     extras_require={
         'test': [ "pytest" ],
         'expectations': [ "optimism>=2.7.5" ],
         'turtle_capture': [ "Pillow>=6.0.0" ], # note: also ghostscript!
         'synth': [ "wavesynth>=1.0.3" ],
```

### Comparing `potluck-eval-1.2.8/tox.ini` & `potluck-eval-1.2.9/tox.ini`

 * *Files identical despite different names*


# Comparing `tmp/tokmon-0.1.4.tar.gz` & `tmp/tokmon-0.2.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "tokmon-0.1.4.tar", last modified: Fri Apr 21 01:06:17 2023, max compression
+gzip compressed data, was "tokmon-0.2.0.tar", last modified: Wed Apr 26 02:14:59 2023, max compression
```

## Comparing `tokmon-0.1.4.tar` & `tokmon-0.2.0.tar`

### file list

```diff
@@ -1,19 +1,21 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-21 01:06:17.750890 tokmon-0.1.4/
--rw-r--r--   0 runner    (1001) docker     (123)    11336 2023-04-21 01:06:02.000000 tokmon-0.1.4/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     7592 2023-04-21 01:06:17.750890 tokmon-0.1.4/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     7244 2023-04-21 01:06:02.000000 tokmon-0.1.4/README.md
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-04-21 01:06:17.750890 tokmon-0.1.4/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)      920 2023-04-21 01:06:02.000000 tokmon-0.1.4/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-21 01:06:17.746890 tokmon-0.1.4/tokmon/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-21 01:06:02.000000 tokmon-0.1.4/tokmon/__init__.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     5375 2023-04-21 01:06:02.000000 tokmon-0.1.4/tokmon/cli.py
--rw-r--r--   0 runner    (1001) docker     (123)     3370 2023-04-21 01:06:02.000000 tokmon-0.1.4/tokmon/costcalculator.py
--rw-r--r--   0 runner    (1001) docker     (123)     1021 2023-04-21 01:06:02.000000 tokmon-0.1.4/tokmon/openai-pricing.json
--rwxr-xr-x   0 runner    (1001) docker     (123)     9233 2023-04-21 01:06:02.000000 tokmon-0.1.4/tokmon/tokmon.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-21 01:06:17.750890 tokmon-0.1.4/tokmon.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     7592 2023-04-21 01:06:17.000000 tokmon-0.1.4/tokmon.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)      310 2023-04-21 01:06:17.000000 tokmon-0.1.4/tokmon.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-21 01:06:17.000000 tokmon-0.1.4/tokmon.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)       42 2023-04-21 01:06:17.000000 tokmon-0.1.4/tokmon.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (123)       19 2023-04-21 01:06:17.000000 tokmon-0.1.4/tokmon.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        7 2023-04-21 01:06:17.000000 tokmon-0.1.4/tokmon.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-26 02:14:59.357382 tokmon-0.2.0/
+-rw-r--r--   0 runner    (1001) docker     (123)    11336 2023-04-26 02:14:46.000000 tokmon-0.2.0/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     9958 2023-04-26 02:14:59.357382 tokmon-0.2.0/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     9610 2023-04-26 02:14:46.000000 tokmon-0.2.0/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-04-26 02:14:59.357382 tokmon-0.2.0/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)      920 2023-04-26 02:14:46.000000 tokmon-0.2.0/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-26 02:14:59.357382 tokmon-0.2.0/tokmon/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-26 02:14:46.000000 tokmon-0.2.0/tokmon/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3816 2023-04-26 02:14:46.000000 tokmon-0.2.0/tokmon/beam.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     7617 2023-04-26 02:14:46.000000 tokmon-0.2.0/tokmon/cli.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3499 2023-04-26 02:14:46.000000 tokmon-0.2.0/tokmon/costcalculator.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1021 2023-04-26 02:14:46.000000 tokmon-0.2.0/tokmon/openai-pricing.json
+-rwxr-xr-x   0 runner    (1001) docker     (123)     9442 2023-04-26 02:14:46.000000 tokmon-0.2.0/tokmon/tokmon.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1128 2023-04-26 02:14:46.000000 tokmon-0.2.0/tokmon/utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-26 02:14:59.357382 tokmon-0.2.0/tokmon.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     9958 2023-04-26 02:14:59.000000 tokmon-0.2.0/tokmon.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)      341 2023-04-26 02:14:59.000000 tokmon-0.2.0/tokmon.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-26 02:14:59.000000 tokmon-0.2.0/tokmon.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       42 2023-04-26 02:14:59.000000 tokmon-0.2.0/tokmon.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       19 2023-04-26 02:14:59.000000 tokmon-0.2.0/tokmon.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        7 2023-04-26 02:14:59.000000 tokmon-0.2.0/tokmon.egg-info/top_level.txt
```

### Comparing `tokmon-0.1.4/LICENSE` & `tokmon-0.2.0/LICENSE`

 * *Files identical despite different names*

### Comparing `tokmon-0.1.4/PKG-INFO` & `tokmon-0.2.0/README.md`

 * *Files 25% similar despite different names*

```diff
@@ -1,475 +1,601 @@
-00000000: 4d65 7461 6461 7461 2d56 6572 7369 6f6e  Metadata-Version
-00000010: 3a20 322e 310a 4e61 6d65 3a20 746f 6b6d  : 2.1.Name: tokm
-00000020: 6f6e 0a56 6572 7369 6f6e 3a20 302e 312e  on.Version: 0.1.
-00000030: 340a 5375 6d6d 6172 793a 2074 6f6b 6d6f  4.Summary: tokmo
-00000040: 6e20 6973 2061 2043 4c49 2075 7469 6c69  n is a CLI utili
-00000050: 7479 2074 6f20 6d6f 6e69 746f 7220 4f70  ty to monitor Op
-00000060: 656e 4149 2074 6f6b 656e 2075 7361 6765  enAI token usage
-00000070: 2061 6e64 2063 6f73 7473 0a48 6f6d 652d   and costs.Home-
-00000080: 7061 6765 3a20 6874 7470 733a 2f2f 6769  page: https://gi
-00000090: 7468 7562 2e63 6f6d 2f79 6167 696c 2f74  thub.com/yagil/t
-000000a0: 6f6b 6d6f 6e0a 5072 6f6a 6563 742d 5552  okmon.Project-UR
-000000b0: 4c3a 2042 7567 2052 6570 6f72 7473 2c20  L: Bug Reports, 
-000000c0: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-000000d0: 6f6d 2f79 6167 696c 2f74 6f6b 6d6f 6e2f  om/yagil/tokmon/
-000000e0: 6973 7375 6573 0a50 726f 6a65 6374 2d55  issues.Project-U
-000000f0: 524c 3a20 536f 7572 6365 2c20 6874 7470  RL: Source, http
-00000100: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f79  s://github.com/y
-00000110: 6167 696c 2f74 6f6b 6d6f 6e2f 0a44 6573  agil/tokmon/.Des
-00000120: 6372 6970 7469 6f6e 2d43 6f6e 7465 6e74  cription-Content
-00000130: 2d54 7970 653a 2074 6578 742f 6d61 726b  -Type: text/mark
-00000140: 646f 776e 0a4c 6963 656e 7365 2d46 696c  down.License-Fil
-00000150: 653a 204c 4943 454e 5345 0a0a 2320 6074  e: LICENSE..# `t
-00000160: 6f6b 6d6f 6e60 20f0 9f94 a4f0 9fa7 9020  okmon` ........ 
-00000170: 2d20 434c 4920 7574 696c 6974 7920 746f  - CLI utility to
-00000180: 206d 6f6e 6974 6f72 204f 7065 6e41 4920   monitor OpenAI 
-00000190: 746f 6b65 6e20 636f 7374 730a 0a60 746f  token costs..`to
-000001a0: 6b6d 6f6e 6020 656e 6162 6c65 7320 796f  kmon` enables yo
-000001b0: 7520 746f 206d 6f6e 6974 6f72 2079 6f75  u to monitor you
-000001c0: 7220 7072 6f67 7261 6d27 7320 4f70 656e  r program's Open
-000001d0: 4149 2041 5049 2074 6f6b 656e 2075 7361  AI API token usa
-000001e0: 6765 2e0a 0a59 6f75 2075 7365 2060 746f  ge...You use `to
-000001f0: 6b6d 6f6e 6020 6a75 7374 206c 696b 6520  kmon` just like 
-00000200: 796f 7520 776f 756c 6420 7573 6520 7468  you would use th
-00000210: 6520 6074 696d 6560 2075 7469 6c69 7479  e `time` utility
-00000220: 2c20 6275 7420 696e 7374 6561 6420 6f66  , but instead of
-00000230: 2065 7865 6375 7469 6f6e 2074 696d 6520   execution time 
-00000240: 796f 7520 6765 7420 746f 6b65 6e20 7573  you get token us
-00000250: 6167 6520 616e 6420 636f 7374 2e0a 3c70  age and cost..<p
-00000260: 2061 6c69 676e 3d22 6365 6e74 6572 223e   align="center">
-00000270: 0a20 2020 203c 696d 6720 7372 633d 2268  .    <img src="h
-00000280: 7474 7073 3a2f 2f75 7365 722d 696d 6167  ttps://user-imag
-00000290: 6573 2e67 6974 6875 6275 7365 7263 6f6e  es.githubusercon
-000002a0: 7465 6e74 2e63 6f6d 2f33 3631 3130 3432  tent.com/3611042
-000002b0: 2f32 3331 3931 3032 3734 2d33 3837 3265  /231910274-3872e
-000002c0: 3133 662d 6439 6536 2d34 3735 322d 6263  13f-d9e6-4752-bc
-000002d0: 3839 2d34 3465 3564 3333 3465 3231 662e  89-44e5d334e21f.
-000002e0: 6769 6622 202f 3e0a 3c2f 703e 0a0a 2323  gif" />.</p>..##
-000002f0: 2054 7279 2069 7420 6f75 740a 0a60 6060   Try it out..```
-00000300: 6261 7368 0a0a 2320 496e 7374 616c 6c20  bash..# Install 
-00000310: 746f 6b6d 6f6e 0a70 6970 2069 6e73 7461  tokmon.pip insta
-00000320: 6c6c 2074 6f6b 6d6f 6e0a 0a23 2043 6c6f  ll tokmon..# Clo
-00000330: 6e65 2074 6869 7320 7265 706f 2061 6e64  ne this repo and
-00000340: 2060 6364 6020 696e 746f 2074 6865 2060   `cd` into the `
-00000350: 746f 6b6d 6f6e 6020 666f 6c64 6572 0a67  tokmon` folder.g
-00000360: 6974 2063 6c6f 6e65 2068 7474 7073 3a2f  it clone https:/
-00000370: 2f67 6974 6875 622e 636f 6d2f 7961 6769  /github.com/yagi
-00000380: 6c2f 746f 6b6d 6f6e 2e67 6974 2026 2620  l/tokmon.git && 
-00000390: 6364 2074 6f6b 6d6f 6e0a 0a23 2065 7870  cd tokmon..# exp
-000003a0: 6f72 7420 796f 7572 204f 7065 6e41 4920  ort your OpenAI 
-000003b0: 4150 4920 6b65 792e 2054 6869 7320 7769  API key. This wi
-000003c0: 6c6c 2062 6520 7573 6564 2069 6e20 7468  ll be used in th
-000003d0: 6520 7465 7374 2070 726f 6772 616d 2028  e test program (
-000003e0: 736f 7572 6365 2069 6e20 2e2f 7465 7374  source in ./test
-000003f0: 732f 7079 7468 6f6e 5f65 7861 6d70 6c65  s/python_example
-00000400: 2e70 7929 0a65 7870 6f72 7420 4f50 454e  .py).export OPEN
-00000410: 4149 5f41 5049 5f4b 4559 3d22 594f 5552  AI_API_KEY="YOUR
-00000420: 5f4f 5045 4e41 495f 4150 495f 4b45 5922  _OPENAI_API_KEY"
-00000430: 200a 0a23 2052 756e 2074 6f6b 6d6f 6e0a   ..# Run tokmon.
-00000440: 746f 6b6d 6f6e 202d 2d6a 736f 6e5f 6f75  tokmon --json_ou
-00000450: 743d 2e20 7079 7468 6f6e 3320 2e2f 7465  t=. python3 ./te
-00000460: 7374 732f 7079 7468 6f6e 5f65 7861 6d70  sts/python_examp
-00000470: 6c65 2e70 7920 2d2d 7072 6f6d 7074 2022  le.py --prompt "
-00000480: 7361 7920 2768 656c 6c6f 2c20 746f 6b6d  say 'hello, tokm
-00000490: 6f6e 2127 220a 6060 600a 0a41 6674 6572  on!'".```..After
-000004a0: 2079 6f75 7220 7072 6f67 7261 6d20 6669   your program fi
-000004b0: 6e69 7368 6573 2072 756e 6e69 6e67 2028  nishes running (
-000004c0: 6f72 2079 6f75 2060 6374 726c 5e43 6020  or you `ctrl^C` 
-000004d0: 6974 292c 2060 746f 6b6d 6f6e 6020 7769  it), `tokmon` wi
-000004e0: 6c6c 2061 7574 6f6d 6174 6963 616c 6c79  ll automatically
-000004f0: 2067 656e 6572 6174 6520 6120 636f 7374   generate a cost
-00000500: 2072 6570 6f72 7420 7468 6174 206c 6f6f   report that loo
-00000510: 6b73 206c 696b 6520 7468 6973 3a3c 6272  ks like this:<br
-00000520: 3e0a 0a60 6060 7961 6d6c 0a74 6f6b 6d6f  >..```yaml.tokmo
-00000530: 6e20 636f 7374 2072 6570 6f72 743a 0a3d  n cost report:.=
-00000540: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00000000: 3c70 7265 2061 6c69 676e 3d22 6365 6e74  <pre align="cent
+00000010: 6572 223e 0a0a 205f 5f5f 5f5f 5f20 2020  er">.. ______   
+00000020: 5f5f 5f5f 5f5f 2020 2020 5f5f 2020 5f5f  ______    __  __
+00000030: 2020 2020 5f5f 2020 2020 5f5f 2020 2020      __    __    
+00000040: 5f5f 5f5f 5f5f 2020 2020 5f5f 2020 205f  ______    __   _
+00000050: 5f20 2020 200a 2f5c 5f5f 2020 5f5c 202f  _    ./\__  _\ /
+00000060: 5c20 205f 5f20 5c20 202f 5c20 5c2f 202f  \  __ \  /\ \/ /
+00000070: 2020 202f 5c20 222d 2e2f 2020 5c20 202f     /\ "-./  \  /
+00000080: 5c20 205f 5f20 5c20 202f 5c20 222d 2e5c  \  __ \  /\ "-.\
+00000090: 205c 2020 200a 5c2f 5f2f 5c20 5c2f 205c   \   .\/_/\ \/ \
+000000a0: 205c 205c 2f5c 205c 205c 205c 2020 5f22   \ \/\ \ \ \  _"
+000000b0: 2d2e 205c 205c 205c 2d2e 2f5c 205c 205c  -. \ \ \-./\ \ \
+000000c0: 205c 205c 2f5c 205c 205c 205c 205c 2d2e   \ \/\ \ \ \ \-.
+000000d0: 2020 5c20 200a 2020 205c 205c 5f5c 2020    \  .   \ \_\  
+000000e0: 5c20 5c5f 5f5f 5f5f 5c20 5c20 5c5f 5c20  \ \_____\ \ \_\ 
+000000f0: 5c5f 5c20 5c20 5c5f 5c20 5c20 5c5f 5c20  \_\ \ \_\ \ \_\ 
+00000100: 5c20 5c5f 5f5f 5f5f 5c20 5c20 5c5f 5c5c  \ \_____\ \ \_\\
+00000110: 225c 5f5c 200a 2020 2020 5c2f 5f2f 2020  "\_\ .    \/_/  
+00000120: 205c 2f5f 5f5f 5f5f 2f20 205c 2f5f 2f5c   \/_____/  \/_/\
+00000130: 2f5f 2f20 205c 2f5f 2f20 205c 2f5f 2f20  /_/  \/_/  \/_/ 
+00000140: 205c 2f5f 5f5f 5f5f 2f20 205c 2f5f 2f20   \/_____/  \/_/ 
+00000150: 5c2f 5f2f 200a 2020 2020 2020 2020 2020  \/_/ .          
+00000160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000190: 2020 2020 2020 2020 200a 0a43 4c49 2075           ..CLI u
+000001a0: 7469 6c69 7479 2074 6f20 6d6f 6e69 746f  tility to monito
+000001b0: 7220 796f 7572 204f 7065 6e41 4920 4150  r your OpenAI AP
+000001c0: 4920 746f 6b65 6e20 7573 6167 650a 2020  I token usage.  
+000001d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000001e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000001f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000210: 200a 3c2f 7072 653e 0a0a 3c70 2061 6c69   .</pre>..<p ali
+00000220: 676e 3d22 6365 6e74 6572 223e e29a a1ef  gn="center">....
+00000230: b88f 3c69 3e3c 623e 4e45 573c 2f62 3e3c  ..<i><b>NEW</b><
+00000240: 2f69 3e3a 203c 6120 6872 6566 3d22 6874  /i>: <a href="ht
+00000250: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00000260: 2f79 6167 696c 2f74 6f6b 6d6f 6e2d 6265  /yagil/tokmon-be
+00000270: 616d 223e 2074 6f6b 6d6f 6e20 6265 616d  am"> tokmon beam
+00000280: 203c 2f61 3e20 2d20 6120 7365 6c66 2d68   </a> - a self-h
+00000290: 6f73 7465 6420 7765 6220 5549 2074 6f20  osted web UI to 
+000002a0: 6d6f 6e69 746f 7220 4150 4920 7573 6167  monitor API usag
+000002b0: 6520 6461 7461 2c20 7275 6e6e 696e 6720  e data, running 
+000002c0: 6672 6f6d 203c 636f 6465 3e6c 6f63 616c  from <code>local
+000002d0: 686f 7374 3c2f 636f 6465 3e2e 3c2f 703e  host</code>.</p>
+000002e0: 0a0a 3c70 2061 6c69 676e 3d22 6365 6e74  ..<p align="cent
+000002f0: 6572 223e 0a20 203c 6120 6872 6566 3d22  er">.  <a href="
+00000300: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+00000310: 6f6d 2f79 6167 696c 2f74 6f6b 6d6f 6e2f  om/yagil/tokmon/
+00000320: 626c 6f62 2f6d 6169 6e2f 4c49 4345 4e53  blob/main/LICENS
+00000330: 4522 2074 6172 6765 743d 225f 626c 616e  E" target="_blan
+00000340: 6b22 3e0a 2020 2020 2020 3c69 6d67 2073  k">.      <img s
+00000350: 7263 3d22 6874 7470 733a 2f2f 696d 672e  rc="https://img.
+00000360: 7368 6965 6c64 732e 696f 2f62 6164 6765  shields.io/badge
+00000370: 2f4c 6963 656e 7365 2d41 7061 6368 6532  /License-Apache2
+00000380: 2e30 2d6f 7261 6e67 652e 7376 6722 2061  .0-orange.svg" a
+00000390: 6c74 3d22 4c69 6365 6e73 6522 3e0a 2020  lt="License">.  
+000003a0: 3c2f 613e 0a3c 2f70 3e0a 0a23 2060 746f  </a>.</p>..# `to
+000003b0: 6b6d 6f6e 6020 f09f 94a4 f09f a790 202d  kmon` ........ -
+000003c0: 2043 4c49 2074 6f20 6d6f 6e69 746f 7220   CLI to monitor 
+000003d0: 4f70 656e 4149 2041 5049 2075 7361 6765  OpenAI API usage
+000003e0: 0a0a 6074 6f6b 6d6f 6e60 2028 2a2a 546f  ..`tokmon` (**To
+000003f0: 6b2a 2a65 6e20 2a2a 4d6f 6e2a 2a69 746f  k**en **Mon**ito
+00000400: 7229 206b 6565 7073 2074 7261 636b 206f  r) keeps track o
+00000410: 6620 796f 7572 2070 726f 6772 616d 2773  f your program's
+00000420: 204f 7065 6e41 4920 4150 4920 746f 6b65   OpenAI API toke
+00000430: 6e20 7573 6167 652e 0a0a 596f 7520 6361  n usage...You ca
+00000440: 6e20 7573 6520 6074 6f6b 6d6f 6e60 206a  n use `tokmon` j
+00000450: 7573 7420 6c69 6b65 2079 6f75 2077 6f75  ust like you wou
+00000460: 6c64 2075 7365 2074 6865 2060 7469 6d65  ld use the `time
+00000470: 6020 7574 696c 6974 792c 2062 7574 2069  ` utility, but i
+00000480: 6e73 7465 6164 206f 6620 6578 6563 7574  nstead of execut
+00000490: 696f 6e20 7469 6d65 2079 6f75 2067 6574  ion time you get
+000004a0: 2074 6f6b 656e 2075 7361 6765 2061 6e64   token usage and
+000004b0: 2063 6f73 742e 0a0a 2323 2049 6e73 7461   cost...## Insta
+000004c0: 6c6c 6174 696f 6e0a 6060 600a 7069 7020  llation.```.pip 
+000004d0: 696e 7374 616c 6c20 746f 6b6d 6f6e 0a60  install tokmon.`
+000004e0: 6060 0a23 2320 5573 6167 650a 6060 6062  ``.## Usage.```b
+000004f0: 6173 680a 2420 746f 6b6d 6f6e 202f 7061  ash.$ tokmon /pa
+00000500: 7468 2f74 6f2f 796f 7572 2f3c 796f 7572  th/to/your/<your
+00000510: 2070 726f 6772 616d 3e20 5b61 7267 315d   program> [arg1]
+00000520: 205b 6172 6732 5d20 2e2e 2e0a 6060 600a   [arg2] ....```.
+00000530: 0a60 6060 6373 730a 746f 6b6d 6f6e 2063  .```css.tokmon c
+00000540: 6f73 7420 7265 706f 7274 3a0a 3d3d 3d3d  ost report:.====
 00000550: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
 00000560: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
 00000570: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00000580: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
-00000590: 4d6f 6e69 746f 7265 6420 696e 766f 6361  Monitored invoca
-000005a0: 7469 6f6e 3a20 2e2f 7079 7468 6f6e 5f65  tion: ./python_e
-000005b0: 7861 6d70 6c65 2e70 7920 2d69 0a4d 6f64  xample.py -i.Mod
-000005c0: 656c 733a 205b 2767 7074 2d33 2e35 2d74  els: ['gpt-3.5-t
-000005d0: 7572 626f 2d30 3330 3127 5d0a 546f 7461  urbo-0301'].Tota
-000005e0: 6c20 5573 6167 653a 207b 2774 6f74 616c  l Usage: {'total
-000005f0: 5f70 726f 6d70 745f 746f 6b65 6e73 273a  _prompt_tokens':
-00000600: 2034 392c 2027 746f 7461 6c5f 636f 6d70   49, 'total_comp
-00000610: 6c65 7469 6f6e 5f74 6f6b 656e 7327 3a20  letion_tokens': 
-00000620: 3434 2c20 2774 6f74 616c 5f74 6f6b 656e  44, 'total_token
-00000630: 7327 3a20 3933 7d0a 5072 6963 696e 673a  s': 93}.Pricing:
-00000640: 207b 2767 7074 2d33 2e35 2d74 7572 626f   {'gpt-3.5-turbo
-00000650: 2d30 3330 3127 3a20 7b27 7072 6f6d 7074  -0301': {'prompt
-00000660: 5f63 6f73 7427 3a20 302e 3030 322c 2027  _cost': 0.002, '
-00000670: 636f 6d70 6c65 7469 6f6e 5f63 6f73 7427  completion_cost'
-00000680: 3a20 302e 3030 322c 2027 7065 725f 746f  : 0.002, 'per_to
-00000690: 6b65 6e73 273a 2031 3030 307d 7d0a 546f  kens': 1000}}.To
-000006a0: 7461 6c20 436f 7374 3a20 2430 2e30 3030  tal Cost: $0.000
-000006b0: 3138 360a 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  186.============
-000006c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000006d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000006e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00000580: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00000590: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a4d 6f6e  ============.Mon
+000005a0: 6974 6f72 6564 2069 6e76 6f63 6174 696f  itored invocatio
+000005b0: 6e3a 2070 7974 686f 6e33 202e 2f74 6573  n: python3 ./tes
+000005c0: 7473 2f70 7974 686f 6e5f 6578 616d 706c  ts/python_exampl
+000005d0: 652e 7079 202d 2d70 726f 6d70 7420 7361  e.py --prompt sa
+000005e0: 7920 2768 656c 6c6f 2c20 746f 6b6d 6f6e  y 'hello, tokmon
+000005f0: 2127 0a4d 6f64 656c 733a 205b 2767 7074  !'.Models: ['gpt
+00000600: 2d33 2e35 2d74 7572 626f 2d30 3330 3127  -3.5-turbo-0301'
+00000610: 5d0a 546f 7461 6c20 5573 6167 653a 207b  ].Total Usage: {
+00000620: 2774 6f74 616c 5f70 726f 6d70 745f 746f  'total_prompt_to
+00000630: 6b65 6e73 273a 2032 362c 2027 746f 7461  kens': 26, 'tota
+00000640: 6c5f 636f 6d70 6c65 7469 6f6e 5f74 6f6b  l_completion_tok
+00000650: 656e 7327 3a20 3132 2c20 2774 6f74 616c  ens': 12, 'total
+00000660: 5f74 6f6b 656e 7327 3a20 3338 7d0a 5072  _tokens': 38}.Pr
+00000670: 6963 696e 673a 207b 2767 7074 2d33 2e35  icing: {'gpt-3.5
+00000680: 2d74 7572 626f 2d30 3330 3127 3a20 7b27  -turbo-0301': {'
+00000690: 7072 6f6d 7074 5f63 6f73 7427 3a20 302e  prompt_cost': 0.
+000006a0: 3030 322c 2027 636f 6d70 6c65 7469 6f6e  002, 'completion
+000006b0: 5f63 6f73 7427 3a20 302e 3030 322c 2027  _cost': 0.002, '
+000006c0: 7065 725f 746f 6b65 6e73 273a 2031 3030  per_tokens': 100
+000006d0: 307d 7d0a 546f 7461 6c20 436f 7374 3a20  0}}.Total Cost: 
+000006e0: 2430 2e30 3030 3037 360a 3d3d 3d3d 3d3d  $0.000076.======
 000006f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00000700: 3d3d 3d3d 0a0a 5772 6974 696e 6720 636f  ====..Writing co
-00000710: 7374 2073 756d 6d61 7279 2074 6f20 4a53  st summary to JS
-00000720: 4f4e 2066 696c 653a 202f 746d 702f 746f  ON file: /tmp/to
-00000730: 6b6d 6f6e 5f75 7361 6765 5f73 756d 6d61  kmon_usage_summa
-00000740: 7279 5f31 3638 3134 3236 3635 302e 6a73  ry_1681426650.js
-00000750: 6f6e 0a60 6060 0a0a 2323 2323 2060 746f  on.```..#### `to
-00000760: 6b6d 6f6e 6020 616c 736f 2073 7570 706f  kmon` also suppo
-00000770: 7274 7320 7468 6973 3a0a 2d20 4966 2079  rts this:.- If y
-00000780: 6f75 7220 7072 6f67 7261 6d20 7573 6573  our program uses
-00000790: 206d 756c 7469 706c 6520 4f70 656e 4149   multiple OpenAI
-000007a0: 206d 6f64 656c 7320 696e 2074 6865 2073   models in the s
-000007b0: 616d 6520 696e 766f 6361 7469 6f6e 2c20  ame invocation, 
-000007c0: 7468 6569 7220 7265 7370 6563 7469 7665  their respective
-000007d0: 2075 7361 6765 7320 7769 6c6c 2062 6520   usages will be 
-000007e0: 7265 666c 6563 7465 6420 696e 2074 6865  reflected in the
-000007f0: 2072 6570 6f72 742e 0a2d 2059 6f75 2063   report..- You c
-00000800: 616e 2072 756e 206d 756c 7469 706c 6520  an run multiple 
-00000810: 696e 7374 616e 6365 7320 6f66 2060 746f  instances of `to
-00000820: 6b6d 6f6e 6020 7369 6d75 6c74 616e 656f  kmon` simultaneo
-00000830: 7573 6c79 2e20 4561 6368 2069 6e76 6f63  usly. Each invoc
-00000840: 6174 696f 6e20 7769 6c6c 2067 656e 6572  ation will gener
-00000850: 6174 6520 6120 7365 7061 7261 7465 2075  ate a separate u
-00000860: 7361 6765 2072 6570 6f72 742e 0a2d 2050  sage report..- P
-00000870: 6173 7320 6120 602d 2d6a 736f 6e5f 6f75  ass a `--json_ou
-00000880: 7420 2f79 6f75 722f 7061 7468 2f72 6570  t /your/path/rep
-00000890: 6f72 742e 6a73 6f6e 6020 746f 2067 6574  ort.json` to get
-000008a0: 2061 2064 6574 6169 6c65 6420 6272 6561   a detailed brea
-000008b0: 6b64 6f77 6e20 2b20 636f 6e76 6572 7361  kdown + conversa
-000008c0: 7469 6f6e 2068 6973 746f 7279 2069 6e20  tion history in 
-000008d0: 4a53 4f4e 2066 6f72 6d61 742e 0a0a 2320  JSON format...# 
-000008e0: 4765 7420 7374 6172 7465 6420 7769 7468  Get started with
-000008f0: 2060 746f 6b6d 6f6e 600a 0a23 2320 496e   `tokmon`..## In
-00000900: 7374 616c 6c20 6074 6f6b 6d6f 6e60 2076  stall `tokmon` v
-00000910: 6961 2060 7069 7060 0a60 6060 0a70 6970  ia `pip`.```.pip
-00000920: 2069 6e73 7461 6c6c 2074 6f6b 6d6f 6e0a   install tokmon.
-00000930: 6060 600a 0a4d 616b 6520 7375 7265 2069  ```..Make sure i
-00000940: 6e73 7461 6c6c 6174 696f 6e20 776f 726b  nstallation work
-00000950: 6564 2062 7920 7275 6e6e 696e 670a 6060  ed by running.``
-00000960: 600a 746f 6b6d 6f6e 202d 2d68 656c 700a  `.tokmon --help.
-00000970: 6060 600a 0a54 6f20 756e 696e 7374 616c  ```..To uninstal
-00000980: 6c2c 2072 756e 2060 7069 7020 756e 696e  l, run `pip unin
-00000990: 7374 616c 6c20 746f 6b6d 6f6e 603c 6272  stall tokmon`<br
-000009a0: 3e0a 0a0a 2323 2055 7365 2060 746f 6b6d  >...## Use `tokm
-000009b0: 6f6e 6020 7769 7468 2079 6f75 7220 6170  on` with your ap
-000009c0: 706c 6963 6174 696f 6e20 6f72 2073 6372  plication or scr
-000009d0: 6970 740a 0a3e 202a 2a57 6172 6e69 6e67  ipt..> **Warning
-000009e0: 2a2a 0a3e 2054 6869 7320 6973 2061 2064  **.> This is a d
-000009f0: 6562 7567 6769 6e67 2074 6f6f 6c2e 2049  ebugging tool. I
-00000a00: 7420 6973 206e 6f74 2069 6e74 656e 6465  t is not intende
-00000a10: 6420 746f 2062 6520 7573 6564 2069 6e20  d to be used in 
-00000a20: 616e 7920 636f 6e73 6571 7565 6e74 6961  any consequentia
-00000a30: 6c20 7365 7474 696e 672e 2055 7365 2079  l setting. Use y
-00000a40: 6f75 7220 6265 7374 206a 7564 6765 6d65  our best judgeme
-00000a50: 6e74 2c20 796f 7527 7265 206f 6e20 796f  nt, you're on yo
-00000a60: 7572 206f 776e 210a 0a50 7265 7065 6e64  ur own!..Prepend
-00000a70: 2060 746f 6b6d 6f6e 6020 746f 2079 6f75   `tokmon` to you
-00000a80: 7220 6e6f 726d 616c 2070 726f 6772 616d  r normal program
-00000a90: 2069 6e76 6f63 6174 696f 6e20 6c69 6b65   invocation like
-00000aa0: 2073 6f3a 0a60 6060 6261 7368 0a24 2074   so:.```bash.$ t
-00000ab0: 6f6b 6d6f 6e20 3c79 6f75 7220 7072 6f67  okmon <your prog
-00000ac0: 7261 6d3e 205b 6172 6731 5d20 5b61 7267  ram> [arg1] [arg
-00000ad0: 325d 202e 2e2e 0a60 6060 0a52 756e 2061  2] ....```.Run a
-00000ae0: 6e64 2075 7365 2079 6f75 7220 7072 6f67  nd use your prog
-00000af0: 7261 6d20 6a75 7374 206c 696b 6520 796f  ram just like yo
-00000b00: 7520 776f 756c 6420 6e6f 726d 616c 6c79  u would normally
-00000b10: 2028 6172 6775 6d65 6e74 7320 616e 6420   (arguments and 
-00000b20: 616c 6c29 2e20 496e 7465 7261 6374 6976  all). Interactiv
-00000b30: 6520 7573 6167 6520 6973 2073 7570 706f  e usage is suppo
-00000b40: 7274 6564 2061 7320 7765 6c6c 2e0a 0a0a  rted as well....
-00000b50: 2323 2046 756c 6c20 7573 6167 6520 616e  ## Full usage an
-00000b60: 6420 636f 7374 2073 756d 6d61 7279 2028  d cost summary (
-00000b70: 4a53 4f4e 290a 0a60 6060 6a73 6f6e 0a7b  JSON)..```json.{
-00000b80: 0a20 2020 2022 746f 7461 6c5f 636f 7374  .    "total_cost
-00000b90: 223a 2030 2e30 3031 3931 3939 3939 3939  ": 0.00191999999
-00000ba0: 3939 3939 3939 3938 2c0a 2020 2020 2274  99999998,.    "t
-00000bb0: 6f74 616c 5f75 7361 6765 223a 207b 0a20  otal_usage": {. 
-00000bc0: 2020 2020 2020 2022 746f 7461 6c5f 7072         "total_pr
-00000bd0: 6f6d 7074 5f74 6f6b 656e 7322 3a20 3138  ompt_tokens": 18
-00000be0: 2c0a 2020 2020 2020 2020 2274 6f74 616c  ,.        "total
-00000bf0: 5f63 6f6d 706c 6574 696f 6e5f 746f 6b65  _completion_toke
-00000c00: 6e73 223a 2032 332c 0a20 2020 2020 2020  ns": 23,.       
-00000c10: 2022 746f 7461 6c5f 746f 6b65 6e73 223a   "total_tokens":
-00000c20: 2034 310a 2020 2020 7d2c 0a20 2020 2022   41.    },.    "
-00000c30: 7072 6963 696e 675f 6461 7461 223a 2022  pricing_data": "
-00000c40: 7b27 6770 742d 342d 3033 3134 273a 207b  {'gpt-4-0314': {
-00000c50: 2770 726f 6d70 745f 636f 7374 273a 2030  'prompt_cost': 0
-00000c60: 2e30 332c 2027 636f 6d70 6c65 7469 6f6e  .03, 'completion
-00000c70: 5f63 6f73 7427 3a20 302e 3036 2c20 2770  _cost': 0.06, 'p
-00000c80: 6572 5f74 6f6b 656e 7327 3a20 3130 3030  er_tokens': 1000
-00000c90: 7d7d 222c 0a20 2020 2022 6d6f 6465 6c73  }}",.    "models
-00000ca0: 223a 205b 0a20 2020 2020 2020 2022 6770  ": [.        "gp
-00000cb0: 742d 342d 3033 3134 220a 2020 2020 5d2c  t-4-0314".    ],
-00000cc0: 0a20 2020 2022 7261 775f 6461 7461 223a  .    "raw_data":
-00000cd0: 205b 0a20 2020 2020 2020 207b 0a20 2020   [.        {.   
-00000ce0: 2020 2020 2020 2020 2022 6d6f 6465 6c22           "model"
-00000cf0: 3a20 2267 7074 2d34 2d30 3331 3422 2c0a  : "gpt-4-0314",.
-00000d00: 2020 2020 2020 2020 2020 2020 2275 7361              "usa
-00000d10: 6765 223a 207b 0a20 2020 2020 2020 2020  ge": {.         
-00000d20: 2020 2020 2020 2022 7072 6f6d 7074 5f74         "prompt_t
-00000d30: 6f6b 656e 7322 3a20 3138 2c0a 2020 2020  okens": 18,.    
-00000d40: 2020 2020 2020 2020 2020 2020 2263 6f6d              "com
-00000d50: 706c 6574 696f 6e5f 746f 6b65 6e73 223a  pletion_tokens":
-00000d60: 2032 332c 0a20 2020 2020 2020 2020 2020   23,.           
-00000d70: 2020 2020 2022 746f 7461 6c5f 746f 6b65       "total_toke
-00000d80: 6e73 223a 2034 310a 2020 2020 2020 2020  ns": 41.        
-00000d90: 2020 2020 7d2c 0a20 2020 2020 2020 2020      },.         
-00000da0: 2020 2022 636f 7374 223a 2030 2e30 3031     "cost": 0.001
-00000db0: 3931 3939 3939 3939 3939 3939 3939 3938  9199999999999998
-00000dc0: 2c0a 2020 2020 2020 2020 2020 2020 226d  ,.            "m
-00000dd0: 6573 7361 6765 7322 3a20 5b0a 2020 2020  essages": [.    
-00000de0: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
-00000df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000e00: 2020 2272 6f6c 6522 3a20 2273 7973 7465    "role": "syste
-00000e10: 6d22 2c0a 2020 2020 2020 2020 2020 2020  m",.            
-00000e20: 2020 2020 2020 2020 2263 6f6e 7465 6e74          "content
-00000e30: 223a 2022 596f 7527 7265 2061 2068 656c  ": "You're a hel
-00000e40: 7066 756c 2061 7373 6973 7461 6e74 2e22  pful assistant."
-00000e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000e60: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-00000e70: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-00000e80: 2020 2020 2020 2020 2020 2272 6f6c 6522            "role"
-00000e90: 3a20 2275 7365 7222 2c0a 2020 2020 2020  : "user",.      
-00000ea0: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-00000eb0: 6f6e 7465 6e74 223a 2022 6865 6c6c 6f22  ontent": "hello"
-00000ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000ed0: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-00000ee0: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-00000ef0: 2020 2020 2020 2020 2020 2272 6f6c 6522            "role"
-00000f00: 3a20 2261 7373 6973 7461 6e74 222c 0a20  : "assistant",. 
-00000f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000f20: 2020 2022 636f 6e74 656e 7422 3a20 2248     "content": "H
-00000f30: 656c 6c6f 2120 486f 7720 6361 6e20 4920  ello! How can I 
-00000f40: 6865 6c70 2079 6f75 2074 6f64 6179 3f20  help you today? 
-00000f50: 4966 2079 6f75 2068 6176 6520 616e 7920  If you have any 
-00000f60: 7175 6573 7469 6f6e 7320 6f72 206e 6565  questions or nee
-00000f70: 6420 6173 7369 7374 616e 6365 2c20 6665  d assistance, fe
-00000f80: 656c 2066 7265 6520 746f 2061 736b 2e22  el free to ask."
-00000f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000fa0: 207d 0a20 2020 2020 2020 2020 2020 205d   }.            ]
-00000fb0: 0a20 2020 2020 2020 207d 0a20 2020 205d  .        }.    ]
-00000fc0: 0a7d 0a60 6060 0a0a 2323 2048 6f77 2069  .}.```..## How i
-00000fd0: 7420 776f 726b 730a 6074 6f6b 6d6f 6e60  t works.`tokmon`
-00000fe0: 2075 7365 7320 7468 6520 5b6d 6974 6d70   uses the [mitmp
-00000ff0: 726f 7879 206c 6962 7261 7279 5d28 6874  roxy library](ht
-00001000: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-00001010: 2f6d 6974 6d70 726f 7879 2f6d 6974 6d70  /mitmproxy/mitmp
-00001020: 726f 7879 2920 746f 2069 6e74 6572 6365  roxy) to interce
-00001030: 7074 2048 5454 5020 7265 7175 6573 7473  pt HTTP requests
-00001040: 2061 6e64 2072 6573 706f 6e73 6573 2062   and responses b
-00001050: 6574 7765 656e 2079 6f75 7220 7072 6f67  etween your prog
-00001060: 7261 6d20 616e 6420 7468 6520 4f70 656e  ram and the Open
-00001070: 4149 2041 5049 2e0a 4974 2074 6865 6e20  AI API..It then 
-00001080: 7072 6f63 6573 7365 7320 7468 6520 7265  processes the re
-00001090: 7175 6573 7420 616e 6420 7265 7370 6f6e  quest and respon
-000010a0: 7365 2064 6174 6120 746f 2063 616c 6375  se data to calcu
-000010b0: 6c61 7465 2074 6f6b 656e 2075 7361 6765  late token usage
-000010c0: 2061 6e64 2063 6f73 7420 6261 7365 6420   and cost based 
-000010d0: 6f6e 205b 746f 6b6d 6f6e 2f6f 7065 6e61  on [tokmon/opena
-000010e0: 692d 7072 6963 696e 672e 6a73 6f6e 5d28  i-pricing.json](
-000010f0: 746f 6b6d 6f6e 2f6f 7065 6e61 692d 7072  tokmon/openai-pr
-00001100: 6963 696e 672e 6a73 6f6e 292e 0a0a 3e20  icing.json)...> 
-00001110: 6074 6f6b 6d6f 6e60 2077 6f72 6b73 2066  `tokmon` works f
-00001120: 6f72 2070 726f 6772 616d 7320 696e 2060  or programs in `
-00001130: 7079 7468 6f6e 6020 2f20 606e 6f64 6560  python` / `node`
-00001140: 2028 7573 696e 6720 4f70 656e 4149 2773   (using OpenAI's
-00001150: 2063 6c69 656e 7473 292c 206f 7220 6063   clients), or `c
-00001160: 7572 6c60 2028 7275 6e20 6469 7265 6374  url` (run direct
-00001170: 6c79 2c20 616e 6420 6e6f 7420 692e 652e  ly, and not i.e.
-00001180: 2069 6e20 6120 6261 7368 2073 6372 6970   in a bash scrip
-00001190: 7429 2e0a 0a3e 2069 6620 796f 7520 5b6d  t)...> if you [m
-000011a0: 616e 7561 6c6c 7920 696e 7374 616c 6c20  anually install 
-000011b0: 606d 6974 6d70 726f 7879 6027 7320 4341  `mitmproxy`'s CA
-000011c0: 2063 6572 7469 6669 6361 7465 5d28 6874   certificate](ht
-000011d0: 7470 733a 2f2f 646f 6373 2e6d 6974 6d70  tps://docs.mitmp
-000011e0: 726f 7879 2e6f 7267 2f73 7461 626c 652f  roxy.org/stable/
-000011f0: 636f 6e63 6570 7473 2d63 6572 7469 6669  concepts-certifi
-00001200: 6361 7465 732f 233a 7e3a 7465 7874 3d47  cates/#:~:text=G
-00001210: 6f25 3230 746f 2532 3053 6574 7469 6e67  o%20to%20Setting
-00001220: 7325 3230 2533 4525 3230 4765 6e65 7261  s%20%3E%20Genera
-00001230: 6c25 3230 2533 4525 3230 4162 6f75 742c  l%20%3E%20About,
-00001240: 7472 7573 7425 3230 666f 7225 3230 7468  trust%20for%20th
-00001250: 6525 3230 6d69 746d 7072 6f78 7925 3230  e%20mitmproxy%20
-00001260: 6365 7274 6966 6963 6174 6529 2c20 6974  certificate), it
-00001270: 2073 686f 756c 6420 776f 726b 2066 6f72   should work for
-00001280: 2061 6c6c 2065 7865 6375 7461 626c 6573   all executables
-00001290: 2028 6e6f 7465 3a20 6861 7665 6e27 7420   (note: haven't 
-000012a0: 7465 7374 6564 2074 6869 732e 290a 0a49  tested this.)..I
-000012b0: 6e20 6d6f 7374 2063 6173 6573 2c20 6074  n most cases, `t
-000012c0: 6f6b 6d6f 6e60 2072 656c 6965 7320 6f6e  okmon` relies on
-000012d0: 2074 6865 2060 7573 6167 6560 2066 6965   the `usage` fie
-000012e0: 6c64 2069 6e20 4f70 656e 4149 2773 2041  ld in OpenAI's A
-000012f0: 5049 2072 6573 706f 6e73 6573 2066 6f72  PI responses for
-00001300: 2074 6f6b 656e 2063 6f75 6e74 732e 2046   token counts. F
-00001310: 6f72 2073 7472 6561 6d69 6e67 2072 6571  or streaming req
-00001320: 7565 7374 732c 2068 6f77 6576 6572 2c20  uests, however, 
-00001330: 6074 6f6b 6d6f 6e60 2075 7365 7320 4f70  `tokmon` uses Op
-00001340: 656e 4149 2773 205b 7469 6b74 6f6b 656e  enAI's [tiktoken
-00001350: 206c 6962 7261 7279 5d28 6874 7470 733a   library](https:
-00001360: 2f2f 6769 7468 7562 2e63 6f6d 2f6f 7065  //github.com/ope
-00001370: 6e61 692f 7469 6b74 6f6b 656e 2920 6469  nai/tiktoken) di
-00001380: 7265 6374 6c79 2074 6f20 636f 756e 7420  rectly to count 
-00001390: 7468 6520 746f 6b65 6e73 2e20 4173 206f  the tokens. As o
-000013a0: 6620 7772 6974 696e 6720 4f70 656e 4149  f writing OpenAI
-000013b0: 2773 2041 5049 2064 6f65 7320 6e6f 7420  's API does not 
-000013c0: 7265 7475 726e 2075 7361 6765 2064 6174  return usage dat
-000013d0: 6120 666f 7220 7374 7265 616d 696e 6720  a for streaming 
-000013e0: 7265 7175 6573 7473 2028 5b72 6566 6572  requests ([refer
-000013f0: 656e 6365 5d28 6874 7470 733a 2f2f 636f  ence](https://co
-00001400: 6d6d 756e 6974 792e 6f70 656e 6169 2e63  mmunity.openai.c
-00001410: 6f6d 2f74 2f75 7361 6765 2d69 6e66 6f2d  om/t/usage-info-
-00001420: 696e 2d61 7069 2d72 6573 706f 6e73 6573  in-api-responses
-00001430: 2f31 3838 3632 2f31 3129 2e29 0a0a 2323  /18862/11).)..##
-00001440: 206f 7065 6e61 692d 7072 6963 696e 672e   openai-pricing.
-00001450: 6a73 6f6e 0a54 6865 2070 7269 6369 6e67  json.The pricing
-00001460: 2064 6174 6120 7761 7320 6578 7472 6163   data was extrac
-00001470: 7465 6420 6672 6f6d 204f 7065 6e41 4927  ted from OpenAI'
-00001480: 7320 7765 6273 6974 6520 7769 7468 2074  s website with t
-00001490: 6865 2068 656c 7020 6f66 2043 6861 7447  he help of ChatG
-000014a0: 5054 2e0a 0a60 746f 6b6d 6f6e 6020 6973  PT...`tokmon` is
-000014b0: 2075 7369 6e67 205b 746f 6b6d 6f6e 2f6f   using [tokmon/o
-000014c0: 7065 6e61 692d 7072 6963 696e 672e 6a73  penai-pricing.js
-000014d0: 6f6e 5d28 746f 6b6d 6f6e 2f6f 7065 6e61  on](tokmon/opena
-000014e0: 692d 7072 6963 696e 672e 6a73 6f6e 2920  i-pricing.json) 
-000014f0: 6672 6f6d 2069 7473 2070 6163 6b61 6765  from its package
-00001500: 2e20 0a0a 6060 606a 736f 6e0a 7b20 2020  . ..```json.{   
-00001510: 0a20 2020 2022 6c61 7374 5f75 7064 6174  .    "last_updat
-00001520: 6564 223a 2022 3230 3233 2d30 342d 3132  ed": "2023-04-12
-00001530: 222c 0a20 2020 2022 6461 7461 5f73 6f75  ",.    "data_sou
-00001540: 7263 6573 223a 205b 0a20 2020 2020 2020  rces": [.       
-00001550: 2022 6874 7470 733a 2f2f 6f70 656e 6169   "https://openai
-00001560: 2e63 6f6d 2f70 7269 6369 6e67 222c 0a20  .com/pricing",. 
-00001570: 2020 2020 2020 2022 6874 7470 733a 2f2f         "https://
-00001580: 706c 6174 666f 726d 2e6f 7065 6e61 692e  platform.openai.
-00001590: 636f 6d2f 646f 6373 2f6d 6f64 656c 732f  com/docs/models/
-000015a0: 6d6f 6465 6c2d 656e 6470 6f69 6e74 2d63  model-endpoint-c
-000015b0: 6f6d 7061 7469 6269 6c69 7479 220a 2020  ompatibility".  
-000015c0: 2020 5d2c 0a20 2020 2022 6770 742d 3422    ],.    "gpt-4"
-000015d0: 3a20 7b22 7072 6f6d 7074 5f63 6f73 7422  : {"prompt_cost"
-000015e0: 3a20 302e 3033 2c20 2263 6f6d 706c 6574  : 0.03, "complet
-000015f0: 696f 6e5f 636f 7374 223a 2030 2e30 362c  ion_cost": 0.06,
-00001600: 2022 7065 725f 746f 6b65 6e73 223a 2031   "per_tokens": 1
-00001610: 3030 307d 2c0a 2020 2020 2267 7074 2d34  000},.    "gpt-4
-00001620: 2d30 3331 3422 3a20 7b22 7072 6f6d 7074  -0314": {"prompt
-00001630: 5f63 6f73 7422 3a20 302e 3033 2c20 2263  _cost": 0.03, "c
-00001640: 6f6d 706c 6574 696f 6e5f 636f 7374 223a  ompletion_cost":
-00001650: 2030 2e30 362c 2022 7065 725f 746f 6b65   0.06, "per_toke
-00001660: 6e73 223a 2031 3030 307d 2c0a 2020 2020  ns": 1000},.    
-00001670: 2267 7074 2d34 2d33 326b 223a 207b 2270  "gpt-4-32k": {"p
-00001680: 726f 6d70 745f 636f 7374 223a 2030 2e30  rompt_cost": 0.0
-00001690: 362c 2022 636f 6d70 6c65 7469 6f6e 5f63  6, "completion_c
-000016a0: 6f73 7422 3a20 302e 3132 2c20 2270 6572  ost": 0.12, "per
-000016b0: 5f74 6f6b 656e 7322 3a20 3130 3030 7d2c  _tokens": 1000},
-000016c0: 0a20 2020 2022 6770 742d 342d 3332 6b2d  .    "gpt-4-32k-
-000016d0: 3033 3134 223a 207b 2270 726f 6d70 745f  0314": {"prompt_
-000016e0: 636f 7374 223a 2030 2e30 362c 2022 636f  cost": 0.06, "co
-000016f0: 6d70 6c65 7469 6f6e 5f63 6f73 7422 3a20  mpletion_cost": 
-00001700: 302e 3132 2c20 2270 6572 5f74 6f6b 656e  0.12, "per_token
-00001710: 7322 3a20 3130 3030 7d2c 0a20 2020 2022  s": 1000},.    "
-00001720: 6770 742d 332e 352d 7475 7262 6f22 3a20  gpt-3.5-turbo": 
-00001730: 7b22 7072 6f6d 7074 5f63 6f73 7422 3a20  {"prompt_cost": 
-00001740: 302e 3030 322c 2022 636f 6d70 6c65 7469  0.002, "completi
-00001750: 6f6e 5f63 6f73 7422 3a20 302e 3030 322c  on_cost": 0.002,
-00001760: 2022 7065 725f 746f 6b65 6e73 223a 2031   "per_tokens": 1
-00001770: 3030 307d 2c0a 2020 2020 2267 7074 2d33  000},.    "gpt-3
-00001780: 2e35 2d74 7572 626f 2d30 3330 3122 3a20  .5-turbo-0301": 
-00001790: 7b22 7072 6f6d 7074 5f63 6f73 7422 3a20  {"prompt_cost": 
-000017a0: 302e 3030 322c 2022 636f 6d70 6c65 7469  0.002, "completi
-000017b0: 6f6e 5f63 6f73 7422 3a20 302e 3030 322c  on_cost": 0.002,
-000017c0: 2022 7065 725f 746f 6b65 6e73 223a 2031   "per_tokens": 1
-000017d0: 3030 307d 2c0a 2020 2020 2274 6578 742d  000},.    "text-
-000017e0: 6461 7669 6e63 692d 3030 3322 3a20 7b22  davinci-003": {"
-000017f0: 636f 7374 223a 2030 2e30 322c 2022 7065  cost": 0.02, "pe
-00001800: 725f 746f 6b65 6e73 223a 2031 3030 307d  r_tokens": 1000}
-00001810: 2c0a 2020 2020 2274 6578 742d 6375 7269  ,.    "text-curi
-00001820: 652d 3030 3122 3a20 7b22 636f 7374 223a  e-001": {"cost":
-00001830: 2030 2e30 3032 2c20 2270 6572 5f74 6f6b   0.002, "per_tok
-00001840: 656e 7322 3a20 3130 3030 7d2c 0a20 2020  ens": 1000},.   
-00001850: 2022 7465 7874 2d62 6162 6261 6765 2d30   "text-babbage-0
-00001860: 3031 223a 207b 2263 6f73 7422 3a20 302e  01": {"cost": 0.
-00001870: 3030 3035 2c20 2270 6572 5f74 6f6b 656e  0005, "per_token
-00001880: 7322 3a20 3130 3030 7d2c 0a20 2020 2022  s": 1000},.    "
-00001890: 7465 7874 2d61 6461 2d30 3031 223a 207b  text-ada-001": {
-000018a0: 2263 6f73 7422 3a20 302e 3030 3034 2c20  "cost": 0.0004, 
-000018b0: 2270 6572 5f74 6f6b 656e 7322 3a20 3130  "per_tokens": 10
-000018c0: 3030 7d2c 0a20 2020 2022 7465 7874 2d65  00},.    "text-e
-000018d0: 6d62 6564 6469 6e67 2d61 6461 2d30 3032  mbedding-ada-002
-000018e0: 223a 207b 2263 6f73 7422 3a20 302e 3030  ": {"cost": 0.00
-000018f0: 3034 2c20 2270 6572 5f74 6f6b 656e 7322  04, "per_tokens"
-00001900: 3a20 3130 3030 7d0a 7d0a 6060 600a 0a59  : 1000}.}.```..Y
-00001910: 6f75 2063 616e 206f 7665 7272 6964 6520  ou can override 
-00001920: 7468 6520 6465 6661 756c 7420 7072 6963  the default pric
-00001930: 696e 6720 7769 7468 3a20 6074 6f6b 6d6f  ing with: `tokmo
-00001940: 6e20 2d2d 7072 6963 696e 6720 2f70 6174  n --pricing /pat
-00001950: 682f 746f 2f79 6f75 722f 6375 7374 6f6d  h/to/your/custom
-00001960: 2d6f 7065 6e61 692d 7072 6963 696e 672e  -openai-pricing.
-00001970: 6a73 6f6e 202e 2e2e 600a 0a3e 2054 6869  json ...`..> Thi
-00001980: 7320 7072 6963 696e 6720 4a53 4f4e 2069  s pricing JSON i
-00001990: 7320 696e 636f 6d70 6c65 7465 2028 6d69  s incomplete (mi
-000019a0: 7373 696e 6720 4441 4c4c 2d45 2c20 6574  ssing DALL-E, et
-000019b0: 632e 292c 2069 7420 6d61 7920 6265 2069  c.), it may be i
-000019c0: 6e63 6f72 7265 6374 2c20 616e 6420 6974  ncorrect, and it
-000019d0: 206d 6179 2067 6f20 6f75 7420 6f66 2064   may go out of d
-000019e0: 6174 652e 0a0a 3e20 466f 7220 6265 7374  ate...> For best
-000019f0: 2072 6573 756c 7473 2c20 6d61 6b65 2073   results, make s
-00001a00: 7572 6520 746f 2063 6865 636b 2074 6861  ure to check tha
-00001a10: 7420 796f 7520 6861 7665 2074 6865 206c  t you have the l
-00001a20: 6174 6573 7420 7072 6963 696e 672e 0a0a  atest pricing...
-00001a30: 2323 2043 7572 7265 6e74 204c 696d 6974  ## Current Limit
-00001a40: 6174 696f 6e73 0a31 2e20 4576 656e 7420  ations.1. Event 
-00001a50: 7374 7265 616d 696e 673a 2060 746f 6b6d  streaming: `tokm
-00001a60: 6f6e 6020 6275 6666 6572 7320 5365 7276  on` buffers Serv
-00001a70: 6572 2d53 656e 7420 4576 656e 7473 2028  er-Sent Events (
-00001a80: 5353 4529 2075 6e74 696c 2074 6865 2060  SSE) until the `
-00001a90: 6461 7461 3a20 5b44 4f4e 455d 6020 6368  data: [DONE]` ch
-00001aa0: 756e 6b20 6973 2072 6563 6569 7665 642e  unk is received.
-00001ab0: 2049 6620 7468 6520 6d6f 6e69 746f 7265   If the monitore
-00001ac0: 6420 7072 6f67 7261 6d20 6c65 7665 7261  d program levera
-00001ad0: 6765 7320 6576 656e 7420 7374 7265 616d  ges event stream
-00001ae0: 696e 672c 2069 7473 2062 6568 6176 696f  ing, its behavio
-00001af0: 7220 7769 6c6c 2062 6520 6d6f 6469 6669  r will be modifi
-00001b00: 6564 2e0a 2020 2020 2d20 5374 6174 7573  ed..    - Status
-00001b10: 3a20 6c6f 6f6b 696e 6720 696e 746f 2069  : looking into i
-00001b20: 742e 2050 756c 6c20 7265 7175 6573 7473  t. Pull requests
-00001b30: 2077 656c 636f 6d65 2e0a 0a23 2320 436f   welcome...## Co
-00001b40: 6e74 7269 6275 7469 6e67 0a49 6620 796f  ntributing.If yo
-00001b50: 7527 6420 6c69 6b65 2074 6f20 636f 6e74  u'd like to cont
-00001b60: 7269 6275 7465 2074 6f20 7468 6520 7072  ribute to the pr
-00001b70: 6f6a 6563 742c 2070 6c65 6173 6520 666f  oject, please fo
-00001b80: 6c6c 6f77 2074 6865 7365 2073 7465 7073  llow these steps
-00001b90: 3a0a 312e 2046 6f72 6b20 7468 6520 7265  :.1. Fork the re
-00001ba0: 706f 7369 746f 7279 2e0a 322e 2043 7265  pository..2. Cre
-00001bb0: 6174 6520 6120 6e65 7720 6272 616e 6368  ate a new branch
-00001bc0: 2066 6f72 2079 6f75 7220 6368 616e 6765   for your change
-00001bd0: 732e 0a33 2e20 4d61 6b65 2079 6f75 7220  s..3. Make your 
-00001be0: 6368 616e 6765 7320 616e 6420 7465 7374  changes and test
-00001bf0: 2074 6865 6d2e 0a34 2e20 5375 626d 6974   them..4. Submit
-00001c00: 2061 2070 756c 6c20 7265 7175 6573 7420   a pull request 
-00001c10: 7769 7468 2061 2063 6c65 6172 2064 6573  with a clear des
-00001c20: 6372 6970 7469 6f6e 206f 6620 796f 7572  cription of your
-00001c30: 2063 6861 6e67 6573 2061 6e64 2061 6e79   changes and any
-00001c40: 2072 656c 6576 616e 7420 696e 666f 726d   relevant inform
-00001c50: 6174 696f 6e2e 0a0a 2323 2057 6172 6e69  ation...## Warni
-00001c60: 6e67 0a31 2e20 6074 6f6b 6d6f 6e60 2063  ng.1. `tokmon` c
-00001c70: 6f6d 6573 2077 6974 686f 7574 2061 6e79  omes without any
-00001c80: 2077 6172 7261 6e74 7920 6f72 2067 7561   warranty or gua
-00001c90: 7261 6e74 6565 2077 6861 7473 6f65 7665  rantee whatsoeve
-00001ca0: 722e 0a32 2e20 6074 6f6b 6d6f 6e60 2077  r..2. `tokmon` w
-00001cb0: 6173 2074 6573 7465 6420 6f6e 206d 6163  as tested on mac
-00001cc0: 4f53 206f 6e6c 792e 2049 7420 6d69 6768  OS only. It migh
-00001cd0: 7420 6e6f 7420 776f 726b 206f 6e20 6f74  t not work on ot
-00001ce0: 6865 7220 706c 6174 666f 726d 732e 0a33  her platforms..3
-00001cf0: 2e20 5468 6973 2074 6f6f 6c20 6d61 7920  . This tool may 
-00001d00: 6e6f 7420 776f 726b 2061 7320 696e 7465  not work as inte
-00001d10: 6e64 6564 2c20 6861 7665 2075 6e6b 6e6f  nded, have unkno
-00001d20: 776e 2073 6964 6520 6566 6665 6374 732c  wn side effects,
-00001d30: 206d 6179 206f 7574 7075 7420 696e 636f   may output inco
-00001d40: 7272 6563 7420 696e 666f 726d 6174 696f  rrect informatio
-00001d50: 6e2c 206f 7220 6e6f 7420 776f 726b 2061  n, or not work a
-00001d60: 7420 616c 6c2e 0a34 2e20 5468 6520 7072  t all..4. The pr
-00001d70: 6963 696e 6720 6461 7461 2069 6e20 606f  icing data in `o
-00001d80: 7065 6e61 692d 7072 6963 696e 672e 6a73  penai-pricing.js
-00001d90: 6f6e 6020 6d61 7920 676f 206f 7574 206f  on` may go out o
-00001da0: 6620 6461 7465 2e0a                      f date..
+00000700: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00000710: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00000720: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00000730: 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a 5772 6974  ==========..Writ
+00000740: 696e 6720 636f 7374 2073 756d 6d61 7279  ing cost summary
+00000750: 2074 6f20 4a53 4f4e 2066 696c 653a 202e   to JSON file: .
+00000760: 2f74 6f6b 6d6f 6e5f 7573 6167 655f 7375  /tokmon_usage_su
+00000770: 6d6d 6172 795f 3136 3832 3033 3935 3035  mmary_1682039505
+00000780: 2e6a 736f 6e0a 6060 600a 4166 7465 7220  .json.```.After 
+00000790: 796f 7572 2070 726f 6772 616d 2066 696e  your program fin
+000007a0: 6973 6865 7320 7275 6e6e 696e 6720 286f  ishes running (o
+000007b0: 7220 796f 7520 6063 7472 6c5e 4360 206f  r you `ctrl^C` o
+000007c0: 7574 2069 7429 2c20 6074 6f6b 6d6f 6e60  ut it), `tokmon`
+000007d0: 2077 696c 6c20 7072 696e 7420 6120 7375   will print a su
+000007e0: 6d6d 6172 7920 7468 6174 206c 6f6f 6b73  mmary that looks
+000007f0: 206c 696b 6520 7468 6520 6162 6f76 652e   like the above.
+00000800: 2060 746f 6b6d 6f6e 6020 616c 736f 2067   `tokmon` also g
+00000810: 656e 6572 6174 6573 2061 2064 6574 6169  enerates a detai
+00000820: 6c65 6420 7265 706f 7274 2061 6e64 2073  led report and s
+00000830: 6176 6573 2069 7420 6173 2061 205b 4a53  aves it as a [JS
+00000840: 4f4e 2066 696c 655d 2852 4541 444d 452e  ON file](README.
+00000850: 6d64 2366 756c 6c2d 7573 6167 652d 616e  md#full-usage-an
+00000860: 642d 636f 7374 2d73 756d 6d61 7279 2d6a  d-cost-summary-j
+00000870: 736f 6e29 2e20 3c62 723e 0a59 6f75 2063  son). <br>.You c
+00000880: 616e 2075 7365 2074 6865 2060 2d2d 6265  an use the `--be
+00000890: 616d 203c 7572 6c3e 6020 666c 6167 2074  am <url>` flag t
+000008a0: 6f20 7374 7265 616d 2074 6f6b 656e 2075  o stream token u
+000008b0: 7361 6765 2064 6174 6120 746f 2061 2073  sage data to a s
+000008c0: 6572 7665 722e 2053 6565 205b 746f 6b6d  erver. See [tokm
+000008d0: 6f6e 202d 2d62 6561 6d5d 2868 7474 7073  on --beam](https
+000008e0: 3a2f 2f67 6974 6875 622e 636f 6d2f 7961  ://github.com/ya
+000008f0: 6769 6c2f 746f 6b6d 6f6e 2d62 6561 6d29  gil/tokmon-beam)
+00000900: 2066 6f72 206d 6f72 6520 696e 666f 726d   for more inform
+00000910: 6174 696f 6e2e 0a0a 0a23 2320 4465 6d6f  ation....## Demo
+00000920: 0a3c 7020 616c 6967 6e3d 2263 656e 7465  .<p align="cente
+00000930: 7222 3e0a 2020 2020 3c69 6d67 2073 7263  r">.    <img src
+00000940: 3d22 6874 7470 733a 2f2f 7573 6572 2d69  ="https://user-i
+00000950: 6d61 6765 732e 6769 7468 7562 7573 6572  mages.githubuser
+00000960: 636f 6e74 656e 742e 636f 6d2f 3336 3131  content.com/3611
+00000970: 3034 322f 3233 3139 3130 3237 342d 3338  042/231910274-38
+00000980: 3732 6531 3366 2d64 3965 362d 3437 3532  72e13f-d9e6-4752
+00000990: 2d62 6338 392d 3434 6535 6433 3334 6532  -bc89-44e5d334e2
+000009a0: 3166 2e67 6966 2220 2f3e 0a3c 2f70 3e0a  1f.gif" />.</p>.
+000009b0: 0a23 2320 5472 7920 6974 206f 7574 0a0a  .## Try it out..
+000009c0: 6060 6062 6173 680a 2320 496e 7374 616c  ```bash.# Instal
+000009d0: 6c20 746f 6b6d 6f6e 0a70 6970 2069 6e73  l tokmon.pip ins
+000009e0: 7461 6c6c 2074 6f6b 6d6f 6e0a 0a23 2043  tall tokmon..# C
+000009f0: 6c6f 6e65 2074 6869 7320 7265 706f 2061  lone this repo a
+00000a00: 6e64 2060 6364 6020 696e 746f 2069 740a  nd `cd` into it.
+00000a10: 6769 7420 636c 6f6e 6520 6874 7470 733a  git clone https:
+00000a20: 2f2f 6769 7468 7562 2e63 6f6d 2f79 6167  //github.com/yag
+00000a30: 696c 2f74 6f6b 6d6f 6e2e 6769 7420 2626  il/tokmon.git &&
+00000a40: 2063 6420 746f 6b6d 6f6e 2f0a 0a23 2065   cd tokmon/..# e
+00000a50: 7870 6f72 7420 796f 7572 204f 7065 6e41  xport your OpenA
+00000a60: 4920 4150 4920 6b65 792e 2054 6869 7320  I API key. This 
+00000a70: 7769 6c6c 2062 6520 7573 6564 2069 6e20  will be used in 
+00000a80: 7468 6520 7465 7374 2070 726f 6772 616d  the test program
+00000a90: 2028 736f 7572 6365 2069 6e20 2e2f 7465   (source in ./te
+00000aa0: 7374 732f 7079 7468 6f6e 5f65 7861 6d70  sts/python_examp
+00000ab0: 6c65 2e70 7929 0a65 7870 6f72 7420 4f50  le.py).export OP
+00000ac0: 454e 4149 5f41 5049 5f4b 4559 3d22 594f  ENAI_API_KEY="YO
+00000ad0: 5552 5f4f 5045 4e41 495f 4150 495f 4b45  UR_OPENAI_API_KE
+00000ae0: 5922 200a 0a23 2052 756e 2074 6f6b 6d6f  Y" ..# Run tokmo
+00000af0: 6e20 2873 6176 6520 7468 6520 4a53 4f4e  n (save the JSON
+00000b00: 2073 756d 6d61 7279 2074 6f20 7468 6520   summary to the 
+00000b10: 6375 7272 656e 7420 666f 6c64 6572 290a  current folder).
+00000b20: 2320 5468 6520 7465 7374 2075 7365 7320  # The test uses 
+00000b30: 7468 6520 6f70 656e 6169 2070 7974 686f  the openai pytho
+00000b40: 6e20 7061 636b 6167 652e 2049 6e73 7461  n package. Insta
+00000b50: 6c6c 2069 7420 6966 2079 6f75 2064 6f6e  ll it if you don
+00000b60: 2774 2068 6176 6520 6974 3a20 6070 6970  't have it: `pip
+00000b70: 2069 6e73 7461 6c6c 206f 7065 6e61 6960   install openai`
+00000b80: 0a74 6f6b 6d6f 6e20 2d2d 6a73 6f6e 5f6f  .tokmon --json_o
+00000b90: 7574 3d2e 2070 7974 686f 6e33 202e 2f74  ut=. python3 ./t
+00000ba0: 6573 7473 2f70 7974 686f 6e5f 6578 616d  ests/python_exam
+00000bb0: 706c 652e 7079 202d 2d70 726f 6d70 7420  ple.py --prompt 
+00000bc0: 2273 6179 2027 6865 6c6c 6f2c 2074 6f6b  "say 'hello, tok
+00000bd0: 6d6f 6e21 2722 0a60 6060 0a0a 2323 2323  mon!'".```..####
+00000be0: 2060 746f 6b6d 6f6e 6020 616c 736f 2073   `tokmon` also s
+00000bf0: 7570 706f 7274 7320 7468 6973 3a0a 2d20  upports this:.- 
+00000c00: 4966 2079 6f75 7220 7072 6f67 7261 6d20  If your program 
+00000c10: 7573 6573 206d 756c 7469 706c 6520 4f70  uses multiple Op
+00000c20: 656e 4149 206d 6f64 656c 7320 696e 2074  enAI models in t
+00000c30: 6865 2073 616d 6520 696e 766f 6361 7469  he same invocati
+00000c40: 6f6e 2c20 7468 6569 7220 7265 7370 6563  on, their respec
+00000c50: 7469 7665 2075 7361 6765 7320 7769 6c6c  tive usages will
+00000c60: 2062 6520 7265 666c 6563 7465 6420 696e   be reflected in
+00000c70: 2074 6865 2072 6570 6f72 742e 0a2d 2059   the report..- Y
+00000c80: 6f75 2063 616e 2072 756e 206d 756c 7469  ou can run multi
+00000c90: 706c 6520 696e 7374 616e 6365 7320 6f66  ple instances of
+00000ca0: 2060 746f 6b6d 6f6e 6020 7369 6d75 6c74   `tokmon` simult
+00000cb0: 616e 656f 7573 6c79 2e20 4561 6368 2069  aneously. Each i
+00000cc0: 6e76 6f63 6174 696f 6e20 7769 6c6c 2067  nvocation will g
+00000cd0: 656e 6572 6174 6520 6120 7365 7061 7261  enerate a separa
+00000ce0: 7465 2075 7361 6765 2072 6570 6f72 742e  te usage report.
+00000cf0: 0a2d 2050 6173 7320 6120 602d 2d6a 736f  .- Pass a `--jso
+00000d00: 6e5f 6f75 7420 2f79 6f75 722f 7061 7468  n_out /your/path
+00000d10: 2f72 6570 6f72 742e 6a73 6f6e 6020 746f  /report.json` to
+00000d20: 2067 6574 2061 2064 6574 6169 6c65 6420   get a detailed 
+00000d30: 6272 6561 6b64 6f77 6e20 2b20 636f 6e76  breakdown + conv
+00000d40: 6572 7361 7469 6f6e 2068 6973 746f 7279  ersation history
+00000d50: 2069 6e20 4a53 4f4e 2066 6f72 6d61 742e   in JSON format.
+00000d60: 0a0a 3c68 723e 0a0a 2323 2055 7365 2060  ..<hr>..## Use `
+00000d70: 746f 6b6d 6f6e 6020 7769 7468 2079 6f75  tokmon` with you
+00000d80: 7220 6170 706c 6963 6174 696f 6e20 6f72  r application or
+00000d90: 2073 6372 6970 740a 3e20 2a2a 5761 726e   script.> **Warn
+00000da0: 696e 672a 2a0a 3e20 5468 6973 2069 7320  ing**.> This is 
+00000db0: 6120 6465 6275 6767 696e 6720 746f 6f6c  a debugging tool
+00000dc0: 2e20 4974 2069 7320 6e6f 7420 696e 7465  . It is not inte
+00000dd0: 6e64 6564 2074 6f20 6265 2075 7365 6420  nded to be used 
+00000de0: 696e 2061 6e79 2063 6f6e 7365 7175 656e  in any consequen
+00000df0: 7469 616c 2073 6574 7469 6e67 2e20 5573  tial setting. Us
+00000e00: 6520 796f 7572 2062 6573 7420 6a75 6467  e your best judg
+00000e10: 656d 656e 7421 0a0a 5072 6570 656e 6420  ement!..Prepend 
+00000e20: 6074 6f6b 6d6f 6e60 2074 6f20 796f 7572  `tokmon` to your
+00000e30: 206e 6f72 6d61 6c20 7072 6f67 7261 6d20   normal program 
+00000e40: 696e 766f 6361 7469 6f6e 206c 696b 6520  invocation like 
+00000e50: 736f 3a0a 6060 6062 6173 680a 2420 746f  so:.```bash.$ to
+00000e60: 6b6d 6f6e 202f 7061 7468 2f74 6f2f 796f  kmon /path/to/yo
+00000e70: 7572 2f3c 796f 7572 2070 726f 6772 616d  ur/<your program
+00000e80: 3e20 5b61 7267 315d 205b 6172 6732 5d20  > [arg1] [arg2] 
+00000e90: 2e2e 2e0a 6060 600a 5275 6e20 616e 6420  ....```.Run and 
+00000ea0: 7573 6520 796f 7572 2070 726f 6772 616d  use your program
+00000eb0: 206a 7573 7420 6c69 6b65 2079 6f75 2077   just like you w
+00000ec0: 6f75 6c64 206e 6f72 6d61 6c6c 7920 2861  ould normally (a
+00000ed0: 7267 756d 656e 7473 2061 6e64 2061 6c6c  rguments and all
+00000ee0: 292e 2049 6e74 6572 6163 7469 7665 2075  ). Interactive u
+00000ef0: 7361 6765 2069 7320 7375 7070 6f72 7465  sage is supporte
+00000f00: 6420 6173 2077 656c 6c2e 0a0a 2323 2323  d as well...####
+00000f10: 2055 7369 6e67 2060 746f 6b6d 6f6e 6020   Using `tokmon` 
+00000f20: 7769 7468 2060 6e70 6d20 7275 6e60 2028  with `npm run` (
+00000f30: 652e 672e 2077 6974 6820 4e65 7874 4a53  e.g. with NextJS
+00000f40: 290a 4564 6974 2079 6f75 7220 6070 6163  ).Edit your `pac
+00000f50: 6b61 6765 2e6a 736f 6e60 2773 2022 7363  kage.json`'s "sc
+00000f60: 7269 7074 7322 2065 6e74 7279 2074 6f20  ripts" entry to 
+00000f70: 696e 636c 7564 6520 6074 6f6b 6d6f 6e60  include `tokmon`
+00000f80: 2e20 0a0a 6060 606a 730a 7b0a 2020 2020  . ..```js.{.    
+00000f90: 2273 6372 6970 7473 223a 207b 0a20 2020  "scripts": {.   
+00000fa0: 2020 2020 2022 6465 7622 3a20 2274 6f6b       "dev": "tok
+00000fb0: 6d6f 6e20 6e65 7874 2064 6576 222c 0a20  mon next dev",. 
+00000fc0: 2020 2020 2020 202e 2e2e 0a20 2020 207d         ....    }
+00000fd0: 0a7d 0a60 6060 0a0a 2323 2046 756c 6c20  .}.```..## Full 
+00000fe0: 7573 6167 6520 616e 6420 636f 7374 2073  usage and cost s
+00000ff0: 756d 6d61 7279 2028 4a53 4f4e 290a 0a60  ummary (JSON)..`
+00001000: 6060 6a73 6f6e 0a7b 0a20 2020 2022 746f  ``json.{.    "to
+00001010: 7461 6c5f 636f 7374 223a 2030 2e30 3031  tal_cost": 0.001
+00001020: 3931 3939 3939 3939 3939 3939 3939 3938  9199999999999998
+00001030: 2c0a 2020 2020 2274 6f74 616c 5f75 7361  ,.    "total_usa
+00001040: 6765 223a 207b 0a20 2020 2020 2020 2022  ge": {.        "
+00001050: 746f 7461 6c5f 7072 6f6d 7074 5f74 6f6b  total_prompt_tok
+00001060: 656e 7322 3a20 3138 2c0a 2020 2020 2020  ens": 18,.      
+00001070: 2020 2274 6f74 616c 5f63 6f6d 706c 6574    "total_complet
+00001080: 696f 6e5f 746f 6b65 6e73 223a 2032 332c  ion_tokens": 23,
+00001090: 0a20 2020 2020 2020 2022 746f 7461 6c5f  .        "total_
+000010a0: 746f 6b65 6e73 223a 2034 310a 2020 2020  tokens": 41.    
+000010b0: 7d2c 0a20 2020 2022 7072 6963 696e 675f  },.    "pricing_
+000010c0: 6461 7461 223a 2022 7b27 6770 742d 342d  data": "{'gpt-4-
+000010d0: 3033 3134 273a 207b 2770 726f 6d70 745f  0314': {'prompt_
+000010e0: 636f 7374 273a 2030 2e30 332c 2027 636f  cost': 0.03, 'co
+000010f0: 6d70 6c65 7469 6f6e 5f63 6f73 7427 3a20  mpletion_cost': 
+00001100: 302e 3036 2c20 2770 6572 5f74 6f6b 656e  0.06, 'per_token
+00001110: 7327 3a20 3130 3030 7d7d 222c 0a20 2020  s': 1000}}",.   
+00001120: 2022 6d6f 6465 6c73 223a 205b 0a20 2020   "models": [.   
+00001130: 2020 2020 2022 6770 742d 342d 3033 3134       "gpt-4-0314
+00001140: 220a 2020 2020 5d2c 0a20 2020 2022 7261  ".    ],.    "ra
+00001150: 775f 6461 7461 223a 205b 0a20 2020 2020  w_data": [.     
+00001160: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00001170: 2022 6d6f 6465 6c22 3a20 2267 7074 2d34   "model": "gpt-4
+00001180: 2d30 3331 3422 2c0a 2020 2020 2020 2020  -0314",.        
+00001190: 2020 2020 2275 7361 6765 223a 207b 0a20      "usage": {. 
+000011a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000011b0: 7072 6f6d 7074 5f74 6f6b 656e 7322 3a20  prompt_tokens": 
+000011c0: 3138 2c0a 2020 2020 2020 2020 2020 2020  18,.            
+000011d0: 2020 2020 2263 6f6d 706c 6574 696f 6e5f      "completion_
+000011e0: 746f 6b65 6e73 223a 2032 332c 0a20 2020  tokens": 23,.   
+000011f0: 2020 2020 2020 2020 2020 2020 2022 746f               "to
+00001200: 7461 6c5f 746f 6b65 6e73 223a 2034 310a  tal_tokens": 41.
+00001210: 2020 2020 2020 2020 2020 2020 7d2c 0a20              },. 
+00001220: 2020 2020 2020 2020 2020 2022 636f 7374             "cost
+00001230: 223a 2030 2e30 3031 3931 3939 3939 3939  ": 0.00191999999
+00001240: 3939 3939 3939 3938 2c0a 2020 2020 2020  99999998,.      
+00001250: 2020 2020 2020 226d 6573 7361 6765 7322        "messages"
+00001260: 3a20 5b0a 2020 2020 2020 2020 2020 2020  : [.            
+00001270: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+00001280: 2020 2020 2020 2020 2020 2272 6f6c 6522            "role"
+00001290: 3a20 2273 7973 7465 6d22 2c0a 2020 2020  : "system",.    
+000012a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000012b0: 2263 6f6e 7465 6e74 223a 2022 596f 7527  "content": "You'
+000012c0: 7265 2061 2068 656c 7066 756c 2061 7373  re a helpful ass
+000012d0: 6973 7461 6e74 2e22 0a20 2020 2020 2020  istant.".       
+000012e0: 2020 2020 2020 2020 207d 2c0a 2020 2020           },.    
+000012f0: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
+00001300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001310: 2020 2272 6f6c 6522 3a20 2275 7365 7222    "role": "user"
+00001320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00001330: 2020 2020 2020 2263 6f6e 7465 6e74 223a        "content":
+00001340: 2022 6865 6c6c 6f22 0a20 2020 2020 2020   "hello".       
+00001350: 2020 2020 2020 2020 207d 2c0a 2020 2020           },.    
+00001360: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
+00001370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001380: 2020 2272 6f6c 6522 3a20 2261 7373 6973    "role": "assis
+00001390: 7461 6e74 222c 0a20 2020 2020 2020 2020  tant",.         
+000013a0: 2020 2020 2020 2020 2020 2022 636f 6e74             "cont
+000013b0: 656e 7422 3a20 2248 656c 6c6f 2120 486f  ent": "Hello! Ho
+000013c0: 7720 6361 6e20 4920 6865 6c70 2079 6f75  w can I help you
+000013d0: 2074 6f64 6179 3f20 4966 2079 6f75 2068   today? If you h
+000013e0: 6176 6520 616e 7920 7175 6573 7469 6f6e  ave any question
+000013f0: 7320 6f72 206e 6565 6420 6173 7369 7374  s or need assist
+00001400: 616e 6365 2c20 6665 656c 2066 7265 6520  ance, feel free 
+00001410: 746f 2061 736b 2e22 0a20 2020 2020 2020  to ask.".       
+00001420: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00001430: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00001440: 207d 0a20 2020 205d 0a7d 0a60 6060 0a0a   }.    ].}.```..
+00001450: 2323 2048 6f77 2069 7420 776f 726b 730a  ## How it works.
+00001460: 6074 6f6b 6d6f 6e60 2075 7365 7320 7468  `tokmon` uses th
+00001470: 6520 5b6d 6974 6d70 726f 7879 206c 6962  e [mitmproxy lib
+00001480: 7261 7279 5d28 6874 7470 733a 2f2f 6769  rary](https://gi
+00001490: 7468 7562 2e63 6f6d 2f6d 6974 6d70 726f  thub.com/mitmpro
+000014a0: 7879 2f6d 6974 6d70 726f 7879 2920 746f  xy/mitmproxy) to
+000014b0: 2069 6e74 6572 6365 7074 2048 5454 5020   intercept HTTP 
+000014c0: 7265 7175 6573 7473 2061 6e64 2072 6573  requests and res
+000014d0: 706f 6e73 6573 2062 6574 7765 656e 2079  ponses between y
+000014e0: 6f75 7220 7072 6f67 7261 6d20 616e 6420  our program and 
+000014f0: 7468 6520 4f70 656e 4149 2041 5049 2e0a  the OpenAI API..
+00001500: 4974 2074 6865 6e20 7072 6f63 6573 7365  It then processe
+00001510: 7320 7468 6520 7265 7175 6573 7420 616e  s the request an
+00001520: 6420 7265 7370 6f6e 7365 2064 6174 6120  d response data 
+00001530: 746f 2063 616c 6375 6c61 7465 2074 6f6b  to calculate tok
+00001540: 656e 2075 7361 6765 2061 6e64 2063 6f73  en usage and cos
+00001550: 7420 6261 7365 6420 6f6e 205b 746f 6b6d  t based on [tokm
+00001560: 6f6e 2f6f 7065 6e61 692d 7072 6963 696e  on/openai-pricin
+00001570: 672e 6a73 6f6e 5d28 746f 6b6d 6f6e 2f6f  g.json](tokmon/o
+00001580: 7065 6e61 692d 7072 6963 696e 672e 6a73  penai-pricing.js
+00001590: 6f6e 292e 0a0a 3e20 6074 6f6b 6d6f 6e60  on)...> `tokmon`
+000015a0: 2077 6f72 6b73 2066 6f72 2070 726f 6772   works for progr
+000015b0: 616d 7320 696e 2060 7079 7468 6f6e 6020  ams in `python` 
+000015c0: 2f20 606e 6f64 6560 2028 7573 696e 6720  / `node` (using 
+000015d0: 4f70 656e 4149 2773 2063 6c69 656e 7473  OpenAI's clients
+000015e0: 292c 206f 7220 6063 7572 6c60 2028 7275  ), or `curl` (ru
+000015f0: 6e20 6469 7265 6374 6c79 2c20 616e 6420  n directly, and 
+00001600: 6e6f 7420 692e 652e 2069 6e20 6120 6261  not i.e. in a ba
+00001610: 7368 2073 6372 6970 7429 2e0a 3e20 5365  sh script)..> Se
+00001620: 6520 5b47 6f6c 616e 6720 696e 7374 7275  e [Golang instru
+00001630: 6374 696f 6e73 5d28 2367 6f6c 616e 6729  ctions](#golang)
+00001640: 2066 6f72 2069 6e73 7472 7563 7469 6f6e   for instruction
+00001650: 7320 6f6e 2068 6f77 2074 6f20 7573 6520  s on how to use 
+00001660: 6074 6f6b 6d6f 6e60 2077 6974 6820 476f  `tokmon` with Go
+00001670: 6c61 6e67 2070 726f 6772 616d 732e 0a0a  lang programs...
+00001680: 3e20 6966 2079 6f75 205b 6d61 6e75 616c  > if you [manual
+00001690: 6c79 2069 6e73 7461 6c6c 2060 6d69 746d  ly install `mitm
+000016a0: 7072 6f78 7960 2773 2043 4120 6365 7274  proxy`'s CA cert
+000016b0: 6966 6963 6174 655d 2868 7474 7073 3a2f  ificate](https:/
+000016c0: 2f64 6f63 732e 6d69 746d 7072 6f78 792e  /docs.mitmproxy.
+000016d0: 6f72 672f 7374 6162 6c65 2f63 6f6e 6365  org/stable/conce
+000016e0: 7074 732d 6365 7274 6966 6963 6174 6573  pts-certificates
+000016f0: 2f23 3a7e 3a74 6578 743d 476f 2532 3074  /#:~:text=Go%20t
+00001700: 6f25 3230 5365 7474 696e 6773 2532 3025  o%20Settings%20%
+00001710: 3345 2532 3047 656e 6572 616c 2532 3025  3E%20General%20%
+00001720: 3345 2532 3041 626f 7574 2c74 7275 7374  3E%20About,trust
+00001730: 2532 3066 6f72 2532 3074 6865 2532 306d  %20for%20the%20m
+00001740: 6974 6d70 726f 7879 2532 3063 6572 7469  itmproxy%20certi
+00001750: 6669 6361 7465 292c 2069 7420 7368 6f75  ficate), it shou
+00001760: 6c64 2077 6f72 6b20 666f 7220 616c 6c20  ld work for all 
+00001770: 6578 6563 7574 6162 6c65 7320 286e 6f74  executables (not
+00001780: 653a 2068 6176 656e 2774 2074 6573 7465  e: haven't teste
+00001790: 6420 7468 6973 2e29 0a0a 496e 206d 6f73  d this.)..In mos
+000017a0: 7420 6361 7365 732c 2060 746f 6b6d 6f6e  t cases, `tokmon
+000017b0: 6020 7265 6c69 6573 206f 6e20 7468 6520  ` relies on the 
+000017c0: 6027 7573 6167 6527 6020 6669 656c 6420  `'usage'` field 
+000017d0: 696e 205b 4f70 656e 4149 2773 2041 5049  in [OpenAI's API
+000017e0: 2072 6573 706f 6e73 6573 5d28 6874 7470   responses](http
+000017f0: 733a 2f2f 636f 6d6d 756e 6974 792e 6f70  s://community.op
+00001800: 656e 6169 2e63 6f6d 2f74 2f75 7361 6765  enai.com/t/usage
+00001810: 2d69 6e66 6f2d 696e 2d61 7069 2d72 6573  -info-in-api-res
+00001820: 706f 6e73 6573 2f31 3838 3632 2920 666f  ponses/18862) fo
+00001830: 7220 746f 6b65 6e20 636f 756e 7473 2e20  r token counts. 
+00001840: 466f 7220 7374 7265 616d 696e 6720 7265  For streaming re
+00001850: 7175 6573 7473 2c20 686f 7765 7665 722c  quests, however,
+00001860: 2060 746f 6b6d 6f6e 6020 7573 6573 204f   `tokmon` uses O
+00001870: 7065 6e41 4927 7320 5b74 696b 746f 6b65  penAI's [tiktoke
+00001880: 6e20 6c69 6272 6172 795d 2868 7474 7073  n library](https
+00001890: 3a2f 2f67 6974 6875 622e 636f 6d2f 6f70  ://github.com/op
+000018a0: 656e 6169 2f74 696b 746f 6b65 6e29 2064  enai/tiktoken) d
+000018b0: 6972 6563 746c 7920 746f 2063 6f75 6e74  irectly to count
+000018c0: 2074 6865 2074 6f6b 656e 732e 2041 7320   the tokens. As 
+000018d0: 6f66 2077 7269 7469 6e67 204f 7065 6e41  of writing OpenA
+000018e0: 4927 7320 4150 4920 646f 6573 206e 6f74  I's API does not
+000018f0: 2072 6574 7572 6e20 7573 6167 6520 6461   return usage da
+00001900: 7461 2066 6f72 2073 7472 6561 6d69 6e67  ta for streaming
+00001910: 2072 6571 7565 7374 7320 285b 7265 6665   requests ([refe
+00001920: 7265 6e63 655d 2868 7474 7073 3a2f 2f63  rence](https://c
+00001930: 6f6d 6d75 6e69 7479 2e6f 7065 6e61 692e  ommunity.openai.
+00001940: 636f 6d2f 742f 7573 6167 652d 696e 666f  com/t/usage-info
+00001950: 2d69 6e2d 6170 692d 7265 7370 6f6e 7365  -in-api-response
+00001960: 732f 3138 3836 322f 3131 292e 290a 0a23  s/18862/11).)..#
+00001970: 2320 6f70 656e 6169 2d70 7269 6369 6e67  # openai-pricing
+00001980: 2e6a 736f 6e0a 5468 6520 7072 6963 696e  .json.The pricin
+00001990: 6720 6461 7461 2077 6173 2065 7874 7261  g data was extra
+000019a0: 6374 6564 2066 726f 6d20 4f70 656e 4149  cted from OpenAI
+000019b0: 2773 2077 6562 7369 7465 2077 6974 6820  's website with 
+000019c0: 7468 6520 6865 6c70 206f 6620 4368 6174  the help of Chat
+000019d0: 4750 542e 0a0a 6074 6f6b 6d6f 6e60 2069  GPT...`tokmon` i
+000019e0: 7320 7573 696e 6720 5b74 6f6b 6d6f 6e2f  s using [tokmon/
+000019f0: 6f70 656e 6169 2d70 7269 6369 6e67 2e6a  openai-pricing.j
+00001a00: 736f 6e5d 2874 6f6b 6d6f 6e2f 6f70 656e  son](tokmon/open
+00001a10: 6169 2d70 7269 6369 6e67 2e6a 736f 6e29  ai-pricing.json)
+00001a20: 2066 726f 6d20 6974 7320 7061 636b 6167   from its packag
+00001a30: 652e 200a 0a60 6060 6a73 6f6e 0a7b 2020  e. ..```json.{  
+00001a40: 200a 2020 2020 226c 6173 745f 7570 6461   .    "last_upda
+00001a50: 7465 6422 3a20 2232 3032 332d 3034 2d31  ted": "2023-04-1
+00001a60: 3222 2c0a 2020 2020 2264 6174 615f 736f  2",.    "data_so
+00001a70: 7572 6365 7322 3a20 5b0a 2020 2020 2020  urces": [.      
+00001a80: 2020 2268 7474 7073 3a2f 2f6f 7065 6e61    "https://opena
+00001a90: 692e 636f 6d2f 7072 6963 696e 6722 2c0a  i.com/pricing",.
+00001aa0: 2020 2020 2020 2020 2268 7474 7073 3a2f          "https:/
+00001ab0: 2f70 6c61 7466 6f72 6d2e 6f70 656e 6169  /platform.openai
+00001ac0: 2e63 6f6d 2f64 6f63 732f 6d6f 6465 6c73  .com/docs/models
+00001ad0: 2f6d 6f64 656c 2d65 6e64 706f 696e 742d  /model-endpoint-
+00001ae0: 636f 6d70 6174 6962 696c 6974 7922 0a20  compatibility". 
+00001af0: 2020 205d 2c0a 2020 2020 2267 7074 2d34     ],.    "gpt-4
+00001b00: 223a 207b 2270 726f 6d70 745f 636f 7374  ": {"prompt_cost
+00001b10: 223a 2030 2e30 332c 2022 636f 6d70 6c65  ": 0.03, "comple
+00001b20: 7469 6f6e 5f63 6f73 7422 3a20 302e 3036  tion_cost": 0.06
+00001b30: 2c20 2270 6572 5f74 6f6b 656e 7322 3a20  , "per_tokens": 
+00001b40: 3130 3030 7d2c 0a20 2020 2022 6770 742d  1000},.    "gpt-
+00001b50: 342d 3033 3134 223a 207b 2270 726f 6d70  4-0314": {"promp
+00001b60: 745f 636f 7374 223a 2030 2e30 332c 2022  t_cost": 0.03, "
+00001b70: 636f 6d70 6c65 7469 6f6e 5f63 6f73 7422  completion_cost"
+00001b80: 3a20 302e 3036 2c20 2270 6572 5f74 6f6b  : 0.06, "per_tok
+00001b90: 656e 7322 3a20 3130 3030 7d2c 0a20 2020  ens": 1000},.   
+00001ba0: 2022 6770 742d 342d 3332 6b22 3a20 7b22   "gpt-4-32k": {"
+00001bb0: 7072 6f6d 7074 5f63 6f73 7422 3a20 302e  prompt_cost": 0.
+00001bc0: 3036 2c20 2263 6f6d 706c 6574 696f 6e5f  06, "completion_
+00001bd0: 636f 7374 223a 2030 2e31 322c 2022 7065  cost": 0.12, "pe
+00001be0: 725f 746f 6b65 6e73 223a 2031 3030 307d  r_tokens": 1000}
+00001bf0: 2c0a 2020 2020 2267 7074 2d34 2d33 326b  ,.    "gpt-4-32k
+00001c00: 2d30 3331 3422 3a20 7b22 7072 6f6d 7074  -0314": {"prompt
+00001c10: 5f63 6f73 7422 3a20 302e 3036 2c20 2263  _cost": 0.06, "c
+00001c20: 6f6d 706c 6574 696f 6e5f 636f 7374 223a  ompletion_cost":
+00001c30: 2030 2e31 322c 2022 7065 725f 746f 6b65   0.12, "per_toke
+00001c40: 6e73 223a 2031 3030 307d 2c0a 2020 2020  ns": 1000},.    
+00001c50: 2267 7074 2d33 2e35 2d74 7572 626f 223a  "gpt-3.5-turbo":
+00001c60: 207b 2270 726f 6d70 745f 636f 7374 223a   {"prompt_cost":
+00001c70: 2030 2e30 3032 2c20 2263 6f6d 706c 6574   0.002, "complet
+00001c80: 696f 6e5f 636f 7374 223a 2030 2e30 3032  ion_cost": 0.002
+00001c90: 2c20 2270 6572 5f74 6f6b 656e 7322 3a20  , "per_tokens": 
+00001ca0: 3130 3030 7d2c 0a20 2020 2022 6770 742d  1000},.    "gpt-
+00001cb0: 332e 352d 7475 7262 6f2d 3033 3031 223a  3.5-turbo-0301":
+00001cc0: 207b 2270 726f 6d70 745f 636f 7374 223a   {"prompt_cost":
+00001cd0: 2030 2e30 3032 2c20 2263 6f6d 706c 6574   0.002, "complet
+00001ce0: 696f 6e5f 636f 7374 223a 2030 2e30 3032  ion_cost": 0.002
+00001cf0: 2c20 2270 6572 5f74 6f6b 656e 7322 3a20  , "per_tokens": 
+00001d00: 3130 3030 7d2c 0a20 2020 2022 7465 7874  1000},.    "text
+00001d10: 2d64 6176 696e 6369 2d30 3033 223a 207b  -davinci-003": {
+00001d20: 2263 6f73 7422 3a20 302e 3032 2c20 2270  "cost": 0.02, "p
+00001d30: 6572 5f74 6f6b 656e 7322 3a20 3130 3030  er_tokens": 1000
+00001d40: 7d2c 0a20 2020 2022 7465 7874 2d63 7572  },.    "text-cur
+00001d50: 6965 2d30 3031 223a 207b 2263 6f73 7422  ie-001": {"cost"
+00001d60: 3a20 302e 3030 322c 2022 7065 725f 746f  : 0.002, "per_to
+00001d70: 6b65 6e73 223a 2031 3030 307d 2c0a 2020  kens": 1000},.  
+00001d80: 2020 2274 6578 742d 6261 6262 6167 652d    "text-babbage-
+00001d90: 3030 3122 3a20 7b22 636f 7374 223a 2030  001": {"cost": 0
+00001da0: 2e30 3030 352c 2022 7065 725f 746f 6b65  .0005, "per_toke
+00001db0: 6e73 223a 2031 3030 307d 2c0a 2020 2020  ns": 1000},.    
+00001dc0: 2274 6578 742d 6164 612d 3030 3122 3a20  "text-ada-001": 
+00001dd0: 7b22 636f 7374 223a 2030 2e30 3030 342c  {"cost": 0.0004,
+00001de0: 2022 7065 725f 746f 6b65 6e73 223a 2031   "per_tokens": 1
+00001df0: 3030 307d 2c0a 2020 2020 2274 6578 742d  000},.    "text-
+00001e00: 656d 6265 6464 696e 672d 6164 612d 3030  embedding-ada-00
+00001e10: 3222 3a20 7b22 636f 7374 223a 2030 2e30  2": {"cost": 0.0
+00001e20: 3030 342c 2022 7065 725f 746f 6b65 6e73  004, "per_tokens
+00001e30: 223a 2031 3030 307d 0a7d 0a60 6060 0a0a  ": 1000}.}.```..
+00001e40: 596f 7520 6361 6e20 6f76 6572 7269 6465  You can override
+00001e50: 2074 6865 2064 6566 6175 6c74 2070 7269   the default pri
+00001e60: 6369 6e67 2077 6974 683a 2060 746f 6b6d  cing with: `tokm
+00001e70: 6f6e 202d 2d70 7269 6369 6e67 202f 7061  on --pricing /pa
+00001e80: 7468 2f74 6f2f 796f 7572 2f63 7573 746f  th/to/your/custo
+00001e90: 6d2d 6f70 656e 6169 2d70 7269 6369 6e67  m-openai-pricing
+00001ea0: 2e6a 736f 6e20 2e2e 2e60 0a0a 3e20 5468  .json ...`..> Th
+00001eb0: 6973 2070 7269 6369 6e67 204a 534f 4e20  is pricing JSON 
+00001ec0: 6973 2069 6e63 6f6d 706c 6574 6520 286d  is incomplete (m
+00001ed0: 6973 7369 6e67 2044 414c 4c2d 452c 2065  issing DALL-E, e
+00001ee0: 7463 2e29 2c20 6974 206d 6179 2062 6520  tc.), it may be 
+00001ef0: 696e 636f 7272 6563 742c 2061 6e64 2069  incorrect, and i
+00001f00: 7420 6d61 7920 676f 206f 7574 206f 6620  t may go out of 
+00001f10: 6461 7465 2e0a 0a3e 2046 6f72 2062 6573  date...> For bes
+00001f20: 7420 7265 7375 6c74 732c 206d 616b 6520  t results, make 
+00001f30: 7375 7265 2074 6f20 6368 6563 6b20 7468  sure to check th
+00001f40: 6174 2079 6f75 2068 6176 6520 7468 6520  at you have the 
+00001f50: 6c61 7465 7374 2070 7269 6369 6e67 2e0a  latest pricing..
+00001f60: 0a23 2320 4d69 7363 0a0a 2323 2320 476f  .## Misc..### Go
+00001f70: 6c61 6e67 0a48 6163 6b79 2077 6f72 6b61  lang.Hacky worka
+00001f80: 726f 756e 6420 666f 7220 476f 6c61 6e67  round for Golang
+00001f90: 2070 726f 6772 616d 732e 2041 6464 2074   programs. Add t
+00001fa0: 6869 7320 746f 2079 6f75 7220 7072 6f67  his to your prog
+00001fb0: 7261 6d3a 0a60 6060 676f 0a09 2f2f 2049  ram:.```go..// I
+00001fc0: 6d70 6f72 7420 7468 6573 6520 7061 636b  mport these pack
+00001fd0: 6167 6573 0a09 696d 706f 7274 2028 0a09  ages..import (..
+00001fe0: 0922 6f73 220a 0920 2020 2022 6372 7970  ."os"..    "cryp
+00001ff0: 746f 2f74 6c73 220a 2020 2020 0922 6372  to/tls".    ."cr
+00002000: 7970 746f 2f78 3530 3922 0a20 2020 2009  ypto/x509".    .
+00002010: 2269 6f2f 696f 7574 696c 220a 2020 2020  "io/ioutil".    
+00002020: 0922 6e65 742f 6874 7470 220a 2020 2020  ."net/http".    
+00002030: 290a 0a09 2f2f 2050 6c61 6365 2074 6869  )...// Place thi
+00002040: 7320 636f 6465 2073 6f6d 6577 6865 7265  s code somewhere
+00002050: 2069 6e20 796f 7572 2067 6f20 7072 6f67   in your go prog
+00002060: 7261 6d20 2a62 6566 6f72 652a 2079 6f75  ram *before* you
+00002070: 206d 616b 6520 616e 7920 6361 6c6c 7320   make any calls 
+00002080: 746f 204f 7065 6e41 4927 7320 4150 492e  to OpenAI's API.
+00002090: 0a09 6365 7274 4669 6c65 203a 3d20 6f73  ..certFile := os
+000020a0: 2e47 6574 656e 7628 2254 4f4b 4d4f 4e5f  .Getenv("TOKMON_
+000020b0: 5353 4c5f 4345 5254 5f46 494c 4522 2920  SSL_CERT_FILE") 
+000020c0: 2f2f 2054 6869 7320 656e 7620 7661 7269  // This env vari
+000020d0: 6162 6c65 2069 7320 7365 7420 6279 2074  able is set by t
+000020e0: 6f6b 6d6f 6e20 7768 656e 6576 6572 2069  okmon whenever i
+000020f0: 7420 7275 6e73 2079 6f75 7220 7072 6f67  t runs your prog
+00002100: 7261 6d2e 0a09 6361 4365 7274 2c20 6572  ram...caCert, er
+00002110: 7220 3a3d 2069 6f75 7469 6c2e 5265 6164  r := ioutil.Read
+00002120: 4669 6c65 2863 6572 7446 696c 6529 0a09  File(certFile)..
+00002130: 6966 2065 7272 203d 3d20 6e69 6c20 7b20  if err == nil { 
+00002140: 0a09 0963 6143 6572 7450 6f6f 6c2c 205f  ...caCertPool, _
+00002150: 203a 3d20 7835 3039 2e53 7973 7465 6d43   := x509.SystemC
+00002160: 6572 7450 6f6f 6c28 290a 0909 6361 4365  ertPool()...caCe
+00002170: 7274 506f 6f6c 2e41 7070 656e 6443 6572  rtPool.AppendCer
+00002180: 7473 4672 6f6d 5045 4d28 6361 4365 7274  tsFromPEM(caCert
+00002190: 290a 0909 6874 7470 2e44 6566 6175 6c74  )...http.Default
+000021a0: 5472 616e 7370 6f72 742e 282a 6874 7470  Transport.(*http
+000021b0: 2e54 7261 6e73 706f 7274 292e 544c 5343  .Transport).TLSC
+000021c0: 6c69 656e 7443 6f6e 6669 6720 3d20 2674  lientConfig = &t
+000021d0: 6c73 2e43 6f6e 6669 677b 0a09 0909 526f  ls.Config{....Ro
+000021e0: 6f74 4341 733a 2063 6143 6572 7450 6f6f  otCAs: caCertPoo
+000021f0: 6c2c 0a09 097d 0a09 7d0a 6060 600a 0a23  l,...}..}.```..#
+00002200: 2320 4375 7272 656e 7420 4c69 6d69 7461  # Current Limita
+00002210: 7469 6f6e 730a 312e 2045 7665 6e74 2073  tions.1. Event s
+00002220: 7472 6561 6d69 6e67 3a20 6074 6f6b 6d6f  treaming: `tokmo
+00002230: 6e60 2062 7566 6665 7273 2053 6572 7665  n` buffers Serve
+00002240: 722d 5365 6e74 2045 7665 6e74 7320 2853  r-Sent Events (S
+00002250: 5345 2920 756e 7469 6c20 7468 6520 6064  SE) until the `d
+00002260: 6174 613a 205b 444f 4e45 5d60 2063 6875  ata: [DONE]` chu
+00002270: 6e6b 2069 7320 7265 6365 6976 6564 2e20  nk is received. 
+00002280: 4966 2074 6865 206d 6f6e 6974 6f72 6564  If the monitored
+00002290: 2070 726f 6772 616d 206c 6576 6572 6167   program leverag
+000022a0: 6573 2065 7665 6e74 2073 7472 6561 6d69  es event streami
+000022b0: 6e67 2c20 6974 7320 6265 6861 7669 6f72  ng, its behavior
+000022c0: 2077 696c 6c20 6265 206d 6f64 6966 6965   will be modifie
+000022d0: 642e 0a20 2020 202d 2049 7373 7565 3a20  d..    - Issue: 
+000022e0: 5b79 6167 696c 2f74 6f6b 6d6f 6e23 345d  [yagil/tokmon#4]
+000022f0: 2868 7474 7073 3a2f 2f67 6974 6875 622e  (https://github.
+00002300: 636f 6d2f 7961 6769 6c2f 746f 6b6d 6f6e  com/yagil/tokmon
+00002310: 2f69 7373 7565 732f 3429 0a32 0a23 2320  /issues/4).2.## 
+00002320: 436f 6e74 7269 6275 7469 6e67 0a49 6620  Contributing.If 
+00002330: 796f 7527 6420 6c69 6b65 2074 6f20 636f  you'd like to co
+00002340: 6e74 7269 6275 7465 2074 6f20 7468 6520  ntribute to the 
+00002350: 7072 6f6a 6563 742c 2070 6c65 6173 6520  project, please 
+00002360: 666f 6c6c 6f77 2074 6865 7365 2073 7465  follow these ste
+00002370: 7073 3a0a 312e 2046 6f72 6b20 7468 6520  ps:.1. Fork the 
+00002380: 7265 706f 7369 746f 7279 2e0a 322e 2043  repository..2. C
+00002390: 7265 6174 6520 6120 6e65 7720 6272 616e  reate a new bran
+000023a0: 6368 2066 6f72 2079 6f75 7220 6368 616e  ch for your chan
+000023b0: 6765 732e 0a33 2e20 4d61 6b65 2079 6f75  ges..3. Make you
+000023c0: 7220 6368 616e 6765 7320 616e 6420 7465  r changes and te
+000023d0: 7374 2074 6865 6d2e 0a34 2e20 5375 626d  st them..4. Subm
+000023e0: 6974 2061 2070 756c 6c20 7265 7175 6573  it a pull reques
+000023f0: 7420 7769 7468 2061 2063 6c65 6172 2064  t with a clear d
+00002400: 6573 6372 6970 7469 6f6e 206f 6620 796f  escription of yo
+00002410: 7572 2063 6861 6e67 6573 2061 6e64 2061  ur changes and a
+00002420: 6e79 2072 656c 6576 616e 7420 696e 666f  ny relevant info
+00002430: 726d 6174 696f 6e2e 0a0a 2323 2057 6172  rmation...## War
+00002440: 6e69 6e67 0a31 2e20 6074 6f6b 6d6f 6e60  ning.1. `tokmon`
+00002450: 2063 6f6d 6573 2077 6974 686f 7574 2061   comes without a
+00002460: 6e79 2077 6172 7261 6e74 7920 6f72 2067  ny warranty or g
+00002470: 7561 7261 6e74 6565 2077 6861 7473 6f65  uarantee whatsoe
+00002480: 7665 722e 0a32 2e20 6074 6f6b 6d6f 6e60  ver..2. `tokmon`
+00002490: 2077 6173 2074 6573 7465 6420 6f6e 206d   was tested on m
+000024a0: 6163 4f53 206f 6e6c 792e 2049 7420 6d69  acOS only. It mi
+000024b0: 6768 7420 6e6f 7420 776f 726b 206f 6e20  ght not work on 
+000024c0: 6f74 6865 7220 706c 6174 666f 726d 732e  other platforms.
+000024d0: 0a33 2e20 5468 6973 2074 6f6f 6c20 6d61  .3. This tool ma
+000024e0: 7920 6e6f 7420 776f 726b 2061 7320 696e  y not work as in
+000024f0: 7465 6e64 6564 2c20 6861 7665 2075 6e6b  tended, have unk
+00002500: 6e6f 776e 2073 6964 6520 6566 6665 6374  nown side effect
+00002510: 732c 206d 6179 206f 7574 7075 7420 696e  s, may output in
+00002520: 636f 7272 6563 7420 696e 666f 726d 6174  correct informat
+00002530: 696f 6e2c 206f 7220 6e6f 7420 776f 726b  ion, or not work
+00002540: 2061 7420 616c 6c2e 0a34 2e20 5468 6520   at all..4. The 
+00002550: 7072 6963 696e 6720 6461 7461 2069 6e20  pricing data in 
+00002560: 606f 7065 6e61 692d 7072 6963 696e 672e  `openai-pricing.
+00002570: 6a73 6f6e 6020 6d61 7920 676f 206f 7574  json` may go out
+00002580: 206f 6620 6461 7465 2e0a                  of date..
```

### Comparing `tokmon-0.1.4/setup.py` & `tokmon-0.2.0/setup.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,15 +3,15 @@
 
 # Read the contents of the README.md file
 with open(os.path.join(os.path.dirname(__file__), "README.md"), encoding="utf-8") as f:
     long_description = f.read()
 
 setup(
     name='tokmon',
-    version='0.1.4',
+    version='0.2.0',
     packages=find_packages(),
     install_requires=[
         'mitmproxy',
         'tiktoken',
     ],
     package_data={
         "tokmon": ["openai-pricing.json"],
```

### Comparing `tokmon-0.1.4/tokmon/costcalculator.py` & `tokmon-0.2.0/tokmon/costcalculator.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from typing import List, Tuple, Dict
 
 class CostCalculator:
-    def __init__(self, pricing_data: Dict[str, Dict[str, float]]):
+    def __init__(self, pricing_data: Dict[str, Dict[str, float]]) -> None:
         self.pricing_data = pricing_data
 
     def calculate_cost_for_tokens(self, tokens, price, per_tokens):
         return (float(tokens) / per_tokens) * price
 
     def calculate_round_trip_cost(self, request: Dict, response: Dict):
         """
@@ -34,22 +34,24 @@
         else:
             """Model has a single cost for all tokens"""
             price = model_pricing_data["cost"]
             total_cost = self.calculate_cost_for_tokens(total_tokens, price, per_tokens)
 
         messages = request["messages"] + response["messages"]
 
-        return model_pricing_data, {
+        cost_summary = {
             "model": model,
             "usage": {"prompt_tokens": prompt_tokens, "completion_tokens": completion_tokens, "total_tokens": total_tokens },
             "cost": total_cost,
             "messages": messages
         }
+        
+        return model_pricing_data, cost_summary
 
-    def calculate_cost(self, usage_data:  List[Tuple[Dict, Dict]]):
+    def calculate_cost(self, conversation_id: str, usage_data: List[Tuple[Dict, Dict]]):
         """
         Calculate cost & usage for all of (request, response) pairs, return a summary
         """
         total_cost = 0.0
         total_prompt_tokens = 0
         total_completion_tokens = 0
         total_tokens = 0
@@ -66,14 +68,15 @@
             total_cost += round_trip_cost["cost"]
             model = round_trip_cost["model"]
             models.add(model)
             pricing_data[model] = model_pricing
             raw_data.append(round_trip_cost)
 
         return {
+            "tokmon_conversation_id": conversation_id,
             "total_cost": total_cost,
             "total_usage": {
                 "total_prompt_tokens": total_prompt_tokens,
                 "total_completion_tokens": total_completion_tokens,
                 "total_tokens": total_tokens,
             },
             "pricing_data": str(pricing_data),
```

### Comparing `tokmon-0.1.4/tokmon/openai-pricing.json` & `tokmon-0.2.0/tokmon/openai-pricing.json`

 * *Files identical despite different names*

### Comparing `tokmon-0.1.4/tokmon/tokmon.py` & `tokmon-0.2.0/tokmon/tokmon.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,106 +1,97 @@
 import asyncio
 import os
 import json
 import subprocess
 import typing
 import time
-import socket
-from typing import Callable, Any, List, Tuple, Dict
+import uuid
+from typing import List, Tuple, Dict, Callable, TypeVar, Optional
 
 import tiktoken
-
 from mitmproxy import http, options
 from mitmproxy.tools.dump import DumpMaster
 
-def find_available_port(start_port: int):
-    """
-    To allow multiple instances of tokmon to run concurrently.
-    """
-    port = start_port
-    while True:
-        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
-            if s.connect_ex(('localhost', port)) != 0:
-                return port
-            port += 1
-
-def count_tokens_in_json(encode_fn: Callable[[str], List[str]], data: Any) -> int:
-    token_count = 0
-    stack = [data]
-
-    while stack:
-        current = stack.pop()
-
-        if isinstance(current, dict):
-            for key, value in current.items(): # 'key' is unused
-                # empricially, the keys seem to not be counted towards the token count
-                # so we are not including this `token_count += count_tokens(key)`
-                stack.append(value)
-        elif isinstance(current, list):
-            stack.extend(current)
-        elif isinstance(current, str):
-            token_count += len(encode_fn(current))
-        else:
-            token_count += len(encode_fn( str(current) ) )
-
-    return token_count
+from tokmon.utils import find_available_port, count_tokens_in_json
 
 PORT = find_available_port(7878)
 
+RequestResponseHandler = Callable[[str, Dict, Dict], None]
+
 class TokenMonitor:
-    def __init__(self, target_url: str, program_name: str, *args: tuple, verbose:bool = False):
-        self.mitm = None
+    def __init__(self,
+                 target_url: str,
+                 program_name: str,
+                 *args: tuple,
+                 verbose:bool = False,
+                 req_res_handler: RequestResponseHandler = None
+                ):
+        self.mitm: Optional[DumpMaster] = None
         self.target_url = target_url
         self.program_name = program_name
         self.args = args
         self.process = None
         self.using_stream = False
         self.verbose = verbose
         self.history: List[Tuple[Dict, Dict]] = []
         self.current_request = None
+        self.req_res_handler = req_res_handler
+        self.conversation_id = str(uuid.uuid4())
 
-    # For handling streaming requests:
+    # Issue: https://github.com/yagil/tokmon/issues/4
+    # 
     # def responseheaders(self, flow: http.HTTPFlow):
     #     if self.target_url in flow.request.pretty_url:
     #         content_type = flow.response.headers.get("Content-Type", "")
     #         if "text/event-stream" in content_type:
     #             flow.response.stream = True
 
     def request(self, flow: http.HTTPFlow):
         self.handle_request(flow)
 
     def response(self, flow: http.HTTPFlow):
         self.handle_response(flow)
+
+    def append_history(self, request: Dict, response: Dict):
+        self.history.append((request, response))
             
     def handle_request(self, flow: http.HTTPFlow):
-        if self.target_url in flow.request.pretty_url:
-            try:
-                if self.current_request is not None:
-                    print("Warning: multiple requests in flight. This is not supported.")
-                
-                request_data = json.loads(flow.request.content)
-                self.current_request = request_data
-
-                if self.verbose:
-                    print(request_data)
-                
-                self.using_stream = request_data["stream"]
+        if self.target_url not in flow.request.pretty_url:
+            return
+        
+        try:
+            if self.current_request is not None:
+                print("Warning: multiple requests in flight. This is not supported.")
+            
+            if flow.request.content is None:
+                raise Exception("No request data")
+            
+            request_data = json.loads(flow.request.content)
+            self.current_request = request_data
 
-            except json.JSONDecodeError:
-                print("Failed to parse request data as JSON")
+            if self.verbose:
+                print(request_data)
+            
+            self.using_stream = request_data["stream"] if "stream" in request_data else False
+
+        except json.JSONDecodeError:
+            print("Failed to parse request data as JSON")
+
+        except Exception as e:
+            print(f"Error handling request: {str(e)}")
 
     def handle_response(self, flow: http.HTTPFlow):
         if not flow.request.url.startswith(self.target_url):
             return
     
         model = ""
         content = ""
         usage = None
 
-        if flow.response.text:
+        if flow.response and flow.response.text is not None:
             if self.using_stream:
                 model, content, usage = self.handle_stream_response(flow.response.text)
             else:    
                 response_data = json.loads(flow.response.text)
                 model = response_data["model"]
                 content = response_data["choices"][0]["message"]["content"]
                 usage = response_data["usage"]
@@ -110,44 +101,53 @@
         request = self.current_request
         response = {
             "model": model,
             "messages": [{"role": "assistant", "content": content}],
             "usage": usage
         }
 
-        self.history.append((request, response))
+        # Add the request and response to the rolling history
+        self.append_history(request, response)
+
+        # Invoke the delegate callback for additional handling on the response object
+        if self.req_res_handler is not None:
+            self.req_res_handler(self.conversation_id, request, response)
+
         self.current_request = None
 
         if self.verbose:
             print(response)
 
     async def run_monitored_program(self) -> bool:
         env = os.environ.copy()
 
         # mitproxy automatically generates a CA cert and stores it in ~/.mitmproxy ...
+        # ... but this coroutine might be called before mitmproxy has had a chance to generate the cert ... ¯\_(ツ)_/¯.
         mitmproxy_path = os.path.expanduser("~/.mitmproxy")
         mitmproxy_abs_path = os.path.abspath(mitmproxy_path)
-        # ... but this coroutine might be called before mitmproxy has had a chance to generate the cert ... ¯\_(ツ)_/¯.
         timeout_seconds = 2
         start = time.time()
         while not os.path.exists(mitmproxy_abs_path):
             await asyncio.sleep(0.1) # yield to other coroutines
             if time.time() - start > timeout_seconds:
                 raise Exception("\n\n*** Error: Cert file wasn't created in time. Try to run `mitmproxy` manually first, and then try running tokmon again.\n\n")
 
         ca_cert_file = "mitmproxy-ca-cert.pem"
         ca_cert_abs_path = os.path.join(mitmproxy_abs_path, ca_cert_file)
 
         # set the HTTP proxy environment variables
         env["HTTP_PROXY"] = f"http://localhost:{PORT}"
         env["HTTPS_PROXY"] = f"http://localhost:{PORT}"
 
-        # add `mitmproxy`'s CA cert to the environment variables of the monitored program
+        # Add `mitmproxy`'s CA cert to the environment variables of the monitored program
         env["REQUESTS_CA_BUNDLE"] = ca_cert_abs_path # for monitored programs using Python's Requests Library
         env["NODE_EXTRA_CA_CERTS"] = ca_cert_abs_path # for monitored programs using Node.js
+        
+        # Support for manually adding `mitmproxy`'s CA cert in the monitored program
+        env["TOKMON_SSL_CERT_FILE"] = ca_cert_abs_path
 
         if self.program_name == 'curl':
             print()
             args = ['--cacert', ca_cert_abs_path] + [arg for arg in self.args]
         else:
             args = [arg for arg in self.args]
 
@@ -217,14 +217,16 @@
             "completion_tokens": completion_tokens,
             "total_tokens": total_tokens
         }
         return model, completion_content, usage
     
     async def start_monitoring(self):        
         opts = options.Options(listen_host='0.0.0.0', listen_port=PORT)
+        if self.verbose:
+            print(f"Starting mitmproxy on port {PORT}...")
         self.mitm = DumpMaster(opts, with_termlog=False, with_dumper=False)
         self.mitm.addons.add(self)
 
         async def run_mitmproxy():
             try:
                 await self.mitm.run()
             except KeyboardInterrupt:
@@ -244,9 +246,9 @@
         await asyncio.gather(run_mitmproxy(), wait_subprocess())
     
     def stop_monitoring(self):
         if self.process:
             self.process.terminate()
         self.mitm.shutdown()
 
-    def usage_summary(self) -> List[Tuple[Dict, Dict]]:
-        return self.history
+    def usage_summary(self):
+        return self.conversation_id, self.history
```


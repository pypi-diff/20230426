# Comparing `tmp/freqtrade-2023.3.tar.gz` & `tmp/freqtrade-2023.4.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "freqtrade-2023.3.tar", last modified: Fri Mar 31 05:42:54 2023, max compression
+gzip compressed data, was "freqtrade-2023.4.tar", last modified: Tue Apr 25 14:49:52 2023, max compression
```

## Comparing `freqtrade-2023.3.tar` & `freqtrade-2023.4.tar`

### file list

```diff
@@ -1,392 +1,409 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.856336 freqtrade-2023.3/
--rw-r--r--   0 runner    (1001) docker     (123)    35141 2023-03-31 05:42:48.000000 freqtrade-2023.3/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)      277 2023-03-31 05:42:48.000000 freqtrade-2023.3/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)    12544 2023-03-31 05:42:54.856336 freqtrade-2023.3/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    11482 2023-03-31 05:42:48.000000 freqtrade-2023.3/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.792334 freqtrade-2023.3/freqtrade/
--rw-r--r--   0 runner    (1001) docker     (123)      810 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/__init__.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      206 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/__main__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.796335 freqtrade-2023.3/freqtrade/commands/
--rw-r--r--   0 runner    (1001) docker     (123)     1741 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2171 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/analyze_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)    20920 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/arguments.py
--rw-r--r--   0 runner    (1001) docker     (123)     8813 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/build_config_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)    21825 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/cli_options.py
--rw-r--r--   0 runner    (1001) docker     (123)     9065 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/data_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1672 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/db_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     6530 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/deploy_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/hyperopt_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     9333 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/list_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     4513 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/optimize_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1388 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/pairlist_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1162 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/plot_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1852 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/strategy_utils_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)      936 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/trade_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)      416 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/commands/webserver_commands.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.796335 freqtrade-2023.3/freqtrade/configuration/
--rw-r--r--   0 runner    (1001) docker     (123)      299 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/configuration/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      723 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/configuration/config_setup.py
--rw-r--r--   0 runner    (1001) docker     (123)    17360 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/configuration/config_validation.py
--rw-r--r--   0 runner    (1001) docker     (123)    24461 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/configuration/configuration.py
--rw-r--r--   0 runner    (1001) docker     (123)     7035 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/configuration/deprecated_settings.py
--rw-r--r--   0 runner    (1001) docker     (123)     3592 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/configuration/directory_operations.py
--rw-r--r--   0 runner    (1001) docker     (123)     1814 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/configuration/environment_vars.py
--rw-r--r--   0 runner    (1001) docker     (123)     3851 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/configuration/load_config.py
--rw-r--r--   0 runner    (1001) docker     (123)     6147 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/configuration/timerange.py
--rw-r--r--   0 runner    (1001) docker     (123)    29111 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/constants.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.796335 freqtrade-2023.3/freqtrade/data/
--rw-r--r--   0 runner    (1001) docker     (123)      152 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    16436 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/btanalysis.py
--rw-r--r--   0 runner    (1001) docker     (123)    13545 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/converter.py
--rw-r--r--   0 runner    (1001) docker     (123)    21145 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/dataprovider.py
--rw-r--r--   0 runner    (1001) docker     (123)    10010 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/entryexitanalysis.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.796335 freqtrade-2023.3/freqtrade/data/history/
--rw-r--r--   0 runner    (1001) docker     (123)      465 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/history/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5048 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/history/featherdatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)     6094 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/history/hdf5datahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)    21492 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/history/history_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    17490 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/history/idatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)     5725 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/history/jsondatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)     4943 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/history/parquetdatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)    12466 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/data/metrics.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.796335 freqtrade-2023.3/freqtrade/edge/
--rw-r--r--   0 runner    (1001) docker     (123)       59 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/edge/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    20825 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/edge/edge_positioning.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.800335 freqtrade-2023.3/freqtrade/enums/
--rw-r--r--   0 runner    (1001) docker     (123)      861 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      238 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/backteststate.py
--rw-r--r--   0 runner    (1001) docker     (123)      798 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/candletype.py
--rw-r--r--   0 runner    (1001) docker     (123)      640 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/exitchecktuple.py
--rw-r--r--   0 runner    (1001) docker     (123)      577 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/exittype.py
--rw-r--r--   0 runner    (1001) docker     (123)      210 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/hyperoptstate.py
--rw-r--r--   0 runner    (1001) docker     (123)      237 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/marginmode.py
--rw-r--r--   0 runner    (1001) docker     (123)      261 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/marketstatetype.py
--rw-r--r--   0 runner    (1001) docker     (123)      100 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/ordertypevalue.py
--rw-r--r--   0 runner    (1001) docker     (123)      177 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/pricetype.py
--rw-r--r--   0 runner    (1001) docker     (123)      976 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/rpcmessagetype.py
--rw-r--r--   0 runner    (1001) docker     (123)      592 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/runmode.py
--rw-r--r--   0 runner    (1001) docker     (123)      626 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/signaltype.py
--rw-r--r--   0 runner    (1001) docker     (123)      202 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/state.py
--rw-r--r--   0 runner    (1001) docker     (123)      220 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/enums/tradingmode.py
--rw-r--r--   0 runner    (1001) docker     (123)     2068 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exceptions.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.804335 freqtrade-2023.3/freqtrade/exchange/
--rw-r--r--   0 runner    (1001) docker     (123)     1462 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9415 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/binance.py
--rw-r--r--   0 runner    (1001) docker     (123)   592945 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/binance_leverage_tiers.json
--rw-r--r--   0 runner    (1001) docker     (123)     1621 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/bitpanda.py
--rw-r--r--   0 runner    (1001) docker     (123)      517 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/bittrex.py
--rw-r--r--   0 runner    (1001) docker     (123)     8304 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/bybit.py
--rw-r--r--   0 runner    (1001) docker     (123)     2975 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/check_exchange.py
--rw-r--r--   0 runner    (1001) docker     (123)      564 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/coinbasepro.py
--rw-r--r--   0 runner    (1001) docker     (123)     5922 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/common.py
--rw-r--r--   0 runner    (1001) docker     (123)   128972 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/exchange.py
--rw-r--r--   0 runner    (1001) docker     (123)    10010 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/exchange_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     5035 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/gate.py
--rw-r--r--   0 runner    (1001) docker     (123)      517 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/hitbtc.py
--rw-r--r--   0 runner    (1001) docker     (123)      827 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/huobi.py
--rw-r--r--   0 runner    (1001) docker     (123)     9535 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/kraken.py
--rw-r--r--   0 runner    (1001) docker     (123)     2120 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/kucoin.py
--rw-r--r--   0 runner    (1001) docker     (123)     9197 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/okx.py
--rw-r--r--   0 runner    (1001) docker     (123)      725 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/exchange/types.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.804335 freqtrade-2023.3/freqtrade/freqai/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.804335 freqtrade-2023.3/freqtrade/freqai/RL/
--rw-r--r--   0 runner    (1001) docker     (123)     4368 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/RL/Base3ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (123)     5292 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/RL/Base4ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (123)     5908 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/RL/Base5ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (123)    14600 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/RL/BaseEnvironment.py
--rw-r--r--   0 runner    (1001) docker     (123)    19776 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/RL/BaseReinforcementLearningModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     2045 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/RL/TensorboardCallback.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/RL/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.804335 freqtrade-2023.3/freqtrade/freqai/base_models/
--rw-r--r--   0 runner    (1001) docker     (123)     4320 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/base_models/BaseClassifierModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     4054 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/base_models/BaseRegressionModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     2572 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/base_models/BaseTensorFlowModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     3466 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2502 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)    29999 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/data_drawer.py
--rw-r--r--   0 runner    (1001) docker     (123)    65887 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/data_kitchen.py
--rw-r--r--   0 runner    (1001) docker     (123)    43754 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/freqai_interface.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.808335 freqtrade-2023.3/freqtrade/freqai/prediction_models/
--rw-r--r--   0 runner    (1001) docker     (123)     1897 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/CatboostClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2680 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     1862 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/CatboostRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2648 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     1734 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/LightGBMClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2512 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     1779 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/LightGBMRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2506 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     6159 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/ReinforcementLearner.py
--rw-r--r--   0 runner    (1001) docker     (123)     2752 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py
--rw-r--r--   0 runner    (1001) docker     (123)     3152 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     3139 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     1658 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     1652 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2410 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/prediction_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9210 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqai/utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    92491 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/freqtradebot.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.808335 freqtrade-2023.3/freqtrade/leverage/
--rw-r--r--   0 runner    (1001) docker     (123)       63 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/leverage/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1257 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/leverage/interest.py
--rw-r--r--   0 runner    (1001) docker     (123)     5199 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/loggers.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2094 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/main.py
--rw-r--r--   0 runner    (1001) docker     (123)    10215 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/misc.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.808335 freqtrade-2023.3/freqtrade/mixins/
--rw-r--r--   0 runner    (1001) docker     (123)       70 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/mixins/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1265 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/mixins/logging_mixin.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.808335 freqtrade-2023.3/freqtrade/optimize/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1519 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/backtest_caching.py
--rw-r--r--   0 runner    (1001) docker     (123)    64620 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/backtesting.py
--rw-r--r--   0 runner    (1001) docker     (123)      856 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/bt_progress.py
--rw-r--r--   0 runner    (1001) docker     (123)     1856 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/edge_cli.py
--rw-r--r--   0 runner    (1001) docker     (123)    29333 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt.py
--rw-r--r--   0 runner    (1001) docker     (123)     3676 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_auto.py
--rw-r--r--   0 runner    (1001) docker     (123)     4525 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_epoch_filters.py
--rw-r--r--   0 runner    (1001) docker     (123)     8554 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_interface.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.812335 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/
--rw-r--r--   0 runner    (1001) docker     (123)     1102 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py
--rw-r--r--   0 runner    (1001) docker     (123)     1237 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py
--rw-r--r--   0 runner    (1001) docker     (123)     1470 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py
--rw-r--r--   0 runner    (1001) docker     (123)      746 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py
--rw-r--r--   0 runner    (1001) docker     (123)      931 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py
--rw-r--r--   0 runner    (1001) docker     (123)     1095 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py
--rw-r--r--   0 runner    (1001) docker     (123)     2108 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py
--rw-r--r--   0 runner    (1001) docker     (123)     1965 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
--rw-r--r--   0 runner    (1001) docker     (123)     1109 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
--rw-r--r--   0 runner    (1001) docker     (123)     2566 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
--rw-r--r--   0 runner    (1001) docker     (123)      951 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_loss_interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    22777 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/hyperopt_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)    42489 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/optimize_reports.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.812335 freqtrade-2023.3/freqtrade/optimize/space/
--rw-r--r--   0 runner    (1001) docker     (123)      127 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/space/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1391 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/optimize/space/decimalspace.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.812335 freqtrade-2023.3/freqtrade/persistence/
--rw-r--r--   0 runner    (1001) docker     (123)      206 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/persistence/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      154 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/persistence/base.py
--rw-r--r--   0 runner    (1001) docker     (123)    15663 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/persistence/migrations.py
--rw-r--r--   0 runner    (1001) docker     (123)     2808 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/persistence/models.py
--rw-r--r--   0 runner    (1001) docker     (123)     3103 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/persistence/pairlock.py
--rw-r--r--   0 runner    (1001) docker     (123)     6366 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/persistence/pairlock_middleware.py
--rw-r--r--   0 runner    (1001) docker     (123)    71503 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/persistence/trade_model.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.812335 freqtrade-2023.3/freqtrade/plot/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plot/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    26213 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plot/plotting.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.812335 freqtrade-2023.3/freqtrade/plugins/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.812335 freqtrade-2023.3/freqtrade/plugins/pairlist/
--rw-r--r--   0 runner    (1001) docker     (123)     5840 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/AgeFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/IPairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/OffsetFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     3259 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/PerformanceFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     2810 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/PrecisionFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     5426 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/PriceFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     3180 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/ProducerPairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     7832 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/RemotePairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     2874 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/ShuffleFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     2505 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/SpreadFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     2369 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/StaticPairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     5025 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/VolatilityFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)    10957 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/VolumePairList.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2347 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/pairlist_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)     5423 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlist/rangestabilityfilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     6881 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/pairlistmanager.py
--rw-r--r--   0 runner    (1001) docker     (123)     2872 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/protectionmanager.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.816335 freqtrade-2023.3/freqtrade/plugins/protections/
--rw-r--r--   0 runner    (1001) docker     (123)      105 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/protections/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2707 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/protections/cooldown_period.py
--rw-r--r--   0 runner    (1001) docker     (123)     4268 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/protections/iprotection.py
--rw-r--r--   0 runner    (1001) docker     (123)     3607 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/protections/low_profit_pairs.py
--rw-r--r--   0 runner    (1001) docker     (123)     3544 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/protections/max_drawdown_protection.py
--rw-r--r--   0 runner    (1001) docker     (123)     3691 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/plugins/protections/stoploss_guard.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.816335 freqtrade-2023.3/freqtrade/resolvers/
--rw-r--r--   0 runner    (1001) docker     (123)      512 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/resolvers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2395 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/resolvers/exchange_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1799 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/resolvers/freqaimodel_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/resolvers/hyperopt_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)    10493 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/resolvers/iresolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/resolvers/pairlist_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1377 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/resolvers/protection_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)    13615 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/resolvers/strategy_resolver.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.820335 freqtrade-2023.3/freqtrade/rpc/
--rw-r--r--   0 runner    (1001) docker     (123)      111 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.824335 freqtrade-2023.3/freqtrade/rpc/api_server/
--rw-r--r--   0 runner    (1001) docker     (123)       47 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5388 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/api_auth.py
--rw-r--r--   0 runner    (1001) docker     (123)     9883 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/api_backtest.py
--rw-r--r--   0 runner    (1001) docker     (123)    10587 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/api_schemas.py
--rw-r--r--   0 runner    (1001) docker     (123)    13843 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/api_v1.py
--rw-r--r--   0 runner    (1001) docker     (123)     4200 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/api_ws.py
--rw-r--r--   0 runner    (1001) docker     (123)     1566 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/deps.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.824335 freqtrade-2023.3/freqtrade/rpc/api_server/ui/
--rw-r--r--   0 runner    (1001) docker     (123)      753 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/ui/fallback_file.html
--rw-r--r--   0 runner    (1001) docker     (123)   126794 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/ui/favicon.ico
--rw-r--r--   0 runner    (1001) docker     (123)     2082 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/uvicorn_threaded.py
--rw-r--r--   0 runner    (1001) docker     (123)     2163 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/web_ui.py
--rw-r--r--   0 runner    (1001) docker     (123)     7992 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/webserver.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.824335 freqtrade-2023.3/freqtrade/rpc/api_server/ws/
--rw-r--r--   0 runner    (1001) docker     (123)      419 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/ws/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7570 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/ws/channel.py
--rw-r--r--   0 runner    (1001) docker     (123)      898 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/ws/message_stream.py
--rw-r--r--   0 runner    (1001) docker     (123)     2292 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/ws/proxy.py
--rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/ws/serializer.py
--rw-r--r--   0 runner    (1001) docker     (123)      257 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/ws/types.py
--rw-r--r--   0 runner    (1001) docker     (123)     1775 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/api_server/ws_schemas.py
--rw-r--r--   0 runner    (1001) docker     (123)     1944 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/discord.py
--rw-r--r--   0 runner    (1001) docker     (123)    14652 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/external_message_consumer.py
--rw-r--r--   0 runner    (1001) docker     (123)     7243 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/fiat_convert.py
--rw-r--r--   0 runner    (1001) docker     (123)    54664 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/rpc.py
--rw-r--r--   0 runner    (1001) docker     (123)     5294 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/rpc_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)     3095 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/rpc_types.py
--rw-r--r--   0 runner    (1001) docker     (123)    76451 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/telegram.py
--rw-r--r--   0 runner    (1001) docker     (123)     4722 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/rpc/webhook.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.828335 freqtrade-2023.3/freqtrade/strategy/
--rw-r--r--   0 runner    (1001) docker     (123)      650 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/strategy/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8278 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/strategy/hyper.py
--rw-r--r--   0 runner    (1001) docker     (123)     5671 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/strategy/informative_decorator.py
--rw-r--r--   0 runner    (1001) docker     (123)    65763 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/strategy/interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    12586 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/strategy/parameters.py
--rw-r--r--   0 runner    (1001) docker     (123)     6781 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/strategy/strategy_helper.py
--rw-r--r--   0 runner    (1001) docker     (123)     1568 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/strategy/strategy_wrapper.py
--rw-r--r--   0 runner    (1001) docker     (123)     9774 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/strategy/strategyupdater.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.828335 freqtrade-2023.3/freqtrade/templates/
--rw-r--r--   0 runner    (1001) docker     (123)    12654 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/FreqaiExampleHybridStrategy.py
--rw-r--r--   0 runner    (1001) docker     (123)    12523 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/FreqaiExampleStrategy.py
--rw-r--r--   0 runner    (1001) docker     (123)     2167 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/base_config.json.j2
--rw-r--r--   0 runner    (1001) docker     (123)     6167 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/base_strategy.py.j2
--rw-r--r--   0 runner    (1001) docker     (123)     1917 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/sample_hyperopt_loss.py
--rw-r--r--   0 runner    (1001) docker     (123)    16719 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/sample_strategy.py
--rw-r--r--   0 runner    (1001) docker     (123)    14583 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_analysis_example.ipynb
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.832335 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/
--rw-r--r--   0 runner    (1001) docker     (123)      261 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/buy_trend_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)      101 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/buy_trend_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/indicators_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)      464 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/indicators_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)      506 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/plot_config_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/plot_config_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)      262 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/sell_trend_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)      103 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/sell_trend_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)    15312 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/strategy_methods_empty.j2
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.832335 freqtrade-2023.3/freqtrade/templates/subtemplates/
--rw-r--r--   0 runner    (1001) docker     (123)      261 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/subtemplates/exchange_binance.j2
--rw-r--r--   0 runner    (1001) docker     (123)      483 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/subtemplates/exchange_bittrex.j2
--rw-r--r--   0 runner    (1001) docker     (123)      271 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/subtemplates/exchange_gateio.j2
--rw-r--r--   0 runner    (1001) docker     (123)      244 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/subtemplates/exchange_generic.j2
--rw-r--r--   0 runner    (1001) docker     (123)      260 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/subtemplates/exchange_huobi.j2
--rw-r--r--   0 runner    (1001) docker     (123)      413 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/subtemplates/exchange_kraken.j2
--rw-r--r--   0 runner    (1001) docker     (123)      291 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/subtemplates/exchange_kucoin.j2
--rw-r--r--   0 runner    (1001) docker     (123)      291 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/templates/subtemplates/exchange_okex.j2
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.836335 freqtrade-2023.3/freqtrade/util/
--rw-r--r--   0 runner    (1001) docker     (123)      132 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2718 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/util/binance_mig.py
--rw-r--r--   0 runner    (1001) docker     (123)      337 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/util/ft_precise.py
--rw-r--r--   0 runner    (1001) docker     (123)      458 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/util/gc_setup.py
--rw-r--r--   0 runner    (1001) docker     (123)      580 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/util/periodic_cache.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.836335 freqtrade-2023.3/freqtrade/vendor/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/vendor/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.836335 freqtrade-2023.3/freqtrade/vendor/qtpylib/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/vendor/qtpylib/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    19870 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/vendor/qtpylib/indicators.py
--rw-r--r--   0 runner    (1001) docker     (123)    13468 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/wallets.py
--rw-r--r--   0 runner    (1001) docker     (123)     8487 2023-03-31 05:42:48.000000 freqtrade-2023.3/freqtrade/worker.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.792334 freqtrade-2023.3/freqtrade.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)    12544 2023-03-31 05:42:54.000000 freqtrade-2023.3/freqtrade.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    12930 2023-03-31 05:42:54.000000 freqtrade-2023.3/freqtrade.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-03-31 05:42:54.000000 freqtrade-2023.3/freqtrade.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)       50 2023-03-31 05:42:54.000000 freqtrade-2023.3/freqtrade.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-03-31 05:42:54.000000 freqtrade-2023.3/freqtrade.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (123)     1350 2023-03-31 05:42:54.000000 freqtrade-2023.3/freqtrade.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)       16 2023-03-31 05:42:54.000000 freqtrade-2023.3/freqtrade.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1652 2023-03-31 05:42:48.000000 freqtrade-2023.3/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)     1227 2023-03-31 05:42:54.860336 freqtrade-2023.3/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     1931 2023-03-31 05:42:48.000000 freqtrade-2023.3/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.840335 freqtrade-2023.3/tests/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.844335 freqtrade-2023.3/tests/commands/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/commands/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4444 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/commands/test_build_config.py
--rw-r--r--   0 runner    (1001) docker     (123)    52543 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/commands/test_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)   124894 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/conftest.py
--rw-r--r--   0 runner    (1001) docker     (123)    14607 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/conftest_trades.py
--rw-r--r--   0 runner    (1001) docker     (123)    10612 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/conftest_trades_usdt.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.844335 freqtrade-2023.3/tests/data/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    18984 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/data/test_btanalysis.py
--rw-r--r--   0 runner    (1001) docker     (123)    12997 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/data/test_converter.py
--rw-r--r--   0 runner    (1001) docker     (123)    21704 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/data/test_datahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)    19077 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/data/test_dataprovider.py
--rw-r--r--   0 runner    (1001) docker     (123)     8070 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/data/test_entryexitanalysis.py
--rw-r--r--   0 runner    (1001) docker     (123)    26838 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/data/test_history.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.844335 freqtrade-2023.3/tests/edge/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/edge/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    20672 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/edge/test_edge.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.848336 freqtrade-2023.3/tests/exchange/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    21870 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_binance.py
--rw-r--r--   0 runner    (1001) docker     (123)     2717 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_bitpanda.py
--rw-r--r--   0 runner    (1001) docker     (123)     3199 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_bybit.py
--rw-r--r--   0 runner    (1001) docker     (123)    29931 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_ccxt_compat.py
--rw-r--r--   0 runner    (1001) docker     (123)     2525 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_ccxt_precise.py
--rw-r--r--   0 runner    (1001) docker     (123)   216525 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_exchange.py
--rw-r--r--   0 runner    (1001) docker     (123)     3556 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_exchange_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3959 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_gate.py
--rw-r--r--   0 runner    (1001) docker     (123)     4959 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_huobi.py
--rw-r--r--   0 runner    (1001) docker     (123)    10755 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_kraken.py
--rw-r--r--   0 runner    (1001) docker     (123)     6621 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_kucoin.py
--rw-r--r--   0 runner    (1001) docker     (123)    22130 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/exchange/test_okx.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.852336 freqtrade-2023.3/tests/optimize/
--rw-r--r--   0 runner    (1001) docker     (123)     2213 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/conftest.py
--rw-r--r--   0 runner    (1001) docker     (123)    43247 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/test_backtest_detail.py
--rw-r--r--   0 runner    (1001) docker     (123)    82510 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/test_backtesting.py
--rw-r--r--   0 runner    (1001) docker     (123)     7660 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/test_backtesting_adjust_position.py
--rw-r--r--   0 runner    (1001) docker     (123)     4236 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/test_edge_cli.py
--rw-r--r--   0 runner    (1001) docker     (123)    44327 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/test_hyperopt.py
--rw-r--r--   0 runner    (1001) docker     (123)    12797 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/test_hyperopt_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)     5541 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/test_hyperoptloss.py
--rw-r--r--   0 runner    (1001) docker     (123)    20674 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/optimize/test_optimize_reports.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.852336 freqtrade-2023.3/tests/persistence/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/persistence/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    15699 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/persistence/test_migrations.py
--rw-r--r--   0 runner    (1001) docker     (123)    98858 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/persistence/test_persistence.py
--rw-r--r--   0 runner    (1001) docker     (123)     6514 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/persistence/test_trade_fromjson.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.852336 freqtrade-2023.3/tests/plugins/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/plugins/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    65213 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/plugins/test_pairlist.py
--rw-r--r--   0 runner    (1001) docker     (123)     5655 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/plugins/test_pairlocks.py
--rw-r--r--   0 runner    (1001) docker     (123)    19048 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/plugins/test_protections.py
--rw-r--r--   0 runner    (1001) docker     (123)     6300 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/plugins/test_remotepairlist.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.856336 freqtrade-2023.3/tests/rpc/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/rpc/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7356 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/rpc/test_fiat_convert.py
--rw-r--r--   0 runner    (1001) docker     (123)    43273 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/rpc/test_rpc.py
--rw-r--r--   0 runner    (1001) docker     (123)    69253 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/rpc/test_rpc_apiserver.py
--rw-r--r--   0 runner    (1001) docker     (123)    14480 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/rpc/test_rpc_emc.py
--rw-r--r--   0 runner    (1001) docker     (123)     9394 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/rpc/test_rpc_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)    90018 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/rpc/test_rpc_telegram.py
--rw-r--r--   0 runner    (1001) docker     (123)    17078 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/rpc/test_rpc_webhook.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:54.856336 freqtrade-2023.3/tests/strategy/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/strategy/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2202 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/strategy/test_default_strategy.py
--rw-r--r--   0 runner    (1001) docker     (123)    40982 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/strategy/test_interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    13011 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/strategy/test_strategy_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)    18658 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/strategy/test_strategy_loading.py
--rw-r--r--   0 runner    (1001) docker     (123)     9004 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_arguments.py
--rw-r--r--   0 runner    (1001) docker     (123)     1761 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_binance_mig.py
--rw-r--r--   0 runner    (1001) docker     (123)    58552 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_configuration.py
--rw-r--r--   0 runner    (1001) docker     (123)     4395 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_directory_operations.py
--rw-r--r--   0 runner    (1001) docker     (123)   227145 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_freqtradebot.py
--rw-r--r--   0 runner    (1001) docker     (123)      880 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_indicators.py
--rw-r--r--   0 runner    (1001) docker     (123)    20426 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_integration.py
--rw-r--r--   0 runner    (1001) docker     (123)     8293 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_main.py
--rw-r--r--   0 runner    (1001) docker     (123)     9765 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_misc.py
--rw-r--r--   0 runner    (1001) docker     (123)      867 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_periodiccache.py
--rw-r--r--   0 runner    (1001) docker     (123)    20021 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_plotting.py
--rw-r--r--   0 runner    (1001) docker     (123)     6750 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_strategy_updater.py
--rw-r--r--   0 runner    (1001) docker     (123)      414 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_talib.py
--rw-r--r--   0 runner    (1001) docker     (123)     3436 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_timerange.py
--rw-r--r--   0 runner    (1001) docker     (123)    13076 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_wallets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6719 2023-03-31 05:42:48.000000 freqtrade-2023.3/tests/test_worker.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.029684 freqtrade-2023.4/
+-rw-r--r--   0 runner    (1001) docker     (123)    35141 2023-04-25 14:49:48.000000 freqtrade-2023.4/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)      277 2023-04-25 14:49:48.000000 freqtrade-2023.4/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)    12539 2023-04-25 14:49:52.029684 freqtrade-2023.4/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    11477 2023-04-25 14:49:48.000000 freqtrade-2023.4/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.981684 freqtrade-2023.4/freqtrade/
+-rw-r--r--   0 runner    (1001) docker     (123)      810 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/__init__.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      206 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/__main__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.985684 freqtrade-2023.4/freqtrade/commands/
+-rw-r--r--   0 runner    (1001) docker     (123)     1741 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2171 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/analyze_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20942 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/arguments.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8813 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/build_config_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21825 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/cli_options.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9065 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/data_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1672 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/db_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6530 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/deploy_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/hyperopt_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9333 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/list_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4513 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/optimize_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1388 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/pairlist_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1162 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/plot_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1852 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/strategy_utils_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)      936 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/trade_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)      416 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/commands/webserver_commands.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.985684 freqtrade-2023.4/freqtrade/configuration/
+-rw-r--r--   0 runner    (1001) docker     (123)      299 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/configuration/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      723 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/configuration/config_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17360 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/configuration/config_validation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24461 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/configuration/configuration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7035 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/configuration/deprecated_settings.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3592 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/configuration/directory_operations.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1814 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/configuration/environment_vars.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3851 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/configuration/load_config.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6143 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/configuration/timerange.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29216 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/constants.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.985684 freqtrade-2023.4/freqtrade/data/
+-rw-r--r--   0 runner    (1001) docker     (123)      152 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16153 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/btanalysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13517 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/converter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21145 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/dataprovider.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10010 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/entryexitanalysis.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.989684 freqtrade-2023.4/freqtrade/data/history/
+-rw-r--r--   0 runner    (1001) docker     (123)      465 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/history/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4903 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/history/featherdatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6094 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/history/hdf5datahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21492 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/history/history_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17490 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/history/idatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5580 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/history/jsondatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4798 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/history/parquetdatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12466 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/data/metrics.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.989684 freqtrade-2023.4/freqtrade/edge/
+-rw-r--r--   0 runner    (1001) docker     (123)       59 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/edge/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20825 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/edge/edge_positioning.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.989684 freqtrade-2023.4/freqtrade/enums/
+-rw-r--r--   0 runner    (1001) docker     (123)      861 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      238 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/backteststate.py
+-rw-r--r--   0 runner    (1001) docker     (123)      798 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/candletype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      640 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/exitchecktuple.py
+-rw-r--r--   0 runner    (1001) docker     (123)      577 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/exittype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      210 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/hyperoptstate.py
+-rw-r--r--   0 runner    (1001) docker     (123)      237 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/marginmode.py
+-rw-r--r--   0 runner    (1001) docker     (123)      261 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/marketstatetype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      100 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/ordertypevalue.py
+-rw-r--r--   0 runner    (1001) docker     (123)      177 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/pricetype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      976 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/rpcmessagetype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      592 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/runmode.py
+-rw-r--r--   0 runner    (1001) docker     (123)      626 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/signaltype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      202 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/state.py
+-rw-r--r--   0 runner    (1001) docker     (123)      220 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/enums/tradingmode.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2068 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exceptions.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.993684 freqtrade-2023.4/freqtrade/exchange/
+-rw-r--r--   0 runner    (1001) docker     (123)     1531 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9415 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/binance.py
+-rw-r--r--   0 runner    (1001) docker     (123)   605433 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/binance_leverage_tiers.json
+-rw-r--r--   0 runner    (1001) docker     (123)     1621 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/bitpanda.py
+-rw-r--r--   0 runner    (1001) docker     (123)      517 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/bittrex.py
+-rw-r--r--   0 runner    (1001) docker     (123)      547 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/bitvavo.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8304 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/bybit.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2975 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/check_exchange.py
+-rw-r--r--   0 runner    (1001) docker     (123)      564 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/coinbasepro.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5922 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)   129828 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/exchange.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10673 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/exchange_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5035 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/gate.py
+-rw-r--r--   0 runner    (1001) docker     (123)      517 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/hitbtc.py
+-rw-r--r--   0 runner    (1001) docker     (123)      827 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/huobi.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9717 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/kraken.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2120 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/kucoin.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8621 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/okx.py
+-rw-r--r--   0 runner    (1001) docker     (123)      725 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/exchange/types.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.993684 freqtrade-2023.4/freqtrade/freqai/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.993684 freqtrade-2023.4/freqtrade/freqai/RL/
+-rw-r--r--   0 runner    (1001) docker     (123)     4405 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/RL/Base3ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4930 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/RL/Base4ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5554 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/RL/Base5ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14600 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/RL/BaseEnvironment.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19776 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/RL/BaseReinforcementLearningModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2045 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/RL/TensorboardCallback.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/RL/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.993684 freqtrade-2023.4/freqtrade/freqai/base_models/
+-rw-r--r--   0 runner    (1001) docker     (123)     4320 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/base_models/BaseClassifierModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5478 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/base_models/BasePyTorchClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2920 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/base_models/BasePyTorchModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1692 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/base_models/BasePyTorchRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4054 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/base_models/BaseRegressionModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2572 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/base_models/BaseTensorFlowModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3466 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2502 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30241 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/data_drawer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65930 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/data_kitchen.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44061 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/freqai_interface.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.997684 freqtrade-2023.4/freqtrade/freqai/prediction_models/
+-rw-r--r--   0 runner    (1001) docker     (123)     2083 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/CatboostClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2866 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2048 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/CatboostRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2834 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1920 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/LightGBMClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2698 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1837 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/LightGBMRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2692 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3470 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3160 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6227 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/ReinforcementLearner.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2752 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3338 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/XGBoostClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3345 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1844 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1838 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/XGBoostRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2596 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/prediction_models/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.997684 freqtrade-2023.4/freqtrade/freqai/torch/
+-rw-r--r--   0 runner    (1001) docker     (123)     2062 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/torch/PyTorchDataConvertor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3796 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/torch/PyTorchMLPModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8171 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/torch/PyTorchModelTrainer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2026 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/torch/PyTorchTrainerInterface.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/torch/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9210 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqai/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    92762 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/freqtradebot.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.997684 freqtrade-2023.4/freqtrade/leverage/
+-rw-r--r--   0 runner    (1001) docker     (123)       63 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/leverage/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1257 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/leverage/interest.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.997684 freqtrade-2023.4/freqtrade/loggers/
+-rw-r--r--   0 runner    (1001) docker     (123)     4888 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/loggers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      460 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/loggers/buffering_handler.py
+-rw-r--r--   0 runner    (1001) docker     (123)      714 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/loggers/std_err_stream_handler.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2094 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/main.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10215 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/misc.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.997684 freqtrade-2023.4/freqtrade/mixins/
+-rw-r--r--   0 runner    (1001) docker     (123)       70 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/mixins/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1265 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/mixins/logging_mixin.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.001684 freqtrade-2023.4/freqtrade/optimize/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1519 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/backtest_caching.py
+-rw-r--r--   0 runner    (1001) docker     (123)    64620 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/backtesting.py
+-rw-r--r--   0 runner    (1001) docker     (123)      856 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/bt_progress.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1856 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/edge_cli.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28627 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3676 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_auto.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4525 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_epoch_filters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8554 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_interface.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.001684 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/
+-rw-r--r--   0 runner    (1001) docker     (123)     1102 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1237 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1470 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py
+-rw-r--r--   0 runner    (1001) docker     (123)      746 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py
+-rw-r--r--   0 runner    (1001) docker     (123)      931 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1095 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2108 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1965 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1109 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2566 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
+-rw-r--r--   0 runner    (1001) docker     (123)      951 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_loss_interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23094 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/hyperopt_tools.py
+-rw-r--r--   0 runner    (1001) docker     (123)    43210 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/optimize_reports.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.001684 freqtrade-2023.4/freqtrade/optimize/space/
+-rw-r--r--   0 runner    (1001) docker     (123)      127 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/space/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1391 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/optimize/space/decimalspace.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.001684 freqtrade-2023.4/freqtrade/persistence/
+-rw-r--r--   0 runner    (1001) docker     (123)      284 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/persistence/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      154 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/persistence/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6397 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/persistence/key_value_store.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15663 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/persistence/migrations.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2926 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/persistence/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3103 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/persistence/pairlock.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6366 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/persistence/pairlock_middleware.py
+-rw-r--r--   0 runner    (1001) docker     (123)    72089 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/persistence/trade_model.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.001684 freqtrade-2023.4/freqtrade/plot/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plot/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26213 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plot/plotting.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.005684 freqtrade-2023.4/freqtrade/plugins/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.005684 freqtrade-2023.4/freqtrade/plugins/pairlist/
+-rw-r--r--   0 runner    (1001) docker     (123)     5840 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/AgeFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/IPairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/OffsetFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3259 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/PerformanceFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2957 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/PrecisionFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5426 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/PriceFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3180 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/ProducerPairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/RemotePairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2874 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/ShuffleFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2505 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/SpreadFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2369 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/StaticPairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5025 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/VolatilityFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10957 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/VolumePairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2347 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/pairlist_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5423 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlist/rangestabilityfilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6881 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/pairlistmanager.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2872 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/protectionmanager.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.005684 freqtrade-2023.4/freqtrade/plugins/protections/
+-rw-r--r--   0 runner    (1001) docker     (123)      105 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/protections/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2707 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/protections/cooldown_period.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4268 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/protections/iprotection.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3607 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/protections/low_profit_pairs.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3544 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/protections/max_drawdown_protection.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3691 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/plugins/protections/stoploss_guard.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.009684 freqtrade-2023.4/freqtrade/resolvers/
+-rw-r--r--   0 runner    (1001) docker     (123)      512 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/resolvers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2395 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/resolvers/exchange_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1799 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/resolvers/freqaimodel_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/resolvers/hyperopt_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10493 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/resolvers/iresolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/resolvers/pairlist_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1377 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/resolvers/protection_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13615 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/resolvers/strategy_resolver.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.009684 freqtrade-2023.4/freqtrade/rpc/
+-rw-r--r--   0 runner    (1001) docker     (123)      111 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.009684 freqtrade-2023.4/freqtrade/rpc/api_server/
+-rw-r--r--   0 runner    (1001) docker     (123)       47 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5388 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/api_auth.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9883 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/api_backtest.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10640 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/api_schemas.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13827 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/api_v1.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4200 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/api_ws.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1566 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/deps.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.009684 freqtrade-2023.4/freqtrade/rpc/api_server/ui/
+-rw-r--r--   0 runner    (1001) docker     (123)      753 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/ui/fallback_file.html
+-rw-r--r--   0 runner    (1001) docker     (123)   126794 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/ui/favicon.ico
+-rw-r--r--   0 runner    (1001) docker     (123)     2100 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/uvicorn_threaded.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2163 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/web_ui.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7992 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/webserver.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.009684 freqtrade-2023.4/freqtrade/rpc/api_server/ws/
+-rw-r--r--   0 runner    (1001) docker     (123)      419 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/ws/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7570 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/ws/channel.py
+-rw-r--r--   0 runner    (1001) docker     (123)      898 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/ws/message_stream.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2292 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/ws/proxy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/ws/serializer.py
+-rw-r--r--   0 runner    (1001) docker     (123)      257 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/ws/types.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1775 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/api_server/ws_schemas.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1944 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/discord.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14652 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/external_message_consumer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7243 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/fiat_convert.py
+-rw-r--r--   0 runner    (1001) docker     (123)    55689 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/rpc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5294 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/rpc_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3061 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/rpc_types.py
+-rw-r--r--   0 runner    (1001) docker     (123)    76482 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/telegram.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4722 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/rpc/webhook.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.013684 freqtrade-2023.4/freqtrade/strategy/
+-rw-r--r--   0 runner    (1001) docker     (123)      650 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/strategy/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8240 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/strategy/hyper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5671 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/strategy/informative_decorator.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65833 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/strategy/interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12586 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/strategy/parameters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6781 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/strategy/strategy_helper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1568 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/strategy/strategy_wrapper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9774 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/strategy/strategyupdater.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.013684 freqtrade-2023.4/freqtrade/templates/
+-rw-r--r--   0 runner    (1001) docker     (123)    12781 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/FreqaiExampleHybridStrategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12601 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/FreqaiExampleStrategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2167 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/base_config.json.j2
+-rw-r--r--   0 runner    (1001) docker     (123)     6167 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/base_strategy.py.j2
+-rw-r--r--   0 runner    (1001) docker     (123)     1917 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/sample_hyperopt_loss.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16719 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/sample_strategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14583 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_analysis_example.ipynb
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.013684 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/
+-rw-r--r--   0 runner    (1001) docker     (123)      261 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/buy_trend_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      101 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/buy_trend_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/indicators_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      464 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/indicators_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      506 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/plot_config_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/plot_config_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      262 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/sell_trend_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      103 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/sell_trend_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)    15312 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/strategy_methods_empty.j2
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.013684 freqtrade-2023.4/freqtrade/templates/subtemplates/
+-rw-r--r--   0 runner    (1001) docker     (123)      261 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/subtemplates/exchange_binance.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      483 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/subtemplates/exchange_bittrex.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      271 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/subtemplates/exchange_gateio.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      244 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/subtemplates/exchange_generic.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      260 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/subtemplates/exchange_huobi.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      413 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/subtemplates/exchange_kraken.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      291 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/subtemplates/exchange_kucoin.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      291 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/templates/subtemplates/exchange_okex.j2
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.017684 freqtrade-2023.4/freqtrade/util/
+-rw-r--r--   0 runner    (1001) docker     (123)      132 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2718 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/util/binance_mig.py
+-rw-r--r--   0 runner    (1001) docker     (123)      337 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/util/ft_precise.py
+-rw-r--r--   0 runner    (1001) docker     (123)      458 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/util/gc_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)      580 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/util/periodic_cache.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.017684 freqtrade-2023.4/freqtrade/vendor/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/vendor/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.017684 freqtrade-2023.4/freqtrade/vendor/qtpylib/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/vendor/qtpylib/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19870 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/vendor/qtpylib/indicators.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13551 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/wallets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8487 2023-04-25 14:49:48.000000 freqtrade-2023.4/freqtrade/worker.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:51.981684 freqtrade-2023.4/freqtrade.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)    12539 2023-04-25 14:49:51.000000 freqtrade-2023.4/freqtrade.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    13628 2023-04-25 14:49:51.000000 freqtrade-2023.4/freqtrade.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-25 14:49:51.000000 freqtrade-2023.4/freqtrade.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       50 2023-04-25 14:49:51.000000 freqtrade-2023.4/freqtrade.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-25 14:49:51.000000 freqtrade-2023.4/freqtrade.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (123)     1323 2023-04-25 14:49:51.000000 freqtrade-2023.4/freqtrade.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       16 2023-04-25 14:49:51.000000 freqtrade-2023.4/freqtrade.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-04-25 14:49:48.000000 freqtrade-2023.4/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)     1227 2023-04-25 14:49:52.029684 freqtrade-2023.4/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     1934 2023-04-25 14:49:48.000000 freqtrade-2023.4/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.017684 freqtrade-2023.4/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.021684 freqtrade-2023.4/tests/commands/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4444 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/commands/test_build_config.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52543 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/commands/test_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)   124895 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/conftest.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14607 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/conftest_trades.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10612 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/conftest_trades_usdt.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.021684 freqtrade-2023.4/tests/data/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18984 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/data/test_btanalysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12997 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/data/test_converter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21704 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/data/test_datahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19077 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/data/test_dataprovider.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8070 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/data/test_entryexitanalysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26838 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/data/test_history.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.021684 freqtrade-2023.4/tests/edge/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/edge/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20672 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/edge/test_edge.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.021684 freqtrade-2023.4/tests/exchange/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21890 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_binance.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2717 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_bitpanda.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3199 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_bybit.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30064 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_ccxt_compat.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2525 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_ccxt_precise.py
+-rw-r--r--   0 runner    (1001) docker     (123)   218526 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_exchange.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3556 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_exchange_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3959 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_gate.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4979 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_huobi.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10785 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_kraken.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6641 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_kucoin.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22177 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/exchange/test_okx.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.025684 freqtrade-2023.4/tests/optimize/
+-rw-r--r--   0 runner    (1001) docker     (123)     2213 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/conftest.py
+-rw-r--r--   0 runner    (1001) docker     (123)    43247 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/test_backtest_detail.py
+-rw-r--r--   0 runner    (1001) docker     (123)    82510 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/test_backtesting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7660 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/test_backtesting_adjust_position.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4236 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/test_edge_cli.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44327 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/test_hyperopt.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12797 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/test_hyperopt_tools.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5541 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/test_hyperoptloss.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20805 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/optimize/test_optimize_reports.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.025684 freqtrade-2023.4/tests/persistence/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/persistence/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2942 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/persistence/test_key_value_store.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15699 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/persistence/test_migrations.py
+-rw-r--r--   0 runner    (1001) docker     (123)    99646 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/persistence/test_persistence.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6514 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/persistence/test_trade_fromjson.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.025684 freqtrade-2023.4/tests/plugins/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/plugins/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65213 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/plugins/test_pairlist.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5655 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/plugins/test_pairlocks.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19048 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/plugins/test_protections.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6300 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/plugins/test_remotepairlist.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.025684 freqtrade-2023.4/tests/rpc/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/rpc/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7356 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/rpc/test_fiat_convert.py
+-rw-r--r--   0 runner    (1001) docker     (123)    43368 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/rpc/test_rpc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    69423 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/rpc/test_rpc_apiserver.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14480 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/rpc/test_rpc_emc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9666 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/rpc/test_rpc_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)    90265 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/rpc/test_rpc_telegram.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17078 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/rpc/test_rpc_webhook.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:52.029684 freqtrade-2023.4/tests/strategy/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/strategy/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2202 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/strategy/test_default_strategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    41178 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/strategy/test_interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13011 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/strategy/test_strategy_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18658 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/strategy/test_strategy_loading.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9004 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_arguments.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1761 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_binance_mig.py
+-rw-r--r--   0 runner    (1001) docker     (123)    58608 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_configuration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4395 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_directory_operations.py
+-rw-r--r--   0 runner    (1001) docker     (123)   232129 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_freqtradebot.py
+-rw-r--r--   0 runner    (1001) docker     (123)      880 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_indicators.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20426 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_integration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8293 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_main.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9765 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_misc.py
+-rw-r--r--   0 runner    (1001) docker     (123)      867 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_periodiccache.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20021 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_plotting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6750 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_strategy_updater.py
+-rw-r--r--   0 runner    (1001) docker     (123)      414 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_talib.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3534 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_timerange.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13076 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_wallets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6719 2023-04-25 14:49:48.000000 freqtrade-2023.4/tests/test_worker.py
```

### Comparing `freqtrade-2023.3/LICENSE` & `freqtrade-2023.4/LICENSE`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/PKG-INFO` & `freqtrade-2023.4/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: freqtrade
-Version: 2023.3
+Version: 2023.4
 Summary: Freqtrade - Crypto Trading Bot
 Home-page: https://github.com/freqtrade/freqtrade
 Author: Freqtrade Team
 Author-email: freqtrade@protonmail.com
 License: GPLv3
 Project-URL: Bug Tracker, https://github.com/freqtrade/freqtrade/issues
 Classifier: Environment :: Console
@@ -237,10 +237,10 @@
 - Minimal (advised) system requirements: 2GB RAM, 1GB disk space, 2vCPU
 
 ### Software requirements
 
 - [Python >= 3.8](http://docs.python-guide.org/en/latest/starting/installation/)
 - [pip](https://pip.pypa.io/en/stable/installing/)
 - [git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git)
-- [TA-Lib](https://mrjbq7.github.io/ta-lib/install.html)
+- [TA-Lib](https://ta-lib.github.io/ta-lib-python/)
 - [virtualenv](https://virtualenv.pypa.io/en/stable/installation.html) (Recommended)
 - [Docker](https://www.docker.com/products/docker) (Recommended)
```

### Comparing `freqtrade-2023.3/README.md` & `freqtrade-2023.4/README.md`

 * *Files 1% similar despite different names*

```diff
@@ -206,10 +206,10 @@
 - Minimal (advised) system requirements: 2GB RAM, 1GB disk space, 2vCPU
 
 ### Software requirements
 
 - [Python >= 3.8](http://docs.python-guide.org/en/latest/starting/installation/)
 - [pip](https://pip.pypa.io/en/stable/installing/)
 - [git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git)
-- [TA-Lib](https://mrjbq7.github.io/ta-lib/install.html)
+- [TA-Lib](https://ta-lib.github.io/ta-lib-python/)
 - [virtualenv](https://virtualenv.pypa.io/en/stable/installation.html) (Recommended)
 - [Docker](https://www.docker.com/products/docker) (Recommended)
```

### Comparing `freqtrade-2023.3/freqtrade/__init__.py` & `freqtrade-2023.4/freqtrade/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 """ Freqtrade bot """
-__version__ = '2023.3'
+__version__ = '2023.4'
 
 if 'dev' in __version__:
     from pathlib import Path
     try:
         import subprocess
         freqtrade_basedir = Path(__file__).parent
```

### Comparing `freqtrade-2023.3/freqtrade/commands/__init__.py` & `freqtrade-2023.4/freqtrade/commands/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/analyze_commands.py` & `freqtrade-2023.4/freqtrade/commands/analyze_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/arguments.py` & `freqtrade-2023.4/freqtrade/commands/arguments.py`

 * *Files 1% similar despite different names*

```diff
@@ -42,15 +42,15 @@
 ARGS_LIST_STRATEGIES = ["strategy_path", "print_one_column", "print_colorized",
                         "recursive_strategy_search"]
 
 ARGS_LIST_FREQAIMODELS = ["freqaimodel_path", "print_one_column", "print_colorized"]
 
 ARGS_LIST_HYPEROPTS = ["hyperopt_path", "print_one_column", "print_colorized"]
 
-ARGS_BACKTEST_SHOW = ["exportfilename", "backtest_show_pair_list"]
+ARGS_BACKTEST_SHOW = ["exportfilename", "backtest_show_pair_list", "backtest_breakdown"]
 
 ARGS_LIST_EXCHANGES = ["print_one_column", "list_exchanges_all"]
 
 ARGS_LIST_TIMEFRAMES = ["exchange", "print_one_column"]
 
 ARGS_LIST_PAIRS = ["exchange", "print_list", "list_pairs_print_json", "print_one_column",
                    "print_csv", "base_currencies", "quote_currencies", "list_pairs_all",
```

### Comparing `freqtrade-2023.3/freqtrade/commands/build_config_commands.py` & `freqtrade-2023.4/freqtrade/commands/build_config_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/cli_options.py` & `freqtrade-2023.4/freqtrade/commands/cli_options.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/data_commands.py` & `freqtrade-2023.4/freqtrade/commands/data_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/db_commands.py` & `freqtrade-2023.4/freqtrade/commands/db_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/deploy_commands.py` & `freqtrade-2023.4/freqtrade/commands/deploy_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/hyperopt_commands.py` & `freqtrade-2023.4/freqtrade/commands/hyperopt_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/list_commands.py` & `freqtrade-2023.4/freqtrade/commands/list_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/optimize_commands.py` & `freqtrade-2023.4/freqtrade/commands/optimize_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/pairlist_commands.py` & `freqtrade-2023.4/freqtrade/commands/pairlist_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/plot_commands.py` & `freqtrade-2023.4/freqtrade/commands/plot_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/strategy_utils_commands.py` & `freqtrade-2023.4/freqtrade/commands/strategy_utils_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/commands/trade_commands.py` & `freqtrade-2023.4/freqtrade/commands/trade_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/configuration/config_setup.py` & `freqtrade-2023.4/freqtrade/configuration/config_setup.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/configuration/config_validation.py` & `freqtrade-2023.4/freqtrade/configuration/config_validation.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/configuration/configuration.py` & `freqtrade-2023.4/freqtrade/configuration/configuration.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/configuration/deprecated_settings.py` & `freqtrade-2023.4/freqtrade/configuration/deprecated_settings.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/configuration/directory_operations.py` & `freqtrade-2023.4/freqtrade/configuration/directory_operations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/configuration/environment_vars.py` & `freqtrade-2023.4/freqtrade/configuration/environment_vars.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/configuration/load_config.py` & `freqtrade-2023.4/freqtrade/configuration/load_config.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/configuration/timerange.py` & `freqtrade-2023.4/freqtrade/configuration/timerange.py`

 * *Files 1% similar despite different names*

```diff
@@ -112,15 +112,15 @@
     @staticmethod
     def parse_timerange(text: Optional[str]) -> 'TimeRange':
         """
         Parse the value of the argument --timerange to determine what is the range desired
         :param text: value from --timerange
         :return: Start and End range period
         """
-        if text is None:
+        if not text:
             return TimeRange(None, None, 0, 0)
         syntax = [(r'^-(\d{8})$', (None, 'date')),
                   (r'^(\d{8})-$', ('date', None)),
                   (r'^(\d{8})-(\d{8})$', ('date', 'date')),
                   (r'^-(\d{10})$', (None, 'date')),
                   (r'^(\d{10})-$', ('date', None)),
                   (r'^(\d{10})-(\d{10})$', ('date', 'date')),
```

### Comparing `freqtrade-2023.3/freqtrade/constants.py` & `freqtrade-2023.4/freqtrade/constants.py`

 * *Files 1% similar despite different names*

```diff
@@ -60,14 +60,15 @@
 USERPATH_STRATEGIES = 'strategies'
 USERPATH_NOTEBOOKS = 'notebooks'
 USERPATH_FREQAIMODELS = 'freqaimodels'
 
 TELEGRAM_SETTING_OPTIONS = ['on', 'off', 'silent']
 WEBHOOK_FORMAT_OPTIONS = ['form', 'json', 'raw']
 FULL_DATAFRAME_THRESHOLD = 100
+CUSTOM_TAG_MAX_LENGTH = 255
 
 ENV_VAR_PREFIX = 'FREQTRADE__'
 
 NON_OPEN_EXCHANGE_STATES = ('cancelled', 'canceled', 'closed', 'expired')
 
 # Define decimals per coin for outputs
 # Only used for outputs.
@@ -594,15 +595,16 @@
                         "max_trade_duration_candles": {"type": "integer"},
                         "add_state_info": {"type": "boolean", "default": False},
                         "max_training_drawdown_pct": {"type": "number", "default": 0.02},
                         "cpu_count": {"type": "integer", "default": 1},
                         "model_type": {"type": "string", "default": "PPO"},
                         "policy_type": {"type": "string", "default": "MlpPolicy"},
                         "net_arch": {"type": "array", "default": [128, 128]},
-                        "randomize_startinng_position": {"type": "boolean", "default": False},
+                        "randomize_starting_position": {"type": "boolean", "default": False},
+                        "progress_bar": {"type": "boolean", "default": True},
                         "model_reward_parameters": {
                             "type": "object",
                             "properties": {
                                 "rr": {"type": "number", "default": 1},
                                 "profit_aim": {"type": "number", "default": 0.025}
                             }
                         }
```

### Comparing `freqtrade-2023.3/freqtrade/data/btanalysis.py` & `freqtrade-2023.4/freqtrade/data/btanalysis.py`

 * *Files 1% similar despite different names*

```diff
@@ -242,22 +242,16 @@
     return results
 
 
 def _load_backtest_data_df_compatibility(df: pd.DataFrame) -> pd.DataFrame:
     """
     Compatibility support for older backtest data.
     """
-    df['open_date'] = pd.to_datetime(df['open_date'],
-                                     utc=True,
-                                     infer_datetime_format=True
-                                     )
-    df['close_date'] = pd.to_datetime(df['close_date'],
-                                      utc=True,
-                                      infer_datetime_format=True
-                                      )
+    df['open_date'] = pd.to_datetime(df['open_date'], utc=True)
+    df['close_date'] = pd.to_datetime(df['close_date'], utc=True)
     # Compatibility support for pre short Columns
     if 'is_short' not in df.columns:
         df['is_short'] = False
     if 'leverage' not in df.columns:
         df['leverage'] = 1.0
     if 'enter_tag' not in df.columns:
         df['enter_tag'] = df['buy_tag']
```

### Comparing `freqtrade-2023.3/freqtrade/data/converter.py` & `freqtrade-2023.4/freqtrade/data/converter.py`

 * *Files 0% similar despite different names*

```diff
@@ -30,15 +30,15 @@
     :param drop_incomplete: Drop the last candle of the dataframe, assuming it's incomplete
     :return: DataFrame
     """
     logger.debug(f"Converting candle (OHLCV) data to dataframe for pair {pair}.")
     cols = DEFAULT_DATAFRAME_COLUMNS
     df = DataFrame(ohlcv, columns=cols)
 
-    df['date'] = to_datetime(df['date'], unit='ms', utc=True, infer_datetime_format=True)
+    df['date'] = to_datetime(df['date'], unit='ms', utc=True)
 
     # Some exchanges return int values for Volume and even for OHLC.
     # Convert them since TA-LIB indicators used in the strategy assume floats
     # and fail with exception...
     df = df.astype(dtype={'open': 'float', 'high': 'float', 'low': 'float', 'close': 'float',
                           'volume': 'float'})
     return clean_ohlcv_dataframe(df, timeframe, pair,
```

### Comparing `freqtrade-2023.3/freqtrade/data/dataprovider.py` & `freqtrade-2023.4/freqtrade/data/dataprovider.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/data/entryexitanalysis.py` & `freqtrade-2023.4/freqtrade/data/entryexitanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/data/history/featherdatahandler.py` & `freqtrade-2023.4/freqtrade/data/history/featherdatahandler.py`

 * *Files 1% similar despite different names*

```diff
@@ -59,18 +59,15 @@
             if not filename.exists():
                 return DataFrame(columns=self._columns)
 
         pairdata = read_feather(filename)
         pairdata.columns = self._columns
         pairdata = pairdata.astype(dtype={'open': 'float', 'high': 'float',
                                           'low': 'float', 'close': 'float', 'volume': 'float'})
-        pairdata['date'] = to_datetime(pairdata['date'],
-                                       unit='ms',
-                                       utc=True,
-                                       infer_datetime_format=True)
+        pairdata['date'] = to_datetime(pairdata['date'], unit='ms', utc=True)
         return pairdata
 
     def ohlcv_append(
         self,
         pair: str,
         timeframe: str,
         data: DataFrame,
```

### Comparing `freqtrade-2023.3/freqtrade/data/history/hdf5datahandler.py` & `freqtrade-2023.4/freqtrade/data/history/hdf5datahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/data/history/history_utils.py` & `freqtrade-2023.4/freqtrade/data/history/history_utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/data/history/idatahandler.py` & `freqtrade-2023.4/freqtrade/data/history/idatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/data/history/jsondatahandler.py` & `freqtrade-2023.4/freqtrade/data/history/jsondatahandler.py`

 * *Files 2% similar despite different names*

```diff
@@ -71,18 +71,15 @@
             pairdata = read_json(filename, orient='values')
             pairdata.columns = self._columns
         except ValueError:
             logger.error(f"Could not load data for {pair}.")
             return DataFrame(columns=self._columns)
         pairdata = pairdata.astype(dtype={'open': 'float', 'high': 'float',
                                           'low': 'float', 'close': 'float', 'volume': 'float'})
-        pairdata['date'] = to_datetime(pairdata['date'],
-                                       unit='ms',
-                                       utc=True,
-                                       infer_datetime_format=True)
+        pairdata['date'] = to_datetime(pairdata['date'], unit='ms', utc=True)
         return pairdata
 
     def ohlcv_append(
         self,
         pair: str,
         timeframe: str,
         data: DataFrame,
```

### Comparing `freqtrade-2023.3/freqtrade/data/history/parquetdatahandler.py` & `freqtrade-2023.4/freqtrade/data/history/parquetdatahandler.py`

 * *Files 2% similar despite different names*

```diff
@@ -58,18 +58,15 @@
             if not filename.exists():
                 return DataFrame(columns=self._columns)
 
         pairdata = read_parquet(filename)
         pairdata.columns = self._columns
         pairdata = pairdata.astype(dtype={'open': 'float', 'high': 'float',
                                           'low': 'float', 'close': 'float', 'volume': 'float'})
-        pairdata['date'] = to_datetime(pairdata['date'],
-                                       unit='ms',
-                                       utc=True,
-                                       infer_datetime_format=True)
+        pairdata['date'] = to_datetime(pairdata['date'], unit='ms', utc=True)
         return pairdata
 
     def ohlcv_append(
         self,
         pair: str,
         timeframe: str,
         data: DataFrame,
```

### Comparing `freqtrade-2023.3/freqtrade/data/metrics.py` & `freqtrade-2023.4/freqtrade/data/metrics.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/edge/edge_positioning.py` & `freqtrade-2023.4/freqtrade/edge/edge_positioning.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/enums/__init__.py` & `freqtrade-2023.4/freqtrade/enums/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/enums/candletype.py` & `freqtrade-2023.4/freqtrade/enums/candletype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/enums/exitchecktuple.py` & `freqtrade-2023.4/freqtrade/enums/exitchecktuple.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/enums/exittype.py` & `freqtrade-2023.4/freqtrade/enums/exittype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/enums/rpcmessagetype.py` & `freqtrade-2023.4/freqtrade/enums/rpcmessagetype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/enums/runmode.py` & `freqtrade-2023.4/freqtrade/enums/runmode.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/enums/signaltype.py` & `freqtrade-2023.4/freqtrade/enums/signaltype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exceptions.py` & `freqtrade-2023.4/freqtrade/exceptions.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/__init__.py` & `freqtrade-2023.4/freqtrade/exchange/__init__.py`

 * *Files 22% similar despite different names*

```diff
@@ -2,24 +2,25 @@
 # isort: off
 from freqtrade.exchange.common import remove_credentials, MAP_EXCHANGE_CHILDCLASS
 from freqtrade.exchange.exchange import Exchange
 # isort: on
 from freqtrade.exchange.binance import Binance
 from freqtrade.exchange.bitpanda import Bitpanda
 from freqtrade.exchange.bittrex import Bittrex
+from freqtrade.exchange.bitvavo import Bitvavo
 from freqtrade.exchange.bybit import Bybit
 from freqtrade.exchange.coinbasepro import Coinbasepro
-from freqtrade.exchange.exchange_utils import (amount_to_contract_precision, amount_to_contracts,
-                                               amount_to_precision, available_exchanges,
-                                               ccxt_exchanges, contracts_to_amount,
-                                               date_minus_candles, is_exchange_known_ccxt,
-                                               market_is_active, price_to_precision,
-                                               timeframe_to_minutes, timeframe_to_msecs,
-                                               timeframe_to_next_date, timeframe_to_prev_date,
-                                               timeframe_to_seconds, validate_exchange,
-                                               validate_exchanges)
+from freqtrade.exchange.exchange_utils import (ROUND_DOWN, ROUND_UP, amount_to_contract_precision,
+                                               amount_to_contracts, amount_to_precision,
+                                               available_exchanges, ccxt_exchanges,
+                                               contracts_to_amount, date_minus_candles,
+                                               is_exchange_known_ccxt, market_is_active,
+                                               price_to_precision, timeframe_to_minutes,
+                                               timeframe_to_msecs, timeframe_to_next_date,
+                                               timeframe_to_prev_date, timeframe_to_seconds,
+                                               validate_exchange, validate_exchanges)
 from freqtrade.exchange.gate import Gate
 from freqtrade.exchange.hitbtc import Hitbtc
 from freqtrade.exchange.huobi import Huobi
 from freqtrade.exchange.kraken import Kraken
 from freqtrade.exchange.kucoin import Kucoin
 from freqtrade.exchange.okx import Okx
```

### Comparing `freqtrade-2023.3/freqtrade/exchange/binance.py` & `freqtrade-2023.4/freqtrade/exchange/binance.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/binance_leverage_tiers.json` & `freqtrade-2023.4/freqtrade/exchange/binance_leverage_tiers.json`

 * *Files 0% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.9614446626733291%*

 * *Differences: {"'AMB/USDT:USDT'": "[OrderedDict([('tier', 1.0), ('currency', 'USDT'), ('minNotional', 0.0), "*

 * *                    "('maxNotional', 5000.0), ('maintenanceMarginRate', 0.02), ('maxLeverage', "*

 * *                    "20.0), ('info', OrderedDict([('bracket', '1'), ('initialLeverage', '20'), "*

 * *                    "('notionalCap', '5000'), ('notionalFloor', '0'), ('maintMarginRatio', "*

 * *                    "'0.02'), ('cum', '0.0')]))]), OrderedDict([('tier', 2.0), ('currency', "*

 * *                    "'USDT'), ('min […]*

```diff
@@ -1739,14 +1739,128 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 1500000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "AMB/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 15.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "650.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "200000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 200000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "10650.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "23150.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "148150.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "3000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "898150.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
+        }
+    ],
     "ANC/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "8",
@@ -3521,53 +3635,53 @@
     ],
     "AVAX/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "25",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 25.0,
+            "maxLeverage": 8.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "15",
+                "initialLeverage": "7",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 15.0,
+            "maxLeverage": 7.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "10",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -3619,20 +3733,20 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "7",
                 "cum": "949400.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "8000000",
+                "notionalCap": "4000000",
                 "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 8000000.0,
+            "maxNotional": 4000000.0,
             "minNotional": 3000000.0,
             "tier": 7.0
         }
     ],
     "AVAX/USDT:USDT": [
         {
             "currency": "USDT",
@@ -5483,128 +5597,14 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 500000000.0,
             "minNotional": 300000000.0,
             "tier": 10.0
         }
     ],
-    "BTC/USDT:USDT-230331": [
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "1",
-                "cum": "0.0",
-                "initialLeverage": "25",
-                "maintMarginRatio": "0.02",
-                "notionalCap": "375000",
-                "notionalFloor": "0"
-            },
-            "maintenanceMarginRate": 0.02,
-            "maxLeverage": 25.0,
-            "maxNotional": 375000.0,
-            "minNotional": 0.0,
-            "tier": 1.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "2",
-                "cum": "11250.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
-                "notionalCap": "2000000",
-                "notionalFloor": "375000"
-            },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 375000.0,
-            "tier": 2.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "3",
-                "cum": "111250.0",
-                "initialLeverage": "5",
-                "maintMarginRatio": "0.1",
-                "notionalCap": "4000000",
-                "notionalFloor": "2000000"
-            },
-            "maintenanceMarginRate": 0.1,
-            "maxLeverage": 5.0,
-            "maxNotional": 4000000.0,
-            "minNotional": 2000000.0,
-            "tier": 3.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "4",
-                "cum": "211250.0",
-                "initialLeverage": "4",
-                "maintMarginRatio": "0.125",
-                "notionalCap": "10000000",
-                "notionalFloor": "4000000"
-            },
-            "maintenanceMarginRate": 0.125,
-            "maxLeverage": 4.0,
-            "maxNotional": 10000000.0,
-            "minNotional": 4000000.0,
-            "tier": 4.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "5",
-                "cum": "461250.0",
-                "initialLeverage": "3",
-                "maintMarginRatio": "0.15",
-                "notionalCap": "20000000",
-                "notionalFloor": "10000000"
-            },
-            "maintenanceMarginRate": 0.15,
-            "maxLeverage": 3.0,
-            "maxNotional": 20000000.0,
-            "minNotional": 10000000.0,
-            "tier": 5.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "6",
-                "cum": "2461250.0",
-                "initialLeverage": "2",
-                "maintMarginRatio": "0.25",
-                "notionalCap": "40000000",
-                "notionalFloor": "20000000"
-            },
-            "maintenanceMarginRate": 0.25,
-            "maxLeverage": 2.0,
-            "maxNotional": 40000000.0,
-            "minNotional": 20000000.0,
-            "tier": 6.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "7",
-                "cum": "1.246125E7",
-                "initialLeverage": "1",
-                "maintMarginRatio": "0.5",
-                "notionalCap": "400000000",
-                "notionalFloor": "40000000"
-            },
-            "maintenanceMarginRate": 0.5,
-            "maxLeverage": 1.0,
-            "maxNotional": 400000000.0,
-            "minNotional": 40000000.0,
-            "tier": 7.0
-        }
-    ],
     "BTC/USDT:USDT-230630": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "25",
@@ -6011,202 +6011,234 @@
     ],
     "C98/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "25",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 25.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 20.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "notionalCap": "300000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
-            "maxNotional": 100000.0,
+            "maxLeverage": 10.0,
+            "maxNotional": 300000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5650.0",
+                "cum": "15650.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "250000",
-                "notionalFloor": "100000"
+                "notionalCap": "800000",
+                "notionalFloor": "300000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 250000.0,
-            "minNotional": 100000.0,
+            "maxNotional": 800000.0,
+            "minNotional": 300000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "11900.0",
-                "initialLeverage": "2",
+                "cum": "35650.0",
+                "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "1000000",
-                "notionalFloor": "250000"
+                "notionalFloor": "800000"
             },
             "maintenanceMarginRate": 0.125,
-            "maxLeverage": 2.0,
+            "maxLeverage": 4.0,
             "maxNotional": 1000000.0,
-            "minNotional": 250000.0,
+            "minNotional": 800000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "386900.0",
-                "initialLeverage": "1",
-                "maintMarginRatio": "0.5",
+                "cum": "160650.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
                 "notionalCap": "3000000",
                 "notionalFloor": "1000000"
             },
-            "maintenanceMarginRate": 0.5,
-            "maxLeverage": 1.0,
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
             "maxNotional": 3000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "910650.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
         }
     ],
     "CELO/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "25",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 25.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 20.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "notionalCap": "300000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
-            "maxNotional": 100000.0,
+            "maxLeverage": 10.0,
+            "maxNotional": 300000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5650.0",
+                "cum": "15650.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "250000",
-                "notionalFloor": "100000"
+                "notionalCap": "800000",
+                "notionalFloor": "300000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 250000.0,
-            "minNotional": 100000.0,
+            "maxNotional": 800000.0,
+            "minNotional": 300000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "11900.0",
-                "initialLeverage": "2",
+                "cum": "35650.0",
+                "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "1000000",
-                "notionalFloor": "250000"
+                "notionalFloor": "800000"
             },
             "maintenanceMarginRate": 0.125,
-            "maxLeverage": 2.0,
+            "maxLeverage": 4.0,
             "maxNotional": 1000000.0,
-            "minNotional": 250000.0,
+            "minNotional": 800000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "386900.0",
-                "initialLeverage": "1",
-                "maintMarginRatio": "0.5",
+                "cum": "160650.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
                 "notionalCap": "3000000",
                 "notionalFloor": "1000000"
             },
-            "maintenanceMarginRate": 0.5,
-            "maxLeverage": 1.0,
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
             "maxNotional": 3000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "910650.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
         }
     ],
     "CELR/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -10093,128 +10125,14 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 300000000.0,
             "minNotional": 150000000.0,
             "tier": 10.0
         }
     ],
-    "ETH/USDT:USDT-230331": [
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "1",
-                "cum": "0.0",
-                "initialLeverage": "25",
-                "maintMarginRatio": "0.02",
-                "notionalCap": "375000",
-                "notionalFloor": "0"
-            },
-            "maintenanceMarginRate": 0.02,
-            "maxLeverage": 25.0,
-            "maxNotional": 375000.0,
-            "minNotional": 0.0,
-            "tier": 1.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "2",
-                "cum": "11250.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
-                "notionalCap": "2000000",
-                "notionalFloor": "375000"
-            },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 375000.0,
-            "tier": 2.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "3",
-                "cum": "111250.0",
-                "initialLeverage": "5",
-                "maintMarginRatio": "0.1",
-                "notionalCap": "4000000",
-                "notionalFloor": "2000000"
-            },
-            "maintenanceMarginRate": 0.1,
-            "maxLeverage": 5.0,
-            "maxNotional": 4000000.0,
-            "minNotional": 2000000.0,
-            "tier": 3.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "4",
-                "cum": "211250.0",
-                "initialLeverage": "4",
-                "maintMarginRatio": "0.125",
-                "notionalCap": "10000000",
-                "notionalFloor": "4000000"
-            },
-            "maintenanceMarginRate": 0.125,
-            "maxLeverage": 4.0,
-            "maxNotional": 10000000.0,
-            "minNotional": 4000000.0,
-            "tier": 4.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "5",
-                "cum": "461250.0",
-                "initialLeverage": "3",
-                "maintMarginRatio": "0.15",
-                "notionalCap": "20000000",
-                "notionalFloor": "10000000"
-            },
-            "maintenanceMarginRate": 0.15,
-            "maxLeverage": 3.0,
-            "maxNotional": 20000000.0,
-            "minNotional": 10000000.0,
-            "tier": 5.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "6",
-                "cum": "2461250.0",
-                "initialLeverage": "2",
-                "maintMarginRatio": "0.25",
-                "notionalCap": "40000000",
-                "notionalFloor": "20000000"
-            },
-            "maintenanceMarginRate": 0.25,
-            "maxLeverage": 2.0,
-            "maxNotional": 40000000.0,
-            "minNotional": 20000000.0,
-            "tier": 6.0
-        },
-        {
-            "currency": "USDT",
-            "info": {
-                "bracket": "7",
-                "cum": "1.246125E7",
-                "initialLeverage": "1",
-                "maintMarginRatio": "0.5",
-                "notionalCap": "400000000",
-                "notionalFloor": "40000000"
-            },
-            "maintenanceMarginRate": 0.5,
-            "maxLeverage": 1.0,
-            "maxNotional": 400000000.0,
-            "minNotional": 40000000.0,
-            "tier": 7.0
-        }
-    ],
     "ETH/USDT:USDT-230630": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "25",
@@ -11925,53 +11843,53 @@
     ],
     "GMT/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 8.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "7",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 7.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -12007,20 +11925,20 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "6",
                 "cum": "386900.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
+                "notionalCap": "1500000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
+            "maxNotional": 1500000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
     "GMT/USDT:USDT": [
         {
             "currency": "USDT",
@@ -12555,14 +12473,128 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "HFT/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 15.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "650.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "200000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 200000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "10650.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "23150.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "148150.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "3000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "898150.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
+        }
+    ],
     "HIGH/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "25",
@@ -13941,14 +13973,128 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 3000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "JOE/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 15.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "650.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "200000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 200000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "10650.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "23150.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "148150.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "3000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "898150.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
+        }
+    ],
     "KAVA/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "25",
@@ -14681,22 +14827,136 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "6",
                 "cum": "386885.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
+                "notionalCap": "1500000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
+            "maxNotional": 1500000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        }
+    ],
+    "LEVER/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 15.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "650.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "200000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 200000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "10650.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "23150.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "148150.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "3000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 3000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "898150.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
         }
     ],
     "LINA/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -16845,53 +17105,53 @@
     ],
     "NEAR/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 8.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "7",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 7.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -16927,20 +17187,20 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "6",
                 "cum": "386900.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
+                "notionalCap": "3000000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
+            "maxNotional": 3000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
     "NEAR/USDT:USDT": [
         {
             "currency": "USDT",
@@ -18149,53 +18409,53 @@
     ],
     "PHB/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "11",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 11.0,
+            "maxLeverage": 8.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "7",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 7.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -18231,20 +18491,20 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "6",
                 "cum": "386900.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
+                "notionalCap": "1500000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
+            "maxNotional": 1500000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
     "PHB/USDT:USDT": [
         {
             "currency": "USDT",
@@ -18649,14 +18909,128 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "RDNT/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 15.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "650.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "200000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 200000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "10650.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "23150.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "148150.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "3000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "898150.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
+        }
+    ],
     "REEF/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "20",
@@ -19503,53 +19877,53 @@
     ],
     "SAND/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 8.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "7",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 7.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -19585,20 +19959,20 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "6",
                 "cum": "386900.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
+                "notionalCap": "1500000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
+            "maxNotional": 1500000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
     "SAND/USDT:USDT": [
         {
             "currency": "USDT",
@@ -21247,104 +21621,120 @@
     ],
     "SXP/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "25",
-                "maintMarginRatio": "0.01",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
-            "maintenanceMarginRate": 0.01,
-            "maxLeverage": 25.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 15.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "75.0",
-                "initialLeverage": "20",
+                "cum": "25.0",
+                "initialLeverage": "10",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
+            "maxLeverage": 10.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "700.0",
-                "initialLeverage": "10",
+                "cum": "650.0",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "notionalCap": "600000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 100000.0,
+            "maxLeverage": 8.0,
+            "maxNotional": 600000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5700.0",
+                "cum": "30650.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "250000",
-                "notionalFloor": "100000"
+                "notionalCap": "1600000",
+                "notionalFloor": "600000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 250000.0,
-            "minNotional": 100000.0,
+            "maxNotional": 1600000.0,
+            "minNotional": 600000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "11950.0",
-                "initialLeverage": "2",
+                "cum": "70650.0",
+                "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "1000000",
-                "notionalFloor": "250000"
+                "notionalCap": "2000000",
+                "notionalFloor": "1600000"
             },
             "maintenanceMarginRate": 0.125,
-            "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 250000.0,
+            "maxLeverage": 4.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 1600000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "386950.0",
+                "cum": "320650.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "6000000",
+                "notionalFloor": "2000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 6000000.0,
+            "minNotional": 2000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "1820650.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "6500000",
+                "notionalFloor": "6000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
-            "minNotional": 1000000.0,
-            "tier": 6.0
+            "maxNotional": 6500000.0,
+            "minNotional": 6000000.0,
+            "tier": 7.0
         }
     ],
     "T/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -21573,53 +21963,53 @@
     ],
     "TLM/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 8.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "7",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 7.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -21655,120 +22045,136 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "6",
                 "cum": "386900.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
+                "notionalCap": "1500000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
+            "maxNotional": 1500000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
     "TLM/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "25",
-                "maintMarginRatio": "0.01",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
-            "maintenanceMarginRate": 0.01,
-            "maxLeverage": 25.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "75.0",
-                "initialLeverage": "20",
+                "cum": "25.0",
+                "initialLeverage": "15",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
+            "maxLeverage": 15.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "700.0",
+                "cum": "650.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "notionalCap": "200000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 100000.0,
+            "maxNotional": 200000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5700.0",
+                "cum": "10650.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "250000",
-                "notionalFloor": "100000"
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 250000.0,
-            "minNotional": 100000.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "11950.0",
-                "initialLeverage": "2",
+                "cum": "23150.0",
+                "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "1000000",
-                "notionalFloor": "250000"
+                "notionalFloor": "500000"
             },
             "maintenanceMarginRate": 0.125,
-            "maxLeverage": 2.0,
+            "maxLeverage": 4.0,
             "maxNotional": 1000000.0,
-            "minNotional": 250000.0,
+            "minNotional": 500000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "386950.0",
+                "cum": "148150.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "3000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "898150.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "5000000",
-                "notionalFloor": "1000000"
+                "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
-            "minNotional": 1000000.0,
-            "tier": 6.0
+            "minNotional": 3000000.0,
+            "tier": 7.0
         }
     ],
     "TOMO/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -22453,53 +22859,53 @@
     ],
     "UNI/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 8.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "7",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 7.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -22535,20 +22941,20 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "6",
                 "cum": "386900.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
+                "notionalCap": "1500000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
+            "maxNotional": 1500000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
     "UNI/USDT:USDT": [
         {
             "currency": "USDT",
@@ -23961,14 +24367,128 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 15000000.0,
             "minNotional": 10000000.0,
             "tier": 7.0
         }
     ],
+    "XVS/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 15.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "650.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "200000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 200000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "10650.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "23150.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "148150.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "3000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "898150.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
+        }
+    ],
     "YFI/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "25",
```

### Comparing `freqtrade-2023.3/freqtrade/exchange/bitpanda.py` & `freqtrade-2023.4/freqtrade/exchange/bitpanda.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/bittrex.py` & `freqtrade-2023.4/freqtrade/exchange/bittrex.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/bybit.py` & `freqtrade-2023.4/freqtrade/exchange/bybit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/check_exchange.py` & `freqtrade-2023.4/freqtrade/exchange/check_exchange.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/coinbasepro.py` & `freqtrade-2023.4/freqtrade/exchange/coinbasepro.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/common.py` & `freqtrade-2023.4/freqtrade/exchange/common.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/exchange.py` & `freqtrade-2023.4/freqtrade/exchange/exchange.py`

 * *Files 1% similar despite different names*

```diff
@@ -84,7978 +84,8032 @@
 00000530: 655f 6372 6564 656e 7469 616c 732c 2072  e_credentials, r
 00000540: 6574 7269 6572 2c0a 2020 2020 2020 2020  etrier,.        
 00000550: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00000560: 2020 2020 2020 2020 2020 2020 2020 2072                 r
 00000570: 6574 7269 6572 5f61 7379 6e63 290a 6672  etrier_async).fr
 00000580: 6f6d 2066 7265 7174 7261 6465 2e65 7863  om freqtrade.exc
 00000590: 6861 6e67 652e 6578 6368 616e 6765 5f75  hange.exchange_u
-000005a0: 7469 6c73 2069 6d70 6f72 7420 2843 6378  tils import (Ccx
-000005b0: 744d 6f64 756c 6554 7970 652c 2061 6d6f  tModuleType, amo
-000005c0: 756e 745f 746f 5f63 6f6e 7472 6163 745f  unt_to_contract_
-000005d0: 7072 6563 6973 696f 6e2c 0a20 2020 2020  precision,.     
+000005a0: 7469 6c73 2069 6d70 6f72 7420 2852 4f55  tils import (ROU
+000005b0: 4e44 2c20 524f 554e 445f 444f 574e 2c20  ND, ROUND_DOWN, 
+000005c0: 524f 554e 445f 5550 2c20 4363 7874 4d6f  ROUND_UP, CcxtMo
+000005d0: 6475 6c65 5479 7065 2c0a 2020 2020 2020  duleType,.      
 000005e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000005f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000600: 2020 2020 2020 2020 2020 616d 6f75 6e74            amount
-00000610: 5f74 6f5f 636f 6e74 7261 6374 732c 2061  _to_contracts, a
-00000620: 6d6f 756e 745f 746f 5f70 7265 6369 7369  mount_to_precisi
-00000630: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+00000600: 2020 2020 2020 2020 2061 6d6f 756e 745f           amount_
+00000610: 746f 5f63 6f6e 7472 6163 745f 7072 6563  to_contract_prec
+00000620: 6973 696f 6e2c 2061 6d6f 756e 745f 746f  ision, amount_to
+00000630: 5f63 6f6e 7472 6163 7473 2c0a 2020 2020  _contracts,.    
 00000640: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00000650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000660: 2020 2063 6f6e 7472 6163 7473 5f74 6f5f     contracts_to_
-00000670: 616d 6f75 6e74 2c20 6461 7465 5f6d 696e  amount, date_min
-00000680: 7573 5f63 616e 646c 6573 2c0a 2020 2020  us_candles,.    
-00000690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000660: 2020 2020 2020 2020 2020 2061 6d6f 756e             amoun
+00000670: 745f 746f 5f70 7265 6369 7369 6f6e 2c20  t_to_precision, 
+00000680: 636f 6e74 7261 6374 735f 746f 5f61 6d6f  contracts_to_amo
+00000690: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
 000006a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000006b0: 2020 2020 2020 2020 2020 2069 735f 6578             is_ex
-000006c0: 6368 616e 6765 5f6b 6e6f 776e 5f63 6378  change_known_ccx
-000006d0: 742c 206d 6172 6b65 745f 6973 5f61 6374  t, market_is_act
-000006e0: 6976 652c 0a20 2020 2020 2020 2020 2020  ive,.           
+000006b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000006c0: 2020 2020 6461 7465 5f6d 696e 7573 5f63      date_minus_c
+000006d0: 616e 646c 6573 2c20 6973 5f65 7863 6861  andles, is_excha
+000006e0: 6e67 655f 6b6e 6f77 6e5f 6363 7874 2c0a  nge_known_ccxt,.
 000006f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00000700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000710: 2020 2020 7072 6963 655f 746f 5f70 7265      price_to_pre
-00000720: 6369 7369 6f6e 2c20 7469 6d65 6672 616d  cision, timefram
-00000730: 655f 746f 5f6d 696e 7574 6573 2c0a 2020  e_to_minutes,.  
-00000740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000710: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00000720: 6172 6b65 745f 6973 5f61 6374 6976 652c  arket_is_active,
+00000730: 2070 7269 6365 5f74 6f5f 7072 6563 6973   price_to_precis
+00000740: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
 00000750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000760: 2020 2020 2020 2020 2020 2020 2074 696d               tim
-00000770: 6566 7261 6d65 5f74 6f5f 6d73 6563 732c  eframe_to_msecs,
-00000780: 2074 696d 6566 7261 6d65 5f74 6f5f 6e65   timeframe_to_ne
-00000790: 7874 5f64 6174 652c 0a20 2020 2020 2020  xt_date,.       
+00000760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000770: 2020 2020 7469 6d65 6672 616d 655f 746f      timeframe_to
+00000780: 5f6d 696e 7574 6573 2c20 7469 6d65 6672  _minutes, timefr
+00000790: 616d 655f 746f 5f6d 7365 6373 2c0a 2020  ame_to_msecs,.  
 000007a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000007b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000007c0: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
-000007d0: 655f 746f 5f70 7265 765f 6461 7465 2c20  e_to_prev_date, 
-000007e0: 7469 6d65 6672 616d 655f 746f 5f73 6563  timeframe_to_sec
-000007f0: 6f6e 6473 290a 6672 6f6d 2066 7265 7174  onds).from freqt
-00000800: 7261 6465 2e65 7863 6861 6e67 652e 7479  rade.exchange.ty
-00000810: 7065 7320 696d 706f 7274 204f 484c 4356  pes import OHLCV
-00000820: 5265 7370 6f6e 7365 2c20 4f72 6465 7242  Response, OrderB
-00000830: 6f6f 6b2c 2054 6963 6b65 722c 2054 6963  ook, Ticker, Tic
-00000840: 6b65 7273 0a66 726f 6d20 6672 6571 7472  kers.from freqtr
-00000850: 6164 652e 6d69 7363 2069 6d70 6f72 7420  ade.misc import 
-00000860: 2863 6875 6e6b 732c 2064 6565 705f 6d65  (chunks, deep_me
-00000870: 7267 655f 6469 6374 732c 2066 696c 655f  rge_dicts, file_
-00000880: 6475 6d70 5f6a 736f 6e2c 2066 696c 655f  dump_json, file_
-00000890: 6c6f 6164 5f6a 736f 6e2c 0a20 2020 2020  load_json,.     
-000008a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000008b0: 2020 2020 2020 2073 6166 655f 7661 6c75         safe_valu
-000008c0: 655f 6661 6c6c 6261 636b 3229 0a66 726f  e_fallback2).fro
-000008d0: 6d20 6672 6571 7472 6164 652e 706c 7567  m freqtrade.plug
-000008e0: 696e 732e 7061 6972 6c69 7374 2e70 6169  ins.pairlist.pai
-000008f0: 726c 6973 745f 6865 6c70 6572 7320 696d  rlist_helpers im
-00000900: 706f 7274 2065 7870 616e 645f 7061 6972  port expand_pair
-00000910: 6c69 7374 0a0a 0a6c 6f67 6765 7220 3d20  list...logger = 
-00000920: 6c6f 6767 696e 672e 6765 744c 6f67 6765  logging.getLogge
-00000930: 7228 5f5f 6e61 6d65 5f5f 290a 0a0a 636c  r(__name__)...cl
-00000940: 6173 7320 4578 6368 616e 6765 3a0a 0a20  ass Exchange:.. 
-00000950: 2020 2023 2050 6172 616d 6574 6572 7320     # Parameters 
-00000960: 746f 2061 6464 2064 6972 6563 746c 7920  to add directly 
-00000970: 746f 2062 7579 2f73 656c 6c20 6361 6c6c  to buy/sell call
-00000980: 7320 286c 696b 6520 6167 7265 6569 6e67  s (like agreeing
-00000990: 2074 6f20 7472 6164 696e 6720 6167 7265   to trading agre
-000009a0: 656d 656e 7429 0a20 2020 205f 7061 7261  ement).    _para
-000009b0: 6d73 3a20 4469 6374 203d 207b 7d0a 0a20  ms: Dict = {}.. 
-000009c0: 2020 2023 2041 6464 6974 696f 6e61 6c20     # Additional 
-000009d0: 7061 7261 6d65 7465 7273 202d 2061 6464  parameters - add
-000009e0: 6564 2074 6f20 7468 6520 6363 7874 206f  ed to the ccxt o
-000009f0: 626a 6563 740a 2020 2020 5f63 6378 745f  bject.    _ccxt_
-00000a00: 7061 7261 6d73 3a20 4469 6374 203d 207b  params: Dict = {
-00000a10: 7d0a 0a20 2020 2023 2044 6963 7420 746f  }..    # Dict to
-00000a20: 2073 7065 6369 6679 2077 6869 6368 206f   specify which o
-00000a30: 7074 696f 6e73 2065 6163 6820 6578 6368  ptions each exch
-00000a40: 616e 6765 2069 6d70 6c65 6d65 6e74 730a  ange implements.
-00000a50: 2020 2020 2320 5468 6973 2064 6566 696e      # This defin
-00000a60: 6573 2064 6566 6175 6c74 732c 2077 6869  es defaults, whi
-00000a70: 6368 2063 616e 2062 6520 7365 6c65 6374  ch can be select
-00000a80: 6976 656c 7920 6f76 6572 7269 6464 656e  ively overridden
-00000a90: 2062 7920 7375 6263 6c61 7373 6573 2075   by subclasses u
-00000aa0: 7369 6e67 205f 6674 5f68 6173 0a20 2020  sing _ft_has.   
-00000ab0: 2023 206f 7220 6279 2073 7065 6369 6679   # or by specify
-00000ac0: 696e 6720 7468 656d 2069 6e20 7468 6520  ing them in the 
-00000ad0: 636f 6e66 6967 7572 6174 696f 6e2e 0a20  configuration.. 
-00000ae0: 2020 205f 6674 5f68 6173 5f64 6566 6175     _ft_has_defau
-00000af0: 6c74 3a20 4469 6374 203d 207b 0a20 2020  lt: Dict = {.   
-00000b00: 2020 2020 2022 7374 6f70 6c6f 7373 5f6f       "stoploss_o
-00000b10: 6e5f 6578 6368 616e 6765 223a 2046 616c  n_exchange": Fal
-00000b20: 7365 2c0a 2020 2020 2020 2020 226f 7264  se,.        "ord
-00000b30: 6572 5f74 696d 655f 696e 5f66 6f72 6365  er_time_in_force
-00000b40: 223a 205b 2247 5443 225d 2c0a 2020 2020  ": ["GTC"],.    
-00000b50: 2020 2020 226f 686c 6376 5f70 6172 616d      "ohlcv_param
-00000b60: 7322 3a20 7b7d 2c0a 2020 2020 2020 2020  s": {},.        
-00000b70: 226f 686c 6376 5f63 616e 646c 655f 6c69  "ohlcv_candle_li
-00000b80: 6d69 7422 3a20 3530 302c 0a20 2020 2020  mit": 500,.     
-00000b90: 2020 2022 6f68 6c63 765f 6861 735f 6869     "ohlcv_has_hi
-00000ba0: 7374 6f72 7922 3a20 5472 7565 2c20 2023  story": True,  #
-00000bb0: 2053 6f6d 6520 6578 6368 616e 6765 7320   Some exchanges 
-00000bc0: 284b 7261 6b65 6e29 2064 6f6e 2774 2070  (Kraken) don't p
-00000bd0: 726f 7669 6465 2068 6973 746f 7279 2076  rovide history v
-00000be0: 6961 206f 686c 6376 0a20 2020 2020 2020  ia ohlcv.       
-00000bf0: 2022 6f68 6c63 765f 7061 7274 6961 6c5f   "ohlcv_partial_
-00000c00: 6361 6e64 6c65 223a 2054 7275 652c 0a20  candle": True,. 
-00000c10: 2020 2020 2020 2022 6f68 6c63 765f 7265         "ohlcv_re
-00000c20: 7175 6972 655f 7369 6e63 6522 3a20 4661  quire_since": Fa
-00000c30: 6c73 652c 0a20 2020 2020 2020 2023 2043  lse,.        # C
-00000c40: 6865 636b 2068 7474 7073 3a2f 2f67 6974  heck https://git
-00000c50: 6875 622e 636f 6d2f 6363 7874 2f63 6378  hub.com/ccxt/ccx
-00000c60: 742f 6973 7375 6573 2f31 3037 3637 2066  t/issues/10767 f
-00000c70: 6f72 2072 656d 6f76 616c 206f 6620 6f68  or removal of oh
-00000c80: 6c63 765f 766f 6c75 6d65 5f63 7572 7265  lcv_volume_curre
-00000c90: 6e63 790a 2020 2020 2020 2020 226f 686c  ncy.        "ohl
-00000ca0: 6376 5f76 6f6c 756d 655f 6375 7272 656e  cv_volume_curren
-00000cb0: 6379 223a 2022 6261 7365 222c 2020 2320  cy": "base",  # 
-00000cc0: 2262 6173 6522 206f 7220 2271 756f 7465  "base" or "quote
-00000cd0: 220a 2020 2020 2020 2020 2274 6963 6b65  ".        "ticke
-00000ce0: 7273 5f68 6176 655f 7175 6f74 6556 6f6c  rs_have_quoteVol
-00000cf0: 756d 6522 3a20 5472 7565 2c0a 2020 2020  ume": True,.    
-00000d00: 2020 2020 2274 6963 6b65 7273 5f68 6176      "tickers_hav
-00000d10: 655f 6269 645f 6173 6b22 3a20 5472 7565  e_bid_ask": True
-00000d20: 2c20 2023 2062 6964 202f 2061 736b 2065  ,  # bid / ask e
-00000d30: 6d70 7479 2066 6f72 2066 6574 6368 5f74  mpty for fetch_t
-00000d40: 6963 6b65 7273 0a20 2020 2020 2020 2022  ickers.        "
-00000d50: 7469 636b 6572 735f 6861 7665 5f70 7269  tickers_have_pri
-00000d60: 6365 223a 2054 7275 652c 0a20 2020 2020  ce": True,.     
-00000d70: 2020 2022 7472 6164 6573 5f70 6167 696e     "trades_pagin
-00000d80: 6174 696f 6e22 3a20 2274 696d 6522 2c20  ation": "time", 
-00000d90: 2023 2050 6f73 7369 626c 6520 6172 6520   # Possible are 
-00000da0: 2274 696d 6522 206f 7220 2269 6422 0a20  "time" or "id". 
-00000db0: 2020 2020 2020 2022 7472 6164 6573 5f70         "trades_p
-00000dc0: 6167 696e 6174 696f 6e5f 6172 6722 3a20  agination_arg": 
-00000dd0: 2273 696e 6365 222c 0a20 2020 2020 2020  "since",.       
-00000de0: 2022 6c32 5f6c 696d 6974 5f72 616e 6765   "l2_limit_range
-00000df0: 223a 204e 6f6e 652c 0a20 2020 2020 2020  ": None,.       
-00000e00: 2022 6c32 5f6c 696d 6974 5f72 616e 6765   "l2_limit_range
-00000e10: 5f72 6571 7569 7265 6422 3a20 5472 7565  _required": True
-00000e20: 2c20 2023 2041 6c6c 6f77 2045 6d70 7479  ,  # Allow Empty
-00000e30: 204c 3220 6c69 6d69 7420 286b 7563 6f69   L2 limit (kucoi
-00000e40: 6e29 0a20 2020 2020 2020 2022 6d61 726b  n).        "mark
-00000e50: 5f6f 686c 6376 5f70 7269 6365 223a 2022  _ohlcv_price": "
-00000e60: 6d61 726b 222c 0a20 2020 2020 2020 2022  mark",.        "
-00000e70: 6d61 726b 5f6f 686c 6376 5f74 696d 6566  mark_ohlcv_timef
-00000e80: 7261 6d65 223a 2022 3868 222c 0a20 2020  rame": "8h",.   
-00000e90: 2020 2020 2022 6363 7874 5f66 7574 7572       "ccxt_futur
-00000ea0: 6573 5f6e 616d 6522 3a20 2273 7761 7022  es_name": "swap"
-00000eb0: 2c0a 2020 2020 2020 2020 2266 6565 5f63  ,.        "fee_c
-00000ec0: 6f73 745f 696e 5f63 6f6e 7472 6163 7473  ost_in_contracts
-00000ed0: 223a 2046 616c 7365 2c20 2023 2046 6565  ": False,  # Fee
-00000ee0: 2063 6f73 7420 6e65 6564 7320 636f 6e74   cost needs cont
-00000ef0: 7261 6374 2063 6f6e 7665 7273 696f 6e0a  ract conversion.
-00000f00: 2020 2020 2020 2020 226e 6565 6473 5f74          "needs_t
-00000f10: 7261 6469 6e67 5f66 6565 7322 3a20 4661  rading_fees": Fa
-00000f20: 6c73 652c 2020 2320 7573 6520 6665 7463  lse,  # use fetc
-00000f30: 685f 7472 6164 696e 675f 6665 6573 2074  h_trading_fees t
-00000f40: 6f20 6361 6368 6520 6665 6573 0a20 2020  o cache fees.   
-00000f50: 2020 2020 2022 6f72 6465 725f 7072 6f70       "order_prop
-00000f60: 735f 696e 5f63 6f6e 7472 6163 7473 223a  s_in_contracts":
-00000f70: 205b 2761 6d6f 756e 7427 2c20 2763 6f73   ['amount', 'cos
-00000f80: 7427 2c20 2766 696c 6c65 6427 2c20 2772  t', 'filled', 'r
-00000f90: 656d 6169 6e69 6e67 275d 2c0a 2020 2020  emaining'],.    
-00000fa0: 2020 2020 2320 4f76 6572 7269 6465 2063      # Override c
-00000fb0: 7265 6174 654d 6172 6b65 7442 7579 4f72  reateMarketBuyOr
-00000fc0: 6465 7252 6571 7569 7265 7350 7269 6365  derRequiresPrice
-00000fd0: 2077 6865 7265 2063 6378 7420 6861 7320   where ccxt has 
-00000fe0: 6974 2077 726f 6e67 0a20 2020 2020 2020  it wrong.       
-00000ff0: 2022 6d61 726b 6574 4f72 6465 7252 6571   "marketOrderReq
-00001000: 7569 7265 7350 7269 6365 223a 2046 616c  uiresPrice": Fal
-00001010: 7365 2c0a 2020 2020 7d0a 2020 2020 5f66  se,.    }.    _f
-00001020: 745f 6861 733a 2044 6963 7420 3d20 7b7d  t_has: Dict = {}
-00001030: 0a20 2020 205f 6674 5f68 6173 5f66 7574  .    _ft_has_fut
-00001040: 7572 6573 3a20 4469 6374 203d 207b 7d0a  ures: Dict = {}.
-00001050: 0a20 2020 205f 7375 7070 6f72 7465 645f  .    _supported_
-00001060: 7472 6164 696e 675f 6d6f 6465 5f6d 6172  trading_mode_mar
-00001070: 6769 6e5f 7061 6972 733a 204c 6973 745b  gin_pairs: List[
-00001080: 5475 706c 655b 5472 6164 696e 674d 6f64  Tuple[TradingMod
-00001090: 652c 204d 6172 6769 6e4d 6f64 655d 5d20  e, MarginMode]] 
-000010a0: 3d20 5b0a 2020 2020 2020 2020 2320 5472  = [.        # Tr
-000010b0: 6164 696e 674d 6f64 652e 5350 4f54 2061  adingMode.SPOT a
-000010c0: 6c77 6179 7320 7375 7070 6f72 7465 6420  lways supported 
-000010d0: 616e 6420 6e6f 7420 7265 7175 6972 6564  and not required
-000010e0: 2069 6e20 7468 6973 206c 6973 740a 2020   in this list.  
-000010f0: 2020 5d0a 0a20 2020 2064 6566 205f 5f69    ]..    def __i
-00001100: 6e69 745f 5f28 7365 6c66 2c20 636f 6e66  nit__(self, conf
-00001110: 6967 3a20 436f 6e66 6967 2c20 7661 6c69  ig: Config, vali
-00001120: 6461 7465 3a20 626f 6f6c 203d 2054 7275  date: bool = Tru
-00001130: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00001140: 2020 2020 6c6f 6164 5f6c 6576 6572 6167      load_leverag
-00001150: 655f 7469 6572 733a 2062 6f6f 6c20 3d20  e_tiers: bool = 
-00001160: 4661 6c73 6529 202d 3e20 4e6f 6e65 3a0a  False) -> None:.
-00001170: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00001180: 2020 2020 496e 6974 6961 6c69 7a65 7320      Initializes 
-00001190: 7468 6973 206d 6f64 756c 6520 7769 7468  this module with
-000011a0: 2074 6865 2067 6976 656e 2063 6f6e 6669   the given confi
-000011b0: 672c 0a20 2020 2020 2020 2069 7420 646f  g,.        it do
-000011c0: 6573 2062 6173 6963 2076 616c 6964 6174  es basic validat
-000011d0: 696f 6e20 7768 6574 6865 7220 7468 6520  ion whether the 
-000011e0: 7370 6563 6966 6965 6420 6578 6368 616e  specified exchan
-000011f0: 6765 2061 6e64 2070 6169 7273 2061 7265  ge and pairs are
-00001200: 2076 616c 6964 2e0a 2020 2020 2020 2020   valid..        
-00001210: 3a72 6574 7572 6e3a 204e 6f6e 650a 2020  :return: None.  
-00001220: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00001230: 2020 7365 6c66 2e5f 6170 693a 2063 6378    self._api: ccx
-00001240: 742e 4578 6368 616e 6765 0a20 2020 2020  t.Exchange.     
-00001250: 2020 2073 656c 662e 5f61 7069 5f61 7379     self._api_asy
-00001260: 6e63 3a20 6363 7874 5f61 7379 6e63 2e45  nc: ccxt_async.E
-00001270: 7863 6861 6e67 6520 3d20 4e6f 6e65 0a20  xchange = None. 
-00001280: 2020 2020 2020 2073 656c 662e 5f6d 6172         self._mar
-00001290: 6b65 7473 3a20 4469 6374 203d 207b 7d0a  kets: Dict = {}.
-000012a0: 2020 2020 2020 2020 7365 6c66 2e5f 7472          self._tr
-000012b0: 6164 696e 675f 6665 6573 3a20 4469 6374  ading_fees: Dict
-000012c0: 5b73 7472 2c20 416e 795d 203d 207b 7d0a  [str, Any] = {}.
-000012d0: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
-000012e0: 7665 7261 6765 5f74 6965 7273 3a20 4469  verage_tiers: Di
-000012f0: 6374 5b73 7472 2c20 4c69 7374 5b44 6963  ct[str, List[Dic
-00001300: 745d 5d20 3d20 7b7d 0a20 2020 2020 2020  t]] = {}.       
-00001310: 2023 204c 6f63 6b20 6576 656e 7420 6c6f   # Lock event lo
-00001320: 6f70 2e20 5468 6973 2069 7320 6e65 6365  op. This is nece
-00001330: 7373 6172 7920 746f 2061 766f 6964 2072  ssary to avoid r
-00001340: 6163 652d 636f 6e64 6974 696f 6e73 2077  ace-conditions w
-00001350: 6865 6e20 7573 696e 6720 666f 7263 652a  hen using force*
-00001360: 2063 6f6d 6d61 6e64 730a 2020 2020 2020   commands.      
-00001370: 2020 2320 4475 6520 746f 2066 756e 6469    # Due to fundi
-00001380: 6e67 2066 6565 2066 6574 6368 696e 672e  ng fee fetching.
-00001390: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
-000013a0: 6f6f 705f 6c6f 636b 203d 204c 6f63 6b28  oop_lock = Lock(
-000013b0: 290a 2020 2020 2020 2020 7365 6c66 2e6c  ).        self.l
-000013c0: 6f6f 7020 3d20 6173 796e 6369 6f2e 6e65  oop = asyncio.ne
-000013d0: 775f 6576 656e 745f 6c6f 6f70 2829 0a20  w_event_loop(). 
-000013e0: 2020 2020 2020 2061 7379 6e63 696f 2e73         asyncio.s
-000013f0: 6574 5f65 7665 6e74 5f6c 6f6f 7028 7365  et_event_loop(se
-00001400: 6c66 2e6c 6f6f 7029 0a20 2020 2020 2020  lf.loop).       
-00001410: 2073 656c 662e 5f63 6f6e 6669 673a 2043   self._config: C
-00001420: 6f6e 6669 6720 3d20 7b7d 0a0a 2020 2020  onfig = {}..    
-00001430: 2020 2020 7365 6c66 2e5f 636f 6e66 6967      self._config
-00001440: 2e75 7064 6174 6528 636f 6e66 6967 290a  .update(config).
-00001450: 0a20 2020 2020 2020 2023 2048 6f6c 6473  .        # Holds
-00001460: 206c 6173 7420 6361 6e64 6c65 2072 6566   last candle ref
-00001470: 7265 7368 6564 2074 696d 6520 6f66 2065  reshed time of e
-00001480: 6163 6820 7061 6972 0a20 2020 2020 2020  ach pair.       
-00001490: 2073 656c 662e 5f70 6169 7273 5f6c 6173   self._pairs_las
-000014a0: 745f 7265 6672 6573 685f 7469 6d65 3a20  t_refresh_time: 
-000014b0: 4469 6374 5b50 6169 7257 6974 6854 696d  Dict[PairWithTim
-000014c0: 6566 7261 6d65 2c20 696e 745d 203d 207b  eframe, int] = {
-000014d0: 7d0a 2020 2020 2020 2020 2320 5469 6d65  }.        # Time
-000014e0: 7374 616d 7020 6f66 206c 6173 7420 6d61  stamp of last ma
-000014f0: 726b 6574 7320 7265 6672 6573 680a 2020  rkets refresh.  
-00001500: 2020 2020 2020 7365 6c66 2e5f 6c61 7374        self._last
-00001510: 5f6d 6172 6b65 7473 5f72 6566 7265 7368  _markets_refresh
-00001520: 3a20 696e 7420 3d20 300a 0a20 2020 2020  : int = 0..     
-00001530: 2020 2023 2043 6163 6865 2066 6f72 2031     # Cache for 1
-00001540: 3020 6d69 6e75 7465 7320 2e2e 2e0a 2020  0 minutes ....  
-00001550: 2020 2020 2020 7365 6c66 2e5f 6361 6368        self._cach
-00001560: 655f 6c6f 636b 203d 204c 6f63 6b28 290a  e_lock = Lock().
-00001570: 2020 2020 2020 2020 7365 6c66 2e5f 6665          self._fe
-00001580: 7463 685f 7469 636b 6572 735f 6361 6368  tch_tickers_cach
-00001590: 653a 2054 544c 4361 6368 6520 3d20 5454  e: TTLCache = TT
-000015a0: 4c43 6163 6865 286d 6178 7369 7a65 3d32  LCache(maxsize=2
-000015b0: 2c20 7474 6c3d 3630 202a 2031 3029 0a20  , ttl=60 * 10). 
-000015c0: 2020 2020 2020 2023 2043 6163 6865 2076         # Cache v
-000015d0: 616c 7565 7320 666f 7220 3138 3030 2074  alues for 1800 t
-000015e0: 6f20 6176 6f69 6420 6672 6571 7565 6e74  o avoid frequent
-000015f0: 2070 6f6c 6c69 6e67 206f 6620 7468 6520   polling of the 
-00001600: 6578 6368 616e 6765 2066 6f72 2070 7269  exchange for pri
-00001610: 6365 730a 2020 2020 2020 2020 2320 4361  ces.        # Ca
-00001620: 6368 696e 6720 6f6e 6c79 2061 7070 6c69  ching only appli
-00001630: 6573 2074 6f20 5250 4320 6d65 7468 6f64  es to RPC method
-00001640: 732c 2073 6f20 7072 6963 6573 2066 6f72  s, so prices for
-00001650: 206f 7065 6e20 7472 6164 6573 2061 7265   open trades are
-00001660: 2073 7469 6c6c 0a20 2020 2020 2020 2023   still.        #
-00001670: 2072 6566 7265 7368 6564 206f 6e63 6520   refreshed once 
-00001680: 6576 6572 7920 6974 6572 6174 696f 6e2e  every iteration.
-00001690: 0a20 2020 2020 2020 2073 656c 662e 5f65  .        self._e
-000016a0: 7869 745f 7261 7465 5f63 6163 6865 3a20  xit_rate_cache: 
-000016b0: 5454 4c43 6163 6865 203d 2054 544c 4361  TTLCache = TTLCa
-000016c0: 6368 6528 6d61 7873 697a 653d 3130 302c  che(maxsize=100,
-000016d0: 2074 746c 3d31 3830 3029 0a20 2020 2020   ttl=1800).     
-000016e0: 2020 2073 656c 662e 5f65 6e74 7279 5f72     self._entry_r
-000016f0: 6174 655f 6361 6368 653a 2054 544c 4361  ate_cache: TTLCa
-00001700: 6368 6520 3d20 5454 4c43 6163 6865 286d  che = TTLCache(m
-00001710: 6178 7369 7a65 3d31 3030 2c20 7474 6c3d  axsize=100, ttl=
-00001720: 3138 3030 290a 0a20 2020 2020 2020 2023  1800)..        #
-00001730: 2048 6f6c 6473 2063 616e 646c 6573 0a20   Holds candles. 
-00001740: 2020 2020 2020 2073 656c 662e 5f6b 6c69         self._kli
-00001750: 6e65 733a 2044 6963 745b 5061 6972 5769  nes: Dict[PairWi
-00001760: 7468 5469 6d65 6672 616d 652c 2044 6174  thTimeframe, Dat
-00001770: 6146 7261 6d65 5d20 3d20 7b7d 0a0a 2020  aFrame] = {}..  
-00001780: 2020 2020 2020 2320 486f 6c64 7320 616c        # Holds al
-00001790: 6c20 6f70 656e 2073 656c 6c20 6f72 6465  l open sell orde
-000017a0: 7273 2066 6f72 2064 7279 5f72 756e 0a20  rs for dry_run. 
-000017b0: 2020 2020 2020 2073 656c 662e 5f64 7279         self._dry
-000017c0: 5f72 756e 5f6f 7065 6e5f 6f72 6465 7273  _run_open_orders
-000017d0: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
-000017e0: 203d 207b 7d0a 2020 2020 2020 2020 7265   = {}.        re
-000017f0: 6d6f 7665 5f63 7265 6465 6e74 6961 6c73  move_credentials
-00001800: 2863 6f6e 6669 6729 0a0a 2020 2020 2020  (config)..      
-00001810: 2020 6966 2063 6f6e 6669 675b 2764 7279    if config['dry
-00001820: 5f72 756e 275d 3a0a 2020 2020 2020 2020  _run']:.        
-00001830: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
-00001840: 2749 6e73 7461 6e63 6520 6973 2072 756e  'Instance is run
-00001850: 6e69 6e67 2077 6974 6820 6472 795f 7275  ning with dry_ru
-00001860: 6e20 656e 6162 6c65 6427 290a 2020 2020  n enabled').    
-00001870: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
-00001880: 6622 5573 696e 6720 4343 5854 207b 6363  f"Using CCXT {cc
-00001890: 7874 2e5f 5f76 6572 7369 6f6e 5f5f 7d22  xt.__version__}"
-000018a0: 290a 2020 2020 2020 2020 6578 6368 616e  ).        exchan
-000018b0: 6765 5f63 6f6e 6669 6720 3d20 636f 6e66  ge_config = conf
-000018c0: 6967 5b27 6578 6368 616e 6765 275d 0a20  ig['exchange']. 
-000018d0: 2020 2020 2020 2073 656c 662e 6c6f 675f         self.log_
-000018e0: 7265 7370 6f6e 7365 7320 3d20 6578 6368  responses = exch
-000018f0: 616e 6765 5f63 6f6e 6669 672e 6765 7428  ange_config.get(
-00001900: 276c 6f67 5f72 6573 706f 6e73 6573 272c  'log_responses',
-00001910: 2046 616c 7365 290a 0a20 2020 2020 2020   False)..       
-00001920: 2023 204c 6576 6572 6167 6520 7072 6f70   # Leverage prop
-00001930: 6572 7469 6573 0a20 2020 2020 2020 2073  erties.        s
-00001940: 656c 662e 7472 6164 696e 675f 6d6f 6465  elf.trading_mode
-00001950: 3a20 5472 6164 696e 674d 6f64 6520 3d20  : TradingMode = 
-00001960: 636f 6e66 6967 2e67 6574 2827 7472 6164  config.get('trad
-00001970: 696e 675f 6d6f 6465 272c 2054 7261 6469  ing_mode', Tradi
-00001980: 6e67 4d6f 6465 2e53 504f 5429 0a20 2020  ngMode.SPOT).   
-00001990: 2020 2020 2073 656c 662e 6d61 7267 696e       self.margin
-000019a0: 5f6d 6f64 653a 204d 6172 6769 6e4d 6f64  _mode: MarginMod
-000019b0: 6520 3d20 280a 2020 2020 2020 2020 2020  e = (.          
-000019c0: 2020 4d61 7267 696e 4d6f 6465 2863 6f6e    MarginMode(con
-000019d0: 6669 672e 6765 7428 276d 6172 6769 6e5f  fig.get('margin_
-000019e0: 6d6f 6465 2729 290a 2020 2020 2020 2020  mode')).        
-000019f0: 2020 2020 6966 2063 6f6e 6669 672e 6765      if config.ge
-00001a00: 7428 276d 6172 6769 6e5f 6d6f 6465 2729  t('margin_mode')
-00001a10: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00001a20: 6520 4d61 7267 696e 4d6f 6465 2e4e 4f4e  e MarginMode.NON
-00001a30: 450a 2020 2020 2020 2020 290a 2020 2020  E.        ).    
-00001a40: 2020 2020 7365 6c66 2e6c 6971 7569 6461      self.liquida
-00001a50: 7469 6f6e 5f62 7566 6665 7220 3d20 636f  tion_buffer = co
-00001a60: 6e66 6967 2e67 6574 2827 6c69 7175 6964  nfig.get('liquid
-00001a70: 6174 696f 6e5f 6275 6666 6572 272c 2030  ation_buffer', 0
-00001a80: 2e30 3529 0a0a 2020 2020 2020 2020 2320  .05)..        # 
-00001a90: 4465 6570 206d 6572 6765 2066 745f 6861  Deep merge ft_ha
-00001aa0: 7320 7769 7468 2064 6566 6175 6c74 2066  s with default f
-00001ab0: 745f 6861 7320 6f70 7469 6f6e 730a 2020  t_has options.  
-00001ac0: 2020 2020 2020 7365 6c66 2e5f 6674 5f68        self._ft_h
-00001ad0: 6173 203d 2064 6565 705f 6d65 7267 655f  as = deep_merge_
-00001ae0: 6469 6374 7328 7365 6c66 2e5f 6674 5f68  dicts(self._ft_h
-00001af0: 6173 2c20 6465 6570 636f 7079 2873 656c  as, deepcopy(sel
-00001b00: 662e 5f66 745f 6861 735f 6465 6661 756c  f._ft_has_defaul
-00001b10: 7429 290a 2020 2020 2020 2020 6966 2073  t)).        if s
-00001b20: 656c 662e 7472 6164 696e 675f 6d6f 6465  elf.trading_mode
-00001b30: 203d 3d20 5472 6164 696e 674d 6f64 652e   == TradingMode.
-00001b40: 4655 5455 5245 533a 0a20 2020 2020 2020  FUTURES:.       
-00001b50: 2020 2020 2073 656c 662e 5f66 745f 6861       self._ft_ha
-00001b60: 7320 3d20 6465 6570 5f6d 6572 6765 5f64  s = deep_merge_d
-00001b70: 6963 7473 2873 656c 662e 5f66 745f 6861  icts(self._ft_ha
-00001b80: 735f 6675 7475 7265 732c 2073 656c 662e  s_futures, self.
-00001b90: 5f66 745f 6861 7329 0a20 2020 2020 2020  _ft_has).       
-00001ba0: 2069 6620 6578 6368 616e 6765 5f63 6f6e   if exchange_con
-00001bb0: 6669 672e 6765 7428 275f 6674 5f68 6173  fig.get('_ft_has
-00001bc0: 5f70 6172 616d 7327 293a 0a20 2020 2020  _params'):.     
-00001bd0: 2020 2020 2020 2073 656c 662e 5f66 745f         self._ft_
-00001be0: 6861 7320 3d20 6465 6570 5f6d 6572 6765  has = deep_merge
-00001bf0: 5f64 6963 7473 2865 7863 6861 6e67 655f  _dicts(exchange_
-00001c00: 636f 6e66 6967 2e67 6574 2827 5f66 745f  config.get('_ft_
-00001c10: 6861 735f 7061 7261 6d73 2729 2c0a 2020  has_params'),.  
-00001c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c40: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00001c50: 6674 5f68 6173 290a 2020 2020 2020 2020  ft_has).        
-00001c60: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
-00001c70: 224f 7665 7272 6964 696e 6720 6578 6368  "Overriding exch
-00001c80: 616e 6765 2e5f 6674 5f68 6173 2077 6974  ange._ft_has wit
-00001c90: 6820 636f 6e66 6967 2070 6172 616d 732c  h config params,
-00001ca0: 2072 6573 756c 743a 2025 7322 2c20 7365   result: %s", se
-00001cb0: 6c66 2e5f 6674 5f68 6173 290a 0a20 2020  lf._ft_has)..   
-00001cc0: 2020 2020 2023 2041 7373 6967 6e20 7468       # Assign th
-00001cd0: 6973 2064 6972 6563 746c 7920 666f 7220  is directly for 
-00001ce0: 6561 7379 2061 6363 6573 730a 2020 2020  easy access.    
-00001cf0: 2020 2020 7365 6c66 2e5f 6f68 6c63 765f      self._ohlcv_
-00001d00: 7061 7274 6961 6c5f 6361 6e64 6c65 203d  partial_candle =
-00001d10: 2073 656c 662e 5f66 745f 6861 735b 276f   self._ft_has['o
-00001d20: 686c 6376 5f70 6172 7469 616c 5f63 616e  hlcv_partial_can
-00001d30: 646c 6527 5d0a 0a20 2020 2020 2020 2073  dle']..        s
-00001d40: 656c 662e 5f74 7261 6465 735f 7061 6769  elf._trades_pagi
-00001d50: 6e61 7469 6f6e 203d 2073 656c 662e 5f66  nation = self._f
-00001d60: 745f 6861 735b 2774 7261 6465 735f 7061  t_has['trades_pa
-00001d70: 6769 6e61 7469 6f6e 275d 0a20 2020 2020  gination'].     
-00001d80: 2020 2073 656c 662e 5f74 7261 6465 735f     self._trades_
-00001d90: 7061 6769 6e61 7469 6f6e 5f61 7267 203d  pagination_arg =
-00001da0: 2073 656c 662e 5f66 745f 6861 735b 2774   self._ft_has['t
-00001db0: 7261 6465 735f 7061 6769 6e61 7469 6f6e  rades_pagination
-00001dc0: 5f61 7267 275d 0a0a 2020 2020 2020 2020  _arg']..        
-00001dd0: 2320 496e 6974 6961 6c69 7a65 2063 6378  # Initialize ccx
-00001de0: 7420 6f62 6a65 6374 730a 2020 2020 2020  t objects.      
-00001df0: 2020 6363 7874 5f63 6f6e 6669 6720 3d20    ccxt_config = 
-00001e00: 7365 6c66 2e5f 6363 7874 5f63 6f6e 6669  self._ccxt_confi
-00001e10: 670a 2020 2020 2020 2020 6363 7874 5f63  g.        ccxt_c
-00001e20: 6f6e 6669 6720 3d20 6465 6570 5f6d 6572  onfig = deep_mer
-00001e30: 6765 5f64 6963 7473 2865 7863 6861 6e67  ge_dicts(exchang
-00001e40: 655f 636f 6e66 6967 2e67 6574 2827 6363  e_config.get('cc
-00001e50: 7874 5f63 6f6e 6669 6727 2c20 7b7d 292c  xt_config', {}),
-00001e60: 2063 6378 745f 636f 6e66 6967 290a 2020   ccxt_config).  
-00001e70: 2020 2020 2020 6363 7874 5f63 6f6e 6669        ccxt_confi
-00001e80: 6720 3d20 6465 6570 5f6d 6572 6765 5f64  g = deep_merge_d
-00001e90: 6963 7473 2865 7863 6861 6e67 655f 636f  icts(exchange_co
-00001ea0: 6e66 6967 2e67 6574 2827 6363 7874 5f73  nfig.get('ccxt_s
-00001eb0: 796e 635f 636f 6e66 6967 272c 207b 7d29  ync_config', {})
-00001ec0: 2c20 6363 7874 5f63 6f6e 6669 6729 0a0a  , ccxt_config)..
-00001ed0: 2020 2020 2020 2020 7365 6c66 2e5f 6170          self._ap
-00001ee0: 6920 3d20 7365 6c66 2e5f 696e 6974 5f63  i = self._init_c
-00001ef0: 6378 7428 6578 6368 616e 6765 5f63 6f6e  cxt(exchange_con
-00001f00: 6669 672c 2063 6378 745f 6b77 6172 6773  fig, ccxt_kwargs
-00001f10: 3d63 6378 745f 636f 6e66 6967 290a 0a20  =ccxt_config).. 
-00001f20: 2020 2020 2020 2063 6378 745f 6173 796e         ccxt_asyn
-00001f30: 635f 636f 6e66 6967 203d 2073 656c 662e  c_config = self.
-00001f40: 5f63 6378 745f 636f 6e66 6967 0a20 2020  _ccxt_config.   
-00001f50: 2020 2020 2063 6378 745f 6173 796e 635f       ccxt_async_
-00001f60: 636f 6e66 6967 203d 2064 6565 705f 6d65  config = deep_me
-00001f70: 7267 655f 6469 6374 7328 6578 6368 616e  rge_dicts(exchan
-00001f80: 6765 5f63 6f6e 6669 672e 6765 7428 2763  ge_config.get('c
-00001f90: 6378 745f 636f 6e66 6967 272c 207b 7d29  cxt_config', {})
-00001fa0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00001fd0: 6378 745f 6173 796e 635f 636f 6e66 6967  cxt_async_config
-00001fe0: 290a 2020 2020 2020 2020 6363 7874 5f61  ).        ccxt_a
-00001ff0: 7379 6e63 5f63 6f6e 6669 6720 3d20 6465  sync_config = de
-00002000: 6570 5f6d 6572 6765 5f64 6963 7473 2865  ep_merge_dicts(e
-00002010: 7863 6861 6e67 655f 636f 6e66 6967 2e67  xchange_config.g
-00002020: 6574 2827 6363 7874 5f61 7379 6e63 5f63  et('ccxt_async_c
-00002030: 6f6e 6669 6727 2c20 7b7d 292c 0a20 2020  onfig', {}),.   
-00002040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002060: 2020 2020 2020 2020 2020 6363 7874 5f61            ccxt_a
-00002070: 7379 6e63 5f63 6f6e 6669 6729 0a20 2020  sync_config).   
-00002080: 2020 2020 2073 656c 662e 5f61 7069 5f61       self._api_a
-00002090: 7379 6e63 203d 2073 656c 662e 5f69 6e69  sync = self._ini
-000020a0: 745f 6363 7874 280a 2020 2020 2020 2020  t_ccxt(.        
-000020b0: 2020 2020 6578 6368 616e 6765 5f63 6f6e      exchange_con
-000020c0: 6669 672c 2063 6378 745f 6173 796e 632c  fig, ccxt_async,
-000020d0: 2063 6378 745f 6b77 6172 6773 3d63 6378   ccxt_kwargs=ccx
-000020e0: 745f 6173 796e 635f 636f 6e66 6967 290a  t_async_config).
-000020f0: 0a20 2020 2020 2020 206c 6f67 6765 722e  .        logger.
-00002100: 696e 666f 2866 2755 7369 6e67 2045 7863  info(f'Using Exc
-00002110: 6861 6e67 6520 227b 7365 6c66 2e6e 616d  hange "{self.nam
-00002120: 657d 2227 290a 2020 2020 2020 2020 7365  e}"').        se
-00002130: 6c66 2e72 6571 7569 7265 645f 6361 6e64  lf.required_cand
-00002140: 6c65 5f63 616c 6c5f 636f 756e 7420 3d20  le_call_count = 
-00002150: 310a 2020 2020 2020 2020 6966 2076 616c  1.        if val
-00002160: 6964 6174 653a 0a20 2020 2020 2020 2020  idate:.         
-00002170: 2020 2023 2049 6e69 7469 616c 206d 6172     # Initial mar
-00002180: 6b65 7473 206c 6f61 640a 2020 2020 2020  kets load.      
-00002190: 2020 2020 2020 7365 6c66 2e5f 6c6f 6164        self._load
-000021a0: 5f6d 6172 6b65 7473 2829 0a20 2020 2020  _markets().     
-000021b0: 2020 2020 2020 2073 656c 662e 7661 6c69         self.vali
-000021c0: 6461 7465 5f63 6f6e 6669 6728 636f 6e66  date_config(conf
-000021d0: 6967 290a 2020 2020 2020 2020 2020 2020  ig).            
-000021e0: 7365 6c66 2e5f 7374 6172 7475 705f 6361  self._startup_ca
-000021f0: 6e64 6c65 5f63 6f75 6e74 3a20 696e 7420  ndle_count: int 
-00002200: 3d20 636f 6e66 6967 2e67 6574 2827 7374  = config.get('st
-00002210: 6172 7475 705f 6361 6e64 6c65 5f63 6f75  artup_candle_cou
-00002220: 6e74 272c 2030 290a 2020 2020 2020 2020  nt', 0).        
-00002230: 2020 2020 7365 6c66 2e72 6571 7569 7265      self.require
-00002240: 645f 6361 6e64 6c65 5f63 616c 6c5f 636f  d_candle_call_co
-00002250: 756e 7420 3d20 7365 6c66 2e76 616c 6964  unt = self.valid
-00002260: 6174 655f 7265 7175 6972 6564 5f73 7461  ate_required_sta
-00002270: 7274 7570 5f63 616e 646c 6573 280a 2020  rtup_candles(.  
-00002280: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00002290: 6c66 2e5f 7374 6172 7475 705f 6361 6e64  lf._startup_cand
-000022a0: 6c65 5f63 6f75 6e74 2c20 636f 6e66 6967  le_count, config
-000022b0: 2e67 6574 2827 7469 6d65 6672 616d 6527  .get('timeframe'
-000022c0: 2c20 2727 2929 0a0a 2020 2020 2020 2020  , ''))..        
-000022d0: 2320 436f 6e76 6572 7473 2074 6865 2069  # Converts the i
-000022e0: 6e74 6572 7661 6c20 7072 6f76 6964 6564  nterval provided
-000022f0: 2069 6e20 6d69 6e75 7465 7320 696e 2063   in minutes in c
-00002300: 6f6e 6669 6720 746f 2073 6563 6f6e 6473  onfig to seconds
-00002310: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
-00002320: 726b 6574 735f 7265 6672 6573 685f 696e  rkets_refresh_in
-00002330: 7465 7276 616c 3a20 696e 7420 3d20 6578  terval: int = ex
-00002340: 6368 616e 6765 5f63 6f6e 6669 672e 6765  change_config.ge
-00002350: 7428 0a20 2020 2020 2020 2020 2020 2022  t(.            "
-00002360: 6d61 726b 6574 735f 7265 6672 6573 685f  markets_refresh_
-00002370: 696e 7465 7276 616c 222c 2036 3029 202a  interval", 60) *
-00002380: 2036 300a 0a20 2020 2020 2020 2069 6620   60..        if 
-00002390: 7365 6c66 2e74 7261 6469 6e67 5f6d 6f64  self.trading_mod
-000023a0: 6520 213d 2054 7261 6469 6e67 4d6f 6465  e != TradingMode
-000023b0: 2e53 504f 5420 616e 6420 6c6f 6164 5f6c  .SPOT and load_l
-000023c0: 6576 6572 6167 655f 7469 6572 733a 0a20  everage_tiers:. 
-000023d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000023e0: 6669 6c6c 5f6c 6576 6572 6167 655f 7469  fill_leverage_ti
-000023f0: 6572 7328 290a 2020 2020 2020 2020 7365  ers().        se
-00002400: 6c66 2e61 6464 6974 696f 6e61 6c5f 6578  lf.additional_ex
-00002410: 6368 616e 6765 5f69 6e69 7428 290a 0a20  change_init().. 
-00002420: 2020 2064 6566 205f 5f64 656c 5f5f 2873     def __del__(s
-00002430: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00002440: 220a 2020 2020 2020 2020 4465 7374 7275  ".        Destru
-00002450: 6374 6f72 202d 2063 6c65 616e 2075 7020  ctor - clean up 
-00002460: 6173 796e 6320 7374 7566 660a 2020 2020  async stuff.    
-00002470: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00002480: 7365 6c66 2e63 6c6f 7365 2829 0a0a 2020  self.close()..  
-00002490: 2020 6465 6620 636c 6f73 6528 7365 6c66    def close(self
-000024a0: 293a 0a20 2020 2020 2020 206c 6f67 6765  ):.        logge
-000024b0: 722e 6465 6275 6728 2245 7863 6861 6e67  r.debug("Exchang
-000024c0: 6520 6f62 6a65 6374 2064 6573 7472 6f79  e object destroy
-000024d0: 6564 2c20 636c 6f73 696e 6720 6173 796e  ed, closing asyn
-000024e0: 6320 6c6f 6f70 2229 0a20 2020 2020 2020  c loop").       
-000024f0: 2069 6620 2873 656c 662e 5f61 7069 5f61   if (self._api_a
-00002500: 7379 6e63 2061 6e64 2069 6e73 7065 6374  sync and inspect
-00002510: 2e69 7363 6f72 6f75 7469 6e65 6675 6e63  .iscoroutinefunc
-00002520: 7469 6f6e 2873 656c 662e 5f61 7069 5f61  tion(self._api_a
-00002530: 7379 6e63 2e63 6c6f 7365 290a 2020 2020  sync.close).    
-00002540: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00002550: 7365 6c66 2e5f 6170 695f 6173 796e 632e  self._api_async.
-00002560: 7365 7373 696f 6e29 3a0a 2020 2020 2020  session):.      
-00002570: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
-00002580: 7567 2822 436c 6f73 696e 6720 6173 796e  ug("Closing asyn
-00002590: 6320 6363 7874 2073 6573 7369 6f6e 2e22  c ccxt session."
-000025a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000025b0: 6c66 2e6c 6f6f 702e 7275 6e5f 756e 7469  lf.loop.run_unti
-000025c0: 6c5f 636f 6d70 6c65 7465 2873 656c 662e  l_complete(self.
-000025d0: 5f61 7069 5f61 7379 6e63 2e63 6c6f 7365  _api_async.close
-000025e0: 2829 290a 2020 2020 2020 2020 6966 2073  ()).        if s
-000025f0: 656c 662e 6c6f 6f70 2061 6e64 206e 6f74  elf.loop and not
-00002600: 2073 656c 662e 6c6f 6f70 2e69 735f 636c   self.loop.is_cl
-00002610: 6f73 6564 2829 3a0a 2020 2020 2020 2020  osed():.        
-00002620: 2020 2020 7365 6c66 2e6c 6f6f 702e 636c      self.loop.cl
-00002630: 6f73 6528 290a 0a20 2020 2064 6566 2076  ose()..    def v
-00002640: 616c 6964 6174 655f 636f 6e66 6967 2873  alidate_config(s
-00002650: 656c 662c 2063 6f6e 6669 6729 3a0a 2020  elf, config):.  
-00002660: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-00002670: 2074 696d 6566 7261 6d65 2069 7320 6176   timeframe is av
-00002680: 6169 6c61 626c 650a 2020 2020 2020 2020  ailable.        
-00002690: 7365 6c66 2e76 616c 6964 6174 655f 7469  self.validate_ti
-000026a0: 6d65 6672 616d 6573 2863 6f6e 6669 672e  meframes(config.
-000026b0: 6765 7428 2774 696d 6566 7261 6d65 2729  get('timeframe')
-000026c0: 290a 0a20 2020 2020 2020 2023 2043 6865  )..        # Che
-000026d0: 636b 2069 6620 616c 6c20 7061 6972 7320  ck if all pairs 
-000026e0: 6172 6520 6176 6169 6c61 626c 650a 2020  are available.  
-000026f0: 2020 2020 2020 7365 6c66 2e76 616c 6964        self.valid
-00002700: 6174 655f 7374 616b 6563 7572 7265 6e63  ate_stakecurrenc
-00002710: 7928 636f 6e66 6967 5b27 7374 616b 655f  y(config['stake_
-00002720: 6375 7272 656e 6379 275d 290a 2020 2020  currency']).    
-00002730: 2020 2020 6966 206e 6f74 2063 6f6e 6669      if not confi
-00002740: 675b 2765 7863 6861 6e67 6527 5d2e 6765  g['exchange'].ge
-00002750: 7428 2773 6b69 705f 7061 6972 5f76 616c  t('skip_pair_val
-00002760: 6964 6174 696f 6e27 293a 0a20 2020 2020  idation'):.     
-00002770: 2020 2020 2020 2073 656c 662e 7661 6c69         self.vali
-00002780: 6461 7465 5f70 6169 7273 2863 6f6e 6669  date_pairs(confi
-00002790: 675b 2765 7863 6861 6e67 6527 5d5b 2770  g['exchange']['p
-000027a0: 6169 725f 7768 6974 656c 6973 7427 5d29  air_whitelist'])
-000027b0: 0a20 2020 2020 2020 2073 656c 662e 7661  .        self.va
-000027c0: 6c69 6461 7465 5f6f 7264 6572 7479 7065  lidate_ordertype
-000027d0: 7328 636f 6e66 6967 2e67 6574 2827 6f72  s(config.get('or
-000027e0: 6465 725f 7479 7065 7327 2c20 7b7d 2929  der_types', {}))
-000027f0: 0a20 2020 2020 2020 2073 656c 662e 7661  .        self.va
-00002800: 6c69 6461 7465 5f6f 7264 6572 5f74 696d  lidate_order_tim
-00002810: 655f 696e 5f66 6f72 6365 2863 6f6e 6669  e_in_force(confi
-00002820: 672e 6765 7428 276f 7264 6572 5f74 696d  g.get('order_tim
-00002830: 655f 696e 5f66 6f72 6365 272c 207b 7d29  e_in_force', {})
-00002840: 290a 2020 2020 2020 2020 7365 6c66 2e76  ).        self.v
-00002850: 616c 6964 6174 655f 7472 6164 696e 675f  alidate_trading_
-00002860: 6d6f 6465 5f61 6e64 5f6d 6172 6769 6e5f  mode_and_margin_
-00002870: 6d6f 6465 2873 656c 662e 7472 6164 696e  mode(self.tradin
-00002880: 675f 6d6f 6465 2c20 7365 6c66 2e6d 6172  g_mode, self.mar
-00002890: 6769 6e5f 6d6f 6465 290a 2020 2020 2020  gin_mode).      
-000028a0: 2020 7365 6c66 2e76 616c 6964 6174 655f    self.validate_
-000028b0: 7072 6963 696e 6728 636f 6e66 6967 5b27  pricing(config['
-000028c0: 6578 6974 5f70 7269 6369 6e67 275d 290a  exit_pricing']).
-000028d0: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
-000028e0: 6964 6174 655f 7072 6963 696e 6728 636f  idate_pricing(co
-000028f0: 6e66 6967 5b27 656e 7472 795f 7072 6963  nfig['entry_pric
-00002900: 696e 6727 5d29 0a0a 2020 2020 6465 6620  ing'])..    def 
-00002910: 5f69 6e69 745f 6363 7874 2873 656c 662c  _init_ccxt(self,
-00002920: 2065 7863 6861 6e67 655f 636f 6e66 6967   exchange_config
-00002930: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
-00002940: 2c20 6363 7874 5f6d 6f64 756c 653a 2043  , ccxt_module: C
-00002950: 6378 744d 6f64 756c 6554 7970 6520 3d20  cxtModuleType = 
-00002960: 6363 7874 2c0a 2020 2020 2020 2020 2020  ccxt,.          
-00002970: 2020 2020 2020 2020 2063 6378 745f 6b77           ccxt_kw
-00002980: 6172 6773 3a20 4469 6374 203d 207b 7d29  args: Dict = {})
-00002990: 202d 3e20 6363 7874 2e45 7863 6861 6e67   -> ccxt.Exchang
-000029a0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-000029b0: 2020 2020 2020 2049 6e69 7469 616c 697a         Initializ
-000029c0: 6520 6363 7874 2077 6974 6820 6769 7665  e ccxt with give
-000029d0: 6e20 636f 6e66 6967 2061 6e64 2072 6574  n config and ret
-000029e0: 7572 6e20 7661 6c69 640a 2020 2020 2020  urn valid.      
-000029f0: 2020 6363 7874 2069 6e73 7461 6e63 652e    ccxt instance.
-00002a00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00002a10: 2020 2020 2023 2046 696e 6420 6d61 7463       # Find matc
-00002a20: 6869 6e67 2063 6c61 7373 2066 6f72 2074  hing class for t
-00002a30: 6865 2067 6976 656e 2065 7863 6861 6e67  he given exchang
-00002a40: 6520 6e61 6d65 0a20 2020 2020 2020 206e  e name.        n
-00002a50: 616d 6520 3d20 6578 6368 616e 6765 5f63  ame = exchange_c
-00002a60: 6f6e 6669 675b 276e 616d 6527 5d0a 0a20  onfig['name'].. 
-00002a70: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00002a80: 5f65 7863 6861 6e67 655f 6b6e 6f77 6e5f  _exchange_known_
-00002a90: 6363 7874 286e 616d 652c 2063 6378 745f  ccxt(name, ccxt_
-00002aa0: 6d6f 6475 6c65 293a 0a20 2020 2020 2020  module):.       
-00002ab0: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-00002ac0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-00002ad0: 6627 4578 6368 616e 6765 207b 6e61 6d65  f'Exchange {name
-00002ae0: 7d20 6973 206e 6f74 2073 7570 706f 7274  } is not support
-00002af0: 6564 2062 7920 6363 7874 2729 0a0a 2020  ed by ccxt')..  
-00002b00: 2020 2020 2020 6578 5f63 6f6e 6669 6720        ex_config 
-00002b10: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00002b20: 2761 7069 4b65 7927 3a20 6578 6368 616e  'apiKey': exchan
-00002b30: 6765 5f63 6f6e 6669 672e 6765 7428 276b  ge_config.get('k
-00002b40: 6579 2729 2c0a 2020 2020 2020 2020 2020  ey'),.          
-00002b50: 2020 2773 6563 7265 7427 3a20 6578 6368    'secret': exch
-00002b60: 616e 6765 5f63 6f6e 6669 672e 6765 7428  ange_config.get(
-00002b70: 2773 6563 7265 7427 292c 0a20 2020 2020  'secret'),.     
-00002b80: 2020 2020 2020 2027 7061 7373 776f 7264         'password
-00002b90: 273a 2065 7863 6861 6e67 655f 636f 6e66  ': exchange_conf
-00002ba0: 6967 2e67 6574 2827 7061 7373 776f 7264  ig.get('password
-00002bb0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-00002bc0: 2775 6964 273a 2065 7863 6861 6e67 655f  'uid': exchange_
-00002bd0: 636f 6e66 6967 2e67 6574 2827 7569 6427  config.get('uid'
-00002be0: 2c20 2727 292c 0a20 2020 2020 2020 207d  , ''),.        }
-00002bf0: 0a20 2020 2020 2020 2069 6620 6363 7874  .        if ccxt
-00002c00: 5f6b 7761 7267 733a 0a20 2020 2020 2020  _kwargs:.       
-00002c10: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-00002c20: 2827 4170 706c 7969 6e67 2061 6464 6974  ('Applying addit
-00002c30: 696f 6e61 6c20 6363 7874 2063 6f6e 6669  ional ccxt confi
-00002c40: 673a 2025 7327 2c20 6363 7874 5f6b 7761  g: %s', ccxt_kwa
-00002c50: 7267 7329 0a20 2020 2020 2020 2069 6620  rgs).        if 
-00002c60: 7365 6c66 2e5f 6363 7874 5f70 6172 616d  self._ccxt_param
-00002c70: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-00002c80: 2049 6e6a 6563 7420 7374 6174 6963 206f   Inject static o
-00002c90: 7074 696f 6e73 2061 6674 6572 2074 6865  ptions after the
-00002ca0: 2061 626f 7665 206f 7574 7075 7420 746f   above output to
-00002cb0: 206e 6f74 2063 6f6e 6675 7365 2075 7365   not confuse use
-00002cc0: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
-00002cd0: 6363 7874 5f6b 7761 7267 7320 3d20 6465  ccxt_kwargs = de
-00002ce0: 6570 5f6d 6572 6765 5f64 6963 7473 2873  ep_merge_dicts(s
-00002cf0: 656c 662e 5f63 6378 745f 7061 7261 6d73  elf._ccxt_params
-00002d00: 2c20 6363 7874 5f6b 7761 7267 7329 0a20  , ccxt_kwargs). 
-00002d10: 2020 2020 2020 2069 6620 6363 7874 5f6b         if ccxt_k
-00002d20: 7761 7267 733a 0a20 2020 2020 2020 2020  wargs:.         
-00002d30: 2020 2065 785f 636f 6e66 6967 2e75 7064     ex_config.upd
-00002d40: 6174 6528 6363 7874 5f6b 7761 7267 7329  ate(ccxt_kwargs)
-00002d50: 0a20 2020 2020 2020 2074 7279 3a0a 0a20  .        try:.. 
-00002d60: 2020 2020 2020 2020 2020 2061 7069 203d             api =
-00002d70: 2067 6574 6174 7472 2863 6378 745f 6d6f   getattr(ccxt_mo
-00002d80: 6475 6c65 2c20 6e61 6d65 2e6c 6f77 6572  dule, name.lower
-00002d90: 2829 2928 6578 5f63 6f6e 6669 6729 0a20  ())(ex_config). 
-00002da0: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
-00002db0: 6579 4572 726f 722c 2041 7474 7269 6275  eyError, Attribu
-00002dc0: 7465 4572 726f 7229 2061 7320 653a 0a20  teError) as e:. 
-00002dd0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00002de0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-00002df0: 7074 696f 6e28 6627 4578 6368 616e 6765  ption(f'Exchange
-00002e00: 207b 6e61 6d65 7d20 6973 206e 6f74 2073   {name} is not s
-00002e10: 7570 706f 7274 6564 2729 2066 726f 6d20  upported') from 
-00002e20: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00002e30: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
-00002e40: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00002e50: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00002e60: 6e61 6c45 7863 6570 7469 6f6e 2866 2249  nalException(f"I
-00002e70: 6e69 7469 616c 697a 6174 696f 6e20 6f66  nitialization of
-00002e80: 2063 6378 7420 6661 696c 6564 2e20 5265   ccxt failed. Re
-00002e90: 6173 6f6e 3a20 7b65 7d22 2920 6672 6f6d  ason: {e}") from
-00002ea0: 2065 0a0a 2020 2020 2020 2020 7365 6c66   e..        self
-00002eb0: 2e73 6574 5f73 616e 6462 6f78 2861 7069  .set_sandbox(api
-00002ec0: 2c20 6578 6368 616e 6765 5f63 6f6e 6669  , exchange_confi
-00002ed0: 672c 206e 616d 6529 0a0a 2020 2020 2020  g, name)..      
-00002ee0: 2020 7265 7475 726e 2061 7069 0a0a 2020    return api..  
-00002ef0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00002f00: 6465 6620 5f63 6378 745f 636f 6e66 6967  def _ccxt_config
-00002f10: 2873 656c 6629 202d 3e20 4469 6374 3a0a  (self) -> Dict:.
-00002f20: 2020 2020 2020 2020 2320 5061 7261 6d65          # Parame
-00002f30: 7465 7273 2074 6f20 6164 6420 6469 7265  ters to add dire
-00002f40: 6374 6c79 2074 6f20 6363 7874 2073 796e  ctly to ccxt syn
-00002f50: 632f 6173 796e 6320 696e 6974 6961 6c69  c/async initiali
-00002f60: 7a61 7469 6f6e 2e0a 2020 2020 2020 2020  zation..        
-00002f70: 6966 2073 656c 662e 7472 6164 696e 675f  if self.trading_
-00002f80: 6d6f 6465 203d 3d20 5472 6164 696e 674d  mode == TradingM
-00002f90: 6f64 652e 4d41 5247 494e 3a0a 2020 2020  ode.MARGIN:.    
-00002fa0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00002fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002fc0: 2022 6f70 7469 6f6e 7322 3a20 7b0a 2020   "options": {.  
-00002fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fe0: 2020 2264 6566 6175 6c74 5479 7065 223a    "defaultType":
-00002ff0: 2022 6d61 7267 696e 220a 2020 2020 2020   "margin".      
-00003000: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-00003010: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00003020: 2020 656c 6966 2073 656c 662e 7472 6164    elif self.trad
-00003030: 696e 675f 6d6f 6465 203d 3d20 5472 6164  ing_mode == Trad
-00003040: 696e 674d 6f64 652e 4655 5455 5245 533a  ingMode.FUTURES:
-00003050: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00003060: 7572 6e20 7b0a 2020 2020 2020 2020 2020  urn {.          
-00003070: 2020 2020 2020 226f 7074 696f 6e73 223a        "options":
-00003080: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00003090: 2020 2020 2020 2022 6465 6661 756c 7454         "defaultT
-000030a0: 7970 6522 3a20 7365 6c66 2e5f 6674 5f68  ype": self._ft_h
-000030b0: 6173 5b22 6363 7874 5f66 7574 7572 6573  as["ccxt_futures
-000030c0: 5f6e 616d 6522 5d0a 2020 2020 2020 2020  _name"].        
-000030d0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-000030e0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-000030f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00003100: 2020 7265 7475 726e 207b 7d0a 0a20 2020    return {}..   
-00003110: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00003120: 6566 206e 616d 6528 7365 6c66 2920 2d3e  ef name(self) ->
-00003130: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
-00003140: 2265 7863 6861 6e67 6520 4e61 6d65 2028  "exchange Name (
-00003150: 6672 6f6d 2063 6378 7429 2222 220a 2020  from ccxt)""".  
-00003160: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00003170: 662e 5f61 7069 2e6e 616d 650a 0a20 2020  f._api.name..   
-00003180: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00003190: 6566 2069 6428 7365 6c66 2920 2d3e 2073  ef id(self) -> s
-000031a0: 7472 3a0a 2020 2020 2020 2020 2222 2265  tr:.        """e
-000031b0: 7863 6861 6e67 6520 6363 7874 2069 6422  xchange ccxt id"
-000031c0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-000031d0: 6e20 7365 6c66 2e5f 6170 692e 6964 0a0a  n self._api.id..
-000031e0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-000031f0: 2020 6465 6620 7469 6d65 6672 616d 6573    def timeframes
-00003200: 2873 656c 6629 202d 3e20 4c69 7374 5b73  (self) -> List[s
-00003210: 7472 5d3a 0a20 2020 2020 2020 2072 6574  tr]:.        ret
-00003220: 7572 6e20 6c69 7374 2828 7365 6c66 2e5f  urn list((self._
-00003230: 6170 692e 7469 6d65 6672 616d 6573 206f  api.timeframes o
-00003240: 7220 7b7d 292e 6b65 7973 2829 290a 0a20  r {}).keys()).. 
-00003250: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00003260: 2064 6566 206d 6172 6b65 7473 2873 656c   def markets(sel
-00003270: 6629 202d 3e20 4469 6374 3a0a 2020 2020  f) -> Dict:.    
-00003280: 2020 2020 2222 2265 7863 6861 6e67 6520      """exchange 
-00003290: 6363 7874 206d 6172 6b65 7473 2222 220a  ccxt markets""".
-000032a0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-000032b0: 656c 662e 5f6d 6172 6b65 7473 3a0a 2020  elf._markets:.  
-000032c0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-000032d0: 2e69 6e66 6f28 224d 6172 6b65 7473 2077  .info("Markets w
-000032e0: 6572 6520 6e6f 7420 6c6f 6164 6564 2e20  ere not loaded. 
-000032f0: 4c6f 6164 696e 6720 7468 656d 206e 6f77  Loading them now
-00003300: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-00003310: 2073 656c 662e 5f6c 6f61 645f 6d61 726b   self._load_mark
-00003320: 6574 7328 290a 2020 2020 2020 2020 7265  ets().        re
-00003330: 7475 726e 2073 656c 662e 5f6d 6172 6b65  turn self._marke
-00003340: 7473 0a0a 2020 2020 4070 726f 7065 7274  ts..    @propert
-00003350: 790a 2020 2020 6465 6620 7072 6563 6973  y.    def precis
-00003360: 696f 6e4d 6f64 6528 7365 6c66 2920 2d3e  ionMode(self) ->
-00003370: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
-00003380: 2265 7863 6861 6e67 6520 6363 7874 2070  "exchange ccxt p
-00003390: 7265 6369 7369 6f6e 4d6f 6465 2222 220a  recisionMode""".
-000033a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000033b0: 656c 662e 5f61 7069 2e70 7265 6369 7369  elf._api.precisi
-000033c0: 6f6e 4d6f 6465 0a0a 2020 2020 6465 6620  onMode..    def 
-000033d0: 6164 6469 7469 6f6e 616c 5f65 7863 6861  additional_excha
-000033e0: 6e67 655f 696e 6974 2873 656c 6629 202d  nge_init(self) -
-000033f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00003400: 2222 220a 2020 2020 2020 2020 4164 6469  """.        Addi
-00003410: 7469 6f6e 616c 2065 7863 6861 6e67 6520  tional exchange 
-00003420: 696e 6974 6961 6c69 7a61 7469 6f6e 206c  initialization l
-00003430: 6f67 6963 2e0a 2020 2020 2020 2020 2e61  ogic..        .a
-00003440: 7069 2077 696c 6c20 6265 2061 7661 696c  pi will be avail
-00003450: 6162 6c65 2061 7420 7468 6973 2070 6f69  able at this poi
-00003460: 6e74 2e0a 2020 2020 2020 2020 4d75 7374  nt..        Must
-00003470: 2062 6520 6f76 6572 7269 6464 656e 2069   be overridden i
-00003480: 6e20 6368 696c 6420 6d65 7468 6f64 7320  n child methods 
-00003490: 6966 2072 6571 7569 7265 642e 0a20 2020  if required..   
-000034a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000034b0: 2070 6173 730a 0a20 2020 2064 6566 205f   pass..    def _
-000034c0: 6c6f 675f 6578 6368 616e 6765 5f72 6573  log_exchange_res
-000034d0: 706f 6e73 6528 7365 6c66 2c20 656e 6470  ponse(self, endp
-000034e0: 6f69 6e74 2c20 7265 7370 6f6e 7365 2920  oint, response) 
-000034f0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00003500: 2022 2222 204c 6f67 2065 7863 6861 6e67   """ Log exchang
-00003510: 6520 7265 7370 6f6e 7365 7320 2222 220a  e responses """.
-00003520: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00003530: 6c6f 675f 7265 7370 6f6e 7365 733a 0a20  log_responses:. 
-00003540: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00003550: 722e 696e 666f 2866 2241 5049 207b 656e  r.info(f"API {en
-00003560: 6470 6f69 6e74 7d3a 207b 7265 7370 6f6e  dpoint}: {respon
-00003570: 7365 7d22 290a 0a20 2020 2064 6566 206f  se}")..    def o
-00003580: 686c 6376 5f63 616e 646c 655f 6c69 6d69  hlcv_candle_limi
-00003590: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-000035a0: 656c 662c 2074 696d 6566 7261 6d65 3a20  elf, timeframe: 
-000035b0: 7374 722c 2063 616e 646c 655f 7479 7065  str, candle_type
-000035c0: 3a20 4361 6e64 6c65 5479 7065 2c20 7369  : CandleType, si
-000035d0: 6e63 655f 6d73 3a20 4f70 7469 6f6e 616c  nce_ms: Optional
-000035e0: 5b69 6e74 5d20 3d20 4e6f 6e65 2920 2d3e  [int] = None) ->
-000035f0: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
-00003600: 220a 2020 2020 2020 2020 4578 6368 616e  ".        Exchan
-00003610: 6765 206f 686c 6376 2063 616e 646c 6520  ge ohlcv candle 
-00003620: 6c69 6d69 740a 2020 2020 2020 2020 5573  limit.        Us
-00003630: 6573 206f 686c 6376 5f63 616e 646c 655f  es ohlcv_candle_
-00003640: 6c69 6d69 745f 7065 725f 7469 6d65 6672  limit_per_timefr
-00003650: 616d 6520 6966 2074 6865 2065 7863 6861  ame if the excha
-00003660: 6e67 6520 6861 7320 6469 6666 6572 656e  nge has differen
-00003670: 7420 6c69 6d69 7473 0a20 2020 2020 2020  t limits.       
-00003680: 2070 6572 2074 696d 6566 7261 6d65 2028   per timeframe (
-00003690: 652e 672e 2062 6974 7472 6578 292c 206f  e.g. bittrex), o
-000036a0: 7468 6572 7769 7365 2066 616c 6c73 2062  therwise falls b
-000036b0: 6163 6b20 746f 206f 686c 6376 5f63 616e  ack to ohlcv_can
-000036c0: 646c 655f 6c69 6d69 740a 2020 2020 2020  dle_limit.      
-000036d0: 2020 3a70 6172 616d 2074 696d 6566 7261    :param timefra
-000036e0: 6d65 3a20 5469 6d65 6672 616d 6520 746f  me: Timeframe to
-000036f0: 2063 6865 636b 0a20 2020 2020 2020 203a   check.        :
-00003700: 7061 7261 6d20 6361 6e64 6c65 5f74 7970  param candle_typ
-00003710: 653a 2043 616e 646c 652d 7479 7065 0a20  e: Candle-type. 
-00003720: 2020 2020 2020 203a 7061 7261 6d20 7369         :param si
-00003730: 6e63 655f 6d73 3a20 5374 6172 7469 6e67  nce_ms: Starting
-00003740: 2074 696d 6573 7461 6d70 0a20 2020 2020   timestamp.     
-00003750: 2020 203a 7265 7475 726e 3a20 4361 6e64     :return: Cand
-00003760: 6c65 206c 696d 6974 2061 7320 696e 7465  le limit as inte
-00003770: 6765 720a 2020 2020 2020 2020 2222 220a  ger.        """.
-00003780: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00003790: 6e74 2873 656c 662e 5f66 745f 6861 732e  nt(self._ft_has.
-000037a0: 6765 7428 276f 686c 6376 5f63 616e 646c  get('ohlcv_candl
-000037b0: 655f 6c69 6d69 745f 7065 725f 7469 6d65  e_limit_per_time
-000037c0: 6672 616d 6527 2c20 7b7d 292e 6765 7428  frame', {}).get(
-000037d0: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-000037e0: 6566 7261 6d65 2c20 7365 6c66 2e5f 6674  eframe, self._ft
-000037f0: 5f68 6173 2e67 6574 2827 6f68 6c63 765f  _has.get('ohlcv_
-00003800: 6361 6e64 6c65 5f6c 696d 6974 2729 2929  candle_limit')))
-00003810: 0a0a 2020 2020 6465 6620 6765 745f 6d61  ..    def get_ma
-00003820: 726b 6574 7328 7365 6c66 2c20 6261 7365  rkets(self, base
-00003830: 5f63 7572 7265 6e63 6965 733a 204c 6973  _currencies: Lis
-00003840: 745b 7374 725d 203d 205b 5d2c 2071 756f  t[str] = [], quo
-00003850: 7465 5f63 7572 7265 6e63 6965 733a 204c  te_currencies: L
-00003860: 6973 745b 7374 725d 203d 205b 5d2c 0a20  ist[str] = [],. 
-00003870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003880: 2020 2073 706f 745f 6f6e 6c79 3a20 626f     spot_only: bo
-00003890: 6f6c 203d 2046 616c 7365 2c20 6d61 7267  ol = False, marg
-000038a0: 696e 5f6f 6e6c 793a 2062 6f6f 6c20 3d20  in_only: bool = 
-000038b0: 4661 6c73 652c 2066 7574 7572 6573 5f6f  False, futures_o
-000038c0: 6e6c 793a 2062 6f6f 6c20 3d20 4661 6c73  nly: bool = Fals
-000038d0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000038e0: 2020 2020 2020 2074 7261 6461 626c 655f         tradable_
-000038f0: 6f6e 6c79 3a20 626f 6f6c 203d 2054 7275  only: bool = Tru
-00003900: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00003910: 2020 2020 2020 2061 6374 6976 655f 6f6e         active_on
-00003920: 6c79 3a20 626f 6f6c 203d 2046 616c 7365  ly: bool = False
-00003930: 2920 2d3e 2044 6963 745b 7374 722c 2041  ) -> Dict[str, A
-00003940: 6e79 5d3a 0a20 2020 2020 2020 2022 2222  ny]:.        """
-00003950: 0a20 2020 2020 2020 2052 6574 7572 6e20  .        Return 
-00003960: 6578 6368 616e 6765 2063 6378 7420 6d61  exchange ccxt ma
-00003970: 726b 6574 732c 2066 696c 7465 7265 6420  rkets, filtered 
-00003980: 6f75 7420 6279 2062 6173 6520 6375 7272  out by base curr
-00003990: 656e 6379 2061 6e64 2071 756f 7465 2063  ency and quote c
-000039a0: 7572 7265 6e63 790a 2020 2020 2020 2020  urrency.        
-000039b0: 6966 2074 6869 7320 7761 7320 7265 7175  if this was requ
-000039c0: 6573 7465 6420 696e 2070 6172 616d 6574  ested in paramet
-000039d0: 6572 732e 0a20 2020 2020 2020 2022 2222  ers..        """
-000039e0: 0a20 2020 2020 2020 206d 6172 6b65 7473  .        markets
-000039f0: 203d 2073 656c 662e 6d61 726b 6574 730a   = self.markets.
-00003a00: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
-00003a10: 6172 6b65 7473 3a0a 2020 2020 2020 2020  arkets:.        
-00003a20: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-00003a30: 696f 6e61 6c45 7863 6570 7469 6f6e 2822  ionalException("
-00003a40: 4d61 726b 6574 7320 7765 7265 206e 6f74  Markets were not
-00003a50: 206c 6f61 6465 642e 2229 0a0a 2020 2020   loaded.")..    
-00003a60: 2020 2020 6966 2062 6173 655f 6375 7272      if base_curr
-00003a70: 656e 6369 6573 3a0a 2020 2020 2020 2020  encies:.        
-00003a80: 2020 2020 6d61 726b 6574 7320 3d20 7b6b      markets = {k
-00003a90: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
-00003aa0: 6d61 726b 6574 732e 6974 656d 7328 2920  markets.items() 
-00003ab0: 6966 2076 5b27 6261 7365 275d 2069 6e20  if v['base'] in 
-00003ac0: 6261 7365 5f63 7572 7265 6e63 6965 737d  base_currencies}
-00003ad0: 0a20 2020 2020 2020 2069 6620 7175 6f74  .        if quot
-00003ae0: 655f 6375 7272 656e 6369 6573 3a0a 2020  e_currencies:.  
-00003af0: 2020 2020 2020 2020 2020 6d61 726b 6574            market
-00003b00: 7320 3d20 7b6b 3a20 7620 666f 7220 6b2c  s = {k: v for k,
-00003b10: 2076 2069 6e20 6d61 726b 6574 732e 6974   v in markets.it
-00003b20: 656d 7328 2920 6966 2076 5b27 7175 6f74  ems() if v['quot
-00003b30: 6527 5d20 696e 2071 756f 7465 5f63 7572  e'] in quote_cur
-00003b40: 7265 6e63 6965 737d 0a20 2020 2020 2020  rencies}.       
-00003b50: 2069 6620 7472 6164 6162 6c65 5f6f 6e6c   if tradable_onl
-00003b60: 793a 0a20 2020 2020 2020 2020 2020 206d  y:.            m
+000007c0: 2020 2020 2020 2020 2020 2020 2074 696d               tim
+000007d0: 6566 7261 6d65 5f74 6f5f 6e65 7874 5f64  eframe_to_next_d
+000007e0: 6174 652c 2074 696d 6566 7261 6d65 5f74  ate, timeframe_t
+000007f0: 6f5f 7072 6576 5f64 6174 652c 0a20 2020  o_prev_date,.   
+00000800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000820: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+00000830: 6672 616d 655f 746f 5f73 6563 6f6e 6473  frame_to_seconds
+00000840: 290a 6672 6f6d 2066 7265 7174 7261 6465  ).from freqtrade
+00000850: 2e65 7863 6861 6e67 652e 7479 7065 7320  .exchange.types 
+00000860: 696d 706f 7274 204f 484c 4356 5265 7370  import OHLCVResp
+00000870: 6f6e 7365 2c20 4f72 6465 7242 6f6f 6b2c  onse, OrderBook,
+00000880: 2054 6963 6b65 722c 2054 6963 6b65 7273   Ticker, Tickers
+00000890: 0a66 726f 6d20 6672 6571 7472 6164 652e  .from freqtrade.
+000008a0: 6d69 7363 2069 6d70 6f72 7420 2863 6875  misc import (chu
+000008b0: 6e6b 732c 2064 6565 705f 6d65 7267 655f  nks, deep_merge_
+000008c0: 6469 6374 732c 2066 696c 655f 6475 6d70  dicts, file_dump
+000008d0: 5f6a 736f 6e2c 2066 696c 655f 6c6f 6164  _json, file_load
+000008e0: 5f6a 736f 6e2c 0a20 2020 2020 2020 2020  _json,.         
+000008f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000900: 2020 2073 6166 655f 7661 6c75 655f 6661     safe_value_fa
+00000910: 6c6c 6261 636b 3229 0a66 726f 6d20 6672  llback2).from fr
+00000920: 6571 7472 6164 652e 706c 7567 696e 732e  eqtrade.plugins.
+00000930: 7061 6972 6c69 7374 2e70 6169 726c 6973  pairlist.pairlis
+00000940: 745f 6865 6c70 6572 7320 696d 706f 7274  t_helpers import
+00000950: 2065 7870 616e 645f 7061 6972 6c69 7374   expand_pairlist
+00000960: 0a0a 0a6c 6f67 6765 7220 3d20 6c6f 6767  ...logger = logg
+00000970: 696e 672e 6765 744c 6f67 6765 7228 5f5f  ing.getLogger(__
+00000980: 6e61 6d65 5f5f 290a 0a0a 636c 6173 7320  name__)...class 
+00000990: 4578 6368 616e 6765 3a0a 0a20 2020 2023  Exchange:..    #
+000009a0: 2050 6172 616d 6574 6572 7320 746f 2061   Parameters to a
+000009b0: 6464 2064 6972 6563 746c 7920 746f 2062  dd directly to b
+000009c0: 7579 2f73 656c 6c20 6361 6c6c 7320 286c  uy/sell calls (l
+000009d0: 696b 6520 6167 7265 6569 6e67 2074 6f20  ike agreeing to 
+000009e0: 7472 6164 696e 6720 6167 7265 656d 656e  trading agreemen
+000009f0: 7429 0a20 2020 205f 7061 7261 6d73 3a20  t).    _params: 
+00000a00: 4469 6374 203d 207b 7d0a 0a20 2020 2023  Dict = {}..    #
+00000a10: 2041 6464 6974 696f 6e61 6c20 7061 7261   Additional para
+00000a20: 6d65 7465 7273 202d 2061 6464 6564 2074  meters - added t
+00000a30: 6f20 7468 6520 6363 7874 206f 626a 6563  o the ccxt objec
+00000a40: 740a 2020 2020 5f63 6378 745f 7061 7261  t.    _ccxt_para
+00000a50: 6d73 3a20 4469 6374 203d 207b 7d0a 0a20  ms: Dict = {}.. 
+00000a60: 2020 2023 2044 6963 7420 746f 2073 7065     # Dict to spe
+00000a70: 6369 6679 2077 6869 6368 206f 7074 696f  cify which optio
+00000a80: 6e73 2065 6163 6820 6578 6368 616e 6765  ns each exchange
+00000a90: 2069 6d70 6c65 6d65 6e74 730a 2020 2020   implements.    
+00000aa0: 2320 5468 6973 2064 6566 696e 6573 2064  # This defines d
+00000ab0: 6566 6175 6c74 732c 2077 6869 6368 2063  efaults, which c
+00000ac0: 616e 2062 6520 7365 6c65 6374 6976 656c  an be selectivel
+00000ad0: 7920 6f76 6572 7269 6464 656e 2062 7920  y overridden by 
+00000ae0: 7375 6263 6c61 7373 6573 2075 7369 6e67  subclasses using
+00000af0: 205f 6674 5f68 6173 0a20 2020 2023 206f   _ft_has.    # o
+00000b00: 7220 6279 2073 7065 6369 6679 696e 6720  r by specifying 
+00000b10: 7468 656d 2069 6e20 7468 6520 636f 6e66  them in the conf
+00000b20: 6967 7572 6174 696f 6e2e 0a20 2020 205f  iguration..    _
+00000b30: 6674 5f68 6173 5f64 6566 6175 6c74 3a20  ft_has_default: 
+00000b40: 4469 6374 203d 207b 0a20 2020 2020 2020  Dict = {.       
+00000b50: 2022 7374 6f70 6c6f 7373 5f6f 6e5f 6578   "stoploss_on_ex
+00000b60: 6368 616e 6765 223a 2046 616c 7365 2c0a  change": False,.
+00000b70: 2020 2020 2020 2020 2273 746f 705f 7072          "stop_pr
+00000b80: 6963 655f 7061 7261 6d22 3a20 2273 746f  ice_param": "sto
+00000b90: 7050 7269 6365 222c 0a20 2020 2020 2020  pPrice",.       
+00000ba0: 2022 6f72 6465 725f 7469 6d65 5f69 6e5f   "order_time_in_
+00000bb0: 666f 7263 6522 3a20 5b22 4754 4322 5d2c  force": ["GTC"],
+00000bc0: 0a20 2020 2020 2020 2022 6f68 6c63 765f  .        "ohlcv_
+00000bd0: 7061 7261 6d73 223a 207b 7d2c 0a20 2020  params": {},.   
+00000be0: 2020 2020 2022 6f68 6c63 765f 6361 6e64       "ohlcv_cand
+00000bf0: 6c65 5f6c 696d 6974 223a 2035 3030 2c0a  le_limit": 500,.
+00000c00: 2020 2020 2020 2020 226f 686c 6376 5f68          "ohlcv_h
+00000c10: 6173 5f68 6973 746f 7279 223a 2054 7275  as_history": Tru
+00000c20: 652c 2020 2320 536f 6d65 2065 7863 6861  e,  # Some excha
+00000c30: 6e67 6573 2028 4b72 616b 656e 2920 646f  nges (Kraken) do
+00000c40: 6e27 7420 7072 6f76 6964 6520 6869 7374  n't provide hist
+00000c50: 6f72 7920 7669 6120 6f68 6c63 760a 2020  ory via ohlcv.  
+00000c60: 2020 2020 2020 226f 686c 6376 5f70 6172        "ohlcv_par
+00000c70: 7469 616c 5f63 616e 646c 6522 3a20 5472  tial_candle": Tr
+00000c80: 7565 2c0a 2020 2020 2020 2020 226f 686c  ue,.        "ohl
+00000c90: 6376 5f72 6571 7569 7265 5f73 696e 6365  cv_require_since
+00000ca0: 223a 2046 616c 7365 2c0a 2020 2020 2020  ": False,.      
+00000cb0: 2020 2320 4368 6563 6b20 6874 7470 733a    # Check https:
+00000cc0: 2f2f 6769 7468 7562 2e63 6f6d 2f63 6378  //github.com/ccx
+00000cd0: 742f 6363 7874 2f69 7373 7565 732f 3130  t/ccxt/issues/10
+00000ce0: 3736 3720 666f 7220 7265 6d6f 7661 6c20  767 for removal 
+00000cf0: 6f66 206f 686c 6376 5f76 6f6c 756d 655f  of ohlcv_volume_
+00000d00: 6375 7272 656e 6379 0a20 2020 2020 2020  currency.       
+00000d10: 2022 6f68 6c63 765f 766f 6c75 6d65 5f63   "ohlcv_volume_c
+00000d20: 7572 7265 6e63 7922 3a20 2262 6173 6522  urrency": "base"
+00000d30: 2c20 2023 2022 6261 7365 2220 6f72 2022  ,  # "base" or "
+00000d40: 7175 6f74 6522 0a20 2020 2020 2020 2022  quote".        "
+00000d50: 7469 636b 6572 735f 6861 7665 5f71 756f  tickers_have_quo
+00000d60: 7465 566f 6c75 6d65 223a 2054 7275 652c  teVolume": True,
+00000d70: 0a20 2020 2020 2020 2022 7469 636b 6572  .        "ticker
+00000d80: 735f 6861 7665 5f62 6964 5f61 736b 223a  s_have_bid_ask":
+00000d90: 2054 7275 652c 2020 2320 6269 6420 2f20   True,  # bid / 
+00000da0: 6173 6b20 656d 7074 7920 666f 7220 6665  ask empty for fe
+00000db0: 7463 685f 7469 636b 6572 730a 2020 2020  tch_tickers.    
+00000dc0: 2020 2020 2274 6963 6b65 7273 5f68 6176      "tickers_hav
+00000dd0: 655f 7072 6963 6522 3a20 5472 7565 2c0a  e_price": True,.
+00000de0: 2020 2020 2020 2020 2274 7261 6465 735f          "trades_
+00000df0: 7061 6769 6e61 7469 6f6e 223a 2022 7469  pagination": "ti
+00000e00: 6d65 222c 2020 2320 506f 7373 6962 6c65  me",  # Possible
+00000e10: 2061 7265 2022 7469 6d65 2220 6f72 2022   are "time" or "
+00000e20: 6964 220a 2020 2020 2020 2020 2274 7261  id".        "tra
+00000e30: 6465 735f 7061 6769 6e61 7469 6f6e 5f61  des_pagination_a
+00000e40: 7267 223a 2022 7369 6e63 6522 2c0a 2020  rg": "since",.  
+00000e50: 2020 2020 2020 226c 325f 6c69 6d69 745f        "l2_limit_
+00000e60: 7261 6e67 6522 3a20 4e6f 6e65 2c0a 2020  range": None,.  
+00000e70: 2020 2020 2020 226c 325f 6c69 6d69 745f        "l2_limit_
+00000e80: 7261 6e67 655f 7265 7175 6972 6564 223a  range_required":
+00000e90: 2054 7275 652c 2020 2320 416c 6c6f 7720   True,  # Allow 
+00000ea0: 456d 7074 7920 4c32 206c 696d 6974 2028  Empty L2 limit (
+00000eb0: 6b75 636f 696e 290a 2020 2020 2020 2020  kucoin).        
+00000ec0: 226d 6172 6b5f 6f68 6c63 765f 7072 6963  "mark_ohlcv_pric
+00000ed0: 6522 3a20 226d 6172 6b22 2c0a 2020 2020  e": "mark",.    
+00000ee0: 2020 2020 226d 6172 6b5f 6f68 6c63 765f      "mark_ohlcv_
+00000ef0: 7469 6d65 6672 616d 6522 3a20 2238 6822  timeframe": "8h"
+00000f00: 2c0a 2020 2020 2020 2020 2263 6378 745f  ,.        "ccxt_
+00000f10: 6675 7475 7265 735f 6e61 6d65 223a 2022  futures_name": "
+00000f20: 7377 6170 222c 0a20 2020 2020 2020 2022  swap",.        "
+00000f30: 6665 655f 636f 7374 5f69 6e5f 636f 6e74  fee_cost_in_cont
+00000f40: 7261 6374 7322 3a20 4661 6c73 652c 2020  racts": False,  
+00000f50: 2320 4665 6520 636f 7374 206e 6565 6473  # Fee cost needs
+00000f60: 2063 6f6e 7472 6163 7420 636f 6e76 6572   contract conver
+00000f70: 7369 6f6e 0a20 2020 2020 2020 2022 6e65  sion.        "ne
+00000f80: 6564 735f 7472 6164 696e 675f 6665 6573  eds_trading_fees
+00000f90: 223a 2046 616c 7365 2c20 2023 2075 7365  ": False,  # use
+00000fa0: 2066 6574 6368 5f74 7261 6469 6e67 5f66   fetch_trading_f
+00000fb0: 6565 7320 746f 2063 6163 6865 2066 6565  ees to cache fee
+00000fc0: 730a 2020 2020 2020 2020 226f 7264 6572  s.        "order
+00000fd0: 5f70 726f 7073 5f69 6e5f 636f 6e74 7261  _props_in_contra
+00000fe0: 6374 7322 3a20 5b27 616d 6f75 6e74 272c  cts": ['amount',
+00000ff0: 2027 636f 7374 272c 2027 6669 6c6c 6564   'cost', 'filled
+00001000: 272c 2027 7265 6d61 696e 696e 6727 5d2c  ', 'remaining'],
+00001010: 0a20 2020 2020 2020 2023 204f 7665 7272  .        # Overr
+00001020: 6964 6520 6372 6561 7465 4d61 726b 6574  ide createMarket
+00001030: 4275 794f 7264 6572 5265 7175 6972 6573  BuyOrderRequires
+00001040: 5072 6963 6520 7768 6572 6520 6363 7874  Price where ccxt
+00001050: 2068 6173 2069 7420 7772 6f6e 670a 2020   has it wrong.  
+00001060: 2020 2020 2020 226d 6172 6b65 744f 7264        "marketOrd
+00001070: 6572 5265 7175 6972 6573 5072 6963 6522  erRequiresPrice"
+00001080: 3a20 4661 6c73 652c 0a20 2020 207d 0a20  : False,.    }. 
+00001090: 2020 205f 6674 5f68 6173 3a20 4469 6374     _ft_has: Dict
+000010a0: 203d 207b 7d0a 2020 2020 5f66 745f 6861   = {}.    _ft_ha
+000010b0: 735f 6675 7475 7265 733a 2044 6963 7420  s_futures: Dict 
+000010c0: 3d20 7b7d 0a0a 2020 2020 5f73 7570 706f  = {}..    _suppo
+000010d0: 7274 6564 5f74 7261 6469 6e67 5f6d 6f64  rted_trading_mod
+000010e0: 655f 6d61 7267 696e 5f70 6169 7273 3a20  e_margin_pairs: 
+000010f0: 4c69 7374 5b54 7570 6c65 5b54 7261 6469  List[Tuple[Tradi
+00001100: 6e67 4d6f 6465 2c20 4d61 7267 696e 4d6f  ngMode, MarginMo
+00001110: 6465 5d5d 203d 205b 0a20 2020 2020 2020  de]] = [.       
+00001120: 2023 2054 7261 6469 6e67 4d6f 6465 2e53   # TradingMode.S
+00001130: 504f 5420 616c 7761 7973 2073 7570 706f  POT always suppo
+00001140: 7274 6564 2061 6e64 206e 6f74 2072 6571  rted and not req
+00001150: 7569 7265 6420 696e 2074 6869 7320 6c69  uired in this li
+00001160: 7374 0a20 2020 205d 0a0a 2020 2020 6465  st.    ]..    de
+00001170: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00001180: 2063 6f6e 6669 673a 2043 6f6e 6669 672c   config: Config,
+00001190: 2076 616c 6964 6174 653a 2062 6f6f 6c20   validate: bool 
+000011a0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+000011b0: 2020 2020 2020 2020 206c 6f61 645f 6c65           load_le
+000011c0: 7665 7261 6765 5f74 6965 7273 3a20 626f  verage_tiers: bo
+000011d0: 6f6c 203d 2046 616c 7365 2920 2d3e 204e  ol = False) -> N
+000011e0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+000011f0: 0a20 2020 2020 2020 2049 6e69 7469 616c  .        Initial
+00001200: 697a 6573 2074 6869 7320 6d6f 6475 6c65  izes this module
+00001210: 2077 6974 6820 7468 6520 6769 7665 6e20   with the given 
+00001220: 636f 6e66 6967 2c0a 2020 2020 2020 2020  config,.        
+00001230: 6974 2064 6f65 7320 6261 7369 6320 7661  it does basic va
+00001240: 6c69 6461 7469 6f6e 2077 6865 7468 6572  lidation whether
+00001250: 2074 6865 2073 7065 6369 6669 6564 2065   the specified e
+00001260: 7863 6861 6e67 6520 616e 6420 7061 6972  xchange and pair
+00001270: 7320 6172 6520 7661 6c69 642e 0a20 2020  s are valid..   
+00001280: 2020 2020 203a 7265 7475 726e 3a20 4e6f       :return: No
+00001290: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
+000012a0: 2020 2020 2020 2073 656c 662e 5f61 7069         self._api
+000012b0: 3a20 6363 7874 2e45 7863 6861 6e67 650a  : ccxt.Exchange.
+000012c0: 2020 2020 2020 2020 7365 6c66 2e5f 6170          self._ap
+000012d0: 695f 6173 796e 633a 2063 6378 745f 6173  i_async: ccxt_as
+000012e0: 796e 632e 4578 6368 616e 6765 203d 204e  ync.Exchange = N
+000012f0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
+00001300: 2e5f 6d61 726b 6574 733a 2044 6963 7420  ._markets: Dict 
+00001310: 3d20 7b7d 0a20 2020 2020 2020 2073 656c  = {}.        sel
+00001320: 662e 5f74 7261 6469 6e67 5f66 6565 733a  f._trading_fees:
+00001330: 2044 6963 745b 7374 722c 2041 6e79 5d20   Dict[str, Any] 
+00001340: 3d20 7b7d 0a20 2020 2020 2020 2073 656c  = {}.        sel
+00001350: 662e 5f6c 6576 6572 6167 655f 7469 6572  f._leverage_tier
+00001360: 733a 2044 6963 745b 7374 722c 204c 6973  s: Dict[str, Lis
+00001370: 745b 4469 6374 5d5d 203d 207b 7d0a 2020  t[Dict]] = {}.  
+00001380: 2020 2020 2020 2320 4c6f 636b 2065 7665        # Lock eve
+00001390: 6e74 206c 6f6f 702e 2054 6869 7320 6973  nt loop. This is
+000013a0: 206e 6563 6573 7361 7279 2074 6f20 6176   necessary to av
+000013b0: 6f69 6420 7261 6365 2d63 6f6e 6469 7469  oid race-conditi
+000013c0: 6f6e 7320 7768 656e 2075 7369 6e67 2066  ons when using f
+000013d0: 6f72 6365 2a20 636f 6d6d 616e 6473 0a20  orce* commands. 
+000013e0: 2020 2020 2020 2023 2044 7565 2074 6f20         # Due to 
+000013f0: 6675 6e64 696e 6720 6665 6520 6665 7463  funding fee fetc
+00001400: 6869 6e67 2e0a 2020 2020 2020 2020 7365  hing..        se
+00001410: 6c66 2e5f 6c6f 6f70 5f6c 6f63 6b20 3d20  lf._loop_lock = 
+00001420: 4c6f 636b 2829 0a20 2020 2020 2020 2073  Lock().        s
+00001430: 656c 662e 6c6f 6f70 203d 2061 7379 6e63  elf.loop = async
+00001440: 696f 2e6e 6577 5f65 7665 6e74 5f6c 6f6f  io.new_event_loo
+00001450: 7028 290a 2020 2020 2020 2020 6173 796e  p().        asyn
+00001460: 6369 6f2e 7365 745f 6576 656e 745f 6c6f  cio.set_event_lo
+00001470: 6f70 2873 656c 662e 6c6f 6f70 290a 2020  op(self.loop).  
+00001480: 2020 2020 2020 7365 6c66 2e5f 636f 6e66        self._conf
+00001490: 6967 3a20 436f 6e66 6967 203d 207b 7d0a  ig: Config = {}.
+000014a0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+000014b0: 6f6e 6669 672e 7570 6461 7465 2863 6f6e  onfig.update(con
+000014c0: 6669 6729 0a0a 2020 2020 2020 2020 2320  fig)..        # 
+000014d0: 486f 6c64 7320 6c61 7374 2063 616e 646c  Holds last candl
+000014e0: 6520 7265 6672 6573 6865 6420 7469 6d65  e refreshed time
+000014f0: 206f 6620 6561 6368 2070 6169 720a 2020   of each pair.  
+00001500: 2020 2020 2020 7365 6c66 2e5f 7061 6972        self._pair
+00001510: 735f 6c61 7374 5f72 6566 7265 7368 5f74  s_last_refresh_t
+00001520: 696d 653a 2044 6963 745b 5061 6972 5769  ime: Dict[PairWi
+00001530: 7468 5469 6d65 6672 616d 652c 2069 6e74  thTimeframe, int
+00001540: 5d20 3d20 7b7d 0a20 2020 2020 2020 2023  ] = {}.        #
+00001550: 2054 696d 6573 7461 6d70 206f 6620 6c61   Timestamp of la
+00001560: 7374 206d 6172 6b65 7473 2072 6566 7265  st markets refre
+00001570: 7368 0a20 2020 2020 2020 2073 656c 662e  sh.        self.
+00001580: 5f6c 6173 745f 6d61 726b 6574 735f 7265  _last_markets_re
+00001590: 6672 6573 683a 2069 6e74 203d 2030 0a0a  fresh: int = 0..
+000015a0: 2020 2020 2020 2020 2320 4361 6368 6520          # Cache 
+000015b0: 666f 7220 3130 206d 696e 7574 6573 202e  for 10 minutes .
+000015c0: 2e2e 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000015d0: 5f63 6163 6865 5f6c 6f63 6b20 3d20 4c6f  _cache_lock = Lo
+000015e0: 636b 2829 0a20 2020 2020 2020 2073 656c  ck().        sel
+000015f0: 662e 5f66 6574 6368 5f74 6963 6b65 7273  f._fetch_tickers
+00001600: 5f63 6163 6865 3a20 5454 4c43 6163 6865  _cache: TTLCache
+00001610: 203d 2054 544c 4361 6368 6528 6d61 7873   = TTLCache(maxs
+00001620: 697a 653d 322c 2074 746c 3d36 3020 2a20  ize=2, ttl=60 * 
+00001630: 3130 290a 2020 2020 2020 2020 2320 4361  10).        # Ca
+00001640: 6368 6520 7661 6c75 6573 2066 6f72 2031  che values for 1
+00001650: 3830 3020 746f 2061 766f 6964 2066 7265  800 to avoid fre
+00001660: 7175 656e 7420 706f 6c6c 696e 6720 6f66  quent polling of
+00001670: 2074 6865 2065 7863 6861 6e67 6520 666f   the exchange fo
+00001680: 7220 7072 6963 6573 0a20 2020 2020 2020  r prices.       
+00001690: 2023 2043 6163 6869 6e67 206f 6e6c 7920   # Caching only 
+000016a0: 6170 706c 6965 7320 746f 2052 5043 206d  applies to RPC m
+000016b0: 6574 686f 6473 2c20 736f 2070 7269 6365  ethods, so price
+000016c0: 7320 666f 7220 6f70 656e 2074 7261 6465  s for open trade
+000016d0: 7320 6172 6520 7374 696c 6c0a 2020 2020  s are still.    
+000016e0: 2020 2020 2320 7265 6672 6573 6865 6420      # refreshed 
+000016f0: 6f6e 6365 2065 7665 7279 2069 7465 7261  once every itera
+00001700: 7469 6f6e 2e0a 2020 2020 2020 2020 7365  tion..        se
+00001710: 6c66 2e5f 6578 6974 5f72 6174 655f 6361  lf._exit_rate_ca
+00001720: 6368 653a 2054 544c 4361 6368 6520 3d20  che: TTLCache = 
+00001730: 5454 4c43 6163 6865 286d 6178 7369 7a65  TTLCache(maxsize
+00001740: 3d31 3030 2c20 7474 6c3d 3138 3030 290a  =100, ttl=1800).
+00001750: 2020 2020 2020 2020 7365 6c66 2e5f 656e          self._en
+00001760: 7472 795f 7261 7465 5f63 6163 6865 3a20  try_rate_cache: 
+00001770: 5454 4c43 6163 6865 203d 2054 544c 4361  TTLCache = TTLCa
+00001780: 6368 6528 6d61 7873 697a 653d 3130 302c  che(maxsize=100,
+00001790: 2074 746c 3d31 3830 3029 0a0a 2020 2020   ttl=1800)..    
+000017a0: 2020 2020 2320 486f 6c64 7320 6361 6e64      # Holds cand
+000017b0: 6c65 730a 2020 2020 2020 2020 7365 6c66  les.        self
+000017c0: 2e5f 6b6c 696e 6573 3a20 4469 6374 5b50  ._klines: Dict[P
+000017d0: 6169 7257 6974 6854 696d 6566 7261 6d65  airWithTimeframe
+000017e0: 2c20 4461 7461 4672 616d 655d 203d 207b  , DataFrame] = {
+000017f0: 7d0a 0a20 2020 2020 2020 2023 2048 6f6c  }..        # Hol
+00001800: 6473 2061 6c6c 206f 7065 6e20 7365 6c6c  ds all open sell
+00001810: 206f 7264 6572 7320 666f 7220 6472 795f   orders for dry_
+00001820: 7275 6e0a 2020 2020 2020 2020 7365 6c66  run.        self
+00001830: 2e5f 6472 795f 7275 6e5f 6f70 656e 5f6f  ._dry_run_open_o
+00001840: 7264 6572 733a 2044 6963 745b 7374 722c  rders: Dict[str,
+00001850: 2041 6e79 5d20 3d20 7b7d 0a20 2020 2020   Any] = {}.     
+00001860: 2020 2072 656d 6f76 655f 6372 6564 656e     remove_creden
+00001870: 7469 616c 7328 636f 6e66 6967 290a 0a20  tials(config).. 
+00001880: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
+00001890: 5b27 6472 795f 7275 6e27 5d3a 0a20 2020  ['dry_run']:.   
+000018a0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+000018b0: 696e 666f 2827 496e 7374 616e 6365 2069  info('Instance i
+000018c0: 7320 7275 6e6e 696e 6720 7769 7468 2064  s running with d
+000018d0: 7279 5f72 756e 2065 6e61 626c 6564 2729  ry_run enabled')
+000018e0: 0a20 2020 2020 2020 206c 6f67 6765 722e  .        logger.
+000018f0: 696e 666f 2866 2255 7369 6e67 2043 4358  info(f"Using CCX
+00001900: 5420 7b63 6378 742e 5f5f 7665 7273 696f  T {ccxt.__versio
+00001910: 6e5f 5f7d 2229 0a20 2020 2020 2020 2065  n__}").        e
+00001920: 7863 6861 6e67 655f 636f 6e66 6967 203d  xchange_config =
+00001930: 2063 6f6e 6669 675b 2765 7863 6861 6e67   config['exchang
+00001940: 6527 5d0a 2020 2020 2020 2020 7365 6c66  e'].        self
+00001950: 2e6c 6f67 5f72 6573 706f 6e73 6573 203d  .log_responses =
+00001960: 2065 7863 6861 6e67 655f 636f 6e66 6967   exchange_config
+00001970: 2e67 6574 2827 6c6f 675f 7265 7370 6f6e  .get('log_respon
+00001980: 7365 7327 2c20 4661 6c73 6529 0a0a 2020  ses', False)..  
+00001990: 2020 2020 2020 2320 4c65 7665 7261 6765        # Leverage
+000019a0: 2070 726f 7065 7274 6965 730a 2020 2020   properties.    
+000019b0: 2020 2020 7365 6c66 2e74 7261 6469 6e67      self.trading
+000019c0: 5f6d 6f64 653a 2054 7261 6469 6e67 4d6f  _mode: TradingMo
+000019d0: 6465 203d 2063 6f6e 6669 672e 6765 7428  de = config.get(
+000019e0: 2774 7261 6469 6e67 5f6d 6f64 6527 2c20  'trading_mode', 
+000019f0: 5472 6164 696e 674d 6f64 652e 5350 4f54  TradingMode.SPOT
+00001a00: 290a 2020 2020 2020 2020 7365 6c66 2e6d  ).        self.m
+00001a10: 6172 6769 6e5f 6d6f 6465 3a20 4d61 7267  argin_mode: Marg
+00001a20: 696e 4d6f 6465 203d 2028 0a20 2020 2020  inMode = (.     
+00001a30: 2020 2020 2020 204d 6172 6769 6e4d 6f64         MarginMod
+00001a40: 6528 636f 6e66 6967 2e67 6574 2827 6d61  e(config.get('ma
+00001a50: 7267 696e 5f6d 6f64 6527 2929 0a20 2020  rgin_mode')).   
+00001a60: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
+00001a70: 6967 2e67 6574 2827 6d61 7267 696e 5f6d  ig.get('margin_m
+00001a80: 6f64 6527 290a 2020 2020 2020 2020 2020  ode').          
+00001a90: 2020 656c 7365 204d 6172 6769 6e4d 6f64    else MarginMod
+00001aa0: 652e 4e4f 4e45 0a20 2020 2020 2020 2029  e.NONE.        )
+00001ab0: 0a20 2020 2020 2020 2073 656c 662e 6c69  .        self.li
+00001ac0: 7175 6964 6174 696f 6e5f 6275 6666 6572  quidation_buffer
+00001ad0: 203d 2063 6f6e 6669 672e 6765 7428 276c   = config.get('l
+00001ae0: 6971 7569 6461 7469 6f6e 5f62 7566 6665  iquidation_buffe
+00001af0: 7227 2c20 302e 3035 290a 0a20 2020 2020  r', 0.05)..     
+00001b00: 2020 2023 2044 6565 7020 6d65 7267 6520     # Deep merge 
+00001b10: 6674 5f68 6173 2077 6974 6820 6465 6661  ft_has with defa
+00001b20: 756c 7420 6674 5f68 6173 206f 7074 696f  ult ft_has optio
+00001b30: 6e73 0a20 2020 2020 2020 2073 656c 662e  ns.        self.
+00001b40: 5f66 745f 6861 7320 3d20 6465 6570 5f6d  _ft_has = deep_m
+00001b50: 6572 6765 5f64 6963 7473 2873 656c 662e  erge_dicts(self.
+00001b60: 5f66 745f 6861 732c 2064 6565 7063 6f70  _ft_has, deepcop
+00001b70: 7928 7365 6c66 2e5f 6674 5f68 6173 5f64  y(self._ft_has_d
+00001b80: 6566 6175 6c74 2929 0a20 2020 2020 2020  efault)).       
+00001b90: 2069 6620 7365 6c66 2e74 7261 6469 6e67   if self.trading
+00001ba0: 5f6d 6f64 6520 3d3d 2054 7261 6469 6e67  _mode == Trading
+00001bb0: 4d6f 6465 2e46 5554 5552 4553 3a0a 2020  Mode.FUTURES:.  
+00001bc0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00001bd0: 6674 5f68 6173 203d 2064 6565 705f 6d65  ft_has = deep_me
+00001be0: 7267 655f 6469 6374 7328 7365 6c66 2e5f  rge_dicts(self._
+00001bf0: 6674 5f68 6173 5f66 7574 7572 6573 2c20  ft_has_futures, 
+00001c00: 7365 6c66 2e5f 6674 5f68 6173 290a 2020  self._ft_has).  
+00001c10: 2020 2020 2020 6966 2065 7863 6861 6e67        if exchang
+00001c20: 655f 636f 6e66 6967 2e67 6574 2827 5f66  e_config.get('_f
+00001c30: 745f 6861 735f 7061 7261 6d73 2729 3a0a  t_has_params'):.
+00001c40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00001c50: 2e5f 6674 5f68 6173 203d 2064 6565 705f  ._ft_has = deep_
+00001c60: 6d65 7267 655f 6469 6374 7328 6578 6368  merge_dicts(exch
+00001c70: 616e 6765 5f63 6f6e 6669 672e 6765 7428  ange_config.get(
+00001c80: 275f 6674 5f68 6173 5f70 6172 616d 7327  '_ft_has_params'
+00001c90: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00001ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001cb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00001cc0: 656c 662e 5f66 745f 6861 7329 0a20 2020  elf._ft_has).   
+00001cd0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00001ce0: 696e 666f 2822 4f76 6572 7269 6469 6e67  info("Overriding
+00001cf0: 2065 7863 6861 6e67 652e 5f66 745f 6861   exchange._ft_ha
+00001d00: 7320 7769 7468 2063 6f6e 6669 6720 7061  s with config pa
+00001d10: 7261 6d73 2c20 7265 7375 6c74 3a20 2573  rams, result: %s
+00001d20: 222c 2073 656c 662e 5f66 745f 6861 7329  ", self._ft_has)
+00001d30: 0a0a 2020 2020 2020 2020 2320 4173 7369  ..        # Assi
+00001d40: 676e 2074 6869 7320 6469 7265 6374 6c79  gn this directly
+00001d50: 2066 6f72 2065 6173 7920 6163 6365 7373   for easy access
+00001d60: 0a20 2020 2020 2020 2073 656c 662e 5f6f  .        self._o
+00001d70: 686c 6376 5f70 6172 7469 616c 5f63 616e  hlcv_partial_can
+00001d80: 646c 6520 3d20 7365 6c66 2e5f 6674 5f68  dle = self._ft_h
+00001d90: 6173 5b27 6f68 6c63 765f 7061 7274 6961  as['ohlcv_partia
+00001da0: 6c5f 6361 6e64 6c65 275d 0a0a 2020 2020  l_candle']..    
+00001db0: 2020 2020 7365 6c66 2e5f 7472 6164 6573      self._trades
+00001dc0: 5f70 6167 696e 6174 696f 6e20 3d20 7365  _pagination = se
+00001dd0: 6c66 2e5f 6674 5f68 6173 5b27 7472 6164  lf._ft_has['trad
+00001de0: 6573 5f70 6167 696e 6174 696f 6e27 5d0a  es_pagination'].
+00001df0: 2020 2020 2020 2020 7365 6c66 2e5f 7472          self._tr
+00001e00: 6164 6573 5f70 6167 696e 6174 696f 6e5f  ades_pagination_
+00001e10: 6172 6720 3d20 7365 6c66 2e5f 6674 5f68  arg = self._ft_h
+00001e20: 6173 5b27 7472 6164 6573 5f70 6167 696e  as['trades_pagin
+00001e30: 6174 696f 6e5f 6172 6727 5d0a 0a20 2020  ation_arg']..   
+00001e40: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
+00001e50: 6520 6363 7874 206f 626a 6563 7473 0a20  e ccxt objects. 
+00001e60: 2020 2020 2020 2063 6378 745f 636f 6e66         ccxt_conf
+00001e70: 6967 203d 2073 656c 662e 5f63 6378 745f  ig = self._ccxt_
+00001e80: 636f 6e66 6967 0a20 2020 2020 2020 2063  config.        c
+00001e90: 6378 745f 636f 6e66 6967 203d 2064 6565  cxt_config = dee
+00001ea0: 705f 6d65 7267 655f 6469 6374 7328 6578  p_merge_dicts(ex
+00001eb0: 6368 616e 6765 5f63 6f6e 6669 672e 6765  change_config.ge
+00001ec0: 7428 2763 6378 745f 636f 6e66 6967 272c  t('ccxt_config',
+00001ed0: 207b 7d29 2c20 6363 7874 5f63 6f6e 6669   {}), ccxt_confi
+00001ee0: 6729 0a20 2020 2020 2020 2063 6378 745f  g).        ccxt_
+00001ef0: 636f 6e66 6967 203d 2064 6565 705f 6d65  config = deep_me
+00001f00: 7267 655f 6469 6374 7328 6578 6368 616e  rge_dicts(exchan
+00001f10: 6765 5f63 6f6e 6669 672e 6765 7428 2763  ge_config.get('c
+00001f20: 6378 745f 7379 6e63 5f63 6f6e 6669 6727  cxt_sync_config'
+00001f30: 2c20 7b7d 292c 2063 6378 745f 636f 6e66  , {}), ccxt_conf
+00001f40: 6967 290a 0a20 2020 2020 2020 2073 656c  ig)..        sel
+00001f50: 662e 5f61 7069 203d 2073 656c 662e 5f69  f._api = self._i
+00001f60: 6e69 745f 6363 7874 2865 7863 6861 6e67  nit_ccxt(exchang
+00001f70: 655f 636f 6e66 6967 2c20 6363 7874 5f6b  e_config, ccxt_k
+00001f80: 7761 7267 733d 6363 7874 5f63 6f6e 6669  wargs=ccxt_confi
+00001f90: 6729 0a0a 2020 2020 2020 2020 6363 7874  g)..        ccxt
+00001fa0: 5f61 7379 6e63 5f63 6f6e 6669 6720 3d20  _async_config = 
+00001fb0: 7365 6c66 2e5f 6363 7874 5f63 6f6e 6669  self._ccxt_confi
+00001fc0: 670a 2020 2020 2020 2020 6363 7874 5f61  g.        ccxt_a
+00001fd0: 7379 6e63 5f63 6f6e 6669 6720 3d20 6465  sync_config = de
+00001fe0: 6570 5f6d 6572 6765 5f64 6963 7473 2865  ep_merge_dicts(e
+00001ff0: 7863 6861 6e67 655f 636f 6e66 6967 2e67  xchange_config.g
+00002000: 6574 2827 6363 7874 5f63 6f6e 6669 6727  et('ccxt_config'
+00002010: 2c20 7b7d 292c 0a20 2020 2020 2020 2020  , {}),.         
+00002020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002040: 2020 2020 6363 7874 5f61 7379 6e63 5f63      ccxt_async_c
+00002050: 6f6e 6669 6729 0a20 2020 2020 2020 2063  onfig).        c
+00002060: 6378 745f 6173 796e 635f 636f 6e66 6967  cxt_async_config
+00002070: 203d 2064 6565 705f 6d65 7267 655f 6469   = deep_merge_di
+00002080: 6374 7328 6578 6368 616e 6765 5f63 6f6e  cts(exchange_con
+00002090: 6669 672e 6765 7428 2763 6378 745f 6173  fig.get('ccxt_as
+000020a0: 796e 635f 636f 6e66 6967 272c 207b 7d29  ync_config', {})
+000020b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000020c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000020d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000020e0: 6378 745f 6173 796e 635f 636f 6e66 6967  cxt_async_config
+000020f0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00002100: 6170 695f 6173 796e 6320 3d20 7365 6c66  api_async = self
+00002110: 2e5f 696e 6974 5f63 6378 7428 0a20 2020  ._init_ccxt(.   
+00002120: 2020 2020 2020 2020 2065 7863 6861 6e67           exchang
+00002130: 655f 636f 6e66 6967 2c20 6363 7874 5f61  e_config, ccxt_a
+00002140: 7379 6e63 2c20 6363 7874 5f6b 7761 7267  sync, ccxt_kwarg
+00002150: 733d 6363 7874 5f61 7379 6e63 5f63 6f6e  s=ccxt_async_con
+00002160: 6669 6729 0a0a 2020 2020 2020 2020 6c6f  fig)..        lo
+00002170: 6767 6572 2e69 6e66 6f28 6627 5573 696e  gger.info(f'Usin
+00002180: 6720 4578 6368 616e 6765 2022 7b73 656c  g Exchange "{sel
+00002190: 662e 6e61 6d65 7d22 2729 0a20 2020 2020  f.name}"').     
+000021a0: 2020 2073 656c 662e 7265 7175 6972 6564     self.required
+000021b0: 5f63 616e 646c 655f 6361 6c6c 5f63 6f75  _candle_call_cou
+000021c0: 6e74 203d 2031 0a20 2020 2020 2020 2069  nt = 1.        i
+000021d0: 6620 7661 6c69 6461 7465 3a0a 2020 2020  f validate:.    
+000021e0: 2020 2020 2020 2020 2320 496e 6974 6961          # Initia
+000021f0: 6c20 6d61 726b 6574 7320 6c6f 6164 0a20  l markets load. 
+00002200: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00002210: 5f6c 6f61 645f 6d61 726b 6574 7328 290a  _load_markets().
+00002220: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002230: 2e76 616c 6964 6174 655f 636f 6e66 6967  .validate_config
+00002240: 2863 6f6e 6669 6729 0a20 2020 2020 2020  (config).       
+00002250: 2020 2020 2073 656c 662e 5f73 7461 7274       self._start
+00002260: 7570 5f63 616e 646c 655f 636f 756e 743a  up_candle_count:
+00002270: 2069 6e74 203d 2063 6f6e 6669 672e 6765   int = config.ge
+00002280: 7428 2773 7461 7274 7570 5f63 616e 646c  t('startup_candl
+00002290: 655f 636f 756e 7427 2c20 3029 0a20 2020  e_count', 0).   
+000022a0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+000022b0: 7175 6972 6564 5f63 616e 646c 655f 6361  quired_candle_ca
+000022c0: 6c6c 5f63 6f75 6e74 203d 2073 656c 662e  ll_count = self.
+000022d0: 7661 6c69 6461 7465 5f72 6571 7569 7265  validate_require
+000022e0: 645f 7374 6172 7475 705f 6361 6e64 6c65  d_startup_candle
+000022f0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+00002300: 2020 2073 656c 662e 5f73 7461 7274 7570     self._startup
+00002310: 5f63 616e 646c 655f 636f 756e 742c 2063  _candle_count, c
+00002320: 6f6e 6669 672e 6765 7428 2774 696d 6566  onfig.get('timef
+00002330: 7261 6d65 272c 2027 2729 290a 0a20 2020  rame', ''))..   
+00002340: 2020 2020 2023 2043 6f6e 7665 7274 7320       # Converts 
+00002350: 7468 6520 696e 7465 7276 616c 2070 726f  the interval pro
+00002360: 7669 6465 6420 696e 206d 696e 7574 6573  vided in minutes
+00002370: 2069 6e20 636f 6e66 6967 2074 6f20 7365   in config to se
+00002380: 636f 6e64 730a 2020 2020 2020 2020 7365  conds.        se
+00002390: 6c66 2e6d 6172 6b65 7473 5f72 6566 7265  lf.markets_refre
+000023a0: 7368 5f69 6e74 6572 7661 6c3a 2069 6e74  sh_interval: int
+000023b0: 203d 2065 7863 6861 6e67 655f 636f 6e66   = exchange_conf
+000023c0: 6967 2e67 6574 280a 2020 2020 2020 2020  ig.get(.        
+000023d0: 2020 2020 226d 6172 6b65 7473 5f72 6566      "markets_ref
+000023e0: 7265 7368 5f69 6e74 6572 7661 6c22 2c20  resh_interval", 
+000023f0: 3630 2920 2a20 3630 0a0a 2020 2020 2020  60) * 60..      
+00002400: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
+00002410: 675f 6d6f 6465 2021 3d20 5472 6164 696e  g_mode != Tradin
+00002420: 674d 6f64 652e 5350 4f54 2061 6e64 206c  gMode.SPOT and l
+00002430: 6f61 645f 6c65 7665 7261 6765 5f74 6965  oad_leverage_tie
+00002440: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00002450: 7365 6c66 2e66 696c 6c5f 6c65 7665 7261  self.fill_levera
+00002460: 6765 5f74 6965 7273 2829 0a20 2020 2020  ge_tiers().     
+00002470: 2020 2073 656c 662e 6164 6469 7469 6f6e     self.addition
+00002480: 616c 5f65 7863 6861 6e67 655f 696e 6974  al_exchange_init
+00002490: 2829 0a0a 2020 2020 6465 6620 5f5f 6465  ()..    def __de
+000024a0: 6c5f 5f28 7365 6c66 293a 0a20 2020 2020  l__(self):.     
+000024b0: 2020 2022 2222 0a20 2020 2020 2020 2044     """.        D
+000024c0: 6573 7472 7563 746f 7220 2d20 636c 6561  estructor - clea
+000024d0: 6e20 7570 2061 7379 6e63 2073 7475 6666  n up async stuff
+000024e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000024f0: 2020 2020 2073 656c 662e 636c 6f73 6528       self.close(
+00002500: 290a 0a20 2020 2064 6566 2063 6c6f 7365  )..    def close
+00002510: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00002520: 6c6f 6767 6572 2e64 6562 7567 2822 4578  logger.debug("Ex
+00002530: 6368 616e 6765 206f 626a 6563 7420 6465  change object de
+00002540: 7374 726f 7965 642c 2063 6c6f 7369 6e67  stroyed, closing
+00002550: 2061 7379 6e63 206c 6f6f 7022 290a 2020   async loop").  
+00002560: 2020 2020 2020 6966 2028 7365 6c66 2e5f        if (self._
+00002570: 6170 695f 6173 796e 6320 616e 6420 696e  api_async and in
+00002580: 7370 6563 742e 6973 636f 726f 7574 696e  spect.iscoroutin
+00002590: 6566 756e 6374 696f 6e28 7365 6c66 2e5f  efunction(self._
+000025a0: 6170 695f 6173 796e 632e 636c 6f73 6529  api_async.close)
+000025b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000025c0: 2061 6e64 2073 656c 662e 5f61 7069 5f61   and self._api_a
+000025d0: 7379 6e63 2e73 6573 7369 6f6e 293a 0a20  sync.session):. 
+000025e0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+000025f0: 722e 6465 6275 6728 2243 6c6f 7369 6e67  r.debug("Closing
+00002600: 2061 7379 6e63 2063 6378 7420 7365 7373   async ccxt sess
+00002610: 696f 6e2e 2229 0a20 2020 2020 2020 2020  ion.").         
+00002620: 2020 2073 656c 662e 6c6f 6f70 2e72 756e     self.loop.run
+00002630: 5f75 6e74 696c 5f63 6f6d 706c 6574 6528  _until_complete(
+00002640: 7365 6c66 2e5f 6170 695f 6173 796e 632e  self._api_async.
+00002650: 636c 6f73 6528 2929 0a20 2020 2020 2020  close()).       
+00002660: 2069 6620 7365 6c66 2e6c 6f6f 7020 616e   if self.loop an
+00002670: 6420 6e6f 7420 7365 6c66 2e6c 6f6f 702e  d not self.loop.
+00002680: 6973 5f63 6c6f 7365 6428 293a 0a20 2020  is_closed():.   
+00002690: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+000026a0: 6f70 2e63 6c6f 7365 2829 0a0a 2020 2020  op.close()..    
+000026b0: 6465 6620 7661 6c69 6461 7465 5f63 6f6e  def validate_con
+000026c0: 6669 6728 7365 6c66 2c20 636f 6e66 6967  fig(self, config
+000026d0: 293a 0a20 2020 2020 2020 2023 2043 6865  ):.        # Che
+000026e0: 636b 2069 6620 7469 6d65 6672 616d 6520  ck if timeframe 
+000026f0: 6973 2061 7661 696c 6162 6c65 0a20 2020  is available.   
+00002700: 2020 2020 2073 656c 662e 7661 6c69 6461       self.valida
+00002710: 7465 5f74 696d 6566 7261 6d65 7328 636f  te_timeframes(co
+00002720: 6e66 6967 2e67 6574 2827 7469 6d65 6672  nfig.get('timefr
+00002730: 616d 6527 2929 0a0a 2020 2020 2020 2020  ame'))..        
+00002740: 2320 4368 6563 6b20 6966 2061 6c6c 2070  # Check if all p
+00002750: 6169 7273 2061 7265 2061 7661 696c 6162  airs are availab
+00002760: 6c65 0a20 2020 2020 2020 2073 656c 662e  le.        self.
+00002770: 7661 6c69 6461 7465 5f73 7461 6b65 6375  validate_stakecu
+00002780: 7272 656e 6379 2863 6f6e 6669 675b 2773  rrency(config['s
+00002790: 7461 6b65 5f63 7572 7265 6e63 7927 5d29  take_currency'])
+000027a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000027b0: 636f 6e66 6967 5b27 6578 6368 616e 6765  config['exchange
+000027c0: 275d 2e67 6574 2827 736b 6970 5f70 6169  '].get('skip_pai
+000027d0: 725f 7661 6c69 6461 7469 6f6e 2729 3a0a  r_validation'):.
+000027e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000027f0: 2e76 616c 6964 6174 655f 7061 6972 7328  .validate_pairs(
+00002800: 636f 6e66 6967 5b27 6578 6368 616e 6765  config['exchange
+00002810: 275d 5b27 7061 6972 5f77 6869 7465 6c69  ']['pair_whiteli
+00002820: 7374 275d 290a 2020 2020 2020 2020 7365  st']).        se
+00002830: 6c66 2e76 616c 6964 6174 655f 6f72 6465  lf.validate_orde
+00002840: 7274 7970 6573 2863 6f6e 6669 672e 6765  rtypes(config.ge
+00002850: 7428 276f 7264 6572 5f74 7970 6573 272c  t('order_types',
+00002860: 207b 7d29 290a 2020 2020 2020 2020 7365   {})).        se
+00002870: 6c66 2e76 616c 6964 6174 655f 6f72 6465  lf.validate_orde
+00002880: 725f 7469 6d65 5f69 6e5f 666f 7263 6528  r_time_in_force(
+00002890: 636f 6e66 6967 2e67 6574 2827 6f72 6465  config.get('orde
+000028a0: 725f 7469 6d65 5f69 6e5f 666f 7263 6527  r_time_in_force'
+000028b0: 2c20 7b7d 2929 0a20 2020 2020 2020 2073  , {})).        s
+000028c0: 656c 662e 7661 6c69 6461 7465 5f74 7261  elf.validate_tra
+000028d0: 6469 6e67 5f6d 6f64 655f 616e 645f 6d61  ding_mode_and_ma
+000028e0: 7267 696e 5f6d 6f64 6528 7365 6c66 2e74  rgin_mode(self.t
+000028f0: 7261 6469 6e67 5f6d 6f64 652c 2073 656c  rading_mode, sel
+00002900: 662e 6d61 7267 696e 5f6d 6f64 6529 0a20  f.margin_mode). 
+00002910: 2020 2020 2020 2073 656c 662e 7661 6c69         self.vali
+00002920: 6461 7465 5f70 7269 6369 6e67 2863 6f6e  date_pricing(con
+00002930: 6669 675b 2765 7869 745f 7072 6963 696e  fig['exit_pricin
+00002940: 6727 5d29 0a20 2020 2020 2020 2073 656c  g']).        sel
+00002950: 662e 7661 6c69 6461 7465 5f70 7269 6369  f.validate_prici
+00002960: 6e67 2863 6f6e 6669 675b 2765 6e74 7279  ng(config['entry
+00002970: 5f70 7269 6369 6e67 275d 290a 0a20 2020  _pricing'])..   
+00002980: 2064 6566 205f 696e 6974 5f63 6378 7428   def _init_ccxt(
+00002990: 7365 6c66 2c20 6578 6368 616e 6765 5f63  self, exchange_c
+000029a0: 6f6e 6669 673a 2044 6963 745b 7374 722c  onfig: Dict[str,
+000029b0: 2041 6e79 5d2c 2063 6378 745f 6d6f 6475   Any], ccxt_modu
+000029c0: 6c65 3a20 4363 7874 4d6f 6475 6c65 5479  le: CcxtModuleTy
+000029d0: 7065 203d 2063 6378 742c 0a20 2020 2020  pe = ccxt,.     
+000029e0: 2020 2020 2020 2020 2020 2020 2020 6363                cc
+000029f0: 7874 5f6b 7761 7267 733a 2044 6963 7420  xt_kwargs: Dict 
+00002a00: 3d20 7b7d 2920 2d3e 2063 6378 742e 4578  = {}) -> ccxt.Ex
+00002a10: 6368 616e 6765 3a0a 2020 2020 2020 2020  change:.        
+00002a20: 2222 220a 2020 2020 2020 2020 496e 6974  """.        Init
+00002a30: 6961 6c69 7a65 2063 6378 7420 7769 7468  ialize ccxt with
+00002a40: 2067 6976 656e 2063 6f6e 6669 6720 616e   given config an
+00002a50: 6420 7265 7475 726e 2076 616c 6964 0a20  d return valid. 
+00002a60: 2020 2020 2020 2063 6378 7420 696e 7374         ccxt inst
+00002a70: 616e 6365 2e0a 2020 2020 2020 2020 2222  ance..        ""
+00002a80: 220a 2020 2020 2020 2020 2320 4669 6e64  ".        # Find
+00002a90: 206d 6174 6368 696e 6720 636c 6173 7320   matching class 
+00002aa0: 666f 7220 7468 6520 6769 7665 6e20 6578  for the given ex
+00002ab0: 6368 616e 6765 206e 616d 650a 2020 2020  change name.    
+00002ac0: 2020 2020 6e61 6d65 203d 2065 7863 6861      name = excha
+00002ad0: 6e67 655f 636f 6e66 6967 5b27 6e61 6d65  nge_config['name
+00002ae0: 275d 0a0a 2020 2020 2020 2020 6966 206e  ']..        if n
+00002af0: 6f74 2069 735f 6578 6368 616e 6765 5f6b  ot is_exchange_k
+00002b00: 6e6f 776e 5f63 6378 7428 6e61 6d65 2c20  nown_ccxt(name, 
+00002b10: 6363 7874 5f6d 6f64 756c 6529 3a0a 2020  ccxt_module):.  
+00002b20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00002b30: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
+00002b40: 7469 6f6e 2866 2745 7863 6861 6e67 6520  tion(f'Exchange 
+00002b50: 7b6e 616d 657d 2069 7320 6e6f 7420 7375  {name} is not su
+00002b60: 7070 6f72 7465 6420 6279 2063 6378 7427  pported by ccxt'
+00002b70: 290a 0a20 2020 2020 2020 2065 785f 636f  )..        ex_co
+00002b80: 6e66 6967 203d 207b 0a20 2020 2020 2020  nfig = {.       
+00002b90: 2020 2020 2027 6170 694b 6579 273a 2065       'apiKey': e
+00002ba0: 7863 6861 6e67 655f 636f 6e66 6967 2e67  xchange_config.g
+00002bb0: 6574 2827 6b65 7927 292c 0a20 2020 2020  et('key'),.     
+00002bc0: 2020 2020 2020 2027 7365 6372 6574 273a         'secret':
+00002bd0: 2065 7863 6861 6e67 655f 636f 6e66 6967   exchange_config
+00002be0: 2e67 6574 2827 7365 6372 6574 2729 2c0a  .get('secret'),.
+00002bf0: 2020 2020 2020 2020 2020 2020 2770 6173              'pas
+00002c00: 7377 6f72 6427 3a20 6578 6368 616e 6765  sword': exchange
+00002c10: 5f63 6f6e 6669 672e 6765 7428 2770 6173  _config.get('pas
+00002c20: 7377 6f72 6427 292c 0a20 2020 2020 2020  sword'),.       
+00002c30: 2020 2020 2027 7569 6427 3a20 6578 6368       'uid': exch
+00002c40: 616e 6765 5f63 6f6e 6669 672e 6765 7428  ange_config.get(
+00002c50: 2775 6964 272c 2027 2729 2c0a 2020 2020  'uid', ''),.    
+00002c60: 2020 2020 7d0a 2020 2020 2020 2020 6966      }.        if
+00002c70: 2063 6378 745f 6b77 6172 6773 3a0a 2020   ccxt_kwargs:.  
+00002c80: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00002c90: 2e69 6e66 6f28 2741 7070 6c79 696e 6720  .info('Applying 
+00002ca0: 6164 6469 7469 6f6e 616c 2063 6378 7420  additional ccxt 
+00002cb0: 636f 6e66 6967 3a20 2573 272c 2063 6378  config: %s', ccx
+00002cc0: 745f 6b77 6172 6773 290a 2020 2020 2020  t_kwargs).      
+00002cd0: 2020 6966 2073 656c 662e 5f63 6378 745f    if self._ccxt_
+00002ce0: 7061 7261 6d73 3a0a 2020 2020 2020 2020  params:.        
+00002cf0: 2020 2020 2320 496e 6a65 6374 2073 7461      # Inject sta
+00002d00: 7469 6320 6f70 7469 6f6e 7320 6166 7465  tic options afte
+00002d10: 7220 7468 6520 6162 6f76 6520 6f75 7470  r the above outp
+00002d20: 7574 2074 6f20 6e6f 7420 636f 6e66 7573  ut to not confus
+00002d30: 6520 7573 6572 732e 0a20 2020 2020 2020  e users..       
+00002d40: 2020 2020 2063 6378 745f 6b77 6172 6773       ccxt_kwargs
+00002d50: 203d 2064 6565 705f 6d65 7267 655f 6469   = deep_merge_di
+00002d60: 6374 7328 7365 6c66 2e5f 6363 7874 5f70  cts(self._ccxt_p
+00002d70: 6172 616d 732c 2063 6378 745f 6b77 6172  arams, ccxt_kwar
+00002d80: 6773 290a 2020 2020 2020 2020 6966 2063  gs).        if c
+00002d90: 6378 745f 6b77 6172 6773 3a0a 2020 2020  cxt_kwargs:.    
+00002da0: 2020 2020 2020 2020 6578 5f63 6f6e 6669          ex_confi
+00002db0: 672e 7570 6461 7465 2863 6378 745f 6b77  g.update(ccxt_kw
+00002dc0: 6172 6773 290a 2020 2020 2020 2020 7472  args).        tr
+00002dd0: 793a 0a0a 2020 2020 2020 2020 2020 2020  y:..            
+00002de0: 6170 6920 3d20 6765 7461 7474 7228 6363  api = getattr(cc
+00002df0: 7874 5f6d 6f64 756c 652c 206e 616d 652e  xt_module, name.
+00002e00: 6c6f 7765 7228 2929 2865 785f 636f 6e66  lower())(ex_conf
+00002e10: 6967 290a 2020 2020 2020 2020 6578 6365  ig).        exce
+00002e20: 7074 2028 4b65 7945 7272 6f72 2c20 4174  pt (KeyError, At
+00002e30: 7472 6962 7574 6545 7272 6f72 2920 6173  tributeError) as
+00002e40: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00002e50: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00002e60: 6c45 7863 6570 7469 6f6e 2866 2745 7863  lException(f'Exc
+00002e70: 6861 6e67 6520 7b6e 616d 657d 2069 7320  hange {name} is 
+00002e80: 6e6f 7420 7375 7070 6f72 7465 6427 2920  not supported') 
+00002e90: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+00002ea0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
+00002eb0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
+00002ec0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+00002ed0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+00002ee0: 6e28 6622 496e 6974 6961 6c69 7a61 7469  n(f"Initializati
+00002ef0: 6f6e 206f 6620 6363 7874 2066 6169 6c65  on of ccxt faile
+00002f00: 642e 2052 6561 736f 6e3a 207b 657d 2229  d. Reason: {e}")
+00002f10: 2066 726f 6d20 650a 0a20 2020 2020 2020   from e..       
+00002f20: 2073 656c 662e 7365 745f 7361 6e64 626f   self.set_sandbo
+00002f30: 7828 6170 692c 2065 7863 6861 6e67 655f  x(api, exchange_
+00002f40: 636f 6e66 6967 2c20 6e61 6d65 290a 0a20  config, name).. 
+00002f50: 2020 2020 2020 2072 6574 7572 6e20 6170         return ap
+00002f60: 690a 0a20 2020 2040 7072 6f70 6572 7479  i..    @property
+00002f70: 0a20 2020 2064 6566 205f 6363 7874 5f63  .    def _ccxt_c
+00002f80: 6f6e 6669 6728 7365 6c66 2920 2d3e 2044  onfig(self) -> D
+00002f90: 6963 743a 0a20 2020 2020 2020 2023 2050  ict:.        # P
+00002fa0: 6172 616d 6574 6572 7320 746f 2061 6464  arameters to add
+00002fb0: 2064 6972 6563 746c 7920 746f 2063 6378   directly to ccx
+00002fc0: 7420 7379 6e63 2f61 7379 6e63 2069 6e69  t sync/async ini
+00002fd0: 7469 616c 697a 6174 696f 6e2e 0a20 2020  tialization..   
+00002fe0: 2020 2020 2069 6620 7365 6c66 2e74 7261       if self.tra
+00002ff0: 6469 6e67 5f6d 6f64 6520 3d3d 2054 7261  ding_mode == Tra
+00003000: 6469 6e67 4d6f 6465 2e4d 4152 4749 4e3a  dingMode.MARGIN:
+00003010: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00003020: 7572 6e20 7b0a 2020 2020 2020 2020 2020  urn {.          
+00003030: 2020 2020 2020 226f 7074 696f 6e73 223a        "options":
+00003040: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00003050: 2020 2020 2020 2022 6465 6661 756c 7454         "defaultT
+00003060: 7970 6522 3a20 226d 6172 6769 6e22 0a20  ype": "margin". 
+00003070: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00003080: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
+00003090: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+000030a0: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
+000030b0: 2054 7261 6469 6e67 4d6f 6465 2e46 5554   TradingMode.FUT
+000030c0: 5552 4553 3a0a 2020 2020 2020 2020 2020  URES:.          
+000030d0: 2020 7265 7475 726e 207b 0a20 2020 2020    return {.     
+000030e0: 2020 2020 2020 2020 2020 2022 6f70 7469             "opti
+000030f0: 6f6e 7322 3a20 7b0a 2020 2020 2020 2020  ons": {.        
+00003100: 2020 2020 2020 2020 2020 2020 2264 6566              "def
+00003110: 6175 6c74 5479 7065 223a 2073 656c 662e  aultType": self.
+00003120: 5f66 745f 6861 735b 2263 6378 745f 6675  _ft_has["ccxt_fu
+00003130: 7475 7265 735f 6e61 6d65 225d 0a20 2020  tures_name"].   
+00003140: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+00003150: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00003160: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00003170: 2020 2020 2020 2072 6574 7572 6e20 7b7d         return {}
+00003180: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+00003190: 2020 2020 6465 6620 6e61 6d65 2873 656c      def name(sel
+000031a0: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
+000031b0: 2020 2022 2222 6578 6368 616e 6765 204e     """exchange N
+000031c0: 616d 6520 2866 726f 6d20 6363 7874 2922  ame (from ccxt)"
+000031d0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+000031e0: 6e20 7365 6c66 2e5f 6170 692e 6e61 6d65  n self._api.name
+000031f0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+00003200: 2020 2020 6465 6620 6964 2873 656c 6629      def id(self)
+00003210: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+00003220: 2022 2222 6578 6368 616e 6765 2063 6378   """exchange ccx
+00003230: 7420 6964 2222 220a 2020 2020 2020 2020  t id""".        
+00003240: 7265 7475 726e 2073 656c 662e 5f61 7069  return self._api
+00003250: 2e69 640a 0a20 2020 2040 7072 6f70 6572  .id..    @proper
+00003260: 7479 0a20 2020 2064 6566 2074 696d 6566  ty.    def timef
+00003270: 7261 6d65 7328 7365 6c66 2920 2d3e 204c  rames(self) -> L
+00003280: 6973 745b 7374 725d 3a0a 2020 2020 2020  ist[str]:.      
+00003290: 2020 7265 7475 726e 206c 6973 7428 2873    return list((s
+000032a0: 656c 662e 5f61 7069 2e74 696d 6566 7261  elf._api.timefra
+000032b0: 6d65 7320 6f72 207b 7d29 2e6b 6579 7328  mes or {}).keys(
+000032c0: 2929 0a0a 2020 2020 4070 726f 7065 7274  ))..    @propert
+000032d0: 790a 2020 2020 6465 6620 6d61 726b 6574  y.    def market
+000032e0: 7328 7365 6c66 2920 2d3e 2044 6963 743a  s(self) -> Dict:
+000032f0: 0a20 2020 2020 2020 2022 2222 6578 6368  .        """exch
+00003300: 616e 6765 2063 6378 7420 6d61 726b 6574  ange ccxt market
+00003310: 7322 2222 0a20 2020 2020 2020 2069 6620  s""".        if 
+00003320: 6e6f 7420 7365 6c66 2e5f 6d61 726b 6574  not self._market
+00003330: 733a 0a20 2020 2020 2020 2020 2020 206c  s:.            l
+00003340: 6f67 6765 722e 696e 666f 2822 4d61 726b  ogger.info("Mark
+00003350: 6574 7320 7765 7265 206e 6f74 206c 6f61  ets were not loa
+00003360: 6465 642e 204c 6f61 6469 6e67 2074 6865  ded. Loading the
+00003370: 6d20 6e6f 772e 2e22 290a 2020 2020 2020  m now..").      
+00003380: 2020 2020 2020 7365 6c66 2e5f 6c6f 6164        self._load
+00003390: 5f6d 6172 6b65 7473 2829 0a20 2020 2020  _markets().     
+000033a0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000033b0: 6d61 726b 6574 730a 0a20 2020 2040 7072  markets..    @pr
+000033c0: 6f70 6572 7479 0a20 2020 2064 6566 2070  operty.    def p
+000033d0: 7265 6369 7369 6f6e 4d6f 6465 2873 656c  recisionMode(sel
+000033e0: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
+000033f0: 2020 2022 2222 6578 6368 616e 6765 2063     """exchange c
+00003400: 6378 7420 7072 6563 6973 696f 6e4d 6f64  cxt precisionMod
+00003410: 6522 2222 0a20 2020 2020 2020 2072 6574  e""".        ret
+00003420: 7572 6e20 7365 6c66 2e5f 6170 692e 7072  urn self._api.pr
+00003430: 6563 6973 696f 6e4d 6f64 650a 0a20 2020  ecisionMode..   
+00003440: 2064 6566 2061 6464 6974 696f 6e61 6c5f   def additional_
+00003450: 6578 6368 616e 6765 5f69 6e69 7428 7365  exchange_init(se
+00003460: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00003470: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003480: 2041 6464 6974 696f 6e61 6c20 6578 6368   Additional exch
+00003490: 616e 6765 2069 6e69 7469 616c 697a 6174  ange initializat
+000034a0: 696f 6e20 6c6f 6769 632e 0a20 2020 2020  ion logic..     
+000034b0: 2020 202e 6170 6920 7769 6c6c 2062 6520     .api will be 
+000034c0: 6176 6169 6c61 626c 6520 6174 2074 6869  available at thi
+000034d0: 7320 706f 696e 742e 0a20 2020 2020 2020  s point..       
+000034e0: 204d 7573 7420 6265 206f 7665 7272 6964   Must be overrid
+000034f0: 6465 6e20 696e 2063 6869 6c64 206d 6574  den in child met
+00003500: 686f 6473 2069 6620 7265 7175 6972 6564  hods if required
+00003510: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00003520: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
+00003530: 6465 6620 5f6c 6f67 5f65 7863 6861 6e67  def _log_exchang
+00003540: 655f 7265 7370 6f6e 7365 2873 656c 662c  e_response(self,
+00003550: 2065 6e64 706f 696e 742c 2072 6573 706f   endpoint, respo
+00003560: 6e73 6529 202d 3e20 4e6f 6e65 3a0a 2020  nse) -> None:.  
+00003570: 2020 2020 2020 2222 2220 4c6f 6720 6578        """ Log ex
+00003580: 6368 616e 6765 2072 6573 706f 6e73 6573  change responses
+00003590: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+000035a0: 7365 6c66 2e6c 6f67 5f72 6573 706f 6e73  self.log_respons
+000035b0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+000035c0: 6c6f 6767 6572 2e69 6e66 6f28 6622 4150  logger.info(f"AP
+000035d0: 4920 7b65 6e64 706f 696e 747d 3a20 7b72  I {endpoint}: {r
+000035e0: 6573 706f 6e73 657d 2229 0a0a 2020 2020  esponse}")..    
+000035f0: 6465 6620 6f68 6c63 765f 6361 6e64 6c65  def ohlcv_candle
+00003600: 5f6c 696d 6974 280a 2020 2020 2020 2020  _limit(.        
+00003610: 2020 2020 7365 6c66 2c20 7469 6d65 6672      self, timefr
+00003620: 616d 653a 2073 7472 2c20 6361 6e64 6c65  ame: str, candle
+00003630: 5f74 7970 653a 2043 616e 646c 6554 7970  _type: CandleTyp
+00003640: 652c 2073 696e 6365 5f6d 733a 204f 7074  e, since_ms: Opt
+00003650: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
+00003660: 6529 202d 3e20 696e 743a 0a20 2020 2020  e) -> int:.     
+00003670: 2020 2022 2222 0a20 2020 2020 2020 2045     """.        E
+00003680: 7863 6861 6e67 6520 6f68 6c63 7620 6361  xchange ohlcv ca
+00003690: 6e64 6c65 206c 696d 6974 0a20 2020 2020  ndle limit.     
+000036a0: 2020 2055 7365 7320 6f68 6c63 765f 6361     Uses ohlcv_ca
+000036b0: 6e64 6c65 5f6c 696d 6974 5f70 6572 5f74  ndle_limit_per_t
+000036c0: 696d 6566 7261 6d65 2069 6620 7468 6520  imeframe if the 
+000036d0: 6578 6368 616e 6765 2068 6173 2064 6966  exchange has dif
+000036e0: 6665 7265 6e74 206c 696d 6974 730a 2020  ferent limits.  
+000036f0: 2020 2020 2020 7065 7220 7469 6d65 6672        per timefr
+00003700: 616d 6520 2865 2e67 2e20 6269 7474 7265  ame (e.g. bittre
+00003710: 7829 2c20 6f74 6865 7277 6973 6520 6661  x), otherwise fa
+00003720: 6c6c 7320 6261 636b 2074 6f20 6f68 6c63  lls back to ohlc
+00003730: 765f 6361 6e64 6c65 5f6c 696d 6974 0a20  v_candle_limit. 
+00003740: 2020 2020 2020 203a 7061 7261 6d20 7469         :param ti
+00003750: 6d65 6672 616d 653a 2054 696d 6566 7261  meframe: Timefra
+00003760: 6d65 2074 6f20 6368 6563 6b0a 2020 2020  me to check.    
+00003770: 2020 2020 3a70 6172 616d 2063 616e 646c      :param candl
+00003780: 655f 7479 7065 3a20 4361 6e64 6c65 2d74  e_type: Candle-t
+00003790: 7970 650a 2020 2020 2020 2020 3a70 6172  ype.        :par
+000037a0: 616d 2073 696e 6365 5f6d 733a 2053 7461  am since_ms: Sta
+000037b0: 7274 696e 6720 7469 6d65 7374 616d 700a  rting timestamp.
+000037c0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+000037d0: 2043 616e 646c 6520 6c69 6d69 7420 6173   Candle limit as
+000037e0: 2069 6e74 6567 6572 0a20 2020 2020 2020   integer.       
+000037f0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00003800: 7572 6e20 696e 7428 7365 6c66 2e5f 6674  urn int(self._ft
+00003810: 5f68 6173 2e67 6574 2827 6f68 6c63 765f  _has.get('ohlcv_
+00003820: 6361 6e64 6c65 5f6c 696d 6974 5f70 6572  candle_limit_per
+00003830: 5f74 696d 6566 7261 6d65 272c 207b 7d29  _timeframe', {})
+00003840: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
+00003850: 2020 7469 6d65 6672 616d 652c 2073 656c    timeframe, sel
+00003860: 662e 5f66 745f 6861 732e 6765 7428 276f  f._ft_has.get('o
+00003870: 686c 6376 5f63 616e 646c 655f 6c69 6d69  hlcv_candle_limi
+00003880: 7427 2929 290a 0a20 2020 2064 6566 2067  t')))..    def g
+00003890: 6574 5f6d 6172 6b65 7473 2873 656c 662c  et_markets(self,
+000038a0: 2062 6173 655f 6375 7272 656e 6369 6573   base_currencies
+000038b0: 3a20 4c69 7374 5b73 7472 5d20 3d20 5b5d  : List[str] = []
+000038c0: 2c20 7175 6f74 655f 6375 7272 656e 6369  , quote_currenci
+000038d0: 6573 3a20 4c69 7374 5b73 7472 5d20 3d20  es: List[str] = 
+000038e0: 5b5d 2c0a 2020 2020 2020 2020 2020 2020  [],.            
+000038f0: 2020 2020 2020 2020 7370 6f74 5f6f 6e6c          spot_onl
+00003900: 793a 2062 6f6f 6c20 3d20 4661 6c73 652c  y: bool = False,
+00003910: 206d 6172 6769 6e5f 6f6e 6c79 3a20 626f   margin_only: bo
+00003920: 6f6c 203d 2046 616c 7365 2c20 6675 7475  ol = False, futu
+00003930: 7265 735f 6f6e 6c79 3a20 626f 6f6c 203d  res_only: bool =
+00003940: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+00003950: 2020 2020 2020 2020 2020 2020 7472 6164              trad
+00003960: 6162 6c65 5f6f 6e6c 793a 2062 6f6f 6c20  able_only: bool 
+00003970: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00003980: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+00003990: 7665 5f6f 6e6c 793a 2062 6f6f 6c20 3d20  ve_only: bool = 
+000039a0: 4661 6c73 6529 202d 3e20 4469 6374 5b73  False) -> Dict[s
+000039b0: 7472 2c20 416e 795d 3a0a 2020 2020 2020  tr, Any]:.      
+000039c0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+000039d0: 7475 726e 2065 7863 6861 6e67 6520 6363  turn exchange cc
+000039e0: 7874 206d 6172 6b65 7473 2c20 6669 6c74  xt markets, filt
+000039f0: 6572 6564 206f 7574 2062 7920 6261 7365  ered out by base
+00003a00: 2063 7572 7265 6e63 7920 616e 6420 7175   currency and qu
+00003a10: 6f74 6520 6375 7272 656e 6379 0a20 2020  ote currency.   
+00003a20: 2020 2020 2069 6620 7468 6973 2077 6173       if this was
+00003a30: 2072 6571 7565 7374 6564 2069 6e20 7061   requested in pa
+00003a40: 7261 6d65 7465 7273 2e0a 2020 2020 2020  rameters..      
+00003a50: 2020 2222 220a 2020 2020 2020 2020 6d61    """.        ma
+00003a60: 726b 6574 7320 3d20 7365 6c66 2e6d 6172  rkets = self.mar
+00003a70: 6b65 7473 0a20 2020 2020 2020 2069 6620  kets.        if 
+00003a80: 6e6f 7420 6d61 726b 6574 733a 0a20 2020  not markets:.   
+00003a90: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+00003aa0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00003ab0: 696f 6e28 224d 6172 6b65 7473 2077 6572  ion("Markets wer
+00003ac0: 6520 6e6f 7420 6c6f 6164 6564 2e22 290a  e not loaded.").
+00003ad0: 0a20 2020 2020 2020 2069 6620 6261 7365  .        if base
+00003ae0: 5f63 7572 7265 6e63 6965 733a 0a20 2020  _currencies:.   
+00003af0: 2020 2020 2020 2020 206d 6172 6b65 7473           markets
+00003b00: 203d 207b 6b3a 2076 2066 6f72 206b 2c20   = {k: v for k, 
+00003b10: 7620 696e 206d 6172 6b65 7473 2e69 7465  v in markets.ite
+00003b20: 6d73 2829 2069 6620 765b 2762 6173 6527  ms() if v['base'
+00003b30: 5d20 696e 2062 6173 655f 6375 7272 656e  ] in base_curren
+00003b40: 6369 6573 7d0a 2020 2020 2020 2020 6966  cies}.        if
+00003b50: 2071 756f 7465 5f63 7572 7265 6e63 6965   quote_currencie
+00003b60: 733a 0a20 2020 2020 2020 2020 2020 206d  s:.            m
 00003b70: 6172 6b65 7473 203d 207b 6b3a 2076 2066  arkets = {k: v f
 00003b80: 6f72 206b 2c20 7620 696e 206d 6172 6b65  or k, v in marke
-00003b90: 7473 2e69 7465 6d73 2829 2069 6620 7365  ts.items() if se
-00003ba0: 6c66 2e6d 6172 6b65 745f 6973 5f74 7261  lf.market_is_tra
-00003bb0: 6461 626c 6528 7629 7d0a 2020 2020 2020  dable(v)}.      
-00003bc0: 2020 6966 2073 706f 745f 6f6e 6c79 3a0a    if spot_only:.
-00003bd0: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
-00003be0: 6574 7320 3d20 7b6b 3a20 7620 666f 7220  ets = {k: v for 
-00003bf0: 6b2c 2076 2069 6e20 6d61 726b 6574 732e  k, v in markets.
-00003c00: 6974 656d 7328 2920 6966 2073 656c 662e  items() if self.
-00003c10: 6d61 726b 6574 5f69 735f 7370 6f74 2876  market_is_spot(v
-00003c20: 297d 0a20 2020 2020 2020 2069 6620 6d61  )}.        if ma
-00003c30: 7267 696e 5f6f 6e6c 793a 0a20 2020 2020  rgin_only:.     
-00003c40: 2020 2020 2020 206d 6172 6b65 7473 203d         markets =
-00003c50: 207b 6b3a 2076 2066 6f72 206b 2c20 7620   {k: v for k, v 
-00003c60: 696e 206d 6172 6b65 7473 2e69 7465 6d73  in markets.items
-00003c70: 2829 2069 6620 7365 6c66 2e6d 6172 6b65  () if self.marke
-00003c80: 745f 6973 5f6d 6172 6769 6e28 7629 7d0a  t_is_margin(v)}.
-00003c90: 2020 2020 2020 2020 6966 2066 7574 7572          if futur
-00003ca0: 6573 5f6f 6e6c 793a 0a20 2020 2020 2020  es_only:.       
-00003cb0: 2020 2020 206d 6172 6b65 7473 203d 207b       markets = {
-00003cc0: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
-00003cd0: 206d 6172 6b65 7473 2e69 7465 6d73 2829   markets.items()
-00003ce0: 2069 6620 7365 6c66 2e6d 6172 6b65 745f   if self.market_
-00003cf0: 6973 5f66 7574 7572 6528 7629 7d0a 2020  is_future(v)}.  
-00003d00: 2020 2020 2020 6966 2061 6374 6976 655f        if active_
-00003d10: 6f6e 6c79 3a0a 2020 2020 2020 2020 2020  only:.          
-00003d20: 2020 6d61 726b 6574 7320 3d20 7b6b 3a20    markets = {k: 
-00003d30: 7620 666f 7220 6b2c 2076 2069 6e20 6d61  v for k, v in ma
-00003d40: 726b 6574 732e 6974 656d 7328 2920 6966  rkets.items() if
-00003d50: 206d 6172 6b65 745f 6973 5f61 6374 6976   market_is_activ
-00003d60: 6528 7629 7d0a 2020 2020 2020 2020 7265  e(v)}.        re
-00003d70: 7475 726e 206d 6172 6b65 7473 0a0a 2020  turn markets..  
-00003d80: 2020 6465 6620 6765 745f 7175 6f74 655f    def get_quote_
-00003d90: 6375 7272 656e 6369 6573 2873 656c 6629  currencies(self)
-00003da0: 202d 3e20 4c69 7374 5b73 7472 5d3a 0a20   -> List[str]:. 
-00003db0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00003dc0: 2020 2052 6574 7572 6e20 6120 6c69 7374     Return a list
-00003dd0: 206f 6620 7375 7070 6f72 7465 6420 7175   of supported qu
-00003de0: 6f74 6520 6375 7272 656e 6369 6573 0a20  ote currencies. 
-00003df0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00003e00: 2020 206d 6172 6b65 7473 203d 2073 656c     markets = sel
-00003e10: 662e 6d61 726b 6574 730a 2020 2020 2020  f.markets.      
-00003e20: 2020 7265 7475 726e 2073 6f72 7465 6428    return sorted(
-00003e30: 7365 7428 5b78 5b27 7175 6f74 6527 5d20  set([x['quote'] 
-00003e40: 666f 7220 5f2c 2078 2069 6e20 6d61 726b  for _, x in mark
-00003e50: 6574 732e 6974 656d 7328 295d 2929 0a0a  ets.items()]))..
-00003e60: 2020 2020 6465 6620 6765 745f 7061 6972      def get_pair
-00003e70: 5f71 756f 7465 5f63 7572 7265 6e63 7928  _quote_currency(
-00003e80: 7365 6c66 2c20 7061 6972 3a20 7374 7229  self, pair: str)
-00003e90: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-00003ea0: 2022 2222 2052 6574 7572 6e20 6120 7061   """ Return a pa
-00003eb0: 6972 2773 2071 756f 7465 2063 7572 7265  ir's quote curre
-00003ec0: 6e63 7920 2862 6173 652f 7175 6f74 653a  ncy (base/quote:
-00003ed0: 7365 7474 6c65 6d65 6e74 2920 2222 220a  settlement) """.
-00003ee0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00003ef0: 656c 662e 6d61 726b 6574 732e 6765 7428  elf.markets.get(
-00003f00: 7061 6972 2c20 7b7d 292e 6765 7428 2771  pair, {}).get('q
-00003f10: 756f 7465 272c 2027 2729 0a0a 2020 2020  uote', '')..    
-00003f20: 6465 6620 6765 745f 7061 6972 5f62 6173  def get_pair_bas
-00003f30: 655f 6375 7272 656e 6379 2873 656c 662c  e_currency(self,
-00003f40: 2070 6169 723a 2073 7472 2920 2d3e 2073   pair: str) -> s
-00003f50: 7472 3a0a 2020 2020 2020 2020 2222 2220  tr:.        """ 
-00003f60: 5265 7475 726e 2061 2070 6169 7227 7320  Return a pair's 
-00003f70: 6261 7365 2063 7572 7265 6e63 7920 2862  base currency (b
-00003f80: 6173 652f 7175 6f74 653a 7365 7474 6c65  ase/quote:settle
-00003f90: 6d65 6e74 2920 2222 220a 2020 2020 2020  ment) """.      
-00003fa0: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
-00003fb0: 726b 6574 732e 6765 7428 7061 6972 2c20  rkets.get(pair, 
-00003fc0: 7b7d 292e 6765 7428 2762 6173 6527 2c20  {}).get('base', 
-00003fd0: 2727 290a 0a20 2020 2064 6566 206d 6172  '')..    def mar
-00003fe0: 6b65 745f 6973 5f66 7574 7572 6528 7365  ket_is_future(se
-00003ff0: 6c66 2c20 6d61 726b 6574 3a20 4469 6374  lf, market: Dict
-00004000: 5b73 7472 2c20 416e 795d 2920 2d3e 2062  [str, Any]) -> b
-00004010: 6f6f 6c3a 0a20 2020 2020 2020 2072 6574  ool:.        ret
-00004020: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
-00004030: 2020 6d61 726b 6574 2e67 6574 2873 656c    market.get(sel
-00004040: 662e 5f66 745f 6861 735b 2263 6378 745f  f._ft_has["ccxt_
-00004050: 6675 7475 7265 735f 6e61 6d65 225d 2c20  futures_name"], 
-00004060: 4661 6c73 6529 2069 7320 5472 7565 2061  False) is True a
-00004070: 6e64 0a20 2020 2020 2020 2020 2020 206d  nd.            m
-00004080: 6172 6b65 742e 6765 7428 276c 696e 6561  arket.get('linea
-00004090: 7227 2c20 4661 6c73 6529 2069 7320 5472  r', False) is Tr
-000040a0: 7565 0a20 2020 2020 2020 2029 0a0a 2020  ue.        )..  
-000040b0: 2020 6465 6620 6d61 726b 6574 5f69 735f    def market_is_
-000040c0: 7370 6f74 2873 656c 662c 206d 6172 6b65  spot(self, marke
-000040d0: 743a 2044 6963 745b 7374 722c 2041 6e79  t: Dict[str, Any
-000040e0: 5d29 202d 3e20 626f 6f6c 3a0a 2020 2020  ]) -> bool:.    
-000040f0: 2020 2020 7265 7475 726e 206d 6172 6b65      return marke
-00004100: 742e 6765 7428 2773 706f 7427 2c20 4661  t.get('spot', Fa
-00004110: 6c73 6529 2069 7320 5472 7565 0a0a 2020  lse) is True..  
-00004120: 2020 6465 6620 6d61 726b 6574 5f69 735f    def market_is_
-00004130: 6d61 7267 696e 2873 656c 662c 206d 6172  margin(self, mar
-00004140: 6b65 743a 2044 6963 745b 7374 722c 2041  ket: Dict[str, A
-00004150: 6e79 5d29 202d 3e20 626f 6f6c 3a0a 2020  ny]) -> bool:.  
-00004160: 2020 2020 2020 7265 7475 726e 206d 6172        return mar
-00004170: 6b65 742e 6765 7428 276d 6172 6769 6e27  ket.get('margin'
-00004180: 2c20 4661 6c73 6529 2069 7320 5472 7565  , False) is True
-00004190: 0a0a 2020 2020 6465 6620 6d61 726b 6574  ..    def market
-000041a0: 5f69 735f 7472 6164 6162 6c65 2873 656c  _is_tradable(sel
-000041b0: 662c 206d 6172 6b65 743a 2044 6963 745b  f, market: Dict[
-000041c0: 7374 722c 2041 6e79 5d29 202d 3e20 626f  str, Any]) -> bo
-000041d0: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
-000041e0: 2020 2020 2020 2020 4368 6563 6b20 6966          Check if
-000041f0: 2074 6865 206d 6172 6b65 7420 7379 6d62   the market symb
-00004200: 6f6c 2069 7320 7472 6164 6162 6c65 2062  ol is tradable b
-00004210: 7920 4672 6571 7472 6164 652e 0a20 2020  y Freqtrade..   
-00004220: 2020 2020 2045 6e73 7572 6573 2074 6861       Ensures tha
-00004230: 7420 436f 6e66 6967 7572 6564 206d 6f64  t Configured mod
-00004240: 6520 616c 6967 6e73 2074 6f0a 2020 2020  e aligns to.    
-00004250: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00004260: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00004270: 2020 2020 206d 6172 6b65 742e 6765 7428       market.get(
-00004280: 2771 756f 7465 272c 204e 6f6e 6529 2069  'quote', None) i
-00004290: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
-000042a0: 2020 2020 2020 2061 6e64 206d 6172 6b65         and marke
-000042b0: 742e 6765 7428 2762 6173 6527 2c20 4e6f  t.get('base', No
-000042c0: 6e65 2920 6973 206e 6f74 204e 6f6e 650a  ne) is not None.
-000042d0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-000042e0: 2873 656c 662e 7072 6563 6973 696f 6e4d  (self.precisionM
-000042f0: 6f64 6520 213d 2054 4943 4b5f 5349 5a45  ode != TICK_SIZE
-00004300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004310: 2020 2320 546f 6f20 6c6f 7720 7072 6563    # Too low prec
-00004320: 6973 696f 6e20 7769 6c6c 2066 616c 7369  ision will falsi
-00004330: 6679 2063 616c 6375 6c61 7469 6f6e 730a  fy calculations.
-00004340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004350: 206f 7220 6d61 726b 6574 2e67 6574 2827   or market.get('
-00004360: 7072 6563 6973 696f 6e27 2c20 7b7d 292e  precision', {}).
-00004370: 6765 7428 2770 7269 6365 2729 203e 2031  get('price') > 1
-00004380: 652d 3131 290a 2020 2020 2020 2020 2020  e-11).          
-00004390: 2020 616e 6420 2828 7365 6c66 2e74 7261    and ((self.tra
-000043a0: 6469 6e67 5f6d 6f64 6520 3d3d 2054 7261  ding_mode == Tra
-000043b0: 6469 6e67 4d6f 6465 2e53 504f 5420 616e  dingMode.SPOT an
-000043c0: 6420 7365 6c66 2e6d 6172 6b65 745f 6973  d self.market_is
-000043d0: 5f73 706f 7428 6d61 726b 6574 2929 0a20  _spot(market)). 
-000043e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043f0: 6f72 2028 7365 6c66 2e74 7261 6469 6e67  or (self.trading
-00004400: 5f6d 6f64 6520 3d3d 2054 7261 6469 6e67  _mode == Trading
-00004410: 4d6f 6465 2e4d 4152 4749 4e20 616e 6420  Mode.MARGIN and 
-00004420: 7365 6c66 2e6d 6172 6b65 745f 6973 5f6d  self.market_is_m
-00004430: 6172 6769 6e28 6d61 726b 6574 2929 0a20  argin(market)). 
-00004440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004450: 6f72 2028 7365 6c66 2e74 7261 6469 6e67  or (self.trading
-00004460: 5f6d 6f64 6520 3d3d 2054 7261 6469 6e67  _mode == Trading
-00004470: 4d6f 6465 2e46 5554 5552 4553 2061 6e64  Mode.FUTURES and
-00004480: 2073 656c 662e 6d61 726b 6574 5f69 735f   self.market_is_
-00004490: 6675 7475 7265 286d 6172 6b65 7429 2929  future(market)))
-000044a0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000044b0: 6465 6620 6b6c 696e 6573 2873 656c 662c  def klines(self,
-000044c0: 2070 6169 725f 696e 7465 7276 616c 3a20   pair_interval: 
-000044d0: 5061 6972 5769 7468 5469 6d65 6672 616d  PairWithTimefram
-000044e0: 652c 2063 6f70 793a 2062 6f6f 6c20 3d20  e, copy: bool = 
-000044f0: 5472 7565 2920 2d3e 2044 6174 6146 7261  True) -> DataFra
-00004500: 6d65 3a0a 2020 2020 2020 2020 6966 2070  me:.        if p
-00004510: 6169 725f 696e 7465 7276 616c 2069 6e20  air_interval in 
-00004520: 7365 6c66 2e5f 6b6c 696e 6573 3a0a 2020  self._klines:.  
-00004530: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00004540: 2073 656c 662e 5f6b 6c69 6e65 735b 7061   self._klines[pa
-00004550: 6972 5f69 6e74 6572 7661 6c5d 2e63 6f70  ir_interval].cop
-00004560: 7928 2920 6966 2063 6f70 7920 656c 7365  y() if copy else
-00004570: 2073 656c 662e 5f6b 6c69 6e65 735b 7061   self._klines[pa
-00004580: 6972 5f69 6e74 6572 7661 6c5d 0a20 2020  ir_interval].   
-00004590: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000045a0: 2020 2020 2020 2072 6574 7572 6e20 4461         return Da
-000045b0: 7461 4672 616d 6528 290a 0a20 2020 2064  taFrame()..    d
-000045c0: 6566 2067 6574 5f63 6f6e 7472 6163 745f  ef get_contract_
-000045d0: 7369 7a65 2873 656c 662c 2070 6169 723a  size(self, pair:
-000045e0: 2073 7472 2920 2d3e 204f 7074 696f 6e61   str) -> Optiona
-000045f0: 6c5b 666c 6f61 745d 3a0a 2020 2020 2020  l[float]:.      
-00004600: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
-00004610: 675f 6d6f 6465 203d 3d20 5472 6164 696e  g_mode == Tradin
-00004620: 674d 6f64 652e 4655 5455 5245 533a 0a20  gMode.FUTURES:. 
-00004630: 2020 2020 2020 2020 2020 206d 6172 6b65             marke
-00004640: 7420 3d20 7365 6c66 2e6d 6172 6b65 7473  t = self.markets
-00004650: 2e67 6574 2870 6169 722c 207b 7d29 0a20  .get(pair, {}). 
-00004660: 2020 2020 2020 2020 2020 2063 6f6e 7472             contr
-00004670: 6163 745f 7369 7a65 3a20 666c 6f61 7420  act_size: float 
-00004680: 3d20 312e 300a 2020 2020 2020 2020 2020  = 1.0.          
-00004690: 2020 6966 206e 6f74 206d 6172 6b65 743a    if not market:
-000046a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000046b0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-000046c0: 2020 2020 2020 2020 2069 6620 6d61 726b           if mark
-000046d0: 6574 2e67 6574 2827 636f 6e74 7261 6374  et.get('contract
-000046e0: 5369 7a65 2729 2069 7320 6e6f 7420 4e6f  Size') is not No
-000046f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00004700: 2020 2020 2320 6363 7874 2068 6173 2063      # ccxt has c
-00004710: 6f6e 7472 6163 7453 697a 6520 696e 206d  ontractSize in m
-00004720: 6172 6b65 7473 2061 7320 7374 7269 6e67  arkets as string
-00004730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004740: 2063 6f6e 7472 6163 745f 7369 7a65 203d   contract_size =
-00004750: 2066 6c6f 6174 286d 6172 6b65 745b 2763   float(market['c
-00004760: 6f6e 7472 6163 7453 697a 6527 5d29 0a20  ontractSize']). 
-00004770: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00004780: 6e20 636f 6e74 7261 6374 5f73 697a 650a  n contract_size.
-00004790: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000047a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000047b0: 2031 0a0a 2020 2020 6465 6620 5f74 7261   1..    def _tra
-000047c0: 6465 735f 636f 6e74 7261 6374 735f 746f  des_contracts_to
-000047d0: 5f61 6d6f 756e 7428 7365 6c66 2c20 7472  _amount(self, tr
-000047e0: 6164 6573 3a20 4c69 7374 2920 2d3e 204c  ades: List) -> L
-000047f0: 6973 743a 0a20 2020 2020 2020 2069 6620  ist:.        if 
-00004800: 6c65 6e28 7472 6164 6573 2920 3e20 3020  len(trades) > 0 
-00004810: 616e 6420 2773 796d 626f 6c27 2069 6e20  and 'symbol' in 
-00004820: 7472 6164 6573 5b30 5d3a 0a20 2020 2020  trades[0]:.     
-00004830: 2020 2020 2020 2063 6f6e 7472 6163 745f         contract_
-00004840: 7369 7a65 203d 2073 656c 662e 6765 745f  size = self.get_
-00004850: 636f 6e74 7261 6374 5f73 697a 6528 7472  contract_size(tr
-00004860: 6164 6573 5b30 5d5b 2773 796d 626f 6c27  ades[0]['symbol'
-00004870: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
-00004880: 6620 636f 6e74 7261 6374 5f73 697a 6520  f contract_size 
-00004890: 213d 2031 3a0a 2020 2020 2020 2020 2020  != 1:.          
-000048a0: 2020 2020 2020 666f 7220 7472 6164 6520        for trade 
-000048b0: 696e 2074 7261 6465 733a 0a20 2020 2020  in trades:.     
-000048c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000048d0: 7261 6465 5b27 616d 6f75 6e74 275d 203d  rade['amount'] =
-000048e0: 2074 7261 6465 5b27 616d 6f75 6e74 275d   trade['amount']
-000048f0: 202a 2063 6f6e 7472 6163 745f 7369 7a65   * contract_size
-00004900: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004910: 7472 6164 6573 0a0a 2020 2020 6465 6620  trades..    def 
-00004920: 5f6f 7264 6572 5f63 6f6e 7472 6163 7473  _order_contracts
-00004930: 5f74 6f5f 616d 6f75 6e74 2873 656c 662c  _to_amount(self,
-00004940: 206f 7264 6572 3a20 4469 6374 2920 2d3e   order: Dict) ->
-00004950: 2044 6963 743a 0a20 2020 2020 2020 2069   Dict:.        i
-00004960: 6620 2773 796d 626f 6c27 2069 6e20 6f72  f 'symbol' in or
-00004970: 6465 7220 616e 6420 6f72 6465 725b 2773  der and order['s
-00004980: 796d 626f 6c27 5d20 6973 206e 6f74 204e  ymbol'] is not N
-00004990: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000049a0: 2063 6f6e 7472 6163 745f 7369 7a65 203d   contract_size =
-000049b0: 2073 656c 662e 6765 745f 636f 6e74 7261   self.get_contra
-000049c0: 6374 5f73 697a 6528 6f72 6465 725b 2773  ct_size(order['s
-000049d0: 796d 626f 6c27 5d29 0a20 2020 2020 2020  ymbol']).       
-000049e0: 2020 2020 2069 6620 636f 6e74 7261 6374       if contract
-000049f0: 5f73 697a 6520 213d 2031 3a0a 2020 2020  _size != 1:.    
-00004a00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00004a10: 7072 6f70 2069 6e20 7365 6c66 2e5f 6674  prop in self._ft
-00004a20: 5f68 6173 2e67 6574 2827 6f72 6465 725f  _has.get('order_
-00004a30: 7072 6f70 735f 696e 5f63 6f6e 7472 6163  props_in_contrac
-00004a40: 7473 272c 205b 5d29 3a0a 2020 2020 2020  ts', []):.      
-00004a50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00004a60: 2070 726f 7020 696e 206f 7264 6572 2061   prop in order a
-00004a70: 6e64 206f 7264 6572 5b70 726f 705d 2069  nd order[prop] i
-00004a80: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00004a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004aa0: 2020 2020 6f72 6465 725b 7072 6f70 5d20      order[prop] 
-00004ab0: 3d20 6f72 6465 725b 7072 6f70 5d20 2a20  = order[prop] * 
-00004ac0: 636f 6e74 7261 6374 5f73 697a 650a 2020  contract_size.  
-00004ad0: 2020 2020 2020 7265 7475 726e 206f 7264        return ord
-00004ae0: 6572 0a0a 2020 2020 6465 6620 5f61 6d6f  er..    def _amo
-00004af0: 756e 745f 746f 5f63 6f6e 7472 6163 7473  unt_to_contracts
-00004b00: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-00004b10: 2c20 616d 6f75 6e74 3a20 666c 6f61 7429  , amount: float)
-00004b20: 202d 3e20 666c 6f61 743a 0a0a 2020 2020   -> float:..    
-00004b30: 2020 2020 636f 6e74 7261 6374 5f73 697a      contract_siz
-00004b40: 6520 3d20 7365 6c66 2e67 6574 5f63 6f6e  e = self.get_con
-00004b50: 7472 6163 745f 7369 7a65 2870 6169 7229  tract_size(pair)
-00004b60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004b70: 616d 6f75 6e74 5f74 6f5f 636f 6e74 7261  amount_to_contra
-00004b80: 6374 7328 616d 6f75 6e74 2c20 636f 6e74  cts(amount, cont
-00004b90: 7261 6374 5f73 697a 6529 0a0a 2020 2020  ract_size)..    
-00004ba0: 6465 6620 5f63 6f6e 7472 6163 7473 5f74  def _contracts_t
-00004bb0: 6f5f 616d 6f75 6e74 2873 656c 662c 2070  o_amount(self, p
-00004bc0: 6169 723a 2073 7472 2c20 6e75 6d5f 636f  air: str, num_co
-00004bd0: 6e74 7261 6374 733a 2066 6c6f 6174 2920  ntracts: float) 
-00004be0: 2d3e 2066 6c6f 6174 3a0a 0a20 2020 2020  -> float:..     
-00004bf0: 2020 2063 6f6e 7472 6163 745f 7369 7a65     contract_size
-00004c00: 203d 2073 656c 662e 6765 745f 636f 6e74   = self.get_cont
-00004c10: 7261 6374 5f73 697a 6528 7061 6972 290a  ract_size(pair).
-00004c20: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00004c30: 6f6e 7472 6163 7473 5f74 6f5f 616d 6f75  ontracts_to_amou
-00004c40: 6e74 286e 756d 5f63 6f6e 7472 6163 7473  nt(num_contracts
-00004c50: 2c20 636f 6e74 7261 6374 5f73 697a 6529  , contract_size)
-00004c60: 0a0a 2020 2020 6465 6620 616d 6f75 6e74  ..    def amount
-00004c70: 5f74 6f5f 636f 6e74 7261 6374 5f70 7265  _to_contract_pre
-00004c80: 6369 7369 6f6e 2873 656c 662c 2070 6169  cision(self, pai
-00004c90: 723a 2073 7472 2c20 616d 6f75 6e74 3a20  r: str, amount: 
-00004ca0: 666c 6f61 7429 202d 3e20 666c 6f61 743a  float) -> float:
-00004cb0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00004cc0: 2020 2020 2048 656c 7065 7220 7772 6170       Helper wrap
-00004cd0: 7065 7220 6172 6f75 6e64 2061 6d6f 756e  per around amoun
-00004ce0: 745f 746f 5f63 6f6e 7472 6163 745f 7072  t_to_contract_pr
-00004cf0: 6563 6973 696f 6e0a 2020 2020 2020 2020  ecision.        
-00004d00: 2222 220a 2020 2020 2020 2020 636f 6e74  """.        cont
-00004d10: 7261 6374 5f73 697a 6520 3d20 7365 6c66  ract_size = self
-00004d20: 2e67 6574 5f63 6f6e 7472 6163 745f 7369  .get_contract_si
-00004d30: 7a65 2870 6169 7229 0a0a 2020 2020 2020  ze(pair)..      
-00004d40: 2020 7265 7475 726e 2061 6d6f 756e 745f    return amount_
-00004d50: 746f 5f63 6f6e 7472 6163 745f 7072 6563  to_contract_prec
-00004d60: 6973 696f 6e28 616d 6f75 6e74 2c20 7365  ision(amount, se
-00004d70: 6c66 2e67 6574 5f70 7265 6369 7369 6f6e  lf.get_precision
-00004d80: 5f61 6d6f 756e 7428 7061 6972 292c 0a20  _amount(pair),. 
-00004d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004db0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004dc0: 7072 6563 6973 696f 6e4d 6f64 652c 2063  precisionMode, c
-00004dd0: 6f6e 7472 6163 745f 7369 7a65 290a 0a20  ontract_size).. 
-00004de0: 2020 2064 6566 2073 6574 5f73 616e 6462     def set_sandb
-00004df0: 6f78 2873 656c 662c 2061 7069 3a20 6363  ox(self, api: cc
-00004e00: 7874 2e45 7863 6861 6e67 652c 2065 7863  xt.Exchange, exc
-00004e10: 6861 6e67 655f 636f 6e66 6967 3a20 6469  hange_config: di
-00004e20: 6374 2c20 6e61 6d65 3a20 7374 7229 202d  ct, name: str) -
-00004e30: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00004e40: 6966 2065 7863 6861 6e67 655f 636f 6e66  if exchange_conf
-00004e50: 6967 2e67 6574 2827 7361 6e64 626f 7827  ig.get('sandbox'
-00004e60: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00004e70: 6620 6170 692e 7572 6c73 2e67 6574 2827  f api.urls.get('
-00004e80: 7465 7374 2729 3a0a 2020 2020 2020 2020  test'):.        
-00004e90: 2020 2020 2020 2020 6170 692e 7572 6c73          api.urls
-00004ea0: 5b27 6170 6927 5d20 3d20 6170 692e 7572  ['api'] = api.ur
-00004eb0: 6c73 5b27 7465 7374 275d 0a20 2020 2020  ls['test'].     
-00004ec0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00004ed0: 722e 696e 666f 2822 456e 6162 6c65 6420  r.info("Enabled 
-00004ee0: 5361 6e64 626f 7820 4150 4920 6f6e 2025  Sandbox API on %
-00004ef0: 7322 2c20 6e61 6d65 290a 2020 2020 2020  s", name).      
-00004f00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00004f10: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00004f20: 6572 2e77 6172 6e69 6e67 280a 2020 2020  er.warning(.    
+00003b90: 7473 2e69 7465 6d73 2829 2069 6620 765b  ts.items() if v[
+00003ba0: 2771 756f 7465 275d 2069 6e20 7175 6f74  'quote'] in quot
+00003bb0: 655f 6375 7272 656e 6369 6573 7d0a 2020  e_currencies}.  
+00003bc0: 2020 2020 2020 6966 2074 7261 6461 626c        if tradabl
+00003bd0: 655f 6f6e 6c79 3a0a 2020 2020 2020 2020  e_only:.        
+00003be0: 2020 2020 6d61 726b 6574 7320 3d20 7b6b      markets = {k
+00003bf0: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
+00003c00: 6d61 726b 6574 732e 6974 656d 7328 2920  markets.items() 
+00003c10: 6966 2073 656c 662e 6d61 726b 6574 5f69  if self.market_i
+00003c20: 735f 7472 6164 6162 6c65 2876 297d 0a20  s_tradable(v)}. 
+00003c30: 2020 2020 2020 2069 6620 7370 6f74 5f6f         if spot_o
+00003c40: 6e6c 793a 0a20 2020 2020 2020 2020 2020  nly:.           
+00003c50: 206d 6172 6b65 7473 203d 207b 6b3a 2076   markets = {k: v
+00003c60: 2066 6f72 206b 2c20 7620 696e 206d 6172   for k, v in mar
+00003c70: 6b65 7473 2e69 7465 6d73 2829 2069 6620  kets.items() if 
+00003c80: 7365 6c66 2e6d 6172 6b65 745f 6973 5f73  self.market_is_s
+00003c90: 706f 7428 7629 7d0a 2020 2020 2020 2020  pot(v)}.        
+00003ca0: 6966 206d 6172 6769 6e5f 6f6e 6c79 3a0a  if margin_only:.
+00003cb0: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
+00003cc0: 6574 7320 3d20 7b6b 3a20 7620 666f 7220  ets = {k: v for 
+00003cd0: 6b2c 2076 2069 6e20 6d61 726b 6574 732e  k, v in markets.
+00003ce0: 6974 656d 7328 2920 6966 2073 656c 662e  items() if self.
+00003cf0: 6d61 726b 6574 5f69 735f 6d61 7267 696e  market_is_margin
+00003d00: 2876 297d 0a20 2020 2020 2020 2069 6620  (v)}.        if 
+00003d10: 6675 7475 7265 735f 6f6e 6c79 3a0a 2020  futures_only:.  
+00003d20: 2020 2020 2020 2020 2020 6d61 726b 6574            market
+00003d30: 7320 3d20 7b6b 3a20 7620 666f 7220 6b2c  s = {k: v for k,
+00003d40: 2076 2069 6e20 6d61 726b 6574 732e 6974   v in markets.it
+00003d50: 656d 7328 2920 6966 2073 656c 662e 6d61  ems() if self.ma
+00003d60: 726b 6574 5f69 735f 6675 7475 7265 2876  rket_is_future(v
+00003d70: 297d 0a20 2020 2020 2020 2069 6620 6163  )}.        if ac
+00003d80: 7469 7665 5f6f 6e6c 793a 0a20 2020 2020  tive_only:.     
+00003d90: 2020 2020 2020 206d 6172 6b65 7473 203d         markets =
+00003da0: 207b 6b3a 2076 2066 6f72 206b 2c20 7620   {k: v for k, v 
+00003db0: 696e 206d 6172 6b65 7473 2e69 7465 6d73  in markets.items
+00003dc0: 2829 2069 6620 6d61 726b 6574 5f69 735f  () if market_is_
+00003dd0: 6163 7469 7665 2876 297d 0a20 2020 2020  active(v)}.     
+00003de0: 2020 2072 6574 7572 6e20 6d61 726b 6574     return market
+00003df0: 730a 0a20 2020 2064 6566 2067 6574 5f71  s..    def get_q
+00003e00: 756f 7465 5f63 7572 7265 6e63 6965 7328  uote_currencies(
+00003e10: 7365 6c66 2920 2d3e 204c 6973 745b 7374  self) -> List[st
+00003e20: 725d 3a0a 2020 2020 2020 2020 2222 220a  r]:.        """.
+00003e30: 2020 2020 2020 2020 5265 7475 726e 2061          Return a
+00003e40: 206c 6973 7420 6f66 2073 7570 706f 7274   list of support
+00003e50: 6564 2071 756f 7465 2063 7572 7265 6e63  ed quote currenc
+00003e60: 6965 730a 2020 2020 2020 2020 2222 220a  ies.        """.
+00003e70: 2020 2020 2020 2020 6d61 726b 6574 7320          markets 
+00003e80: 3d20 7365 6c66 2e6d 6172 6b65 7473 0a20  = self.markets. 
+00003e90: 2020 2020 2020 2072 6574 7572 6e20 736f         return so
+00003ea0: 7274 6564 2873 6574 285b 785b 2771 756f  rted(set([x['quo
+00003eb0: 7465 275d 2066 6f72 205f 2c20 7820 696e  te'] for _, x in
+00003ec0: 206d 6172 6b65 7473 2e69 7465 6d73 2829   markets.items()
+00003ed0: 5d29 290a 0a20 2020 2064 6566 2067 6574  ]))..    def get
+00003ee0: 5f70 6169 725f 7175 6f74 655f 6375 7272  _pair_quote_curr
+00003ef0: 656e 6379 2873 656c 662c 2070 6169 723a  ency(self, pair:
+00003f00: 2073 7472 2920 2d3e 2073 7472 3a0a 2020   str) -> str:.  
+00003f10: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
+00003f20: 2061 2070 6169 7227 7320 7175 6f74 6520   a pair's quote 
+00003f30: 6375 7272 656e 6379 2028 6261 7365 2f71  currency (base/q
+00003f40: 756f 7465 3a73 6574 746c 656d 656e 7429  uote:settlement)
+00003f50: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00003f60: 7572 6e20 7365 6c66 2e6d 6172 6b65 7473  urn self.markets
+00003f70: 2e67 6574 2870 6169 722c 207b 7d29 2e67  .get(pair, {}).g
+00003f80: 6574 2827 7175 6f74 6527 2c20 2727 290a  et('quote', '').
+00003f90: 0a20 2020 2064 6566 2067 6574 5f70 6169  .    def get_pai
+00003fa0: 725f 6261 7365 5f63 7572 7265 6e63 7928  r_base_currency(
+00003fb0: 7365 6c66 2c20 7061 6972 3a20 7374 7229  self, pair: str)
+00003fc0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+00003fd0: 2022 2222 2052 6574 7572 6e20 6120 7061   """ Return a pa
+00003fe0: 6972 2773 2062 6173 6520 6375 7272 656e  ir's base curren
+00003ff0: 6379 2028 6261 7365 2f71 756f 7465 3a73  cy (base/quote:s
+00004000: 6574 746c 656d 656e 7429 2022 2222 0a20  ettlement) """. 
+00004010: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00004020: 6c66 2e6d 6172 6b65 7473 2e67 6574 2870  lf.markets.get(p
+00004030: 6169 722c 207b 7d29 2e67 6574 2827 6261  air, {}).get('ba
+00004040: 7365 272c 2027 2729 0a0a 2020 2020 6465  se', '')..    de
+00004050: 6620 6d61 726b 6574 5f69 735f 6675 7475  f market_is_futu
+00004060: 7265 2873 656c 662c 206d 6172 6b65 743a  re(self, market:
+00004070: 2044 6963 745b 7374 722c 2041 6e79 5d29   Dict[str, Any])
+00004080: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00004090: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+000040a0: 2020 2020 2020 206d 6172 6b65 742e 6765         market.ge
+000040b0: 7428 7365 6c66 2e5f 6674 5f68 6173 5b22  t(self._ft_has["
+000040c0: 6363 7874 5f66 7574 7572 6573 5f6e 616d  ccxt_futures_nam
+000040d0: 6522 5d2c 2046 616c 7365 2920 6973 2054  e"], False) is T
+000040e0: 7275 6520 616e 640a 2020 2020 2020 2020  rue and.        
+000040f0: 2020 2020 6d61 726b 6574 2e67 6574 2827      market.get('
+00004100: 6c69 6e65 6172 272c 2046 616c 7365 2920  linear', False) 
+00004110: 6973 2054 7275 650a 2020 2020 2020 2020  is True.        
+00004120: 290a 0a20 2020 2064 6566 206d 6172 6b65  )..    def marke
+00004130: 745f 6973 5f73 706f 7428 7365 6c66 2c20  t_is_spot(self, 
+00004140: 6d61 726b 6574 3a20 4469 6374 5b73 7472  market: Dict[str
+00004150: 2c20 416e 795d 2920 2d3e 2062 6f6f 6c3a  , Any]) -> bool:
+00004160: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00004170: 6d61 726b 6574 2e67 6574 2827 7370 6f74  market.get('spot
+00004180: 272c 2046 616c 7365 2920 6973 2054 7275  ', False) is Tru
+00004190: 650a 0a20 2020 2064 6566 206d 6172 6b65  e..    def marke
+000041a0: 745f 6973 5f6d 6172 6769 6e28 7365 6c66  t_is_margin(self
+000041b0: 2c20 6d61 726b 6574 3a20 4469 6374 5b73  , market: Dict[s
+000041c0: 7472 2c20 416e 795d 2920 2d3e 2062 6f6f  tr, Any]) -> boo
+000041d0: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
+000041e0: 6e20 6d61 726b 6574 2e67 6574 2827 6d61  n market.get('ma
+000041f0: 7267 696e 272c 2046 616c 7365 2920 6973  rgin', False) is
+00004200: 2054 7275 650a 0a20 2020 2064 6566 206d   True..    def m
+00004210: 6172 6b65 745f 6973 5f74 7261 6461 626c  arket_is_tradabl
+00004220: 6528 7365 6c66 2c20 6d61 726b 6574 3a20  e(self, market: 
+00004230: 4469 6374 5b73 7472 2c20 416e 795d 2920  Dict[str, Any]) 
+00004240: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+00004250: 2022 2222 0a20 2020 2020 2020 2043 6865   """.        Che
+00004260: 636b 2069 6620 7468 6520 6d61 726b 6574  ck if the market
+00004270: 2073 796d 626f 6c20 6973 2074 7261 6461   symbol is trada
+00004280: 626c 6520 6279 2046 7265 7174 7261 6465  ble by Freqtrade
+00004290: 2e0a 2020 2020 2020 2020 456e 7375 7265  ..        Ensure
+000042a0: 7320 7468 6174 2043 6f6e 6669 6775 7265  s that Configure
+000042b0: 6420 6d6f 6465 2061 6c69 676e 7320 746f  d mode aligns to
+000042c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000042d0: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
+000042e0: 2020 2020 2020 2020 2020 6d61 726b 6574            market
+000042f0: 2e67 6574 2827 7175 6f74 6527 2c20 4e6f  .get('quote', No
+00004300: 6e65 2920 6973 206e 6f74 204e 6f6e 650a  ne) is not None.
+00004310: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00004320: 6d61 726b 6574 2e67 6574 2827 6261 7365  market.get('base
+00004330: 272c 204e 6f6e 6529 2069 7320 6e6f 7420  ', None) is not 
+00004340: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00004350: 2061 6e64 2028 7365 6c66 2e70 7265 6369   and (self.preci
+00004360: 7369 6f6e 4d6f 6465 2021 3d20 5449 434b  sionMode != TICK
+00004370: 5f53 495a 450a 2020 2020 2020 2020 2020  _SIZE.          
+00004380: 2020 2020 2020 2023 2054 6f6f 206c 6f77         # Too low
+00004390: 2070 7265 6369 7369 6f6e 2077 696c 6c20   precision will 
+000043a0: 6661 6c73 6966 7920 6361 6c63 756c 6174  falsify calculat
+000043b0: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+000043c0: 2020 2020 2020 6f72 206d 6172 6b65 742e        or market.
+000043d0: 6765 7428 2770 7265 6369 7369 6f6e 272c  get('precision',
+000043e0: 207b 7d29 2e67 6574 2827 7072 6963 6527   {}).get('price'
+000043f0: 2920 3e20 3165 2d31 3129 0a20 2020 2020  ) > 1e-11).     
+00004400: 2020 2020 2020 2061 6e64 2028 2873 656c         and ((sel
+00004410: 662e 7472 6164 696e 675f 6d6f 6465 203d  f.trading_mode =
+00004420: 3d20 5472 6164 696e 674d 6f64 652e 5350  = TradingMode.SP
+00004430: 4f54 2061 6e64 2073 656c 662e 6d61 726b  OT and self.mark
+00004440: 6574 5f69 735f 7370 6f74 286d 6172 6b65  et_is_spot(marke
+00004450: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
+00004460: 2020 2020 206f 7220 2873 656c 662e 7472       or (self.tr
+00004470: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
+00004480: 6164 696e 674d 6f64 652e 4d41 5247 494e  adingMode.MARGIN
+00004490: 2061 6e64 2073 656c 662e 6d61 726b 6574   and self.market
+000044a0: 5f69 735f 6d61 7267 696e 286d 6172 6b65  _is_margin(marke
+000044b0: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
+000044c0: 2020 2020 206f 7220 2873 656c 662e 7472       or (self.tr
+000044d0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
+000044e0: 6164 696e 674d 6f64 652e 4655 5455 5245  adingMode.FUTURE
+000044f0: 5320 616e 6420 7365 6c66 2e6d 6172 6b65  S and self.marke
+00004500: 745f 6973 5f66 7574 7572 6528 6d61 726b  t_is_future(mark
+00004510: 6574 2929 290a 2020 2020 2020 2020 290a  et))).        ).
+00004520: 0a20 2020 2064 6566 206b 6c69 6e65 7328  .    def klines(
+00004530: 7365 6c66 2c20 7061 6972 5f69 6e74 6572  self, pair_inter
+00004540: 7661 6c3a 2050 6169 7257 6974 6854 696d  val: PairWithTim
+00004550: 6566 7261 6d65 2c20 636f 7079 3a20 626f  eframe, copy: bo
+00004560: 6f6c 203d 2054 7275 6529 202d 3e20 4461  ol = True) -> Da
+00004570: 7461 4672 616d 653a 0a20 2020 2020 2020  taFrame:.       
+00004580: 2069 6620 7061 6972 5f69 6e74 6572 7661   if pair_interva
+00004590: 6c20 696e 2073 656c 662e 5f6b 6c69 6e65  l in self._kline
+000045a0: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+000045b0: 6574 7572 6e20 7365 6c66 2e5f 6b6c 696e  eturn self._klin
+000045c0: 6573 5b70 6169 725f 696e 7465 7276 616c  es[pair_interval
+000045d0: 5d2e 636f 7079 2829 2069 6620 636f 7079  ].copy() if copy
+000045e0: 2065 6c73 6520 7365 6c66 2e5f 6b6c 696e   else self._klin
+000045f0: 6573 5b70 6169 725f 696e 7465 7276 616c  es[pair_interval
+00004600: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
+00004610: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00004620: 726e 2044 6174 6146 7261 6d65 2829 0a0a  rn DataFrame()..
+00004630: 2020 2020 6465 6620 6765 745f 636f 6e74      def get_cont
+00004640: 7261 6374 5f73 697a 6528 7365 6c66 2c20  ract_size(self, 
+00004650: 7061 6972 3a20 7374 7229 202d 3e20 4f70  pair: str) -> Op
+00004660: 7469 6f6e 616c 5b66 6c6f 6174 5d3a 0a20  tional[float]:. 
+00004670: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
+00004680: 7261 6469 6e67 5f6d 6f64 6520 3d3d 2054  rading_mode == T
+00004690: 7261 6469 6e67 4d6f 6465 2e46 5554 5552  radingMode.FUTUR
+000046a0: 4553 3a0a 2020 2020 2020 2020 2020 2020  ES:.            
+000046b0: 6d61 726b 6574 203d 2073 656c 662e 6d61  market = self.ma
+000046c0: 726b 6574 732e 6765 7428 7061 6972 2c20  rkets.get(pair, 
+000046d0: 7b7d 290a 2020 2020 2020 2020 2020 2020  {}).            
+000046e0: 636f 6e74 7261 6374 5f73 697a 653a 2066  contract_size: f
+000046f0: 6c6f 6174 203d 2031 2e30 0a20 2020 2020  loat = 1.0.     
+00004700: 2020 2020 2020 2069 6620 6e6f 7420 6d61         if not ma
+00004710: 726b 6574 3a0a 2020 2020 2020 2020 2020  rket:.          
+00004720: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00004730: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+00004740: 206d 6172 6b65 742e 6765 7428 2763 6f6e   market.get('con
+00004750: 7472 6163 7453 697a 6527 2920 6973 206e  tractSize') is n
+00004760: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00004770: 2020 2020 2020 2020 2023 2063 6378 7420           # ccxt 
+00004780: 6861 7320 636f 6e74 7261 6374 5369 7a65  has contractSize
+00004790: 2069 6e20 6d61 726b 6574 7320 6173 2073   in markets as s
+000047a0: 7472 696e 670a 2020 2020 2020 2020 2020  tring.          
+000047b0: 2020 2020 2020 636f 6e74 7261 6374 5f73        contract_s
+000047c0: 697a 6520 3d20 666c 6f61 7428 6d61 726b  ize = float(mark
+000047d0: 6574 5b27 636f 6e74 7261 6374 5369 7a65  et['contractSize
+000047e0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+000047f0: 7265 7475 726e 2063 6f6e 7472 6163 745f  return contract_
+00004800: 7369 7a65 0a20 2020 2020 2020 2065 6c73  size.        els
+00004810: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00004820: 6574 7572 6e20 310a 0a20 2020 2064 6566  eturn 1..    def
+00004830: 205f 7472 6164 6573 5f63 6f6e 7472 6163   _trades_contrac
+00004840: 7473 5f74 6f5f 616d 6f75 6e74 2873 656c  ts_to_amount(sel
+00004850: 662c 2074 7261 6465 733a 204c 6973 7429  f, trades: List)
+00004860: 202d 3e20 4c69 7374 3a0a 2020 2020 2020   -> List:.      
+00004870: 2020 6966 206c 656e 2874 7261 6465 7329    if len(trades)
+00004880: 203e 2030 2061 6e64 2027 7379 6d62 6f6c   > 0 and 'symbol
+00004890: 2720 696e 2074 7261 6465 735b 305d 3a0a  ' in trades[0]:.
+000048a0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000048b0: 7261 6374 5f73 697a 6520 3d20 7365 6c66  ract_size = self
+000048c0: 2e67 6574 5f63 6f6e 7472 6163 745f 7369  .get_contract_si
+000048d0: 7a65 2874 7261 6465 735b 305d 5b27 7379  ze(trades[0]['sy
+000048e0: 6d62 6f6c 275d 290a 2020 2020 2020 2020  mbol']).        
+000048f0: 2020 2020 6966 2063 6f6e 7472 6163 745f      if contract_
+00004900: 7369 7a65 2021 3d20 313a 0a20 2020 2020  size != 1:.     
+00004910: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+00004920: 7261 6465 2069 6e20 7472 6164 6573 3a0a  rade in trades:.
+00004930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004940: 2020 2020 7472 6164 655b 2761 6d6f 756e      trade['amoun
+00004950: 7427 5d20 3d20 7472 6164 655b 2761 6d6f  t'] = trade['amo
+00004960: 756e 7427 5d20 2a20 636f 6e74 7261 6374  unt'] * contract
+00004970: 5f73 697a 650a 2020 2020 2020 2020 7265  _size.        re
+00004980: 7475 726e 2074 7261 6465 730a 0a20 2020  turn trades..   
+00004990: 2064 6566 205f 6f72 6465 725f 636f 6e74   def _order_cont
+000049a0: 7261 6374 735f 746f 5f61 6d6f 756e 7428  racts_to_amount(
+000049b0: 7365 6c66 2c20 6f72 6465 723a 2044 6963  self, order: Dic
+000049c0: 7429 202d 3e20 4469 6374 3a0a 2020 2020  t) -> Dict:.    
+000049d0: 2020 2020 6966 2027 7379 6d62 6f6c 2720      if 'symbol' 
+000049e0: 696e 206f 7264 6572 2061 6e64 206f 7264  in order and ord
+000049f0: 6572 5b27 7379 6d62 6f6c 275d 2069 7320  er['symbol'] is 
+00004a00: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00004a10: 2020 2020 2020 636f 6e74 7261 6374 5f73        contract_s
+00004a20: 697a 6520 3d20 7365 6c66 2e67 6574 5f63  ize = self.get_c
+00004a30: 6f6e 7472 6163 745f 7369 7a65 286f 7264  ontract_size(ord
+00004a40: 6572 5b27 7379 6d62 6f6c 275d 290a 2020  er['symbol']).  
+00004a50: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
+00004a60: 7472 6163 745f 7369 7a65 2021 3d20 313a  tract_size != 1:
+00004a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004a80: 2066 6f72 2070 726f 7020 696e 2073 656c   for prop in sel
+00004a90: 662e 5f66 745f 6861 732e 6765 7428 276f  f._ft_has.get('o
+00004aa0: 7264 6572 5f70 726f 7073 5f69 6e5f 636f  rder_props_in_co
+00004ab0: 6e74 7261 6374 7327 2c20 5b5d 293a 0a20  ntracts', []):. 
+00004ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ad0: 2020 2069 6620 7072 6f70 2069 6e20 6f72     if prop in or
+00004ae0: 6465 7220 616e 6420 6f72 6465 725b 7072  der and order[pr
+00004af0: 6f70 5d20 6973 206e 6f74 204e 6f6e 653a  op] is not None:
+00004b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004b10: 2020 2020 2020 2020 206f 7264 6572 5b70           order[p
+00004b20: 726f 705d 203d 206f 7264 6572 5b70 726f  rop] = order[pro
+00004b30: 705d 202a 2063 6f6e 7472 6163 745f 7369  p] * contract_si
+00004b40: 7a65 0a20 2020 2020 2020 2072 6574 7572  ze.        retur
+00004b50: 6e20 6f72 6465 720a 0a20 2020 2064 6566  n order..    def
+00004b60: 205f 616d 6f75 6e74 5f74 6f5f 636f 6e74   _amount_to_cont
+00004b70: 7261 6374 7328 7365 6c66 2c20 7061 6972  racts(self, pair
+00004b80: 3a20 7374 722c 2061 6d6f 756e 743a 2066  : str, amount: f
+00004b90: 6c6f 6174 2920 2d3e 2066 6c6f 6174 3a0a  loat) -> float:.
+00004ba0: 0a20 2020 2020 2020 2063 6f6e 7472 6163  .        contrac
+00004bb0: 745f 7369 7a65 203d 2073 656c 662e 6765  t_size = self.ge
+00004bc0: 745f 636f 6e74 7261 6374 5f73 697a 6528  t_contract_size(
+00004bd0: 7061 6972 290a 2020 2020 2020 2020 7265  pair).        re
+00004be0: 7475 726e 2061 6d6f 756e 745f 746f 5f63  turn amount_to_c
+00004bf0: 6f6e 7472 6163 7473 2861 6d6f 756e 742c  ontracts(amount,
+00004c00: 2063 6f6e 7472 6163 745f 7369 7a65 290a   contract_size).
+00004c10: 0a20 2020 2064 6566 205f 636f 6e74 7261  .    def _contra
+00004c20: 6374 735f 746f 5f61 6d6f 756e 7428 7365  cts_to_amount(se
+00004c30: 6c66 2c20 7061 6972 3a20 7374 722c 206e  lf, pair: str, n
+00004c40: 756d 5f63 6f6e 7472 6163 7473 3a20 666c  um_contracts: fl
+00004c50: 6f61 7429 202d 3e20 666c 6f61 743a 0a0a  oat) -> float:..
+00004c60: 2020 2020 2020 2020 636f 6e74 7261 6374          contract
+00004c70: 5f73 697a 6520 3d20 7365 6c66 2e67 6574  _size = self.get
+00004c80: 5f63 6f6e 7472 6163 745f 7369 7a65 2870  _contract_size(p
+00004c90: 6169 7229 0a20 2020 2020 2020 2072 6574  air).        ret
+00004ca0: 7572 6e20 636f 6e74 7261 6374 735f 746f  urn contracts_to
+00004cb0: 5f61 6d6f 756e 7428 6e75 6d5f 636f 6e74  _amount(num_cont
+00004cc0: 7261 6374 732c 2063 6f6e 7472 6163 745f  racts, contract_
+00004cd0: 7369 7a65 290a 0a20 2020 2064 6566 2061  size)..    def a
+00004ce0: 6d6f 756e 745f 746f 5f63 6f6e 7472 6163  mount_to_contrac
+00004cf0: 745f 7072 6563 6973 696f 6e28 7365 6c66  t_precision(self
+00004d00: 2c20 7061 6972 3a20 7374 722c 2061 6d6f  , pair: str, amo
+00004d10: 756e 743a 2066 6c6f 6174 2920 2d3e 2066  unt: float) -> f
+00004d20: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
+00004d30: 220a 2020 2020 2020 2020 4865 6c70 6572  ".        Helper
+00004d40: 2077 7261 7070 6572 2061 726f 756e 6420   wrapper around 
+00004d50: 616d 6f75 6e74 5f74 6f5f 636f 6e74 7261  amount_to_contra
+00004d60: 6374 5f70 7265 6369 7369 6f6e 0a20 2020  ct_precision.   
+00004d70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00004d80: 2063 6f6e 7472 6163 745f 7369 7a65 203d   contract_size =
+00004d90: 2073 656c 662e 6765 745f 636f 6e74 7261   self.get_contra
+00004da0: 6374 5f73 697a 6528 7061 6972 290a 0a20  ct_size(pair).. 
+00004db0: 2020 2020 2020 2072 6574 7572 6e20 616d         return am
+00004dc0: 6f75 6e74 5f74 6f5f 636f 6e74 7261 6374  ount_to_contract
+00004dd0: 5f70 7265 6369 7369 6f6e 2861 6d6f 756e  _precision(amoun
+00004de0: 742c 2073 656c 662e 6765 745f 7072 6563  t, self.get_prec
+00004df0: 6973 696f 6e5f 616d 6f75 6e74 2870 6169  ision_amount(pai
+00004e00: 7229 2c0a 2020 2020 2020 2020 2020 2020  r),.            
+00004e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e30: 7365 6c66 2e70 7265 6369 7369 6f6e 4d6f  self.precisionMo
+00004e40: 6465 2c20 636f 6e74 7261 6374 5f73 697a  de, contract_siz
+00004e50: 6529 0a0a 2020 2020 6465 6620 7365 745f  e)..    def set_
+00004e60: 7361 6e64 626f 7828 7365 6c66 2c20 6170  sandbox(self, ap
+00004e70: 693a 2063 6378 742e 4578 6368 616e 6765  i: ccxt.Exchange
+00004e80: 2c20 6578 6368 616e 6765 5f63 6f6e 6669  , exchange_confi
+00004e90: 673a 2064 6963 742c 206e 616d 653a 2073  g: dict, name: s
+00004ea0: 7472 2920 2d3e 204e 6f6e 653a 0a20 2020  tr) -> None:.   
+00004eb0: 2020 2020 2069 6620 6578 6368 616e 6765       if exchange
+00004ec0: 5f63 6f6e 6669 672e 6765 7428 2773 616e  _config.get('san
+00004ed0: 6462 6f78 2729 3a0a 2020 2020 2020 2020  dbox'):.        
+00004ee0: 2020 2020 6966 2061 7069 2e75 726c 732e      if api.urls.
+00004ef0: 6765 7428 2774 6573 7427 293a 0a20 2020  get('test'):.   
+00004f00: 2020 2020 2020 2020 2020 2020 2061 7069               api
+00004f10: 2e75 726c 735b 2761 7069 275d 203d 2061  .urls['api'] = a
+00004f20: 7069 2e75 726c 735b 2774 6573 7427 5d0a  pi.urls['test'].
 00004f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f40: 6622 4e6f 2053 616e 6462 6f78 2055 524c  f"No Sandbox URL
-00004f50: 2069 6e20 4343 5854 2066 6f72 207b 6e61   in CCXT for {na
-00004f60: 6d65 7d2c 2065 7869 7469 6e67 2e20 506c  me}, exiting. Pl
-00004f70: 6561 7365 2063 6865 636b 2079 6f75 7220  ease check your 
-00004f80: 636f 6e66 6967 2e6a 736f 6e22 290a 2020  config.json").  
-00004f90: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00004fa0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-00004fb0: 7863 6570 7469 6f6e 2866 2745 7863 6861  xception(f'Excha
-00004fc0: 6e67 6520 7b6e 616d 657d 2064 6f65 7320  nge {name} does 
-00004fd0: 6e6f 7420 7072 6f76 6964 6520 6120 7361  not provide a sa
-00004fe0: 6e64 626f 7820 6170 6927 290a 0a20 2020  ndbox api')..   
-00004ff0: 2064 6566 205f 6c6f 6164 5f61 7379 6e63   def _load_async
-00005000: 5f6d 6172 6b65 7473 2873 656c 662c 2072  _markets(self, r
-00005010: 656c 6f61 643a 2062 6f6f 6c20 3d20 4661  eload: bool = Fa
-00005020: 6c73 6529 202d 3e20 4e6f 6e65 3a0a 2020  lse) -> None:.  
-00005030: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00005040: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00005050: 6170 695f 6173 796e 633a 0a20 2020 2020  api_async:.     
-00005060: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005070: 6c6f 6f70 2e72 756e 5f75 6e74 696c 5f63  loop.run_until_c
-00005080: 6f6d 706c 6574 6528 0a20 2020 2020 2020  omplete(.       
-00005090: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000050a0: 662e 5f61 7069 5f61 7379 6e63 2e6c 6f61  f._api_async.loa
-000050b0: 645f 6d61 726b 6574 7328 7265 6c6f 6164  d_markets(reload
-000050c0: 3d72 656c 6f61 642c 2070 6172 616d 733d  =reload, params=
-000050d0: 7b7d 2929 0a0a 2020 2020 2020 2020 6578  {}))..        ex
-000050e0: 6365 7074 2028 6173 796e 6369 6f2e 5469  cept (asyncio.Ti
-000050f0: 6d65 6f75 7445 7272 6f72 2c20 6363 7874  meoutError, ccxt
-00005100: 2e42 6173 6545 7272 6f72 2920 6173 2065  .BaseError) as e
-00005110: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-00005120: 6767 6572 2e77 6172 6e69 6e67 2827 436f  gger.warning('Co
-00005130: 756c 6420 6e6f 7420 6c6f 6164 2061 7379  uld not load asy
-00005140: 6e63 206d 6172 6b65 7473 2e20 5265 6173  nc markets. Reas
-00005150: 6f6e 3a20 2573 272c 2065 290a 2020 2020  on: %s', e).    
-00005160: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00005170: 2020 2020 6465 6620 5f6c 6f61 645f 6d61      def _load_ma
-00005180: 726b 6574 7328 7365 6c66 2920 2d3e 204e  rkets(self) -> N
-00005190: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-000051a0: 2049 6e69 7469 616c 697a 6520 6d61 726b   Initialize mark
-000051b0: 6574 7320 626f 7468 2073 796e 6320 616e  ets both sync an
-000051c0: 6420 6173 796e 6320 2222 220a 2020 2020  d async """.    
-000051d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000051e0: 2020 2020 2073 656c 662e 5f6d 6172 6b65       self._marke
-000051f0: 7473 203d 2073 656c 662e 5f61 7069 2e6c  ts = self._api.l
-00005200: 6f61 645f 6d61 726b 6574 7328 7061 7261  oad_markets(para
-00005210: 6d73 3d7b 7d29 0a20 2020 2020 2020 2020  ms={}).         
-00005220: 2020 2073 656c 662e 5f6c 6f61 645f 6173     self._load_as
-00005230: 796e 635f 6d61 726b 6574 7328 290a 2020  ync_markets().  
-00005240: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00005250: 6c61 7374 5f6d 6172 6b65 7473 5f72 6566  last_markets_ref
-00005260: 7265 7368 203d 2061 7272 6f77 2e75 7463  resh = arrow.utc
-00005270: 6e6f 7728 292e 696e 745f 7469 6d65 7374  now().int_timest
-00005280: 616d 700a 2020 2020 2020 2020 2020 2020  amp.            
-00005290: 6966 2073 656c 662e 5f66 745f 6861 735b  if self._ft_has[
-000052a0: 276e 6565 6473 5f74 7261 6469 6e67 5f66  'needs_trading_f
-000052b0: 6565 7327 5d3a 0a20 2020 2020 2020 2020  ees']:.         
-000052c0: 2020 2020 2020 2073 656c 662e 5f74 7261         self._tra
-000052d0: 6469 6e67 5f66 6565 7320 3d20 7365 6c66  ding_fees = self
-000052e0: 2e66 6574 6368 5f74 7261 6469 6e67 5f66  .fetch_trading_f
-000052f0: 6565 7328 290a 0a20 2020 2020 2020 2065  ees()..        e
-00005300: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
-00005310: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00005320: 2020 6c6f 6767 6572 2e65 7863 6570 7469    logger.excepti
-00005330: 6f6e 2827 556e 6162 6c65 2074 6f20 696e  on('Unable to in
-00005340: 6974 6961 6c69 7a65 206d 6172 6b65 7473  itialize markets
-00005350: 2e27 290a 0a20 2020 2064 6566 2072 656c  .')..    def rel
-00005360: 6f61 645f 6d61 726b 6574 7328 7365 6c66  oad_markets(self
-00005370: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00005380: 2020 2022 2222 5265 6c6f 6164 206d 6172     """Reload mar
-00005390: 6b65 7473 2062 6f74 6820 7379 6e63 2061  kets both sync a
-000053a0: 6e64 2061 7379 6e63 2069 6620 7265 6672  nd async if refr
-000053b0: 6573 6820 696e 7465 7276 616c 2068 6173  esh interval has
-000053c0: 2070 6173 7365 6420 2222 220a 2020 2020   passed """.    
-000053d0: 2020 2020 2320 4368 6563 6b20 7768 6574      # Check whet
-000053e0: 6865 7220 6d61 726b 6574 7320 6861 7665  her markets have
-000053f0: 2074 6f20 6265 2072 656c 6f61 6465 640a   to be reloaded.
-00005400: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
-00005410: 2e5f 6c61 7374 5f6d 6172 6b65 7473 5f72  ._last_markets_r
-00005420: 6566 7265 7368 203e 2030 2920 616e 6420  efresh > 0) and 
-00005430: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00005440: 2020 7365 6c66 2e5f 6c61 7374 5f6d 6172    self._last_mar
-00005450: 6b65 7473 5f72 6566 7265 7368 202b 2073  kets_refresh + s
-00005460: 656c 662e 6d61 726b 6574 735f 7265 6672  elf.markets_refr
-00005470: 6573 685f 696e 7465 7276 616c 0a20 2020  esh_interval.   
-00005480: 2020 2020 2020 2020 2020 2020 203e 2061               > a
-00005490: 7272 6f77 2e75 7463 6e6f 7728 292e 696e  rrow.utcnow().in
-000054a0: 745f 7469 6d65 7374 616d 7029 3a0a 2020  t_timestamp):.  
-000054b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000054c0: 204e 6f6e 650a 2020 2020 2020 2020 6c6f   None.        lo
-000054d0: 6767 6572 2e64 6562 7567 2822 5065 7266  gger.debug("Perf
-000054e0: 6f72 6d69 6e67 2073 6368 6564 756c 6564  orming scheduled
-000054f0: 206d 6172 6b65 7420 7265 6c6f 6164 2e2e   market reload..
-00005500: 2229 0a20 2020 2020 2020 2074 7279 3a0a  ").        try:.
-00005510: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005520: 2e5f 6d61 726b 6574 7320 3d20 7365 6c66  ._markets = self
-00005530: 2e5f 6170 692e 6c6f 6164 5f6d 6172 6b65  ._api.load_marke
-00005540: 7473 2872 656c 6f61 643d 5472 7565 2c20  ts(reload=True, 
-00005550: 7061 7261 6d73 3d7b 7d29 0a20 2020 2020  params={}).     
-00005560: 2020 2020 2020 2023 2041 6c73 6f20 7265         # Also re
-00005570: 6c6f 6164 2061 7379 6e63 206d 6172 6b65  load async marke
-00005580: 7473 2074 6f20 6176 6f69 6420 6973 7375  ts to avoid issu
-00005590: 6573 2077 6974 6820 6e65 776c 7920 6c69  es with newly li
-000055a0: 7374 6564 2070 6169 7273 0a20 2020 2020  sted pairs.     
-000055b0: 2020 2020 2020 2073 656c 662e 5f6c 6f61         self._loa
-000055c0: 645f 6173 796e 635f 6d61 726b 6574 7328  d_async_markets(
-000055d0: 7265 6c6f 6164 3d54 7275 6529 0a20 2020  reload=True).   
-000055e0: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-000055f0: 6173 745f 6d61 726b 6574 735f 7265 6672  ast_markets_refr
-00005600: 6573 6820 3d20 6172 726f 772e 7574 636e  esh = arrow.utcn
-00005610: 6f77 2829 2e69 6e74 5f74 696d 6573 7461  ow().int_timesta
-00005620: 6d70 0a20 2020 2020 2020 2020 2020 2073  mp.            s
-00005630: 656c 662e 6669 6c6c 5f6c 6576 6572 6167  elf.fill_leverag
-00005640: 655f 7469 6572 7328 290a 2020 2020 2020  e_tiers().      
-00005650: 2020 6578 6365 7074 2063 6378 742e 4261    except ccxt.Ba
-00005660: 7365 4572 726f 723a 0a20 2020 2020 2020  seError:.       
-00005670: 2020 2020 206c 6f67 6765 722e 6578 6365       logger.exce
-00005680: 7074 696f 6e28 2243 6f75 6c64 206e 6f74  ption("Could not
-00005690: 2072 656c 6f61 6420 6d61 726b 6574 732e   reload markets.
-000056a0: 2229 0a0a 2020 2020 6465 6620 7661 6c69  ")..    def vali
-000056b0: 6461 7465 5f73 7461 6b65 6375 7272 656e  date_stakecurren
-000056c0: 6379 2873 656c 662c 2073 7461 6b65 5f63  cy(self, stake_c
-000056d0: 7572 7265 6e63 793a 2073 7472 2920 2d3e  urrency: str) ->
-000056e0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-000056f0: 2222 0a20 2020 2020 2020 2043 6865 636b  "".        Check
-00005700: 7320 7374 616b 652d 6375 7272 656e 6379  s stake-currency
-00005710: 2061 6761 696e 7374 2061 7661 696c 6162   against availab
-00005720: 6c65 2063 7572 7265 6e63 6965 7320 6f6e  le currencies on
-00005730: 2074 6865 2065 7863 6861 6e67 652e 0a20   the exchange.. 
-00005740: 2020 2020 2020 204f 6e6c 7920 7275 6e73         Only runs
-00005750: 206f 6e20 7374 6172 7475 702e 2049 6620   on startup. If 
-00005760: 6d61 726b 6574 7320 6861 7665 206e 6f74  markets have not
-00005770: 2062 6565 6e20 6c6f 6164 6564 2c20 7468   been loaded, th
-00005780: 6572 6527 7320 6265 656e 2061 2070 726f  ere's been a pro
-00005790: 626c 656d 2077 6974 680a 2020 2020 2020  blem with.      
-000057a0: 2020 7468 6520 636f 6e6e 6563 7469 6f6e    the connection
-000057b0: 2074 6f20 7468 6520 6578 6368 616e 6765   to the exchange
-000057c0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000057d0: 2073 7461 6b65 5f63 7572 7265 6e63 793a   stake_currency:
-000057e0: 2053 7461 6b65 2d63 7572 7265 6e63 7920   Stake-currency 
-000057f0: 746f 2076 616c 6964 6174 650a 2020 2020  to validate.    
-00005800: 2020 2020 3a72 6169 7365 3a20 4f70 6572      :raise: Oper
-00005810: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
-00005820: 2069 6620 7374 616b 652d 6375 7272 656e   if stake-curren
-00005830: 6379 2069 7320 6e6f 7420 6176 6169 6c61  cy is not availa
-00005840: 626c 652e 0a20 2020 2020 2020 2022 2222  ble..        """
-00005850: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00005860: 7365 6c66 2e5f 6d61 726b 6574 733a 0a20  self._markets:. 
-00005870: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00004f40: 6c6f 6767 6572 2e69 6e66 6f28 2245 6e61  logger.info("Ena
+00004f50: 626c 6564 2053 616e 6462 6f78 2041 5049  bled Sandbox API
+00004f60: 206f 6e20 2573 222c 206e 616d 6529 0a20   on %s", name). 
+00004f70: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00004f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f90: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
+00004fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004fb0: 2020 2020 2066 224e 6f20 5361 6e64 626f       f"No Sandbo
+00004fc0: 7820 5552 4c20 696e 2043 4358 5420 666f  x URL in CCXT fo
+00004fd0: 7220 7b6e 616d 657d 2c20 6578 6974 696e  r {name}, exitin
+00004fe0: 672e 2050 6c65 6173 6520 6368 6563 6b20  g. Please check 
+00004ff0: 796f 7572 2063 6f6e 6669 672e 6a73 6f6e  your config.json
+00005000: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00005010: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+00005020: 6f6e 616c 4578 6365 7074 696f 6e28 6627  onalException(f'
+00005030: 4578 6368 616e 6765 207b 6e61 6d65 7d20  Exchange {name} 
+00005040: 646f 6573 206e 6f74 2070 726f 7669 6465  does not provide
+00005050: 2061 2073 616e 6462 6f78 2061 7069 2729   a sandbox api')
+00005060: 0a0a 2020 2020 6465 6620 5f6c 6f61 645f  ..    def _load_
+00005070: 6173 796e 635f 6d61 726b 6574 7328 7365  async_markets(se
+00005080: 6c66 2c20 7265 6c6f 6164 3a20 626f 6f6c  lf, reload: bool
+00005090: 203d 2046 616c 7365 2920 2d3e 204e 6f6e   = False) -> Non
+000050a0: 653a 0a20 2020 2020 2020 2074 7279 3a0a  e:.        try:.
+000050b0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000050c0: 656c 662e 5f61 7069 5f61 7379 6e63 3a0a  elf._api_async:.
+000050d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000050e0: 7365 6c66 2e6c 6f6f 702e 7275 6e5f 756e  self.loop.run_un
+000050f0: 7469 6c5f 636f 6d70 6c65 7465 280a 2020  til_complete(.  
+00005100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005110: 2020 7365 6c66 2e5f 6170 695f 6173 796e    self._api_asyn
+00005120: 632e 6c6f 6164 5f6d 6172 6b65 7473 2872  c.load_markets(r
+00005130: 656c 6f61 643d 7265 6c6f 6164 2c20 7061  eload=reload, pa
+00005140: 7261 6d73 3d7b 7d29 290a 0a20 2020 2020  rams={}))..     
+00005150: 2020 2065 7863 6570 7420 2861 7379 6e63     except (async
+00005160: 696f 2e54 696d 656f 7574 4572 726f 722c  io.TimeoutError,
+00005170: 2063 6378 742e 4261 7365 4572 726f 7229   ccxt.BaseError)
+00005180: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00005190: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
+000051a0: 6728 2743 6f75 6c64 206e 6f74 206c 6f61  g('Could not loa
+000051b0: 6420 6173 796e 6320 6d61 726b 6574 732e  d async markets.
+000051c0: 2052 6561 736f 6e3a 2025 7327 2c20 6529   Reason: %s', e)
+000051d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000051e0: 7572 6e0a 0a20 2020 2064 6566 205f 6c6f  urn..    def _lo
+000051f0: 6164 5f6d 6172 6b65 7473 2873 656c 6629  ad_markets(self)
+00005200: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00005210: 2020 2222 2220 496e 6974 6961 6c69 7a65    """ Initialize
+00005220: 206d 6172 6b65 7473 2062 6f74 6820 7379   markets both sy
+00005230: 6e63 2061 6e64 2061 7379 6e63 2022 2222  nc and async """
+00005240: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00005250: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00005260: 6d61 726b 6574 7320 3d20 7365 6c66 2e5f  markets = self._
+00005270: 6170 692e 6c6f 6164 5f6d 6172 6b65 7473  api.load_markets
+00005280: 2870 6172 616d 733d 7b7d 290a 2020 2020  (params={}).    
+00005290: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
+000052a0: 6164 5f61 7379 6e63 5f6d 6172 6b65 7473  ad_async_markets
+000052b0: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+000052c0: 656c 662e 5f6c 6173 745f 6d61 726b 6574  elf._last_market
+000052d0: 735f 7265 6672 6573 6820 3d20 6172 726f  s_refresh = arro
+000052e0: 772e 7574 636e 6f77 2829 2e69 6e74 5f74  w.utcnow().int_t
+000052f0: 696d 6573 7461 6d70 0a20 2020 2020 2020  imestamp.       
+00005300: 2020 2020 2069 6620 7365 6c66 2e5f 6674       if self._ft
+00005310: 5f68 6173 5b27 6e65 6564 735f 7472 6164  _has['needs_trad
+00005320: 696e 675f 6665 6573 275d 3a0a 2020 2020  ing_fees']:.    
+00005330: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005340: 2e5f 7472 6164 696e 675f 6665 6573 203d  ._trading_fees =
+00005350: 2073 656c 662e 6665 7463 685f 7472 6164   self.fetch_trad
+00005360: 696e 675f 6665 6573 2829 0a0a 2020 2020  ing_fees()..    
+00005370: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+00005380: 4261 7365 4572 726f 723a 0a20 2020 2020  BaseError:.     
+00005390: 2020 2020 2020 206c 6f67 6765 722e 6578         logger.ex
+000053a0: 6365 7074 696f 6e28 2755 6e61 626c 6520  ception('Unable 
+000053b0: 746f 2069 6e69 7469 616c 697a 6520 6d61  to initialize ma
+000053c0: 726b 6574 732e 2729 0a0a 2020 2020 6465  rkets.')..    de
+000053d0: 6620 7265 6c6f 6164 5f6d 6172 6b65 7473  f reload_markets
+000053e0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000053f0: 2020 2020 2020 2020 2222 2252 656c 6f61          """Reloa
+00005400: 6420 6d61 726b 6574 7320 626f 7468 2073  d markets both s
+00005410: 796e 6320 616e 6420 6173 796e 6320 6966  ync and async if
+00005420: 2072 6566 7265 7368 2069 6e74 6572 7661   refresh interva
+00005430: 6c20 6861 7320 7061 7373 6564 2022 2222  l has passed """
+00005440: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
+00005450: 2077 6865 7468 6572 206d 6172 6b65 7473   whether markets
+00005460: 2068 6176 6520 746f 2062 6520 7265 6c6f   have to be relo
+00005470: 6164 6564 0a20 2020 2020 2020 2069 6620  aded.        if 
+00005480: 2873 656c 662e 5f6c 6173 745f 6d61 726b  (self._last_mark
+00005490: 6574 735f 7265 6672 6573 6820 3e20 3029  ets_refresh > 0)
+000054a0: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
+000054b0: 2020 2020 2020 2073 656c 662e 5f6c 6173         self._las
+000054c0: 745f 6d61 726b 6574 735f 7265 6672 6573  t_markets_refres
+000054d0: 6820 2b20 7365 6c66 2e6d 6172 6b65 7473  h + self.markets
+000054e0: 5f72 6566 7265 7368 5f69 6e74 6572 7661  _refresh_interva
+000054f0: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00005500: 2020 3e20 6172 726f 772e 7574 636e 6f77    > arrow.utcnow
+00005510: 2829 2e69 6e74 5f74 696d 6573 7461 6d70  ().int_timestamp
+00005520: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00005530: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+00005540: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+00005550: 2250 6572 666f 726d 696e 6720 7363 6865  "Performing sche
+00005560: 6475 6c65 6420 6d61 726b 6574 2072 656c  duled market rel
+00005570: 6f61 642e 2e22 290a 2020 2020 2020 2020  oad..").        
+00005580: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00005590: 2073 656c 662e 5f6d 6172 6b65 7473 203d   self._markets =
+000055a0: 2073 656c 662e 5f61 7069 2e6c 6f61 645f   self._api.load_
+000055b0: 6d61 726b 6574 7328 7265 6c6f 6164 3d54  markets(reload=T
+000055c0: 7275 652c 2070 6172 616d 733d 7b7d 290a  rue, params={}).
+000055d0: 2020 2020 2020 2020 2020 2020 2320 416c              # Al
+000055e0: 736f 2072 656c 6f61 6420 6173 796e 6320  so reload async 
+000055f0: 6d61 726b 6574 7320 746f 2061 766f 6964  markets to avoid
+00005600: 2069 7373 7565 7320 7769 7468 206e 6577   issues with new
+00005610: 6c79 206c 6973 7465 6420 7061 6972 730a  ly listed pairs.
+00005620: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005630: 2e5f 6c6f 6164 5f61 7379 6e63 5f6d 6172  ._load_async_mar
+00005640: 6b65 7473 2872 656c 6f61 643d 5472 7565  kets(reload=True
+00005650: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00005660: 6c66 2e5f 6c61 7374 5f6d 6172 6b65 7473  lf._last_markets
+00005670: 5f72 6566 7265 7368 203d 2061 7272 6f77  _refresh = arrow
+00005680: 2e75 7463 6e6f 7728 292e 696e 745f 7469  .utcnow().int_ti
+00005690: 6d65 7374 616d 700a 2020 2020 2020 2020  mestamp.        
+000056a0: 2020 2020 7365 6c66 2e66 696c 6c5f 6c65      self.fill_le
+000056b0: 7665 7261 6765 5f74 6965 7273 2829 0a20  verage_tiers(). 
+000056c0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+000056d0: 7874 2e42 6173 6545 7272 6f72 3a0a 2020  xt.BaseError:.  
+000056e0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+000056f0: 2e65 7863 6570 7469 6f6e 2822 436f 756c  .exception("Coul
+00005700: 6420 6e6f 7420 7265 6c6f 6164 206d 6172  d not reload mar
+00005710: 6b65 7473 2e22 290a 0a20 2020 2064 6566  kets.")..    def
+00005720: 2076 616c 6964 6174 655f 7374 616b 6563   validate_stakec
+00005730: 7572 7265 6e63 7928 7365 6c66 2c20 7374  urrency(self, st
+00005740: 616b 655f 6375 7272 656e 6379 3a20 7374  ake_currency: st
+00005750: 7229 202d 3e20 4e6f 6e65 3a0a 2020 2020  r) -> None:.    
+00005760: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00005770: 4368 6563 6b73 2073 7461 6b65 2d63 7572  Checks stake-cur
+00005780: 7265 6e63 7920 6167 6169 6e73 7420 6176  rency against av
+00005790: 6169 6c61 626c 6520 6375 7272 656e 6369  ailable currenci
+000057a0: 6573 206f 6e20 7468 6520 6578 6368 616e  es on the exchan
+000057b0: 6765 2e0a 2020 2020 2020 2020 4f6e 6c79  ge..        Only
+000057c0: 2072 756e 7320 6f6e 2073 7461 7274 7570   runs on startup
+000057d0: 2e20 4966 206d 6172 6b65 7473 2068 6176  . If markets hav
+000057e0: 6520 6e6f 7420 6265 656e 206c 6f61 6465  e not been loade
+000057f0: 642c 2074 6865 7265 2773 2062 6565 6e20  d, there's been 
+00005800: 6120 7072 6f62 6c65 6d20 7769 7468 0a20  a problem with. 
+00005810: 2020 2020 2020 2074 6865 2063 6f6e 6e65         the conne
+00005820: 6374 696f 6e20 746f 2074 6865 2065 7863  ction to the exc
+00005830: 6861 6e67 652e 0a20 2020 2020 2020 203a  hange..        :
+00005840: 7061 7261 6d20 7374 616b 655f 6375 7272  param stake_curr
+00005850: 656e 6379 3a20 5374 616b 652d 6375 7272  ency: Stake-curr
+00005860: 656e 6379 2074 6f20 7661 6c69 6461 7465  ency to validate
+00005870: 0a20 2020 2020 2020 203a 7261 6973 653a  .        :raise:
 00005880: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-00005890: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
-000058a0: 2020 2020 2020 2027 436f 756c 6420 6e6f         'Could no
-000058b0: 7420 6c6f 6164 206d 6172 6b65 7473 2c20  t load markets, 
-000058c0: 7468 6572 6566 6f72 6520 6361 6e6e 6f74  therefore cannot
-000058d0: 2073 7461 7274 2e20 270a 2020 2020 2020   start. '.      
-000058e0: 2020 2020 2020 2020 2020 2750 6c65 6173            'Pleas
-000058f0: 6520 696e 7665 7374 6967 6174 6520 7468  e investigate th
-00005900: 6520 6162 6f76 6520 6572 726f 7220 666f  e above error fo
-00005910: 7220 6d6f 7265 2064 6574 6169 6c73 2e27  r more details.'
-00005920: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00005930: 2020 2020 2020 2071 756f 7465 5f63 7572         quote_cur
-00005940: 7265 6e63 6965 7320 3d20 7365 6c66 2e67  rencies = self.g
-00005950: 6574 5f71 756f 7465 5f63 7572 7265 6e63  et_quote_currenc
-00005960: 6965 7328 290a 2020 2020 2020 2020 6966  ies().        if
-00005970: 2073 7461 6b65 5f63 7572 7265 6e63 7920   stake_currency 
-00005980: 6e6f 7420 696e 2071 756f 7465 5f63 7572  not in quote_cur
-00005990: 7265 6e63 6965 733a 0a20 2020 2020 2020  rencies:.       
-000059a0: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-000059b0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-000059c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000059d0: 2066 227b 7374 616b 655f 6375 7272 656e   f"{stake_curren
-000059e0: 6379 7d20 6973 206e 6f74 2061 7661 696c  cy} is not avail
-000059f0: 6162 6c65 2061 7320 7374 616b 6520 6f6e  able as stake on
-00005a00: 207b 7365 6c66 2e6e 616d 657d 2e20 220a   {self.name}. ".
-00005a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a20: 6622 4176 6169 6c61 626c 6520 6375 7272  f"Available curr
-00005a30: 656e 6369 6573 2061 7265 3a20 7b27 2c20  encies are: {', 
-00005a40: 272e 6a6f 696e 2871 756f 7465 5f63 7572  '.join(quote_cur
-00005a50: 7265 6e63 6965 7329 7d22 290a 0a20 2020  rencies)}")..   
-00005a60: 2064 6566 2076 616c 6964 6174 655f 7061   def validate_pa
-00005a70: 6972 7328 7365 6c66 2c20 7061 6972 733a  irs(self, pairs:
-00005a80: 204c 6973 745b 7374 725d 2920 2d3e 204e   List[str]) -> N
-00005a90: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00005aa0: 0a20 2020 2020 2020 2043 6865 636b 7320  .        Checks 
-00005ab0: 6966 2061 6c6c 2067 6976 656e 2070 6169  if all given pai
-00005ac0: 7273 2061 7265 2074 7261 6461 626c 6520  rs are tradable 
-00005ad0: 6f6e 2074 6865 2063 7572 7265 6e74 2065  on the current e
-00005ae0: 7863 6861 6e67 652e 0a20 2020 2020 2020  xchange..       
-00005af0: 203a 7061 7261 6d20 7061 6972 733a 206c   :param pairs: l
-00005b00: 6973 7420 6f66 2070 6169 7273 0a20 2020  ist of pairs.   
-00005b10: 2020 2020 203a 7261 6973 653a 204f 7065       :raise: Ope
-00005b20: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-00005b30: 6e20 6966 206f 6e65 2070 6169 7220 6973  n if one pair is
-00005b40: 206e 6f74 2061 7661 696c 6162 6c65 0a20   not available. 
-00005b50: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-00005b60: 4e6f 6e65 0a20 2020 2020 2020 2022 2222  None.        """
-00005b70: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00005b80: 2073 656c 662e 6d61 726b 6574 733a 0a20   self.markets:. 
-00005b90: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00005ba0: 722e 7761 726e 696e 6728 2755 6e61 626c  r.warning('Unabl
-00005bb0: 6520 746f 2076 616c 6964 6174 6520 7061  e to validate pa
-00005bc0: 6972 7320 2861 7373 756d 696e 6720 7468  irs (assuming th
-00005bd0: 6579 2061 7265 2063 6f72 7265 6374 292e  ey are correct).
-00005be0: 2729 0a20 2020 2020 2020 2020 2020 2072  ').            r
-00005bf0: 6574 7572 6e0a 2020 2020 2020 2020 6578  eturn.        ex
-00005c00: 7465 6e64 6564 5f70 6169 7273 203d 2065  tended_pairs = e
-00005c10: 7870 616e 645f 7061 6972 6c69 7374 2870  xpand_pairlist(p
-00005c20: 6169 7273 2c20 6c69 7374 2873 656c 662e  airs, list(self.
-00005c30: 6d61 726b 6574 7329 2c20 6b65 6570 5f69  markets), keep_i
-00005c40: 6e76 616c 6964 3d54 7275 6529 0a20 2020  nvalid=True).   
-00005c50: 2020 2020 2069 6e76 616c 6964 5f70 6169       invalid_pai
-00005c60: 7273 203d 205b 5d0a 2020 2020 2020 2020  rs = [].        
-00005c70: 666f 7220 7061 6972 2069 6e20 6578 7465  for pair in exte
-00005c80: 6e64 6564 5f70 6169 7273 3a0a 2020 2020  nded_pairs:.    
-00005c90: 2020 2020 2020 2020 2320 4e6f 7465 3a20          # Note: 
-00005ca0: 6363 7874 2068 6173 2042 6173 6543 7572  ccxt has BaseCur
-00005cb0: 7265 6e63 792f 5175 6f74 6543 7572 7265  rency/QuoteCurre
-00005cc0: 6e63 7920 666f 726d 6174 2066 6f72 2070  ncy format for p
-00005cd0: 6169 7273 0a20 2020 2020 2020 2020 2020  airs.           
-00005ce0: 2069 6620 7365 6c66 2e6d 6172 6b65 7473   if self.markets
-00005cf0: 2061 6e64 2070 6169 7220 6e6f 7420 696e   and pair not in
-00005d00: 2073 656c 662e 6d61 726b 6574 733a 0a20   self.markets:. 
-00005d10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00005d20: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
-00005d30: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
-00005d40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00005d50: 2750 6169 7220 7b70 6169 727d 2069 7320  'Pair {pair} is 
-00005d60: 6e6f 7420 6176 6169 6c61 626c 6520 6f6e  not available on
-00005d70: 207b 7365 6c66 2e6e 616d 657d 207b 7365   {self.name} {se
-00005d80: 6c66 2e74 7261 6469 6e67 5f6d 6f64 652e  lf.trading_mode.
-00005d90: 7661 6c75 657d 2e20 270a 2020 2020 2020  value}. '.      
-00005da0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-00005db0: 506c 6561 7365 2072 656d 6f76 6520 7b70  Please remove {p
-00005dc0: 6169 727d 2066 726f 6d20 796f 7572 2077  air} from your w
-00005dd0: 6869 7465 6c69 7374 2e27 290a 0a20 2020  hitelist.')..   
-00005de0: 2020 2020 2020 2020 2020 2020 2023 2046               # F
-00005df0: 726f 6d20 6363 7874 2044 6f63 756d 656e  rom ccxt Documen
-00005e00: 7461 7469 6f6e 3a0a 2020 2020 2020 2020  tation:.        
-00005e10: 2020 2020 2020 2020 2320 6d61 726b 6574          # market
-00005e20: 732e 696e 666f 3a20 416e 2061 7373 6f63  s.info: An assoc
-00005e30: 6961 7469 7665 2061 7272 6179 206f 6620  iative array of 
-00005e40: 6e6f 6e2d 636f 6d6d 6f6e 206d 6172 6b65  non-common marke
-00005e50: 7420 7072 6f70 6572 7469 6573 2c0a 2020  t properties,.  
-00005e60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00005e70: 696e 636c 7564 696e 6720 6665 6573 2c20  including fees, 
-00005e80: 7261 7465 732c 206c 696d 6974 7320 616e  rates, limits an
-00005e90: 6420 6f74 6865 7220 6765 6e65 7261 6c20  d other general 
-00005ea0: 6d61 726b 6574 2069 6e66 6f72 6d61 7469  market informati
-00005eb0: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-00005ec0: 2020 2020 2320 5468 6520 696e 7465 726e      # The intern
-00005ed0: 616c 2069 6e66 6f20 6172 7261 7920 6973  al info array is
-00005ee0: 2064 6966 6665 7265 6e74 2066 6f72 2065   different for e
-00005ef0: 6163 6820 7061 7274 6963 756c 6172 206d  ach particular m
-00005f00: 6172 6b65 742c 0a20 2020 2020 2020 2020  arket,.         
-00005f10: 2020 2020 2020 2023 2069 7473 2063 6f6e         # its con
-00005f20: 7465 6e74 7320 6465 7065 6e64 206f 6e20  tents depend on 
-00005f30: 7468 6520 6578 6368 616e 6765 2e0a 2020  the exchange..  
-00005f40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00005f50: 4974 2063 616e 2061 6c73 6f20 6265 2061  It can also be a
-00005f60: 2073 7472 696e 6720 6f72 2073 696d 696c   string or simil
-00005f70: 6172 202e 2e2e 2073 6f20 7765 206e 6565  ar ... so we nee
-00005f80: 6420 746f 2076 6572 6966 7920 7468 6174  d to verify that
-00005f90: 2066 6972 7374 2e0a 2020 2020 2020 2020   first..        
-00005fa0: 2020 2020 656c 6966 2028 6973 696e 7374      elif (isinst
-00005fb0: 616e 6365 2873 656c 662e 6d61 726b 6574  ance(self.market
-00005fc0: 735b 7061 6972 5d2e 6765 7428 2769 6e66  s[pair].get('inf
-00005fd0: 6f27 292c 2064 6963 7429 0a20 2020 2020  o'), dict).     
-00005fe0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00005ff0: 2073 656c 662e 6d61 726b 6574 735b 7061   self.markets[pa
-00006000: 6972 5d2e 6765 7428 2769 6e66 6f27 2c20  ir].get('info', 
-00006010: 7b7d 292e 6765 7428 2770 726f 6869 6269  {}).get('prohibi
-00006020: 7465 6449 6e27 2c20 4661 6c73 6529 293a  tedIn', False)):
-00006030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006040: 2023 2057 6172 6e20 7573 6572 7320 6162   # Warn users ab
-00006050: 6f75 7420 7265 7374 7269 6374 6564 2070  out restricted p
-00006060: 6169 7273 2069 6e20 7768 6974 656c 6973  airs in whitelis
-00006070: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
-00006080: 2020 2023 2057 6520 6361 6e6e 6f74 2064     # We cannot d
-00006090: 6574 6572 6d69 6e65 2072 656c 6961 626c  etermine reliabl
-000060a0: 7920 6966 2055 7365 7273 2061 7265 2061  y if Users are a
-000060b0: 6666 6563 7465 642e 0a20 2020 2020 2020  ffected..       
-000060c0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-000060d0: 7761 726e 696e 6728 6622 5061 6972 207b  warning(f"Pair {
-000060e0: 7061 6972 7d20 6973 2072 6573 7472 6963  pair} is restric
-000060f0: 7465 6420 666f 7220 736f 6d65 2075 7365  ted for some use
-00006100: 7273 206f 6e20 7468 6973 2065 7863 6861  rs on this excha
-00006110: 6e67 652e 220a 2020 2020 2020 2020 2020  nge.".          
-00006120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006130: 2020 2020 2066 2250 6c65 6173 6520 6368       f"Please ch
-00006140: 6563 6b20 6966 2079 6f75 2061 7265 2069  eck if you are i
-00006150: 6d70 6163 7465 6420 6279 2074 6869 7320  mpacted by this 
-00006160: 7265 7374 7269 6374 696f 6e20 220a 2020  restriction ".  
-00006170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006180: 2020 2020 2020 2020 2020 2020 2066 226f               f"o
-00006190: 6e20 7468 6520 6578 6368 616e 6765 2061  n the exchange a
-000061a0: 6e64 2065 7665 6e74 7561 6c6c 7920 7265  nd eventually re
-000061b0: 6d6f 7665 207b 7061 6972 7d20 6672 6f6d  move {pair} from
-000061c0: 2079 6f75 7220 7768 6974 656c 6973 742e   your whitelist.
-000061d0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-000061e0: 6620 2873 656c 662e 5f63 6f6e 6669 675b  f (self._config[
-000061f0: 2773 7461 6b65 5f63 7572 7265 6e63 7927  'stake_currency'
-00006200: 5d20 616e 640a 2020 2020 2020 2020 2020  ] and.          
-00006210: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
-00006220: 6574 5f70 6169 725f 7175 6f74 655f 6375  et_pair_quote_cu
-00006230: 7272 656e 6379 2870 6169 7229 2021 3d20  rrency(pair) != 
-00006240: 7365 6c66 2e5f 636f 6e66 6967 5b27 7374  self._config['st
-00006250: 616b 655f 6375 7272 656e 6379 275d 293a  ake_currency']):
-00006260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006270: 2069 6e76 616c 6964 5f70 6169 7273 2e61   invalid_pairs.a
-00006280: 7070 656e 6428 7061 6972 290a 2020 2020  ppend(pair).    
-00006290: 2020 2020 6966 2069 6e76 616c 6964 5f70      if invalid_p
-000062a0: 6169 7273 3a0a 2020 2020 2020 2020 2020  airs:.          
-000062b0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-000062c0: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
-000062d0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000062e0: 5374 616b 652d 6375 7272 656e 6379 2027  Stake-currency '
-000062f0: 7b73 656c 662e 5f63 6f6e 6669 675b 2773  {self._config['s
-00006300: 7461 6b65 5f63 7572 7265 6e63 7927 5d7d  take_currency']}
-00006310: 2720 6e6f 7420 636f 6d70 6174 6962 6c65  ' not compatible
-00006320: 2077 6974 6820 220a 2020 2020 2020 2020   with ".        
-00006330: 2020 2020 2020 2020 6622 7061 6972 2d77          f"pair-w
-00006340: 6869 7465 6c69 7374 2e20 506c 6561 7365  hitelist. Please
-00006350: 2072 656d 6f76 6520 7468 6520 666f 6c6c   remove the foll
-00006360: 6f77 696e 6720 7061 6972 733a 207b 696e  owing pairs: {in
-00006370: 7661 6c69 645f 7061 6972 737d 2229 0a0a  valid_pairs}")..
-00006380: 2020 2020 6465 6620 6765 745f 7661 6c69      def get_vali
-00006390: 645f 7061 6972 5f63 6f6d 6269 6e61 7469  d_pair_combinati
-000063a0: 6f6e 2873 656c 662c 2063 7572 725f 313a  on(self, curr_1:
-000063b0: 2073 7472 2c20 6375 7272 5f32 3a20 7374   str, curr_2: st
-000063c0: 7229 202d 3e20 7374 723a 0a20 2020 2020  r) -> str:.     
-000063d0: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
-000063e0: 6574 2076 616c 6964 2070 6169 7220 636f  et valid pair co
-000063f0: 6d62 696e 6174 696f 6e20 6f66 2063 7572  mbination of cur
-00006400: 725f 3120 616e 6420 6375 7272 5f32 2062  r_1 and curr_2 b
-00006410: 7920 7472 7969 6e67 2062 6f74 6820 636f  y trying both co
-00006420: 6d62 696e 6174 696f 6e73 2e0a 2020 2020  mbinations..    
-00006430: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00006440: 666f 7220 7061 6972 2069 6e20 5b66 227b  for pair in [f"{
-00006450: 6375 7272 5f31 7d2f 7b63 7572 725f 327d  curr_1}/{curr_2}
-00006460: 222c 2066 227b 6375 7272 5f32 7d2f 7b63  ", f"{curr_2}/{c
-00006470: 7572 725f 317d 225d 3a0a 2020 2020 2020  urr_1}"]:.      
-00006480: 2020 2020 2020 6966 2070 6169 7220 696e        if pair in
-00006490: 2073 656c 662e 6d61 726b 6574 7320 616e   self.markets an
-000064a0: 6420 7365 6c66 2e6d 6172 6b65 7473 5b70  d self.markets[p
-000064b0: 6169 725d 2e67 6574 2827 6163 7469 7665  air].get('active
-000064c0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-000064d0: 2020 2020 7265 7475 726e 2070 6169 720a      return pair.
-000064e0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-000064f0: 6368 616e 6765 4572 726f 7228 6622 436f  changeError(f"Co
-00006500: 756c 6420 6e6f 7420 636f 6d62 696e 6520  uld not combine 
-00006510: 7b63 7572 725f 317d 2061 6e64 207b 6375  {curr_1} and {cu
-00006520: 7272 5f32 7d20 746f 2067 6574 2061 2076  rr_2} to get a v
-00006530: 616c 6964 2070 6169 722e 2229 0a0a 2020  alid pair.")..  
-00006540: 2020 6465 6620 7661 6c69 6461 7465 5f74    def validate_t
-00006550: 696d 6566 7261 6d65 7328 7365 6c66 2c20  imeframes(self, 
-00006560: 7469 6d65 6672 616d 653a 204f 7074 696f  timeframe: Optio
-00006570: 6e61 6c5b 7374 725d 2920 2d3e 204e 6f6e  nal[str]) -> Non
-00006580: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-00006590: 2020 2020 2020 2043 6865 636b 2069 6620         Check if 
-000065a0: 7469 6d65 6672 616d 6520 6672 6f6d 2063  timeframe from c
-000065b0: 6f6e 6669 6720 6973 2061 2073 7570 706f  onfig is a suppo
-000065c0: 7274 6564 2074 696d 6566 7261 6d65 206f  rted timeframe o
-000065d0: 6e20 7468 6520 6578 6368 616e 6765 0a20  n the exchange. 
-000065e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000065f0: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
-00006600: 7228 7365 6c66 2e5f 6170 692c 2022 7469  r(self._api, "ti
-00006610: 6d65 6672 616d 6573 2229 206f 7220 7365  meframes") or se
-00006620: 6c66 2e5f 6170 692e 7469 6d65 6672 616d  lf._api.timefram
-00006630: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00006640: 2020 2020 2020 2020 2320 4966 2074 696d          # If tim
-00006650: 6566 7261 6d65 7320 6174 7472 6962 7574  eframes attribut
-00006660: 6520 6973 206d 6973 7369 6e67 2028 6f72  e is missing (or
-00006670: 2069 7320 4e6f 6e65 292c 2074 6865 2065   is None), the e
-00006680: 7863 6861 6e67 6520 7072 6f62 6162 6c79  xchange probably
-00006690: 0a20 2020 2020 2020 2020 2020 2023 2068  .            # h
-000066a0: 6173 206e 6f20 6665 7463 684f 484c 4356  as no fetchOHLCV
-000066b0: 206d 6574 686f 642e 0a20 2020 2020 2020   method..       
-000066c0: 2020 2020 2023 2054 6865 7265 666f 7265       # Therefore
-000066d0: 2077 6520 616c 736f 2073 686f 7720 7468   we also show th
-000066e0: 6174 2e0a 2020 2020 2020 2020 2020 2020  at..            
-000066f0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-00006700: 6c45 7863 6570 7469 6f6e 280a 2020 2020  lException(.    
-00006710: 2020 2020 2020 2020 2020 2020 6622 5468              f"Th
-00006720: 6520 6363 7874 206c 6962 7261 7279 2064  e ccxt library d
-00006730: 6f65 7320 6e6f 7420 7072 6f76 6964 6520  oes not provide 
-00006740: 7468 6520 6c69 7374 206f 6620 7469 6d65  the list of time
-00006750: 6672 616d 6573 2022 0a20 2020 2020 2020  frames ".       
-00006760: 2020 2020 2020 2020 2066 2266 6f72 2074           f"for t
-00006770: 6865 2065 7863 6861 6e67 6520 7b73 656c  he exchange {sel
-00006780: 662e 6e61 6d65 7d20 616e 6420 7468 6973  f.name} and this
-00006790: 2065 7863 6861 6e67 6520 220a 2020 2020   exchange ".    
-000067a0: 2020 2020 2020 2020 2020 2020 6622 6973              f"is
-000067b0: 2074 6865 7265 666f 7265 206e 6f74 2073   therefore not s
-000067c0: 7570 706f 7274 6564 2e20 6363 7874 2066  upported. ccxt f
-000067d0: 6574 6368 4f48 4c43 563a 207b 7365 6c66  etchOHLCV: {self
-000067e0: 2e65 7863 6861 6e67 655f 6861 7328 2766  .exchange_has('f
-000067f0: 6574 6368 4f48 4c43 5627 297d 2229 0a0a  etchOHLCV')}")..
-00006800: 2020 2020 2020 2020 6966 2074 696d 6566          if timef
-00006810: 7261 6d65 2061 6e64 2028 7469 6d65 6672  rame and (timefr
-00006820: 616d 6520 6e6f 7420 696e 2073 656c 662e  ame not in self.
-00006830: 7469 6d65 6672 616d 6573 293a 0a20 2020  timeframes):.   
-00006840: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-00006850: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-00006860: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-00006870: 2020 2020 2066 2249 6e76 616c 6964 2074       f"Invalid t
-00006880: 696d 6566 7261 6d65 2027 7b74 696d 6566  imeframe '{timef
-00006890: 7261 6d65 7d27 2e20 5468 6973 2065 7863  rame}'. This exc
-000068a0: 6861 6e67 6520 7375 7070 6f72 7473 3a20  hange supports: 
-000068b0: 7b73 656c 662e 7469 6d65 6672 616d 6573  {self.timeframes
-000068c0: 7d22 290a 0a20 2020 2020 2020 2069 6620  }")..        if 
-000068d0: 7469 6d65 6672 616d 6520 616e 6420 7469  timeframe and ti
-000068e0: 6d65 6672 616d 655f 746f 5f6d 696e 7574  meframe_to_minut
-000068f0: 6573 2874 696d 6566 7261 6d65 2920 3c20  es(timeframe) < 
-00006900: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
-00006910: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
-00006920: 4578 6365 7074 696f 6e28 2254 696d 6566  Exception("Timef
-00006930: 7261 6d65 7320 3c20 316d 2061 7265 2063  rames < 1m are c
-00006940: 7572 7265 6e74 6c79 206e 6f74 2073 7570  urrently not sup
-00006950: 706f 7274 6564 2062 7920 4672 6571 7472  ported by Freqtr
-00006960: 6164 652e 2229 0a0a 2020 2020 6465 6620  ade.")..    def 
-00006970: 7661 6c69 6461 7465 5f6f 7264 6572 7479  validate_orderty
-00006980: 7065 7328 7365 6c66 2c20 6f72 6465 725f  pes(self, order_
-00006990: 7479 7065 733a 2044 6963 7429 202d 3e20  types: Dict) -> 
-000069a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-000069b0: 220a 2020 2020 2020 2020 4368 6563 6b73  ".        Checks
-000069c0: 2069 6620 6f72 6465 722d 7479 7065 7320   if order-types 
-000069d0: 636f 6e66 6967 7572 6564 2069 6e20 7374  configured in st
-000069e0: 7261 7465 6779 2f63 6f6e 6669 6720 6172  rategy/config ar
-000069f0: 6520 7375 7070 6f72 7465 640a 2020 2020  e supported.    
-00006a00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00006a10: 6966 2061 6e79 2876 203d 3d20 276d 6172  if any(v == 'mar
-00006a20: 6b65 7427 2066 6f72 206b 2c20 7620 696e  ket' for k, v in
-00006a30: 206f 7264 6572 5f74 7970 6573 2e69 7465   order_types.ite
-00006a40: 6d73 2829 293a 0a20 2020 2020 2020 2020  ms()):.         
-00006a50: 2020 2069 6620 6e6f 7420 7365 6c66 2e65     if not self.e
-00006a60: 7863 6861 6e67 655f 6861 7328 2763 7265  xchange_has('cre
-00006a70: 6174 654d 6172 6b65 744f 7264 6572 2729  ateMarketOrder')
-00006a80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006a90: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00006aa0: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
-00006ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ac0: 2020 6627 4578 6368 616e 6765 207b 7365    f'Exchange {se
-00006ad0: 6c66 2e6e 616d 657d 2064 6f65 7320 6e6f  lf.name} does no
-00006ae0: 7420 7375 7070 6f72 7420 6d61 726b 6574  t support market
-00006af0: 206f 7264 6572 732e 2729 0a20 2020 2020   orders.').     
-00006b00: 2020 2073 656c 662e 7661 6c69 6461 7465     self.validate
-00006b10: 5f73 746f 705f 6f72 6465 7274 7970 6573  _stop_ordertypes
-00006b20: 286f 7264 6572 5f74 7970 6573 290a 0a20  (order_types).. 
-00006b30: 2020 2064 6566 2076 616c 6964 6174 655f     def validate_
-00006b40: 7374 6f70 5f6f 7264 6572 7479 7065 7328  stop_ordertypes(
-00006b50: 7365 6c66 2c20 6f72 6465 725f 7479 7065  self, order_type
-00006b60: 733a 2044 6963 7429 202d 3e20 4e6f 6e65  s: Dict) -> None
-00006b70: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00006b80: 2020 2020 2020 5661 6c69 6461 7465 2073        Validate s
-00006b90: 746f 706c 6f73 7320 6f72 6465 7220 7479  toploss order ty
-00006ba0: 7065 730a 2020 2020 2020 2020 2222 220a  pes.        """.
-00006bb0: 2020 2020 2020 2020 6966 2028 6f72 6465          if (orde
-00006bc0: 725f 7479 7065 732e 6765 7428 2273 746f  r_types.get("sto
-00006bd0: 706c 6f73 735f 6f6e 5f65 7863 6861 6e67  ploss_on_exchang
-00006be0: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-00006bf0: 2020 2020 616e 6420 6e6f 7420 7365 6c66      and not self
-00006c00: 2e5f 6674 5f68 6173 2e67 6574 2822 7374  ._ft_has.get("st
-00006c10: 6f70 6c6f 7373 5f6f 6e5f 6578 6368 616e  oploss_on_exchan
-00006c20: 6765 222c 2046 616c 7365 2929 3a0a 2020  ge", False)):.  
-00006c30: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00006c40: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00006c50: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00006c60: 2020 2020 2020 6627 4f6e 2065 7863 6861        f'On excha
-00006c70: 6e67 6520 7374 6f70 6c6f 7373 2069 7320  nge stoploss is 
-00006c80: 6e6f 7420 7375 7070 6f72 7465 6420 666f  not supported fo
-00006c90: 7220 7b73 656c 662e 6e61 6d65 7d2e 270a  r {self.name}.'.
-00006ca0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00006cb0: 2020 2020 2020 6966 2073 656c 662e 7472        if self.tr
-00006cc0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
-00006cd0: 6164 696e 674d 6f64 652e 4655 5455 5245  adingMode.FUTURE
-00006ce0: 533a 0a20 2020 2020 2020 2020 2020 2070  S:.            p
-00006cf0: 7269 6365 5f6d 6170 7069 6e67 203d 2073  rice_mapping = s
-00006d00: 656c 662e 5f66 745f 6861 732e 6765 7428  elf._ft_has.get(
-00006d10: 2773 746f 705f 7072 6963 655f 7479 7065  'stop_price_type
-00006d20: 5f76 616c 7565 5f6d 6170 7069 6e67 272c  _value_mapping',
-00006d30: 207b 7d29 2e6b 6579 7328 290a 2020 2020   {}).keys().    
-00006d40: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00006d50: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-00006d60: 6572 5f74 7970 6573 2e67 6574 2822 7374  er_types.get("st
-00006d70: 6f70 6c6f 7373 5f6f 6e5f 6578 6368 616e  oploss_on_exchan
-00006d80: 6765 222c 2046 616c 7365 2920 6973 2054  ge", False) is T
-00006d90: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00006da0: 2020 2020 616e 6420 2773 746f 706c 6f73      and 'stoplos
-00006db0: 735f 7072 6963 655f 7479 7065 2720 696e  s_price_type' in
-00006dc0: 206f 7264 6572 5f74 7970 6573 0a20 2020   order_types.   
-00006dd0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00006de0: 206f 7264 6572 5f74 7970 6573 5b27 7374   order_types['st
-00006df0: 6f70 6c6f 7373 5f70 7269 6365 5f74 7970  oploss_price_typ
-00006e00: 6527 5d20 6e6f 7420 696e 2070 7269 6365  e'] not in price
-00006e10: 5f6d 6170 7069 6e67 0a20 2020 2020 2020  _mapping.       
-00006e20: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-00006e30: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-00006e40: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-00006e50: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-00006e60: 2020 2020 2020 2020 6627 4f6e 2065 7863          f'On exc
-00006e70: 6861 6e67 6520 7374 6f70 6c6f 7373 2070  hange stoploss p
-00006e80: 7269 6365 2074 7970 6520 6973 206e 6f74  rice type is not
-00006e90: 2073 7570 706f 7274 6564 2066 6f72 207b   supported for {
-00006ea0: 7365 6c66 2e6e 616d 657d 2e27 0a20 2020  self.name}.'.   
-00006eb0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00006ec0: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
-00006ed0: 5f70 7269 6369 6e67 2873 656c 662c 2070  _pricing(self, p
-00006ee0: 7269 6369 6e67 3a20 4469 6374 2920 2d3e  ricing: Dict) ->
-00006ef0: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
-00006f00: 6620 7072 6963 696e 672e 6765 7428 2775  f pricing.get('u
-00006f10: 7365 5f6f 7264 6572 5f62 6f6f 6b27 2c20  se_order_book', 
-00006f20: 4661 6c73 6529 2061 6e64 206e 6f74 2073  False) and not s
-00006f30: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
-00006f40: 2827 6665 7463 684c 324f 7264 6572 426f  ('fetchL2OrderBo
-00006f50: 6f6b 2729 3a0a 2020 2020 2020 2020 2020  ok'):.          
-00006f60: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00006f70: 6e61 6c45 7863 6570 7469 6f6e 2866 274f  nalException(f'O
-00006f80: 7264 6572 626f 6f6b 206e 6f74 2061 7661  rderbook not ava
-00006f90: 696c 6162 6c65 2066 6f72 207b 7365 6c66  ilable for {self
-00006fa0: 2e6e 616d 657d 2e27 290a 2020 2020 2020  .name}.').      
-00006fb0: 2020 6966 2028 6e6f 7420 7072 6963 696e    if (not pricin
-00006fc0: 672e 6765 7428 2775 7365 5f6f 7264 6572  g.get('use_order
-00006fd0: 5f62 6f6f 6b27 2c20 4661 6c73 6529 2061  _book', False) a
-00006fe0: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
-00006ff0: 2020 2020 206e 6f74 2073 656c 662e 6578       not self.ex
-00007000: 6368 616e 6765 5f68 6173 2827 6665 7463  change_has('fetc
-00007010: 6854 6963 6b65 7227 290a 2020 2020 2020  hTicker').      
-00007020: 2020 2020 2020 2020 2020 6f72 206e 6f74            or not
-00007030: 2073 656c 662e 5f66 745f 6861 735b 2774   self._ft_has['t
-00007040: 6963 6b65 7273 5f68 6176 655f 7072 6963  ickers_have_pric
-00007050: 6527 5d29 293a 0a20 2020 2020 2020 2020  e'])):.         
-00007060: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00007070: 6f6e 616c 4578 6365 7074 696f 6e28 6627  onalException(f'
-00007080: 5469 636b 6572 2070 7269 6369 6e67 206e  Ticker pricing n
-00007090: 6f74 2061 7661 696c 6162 6c65 2066 6f72  ot available for
-000070a0: 207b 7365 6c66 2e6e 616d 657d 2e27 290a   {self.name}.').
-000070b0: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
-000070c0: 655f 6f72 6465 725f 7469 6d65 5f69 6e5f  e_order_time_in_
-000070d0: 666f 7263 6528 7365 6c66 2c20 6f72 6465  force(self, orde
-000070e0: 725f 7469 6d65 5f69 6e5f 666f 7263 653a  r_time_in_force:
-000070f0: 2044 6963 7429 202d 3e20 4e6f 6e65 3a0a   Dict) -> None:.
-00007100: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00007110: 2020 2020 4368 6563 6b73 2069 6620 6f72      Checks if or
-00007120: 6465 7220 7469 6d65 2069 6e20 666f 7263  der time in forc
-00007130: 6520 636f 6e66 6967 7572 6564 2069 6e20  e configured in 
-00007140: 7374 7261 7465 6779 2f63 6f6e 6669 6720  strategy/config 
-00007150: 6172 6520 7375 7070 6f72 7465 640a 2020  are supported.  
-00007160: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00007170: 2020 6966 2061 6e79 2876 2e75 7070 6572    if any(v.upper
-00007180: 2829 206e 6f74 2069 6e20 7365 6c66 2e5f  () not in self._
-00007190: 6674 5f68 6173 5b22 6f72 6465 725f 7469  ft_has["order_ti
-000071a0: 6d65 5f69 6e5f 666f 7263 6522 5d0a 2020  me_in_force"].  
-000071b0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000071c0: 206b 2c20 7620 696e 206f 7264 6572 5f74   k, v in order_t
-000071d0: 696d 655f 696e 5f66 6f72 6365 2e69 7465  ime_in_force.ite
-000071e0: 6d73 2829 293a 0a20 2020 2020 2020 2020  ms()):.         
-000071f0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00007200: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
-00007210: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00007220: 2754 696d 6520 696e 2066 6f72 6365 2070  'Time in force p
-00007230: 6f6c 6963 6965 7320 6172 6520 6e6f 7420  olicies are not 
-00007240: 7375 7070 6f72 7465 6420 666f 7220 7b73  supported for {s
-00007250: 656c 662e 6e61 6d65 7d20 7965 742e 2729  elf.name} yet.')
-00007260: 0a0a 2020 2020 6465 6620 7661 6c69 6461  ..    def valida
-00007270: 7465 5f72 6571 7569 7265 645f 7374 6172  te_required_star
-00007280: 7475 705f 6361 6e64 6c65 7328 7365 6c66  tup_candles(self
-00007290: 2c20 7374 6172 7475 705f 6361 6e64 6c65  , startup_candle
-000072a0: 733a 2069 6e74 2c20 7469 6d65 6672 616d  s: int, timefram
-000072b0: 653a 2073 7472 2920 2d3e 2069 6e74 3a0a  e: str) -> int:.
-000072c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000072d0: 2020 2020 4368 6563 6b73 2069 6620 7265      Checks if re
-000072e0: 7175 6972 6564 2073 7461 7274 7570 5f63  quired startup_c
-000072f0: 616e 646c 6573 2069 7320 6d6f 7265 2074  andles is more t
-00007300: 6861 6e20 6f68 6c63 765f 6361 6e64 6c65  han ohlcv_candle
-00007310: 5f6c 696d 6974 2829 2e0a 2020 2020 2020  _limit()..      
-00007320: 2020 5265 7175 6972 6573 2061 2067 7261    Requires a gra
-00007330: 6365 2d70 6572 696f 6420 6f66 2035 2063  ce-period of 5 c
-00007340: 616e 646c 6573 202d 2073 6f20 6120 7374  andles - so a st
-00007350: 6172 7475 702d 7065 7269 6f64 2075 7020  artup-period up 
-00007360: 746f 2034 3934 2069 7320 616c 6c6f 7765  to 494 is allowe
-00007370: 6420 6279 2064 6566 6175 6c74 2e0a 2020  d by default..  
-00007380: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00007390: 2020 2063 616e 646c 655f 6c69 6d69 7420     candle_limit 
-000073a0: 3d20 7365 6c66 2e6f 686c 6376 5f63 616e  = self.ohlcv_can
-000073b0: 646c 655f 6c69 6d69 7428 0a20 2020 2020  dle_limit(.     
-000073c0: 2020 2020 2020 2074 696d 6566 7261 6d65         timeframe
-000073d0: 2c20 7365 6c66 2e5f 636f 6e66 6967 5b27  , self._config['
-000073e0: 6361 6e64 6c65 5f74 7970 655f 6465 6627  candle_type_def'
-000073f0: 5d2c 0a20 2020 2020 2020 2020 2020 2069  ],.            i
-00007400: 6e74 2864 6174 655f 6d69 6e75 735f 6361  nt(date_minus_ca
-00007410: 6e64 6c65 7328 7469 6d65 6672 616d 652c  ndles(timeframe,
-00007420: 2073 7461 7274 7570 5f63 616e 646c 6573   startup_candles
-00007430: 292e 7469 6d65 7374 616d 7028 2920 2a20  ).timestamp() * 
-00007440: 3130 3030 290a 2020 2020 2020 2020 2020  1000).          
-00007450: 2020 6966 2074 696d 6566 7261 6d65 2065    if timeframe e
-00007460: 6c73 6520 4e6f 6e65 290a 2020 2020 2020  lse None).      
-00007470: 2020 2320 5265 7175 6972 6520 6f6e 6520    # Require one 
-00007480: 6d6f 7265 2063 616e 646c 6520 2d20 746f  more candle - to
-00007490: 2061 6363 6f75 6e74 2066 6f72 2074 6865   account for the
-000074a0: 2073 7469 6c6c 206f 7065 6e20 6361 6e64   still open cand
-000074b0: 6c65 2e0a 2020 2020 2020 2020 6361 6e64  le..        cand
-000074c0: 6c65 5f63 6f75 6e74 203d 2073 7461 7274  le_count = start
-000074d0: 7570 5f63 616e 646c 6573 202b 2031 0a20  up_candles + 1. 
-000074e0: 2020 2020 2020 2023 2041 6c6c 6f77 2035         # Allow 5
-000074f0: 2063 616c 6c73 2074 6f20 7468 6520 6578   calls to the ex
-00007500: 6368 616e 6765 2070 6572 2070 6169 720a  change per pair.
-00007510: 2020 2020 2020 2020 7265 7175 6972 6564          required
-00007520: 5f63 616e 646c 655f 6361 6c6c 5f63 6f75  _candle_call_cou
-00007530: 6e74 203d 2069 6e74 280a 2020 2020 2020  nt = int(.      
-00007540: 2020 2020 2020 2863 616e 646c 655f 636f        (candle_co
-00007550: 756e 7420 2f20 6361 6e64 6c65 5f6c 696d  unt / candle_lim
-00007560: 6974 2920 2b20 2830 2069 6620 6361 6e64  it) + (0 if cand
-00007570: 6c65 5f63 6f75 6e74 2025 2063 616e 646c  le_count % candl
-00007580: 655f 6c69 6d69 7420 3d3d 2030 2065 6c73  e_limit == 0 els
-00007590: 6520 3129 290a 2020 2020 2020 2020 6966  e 1)).        if
-000075a0: 2073 656c 662e 5f66 745f 6861 735b 276f   self._ft_has['o
-000075b0: 686c 6376 5f68 6173 5f68 6973 746f 7279  hlcv_has_history
-000075c0: 275d 3a0a 0a20 2020 2020 2020 2020 2020  ']:..           
-000075d0: 2069 6620 7265 7175 6972 6564 5f63 616e   if required_can
-000075e0: 646c 655f 6361 6c6c 5f63 6f75 6e74 203e  dle_call_count >
-000075f0: 2035 3a0a 2020 2020 2020 2020 2020 2020   5:.            
-00007600: 2020 2020 2320 4f6e 6c79 2061 6c6c 6f77      # Only allow
-00007610: 2035 2063 616c 6c73 2070 6572 2070 6169   5 calls per pai
-00007620: 7220 746f 2073 6f6d 6577 6861 7420 6c69  r to somewhat li
-00007630: 6d69 7420 7468 6520 696d 7061 6374 0a20  mit the impact. 
-00007640: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00007650: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
-00007660: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
-00007670: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00007680: 2254 6869 7320 7374 7261 7465 6779 2072  "This strategy r
-00007690: 6571 7569 7265 7320 7b73 7461 7274 7570  equires {startup
-000076a0: 5f63 616e 646c 6573 7d20 6361 6e64 6c65  _candles} candle
-000076b0: 7320 746f 2073 7461 7274 2c20 220a 2020  s to start, ".  
-000076c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000076d0: 2020 2277 6869 6368 2069 7320 6d6f 7265    "which is more
-000076e0: 2074 6861 6e20 3578 2022 0a20 2020 2020   than 5x ".     
-000076f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00007700: 2274 6865 2061 6d6f 756e 7420 6f66 2063  "the amount of c
-00007710: 616e 646c 6573 207b 7365 6c66 2e6e 616d  andles {self.nam
-00007720: 657d 2070 726f 7669 6465 7320 666f 7220  e} provides for 
-00007730: 7b74 696d 6566 7261 6d65 7d2e 2229 0a20  {timeframe}."). 
-00007740: 2020 2020 2020 2065 6c69 6620 7265 7175         elif requ
-00007750: 6972 6564 5f63 616e 646c 655f 6361 6c6c  ired_candle_call
-00007760: 5f63 6f75 6e74 203e 2031 3a0a 2020 2020  _count > 1:.    
-00007770: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-00007780: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-00007790: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-000077a0: 2020 2020 6622 5468 6973 2073 7472 6174      f"This strat
-000077b0: 6567 7920 7265 7175 6972 6573 207b 7374  egy requires {st
-000077c0: 6172 7475 705f 6361 6e64 6c65 737d 2063  artup_candles} c
-000077d0: 616e 646c 6573 2074 6f20 7374 6172 742c  andles to start,
-000077e0: 2077 6869 6368 2069 7320 6d6f 7265 2074   which is more t
-000077f0: 6861 6e20 220a 2020 2020 2020 2020 2020  han ".          
-00007800: 2020 2020 2020 6622 7468 6520 616d 6f75        f"the amou
-00007810: 6e74 206f 6620 6361 6e64 6c65 7320 7b73  nt of candles {s
-00007820: 656c 662e 6e61 6d65 7d20 7072 6f76 6964  elf.name} provid
-00007830: 6573 2066 6f72 207b 7469 6d65 6672 616d  es for {timefram
-00007840: 657d 2e22 290a 2020 2020 2020 2020 6966  e}.").        if
-00007850: 2072 6571 7569 7265 645f 6361 6e64 6c65   required_candle
-00007860: 5f63 616c 6c5f 636f 756e 7420 3e20 313a  _call_count > 1:
-00007870: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00007880: 6765 722e 7761 726e 696e 6728 6622 5573  ger.warning(f"Us
-00007890: 696e 6720 7b72 6571 7569 7265 645f 6361  ing {required_ca
-000078a0: 6e64 6c65 5f63 616c 6c5f 636f 756e 747d  ndle_call_count}
-000078b0: 2063 616c 6c73 2074 6f20 6765 7420 4f48   calls to get OH
-000078c0: 4c43 562e 2022 0a20 2020 2020 2020 2020  LCV. ".         
-000078d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000078e0: 2020 6622 5468 6973 2063 616e 2072 6573    f"This can res
-000078f0: 756c 7420 696e 2073 6c6f 7765 7220 6f70  ult in slower op
-00007900: 6572 6174 696f 6e73 2066 6f72 2074 6865  erations for the
-00007910: 2062 6f74 2e20 506c 6561 7365 2063 6865   bot. Please che
-00007920: 636b 2022 0a20 2020 2020 2020 2020 2020  ck ".           
-00007930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007940: 6622 6966 2079 6f75 2072 6561 6c6c 7920  f"if you really 
-00007950: 6e65 6564 207b 7374 6172 7475 705f 6361  need {startup_ca
-00007960: 6e64 6c65 737d 2063 616e 646c 6573 2066  ndles} candles f
-00007970: 6f72 2079 6f75 7220 7374 7261 7465 6779  or your strategy
-00007980: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-00007990: 6e20 7265 7175 6972 6564 5f63 616e 646c  n required_candl
-000079a0: 655f 6361 6c6c 5f63 6f75 6e74 0a0a 2020  e_call_count..  
-000079b0: 2020 6465 6620 7661 6c69 6461 7465 5f74    def validate_t
-000079c0: 7261 6469 6e67 5f6d 6f64 655f 616e 645f  rading_mode_and_
-000079d0: 6d61 7267 696e 5f6d 6f64 6528 0a20 2020  margin_mode(.   
-000079e0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000079f0: 2020 2074 7261 6469 6e67 5f6d 6f64 653a     trading_mode:
-00007a00: 2054 7261 6469 6e67 4d6f 6465 2c0a 2020   TradingMode,.  
-00007a10: 2020 2020 2020 6d61 7267 696e 5f6d 6f64        margin_mod
-00007a20: 653a 204f 7074 696f 6e61 6c5b 4d61 7267  e: Optional[Marg
-00007a30: 696e 4d6f 6465 5d20 2023 204f 6e6c 7920  inMode]  # Only 
-00007a40: 4e6f 6e65 2077 6865 6e20 7472 6164 696e  None when tradin
-00007a50: 675f 6d6f 6465 203d 2054 7261 6469 6e67  g_mode = Trading
-00007a60: 4d6f 6465 2e53 504f 540a 2020 2020 293a  Mode.SPOT.    ):
-00007a70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00007a80: 2020 2020 2043 6865 636b 7320 6966 2066       Checks if f
-00007a90: 7265 7174 7261 6465 2063 616e 2070 6572  reqtrade can per
-00007aa0: 666f 726d 2074 7261 6465 7320 7573 696e  form trades usin
-00007ab0: 6720 7468 6520 636f 6e66 6967 7572 6564  g the configured
-00007ac0: 0a20 2020 2020 2020 2074 7261 6469 6e67  .        trading
-00007ad0: 206d 6f64 6528 4d61 7267 696e 2c20 4675   mode(Margin, Fu
-00007ae0: 7475 7265 7329 2061 6e64 204d 6172 6769  tures) and Margi
-00007af0: 6e4d 6f64 6528 4372 6f73 732c 2049 736f  nMode(Cross, Iso
-00007b00: 6c61 7465 6429 0a20 2020 2020 2020 2054  lated).        T
-00007b10: 6872 6f77 7320 4f70 6572 6174 696f 6e61  hrows Operationa
-00007b20: 6c45 7863 6570 7469 6f6e 3a0a 2020 2020  lException:.    
-00007b30: 2020 2020 2020 2020 4966 2074 6865 2074          If the t
-00007b40: 7261 6469 6e67 5f6d 6f64 652f 6d61 7267  rading_mode/marg
-00007b50: 696e 5f6d 6f64 6520 7479 7065 2061 7265  in_mode type are
-00007b60: 206e 6f74 2073 7570 706f 7274 6564 2062   not supported b
-00007b70: 7920 6672 6571 7472 6164 6520 6f6e 2074  y freqtrade on t
-00007b80: 6869 7320 6578 6368 616e 6765 0a20 2020  his exchange.   
-00007b90: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00007ba0: 2069 6620 7472 6164 696e 675f 6d6f 6465   if trading_mode
-00007bb0: 2021 3d20 5472 6164 696e 674d 6f64 652e   != TradingMode.
-00007bc0: 5350 4f54 2061 6e64 2028 0a20 2020 2020  SPOT and (.     
-00007bd0: 2020 2020 2020 2028 7472 6164 696e 675f         (trading_
-00007be0: 6d6f 6465 2c20 6d61 7267 696e 5f6d 6f64  mode, margin_mod
-00007bf0: 6529 206e 6f74 2069 6e20 7365 6c66 2e5f  e) not in self._
-00007c00: 7375 7070 6f72 7465 645f 7472 6164 696e  supported_tradin
-00007c10: 675f 6d6f 6465 5f6d 6172 6769 6e5f 7061  g_mode_margin_pa
-00007c20: 6972 730a 2020 2020 2020 2020 293a 0a20  irs.        ):. 
-00007c30: 2020 2020 2020 2020 2020 206d 6d5f 7661             mm_va
-00007c40: 6c75 6520 3d20 6d61 7267 696e 5f6d 6f64  lue = margin_mod
-00007c50: 6520 616e 6420 6d61 7267 696e 5f6d 6f64  e and margin_mod
-00007c60: 652e 7661 6c75 650a 2020 2020 2020 2020  e.value.        
-00007c70: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-00007c80: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
-00007c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ca0: 6622 4672 6571 7472 6164 6520 646f 6573  f"Freqtrade does
-00007cb0: 206e 6f74 2073 7570 706f 7274 207b 6d6d   not support {mm
-00007cc0: 5f76 616c 7565 7d20 7b74 7261 6469 6e67  _value} {trading
-00007cd0: 5f6d 6f64 652e 7661 6c75 657d 206f 6e20  _mode.value} on 
-00007ce0: 7b73 656c 662e 6e61 6d65 7d22 0a20 2020  {self.name}".   
-00007cf0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00007d00: 6465 6620 6765 745f 6f70 7469 6f6e 2873  def get_option(s
-00007d10: 656c 662c 2070 6172 616d 3a20 7374 722c  elf, param: str,
-00007d20: 2064 6566 6175 6c74 3a20 4f70 7469 6f6e   default: Option
-00007d30: 616c 5b41 6e79 5d20 3d20 4e6f 6e65 2920  al[Any] = None) 
-00007d40: 2d3e 2041 6e79 3a0a 2020 2020 2020 2020  -> Any:.        
-00007d50: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-00007d60: 7061 7261 6d65 7465 7220 7661 6c75 6520  parameter value 
-00007d70: 6672 6f6d 205f 6674 5f68 6173 0a20 2020  from _ft_has.   
-00007d80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00007d90: 2072 6574 7572 6e20 7365 6c66 2e5f 6674   return self._ft
-00007da0: 5f68 6173 2e67 6574 2870 6172 616d 2c20  _has.get(param, 
-00007db0: 6465 6661 756c 7429 0a0a 2020 2020 6465  default)..    de
-00007dc0: 6620 6578 6368 616e 6765 5f68 6173 2873  f exchange_has(s
-00007dd0: 656c 662c 2065 6e64 706f 696e 743a 2073  elf, endpoint: s
-00007de0: 7472 2920 2d3e 2062 6f6f 6c3a 0a20 2020  tr) -> bool:.   
-00007df0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00007e00: 2043 6865 636b 7320 6966 2065 7863 6861   Checks if excha
-00007e10: 6e67 6520 696d 706c 656d 656e 7473 2061  nge implements a
-00007e20: 2073 7065 6369 6669 6320 4150 4920 656e   specific API en
-00007e30: 6470 6f69 6e74 2e0a 2020 2020 2020 2020  dpoint..        
-00007e40: 5772 6170 7065 7220 6172 6f75 6e64 2063  Wrapper around c
-00007e50: 6378 7420 2768 6173 2720 6174 7472 6962  cxt 'has' attrib
-00007e60: 7574 650a 2020 2020 2020 2020 3a70 6172  ute.        :par
-00007e70: 616d 2065 6e64 706f 696e 743a 204e 616d  am endpoint: Nam
-00007e80: 6520 6f66 2065 6e64 706f 696e 7420 2865  e of endpoint (e
-00007e90: 2e67 2e20 2766 6574 6368 4f48 4c43 5627  .g. 'fetchOHLCV'
-00007ea0: 2c20 2766 6574 6368 5469 636b 6572 7327  , 'fetchTickers'
-00007eb0: 290a 2020 2020 2020 2020 3a72 6574 7572  ).        :retur
-00007ec0: 6e3a 2062 6f6f 6c0a 2020 2020 2020 2020  n: bool.        
-00007ed0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00007ee0: 726e 2065 6e64 706f 696e 7420 696e 2073  rn endpoint in s
-00007ef0: 656c 662e 5f61 7069 2e68 6173 2061 6e64  elf._api.has and
-00007f00: 2073 656c 662e 5f61 7069 2e68 6173 5b65   self._api.has[e
-00007f10: 6e64 706f 696e 745d 0a0a 2020 2020 6465  ndpoint]..    de
-00007f20: 6620 6765 745f 7072 6563 6973 696f 6e5f  f get_precision_
-00007f30: 616d 6f75 6e74 2873 656c 662c 2070 6169  amount(self, pai
-00007f40: 723a 2073 7472 2920 2d3e 204f 7074 696f  r: str) -> Optio
-00007f50: 6e61 6c5b 666c 6f61 745d 3a0a 2020 2020  nal[float]:.    
-00007f60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007f70: 5265 7475 726e 7320 7468 6520 616d 6f75  Returns the amou
-00007f80: 6e74 2070 7265 6369 7369 6f6e 206f 6620  nt precision of 
-00007f90: 7468 6520 6578 6368 616e 6765 2e0a 2020  the exchange..  
-00007fa0: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
-00007fb0: 723a 2050 6169 7220 746f 2067 6574 2070  r: Pair to get p
-00007fc0: 7265 6369 7369 6f6e 2066 6f72 0a20 2020  recision for.   
-00007fd0: 2020 2020 203a 7265 7475 726e 3a20 7072       :return: pr
-00007fe0: 6563 6973 696f 6e20 666f 7220 616d 6f75  ecision for amou
-00007ff0: 6e74 206f 7220 4e6f 6e65 2e20 4d75 7374  nt or None. Must
-00008000: 2062 6520 7573 6564 2069 6e20 636f 6d62   be used in comb
-00008010: 696e 6174 696f 6e20 7769 7468 2070 7265  ination with pre
-00008020: 6369 7369 6f6e 4d6f 6465 0a20 2020 2020  cisionMode.     
-00008030: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00008040: 6574 7572 6e20 7365 6c66 2e6d 6172 6b65  eturn self.marke
-00008050: 7473 2e67 6574 2870 6169 722c 207b 7d29  ts.get(pair, {})
-00008060: 2e67 6574 2827 7072 6563 6973 696f 6e27  .get('precision'
-00008070: 2c20 7b7d 292e 6765 7428 2761 6d6f 756e  , {}).get('amoun
-00008080: 7427 2c20 4e6f 6e65 290a 0a20 2020 2064  t', None)..    d
-00008090: 6566 2067 6574 5f70 7265 6369 7369 6f6e  ef get_precision
-000080a0: 5f70 7269 6365 2873 656c 662c 2070 6169  _price(self, pai
-000080b0: 723a 2073 7472 2920 2d3e 204f 7074 696f  r: str) -> Optio
-000080c0: 6e61 6c5b 666c 6f61 745d 3a0a 2020 2020  nal[float]:.    
-000080d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000080e0: 5265 7475 726e 7320 7468 6520 7072 6963  Returns the pric
-000080f0: 6520 7072 6563 6973 696f 6e20 6f66 2074  e precision of t
-00008100: 6865 2065 7863 6861 6e67 652e 0a20 2020  he exchange..   
-00008110: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
-00008120: 3a20 5061 6972 2074 6f20 6765 7420 7072  : Pair to get pr
-00008130: 6563 6973 696f 6e20 666f 720a 2020 2020  ecision for.    
-00008140: 2020 2020 3a72 6574 7572 6e3a 2070 7265      :return: pre
-00008150: 6369 7369 6f6e 2066 6f72 2070 7269 6365  cision for price
-00008160: 206f 7220 4e6f 6e65 2e20 4d75 7374 2062   or None. Must b
-00008170: 6520 7573 6564 2069 6e20 636f 6d62 696e  e used in combin
-00008180: 6174 696f 6e20 7769 7468 2070 7265 6369  ation with preci
-00008190: 7369 6f6e 4d6f 6465 0a20 2020 2020 2020  sionMode.       
-000081a0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-000081b0: 7572 6e20 7365 6c66 2e6d 6172 6b65 7473  urn self.markets
-000081c0: 2e67 6574 2870 6169 722c 207b 7d29 2e67  .get(pair, {}).g
-000081d0: 6574 2827 7072 6563 6973 696f 6e27 2c20  et('precision', 
-000081e0: 7b7d 292e 6765 7428 2770 7269 6365 272c  {}).get('price',
-000081f0: 204e 6f6e 6529 0a0a 2020 2020 6465 6620   None)..    def 
-00008200: 616d 6f75 6e74 5f74 6f5f 7072 6563 6973  amount_to_precis
-00008210: 696f 6e28 7365 6c66 2c20 7061 6972 3a20  ion(self, pair: 
-00008220: 7374 722c 2061 6d6f 756e 743a 2066 6c6f  str, amount: flo
-00008230: 6174 2920 2d3e 2066 6c6f 6174 3a0a 2020  at) -> float:.  
-00008240: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00008250: 2020 5265 7475 726e 7320 7468 6520 616d    Returns the am
-00008260: 6f75 6e74 2074 6f20 6275 7920 6f72 2073  ount to buy or s
-00008270: 656c 6c20 746f 2061 2070 7265 6369 7369  ell to a precisi
-00008280: 6f6e 2074 6865 2045 7863 6861 6e67 6520  on the Exchange 
-00008290: 6163 6365 7074 730a 0a20 2020 2020 2020  accepts..       
-000082a0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-000082b0: 7572 6e20 616d 6f75 6e74 5f74 6f5f 7072  urn amount_to_pr
-000082c0: 6563 6973 696f 6e28 616d 6f75 6e74 2c20  ecision(amount, 
-000082d0: 7365 6c66 2e67 6574 5f70 7265 6369 7369  self.get_precisi
-000082e0: 6f6e 5f61 6d6f 756e 7428 7061 6972 292c  on_amount(pair),
-000082f0: 2073 656c 662e 7072 6563 6973 696f 6e4d   self.precisionM
-00008300: 6f64 6529 0a0a 2020 2020 6465 6620 7072  ode)..    def pr
-00008310: 6963 655f 746f 5f70 7265 6369 7369 6f6e  ice_to_precision
-00008320: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-00008330: 2c20 7072 6963 653a 2066 6c6f 6174 2920  , price: float) 
-00008340: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
-00008350: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00008360: 7475 726e 7320 7468 6520 7072 6963 6520  turns the price 
-00008370: 726f 756e 6465 6420 7570 2074 6f20 7468  rounded up to th
-00008380: 6520 7072 6563 6973 696f 6e20 7468 6520  e precision the 
-00008390: 4578 6368 616e 6765 2061 6363 6570 7473  Exchange accepts
-000083a0: 2e0a 2020 2020 2020 2020 526f 756e 6473  ..        Rounds
-000083b0: 2075 700a 2020 2020 2020 2020 2222 220a   up.        """.
-000083c0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-000083d0: 7269 6365 5f74 6f5f 7072 6563 6973 696f  rice_to_precisio
-000083e0: 6e28 7072 6963 652c 2073 656c 662e 6765  n(price, self.ge
-000083f0: 745f 7072 6563 6973 696f 6e5f 7072 6963  t_precision_pric
-00008400: 6528 7061 6972 292c 2073 656c 662e 7072  e(pair), self.pr
-00008410: 6563 6973 696f 6e4d 6f64 6529 0a0a 2020  ecisionMode)..  
-00008420: 2020 6465 6620 7072 6963 655f 6765 745f    def price_get_
-00008430: 6f6e 655f 7069 7028 7365 6c66 2c20 7061  one_pip(self, pa
-00008440: 6972 3a20 7374 722c 2070 7269 6365 3a20  ir: str, price: 
-00008450: 666c 6f61 7429 202d 3e20 666c 6f61 743a  float) -> float:
-00008460: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00008470: 2020 2020 2047 6574 2773 2074 6865 2022       Get's the "
-00008480: 3120 7069 7022 2076 616c 7565 2066 6f72  1 pip" value for
-00008490: 2074 6869 7320 7061 6972 2e0a 2020 2020   this pair..    
-000084a0: 2020 2020 5573 6564 2069 6e20 5072 6963      Used in Pric
-000084b0: 6546 696c 7465 7220 746f 2063 616c 6375  eFilter to calcu
-000084c0: 6c61 7465 2074 6865 2031 7069 7020 6d6f  late the 1pip mo
-000084d0: 7665 6d65 6e74 732e 0a20 2020 2020 2020  vements..       
-000084e0: 2022 2222 0a20 2020 2020 2020 2070 7265   """.        pre
-000084f0: 6369 7369 6f6e 203d 2073 656c 662e 6d61  cision = self.ma
-00008500: 726b 6574 735b 7061 6972 5d5b 2770 7265  rkets[pair]['pre
-00008510: 6369 7369 6f6e 275d 5b27 7072 6963 6527  cision']['price'
-00008520: 5d0a 2020 2020 2020 2020 6966 2073 656c  ].        if sel
-00008530: 662e 7072 6563 6973 696f 6e4d 6f64 6520  f.precisionMode 
-00008540: 3d3d 2054 4943 4b5f 5349 5a45 3a0a 2020  == TICK_SIZE:.  
-00008550: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00008560: 2070 7265 6369 7369 6f6e 0a20 2020 2020   precision.     
-00008570: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00008580: 2020 2020 2072 6574 7572 6e20 3120 2f20       return 1 / 
-00008590: 706f 7728 3130 2c20 7072 6563 6973 696f  pow(10, precisio
-000085a0: 6e29 0a0a 2020 2020 6465 6620 6765 745f  n)..    def get_
-000085b0: 6d69 6e5f 7061 6972 5f73 7461 6b65 5f61  min_pair_stake_a
-000085c0: 6d6f 756e 7428 0a20 2020 2020 2020 2073  mount(.        s
-000085d0: 656c 662c 0a20 2020 2020 2020 2070 6169  elf,.        pai
-000085e0: 723a 2073 7472 2c0a 2020 2020 2020 2020  r: str,.        
-000085f0: 7072 6963 653a 2066 6c6f 6174 2c0a 2020  price: float,.  
-00008600: 2020 2020 2020 7374 6f70 6c6f 7373 3a20        stoploss: 
-00008610: 666c 6f61 742c 0a20 2020 2020 2020 206c  float,.        l
-00008620: 6576 6572 6167 653a 204f 7074 696f 6e61  everage: Optiona
-00008630: 6c5b 666c 6f61 745d 203d 2031 2e30 0a20  l[float] = 1.0. 
-00008640: 2020 2029 202d 3e20 4f70 7469 6f6e 616c     ) -> Optional
-00008650: 5b66 6c6f 6174 5d3a 0a20 2020 2020 2020  [float]:.       
-00008660: 2072 6574 7572 6e20 7365 6c66 2e5f 6765   return self._ge
-00008670: 745f 7374 616b 655f 616d 6f75 6e74 5f6c  t_stake_amount_l
-00008680: 696d 6974 2870 6169 722c 2070 7269 6365  imit(pair, price
-00008690: 2c20 7374 6f70 6c6f 7373 2c20 276d 696e  , stoploss, 'min
-000086a0: 272c 206c 6576 6572 6167 6529 0a0a 2020  ', leverage)..  
-000086b0: 2020 6465 6620 6765 745f 6d61 785f 7061    def get_max_pa
-000086c0: 6972 5f73 7461 6b65 5f61 6d6f 756e 7428  ir_stake_amount(
-000086d0: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
-000086e0: 2070 7269 6365 3a20 666c 6f61 742c 206c   price: float, l
-000086f0: 6576 6572 6167 653a 2066 6c6f 6174 203d  everage: float =
-00008700: 2031 2e30 2920 2d3e 2066 6c6f 6174 3a0a   1.0) -> float:.
-00008710: 2020 2020 2020 2020 6d61 785f 7374 616b          max_stak
-00008720: 655f 616d 6f75 6e74 203d 2073 656c 662e  e_amount = self.
-00008730: 5f67 6574 5f73 7461 6b65 5f61 6d6f 756e  _get_stake_amoun
-00008740: 745f 6c69 6d69 7428 7061 6972 2c20 7072  t_limit(pair, pr
-00008750: 6963 652c 2030 2e30 2c20 276d 6178 2729  ice, 0.0, 'max')
-00008760: 0a20 2020 2020 2020 2069 6620 6d61 785f  .        if max_
-00008770: 7374 616b 655f 616d 6f75 6e74 2069 7320  stake_amount is 
-00008780: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00008790: 2020 2320 2a20 5368 6f75 6c64 206e 6576    # * Should nev
-000087a0: 6572 2062 6520 6578 6563 7574 6564 0a20  er be executed. 
-000087b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000087c0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-000087d0: 7074 696f 6e28 6627 7b73 656c 662e 6e61  ption(f'{self.na
-000087e0: 6d65 7d2e 6765 745f 6d61 785f 7061 6972  me}.get_max_pair
-000087f0: 5f73 7461 6b65 5f61 6d6f 756e 7420 7368  _stake_amount sh
-00008800: 6f75 6c64 270a 2020 2020 2020 2020 2020  ould'.          
-00008810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008820: 2020 2020 2020 2020 2020 2020 2027 6e65               'ne
-00008830: 7665 7220 7365 7420 6d61 785f 7374 616b  ver set max_stak
-00008840: 655f 616d 6f75 6e74 2074 6f20 4e6f 6e65  e_amount to None
-00008850: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
-00008860: 6e20 6d61 785f 7374 616b 655f 616d 6f75  n max_stake_amou
-00008870: 6e74 202f 206c 6576 6572 6167 650a 0a20  nt / leverage.. 
-00008880: 2020 2064 6566 205f 6765 745f 7374 616b     def _get_stak
-00008890: 655f 616d 6f75 6e74 5f6c 696d 6974 280a  e_amount_limit(.
-000088a0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-000088b0: 2020 2020 2020 7061 6972 3a20 7374 722c        pair: str,
-000088c0: 0a20 2020 2020 2020 2070 7269 6365 3a20  .        price: 
-000088d0: 666c 6f61 742c 0a20 2020 2020 2020 2073  float,.        s
-000088e0: 746f 706c 6f73 733a 2066 6c6f 6174 2c0a  toploss: float,.
-000088f0: 2020 2020 2020 2020 6c69 6d69 743a 204c          limit: L
-00008900: 6974 6572 616c 5b27 6d69 6e27 2c20 276d  iteral['min', 'm
-00008910: 6178 275d 2c0a 2020 2020 2020 2020 6c65  ax'],.        le
-00008920: 7665 7261 6765 3a20 4f70 7469 6f6e 616c  verage: Optional
-00008930: 5b66 6c6f 6174 5d20 3d20 312e 300a 2020  [float] = 1.0.  
-00008940: 2020 2920 2d3e 204f 7074 696f 6e61 6c5b    ) -> Optional[
-00008950: 666c 6f61 745d 3a0a 0a20 2020 2020 2020  float]:..       
-00008960: 2069 734d 696e 203d 206c 696d 6974 203d   isMin = limit =
-00008970: 3d20 276d 696e 270a 0a20 2020 2020 2020  = 'min'..       
-00008980: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00008990: 2020 6d61 726b 6574 203d 2073 656c 662e    market = self.
-000089a0: 6d61 726b 6574 735b 7061 6972 5d0a 2020  markets[pair].  
-000089b0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-000089c0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-000089d0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000089e0: 726f 7228 6622 4361 6e27 7420 6765 7420  ror(f"Can't get 
-000089f0: 6d61 726b 6574 2069 6e66 6f72 6d61 7469  market informati
-00008a00: 6f6e 2066 6f72 2073 796d 626f 6c20 7b70  on for symbol {p
-00008a10: 6169 727d 2229 0a0a 2020 2020 2020 2020  air}")..        
-00008a20: 7374 616b 655f 6c69 6d69 7473 203d 205b  stake_limits = [
-00008a30: 5d0a 2020 2020 2020 2020 6c69 6d69 7473  ].        limits
-00008a40: 203d 206d 6172 6b65 745b 276c 696d 6974   = market['limit
-00008a50: 7327 5d0a 2020 2020 2020 2020 6966 2028  s'].        if (
-00008a60: 6c69 6d69 7473 5b27 636f 7374 275d 5b6c  limits['cost'][l
-00008a70: 696d 6974 5d20 6973 206e 6f74 204e 6f6e  imit] is not Non
-00008a80: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00008a90: 7374 616b 655f 6c69 6d69 7473 2e61 7070  stake_limits.app
-00008aa0: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
-00008ab0: 2020 2020 2073 656c 662e 5f63 6f6e 7472       self._contr
-00008ac0: 6163 7473 5f74 6f5f 616d 6f75 6e74 280a  acts_to_amount(.
-00008ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ae0: 2020 2020 7061 6972 2c0a 2020 2020 2020      pair,.      
-00008af0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-00008b00: 6d69 7473 5b27 636f 7374 275d 5b6c 696d  mits['cost'][lim
-00008b10: 6974 5d0a 2020 2020 2020 2020 2020 2020  it].            
-00008b20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00008b30: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-00008b40: 286c 696d 6974 735b 2761 6d6f 756e 7427  (limits['amount'
-00008b50: 5d5b 6c69 6d69 745d 2069 7320 6e6f 7420  ][limit] is not 
-00008b60: 4e6f 6e65 293a 0a20 2020 2020 2020 2020  None):.         
-00008b70: 2020 2073 7461 6b65 5f6c 696d 6974 732e     stake_limits.
-00008b80: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
-00008b90: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
-00008ba0: 6e74 7261 6374 735f 746f 5f61 6d6f 756e  ntracts_to_amoun
-00008bb0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00008bc0: 2020 2020 2020 2070 6169 722c 0a20 2020         pair,.   
-00008bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008be0: 206c 696d 6974 735b 2761 6d6f 756e 7427   limits['amount'
-00008bf0: 5d5b 6c69 6d69 745d 202a 2070 7269 6365  ][limit] * price
-00008c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008c10: 2029 0a20 2020 2020 2020 2020 2020 2029   ).            )
-00008c20: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00008c30: 2073 7461 6b65 5f6c 696d 6974 733a 0a20   stake_limits:. 
-00008c40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008c50: 6e20 4e6f 6e65 2069 6620 6973 4d69 6e20  n None if isMin 
-00008c60: 656c 7365 2066 6c6f 6174 2827 696e 6627  else float('inf'
-00008c70: 290a 0a20 2020 2020 2020 2023 2072 6573  )..        # res
-00008c80: 6572 7665 2073 6f6d 6520 7065 7263 656e  erve some percen
-00008c90: 7420 6465 6669 6e65 6420 696e 2063 6f6e  t defined in con
-00008ca0: 6669 6720 2835 2520 6465 6661 756c 7429  fig (5% default)
-00008cb0: 202b 2073 746f 706c 6f73 730a 2020 2020   + stoploss.    
-00008cc0: 2020 2020 616d 6f75 6e74 5f72 6573 6572      amount_reser
-00008cd0: 7665 5f70 6572 6365 6e74 203d 2031 2e30  ve_percent = 1.0
-00008ce0: 202b 2073 656c 662e 5f63 6f6e 6669 672e   + self._config.
-00008cf0: 6765 7428 2761 6d6f 756e 745f 7265 7365  get('amount_rese
-00008d00: 7276 655f 7065 7263 656e 7427 2c0a 2020  rve_percent',.  
-00008d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d40: 2020 2020 2020 4445 4641 554c 545f 414d        DEFAULT_AM
-00008d50: 4f55 4e54 5f52 4553 4552 5645 5f50 4552  OUNT_RESERVE_PER
-00008d60: 4345 4e54 290a 2020 2020 2020 2020 616d  CENT).        am
-00008d70: 6f75 6e74 5f72 6573 6572 7665 5f70 6572  ount_reserve_per
-00008d80: 6365 6e74 203d 2028 0a20 2020 2020 2020  cent = (.       
-00008d90: 2020 2020 2061 6d6f 756e 745f 7265 7365       amount_rese
-00008da0: 7276 655f 7065 7263 656e 7420 2f20 2831  rve_percent / (1
-00008db0: 202d 2061 6273 2873 746f 706c 6f73 7329   - abs(stoploss)
-00008dc0: 2920 6966 2061 6273 2873 746f 706c 6f73  ) if abs(stoplos
-00008dd0: 7329 2021 3d20 3120 656c 7365 2031 2e35  s) != 1 else 1.5
-00008de0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00008df0: 2020 2023 2069 7420 7368 6f75 6c64 206e     # it should n
-00008e00: 6f74 2062 6520 6d6f 7265 2074 6861 6e20  ot be more than 
-00008e10: 3530 250a 2020 2020 2020 2020 616d 6f75  50%.        amou
-00008e20: 6e74 5f72 6573 6572 7665 5f70 6572 6365  nt_reserve_perce
-00008e30: 6e74 203d 206d 6178 286d 696e 2861 6d6f  nt = max(min(amo
-00008e40: 756e 745f 7265 7365 7276 655f 7065 7263  unt_reserve_perc
-00008e50: 656e 742c 2031 2e35 292c 2031 290a 0a20  ent, 1.5), 1).. 
-00008e60: 2020 2020 2020 2023 2054 6865 2076 616c         # The val
-00008e70: 7565 2072 6574 7572 6e65 6420 7368 6f75  ue returned shou
-00008e80: 6c64 2073 6174 6973 6679 2062 6f74 6820  ld satisfy both 
-00008e90: 6c69 6d69 7473 3a20 666f 7220 616d 6f75  limits: for amou
-00008ea0: 6e74 2028 6261 7365 2063 7572 7265 6e63  nt (base currenc
-00008eb0: 7929 2061 6e64 0a20 2020 2020 2020 2023  y) and.        #
-00008ec0: 2066 6f72 2063 6f73 7420 2871 756f 7465   for cost (quote
-00008ed0: 2c20 7374 616b 6520 6375 7272 656e 6379  , stake currency
-00008ee0: 292c 2073 6f20 6d61 7828 2920 6973 2075  ), so max() is u
-00008ef0: 7365 6420 6865 7265 2e0a 2020 2020 2020  sed here..      
-00008f00: 2020 2320 5365 6520 616c 736f 2023 3235    # See also #25
-00008f10: 3735 2061 7420 6769 7468 7562 2e0a 2020  75 at github..  
-00008f20: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00008f30: 662e 5f67 6574 5f73 7461 6b65 5f61 6d6f  f._get_stake_amo
-00008f40: 756e 745f 636f 6e73 6964 6572 696e 675f  unt_considering_
-00008f50: 6c65 7665 7261 6765 280a 2020 2020 2020  leverage(.      
-00008f60: 2020 2020 2020 6d61 7828 7374 616b 655f        max(stake_
-00008f70: 6c69 6d69 7473 2920 2a20 616d 6f75 6e74  limits) * amount
-00008f80: 5f72 6573 6572 7665 5f70 6572 6365 6e74  _reserve_percent
-00008f90: 2c0a 2020 2020 2020 2020 2020 2020 6c65  ,.            le
-00008fa0: 7665 7261 6765 206f 7220 312e 300a 2020  verage or 1.0.  
-00008fb0: 2020 2020 2020 2920 6966 2069 734d 696e        ) if isMin
-00008fc0: 2065 6c73 6520 6d69 6e28 7374 616b 655f   else min(stake_
-00008fd0: 6c69 6d69 7473 290a 0a20 2020 2064 6566  limits)..    def
-00008fe0: 205f 6765 745f 7374 616b 655f 616d 6f75   _get_stake_amou
-00008ff0: 6e74 5f63 6f6e 7369 6465 7269 6e67 5f6c  nt_considering_l
-00009000: 6576 6572 6167 6528 7365 6c66 2c20 7374  everage(self, st
-00009010: 616b 655f 616d 6f75 6e74 3a20 666c 6f61  ake_amount: floa
-00009020: 742c 206c 6576 6572 6167 653a 2066 6c6f  t, leverage: flo
-00009030: 6174 2920 2d3e 2066 6c6f 6174 3a0a 2020  at) -> float:.  
-00009040: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00009050: 2020 5461 6b65 7320 7468 6520 6d69 6e69    Takes the mini
-00009060: 6d75 6d20 7374 616b 6520 616d 6f75 6e74  mum stake amount
-00009070: 2066 6f72 2061 2070 6169 7220 7769 7468   for a pair with
-00009080: 206e 6f20 6c65 7665 7261 6765 2061 6e64   no leverage and
-00009090: 2072 6574 7572 6e73 2074 6865 206d 696e   returns the min
-000090a0: 696d 756d 0a20 2020 2020 2020 2073 7461  imum.        sta
-000090b0: 6b65 2061 6d6f 756e 7420 7768 656e 206c  ke amount when l
-000090c0: 6576 6572 6167 6520 6973 2063 6f6e 7369  everage is consi
-000090d0: 6465 7265 640a 2020 2020 2020 2020 3a70  dered.        :p
-000090e0: 6172 616d 2073 7461 6b65 5f61 6d6f 756e  aram stake_amoun
-000090f0: 743a 2054 6865 2073 7461 6b65 2061 6d6f  t: The stake amo
-00009100: 756e 7420 666f 7220 6120 7061 6972 2062  unt for a pair b
-00009110: 6566 6f72 6520 6c65 7665 7261 6765 2069  efore leverage i
-00009120: 7320 636f 6e73 6964 6572 6564 0a20 2020  s considered.   
-00009130: 2020 2020 203a 7061 7261 6d20 6c65 7665       :param leve
-00009140: 7261 6765 3a20 5468 6520 616d 6f75 6e74  rage: The amount
-00009150: 206f 6620 6c65 7665 7261 6765 2062 6569   of leverage bei
-00009160: 6e67 2075 7365 6420 6f6e 2074 6865 2063  ng used on the c
-00009170: 7572 7265 6e74 2074 7261 6465 0a20 2020  urrent trade.   
-00009180: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00009190: 2072 6574 7572 6e20 7374 616b 655f 616d   return stake_am
-000091a0: 6f75 6e74 202f 206c 6576 6572 6167 650a  ount / leverage.
-000091b0: 0a20 2020 2023 2044 7279 2d72 756e 206d  .    # Dry-run m
-000091c0: 6574 686f 6473 0a0a 2020 2020 6465 6620  ethods..    def 
-000091d0: 6372 6561 7465 5f64 7279 5f72 756e 5f6f  create_dry_run_o
-000091e0: 7264 6572 2873 656c 662c 2070 6169 723a  rder(self, pair:
-000091f0: 2073 7472 2c20 6f72 6465 7274 7970 653a   str, ordertype:
-00009200: 2073 7472 2c20 7369 6465 3a20 7374 722c   str, side: str,
-00009210: 2061 6d6f 756e 743a 2066 6c6f 6174 2c0a   amount: float,.
-00009220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009230: 2020 2020 2020 2020 2020 2020 2072 6174               rat
-00009240: 653a 2066 6c6f 6174 2c20 6c65 7665 7261  e: float, levera
-00009250: 6765 3a20 666c 6f61 742c 2070 6172 616d  ge: float, param
-00009260: 733a 2044 6963 7420 3d20 7b7d 2c0a 2020  s: Dict = {},.  
-00009270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009280: 2020 2020 2020 2020 2020 2073 746f 705f             stop_
-00009290: 6c6f 7373 3a20 626f 6f6c 203d 2046 616c  loss: bool = Fal
-000092a0: 7365 2920 2d3e 2044 6963 745b 7374 722c  se) -> Dict[str,
-000092b0: 2041 6e79 5d3a 0a20 2020 2020 2020 206f   Any]:.        o
-000092c0: 7264 6572 5f69 6420 3d20 6627 6472 795f  rder_id = f'dry_
-000092d0: 7275 6e5f 7b73 6964 657d 5f7b 6461 7465  run_{side}_{date
-000092e0: 7469 6d65 2e6e 6f77 2829 2e74 696d 6573  time.now().times
-000092f0: 7461 6d70 2829 7d27 0a20 2020 2020 2020  tamp()}'.       
-00009300: 2023 2052 6f75 6e64 696e 6720 6865 7265   # Rounding here
-00009310: 206d 7573 7420 7265 7370 6563 7420 746f   must respect to
-00009320: 2063 6f6e 7472 6163 7420 7369 7a65 730a   contract sizes.
-00009330: 2020 2020 2020 2020 5f61 6d6f 756e 7420          _amount 
-00009340: 3d20 7365 6c66 2e5f 636f 6e74 7261 6374  = self._contract
-00009350: 735f 746f 5f61 6d6f 756e 7428 0a20 2020  s_to_amount(.   
-00009360: 2020 2020 2020 2020 2070 6169 722c 2073           pair, s
-00009370: 656c 662e 616d 6f75 6e74 5f74 6f5f 7072  elf.amount_to_pr
-00009380: 6563 6973 696f 6e28 7061 6972 2c20 7365  ecision(pair, se
-00009390: 6c66 2e5f 616d 6f75 6e74 5f74 6f5f 636f  lf._amount_to_co
-000093a0: 6e74 7261 6374 7328 7061 6972 2c20 616d  ntracts(pair, am
-000093b0: 6f75 6e74 2929 290a 2020 2020 2020 2020  ount))).        
-000093c0: 6472 795f 6f72 6465 723a 2044 6963 745b  dry_order: Dict[
-000093d0: 7374 722c 2041 6e79 5d20 3d20 7b0a 2020  str, Any] = {.  
-000093e0: 2020 2020 2020 2020 2020 2769 6427 3a20            'id': 
-000093f0: 6f72 6465 725f 6964 2c0a 2020 2020 2020  order_id,.      
-00009400: 2020 2020 2020 2773 796d 626f 6c27 3a20        'symbol': 
-00009410: 7061 6972 2c0a 2020 2020 2020 2020 2020  pair,.          
-00009420: 2020 2770 7269 6365 273a 2072 6174 652c    'price': rate,
-00009430: 0a20 2020 2020 2020 2020 2020 2027 6176  .            'av
-00009440: 6572 6167 6527 3a20 7261 7465 2c0a 2020  erage': rate,.  
-00009450: 2020 2020 2020 2020 2020 2761 6d6f 756e            'amoun
-00009460: 7427 3a20 5f61 6d6f 756e 742c 0a20 2020  t': _amount,.   
-00009470: 2020 2020 2020 2020 2027 636f 7374 273a           'cost':
-00009480: 205f 616d 6f75 6e74 202a 2072 6174 652c   _amount * rate,
-00009490: 0a20 2020 2020 2020 2020 2020 2027 7479  .            'ty
-000094a0: 7065 273a 206f 7264 6572 7479 7065 2c0a  pe': ordertype,.
-000094b0: 2020 2020 2020 2020 2020 2020 2773 6964              'sid
-000094c0: 6527 3a20 7369 6465 2c0a 2020 2020 2020  e': side,.      
-000094d0: 2020 2020 2020 2766 696c 6c65 6427 3a20        'filled': 
-000094e0: 302c 0a20 2020 2020 2020 2020 2020 2027  0,.            '
-000094f0: 7265 6d61 696e 696e 6727 3a20 5f61 6d6f  remaining': _amo
-00009500: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
-00009510: 2027 6461 7465 7469 6d65 273a 2061 7272   'datetime': arr
-00009520: 6f77 2e75 7463 6e6f 7728 292e 7374 7266  ow.utcnow().strf
-00009530: 7469 6d65 2827 2559 2d25 6d2d 2564 5425  time('%Y-%m-%dT%
-00009540: 483a 254d 3a25 532e 2566 5a27 292c 0a20  H:%M:%S.%fZ'),. 
-00009550: 2020 2020 2020 2020 2020 2027 7469 6d65             'time
-00009560: 7374 616d 7027 3a20 6172 726f 772e 7574  stamp': arrow.ut
-00009570: 636e 6f77 2829 2e69 6e74 5f74 696d 6573  cnow().int_times
-00009580: 7461 6d70 202a 2031 3030 302c 0a20 2020  tamp * 1000,.   
-00009590: 2020 2020 2020 2020 2027 7374 6174 7573           'status
-000095a0: 273a 2022 6f70 656e 222c 0a20 2020 2020  ': "open",.     
-000095b0: 2020 2020 2020 2027 6665 6527 3a20 4e6f         'fee': No
-000095c0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-000095d0: 2769 6e66 6f27 3a20 7b7d 2c0a 2020 2020  'info': {},.    
-000095e0: 2020 2020 2020 2020 276c 6576 6572 6167          'leverag
-000095f0: 6527 3a20 6c65 7665 7261 6765 0a20 2020  e': leverage.   
-00009600: 2020 2020 207d 0a20 2020 2020 2020 2069       }.        i
-00009610: 6620 7374 6f70 5f6c 6f73 733a 0a20 2020  f stop_loss:.   
-00009620: 2020 2020 2020 2020 2064 7279 5f6f 7264           dry_ord
-00009630: 6572 5b22 696e 666f 225d 203d 207b 2273  er["info"] = {"s
-00009640: 746f 7050 7269 6365 223a 2064 7279 5f6f  topPrice": dry_o
-00009650: 7264 6572 5b22 7072 6963 6522 5d7d 0a20  rder["price"]}. 
-00009660: 2020 2020 2020 2020 2020 2064 7279 5f6f             dry_o
-00009670: 7264 6572 5b22 7374 6f70 5072 6963 6522  rder["stopPrice"
-00009680: 5d20 3d20 6472 795f 6f72 6465 725b 2270  ] = dry_order["p
-00009690: 7269 6365 225d 0a20 2020 2020 2020 2020  rice"].         
-000096a0: 2020 2023 2057 6f72 6b61 726f 756e 6420     # Workaround 
-000096b0: 746f 2061 766f 6964 2066 696c 6c69 6e67  to avoid filling
-000096c0: 2073 746f 706c 6f73 7320 6f72 6465 7273   stoploss orders
-000096d0: 2069 6d6d 6564 6961 7465 6c79 0a20 2020   immediately.   
-000096e0: 2020 2020 2020 2020 2064 7279 5f6f 7264           dry_ord
-000096f0: 6572 5b22 6674 5f6f 7264 6572 5f74 7970  er["ft_order_typ
-00009700: 6522 5d20 3d20 2273 746f 706c 6f73 7322  e"] = "stoploss"
-00009710: 0a20 2020 2020 2020 206f 7264 6572 626f  .        orderbo
-00009720: 6f6b 3a20 4f70 7469 6f6e 616c 5b4f 7264  ok: Optional[Ord
-00009730: 6572 426f 6f6b 5d20 3d20 4e6f 6e65 0a20  erBook] = None. 
-00009740: 2020 2020 2020 2069 6620 7365 6c66 2e65         if self.e
-00009750: 7863 6861 6e67 655f 6861 7328 2766 6574  xchange_has('fet
-00009760: 6368 4c32 4f72 6465 7242 6f6f 6b27 293a  chL2OrderBook'):
-00009770: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-00009780: 6572 626f 6f6b 203d 2073 656c 662e 6665  erbook = self.fe
-00009790: 7463 685f 6c32 5f6f 7264 6572 5f62 6f6f  tch_l2_order_boo
-000097a0: 6b28 7061 6972 2c20 3230 290a 2020 2020  k(pair, 20).    
-000097b0: 2020 2020 6966 206f 7264 6572 7479 7065      if ordertype
-000097c0: 203d 3d20 226c 696d 6974 2220 616e 6420   == "limit" and 
-000097d0: 6f72 6465 7262 6f6f 6b3a 0a20 2020 2020  orderbook:.     
-000097e0: 2020 2020 2020 2023 2041 6c6c 6f77 2061         # Allow a
-000097f0: 2033 2520 7072 6963 6520 6469 6666 6572   3% price differ
-00009800: 656e 6365 0a20 2020 2020 2020 2020 2020  ence.           
-00009810: 2061 6c6c 6f77 6564 5f64 6966 6620 3d20   allowed_diff = 
-00009820: 302e 3033 0a20 2020 2020 2020 2020 2020  0.03.           
-00009830: 2069 6620 7365 6c66 2e5f 6472 795f 6973   if self._dry_is
-00009840: 5f70 7269 6365 5f63 726f 7373 6564 2870  _price_crossed(p
-00009850: 6169 722c 2073 6964 652c 2072 6174 652c  air, side, rate,
-00009860: 206f 7264 6572 626f 6f6b 2c20 616c 6c6f   orderbook, allo
-00009870: 7765 645f 6469 6666 293a 0a20 2020 2020  wed_diff):.     
-00009880: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00009890: 722e 696e 666f 280a 2020 2020 2020 2020  r.info(.        
-000098a0: 2020 2020 2020 2020 2020 2020 6622 436f              f"Co
-000098b0: 6e76 6572 7465 6420 6f72 6465 7220 7b70  nverted order {p
-000098c0: 6169 727d 2074 6f20 6d61 726b 6574 206f  air} to market o
-000098d0: 7264 6572 2064 7565 2074 6f20 7072 6963  rder due to pric
-000098e0: 6520 7b72 6174 657d 2063 726f 7373 696e  e {rate} crossin
-000098f0: 6720 7370 7265 6164 2022 0a20 2020 2020  g spread ".     
-00009900: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009910: 2262 7920 6d6f 7265 2074 6861 6e20 7b61  "by more than {a
-00009920: 6c6c 6f77 6564 5f64 6966 663a 2e32 257d  llowed_diff:.2%}
-00009930: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00009940: 2020 2020 6472 795f 6f72 6465 725b 2274      dry_order["t
-00009950: 7970 6522 5d20 3d20 226d 6172 6b65 7422  ype"] = "market"
-00009960: 0a0a 2020 2020 2020 2020 6966 2064 7279  ..        if dry
-00009970: 5f6f 7264 6572 5b22 7479 7065 225d 203d  _order["type"] =
-00009980: 3d20 226d 6172 6b65 7422 2061 6e64 206e  = "market" and n
-00009990: 6f74 2064 7279 5f6f 7264 6572 2e67 6574  ot dry_order.get
-000099a0: 2822 6674 5f6f 7264 6572 5f74 7970 6522  ("ft_order_type"
-000099b0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-000099c0: 2055 7064 6174 6520 6d61 726b 6574 206f   Update market o
-000099d0: 7264 6572 2070 7269 6369 6e67 0a20 2020  rder pricing.   
-000099e0: 2020 2020 2020 2020 2061 7665 7261 6765           average
-000099f0: 203d 2073 656c 662e 6765 745f 6472 795f   = self.get_dry_
-00009a00: 6d61 726b 6574 5f66 696c 6c5f 7072 6963  market_fill_pric
-00009a10: 6528 7061 6972 2c20 7369 6465 2c20 616d  e(pair, side, am
-00009a20: 6f75 6e74 2c20 7261 7465 2c20 6f72 6465  ount, rate, orde
-00009a30: 7262 6f6f 6b29 0a20 2020 2020 2020 2020  rbook).         
-00009a40: 2020 2064 7279 5f6f 7264 6572 2e75 7064     dry_order.upd
-00009a50: 6174 6528 7b0a 2020 2020 2020 2020 2020  ate({.          
-00009a60: 2020 2020 2020 2761 7665 7261 6765 273a        'average':
-00009a70: 2061 7665 7261 6765 2c0a 2020 2020 2020   average,.      
-00009a80: 2020 2020 2020 2020 2020 2766 696c 6c65            'fille
-00009a90: 6427 3a20 5f61 6d6f 756e 742c 0a20 2020  d': _amount,.   
-00009aa0: 2020 2020 2020 2020 2020 2020 2027 7265               're
-00009ab0: 6d61 696e 696e 6727 3a20 302e 302c 0a20  maining': 0.0,. 
-00009ac0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00009ad0: 7374 6174 7573 273a 2022 636c 6f73 6564  status': "closed
-00009ae0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00009af0: 2020 2027 636f 7374 273a 2028 6472 795f     'cost': (dry_
-00009b00: 6f72 6465 725b 2761 6d6f 756e 7427 5d20  order['amount'] 
-00009b10: 2a20 6176 6572 6167 6529 202f 206c 6576  * average) / lev
-00009b20: 6572 6167 650a 2020 2020 2020 2020 2020  erage.          
-00009b30: 2020 7d29 0a20 2020 2020 2020 2020 2020    }).           
-00009b40: 2023 206d 6172 6b65 7420 6f72 6465 7273   # market orders
-00009b50: 2077 696c 6c20 616c 7761 7973 2069 6e63   will always inc
-00009b60: 7572 7220 7461 6b65 7220 6665 6573 0a20  urr taker fees. 
-00009b70: 2020 2020 2020 2020 2020 2064 7279 5f6f             dry_o
-00009b80: 7264 6572 203d 2073 656c 662e 6164 645f  rder = self.add_
-00009b90: 6472 795f 6f72 6465 725f 6665 6528 7061  dry_order_fee(pa
-00009ba0: 6972 2c20 6472 795f 6f72 6465 722c 2027  ir, dry_order, '
-00009bb0: 7461 6b65 7227 290a 0a20 2020 2020 2020  taker')..       
-00009bc0: 2064 7279 5f6f 7264 6572 203d 2073 656c   dry_order = sel
-00009bd0: 662e 6368 6563 6b5f 6472 795f 6c69 6d69  f.check_dry_limi
-00009be0: 745f 6f72 6465 725f 6669 6c6c 6564 280a  t_order_filled(.
-00009bf0: 2020 2020 2020 2020 2020 2020 6472 795f              dry_
-00009c00: 6f72 6465 722c 2069 6d6d 6564 6961 7465  order, immediate
-00009c10: 3d54 7275 652c 206f 7264 6572 626f 6f6b  =True, orderbook
-00009c20: 3d6f 7264 6572 626f 6f6b 290a 0a20 2020  =orderbook)..   
-00009c30: 2020 2020 2073 656c 662e 5f64 7279 5f72       self._dry_r
-00009c40: 756e 5f6f 7065 6e5f 6f72 6465 7273 5b64  un_open_orders[d
-00009c50: 7279 5f6f 7264 6572 5b22 6964 225d 5d20  ry_order["id"]] 
-00009c60: 3d20 6472 795f 6f72 6465 720a 2020 2020  = dry_order.    
-00009c70: 2020 2020 2320 436f 7079 206f 7264 6572      # Copy order
-00009c80: 2061 6e64 2063 6c6f 7365 2069 7420 2d20   and close it - 
-00009c90: 736f 2074 6865 2072 6574 7572 6e65 6420  so the returned 
-00009ca0: 6f72 6465 7220 6973 206f 7065 6e20 756e  order is open un
-00009cb0: 6c65 7373 2069 7427 7320 6120 6d61 726b  less it's a mark
-00009cc0: 6574 206f 7264 6572 0a20 2020 2020 2020  et order.       
-00009cd0: 2072 6574 7572 6e20 6472 795f 6f72 6465   return dry_orde
-00009ce0: 720a 0a20 2020 2064 6566 2061 6464 5f64  r..    def add_d
-00009cf0: 7279 5f6f 7264 6572 5f66 6565 280a 2020  ry_order_fee(.  
-00009d00: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00009d10: 2020 2020 7061 6972 3a20 7374 722c 0a20      pair: str,. 
-00009d20: 2020 2020 2020 2064 7279 5f6f 7264 6572         dry_order
-00009d30: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
-00009d40: 2c0a 2020 2020 2020 2020 7461 6b65 725f  ,.        taker_
-00009d50: 6f72 5f6d 616b 6572 3a20 4d61 6b65 7254  or_maker: MakerT
-00009d60: 616b 6572 2c0a 2020 2020 2920 2d3e 2044  aker,.    ) -> D
-00009d70: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
-00009d80: 2020 2020 2020 2066 6565 203d 2073 656c         fee = sel
-00009d90: 662e 6765 745f 6665 6528 7061 6972 2c20  f.get_fee(pair, 
-00009da0: 7461 6b65 725f 6f72 5f6d 616b 6572 3d74  taker_or_maker=t
-00009db0: 616b 6572 5f6f 725f 6d61 6b65 7229 0a20  aker_or_maker). 
-00009dc0: 2020 2020 2020 2064 7279 5f6f 7264 6572         dry_order
-00009dd0: 2e75 7064 6174 6528 7b0a 2020 2020 2020  .update({.      
-00009de0: 2020 2020 2020 2766 6565 273a 207b 0a20        'fee': {. 
-00009df0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00009e00: 6375 7272 656e 6379 273a 2073 656c 662e  currency': self.
-00009e10: 6765 745f 7061 6972 5f71 756f 7465 5f63  get_pair_quote_c
-00009e20: 7572 7265 6e63 7928 7061 6972 292c 0a20  urrency(pair),. 
-00009e30: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00009e40: 636f 7374 273a 2064 7279 5f6f 7264 6572  cost': dry_order
-00009e50: 5b27 636f 7374 275d 202a 2066 6565 2c0a  ['cost'] * fee,.
-00009e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e70: 2772 6174 6527 3a20 6665 650a 2020 2020  'rate': fee.    
-00009e80: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00009e90: 2020 7d29 0a20 2020 2020 2020 2072 6574    }).        ret
-00009ea0: 7572 6e20 6472 795f 6f72 6465 720a 0a20  urn dry_order.. 
-00009eb0: 2020 2064 6566 2067 6574 5f64 7279 5f6d     def get_dry_m
-00009ec0: 6172 6b65 745f 6669 6c6c 5f70 7269 6365  arket_fill_price
-00009ed0: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-00009ee0: 2c20 7369 6465 3a20 7374 722c 2061 6d6f  , side: str, amo
-00009ef0: 756e 743a 2066 6c6f 6174 2c20 7261 7465  unt: float, rate
-00009f00: 3a20 666c 6f61 742c 0a20 2020 2020 2020  : float,.       
-00009f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f20: 2020 2020 2020 2020 2020 206f 7264 6572             order
-00009f30: 626f 6f6b 3a20 4f70 7469 6f6e 616c 5b4f  book: Optional[O
-00009f40: 7264 6572 426f 6f6b 5d29 202d 3e20 666c  rderBook]) -> fl
-00009f50: 6f61 743a 0a20 2020 2020 2020 2022 2222  oat:.        """
-00009f60: 0a20 2020 2020 2020 2047 6574 2074 6865  .        Get the
-00009f70: 206d 6172 6b65 7420 6f72 6465 7220 6669   market order fi
-00009f80: 6c6c 2070 7269 6365 2062 6173 6564 206f  ll price based o
-00009f90: 6e20 6f72 6465 7262 6f6f 6b20 696e 7465  n orderbook inte
-00009fa0: 7270 6f6c 6174 696f 6e0a 2020 2020 2020  rpolation.      
-00009fb0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00009fc0: 2073 656c 662e 6578 6368 616e 6765 5f68   self.exchange_h
-00009fd0: 6173 2827 6665 7463 684c 324f 7264 6572  as('fetchL2Order
-00009fe0: 426f 6f6b 2729 3a0a 2020 2020 2020 2020  Book'):.        
-00009ff0: 2020 2020 6966 206e 6f74 206f 7264 6572      if not order
-0000a000: 626f 6f6b 3a0a 2020 2020 2020 2020 2020  book:.          
-0000a010: 2020 2020 2020 6f72 6465 7262 6f6f 6b20        orderbook 
-0000a020: 3d20 7365 6c66 2e66 6574 6368 5f6c 325f  = self.fetch_l2_
-0000a030: 6f72 6465 725f 626f 6f6b 2870 6169 722c  order_book(pair,
-0000a040: 2032 3029 0a20 2020 2020 2020 2020 2020   20).           
-0000a050: 206f 625f 7479 7065 3a20 4f42 4c69 7465   ob_type: OBLite
-0000a060: 7261 6c20 3d20 2761 736b 7327 2069 6620  ral = 'asks' if 
-0000a070: 7369 6465 203d 3d20 2762 7579 2720 656c  side == 'buy' el
-0000a080: 7365 2027 6269 6473 270a 2020 2020 2020  se 'bids'.      
-0000a090: 2020 2020 2020 736c 6970 7061 6765 203d        slippage =
-0000a0a0: 2030 2e30 350a 2020 2020 2020 2020 2020   0.05.          
-0000a0b0: 2020 6d61 785f 736c 6970 7061 6765 5f76    max_slippage_v
-0000a0c0: 616c 203d 2072 6174 6520 2a20 2828 3120  al = rate * ((1 
-0000a0d0: 2b20 736c 6970 7061 6765 2920 6966 2073  + slippage) if s
-0000a0e0: 6964 6520 3d3d 2027 6275 7927 2065 6c73  ide == 'buy' els
-0000a0f0: 6520 2831 202d 2073 6c69 7070 6167 6529  e (1 - slippage)
-0000a100: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
-0000a110: 656d 6169 6e69 6e67 5f61 6d6f 756e 7420  emaining_amount 
-0000a120: 3d20 616d 6f75 6e74 0a20 2020 2020 2020  = amount.       
-0000a130: 2020 2020 2066 696c 6c65 645f 616d 6f75       filled_amou
-0000a140: 6e74 203d 2030 2e30 0a20 2020 2020 2020  nt = 0.0.       
-0000a150: 2020 2020 2062 6f6f 6b5f 656e 7472 795f       book_entry_
-0000a160: 7072 6963 6520 3d20 302e 300a 2020 2020  price = 0.0.    
-0000a170: 2020 2020 2020 2020 666f 7220 626f 6f6b          for book
-0000a180: 5f65 6e74 7279 2069 6e20 6f72 6465 7262  _entry in orderb
-0000a190: 6f6f 6b5b 6f62 5f74 7970 655d 3a0a 2020  ook[ob_type]:.  
-0000a1a0: 2020 2020 2020 2020 2020 2020 2020 626f                bo
-0000a1b0: 6f6b 5f65 6e74 7279 5f70 7269 6365 203d  ok_entry_price =
-0000a1c0: 2062 6f6f 6b5f 656e 7472 795b 305d 0a20   book_entry[0]. 
-0000a1d0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000a1e0: 6f6f 6b5f 656e 7472 795f 636f 696e 5f76  ook_entry_coin_v
-0000a1f0: 6f6c 756d 6520 3d20 626f 6f6b 5f65 6e74  olume = book_ent
-0000a200: 7279 5b31 5d0a 2020 2020 2020 2020 2020  ry[1].          
-0000a210: 2020 2020 2020 6966 2072 656d 6169 6e69        if remaini
-0000a220: 6e67 5f61 6d6f 756e 7420 3e20 303a 0a20  ng_amount > 0:. 
-0000a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a240: 2020 2069 6620 7265 6d61 696e 696e 675f     if remaining_
-0000a250: 616d 6f75 6e74 203c 2062 6f6f 6b5f 656e  amount < book_en
-0000a260: 7472 795f 636f 696e 5f76 6f6c 756d 653a  try_coin_volume:
-0000a270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a280: 2020 2020 2020 2020 2023 204f 7264 6572           # Order
-0000a290: 626f 6f6b 2061 7420 7468 6973 2073 6c6f  book at this slo
-0000a2a0: 7420 6269 6767 6572 2074 6861 6e20 7265  t bigger than re
-0000a2b0: 6d61 696e 696e 6720 616d 6f75 6e74 0a20  maining amount. 
-0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2d0: 2020 2020 2020 2066 696c 6c65 645f 616d         filled_am
-0000a2e0: 6f75 6e74 202b 3d20 7265 6d61 696e 696e  ount += remainin
-0000a2f0: 675f 616d 6f75 6e74 202a 2062 6f6f 6b5f  g_amount * book_
-0000a300: 656e 7472 795f 7072 6963 650a 2020 2020  entry_price.    
-0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a320: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0000a330: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000a340: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000a350: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-0000a360: 6564 5f61 6d6f 756e 7420 2b3d 2062 6f6f  ed_amount += boo
-0000a370: 6b5f 656e 7472 795f 636f 696e 5f76 6f6c  k_entry_coin_vol
-0000a380: 756d 6520 2a20 626f 6f6b 5f65 6e74 7279  ume * book_entry
-0000a390: 5f70 7269 6365 0a20 2020 2020 2020 2020  _price.         
-0000a3a0: 2020 2020 2020 2020 2020 2072 656d 6169             remai
-0000a3b0: 6e69 6e67 5f61 6d6f 756e 7420 2d3d 2062  ning_amount -= b
-0000a3c0: 6f6f 6b5f 656e 7472 795f 636f 696e 5f76  ook_entry_coin_v
-0000a3d0: 6f6c 756d 650a 2020 2020 2020 2020 2020  olume.          
-0000a3e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a400: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-0000a410: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000a420: 2020 2020 2020 2020 2320 4966 2072 656d          # If rem
-0000a430: 6169 6e69 6e67 5f61 6d6f 756e 7420 7761  aining_amount wa
-0000a440: 736e 2774 2063 6f6e 7375 6d65 6420 636f  sn't consumed co
-0000a450: 6d70 6c65 7465 6c79 2028 6272 6561 6b20  mpletely (break 
-0000a460: 7761 7320 6e6f 7420 6361 6c6c 6564 290a  was not called).
+00005890: 7074 696f 6e20 6966 2073 7461 6b65 2d63  ption if stake-c
+000058a0: 7572 7265 6e63 7920 6973 206e 6f74 2061  urrency is not a
+000058b0: 7661 696c 6162 6c65 2e0a 2020 2020 2020  vailable..      
+000058c0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+000058d0: 206e 6f74 2073 656c 662e 5f6d 6172 6b65   not self._marke
+000058e0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000058f0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00005900: 6c45 7863 6570 7469 6f6e 280a 2020 2020  lException(.    
+00005910: 2020 2020 2020 2020 2020 2020 2743 6f75              'Cou
+00005920: 6c64 206e 6f74 206c 6f61 6420 6d61 726b  ld not load mark
+00005930: 6574 732c 2074 6865 7265 666f 7265 2063  ets, therefore c
+00005940: 616e 6e6f 7420 7374 6172 742e 2027 0a20  annot start. '. 
+00005950: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00005960: 506c 6561 7365 2069 6e76 6573 7469 6761  Please investiga
+00005970: 7465 2074 6865 2061 626f 7665 2065 7272  te the above err
+00005980: 6f72 2066 6f72 206d 6f72 6520 6465 7461  or for more deta
+00005990: 696c 732e 270a 2020 2020 2020 2020 2020  ils.'.          
+000059a0: 2020 290a 2020 2020 2020 2020 7175 6f74    ).        quot
+000059b0: 655f 6375 7272 656e 6369 6573 203d 2073  e_currencies = s
+000059c0: 656c 662e 6765 745f 7175 6f74 655f 6375  elf.get_quote_cu
+000059d0: 7272 656e 6369 6573 2829 0a20 2020 2020  rrencies().     
+000059e0: 2020 2069 6620 7374 616b 655f 6375 7272     if stake_curr
+000059f0: 656e 6379 206e 6f74 2069 6e20 7175 6f74  ency not in quot
+00005a00: 655f 6375 7272 656e 6369 6573 3a0a 2020  e_currencies:.  
+00005a10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00005a20: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
+00005a30: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
+00005a40: 2020 2020 2020 6622 7b73 7461 6b65 5f63        f"{stake_c
+00005a50: 7572 7265 6e63 797d 2069 7320 6e6f 7420  urrency} is not 
+00005a60: 6176 6169 6c61 626c 6520 6173 2073 7461  available as sta
+00005a70: 6b65 206f 6e20 7b73 656c 662e 6e61 6d65  ke on {self.name
+00005a80: 7d2e 2022 0a20 2020 2020 2020 2020 2020  }. ".           
+00005a90: 2020 2020 2066 2241 7661 696c 6162 6c65       f"Available
+00005aa0: 2063 7572 7265 6e63 6965 7320 6172 653a   currencies are:
+00005ab0: 207b 272c 2027 2e6a 6f69 6e28 7175 6f74   {', '.join(quot
+00005ac0: 655f 6375 7272 656e 6369 6573 297d 2229  e_currencies)}")
+00005ad0: 0a0a 2020 2020 6465 6620 7661 6c69 6461  ..    def valida
+00005ae0: 7465 5f70 6169 7273 2873 656c 662c 2070  te_pairs(self, p
+00005af0: 6169 7273 3a20 4c69 7374 5b73 7472 5d29  airs: List[str])
+00005b00: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00005b10: 2020 2222 220a 2020 2020 2020 2020 4368    """.        Ch
+00005b20: 6563 6b73 2069 6620 616c 6c20 6769 7665  ecks if all give
+00005b30: 6e20 7061 6972 7320 6172 6520 7472 6164  n pairs are trad
+00005b40: 6162 6c65 206f 6e20 7468 6520 6375 7272  able on the curr
+00005b50: 656e 7420 6578 6368 616e 6765 2e0a 2020  ent exchange..  
+00005b60: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
+00005b70: 7273 3a20 6c69 7374 206f 6620 7061 6972  rs: list of pair
+00005b80: 730a 2020 2020 2020 2020 3a72 6169 7365  s.        :raise
+00005b90: 3a20 4f70 6572 6174 696f 6e61 6c45 7863  : OperationalExc
+00005ba0: 6570 7469 6f6e 2069 6620 6f6e 6520 7061  eption if one pa
+00005bb0: 6972 2069 7320 6e6f 7420 6176 6169 6c61  ir is not availa
+00005bc0: 626c 650a 2020 2020 2020 2020 3a72 6574  ble.        :ret
+00005bd0: 7572 6e3a 204e 6f6e 650a 2020 2020 2020  urn: None.      
+00005be0: 2020 2222 220a 0a20 2020 2020 2020 2069    """..        i
+00005bf0: 6620 6e6f 7420 7365 6c66 2e6d 6172 6b65  f not self.marke
+00005c00: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00005c10: 6c6f 6767 6572 2e77 6172 6e69 6e67 2827  logger.warning('
+00005c20: 556e 6162 6c65 2074 6f20 7661 6c69 6461  Unable to valida
+00005c30: 7465 2070 6169 7273 2028 6173 7375 6d69  te pairs (assumi
+00005c40: 6e67 2074 6865 7920 6172 6520 636f 7272  ng they are corr
+00005c50: 6563 7429 2e27 290a 2020 2020 2020 2020  ect).').        
+00005c60: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+00005c70: 2020 2065 7874 656e 6465 645f 7061 6972     extended_pair
+00005c80: 7320 3d20 6578 7061 6e64 5f70 6169 726c  s = expand_pairl
+00005c90: 6973 7428 7061 6972 732c 206c 6973 7428  ist(pairs, list(
+00005ca0: 7365 6c66 2e6d 6172 6b65 7473 292c 206b  self.markets), k
+00005cb0: 6565 705f 696e 7661 6c69 643d 5472 7565  eep_invalid=True
+00005cc0: 290a 2020 2020 2020 2020 696e 7661 6c69  ).        invali
+00005cd0: 645f 7061 6972 7320 3d20 5b5d 0a20 2020  d_pairs = [].   
+00005ce0: 2020 2020 2066 6f72 2070 6169 7220 696e       for pair in
+00005cf0: 2065 7874 656e 6465 645f 7061 6972 733a   extended_pairs:
+00005d00: 0a20 2020 2020 2020 2020 2020 2023 204e  .            # N
+00005d10: 6f74 653a 2063 6378 7420 6861 7320 4261  ote: ccxt has Ba
+00005d20: 7365 4375 7272 656e 6379 2f51 756f 7465  seCurrency/Quote
+00005d30: 4375 7272 656e 6379 2066 6f72 6d61 7420  Currency format 
+00005d40: 666f 7220 7061 6972 730a 2020 2020 2020  for pairs.      
+00005d50: 2020 2020 2020 6966 2073 656c 662e 6d61        if self.ma
+00005d60: 726b 6574 7320 616e 6420 7061 6972 206e  rkets and pair n
+00005d70: 6f74 2069 6e20 7365 6c66 2e6d 6172 6b65  ot in self.marke
+00005d80: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00005d90: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+00005da0: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
+00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005dc0: 2020 2020 6627 5061 6972 207b 7061 6972      f'Pair {pair
+00005dd0: 7d20 6973 206e 6f74 2061 7661 696c 6162  } is not availab
+00005de0: 6c65 206f 6e20 7b73 656c 662e 6e61 6d65  le on {self.name
+00005df0: 7d20 7b73 656c 662e 7472 6164 696e 675f  } {self.trading_
+00005e00: 6d6f 6465 2e76 616c 7565 7d2e 2027 0a20  mode.value}. '. 
+00005e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e20: 2020 2066 2750 6c65 6173 6520 7265 6d6f     f'Please remo
+00005e30: 7665 207b 7061 6972 7d20 6672 6f6d 2079  ve {pair} from y
+00005e40: 6f75 7220 7768 6974 656c 6973 742e 2729  our whitelist.')
+00005e50: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005e60: 2020 2320 4672 6f6d 2063 6378 7420 446f    # From ccxt Do
+00005e70: 6375 6d65 6e74 6174 696f 6e3a 0a20 2020  cumentation:.   
+00005e80: 2020 2020 2020 2020 2020 2020 2023 206d               # m
+00005e90: 6172 6b65 7473 2e69 6e66 6f3a 2041 6e20  arkets.info: An 
+00005ea0: 6173 736f 6369 6174 6976 6520 6172 7261  associative arra
+00005eb0: 7920 6f66 206e 6f6e 2d63 6f6d 6d6f 6e20  y of non-common 
+00005ec0: 6d61 726b 6574 2070 726f 7065 7274 6965  market propertie
+00005ed0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00005ee0: 2020 2023 2069 6e63 6c75 6469 6e67 2066     # including f
+00005ef0: 6565 732c 2072 6174 6573 2c20 6c69 6d69  ees, rates, limi
+00005f00: 7473 2061 6e64 206f 7468 6572 2067 656e  ts and other gen
+00005f10: 6572 616c 206d 6172 6b65 7420 696e 666f  eral market info
+00005f20: 726d 6174 696f 6e2e 0a20 2020 2020 2020  rmation..       
+00005f30: 2020 2020 2020 2020 2023 2054 6865 2069           # The i
+00005f40: 6e74 6572 6e61 6c20 696e 666f 2061 7272  nternal info arr
+00005f50: 6179 2069 7320 6469 6666 6572 656e 7420  ay is different 
+00005f60: 666f 7220 6561 6368 2070 6172 7469 6375  for each particu
+00005f70: 6c61 7220 6d61 726b 6574 2c0a 2020 2020  lar market,.    
+00005f80: 2020 2020 2020 2020 2020 2020 2320 6974              # it
+00005f90: 7320 636f 6e74 656e 7473 2064 6570 656e  s contents depen
+00005fa0: 6420 6f6e 2074 6865 2065 7863 6861 6e67  d on the exchang
+00005fb0: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
+00005fc0: 2020 2023 2049 7420 6361 6e20 616c 736f     # It can also
+00005fd0: 2062 6520 6120 7374 7269 6e67 206f 7220   be a string or 
+00005fe0: 7369 6d69 6c61 7220 2e2e 2e20 736f 2077  similar ... so w
+00005ff0: 6520 6e65 6564 2074 6f20 7665 7269 6679  e need to verify
+00006000: 2074 6861 7420 6669 7273 742e 0a20 2020   that first..   
+00006010: 2020 2020 2020 2020 2065 6c69 6620 2869           elif (i
+00006020: 7369 6e73 7461 6e63 6528 7365 6c66 2e6d  sinstance(self.m
+00006030: 6172 6b65 7473 5b70 6169 725d 2e67 6574  arkets[pair].get
+00006040: 2827 696e 666f 2729 2c20 6469 6374 290a  ('info'), dict).
+00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006060: 2020 616e 6420 7365 6c66 2e6d 6172 6b65    and self.marke
+00006070: 7473 5b70 6169 725d 2e67 6574 2827 696e  ts[pair].get('in
+00006080: 666f 272c 207b 7d29 2e67 6574 2827 7072  fo', {}).get('pr
+00006090: 6f68 6962 6974 6564 496e 272c 2046 616c  ohibitedIn', Fal
+000060a0: 7365 2929 3a0a 2020 2020 2020 2020 2020  se)):.          
+000060b0: 2020 2020 2020 2320 5761 726e 2075 7365        # Warn use
+000060c0: 7273 2061 626f 7574 2072 6573 7472 6963  rs about restric
+000060d0: 7465 6420 7061 6972 7320 696e 2077 6869  ted pairs in whi
+000060e0: 7465 6c69 7374 2e0a 2020 2020 2020 2020  telist..        
+000060f0: 2020 2020 2020 2020 2320 5765 2063 616e          # We can
+00006100: 6e6f 7420 6465 7465 726d 696e 6520 7265  not determine re
+00006110: 6c69 6162 6c79 2069 6620 5573 6572 7320  liably if Users 
+00006120: 6172 6520 6166 6665 6374 6564 2e0a 2020  are affected..  
+00006130: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00006140: 6767 6572 2e77 6172 6e69 6e67 2866 2250  gger.warning(f"P
+00006150: 6169 7220 7b70 6169 727d 2069 7320 7265  air {pair} is re
+00006160: 7374 7269 6374 6564 2066 6f72 2073 6f6d  stricted for som
+00006170: 6520 7573 6572 7320 6f6e 2074 6869 7320  e users on this 
+00006180: 6578 6368 616e 6765 2e22 0a20 2020 2020  exchange.".     
+00006190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061a0: 2020 2020 2020 2020 2020 6622 506c 6561            f"Plea
+000061b0: 7365 2063 6865 636b 2069 6620 796f 7520  se check if you 
+000061c0: 6172 6520 696d 7061 6374 6564 2062 7920  are impacted by 
+000061d0: 7468 6973 2072 6573 7472 6963 7469 6f6e  this restriction
+000061e0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000061f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006200: 2020 6622 6f6e 2074 6865 2065 7863 6861    f"on the excha
+00006210: 6e67 6520 616e 6420 6576 656e 7475 616c  nge and eventual
+00006220: 6c79 2072 656d 6f76 6520 7b70 6169 727d  ly remove {pair}
+00006230: 2066 726f 6d20 796f 7572 2077 6869 7465   from your white
+00006240: 6c69 7374 2e22 290a 2020 2020 2020 2020  list.").        
+00006250: 2020 2020 6966 2028 7365 6c66 2e5f 636f      if (self._co
+00006260: 6e66 6967 5b27 7374 616b 655f 6375 7272  nfig['stake_curr
+00006270: 656e 6379 275d 2061 6e64 0a20 2020 2020  ency'] and.     
+00006280: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00006290: 656c 662e 6765 745f 7061 6972 5f71 756f  elf.get_pair_quo
+000062a0: 7465 5f63 7572 7265 6e63 7928 7061 6972  te_currency(pair
+000062b0: 2920 213d 2073 656c 662e 5f63 6f6e 6669  ) != self._confi
+000062c0: 675b 2773 7461 6b65 5f63 7572 7265 6e63  g['stake_currenc
+000062d0: 7927 5d29 3a0a 2020 2020 2020 2020 2020  y']):.          
+000062e0: 2020 2020 2020 696e 7661 6c69 645f 7061        invalid_pa
+000062f0: 6972 732e 6170 7065 6e64 2870 6169 7229  irs.append(pair)
+00006300: 0a20 2020 2020 2020 2069 6620 696e 7661  .        if inva
+00006310: 6c69 645f 7061 6972 733a 0a20 2020 2020  lid_pairs:.     
+00006320: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+00006330: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+00006340: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00006350: 2020 2066 2253 7461 6b65 2d63 7572 7265     f"Stake-curre
+00006360: 6e63 7920 277b 7365 6c66 2e5f 636f 6e66  ncy '{self._conf
+00006370: 6967 5b27 7374 616b 655f 6375 7272 656e  ig['stake_curren
+00006380: 6379 275d 7d27 206e 6f74 2063 6f6d 7061  cy']}' not compa
+00006390: 7469 626c 6520 7769 7468 2022 0a20 2020  tible with ".   
+000063a0: 2020 2020 2020 2020 2020 2020 2066 2270               f"p
+000063b0: 6169 722d 7768 6974 656c 6973 742e 2050  air-whitelist. P
+000063c0: 6c65 6173 6520 7265 6d6f 7665 2074 6865  lease remove the
+000063d0: 2066 6f6c 6c6f 7769 6e67 2070 6169 7273   following pairs
+000063e0: 3a20 7b69 6e76 616c 6964 5f70 6169 7273  : {invalid_pairs
+000063f0: 7d22 290a 0a20 2020 2064 6566 2067 6574  }")..    def get
+00006400: 5f76 616c 6964 5f70 6169 725f 636f 6d62  _valid_pair_comb
+00006410: 696e 6174 696f 6e28 7365 6c66 2c20 6375  ination(self, cu
+00006420: 7272 5f31 3a20 7374 722c 2063 7572 725f  rr_1: str, curr_
+00006430: 323a 2073 7472 2920 2d3e 2073 7472 3a0a  2: str) -> str:.
+00006440: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00006450: 2020 2020 4765 7420 7661 6c69 6420 7061      Get valid pa
+00006460: 6972 2063 6f6d 6269 6e61 7469 6f6e 206f  ir combination o
+00006470: 6620 6375 7272 5f31 2061 6e64 2063 7572  f curr_1 and cur
+00006480: 725f 3220 6279 2074 7279 696e 6720 626f  r_2 by trying bo
+00006490: 7468 2063 6f6d 6269 6e61 7469 6f6e 732e  th combinations.
+000064a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000064b0: 2020 2020 2066 6f72 2070 6169 7220 696e       for pair in
+000064c0: 205b 6622 7b63 7572 725f 317d 2f7b 6375   [f"{curr_1}/{cu
+000064d0: 7272 5f32 7d22 2c20 6622 7b63 7572 725f  rr_2}", f"{curr_
+000064e0: 327d 2f7b 6375 7272 5f31 7d22 5d3a 0a20  2}/{curr_1}"]:. 
+000064f0: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+00006500: 6972 2069 6e20 7365 6c66 2e6d 6172 6b65  ir in self.marke
+00006510: 7473 2061 6e64 2073 656c 662e 6d61 726b  ts and self.mark
+00006520: 6574 735b 7061 6972 5d2e 6765 7428 2761  ets[pair].get('a
+00006530: 6374 6976 6527 293a 0a20 2020 2020 2020  ctive'):.       
+00006540: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00006550: 7061 6972 0a20 2020 2020 2020 2072 6169  pair.        rai
+00006560: 7365 2045 7863 6861 6e67 6545 7272 6f72  se ExchangeError
+00006570: 2866 2243 6f75 6c64 206e 6f74 2063 6f6d  (f"Could not com
+00006580: 6269 6e65 207b 6375 7272 5f31 7d20 616e  bine {curr_1} an
+00006590: 6420 7b63 7572 725f 327d 2074 6f20 6765  d {curr_2} to ge
+000065a0: 7420 6120 7661 6c69 6420 7061 6972 2e22  t a valid pair."
+000065b0: 290a 0a20 2020 2064 6566 2076 616c 6964  )..    def valid
+000065c0: 6174 655f 7469 6d65 6672 616d 6573 2873  ate_timeframes(s
+000065d0: 656c 662c 2074 696d 6566 7261 6d65 3a20  elf, timeframe: 
+000065e0: 4f70 7469 6f6e 616c 5b73 7472 5d29 202d  Optional[str]) -
+000065f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00006600: 2222 220a 2020 2020 2020 2020 4368 6563  """.        Chec
+00006610: 6b20 6966 2074 696d 6566 7261 6d65 2066  k if timeframe f
+00006620: 726f 6d20 636f 6e66 6967 2069 7320 6120  rom config is a 
+00006630: 7375 7070 6f72 7465 6420 7469 6d65 6672  supported timefr
+00006640: 616d 6520 6f6e 2074 6865 2065 7863 6861  ame on the excha
+00006650: 6e67 650a 2020 2020 2020 2020 2222 220a  nge.        """.
+00006660: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
+00006670: 6173 6174 7472 2873 656c 662e 5f61 7069  asattr(self._api
+00006680: 2c20 2274 696d 6566 7261 6d65 7322 2920  , "timeframes") 
+00006690: 6f72 2073 656c 662e 5f61 7069 2e74 696d  or self._api.tim
+000066a0: 6566 7261 6d65 7320 6973 204e 6f6e 653a  eframes is None:
+000066b0: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+000066c0: 6620 7469 6d65 6672 616d 6573 2061 7474  f timeframes att
+000066d0: 7269 6275 7465 2069 7320 6d69 7373 696e  ribute is missin
+000066e0: 6720 286f 7220 6973 204e 6f6e 6529 2c20  g (or is None), 
+000066f0: 7468 6520 6578 6368 616e 6765 2070 726f  the exchange pro
+00006700: 6261 626c 790a 2020 2020 2020 2020 2020  bably.          
+00006710: 2020 2320 6861 7320 6e6f 2066 6574 6368    # has no fetch
+00006720: 4f48 4c43 5620 6d65 7468 6f64 2e0a 2020  OHLCV method..  
+00006730: 2020 2020 2020 2020 2020 2320 5468 6572            # Ther
+00006740: 6566 6f72 6520 7765 2061 6c73 6f20 7368  efore we also sh
+00006750: 6f77 2074 6861 742e 0a20 2020 2020 2020  ow that..       
+00006760: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+00006770: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+00006780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006790: 2066 2254 6865 2063 6378 7420 6c69 6272   f"The ccxt libr
+000067a0: 6172 7920 646f 6573 206e 6f74 2070 726f  ary does not pro
+000067b0: 7669 6465 2074 6865 206c 6973 7420 6f66  vide the list of
+000067c0: 2074 696d 6566 7261 6d65 7320 220a 2020   timeframes ".  
+000067d0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+000067e0: 666f 7220 7468 6520 6578 6368 616e 6765  for the exchange
+000067f0: 207b 7365 6c66 2e6e 616d 657d 2061 6e64   {self.name} and
+00006800: 2074 6869 7320 6578 6368 616e 6765 2022   this exchange "
+00006810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006820: 2066 2269 7320 7468 6572 6566 6f72 6520   f"is therefore 
+00006830: 6e6f 7420 7375 7070 6f72 7465 642e 2063  not supported. c
+00006840: 6378 7420 6665 7463 684f 484c 4356 3a20  cxt fetchOHLCV: 
+00006850: 7b73 656c 662e 6578 6368 616e 6765 5f68  {self.exchange_h
+00006860: 6173 2827 6665 7463 684f 484c 4356 2729  as('fetchOHLCV')
+00006870: 7d22 290a 0a20 2020 2020 2020 2069 6620  }")..        if 
+00006880: 7469 6d65 6672 616d 6520 616e 6420 2874  timeframe and (t
+00006890: 696d 6566 7261 6d65 206e 6f74 2069 6e20  imeframe not in 
+000068a0: 7365 6c66 2e74 696d 6566 7261 6d65 7329  self.timeframes)
+000068b0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000068c0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+000068d0: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+000068e0: 2020 2020 2020 2020 2020 6622 496e 7661            f"Inva
+000068f0: 6c69 6420 7469 6d65 6672 616d 6520 277b  lid timeframe '{
+00006900: 7469 6d65 6672 616d 657d 272e 2054 6869  timeframe}'. Thi
+00006910: 7320 6578 6368 616e 6765 2073 7570 706f  s exchange suppo
+00006920: 7274 733a 207b 7365 6c66 2e74 696d 6566  rts: {self.timef
+00006930: 7261 6d65 737d 2229 0a0a 2020 2020 2020  rames}")..      
+00006940: 2020 6966 2074 696d 6566 7261 6d65 2061    if timeframe a
+00006950: 6e64 2074 696d 6566 7261 6d65 5f74 6f5f  nd timeframe_to_
+00006960: 6d69 6e75 7465 7328 7469 6d65 6672 616d  minutes(timefram
+00006970: 6529 203c 2031 3a0a 2020 2020 2020 2020  e) < 1:.        
+00006980: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+00006990: 696f 6e61 6c45 7863 6570 7469 6f6e 2822  ionalException("
+000069a0: 5469 6d65 6672 616d 6573 203c 2031 6d20  Timeframes < 1m 
+000069b0: 6172 6520 6375 7272 656e 746c 7920 6e6f  are currently no
+000069c0: 7420 7375 7070 6f72 7465 6420 6279 2046  t supported by F
+000069d0: 7265 7174 7261 6465 2e22 290a 0a20 2020  reqtrade.")..   
+000069e0: 2064 6566 2076 616c 6964 6174 655f 6f72   def validate_or
+000069f0: 6465 7274 7970 6573 2873 656c 662c 206f  dertypes(self, o
+00006a00: 7264 6572 5f74 7970 6573 3a20 4469 6374  rder_types: Dict
+00006a10: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00006a20: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
+00006a30: 6865 636b 7320 6966 206f 7264 6572 2d74  hecks if order-t
+00006a40: 7970 6573 2063 6f6e 6669 6775 7265 6420  ypes configured 
+00006a50: 696e 2073 7472 6174 6567 792f 636f 6e66  in strategy/conf
+00006a60: 6967 2061 7265 2073 7570 706f 7274 6564  ig are supported
+00006a70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00006a80: 2020 2020 2069 6620 616e 7928 7620 3d3d       if any(v ==
+00006a90: 2027 6d61 726b 6574 2720 666f 7220 6b2c   'market' for k,
+00006aa0: 2076 2069 6e20 6f72 6465 725f 7479 7065   v in order_type
+00006ab0: 732e 6974 656d 7328 2929 3a0a 2020 2020  s.items()):.    
+00006ac0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00006ad0: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
+00006ae0: 2827 6372 6561 7465 4d61 726b 6574 4f72  ('createMarketOr
+00006af0: 6465 7227 293a 0a20 2020 2020 2020 2020  der'):.         
+00006b00: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+00006b10: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+00006b20: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00006b30: 2020 2020 2020 2066 2745 7863 6861 6e67         f'Exchang
+00006b40: 6520 7b73 656c 662e 6e61 6d65 7d20 646f  e {self.name} do
+00006b50: 6573 206e 6f74 2073 7570 706f 7274 206d  es not support m
+00006b60: 6172 6b65 7420 6f72 6465 7273 2e27 290a  arket orders.').
+00006b70: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
+00006b80: 6964 6174 655f 7374 6f70 5f6f 7264 6572  idate_stop_order
+00006b90: 7479 7065 7328 6f72 6465 725f 7479 7065  types(order_type
+00006ba0: 7329 0a0a 2020 2020 6465 6620 7661 6c69  s)..    def vali
+00006bb0: 6461 7465 5f73 746f 705f 6f72 6465 7274  date_stop_ordert
+00006bc0: 7970 6573 2873 656c 662c 206f 7264 6572  ypes(self, order
+00006bd0: 5f74 7970 6573 3a20 4469 6374 2920 2d3e  _types: Dict) ->
+00006be0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00006bf0: 2222 0a20 2020 2020 2020 2056 616c 6964  "".        Valid
+00006c00: 6174 6520 7374 6f70 6c6f 7373 206f 7264  ate stoploss ord
+00006c10: 6572 2074 7970 6573 0a20 2020 2020 2020  er types.       
+00006c20: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00006c30: 286f 7264 6572 5f74 7970 6573 2e67 6574  (order_types.get
+00006c40: 2822 7374 6f70 6c6f 7373 5f6f 6e5f 6578  ("stoploss_on_ex
+00006c50: 6368 616e 6765 2229 0a20 2020 2020 2020  change").       
+00006c60: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
+00006c70: 2073 656c 662e 5f66 745f 6861 732e 6765   self._ft_has.ge
+00006c80: 7428 2273 746f 706c 6f73 735f 6f6e 5f65  t("stoploss_on_e
+00006c90: 7863 6861 6e67 6522 2c20 4661 6c73 6529  xchange", False)
+00006ca0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00006cb0: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+00006cc0: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
+00006cd0: 2020 2020 2020 2020 2020 2066 274f 6e20             f'On 
+00006ce0: 6578 6368 616e 6765 2073 746f 706c 6f73  exchange stoplos
+00006cf0: 7320 6973 206e 6f74 2073 7570 706f 7274  s is not support
+00006d00: 6564 2066 6f72 207b 7365 6c66 2e6e 616d  ed for {self.nam
+00006d10: 657d 2e27 0a20 2020 2020 2020 2020 2020  e}.'.           
+00006d20: 2029 0a20 2020 2020 2020 2069 6620 7365   ).        if se
+00006d30: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
+00006d40: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e46  == TradingMode.F
+00006d50: 5554 5552 4553 3a0a 2020 2020 2020 2020  UTURES:.        
+00006d60: 2020 2020 7072 6963 655f 6d61 7070 696e      price_mappin
+00006d70: 6720 3d20 7365 6c66 2e5f 6674 5f68 6173  g = self._ft_has
+00006d80: 2e67 6574 2827 7374 6f70 5f70 7269 6365  .get('stop_price
+00006d90: 5f74 7970 655f 7661 6c75 655f 6d61 7070  _type_value_mapp
+00006da0: 696e 6727 2c20 7b7d 292e 6b65 7973 2829  ing', {}).keys()
+00006db0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00006dc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00006dd0: 2020 6f72 6465 725f 7479 7065 732e 6765    order_types.ge
+00006de0: 7428 2273 746f 706c 6f73 735f 6f6e 5f65  t("stoploss_on_e
+00006df0: 7863 6861 6e67 6522 2c20 4661 6c73 6529  xchange", False)
+00006e00: 2069 7320 5472 7565 0a20 2020 2020 2020   is True.       
+00006e10: 2020 2020 2020 2020 2061 6e64 2027 7374           and 'st
+00006e20: 6f70 6c6f 7373 5f70 7269 6365 5f74 7970  oploss_price_typ
+00006e30: 6527 2069 6e20 6f72 6465 725f 7479 7065  e' in order_type
+00006e40: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00006e50: 2020 616e 6420 6f72 6465 725f 7479 7065    and order_type
+00006e60: 735b 2773 746f 706c 6f73 735f 7072 6963  s['stoploss_pric
+00006e70: 655f 7479 7065 275d 206e 6f74 2069 6e20  e_type'] not in 
+00006e80: 7072 6963 655f 6d61 7070 696e 670a 2020  price_mapping.  
+00006e90: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00006ea0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00006eb0: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+00006ec0: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
+00006ed0: 2020 2020 2020 2020 2020 2020 2066 274f               f'O
+00006ee0: 6e20 6578 6368 616e 6765 2073 746f 706c  n exchange stopl
+00006ef0: 6f73 7320 7072 6963 6520 7479 7065 2069  oss price type i
+00006f00: 7320 6e6f 7420 7375 7070 6f72 7465 6420  s not supported 
+00006f10: 666f 7220 7b73 656c 662e 6e61 6d65 7d2e  for {self.name}.
+00006f20: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00006f30: 2020 290a 0a20 2020 2064 6566 2076 616c    )..    def val
+00006f40: 6964 6174 655f 7072 6963 696e 6728 7365  idate_pricing(se
+00006f50: 6c66 2c20 7072 6963 696e 673a 2044 6963  lf, pricing: Dic
+00006f60: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
+00006f70: 2020 2020 6966 2070 7269 6369 6e67 2e67      if pricing.g
+00006f80: 6574 2827 7573 655f 6f72 6465 725f 626f  et('use_order_bo
+00006f90: 6f6b 272c 2046 616c 7365 2920 616e 6420  ok', False) and 
+00006fa0: 6e6f 7420 7365 6c66 2e65 7863 6861 6e67  not self.exchang
+00006fb0: 655f 6861 7328 2766 6574 6368 4c32 4f72  e_has('fetchL2Or
+00006fc0: 6465 7242 6f6f 6b27 293a 0a20 2020 2020  derBook'):.     
+00006fd0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+00006fe0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+00006ff0: 6e28 6627 4f72 6465 7262 6f6f 6b20 6e6f  n(f'Orderbook no
+00007000: 7420 6176 6169 6c61 626c 6520 666f 7220  t available for 
+00007010: 7b73 656c 662e 6e61 6d65 7d2e 2729 0a20  {self.name}.'). 
+00007020: 2020 2020 2020 2069 6620 286e 6f74 2070         if (not p
+00007030: 7269 6369 6e67 2e67 6574 2827 7573 655f  ricing.get('use_
+00007040: 6f72 6465 725f 626f 6f6b 272c 2046 616c  order_book', Fal
+00007050: 7365 2920 616e 6420 280a 2020 2020 2020  se) and (.      
+00007060: 2020 2020 2020 2020 2020 6e6f 7420 7365            not se
+00007070: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
+00007080: 2766 6574 6368 5469 636b 6572 2729 0a20  'fetchTicker'). 
+00007090: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000070a0: 7220 6e6f 7420 7365 6c66 2e5f 6674 5f68  r not self._ft_h
+000070b0: 6173 5b27 7469 636b 6572 735f 6861 7665  as['tickers_have
+000070c0: 5f70 7269 6365 275d 2929 3a0a 2020 2020  _price'])):.    
+000070d0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+000070e0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+000070f0: 6f6e 2866 2754 6963 6b65 7220 7072 6963  on(f'Ticker pric
+00007100: 696e 6720 6e6f 7420 6176 6169 6c61 626c  ing not availabl
+00007110: 6520 666f 7220 7b73 656c 662e 6e61 6d65  e for {self.name
+00007120: 7d2e 2729 0a0a 2020 2020 6465 6620 7661  }.')..    def va
+00007130: 6c69 6461 7465 5f6f 7264 6572 5f74 696d  lidate_order_tim
+00007140: 655f 696e 5f66 6f72 6365 2873 656c 662c  e_in_force(self,
+00007150: 206f 7264 6572 5f74 696d 655f 696e 5f66   order_time_in_f
+00007160: 6f72 6365 3a20 4469 6374 2920 2d3e 204e  orce: Dict) -> N
+00007170: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00007180: 0a20 2020 2020 2020 2043 6865 636b 7320  .        Checks 
+00007190: 6966 206f 7264 6572 2074 696d 6520 696e  if order time in
+000071a0: 2066 6f72 6365 2063 6f6e 6669 6775 7265   force configure
+000071b0: 6420 696e 2073 7472 6174 6567 792f 636f  d in strategy/co
+000071c0: 6e66 6967 2061 7265 2073 7570 706f 7274  nfig are support
+000071d0: 6564 0a20 2020 2020 2020 2022 2222 0a20  ed.        """. 
+000071e0: 2020 2020 2020 2069 6620 616e 7928 762e         if any(v.
+000071f0: 7570 7065 7228 2920 6e6f 7420 696e 2073  upper() not in s
+00007200: 656c 662e 5f66 745f 6861 735b 226f 7264  elf._ft_has["ord
+00007210: 6572 5f74 696d 655f 696e 5f66 6f72 6365  er_time_in_force
+00007220: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
+00007230: 2020 666f 7220 6b2c 2076 2069 6e20 6f72    for k, v in or
+00007240: 6465 725f 7469 6d65 5f69 6e5f 666f 7263  der_time_in_forc
+00007250: 652e 6974 656d 7328 2929 3a0a 2020 2020  e.items()):.    
+00007260: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+00007270: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+00007280: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00007290: 2020 2020 6627 5469 6d65 2069 6e20 666f      f'Time in fo
+000072a0: 7263 6520 706f 6c69 6369 6573 2061 7265  rce policies are
+000072b0: 206e 6f74 2073 7570 706f 7274 6564 2066   not supported f
+000072c0: 6f72 207b 7365 6c66 2e6e 616d 657d 2079  or {self.name} y
+000072d0: 6574 2e27 290a 0a20 2020 2064 6566 2076  et.')..    def v
+000072e0: 616c 6964 6174 655f 7265 7175 6972 6564  alidate_required
+000072f0: 5f73 7461 7274 7570 5f63 616e 646c 6573  _startup_candles
+00007300: 2873 656c 662c 2073 7461 7274 7570 5f63  (self, startup_c
+00007310: 616e 646c 6573 3a20 696e 742c 2074 696d  andles: int, tim
+00007320: 6566 7261 6d65 3a20 7374 7229 202d 3e20  eframe: str) -> 
+00007330: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+00007340: 0a20 2020 2020 2020 2043 6865 636b 7320  .        Checks 
+00007350: 6966 2072 6571 7569 7265 6420 7374 6172  if required star
+00007360: 7475 705f 6361 6e64 6c65 7320 6973 206d  tup_candles is m
+00007370: 6f72 6520 7468 616e 206f 686c 6376 5f63  ore than ohlcv_c
+00007380: 616e 646c 655f 6c69 6d69 7428 292e 0a20  andle_limit().. 
+00007390: 2020 2020 2020 2052 6571 7569 7265 7320         Requires 
+000073a0: 6120 6772 6163 652d 7065 7269 6f64 206f  a grace-period o
+000073b0: 6620 3520 6361 6e64 6c65 7320 2d20 736f  f 5 candles - so
+000073c0: 2061 2073 7461 7274 7570 2d70 6572 696f   a startup-perio
+000073d0: 6420 7570 2074 6f20 3439 3420 6973 2061  d up to 494 is a
+000073e0: 6c6c 6f77 6564 2062 7920 6465 6661 756c  llowed by defaul
+000073f0: 742e 0a20 2020 2020 2020 2022 2222 0a0a  t..        """..
+00007400: 2020 2020 2020 2020 6361 6e64 6c65 5f6c          candle_l
+00007410: 696d 6974 203d 2073 656c 662e 6f68 6c63  imit = self.ohlc
+00007420: 765f 6361 6e64 6c65 5f6c 696d 6974 280a  v_candle_limit(.
+00007430: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+00007440: 6672 616d 652c 2073 656c 662e 5f63 6f6e  frame, self._con
+00007450: 6669 675b 2763 616e 646c 655f 7479 7065  fig['candle_type
+00007460: 5f64 6566 275d 2c0a 2020 2020 2020 2020  _def'],.        
+00007470: 2020 2020 696e 7428 6461 7465 5f6d 696e      int(date_min
+00007480: 7573 5f63 616e 646c 6573 2874 696d 6566  us_candles(timef
+00007490: 7261 6d65 2c20 7374 6172 7475 705f 6361  rame, startup_ca
+000074a0: 6e64 6c65 7329 2e74 696d 6573 7461 6d70  ndles).timestamp
+000074b0: 2829 202a 2031 3030 3029 0a20 2020 2020  () * 1000).     
+000074c0: 2020 2020 2020 2069 6620 7469 6d65 6672         if timefr
+000074d0: 616d 6520 656c 7365 204e 6f6e 6529 0a20  ame else None). 
+000074e0: 2020 2020 2020 2023 2052 6571 7569 7265         # Require
+000074f0: 206f 6e65 206d 6f72 6520 6361 6e64 6c65   one more candle
+00007500: 202d 2074 6f20 6163 636f 756e 7420 666f   - to account fo
+00007510: 7220 7468 6520 7374 696c 6c20 6f70 656e  r the still open
+00007520: 2063 616e 646c 652e 0a20 2020 2020 2020   candle..       
+00007530: 2063 616e 646c 655f 636f 756e 7420 3d20   candle_count = 
+00007540: 7374 6172 7475 705f 6361 6e64 6c65 7320  startup_candles 
+00007550: 2b20 310a 2020 2020 2020 2020 2320 416c  + 1.        # Al
+00007560: 6c6f 7720 3520 6361 6c6c 7320 746f 2074  low 5 calls to t
+00007570: 6865 2065 7863 6861 6e67 6520 7065 7220  he exchange per 
+00007580: 7061 6972 0a20 2020 2020 2020 2072 6571  pair.        req
+00007590: 7569 7265 645f 6361 6e64 6c65 5f63 616c  uired_candle_cal
+000075a0: 6c5f 636f 756e 7420 3d20 696e 7428 0a20  l_count = int(. 
+000075b0: 2020 2020 2020 2020 2020 2028 6361 6e64             (cand
+000075c0: 6c65 5f63 6f75 6e74 202f 2063 616e 646c  le_count / candl
+000075d0: 655f 6c69 6d69 7429 202b 2028 3020 6966  e_limit) + (0 if
+000075e0: 2063 616e 646c 655f 636f 756e 7420 2520   candle_count % 
+000075f0: 6361 6e64 6c65 5f6c 696d 6974 203d 3d20  candle_limit == 
+00007600: 3020 656c 7365 2031 2929 0a20 2020 2020  0 else 1)).     
+00007610: 2020 2069 6620 7365 6c66 2e5f 6674 5f68     if self._ft_h
+00007620: 6173 5b27 6f68 6c63 765f 6861 735f 6869  as['ohlcv_has_hi
+00007630: 7374 6f72 7927 5d3a 0a0a 2020 2020 2020  story']:..      
+00007640: 2020 2020 2020 6966 2072 6571 7569 7265        if require
+00007650: 645f 6361 6e64 6c65 5f63 616c 6c5f 636f  d_candle_call_co
+00007660: 756e 7420 3e20 353a 0a20 2020 2020 2020  unt > 5:.       
+00007670: 2020 2020 2020 2020 2023 204f 6e6c 7920           # Only 
+00007680: 616c 6c6f 7720 3520 6361 6c6c 7320 7065  allow 5 calls pe
+00007690: 7220 7061 6972 2074 6f20 736f 6d65 7768  r pair to somewh
+000076a0: 6174 206c 696d 6974 2074 6865 2069 6d70  at limit the imp
+000076b0: 6163 740a 2020 2020 2020 2020 2020 2020  act.            
+000076c0: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+000076d0: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
+000076e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076f0: 2020 2020 6622 5468 6973 2073 7472 6174      f"This strat
+00007700: 6567 7920 7265 7175 6972 6573 207b 7374  egy requires {st
+00007710: 6172 7475 705f 6361 6e64 6c65 737d 2063  artup_candles} c
+00007720: 616e 646c 6573 2074 6f20 7374 6172 742c  andles to start,
+00007730: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00007740: 2020 2020 2020 2022 7768 6963 6820 6973         "which is
+00007750: 206d 6f72 6520 7468 616e 2035 7820 220a   more than 5x ".
+00007760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007770: 2020 2020 6622 7468 6520 616d 6f75 6e74      f"the amount
+00007780: 206f 6620 6361 6e64 6c65 7320 7b73 656c   of candles {sel
+00007790: 662e 6e61 6d65 7d20 7072 6f76 6964 6573  f.name} provides
+000077a0: 2066 6f72 207b 7469 6d65 6672 616d 657d   for {timeframe}
+000077b0: 2e22 290a 2020 2020 2020 2020 656c 6966  .").        elif
+000077c0: 2072 6571 7569 7265 645f 6361 6e64 6c65   required_candle
+000077d0: 5f63 616c 6c5f 636f 756e 7420 3e20 313a  _call_count > 1:
+000077e0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000077f0: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+00007800: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
+00007810: 2020 2020 2020 2020 2066 2254 6869 7320           f"This 
+00007820: 7374 7261 7465 6779 2072 6571 7569 7265  strategy require
+00007830: 7320 7b73 7461 7274 7570 5f63 616e 646c  s {startup_candl
+00007840: 6573 7d20 6361 6e64 6c65 7320 746f 2073  es} candles to s
+00007850: 7461 7274 2c20 7768 6963 6820 6973 206d  tart, which is m
+00007860: 6f72 6520 7468 616e 2022 0a20 2020 2020  ore than ".     
+00007870: 2020 2020 2020 2020 2020 2066 2274 6865             f"the
+00007880: 2061 6d6f 756e 7420 6f66 2063 616e 646c   amount of candl
+00007890: 6573 207b 7365 6c66 2e6e 616d 657d 2070  es {self.name} p
+000078a0: 726f 7669 6465 7320 666f 7220 7b74 696d  rovides for {tim
+000078b0: 6566 7261 6d65 7d2e 2229 0a20 2020 2020  eframe}.").     
+000078c0: 2020 2069 6620 7265 7175 6972 6564 5f63     if required_c
+000078d0: 616e 646c 655f 6361 6c6c 5f63 6f75 6e74  andle_call_count
+000078e0: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
+000078f0: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+00007900: 2866 2255 7369 6e67 207b 7265 7175 6972  (f"Using {requir
+00007910: 6564 5f63 616e 646c 655f 6361 6c6c 5f63  ed_candle_call_c
+00007920: 6f75 6e74 7d20 6361 6c6c 7320 746f 2067  ount} calls to g
+00007930: 6574 204f 484c 4356 2e20 220a 2020 2020  et OHLCV. ".    
+00007940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007950: 2020 2020 2020 2066 2254 6869 7320 6361         f"This ca
+00007960: 6e20 7265 7375 6c74 2069 6e20 736c 6f77  n result in slow
+00007970: 6572 206f 7065 7261 7469 6f6e 7320 666f  er operations fo
+00007980: 7220 7468 6520 626f 742e 2050 6c65 6173  r the bot. Pleas
+00007990: 6520 6368 6563 6b20 220a 2020 2020 2020  e check ".      
+000079a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079b0: 2020 2020 2066 2269 6620 796f 7520 7265       f"if you re
+000079c0: 616c 6c79 206e 6565 6420 7b73 7461 7274  ally need {start
+000079d0: 7570 5f63 616e 646c 6573 7d20 6361 6e64  up_candles} cand
+000079e0: 6c65 7320 666f 7220 796f 7572 2073 7472  les for your str
+000079f0: 6174 6567 7922 290a 2020 2020 2020 2020  ategy").        
+00007a00: 7265 7475 726e 2072 6571 7569 7265 645f  return required_
+00007a10: 6361 6e64 6c65 5f63 616c 6c5f 636f 756e  candle_call_coun
+00007a20: 740a 0a20 2020 2064 6566 2076 616c 6964  t..    def valid
+00007a30: 6174 655f 7472 6164 696e 675f 6d6f 6465  ate_trading_mode
+00007a40: 5f61 6e64 5f6d 6172 6769 6e5f 6d6f 6465  _and_margin_mode
+00007a50: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00007a60: 2020 2020 2020 2020 7472 6164 696e 675f          trading_
+00007a70: 6d6f 6465 3a20 5472 6164 696e 674d 6f64  mode: TradingMod
+00007a80: 652c 0a20 2020 2020 2020 206d 6172 6769  e,.        margi
+00007a90: 6e5f 6d6f 6465 3a20 4f70 7469 6f6e 616c  n_mode: Optional
+00007aa0: 5b4d 6172 6769 6e4d 6f64 655d 2020 2320  [MarginMode]  # 
+00007ab0: 4f6e 6c79 204e 6f6e 6520 7768 656e 2074  Only None when t
+00007ac0: 7261 6469 6e67 5f6d 6f64 6520 3d20 5472  rading_mode = Tr
+00007ad0: 6164 696e 674d 6f64 652e 5350 4f54 0a20  adingMode.SPOT. 
+00007ae0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00007af0: 220a 2020 2020 2020 2020 4368 6563 6b73  ".        Checks
+00007b00: 2069 6620 6672 6571 7472 6164 6520 6361   if freqtrade ca
+00007b10: 6e20 7065 7266 6f72 6d20 7472 6164 6573  n perform trades
+00007b20: 2075 7369 6e67 2074 6865 2063 6f6e 6669   using the confi
+00007b30: 6775 7265 640a 2020 2020 2020 2020 7472  gured.        tr
+00007b40: 6164 696e 6720 6d6f 6465 284d 6172 6769  ading mode(Margi
+00007b50: 6e2c 2046 7574 7572 6573 2920 616e 6420  n, Futures) and 
+00007b60: 4d61 7267 696e 4d6f 6465 2843 726f 7373  MarginMode(Cross
+00007b70: 2c20 4973 6f6c 6174 6564 290a 2020 2020  , Isolated).    
+00007b80: 2020 2020 5468 726f 7773 204f 7065 7261      Throws Opera
+00007b90: 7469 6f6e 616c 4578 6365 7074 696f 6e3a  tionalException:
+00007ba0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00007bb0: 7468 6520 7472 6164 696e 675f 6d6f 6465  the trading_mode
+00007bc0: 2f6d 6172 6769 6e5f 6d6f 6465 2074 7970  /margin_mode typ
+00007bd0: 6520 6172 6520 6e6f 7420 7375 7070 6f72  e are not suppor
+00007be0: 7465 6420 6279 2066 7265 7174 7261 6465  ted by freqtrade
+00007bf0: 206f 6e20 7468 6973 2065 7863 6861 6e67   on this exchang
+00007c00: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00007c10: 2020 2020 2020 6966 2074 7261 6469 6e67        if trading
+00007c20: 5f6d 6f64 6520 213d 2054 7261 6469 6e67  _mode != Trading
+00007c30: 4d6f 6465 2e53 504f 5420 616e 6420 280a  Mode.SPOT and (.
+00007c40: 2020 2020 2020 2020 2020 2020 2874 7261              (tra
+00007c50: 6469 6e67 5f6d 6f64 652c 206d 6172 6769  ding_mode, margi
+00007c60: 6e5f 6d6f 6465 2920 6e6f 7420 696e 2073  n_mode) not in s
+00007c70: 656c 662e 5f73 7570 706f 7274 6564 5f74  elf._supported_t
+00007c80: 7261 6469 6e67 5f6d 6f64 655f 6d61 7267  rading_mode_marg
+00007c90: 696e 5f70 6169 7273 0a20 2020 2020 2020  in_pairs.       
+00007ca0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00007cb0: 6d6d 5f76 616c 7565 203d 206d 6172 6769  mm_value = margi
+00007cc0: 6e5f 6d6f 6465 2061 6e64 206d 6172 6769  n_mode and margi
+00007cd0: 6e5f 6d6f 6465 2e76 616c 7565 0a20 2020  n_mode.value.   
+00007ce0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+00007cf0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00007d00: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+00007d10: 2020 2020 2066 2246 7265 7174 7261 6465       f"Freqtrade
+00007d20: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
+00007d30: 7420 7b6d 6d5f 7661 6c75 657d 207b 7472  t {mm_value} {tr
+00007d40: 6164 696e 675f 6d6f 6465 2e76 616c 7565  ading_mode.value
+00007d50: 7d20 6f6e 207b 7365 6c66 2e6e 616d 657d  } on {self.name}
+00007d60: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00007d70: 0a20 2020 2064 6566 2067 6574 5f6f 7074  .    def get_opt
+00007d80: 696f 6e28 7365 6c66 2c20 7061 7261 6d3a  ion(self, param:
+00007d90: 2073 7472 2c20 6465 6661 756c 743a 204f   str, default: O
+00007da0: 7074 696f 6e61 6c5b 416e 795d 203d 204e  ptional[Any] = N
+00007db0: 6f6e 6529 202d 3e20 416e 793a 0a20 2020  one) -> Any:.   
+00007dc0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00007dd0: 2047 6574 2070 6172 616d 6574 6572 2076   Get parameter v
+00007de0: 616c 7565 2066 726f 6d20 5f66 745f 6861  alue from _ft_ha
+00007df0: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
+00007e00: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00007e10: 662e 5f66 745f 6861 732e 6765 7428 7061  f._ft_has.get(pa
+00007e20: 7261 6d2c 2064 6566 6175 6c74 290a 0a20  ram, default).. 
+00007e30: 2020 2064 6566 2065 7863 6861 6e67 655f     def exchange_
+00007e40: 6861 7328 7365 6c66 2c20 656e 6470 6f69  has(self, endpoi
+00007e50: 6e74 3a20 7374 7229 202d 3e20 626f 6f6c  nt: str) -> bool
+00007e60: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00007e70: 2020 2020 2020 4368 6563 6b73 2069 6620        Checks if 
+00007e80: 6578 6368 616e 6765 2069 6d70 6c65 6d65  exchange impleme
+00007e90: 6e74 7320 6120 7370 6563 6966 6963 2041  nts a specific A
+00007ea0: 5049 2065 6e64 706f 696e 742e 0a20 2020  PI endpoint..   
+00007eb0: 2020 2020 2057 7261 7070 6572 2061 726f       Wrapper aro
+00007ec0: 756e 6420 6363 7874 2027 6861 7327 2061  und ccxt 'has' a
+00007ed0: 7474 7269 6275 7465 0a20 2020 2020 2020  ttribute.       
+00007ee0: 203a 7061 7261 6d20 656e 6470 6f69 6e74   :param endpoint
+00007ef0: 3a20 4e61 6d65 206f 6620 656e 6470 6f69  : Name of endpoi
+00007f00: 6e74 2028 652e 672e 2027 6665 7463 684f  nt (e.g. 'fetchO
+00007f10: 484c 4356 272c 2027 6665 7463 6854 6963  HLCV', 'fetchTic
+00007f20: 6b65 7273 2729 0a20 2020 2020 2020 203a  kers').        :
+00007f30: 7265 7475 726e 3a20 626f 6f6c 0a20 2020  return: bool.   
+00007f40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00007f50: 2072 6574 7572 6e20 656e 6470 6f69 6e74   return endpoint
+00007f60: 2069 6e20 7365 6c66 2e5f 6170 692e 6861   in self._api.ha
+00007f70: 7320 616e 6420 7365 6c66 2e5f 6170 692e  s and self._api.
+00007f80: 6861 735b 656e 6470 6f69 6e74 5d0a 0a20  has[endpoint].. 
+00007f90: 2020 2064 6566 2067 6574 5f70 7265 6369     def get_preci
+00007fa0: 7369 6f6e 5f61 6d6f 756e 7428 7365 6c66  sion_amount(self
+00007fb0: 2c20 7061 6972 3a20 7374 7229 202d 3e20  , pair: str) -> 
+00007fc0: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d3a  Optional[float]:
+00007fd0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00007fe0: 2020 2020 2052 6574 7572 6e73 2074 6865       Returns the
+00007ff0: 2061 6d6f 756e 7420 7072 6563 6973 696f   amount precisio
+00008000: 6e20 6f66 2074 6865 2065 7863 6861 6e67  n of the exchang
+00008010: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+00008020: 6d20 7061 6972 3a20 5061 6972 2074 6f20  m pair: Pair to 
+00008030: 6765 7420 7072 6563 6973 696f 6e20 666f  get precision fo
+00008040: 720a 2020 2020 2020 2020 3a72 6574 7572  r.        :retur
+00008050: 6e3a 2070 7265 6369 7369 6f6e 2066 6f72  n: precision for
+00008060: 2061 6d6f 756e 7420 6f72 204e 6f6e 652e   amount or None.
+00008070: 204d 7573 7420 6265 2075 7365 6420 696e   Must be used in
+00008080: 2063 6f6d 6269 6e61 7469 6f6e 2077 6974   combination wit
+00008090: 6820 7072 6563 6973 696f 6e4d 6f64 650a  h precisionMode.
+000080a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000080b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000080c0: 6d61 726b 6574 732e 6765 7428 7061 6972  markets.get(pair
+000080d0: 2c20 7b7d 292e 6765 7428 2770 7265 6369  , {}).get('preci
+000080e0: 7369 6f6e 272c 207b 7d29 2e67 6574 2827  sion', {}).get('
+000080f0: 616d 6f75 6e74 272c 204e 6f6e 6529 0a0a  amount', None)..
+00008100: 2020 2020 6465 6620 6765 745f 7072 6563      def get_prec
+00008110: 6973 696f 6e5f 7072 6963 6528 7365 6c66  ision_price(self
+00008120: 2c20 7061 6972 3a20 7374 7229 202d 3e20  , pair: str) -> 
+00008130: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d3a  Optional[float]:
+00008140: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00008150: 2020 2020 2052 6574 7572 6e73 2074 6865       Returns the
+00008160: 2070 7269 6365 2070 7265 6369 7369 6f6e   price precision
+00008170: 206f 6620 7468 6520 6578 6368 616e 6765   of the exchange
+00008180: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00008190: 2070 6169 723a 2050 6169 7220 746f 2067   pair: Pair to g
+000081a0: 6574 2070 7265 6369 7369 6f6e 2066 6f72  et precision for
+000081b0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+000081c0: 3a20 7072 6563 6973 696f 6e20 666f 7220  : precision for 
+000081d0: 7072 6963 6520 6f72 204e 6f6e 652e 204d  price or None. M
+000081e0: 7573 7420 6265 2075 7365 6420 696e 2063  ust be used in c
+000081f0: 6f6d 6269 6e61 7469 6f6e 2077 6974 6820  ombination with 
+00008200: 7072 6563 6973 696f 6e4d 6f64 650a 2020  precisionMode.  
+00008210: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00008220: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+00008230: 726b 6574 732e 6765 7428 7061 6972 2c20  rkets.get(pair, 
+00008240: 7b7d 292e 6765 7428 2770 7265 6369 7369  {}).get('precisi
+00008250: 6f6e 272c 207b 7d29 2e67 6574 2827 7072  on', {}).get('pr
+00008260: 6963 6527 2c20 4e6f 6e65 290a 0a20 2020  ice', None)..   
+00008270: 2064 6566 2061 6d6f 756e 745f 746f 5f70   def amount_to_p
+00008280: 7265 6369 7369 6f6e 2873 656c 662c 2070  recision(self, p
+00008290: 6169 723a 2073 7472 2c20 616d 6f75 6e74  air: str, amount
+000082a0: 3a20 666c 6f61 7429 202d 3e20 666c 6f61  : float) -> floa
+000082b0: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+000082c0: 2020 2020 2020 2052 6574 7572 6e73 2074         Returns t
+000082d0: 6865 2061 6d6f 756e 7420 746f 2062 7579  he amount to buy
+000082e0: 206f 7220 7365 6c6c 2074 6f20 6120 7072   or sell to a pr
+000082f0: 6563 6973 696f 6e20 7468 6520 4578 6368  ecision the Exch
+00008300: 616e 6765 2061 6363 6570 7473 0a0a 2020  ange accepts..  
+00008310: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00008320: 2020 7265 7475 726e 2061 6d6f 756e 745f    return amount_
+00008330: 746f 5f70 7265 6369 7369 6f6e 2861 6d6f  to_precision(amo
+00008340: 756e 742c 2073 656c 662e 6765 745f 7072  unt, self.get_pr
+00008350: 6563 6973 696f 6e5f 616d 6f75 6e74 2870  ecision_amount(p
+00008360: 6169 7229 2c20 7365 6c66 2e70 7265 6369  air), self.preci
+00008370: 7369 6f6e 4d6f 6465 290a 0a20 2020 2064  sionMode)..    d
+00008380: 6566 2070 7269 6365 5f74 6f5f 7072 6563  ef price_to_prec
+00008390: 6973 696f 6e28 7365 6c66 2c20 7061 6972  ision(self, pair
+000083a0: 3a20 7374 722c 2070 7269 6365 3a20 666c  : str, price: fl
+000083b0: 6f61 742c 202a 2c20 726f 756e 6469 6e67  oat, *, rounding
+000083c0: 5f6d 6f64 653a 2069 6e74 203d 2052 4f55  _mode: int = ROU
+000083d0: 4e44 2920 2d3e 2066 6c6f 6174 3a0a 2020  ND) -> float:.  
+000083e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000083f0: 2020 5265 7475 726e 7320 7468 6520 7072    Returns the pr
+00008400: 6963 6520 726f 756e 6465 6420 746f 2074  ice rounded to t
+00008410: 6865 2070 7265 6369 7369 6f6e 2074 6865  he precision the
+00008420: 2045 7863 6861 6e67 6520 6163 6365 7074   Exchange accept
+00008430: 732e 0a20 2020 2020 2020 2054 6865 2064  s..        The d
+00008440: 6566 6175 6c74 2070 7269 6365 5f72 6f75  efault price_rou
+00008450: 6e64 696e 675f 6d6f 6465 2069 6e20 636f  nding_mode in co
+00008460: 6e66 2069 7320 524f 554e 442e 0a20 2020  nf is ROUND..   
+00008470: 2020 2020 2046 6f72 2073 746f 706c 6f73       For stoplos
+00008480: 7320 6361 6c63 756c 6174 696f 6e73 2c20  s calculations, 
+00008490: 6d75 7374 2075 7365 2052 4f55 4e44 5f55  must use ROUND_U
+000084a0: 5020 666f 7220 6c6f 6e67 732c 2061 6e64  P for longs, and
+000084b0: 2052 4f55 4e44 5f44 4f57 4e20 666f 7220   ROUND_DOWN for 
+000084c0: 7368 6f72 7473 2e0a 2020 2020 2020 2020  shorts..        
+000084d0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+000084e0: 726e 2070 7269 6365 5f74 6f5f 7072 6563  rn price_to_prec
+000084f0: 6973 696f 6e28 7072 6963 652c 2073 656c  ision(price, sel
+00008500: 662e 6765 745f 7072 6563 6973 696f 6e5f  f.get_precision_
+00008510: 7072 6963 6528 7061 6972 292c 0a20 2020  price(pair),.   
+00008520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008530: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008540: 656c 662e 7072 6563 6973 696f 6e4d 6f64  elf.precisionMod
+00008550: 652c 2072 6f75 6e64 696e 675f 6d6f 6465  e, rounding_mode
+00008560: 3d72 6f75 6e64 696e 675f 6d6f 6465 290a  =rounding_mode).
+00008570: 0a20 2020 2064 6566 2070 7269 6365 5f67  .    def price_g
+00008580: 6574 5f6f 6e65 5f70 6970 2873 656c 662c  et_one_pip(self,
+00008590: 2070 6169 723a 2073 7472 2c20 7072 6963   pair: str, pric
+000085a0: 653a 2066 6c6f 6174 2920 2d3e 2066 6c6f  e: float) -> flo
+000085b0: 6174 3a0a 2020 2020 2020 2020 2222 220a  at:.        """.
+000085c0: 2020 2020 2020 2020 4765 7427 7320 7468          Get's th
+000085d0: 6520 2231 2070 6970 2220 7661 6c75 6520  e "1 pip" value 
+000085e0: 666f 7220 7468 6973 2070 6169 722e 0a20  for this pair.. 
+000085f0: 2020 2020 2020 2055 7365 6420 696e 2050         Used in P
+00008600: 7269 6365 4669 6c74 6572 2074 6f20 6361  riceFilter to ca
+00008610: 6c63 756c 6174 6520 7468 6520 3170 6970  lculate the 1pip
+00008620: 206d 6f76 656d 656e 7473 2e0a 2020 2020   movements..    
+00008630: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00008640: 7072 6563 6973 696f 6e20 3d20 7365 6c66  precision = self
+00008650: 2e6d 6172 6b65 7473 5b70 6169 725d 5b27  .markets[pair]['
+00008660: 7072 6563 6973 696f 6e27 5d5b 2770 7269  precision']['pri
+00008670: 6365 275d 0a20 2020 2020 2020 2069 6620  ce'].        if 
+00008680: 7365 6c66 2e70 7265 6369 7369 6f6e 4d6f  self.precisionMo
+00008690: 6465 203d 3d20 5449 434b 5f53 495a 453a  de == TICK_SIZE:
+000086a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000086b0: 7572 6e20 7072 6563 6973 696f 6e0a 2020  urn precision.  
+000086c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000086d0: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
+000086e0: 202f 2070 6f77 2831 302c 2070 7265 6369   / pow(10, preci
+000086f0: 7369 6f6e 290a 0a20 2020 2064 6566 2067  sion)..    def g
+00008700: 6574 5f6d 696e 5f70 6169 725f 7374 616b  et_min_pair_stak
+00008710: 655f 616d 6f75 6e74 280a 2020 2020 2020  e_amount(.      
+00008720: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00008730: 7061 6972 3a20 7374 722c 0a20 2020 2020  pair: str,.     
+00008740: 2020 2070 7269 6365 3a20 666c 6f61 742c     price: float,
+00008750: 0a20 2020 2020 2020 2073 746f 706c 6f73  .        stoplos
+00008760: 733a 2066 6c6f 6174 2c0a 2020 2020 2020  s: float,.      
+00008770: 2020 6c65 7665 7261 6765 3a20 4f70 7469    leverage: Opti
+00008780: 6f6e 616c 5b66 6c6f 6174 5d20 3d20 312e  onal[float] = 1.
+00008790: 300a 2020 2020 2920 2d3e 204f 7074 696f  0.    ) -> Optio
+000087a0: 6e61 6c5b 666c 6f61 745d 3a0a 2020 2020  nal[float]:.    
+000087b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000087c0: 5f67 6574 5f73 7461 6b65 5f61 6d6f 756e  _get_stake_amoun
+000087d0: 745f 6c69 6d69 7428 7061 6972 2c20 7072  t_limit(pair, pr
+000087e0: 6963 652c 2073 746f 706c 6f73 732c 2027  ice, stoploss, '
+000087f0: 6d69 6e27 2c20 6c65 7665 7261 6765 290a  min', leverage).
+00008800: 0a20 2020 2064 6566 2067 6574 5f6d 6178  .    def get_max
+00008810: 5f70 6169 725f 7374 616b 655f 616d 6f75  _pair_stake_amou
+00008820: 6e74 2873 656c 662c 2070 6169 723a 2073  nt(self, pair: s
+00008830: 7472 2c20 7072 6963 653a 2066 6c6f 6174  tr, price: float
+00008840: 2c20 6c65 7665 7261 6765 3a20 666c 6f61  , leverage: floa
+00008850: 7420 3d20 312e 3029 202d 3e20 666c 6f61  t = 1.0) -> floa
+00008860: 743a 0a20 2020 2020 2020 206d 6178 5f73  t:.        max_s
+00008870: 7461 6b65 5f61 6d6f 756e 7420 3d20 7365  take_amount = se
+00008880: 6c66 2e5f 6765 745f 7374 616b 655f 616d  lf._get_stake_am
+00008890: 6f75 6e74 5f6c 696d 6974 2870 6169 722c  ount_limit(pair,
+000088a0: 2070 7269 6365 2c20 302e 302c 2027 6d61   price, 0.0, 'ma
+000088b0: 7827 2c20 6c65 7665 7261 6765 290a 2020  x', leverage).  
+000088c0: 2020 2020 2020 6966 206d 6178 5f73 7461        if max_sta
+000088d0: 6b65 5f61 6d6f 756e 7420 6973 204e 6f6e  ke_amount is Non
+000088e0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+000088f0: 202a 2053 686f 756c 6420 6e65 7665 7220   * Should never 
+00008900: 6265 2065 7865 6375 7465 640a 2020 2020  be executed.    
+00008910: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+00008920: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+00008930: 6f6e 2866 277b 7365 6c66 2e6e 616d 657d  on(f'{self.name}
+00008940: 2e67 6574 5f6d 6178 5f70 6169 725f 7374  .get_max_pair_st
+00008950: 616b 655f 616d 6f75 6e74 2073 686f 756c  ake_amount shoul
+00008960: 6427 0a20 2020 2020 2020 2020 2020 2020  d'.             
+00008970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008980: 2020 2020 2020 2020 2020 276e 6576 6572            'never
+00008990: 2073 6574 206d 6178 5f73 7461 6b65 5f61   set max_stake_a
+000089a0: 6d6f 756e 7420 746f 204e 6f6e 6527 290a  mount to None').
+000089b0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+000089c0: 6178 5f73 7461 6b65 5f61 6d6f 756e 740a  ax_stake_amount.
+000089d0: 0a20 2020 2064 6566 205f 6765 745f 7374  .    def _get_st
+000089e0: 616b 655f 616d 6f75 6e74 5f6c 696d 6974  ake_amount_limit
+000089f0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00008a00: 2020 2020 2020 2020 7061 6972 3a20 7374          pair: st
+00008a10: 722c 0a20 2020 2020 2020 2070 7269 6365  r,.        price
+00008a20: 3a20 666c 6f61 742c 0a20 2020 2020 2020  : float,.       
+00008a30: 2073 746f 706c 6f73 733a 2066 6c6f 6174   stoploss: float
+00008a40: 2c0a 2020 2020 2020 2020 6c69 6d69 743a  ,.        limit:
+00008a50: 204c 6974 6572 616c 5b27 6d69 6e27 2c20   Literal['min', 
+00008a60: 276d 6178 275d 2c0a 2020 2020 2020 2020  'max'],.        
+00008a70: 6c65 7665 7261 6765 3a20 4f70 7469 6f6e  leverage: Option
+00008a80: 616c 5b66 6c6f 6174 5d20 3d20 312e 300a  al[float] = 1.0.
+00008a90: 2020 2020 2920 2d3e 204f 7074 696f 6e61      ) -> Optiona
+00008aa0: 6c5b 666c 6f61 745d 3a0a 0a20 2020 2020  l[float]:..     
+00008ab0: 2020 2069 734d 696e 203d 206c 696d 6974     isMin = limit
+00008ac0: 203d 3d20 276d 696e 270a 0a20 2020 2020   == 'min'..     
+00008ad0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00008ae0: 2020 2020 6d61 726b 6574 203d 2073 656c      market = sel
+00008af0: 662e 6d61 726b 6574 735b 7061 6972 5d0a  f.markets[pair].
+00008b00: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+00008b10: 6579 4572 726f 723a 0a20 2020 2020 2020  eyError:.       
+00008b20: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00008b30: 4572 726f 7228 6622 4361 6e27 7420 6765  Error(f"Can't ge
+00008b40: 7420 6d61 726b 6574 2069 6e66 6f72 6d61  t market informa
+00008b50: 7469 6f6e 2066 6f72 2073 796d 626f 6c20  tion for symbol 
+00008b60: 7b70 6169 727d 2229 0a0a 2020 2020 2020  {pair}")..      
+00008b70: 2020 6966 2069 734d 696e 3a0a 2020 2020    if isMin:.    
+00008b80: 2020 2020 2020 2020 2320 7265 7365 7276          # reserv
+00008b90: 6520 736f 6d65 2070 6572 6365 6e74 2064  e some percent d
+00008ba0: 6566 696e 6564 2069 6e20 636f 6e66 6967  efined in config
+00008bb0: 2028 3525 2064 6566 6175 6c74 2920 2b20   (5% default) + 
+00008bc0: 7374 6f70 6c6f 7373 0a20 2020 2020 2020  stoploss.       
+00008bd0: 2020 2020 206d 6172 6769 6e5f 7265 7365       margin_rese
+00008be0: 7276 653a 2066 6c6f 6174 203d 2031 2e30  rve: float = 1.0
+00008bf0: 202b 2073 656c 662e 5f63 6f6e 6669 672e   + self._config.
+00008c00: 6765 7428 2761 6d6f 756e 745f 7265 7365  get('amount_rese
+00008c10: 7276 655f 7065 7263 656e 7427 2c0a 2020  rve_percent',.  
+00008c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c50: 2020 2020 2020 2020 2044 4546 4155 4c54           DEFAULT
+00008c60: 5f41 4d4f 554e 545f 5245 5345 5256 455f  _AMOUNT_RESERVE_
+00008c70: 5045 5243 454e 5429 0a20 2020 2020 2020  PERCENT).       
+00008c80: 2020 2020 2073 746f 706c 6f73 735f 7265       stoploss_re
+00008c90: 7365 7276 6520 3d20 280a 2020 2020 2020  serve = (.      
+00008ca0: 2020 2020 2020 2020 2020 6d61 7267 696e            margin
+00008cb0: 5f72 6573 6572 7665 202f 2028 3120 2d20  _reserve / (1 - 
+00008cc0: 6162 7328 7374 6f70 6c6f 7373 2929 2069  abs(stoploss)) i
+00008cd0: 6620 6162 7328 7374 6f70 6c6f 7373 2920  f abs(stoploss) 
+00008ce0: 213d 2031 2065 6c73 6520 312e 350a 2020  != 1 else 1.5.  
+00008cf0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00008d00: 2020 2020 2020 2020 2320 6974 2073 686f          # it sho
+00008d10: 756c 6420 6e6f 7420 6265 206d 6f72 6520  uld not be more 
+00008d20: 7468 616e 2035 3025 0a20 2020 2020 2020  than 50%.       
+00008d30: 2020 2020 2073 746f 706c 6f73 735f 7265       stoploss_re
+00008d40: 7365 7276 6520 3d20 6d61 7828 6d69 6e28  serve = max(min(
+00008d50: 7374 6f70 6c6f 7373 5f72 6573 6572 7665  stoploss_reserve
+00008d60: 2c20 312e 3529 2c20 3129 0a20 2020 2020  , 1.5), 1).     
+00008d70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00008d80: 2020 2020 206d 6172 6769 6e5f 7265 7365       margin_rese
+00008d90: 7276 6520 3d20 312e 300a 2020 2020 2020  rve = 1.0.      
+00008da0: 2020 2020 2020 7374 6f70 6c6f 7373 5f72        stoploss_r
+00008db0: 6573 6572 7665 203d 2031 2e30 0a0a 2020  eserve = 1.0..  
+00008dc0: 2020 2020 2020 7374 616b 655f 6c69 6d69        stake_limi
+00008dd0: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
+00008de0: 6c69 6d69 7473 203d 206d 6172 6b65 745b  limits = market[
+00008df0: 276c 696d 6974 7327 5d0a 2020 2020 2020  'limits'].      
+00008e00: 2020 6966 2028 6c69 6d69 7473 5b27 636f    if (limits['co
+00008e10: 7374 275d 5b6c 696d 6974 5d20 6973 206e  st'][limit] is n
+00008e20: 6f74 204e 6f6e 6529 3a0a 2020 2020 2020  ot None):.      
+00008e30: 2020 2020 2020 7374 616b 655f 6c69 6d69        stake_limi
+00008e40: 7473 2e61 7070 656e 6428 0a20 2020 2020  ts.append(.     
+00008e50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008e60: 5f63 6f6e 7472 6163 7473 5f74 6f5f 616d  _contracts_to_am
+00008e70: 6f75 6e74 2870 6169 722c 206c 696d 6974  ount(pair, limit
+00008e80: 735b 2763 6f73 7427 5d5b 6c69 6d69 745d  s['cost'][limit]
+00008e90: 2920 2a20 7374 6f70 6c6f 7373 5f72 6573  ) * stoploss_res
+00008ea0: 6572 7665 0a20 2020 2020 2020 2020 2020  erve.           
+00008eb0: 2029 0a0a 2020 2020 2020 2020 6966 2028   )..        if (
+00008ec0: 6c69 6d69 7473 5b27 616d 6f75 6e74 275d  limits['amount']
+00008ed0: 5b6c 696d 6974 5d20 6973 206e 6f74 204e  [limit] is not N
+00008ee0: 6f6e 6529 3a0a 2020 2020 2020 2020 2020  one):.          
+00008ef0: 2020 7374 616b 655f 6c69 6d69 7473 2e61    stake_limits.a
+00008f00: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
+00008f10: 2020 2020 2020 2073 656c 662e 5f63 6f6e         self._con
+00008f20: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
+00008f30: 2870 6169 722c 206c 696d 6974 735b 2761  (pair, limits['a
+00008f40: 6d6f 756e 7427 5d5b 6c69 6d69 745d 2920  mount'][limit]) 
+00008f50: 2a20 7072 6963 6520 2a20 6d61 7267 696e  * price * margin
+00008f60: 5f72 6573 6572 7665 0a20 2020 2020 2020  _reserve.       
+00008f70: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00008f80: 6966 206e 6f74 2073 7461 6b65 5f6c 696d  if not stake_lim
+00008f90: 6974 733a 0a20 2020 2020 2020 2020 2020  its:.           
+00008fa0: 2072 6574 7572 6e20 4e6f 6e65 2069 6620   return None if 
+00008fb0: 6973 4d69 6e20 656c 7365 2066 6c6f 6174  isMin else float
+00008fc0: 2827 696e 6627 290a 0a20 2020 2020 2020  ('inf')..       
+00008fd0: 2023 2054 6865 2076 616c 7565 2072 6574   # The value ret
+00008fe0: 7572 6e65 6420 7368 6f75 6c64 2073 6174  urned should sat
+00008ff0: 6973 6679 2062 6f74 6820 6c69 6d69 7473  isfy both limits
+00009000: 3a20 666f 7220 616d 6f75 6e74 2028 6261  : for amount (ba
+00009010: 7365 2063 7572 7265 6e63 7929 2061 6e64  se currency) and
+00009020: 0a20 2020 2020 2020 2023 2066 6f72 2063  .        # for c
+00009030: 6f73 7420 2871 756f 7465 2c20 7374 616b  ost (quote, stak
+00009040: 6520 6375 7272 656e 6379 292c 2073 6f20  e currency), so 
+00009050: 6d61 7828 2920 6973 2075 7365 6420 6865  max() is used he
+00009060: 7265 2e0a 2020 2020 2020 2020 2320 5365  re..        # Se
+00009070: 6520 616c 736f 2023 3235 3735 2061 7420  e also #2575 at 
+00009080: 6769 7468 7562 2e0a 2020 2020 2020 2020  github..        
+00009090: 7265 7475 726e 2073 656c 662e 5f67 6574  return self._get
+000090a0: 5f73 7461 6b65 5f61 6d6f 756e 745f 636f  _stake_amount_co
+000090b0: 6e73 6964 6572 696e 675f 6c65 7665 7261  nsidering_levera
+000090c0: 6765 280a 2020 2020 2020 2020 2020 2020  ge(.            
+000090d0: 6d61 7828 7374 616b 655f 6c69 6d69 7473  max(stake_limits
+000090e0: 2920 6966 2069 734d 696e 2065 6c73 6520  ) if isMin else 
+000090f0: 6d69 6e28 7374 616b 655f 6c69 6d69 7473  min(stake_limits
+00009100: 292c 0a20 2020 2020 2020 2020 2020 206c  ),.            l
+00009110: 6576 6572 6167 6520 6f72 2031 2e30 0a20  everage or 1.0. 
+00009120: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00009130: 6620 5f67 6574 5f73 7461 6b65 5f61 6d6f  f _get_stake_amo
+00009140: 756e 745f 636f 6e73 6964 6572 696e 675f  unt_considering_
+00009150: 6c65 7665 7261 6765 2873 656c 662c 2073  leverage(self, s
+00009160: 7461 6b65 5f61 6d6f 756e 743a 2066 6c6f  take_amount: flo
+00009170: 6174 2c20 6c65 7665 7261 6765 3a20 666c  at, leverage: fl
+00009180: 6f61 7429 202d 3e20 666c 6f61 743a 0a20  oat) -> float:. 
+00009190: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000091a0: 2020 2054 616b 6573 2074 6865 206d 696e     Takes the min
+000091b0: 696d 756d 2073 7461 6b65 2061 6d6f 756e  imum stake amoun
+000091c0: 7420 666f 7220 6120 7061 6972 2077 6974  t for a pair wit
+000091d0: 6820 6e6f 206c 6576 6572 6167 6520 616e  h no leverage an
+000091e0: 6420 7265 7475 726e 7320 7468 6520 6d69  d returns the mi
+000091f0: 6e69 6d75 6d0a 2020 2020 2020 2020 7374  nimum.        st
+00009200: 616b 6520 616d 6f75 6e74 2077 6865 6e20  ake amount when 
+00009210: 6c65 7665 7261 6765 2069 7320 636f 6e73  leverage is cons
+00009220: 6964 6572 6564 0a20 2020 2020 2020 203a  idered.        :
+00009230: 7061 7261 6d20 7374 616b 655f 616d 6f75  param stake_amou
+00009240: 6e74 3a20 5468 6520 7374 616b 6520 616d  nt: The stake am
+00009250: 6f75 6e74 2066 6f72 2061 2070 6169 7220  ount for a pair 
+00009260: 6265 666f 7265 206c 6576 6572 6167 6520  before leverage 
+00009270: 6973 2063 6f6e 7369 6465 7265 640a 2020  is considered.  
+00009280: 2020 2020 2020 3a70 6172 616d 206c 6576        :param lev
+00009290: 6572 6167 653a 2054 6865 2061 6d6f 756e  erage: The amoun
+000092a0: 7420 6f66 206c 6576 6572 6167 6520 6265  t of leverage be
+000092b0: 696e 6720 7573 6564 206f 6e20 7468 6520  ing used on the 
+000092c0: 6375 7272 656e 7420 7472 6164 650a 2020  current trade.  
+000092d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000092e0: 2020 7265 7475 726e 2073 7461 6b65 5f61    return stake_a
+000092f0: 6d6f 756e 7420 2f20 6c65 7665 7261 6765  mount / leverage
+00009300: 0a0a 2020 2020 2320 4472 792d 7275 6e20  ..    # Dry-run 
+00009310: 6d65 7468 6f64 730a 0a20 2020 2064 6566  methods..    def
+00009320: 2063 7265 6174 655f 6472 795f 7275 6e5f   create_dry_run_
+00009330: 6f72 6465 7228 7365 6c66 2c20 7061 6972  order(self, pair
+00009340: 3a20 7374 722c 206f 7264 6572 7479 7065  : str, ordertype
+00009350: 3a20 7374 722c 2073 6964 653a 2073 7472  : str, side: str
+00009360: 2c20 616d 6f75 6e74 3a20 666c 6f61 742c  , amount: float,
+00009370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009380: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00009390: 7465 3a20 666c 6f61 742c 206c 6576 6572  te: float, lever
+000093a0: 6167 653a 2066 6c6f 6174 2c20 7061 7261  age: float, para
+000093b0: 6d73 3a20 4469 6374 203d 207b 7d2c 0a20  ms: Dict = {},. 
+000093c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093d0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+000093e0: 5f6c 6f73 733a 2062 6f6f 6c20 3d20 4661  _loss: bool = Fa
+000093f0: 6c73 6529 202d 3e20 4469 6374 5b73 7472  lse) -> Dict[str
+00009400: 2c20 416e 795d 3a0a 2020 2020 2020 2020  , Any]:.        
+00009410: 6f72 6465 725f 6964 203d 2066 2764 7279  order_id = f'dry
+00009420: 5f72 756e 5f7b 7369 6465 7d5f 7b64 6174  _run_{side}_{dat
+00009430: 6574 696d 652e 6e6f 7728 292e 7469 6d65  etime.now().time
+00009440: 7374 616d 7028 297d 270a 2020 2020 2020  stamp()}'.      
+00009450: 2020 2320 526f 756e 6469 6e67 2068 6572    # Rounding her
+00009460: 6520 6d75 7374 2072 6573 7065 6374 2074  e must respect t
+00009470: 6f20 636f 6e74 7261 6374 2073 697a 6573  o contract sizes
+00009480: 0a20 2020 2020 2020 205f 616d 6f75 6e74  .        _amount
+00009490: 203d 2073 656c 662e 5f63 6f6e 7472 6163   = self._contrac
+000094a0: 7473 5f74 6f5f 616d 6f75 6e74 280a 2020  ts_to_amount(.  
+000094b0: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
+000094c0: 7365 6c66 2e61 6d6f 756e 745f 746f 5f70  self.amount_to_p
+000094d0: 7265 6369 7369 6f6e 2870 6169 722c 2073  recision(pair, s
+000094e0: 656c 662e 5f61 6d6f 756e 745f 746f 5f63  elf._amount_to_c
+000094f0: 6f6e 7472 6163 7473 2870 6169 722c 2061  ontracts(pair, a
+00009500: 6d6f 756e 7429 2929 0a20 2020 2020 2020  mount))).       
+00009510: 2064 7279 5f6f 7264 6572 3a20 4469 6374   dry_order: Dict
+00009520: 5b73 7472 2c20 416e 795d 203d 207b 0a20  [str, Any] = {. 
+00009530: 2020 2020 2020 2020 2020 2027 6964 273a             'id':
+00009540: 206f 7264 6572 5f69 642c 0a20 2020 2020   order_id,.     
+00009550: 2020 2020 2020 2027 7379 6d62 6f6c 273a         'symbol':
+00009560: 2070 6169 722c 0a20 2020 2020 2020 2020   pair,.         
+00009570: 2020 2027 7072 6963 6527 3a20 7261 7465     'price': rate
+00009580: 2c0a 2020 2020 2020 2020 2020 2020 2761  ,.            'a
+00009590: 7665 7261 6765 273a 2072 6174 652c 0a20  verage': rate,. 
+000095a0: 2020 2020 2020 2020 2020 2027 616d 6f75             'amou
+000095b0: 6e74 273a 205f 616d 6f75 6e74 2c0a 2020  nt': _amount,.  
+000095c0: 2020 2020 2020 2020 2020 2763 6f73 7427            'cost'
+000095d0: 3a20 5f61 6d6f 756e 7420 2a20 7261 7465  : _amount * rate
+000095e0: 2c0a 2020 2020 2020 2020 2020 2020 2774  ,.            't
+000095f0: 7970 6527 3a20 6f72 6465 7274 7970 652c  ype': ordertype,
+00009600: 0a20 2020 2020 2020 2020 2020 2027 7369  .            'si
+00009610: 6465 273a 2073 6964 652c 0a20 2020 2020  de': side,.     
+00009620: 2020 2020 2020 2027 6669 6c6c 6564 273a         'filled':
+00009630: 2030 2c0a 2020 2020 2020 2020 2020 2020   0,.            
+00009640: 2772 656d 6169 6e69 6e67 273a 205f 616d  'remaining': _am
+00009650: 6f75 6e74 2c0a 2020 2020 2020 2020 2020  ount,.          
+00009660: 2020 2764 6174 6574 696d 6527 3a20 6172    'datetime': ar
+00009670: 726f 772e 7574 636e 6f77 2829 2e73 7472  row.utcnow().str
+00009680: 6674 696d 6528 2725 592d 256d 2d25 6454  ftime('%Y-%m-%dT
+00009690: 2548 3a25 4d3a 2553 2e25 665a 2729 2c0a  %H:%M:%S.%fZ'),.
+000096a0: 2020 2020 2020 2020 2020 2020 2774 696d              'tim
+000096b0: 6573 7461 6d70 273a 2061 7272 6f77 2e75  estamp': arrow.u
+000096c0: 7463 6e6f 7728 292e 696e 745f 7469 6d65  tcnow().int_time
+000096d0: 7374 616d 7020 2a20 3130 3030 2c0a 2020  stamp * 1000,.  
+000096e0: 2020 2020 2020 2020 2020 2773 7461 7475            'statu
+000096f0: 7327 3a20 226f 7065 6e22 2c0a 2020 2020  s': "open",.    
+00009700: 2020 2020 2020 2020 2766 6565 273a 204e          'fee': N
+00009710: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00009720: 2027 696e 666f 273a 207b 7d2c 0a20 2020   'info': {},.   
+00009730: 2020 2020 2020 2020 2027 6c65 7665 7261           'levera
+00009740: 6765 273a 206c 6576 6572 6167 650a 2020  ge': leverage.  
+00009750: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00009760: 6966 2073 746f 705f 6c6f 7373 3a0a 2020  if stop_loss:.  
+00009770: 2020 2020 2020 2020 2020 6472 795f 6f72            dry_or
+00009780: 6465 725b 2269 6e66 6f22 5d20 3d20 7b22  der["info"] = {"
+00009790: 7374 6f70 5072 6963 6522 3a20 6472 795f  stopPrice": dry_
+000097a0: 6f72 6465 725b 2270 7269 6365 225d 7d0a  order["price"]}.
+000097b0: 2020 2020 2020 2020 2020 2020 6472 795f              dry_
+000097c0: 6f72 6465 725b 2273 746f 7050 7269 6365  order["stopPrice
+000097d0: 225d 203d 2064 7279 5f6f 7264 6572 5b22  "] = dry_order["
+000097e0: 7072 6963 6522 5d0a 2020 2020 2020 2020  price"].        
+000097f0: 2020 2020 2320 576f 726b 6172 6f75 6e64      # Workaround
+00009800: 2074 6f20 6176 6f69 6420 6669 6c6c 696e   to avoid fillin
+00009810: 6720 7374 6f70 6c6f 7373 206f 7264 6572  g stoploss order
+00009820: 7320 696d 6d65 6469 6174 656c 790a 2020  s immediately.  
+00009830: 2020 2020 2020 2020 2020 6472 795f 6f72            dry_or
+00009840: 6465 725b 2266 745f 6f72 6465 725f 7479  der["ft_order_ty
+00009850: 7065 225d 203d 2022 7374 6f70 6c6f 7373  pe"] = "stoploss
+00009860: 220a 2020 2020 2020 2020 6f72 6465 7262  ".        orderb
+00009870: 6f6f 6b3a 204f 7074 696f 6e61 6c5b 4f72  ook: Optional[Or
+00009880: 6465 7242 6f6f 6b5d 203d 204e 6f6e 650a  derBook] = None.
+00009890: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000098a0: 6578 6368 616e 6765 5f68 6173 2827 6665  exchange_has('fe
+000098b0: 7463 684c 324f 7264 6572 426f 6f6b 2729  tchL2OrderBook')
+000098c0: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
+000098d0: 6465 7262 6f6f 6b20 3d20 7365 6c66 2e66  derbook = self.f
+000098e0: 6574 6368 5f6c 325f 6f72 6465 725f 626f  etch_l2_order_bo
+000098f0: 6f6b 2870 6169 722c 2032 3029 0a20 2020  ok(pair, 20).   
+00009900: 2020 2020 2069 6620 6f72 6465 7274 7970       if ordertyp
+00009910: 6520 3d3d 2022 6c69 6d69 7422 2061 6e64  e == "limit" and
+00009920: 206f 7264 6572 626f 6f6b 3a0a 2020 2020   orderbook:.    
+00009930: 2020 2020 2020 2020 2320 416c 6c6f 7720          # Allow 
+00009940: 6120 3325 2070 7269 6365 2064 6966 6665  a 3% price diffe
+00009950: 7265 6e63 650a 2020 2020 2020 2020 2020  rence.          
+00009960: 2020 616c 6c6f 7765 645f 6469 6666 203d    allowed_diff =
+00009970: 2030 2e30 330a 2020 2020 2020 2020 2020   0.03.          
+00009980: 2020 6966 2073 656c 662e 5f64 7279 5f69    if self._dry_i
+00009990: 735f 7072 6963 655f 6372 6f73 7365 6428  s_price_crossed(
+000099a0: 7061 6972 2c20 7369 6465 2c20 7261 7465  pair, side, rate
+000099b0: 2c20 6f72 6465 7262 6f6f 6b2c 2061 6c6c  , orderbook, all
+000099c0: 6f77 6564 5f64 6966 6629 3a0a 2020 2020  owed_diff):.    
+000099d0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+000099e0: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
+000099f0: 2020 2020 2020 2020 2020 2020 2066 2243               f"C
+00009a00: 6f6e 7665 7274 6564 206f 7264 6572 207b  onverted order {
+00009a10: 7061 6972 7d20 746f 206d 6172 6b65 7420  pair} to market 
+00009a20: 6f72 6465 7220 6475 6520 746f 2070 7269  order due to pri
+00009a30: 6365 207b 7261 7465 7d20 6372 6f73 7369  ce {rate} crossi
+00009a40: 6e67 2073 7072 6561 6420 220a 2020 2020  ng spread ".    
+00009a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a60: 6622 6279 206d 6f72 6520 7468 616e 207b  f"by more than {
+00009a70: 616c 6c6f 7765 645f 6469 6666 3a2e 3225  allowed_diff:.2%
+00009a80: 7d2e 2229 0a20 2020 2020 2020 2020 2020  }.").           
+00009a90: 2020 2020 2064 7279 5f6f 7264 6572 5b22       dry_order["
+00009aa0: 7479 7065 225d 203d 2022 6d61 726b 6574  type"] = "market
+00009ab0: 220a 0a20 2020 2020 2020 2069 6620 6472  "..        if dr
+00009ac0: 795f 6f72 6465 725b 2274 7970 6522 5d20  y_order["type"] 
+00009ad0: 3d3d 2022 6d61 726b 6574 2220 616e 6420  == "market" and 
+00009ae0: 6e6f 7420 6472 795f 6f72 6465 722e 6765  not dry_order.ge
+00009af0: 7428 2266 745f 6f72 6465 725f 7479 7065  t("ft_order_type
+00009b00: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+00009b10: 2320 5570 6461 7465 206d 6172 6b65 7420  # Update market 
+00009b20: 6f72 6465 7220 7072 6963 696e 670a 2020  order pricing.  
+00009b30: 2020 2020 2020 2020 2020 6176 6572 6167            averag
+00009b40: 6520 3d20 7365 6c66 2e67 6574 5f64 7279  e = self.get_dry
+00009b50: 5f6d 6172 6b65 745f 6669 6c6c 5f70 7269  _market_fill_pri
+00009b60: 6365 2870 6169 722c 2073 6964 652c 2061  ce(pair, side, a
+00009b70: 6d6f 756e 742c 2072 6174 652c 206f 7264  mount, rate, ord
+00009b80: 6572 626f 6f6b 290a 2020 2020 2020 2020  erbook).        
+00009b90: 2020 2020 6472 795f 6f72 6465 722e 7570      dry_order.up
+00009ba0: 6461 7465 287b 0a20 2020 2020 2020 2020  date({.         
+00009bb0: 2020 2020 2020 2027 6176 6572 6167 6527         'average'
+00009bc0: 3a20 6176 6572 6167 652c 0a20 2020 2020  : average,.     
+00009bd0: 2020 2020 2020 2020 2020 2027 6669 6c6c             'fill
+00009be0: 6564 273a 205f 616d 6f75 6e74 2c0a 2020  ed': _amount,.  
+00009bf0: 2020 2020 2020 2020 2020 2020 2020 2772                'r
+00009c00: 656d 6169 6e69 6e67 273a 2030 2e30 2c0a  emaining': 0.0,.
+00009c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c20: 2773 7461 7475 7327 3a20 2263 6c6f 7365  'status': "close
+00009c30: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
+00009c40: 2020 2020 2763 6f73 7427 3a20 2864 7279      'cost': (dry
+00009c50: 5f6f 7264 6572 5b27 616d 6f75 6e74 275d  _order['amount']
+00009c60: 202a 2061 7665 7261 6765 290a 2020 2020   * average).    
+00009c70: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
+00009c80: 2020 2020 2020 2023 206d 6172 6b65 7420         # market 
+00009c90: 6f72 6465 7273 2077 696c 6c20 616c 7761  orders will alwa
+00009ca0: 7973 2069 6e63 7572 7220 7461 6b65 7220  ys incurr taker 
+00009cb0: 6665 6573 0a20 2020 2020 2020 2020 2020  fees.           
+00009cc0: 2064 7279 5f6f 7264 6572 203d 2073 656c   dry_order = sel
+00009cd0: 662e 6164 645f 6472 795f 6f72 6465 725f  f.add_dry_order_
+00009ce0: 6665 6528 7061 6972 2c20 6472 795f 6f72  fee(pair, dry_or
+00009cf0: 6465 722c 2027 7461 6b65 7227 290a 0a20  der, 'taker').. 
+00009d00: 2020 2020 2020 2064 7279 5f6f 7264 6572         dry_order
+00009d10: 203d 2073 656c 662e 6368 6563 6b5f 6472   = self.check_dr
+00009d20: 795f 6c69 6d69 745f 6f72 6465 725f 6669  y_limit_order_fi
+00009d30: 6c6c 6564 280a 2020 2020 2020 2020 2020  lled(.          
+00009d40: 2020 6472 795f 6f72 6465 722c 2069 6d6d    dry_order, imm
+00009d50: 6564 6961 7465 3d54 7275 652c 206f 7264  ediate=True, ord
+00009d60: 6572 626f 6f6b 3d6f 7264 6572 626f 6f6b  erbook=orderbook
+00009d70: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00009d80: 5f64 7279 5f72 756e 5f6f 7065 6e5f 6f72  _dry_run_open_or
+00009d90: 6465 7273 5b64 7279 5f6f 7264 6572 5b22  ders[dry_order["
+00009da0: 6964 225d 5d20 3d20 6472 795f 6f72 6465  id"]] = dry_orde
+00009db0: 720a 2020 2020 2020 2020 2320 436f 7079  r.        # Copy
+00009dc0: 206f 7264 6572 2061 6e64 2063 6c6f 7365   order and close
+00009dd0: 2069 7420 2d20 736f 2074 6865 2072 6574   it - so the ret
+00009de0: 7572 6e65 6420 6f72 6465 7220 6973 206f  urned order is o
+00009df0: 7065 6e20 756e 6c65 7373 2069 7427 7320  pen unless it's 
+00009e00: 6120 6d61 726b 6574 206f 7264 6572 0a20  a market order. 
+00009e10: 2020 2020 2020 2072 6574 7572 6e20 6472         return dr
+00009e20: 795f 6f72 6465 720a 0a20 2020 2064 6566  y_order..    def
+00009e30: 2061 6464 5f64 7279 5f6f 7264 6572 5f66   add_dry_order_f
+00009e40: 6565 280a 2020 2020 2020 2020 7365 6c66  ee(.        self
+00009e50: 2c0a 2020 2020 2020 2020 7061 6972 3a20  ,.        pair: 
+00009e60: 7374 722c 0a20 2020 2020 2020 2064 7279  str,.        dry
+00009e70: 5f6f 7264 6572 3a20 4469 6374 5b73 7472  _order: Dict[str
+00009e80: 2c20 416e 795d 2c0a 2020 2020 2020 2020  , Any],.        
+00009e90: 7461 6b65 725f 6f72 5f6d 616b 6572 3a20  taker_or_maker: 
+00009ea0: 4d61 6b65 7254 616b 6572 2c0a 2020 2020  MakerTaker,.    
+00009eb0: 2920 2d3e 2044 6963 745b 7374 722c 2041  ) -> Dict[str, A
+00009ec0: 6e79 5d3a 0a20 2020 2020 2020 2066 6565  ny]:.        fee
+00009ed0: 203d 2073 656c 662e 6765 745f 6665 6528   = self.get_fee(
+00009ee0: 7061 6972 2c20 7461 6b65 725f 6f72 5f6d  pair, taker_or_m
+00009ef0: 616b 6572 3d74 616b 6572 5f6f 725f 6d61  aker=taker_or_ma
+00009f00: 6b65 7229 0a20 2020 2020 2020 2064 7279  ker).        dry
+00009f10: 5f6f 7264 6572 2e75 7064 6174 6528 7b0a  _order.update({.
+00009f20: 2020 2020 2020 2020 2020 2020 2766 6565              'fee
+00009f30: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
+00009f40: 2020 2020 2027 6375 7272 656e 6379 273a       'currency':
+00009f50: 2073 656c 662e 6765 745f 7061 6972 5f71   self.get_pair_q
+00009f60: 756f 7465 5f63 7572 7265 6e63 7928 7061  uote_currency(pa
+00009f70: 6972 292c 0a20 2020 2020 2020 2020 2020  ir),.           
+00009f80: 2020 2020 2027 636f 7374 273a 2064 7279       'cost': dry
+00009f90: 5f6f 7264 6572 5b27 636f 7374 275d 202a  _order['cost'] *
+00009fa0: 2066 6565 2c0a 2020 2020 2020 2020 2020   fee,.          
+00009fb0: 2020 2020 2020 2772 6174 6527 3a20 6665        'rate': fe
+00009fc0: 650a 2020 2020 2020 2020 2020 2020 7d0a  e.            }.
+00009fd0: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
+00009fe0: 2020 2072 6574 7572 6e20 6472 795f 6f72     return dry_or
+00009ff0: 6465 720a 0a20 2020 2064 6566 2067 6574  der..    def get
+0000a000: 5f64 7279 5f6d 6172 6b65 745f 6669 6c6c  _dry_market_fill
+0000a010: 5f70 7269 6365 2873 656c 662c 2070 6169  _price(self, pai
+0000a020: 723a 2073 7472 2c20 7369 6465 3a20 7374  r: str, side: st
+0000a030: 722c 2061 6d6f 756e 743a 2066 6c6f 6174  r, amount: float
+0000a040: 2c20 7261 7465 3a20 666c 6f61 742c 0a20  , rate: float,. 
+0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a070: 206f 7264 6572 626f 6f6b 3a20 4f70 7469   orderbook: Opti
+0000a080: 6f6e 616c 5b4f 7264 6572 426f 6f6b 5d29  onal[OrderBook])
+0000a090: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
+0000a0a0: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
+0000a0b0: 6574 2074 6865 206d 6172 6b65 7420 6f72  et the market or
+0000a0c0: 6465 7220 6669 6c6c 2070 7269 6365 2062  der fill price b
+0000a0d0: 6173 6564 206f 6e20 6f72 6465 7262 6f6f  ased on orderboo
+0000a0e0: 6b20 696e 7465 7270 6f6c 6174 696f 6e0a  k interpolation.
+0000a0f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000a100: 2020 2020 6966 2073 656c 662e 6578 6368      if self.exch
+0000a110: 616e 6765 5f68 6173 2827 6665 7463 684c  ange_has('fetchL
+0000a120: 324f 7264 6572 426f 6f6b 2729 3a0a 2020  2OrderBook'):.  
+0000a130: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000a140: 206f 7264 6572 626f 6f6b 3a0a 2020 2020   orderbook:.    
+0000a150: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000a160: 7262 6f6f 6b20 3d20 7365 6c66 2e66 6574  rbook = self.fet
+0000a170: 6368 5f6c 325f 6f72 6465 725f 626f 6f6b  ch_l2_order_book
+0000a180: 2870 6169 722c 2032 3029 0a20 2020 2020  (pair, 20).     
+0000a190: 2020 2020 2020 206f 625f 7479 7065 3a20         ob_type: 
+0000a1a0: 4f42 4c69 7465 7261 6c20 3d20 2761 736b  OBLiteral = 'ask
+0000a1b0: 7327 2069 6620 7369 6465 203d 3d20 2762  s' if side == 'b
+0000a1c0: 7579 2720 656c 7365 2027 6269 6473 270a  uy' else 'bids'.
+0000a1d0: 2020 2020 2020 2020 2020 2020 736c 6970              slip
+0000a1e0: 7061 6765 203d 2030 2e30 350a 2020 2020  page = 0.05.    
+0000a1f0: 2020 2020 2020 2020 6d61 785f 736c 6970          max_slip
+0000a200: 7061 6765 5f76 616c 203d 2072 6174 6520  page_val = rate 
+0000a210: 2a20 2828 3120 2b20 736c 6970 7061 6765  * ((1 + slippage
+0000a220: 2920 6966 2073 6964 6520 3d3d 2027 6275  ) if side == 'bu
+0000a230: 7927 2065 6c73 6520 2831 202d 2073 6c69  y' else (1 - sli
+0000a240: 7070 6167 6529 290a 0a20 2020 2020 2020  ppage))..       
+0000a250: 2020 2020 2072 656d 6169 6e69 6e67 5f61       remaining_a
+0000a260: 6d6f 756e 7420 3d20 616d 6f75 6e74 0a20  mount = amount. 
+0000a270: 2020 2020 2020 2020 2020 2066 696c 6c65             fille
+0000a280: 645f 616d 6f75 6e74 203d 2030 2e30 0a20  d_amount = 0.0. 
+0000a290: 2020 2020 2020 2020 2020 2062 6f6f 6b5f             book_
+0000a2a0: 656e 7472 795f 7072 6963 6520 3d20 302e  entry_price = 0.
+0000a2b0: 300a 2020 2020 2020 2020 2020 2020 666f  0.            fo
+0000a2c0: 7220 626f 6f6b 5f65 6e74 7279 2069 6e20  r book_entry in 
+0000a2d0: 6f72 6465 7262 6f6f 6b5b 6f62 5f74 7970  orderbook[ob_typ
+0000a2e0: 655d 3a0a 2020 2020 2020 2020 2020 2020  e]:.            
+0000a2f0: 2020 2020 626f 6f6b 5f65 6e74 7279 5f70      book_entry_p
+0000a300: 7269 6365 203d 2062 6f6f 6b5f 656e 7472  rice = book_entr
+0000a310: 795b 305d 0a20 2020 2020 2020 2020 2020  y[0].           
+0000a320: 2020 2020 2062 6f6f 6b5f 656e 7472 795f       book_entry_
+0000a330: 636f 696e 5f76 6f6c 756d 6520 3d20 626f  coin_volume = bo
+0000a340: 6f6b 5f65 6e74 7279 5b31 5d0a 2020 2020  ok_entry[1].    
+0000a350: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0000a360: 656d 6169 6e69 6e67 5f61 6d6f 756e 7420  emaining_amount 
+0000a370: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0000a380: 2020 2020 2020 2020 2069 6620 7265 6d61           if rema
+0000a390: 696e 696e 675f 616d 6f75 6e74 203c 2062  ining_amount < b
+0000a3a0: 6f6f 6b5f 656e 7472 795f 636f 696e 5f76  ook_entry_coin_v
+0000a3b0: 6f6c 756d 653a 0a20 2020 2020 2020 2020  olume:.         
+0000a3c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000a3d0: 204f 7264 6572 626f 6f6b 2061 7420 7468   Orderbook at th
+0000a3e0: 6973 2073 6c6f 7420 6269 6767 6572 2074  is slot bigger t
+0000a3f0: 6861 6e20 7265 6d61 696e 696e 6720 616d  han remaining am
+0000a400: 6f75 6e74 0a20 2020 2020 2020 2020 2020  ount.           
+0000a410: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000a420: 6c65 645f 616d 6f75 6e74 202b 3d20 7265  led_amount += re
+0000a430: 6d61 696e 696e 675f 616d 6f75 6e74 202a  maining_amount *
+0000a440: 2062 6f6f 6b5f 656e 7472 795f 7072 6963   book_entry_pric
+0000a450: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000a460: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
 0000a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a480: 6669 6c6c 6564 5f61 6d6f 756e 7420 2b3d  filled_amount +=
-0000a490: 2072 656d 6169 6e69 6e67 5f61 6d6f 756e   remaining_amoun
-0000a4a0: 7420 2a20 626f 6f6b 5f65 6e74 7279 5f70  t * book_entry_p
-0000a4b0: 7269 6365 0a20 2020 2020 2020 2020 2020  rice.           
-0000a4c0: 2066 6f72 6563 6173 745f 6176 675f 6669   forecast_avg_fi
-0000a4d0: 6c6c 6564 5f70 7269 6365 203d 206d 6178  lled_price = max
-0000a4e0: 2866 696c 6c65 645f 616d 6f75 6e74 2c20  (filled_amount, 
-0000a4f0: 3029 202f 2061 6d6f 756e 740a 2020 2020  0) / amount.    
-0000a500: 2020 2020 2020 2020 2320 4c69 6d69 7420          # Limit 
-0000a510: 6d61 782e 2073 6c69 7070 6167 6520 746f  max. slippage to
-0000a520: 2073 7065 6369 6669 6564 2076 616c 7565   specified value
-0000a530: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000a540: 7369 6465 203d 3d20 2762 7579 273a 0a20  side == 'buy':. 
-0000a550: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000a560: 6f72 6563 6173 745f 6176 675f 6669 6c6c  orecast_avg_fill
-0000a570: 6564 5f70 7269 6365 203d 206d 696e 2866  ed_price = min(f
-0000a580: 6f72 6563 6173 745f 6176 675f 6669 6c6c  orecast_avg_fill
-0000a590: 6564 5f70 7269 6365 2c20 6d61 785f 736c  ed_price, max_sl
-0000a5a0: 6970 7061 6765 5f76 616c 290a 0a20 2020  ippage_val)..   
-0000a5b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000a5c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000a5d0: 6f72 6563 6173 745f 6176 675f 6669 6c6c  orecast_avg_fill
-0000a5e0: 6564 5f70 7269 6365 203d 206d 6178 2866  ed_price = max(f
-0000a5f0: 6f72 6563 6173 745f 6176 675f 6669 6c6c  orecast_avg_fill
-0000a600: 6564 5f70 7269 6365 2c20 6d61 785f 736c  ed_price, max_sl
-0000a610: 6970 7061 6765 5f76 616c 290a 0a20 2020  ippage_val)..   
-0000a620: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000a630: 7365 6c66 2e70 7269 6365 5f74 6f5f 7072  self.price_to_pr
-0000a640: 6563 6973 696f 6e28 7061 6972 2c20 666f  ecision(pair, fo
-0000a650: 7265 6361 7374 5f61 7667 5f66 696c 6c65  recast_avg_fille
-0000a660: 645f 7072 6963 6529 0a0a 2020 2020 2020  d_price)..      
-0000a670: 2020 7265 7475 726e 2072 6174 650a 0a20    return rate.. 
-0000a680: 2020 2064 6566 205f 6472 795f 6973 5f70     def _dry_is_p
-0000a690: 7269 6365 5f63 726f 7373 6564 2873 656c  rice_crossed(sel
-0000a6a0: 662c 2070 6169 723a 2073 7472 2c20 7369  f, pair: str, si
-0000a6b0: 6465 3a20 7374 722c 206c 696d 6974 3a20  de: str, limit: 
-0000a6c0: 666c 6f61 742c 0a20 2020 2020 2020 2020  float,.         
-0000a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6e0: 2020 2020 206f 7264 6572 626f 6f6b 3a20       orderbook: 
-0000a6f0: 4f70 7469 6f6e 616c 5b4f 7264 6572 426f  Optional[OrderBo
-0000a700: 6f6b 5d20 3d20 4e6f 6e65 2c20 6f66 6673  ok] = None, offs
-0000a710: 6574 3a20 666c 6f61 7420 3d20 302e 3029  et: float = 0.0)
-0000a720: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-0000a730: 2020 6966 206e 6f74 2073 656c 662e 6578    if not self.ex
-0000a740: 6368 616e 6765 5f68 6173 2827 6665 7463  change_has('fetc
-0000a750: 684c 324f 7264 6572 426f 6f6b 2729 3a0a  hL2OrderBook'):.
-0000a760: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000a770: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
-0000a780: 6966 206e 6f74 206f 7264 6572 626f 6f6b  if not orderbook
-0000a790: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
-0000a7a0: 6465 7262 6f6f 6b20 3d20 7365 6c66 2e66  derbook = self.f
-0000a7b0: 6574 6368 5f6c 325f 6f72 6465 725f 626f  etch_l2_order_bo
-0000a7c0: 6f6b 2870 6169 722c 2031 290a 2020 2020  ok(pair, 1).    
-0000a7d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000a7e0: 2020 2020 2069 6620 7369 6465 203d 3d20       if side == 
-0000a7f0: 2762 7579 273a 0a20 2020 2020 2020 2020  'buy':.         
-0000a800: 2020 2020 2020 2070 7269 6365 203d 206f         price = o
-0000a810: 7264 6572 626f 6f6b 5b27 6173 6b73 275d  rderbook['asks']
-0000a820: 5b30 5d5b 305d 0a20 2020 2020 2020 2020  [0][0].         
-0000a830: 2020 2020 2020 2069 6620 6c69 6d69 7420         if limit 
-0000a840: 2a20 2831 202d 206f 6666 7365 7429 203e  * (1 - offset) >
-0000a850: 3d20 7072 6963 653a 0a20 2020 2020 2020  = price:.       
-0000a860: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000a870: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
-0000a880: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000a890: 2020 2020 2020 2020 2020 2070 7269 6365             price
-0000a8a0: 203d 206f 7264 6572 626f 6f6b 5b27 6269   = orderbook['bi
-0000a8b0: 6473 275d 5b30 5d5b 305d 0a20 2020 2020  ds'][0][0].     
-0000a8c0: 2020 2020 2020 2020 2020 2069 6620 6c69             if li
-0000a8d0: 6d69 7420 2a20 2831 202b 206f 6666 7365  mit * (1 + offse
-0000a8e0: 7429 203c 3d20 7072 6963 653a 0a20 2020  t) <= price:.   
-0000a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a900: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
-0000a910: 2020 2020 2065 7863 6570 7420 496e 6465       except Inde
-0000a920: 7845 7272 6f72 3a0a 2020 2020 2020 2020  xError:.        
-0000a930: 2020 2020 2320 4967 6e6f 7265 2065 6d70      # Ignore emp
-0000a940: 7479 206f 7264 6572 626f 6f6b 7320 7768  ty orderbooks wh
-0000a950: 656e 2066 696c 6c69 6e67 202d 2063 616e  en filling - can
-0000a960: 2062 6520 6669 6c6c 6564 2077 6974 6820   be filled with 
-0000a970: 7468 6520 6e65 7874 2069 7465 7261 7469  the next iterati
-0000a980: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-0000a990: 7061 7373 0a20 2020 2020 2020 2072 6574  pass.        ret
-0000a9a0: 7572 6e20 4661 6c73 650a 0a20 2020 2064  urn False..    d
-0000a9b0: 6566 2063 6865 636b 5f64 7279 5f6c 696d  ef check_dry_lim
-0000a9c0: 6974 5f6f 7264 6572 5f66 696c 6c65 6428  it_order_filled(
-0000a9d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000a9e0: 662c 206f 7264 6572 3a20 4469 6374 5b73  f, order: Dict[s
-0000a9f0: 7472 2c20 416e 795d 2c20 696d 6d65 6469  tr, Any], immedi
-0000aa00: 6174 653a 2062 6f6f 6c20 3d20 4661 6c73  ate: bool = Fals
-0000aa10: 652c 0a20 2020 2020 2020 2020 2020 206f  e,.            o
-0000aa20: 7264 6572 626f 6f6b 3a20 4f70 7469 6f6e  rderbook: Option
-0000aa30: 616c 5b4f 7264 6572 426f 6f6b 5d20 3d20  al[OrderBook] = 
-0000aa40: 4e6f 6e65 2920 2d3e 2044 6963 745b 7374  None) -> Dict[st
-0000aa50: 722c 2041 6e79 5d3a 0a20 2020 2020 2020  r, Any]:.       
-0000aa60: 2022 2222 0a20 2020 2020 2020 2043 6865   """.        Che
-0000aa70: 636b 2064 7279 2d72 756e 206c 696d 6974  ck dry-run limit
-0000aa80: 206f 7264 6572 2066 696c 6c20 616e 6420   order fill and 
-0000aa90: 7570 6461 7465 2066 6565 2028 6966 2069  update fee (if i
-0000aaa0: 7420 6669 6c6c 6564 292e 0a20 2020 2020  t filled)..     
-0000aab0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0000aac0: 6620 286f 7264 6572 5b27 7374 6174 7573  f (order['status
-0000aad0: 275d 2021 3d20 2263 6c6f 7365 6422 0a20  '] != "closed". 
-0000aae0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000aaf0: 6e64 206f 7264 6572 5b27 7479 7065 275d  nd order['type']
-0000ab00: 2069 6e20 5b22 6c69 6d69 7422 5d0a 2020   in ["limit"].  
-0000ab10: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0000ab20: 6420 6e6f 7420 6f72 6465 722e 6765 7428  d not order.get(
-0000ab30: 2766 745f 6f72 6465 725f 7479 7065 2729  'ft_order_type')
-0000ab40: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-0000ab50: 6169 7220 3d20 6f72 6465 725b 2773 796d  air = order['sym
-0000ab60: 626f 6c27 5d0a 2020 2020 2020 2020 2020  bol'].          
-0000ab70: 2020 6966 2073 656c 662e 5f64 7279 5f69    if self._dry_i
-0000ab80: 735f 7072 6963 655f 6372 6f73 7365 6428  s_price_crossed(
-0000ab90: 7061 6972 2c20 6f72 6465 725b 2773 6964  pair, order['sid
-0000aba0: 6527 5d2c 206f 7264 6572 5b27 7072 6963  e'], order['pric
-0000abb0: 6527 5d2c 206f 7264 6572 626f 6f6b 293a  e'], orderbook):
-0000abc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000abd0: 206f 7264 6572 2e75 7064 6174 6528 7b0a   order.update({.
-0000abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abf0: 2020 2020 2773 7461 7475 7327 3a20 2763      'status': 'c
-0000ac00: 6c6f 7365 6427 2c0a 2020 2020 2020 2020  losed',.        
-0000ac10: 2020 2020 2020 2020 2020 2020 2766 696c              'fil
-0000ac20: 6c65 6427 3a20 6f72 6465 725b 2761 6d6f  led': order['amo
-0000ac30: 756e 7427 5d2c 0a20 2020 2020 2020 2020  unt'],.         
-0000ac40: 2020 2020 2020 2020 2020 2027 7265 6d61             'rema
-0000ac50: 696e 696e 6727 3a20 302c 0a20 2020 2020  ining': 0,.     
-0000ac60: 2020 2020 2020 2020 2020 207d 290a 0a20             }).. 
-0000ac70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000ac80: 656c 662e 6164 645f 6472 795f 6f72 6465  elf.add_dry_orde
-0000ac90: 725f 6665 6528 0a20 2020 2020 2020 2020  r_fee(.         
-0000aca0: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-0000acb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000acc0: 2020 2020 206f 7264 6572 2c0a 2020 2020       order,.    
-0000acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ace0: 2774 616b 6572 2720 6966 2069 6d6d 6564  'taker' if immed
-0000acf0: 6961 7465 2065 6c73 6520 276d 616b 6572  iate else 'maker
-0000ad00: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0000ad10: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
-0000ad20: 7475 726e 206f 7264 6572 0a0a 2020 2020  turn order..    
-0000ad30: 6465 6620 6665 7463 685f 6472 795f 7275  def fetch_dry_ru
-0000ad40: 6e5f 6f72 6465 7228 7365 6c66 2c20 6f72  n_order(self, or
-0000ad50: 6465 725f 6964 2920 2d3e 2044 6963 745b  der_id) -> Dict[
-0000ad60: 7374 722c 2041 6e79 5d3a 0a20 2020 2020  str, Any]:.     
-0000ad70: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-0000ad80: 6574 7572 6e20 6472 792d 7275 6e20 6f72  eturn dry-run or
-0000ad90: 6465 720a 2020 2020 2020 2020 4f6e 6c79  der.        Only
-0000ada0: 2063 616c 6c20 6966 2072 756e 6e69 6e67   call if running
-0000adb0: 2069 6e20 6472 792d 7275 6e20 6d6f 6465   in dry-run mode
-0000adc0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000add0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000ade0: 2020 2020 2020 206f 7264 6572 203d 2073         order = s
-0000adf0: 656c 662e 5f64 7279 5f72 756e 5f6f 7065  elf._dry_run_ope
-0000ae00: 6e5f 6f72 6465 7273 5b6f 7264 6572 5f69  n_orders[order_i
-0000ae10: 645d 0a20 2020 2020 2020 2020 2020 206f  d].            o
-0000ae20: 7264 6572 203d 2073 656c 662e 6368 6563  rder = self.chec
-0000ae30: 6b5f 6472 795f 6c69 6d69 745f 6f72 6465  k_dry_limit_orde
-0000ae40: 725f 6669 6c6c 6564 286f 7264 6572 290a  r_filled(order).
-0000ae50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000ae60: 726e 206f 7264 6572 0a20 2020 2020 2020  rn order.       
-0000ae70: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
-0000ae80: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000ae90: 2020 2066 726f 6d20 6672 6571 7472 6164     from freqtrad
-0000aea0: 652e 7065 7273 6973 7465 6e63 6520 696d  e.persistence im
-0000aeb0: 706f 7274 204f 7264 6572 0a20 2020 2020  port Order.     
-0000aec0: 2020 2020 2020 206f 7264 6572 203d 204f         order = O
-0000aed0: 7264 6572 2e6f 7264 6572 5f62 795f 6964  rder.order_by_id
-0000aee0: 286f 7264 6572 5f69 6429 0a20 2020 2020  (order_id).     
-0000aef0: 2020 2020 2020 2069 6620 6f72 6465 723a         if order:
-0000af00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000af10: 2063 6378 745f 6f72 6465 7220 3d20 6f72   ccxt_order = or
-0000af20: 6465 722e 746f 5f63 6378 745f 6f62 6a65  der.to_ccxt_obje
-0000af30: 6374 2829 0a20 2020 2020 2020 2020 2020  ct().           
-0000af40: 2020 2020 2073 656c 662e 5f64 7279 5f72       self._dry_r
-0000af50: 756e 5f6f 7065 6e5f 6f72 6465 7273 5b6f  un_open_orders[o
-0000af60: 7264 6572 5f69 645d 203d 2063 6378 745f  rder_id] = ccxt_
-0000af70: 6f72 6465 720a 2020 2020 2020 2020 2020  order.          
-0000af80: 2020 2020 2020 7265 7475 726e 2063 6378        return ccx
-0000af90: 745f 6f72 6465 720a 2020 2020 2020 2020  t_order.        
-0000afa0: 2020 2020 2320 4772 6163 6566 756c 6c79      # Gracefully
-0000afb0: 2068 616e 646c 6520 6572 726f 7273 2077   handle errors w
-0000afc0: 6974 6820 6472 792d 7275 6e20 6f72 6465  ith dry-run orde
-0000afd0: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
-0000afe0: 7261 6973 6520 496e 7661 6c69 644f 7264  raise InvalidOrd
-0000aff0: 6572 4578 6365 7074 696f 6e28 0a20 2020  erException(.   
-0000b000: 2020 2020 2020 2020 2020 2020 2066 2754               f'T
-0000b010: 7269 6564 2074 6f20 6765 7420 616e 2069  ried to get an i
-0000b020: 6e76 616c 6964 2064 7279 2d72 756e 2d6f  nvalid dry-run-o
-0000b030: 7264 6572 2028 6964 3a20 7b6f 7264 6572  rder (id: {order
-0000b040: 5f69 647d 292e 204d 6573 7361 6765 3a20  _id}). Message: 
-0000b050: 7b65 7d27 2920 6672 6f6d 2065 0a0a 2020  {e}') from e..  
-0000b060: 2020 2320 4f72 6465 7220 6861 6e64 6c69    # Order handli
-0000b070: 6e67 0a0a 2020 2020 6465 6620 5f6c 6576  ng..    def _lev
-0000b080: 5f70 7265 7028 7365 6c66 2c20 7061 6972  _prep(self, pair
-0000b090: 3a20 7374 722c 206c 6576 6572 6167 653a  : str, leverage:
-0000b0a0: 2066 6c6f 6174 2c20 7369 6465 3a20 4275   float, side: Bu
-0000b0b0: 7953 656c 6c2c 2061 6363 6570 745f 6661  ySell, accept_fa
-0000b0c0: 696c 3a20 626f 6f6c 203d 2046 616c 7365  il: bool = False
-0000b0d0: 293a 0a20 2020 2020 2020 2069 6620 7365  ):.        if se
-0000b0e0: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
-0000b0f0: 213d 2054 7261 6469 6e67 4d6f 6465 2e53  != TradingMode.S
-0000b100: 504f 543a 0a20 2020 2020 2020 2020 2020  POT:.           
-0000b110: 2073 656c 662e 7365 745f 6d61 7267 696e   self.set_margin
-0000b120: 5f6d 6f64 6528 7061 6972 2c20 7365 6c66  _mode(pair, self
-0000b130: 2e6d 6172 6769 6e5f 6d6f 6465 2c20 6163  .margin_mode, ac
-0000b140: 6365 7074 5f66 6169 6c29 0a20 2020 2020  cept_fail).     
-0000b150: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-0000b160: 5f6c 6576 6572 6167 6528 6c65 7665 7261  _leverage(levera
-0000b170: 6765 2c20 7061 6972 2c20 6163 6365 7074  ge, pair, accept
-0000b180: 5f66 6169 6c29 0a0a 2020 2020 6465 6620  _fail)..    def 
-0000b190: 5f67 6574 5f70 6172 616d 7328 0a20 2020  _get_params(.   
-0000b1a0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0000b1b0: 2020 2073 6964 653a 2042 7579 5365 6c6c     side: BuySell
-0000b1c0: 2c0a 2020 2020 2020 2020 6f72 6465 7274  ,.        ordert
-0000b1d0: 7970 653a 2073 7472 2c0a 2020 2020 2020  ype: str,.      
-0000b1e0: 2020 6c65 7665 7261 6765 3a20 666c 6f61    leverage: floa
-0000b1f0: 742c 0a20 2020 2020 2020 2072 6564 7563  t,.        reduc
-0000b200: 654f 6e6c 793a 2062 6f6f 6c2c 0a20 2020  eOnly: bool,.   
-0000b210: 2020 2020 2074 696d 655f 696e 5f66 6f72       time_in_for
-0000b220: 6365 3a20 7374 7220 3d20 2747 5443 272c  ce: str = 'GTC',
-0000b230: 0a20 2020 2029 202d 3e20 4469 6374 3a0a  .    ) -> Dict:.
-0000b240: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-0000b250: 2073 656c 662e 5f70 6172 616d 732e 636f   self._params.co
-0000b260: 7079 2829 0a20 2020 2020 2020 2069 6620  py().        if 
-0000b270: 7469 6d65 5f69 6e5f 666f 7263 6520 213d  time_in_force !=
-0000b280: 2027 4754 4327 2061 6e64 206f 7264 6572   'GTC' and order
-0000b290: 7479 7065 2021 3d20 276d 6172 6b65 7427  type != 'market'
-0000b2a0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-0000b2b0: 7261 6d73 2e75 7064 6174 6528 7b27 7469  rams.update({'ti
-0000b2c0: 6d65 496e 466f 7263 6527 3a20 7469 6d65  meInForce': time
-0000b2d0: 5f69 6e5f 666f 7263 652e 7570 7065 7228  _in_force.upper(
-0000b2e0: 297d 290a 2020 2020 2020 2020 6966 2072  )}).        if r
-0000b2f0: 6564 7563 654f 6e6c 793a 0a20 2020 2020  educeOnly:.     
-0000b300: 2020 2020 2020 2070 6172 616d 732e 7570         params.up
-0000b310: 6461 7465 287b 2772 6564 7563 654f 6e6c  date({'reduceOnl
-0000b320: 7927 3a20 5472 7565 7d29 0a20 2020 2020  y': True}).     
-0000b330: 2020 2072 6574 7572 6e20 7061 7261 6d73     return params
-0000b340: 0a0a 2020 2020 6465 6620 5f6f 7264 6572  ..    def _order
-0000b350: 5f6e 6565 6473 5f70 7269 6365 2873 656c  _needs_price(sel
-0000b360: 662c 206f 7264 6572 7479 7065 3a20 7374  f, ordertype: st
-0000b370: 7229 202d 3e20 626f 6f6c 3a0a 2020 2020  r) -> bool:.    
-0000b380: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-0000b390: 2020 2020 2020 2020 206f 7264 6572 7479           orderty
-0000b3a0: 7065 2021 3d20 276d 6172 6b65 7427 0a20  pe != 'market'. 
-0000b3b0: 2020 2020 2020 2020 2020 206f 7220 7365             or se
-0000b3c0: 6c66 2e5f 6170 692e 6f70 7469 6f6e 732e  lf._api.options.
-0000b3d0: 6765 7428 2263 7265 6174 654d 6172 6b65  get("createMarke
-0000b3e0: 7442 7579 4f72 6465 7252 6571 7569 7265  tBuyOrderRequire
-0000b3f0: 7350 7269 6365 222c 2046 616c 7365 290a  sPrice", False).
-0000b400: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
-0000b410: 656c 662e 5f66 745f 6861 732e 6765 7428  elf._ft_has.get(
-0000b420: 276d 6172 6b65 744f 7264 6572 5265 7175  'marketOrderRequ
-0000b430: 6972 6573 5072 6963 6527 2c20 4661 6c73  iresPrice', Fals
-0000b440: 6529 0a20 2020 2020 2020 2029 0a0a 2020  e).        )..  
-0000b450: 2020 6465 6620 6372 6561 7465 5f6f 7264    def create_ord
-0000b460: 6572 280a 2020 2020 2020 2020 7365 6c66  er(.        self
-0000b470: 2c0a 2020 2020 2020 2020 2a2c 0a20 2020  ,.        *,.   
-0000b480: 2020 2020 2070 6169 723a 2073 7472 2c0a       pair: str,.
-0000b490: 2020 2020 2020 2020 6f72 6465 7274 7970          ordertyp
-0000b4a0: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
-0000b4b0: 7369 6465 3a20 4275 7953 656c 6c2c 0a20  side: BuySell,. 
-0000b4c0: 2020 2020 2020 2061 6d6f 756e 743a 2066         amount: f
-0000b4d0: 6c6f 6174 2c0a 2020 2020 2020 2020 7261  loat,.        ra
-0000b4e0: 7465 3a20 666c 6f61 742c 0a20 2020 2020  te: float,.     
-0000b4f0: 2020 206c 6576 6572 6167 653a 2066 6c6f     leverage: flo
-0000b500: 6174 2c0a 2020 2020 2020 2020 7265 6475  at,.        redu
-0000b510: 6365 4f6e 6c79 3a20 626f 6f6c 203d 2046  ceOnly: bool = F
-0000b520: 616c 7365 2c0a 2020 2020 2020 2020 7469  alse,.        ti
-0000b530: 6d65 5f69 6e5f 666f 7263 653a 2073 7472  me_in_force: str
-0000b540: 203d 2027 4754 4327 2c0a 2020 2020 2920   = 'GTC',.    ) 
-0000b550: 2d3e 2044 6963 743a 0a20 2020 2020 2020  -> Dict:.       
-0000b560: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
-0000b570: 5b27 6472 795f 7275 6e27 5d3a 0a20 2020  ['dry_run']:.   
-0000b580: 2020 2020 2020 2020 2064 7279 5f6f 7264           dry_ord
-0000b590: 6572 203d 2073 656c 662e 6372 6561 7465  er = self.create
-0000b5a0: 5f64 7279 5f72 756e 5f6f 7264 6572 280a  _dry_run_order(.
-0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5c0: 7061 6972 2c20 6f72 6465 7274 7970 652c  pair, ordertype,
-0000b5d0: 2073 6964 652c 2061 6d6f 756e 742c 2073   side, amount, s
-0000b5e0: 656c 662e 7072 6963 655f 746f 5f70 7265  elf.price_to_pre
-0000b5f0: 6369 7369 6f6e 2870 6169 722c 2072 6174  cision(pair, rat
-0000b600: 6529 2c20 6c65 7665 7261 6765 290a 2020  e), leverage).  
-0000b610: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000b620: 2064 7279 5f6f 7264 6572 0a0a 2020 2020   dry_order..    
-0000b630: 2020 2020 7061 7261 6d73 203d 2073 656c      params = sel
-0000b640: 662e 5f67 6574 5f70 6172 616d 7328 7369  f._get_params(si
-0000b650: 6465 2c20 6f72 6465 7274 7970 652c 206c  de, ordertype, l
-0000b660: 6576 6572 6167 652c 2072 6564 7563 654f  everage, reduceO
-0000b670: 6e6c 792c 2074 696d 655f 696e 5f66 6f72  nly, time_in_for
-0000b680: 6365 290a 0a20 2020 2020 2020 2074 7279  ce)..        try
-0000b690: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0000b6a0: 5365 7420 7468 6520 7072 6563 6973 696f  Set the precisio
-0000b6b0: 6e20 666f 7220 616d 6f75 6e74 2061 6e64  n for amount and
-0000b6c0: 2070 7269 6365 2872 6174 6529 2061 7320   price(rate) as 
-0000b6d0: 6163 6365 7074 6564 2062 7920 7468 6520  accepted by the 
-0000b6e0: 6578 6368 616e 6765 0a20 2020 2020 2020  exchange.       
-0000b6f0: 2020 2020 2061 6d6f 756e 7420 3d20 7365       amount = se
-0000b700: 6c66 2e61 6d6f 756e 745f 746f 5f70 7265  lf.amount_to_pre
-0000b710: 6369 7369 6f6e 2870 6169 722c 2073 656c  cision(pair, sel
-0000b720: 662e 5f61 6d6f 756e 745f 746f 5f63 6f6e  f._amount_to_con
-0000b730: 7472 6163 7473 2870 6169 722c 2061 6d6f  tracts(pair, amo
-0000b740: 756e 7429 290a 2020 2020 2020 2020 2020  unt)).          
-0000b750: 2020 6e65 6564 735f 7072 6963 6520 3d20    needs_price = 
-0000b760: 7365 6c66 2e5f 6f72 6465 725f 6e65 6564  self._order_need
-0000b770: 735f 7072 6963 6528 6f72 6465 7274 7970  s_price(ordertyp
-0000b780: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
-0000b790: 6174 655f 666f 725f 6f72 6465 7220 3d20  ate_for_order = 
-0000b7a0: 7365 6c66 2e70 7269 6365 5f74 6f5f 7072  self.price_to_pr
-0000b7b0: 6563 6973 696f 6e28 7061 6972 2c20 7261  ecision(pair, ra
-0000b7c0: 7465 2920 6966 206e 6565 6473 5f70 7269  te) if needs_pri
-0000b7d0: 6365 2065 6c73 6520 4e6f 6e65 0a0a 2020  ce else None..  
-0000b7e0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000b7f0: 2072 6564 7563 654f 6e6c 793a 0a20 2020   reduceOnly:.   
-0000b800: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b810: 662e 5f6c 6576 5f70 7265 7028 7061 6972  f._lev_prep(pair
-0000b820: 2c20 6c65 7665 7261 6765 2c20 7369 6465  , leverage, side
-0000b830: 290a 0a20 2020 2020 2020 2020 2020 206f  )..            o
-0000b840: 7264 6572 203d 2073 656c 662e 5f61 7069  rder = self._api
-0000b850: 2e63 7265 6174 655f 6f72 6465 7228 0a20  .create_order(. 
-0000b860: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000b870: 6169 722c 0a20 2020 2020 2020 2020 2020  air,.           
-0000b880: 2020 2020 206f 7264 6572 7479 7065 2c0a       ordertype,.
-0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8a0: 7369 6465 2c0a 2020 2020 2020 2020 2020  side,.          
-0000b8b0: 2020 2020 2020 616d 6f75 6e74 2c0a 2020        amount,.  
-0000b8c0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000b8d0: 7465 5f66 6f72 5f6f 7264 6572 2c0a 2020  te_for_order,.  
-0000b8e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0000b8f0: 7261 6d73 2c0a 2020 2020 2020 2020 2020  rams,.          
-0000b900: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000b910: 7365 6c66 2e5f 6c6f 675f 6578 6368 616e  self._log_exchan
-0000b920: 6765 5f72 6573 706f 6e73 6528 2763 7265  ge_response('cre
-0000b930: 6174 655f 6f72 6465 7227 2c20 6f72 6465  ate_order', orde
-0000b940: 7229 0a20 2020 2020 2020 2020 2020 206f  r).            o
-0000b950: 7264 6572 203d 2073 656c 662e 5f6f 7264  rder = self._ord
-0000b960: 6572 5f63 6f6e 7472 6163 7473 5f74 6f5f  er_contracts_to_
-0000b970: 616d 6f75 6e74 286f 7264 6572 290a 2020  amount(order).  
-0000b980: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000b990: 206f 7264 6572 0a0a 2020 2020 2020 2020   order..        
-0000b9a0: 6578 6365 7074 2063 6378 742e 496e 7375  except ccxt.Insu
-0000b9b0: 6666 6963 6965 6e74 4675 6e64 7320 6173  fficientFunds as
-0000b9c0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000b9d0: 7261 6973 6520 496e 7375 6666 6963 6965  raise Insufficie
-0000b9e0: 6e74 4675 6e64 7345 7272 6f72 280a 2020  ntFundsError(.  
-0000b9f0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-0000ba00: 496e 7375 6666 6963 6965 6e74 2066 756e  Insufficient fun
-0000ba10: 6473 2074 6f20 6372 6561 7465 207b 6f72  ds to create {or
-0000ba20: 6465 7274 7970 657d 207b 7369 6465 7d20  dertype} {side} 
-0000ba30: 6f72 6465 7220 6f6e 206d 6172 6b65 7420  order on market 
-0000ba40: 7b70 6169 727d 2e20 270a 2020 2020 2020  {pair}. '.      
-0000ba50: 2020 2020 2020 2020 2020 6627 5472 6965            f'Trie
-0000ba60: 6420 746f 207b 7369 6465 7d20 616d 6f75  d to {side} amou
-0000ba70: 6e74 207b 616d 6f75 6e74 7d20 6174 2072  nt {amount} at r
-0000ba80: 6174 6520 7b72 6174 657d 2e27 0a20 2020  ate {rate}.'.   
-0000ba90: 2020 2020 2020 2020 2020 2020 2066 274d               f'M
-0000baa0: 6573 7361 6765 3a20 7b65 7d27 2920 6672  essage: {e}') fr
-0000bab0: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
-0000bac0: 6570 7420 6363 7874 2e49 6e76 616c 6964  ept ccxt.Invalid
-0000bad0: 4f72 6465 7220 6173 2065 3a0a 2020 2020  Order as e:.    
-0000bae0: 2020 2020 2020 2020 7261 6973 6520 496e          raise In
-0000baf0: 7661 6c69 644f 7264 6572 4578 6365 7074  validOrderExcept
-0000bb00: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0000bb10: 2020 2020 2066 2743 6f75 6c64 206e 6f74       f'Could not
-0000bb20: 2063 7265 6174 6520 7b6f 7264 6572 7479   create {orderty
-0000bb30: 7065 7d20 7b73 6964 657d 206f 7264 6572  pe} {side} order
-0000bb40: 206f 6e20 6d61 726b 6574 207b 7061 6972   on market {pair
-0000bb50: 7d2e 2027 0a20 2020 2020 2020 2020 2020  }. '.           
-0000bb60: 2020 2020 2066 2754 7269 6564 2074 6f20       f'Tried to 
-0000bb70: 7b73 6964 657d 2061 6d6f 756e 7420 7b61  {side} amount {a
-0000bb80: 6d6f 756e 747d 2061 7420 7261 7465 207b  mount} at rate {
-0000bb90: 7261 7465 7d2e 2027 0a20 2020 2020 2020  rate}. '.       
-0000bba0: 2020 2020 2020 2020 2066 274d 6573 7361           f'Messa
-0000bbb0: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
-0000bbc0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000bbd0: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
-0000bbe0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-0000bbf0: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
-0000bc00: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
-0000bc10: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
-0000bc20: 6570 7420 2863 6378 742e 4e65 7477 6f72  ept (ccxt.Networ
-0000bc30: 6b45 7272 6f72 2c20 6363 7874 2e45 7863  kError, ccxt.Exc
-0000bc40: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
-0000bc50: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000bc60: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
-0000bc70: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000bc80: 2020 2020 6627 436f 756c 6420 6e6f 7420      f'Could not 
-0000bc90: 706c 6163 6520 7b73 6964 657d 206f 7264  place {side} ord
-0000bca0: 6572 2064 7565 2074 6f20 7b65 2e5f 5f63  er due to {e.__c
-0000bcb0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-0000bcc0: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
-0000bcd0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0000bce0: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
-0000bcf0: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
-0000bd00: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-0000bd10: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-0000bd20: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
-0000bd30: 2020 6465 6620 7374 6f70 6c6f 7373 5f61    def stoploss_a
-0000bd40: 646a 7573 7428 7365 6c66 2c20 7374 6f70  djust(self, stop
-0000bd50: 5f6c 6f73 733a 2066 6c6f 6174 2c20 6f72  _loss: float, or
-0000bd60: 6465 723a 2044 6963 742c 2073 6964 653a  der: Dict, side:
-0000bd70: 2073 7472 2920 2d3e 2062 6f6f 6c3a 0a20   str) -> bool:. 
-0000bd80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000bd90: 2020 2056 6572 6966 7920 7374 6f70 5f6c     Verify stop_l
-0000bda0: 6f73 7320 6167 6169 6e73 7420 7374 6f70  oss against stop
-0000bdb0: 6c6f 7373 2d6f 7264 6572 2076 616c 7565  loss-order value
-0000bdc0: 2028 6c69 6d69 7420 6f72 2070 7269 6365   (limit or price
-0000bdd0: 290a 2020 2020 2020 2020 5265 7475 726e  ).        Return
-0000bde0: 7320 5472 7565 2069 6620 6164 6a75 7374  s True if adjust
-0000bdf0: 6d65 6e74 2069 7320 6e65 6365 7373 6172  ment is necessar
-0000be00: 792e 0a20 2020 2020 2020 2022 2222 0a20  y..        """. 
-0000be10: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-0000be20: 6c66 2e5f 6674 5f68 6173 2e67 6574 2827  lf._ft_has.get('
-0000be30: 7374 6f70 6c6f 7373 5f6f 6e5f 6578 6368  stoploss_on_exch
-0000be40: 616e 6765 2729 3a0a 2020 2020 2020 2020  ange'):.        
-0000be50: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-0000be60: 696f 6e61 6c45 7863 6570 7469 6f6e 2866  ionalException(f
-0000be70: 2273 746f 706c 6f73 7320 6973 206e 6f74  "stoploss is not
-0000be80: 2069 6d70 6c65 6d65 6e74 6564 2066 6f72   implemented for
-0000be90: 207b 7365 6c66 2e6e 616d 657d 2e22 290a   {self.name}.").
-0000bea0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000beb0: 280a 2020 2020 2020 2020 2020 2020 6f72  (.            or
-0000bec0: 6465 722e 6765 7428 2773 746f 7050 7269  der.get('stopPri
-0000bed0: 6365 272c 204e 6f6e 6529 2069 7320 4e6f  ce', None) is No
-0000bee0: 6e65 0a20 2020 2020 2020 2020 2020 206f  ne.            o
-0000bef0: 7220 2828 7369 6465 203d 3d20 2273 656c  r ((side == "sel
-0000bf00: 6c22 2061 6e64 2073 746f 705f 6c6f 7373  l" and stop_loss
-0000bf10: 203e 2066 6c6f 6174 286f 7264 6572 5b27   > float(order['
-0000bf20: 7374 6f70 5072 6963 6527 5d29 2920 6f72  stopPrice'])) or
-0000bf30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bf40: 2028 7369 6465 203d 3d20 2262 7579 2220   (side == "buy" 
-0000bf50: 616e 6420 7374 6f70 5f6c 6f73 7320 3c20  and stop_loss < 
-0000bf60: 666c 6f61 7428 6f72 6465 725b 2773 746f  float(order['sto
-0000bf70: 7050 7269 6365 275d 2929 290a 2020 2020  pPrice']))).    
-0000bf80: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
-0000bf90: 6765 745f 7374 6f70 5f6f 7264 6572 5f74  get_stop_order_t
-0000bfa0: 7970 6528 7365 6c66 2c20 7573 6572 5f6f  ype(self, user_o
-0000bfb0: 7264 6572 5f74 7970 6529 202d 3e20 5475  rder_type) -> Tu
-0000bfc0: 706c 655b 7374 722c 2073 7472 5d3a 0a0a  ple[str, str]:..
-0000bfd0: 2020 2020 2020 2020 6176 6169 6c61 626c          availabl
-0000bfe0: 655f 6f72 6465 725f 5479 7065 733a 2044  e_order_Types: D
-0000bff0: 6963 745b 7374 722c 2073 7472 5d20 3d20  ict[str, str] = 
-0000c000: 7365 6c66 2e5f 6674 5f68 6173 5b22 7374  self._ft_has["st
-0000c010: 6f70 6c6f 7373 5f6f 7264 6572 5f74 7970  oploss_order_typ
-0000c020: 6573 225d 0a0a 2020 2020 2020 2020 6966  es"]..        if
-0000c030: 2075 7365 725f 6f72 6465 725f 7479 7065   user_order_type
-0000c040: 2069 6e20 6176 6169 6c61 626c 655f 6f72   in available_or
-0000c050: 6465 725f 5479 7065 732e 6b65 7973 2829  der_Types.keys()
-0000c060: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
-0000c070: 6465 7274 7970 6520 3d20 6176 6169 6c61  dertype = availa
-0000c080: 626c 655f 6f72 6465 725f 5479 7065 735b  ble_order_Types[
-0000c090: 7573 6572 5f6f 7264 6572 5f74 7970 655d  user_order_type]
-0000c0a0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000c0b0: 2020 2020 2020 2020 2020 2023 204f 7468             # Oth
-0000c0c0: 6572 7769 7365 2070 6963 6b20 6f6e 6c79  erwise pick only
-0000c0d0: 206f 6e65 2061 7661 696c 6162 6c65 0a20   one available. 
-0000c0e0: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000c0f0: 7479 7065 203d 206c 6973 7428 6176 6169  type = list(avai
-0000c100: 6c61 626c 655f 6f72 6465 725f 5479 7065  lable_order_Type
-0000c110: 732e 7661 6c75 6573 2829 295b 305d 0a20  s.values())[0]. 
-0000c120: 2020 2020 2020 2020 2020 2075 7365 725f             user_
-0000c130: 6f72 6465 725f 7479 7065 203d 206c 6973  order_type = lis
-0000c140: 7428 6176 6169 6c61 626c 655f 6f72 6465  t(available_orde
-0000c150: 725f 5479 7065 732e 6b65 7973 2829 295b  r_Types.keys())[
-0000c160: 305d 0a20 2020 2020 2020 2072 6574 7572  0].        retur
-0000c170: 6e20 6f72 6465 7274 7970 652c 2075 7365  n ordertype, use
-0000c180: 725f 6f72 6465 725f 7479 7065 0a0a 2020  r_order_type..  
-0000c190: 2020 6465 6620 5f67 6574 5f73 746f 705f    def _get_stop_
-0000c1a0: 6c69 6d69 745f 7261 7465 2873 656c 662c  limit_rate(self,
-0000c1b0: 2073 746f 705f 7072 6963 653a 2066 6c6f   stop_price: flo
-0000c1c0: 6174 2c20 6f72 6465 725f 7479 7065 733a  at, order_types:
-0000c1d0: 2044 6963 742c 2073 6964 653a 2073 7472   Dict, side: str
-0000c1e0: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
-0000c1f0: 2020 2020 2320 4c69 6d69 7420 7072 6963      # Limit pric
-0000c200: 6520 7468 7265 7368 6f6c 643a 2041 7320  e threshold: As 
-0000c210: 6c69 6d69 7420 7072 6963 6520 7368 6f75  limit price shou
-0000c220: 6c64 2061 6c77 6179 7320 6265 2062 656c  ld always be bel
-0000c230: 6f77 2073 746f 702d 7072 6963 650a 2020  ow stop-price.  
-0000c240: 2020 2020 2020 6c69 6d69 745f 7072 6963        limit_pric
-0000c250: 655f 7063 7420 3d20 6f72 6465 725f 7479  e_pct = order_ty
-0000c260: 7065 732e 6765 7428 2773 746f 706c 6f73  pes.get('stoplos
-0000c270: 735f 6f6e 5f65 7863 6861 6e67 655f 6c69  s_on_exchange_li
-0000c280: 6d69 745f 7261 7469 6f27 2c20 302e 3939  mit_ratio', 0.99
-0000c290: 290a 2020 2020 2020 2020 6966 2073 6964  ).        if sid
-0000c2a0: 6520 3d3d 2022 7365 6c6c 223a 0a20 2020  e == "sell":.   
-0000c2b0: 2020 2020 2020 2020 206c 696d 6974 5f72           limit_r
-0000c2c0: 6174 6520 3d20 7374 6f70 5f70 7269 6365  ate = stop_price
-0000c2d0: 202a 206c 696d 6974 5f70 7269 6365 5f70   * limit_price_p
-0000c2e0: 6374 0a20 2020 2020 2020 2065 6c73 653a  ct.        else:
-0000c2f0: 0a20 2020 2020 2020 2020 2020 206c 696d  .            lim
-0000c300: 6974 5f72 6174 6520 3d20 7374 6f70 5f70  it_rate = stop_p
-0000c310: 7269 6365 202a 2028 3220 2d20 6c69 6d69  rice * (2 - limi
-0000c320: 745f 7072 6963 655f 7063 7429 0a0a 2020  t_price_pct)..  
-0000c330: 2020 2020 2020 6261 645f 7374 6f70 5f70        bad_stop_p
-0000c340: 7269 6365 203d 2028 2873 746f 705f 7072  rice = ((stop_pr
-0000c350: 6963 6520 3c3d 206c 696d 6974 5f72 6174  ice <= limit_rat
-0000c360: 6529 2069 6620 7369 6465 203d 3d0a 2020  e) if side ==.  
-0000c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c380: 2020 2020 2020 2020 2273 656c 6c22 2065          "sell" e
-0000c390: 6c73 6520 2873 746f 705f 7072 6963 6520  lse (stop_price 
-0000c3a0: 3e3d 206c 696d 6974 5f72 6174 6529 290a  >= limit_rate)).
-0000c3b0: 2020 2020 2020 2020 2320 456e 7375 7265          # Ensure
-0000c3c0: 2072 6174 6520 6973 206c 6573 7320 7468   rate is less th
-0000c3d0: 616e 2073 746f 7020 7072 6963 650a 2020  an stop price.  
-0000c3e0: 2020 2020 2020 6966 2062 6164 5f73 746f        if bad_sto
-0000c3f0: 705f 7072 6963 653a 0a20 2020 2020 2020  p_price:.       
-0000c400: 2020 2020 2023 2054 6869 7320 6361 6e20       # This can 
-0000c410: 666f 7220 6578 616d 706c 6520 6861 7070  for example happ
-0000c420: 656e 2069 6620 7468 6520 7374 6f70 202f  en if the stop /
-0000c430: 206c 6971 7569 6461 7469 6f6e 2070 7269   liquidation pri
-0000c440: 6365 2069 7320 7365 7420 746f 2030 0a20  ce is set to 0. 
-0000c450: 2020 2020 2020 2020 2020 2023 2057 6869             # Whi
-0000c460: 6368 2069 7320 706f 7373 6962 6c65 2069  ch is possible i
-0000c470: 6620 6120 6d61 726b 6574 2d6f 7264 6572  f a market-order
-0000c480: 2063 6c6f 7365 7320 7269 6768 7420 6177   closes right aw
-0000c490: 6179 2e0a 2020 2020 2020 2020 2020 2020  ay..            
-0000c4a0: 2320 5468 6520 496e 7661 6c69 644f 7264  # The InvalidOrd
-0000c4b0: 6572 4578 6365 7074 696f 6e20 7769 6c6c  erException will
-0000c4c0: 2062 7562 626c 6520 7570 2074 6f20 6578   bubble up to ex
-0000c4d0: 6974 5f70 6f73 6974 696f 6e73 2c20 7768  it_positions, wh
-0000c4e0: 6572 6520 6974 2077 696c 6c20 6265 0a20  ere it will be. 
-0000c4f0: 2020 2020 2020 2020 2020 2023 2068 616e             # han
-0000c500: 646c 6564 2067 7261 6365 6675 6c6c 792e  dled gracefully.
-0000c510: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000c520: 7365 2049 6e76 616c 6964 4f72 6465 7245  se InvalidOrderE
-0000c530: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-0000c540: 2020 2020 2020 2020 2020 2249 6e20 7374            "In st
-0000c550: 6f70 6c6f 7373 206c 696d 6974 206f 7264  oploss limit ord
-0000c560: 6572 2c20 7374 6f70 2070 7269 6365 2073  er, stop price s
-0000c570: 686f 756c 6420 6265 206d 6f72 6520 7468  hould be more th
-0000c580: 616e 206c 696d 6974 2070 7269 6365 2e20  an limit price. 
-0000c590: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000c5a0: 2020 6622 5374 6f70 2070 7269 6365 3a20    f"Stop price: 
-0000c5b0: 7b73 746f 705f 7072 6963 657d 2c20 4c69  {stop_price}, Li
-0000c5c0: 6d69 7420 7072 6963 653a 207b 6c69 6d69  mit price: {limi
-0000c5d0: 745f 7261 7465 7d2c 2022 0a20 2020 2020  t_rate}, ".     
-0000c5e0: 2020 2020 2020 2020 2020 2066 224c 696d             f"Lim
-0000c5f0: 6974 2050 7269 6365 2070 6374 3a20 7b6c  it Price pct: {l
-0000c600: 696d 6974 5f70 7269 6365 5f70 6374 7d22  imit_price_pct}"
-0000c610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c620: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-0000c630: 6e20 6c69 6d69 745f 7261 7465 0a0a 2020  n limit_rate..  
-0000c640: 2020 6465 6620 5f67 6574 5f73 746f 705f    def _get_stop_
-0000c650: 7061 7261 6d73 2873 656c 662c 2073 6964  params(self, sid
-0000c660: 653a 2042 7579 5365 6c6c 2c20 6f72 6465  e: BuySell, orde
-0000c670: 7274 7970 653a 2073 7472 2c20 7374 6f70  rtype: str, stop
-0000c680: 5f70 7269 6365 3a20 666c 6f61 7429 202d  _price: float) -
-0000c690: 3e20 4469 6374 3a0a 2020 2020 2020 2020  > Dict:.        
-0000c6a0: 7061 7261 6d73 203d 2073 656c 662e 5f70  params = self._p
-0000c6b0: 6172 616d 732e 636f 7079 2829 0a20 2020  arams.copy().   
-0000c6c0: 2020 2020 2023 2056 6572 6966 7920 6966       # Verify if
-0000c6d0: 2073 746f 7050 7269 6365 2077 6f72 6b73   stopPrice works
-0000c6e0: 2066 6f72 2079 6f75 7220 6578 6368 616e   for your exchan
-0000c6f0: 6765 210a 2020 2020 2020 2020 7061 7261  ge!.        para
-0000c700: 6d73 2e75 7064 6174 6528 7b27 7374 6f70  ms.update({'stop
-0000c710: 5072 6963 6527 3a20 7374 6f70 5f70 7269  Price': stop_pri
-0000c720: 6365 7d29 0a20 2020 2020 2020 2072 6574  ce}).        ret
-0000c730: 7572 6e20 7061 7261 6d73 0a0a 2020 2020  urn params..    
-0000c740: 4072 6574 7269 6572 2872 6574 7269 6573  @retrier(retries
-0000c750: 3d30 290a 2020 2020 6465 6620 6372 6561  =0).    def crea
-0000c760: 7465 5f73 746f 706c 6f73 7328 7365 6c66  te_stoploss(self
-0000c770: 2c20 7061 6972 3a20 7374 722c 2061 6d6f  , pair: str, amo
-0000c780: 756e 743a 2066 6c6f 6174 2c20 7374 6f70  unt: float, stop
-0000c790: 5f70 7269 6365 3a20 666c 6f61 742c 206f  _price: float, o
-0000c7a0: 7264 6572 5f74 7970 6573 3a20 4469 6374  rder_types: Dict
-0000c7b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c7c0: 2020 2020 2020 2020 2020 7369 6465 3a20            side: 
-0000c7d0: 4275 7953 656c 6c2c 206c 6576 6572 6167  BuySell, leverag
-0000c7e0: 653a 2066 6c6f 6174 2920 2d3e 2044 6963  e: float) -> Dic
-0000c7f0: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-0000c800: 2020 2020 2020 2063 7265 6174 6573 2061         creates a
-0000c810: 2073 746f 706c 6f73 7320 6f72 6465 722e   stoploss order.
-0000c820: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
-0000c830: 7320 605f 6674 5f68 6173 5b27 7374 6f70  s `_ft_has['stop
-0000c840: 6c6f 7373 5f6f 7264 6572 5f74 7970 6573  loss_order_types
-0000c850: 275d 6020 746f 2062 6520 7365 7420 6173  ']` to be set as
-0000c860: 2061 2064 6963 7420 6d61 7070 696e 6720   a dict mapping 
-0000c870: 6c69 6d69 7420 616e 6420 6d61 726b 6574  limit and market
-0000c880: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-0000c890: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
-0000c8a0: 6720 6578 6368 616e 6765 2074 7970 652e  g exchange type.
-0000c8b0: 0a0a 2020 2020 2020 2020 5468 6520 7072  ..        The pr
-0000c8c0: 6563 6973 6520 6f72 6465 7274 7970 6520  ecise ordertype 
-0000c8d0: 6973 2064 6574 6572 6d69 6e65 6420 6279  is determined by
-0000c8e0: 2074 6865 206f 7264 6572 5f74 7970 6573   the order_types
-0000c8f0: 2064 6963 7420 6f72 2065 7863 6861 6e67   dict or exchang
-0000c900: 6520 6465 6661 756c 742e 0a0a 2020 2020  e default...    
-0000c910: 2020 2020 5468 6520 6578 6365 7074 696f      The exceptio
-0000c920: 6e20 6265 6c6f 7720 7368 6f75 6c64 206e  n below should n
-0000c930: 6576 6572 2072 6169 7365 2c20 7369 6e63  ever raise, sinc
-0000c940: 6520 7765 2064 6973 616c 6c6f 770a 2020  e we disallow.  
-0000c950: 2020 2020 2020 7374 6172 7469 6e67 2074        starting t
-0000c960: 6865 2062 6f74 2069 6e20 7661 6c69 6461  he bot in valida
-0000c970: 7465 5f6f 7264 6572 7479 7065 7328 290a  te_ordertypes().
-0000c980: 0a20 2020 2020 2020 2054 6869 7320 6d61  .        This ma
-0000c990: 7920 776f 726b 2077 6974 6820 6120 6c69  y work with a li
-0000c9a0: 6d69 7465 6420 6e75 6d62 6572 206f 6620  mited number of 
-0000c9b0: 6f74 6865 7220 6578 6368 616e 6765 732c  other exchanges,
-0000c9c0: 2062 7574 2063 6f72 7265 6374 2077 6f72   but correct wor
-0000c9d0: 6b69 6e67 0a20 2020 2020 2020 2020 2020  king.           
-0000c9e0: 206e 6565 6473 2074 6f20 6265 2074 6573   needs to be tes
-0000c9f0: 7465 6420 696e 6469 7669 6475 616c 6c79  ted individually
-0000ca00: 2e0a 2020 2020 2020 2020 5741 524e 494e  ..        WARNIN
-0000ca10: 473a 2073 6574 7469 6e67 2060 7374 6f70  G: setting `stop
-0000ca20: 6c6f 7373 5f6f 6e5f 6578 6368 616e 6765  loss_on_exchange
-0000ca30: 6020 746f 2054 7275 6520 7769 6c6c 204e  ` to True will N
-0000ca40: 4f54 2061 7574 6f2d 656e 6162 6c65 2073  OT auto-enable s
-0000ca50: 746f 706c 6f73 7320 6f6e 2065 7863 6861  toploss on excha
-0000ca60: 6e67 652e 0a20 2020 2020 2020 2020 2020  nge..           
-0000ca70: 2060 7374 6f70 6c6f 7373 5f61 646a 7573   `stoploss_adjus
-0000ca80: 7460 206d 7573 7420 7374 696c 6c20 6265  t` must still be
-0000ca90: 2069 6d70 6c65 6d65 6e74 6564 2066 6f72   implemented for
-0000caa0: 2074 6869 7320 746f 2077 6f72 6b2e 0a20   this to work.. 
-0000cab0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000cac0: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
-0000cad0: 6674 5f68 6173 5b27 7374 6f70 6c6f 7373  ft_has['stoploss
-0000cae0: 5f6f 6e5f 6578 6368 616e 6765 275d 3a0a  _on_exchange']:.
-0000caf0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000cb00: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-0000cb10: 6570 7469 6f6e 2866 2273 746f 706c 6f73  eption(f"stoplos
-0000cb20: 7320 6973 206e 6f74 2069 6d70 6c65 6d65  s is not impleme
-0000cb30: 6e74 6564 2066 6f72 207b 7365 6c66 2e6e  nted for {self.n
-0000cb40: 616d 657d 2e22 290a 0a20 2020 2020 2020  ame}.")..       
-0000cb50: 2075 7365 725f 6f72 6465 725f 7479 7065   user_order_type
-0000cb60: 203d 206f 7264 6572 5f74 7970 6573 2e67   = order_types.g
-0000cb70: 6574 2827 7374 6f70 6c6f 7373 272c 2027  et('stoploss', '
-0000cb80: 6d61 726b 6574 2729 0a20 2020 2020 2020  market').       
-0000cb90: 206f 7264 6572 7479 7065 2c20 7573 6572   ordertype, user
-0000cba0: 5f6f 7264 6572 5f74 7970 6520 3d20 7365  _order_type = se
-0000cbb0: 6c66 2e5f 6765 745f 7374 6f70 5f6f 7264  lf._get_stop_ord
-0000cbc0: 6572 5f74 7970 6528 7573 6572 5f6f 7264  er_type(user_ord
-0000cbd0: 6572 5f74 7970 6529 0a0a 2020 2020 2020  er_type)..      
-0000cbe0: 2020 7374 6f70 5f70 7269 6365 5f6e 6f72    stop_price_nor
-0000cbf0: 6d20 3d20 7365 6c66 2e70 7269 6365 5f74  m = self.price_t
-0000cc00: 6f5f 7072 6563 6973 696f 6e28 7061 6972  o_precision(pair
-0000cc10: 2c20 7374 6f70 5f70 7269 6365 290a 2020  , stop_price).  
-0000cc20: 2020 2020 2020 6c69 6d69 745f 7261 7465        limit_rate
-0000cc30: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000cc40: 6966 2075 7365 725f 6f72 6465 725f 7479  if user_order_ty
-0000cc50: 7065 203d 3d20 276c 696d 6974 273a 0a20  pe == 'limit':. 
-0000cc60: 2020 2020 2020 2020 2020 206c 696d 6974             limit
-0000cc70: 5f72 6174 6520 3d20 7365 6c66 2e5f 6765  _rate = self._ge
-0000cc80: 745f 7374 6f70 5f6c 696d 6974 5f72 6174  t_stop_limit_rat
-0000cc90: 6528 7374 6f70 5f70 7269 6365 2c20 6f72  e(stop_price, or
-0000cca0: 6465 725f 7479 7065 732c 2073 6964 6529  der_types, side)
-0000ccb0: 0a20 2020 2020 2020 2020 2020 206c 696d  .            lim
-0000ccc0: 6974 5f72 6174 6520 3d20 7365 6c66 2e70  it_rate = self.p
-0000ccd0: 7269 6365 5f74 6f5f 7072 6563 6973 696f  rice_to_precisio
-0000cce0: 6e28 7061 6972 2c20 6c69 6d69 745f 7261  n(pair, limit_ra
-0000ccf0: 7465 290a 0a20 2020 2020 2020 2069 6620  te)..        if 
-0000cd00: 7365 6c66 2e5f 636f 6e66 6967 5b27 6472  self._config['dr
-0000cd10: 795f 7275 6e27 5d3a 0a20 2020 2020 2020  y_run']:.       
-0000cd20: 2020 2020 2064 7279 5f6f 7264 6572 203d       dry_order =
-0000cd30: 2073 656c 662e 6372 6561 7465 5f64 7279   self.create_dry
-0000cd40: 5f72 756e 5f6f 7264 6572 280a 2020 2020  _run_order(.    
-0000cd50: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-0000cd60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000cd70: 2020 6f72 6465 7274 7970 652c 0a20 2020    ordertype,.   
-0000cd80: 2020 2020 2020 2020 2020 2020 2073 6964               sid
-0000cd90: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000cda0: 2020 2061 6d6f 756e 742c 0a20 2020 2020     amount,.     
-0000cdb0: 2020 2020 2020 2020 2020 2073 746f 705f             stop_
-0000cdc0: 7072 6963 655f 6e6f 726d 2c0a 2020 2020  price_norm,.    
-0000cdd0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
-0000cde0: 5f6c 6f73 733d 5472 7565 2c0a 2020 2020  _loss=True,.    
-0000cdf0: 2020 2020 2020 2020 2020 2020 6c65 7665              leve
-0000ce00: 7261 6765 3d6c 6576 6572 6167 652c 0a20  rage=leverage,. 
-0000ce10: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000ce20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000ce30: 6472 795f 6f72 6465 720a 0a20 2020 2020  dry_order..     
-0000ce40: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000ce50: 2020 2020 7061 7261 6d73 203d 2073 656c      params = sel
-0000ce60: 662e 5f67 6574 5f73 746f 705f 7061 7261  f._get_stop_para
-0000ce70: 6d73 2873 6964 653d 7369 6465 2c20 6f72  ms(side=side, or
-0000ce80: 6465 7274 7970 653d 6f72 6465 7274 7970  dertype=ordertyp
-0000ce90: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ceb0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0000cec0: 6f70 5f70 7269 6365 3d73 746f 705f 7072  op_price=stop_pr
-0000ced0: 6963 655f 6e6f 726d 290a 2020 2020 2020  ice_norm).      
-0000cee0: 2020 2020 2020 6966 2073 656c 662e 7472        if self.tr
-0000cef0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
-0000cf00: 6164 696e 674d 6f64 652e 4655 5455 5245  adingMode.FUTURE
-0000cf10: 533a 0a20 2020 2020 2020 2020 2020 2020  S:.             
-0000cf20: 2020 2070 6172 616d 735b 2772 6564 7563     params['reduc
-0000cf30: 654f 6e6c 7927 5d20 3d20 5472 7565 0a20  eOnly'] = True. 
-0000cf40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000cf50: 6620 2773 746f 706c 6f73 735f 7072 6963  f 'stoploss_pric
-0000cf60: 655f 7479 7065 2720 696e 206f 7264 6572  e_type' in order
-0000cf70: 5f74 7970 6573 2061 6e64 2027 7374 6f70  _types and 'stop
-0000cf80: 5f70 7269 6365 5f74 7970 655f 6669 656c  _price_type_fiel
-0000cf90: 6427 2069 6e20 7365 6c66 2e5f 6674 5f68  d' in self._ft_h
-0000cfa0: 6173 3a0a 2020 2020 2020 2020 2020 2020  as:.            
-0000cfb0: 2020 2020 2020 2020 7072 6963 655f 7479          price_ty
-0000cfc0: 7065 203d 2073 656c 662e 5f66 745f 6861  pe = self._ft_ha
-0000cfd0: 735b 2773 746f 705f 7072 6963 655f 7479  s['stop_price_ty
-0000cfe0: 7065 5f76 616c 7565 5f6d 6170 7069 6e67  pe_value_mapping
-0000cff0: 275d 5b0a 2020 2020 2020 2020 2020 2020  '][.            
-0000d000: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000d010: 725f 7479 7065 732e 6765 7428 2773 746f  r_types.get('sto
-0000d020: 706c 6f73 735f 7072 6963 655f 7479 7065  ploss_price_type
-0000d030: 272c 2050 7269 6365 5479 7065 2e4c 4153  ', PriceType.LAS
-0000d040: 5429 5d0a 2020 2020 2020 2020 2020 2020  T)].            
-0000d050: 2020 2020 2020 2020 7061 7261 6d73 5b73          params[s
-0000d060: 656c 662e 5f66 745f 6861 735b 2773 746f  elf._ft_has['sto
-0000d070: 705f 7072 6963 655f 7479 7065 5f66 6965  p_price_type_fie
-0000d080: 6c64 275d 5d20 3d20 7072 6963 655f 7479  ld']] = price_ty
-0000d090: 7065 0a0a 2020 2020 2020 2020 2020 2020  pe..            
-0000d0a0: 616d 6f75 6e74 203d 2073 656c 662e 616d  amount = self.am
-0000d0b0: 6f75 6e74 5f74 6f5f 7072 6563 6973 696f  ount_to_precisio
-0000d0c0: 6e28 7061 6972 2c20 7365 6c66 2e5f 616d  n(pair, self._am
-0000d0d0: 6f75 6e74 5f74 6f5f 636f 6e74 7261 6374  ount_to_contract
-0000d0e0: 7328 7061 6972 2c20 616d 6f75 6e74 2929  s(pair, amount))
-0000d0f0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000d100: 6c66 2e5f 6c65 765f 7072 6570 2870 6169  lf._lev_prep(pai
-0000d110: 722c 206c 6576 6572 6167 652c 2073 6964  r, leverage, sid
-0000d120: 652c 2061 6363 6570 745f 6661 696c 3d54  e, accept_fail=T
-0000d130: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0000d140: 206f 7264 6572 203d 2073 656c 662e 5f61   order = self._a
-0000d150: 7069 2e63 7265 6174 655f 6f72 6465 7228  pi.create_order(
-0000d160: 7379 6d62 6f6c 3d70 6169 722c 2074 7970  symbol=pair, typ
-0000d170: 653d 6f72 6465 7274 7970 652c 2073 6964  e=ordertype, sid
-0000d180: 653d 7369 6465 2c0a 2020 2020 2020 2020  e=side,.        
-0000d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1b0: 2020 2061 6d6f 756e 743d 616d 6f75 6e74     amount=amount
-0000d1c0: 2c20 7072 6963 653d 6c69 6d69 745f 7261  , price=limit_ra
-0000d1d0: 7465 2c20 7061 7261 6d73 3d70 6172 616d  te, params=param
-0000d1e0: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
-0000d1f0: 656c 662e 5f6c 6f67 5f65 7863 6861 6e67  elf._log_exchang
-0000d200: 655f 7265 7370 6f6e 7365 2827 6372 6561  e_response('crea
-0000d210: 7465 5f73 746f 706c 6f73 735f 6f72 6465  te_stoploss_orde
-0000d220: 7227 2c20 6f72 6465 7229 0a20 2020 2020  r', order).     
-0000d230: 2020 2020 2020 206f 7264 6572 203d 2073         order = s
-0000d240: 656c 662e 5f6f 7264 6572 5f63 6f6e 7472  elf._order_contr
-0000d250: 6163 7473 5f74 6f5f 616d 6f75 6e74 286f  acts_to_amount(o
-0000d260: 7264 6572 290a 2020 2020 2020 2020 2020  rder).          
-0000d270: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
-0000d280: 7374 6f70 6c6f 7373 207b 7573 6572 5f6f  stoploss {user_o
-0000d290: 7264 6572 5f74 7970 657d 206f 7264 6572  rder_type} order
-0000d2a0: 2061 6464 6564 2066 6f72 207b 7061 6972   added for {pair
-0000d2b0: 7d2e 2022 0a20 2020 2020 2020 2020 2020  }. ".           
-0000d2c0: 2020 2020 2020 2020 2020 2020 2066 2273               f"s
-0000d2d0: 746f 7020 7072 6963 653a 207b 7374 6f70  top price: {stop
-0000d2e0: 5f70 7269 6365 7d2e 206c 696d 6974 3a20  _price}. limit: 
-0000d2f0: 7b6c 696d 6974 5f72 6174 657d 2229 0a20  {limit_rate}"). 
-0000d300: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000d310: 6e20 6f72 6465 720a 2020 2020 2020 2020  n order.        
-0000d320: 6578 6365 7074 2063 6378 742e 496e 7375  except ccxt.Insu
-0000d330: 6666 6963 6965 6e74 4675 6e64 7320 6173  fficientFunds as
-0000d340: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000d350: 7261 6973 6520 496e 7375 6666 6963 6965  raise Insufficie
-0000d360: 6e74 4675 6e64 7345 7272 6f72 280a 2020  ntFundsError(.  
-0000d370: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-0000d380: 496e 7375 6666 6963 6965 6e74 2066 756e  Insufficient fun
-0000d390: 6473 2074 6f20 6372 6561 7465 207b 6f72  ds to create {or
-0000d3a0: 6465 7274 7970 657d 2073 656c 6c20 6f72  dertype} sell or
-0000d3b0: 6465 7220 6f6e 206d 6172 6b65 7420 7b70  der on market {p
-0000d3c0: 6169 727d 2e20 270a 2020 2020 2020 2020  air}. '.        
-0000d3d0: 2020 2020 2020 2020 6627 5472 6965 6420          f'Tried 
-0000d3e0: 746f 2073 656c 6c20 616d 6f75 6e74 207b  to sell amount {
-0000d3f0: 616d 6f75 6e74 7d20 6174 2072 6174 6520  amount} at rate 
-0000d400: 7b6c 696d 6974 5f72 6174 657d 2e20 270a  {limit_rate}. '.
-0000d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d420: 6627 4d65 7373 6167 653a 207b 657d 2729  f'Message: {e}')
-0000d430: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0000d440: 6578 6365 7074 2063 6378 742e 496e 7661  except ccxt.Inva
-0000d450: 6c69 644f 7264 6572 2061 7320 653a 0a20  lidOrder as e:. 
-0000d460: 2020 2020 2020 2020 2020 2023 2045 7272             # Err
-0000d470: 6f72 733a 0a20 2020 2020 2020 2020 2020  ors:.           
-0000d480: 2023 2060 4f72 6465 7220 776f 756c 6420   # `Order would 
-0000d490: 7472 6967 6765 7220 696d 6d65 6469 6174  trigger immediat
-0000d4a0: 656c 792e 600a 2020 2020 2020 2020 2020  ely.`.          
-0000d4b0: 2020 7261 6973 6520 496e 7661 6c69 644f    raise InvalidO
-0000d4c0: 7264 6572 4578 6365 7074 696f 6e28 0a20  rderException(. 
-0000d4d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000d4e0: 2743 6f75 6c64 206e 6f74 2063 7265 6174  'Could not creat
-0000d4f0: 6520 7b6f 7264 6572 7479 7065 7d20 7365  e {ordertype} se
-0000d500: 6c6c 206f 7264 6572 206f 6e20 6d61 726b  ll order on mark
-0000d510: 6574 207b 7061 6972 7d2e 2027 0a20 2020  et {pair}. '.   
-0000d520: 2020 2020 2020 2020 2020 2020 2066 2754               f'T
-0000d530: 7269 6564 2074 6f20 7365 6c6c 2061 6d6f  ried to sell amo
-0000d540: 756e 7420 7b61 6d6f 756e 747d 2061 7420  unt {amount} at 
-0000d550: 7261 7465 207b 6c69 6d69 745f 7261 7465  rate {limit_rate
-0000d560: 7d2e 2027 0a20 2020 2020 2020 2020 2020  }. '.           
-0000d570: 2020 2020 2066 274d 6573 7361 6765 3a20       f'Message: 
-0000d580: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-0000d590: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-0000d5a0: 2e44 446f 5350 726f 7465 6374 696f 6e20  .DDoSProtection 
-0000d5b0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000d5c0: 2020 7261 6973 6520 4444 6f73 5072 6f74    raise DDosProt
-0000d5d0: 6563 7469 6f6e 2865 2920 6672 6f6d 2065  ection(e) from e
-0000d5e0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000d5f0: 2863 6378 742e 4e65 7477 6f72 6b45 7272  (ccxt.NetworkErr
-0000d600: 6f72 2c20 6363 7874 2e45 7863 6861 6e67  or, ccxt.Exchang
-0000d610: 6545 7272 6f72 2920 6173 2065 3a0a 2020  eError) as e:.  
-0000d620: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000d630: 5465 6d70 6f72 6172 7945 7272 6f72 280a  TemporaryError(.
-0000d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d650: 6622 436f 756c 6420 6e6f 7420 706c 6163  f"Could not plac
-0000d660: 6520 7374 6f70 6c6f 7373 206f 7264 6572  e stoploss order
-0000d670: 2064 7565 2074 6f20 7b65 2e5f 5f63 6c61   due to {e.__cla
-0000d680: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20  ss__.__name__}. 
-0000d690: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000d6a0: 2020 6622 4d65 7373 6167 653a 207b 657d    f"Message: {e}
-0000d6b0: 2229 2066 726f 6d20 650a 2020 2020 2020  ") from e.      
-0000d6c0: 2020 6578 6365 7074 2063 6378 742e 4261    except ccxt.Ba
-0000d6d0: 7365 4572 726f 7220 6173 2065 3a0a 2020  seError as e:.  
-0000d6e0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000d6f0: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-0000d700: 7469 6f6e 2865 2920 6672 6f6d 2065 0a0a  tion(e) from e..
-0000d710: 2020 2020 4072 6574 7269 6572 2872 6574      @retrier(ret
-0000d720: 7269 6573 3d41 5049 5f46 4554 4348 5f4f  ries=API_FETCH_O
-0000d730: 5244 4552 5f52 4554 5259 5f43 4f55 4e54  RDER_RETRY_COUNT
-0000d740: 290a 2020 2020 6465 6620 6665 7463 685f  ).    def fetch_
-0000d750: 6f72 6465 7228 7365 6c66 2c20 6f72 6465  order(self, orde
-0000d760: 725f 6964 3a20 7374 722c 2070 6169 723a  r_id: str, pair:
-0000d770: 2073 7472 2c20 7061 7261 6d73 3a20 4469   str, params: Di
-0000d780: 6374 203d 207b 7d29 202d 3e20 4469 6374  ct = {}) -> Dict
-0000d790: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
-0000d7a0: 662e 5f63 6f6e 6669 675b 2764 7279 5f72  f._config['dry_r
-0000d7b0: 756e 275d 3a0a 2020 2020 2020 2020 2020  un']:.          
-0000d7c0: 2020 7265 7475 726e 2073 656c 662e 6665    return self.fe
-0000d7d0: 7463 685f 6472 795f 7275 6e5f 6f72 6465  tch_dry_run_orde
-0000d7e0: 7228 6f72 6465 725f 6964 290a 2020 2020  r(order_id).    
-0000d7f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000d800: 2020 2020 206f 7264 6572 203d 2073 656c       order = sel
-0000d810: 662e 5f61 7069 2e66 6574 6368 5f6f 7264  f._api.fetch_ord
-0000d820: 6572 286f 7264 6572 5f69 642c 2070 6169  er(order_id, pai
-0000d830: 722c 2070 6172 616d 733d 7061 7261 6d73  r, params=params
-0000d840: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000d850: 6c66 2e5f 6c6f 675f 6578 6368 616e 6765  lf._log_exchange
-0000d860: 5f72 6573 706f 6e73 6528 2766 6574 6368  _response('fetch
-0000d870: 5f6f 7264 6572 272c 206f 7264 6572 290a  _order', order).
-0000d880: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000d890: 7220 3d20 7365 6c66 2e5f 6f72 6465 725f  r = self._order_
-0000d8a0: 636f 6e74 7261 6374 735f 746f 5f61 6d6f  contracts_to_amo
-0000d8b0: 756e 7428 6f72 6465 7229 0a20 2020 2020  unt(order).     
-0000d8c0: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
-0000d8d0: 6465 720a 2020 2020 2020 2020 6578 6365  der.        exce
-0000d8e0: 7074 2063 6378 742e 4f72 6465 724e 6f74  pt ccxt.OrderNot
-0000d8f0: 466f 756e 6420 6173 2065 3a0a 2020 2020  Found as e:.    
-0000d900: 2020 2020 2020 2020 7261 6973 6520 5265          raise Re
-0000d910: 7472 7961 626c 654f 7264 6572 4572 726f  tryableOrderErro
-0000d920: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0000d930: 2020 2066 274f 7264 6572 206e 6f74 2066     f'Order not f
-0000d940: 6f75 6e64 2028 7061 6972 3a20 7b70 6169  ound (pair: {pai
-0000d950: 727d 2069 643a 207b 6f72 6465 725f 6964  r} id: {order_id
-0000d960: 7d29 2e20 4d65 7373 6167 653a 207b 657d  }). Message: {e}
-0000d970: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
-0000d980: 2020 6578 6365 7074 2063 6378 742e 496e    except ccxt.In
-0000d990: 7661 6c69 644f 7264 6572 2061 7320 653a  validOrder as e:
-0000d9a0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000d9b0: 7365 2049 6e76 616c 6964 4f72 6465 7245  se InvalidOrderE
-0000d9c0: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-0000d9d0: 2020 2020 2020 2020 2020 6627 5472 6965            f'Trie
-0000d9e0: 6420 746f 2067 6574 2061 6e20 696e 7661  d to get an inva
-0000d9f0: 6c69 6420 6f72 6465 7220 2870 6169 723a  lid order (pair:
-0000da00: 207b 7061 6972 7d20 6964 3a20 7b6f 7264   {pair} id: {ord
-0000da10: 6572 5f69 647d 292e 204d 6573 7361 6765  er_id}). Message
-0000da20: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
-0000da30: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0000da40: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
-0000da50: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-0000da60: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
-0000da70: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
-0000da80: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-0000da90: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
-0000daa0: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
-0000dab0: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
-0000dac0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000dad0: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
-0000dae0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000daf0: 2020 6627 436f 756c 6420 6e6f 7420 6765    f'Could not ge
-0000db00: 7420 6f72 6465 7220 6475 6520 746f 207b  t order due to {
-0000db10: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-0000db20: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-0000db30: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-0000db40: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-0000db50: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-0000db60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000db70: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-0000db80: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-0000db90: 650a 0a20 2020 2064 6566 2066 6574 6368  e..    def fetch
-0000dba0: 5f73 746f 706c 6f73 735f 6f72 6465 7228  _stoploss_order(
-0000dbb0: 7365 6c66 2c20 6f72 6465 725f 6964 3a20  self, order_id: 
-0000dbc0: 7374 722c 2070 6169 723a 2073 7472 2c20  str, pair: str, 
-0000dbd0: 7061 7261 6d73 3a20 4469 6374 203d 207b  params: Dict = {
-0000dbe0: 7d29 202d 3e20 4469 6374 3a0a 2020 2020  }) -> Dict:.    
-0000dbf0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000dc00: 6665 7463 685f 6f72 6465 7228 6f72 6465  fetch_order(orde
-0000dc10: 725f 6964 2c20 7061 6972 2c20 7061 7261  r_id, pair, para
-0000dc20: 6d73 290a 0a20 2020 2064 6566 2066 6574  ms)..    def fet
-0000dc30: 6368 5f6f 7264 6572 5f6f 725f 7374 6f70  ch_order_or_stop
-0000dc40: 6c6f 7373 5f6f 7264 6572 2873 656c 662c  loss_order(self,
-0000dc50: 206f 7264 6572 5f69 643a 2073 7472 2c20   order_id: str, 
-0000dc60: 7061 6972 3a20 7374 722c 0a20 2020 2020  pair: str,.     
-0000dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc90: 2073 746f 706c 6f73 735f 6f72 6465 723a   stoploss_order:
-0000dca0: 2062 6f6f 6c20 3d20 4661 6c73 6529 202d   bool = False) -
-0000dcb0: 3e20 4469 6374 3a0a 2020 2020 2020 2020  > Dict:.        
-0000dcc0: 2222 220a 2020 2020 2020 2020 5369 6d70  """.        Simp
-0000dcd0: 6c65 2077 7261 7070 6572 2063 616c 6c69  le wrapper calli
-0000dce0: 6e67 2065 6974 6865 7220 6665 7463 685f  ng either fetch_
-0000dcf0: 6f72 6465 7220 6f72 2066 6574 6368 5f73  order or fetch_s
-0000dd00: 746f 706c 6f73 735f 6f72 6465 7220 6465  toploss_order de
-0000dd10: 7065 6e64 696e 6720 6f6e 0a20 2020 2020  pending on.     
-0000dd20: 2020 2074 6865 2073 746f 706c 6f73 735f     the stoploss_
-0000dd30: 6f72 6465 7220 7061 7261 6d65 7465 720a  order parameter.
-0000dd40: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-0000dd50: 7264 6572 5f69 643a 204f 7264 6572 4964  rder_id: OrderId
-0000dd60: 2074 6f20 6665 7463 6820 6f72 6465 720a   to fetch order.
-0000dd70: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-0000dd80: 6169 723a 2050 6169 7220 636f 7272 6573  air: Pair corres
-0000dd90: 706f 6e64 696e 6720 746f 206f 7264 6572  ponding to order
-0000dda0: 5f69 640a 2020 2020 2020 2020 3a70 6172  _id.        :par
-0000ddb0: 616d 2073 746f 706c 6f73 735f 6f72 6465  am stoploss_orde
-0000ddc0: 723a 2049 6620 7472 7565 2c20 7573 6573  r: If true, uses
-0000ddd0: 2066 6574 6368 5f73 746f 706c 6f73 735f   fetch_stoploss_
-0000dde0: 6f72 6465 722c 206f 7468 6572 7769 7365  order, otherwise
-0000ddf0: 2066 6574 6368 5f6f 7264 6572 2e0a 2020   fetch_order..  
-0000de00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000de10: 2020 6966 2073 746f 706c 6f73 735f 6f72    if stoploss_or
-0000de20: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-0000de30: 2072 6574 7572 6e20 7365 6c66 2e66 6574   return self.fet
-0000de40: 6368 5f73 746f 706c 6f73 735f 6f72 6465  ch_stoploss_orde
-0000de50: 7228 6f72 6465 725f 6964 2c20 7061 6972  r(order_id, pair
-0000de60: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000de70: 2073 656c 662e 6665 7463 685f 6f72 6465   self.fetch_orde
-0000de80: 7228 6f72 6465 725f 6964 2c20 7061 6972  r(order_id, pair
-0000de90: 290a 0a20 2020 2064 6566 2063 6865 636b  )..    def check
-0000dea0: 5f6f 7264 6572 5f63 616e 6365 6c65 645f  _order_canceled_
-0000deb0: 656d 7074 7928 7365 6c66 2c20 6f72 6465  empty(self, orde
-0000dec0: 723a 2044 6963 7429 202d 3e20 626f 6f6c  r: Dict) -> bool
-0000ded0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000dee0: 2020 2020 2020 5665 7269 6679 2069 6620        Verify if 
-0000def0: 616e 206f 7264 6572 2068 6173 2062 6565  an order has bee
-0000df00: 6e20 6361 6e63 656c 6c65 6420 7769 7468  n cancelled with
-0000df10: 6f75 7420 6265 696e 6720 7061 7274 6961  out being partia
-0000df20: 6c6c 7920 6669 6c6c 6564 0a20 2020 2020  lly filled.     
-0000df30: 2020 203a 7061 7261 6d20 6f72 6465 723a     :param order:
-0000df40: 204f 7264 6572 2064 6963 7420 6173 2072   Order dict as r
-0000df50: 6574 7572 6e65 6420 6672 6f6d 2066 6574  eturned from fet
-0000df60: 6368 5f6f 7264 6572 2829 0a20 2020 2020  ch_order().     
-0000df70: 2020 203a 7265 7475 726e 3a20 5472 7565     :return: True
-0000df80: 2069 6620 6f72 6465 7220 6861 7320 6265   if order has be
-0000df90: 656e 2063 616e 6365 6c6c 6564 2077 6974  en cancelled wit
-0000dfa0: 686f 7574 2062 6569 6e67 2066 696c 6c65  hout being fille
-0000dfb0: 642c 2046 616c 7365 206f 7468 6572 7769  d, False otherwi
-0000dfc0: 7365 2e0a 2020 2020 2020 2020 2222 220a  se..        """.
-0000dfd0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-0000dfe0: 6f72 6465 722e 6765 7428 2773 7461 7475  order.get('statu
-0000dff0: 7327 2920 696e 204e 4f4e 5f4f 5045 4e5f  s') in NON_OPEN_
-0000e000: 4558 4348 414e 4745 5f53 5441 5445 530a  EXCHANGE_STATES.
-0000e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e020: 616e 6420 6f72 6465 722e 6765 7428 2766  and order.get('f
-0000e030: 696c 6c65 6427 2920 3d3d 2030 2e30 290a  illed') == 0.0).
-0000e040: 0a20 2020 2040 7265 7472 6965 720a 2020  .    @retrier.  
-0000e050: 2020 6465 6620 6361 6e63 656c 5f6f 7264    def cancel_ord
-0000e060: 6572 2873 656c 662c 206f 7264 6572 5f69  er(self, order_i
-0000e070: 643a 2073 7472 2c20 7061 6972 3a20 7374  d: str, pair: st
-0000e080: 722c 2070 6172 616d 733a 2044 6963 7420  r, params: Dict 
-0000e090: 3d20 7b7d 2920 2d3e 2044 6963 743a 0a20  = {}) -> Dict:. 
-0000e0a0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-0000e0b0: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
-0000e0c0: 5d3a 0a20 2020 2020 2020 2020 2020 2074  ]:.            t
-0000e0d0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000e0e0: 2020 2020 6f72 6465 7220 3d20 7365 6c66      order = self
-0000e0f0: 2e66 6574 6368 5f64 7279 5f72 756e 5f6f  .fetch_dry_run_o
-0000e100: 7264 6572 286f 7264 6572 5f69 6429 0a0a  rder(order_id)..
-0000e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e120: 6f72 6465 722e 7570 6461 7465 287b 2773  order.update({'s
-0000e130: 7461 7475 7327 3a20 2763 616e 6365 6c65  tatus': 'cancele
-0000e140: 6427 2c20 2766 696c 6c65 6427 3a20 302e  d', 'filled': 0.
-0000e150: 302c 2027 7265 6d61 696e 696e 6727 3a20  0, 'remaining': 
-0000e160: 6f72 6465 725b 2761 6d6f 756e 7427 5d7d  order['amount']}
-0000e170: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e180: 2020 7265 7475 726e 206f 7264 6572 0a20    return order. 
-0000e190: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000e1a0: 7420 496e 7661 6c69 644f 7264 6572 4578  t InvalidOrderEx
-0000e1b0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-0000e1c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000e1d0: 7b7d 0a0a 2020 2020 2020 2020 7472 793a  {}..        try:
-0000e1e0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-0000e1f0: 6572 203d 2073 656c 662e 5f61 7069 2e63  er = self._api.c
-0000e200: 616e 6365 6c5f 6f72 6465 7228 6f72 6465  ancel_order(orde
-0000e210: 725f 6964 2c20 7061 6972 2c20 7061 7261  r_id, pair, para
-0000e220: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
-0000e230: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
-0000e240: 5f65 7863 6861 6e67 655f 7265 7370 6f6e  _exchange_respon
-0000e250: 7365 2827 6361 6e63 656c 5f6f 7264 6572  se('cancel_order
-0000e260: 272c 206f 7264 6572 290a 2020 2020 2020  ', order).      
-0000e270: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
-0000e280: 6c66 2e5f 6f72 6465 725f 636f 6e74 7261  lf._order_contra
-0000e290: 6374 735f 746f 5f61 6d6f 756e 7428 6f72  cts_to_amount(or
-0000e2a0: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
-0000e2b0: 2072 6574 7572 6e20 6f72 6465 720a 2020   return order.  
-0000e2c0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000e2d0: 742e 496e 7661 6c69 644f 7264 6572 2061  t.InvalidOrder a
-0000e2e0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000e2f0: 2072 6169 7365 2049 6e76 616c 6964 4f72   raise InvalidOr
-0000e300: 6465 7245 7863 6570 7469 6f6e 280a 2020  derException(.  
-0000e310: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-0000e320: 436f 756c 6420 6e6f 7420 6361 6e63 656c  Could not cancel
-0000e330: 206f 7264 6572 2e20 4d65 7373 6167 653a   order. Message:
-0000e340: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-0000e350: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000e360: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
-0000e370: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000e380: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
-0000e390: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
-0000e3a0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0000e3b0: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
-0000e3c0: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
-0000e3d0: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
-0000e3e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000e3f0: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
-0000e400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e410: 2066 2743 6f75 6c64 206e 6f74 2063 616e   f'Could not can
-0000e420: 6365 6c20 6f72 6465 7220 6475 6520 746f  cel order due to
-0000e430: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
-0000e440: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
-0000e450: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
-0000e460: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0000e470: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
-0000e480: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000e490: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
-0000e4a0: 4578 6365 7074 696f 6e28 6529 2066 726f  Exception(e) fro
-0000e4b0: 6d20 650a 0a20 2020 2064 6566 2063 616e  m e..    def can
-0000e4c0: 6365 6c5f 7374 6f70 6c6f 7373 5f6f 7264  cel_stoploss_ord
-0000e4d0: 6572 2873 656c 662c 206f 7264 6572 5f69  er(self, order_i
-0000e4e0: 643a 2073 7472 2c20 7061 6972 3a20 7374  d: str, pair: st
-0000e4f0: 722c 2070 6172 616d 733a 2044 6963 7420  r, params: Dict 
-0000e500: 3d20 7b7d 2920 2d3e 2044 6963 743a 0a20  = {}) -> Dict:. 
-0000e510: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000e520: 6c66 2e63 616e 6365 6c5f 6f72 6465 7228  lf.cancel_order(
-0000e530: 6f72 6465 725f 6964 2c20 7061 6972 2c20  order_id, pair, 
-0000e540: 7061 7261 6d73 290a 0a20 2020 2064 6566  params)..    def
-0000e550: 2069 735f 6361 6e63 656c 5f6f 7264 6572   is_cancel_order
-0000e560: 5f72 6573 756c 745f 7375 6974 6162 6c65  _result_suitable
-0000e570: 2873 656c 662c 2063 6f72 6465 7229 202d  (self, corder) -
-0000e580: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-0000e590: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-0000e5a0: 6528 636f 7264 6572 2c20 6469 6374 293a  e(corder, dict):
-0000e5b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000e5c0: 7572 6e20 4661 6c73 650a 0a20 2020 2020  urn False..     
-0000e5d0: 2020 2072 6571 7569 7265 6420 3d20 2827     required = ('
-0000e5e0: 6665 6527 2c20 2773 7461 7475 7327 2c20  fee', 'status', 
-0000e5f0: 2761 6d6f 756e 7427 290a 2020 2020 2020  'amount').      
-0000e600: 2020 7265 7475 726e 2061 6c6c 2863 6f72    return all(cor
-0000e610: 6465 722e 6765 7428 6b2c 204e 6f6e 6529  der.get(k, None)
-0000e620: 2069 7320 6e6f 7420 4e6f 6e65 2066 6f72   is not None for
-0000e630: 206b 2069 6e20 7265 7175 6972 6564 290a   k in required).
-0000e640: 0a20 2020 2064 6566 2063 616e 6365 6c5f  .    def cancel_
-0000e650: 6f72 6465 725f 7769 7468 5f72 6573 756c  order_with_resul
-0000e660: 7428 7365 6c66 2c20 6f72 6465 725f 6964  t(self, order_id
-0000e670: 3a20 7374 722c 2070 6169 723a 2073 7472  : str, pair: str
-0000e680: 2c20 616d 6f75 6e74 3a20 666c 6f61 7429  , amount: float)
-0000e690: 202d 3e20 4469 6374 3a0a 2020 2020 2020   -> Dict:.      
-0000e6a0: 2020 2222 220a 2020 2020 2020 2020 4361    """.        Ca
-0000e6b0: 6e63 656c 206f 7264 6572 2072 6574 7572  ncel order retur
-0000e6c0: 6e69 6e67 2061 2072 6573 756c 742e 0a20  ning a result.. 
-0000e6d0: 2020 2020 2020 2043 7265 6174 6573 2061         Creates a
-0000e6e0: 2066 616b 6520 7265 7375 6c74 2069 6620   fake result if 
-0000e6f0: 6361 6e63 656c 206f 7264 6572 2072 6574  cancel order ret
-0000e700: 7572 6e73 2061 206e 6f6e 2d75 7361 626c  urns a non-usabl
-0000e710: 6520 7265 7375 6c74 0a20 2020 2020 2020  e result.       
-0000e720: 2061 6e64 2066 6574 6368 5f6f 7264 6572   and fetch_order
-0000e730: 2064 6f65 7320 6e6f 7420 776f 726b 2028   does not work (
-0000e740: 6365 7274 6169 6e20 6578 6368 616e 6765  certain exchange
-0000e750: 7320 646f 6e27 7420 7265 7475 726e 2063  s don't return c
-0000e760: 616e 6365 6c6c 6564 206f 7264 6572 7329  ancelled orders)
-0000e770: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000e780: 6f72 6465 725f 6964 3a20 4f72 6465 7269  order_id: Orderi
-0000e790: 6420 746f 2063 616e 6365 6c0a 2020 2020  d to cancel.    
-0000e7a0: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-0000e7b0: 2050 6169 7220 636f 7272 6573 706f 6e64   Pair correspond
-0000e7c0: 696e 6720 746f 206f 7264 6572 5f69 640a  ing to order_id.
-0000e7d0: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
-0000e7e0: 6d6f 756e 743a 2041 6d6f 756e 7420 746f  mount: Amount to
-0000e7f0: 2075 7365 2066 6f72 2066 616b 6520 7265   use for fake re
-0000e800: 7370 6f6e 7365 0a20 2020 2020 2020 203a  sponse.        :
-0000e810: 7265 7475 726e 3a20 5265 7375 6c74 2066  return: Result f
-0000e820: 726f 6d20 6569 7468 6572 2063 616e 6365  rom either cance
-0000e830: 6c5f 6f72 6465 7220 6966 2075 7361 626c  l_order if usabl
-0000e840: 652c 206f 7220 6665 7463 685f 6f72 6465  e, or fetch_orde
-0000e850: 720a 2020 2020 2020 2020 2222 220a 2020  r.        """.  
-0000e860: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000e870: 2020 2020 2020 2063 6f72 6465 7220 3d20         corder = 
-0000e880: 7365 6c66 2e63 616e 6365 6c5f 6f72 6465  self.cancel_orde
-0000e890: 7228 6f72 6465 725f 6964 2c20 7061 6972  r(order_id, pair
-0000e8a0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000e8b0: 2073 656c 662e 6973 5f63 616e 6365 6c5f   self.is_cancel_
-0000e8c0: 6f72 6465 725f 7265 7375 6c74 5f73 7569  order_result_sui
-0000e8d0: 7461 626c 6528 636f 7264 6572 293a 0a20  table(corder):. 
-0000e8e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e8f0: 6574 7572 6e20 636f 7264 6572 0a20 2020  eturn corder.   
-0000e900: 2020 2020 2065 7863 6570 7420 496e 7661       except Inva
-0000e910: 6c69 644f 7264 6572 4578 6365 7074 696f  lidOrderExceptio
-0000e920: 6e3a 0a20 2020 2020 2020 2020 2020 206c  n:.            l
-0000e930: 6f67 6765 722e 7761 726e 696e 6728 6622  ogger.warning(f"
-0000e940: 436f 756c 6420 6e6f 7420 6361 6e63 656c  Could not cancel
-0000e950: 206f 7264 6572 207b 6f72 6465 725f 6964   order {order_id
-0000e960: 7d20 666f 7220 7b70 6169 727d 2e22 290a  } for {pair}.").
-0000e970: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000e980: 2020 2020 2020 2020 206f 7264 6572 203d           order =
-0000e990: 2073 656c 662e 6665 7463 685f 6f72 6465   self.fetch_orde
-0000e9a0: 7228 6f72 6465 725f 6964 2c20 7061 6972  r(order_id, pair
-0000e9b0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-0000e9c0: 2049 6e76 616c 6964 4f72 6465 7245 7863   InvalidOrderExc
-0000e9d0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-0000e9e0: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
-0000e9f0: 6e67 2866 2243 6f75 6c64 206e 6f74 2066  ng(f"Could not f
-0000ea00: 6574 6368 2063 616e 6365 6c6c 6564 206f  etch cancelled o
-0000ea10: 7264 6572 207b 6f72 6465 725f 6964 7d2e  rder {order_id}.
-0000ea20: 2229 0a20 2020 2020 2020 2020 2020 206f  ").            o
-0000ea30: 7264 6572 203d 207b 0a20 2020 2020 2020  rder = {.       
-0000ea40: 2020 2020 2020 2020 2027 6964 273a 206f           'id': o
-0000ea50: 7264 6572 5f69 642c 0a20 2020 2020 2020  rder_id,.       
-0000ea60: 2020 2020 2020 2020 2027 7374 6174 7573           'status
-0000ea70: 273a 2027 6361 6e63 656c 6564 272c 0a20  ': 'canceled',. 
-0000ea80: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000ea90: 616d 6f75 6e74 273a 2061 6d6f 756e 742c  amount': amount,
-0000eaa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eab0: 2027 6669 6c6c 6564 273a 2030 2e30 2c0a   'filled': 0.0,.
-0000eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ead0: 2766 6565 273a 207b 7d2c 0a20 2020 2020  'fee': {},.     
-0000eae0: 2020 2020 2020 2020 2020 2027 696e 666f             'info
-0000eaf0: 273a 207b 7d0a 2020 2020 2020 2020 2020  ': {}.          
-0000eb00: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
-0000eb10: 7572 6e20 6f72 6465 720a 0a20 2020 2064  urn order..    d
-0000eb20: 6566 2063 616e 6365 6c5f 7374 6f70 6c6f  ef cancel_stoplo
-0000eb30: 7373 5f6f 7264 6572 5f77 6974 685f 7265  ss_order_with_re
-0000eb40: 7375 6c74 2873 656c 662c 206f 7264 6572  sult(self, order
-0000eb50: 5f69 643a 2073 7472 2c20 7061 6972 3a20  _id: str, pair: 
-0000eb60: 7374 722c 2061 6d6f 756e 743a 2066 6c6f  str, amount: flo
-0000eb70: 6174 2920 2d3e 2044 6963 743a 0a20 2020  at) -> Dict:.   
-0000eb80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000eb90: 2043 616e 6365 6c20 7374 6f70 6c6f 7373   Cancel stoploss
-0000eba0: 206f 7264 6572 2072 6574 7572 6e69 6e67   order returning
-0000ebb0: 2061 2072 6573 756c 742e 0a20 2020 2020   a result..     
-0000ebc0: 2020 2043 7265 6174 6573 2061 2066 616b     Creates a fak
-0000ebd0: 6520 7265 7375 6c74 2069 6620 6361 6e63  e result if canc
-0000ebe0: 656c 206f 7264 6572 2072 6574 7572 6e73  el order returns
-0000ebf0: 2061 206e 6f6e 2d75 7361 626c 6520 7265   a non-usable re
-0000ec00: 7375 6c74 0a20 2020 2020 2020 2061 6e64  sult.        and
-0000ec10: 2066 6574 6368 5f6f 7264 6572 2064 6f65   fetch_order doe
-0000ec20: 7320 6e6f 7420 776f 726b 2028 6365 7274  s not work (cert
-0000ec30: 6169 6e20 6578 6368 616e 6765 7320 646f  ain exchanges do
-0000ec40: 6e27 7420 7265 7475 726e 2063 616e 6365  n't return cance
-0000ec50: 6c6c 6564 206f 7264 6572 7329 0a20 2020  lled orders).   
-0000ec60: 2020 2020 203a 7061 7261 6d20 6f72 6465       :param orde
-0000ec70: 725f 6964 3a20 7374 6f70 6c6f 7373 2d6f  r_id: stoploss-o
-0000ec80: 7264 6572 2d69 6420 746f 2063 616e 6365  rder-id to cance
-0000ec90: 6c0a 2020 2020 2020 2020 3a70 6172 616d  l.        :param
-0000eca0: 2070 6169 723a 2050 6169 7220 636f 7272   pair: Pair corr
-0000ecb0: 6573 706f 6e64 696e 6720 746f 206f 7264  esponding to ord
-0000ecc0: 6572 5f69 640a 2020 2020 2020 2020 3a70  er_id.        :p
-0000ecd0: 6172 616d 2061 6d6f 756e 743a 2041 6d6f  aram amount: Amo
-0000ece0: 756e 7420 746f 2075 7365 2066 6f72 2066  unt to use for f
-0000ecf0: 616b 6520 7265 7370 6f6e 7365 0a20 2020  ake response.   
-0000ed00: 2020 2020 203a 7265 7475 726e 3a20 5265       :return: Re
-0000ed10: 7375 6c74 2066 726f 6d20 6569 7468 6572  sult from either
-0000ed20: 2063 616e 6365 6c5f 6f72 6465 7220 6966   cancel_order if
-0000ed30: 2075 7361 626c 652c 206f 7220 6665 7463   usable, or fetc
-0000ed40: 685f 6f72 6465 720a 2020 2020 2020 2020  h_order.        
-0000ed50: 2222 220a 2020 2020 2020 2020 636f 7264  """.        cord
-0000ed60: 6572 203d 2073 656c 662e 6361 6e63 656c  er = self.cancel
-0000ed70: 5f73 746f 706c 6f73 735f 6f72 6465 7228  _stoploss_order(
-0000ed80: 6f72 6465 725f 6964 2c20 7061 6972 290a  order_id, pair).
-0000ed90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000eda0: 6973 5f63 616e 6365 6c5f 6f72 6465 725f  is_cancel_order_
-0000edb0: 7265 7375 6c74 5f73 7569 7461 626c 6528  result_suitable(
-0000edc0: 636f 7264 6572 293a 0a20 2020 2020 2020  corder):.       
-0000edd0: 2020 2020 2072 6574 7572 6e20 636f 7264       return cord
-0000ede0: 6572 0a20 2020 2020 2020 2074 7279 3a0a  er.        try:.
-0000edf0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000ee00: 7220 3d20 7365 6c66 2e66 6574 6368 5f73  r = self.fetch_s
-0000ee10: 746f 706c 6f73 735f 6f72 6465 7228 6f72  toploss_order(or
-0000ee20: 6465 725f 6964 2c20 7061 6972 290a 2020  der_id, pair).  
-0000ee30: 2020 2020 2020 6578 6365 7074 2049 6e76        except Inv
-0000ee40: 616c 6964 4f72 6465 7245 7863 6570 7469  alidOrderExcepti
-0000ee50: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-0000ee60: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
-0000ee70: 2243 6f75 6c64 206e 6f74 2066 6574 6368  "Could not fetch
-0000ee80: 2063 616e 6365 6c6c 6564 2073 746f 706c   cancelled stopl
-0000ee90: 6f73 7320 6f72 6465 7220 7b6f 7264 6572  oss order {order
-0000eea0: 5f69 647d 2e22 290a 2020 2020 2020 2020  _id}.").        
-0000eeb0: 2020 2020 6f72 6465 7220 3d20 7b27 6665      order = {'fe
-0000eec0: 6527 3a20 7b7d 2c20 2773 7461 7475 7327  e': {}, 'status'
-0000eed0: 3a20 2763 616e 6365 6c65 6427 2c20 2761  : 'canceled', 'a
-0000eee0: 6d6f 756e 7427 3a20 616d 6f75 6e74 2c20  mount': amount, 
-0000eef0: 2769 6e66 6f27 3a20 7b7d 7d0a 0a20 2020  'info': {}}..   
-0000ef00: 2020 2020 2072 6574 7572 6e20 6f72 6465       return orde
-0000ef10: 720a 0a20 2020 2040 7265 7472 6965 720a  r..    @retrier.
-0000ef20: 2020 2020 6465 6620 6765 745f 6261 6c61      def get_bala
-0000ef30: 6e63 6573 2873 656c 6629 202d 3e20 6469  nces(self) -> di
-0000ef40: 6374 3a0a 0a20 2020 2020 2020 2074 7279  ct:..        try
-0000ef50: 3a0a 2020 2020 2020 2020 2020 2020 6261  :.            ba
-0000ef60: 6c61 6e63 6573 203d 2073 656c 662e 5f61  lances = self._a
-0000ef70: 7069 2e66 6574 6368 5f62 616c 616e 6365  pi.fetch_balance
-0000ef80: 2829 0a20 2020 2020 2020 2020 2020 2023  ().            #
-0000ef90: 2052 656d 6f76 6520 6164 6469 7469 6f6e   Remove addition
-0000efa0: 616c 2069 6e66 6f20 6672 6f6d 2063 6378  al info from ccx
-0000efb0: 7420 7265 7375 6c74 730a 2020 2020 2020  t results.      
-0000efc0: 2020 2020 2020 6261 6c61 6e63 6573 2e70        balances.p
-0000efd0: 6f70 2822 696e 666f 222c 204e 6f6e 6529  op("info", None)
-0000efe0: 0a20 2020 2020 2020 2020 2020 2062 616c  .            bal
-0000eff0: 616e 6365 732e 706f 7028 2266 7265 6522  ances.pop("free"
-0000f000: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-0000f010: 2020 2020 6261 6c61 6e63 6573 2e70 6f70      balances.pop
-0000f020: 2822 746f 7461 6c22 2c20 4e6f 6e65 290a  ("total", None).
-0000f030: 2020 2020 2020 2020 2020 2020 6261 6c61              bala
-0000f040: 6e63 6573 2e70 6f70 2822 7573 6564 222c  nces.pop("used",
-0000f050: 204e 6f6e 6529 0a0a 2020 2020 2020 2020   None)..        
-0000f060: 2020 2020 7265 7475 726e 2062 616c 616e      return balan
-0000f070: 6365 730a 2020 2020 2020 2020 6578 6365  ces.        exce
-0000f080: 7074 2063 6378 742e 4444 6f53 5072 6f74  pt ccxt.DDoSProt
-0000f090: 6563 7469 6f6e 2061 7320 653a 0a20 2020  ection as e:.   
-0000f0a0: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
-0000f0b0: 446f 7350 726f 7465 6374 696f 6e28 6529  DosProtection(e)
-0000f0c0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0000f0d0: 6578 6365 7074 2028 6363 7874 2e4e 6574  except (ccxt.Net
-0000f0e0: 776f 726b 4572 726f 722c 2063 6378 742e  workError, ccxt.
-0000f0f0: 4578 6368 616e 6765 4572 726f 7229 2061  ExchangeError) a
-0000f100: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000f110: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
-0000f120: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0000f130: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
-0000f140: 6f74 2067 6574 2062 616c 616e 6365 2064  ot get balance d
-0000f150: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-0000f160: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
-0000f170: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
-0000f180: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0000f190: 7074 2063 6378 742e 4261 7365 4572 726f  pt ccxt.BaseErro
-0000f1a0: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0000f1b0: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-0000f1c0: 696f 6e61 6c45 7863 6570 7469 6f6e 2865  ionalException(e
-0000f1d0: 2920 6672 6f6d 2065 0a0a 2020 2020 4072  ) from e..    @r
-0000f1e0: 6574 7269 6572 0a20 2020 2064 6566 2066  etrier.    def f
-0000f1f0: 6574 6368 5f70 6f73 6974 696f 6e73 2873  etch_positions(s
-0000f200: 656c 662c 2070 6169 723a 204f 7074 696f  elf, pair: Optio
-0000f210: 6e61 6c5b 7374 725d 203d 204e 6f6e 6529  nal[str] = None)
-0000f220: 202d 3e20 4c69 7374 5b44 6963 745d 3a0a   -> List[Dict]:.
-0000f230: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000f240: 2020 2020 4665 7463 6820 706f 7369 7469      Fetch positi
-0000f250: 6f6e 7320 6672 6f6d 2074 6865 2065 7863  ons from the exc
-0000f260: 6861 6e67 652e 0a20 2020 2020 2020 2049  hange..        I
-0000f270: 6620 6e6f 2070 6169 7220 6973 2067 6976  f no pair is giv
-0000f280: 656e 2c20 616c 6c20 706f 7369 7469 6f6e  en, all position
-0000f290: 7320 6172 6520 7265 7475 726e 6564 2e0a  s are returned..
-0000f2a0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-0000f2b0: 6169 723a 2050 6169 7220 666f 7220 7468  air: Pair for th
-0000f2c0: 6520 7175 6572 790a 2020 2020 2020 2020  e query.        
-0000f2d0: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-0000f2e0: 656c 662e 5f63 6f6e 6669 675b 2764 7279  elf._config['dry
-0000f2f0: 5f72 756e 275d 206f 7220 7365 6c66 2e74  _run'] or self.t
-0000f300: 7261 6469 6e67 5f6d 6f64 6520 213d 2054  rading_mode != T
-0000f310: 7261 6469 6e67 4d6f 6465 2e46 5554 5552  radingMode.FUTUR
-0000f320: 4553 3a0a 2020 2020 2020 2020 2020 2020  ES:.            
-0000f330: 7265 7475 726e 205b 5d0a 2020 2020 2020  return [].      
-0000f340: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000f350: 2020 2073 796d 626f 6c73 203d 205b 5d0a     symbols = [].
-0000f360: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0000f370: 6169 723a 0a20 2020 2020 2020 2020 2020  air:.           
-0000f380: 2020 2020 2073 796d 626f 6c73 2e61 7070       symbols.app
-0000f390: 656e 6428 7061 6972 290a 2020 2020 2020  end(pair).      
-0000f3a0: 2020 2020 2020 706f 7369 7469 6f6e 733a        positions:
-0000f3b0: 204c 6973 745b 4469 6374 5d20 3d20 7365   List[Dict] = se
-0000f3c0: 6c66 2e5f 6170 692e 6665 7463 685f 706f  lf._api.fetch_po
-0000f3d0: 7369 7469 6f6e 7328 7379 6d62 6f6c 7329  sitions(symbols)
-0000f3e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f3f0: 662e 5f6c 6f67 5f65 7863 6861 6e67 655f  f._log_exchange_
-0000f400: 7265 7370 6f6e 7365 2827 6665 7463 685f  response('fetch_
-0000f410: 706f 7369 7469 6f6e 7327 2c20 706f 7369  positions', posi
-0000f420: 7469 6f6e 7329 0a20 2020 2020 2020 2020  tions).         
-0000f430: 2020 2072 6574 7572 6e20 706f 7369 7469     return positi
-0000f440: 6f6e 730a 2020 2020 2020 2020 6578 6365  ons.        exce
-0000f450: 7074 2063 6378 742e 4444 6f53 5072 6f74  pt ccxt.DDoSProt
-0000f460: 6563 7469 6f6e 2061 7320 653a 0a20 2020  ection as e:.   
-0000f470: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
-0000f480: 446f 7350 726f 7465 6374 696f 6e28 6529  DosProtection(e)
-0000f490: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0000f4a0: 6578 6365 7074 2028 6363 7874 2e4e 6574  except (ccxt.Net
-0000f4b0: 776f 726b 4572 726f 722c 2063 6378 742e  workError, ccxt.
-0000f4c0: 4578 6368 616e 6765 4572 726f 7229 2061  ExchangeError) a
-0000f4d0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000f4e0: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
-0000f4f0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0000f500: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
-0000f510: 6f74 2067 6574 2070 6f73 6974 696f 6e73  ot get positions
-0000f520: 2064 7565 2074 6f20 7b65 2e5f 5f63 6c61   due to {e.__cla
-0000f530: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20  ss__.__name__}. 
-0000f540: 4d65 7373 6167 653a 207b 657d 2729 2066  Message: {e}') f
-0000f550: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
-0000f560: 6365 7074 2063 6378 742e 4261 7365 4572  cept ccxt.BaseEr
-0000f570: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
-0000f580: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
-0000f590: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
-0000f5a0: 2865 2920 6672 6f6d 2065 0a0a 2020 2020  (e) from e..    
-0000f5b0: 4072 6574 7269 6572 0a20 2020 2064 6566  @retrier.    def
-0000f5c0: 2066 6574 6368 5f74 7261 6469 6e67 5f66   fetch_trading_f
-0000f5d0: 6565 7328 7365 6c66 2920 2d3e 2044 6963  ees(self) -> Dic
-0000f5e0: 745b 7374 722c 2041 6e79 5d3a 0a20 2020  t[str, Any]:.   
-0000f5f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000f600: 2046 6574 6368 2075 7365 7220 6163 636f   Fetch user acco
-0000f610: 756e 7420 7472 6164 696e 6720 6665 6573  unt trading fees
-0000f620: 0a20 2020 2020 2020 2043 616e 2062 6520  .        Can be 
-0000f630: 6361 6368 6564 2c20 7368 6f75 6c64 206e  cached, should n
-0000f640: 6f74 2075 7064 6174 6520 6f66 7465 6e2e  ot update often.
-0000f650: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000f660: 2020 2020 2069 6620 2873 656c 662e 5f63       if (self._c
-0000f670: 6f6e 6669 675b 2764 7279 5f72 756e 275d  onfig['dry_run']
-0000f680: 206f 7220 7365 6c66 2e74 7261 6469 6e67   or self.trading
-0000f690: 5f6d 6f64 6520 213d 2054 7261 6469 6e67  _mode != Trading
-0000f6a0: 4d6f 6465 2e46 5554 5552 4553 0a20 2020  Mode.FUTURES.   
-0000f6b0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-0000f6c0: 6e6f 7420 7365 6c66 2e65 7863 6861 6e67  not self.exchang
-0000f6d0: 655f 6861 7328 2766 6574 6368 5472 6164  e_has('fetchTrad
-0000f6e0: 696e 6746 6565 7327 2929 3a0a 2020 2020  ingFees')):.    
-0000f6f0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-0000f700: 7d0a 2020 2020 2020 2020 7472 793a 0a20  }.        try:. 
-0000f710: 2020 2020 2020 2020 2020 2074 7261 6469             tradi
-0000f720: 6e67 5f66 6565 733a 2044 6963 745b 7374  ng_fees: Dict[st
-0000f730: 722c 2041 6e79 5d20 3d20 7365 6c66 2e5f  r, Any] = self._
-0000f740: 6170 692e 6665 7463 685f 7472 6164 696e  api.fetch_tradin
-0000f750: 675f 6665 6573 2829 0a20 2020 2020 2020  g_fees().       
-0000f760: 2020 2020 2073 656c 662e 5f6c 6f67 5f65       self._log_e
-0000f770: 7863 6861 6e67 655f 7265 7370 6f6e 7365  xchange_response
-0000f780: 2827 6665 7463 685f 7472 6164 696e 675f  ('fetch_trading_
-0000f790: 6665 6573 272c 2074 7261 6469 6e67 5f66  fees', trading_f
-0000f7a0: 6565 7329 0a20 2020 2020 2020 2020 2020  ees).           
-0000f7b0: 2072 6574 7572 6e20 7472 6164 696e 675f   return trading_
-0000f7c0: 6665 6573 0a20 2020 2020 2020 2065 7863  fees.        exc
-0000f7d0: 6570 7420 6363 7874 2e44 446f 5350 726f  ept ccxt.DDoSPro
-0000f7e0: 7465 6374 696f 6e20 6173 2065 3a0a 2020  tection as e:.  
-0000f7f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000f800: 4444 6f73 5072 6f74 6563 7469 6f6e 2865  DDosProtection(e
-0000f810: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-0000f820: 2065 7863 6570 7420 2863 6378 742e 4e65   except (ccxt.Ne
-0000f830: 7477 6f72 6b45 7272 6f72 2c20 6363 7874  tworkError, ccxt
-0000f840: 2e45 7863 6861 6e67 6545 7272 6f72 2920  .ExchangeError) 
-0000f850: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000f860: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
-0000f870: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
-0000f880: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
-0000f890: 6e6f 7420 6665 7463 6820 7472 6164 696e  not fetch tradin
-0000f8a0: 6720 6665 6573 2064 7565 2074 6f20 7b65  g fees due to {e
-0000f8b0: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-0000f8c0: 655f 5f7d 2e20 4d65 7373 6167 653a 207b  e__}. Message: {
-0000f8d0: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
-0000f8e0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
-0000f8f0: 4261 7365 4572 726f 7220 6173 2065 3a0a  BaseError as e:.
-0000f900: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f910: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-0000f920: 6570 7469 6f6e 2865 2920 6672 6f6d 2065  eption(e) from e
-0000f930: 0a0a 2020 2020 4072 6574 7269 6572 0a20  ..    @retrier. 
-0000f940: 2020 2064 6566 2066 6574 6368 5f62 6964     def fetch_bid
-0000f950: 735f 6173 6b73 2873 656c 662c 2073 796d  s_asks(self, sym
-0000f960: 626f 6c73 3a20 4f70 7469 6f6e 616c 5b4c  bols: Optional[L
-0000f970: 6973 745b 7374 725d 5d20 3d20 4e6f 6e65  ist[str]] = None
-0000f980: 2c20 6361 6368 6564 3a20 626f 6f6c 203d  , cached: bool =
-0000f990: 2046 616c 7365 2920 2d3e 2044 6963 743a   False) -> Dict:
-0000f9a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000f9b0: 2020 2020 203a 7061 7261 6d20 6361 6368       :param cach
-0000f9c0: 6564 3a20 416c 6c6f 7720 6361 6368 6564  ed: Allow cached
-0000f9d0: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-0000f9e0: 3a72 6574 7572 6e3a 2066 6574 6368 5f74  :return: fetch_t
-0000f9f0: 6963 6b65 7273 2072 6573 756c 740a 2020  ickers result.  
-0000fa00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000fa10: 2020 6966 206e 6f74 2073 656c 662e 6578    if not self.ex
-0000fa20: 6368 616e 6765 5f68 6173 2827 6665 7463  change_has('fetc
-0000fa30: 6842 6964 7341 736b 7327 293a 0a20 2020  hBidsAsks'):.   
-0000fa40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000fa50: 7b7d 0a20 2020 2020 2020 2069 6620 6361  {}.        if ca
-0000fa60: 6368 6564 3a0a 2020 2020 2020 2020 2020  ched:.          
-0000fa70: 2020 7769 7468 2073 656c 662e 5f63 6163    with self._cac
-0000fa80: 6865 5f6c 6f63 6b3a 0a20 2020 2020 2020  he_lock:.       
-0000fa90: 2020 2020 2020 2020 2074 6963 6b65 7273           tickers
-0000faa0: 203d 2073 656c 662e 5f66 6574 6368 5f74   = self._fetch_t
-0000fab0: 6963 6b65 7273 5f63 6163 6865 2e67 6574  ickers_cache.get
-0000fac0: 2827 6665 7463 685f 6269 6473 5f61 736b  ('fetch_bids_ask
-0000fad0: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
-0000fae0: 6966 2074 6963 6b65 7273 3a0a 2020 2020  if tickers:.    
-0000faf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000fb00: 726e 2074 6963 6b65 7273 0a20 2020 2020  rn tickers.     
-0000fb10: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000fb20: 2020 2020 7469 636b 6572 7320 3d20 7365      tickers = se
-0000fb30: 6c66 2e5f 6170 692e 6665 7463 685f 6269  lf._api.fetch_bi
-0000fb40: 6473 5f61 736b 7328 7379 6d62 6f6c 7329  ds_asks(symbols)
-0000fb50: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0000fb60: 6820 7365 6c66 2e5f 6361 6368 655f 6c6f  h self._cache_lo
-0000fb70: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
-0000fb80: 2020 2020 7365 6c66 2e5f 6665 7463 685f      self._fetch_
-0000fb90: 7469 636b 6572 735f 6361 6368 655b 2766  tickers_cache['f
-0000fba0: 6574 6368 5f62 6964 735f 6173 6b73 275d  etch_bids_asks']
-0000fbb0: 203d 2074 6963 6b65 7273 0a20 2020 2020   = tickers.     
-0000fbc0: 2020 2020 2020 2072 6574 7572 6e20 7469         return ti
-0000fbd0: 636b 6572 730a 2020 2020 2020 2020 6578  ckers.        ex
-0000fbe0: 6365 7074 2063 6378 742e 4e6f 7453 7570  cept ccxt.NotSup
-0000fbf0: 706f 7274 6564 2061 7320 653a 0a20 2020  ported as e:.   
-0000fc00: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-0000fc10: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-0000fc20: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0000fc30: 2020 2020 2066 2745 7863 6861 6e67 6520       f'Exchange 
-0000fc40: 7b73 656c 662e 5f61 7069 2e6e 616d 657d  {self._api.name}
-0000fc50: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
-0000fc60: 7420 6665 7463 6869 6e67 2062 6964 732f  t fetching bids/
-0000fc70: 6173 6b73 2069 6e20 6261 7463 682e 2027  asks in batch. '
-0000fc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fc90: 2066 274d 6573 7361 6765 3a20 7b65 7d27   f'Message: {e}'
-0000fca0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-0000fcb0: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
-0000fcc0: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
-0000fcd0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000fce0: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
-0000fcf0: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
-0000fd00: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
-0000fd10: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
-0000fd20: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
-0000fd30: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
-0000fd40: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
-0000fd50: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
-0000fd60: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
-0000fd70: 756c 6420 6e6f 7420 6c6f 6164 2062 6964  uld not load bid
-0000fd80: 732f 6173 6b73 2064 7565 2074 6f20 7b65  s/asks due to {e
-0000fd90: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-0000fda0: 655f 5f7d 2e20 4d65 7373 6167 653a 207b  e__}. Message: {
-0000fdb0: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
-0000fdc0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
-0000fdd0: 4261 7365 4572 726f 7220 6173 2065 3a0a  BaseError as e:.
-0000fde0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000fdf0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-0000fe00: 6570 7469 6f6e 2865 2920 6672 6f6d 2065  eption(e) from e
-0000fe10: 0a0a 2020 2020 4072 6574 7269 6572 0a20  ..    @retrier. 
-0000fe20: 2020 2064 6566 2067 6574 5f74 6963 6b65     def get_ticke
-0000fe30: 7273 2873 656c 662c 2073 796d 626f 6c73  rs(self, symbols
-0000fe40: 3a20 4f70 7469 6f6e 616c 5b4c 6973 745b  : Optional[List[
-0000fe50: 7374 725d 5d20 3d20 4e6f 6e65 2c20 6361  str]] = None, ca
-0000fe60: 6368 6564 3a20 626f 6f6c 203d 2046 616c  ched: bool = Fal
-0000fe70: 7365 2920 2d3e 2054 6963 6b65 7273 3a0a  se) -> Tickers:.
-0000fe80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000fe90: 2020 2020 3a70 6172 616d 2063 6163 6865      :param cache
-0000fea0: 643a 2041 6c6c 6f77 2063 6163 6865 6420  d: Allow cached 
-0000feb0: 7265 7375 6c74 0a20 2020 2020 2020 203a  result.        :
-0000fec0: 7265 7475 726e 3a20 6665 7463 685f 7469  return: fetch_ti
-0000fed0: 636b 6572 7320 7265 7375 6c74 0a20 2020  ckers result.   
-0000fee0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000fef0: 2074 6963 6b65 7273 3a20 5469 636b 6572   tickers: Ticker
-0000ff00: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-0000ff10: 2073 656c 662e 6578 6368 616e 6765 5f68   self.exchange_h
-0000ff20: 6173 2827 6665 7463 6854 6963 6b65 7273  as('fetchTickers
-0000ff30: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-0000ff40: 7265 7475 726e 207b 7d0a 2020 2020 2020  return {}.      
-0000ff50: 2020 6966 2063 6163 6865 643a 0a20 2020    if cached:.   
-0000ff60: 2020 2020 2020 2020 2077 6974 6820 7365           with se
-0000ff70: 6c66 2e5f 6361 6368 655f 6c6f 636b 3a0a  lf._cache_lock:.
-0000ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff90: 7469 636b 6572 7320 3d20 7365 6c66 2e5f  tickers = self._
-0000ffa0: 6665 7463 685f 7469 636b 6572 735f 6361  fetch_tickers_ca
-0000ffb0: 6368 652e 6765 7428 2766 6574 6368 5f74  che.get('fetch_t
-0000ffc0: 6963 6b65 7273 2729 2020 2320 7479 7065  ickers')  # type
-0000ffd0: 3a20 6967 6e6f 7265 0a20 2020 2020 2020  : ignore.       
-0000ffe0: 2020 2020 2069 6620 7469 636b 6572 733a       if tickers:
-0000fff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010000: 2072 6574 7572 6e20 7469 636b 6572 730a   return tickers.
-00010010: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00010020: 2020 2020 2020 2020 2074 6963 6b65 7273           tickers
-00010030: 203d 2073 656c 662e 5f61 7069 2e66 6574   = self._api.fet
-00010040: 6368 5f74 6963 6b65 7273 2873 796d 626f  ch_tickers(symbo
-00010050: 6c73 290a 2020 2020 2020 2020 2020 2020  ls).            
-00010060: 7769 7468 2073 656c 662e 5f63 6163 6865  with self._cache
-00010070: 5f6c 6f63 6b3a 0a20 2020 2020 2020 2020  _lock:.         
-00010080: 2020 2020 2020 2073 656c 662e 5f66 6574         self._fet
-00010090: 6368 5f74 6963 6b65 7273 5f63 6163 6865  ch_tickers_cache
-000100a0: 5b27 6665 7463 685f 7469 636b 6572 7327  ['fetch_tickers'
-000100b0: 5d20 3d20 7469 636b 6572 730a 2020 2020  ] = tickers.    
-000100c0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-000100d0: 6963 6b65 7273 0a20 2020 2020 2020 2065  ickers.        e
-000100e0: 7863 6570 7420 6363 7874 2e4e 6f74 5375  xcept ccxt.NotSu
-000100f0: 7070 6f72 7465 6420 6173 2065 3a0a 2020  pported as e:.  
-00010100: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00010110: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00010120: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00010130: 2020 2020 2020 6627 4578 6368 616e 6765        f'Exchange
-00010140: 207b 7365 6c66 2e5f 6170 692e 6e61 6d65   {self._api.name
-00010150: 7d20 646f 6573 206e 6f74 2073 7570 706f  } does not suppo
-00010160: 7274 2066 6574 6368 696e 6720 7469 636b  rt fetching tick
-00010170: 6572 7320 696e 2062 6174 6368 2e20 270a  ers in batch. '.
-00010180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010190: 6627 4d65 7373 6167 653a 207b 657d 2729  f'Message: {e}')
-000101a0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-000101b0: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
-000101c0: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
-000101d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000101e0: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
-000101f0: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
-00010200: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
-00010210: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
-00010220: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
-00010230: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-00010240: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
-00010250: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
-00010260: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
-00010270: 6c64 206e 6f74 206c 6f61 6420 7469 636b  ld not load tick
-00010280: 6572 7320 6475 6520 746f 207b 652e 5f5f  ers due to {e.__
-00010290: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-000102a0: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
-000102b0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-000102c0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-000102d0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-000102e0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-000102f0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-00010300: 696f 6e28 6529 2066 726f 6d20 650a 0a20  ion(e) from e.. 
-00010310: 2020 2023 2050 7269 6369 6e67 2069 6e66     # Pricing inf
-00010320: 6f0a 0a20 2020 2040 7265 7472 6965 720a  o..    @retrier.
-00010330: 2020 2020 6465 6620 6665 7463 685f 7469      def fetch_ti
-00010340: 636b 6572 2873 656c 662c 2070 6169 723a  cker(self, pair:
-00010350: 2073 7472 2920 2d3e 2054 6963 6b65 723a   str) -> Ticker:
-00010360: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00010370: 2020 2020 2020 2020 2020 6966 2028 7061            if (pa
-00010380: 6972 206e 6f74 2069 6e20 7365 6c66 2e6d  ir not in self.m
-00010390: 6172 6b65 7473 206f 720a 2020 2020 2020  arkets or.      
-000103a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000103b0: 6c66 2e6d 6172 6b65 7473 5b70 6169 725d  lf.markets[pair]
-000103c0: 2e67 6574 2827 6163 7469 7665 272c 2046  .get('active', F
-000103d0: 616c 7365 2920 6973 2046 616c 7365 293a  alse) is False):
-000103e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000103f0: 2072 6169 7365 2045 7863 6861 6e67 6545   raise ExchangeE
-00010400: 7272 6f72 2866 2250 6169 7220 7b70 6169  rror(f"Pair {pai
-00010410: 727d 206e 6f74 2061 7661 696c 6162 6c65  r} not available
-00010420: 2229 0a20 2020 2020 2020 2020 2020 2064  ").            d
-00010430: 6174 613a 2054 6963 6b65 7220 3d20 7365  ata: Ticker = se
-00010440: 6c66 2e5f 6170 692e 6665 7463 685f 7469  lf._api.fetch_ti
-00010450: 636b 6572 2870 6169 7229 0a20 2020 2020  cker(pair).     
-00010460: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-00010470: 7461 0a20 2020 2020 2020 2065 7863 6570  ta.        excep
-00010480: 7420 6363 7874 2e44 446f 5350 726f 7465  t ccxt.DDoSProte
-00010490: 6374 696f 6e20 6173 2065 3a0a 2020 2020  ction as e:.    
-000104a0: 2020 2020 2020 2020 7261 6973 6520 4444          raise DD
-000104b0: 6f73 5072 6f74 6563 7469 6f6e 2865 2920  osProtection(e) 
-000104c0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-000104d0: 7863 6570 7420 2863 6378 742e 4e65 7477  xcept (ccxt.Netw
-000104e0: 6f72 6b45 7272 6f72 2c20 6363 7874 2e45  orkError, ccxt.E
-000104f0: 7863 6861 6e67 6545 7272 6f72 2920 6173  xchangeError) as
-00010500: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-00010510: 7261 6973 6520 5465 6d70 6f72 6172 7945  raise TemporaryE
-00010520: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00010530: 2020 2020 2020 6627 436f 756c 6420 6e6f        f'Could no
-00010540: 7420 6c6f 6164 2074 6963 6b65 7220 6475  t load ticker du
-00010550: 6520 746f 207b 652e 5f5f 636c 6173 735f  e to {e.__class_
-00010560: 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d 6573  _.__name__}. Mes
-00010570: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
-00010580: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00010590: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
-000105a0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000105b0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-000105c0: 6f6e 616c 4578 6365 7074 696f 6e28 6529  onalException(e)
-000105d0: 2066 726f 6d20 650a 0a20 2020 2040 7374   from e..    @st
-000105e0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-000105f0: 6566 2067 6574 5f6e 6578 745f 6c69 6d69  ef get_next_limi
-00010600: 745f 696e 5f6c 6973 7428 6c69 6d69 743a  t_in_list(limit:
-00010610: 2069 6e74 2c20 6c69 6d69 745f 7261 6e67   int, limit_rang
-00010620: 653a 204f 7074 696f 6e61 6c5b 4c69 7374  e: Optional[List
-00010630: 5b69 6e74 5d5d 2c0a 2020 2020 2020 2020  [int]],.        
-00010640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010650: 2020 2020 2020 2072 616e 6765 5f72 6571         range_req
-00010660: 7569 7265 643a 2062 6f6f 6c20 3d20 5472  uired: bool = Tr
-00010670: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-00010680: 0a20 2020 2020 2020 2047 6574 206e 6578  .        Get nex
-00010690: 7420 6772 6561 7465 7220 7661 6c75 6520  t greater value 
-000106a0: 696e 2074 6865 206c 6973 742e 0a20 2020  in the list..   
-000106b0: 2020 2020 2055 7365 6420 6279 2066 6574       Used by fet
-000106c0: 6368 5f6c 325f 6f72 6465 725f 626f 6f6b  ch_l2_order_book
-000106d0: 2069 6620 7468 6520 6170 6920 6f6e 6c79   if the api only
-000106e0: 2073 7570 706f 7274 7320 6120 6c69 6d69   supports a limi
-000106f0: 7465 6420 7261 6e67 650a 2020 2020 2020  ted range.      
-00010700: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00010710: 206e 6f74 206c 696d 6974 5f72 616e 6765   not limit_range
-00010720: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00010730: 7475 726e 206c 696d 6974 0a0a 2020 2020  turn limit..    
-00010740: 2020 2020 7265 7375 6c74 203d 206d 696e      result = min
-00010750: 285b 7820 666f 7220 7820 696e 206c 696d  ([x for x in lim
-00010760: 6974 5f72 616e 6765 2069 6620 6c69 6d69  it_range if limi
-00010770: 7420 3c3d 2078 5d20 2b20 5b6d 6178 286c  t <= x] + [max(l
-00010780: 696d 6974 5f72 616e 6765 295d 290a 2020  imit_range)]).  
-00010790: 2020 2020 2020 6966 206e 6f74 2072 616e        if not ran
-000107a0: 6765 5f72 6571 7569 7265 6420 616e 6420  ge_required and 
-000107b0: 6c69 6d69 7420 3e20 7265 7375 6c74 3a0a  limit > result:.
-000107c0: 2020 2020 2020 2020 2020 2020 2320 5261              # Ra
-000107d0: 6e67 6520 6973 206e 6f74 2072 6571 7569  nge is not requi
-000107e0: 7265 6420 2d20 7765 2063 616e 2075 7365  red - we can use
-000107f0: 204e 6f6e 6520 6173 2070 6172 616d 6574   None as paramet
-00010800: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
-00010810: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
-00010820: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-00010830: 740a 0a20 2020 2040 7265 7472 6965 720a  t..    @retrier.
-00010840: 2020 2020 6465 6620 6665 7463 685f 6c32      def fetch_l2
-00010850: 5f6f 7264 6572 5f62 6f6f 6b28 7365 6c66  _order_book(self
-00010860: 2c20 7061 6972 3a20 7374 722c 206c 696d  , pair: str, lim
-00010870: 6974 3a20 696e 7420 3d20 3130 3029 202d  it: int = 100) -
-00010880: 3e20 4f72 6465 7242 6f6f 6b3a 0a20 2020  > OrderBook:.   
-00010890: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000108a0: 2047 6574 204c 3220 6f72 6465 7220 626f   Get L2 order bo
-000108b0: 6f6b 2066 726f 6d20 6578 6368 616e 6765  ok from exchange
-000108c0: 2e0a 2020 2020 2020 2020 4361 6e20 6265  ..        Can be
-000108d0: 206c 696d 6974 6564 2074 6f20 6120 6365   limited to a ce
-000108e0: 7274 6169 6e20 616d 6f75 6e74 2028 6966  rtain amount (if
-000108f0: 2073 7570 706f 7274 6564 292e 0a20 2020   supported)..   
-00010900: 2020 2020 2052 6574 7572 6e73 2061 2064       Returns a d
-00010910: 6963 7420 696e 2074 6865 2066 6f72 6d61  ict in the forma
-00010920: 740a 2020 2020 2020 2020 7b27 6173 6b73  t.        {'asks
-00010930: 273a 205b 7072 6963 652c 2076 6f6c 756d  ': [price, volum
-00010940: 655d 2c20 2762 6964 7327 3a20 5b70 7269  e], 'bids': [pri
-00010950: 6365 2c20 766f 6c75 6d65 5d7d 0a20 2020  ce, volume]}.   
-00010960: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00010970: 206c 696d 6974 3120 3d20 7365 6c66 2e67   limit1 = self.g
-00010980: 6574 5f6e 6578 745f 6c69 6d69 745f 696e  et_next_limit_in
-00010990: 5f6c 6973 7428 6c69 6d69 742c 2073 656c  _list(limit, sel
-000109a0: 662e 5f66 745f 6861 735b 276c 325f 6c69  f._ft_has['l2_li
-000109b0: 6d69 745f 7261 6e67 6527 5d2c 0a20 2020  mit_range'],.   
-000109c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109e0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000109f0: 6674 5f68 6173 5b27 6c32 5f6c 696d 6974  ft_has['l2_limit
-00010a00: 5f72 616e 6765 5f72 6571 7569 7265 6427  _range_required'
-00010a10: 5d29 0a20 2020 2020 2020 2074 7279 3a0a  ]).        try:.
-00010a20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00010a30: 7572 6e20 7365 6c66 2e5f 6170 692e 6665  urn self._api.fe
-00010a40: 7463 685f 6c32 5f6f 7264 6572 5f62 6f6f  tch_l2_order_boo
-00010a50: 6b28 7061 6972 2c20 6c69 6d69 7431 290a  k(pair, limit1).
-00010a60: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-00010a70: 6378 742e 4e6f 7453 7570 706f 7274 6564  cxt.NotSupported
-00010a80: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00010a90: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00010aa0: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
-00010ab0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00010ac0: 2745 7863 6861 6e67 6520 7b73 656c 662e  'Exchange {self.
-00010ad0: 5f61 7069 2e6e 616d 657d 2064 6f65 7320  _api.name} does 
-00010ae0: 6e6f 7420 7375 7070 6f72 7420 6665 7463  not support fetc
-00010af0: 6869 6e67 206f 7264 6572 2062 6f6f 6b2e  hing order book.
-00010b00: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00010b10: 2020 6627 4d65 7373 6167 653a 207b 657d    f'Message: {e}
-00010b20: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
-00010b30: 2020 6578 6365 7074 2063 6378 742e 4444    except ccxt.DD
-00010b40: 6f53 5072 6f74 6563 7469 6f6e 2061 7320  oSProtection as 
-00010b50: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00010b60: 6169 7365 2044 446f 7350 726f 7465 6374  aise DDosProtect
-00010b70: 696f 6e28 6529 2066 726f 6d20 650a 2020  ion(e) from e.  
-00010b80: 2020 2020 2020 6578 6365 7074 2028 6363        except (cc
-00010b90: 7874 2e4e 6574 776f 726b 4572 726f 722c  xt.NetworkError,
-00010ba0: 2063 6378 742e 4578 6368 616e 6765 4572   ccxt.ExchangeEr
-00010bb0: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
-00010bc0: 2020 2020 2020 2072 6169 7365 2054 656d         raise Tem
-00010bd0: 706f 7261 7279 4572 726f 7228 0a20 2020  poraryError(.   
-00010be0: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
-00010bf0: 6f75 6c64 206e 6f74 2067 6574 206f 7264  ould not get ord
-00010c00: 6572 2062 6f6f 6b20 6475 6520 746f 207b  er book due to {
-00010c10: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00010c20: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-00010c30: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-00010c40: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-00010c50: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-00010c60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00010c70: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-00010c80: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-00010c90: 650a 0a20 2020 2064 6566 205f 6765 745f  e..    def _get_
-00010ca0: 7072 6963 655f 7369 6465 2873 656c 662c  price_side(self,
-00010cb0: 2073 6964 653a 2073 7472 2c20 6973 5f73   side: str, is_s
-00010cc0: 686f 7274 3a20 626f 6f6c 2c20 636f 6e66  hort: bool, conf
-00010cd0: 5f73 7472 6174 6567 793a 2044 6963 7429  _strategy: Dict)
-00010ce0: 202d 3e20 4269 6441 736b 3a0a 2020 2020   -> BidAsk:.    
-00010cf0: 2020 2020 7072 6963 655f 7369 6465 203d      price_side =
-00010d00: 2063 6f6e 665f 7374 7261 7465 6779 5b27   conf_strategy['
-00010d10: 7072 6963 655f 7369 6465 275d 0a0a 2020  price_side']..  
-00010d20: 2020 2020 2020 6966 2070 7269 6365 5f73        if price_s
-00010d30: 6964 6520 696e 2028 2773 616d 6527 2c20  ide in ('same', 
-00010d40: 276f 7468 6572 2729 3a0a 2020 2020 2020  'other'):.      
-00010d50: 2020 2020 2020 7072 6963 655f 6d61 7020        price_map 
-00010d60: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00010d70: 2020 2020 2827 656e 7472 7927 2c20 276c      ('entry', 'l
-00010d80: 6f6e 6727 2c20 2773 616d 6527 293a 2027  ong', 'same'): '
-00010d90: 6269 6427 2c0a 2020 2020 2020 2020 2020  bid',.          
-00010da0: 2020 2020 2020 2827 656e 7472 7927 2c20        ('entry', 
-00010db0: 276c 6f6e 6727 2c20 276f 7468 6572 2729  'long', 'other')
-00010dc0: 3a20 2761 736b 272c 0a20 2020 2020 2020  : 'ask',.       
-00010dd0: 2020 2020 2020 2020 2028 2765 6e74 7279           ('entry
-00010de0: 272c 2027 7368 6f72 7427 2c20 2773 616d  ', 'short', 'sam
-00010df0: 6527 293a 2027 6173 6b27 2c0a 2020 2020  e'): 'ask',.    
-00010e00: 2020 2020 2020 2020 2020 2020 2827 656e              ('en
-00010e10: 7472 7927 2c20 2773 686f 7274 272c 2027  try', 'short', '
-00010e20: 6f74 6865 7227 293a 2027 6269 6427 2c0a  other'): 'bid',.
-00010e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e40: 2827 6578 6974 272c 2027 6c6f 6e67 272c  ('exit', 'long',
-00010e50: 2027 7361 6d65 2729 3a20 2761 736b 272c   'same'): 'ask',
-00010e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010e70: 2028 2765 7869 7427 2c20 276c 6f6e 6727   ('exit', 'long'
-00010e80: 2c20 276f 7468 6572 2729 3a20 2762 6964  , 'other'): 'bid
-00010e90: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00010ea0: 2020 2028 2765 7869 7427 2c20 2773 686f     ('exit', 'sho
-00010eb0: 7274 272c 2027 7361 6d65 2729 3a20 2762  rt', 'same'): 'b
-00010ec0: 6964 272c 0a20 2020 2020 2020 2020 2020  id',.           
-00010ed0: 2020 2020 2028 2765 7869 7427 2c20 2773       ('exit', 's
-00010ee0: 686f 7274 272c 2027 6f74 6865 7227 293a  hort', 'other'):
-00010ef0: 2027 6173 6b27 2c0a 2020 2020 2020 2020   'ask',.        
-00010f00: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-00010f10: 2020 7072 6963 655f 7369 6465 203d 2070    price_side = p
-00010f20: 7269 6365 5f6d 6170 5b28 7369 6465 2c20  rice_map[(side, 
-00010f30: 2773 686f 7274 2720 6966 2069 735f 7368  'short' if is_sh
-00010f40: 6f72 7420 656c 7365 2027 6c6f 6e67 272c  ort else 'long',
-00010f50: 2070 7269 6365 5f73 6964 6529 5d0a 2020   price_side)].  
-00010f60: 2020 2020 2020 7265 7475 726e 2070 7269        return pri
-00010f70: 6365 5f73 6964 650a 0a20 2020 2064 6566  ce_side..    def
-00010f80: 2067 6574 5f72 6174 6528 7365 6c66 2c20   get_rate(self, 
-00010f90: 7061 6972 3a20 7374 722c 2072 6566 7265  pair: str, refre
-00010fa0: 7368 3a20 626f 6f6c 2c0a 2020 2020 2020  sh: bool,.      
-00010fb0: 2020 2020 2020 2020 2020 2073 6964 653a             side:
-00010fc0: 2045 6e74 7279 4578 6974 2c20 6973 5f73   EntryExit, is_s
-00010fd0: 686f 7274 3a20 626f 6f6c 2c0a 2020 2020  hort: bool,.    
-00010fe0: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-00010ff0: 6572 5f62 6f6f 6b3a 204f 7074 696f 6e61  er_book: Optiona
-00011000: 6c5b 4f72 6465 7242 6f6f 6b5d 203d 204e  l[OrderBook] = N
-00011010: 6f6e 652c 2074 6963 6b65 723a 204f 7074  one, ticker: Opt
-00011020: 696f 6e61 6c5b 5469 636b 6572 5d20 3d20  ional[Ticker] = 
-00011030: 4e6f 6e65 2920 2d3e 2066 6c6f 6174 3a0a  None) -> float:.
-00011040: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00011050: 2020 2020 4361 6c63 756c 6174 6573 2062      Calculates b
-00011060: 6964 2f61 736b 2074 6172 6765 740a 2020  id/ask target.  
-00011070: 2020 2020 2020 6269 6420 7261 7465 202d        bid rate -
-00011080: 2062 6574 7765 656e 2063 7572 7265 6e74   between current
-00011090: 2061 736b 2070 7269 6365 2061 6e64 206c   ask price and l
-000110a0: 6173 7420 7072 6963 650a 2020 2020 2020  ast price.      
-000110b0: 2020 6173 6b20 7261 7465 202d 2065 6974    ask rate - eit
-000110c0: 6865 7220 7573 696e 6720 7469 636b 6572  her using ticker
-000110d0: 2062 6964 206f 7220 6669 7273 7420 6269   bid or first bi
-000110e0: 6420 6261 7365 6420 6f6e 206f 7264 6572  d based on order
-000110f0: 626f 6f6b 0a20 2020 2020 2020 206f 7220  book.        or 
-00011100: 7265 6d61 696e 2073 7461 7469 6320 696e  remain static in
-00011110: 2061 6e79 206f 7468 6572 2063 6173 6520   any other case 
-00011120: 7369 6e63 6520 6974 2773 206e 6f74 2075  since it's not u
-00011130: 7064 6174 696e 672e 0a20 2020 2020 2020  pdating..       
-00011140: 203a 7061 7261 6d20 7061 6972 3a20 5061   :param pair: Pa
-00011150: 6972 2074 6f20 6765 7420 7261 7465 2066  ir to get rate f
-00011160: 6f72 0a20 2020 2020 2020 203a 7061 7261  or.        :para
-00011170: 6d20 7265 6672 6573 683a 2061 6c6c 6f77  m refresh: allow
-00011180: 2063 6163 6865 6420 6461 7461 0a20 2020   cached data.   
-00011190: 2020 2020 203a 7061 7261 6d20 7369 6465       :param side
-000111a0: 3a20 2262 7579 2220 6f72 2022 7365 6c6c  : "buy" or "sell
-000111b0: 220a 2020 2020 2020 2020 3a72 6574 7572  ".        :retur
-000111c0: 6e3a 2066 6c6f 6174 3a20 5072 6963 650a  n: float: Price.
-000111d0: 2020 2020 2020 2020 3a72 6169 7365 7320          :raises 
-000111e0: 5072 6963 696e 6745 7272 6f72 2069 6620  PricingError if 
-000111f0: 6f72 6465 7262 6f6f 6b20 7072 6963 6520  orderbook price 
-00011200: 636f 756c 6420 6e6f 7420 6265 2064 6574  could not be det
-00011210: 6572 6d69 6e65 642e 0a20 2020 2020 2020  ermined..       
-00011220: 2022 2222 0a20 2020 2020 2020 206e 616d   """.        nam
-00011230: 6520 3d20 7369 6465 2e63 6170 6974 616c  e = side.capital
-00011240: 697a 6528 290a 2020 2020 2020 2020 7374  ize().        st
-00011250: 7261 745f 6e61 6d65 203d 2027 656e 7472  rat_name = 'entr
-00011260: 795f 7072 6963 696e 6727 2069 6620 7369  y_pricing' if si
-00011270: 6465 203d 3d20 2265 6e74 7279 2220 656c  de == "entry" el
-00011280: 7365 2027 6578 6974 5f70 7269 6369 6e67  se 'exit_pricing
-00011290: 270a 0a20 2020 2020 2020 2063 6163 6865  '..        cache
-000112a0: 5f72 6174 653a 2054 544c 4361 6368 6520  _rate: TTLCache 
-000112b0: 3d20 7365 6c66 2e5f 656e 7472 795f 7261  = self._entry_ra
-000112c0: 7465 5f63 6163 6865 2069 6620 7369 6465  te_cache if side
-000112d0: 203d 3d20 2265 6e74 7279 2220 656c 7365   == "entry" else
-000112e0: 2073 656c 662e 5f65 7869 745f 7261 7465   self._exit_rate
-000112f0: 5f63 6163 6865 0a20 2020 2020 2020 2069  _cache.        i
-00011300: 6620 6e6f 7420 7265 6672 6573 683a 0a20  f not refresh:. 
-00011310: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00011320: 7365 6c66 2e5f 6361 6368 655f 6c6f 636b  self._cache_lock
-00011330: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011340: 2020 7261 7465 203d 2063 6163 6865 5f72    rate = cache_r
-00011350: 6174 652e 6765 7428 7061 6972 290a 2020  ate.get(pair).  
-00011360: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
-00011370: 6b20 6966 2063 6163 6865 2068 6173 2062  k if cache has b
-00011380: 6565 6e20 696e 7661 6c69 6461 7465 640a  een invalidated.
-00011390: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-000113a0: 6174 653a 0a20 2020 2020 2020 2020 2020  ate:.           
-000113b0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
-000113c0: 6728 6622 5573 696e 6720 6361 6368 6564  g(f"Using cached
-000113d0: 207b 7369 6465 7d20 7261 7465 2066 6f72   {side} rate for
-000113e0: 207b 7061 6972 7d2e 2229 0a20 2020 2020   {pair}.").     
-000113f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00011400: 6e20 7261 7465 0a0a 2020 2020 2020 2020  n rate..        
-00011410: 636f 6e66 5f73 7472 6174 6567 7920 3d20  conf_strategy = 
-00011420: 7365 6c66 2e5f 636f 6e66 6967 2e67 6574  self._config.get
-00011430: 2873 7472 6174 5f6e 616d 652c 207b 7d29  (strat_name, {})
-00011440: 0a0a 2020 2020 2020 2020 7072 6963 655f  ..        price_
-00011450: 7369 6465 203d 2073 656c 662e 5f67 6574  side = self._get
-00011460: 5f70 7269 6365 5f73 6964 6528 7369 6465  _price_side(side
-00011470: 2c20 6973 5f73 686f 7274 2c20 636f 6e66  , is_short, conf
-00011480: 5f73 7472 6174 6567 7929 0a0a 2020 2020  _strategy)..    
-00011490: 2020 2020 7072 6963 655f 7369 6465 5f77      price_side_w
-000114a0: 6f72 6420 3d20 7072 6963 655f 7369 6465  ord = price_side
-000114b0: 2e63 6170 6974 616c 697a 6528 290a 0a20  .capitalize().. 
-000114c0: 2020 2020 2020 2069 6620 636f 6e66 5f73         if conf_s
-000114d0: 7472 6174 6567 792e 6765 7428 2775 7365  trategy.get('use
-000114e0: 5f6f 7264 6572 5f62 6f6f 6b27 2c20 4661  _order_book', Fa
-000114f0: 6c73 6529 3a0a 0a20 2020 2020 2020 2020  lse):..         
-00011500: 2020 206f 7264 6572 5f62 6f6f 6b5f 746f     order_book_to
-00011510: 7020 3d20 636f 6e66 5f73 7472 6174 6567  p = conf_strateg
-00011520: 792e 6765 7428 276f 7264 6572 5f62 6f6f  y.get('order_boo
-00011530: 6b5f 746f 7027 2c20 3129 0a20 2020 2020  k_top', 1).     
-00011540: 2020 2020 2020 2069 6620 6f72 6465 725f         if order_
-00011550: 626f 6f6b 2069 7320 4e6f 6e65 3a0a 2020  book is None:.  
-00011560: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00011570: 6465 725f 626f 6f6b 203d 2073 656c 662e  der_book = self.
-00011580: 6665 7463 685f 6c32 5f6f 7264 6572 5f62  fetch_l2_order_b
-00011590: 6f6f 6b28 7061 6972 2c20 6f72 6465 725f  ook(pair, order_
-000115a0: 626f 6f6b 5f74 6f70 290a 2020 2020 2020  book_top).      
-000115b0: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
-000115c0: 7567 2827 6f72 6465 725f 626f 6f6b 2025  ug('order_book %
-000115d0: 7327 2c20 6f72 6465 725f 626f 6f6b 290a  s', order_book).
-000115e0: 2020 2020 2020 2020 2020 2020 2320 746f              # to
-000115f0: 7020 3120 3d20 696e 6465 7820 300a 2020  p 1 = index 0.  
-00011600: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00011610: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00011620: 6273 6964 653a 204f 424c 6974 6572 616c  bside: OBLiteral
-00011630: 203d 2027 6269 6473 2720 6966 2070 7269   = 'bids' if pri
-00011640: 6365 5f73 6964 6520 3d3d 2027 6269 6427  ce_side == 'bid'
-00011650: 2065 6c73 6520 2761 736b 7327 0a20 2020   else 'asks'.   
-00011660: 2020 2020 2020 2020 2020 2020 2072 6174               rat
-00011670: 6520 3d20 6f72 6465 725f 626f 6f6b 5b6f  e = order_book[o
-00011680: 6273 6964 655d 5b6f 7264 6572 5f62 6f6f  bside][order_boo
-00011690: 6b5f 746f 7020 2d20 315d 5b30 5d0a 2020  k_top - 1][0].  
-000116a0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000116b0: 2028 496e 6465 7845 7272 6f72 2c20 4b65   (IndexError, Ke
-000116c0: 7945 7272 6f72 2920 6173 2065 3a0a 2020  yError) as e:.  
-000116d0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-000116e0: 6767 6572 2e77 6172 6e69 6e67 280a 2020  gger.warning(.  
-000116f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011700: 2020 6622 7b70 6169 727d 202d 207b 6e61    f"{pair} - {na
-00011710: 6d65 7d20 5072 6963 6520 6174 206c 6f63  me} Price at loc
-00011720: 6174 696f 6e20 7b6f 7264 6572 5f62 6f6f  ation {order_boo
-00011730: 6b5f 746f 707d 2066 726f 6d20 6f72 6465  k_top} from orde
-00011740: 7262 6f6f 6b20 220a 2020 2020 2020 2020  rbook ".        
-00011750: 2020 2020 2020 2020 2020 2020 6622 636f              f"co
-00011760: 756c 6420 6e6f 7420 6265 2064 6574 6572  uld not be deter
-00011770: 6d69 6e65 642e 204f 7264 6572 626f 6f6b  mined. Orderbook
-00011780: 3a20 7b6f 7264 6572 5f62 6f6f 6b7d 220a  : {order_book}".
-00011790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000117b0: 2020 7261 6973 6520 5072 6963 696e 6745    raise PricingE
-000117c0: 7272 6f72 2066 726f 6d20 650a 2020 2020  rror from e.    
-000117d0: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-000117e0: 6562 7567 2866 227b 7061 6972 7d20 2d20  ebug(f"{pair} - 
-000117f0: 7b6e 616d 657d 2070 7269 6365 2066 726f  {name} price fro
-00011800: 6d20 6f72 6465 7262 6f6f 6b20 7b70 7269  m orderbook {pri
-00011810: 6365 5f73 6964 655f 776f 7264 7d22 0a20  ce_side_word}". 
-00011820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011830: 2020 2020 2020 2020 6622 7369 6465 202d          f"side -
-00011840: 2074 6f70 207b 6f72 6465 725f 626f 6f6b   top {order_book
-00011850: 5f74 6f70 7d20 6f72 6465 7220 626f 6f6b  _top} order book
-00011860: 207b 7369 6465 7d20 7261 7465 207b 7261   {side} rate {ra
-00011870: 7465 3a2e 3866 7d22 290a 2020 2020 2020  te:.8f}").      
-00011880: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00011890: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-000118a0: 2866 2255 7369 6e67 204c 6173 7420 7b70  (f"Using Last {p
-000118b0: 7269 6365 5f73 6964 655f 776f 7264 7d20  rice_side_word} 
-000118c0: 2f20 4c61 7374 2050 7269 6365 2229 0a20  / Last Price"). 
-000118d0: 2020 2020 2020 2020 2020 2069 6620 7469             if ti
-000118e0: 636b 6572 2069 7320 4e6f 6e65 3a0a 2020  cker is None:.  
-000118f0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-00011900: 636b 6572 203d 2073 656c 662e 6665 7463  cker = self.fetc
-00011910: 685f 7469 636b 6572 2870 6169 7229 0a20  h_ticker(pair). 
-00011920: 2020 2020 2020 2020 2020 2074 6963 6b65             ticke
-00011930: 725f 7261 7465 203d 2074 6963 6b65 725b  r_rate = ticker[
-00011940: 7072 6963 655f 7369 6465 5d0a 2020 2020  price_side].    
-00011950: 2020 2020 2020 2020 6966 2074 6963 6b65          if ticke
-00011960: 725b 276c 6173 7427 5d20 616e 6420 7469  r['last'] and ti
-00011970: 636b 6572 5f72 6174 653a 0a20 2020 2020  cker_rate:.     
-00011980: 2020 2020 2020 2020 2020 2069 6620 7369             if si
-00011990: 6465 203d 3d20 2765 6e74 7279 2720 616e  de == 'entry' an
-000119a0: 6420 7469 636b 6572 5f72 6174 6520 3e20  d ticker_rate > 
-000119b0: 7469 636b 6572 5b27 6c61 7374 275d 3a0a  ticker['last']:.
-000119c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119d0: 2020 2020 6261 6c61 6e63 6520 3d20 636f      balance = co
-000119e0: 6e66 5f73 7472 6174 6567 792e 6765 7428  nf_strategy.get(
-000119f0: 2770 7269 6365 5f6c 6173 745f 6261 6c61  'price_last_bala
-00011a00: 6e63 6527 2c20 302e 3029 0a20 2020 2020  nce', 0.0).     
-00011a10: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00011a20: 6963 6b65 725f 7261 7465 203d 2074 6963  icker_rate = tic
-00011a30: 6b65 725f 7261 7465 202b 2062 616c 616e  ker_rate + balan
-00011a40: 6365 202a 2028 7469 636b 6572 5b27 6c61  ce * (ticker['la
-00011a50: 7374 275d 202d 2074 6963 6b65 725f 7261  st'] - ticker_ra
-00011a60: 7465 290a 2020 2020 2020 2020 2020 2020  te).            
-00011a70: 2020 2020 656c 6966 2073 6964 6520 3d3d      elif side ==
-00011a80: 2027 6578 6974 2720 616e 6420 7469 636b   'exit' and tick
-00011a90: 6572 5f72 6174 6520 3c20 7469 636b 6572  er_rate < ticker
-00011aa0: 5b27 6c61 7374 275d 3a0a 2020 2020 2020  ['last']:.      
-00011ab0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-00011ac0: 6c61 6e63 6520 3d20 636f 6e66 5f73 7472  lance = conf_str
-00011ad0: 6174 6567 792e 6765 7428 2770 7269 6365  ategy.get('price
-00011ae0: 5f6c 6173 745f 6261 6c61 6e63 6527 2c20  _last_balance', 
-00011af0: 302e 3029 0a20 2020 2020 2020 2020 2020  0.0).           
-00011b00: 2020 2020 2020 2020 2074 6963 6b65 725f           ticker_
-00011b10: 7261 7465 203d 2074 6963 6b65 725f 7261  rate = ticker_ra
-00011b20: 7465 202d 2062 616c 616e 6365 202a 2028  te - balance * (
-00011b30: 7469 636b 6572 5f72 6174 6520 2d20 7469  ticker_rate - ti
-00011b40: 636b 6572 5b27 6c61 7374 275d 290a 2020  cker['last']).  
-00011b50: 2020 2020 2020 2020 2020 7261 7465 203d            rate =
-00011b60: 2074 6963 6b65 725f 7261 7465 0a0a 2020   ticker_rate..  
-00011b70: 2020 2020 2020 6966 2072 6174 6520 6973        if rate is
-00011b80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00011b90: 2020 2072 6169 7365 2050 7269 6369 6e67     raise Pricing
-00011ba0: 4572 726f 7228 6622 7b6e 616d 657d 2d52  Error(f"{name}-R
-00011bb0: 6174 6520 666f 7220 7b70 6169 727d 2077  ate for {pair} w
-00011bc0: 6173 2065 6d70 7479 2e22 290a 2020 2020  as empty.").    
-00011bd0: 2020 2020 7769 7468 2073 656c 662e 5f63      with self._c
-00011be0: 6163 6865 5f6c 6f63 6b3a 0a20 2020 2020  ache_lock:.     
-00011bf0: 2020 2020 2020 2063 6163 6865 5f72 6174         cache_rat
-00011c00: 655b 7061 6972 5d20 3d20 7261 7465 0a0a  e[pair] = rate..
-00011c10: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00011c20: 6174 650a 0a20 2020 2064 6566 2067 6574  ate..    def get
-00011c30: 5f72 6174 6573 2873 656c 662c 2070 6169  _rates(self, pai
-00011c40: 723a 2073 7472 2c20 7265 6672 6573 683a  r: str, refresh:
-00011c50: 2062 6f6f 6c2c 2069 735f 7368 6f72 743a   bool, is_short:
-00011c60: 2062 6f6f 6c29 202d 3e20 5475 706c 655b   bool) -> Tuple[
-00011c70: 666c 6f61 742c 2066 6c6f 6174 5d3a 0a20  float, float]:. 
-00011c80: 2020 2020 2020 2065 6e74 7279 5f72 6174         entry_rat
-00011c90: 6520 3d20 4e6f 6e65 0a20 2020 2020 2020  e = None.       
-00011ca0: 2065 7869 745f 7261 7465 203d 204e 6f6e   exit_rate = Non
-00011cb0: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-00011cc0: 2072 6566 7265 7368 3a0a 2020 2020 2020   refresh:.      
-00011cd0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-00011ce0: 5f63 6163 6865 5f6c 6f63 6b3a 0a20 2020  _cache_lock:.   
-00011cf0: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-00011d00: 7279 5f72 6174 6520 3d20 7365 6c66 2e5f  ry_rate = self._
-00011d10: 656e 7472 795f 7261 7465 5f63 6163 6865  entry_rate_cache
-00011d20: 2e67 6574 2870 6169 7229 0a20 2020 2020  .get(pair).     
-00011d30: 2020 2020 2020 2020 2020 2065 7869 745f             exit_
-00011d40: 7261 7465 203d 2073 656c 662e 5f65 7869  rate = self._exi
-00011d50: 745f 7261 7465 5f63 6163 6865 2e67 6574  t_rate_cache.get
-00011d60: 2870 6169 7229 0a20 2020 2020 2020 2020  (pair).         
-00011d70: 2020 2069 6620 656e 7472 795f 7261 7465     if entry_rate
-00011d80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011d90: 2020 6c6f 6767 6572 2e64 6562 7567 2866    logger.debug(f
-00011da0: 2255 7369 6e67 2063 6163 6865 6420 6275  "Using cached bu
-00011db0: 7920 7261 7465 2066 6f72 207b 7061 6972  y rate for {pair
-00011dc0: 7d2e 2229 0a20 2020 2020 2020 2020 2020  }.").           
-00011dd0: 2069 6620 6578 6974 5f72 6174 653a 0a20   if exit_rate:. 
-00011de0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00011df0: 6f67 6765 722e 6465 6275 6728 6622 5573  ogger.debug(f"Us
-00011e00: 696e 6720 6361 6368 6564 2073 656c 6c20  ing cached sell 
-00011e10: 7261 7465 2066 6f72 207b 7061 6972 7d2e  rate for {pair}.
-00011e20: 2229 0a0a 2020 2020 2020 2020 656e 7472  ")..        entr
-00011e30: 795f 7072 6963 696e 6720 3d20 7365 6c66  y_pricing = self
-00011e40: 2e5f 636f 6e66 6967 2e67 6574 2827 656e  ._config.get('en
-00011e50: 7472 795f 7072 6963 696e 6727 2c20 7b7d  try_pricing', {}
-00011e60: 290a 2020 2020 2020 2020 6578 6974 5f70  ).        exit_p
-00011e70: 7269 6369 6e67 203d 2073 656c 662e 5f63  ricing = self._c
-00011e80: 6f6e 6669 672e 6765 7428 2765 7869 745f  onfig.get('exit_
-00011e90: 7072 6963 696e 6727 2c20 7b7d 290a 2020  pricing', {}).  
-00011ea0: 2020 2020 2020 6f72 6465 725f 626f 6f6b        order_book
-00011eb0: 203d 2074 6963 6b65 7220 3d20 4e6f 6e65   = ticker = None
-00011ec0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00011ed0: 656e 7472 795f 7261 7465 2061 6e64 2065  entry_rate and e
-00011ee0: 6e74 7279 5f70 7269 6369 6e67 2e67 6574  ntry_pricing.get
-00011ef0: 2827 7573 655f 6f72 6465 725f 626f 6f6b  ('use_order_book
-00011f00: 272c 2046 616c 7365 293a 0a20 2020 2020  ', False):.     
-00011f10: 2020 2020 2020 206f 7264 6572 5f62 6f6f         order_boo
-00011f20: 6b5f 746f 7020 3d20 6d61 7828 656e 7472  k_top = max(entr
-00011f30: 795f 7072 6963 696e 672e 6765 7428 276f  y_pricing.get('o
-00011f40: 7264 6572 5f62 6f6f 6b5f 746f 7027 2c20  rder_book_top', 
-00011f50: 3129 2c0a 2020 2020 2020 2020 2020 2020  1),.            
-00011f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f70: 2020 2020 2065 7869 745f 7072 6963 696e       exit_pricin
-00011f80: 672e 6765 7428 276f 7264 6572 5f62 6f6f  g.get('order_boo
-00011f90: 6b5f 746f 7027 2c20 3129 290a 2020 2020  k_top', 1)).    
-00011fa0: 2020 2020 2020 2020 6f72 6465 725f 626f          order_bo
-00011fb0: 6f6b 203d 2073 656c 662e 6665 7463 685f  ok = self.fetch_
-00011fc0: 6c32 5f6f 7264 6572 5f62 6f6f 6b28 7061  l2_order_book(pa
-00011fd0: 6972 2c20 6f72 6465 725f 626f 6f6b 5f74  ir, order_book_t
-00011fe0: 6f70 290a 2020 2020 2020 2020 2020 2020  op).            
-00011ff0: 656e 7472 795f 7261 7465 203d 2073 656c  entry_rate = sel
-00012000: 662e 6765 745f 7261 7465 2870 6169 722c  f.get_rate(pair,
-00012010: 2072 6566 7265 7368 2c20 2765 6e74 7279   refresh, 'entry
-00012020: 272c 2069 735f 7368 6f72 742c 206f 7264  ', is_short, ord
-00012030: 6572 5f62 6f6f 6b3d 6f72 6465 725f 626f  er_book=order_bo
-00012040: 6f6b 290a 2020 2020 2020 2020 656c 6966  ok).        elif
-00012050: 206e 6f74 2065 6e74 7279 5f72 6174 653a   not entry_rate:
-00012060: 0a20 2020 2020 2020 2020 2020 2074 6963  .            tic
-00012070: 6b65 7220 3d20 7365 6c66 2e66 6574 6368  ker = self.fetch
-00012080: 5f74 6963 6b65 7228 7061 6972 290a 2020  _ticker(pair).  
-00012090: 2020 2020 2020 2020 2020 656e 7472 795f            entry_
-000120a0: 7261 7465 203d 2073 656c 662e 6765 745f  rate = self.get_
-000120b0: 7261 7465 2870 6169 722c 2072 6566 7265  rate(pair, refre
-000120c0: 7368 2c20 2765 6e74 7279 272c 2069 735f  sh, 'entry', is_
-000120d0: 7368 6f72 742c 2074 6963 6b65 723d 7469  short, ticker=ti
-000120e0: 636b 6572 290a 2020 2020 2020 2020 6966  cker).        if
-000120f0: 206e 6f74 2065 7869 745f 7261 7465 3a0a   not exit_rate:.
-00012100: 2020 2020 2020 2020 2020 2020 6578 6974              exit
-00012110: 5f72 6174 6520 3d20 7365 6c66 2e67 6574  _rate = self.get
-00012120: 5f72 6174 6528 7061 6972 2c20 7265 6672  _rate(pair, refr
-00012130: 6573 682c 2027 6578 6974 272c 0a20 2020  esh, 'exit',.   
-00012140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012160: 2020 2069 735f 7368 6f72 742c 206f 7264     is_short, ord
-00012170: 6572 5f62 6f6f 6b3d 6f72 6465 725f 626f  er_book=order_bo
-00012180: 6f6b 2c20 7469 636b 6572 3d74 6963 6b65  ok, ticker=ticke
-00012190: 7229 0a20 2020 2020 2020 2072 6574 7572  r).        retur
-000121a0: 6e20 656e 7472 795f 7261 7465 2c20 6578  n entry_rate, ex
-000121b0: 6974 5f72 6174 650a 0a20 2020 2023 2046  it_rate..    # F
-000121c0: 6565 2068 616e 646c 696e 670a 0a20 2020  ee handling..   
-000121d0: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
-000121e0: 6620 6765 745f 7472 6164 6573 5f66 6f72  f get_trades_for
-000121f0: 5f6f 7264 6572 2873 656c 662c 206f 7264  _order(self, ord
-00012200: 6572 5f69 643a 2073 7472 2c20 7061 6972  er_id: str, pair
-00012210: 3a20 7374 722c 2073 696e 6365 3a20 6461  : str, since: da
-00012220: 7465 7469 6d65 2c0a 2020 2020 2020 2020  tetime,.        
-00012230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012240: 2020 2020 2070 6172 616d 733a 204f 7074       params: Opt
-00012250: 696f 6e61 6c5b 4469 6374 5d20 3d20 4e6f  ional[Dict] = No
-00012260: 6e65 2920 2d3e 204c 6973 743a 0a20 2020  ne) -> List:.   
-00012270: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00012280: 2046 6574 6368 204f 7264 6572 7320 7573   Fetch Orders us
-00012290: 696e 6720 7468 6520 2266 6574 6368 5f6d  ing the "fetch_m
-000122a0: 795f 7472 6164 6573 2220 656e 6470 6f69  y_trades" endpoi
-000122b0: 6e74 2061 6e64 2066 696c 7465 7220 7468  nt and filter th
-000122c0: 656d 2062 7920 6f72 6465 722d 6964 2e0a  em by order-id..
-000122d0: 2020 2020 2020 2020 5468 6520 2273 696e          The "sin
-000122e0: 6365 2220 6172 6775 6d65 6e74 2070 6173  ce" argument pas
-000122f0: 7365 6420 696e 2069 7320 636f 6d69 6e67  sed in is coming
-00012300: 2066 726f 6d20 7468 6520 6461 7461 6261   from the databa
-00012310: 7365 2061 6e64 2069 7320 696e 2055 5443  se and is in UTC
-00012320: 2c0a 2020 2020 2020 2020 6173 2074 696d  ,.        as tim
-00012330: 657a 6f6e 652d 6e61 7469 7665 2064 6174  ezone-native dat
-00012340: 6574 696d 6520 6f62 6a65 6374 2e0a 2020  etime object..  
-00012350: 2020 2020 2020 4672 6f6d 2074 6865 2070        From the p
-00012360: 7974 686f 6e20 646f 6375 6d65 6e74 6174  ython documentat
-00012370: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-00012380: 203e 204e 6169 7665 2064 6174 6574 696d   > Naive datetim
-00012390: 6520 696e 7374 616e 6365 7320 6172 6520  e instances are 
-000123a0: 6173 7375 6d65 6420 746f 2072 6570 7265  assumed to repre
-000123b0: 7365 6e74 206c 6f63 616c 2074 696d 650a  sent local time.
-000123c0: 2020 2020 2020 2020 5468 6572 6566 6f72          Therefor
-000123d0: 652c 2063 616c 6c69 6e67 2022 7369 6e63  e, calling "sinc
-000123e0: 652e 7469 6d65 7374 616d 7028 2922 2077  e.timestamp()" w
-000123f0: 696c 6c20 6765 7420 7468 6520 5554 4320  ill get the UTC 
-00012400: 7469 6d65 7374 616d 702c 2061 6674 6572  timestamp, after
-00012410: 2061 7070 6c79 696e 6720 7468 650a 2020   applying the.  
-00012420: 2020 2020 2020 7472 616e 7366 6f72 6d61        transforma
-00012430: 7469 6f6e 2066 726f 6d20 6c6f 6361 6c20  tion from local 
-00012440: 7469 6d65 7a6f 6e65 2074 6f20 5554 432e  timezone to UTC.
-00012450: 0a20 2020 2020 2020 2054 6869 7320 776f  .        This wo
-00012460: 726b 7320 666f 7220 7469 6d65 7a6f 6e65  rks for timezone
-00012470: 7320 5554 432b 2073 696e 6365 2074 6865  s UTC+ since the
-00012480: 6e20 7468 6520 7265 7375 6c74 2077 696c  n the result wil
-00012490: 6c20 636f 6e74 6169 6e20 7472 6164 6573  l contain trades
-000124a0: 2066 726f 6d20 6120 6665 7720 686f 7572   from a few hour
-000124b0: 730a 2020 2020 2020 2020 696e 7374 6561  s.        instea
-000124c0: 6420 6f66 2066 726f 6d20 7468 6520 6c61  d of from the la
-000124d0: 7374 2035 2073 6563 6f6e 6473 2c20 686f  st 5 seconds, ho
-000124e0: 7765 7665 7220 6661 696c 7320 666f 7220  wever fails for 
-000124f0: 5554 432d 2074 696d 657a 6f6e 6573 2c0a  UTC- timezones,.
-00012500: 2020 2020 2020 2020 7369 6e63 6520 7765          since we
-00012510: 2772 6520 7468 656e 2061 736b 696e 6720  're then asking 
-00012520: 666f 7220 7472 6164 6573 2077 6974 6820  for trades with 
-00012530: 6120 2273 696e 6365 2220 6172 6775 6d65  a "since" argume
-00012540: 6e74 2069 6e20 7468 6520 6675 7475 7265  nt in the future
-00012550: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00012560: 6d20 6f72 6465 725f 6964 206f 7264 6572  m order_id order
-00012570: 5f69 643a 204f 7264 6572 2d69 6420 6173  _id: Order-id as
-00012580: 2067 6976 656e 2077 6865 6e20 6372 6561   given when crea
-00012590: 7469 6e67 2074 6865 206f 7264 6572 0a20  ting the order. 
-000125a0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-000125b0: 6972 3a20 5061 6972 2074 6865 206f 7264  ir: Pair the ord
-000125c0: 6572 2069 7320 666f 720a 2020 2020 2020  er is for.      
-000125d0: 2020 3a70 6172 616d 2073 696e 6365 3a20    :param since: 
-000125e0: 6461 7465 7469 6d65 206f 626a 6563 7420  datetime object 
-000125f0: 6f66 2074 6865 206f 7264 6572 2063 7265  of the order cre
-00012600: 6174 696f 6e20 7469 6d65 2e20 4173 7375  ation time. Assu
-00012610: 6d65 7320 6f62 6a65 6374 2069 7320 696e  mes object is in
-00012620: 2055 5443 2e0a 2020 2020 2020 2020 2222   UTC..        ""
-00012630: 220a 2020 2020 2020 2020 6966 2073 656c  ".        if sel
-00012640: 662e 5f63 6f6e 6669 675b 2764 7279 5f72  f._config['dry_r
-00012650: 756e 275d 3a0a 2020 2020 2020 2020 2020  un']:.          
-00012660: 2020 7265 7475 726e 205b 5d0a 2020 2020    return [].    
-00012670: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00012680: 6578 6368 616e 6765 5f68 6173 2827 6665  exchange_has('fe
-00012690: 7463 684d 7954 7261 6465 7327 293a 0a20  tchMyTrades'):. 
-000126a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000126b0: 6e20 5b5d 0a20 2020 2020 2020 2074 7279  n [].        try
-000126c0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-000126d0: 416c 6c6f 7720 3573 206f 6666 7365 7420  Allow 5s offset 
-000126e0: 746f 2063 6174 6368 2073 6c69 6768 7420  to catch slight 
-000126f0: 7469 6d65 206f 6666 7365 7473 2028 6469  time offsets (di
-00012700: 7363 6f76 6572 6564 2069 6e20 2331 3138  scovered in #118
-00012710: 3529 0a20 2020 2020 2020 2020 2020 2023  5).            #
-00012720: 2073 696e 6365 206e 6565 6473 2074 6f20   since needs to 
-00012730: 6265 2069 6e74 2069 6e20 6d69 6c6c 6973  be int in millis
-00012740: 6563 6f6e 6473 0a20 2020 2020 2020 2020  econds.         
-00012750: 2020 205f 7061 7261 6d73 203d 2070 6172     _params = par
-00012760: 616d 7320 6966 2070 6172 616d 7320 656c  ams if params el
-00012770: 7365 207b 7d0a 2020 2020 2020 2020 2020  se {}.          
-00012780: 2020 6d79 5f74 7261 6465 7320 3d20 7365    my_trades = se
-00012790: 6c66 2e5f 6170 692e 6665 7463 685f 6d79  lf._api.fetch_my
-000127a0: 5f74 7261 6465 7328 0a20 2020 2020 2020  _trades(.       
-000127b0: 2020 2020 2020 2020 2070 6169 722c 2069           pair, i
-000127c0: 6e74 2828 7369 6e63 652e 7265 706c 6163  nt((since.replac
-000127d0: 6528 747a 696e 666f 3d74 696d 657a 6f6e  e(tzinfo=timezon
-000127e0: 652e 7574 6329 2e74 696d 6573 7461 6d70  e.utc).timestamp
-000127f0: 2829 202d 2035 2920 2a20 3130 3030 292c  () - 5) * 1000),
-00012800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012810: 2070 6172 616d 733d 5f70 6172 616d 7329   params=_params)
-00012820: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
-00012830: 6368 6564 5f74 7261 6465 7320 3d20 5b74  ched_trades = [t
-00012840: 7261 6465 2066 6f72 2074 7261 6465 2069  rade for trade i
-00012850: 6e20 6d79 5f74 7261 6465 7320 6966 2074  n my_trades if t
-00012860: 7261 6465 5b27 6f72 6465 7227 5d20 3d3d  rade['order'] ==
-00012870: 206f 7264 6572 5f69 645d 0a0a 2020 2020   order_id]..    
-00012880: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-00012890: 675f 6578 6368 616e 6765 5f72 6573 706f  g_exchange_respo
-000128a0: 6e73 6528 2767 6574 5f74 7261 6465 735f  nse('get_trades_
-000128b0: 666f 725f 6f72 6465 7227 2c20 6d61 7463  for_order', matc
-000128c0: 6865 645f 7472 6164 6573 290a 0a20 2020  hed_trades)..   
-000128d0: 2020 2020 2020 2020 206d 6174 6368 6564           matched
-000128e0: 5f74 7261 6465 7320 3d20 7365 6c66 2e5f  _trades = self._
-000128f0: 7472 6164 6573 5f63 6f6e 7472 6163 7473  trades_contracts
-00012900: 5f74 6f5f 616d 6f75 6e74 286d 6174 6368  _to_amount(match
-00012910: 6564 5f74 7261 6465 7329 0a0a 2020 2020  ed_trades)..    
-00012920: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00012930: 6174 6368 6564 5f74 7261 6465 730a 2020  atched_trades.  
-00012940: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-00012950: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
-00012960: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00012970: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
-00012980: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
-00012990: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-000129a0: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
-000129b0: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
-000129c0: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
-000129d0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000129e0: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
-000129f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012a00: 2066 2743 6f75 6c64 206e 6f74 2067 6574   f'Could not get
-00012a10: 2074 7261 6465 7320 6475 6520 746f 207b   trades due to {
-00012a20: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00012a30: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-00012a40: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-00012a50: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-00012a60: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-00012a70: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00012a80: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-00012a90: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-00012aa0: 650a 0a20 2020 2064 6566 2067 6574 5f6f  e..    def get_o
-00012ab0: 7264 6572 5f69 645f 636f 6e64 6974 696f  rder_id_conditio
-00012ac0: 6e61 6c28 7365 6c66 2c20 6f72 6465 723a  nal(self, order:
-00012ad0: 2044 6963 745b 7374 722c 2041 6e79 5d29   Dict[str, Any])
-00012ae0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-00012af0: 2072 6574 7572 6e20 6f72 6465 725b 2769   return order['i
-00012b00: 6427 5d0a 0a20 2020 2040 7265 7472 6965  d']..    @retrie
-00012b10: 720a 2020 2020 6465 6620 6765 745f 6665  r.    def get_fe
-00012b20: 6528 7365 6c66 2c20 7379 6d62 6f6c 3a20  e(self, symbol: 
-00012b30: 7374 722c 2074 7970 653a 2073 7472 203d  str, type: str =
-00012b40: 2027 272c 2073 6964 653a 2073 7472 203d   '', side: str =
-00012b50: 2027 272c 2061 6d6f 756e 743a 2066 6c6f   '', amount: flo
-00012b60: 6174 203d 2031 2c0a 2020 2020 2020 2020  at = 1,.        
-00012b70: 2020 2020 2020 2020 7072 6963 653a 2066          price: f
-00012b80: 6c6f 6174 203d 2031 2c20 7461 6b65 725f  loat = 1, taker_
-00012b90: 6f72 5f6d 616b 6572 3a20 4d61 6b65 7254  or_maker: MakerT
-00012ba0: 616b 6572 203d 2027 6d61 6b65 7227 2920  aker = 'maker') 
-00012bb0: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
-00012bc0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00012bd0: 7472 6965 7665 2066 6565 2066 726f 6d20  trieve fee from 
-00012be0: 6578 6368 616e 6765 0a20 2020 2020 2020  exchange.       
-00012bf0: 203a 7061 7261 6d20 7379 6d62 6f6c 3a20   :param symbol: 
-00012c00: 5061 6972 0a20 2020 2020 2020 203a 7061  Pair.        :pa
-00012c10: 7261 6d20 7479 7065 3a20 5479 7065 206f  ram type: Type o
-00012c20: 6620 6f72 6465 7220 286d 6172 6b65 742c  f order (market,
-00012c30: 206c 696d 6974 2c20 2e2e 2e29 0a20 2020   limit, ...).   
-00012c40: 2020 2020 203a 7061 7261 6d20 7369 6465       :param side
-00012c50: 3a20 5369 6465 206f 6620 6f72 6465 7220  : Side of order 
-00012c60: 2862 7579 2c20 7365 6c6c 290a 2020 2020  (buy, sell).    
-00012c70: 2020 2020 3a70 6172 616d 2061 6d6f 756e      :param amoun
-00012c80: 743a 2041 6d6f 756e 7420 6f66 206f 7264  t: Amount of ord
-00012c90: 6572 0a20 2020 2020 2020 203a 7061 7261  er.        :para
-00012ca0: 6d20 7072 6963 653a 2050 7269 6365 206f  m price: Price o
-00012cb0: 6620 6f72 6465 720a 2020 2020 2020 2020  f order.        
-00012cc0: 3a70 6172 616d 2074 616b 6572 5f6f 725f  :param taker_or_
-00012cd0: 6d61 6b65 723a 2027 6d61 6b65 7227 206f  maker: 'maker' o
-00012ce0: 7220 2774 616b 6572 2720 2869 676e 6f72  r 'taker' (ignor
-00012cf0: 6564 2069 6620 2274 7970 6522 2069 7320  ed if "type" is 
-00012d00: 7072 6f76 6964 6564 290a 2020 2020 2020  provided).      
-00012d10: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00012d20: 2074 7970 6520 616e 6420 7479 7065 203d   type and type =
-00012d30: 3d20 276d 6172 6b65 7427 3a0a 2020 2020  = 'market':.    
-00012d40: 2020 2020 2020 2020 7461 6b65 725f 6f72          taker_or
-00012d50: 5f6d 616b 6572 203d 2027 7461 6b65 7227  _maker = 'taker'
-00012d60: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00012d70: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00012d80: 662e 5f63 6f6e 6669 675b 2764 7279 5f72  f._config['dry_r
-00012d90: 756e 275d 2061 6e64 2073 656c 662e 5f63  un'] and self._c
-00012da0: 6f6e 6669 672e 6765 7428 2766 6565 272c  onfig.get('fee',
-00012db0: 204e 6f6e 6529 2069 7320 6e6f 7420 4e6f   None) is not No
-00012dc0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00012dd0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00012de0: 5f63 6f6e 6669 675b 2766 6565 275d 0a20  _config['fee']. 
-00012df0: 2020 2020 2020 2020 2020 2023 2076 616c             # val
-00012e00: 6964 6174 6520 7468 6174 206d 6172 6b65  idate that marke
-00012e10: 7473 2061 7265 206c 6f61 6465 6420 6265  ts are loaded be
-00012e20: 666f 7265 2074 7279 696e 6720 746f 2067  fore trying to g
-00012e30: 6574 2066 6565 0a20 2020 2020 2020 2020  et fee.         
-00012e40: 2020 2069 6620 7365 6c66 2e5f 6170 692e     if self._api.
-00012e50: 6d61 726b 6574 7320 6973 204e 6f6e 6520  markets is None 
-00012e60: 6f72 206c 656e 2873 656c 662e 5f61 7069  or len(self._api
-00012e70: 2e6d 6172 6b65 7473 2920 3d3d 2030 3a0a  .markets) == 0:.
-00012e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e90: 7365 6c66 2e5f 6170 692e 6c6f 6164 5f6d  self._api.load_m
-00012ea0: 6172 6b65 7473 2870 6172 616d 733d 7b7d  arkets(params={}
-00012eb0: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
-00012ec0: 6574 7572 6e20 7365 6c66 2e5f 6170 692e  eturn self._api.
-00012ed0: 6361 6c63 756c 6174 655f 6665 6528 7379  calculate_fee(sy
-00012ee0: 6d62 6f6c 3d73 796d 626f 6c2c 2074 7970  mbol=symbol, typ
-00012ef0: 653d 7479 7065 2c20 7369 6465 3d73 6964  e=type, side=sid
-00012f00: 652c 2061 6d6f 756e 743d 616d 6f75 6e74  e, amount=amount
-00012f10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00012f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f30: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00012f40: 6365 3d70 7269 6365 2c20 7461 6b65 724f  ce=price, takerO
-00012f50: 724d 616b 6572 3d74 616b 6572 5f6f 725f  rMaker=taker_or_
-00012f60: 6d61 6b65 7229 5b27 7261 7465 275d 0a20  maker)['rate']. 
-00012f70: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-00012f80: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
-00012f90: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-00012fa0: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
-00012fb0: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
-00012fc0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00012fd0: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
-00012fe0: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
-00012ff0: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
-00013000: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00013010: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
-00013020: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00013030: 2020 6627 436f 756c 6420 6e6f 7420 6765    f'Could not ge
-00013040: 7420 6665 6520 696e 666f 2064 7565 2074  t fee info due t
-00013050: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
-00013060: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
-00013070: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-00013080: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-00013090: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
-000130a0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-000130b0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-000130c0: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
-000130d0: 6f6d 2065 0a0a 2020 2020 4073 7461 7469  om e..    @stati
-000130e0: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-000130f0: 6f72 6465 725f 6861 735f 6665 6528 6f72  order_has_fee(or
-00013100: 6465 723a 2044 6963 7429 202d 3e20 626f  der: Dict) -> bo
-00013110: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
-00013120: 2020 2020 2020 2020 5665 7269 6669 6573          Verifies
-00013130: 2069 6620 7468 6520 7061 7373 6564 2069   if the passed i
-00013140: 6e20 6f72 6465 7220 6469 6374 2068 6173  n order dict has
-00013150: 2074 6865 206e 6565 6465 6420 6b65 7973   the needed keys
-00013160: 2074 6f20 6578 7472 6163 7420 6665 6573   to extract fees
-00013170: 2c0a 2020 2020 2020 2020 616e 6420 7468  ,.        and th
-00013180: 6174 2074 6865 7365 206b 6579 7320 2863  at these keys (c
-00013190: 7572 7265 6e63 792c 2063 6f73 7429 2061  urrency, cost) a
-000131a0: 7265 206e 6f74 2065 6d70 7479 2e0a 2020  re not empty..  
-000131b0: 2020 2020 2020 3a70 6172 616d 206f 7264        :param ord
-000131c0: 6572 3a20 4f72 6465 7220 6f72 2074 7261  er: Order or tra
-000131d0: 6465 2028 6f6e 6520 7472 6164 6529 2064  de (one trade) d
-000131e0: 6963 740a 2020 2020 2020 2020 3a72 6574  ict.        :ret
-000131f0: 7572 6e3a 2054 7275 6520 6966 2074 6865  urn: True if the
-00013200: 2066 6565 2073 7562 7374 7275 6374 7572   fee substructur
-00013210: 6520 636f 6e74 6169 6e73 2063 7572 7265  e contains curre
-00013220: 6e63 7920 616e 6420 636f 7374 2c20 6661  ncy and cost, fa
-00013230: 6c73 6520 6f74 6865 7277 6973 650a 2020  lse otherwise.  
-00013240: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013250: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00013260: 6e63 6528 6f72 6465 722c 2064 6963 7429  nce(order, dict)
-00013270: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00013280: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-00013290: 2020 2072 6574 7572 6e20 2827 6665 6527     return ('fee'
-000132a0: 2069 6e20 6f72 6465 7220 616e 6420 6f72   in order and or
-000132b0: 6465 725b 2766 6565 275d 2069 7320 6e6f  der['fee'] is no
-000132c0: 7420 4e6f 6e65 0a20 2020 2020 2020 2020  t None.         
-000132d0: 2020 2020 2020 2061 6e64 2028 6f72 6465         and (orde
-000132e0: 725b 2766 6565 275d 2e6b 6579 7328 2920  r['fee'].keys() 
-000132f0: 3e3d 207b 2763 7572 7265 6e63 7927 2c20  >= {'currency', 
-00013300: 2763 6f73 7427 7d29 0a20 2020 2020 2020  'cost'}).       
-00013310: 2020 2020 2020 2020 2061 6e64 206f 7264           and ord
-00013320: 6572 5b27 6665 6527 5d5b 2763 7572 7265  er['fee']['curre
-00013330: 6e63 7927 5d20 6973 206e 6f74 204e 6f6e  ncy'] is not Non
-00013340: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00013350: 2020 616e 6420 6f72 6465 725b 2766 6565    and order['fee
-00013360: 275d 5b27 636f 7374 275d 2069 7320 6e6f  ']['cost'] is no
-00013370: 7420 4e6f 6e65 0a20 2020 2020 2020 2020  t None.         
-00013380: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00013390: 6620 6361 6c63 756c 6174 655f 6665 655f  f calculate_fee_
-000133a0: 7261 7465 280a 2020 2020 2020 2020 2020  rate(.          
-000133b0: 2020 7365 6c66 2c20 6665 653a 2044 6963    self, fee: Dic
-000133c0: 742c 2073 796d 626f 6c3a 2073 7472 2c20  t, symbol: str, 
-000133d0: 636f 7374 3a20 666c 6f61 742c 2061 6d6f  cost: float, amo
-000133e0: 756e 743a 2066 6c6f 6174 2920 2d3e 204f  unt: float) -> O
-000133f0: 7074 696f 6e61 6c5b 666c 6f61 745d 3a0a  ptional[float]:.
-00013400: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013410: 2020 2020 4361 6c63 756c 6174 6520 6665      Calculate fe
-00013420: 6520 7261 7465 2069 6620 6974 2773 206e  e rate if it's n
-00013430: 6f74 2067 6976 656e 2062 7920 7468 6520  ot given by the 
-00013440: 6578 6368 616e 6765 2e0a 2020 2020 2020  exchange..      
-00013450: 2020 3a70 6172 616d 2066 6565 3a20 6363    :param fee: cc
-00013460: 7874 2046 6565 2064 6963 7420 2d20 6d75  xt Fee dict - mu
-00013470: 7374 2063 6f6e 7461 696e 2063 6f73 7420  st contain cost 
-00013480: 2f20 6375 7272 656e 6379 202f 2072 6174  / currency / rat
-00013490: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
-000134a0: 2073 796d 626f 6c3a 2053 796d 626f 6c20   symbol: Symbol 
-000134b0: 6f66 2074 6865 206f 7264 6572 0a20 2020  of the order.   
-000134c0: 2020 2020 203a 7061 7261 6d20 636f 7374       :param cost
-000134d0: 3a20 546f 7461 6c20 636f 7374 206f 6620  : Total cost of 
-000134e0: 7468 6520 6f72 6465 720a 2020 2020 2020  the order.      
-000134f0: 2020 3a70 6172 616d 2061 6d6f 756e 743a    :param amount:
-00013500: 2041 6d6f 756e 7420 6f66 2074 6865 206f   Amount of the o
-00013510: 7264 6572 0a20 2020 2020 2020 2022 2222  rder.        """
-00013520: 0a20 2020 2020 2020 2069 6620 6665 652e  .        if fee.
-00013530: 6765 7428 2772 6174 6527 2920 6973 206e  get('rate') is n
-00013540: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00013550: 2020 2020 2072 6574 7572 6e20 6665 652e       return fee.
-00013560: 6765 7428 2772 6174 6527 290a 2020 2020  get('rate').    
-00013570: 2020 2020 6665 655f 6375 7272 203d 2066      fee_curr = f
-00013580: 6565 2e67 6574 2827 6375 7272 656e 6379  ee.get('currency
-00013590: 2729 0a20 2020 2020 2020 2069 6620 6665  ').        if fe
-000135a0: 655f 6375 7272 2069 7320 4e6f 6e65 3a0a  e_curr is None:.
-000135b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000135c0: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-000135d0: 6665 655f 636f 7374 203d 2066 6c6f 6174  fee_cost = float
-000135e0: 2866 6565 5b27 636f 7374 275d 290a 2020  (fee['cost']).  
-000135f0: 2020 2020 2020 6966 2073 656c 662e 5f66        if self._f
-00013600: 745f 6861 735b 2766 6565 5f63 6f73 745f  t_has['fee_cost_
-00013610: 696e 5f63 6f6e 7472 6163 7473 275d 3a0a  in_contracts']:.
-00013620: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
-00013630: 6e76 6572 7420 636f 7374 2076 6961 2022  nvert cost via "
-00013640: 636f 6e74 7261 6374 7322 2063 6f6e 7665  contracts" conve
-00013650: 7273 696f 6e0a 2020 2020 2020 2020 2020  rsion.          
-00013660: 2020 6665 655f 636f 7374 203d 2073 656c    fee_cost = sel
-00013670: 662e 5f63 6f6e 7472 6163 7473 5f74 6f5f  f._contracts_to_
-00013680: 616d 6f75 6e74 2873 796d 626f 6c2c 2066  amount(symbol, f
-00013690: 6565 5b27 636f 7374 275d 290a 0a20 2020  ee['cost'])..   
-000136a0: 2020 2020 2023 2043 616c 6375 6c61 7465       # Calculate
-000136b0: 2066 6565 2062 6173 6564 206f 6e20 6f72   fee based on or
-000136c0: 6465 7220 6465 7461 696c 730a 2020 2020  der details.    
-000136d0: 2020 2020 6966 2066 6565 5f63 7572 7220      if fee_curr 
-000136e0: 3d3d 2073 656c 662e 6765 745f 7061 6972  == self.get_pair
-000136f0: 5f62 6173 655f 6375 7272 656e 6379 2873  _base_currency(s
-00013700: 796d 626f 6c29 3a0a 2020 2020 2020 2020  ymbol):.        
-00013710: 2020 2020 2320 4261 7365 2063 7572 7265      # Base curre
-00013720: 6e63 7920 2d20 6469 7669 6465 2062 7920  ncy - divide by 
-00013730: 616d 6f75 6e74 0a20 2020 2020 2020 2020  amount.         
-00013740: 2020 2072 6574 7572 6e20 726f 756e 6428     return round(
-00013750: 6665 655f 636f 7374 202f 2061 6d6f 756e  fee_cost / amoun
-00013760: 742c 2038 290a 2020 2020 2020 2020 656c  t, 8).        el
-00013770: 6966 2066 6565 5f63 7572 7220 3d3d 2073  if fee_curr == s
-00013780: 656c 662e 6765 745f 7061 6972 5f71 756f  elf.get_pair_quo
-00013790: 7465 5f63 7572 7265 6e63 7928 7379 6d62  te_currency(symb
-000137a0: 6f6c 293a 0a20 2020 2020 2020 2020 2020  ol):.           
-000137b0: 2023 2051 756f 7465 2063 7572 7265 6e63   # Quote currenc
-000137c0: 7920 2d20 6469 7669 6465 2062 7920 636f  y - divide by co
-000137d0: 7374 0a20 2020 2020 2020 2020 2020 2072  st.            r
-000137e0: 6574 7572 6e20 726f 756e 6428 6665 655f  eturn round(fee_
-000137f0: 636f 7374 202f 2063 6f73 742c 2038 2920  cost / cost, 8) 
-00013800: 6966 2063 6f73 7420 656c 7365 204e 6f6e  if cost else Non
-00013810: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-00013820: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-00013830: 2046 6565 2063 7572 7265 6e63 7920 6973   Fee currency is
-00013840: 2061 2064 6966 6665 7265 6e74 2063 7572   a different cur
-00013850: 7265 6e63 790a 2020 2020 2020 2020 2020  rency.          
-00013860: 2020 6966 206e 6f74 2063 6f73 743a 0a20    if not cost:. 
-00013870: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00013880: 2049 6620 636f 7374 2069 7320 4e6f 6e65   If cost is None
-00013890: 206f 7220 302e 3020 2d3e 2066 616c 7379   or 0.0 -> falsy
-000138a0: 2c20 7265 7475 726e 204e 6f6e 650a 2020  , return None.  
-000138b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000138c0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-000138d0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000138e0: 2020 2020 2020 2020 2020 2063 6f6d 6220             comb 
-000138f0: 3d20 7365 6c66 2e67 6574 5f76 616c 6964  = self.get_valid
-00013900: 5f70 6169 725f 636f 6d62 696e 6174 696f  _pair_combinatio
-00013910: 6e28 6665 655f 6375 7272 2c20 7365 6c66  n(fee_curr, self
-00013920: 2e5f 636f 6e66 6967 5b27 7374 616b 655f  ._config['stake_
-00013930: 6375 7272 656e 6379 275d 290a 2020 2020  currency']).    
-00013940: 2020 2020 2020 2020 2020 2020 7469 636b              tick
-00013950: 203d 2073 656c 662e 6665 7463 685f 7469   = self.fetch_ti
-00013960: 636b 6572 2863 6f6d 6229 0a0a 2020 2020  cker(comb)..    
-00013970: 2020 2020 2020 2020 2020 2020 6665 655f              fee_
-00013980: 746f 5f71 756f 7465 5f72 6174 6520 3d20  to_quote_rate = 
-00013990: 7361 6665 5f76 616c 7565 5f66 616c 6c62  safe_value_fallb
-000139a0: 6163 6b32 2874 6963 6b2c 2074 6963 6b2c  ack2(tick, tick,
-000139b0: 2027 6c61 7374 272c 2027 6173 6b27 290a   'last', 'ask').
-000139c0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-000139d0: 7074 2045 7863 6861 6e67 6545 7272 6f72  pt ExchangeError
-000139e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000139f0: 2020 6665 655f 746f 5f71 756f 7465 5f72    fee_to_quote_r
-00013a00: 6174 6520 3d20 7365 6c66 2e5f 636f 6e66  ate = self._conf
-00013a10: 6967 5b27 6578 6368 616e 6765 275d 2e67  ig['exchange'].g
-00013a20: 6574 2827 756e 6b6e 6f77 6e5f 6665 655f  et('unknown_fee_
-00013a30: 7261 7465 272c 204e 6f6e 6529 0a20 2020  rate', None).   
-00013a40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00013a50: 6e6f 7420 6665 655f 746f 5f71 756f 7465  not fee_to_quote
-00013a60: 5f72 6174 653a 0a20 2020 2020 2020 2020  _rate:.         
-00013a70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00013a80: 6e20 4e6f 6e65 0a20 2020 2020 2020 2020  n None.         
-00013a90: 2020 2072 6574 7572 6e20 726f 756e 6428     return round(
-00013aa0: 2866 6565 5f63 6f73 7420 2a20 6665 655f  (fee_cost * fee_
-00013ab0: 746f 5f71 756f 7465 5f72 6174 6529 202f  to_quote_rate) /
-00013ac0: 2063 6f73 742c 2038 290a 0a20 2020 2064   cost, 8)..    d
-00013ad0: 6566 2065 7874 7261 6374 5f63 6f73 745f  ef extract_cost_
-00013ae0: 6375 7272 5f72 6174 6528 7365 6c66 2c20  curr_rate(self, 
-00013af0: 6665 653a 2044 6963 742c 2073 796d 626f  fee: Dict, symbo
-00013b00: 6c3a 2073 7472 2c20 636f 7374 3a20 666c  l: str, cost: fl
-00013b10: 6f61 742c 0a20 2020 2020 2020 2020 2020  oat,.           
-00013b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b30: 2020 2020 616d 6f75 6e74 3a20 666c 6f61      amount: floa
-00013b40: 7429 202d 3e20 5475 706c 655b 666c 6f61  t) -> Tuple[floa
-00013b50: 742c 2073 7472 2c20 4f70 7469 6f6e 616c  t, str, Optional
-00013b60: 5b66 6c6f 6174 5d5d 3a0a 2020 2020 2020  [float]]:.      
-00013b70: 2020 2222 220a 2020 2020 2020 2020 4578    """.        Ex
-00013b80: 7472 6163 7420 7475 706c 6520 6f66 2063  tract tuple of c
-00013b90: 6f73 742c 2063 7572 7265 6e63 792c 2072  ost, currency, r
-00013ba0: 6174 652e 0a20 2020 2020 2020 2052 6571  ate..        Req
-00013bb0: 7569 7265 7320 6f72 6465 725f 6861 735f  uires order_has_
-00013bc0: 6665 6520 746f 2072 756e 2066 6972 7374  fee to run first
-00013bd0: 210a 2020 2020 2020 2020 3a70 6172 616d  !.        :param
-00013be0: 2066 6565 3a20 6363 7874 2046 6565 2064   fee: ccxt Fee d
-00013bf0: 6963 7420 2d20 6d75 7374 2063 6f6e 7461  ict - must conta
-00013c00: 696e 2063 6f73 7420 2f20 6375 7272 656e  in cost / curren
-00013c10: 6379 202f 2072 6174 650a 2020 2020 2020  cy / rate.      
-00013c20: 2020 3a70 6172 616d 2073 796d 626f 6c3a    :param symbol:
-00013c30: 2053 796d 626f 6c20 6f66 2074 6865 206f   Symbol of the o
-00013c40: 7264 6572 0a20 2020 2020 2020 203a 7061  rder.        :pa
-00013c50: 7261 6d20 636f 7374 3a20 546f 7461 6c20  ram cost: Total 
-00013c60: 636f 7374 206f 6620 7468 6520 6f72 6465  cost of the orde
-00013c70: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
-00013c80: 2061 6d6f 756e 743a 2041 6d6f 756e 7420   amount: Amount 
-00013c90: 6f66 2074 6865 206f 7264 6572 0a20 2020  of the order.   
-00013ca0: 2020 2020 203a 7265 7475 726e 3a20 5475       :return: Tu
-00013cb0: 706c 6520 7769 7468 2063 6f73 742c 2063  ple with cost, c
-00013cc0: 7572 7265 6e63 792c 2072 6174 6520 6f66  urrency, rate of
-00013cd0: 2074 6865 2067 6976 656e 2066 6565 2064   the given fee d
-00013ce0: 6963 740a 2020 2020 2020 2020 2222 220a  ict.        """.
-00013cf0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00013d00: 666c 6f61 7428 6665 655b 2763 6f73 7427  float(fee['cost'
-00013d10: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
-00013d20: 2020 2020 6665 655b 2763 7572 7265 6e63      fee['currenc
-00013d30: 7927 5d2c 0a20 2020 2020 2020 2020 2020  y'],.           
-00013d40: 2020 2020 2073 656c 662e 6361 6c63 756c       self.calcul
-00013d50: 6174 655f 6665 655f 7261 7465 280a 2020  ate_fee_rate(.  
-00013d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d70: 2020 6665 652c 0a20 2020 2020 2020 2020    fee,.         
-00013d80: 2020 2020 2020 2020 2020 2073 796d 626f             symbo
-00013d90: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
-00013da0: 2020 2020 2020 2063 6f73 742c 0a20 2020         cost,.   
-00013db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013dc0: 2061 6d6f 756e 740a 2020 2020 2020 2020   amount.        
-00013dd0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00013de0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00013df0: 0a20 2020 2023 2048 6973 746f 7269 6320  .    # Historic 
-00013e00: 6461 7461 0a0a 2020 2020 6465 6620 6765  data..    def ge
-00013e10: 745f 6869 7374 6f72 6963 5f6f 686c 6376  t_historic_ohlcv
-00013e20: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-00013e30: 2c20 7469 6d65 6672 616d 653a 2073 7472  , timeframe: str
-00013e40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013e50: 2020 2020 2020 2020 2020 2020 2073 696e               sin
-00013e60: 6365 5f6d 733a 2069 6e74 2c20 6361 6e64  ce_ms: int, cand
-00013e70: 6c65 5f74 7970 653a 2043 616e 646c 6554  le_type: CandleT
-00013e80: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
-00013e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ea0: 6973 5f6e 6577 5f70 6169 723a 2062 6f6f  is_new_pair: boo
-00013eb0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00013ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ed0: 2020 2020 2020 756e 7469 6c5f 6d73 3a20        until_ms: 
-00013ee0: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-00013ef0: 4e6f 6e65 2920 2d3e 204c 6973 743a 0a20  None) -> List:. 
-00013f00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013f10: 2020 2047 6574 2063 616e 646c 6520 6869     Get candle hi
-00013f20: 7374 6f72 7920 7573 696e 6720 6173 796e  story using asyn
-00013f30: 6369 6f20 616e 6420 7265 7475 726e 7320  cio and returns 
-00013f40: 7468 6520 6c69 7374 206f 6620 6361 6e64  the list of cand
-00013f50: 6c65 732e 0a20 2020 2020 2020 2048 616e  les..        Han
-00013f60: 646c 6573 2061 6c6c 2061 7379 6e63 2077  dles all async w
-00013f70: 6f72 6b20 666f 7220 7468 6973 2e0a 2020  ork for this..  
-00013f80: 2020 2020 2020 4173 796e 6320 6f76 6572        Async over
-00013f90: 206f 6e65 2070 6169 722c 2061 7373 756d   one pair, assum
-00013fa0: 696e 6720 7765 2067 6574 2060 7365 6c66  ing we get `self
-00013fb0: 2e6f 686c 6376 5f63 616e 646c 655f 6c69  .ohlcv_candle_li
-00013fc0: 6d69 7428 2960 2063 616e 646c 6573 2070  mit()` candles p
-00013fd0: 6572 2063 616c 6c2e 0a20 2020 2020 2020  er call..       
-00013fe0: 203a 7061 7261 6d20 7061 6972 3a20 5061   :param pair: Pa
-00013ff0: 6972 2074 6f20 646f 776e 6c6f 6164 0a20  ir to download. 
-00014000: 2020 2020 2020 203a 7061 7261 6d20 7469         :param ti
-00014010: 6d65 6672 616d 653a 2054 696d 6566 7261  meframe: Timefra
-00014020: 6d65 2074 6f20 6765 7420 6461 7461 2066  me to get data f
-00014030: 6f72 0a20 2020 2020 2020 203a 7061 7261  or.        :para
-00014040: 6d20 7369 6e63 655f 6d73 3a20 5469 6d65  m since_ms: Time
-00014050: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
-00014060: 636f 6e64 7320 746f 2067 6574 2068 6973  conds to get his
-00014070: 746f 7279 2066 726f 6d0a 2020 2020 2020  tory from.      
-00014080: 2020 3a70 6172 616d 2075 6e74 696c 5f6d    :param until_m
-00014090: 733a 2054 696d 6573 7461 6d70 2069 6e20  s: Timestamp in 
-000140a0: 6d69 6c6c 6973 6563 6f6e 6473 2074 6f20  milliseconds to 
-000140b0: 6765 7420 6869 7374 6f72 7920 7570 2074  get history up t
-000140c0: 6f0a 2020 2020 2020 2020 3a70 6172 616d  o.        :param
-000140d0: 2063 616e 646c 655f 7479 7065 3a20 2727   candle_type: ''
-000140e0: 2c20 6d61 726b 2c20 696e 6465 782c 2070  , mark, index, p
-000140f0: 7265 6d69 756d 496e 6465 782c 206f 7220  remiumIndex, or 
-00014100: 6675 6e64 696e 675f 7261 7465 0a20 2020  funding_rate.   
-00014110: 2020 2020 203a 7265 7475 726e 3a20 4c69       :return: Li
-00014120: 7374 2077 6974 6820 6361 6e64 6c65 2028  st with candle (
-00014130: 4f48 4c43 5629 2064 6174 610a 2020 2020  OHLCV) data.    
-00014140: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00014150: 7061 6972 2c20 5f2c 205f 2c20 6461 7461  pair, _, _, data
-00014160: 2c20 5f20 3d20 7365 6c66 2e6c 6f6f 702e  , _ = self.loop.
-00014170: 7275 6e5f 756e 7469 6c5f 636f 6d70 6c65  run_until_comple
-00014180: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
-00014190: 7365 6c66 2e5f 6173 796e 635f 6765 745f  self._async_get_
-000141a0: 6869 7374 6f72 6963 5f6f 686c 6376 2870  historic_ohlcv(p
-000141b0: 6169 723d 7061 6972 2c20 7469 6d65 6672  air=pair, timefr
-000141c0: 616d 653d 7469 6d65 6672 616d 652c 0a20  ame=timeframe,. 
-000141d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141f0: 2020 2020 2020 2020 2020 7369 6e63 655f            since_
-00014200: 6d73 3d73 696e 6365 5f6d 732c 2075 6e74  ms=since_ms, unt
-00014210: 696c 5f6d 733d 756e 7469 6c5f 6d73 2c0a  il_ms=until_ms,.
-00014220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014240: 2020 2020 2020 2020 2020 2069 735f 6e65             is_ne
-00014250: 775f 7061 6972 3d69 735f 6e65 775f 7061  w_pair=is_new_pa
-00014260: 6972 2c20 6361 6e64 6c65 5f74 7970 653d  ir, candle_type=
-00014270: 6361 6e64 6c65 5f74 7970 6529 290a 2020  candle_type)).  
-00014280: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-00014290: 6f28 6622 446f 776e 6c6f 6164 6564 2064  o(f"Downloaded d
-000142a0: 6174 6120 666f 7220 7b70 6169 727d 2077  ata for {pair} w
-000142b0: 6974 6820 6c65 6e67 7468 207b 6c65 6e28  ith length {len(
-000142c0: 6461 7461 297d 2e22 290a 2020 2020 2020  data)}.").      
-000142d0: 2020 7265 7475 726e 2064 6174 610a 0a20    return data.. 
-000142e0: 2020 2061 7379 6e63 2064 6566 205f 6173     async def _as
-000142f0: 796e 635f 6765 745f 6869 7374 6f72 6963  ync_get_historic
-00014300: 5f6f 686c 6376 2873 656c 662c 2070 6169  _ohlcv(self, pai
-00014310: 723a 2073 7472 2c20 7469 6d65 6672 616d  r: str, timefram
-00014320: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
-00014330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014350: 7369 6e63 655f 6d73 3a20 696e 742c 2063  since_ms: int, c
-00014360: 616e 646c 655f 7479 7065 3a20 4361 6e64  andle_type: Cand
-00014370: 6c65 5479 7065 2c0a 2020 2020 2020 2020  leType,.        
-00014380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143a0: 6973 5f6e 6577 5f70 6169 723a 2062 6f6f  is_new_pair: boo
-000143b0: 6c20 3d20 4661 6c73 652c 2072 6169 7365  l = False, raise
-000143c0: 5f3a 2062 6f6f 6c20 3d20 4661 6c73 652c  _: bool = False,
-000143d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000143e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143f0: 2020 2020 2020 2020 2075 6e74 696c 5f6d           until_m
-00014400: 733a 204f 7074 696f 6e61 6c5b 696e 745d  s: Optional[int]
-00014410: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00014420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014440: 2920 2d3e 204f 484c 4356 5265 7370 6f6e  ) -> OHLCVRespon
-00014450: 7365 3a0a 2020 2020 2020 2020 2222 220a  se:.        """.
-00014460: 2020 2020 2020 2020 446f 776e 6c6f 6164          Download
-00014470: 2068 6973 746f 7269 6320 6f68 6c63 760a   historic ohlcv.
-00014480: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-00014490: 735f 6e65 775f 7061 6972 3a20 7573 6564  s_new_pair: used
-000144a0: 2062 7920 6269 6e61 6e63 6520 7375 6263   by binance subc
-000144b0: 6c61 7373 2074 6f20 616c 6c6f 7720 2266  lass to allow "f
-000144c0: 6173 7422 206e 6577 2070 6169 7220 646f  ast" new pair do
-000144d0: 776e 6c6f 6164 696e 670a 2020 2020 2020  wnloading.      
-000144e0: 2020 3a70 6172 616d 2063 616e 646c 655f    :param candle_
-000144f0: 7479 7065 3a20 416e 7920 6f66 2074 6865  type: Any of the
-00014500: 2065 6e75 6d20 4361 6e64 6c65 5479 7065   enum CandleType
-00014510: 2028 6d75 7374 206d 6174 6368 2074 7261   (must match tra
-00014520: 6469 6e67 206d 6f64 6521 290a 2020 2020  ding mode!).    
-00014530: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00014540: 206f 6e65 5f63 616c 6c20 3d20 7469 6d65   one_call = time
-00014550: 6672 616d 655f 746f 5f6d 7365 6373 2874  frame_to_msecs(t
-00014560: 696d 6566 7261 6d65 2920 2a20 7365 6c66  imeframe) * self
-00014570: 2e6f 686c 6376 5f63 616e 646c 655f 6c69  .ohlcv_candle_li
-00014580: 6d69 7428 0a20 2020 2020 2020 2020 2020  mit(.           
-00014590: 2074 696d 6566 7261 6d65 2c20 6361 6e64   timeframe, cand
-000145a0: 6c65 5f74 7970 652c 2073 696e 6365 5f6d  le_type, since_m
-000145b0: 7329 0a20 2020 2020 2020 206c 6f67 6765  s).        logge
-000145c0: 722e 6465 6275 6728 0a20 2020 2020 2020  r.debug(.       
-000145d0: 2020 2020 2022 6f6e 655f 6361 6c6c 3a20       "one_call: 
-000145e0: 2573 206d 7365 6373 2028 2573 2922 2c0a  %s msecs (%s)",.
-000145f0: 2020 2020 2020 2020 2020 2020 6f6e 655f              one_
-00014600: 6361 6c6c 2c0a 2020 2020 2020 2020 2020  call,.          
-00014610: 2020 6172 726f 772e 7574 636e 6f77 2829    arrow.utcnow()
-00014620: 2e73 6869 6674 2873 6563 6f6e 6473 3d6f  .shift(seconds=o
-00014630: 6e65 5f63 616c 6c20 2f2f 2031 3030 3029  ne_call // 1000)
-00014640: 2e68 756d 616e 697a 6528 6f6e 6c79 5f64  .humanize(only_d
-00014650: 6973 7461 6e63 653d 5472 7565 290a 2020  istance=True).  
-00014660: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00014670: 696e 7075 745f 636f 726f 7574 696e 6573  input_coroutines
-00014680: 203d 205b 7365 6c66 2e5f 6173 796e 635f   = [self._async_
-00014690: 6765 745f 6361 6e64 6c65 5f68 6973 746f  get_candle_histo
-000146a0: 7279 280a 2020 2020 2020 2020 2020 2020  ry(.            
-000146b0: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
-000146c0: 2063 616e 646c 655f 7479 7065 2c20 7369   candle_type, si
-000146d0: 6e63 6529 2066 6f72 2073 696e 6365 2069  nce) for since i
-000146e0: 6e0a 2020 2020 2020 2020 2020 2020 7261  n.            ra
-000146f0: 6e67 6528 7369 6e63 655f 6d73 2c20 756e  nge(since_ms, un
-00014700: 7469 6c5f 6d73 206f 7220 2861 7272 6f77  til_ms or (arrow
-00014710: 2e75 7463 6e6f 7728 292e 696e 745f 7469  .utcnow().int_ti
-00014720: 6d65 7374 616d 7020 2a20 3130 3030 292c  mestamp * 1000),
-00014730: 206f 6e65 5f63 616c 6c29 5d0a 0a20 2020   one_call)]..   
-00014740: 2020 2020 2064 6174 613a 204c 6973 7420       data: List 
-00014750: 3d20 5b5d 0a20 2020 2020 2020 2023 2043  = [].        # C
-00014760: 6875 6e6b 2072 6571 7565 7374 7320 696e  hunk requests in
-00014770: 746f 2062 6174 6368 6573 206f 6620 3130  to batches of 10
-00014780: 3020 746f 2061 766f 6964 206f 7665 7277  0 to avoid overw
-00014790: 656c 6d69 6e67 2063 6378 7420 5468 726f  elming ccxt Thro
-000147a0: 7474 6c69 6e67 0a20 2020 2020 2020 2066  ttling.        f
-000147b0: 6f72 2069 6e70 7574 5f63 6f72 6f20 696e  or input_coro in
-000147c0: 2063 6875 6e6b 7328 696e 7075 745f 636f   chunks(input_co
-000147d0: 726f 7574 696e 6573 2c20 3130 3029 3a0a  routines, 100):.
-000147e0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000147f0: 756c 7473 203d 2061 7761 6974 2061 7379  ults = await asy
-00014800: 6e63 696f 2e67 6174 6865 7228 2a69 6e70  ncio.gather(*inp
-00014810: 7574 5f63 6f72 6f2c 2072 6574 7572 6e5f  ut_coro, return_
-00014820: 6578 6365 7074 696f 6e73 3d54 7275 6529  exceptions=True)
-00014830: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00014840: 2072 6573 2069 6e20 7265 7375 6c74 733a   res in results:
-00014850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014860: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
-00014870: 6573 2c20 4578 6365 7074 696f 6e29 3a0a  es, Exception):.
-00014880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014890: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
-000148a0: 6e67 2866 2241 7379 6e63 2063 6f64 6520  ng(f"Async code 
-000148b0: 7261 6973 6564 2061 6e20 6578 6365 7074  raised an except
-000148c0: 696f 6e3a 207b 7265 7072 2872 6573 297d  ion: {repr(res)}
-000148d0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000148e0: 2020 2020 2020 2069 6620 7261 6973 655f         if raise_
-000148f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014900: 2020 2020 2020 2020 2020 7261 6973 650a            raise.
-00014910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014920: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-00014930: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00014940: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00014950: 2020 2020 2020 2023 2044 6563 6f6e 7374         # Deconst
-00014960: 7275 6374 2074 7570 6c65 2069 6620 6974  ruct tuple if it
-00014970: 2773 206e 6f74 2061 6e20 6578 6365 7074  's not an except
-00014980: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00014990: 2020 2020 2020 2020 702c 205f 2c20 632c          p, _, c,
-000149a0: 206e 6577 5f64 6174 612c 205f 203d 2072   new_data, _ = r
-000149b0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-000149c0: 2020 2020 2020 2069 6620 7020 3d3d 2070         if p == p
-000149d0: 6169 7220 616e 6420 6320 3d3d 2063 616e  air and c == can
-000149e0: 646c 655f 7479 7065 3a0a 2020 2020 2020  dle_type:.      
-000149f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a00: 2020 6461 7461 2e65 7874 656e 6428 6e65    data.extend(ne
-00014a10: 775f 6461 7461 290a 2020 2020 2020 2020  w_data).        
-00014a20: 2320 536f 7274 2064 6174 6120 6167 6169  # Sort data agai
-00014a30: 6e20 6166 7465 7220 6578 7465 6e64 696e  n after extendin
-00014a40: 6720 7468 6520 7265 7375 6c74 202d 2061  g the result - a
-00014a50: 626f 7665 2063 616c 6c73 2072 6574 7572  bove calls retur
-00014a60: 6e20 696e 2022 6173 796e 6320 6f72 6465  n in "async orde
-00014a70: 7222 0a20 2020 2020 2020 2064 6174 6120  r".        data 
-00014a80: 3d20 736f 7274 6564 2864 6174 612c 206b  = sorted(data, k
-00014a90: 6579 3d6c 616d 6264 6120 783a 2078 5b30  ey=lambda x: x[0
-00014aa0: 5d29 0a20 2020 2020 2020 2072 6574 7572  ]).        retur
-00014ab0: 6e20 7061 6972 2c20 7469 6d65 6672 616d  n pair, timefram
-00014ac0: 652c 2063 616e 646c 655f 7479 7065 2c20  e, candle_type, 
-00014ad0: 6461 7461 2c20 7365 6c66 2e5f 6f68 6c63  data, self._ohlc
-00014ae0: 765f 7061 7274 6961 6c5f 6361 6e64 6c65  v_partial_candle
-00014af0: 0a0a 2020 2020 6465 6620 5f62 7569 6c64  ..    def _build
-00014b00: 5f63 6f72 6f75 7469 6e65 280a 2020 2020  _coroutine(.    
-00014b10: 2020 2020 2020 2020 7365 6c66 2c20 7061          self, pa
-00014b20: 6972 3a20 7374 722c 2074 696d 6566 7261  ir: str, timefra
-00014b30: 6d65 3a20 7374 722c 2063 616e 646c 655f  me: str, candle_
-00014b40: 7479 7065 3a20 4361 6e64 6c65 5479 7065  type: CandleType
-00014b50: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-00014b60: 6e63 655f 6d73 3a20 4f70 7469 6f6e 616c  nce_ms: Optional
-00014b70: 5b69 6e74 5d2c 2063 6163 6865 3a20 626f  [int], cache: bo
-00014b80: 6f6c 2920 2d3e 2043 6f72 6f75 7469 6e65  ol) -> Coroutine
-00014b90: 5b41 6e79 2c20 416e 792c 204f 484c 4356  [Any, Any, OHLCV
-00014ba0: 5265 7370 6f6e 7365 5d3a 0a20 2020 2020  Response]:.     
-00014bb0: 2020 206e 6f74 5f61 6c6c 5f64 6174 6120     not_all_data 
-00014bc0: 3d20 6361 6368 6520 616e 6420 7365 6c66  = cache and self
-00014bd0: 2e72 6571 7569 7265 645f 6361 6e64 6c65  .required_candle
-00014be0: 5f63 616c 6c5f 636f 756e 7420 3e20 310a  _call_count > 1.
-00014bf0: 2020 2020 2020 2020 6966 2063 6163 6865          if cache
-00014c00: 2061 6e64 2028 7061 6972 2c20 7469 6d65   and (pair, time
-00014c10: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
-00014c20: 7065 2920 696e 2073 656c 662e 5f6b 6c69  pe) in self._kli
-00014c30: 6e65 733a 0a20 2020 2020 2020 2020 2020  nes:.           
-00014c40: 2063 616e 646c 655f 6c69 6d69 7420 3d20   candle_limit = 
-00014c50: 7365 6c66 2e6f 686c 6376 5f63 616e 646c  self.ohlcv_candl
-00014c60: 655f 6c69 6d69 7428 7469 6d65 6672 616d  e_limit(timefram
-00014c70: 652c 2063 616e 646c 655f 7479 7065 290a  e, candle_type).
-00014c80: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-00014c90: 6461 7465 203d 2064 6174 655f 6d69 6e75  date = date_minu
-00014ca0: 735f 6361 6e64 6c65 7328 7469 6d65 6672  s_candles(timefr
-00014cb0: 616d 652c 2063 616e 646c 655f 6c69 6d69  ame, candle_limi
-00014cc0: 7420 2d20 3529 2e74 696d 6573 7461 6d70  t - 5).timestamp
-00014cd0: 2829 0a20 2020 2020 2020 2020 2020 2023  ().            #
-00014ce0: 2043 6865 636b 2069 6620 3120 6361 6c6c   Check if 1 call
-00014cf0: 2063 616e 2067 6574 2075 7320 7570 6461   can get us upda
-00014d00: 7465 6420 6361 6e64 6c65 7320 7769 7468  ted candles with
-00014d10: 6f75 7420 686f 6c65 2069 6e20 7468 6520  out hole in the 
-00014d20: 6461 7461 2e0a 2020 2020 2020 2020 2020  data..          
-00014d30: 2020 6966 206d 696e 5f64 6174 6520 3c20    if min_date < 
-00014d40: 7365 6c66 2e5f 7061 6972 735f 6c61 7374  self._pairs_last
-00014d50: 5f72 6566 7265 7368 5f74 696d 652e 6765  _refresh_time.ge
-00014d60: 7428 2870 6169 722c 2074 696d 6566 7261  t((pair, timefra
-00014d70: 6d65 2c20 6361 6e64 6c65 5f74 7970 6529  me, candle_type)
-00014d80: 2c20 3029 3a0a 2020 2020 2020 2020 2020  , 0):.          
-00014d90: 2020 2020 2020 2320 4361 6368 6520 6361        # Cache ca
-00014da0: 6e20 6265 2075 7365 6420 2d20 646f 206f  n be used - do o
-00014db0: 6e65 2d6f 6666 2063 616c 6c2e 0a20 2020  ne-off call..   
-00014dc0: 2020 2020 2020 2020 2020 2020 206e 6f74               not
-00014dd0: 5f61 6c6c 5f64 6174 6120 3d20 4661 6c73  _all_data = Fals
-00014de0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-00014df0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00014e00: 2020 2020 2320 5469 6d65 206a 756d 7020      # Time jump 
-00014e10: 6465 7465 6374 6564 2c20 6576 6963 7420  detected, evict 
-00014e20: 6361 6368 650a 2020 2020 2020 2020 2020  cache.          
-00014e30: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-00014e40: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-00014e50: 2020 2020 2020 2066 2254 696d 6520 6a75         f"Time ju
-00014e60: 6d70 2064 6574 6563 7465 642e 2045 7669  mp detected. Evi
-00014e70: 6374 696e 6720 6361 6368 6520 666f 7220  cting cache for 
-00014e80: 7b70 6169 727d 2c20 7b74 696d 6566 7261  {pair}, {timefra
-00014e90: 6d65 7d2c 207b 6361 6e64 6c65 5f74 7970  me}, {candle_typ
-00014ea0: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-00014eb0: 2020 2020 2064 656c 2073 656c 662e 5f6b       del self._k
-00014ec0: 6c69 6e65 735b 2870 6169 722c 2074 696d  lines[(pair, tim
-00014ed0: 6566 7261 6d65 2c20 6361 6e64 6c65 5f74  eframe, candle_t
-00014ee0: 7970 6529 5d0a 0a20 2020 2020 2020 2069  ype)]..        i
-00014ef0: 6620 286e 6f74 2073 696e 6365 5f6d 7320  f (not since_ms 
-00014f00: 616e 6420 2873 656c 662e 5f66 745f 6861  and (self._ft_ha
-00014f10: 735b 226f 686c 6376 5f72 6571 7569 7265  s["ohlcv_require
-00014f20: 5f73 696e 6365 225d 206f 7220 6e6f 745f  _since"] or not_
-00014f30: 616c 6c5f 6461 7461 2929 3a0a 2020 2020  all_data)):.    
-00014f40: 2020 2020 2020 2020 2320 4d75 6c74 6970          # Multip
-00014f50: 6c65 2063 616c 6c73 2066 6f72 206f 6e65  le calls for one
-00014f60: 2070 6169 7220 2d20 746f 2067 6574 206d   pair - to get m
-00014f70: 6f72 6520 6869 7374 6f72 790a 2020 2020  ore history.    
-00014f80: 2020 2020 2020 2020 6f6e 655f 6361 6c6c          one_call
-00014f90: 203d 2074 696d 6566 7261 6d65 5f74 6f5f   = timeframe_to_
-00014fa0: 6d73 6563 7328 7469 6d65 6672 616d 6529  msecs(timeframe)
-00014fb0: 202a 2073 656c 662e 6f68 6c63 765f 6361   * self.ohlcv_ca
-00014fc0: 6e64 6c65 5f6c 696d 6974 280a 2020 2020  ndle_limit(.    
-00014fd0: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-00014fe0: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
-00014ff0: 7065 2c20 7369 6e63 655f 6d73 290a 2020  pe, since_ms).  
-00015000: 2020 2020 2020 2020 2020 6d6f 7665 5f74            move_t
-00015010: 6f20 3d20 6f6e 655f 6361 6c6c 202a 2073  o = one_call * s
-00015020: 656c 662e 7265 7175 6972 6564 5f63 616e  elf.required_can
-00015030: 646c 655f 6361 6c6c 5f63 6f75 6e74 0a20  dle_call_count. 
-00015040: 2020 2020 2020 2020 2020 206e 6f77 203d             now =
-00015050: 2074 696d 6566 7261 6d65 5f74 6f5f 6e65   timeframe_to_ne
-00015060: 7874 5f64 6174 6528 7469 6d65 6672 616d  xt_date(timefram
-00015070: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-00015080: 696e 6365 5f6d 7320 3d20 696e 7428 286e  ince_ms = int((n
-00015090: 6f77 202d 2074 696d 6564 656c 7461 2873  ow - timedelta(s
-000150a0: 6563 6f6e 6473 3d6d 6f76 655f 746f 202f  econds=move_to /
-000150b0: 2f20 3130 3030 2929 2e74 696d 6573 7461  / 1000)).timesta
-000150c0: 6d70 2829 202a 2031 3030 3029 0a0a 2020  mp() * 1000)..  
-000150d0: 2020 2020 2020 6966 2073 696e 6365 5f6d        if since_m
-000150e0: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-000150f0: 6574 7572 6e20 7365 6c66 2e5f 6173 796e  eturn self._asyn
-00015100: 635f 6765 745f 6869 7374 6f72 6963 5f6f  c_get_historic_o
-00015110: 686c 6376 280a 2020 2020 2020 2020 2020  hlcv(.          
-00015120: 2020 2020 2020 7061 6972 2c20 7469 6d65        pair, time
-00015130: 6672 616d 652c 2073 696e 6365 5f6d 733d  frame, since_ms=
-00015140: 7369 6e63 655f 6d73 2c20 7261 6973 655f  since_ms, raise_
-00015150: 3d54 7275 652c 2063 616e 646c 655f 7479  =True, candle_ty
-00015160: 7065 3d63 616e 646c 655f 7479 7065 290a  pe=candle_type).
-00015170: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00015180: 2020 2020 2020 2020 2020 2320 4f6e 6520            # One 
-00015190: 6361 6c6c 202e 2e2e 2022 7265 6775 6c61  call ... "regula
-000151a0: 7222 2072 6566 7265 7368 0a20 2020 2020  r" refresh.     
-000151b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000151c0: 6c66 2e5f 6173 796e 635f 6765 745f 6361  lf._async_get_ca
-000151d0: 6e64 6c65 5f68 6973 746f 7279 280a 2020  ndle_history(.  
-000151e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-000151f0: 6972 2c20 7469 6d65 6672 616d 652c 2073  ir, timeframe, s
-00015200: 696e 6365 5f6d 733d 7369 6e63 655f 6d73  ince_ms=since_ms
-00015210: 2c20 6361 6e64 6c65 5f74 7970 653d 6361  , candle_type=ca
-00015220: 6e64 6c65 5f74 7970 6529 0a0a 2020 2020  ndle_type)..    
-00015230: 6465 6620 5f62 7569 6c64 5f6f 686c 6376  def _build_ohlcv
-00015240: 5f64 6c5f 6a6f 6273 280a 2020 2020 2020  _dl_jobs(.      
-00015250: 2020 2020 2020 7365 6c66 2c20 7061 6972        self, pair
-00015260: 5f6c 6973 743a 204c 6973 7450 6169 7273  _list: ListPairs
-00015270: 5769 7468 5469 6d65 6672 616d 6573 2c20  WithTimeframes, 
-00015280: 7369 6e63 655f 6d73 3a20 4f70 7469 6f6e  since_ms: Option
-00015290: 616c 5b69 6e74 5d2c 0a20 2020 2020 2020  al[int],.       
-000152a0: 2020 2020 2063 6163 6865 3a20 626f 6f6c       cache: bool
-000152b0: 2920 2d3e 2054 7570 6c65 5b4c 6973 745b  ) -> Tuple[List[
-000152c0: 436f 726f 7574 696e 655d 2c20 4c69 7374  Coroutine], List
-000152d0: 5b54 7570 6c65 5b73 7472 2c20 7374 722c  [Tuple[str, str,
-000152e0: 2043 616e 646c 6554 7970 655d 5d5d 3a0a   CandleType]]]:.
-000152f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00015300: 2020 2020 4275 696c 6420 436f 726f 7574      Build Corout
-00015310: 696e 6573 2074 6f20 6578 6563 7574 6520  ines to execute 
-00015320: 6173 2070 6172 7420 6f66 2072 6566 7265  as part of refre
-00015330: 7368 5f6c 6174 6573 745f 6f68 6c63 760a  sh_latest_ohlcv.
-00015340: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00015350: 2020 2020 696e 7075 745f 636f 726f 7574      input_corout
-00015360: 696e 6573 3a20 4c69 7374 5b43 6f72 6f75  ines: List[Corou
-00015370: 7469 6e65 5b41 6e79 2c20 416e 792c 204f  tine[Any, Any, O
-00015380: 484c 4356 5265 7370 6f6e 7365 5d5d 203d  HLCVResponse]] =
-00015390: 205b 5d0a 2020 2020 2020 2020 6361 6368   [].        cach
-000153a0: 6564 5f70 6169 7273 203d 205b 5d0a 2020  ed_pairs = [].  
-000153b0: 2020 2020 2020 666f 7220 7061 6972 2c20        for pair, 
-000153c0: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
-000153d0: 655f 7479 7065 2069 6e20 7365 7428 7061  e_type in set(pa
-000153e0: 6972 5f6c 6973 7429 3a0a 2020 2020 2020  ir_list):.      
-000153f0: 2020 2020 2020 6966 2028 7469 6d65 6672        if (timefr
-00015400: 616d 6520 6e6f 7420 696e 2073 656c 662e  ame not in self.
-00015410: 7469 6d65 6672 616d 6573 0a20 2020 2020  timeframes.     
-00015420: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00015430: 6e64 2063 616e 646c 655f 7479 7065 2069  nd candle_type i
-00015440: 6e20 2843 616e 646c 6554 7970 652e 5350  n (CandleType.SP
-00015450: 4f54 2c20 4361 6e64 6c65 5479 7065 2e46  OT, CandleType.F
-00015460: 5554 5552 4553 2929 3a0a 2020 2020 2020  UTURES)):.      
-00015470: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00015480: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
-00015490: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000154a0: 4361 6e6e 6f74 2064 6f77 6e6c 6f61 6420  Cannot download 
-000154b0: 287b 7061 6972 7d2c 207b 7469 6d65 6672  ({pair}, {timefr
-000154c0: 616d 657d 2920 636f 6d62 696e 6174 696f  ame}) combinatio
-000154d0: 6e20 6173 2074 6869 7320 7469 6d65 6672  n as this timefr
-000154e0: 616d 6520 6973 2022 0a20 2020 2020 2020  ame is ".       
-000154f0: 2020 2020 2020 2020 2020 2020 2066 226e               f"n
-00015500: 6f74 2061 7661 696c 6162 6c65 206f 6e20  ot available on 
-00015510: 7b73 656c 662e 6e61 6d65 7d2e 2041 7661  {self.name}. Ava
-00015520: 696c 6162 6c65 2074 696d 6566 7261 6d65  ilable timeframe
-00015530: 7320 6172 6520 220a 2020 2020 2020 2020  s are ".        
-00015540: 2020 2020 2020 2020 2020 2020 6622 7b27              f"{'
-00015550: 2c20 272e 6a6f 696e 2873 656c 662e 7469  , '.join(self.ti
-00015560: 6d65 6672 616d 6573 297d 2e22 290a 2020  meframes)}.").  
-00015570: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00015580: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-00015590: 2020 2020 6966 2028 2870 6169 722c 2074      if ((pair, t
-000155a0: 696d 6566 7261 6d65 2c20 6361 6e64 6c65  imeframe, candle
-000155b0: 5f74 7970 6529 206e 6f74 2069 6e20 7365  _type) not in se
-000155c0: 6c66 2e5f 6b6c 696e 6573 206f 7220 6e6f  lf._klines or no
-000155d0: 7420 6361 6368 650a 2020 2020 2020 2020  t cache.        
-000155e0: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
-000155f0: 656c 662e 5f6e 6f77 5f69 735f 7469 6d65  elf._now_is_time
-00015600: 5f74 6f5f 7265 6672 6573 6828 7061 6972  _to_refresh(pair
-00015610: 2c20 7469 6d65 6672 616d 652c 2063 616e  , timeframe, can
-00015620: 646c 655f 7479 7065 2929 3a0a 0a20 2020  dle_type)):..   
-00015630: 2020 2020 2020 2020 2020 2020 2069 6e70               inp
-00015640: 7574 5f63 6f72 6f75 7469 6e65 732e 6170  ut_coroutines.ap
-00015650: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
-00015660: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00015670: 6275 696c 645f 636f 726f 7574 696e 6528  build_coroutine(
-00015680: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
-00015690: 2063 616e 646c 655f 7479 7065 2c20 7369   candle_type, si
-000156a0: 6e63 655f 6d73 2c20 6361 6368 6529 290a  nce_ms, cache)).
-000156b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000156c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000156d0: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
-000156e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000156f0: 2020 2020 2066 2255 7369 6e67 2063 6163       f"Using cac
-00015700: 6865 6420 6361 6e64 6c65 2028 4f48 4c43  hed candle (OHLC
-00015710: 5629 2064 6174 6120 666f 7220 7b70 6169  V) data for {pai
-00015720: 727d 2c20 7b74 696d 6566 7261 6d65 7d2c  r}, {timeframe},
-00015730: 207b 6361 6e64 6c65 5f74 7970 657d 202e   {candle_type} .
-00015740: 2e2e 220a 2020 2020 2020 2020 2020 2020  ..".            
-00015750: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00015760: 2020 2020 2020 6361 6368 6564 5f70 6169        cached_pai
-00015770: 7273 2e61 7070 656e 6428 2870 6169 722c  rs.append((pair,
-00015780: 2074 696d 6566 7261 6d65 2c20 6361 6e64   timeframe, cand
-00015790: 6c65 5f74 7970 6529 290a 0a20 2020 2020  le_type))..     
-000157a0: 2020 2072 6574 7572 6e20 696e 7075 745f     return input_
-000157b0: 636f 726f 7574 696e 6573 2c20 6361 6368  coroutines, cach
-000157c0: 6564 5f70 6169 7273 0a0a 2020 2020 6465  ed_pairs..    de
-000157d0: 6620 5f70 726f 6365 7373 5f6f 686c 6376  f _process_ohlcv
-000157e0: 5f64 6628 7365 6c66 2c20 7061 6972 3a20  _df(self, pair: 
-000157f0: 7374 722c 2074 696d 6566 7261 6d65 3a20  str, timeframe: 
-00015800: 7374 722c 2063 5f74 7970 653a 2043 616e  str, c_type: Can
-00015810: 646c 6554 7970 652c 2074 6963 6b73 3a20  dleType, ticks: 
-00015820: 4c69 7374 5b4c 6973 745d 2c0a 2020 2020  List[List],.    
-00015830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015840: 2020 2020 2020 6361 6368 653a 2062 6f6f        cache: boo
-00015850: 6c2c 2064 726f 705f 696e 636f 6d70 6c65  l, drop_incomple
-00015860: 7465 3a20 626f 6f6c 2920 2d3e 2044 6174  te: bool) -> Dat
-00015870: 6146 7261 6d65 3a0a 2020 2020 2020 2020  aFrame:.        
-00015880: 2320 6b65 6570 696e 6720 6c61 7374 2063  # keeping last c
-00015890: 616e 646c 6520 7469 6d65 2061 7320 6c61  andle time as la
-000158a0: 7374 2072 6566 7265 7368 6564 2074 696d  st refreshed tim
-000158b0: 6520 6f66 2074 6865 2070 6169 720a 2020  e of the pair.  
-000158c0: 2020 2020 2020 6966 2074 6963 6b73 2061        if ticks a
-000158d0: 6e64 2063 6163 6865 3a0a 2020 2020 2020  nd cache:.      
-000158e0: 2020 2020 2020 6964 7820 3d20 2d32 2069        idx = -2 i
-000158f0: 6620 6472 6f70 5f69 6e63 6f6d 706c 6574  f drop_incomplet
-00015900: 6520 616e 6420 6c65 6e28 7469 636b 7329  e and len(ticks)
-00015910: 203e 2031 2065 6c73 6520 2d31 0a20 2020   > 1 else -1.   
-00015920: 2020 2020 2020 2020 2073 656c 662e 5f70           self._p
-00015930: 6169 7273 5f6c 6173 745f 7265 6672 6573  airs_last_refres
-00015940: 685f 7469 6d65 5b28 7061 6972 2c20 7469  h_time[(pair, ti
-00015950: 6d65 6672 616d 652c 2063 5f74 7970 6529  meframe, c_type)
-00015960: 5d20 3d20 7469 636b 735b 6964 785d 5b30  ] = ticks[idx][0
-00015970: 5d20 2f2f 2031 3030 300a 2020 2020 2020  ] // 1000.      
-00015980: 2020 2320 6b65 6570 696e 6720 7061 7273    # keeping pars
-00015990: 6564 2064 6174 6166 7261 6d65 2069 6e20  ed dataframe in 
-000159a0: 6361 6368 650a 2020 2020 2020 2020 6f68  cache.        oh
-000159b0: 6c63 765f 6466 203d 206f 686c 6376 5f74  lcv_df = ohlcv_t
-000159c0: 6f5f 6461 7461 6672 616d 6528 7469 636b  o_dataframe(tick
-000159d0: 732c 2074 696d 6566 7261 6d65 2c20 7061  s, timeframe, pa
-000159e0: 6972 3d70 6169 722c 2066 696c 6c5f 6d69  ir=pair, fill_mi
-000159f0: 7373 696e 673d 5472 7565 2c0a 2020 2020  ssing=True,.    
-00015a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a20: 2020 6472 6f70 5f69 6e63 6f6d 706c 6574    drop_incomplet
-00015a30: 653d 6472 6f70 5f69 6e63 6f6d 706c 6574  e=drop_incomplet
-00015a40: 6529 0a20 2020 2020 2020 2069 6620 6361  e).        if ca
-00015a50: 6368 653a 0a20 2020 2020 2020 2020 2020  che:.           
-00015a60: 2069 6620 2870 6169 722c 2074 696d 6566   if (pair, timef
-00015a70: 7261 6d65 2c20 635f 7479 7065 2920 696e  rame, c_type) in
-00015a80: 2073 656c 662e 5f6b 6c69 6e65 733a 0a20   self._klines:. 
-00015a90: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00015aa0: 6c64 203d 2073 656c 662e 5f6b 6c69 6e65  ld = self._kline
-00015ab0: 735b 2870 6169 722c 2074 696d 6566 7261  s[(pair, timefra
-00015ac0: 6d65 2c20 635f 7479 7065 295d 0a20 2020  me, c_type)].   
-00015ad0: 2020 2020 2020 2020 2020 2020 2023 2052               # R
-00015ae0: 6561 7373 6967 6e20 736f 2077 6520 7265  eassign so we re
-00015af0: 7475 726e 2074 6865 2075 7064 6174 6564  turn the updated
-00015b00: 2c20 636f 6d62 696e 6564 2064 660a 2020  , combined df.  
-00015b10: 2020 2020 2020 2020 2020 2020 2020 6f68                oh
-00015b20: 6c63 765f 6466 203d 2063 6c65 616e 5f6f  lcv_df = clean_o
-00015b30: 686c 6376 5f64 6174 6166 7261 6d65 2863  hlcv_dataframe(c
-00015b40: 6f6e 6361 7428 5b6f 6c64 2c20 6f68 6c63  oncat([old, ohlc
-00015b50: 765f 6466 5d2c 2061 7869 733d 3029 2c20  v_df], axis=0), 
-00015b60: 7469 6d65 6672 616d 652c 2070 6169 722c  timeframe, pair,
-00015b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ba0: 2020 6669 6c6c 5f6d 6973 7369 6e67 3d54    fill_missing=T
-00015bb0: 7275 652c 2064 726f 705f 696e 636f 6d70  rue, drop_incomp
-00015bc0: 6c65 7465 3d46 616c 7365 290a 2020 2020  lete=False).    
-00015bd0: 2020 2020 2020 2020 2020 2020 6361 6e64              cand
-00015be0: 6c65 5f6c 696d 6974 203d 2073 656c 662e  le_limit = self.
-00015bf0: 6f68 6c63 765f 6361 6e64 6c65 5f6c 696d  ohlcv_candle_lim
-00015c00: 6974 2874 696d 6566 7261 6d65 2c20 7365  it(timeframe, se
-00015c10: 6c66 2e5f 636f 6e66 6967 5b27 6361 6e64  lf._config['cand
-00015c20: 6c65 5f74 7970 655f 6465 6627 5d29 0a20  le_type_def']). 
-00015c30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00015c40: 2041 6765 206f 7574 206f 6c64 2063 616e   Age out old can
-00015c50: 646c 6573 0a20 2020 2020 2020 2020 2020  dles.           
-00015c60: 2020 2020 206f 686c 6376 5f64 6620 3d20       ohlcv_df = 
-00015c70: 6f68 6c63 765f 6466 2e74 6169 6c28 6361  ohlcv_df.tail(ca
-00015c80: 6e64 6c65 5f6c 696d 6974 202b 2073 656c  ndle_limit + sel
-00015c90: 662e 5f73 7461 7274 7570 5f63 616e 646c  f._startup_candl
-00015ca0: 655f 636f 756e 7429 0a20 2020 2020 2020  e_count).       
-00015cb0: 2020 2020 2020 2020 206f 686c 6376 5f64           ohlcv_d
-00015cc0: 6620 3d20 6f68 6c63 765f 6466 2e72 6573  f = ohlcv_df.res
-00015cd0: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
-00015ce0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00015cf0: 2020 2020 7365 6c66 2e5f 6b6c 696e 6573      self._klines
-00015d00: 5b28 7061 6972 2c20 7469 6d65 6672 616d  [(pair, timefram
-00015d10: 652c 2063 5f74 7970 6529 5d20 3d20 6f68  e, c_type)] = oh
-00015d20: 6c63 765f 6466 0a20 2020 2020 2020 2020  lcv_df.         
-00015d30: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00015d40: 2020 2020 2020 2020 2073 656c 662e 5f6b           self._k
-00015d50: 6c69 6e65 735b 2870 6169 722c 2074 696d  lines[(pair, tim
-00015d60: 6566 7261 6d65 2c20 635f 7479 7065 295d  eframe, c_type)]
-00015d70: 203d 206f 686c 6376 5f64 660a 2020 2020   = ohlcv_df.    
-00015d80: 2020 2020 7265 7475 726e 206f 686c 6376      return ohlcv
-00015d90: 5f64 660a 0a20 2020 2064 6566 2072 6566  _df..    def ref
-00015da0: 7265 7368 5f6c 6174 6573 745f 6f68 6c63  resh_latest_ohlc
-00015db0: 7628 7365 6c66 2c20 7061 6972 5f6c 6973  v(self, pair_lis
-00015dc0: 743a 204c 6973 7450 6169 7273 5769 7468  t: ListPairsWith
-00015dd0: 5469 6d65 6672 616d 6573 2c20 2a2c 0a20  Timeframes, *,. 
-00015de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015df0: 2020 2020 2020 2020 2020 2020 7369 6e63              sinc
-00015e00: 655f 6d73 3a20 4f70 7469 6f6e 616c 5b69  e_ms: Optional[i
-00015e10: 6e74 5d20 3d20 4e6f 6e65 2c20 6361 6368  nt] = None, cach
-00015e20: 653a 2062 6f6f 6c20 3d20 5472 7565 2c0a  e: bool = True,.
-00015e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e40: 2020 2020 2020 2020 2020 2020 2064 726f               dro
-00015e50: 705f 696e 636f 6d70 6c65 7465 3a20 4f70  p_incomplete: Op
-00015e60: 7469 6f6e 616c 5b62 6f6f 6c5d 203d 204e  tional[bool] = N
-00015e70: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00015e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e90: 2029 202d 3e20 4469 6374 5b50 6169 7257   ) -> Dict[PairW
-00015ea0: 6974 6854 696d 6566 7261 6d65 2c20 4461  ithTimeframe, Da
-00015eb0: 7461 4672 616d 655d 3a0a 2020 2020 2020  taFrame]:.      
-00015ec0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00015ed0: 6672 6573 6820 696e 2d6d 656d 6f72 7920  fresh in-memory 
-00015ee0: 4f48 4c43 5620 6173 796e 6368 726f 6e6f  OHLCV asynchrono
-00015ef0: 7573 6c79 2061 6e64 2073 6574 2060 5f6b  usly and set `_k
-00015f00: 6c69 6e65 7360 2077 6974 6820 7468 6520  lines` with the 
-00015f10: 7265 7375 6c74 0a20 2020 2020 2020 204c  result.        L
-00015f20: 6f6f 7073 2061 7379 6e63 6872 6f6e 6f75  oops asynchronou
-00015f30: 736c 7920 6f76 6572 2070 6169 725f 6c69  sly over pair_li
-00015f40: 7374 2061 6e64 2064 6f77 6e6c 6f61 6473  st and downloads
-00015f50: 2061 6c6c 2070 6169 7273 2061 7379 6e63   all pairs async
-00015f60: 2028 7365 6d69 2d70 6172 616c 6c65 6c29   (semi-parallel)
-00015f70: 2e0a 2020 2020 2020 2020 4f6e 6c79 2075  ..        Only u
-00015f80: 7365 6420 696e 2074 6865 2064 6174 6170  sed in the datap
-00015f90: 726f 7669 6465 722e 7265 6672 6573 6828  rovider.refresh(
-00015fa0: 2920 6d65 7468 6f64 2e0a 2020 2020 2020  ) method..      
-00015fb0: 2020 3a70 6172 616d 2070 6169 725f 6c69    :param pair_li
-00015fc0: 7374 3a20 4c69 7374 206f 6620 3220 656c  st: List of 2 el
-00015fd0: 656d 656e 7420 7475 706c 6573 2063 6f6e  ement tuples con
-00015fe0: 7461 696e 696e 6720 7061 6972 2c20 696e  taining pair, in
-00015ff0: 7465 7276 616c 2074 6f20 7265 6672 6573  terval to refres
-00016000: 680a 2020 2020 2020 2020 3a70 6172 616d  h.        :param
-00016010: 2073 696e 6365 5f6d 733a 2074 696d 6520   since_ms: time 
-00016020: 7369 6e63 6520 7768 656e 2074 6f20 646f  since when to do
-00016030: 776e 6c6f 6164 2c20 696e 206d 696c 6c69  wnload, in milli
-00016040: 7365 636f 6e64 730a 2020 2020 2020 2020  seconds.        
-00016050: 3a70 6172 616d 2063 6163 6865 3a20 4173  :param cache: As
-00016060: 7369 676e 2072 6573 756c 7420 746f 205f  sign result to _
-00016070: 6b6c 696e 6573 2e20 5573 6566 756c 6c20  klines. Usefull 
-00016080: 666f 7220 6f6e 652d 6f66 6620 646f 776e  for one-off down
-00016090: 6c6f 6164 7320 6c69 6b65 2066 6f72 2070  loads like for p
-000160a0: 6169 726c 6973 7473 0a20 2020 2020 2020  airlists.       
-000160b0: 203a 7061 7261 6d20 6472 6f70 5f69 6e63   :param drop_inc
-000160c0: 6f6d 706c 6574 653a 2043 6f6e 7472 6f6c  omplete: Control
-000160d0: 2063 616e 646c 6520 6472 6f70 7069 6e67   candle dropping
-000160e0: 2e0a 2020 2020 2020 2020 2020 2020 5370  ..            Sp
-000160f0: 6563 6966 7969 6e67 204e 6f6e 6520 6465  ecifying None de
-00016100: 6661 756c 7473 2074 6f20 5f6f 686c 6376  faults to _ohlcv
-00016110: 5f70 6172 7469 616c 5f63 616e 646c 650a  _partial_candle.
-00016120: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00016130: 2044 6963 7420 6f66 205b 7b28 7061 6972   Dict of [{(pair
-00016140: 2c20 7469 6d65 6672 616d 6529 3a20 4461  , timeframe): Da
-00016150: 7461 6672 616d 657d 5d0a 2020 2020 2020  taframe}].      
-00016160: 2020 2222 220a 2020 2020 2020 2020 6c6f    """.        lo
-00016170: 6767 6572 2e64 6562 7567 2822 5265 6672  gger.debug("Refr
-00016180: 6573 6869 6e67 2063 616e 646c 6520 284f  eshing candle (O
-00016190: 484c 4356 2920 6461 7461 2066 6f72 2025  HLCV) data for %
-000161a0: 6420 7061 6972 7322 2c20 6c65 6e28 7061  d pairs", len(pa
-000161b0: 6972 5f6c 6973 7429 290a 0a20 2020 2020  ir_list))..     
-000161c0: 2020 2023 2047 6174 6865 7220 636f 726f     # Gather coro
-000161d0: 7574 696e 6573 2074 6f20 7275 6e0a 2020  utines to run.  
-000161e0: 2020 2020 2020 696e 7075 745f 636f 726f        input_coro
-000161f0: 7574 696e 6573 2c20 6361 6368 6564 5f70  utines, cached_p
-00016200: 6169 7273 203d 2073 656c 662e 5f62 7569  airs = self._bui
-00016210: 6c64 5f6f 686c 6376 5f64 6c5f 6a6f 6273  ld_ohlcv_dl_jobs
-00016220: 2870 6169 725f 6c69 7374 2c20 7369 6e63  (pair_list, sinc
-00016230: 655f 6d73 2c20 6361 6368 6529 0a0a 2020  e_ms, cache)..  
-00016240: 2020 2020 2020 7265 7375 6c74 735f 6466        results_df
-00016250: 203d 207b 7d0a 2020 2020 2020 2020 2320   = {}.        # 
-00016260: 4368 756e 6b20 7265 7175 6573 7473 2069  Chunk requests i
-00016270: 6e74 6f20 6261 7463 6865 7320 6f66 2031  nto batches of 1
-00016280: 3030 2074 6f20 6176 6f69 6420 6f76 6572  00 to avoid over
-00016290: 7765 6c6d 696e 6720 6363 7874 2054 6872  welming ccxt Thr
-000162a0: 6f74 746c 696e 670a 2020 2020 2020 2020  ottling.        
-000162b0: 666f 7220 696e 7075 745f 636f 726f 2069  for input_coro i
-000162c0: 6e20 6368 756e 6b73 2869 6e70 7574 5f63  n chunks(input_c
-000162d0: 6f72 6f75 7469 6e65 732c 2031 3030 293a  oroutines, 100):
-000162e0: 0a20 2020 2020 2020 2020 2020 2061 7379  .            asy
-000162f0: 6e63 2064 6566 2067 6174 6865 725f 7374  nc def gather_st
-00016300: 7566 6628 293a 0a20 2020 2020 2020 2020  uff():.         
-00016310: 2020 2020 2020 2072 6574 7572 6e20 6177         return aw
-00016320: 6169 7420 6173 796e 6369 6f2e 6761 7468  ait asyncio.gath
-00016330: 6572 282a 696e 7075 745f 636f 726f 2c20  er(*input_coro, 
-00016340: 7265 7475 726e 5f65 7863 6570 7469 6f6e  return_exception
-00016350: 733d 5472 7565 290a 0a20 2020 2020 2020  s=True)..       
-00016360: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
-00016370: 6c6f 6f70 5f6c 6f63 6b3a 0a20 2020 2020  loop_lock:.     
-00016380: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00016390: 7473 203d 2073 656c 662e 6c6f 6f70 2e72  ts = self.loop.r
-000163a0: 756e 5f75 6e74 696c 5f63 6f6d 706c 6574  un_until_complet
-000163b0: 6528 6761 7468 6572 5f73 7475 6666 2829  e(gather_stuff()
-000163c0: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
-000163d0: 6f72 2072 6573 2069 6e20 7265 7375 6c74  or res in result
-000163e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000163f0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00016400: 2872 6573 2c20 4578 6365 7074 696f 6e29  (res, Exception)
-00016410: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016420: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
-00016430: 6e69 6e67 2866 2241 7379 6e63 2063 6f64  ning(f"Async cod
-00016440: 6520 7261 6973 6564 2061 6e20 6578 6365  e raised an exce
-00016450: 7074 696f 6e3a 207b 7265 7072 2872 6573  ption: {repr(res
-00016460: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
-00016470: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00016480: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00016490: 2020 2320 4465 636f 6e73 7472 7563 7420    # Deconstruct 
-000164a0: 7475 706c 6520 2868 6173 2035 2065 6c65  tuple (has 5 ele
-000164b0: 6d65 6e74 7329 0a20 2020 2020 2020 2020  ments).         
-000164c0: 2020 2020 2020 2070 6169 722c 2074 696d         pair, tim
-000164d0: 6566 7261 6d65 2c20 635f 7479 7065 2c20  eframe, c_type, 
-000164e0: 7469 636b 732c 2064 726f 705f 6869 6e74  ticks, drop_hint
-000164f0: 203d 2072 6573 0a20 2020 2020 2020 2020   = res.         
-00016500: 2020 2020 2020 2064 726f 705f 696e 636f         drop_inco
-00016510: 6d70 6c65 7465 5f20 3d20 6472 6f70 5f68  mplete_ = drop_h
-00016520: 696e 7420 6966 2064 726f 705f 696e 636f  int if drop_inco
-00016530: 6d70 6c65 7465 2069 7320 4e6f 6e65 2065  mplete is None e
-00016540: 6c73 6520 6472 6f70 5f69 6e63 6f6d 706c  lse drop_incompl
-00016550: 6574 650a 2020 2020 2020 2020 2020 2020  ete.            
-00016560: 2020 2020 6f68 6c63 765f 6466 203d 2073      ohlcv_df = s
-00016570: 656c 662e 5f70 726f 6365 7373 5f6f 686c  elf._process_ohl
-00016580: 6376 5f64 6628 0a20 2020 2020 2020 2020  cv_df(.         
-00016590: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-000165a0: 2074 696d 6566 7261 6d65 2c20 635f 7479   timeframe, c_ty
-000165b0: 7065 2c20 7469 636b 732c 2063 6163 6865  pe, ticks, cache
-000165c0: 2c20 6472 6f70 5f69 6e63 6f6d 706c 6574  , drop_incomplet
-000165d0: 655f 290a 0a20 2020 2020 2020 2020 2020  e_)..           
-000165e0: 2020 2020 2072 6573 756c 7473 5f64 665b       results_df[
-000165f0: 2870 6169 722c 2074 696d 6566 7261 6d65  (pair, timeframe
-00016600: 2c20 635f 7479 7065 295d 203d 206f 686c  , c_type)] = ohl
-00016610: 6376 5f64 660a 0a20 2020 2020 2020 2023  cv_df..        #
-00016620: 2052 6574 7572 6e20 6361 6368 6564 206b   Return cached k
-00016630: 6c69 6e65 730a 2020 2020 2020 2020 666f  lines.        fo
-00016640: 7220 7061 6972 2c20 7469 6d65 6672 616d  r pair, timefram
-00016650: 652c 2063 5f74 7970 6520 696e 2063 6163  e, c_type in cac
-00016660: 6865 645f 7061 6972 733a 0a20 2020 2020  hed_pairs:.     
-00016670: 2020 2020 2020 2072 6573 756c 7473 5f64         results_d
-00016680: 665b 2870 6169 722c 2074 696d 6566 7261  f[(pair, timefra
-00016690: 6d65 2c20 635f 7479 7065 295d 203d 2073  me, c_type)] = s
-000166a0: 656c 662e 6b6c 696e 6573 280a 2020 2020  elf.klines(.    
-000166b0: 2020 2020 2020 2020 2020 2020 2870 6169              (pai
-000166c0: 722c 2074 696d 6566 7261 6d65 2c20 635f  r, timeframe, c_
-000166d0: 7479 7065 292c 0a20 2020 2020 2020 2020  type),.         
-000166e0: 2020 2020 2020 2063 6f70 793d 4661 6c73         copy=Fals
-000166f0: 650a 2020 2020 2020 2020 2020 2020 290a  e.            ).
-00016700: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00016710: 7265 7375 6c74 735f 6466 0a0a 2020 2020  results_df..    
-00016720: 6465 6620 5f6e 6f77 5f69 735f 7469 6d65  def _now_is_time
-00016730: 5f74 6f5f 7265 6672 6573 6828 7365 6c66  _to_refresh(self
-00016740: 2c20 7061 6972 3a20 7374 722c 2074 696d  , pair: str, tim
-00016750: 6566 7261 6d65 3a20 7374 722c 2063 616e  eframe: str, can
-00016760: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
-00016770: 5479 7065 2920 2d3e 2062 6f6f 6c3a 0a20  Type) -> bool:. 
-00016780: 2020 2020 2020 2023 2054 696d 6566 7261         # Timefra
-00016790: 6d65 2069 6e20 7365 636f 6e64 730a 2020  me in seconds.  
-000167a0: 2020 2020 2020 696e 7465 7276 616c 5f69        interval_i
-000167b0: 6e5f 7365 6320 3d20 7469 6d65 6672 616d  n_sec = timefram
-000167c0: 655f 746f 5f73 6563 6f6e 6473 2874 696d  e_to_seconds(tim
-000167d0: 6566 7261 6d65 290a 2020 2020 2020 2020  eframe).        
-000167e0: 706c 7220 3d20 7365 6c66 2e5f 7061 6972  plr = self._pair
-000167f0: 735f 6c61 7374 5f72 6566 7265 7368 5f74  s_last_refresh_t
-00016800: 696d 652e 6765 7428 2870 6169 722c 2074  ime.get((pair, t
-00016810: 696d 6566 7261 6d65 2c20 6361 6e64 6c65  imeframe, candle
-00016820: 5f74 7970 6529 2c20 3029 202b 2069 6e74  _type), 0) + int
-00016830: 6572 7661 6c5f 696e 5f73 6563 0a20 2020  erval_in_sec.   
-00016840: 2020 2020 2023 2063 7572 7265 6e74 2c61       # current,a
-00016850: 6374 6976 6520 6361 6e64 6c65 206f 7065  ctive candle ope
-00016860: 6e20 6461 7465 0a20 2020 2020 2020 206e  n date.        n
-00016870: 6f77 203d 2069 6e74 2874 696d 6566 7261  ow = int(timefra
-00016880: 6d65 5f74 6f5f 7072 6576 5f64 6174 6528  me_to_prev_date(
-00016890: 7469 6d65 6672 616d 6529 2e74 696d 6573  timeframe).times
-000168a0: 7461 6d70 2829 290a 2020 2020 2020 2020  tamp()).        
-000168b0: 7265 7475 726e 2070 6c72 203c 206e 6f77  return plr < now
-000168c0: 0a0a 2020 2020 4072 6574 7269 6572 5f61  ..    @retrier_a
-000168d0: 7379 6e63 0a20 2020 2061 7379 6e63 2064  sync.    async d
-000168e0: 6566 205f 6173 796e 635f 6765 745f 6361  ef _async_get_ca
-000168f0: 6e64 6c65 5f68 6973 746f 7279 280a 2020  ndle_history(.  
-00016900: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00016910: 2020 2020 7061 6972 3a20 7374 722c 0a20      pair: str,. 
-00016920: 2020 2020 2020 2074 696d 6566 7261 6d65         timeframe
-00016930: 3a20 7374 722c 0a20 2020 2020 2020 2063  : str,.        c
-00016940: 616e 646c 655f 7479 7065 3a20 4361 6e64  andle_type: Cand
-00016950: 6c65 5479 7065 2c0a 2020 2020 2020 2020  leType,.        
-00016960: 7369 6e63 655f 6d73 3a20 4f70 7469 6f6e  since_ms: Option
-00016970: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
-00016980: 2020 2020 2920 2d3e 204f 484c 4356 5265      ) -> OHLCVRe
-00016990: 7370 6f6e 7365 3a0a 2020 2020 2020 2020  sponse:.        
-000169a0: 2222 220a 2020 2020 2020 2020 4173 796e  """.        Asyn
-000169b0: 6368 726f 6e6f 7573 6c79 2067 6574 2063  chronously get c
-000169c0: 616e 646c 6520 6869 7374 6f72 7920 6461  andle history da
-000169d0: 7461 2075 7369 6e67 2066 6574 6368 5f6f  ta using fetch_o
-000169e0: 686c 6376 0a20 2020 2020 2020 203a 7061  hlcv.        :pa
-000169f0: 7261 6d20 6361 6e64 6c65 5f74 7970 653a  ram candle_type:
-00016a00: 2027 272c 206d 6172 6b2c 2069 6e64 6578   '', mark, index
-00016a10: 2c20 7072 656d 6975 6d49 6e64 6578 2c20  , premiumIndex, 
-00016a20: 6f72 2066 756e 6469 6e67 5f72 6174 650a  or funding_rate.
-00016a30: 2020 2020 2020 2020 7265 7475 726e 7320          returns 
-00016a40: 7475 706c 653a 2028 7061 6972 2c20 7469  tuple: (pair, ti
-00016a50: 6d65 6672 616d 652c 206f 686c 6376 5f6c  meframe, ohlcv_l
-00016a60: 6973 7429 0a20 2020 2020 2020 2022 2222  ist).        """
-00016a70: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00016a80: 2020 2020 2020 2020 2020 2320 4665 7463            # Fetc
-00016a90: 6820 4f48 4c43 5620 6173 796e 6368 726f  h OHLCV asynchro
-00016aa0: 6e6f 7573 6c79 0a20 2020 2020 2020 2020  nously.         
-00016ab0: 2020 2073 203d 2027 2827 202b 2061 7272     s = '(' + arr
-00016ac0: 6f77 2e67 6574 2873 696e 6365 5f6d 7320  ow.get(since_ms 
-00016ad0: 2f2f 2031 3030 3029 2e69 736f 666f 726d  // 1000).isoform
-00016ae0: 6174 2829 202b 2027 2920 2720 6966 2073  at() + ') ' if s
-00016af0: 696e 6365 5f6d 7320 6973 206e 6f74 204e  ince_ms is not N
-00016b00: 6f6e 6520 656c 7365 2027 270a 2020 2020  one else ''.    
-00016b10: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-00016b20: 6562 7567 280a 2020 2020 2020 2020 2020  ebug(.          
-00016b30: 2020 2020 2020 2246 6574 6368 696e 6720        "Fetching 
-00016b40: 7061 6972 2025 732c 2025 732c 2069 6e74  pair %s, %s, int
-00016b50: 6572 7661 6c20 2573 2c20 7369 6e63 6520  erval %s, since 
-00016b60: 2573 2025 732e 2e2e 222c 0a20 2020 2020  %s %s...",.     
-00016b70: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-00016b80: 2063 616e 646c 655f 7479 7065 2c20 7469   candle_type, ti
-00016b90: 6d65 6672 616d 652c 2073 696e 6365 5f6d  meframe, since_m
-00016ba0: 732c 2073 0a20 2020 2020 2020 2020 2020  s, s.           
-00016bb0: 2029 0a20 2020 2020 2020 2020 2020 2070   ).            p
-00016bc0: 6172 616d 7320 3d20 6465 6570 636f 7079  arams = deepcopy
-00016bd0: 2873 656c 662e 5f66 745f 6861 732e 6765  (self._ft_has.ge
-00016be0: 7428 276f 686c 6376 5f70 6172 616d 7327  t('ohlcv_params'
-00016bf0: 2c20 7b7d 2929 0a20 2020 2020 2020 2020  , {})).         
-00016c00: 2020 2063 616e 646c 655f 6c69 6d69 7420     candle_limit 
-00016c10: 3d20 7365 6c66 2e6f 686c 6376 5f63 616e  = self.ohlcv_can
-00016c20: 646c 655f 6c69 6d69 7428 0a20 2020 2020  dle_limit(.     
-00016c30: 2020 2020 2020 2020 2020 2074 696d 6566             timef
-00016c40: 7261 6d65 2c20 6361 6e64 6c65 5f74 7970  rame, candle_typ
-00016c50: 653d 6361 6e64 6c65 5f74 7970 652c 2073  e=candle_type, s
-00016c60: 696e 6365 5f6d 733d 7369 6e63 655f 6d73  ince_ms=since_ms
-00016c70: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00016c80: 6620 6361 6e64 6c65 5f74 7970 6520 616e  f candle_type an
-00016c90: 6420 6361 6e64 6c65 5f74 7970 6520 213d  d candle_type !=
-00016ca0: 2043 616e 646c 6554 7970 652e 5350 4f54   CandleType.SPOT
-00016cb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016cc0: 2020 7061 7261 6d73 2e75 7064 6174 6528    params.update(
-00016cd0: 7b27 7072 6963 6527 3a20 6361 6e64 6c65  {'price': candle
-00016ce0: 5f74 7970 652e 7661 6c75 657d 290a 2020  _type.value}).  
-00016cf0: 2020 2020 2020 2020 2020 6966 2063 616e            if can
-00016d00: 646c 655f 7479 7065 2021 3d20 4361 6e64  dle_type != Cand
-00016d10: 6c65 5479 7065 2e46 554e 4449 4e47 5f52  leType.FUNDING_R
-00016d20: 4154 453a 0a20 2020 2020 2020 2020 2020  ATE:.           
-00016d30: 2020 2020 2064 6174 6120 3d20 6177 6169       data = awai
-00016d40: 7420 7365 6c66 2e5f 6170 695f 6173 796e  t self._api_asyn
-00016d50: 632e 6665 7463 685f 6f68 6c63 7628 0a20  c.fetch_ohlcv(. 
-00016d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d70: 2020 2070 6169 722c 2074 696d 6566 7261     pair, timefra
-00016d80: 6d65 3d74 696d 6566 7261 6d65 2c20 7369  me=timeframe, si
-00016d90: 6e63 653d 7369 6e63 655f 6d73 2c0a 2020  nce=since_ms,.  
-00016da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016db0: 2020 6c69 6d69 743d 6361 6e64 6c65 5f6c    limit=candle_l
-00016dc0: 696d 6974 2c20 7061 7261 6d73 3d70 6172  imit, params=par
-00016dd0: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
-00016de0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00016df0: 2020 2020 2020 2023 2046 756e 6469 6e67         # Funding
-00016e00: 2072 6174 650a 2020 2020 2020 2020 2020   rate.          
-00016e10: 2020 2020 2020 6461 7461 203d 2061 7761        data = awa
-00016e20: 6974 2073 656c 662e 5f66 6574 6368 5f66  it self._fetch_f
-00016e30: 756e 6469 6e67 5f72 6174 655f 6869 7374  unding_rate_hist
-00016e40: 6f72 7928 0a20 2020 2020 2020 2020 2020  ory(.           
-00016e50: 2020 2020 2020 2020 2070 6169 723d 7061           pair=pa
-00016e60: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
-00016e70: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
-00016e80: 653d 7469 6d65 6672 616d 652c 0a20 2020  e=timeframe,.   
-00016e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ea0: 206c 696d 6974 3d63 616e 646c 655f 6c69   limit=candle_li
-00016eb0: 6d69 742c 0a20 2020 2020 2020 2020 2020  mit,.           
-00016ec0: 2020 2020 2020 2020 2073 696e 6365 5f6d           since_m
-00016ed0: 733d 7369 6e63 655f 6d73 2c0a 2020 2020  s=since_ms,.    
-00016ee0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00016ef0: 2020 2020 2020 2020 2020 2320 536f 6d65            # Some
-00016f00: 2065 7863 6861 6e67 6573 2073 6f72 7420   exchanges sort 
-00016f10: 4f48 4c43 5620 696e 2041 5343 206f 7264  OHLCV in ASC ord
-00016f20: 6572 2061 6e64 206f 7468 6572 7320 696e  er and others in
-00016f30: 2044 4553 432e 0a20 2020 2020 2020 2020   DESC..         
-00016f40: 2020 2023 2045 783a 2042 6974 7472 6578     # Ex: Bittrex
-00016f50: 2072 6574 7572 6e73 2074 6865 206c 6973   returns the lis
-00016f60: 7420 6f66 204f 484c 4356 2069 6e20 4153  t of OHLCV in AS
-00016f70: 4320 6f72 6465 7220 286f 6c64 6573 7420  C order (oldest 
-00016f80: 6669 7273 742c 206e 6577 6573 7420 6c61  first, newest la
-00016f90: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
-00016fa0: 2320 7768 696c 6520 4744 4158 2072 6574  # while GDAX ret
-00016fb0: 7572 6e73 2074 6865 206c 6973 7420 6f66  urns the list of
-00016fc0: 204f 484c 4356 2069 6e20 4445 5343 206f   OHLCV in DESC o
-00016fd0: 7264 6572 2028 6e65 7765 7374 2066 6972  rder (newest fir
-00016fe0: 7374 2c20 6f6c 6465 7374 206c 6173 7429  st, oldest last)
-00016ff0: 0a20 2020 2020 2020 2020 2020 2023 204f  .            # O
-00017000: 6e6c 7920 736f 7274 2069 6620 6e65 6365  nly sort if nece
-00017010: 7373 6172 7920 746f 2073 6176 6520 636f  ssary to save co
-00017020: 6d70 7574 696e 6720 7469 6d65 0a20 2020  mputing time.   
-00017030: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00017040: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00017050: 2064 6174 6120 616e 6420 6461 7461 5b30   data and data[0
-00017060: 5d5b 305d 203e 2064 6174 615b 2d31 5d5b  ][0] > data[-1][
-00017070: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
-00017080: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
-00017090: 6f72 7465 6428 6461 7461 2c20 6b65 793d  orted(data, key=
-000170a0: 6c61 6d62 6461 2078 3a20 785b 305d 290a  lambda x: x[0]).
-000170b0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-000170c0: 7074 2049 6e64 6578 4572 726f 723a 0a20  pt IndexError:. 
-000170d0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000170e0: 6f67 6765 722e 6578 6365 7074 696f 6e28  ogger.exception(
-000170f0: 2245 7272 6f72 206c 6f61 6469 6e67 2025  "Error loading %
-00017100: 732e 2052 6573 756c 7420 7761 7320 2573  s. Result was %s
-00017110: 2e22 2c20 7061 6972 2c20 6461 7461 290a  .", pair, data).
-00017120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017130: 7265 7475 726e 2070 6169 722c 2074 696d  return pair, tim
-00017140: 6566 7261 6d65 2c20 6361 6e64 6c65 5f74  eframe, candle_t
-00017150: 7970 652c 205b 5d2c 2073 656c 662e 5f6f  ype, [], self._o
-00017160: 686c 6376 5f70 6172 7469 616c 5f63 616e  hlcv_partial_can
-00017170: 646c 650a 2020 2020 2020 2020 2020 2020  dle.            
-00017180: 6c6f 6767 6572 2e64 6562 7567 2822 446f  logger.debug("Do
-00017190: 6e65 2066 6574 6368 696e 6720 7061 6972  ne fetching pair
-000171a0: 2025 732c 2069 6e74 6572 7661 6c20 2573   %s, interval %s
-000171b0: 202e 2e2e 222c 2070 6169 722c 2074 696d   ...", pair, tim
-000171c0: 6566 7261 6d65 290a 2020 2020 2020 2020  eframe).        
-000171d0: 2020 2020 7265 7475 726e 2070 6169 722c      return pair,
-000171e0: 2074 696d 6566 7261 6d65 2c20 6361 6e64   timeframe, cand
-000171f0: 6c65 5f74 7970 652c 2064 6174 612c 2073  le_type, data, s
-00017200: 656c 662e 5f6f 686c 6376 5f70 6172 7469  elf._ohlcv_parti
-00017210: 616c 5f63 616e 646c 650a 0a20 2020 2020  al_candle..     
-00017220: 2020 2065 7863 6570 7420 6363 7874 2e4e     except ccxt.N
-00017230: 6f74 5375 7070 6f72 7465 6420 6173 2065  otSupported as e
-00017240: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00017250: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-00017260: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-00017270: 2020 2020 2020 2020 2020 6627 4578 6368            f'Exch
-00017280: 616e 6765 207b 7365 6c66 2e5f 6170 692e  ange {self._api.
-00017290: 6e61 6d65 7d20 646f 6573 206e 6f74 2073  name} does not s
-000172a0: 7570 706f 7274 2066 6574 6368 696e 6720  upport fetching 
-000172b0: 6869 7374 6f72 6963 616c 2027 0a20 2020  historical '.   
-000172c0: 2020 2020 2020 2020 2020 2020 2066 2763               f'c
-000172d0: 616e 646c 6520 284f 484c 4356 2920 6461  andle (OHLCV) da
-000172e0: 7461 2e20 4d65 7373 6167 653a 207b 657d  ta. Message: {e}
-000172f0: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
-00017300: 2020 6578 6365 7074 2063 6378 742e 4444    except ccxt.DD
-00017310: 6f53 5072 6f74 6563 7469 6f6e 2061 7320  oSProtection as 
-00017320: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00017330: 6169 7365 2044 446f 7350 726f 7465 6374  aise DDosProtect
-00017340: 696f 6e28 6529 2066 726f 6d20 650a 2020  ion(e) from e.  
-00017350: 2020 2020 2020 6578 6365 7074 2028 6363        except (cc
-00017360: 7874 2e4e 6574 776f 726b 4572 726f 722c  xt.NetworkError,
-00017370: 2063 6378 742e 4578 6368 616e 6765 4572   ccxt.ExchangeEr
-00017380: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
-00017390: 2020 2020 2020 2072 6169 7365 2054 656d         raise Tem
-000173a0: 706f 7261 7279 4572 726f 7228 6627 436f  poraryError(f'Co
-000173b0: 756c 6420 6e6f 7420 6665 7463 6820 6869  uld not fetch hi
-000173c0: 7374 6f72 6963 616c 2063 616e 646c 6520  storical candle 
-000173d0: 284f 484c 4356 2920 6461 7461 2027 0a20  (OHLCV) data '. 
-000173e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017400: 6627 666f 7220 7061 6972 207b 7061 6972  f'for pair {pair
-00017410: 7d20 6475 6520 746f 207b 652e 5f5f 636c  } due to {e.__cl
-00017420: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
-00017430: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
-00017440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017450: 2020 2020 6627 4d65 7373 6167 653a 207b      f'Message: {
-00017460: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
-00017470: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
-00017480: 4261 7365 4572 726f 7220 6173 2065 3a0a  BaseError as e:.
-00017490: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000174a0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-000174b0: 6570 7469 6f6e 2866 2743 6f75 6c64 206e  eption(f'Could n
-000174c0: 6f74 2066 6574 6368 2068 6973 746f 7269  ot fetch histori
-000174d0: 6361 6c20 6361 6e64 6c65 2028 4f48 4c43  cal candle (OHLC
-000174e0: 5629 2064 6174 6120 270a 2020 2020 2020  V) data '.      
-000174f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017510: 2066 2766 6f72 2070 6169 7220 7b70 6169   f'for pair {pai
-00017520: 727d 2e20 4d65 7373 6167 653a 207b 657d  r}. Message: {e}
-00017530: 2729 2066 726f 6d20 650a 0a20 2020 2061  ') from e..    a
-00017540: 7379 6e63 2064 6566 205f 6665 7463 685f  sync def _fetch_
-00017550: 6675 6e64 696e 675f 7261 7465 5f68 6973  funding_rate_his
-00017560: 746f 7279 280a 2020 2020 2020 2020 7365  tory(.        se
-00017570: 6c66 2c0a 2020 2020 2020 2020 7061 6972  lf,.        pair
-00017580: 3a20 7374 722c 0a20 2020 2020 2020 2074  : str,.        t
-00017590: 696d 6566 7261 6d65 3a20 7374 722c 0a20  imeframe: str,. 
-000175a0: 2020 2020 2020 206c 696d 6974 3a20 696e         limit: in
-000175b0: 742c 0a20 2020 2020 2020 2073 696e 6365  t,.        since
-000175c0: 5f6d 733a 204f 7074 696f 6e61 6c5b 696e  _ms: Optional[in
-000175d0: 745d 203d 204e 6f6e 652c 0a20 2020 2029  t] = None,.    )
-000175e0: 202d 3e20 4c69 7374 5b4c 6973 745d 3a0a   -> List[List]:.
-000175f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00017600: 2020 2020 4665 7463 6820 6675 6e64 696e      Fetch fundin
-00017610: 6720 7261 7465 2068 6973 746f 7279 202d  g rate history -
-00017620: 2075 7365 6420 746f 2073 656c 6563 7469   used to selecti
-00017630: 7665 6c79 206f 7665 7272 6964 6520 7468  vely override th
-00017640: 6973 2062 7920 7375 6263 6c61 7373 6573  is by subclasses
-00017650: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00017660: 2020 2020 2020 2320 4675 6e64 696e 6720        # Funding 
-00017670: 7261 7465 0a20 2020 2020 2020 2064 6174  rate.        dat
-00017680: 6120 3d20 6177 6169 7420 7365 6c66 2e5f  a = await self._
-00017690: 6170 695f 6173 796e 632e 6665 7463 685f  api_async.fetch_
-000176a0: 6675 6e64 696e 675f 7261 7465 5f68 6973  funding_rate_his
-000176b0: 746f 7279 280a 2020 2020 2020 2020 2020  tory(.          
-000176c0: 2020 7061 6972 2c20 7369 6e63 653d 7369    pair, since=si
-000176d0: 6e63 655f 6d73 2c0a 2020 2020 2020 2020  nce_ms,.        
-000176e0: 2020 2020 6c69 6d69 743d 6c69 6d69 7429      limit=limit)
-000176f0: 0a20 2020 2020 2020 2023 2043 6f6e 7665  .        # Conve
-00017700: 7274 2066 756e 6469 6e67 2072 6174 6520  rt funding rate 
-00017710: 746f 2063 616e 646c 6520 7061 7474 6572  to candle patter
-00017720: 6e0a 2020 2020 2020 2020 6461 7461 203d  n.        data =
-00017730: 205b 5b78 5b27 7469 6d65 7374 616d 7027   [[x['timestamp'
-00017740: 5d2c 2078 5b27 6675 6e64 696e 6752 6174  ], x['fundingRat
-00017750: 6527 5d2c 2030 2c20 302c 2030 2c20 305d  e'], 0, 0, 0, 0]
-00017760: 2066 6f72 2078 2069 6e20 6461 7461 5d0a   for x in data].
-00017770: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00017780: 6174 610a 0a20 2020 2023 2046 6574 6368  ata..    # Fetch
-00017790: 2068 6973 746f 7269 6320 7472 6164 6573   historic trades
-000177a0: 0a0a 2020 2020 4072 6574 7269 6572 5f61  ..    @retrier_a
-000177b0: 7379 6e63 0a20 2020 2061 7379 6e63 2064  sync.    async d
-000177c0: 6566 205f 6173 796e 635f 6665 7463 685f  ef _async_fetch_
-000177d0: 7472 6164 6573 2873 656c 662c 2070 6169  trades(self, pai
-000177e0: 723a 2073 7472 2c0a 2020 2020 2020 2020  r: str,.        
-000177f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017800: 2020 2020 2020 2020 2020 7369 6e63 653a            since:
-00017810: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-00017820: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00017830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017840: 2020 2020 2020 2020 2070 6172 616d 733a           params:
-00017850: 204f 7074 696f 6e61 6c5b 6469 6374 5d20   Optional[dict] 
-00017860: 3d20 4e6f 6e65 2920 2d3e 204c 6973 745b  = None) -> List[
-00017870: 4c69 7374 5d3a 0a20 2020 2020 2020 2022  List]:.        "
-00017880: 2222 0a20 2020 2020 2020 2041 7379 6e63  "".        Async
-00017890: 726f 6e6f 7573 6c79 2067 6574 7320 7472  ronously gets tr
-000178a0: 6164 6520 6869 7374 6f72 7920 7573 696e  ade history usin
-000178b0: 6720 6665 7463 685f 7472 6164 6573 2e0a  g fetch_trades..
-000178c0: 2020 2020 2020 2020 4861 6e64 6c65 7320          Handles 
-000178d0: 6578 6368 616e 6765 2065 7272 6f72 732c  exchange errors,
-000178e0: 2064 6f65 7320 6f6e 6520 6361 6c6c 2074   does one call t
-000178f0: 6f20 7468 6520 6578 6368 616e 6765 2e0a  o the exchange..
-00017900: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00017910: 6169 723a 2050 6169 7220 746f 2066 6574  air: Pair to fet
-00017920: 6368 2074 7261 6465 2064 6174 6120 666f  ch trade data fo
-00017930: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
-00017940: 2073 696e 6365 3a20 5369 6e63 6520 6173   since: Since as
-00017950: 2069 6e74 6567 6572 2074 696d 6573 7461   integer timesta
-00017960: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
-00017970: 6473 0a20 2020 2020 2020 2072 6574 7572  ds.        retur
-00017980: 6e73 3a20 4c69 7374 206f 6620 6469 6374  ns: List of dict
-00017990: 7320 636f 6e74 6169 6e69 6e67 2074 7261  s containing tra
-000179a0: 6465 730a 2020 2020 2020 2020 2222 220a  des.        """.
-000179b0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000179c0: 2020 2020 2020 2020 2023 2066 6574 6368           # fetch
-000179d0: 2074 7261 6465 7320 6173 796e 6368 726f   trades asynchro
-000179e0: 6e6f 7573 6c79 0a20 2020 2020 2020 2020  nously.         
-000179f0: 2020 2069 6620 7061 7261 6d73 3a0a 2020     if params:.  
-00017a00: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00017a10: 6767 6572 2e64 6562 7567 2822 4665 7463  gger.debug("Fetc
-00017a20: 6869 6e67 2074 7261 6465 7320 666f 7220  hing trades for 
-00017a30: 7061 6972 2025 732c 2070 6172 616d 733a  pair %s, params:
-00017a40: 2025 7320 222c 2070 6169 722c 2070 6172   %s ", pair, par
-00017a50: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
-00017a60: 2020 2020 2074 7261 6465 7320 3d20 6177       trades = aw
-00017a70: 6169 7420 7365 6c66 2e5f 6170 695f 6173  ait self._api_as
-00017a80: 796e 632e 6665 7463 685f 7472 6164 6573  ync.fetch_trades
-00017a90: 2870 6169 722c 2070 6172 616d 733d 7061  (pair, params=pa
-00017aa0: 7261 6d73 2c20 6c69 6d69 743d 3130 3030  rams, limit=1000
-00017ab0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00017ac0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00017ad0: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-00017ae0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00017af0: 2020 2020 2020 2246 6574 6368 696e 6720        "Fetching 
-00017b00: 7472 6164 6573 2066 6f72 2070 6169 7220  trades for pair 
-00017b10: 2573 2c20 7369 6e63 6520 2573 2025 732e  %s, since %s %s.
-00017b20: 2e2e 222c 0a20 2020 2020 2020 2020 2020  ..",.           
-00017b30: 2020 2020 2020 2020 2070 6169 722c 2073           pair, s
-00017b40: 696e 6365 2c0a 2020 2020 2020 2020 2020  ince,.          
-00017b50: 2020 2020 2020 2020 2020 2728 2720 2b20            '(' + 
-00017b60: 6172 726f 772e 6765 7428 7369 6e63 6520  arrow.get(since 
-00017b70: 2f2f 2031 3030 3029 2e69 736f 666f 726d  // 1000).isoform
-00017b80: 6174 2829 202b 2027 2920 2720 6966 2073  at() + ') ' if s
-00017b90: 696e 6365 2069 7320 6e6f 7420 4e6f 6e65  ince is not None
-00017ba0: 2065 6c73 6520 2727 0a20 2020 2020 2020   else ''.       
-00017bb0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00017bc0: 2020 2020 2020 2020 2020 2074 7261 6465             trade
-00017bd0: 7320 3d20 6177 6169 7420 7365 6c66 2e5f  s = await self._
-00017be0: 6170 695f 6173 796e 632e 6665 7463 685f  api_async.fetch_
-00017bf0: 7472 6164 6573 2870 6169 722c 2073 696e  trades(pair, sin
-00017c00: 6365 3d73 696e 6365 2c20 6c69 6d69 743d  ce=since, limit=
-00017c10: 3130 3030 290a 2020 2020 2020 2020 2020  1000).          
-00017c20: 2020 7472 6164 6573 203d 2073 656c 662e    trades = self.
-00017c30: 5f74 7261 6465 735f 636f 6e74 7261 6374  _trades_contract
-00017c40: 735f 746f 5f61 6d6f 756e 7428 7472 6164  s_to_amount(trad
-00017c50: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00017c60: 7265 7475 726e 2074 7261 6465 735f 6469  return trades_di
-00017c70: 6374 5f74 6f5f 6c69 7374 2874 7261 6465  ct_to_list(trade
-00017c80: 7329 0a20 2020 2020 2020 2065 7863 6570  s).        excep
-00017c90: 7420 6363 7874 2e4e 6f74 5375 7070 6f72  t ccxt.NotSuppor
-00017ca0: 7465 6420 6173 2065 3a0a 2020 2020 2020  ted as e:.      
-00017cb0: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
-00017cc0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
-00017cd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00017ce0: 2020 6627 4578 6368 616e 6765 207b 7365    f'Exchange {se
-00017cf0: 6c66 2e5f 6170 692e 6e61 6d65 7d20 646f  lf._api.name} do
-00017d00: 6573 206e 6f74 2073 7570 706f 7274 2066  es not support f
-00017d10: 6574 6368 696e 6720 6869 7374 6f72 6963  etching historic
-00017d20: 616c 2074 7261 6465 2064 6174 612e 270a  al trade data.'.
-00017d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d40: 6627 4d65 7373 6167 653a 207b 657d 2729  f'Message: {e}')
-00017d50: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-00017d60: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
-00017d70: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
-00017d80: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00017d90: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
-00017da0: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
-00017db0: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
-00017dc0: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
-00017dd0: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
-00017de0: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-00017df0: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
-00017e00: 7261 7279 4572 726f 7228 6627 436f 756c  raryError(f'Coul
-00017e10: 6420 6e6f 7420 6c6f 6164 2074 7261 6465  d not load trade
-00017e20: 2068 6973 746f 7279 2064 7565 2074 6f20   history due to 
-00017e30: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-00017e40: 616d 655f 5f7d 2e20 270a 2020 2020 2020  ame__}. '.      
-00017e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e60: 2020 2020 2020 2020 2020 2066 274d 6573             f'Mes
-00017e70: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
-00017e80: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00017e90: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
-00017ea0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00017eb0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00017ec0: 6f6e 616c 4578 6365 7074 696f 6e28 6627  onalException(f'
-00017ed0: 436f 756c 6420 6e6f 7420 6665 7463 6820  Could not fetch 
-00017ee0: 7472 6164 6520 6461 7461 2e20 4d73 673a  trade data. Msg:
-00017ef0: 207b 657d 2729 2066 726f 6d20 650a 0a20   {e}') from e.. 
-00017f00: 2020 2061 7379 6e63 2064 6566 205f 6173     async def _as
-00017f10: 796e 635f 6765 745f 7472 6164 655f 6869  ync_get_trade_hi
-00017f20: 7374 6f72 795f 6964 2873 656c 662c 2070  story_id(self, p
-00017f30: 6169 723a 2073 7472 2c0a 2020 2020 2020  air: str,.      
-00017f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f60: 2020 2020 756e 7469 6c3a 2069 6e74 2c0a      until: int,.
-00017f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f90: 2020 2020 2020 2020 2020 7369 6e63 653a            since:
-00017fa0: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-00017fb0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fe0: 2066 726f 6d5f 6964 3a20 4f70 7469 6f6e   from_id: Option
-00017ff0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2920  al[str] = None) 
-00018000: 2d3e 2054 7570 6c65 5b73 7472 2c20 4c69  -> Tuple[str, Li
-00018010: 7374 5b4c 6973 745d 5d3a 0a20 2020 2020  st[List]]:.     
-00018020: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
-00018030: 7379 6e63 726f 6e6f 7573 6c79 2067 6574  syncronously get
-00018040: 7320 7472 6164 6520 6869 7374 6f72 7920  s trade history 
-00018050: 7573 696e 6720 6665 7463 685f 7472 6164  using fetch_trad
-00018060: 6573 0a20 2020 2020 2020 2075 7365 2074  es.        use t
-00018070: 6869 7320 7768 656e 2065 7863 6861 6e67  his when exchang
-00018080: 6520 7573 6573 2069 642d 6261 7365 6420  e uses id-based 
-00018090: 6974 6572 6174 696f 6e20 2863 6865 636b  iteration (check
-000180a0: 2060 7365 6c66 2e5f 7472 6164 6573 5f70   `self._trades_p
-000180b0: 6167 696e 6174 696f 6e60 290a 2020 2020  agination`).    
-000180c0: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-000180d0: 2050 6169 7220 746f 2066 6574 6368 2074   Pair to fetch t
-000180e0: 7261 6465 2064 6174 6120 666f 720a 2020  rade data for.  
-000180f0: 2020 2020 2020 3a70 6172 616d 2073 696e        :param sin
-00018100: 6365 3a20 5369 6e63 6520 6173 2069 6e74  ce: Since as int
-00018110: 6567 6572 2074 696d 6573 7461 6d70 2069  eger timestamp i
-00018120: 6e20 6d69 6c6c 6973 6563 6f6e 6473 0a20  n milliseconds. 
-00018130: 2020 2020 2020 203a 7061 7261 6d20 756e         :param un
-00018140: 7469 6c3a 2055 6e74 696c 2061 7320 696e  til: Until as in
-00018150: 7465 6765 7220 7469 6d65 7374 616d 7020  teger timestamp 
-00018160: 696e 206d 696c 6c69 7365 636f 6e64 730a  in milliseconds.
-00018170: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-00018180: 726f 6d5f 6964 3a20 446f 776e 6c6f 6164  rom_id: Download
-00018190: 2064 6174 6120 7374 6172 7469 6e67 2077   data starting w
-000181a0: 6974 6820 4944 2028 6966 2069 6420 6973  ith ID (if id is
-000181b0: 206b 6e6f 776e 292e 2049 676e 6f72 6573   known). Ignores
-000181c0: 2022 7369 6e63 6522 2069 6620 7365 742e   "since" if set.
-000181d0: 0a20 2020 2020 2020 2072 6574 7572 6e73  .        returns
-000181e0: 2074 7570 6c65 3a20 2870 6169 722c 2074   tuple: (pair, t
-000181f0: 7261 6465 732d 6c69 7374 290a 2020 2020  rades-list).    
-00018200: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00018210: 2074 7261 6465 733a 204c 6973 745b 4c69   trades: List[Li
-00018220: 7374 5d20 3d20 5b5d 0a0a 2020 2020 2020  st] = []..      
-00018230: 2020 6966 206e 6f74 2066 726f 6d5f 6964    if not from_id
-00018240: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00018250: 4665 7463 6820 6669 7273 7420 656c 656d  Fetch first elem
-00018260: 656e 7473 2075 7369 6e67 2074 696d 6562  ents using timeb
-00018270: 6173 6564 206d 6574 686f 6420 746f 2067  ased method to g
-00018280: 6574 2061 6e20 4944 2074 6f20 7061 6769  et an ID to pagi
-00018290: 6e61 7465 206f 6e0a 2020 2020 2020 2020  nate on.        
-000182a0: 2020 2020 2320 4465 7065 6e64 696e 6720      # Depending 
-000182b0: 6f6e 2074 6865 2045 7863 6861 6e67 652c  on the Exchange,
-000182c0: 2074 6869 7320 6361 6e20 696e 7472 6f64   this can introd
-000182d0: 7563 6520 6120 6472 6966 7420 6174 2074  uce a drift at t
-000182e0: 6865 2073 7461 7274 206f 6620 7468 6520  he start of the 
-000182f0: 696e 7465 7276 616c 0a20 2020 2020 2020  interval.       
-00018300: 2020 2020 2023 206f 6620 7570 2074 6f20       # of up to 
-00018310: 616e 2068 6f75 722e 0a20 2020 2020 2020  an hour..       
-00018320: 2020 2020 2023 2065 2e67 2e20 4269 6e61       # e.g. Bina
-00018330: 6e63 6520 7265 7475 726e 7320 7468 6520  nce returns the 
-00018340: 226c 6173 7420 3130 3030 2220 6361 6e64  "last 1000" cand
-00018350: 6c65 7320 7769 7468 696e 2061 2031 6820  les within a 1h 
-00018360: 7469 6d65 2069 6e74 6572 7661 6c0a 2020  time interval.  
-00018370: 2020 2020 2020 2020 2020 2320 2d20 736f            # - so
-00018380: 2077 6520 7769 6c6c 206d 6973 7320 7468   we will miss th
-00018390: 6520 6669 7273 7420 7472 6164 6573 2e0a  e first trades..
-000183a0: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
-000183b0: 6177 6169 7420 7365 6c66 2e5f 6173 796e  await self._asyn
-000183c0: 635f 6665 7463 685f 7472 6164 6573 2870  c_fetch_trades(p
-000183d0: 6169 722c 2073 696e 6365 3d73 696e 6365  air, since=since
-000183e0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-000183f0: 4445 4641 554c 545f 5452 4144 4553 5f43  DEFAULT_TRADES_C
-00018400: 4f4c 554d 4e53 3a20 3020 2d3e 2074 696d  OLUMNS: 0 -> tim
-00018410: 6573 7461 6d70 0a20 2020 2020 2020 2020  estamp.         
-00018420: 2020 2023 2044 4546 4155 4c54 5f54 5241     # DEFAULT_TRA
-00018430: 4445 535f 434f 4c55 4d4e 533a 2031 202d  DES_COLUMNS: 1 -
-00018440: 3e20 6964 0a20 2020 2020 2020 2020 2020  > id.           
-00018450: 2066 726f 6d5f 6964 203d 2074 5b2d 315d   from_id = t[-1]
-00018460: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-00018470: 7472 6164 6573 2e65 7874 656e 6428 745b  trades.extend(t[
-00018480: 3a2d 315d 290a 2020 2020 2020 2020 7768  :-1]).        wh
-00018490: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
-000184a0: 2020 2020 2020 7420 3d20 6177 6169 7420        t = await 
-000184b0: 7365 6c66 2e5f 6173 796e 635f 6665 7463  self._async_fetc
-000184c0: 685f 7472 6164 6573 2870 6169 722c 0a20  h_trades(pair,. 
-000184d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184f0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00018500: 7261 6d73 3d7b 7365 6c66 2e5f 7472 6164  rams={self._trad
-00018510: 6573 5f70 6167 696e 6174 696f 6e5f 6172  es_pagination_ar
-00018520: 673a 2066 726f 6d5f 6964 7d29 0a20 2020  g: from_id}).   
-00018530: 2020 2020 2020 2020 2069 6620 743a 0a20           if t:. 
-00018540: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00018550: 2053 6b69 7020 6c61 7374 2069 6420 7369   Skip last id si
-00018560: 6e63 6520 6974 7320 7468 6520 6b65 7920  nce its the key 
-00018570: 666f 7220 7468 6520 6e65 7874 2063 616c  for the next cal
-00018580: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-00018590: 2020 7472 6164 6573 2e65 7874 656e 6428    trades.extend(
-000185a0: 745b 3a2d 315d 290a 2020 2020 2020 2020  t[:-1]).        
-000185b0: 2020 2020 2020 2020 6966 2066 726f 6d5f          if from_
-000185c0: 6964 203d 3d20 745b 2d31 5d5b 315d 206f  id == t[-1][1] o
-000185d0: 7220 745b 2d31 5d5b 305d 203e 2075 6e74  r t[-1][0] > unt
-000185e0: 696c 3a0a 2020 2020 2020 2020 2020 2020  il:.            
-000185f0: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-00018600: 6562 7567 2866 2253 746f 7070 696e 6720  ebug(f"Stopping 
-00018610: 6265 6361 7573 6520 6672 6f6d 5f69 6420  because from_id 
-00018620: 6469 6420 6e6f 7420 6368 616e 6765 2e20  did not change. 
-00018630: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00018640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018650: 2020 2066 2252 6561 6368 6564 207b 745b     f"Reached {t[
-00018660: 2d31 5d5b 305d 7d20 3e20 7b75 6e74 696c  -1][0]} > {until
-00018670: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00018680: 2020 2020 2020 2020 2320 5265 6163 6865          # Reache
-00018690: 6420 7468 6520 656e 6420 6f66 2074 6865  d the end of the
-000186a0: 2064 6566 696e 6564 2d64 6f77 6e6c 6f61   defined-downloa
-000186b0: 6420 7065 7269 6f64 202d 2061 6464 206c  d period - add l
-000186c0: 6173 7420 7472 6164 6520 6173 2077 656c  ast trade as wel
-000186d0: 6c2e 0a20 2020 2020 2020 2020 2020 2020  l..             
-000186e0: 2020 2020 2020 2074 7261 6465 732e 6578         trades.ex
-000186f0: 7465 6e64 2874 5b2d 313a 5d29 0a20 2020  tend(t[-1:]).   
+0000a480: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4a0: 2020 6669 6c6c 6564 5f61 6d6f 756e 7420    filled_amount 
+0000a4b0: 2b3d 2062 6f6f 6b5f 656e 7472 795f 636f  += book_entry_co
+0000a4c0: 696e 5f76 6f6c 756d 6520 2a20 626f 6f6b  in_volume * book
+0000a4d0: 5f65 6e74 7279 5f70 7269 6365 0a20 2020  _entry_price.   
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4f0: 2072 656d 6169 6e69 6e67 5f61 6d6f 756e   remaining_amoun
+0000a500: 7420 2d3d 2062 6f6f 6b5f 656e 7472 795f  t -= book_entry_
+0000a510: 636f 696e 5f76 6f6c 756d 650a 2020 2020  coin_volume.    
+0000a520: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000a530: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a540: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0000a550: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000a570: 4966 2072 656d 6169 6e69 6e67 5f61 6d6f  If remaining_amo
+0000a580: 756e 7420 7761 736e 2774 2063 6f6e 7375  unt wasn't consu
+0000a590: 6d65 6420 636f 6d70 6c65 7465 6c79 2028  med completely (
+0000a5a0: 6272 6561 6b20 7761 7320 6e6f 7420 6361  break was not ca
+0000a5b0: 6c6c 6564 290a 2020 2020 2020 2020 2020  lled).          
+0000a5c0: 2020 2020 2020 6669 6c6c 6564 5f61 6d6f        filled_amo
+0000a5d0: 756e 7420 2b3d 2072 656d 6169 6e69 6e67  unt += remaining
+0000a5e0: 5f61 6d6f 756e 7420 2a20 626f 6f6b 5f65  _amount * book_e
+0000a5f0: 6e74 7279 5f70 7269 6365 0a20 2020 2020  ntry_price.     
+0000a600: 2020 2020 2020 2066 6f72 6563 6173 745f         forecast_
+0000a610: 6176 675f 6669 6c6c 6564 5f70 7269 6365  avg_filled_price
+0000a620: 203d 206d 6178 2866 696c 6c65 645f 616d   = max(filled_am
+0000a630: 6f75 6e74 2c20 3029 202f 2061 6d6f 756e  ount, 0) / amoun
+0000a640: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
+0000a650: 4c69 6d69 7420 6d61 782e 2073 6c69 7070  Limit max. slipp
+0000a660: 6167 6520 746f 2073 7065 6369 6669 6564  age to specified
+0000a670: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
+0000a680: 2020 2069 6620 7369 6465 203d 3d20 2762     if side == 'b
+0000a690: 7579 273a 0a20 2020 2020 2020 2020 2020  uy':.           
+0000a6a0: 2020 2020 2066 6f72 6563 6173 745f 6176       forecast_av
+0000a6b0: 675f 6669 6c6c 6564 5f70 7269 6365 203d  g_filled_price =
+0000a6c0: 206d 696e 2866 6f72 6563 6173 745f 6176   min(forecast_av
+0000a6d0: 675f 6669 6c6c 6564 5f70 7269 6365 2c20  g_filled_price, 
+0000a6e0: 6d61 785f 736c 6970 7061 6765 5f76 616c  max_slippage_val
+0000a6f0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+0000a700: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000a710: 2020 2020 2066 6f72 6563 6173 745f 6176       forecast_av
+0000a720: 675f 6669 6c6c 6564 5f70 7269 6365 203d  g_filled_price =
+0000a730: 206d 6178 2866 6f72 6563 6173 745f 6176   max(forecast_av
+0000a740: 675f 6669 6c6c 6564 5f70 7269 6365 2c20  g_filled_price, 
+0000a750: 6d61 785f 736c 6970 7061 6765 5f76 616c  max_slippage_val
+0000a760: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+0000a770: 6574 7572 6e20 7365 6c66 2e70 7269 6365  eturn self.price
+0000a780: 5f74 6f5f 7072 6563 6973 696f 6e28 7061  _to_precision(pa
+0000a790: 6972 2c20 666f 7265 6361 7374 5f61 7667  ir, forecast_avg
+0000a7a0: 5f66 696c 6c65 645f 7072 6963 6529 0a0a  _filled_price)..
+0000a7b0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000a7c0: 6174 650a 0a20 2020 2064 6566 205f 6472  ate..    def _dr
+0000a7d0: 795f 6973 5f70 7269 6365 5f63 726f 7373  y_is_price_cross
+0000a7e0: 6564 2873 656c 662c 2070 6169 723a 2073  ed(self, pair: s
+0000a7f0: 7472 2c20 7369 6465 3a20 7374 722c 206c  tr, side: str, l
+0000a800: 696d 6974 3a20 666c 6f61 742c 0a20 2020  imit: float,.   
+0000a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a820: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000a830: 626f 6f6b 3a20 4f70 7469 6f6e 616c 5b4f  book: Optional[O
+0000a840: 7264 6572 426f 6f6b 5d20 3d20 4e6f 6e65  rderBook] = None
+0000a850: 2c20 6f66 6673 6574 3a20 666c 6f61 7420  , offset: float 
+0000a860: 3d20 302e 3029 202d 3e20 626f 6f6c 3a0a  = 0.0) -> bool:.
+0000a870: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0000a880: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
+0000a890: 2827 6665 7463 684c 324f 7264 6572 426f  ('fetchL2OrderBo
+0000a8a0: 6f6b 2729 3a0a 2020 2020 2020 2020 2020  ok'):.          
+0000a8b0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0000a8c0: 2020 2020 2020 6966 206e 6f74 206f 7264        if not ord
+0000a8d0: 6572 626f 6f6b 3a0a 2020 2020 2020 2020  erbook:.        
+0000a8e0: 2020 2020 6f72 6465 7262 6f6f 6b20 3d20      orderbook = 
+0000a8f0: 7365 6c66 2e66 6574 6368 5f6c 325f 6f72  self.fetch_l2_or
+0000a900: 6465 725f 626f 6f6b 2870 6169 722c 2031  der_book(pair, 1
+0000a910: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+0000a920: 2020 2020 2020 2020 2020 2069 6620 7369             if si
+0000a930: 6465 203d 3d20 2762 7579 273a 0a20 2020  de == 'buy':.   
+0000a940: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000a950: 6365 203d 206f 7264 6572 626f 6f6b 5b27  ce = orderbook['
+0000a960: 6173 6b73 275d 5b30 5d5b 305d 0a20 2020  asks'][0][0].   
+0000a970: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000a980: 6c69 6d69 7420 2a20 2831 202d 206f 6666  limit * (1 - off
+0000a990: 7365 7429 203e 3d20 7072 6963 653a 0a20  set) >= price:. 
+0000a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9b0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
+0000a9c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000a9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a9e0: 2070 7269 6365 203d 206f 7264 6572 626f   price = orderbo
+0000a9f0: 6f6b 5b27 6269 6473 275d 5b30 5d5b 305d  ok['bids'][0][0]
+0000aa00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aa10: 2069 6620 6c69 6d69 7420 2a20 2831 202b   if limit * (1 +
+0000aa20: 206f 6666 7365 7429 203c 3d20 7072 6963   offset) <= pric
+0000aa30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000aa40: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0000aa50: 7565 0a20 2020 2020 2020 2065 7863 6570  ue.        excep
+0000aa60: 7420 496e 6465 7845 7272 6f72 3a0a 2020  t IndexError:.  
+0000aa70: 2020 2020 2020 2020 2020 2320 4967 6e6f            # Igno
+0000aa80: 7265 2065 6d70 7479 206f 7264 6572 626f  re empty orderbo
+0000aa90: 6f6b 7320 7768 656e 2066 696c 6c69 6e67  oks when filling
+0000aaa0: 202d 2063 616e 2062 6520 6669 6c6c 6564   - can be filled
+0000aab0: 2077 6974 6820 7468 6520 6e65 7874 2069   with the next i
+0000aac0: 7465 7261 7469 6f6e 2e0a 2020 2020 2020  teration..      
+0000aad0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+0000aae0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0000aaf0: 0a20 2020 2064 6566 2063 6865 636b 5f64  .    def check_d
+0000ab00: 7279 5f6c 696d 6974 5f6f 7264 6572 5f66  ry_limit_order_f
+0000ab10: 696c 6c65 6428 0a20 2020 2020 2020 2020  illed(.         
+0000ab20: 2020 2073 656c 662c 206f 7264 6572 3a20     self, order: 
+0000ab30: 4469 6374 5b73 7472 2c20 416e 795d 2c20  Dict[str, Any], 
+0000ab40: 696d 6d65 6469 6174 653a 2062 6f6f 6c20  immediate: bool 
+0000ab50: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+0000ab60: 2020 2020 206f 7264 6572 626f 6f6b 3a20       orderbook: 
+0000ab70: 4f70 7469 6f6e 616c 5b4f 7264 6572 426f  Optional[OrderBo
+0000ab80: 6f6b 5d20 3d20 4e6f 6e65 2920 2d3e 2044  ok] = None) -> D
+0000ab90: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
+0000aba0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000abb0: 2020 2043 6865 636b 2064 7279 2d72 756e     Check dry-run
+0000abc0: 206c 696d 6974 206f 7264 6572 2066 696c   limit order fil
+0000abd0: 6c20 616e 6420 7570 6461 7465 2066 6565  l and update fee
+0000abe0: 2028 6966 2069 7420 6669 6c6c 6564 292e   (if it filled).
+0000abf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ac00: 2020 2020 2069 6620 286f 7264 6572 5b27       if (order['
+0000ac10: 7374 6174 7573 275d 2021 3d20 2263 6c6f  status'] != "clo
+0000ac20: 7365 6422 0a20 2020 2020 2020 2020 2020  sed".           
+0000ac30: 2020 2020 2061 6e64 206f 7264 6572 5b27       and order['
+0000ac40: 7479 7065 275d 2069 6e20 5b22 6c69 6d69  type'] in ["limi
+0000ac50: 7422 5d0a 2020 2020 2020 2020 2020 2020  t"].            
+0000ac60: 2020 2020 616e 6420 6e6f 7420 6f72 6465      and not orde
+0000ac70: 722e 6765 7428 2766 745f 6f72 6465 725f  r.get('ft_order_
+0000ac80: 7479 7065 2729 293a 0a20 2020 2020 2020  type')):.       
+0000ac90: 2020 2020 2070 6169 7220 3d20 6f72 6465       pair = orde
+0000aca0: 725b 2773 796d 626f 6c27 5d0a 2020 2020  r['symbol'].    
+0000acb0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000acc0: 5f64 7279 5f69 735f 7072 6963 655f 6372  _dry_is_price_cr
+0000acd0: 6f73 7365 6428 7061 6972 2c20 6f72 6465  ossed(pair, orde
+0000ace0: 725b 2773 6964 6527 5d2c 206f 7264 6572  r['side'], order
+0000acf0: 5b27 7072 6963 6527 5d2c 206f 7264 6572  ['price'], order
+0000ad00: 626f 6f6b 293a 0a20 2020 2020 2020 2020  book):.         
+0000ad10: 2020 2020 2020 206f 7264 6572 2e75 7064         order.upd
+0000ad20: 6174 6528 7b0a 2020 2020 2020 2020 2020  ate({.          
+0000ad30: 2020 2020 2020 2020 2020 2773 7461 7475            'statu
+0000ad40: 7327 3a20 2763 6c6f 7365 6427 2c0a 2020  s': 'closed',.  
+0000ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad60: 2020 2766 696c 6c65 6427 3a20 6f72 6465    'filled': orde
+0000ad70: 725b 2761 6d6f 756e 7427 5d2c 0a20 2020  r['amount'],.   
+0000ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad90: 2027 7265 6d61 696e 696e 6727 3a20 302c   'remaining': 0,
+0000ada0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000adb0: 207d 290a 0a20 2020 2020 2020 2020 2020   })..           
+0000adc0: 2020 2020 2073 656c 662e 6164 645f 6472       self.add_dr
+0000add0: 795f 6f72 6465 725f 6665 6528 0a20 2020  y_order_fee(.   
+0000ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000adf0: 2070 6169 722c 0a20 2020 2020 2020 2020   pair,.         
+0000ae00: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000ae10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ae20: 2020 2020 2020 2774 616b 6572 2720 6966        'taker' if
+0000ae30: 2069 6d6d 6564 6961 7465 2065 6c73 6520   immediate else 
+0000ae40: 276d 616b 6572 272c 0a20 2020 2020 2020  'maker',.       
+0000ae50: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000ae60: 2020 2020 7265 7475 726e 206f 7264 6572      return order
+0000ae70: 0a0a 2020 2020 6465 6620 6665 7463 685f  ..    def fetch_
+0000ae80: 6472 795f 7275 6e5f 6f72 6465 7228 7365  dry_run_order(se
+0000ae90: 6c66 2c20 6f72 6465 725f 6964 2920 2d3e  lf, order_id) ->
+0000aea0: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
+0000aeb0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000aec0: 2020 2020 2052 6574 7572 6e20 6472 792d       Return dry-
+0000aed0: 7275 6e20 6f72 6465 720a 2020 2020 2020  run order.      
+0000aee0: 2020 4f6e 6c79 2063 616c 6c20 6966 2072    Only call if r
+0000aef0: 756e 6e69 6e67 2069 6e20 6472 792d 7275  unning in dry-ru
+0000af00: 6e20 6d6f 6465 2e0a 2020 2020 2020 2020  n mode..        
+0000af10: 2222 220a 2020 2020 2020 2020 7472 793a  """.        try:
+0000af20: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+0000af30: 6572 203d 2073 656c 662e 5f64 7279 5f72  er = self._dry_r
+0000af40: 756e 5f6f 7065 6e5f 6f72 6465 7273 5b6f  un_open_orders[o
+0000af50: 7264 6572 5f69 645d 0a20 2020 2020 2020  rder_id].       
+0000af60: 2020 2020 206f 7264 6572 203d 2073 656c       order = sel
+0000af70: 662e 6368 6563 6b5f 6472 795f 6c69 6d69  f.check_dry_limi
+0000af80: 745f 6f72 6465 725f 6669 6c6c 6564 286f  t_order_filled(o
+0000af90: 7264 6572 290a 2020 2020 2020 2020 2020  rder).          
+0000afa0: 2020 7265 7475 726e 206f 7264 6572 0a20    return order. 
+0000afb0: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+0000afc0: 7945 7272 6f72 2061 7320 653a 0a20 2020  yError as e:.   
+0000afd0: 2020 2020 2020 2020 2066 726f 6d20 6672           from fr
+0000afe0: 6571 7472 6164 652e 7065 7273 6973 7465  eqtrade.persiste
+0000aff0: 6e63 6520 696d 706f 7274 204f 7264 6572  nce import Order
+0000b000: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+0000b010: 6572 203d 204f 7264 6572 2e6f 7264 6572  er = Order.order
+0000b020: 5f62 795f 6964 286f 7264 6572 5f69 6429  _by_id(order_id)
+0000b030: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000b040: 6f72 6465 723a 0a20 2020 2020 2020 2020  order:.         
+0000b050: 2020 2020 2020 2063 6378 745f 6f72 6465         ccxt_orde
+0000b060: 7220 3d20 6f72 6465 722e 746f 5f63 6378  r = order.to_ccx
+0000b070: 745f 6f62 6a65 6374 2829 0a20 2020 2020  t_object().     
+0000b080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b090: 5f64 7279 5f72 756e 5f6f 7065 6e5f 6f72  _dry_run_open_or
+0000b0a0: 6465 7273 5b6f 7264 6572 5f69 645d 203d  ders[order_id] =
+0000b0b0: 2063 6378 745f 6f72 6465 720a 2020 2020   ccxt_order.    
+0000b0c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000b0d0: 726e 2063 6378 745f 6f72 6465 720a 2020  rn ccxt_order.  
+0000b0e0: 2020 2020 2020 2020 2020 2320 4772 6163            # Grac
+0000b0f0: 6566 756c 6c79 2068 616e 646c 6520 6572  efully handle er
+0000b100: 726f 7273 2077 6974 6820 6472 792d 7275  rors with dry-ru
+0000b110: 6e20 6f72 6465 7273 2e0a 2020 2020 2020  n orders..      
+0000b120: 2020 2020 2020 7261 6973 6520 496e 7661        raise Inva
+0000b130: 6c69 644f 7264 6572 4578 6365 7074 696f  lidOrderExceptio
+0000b140: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+0000b150: 2020 2066 2754 7269 6564 2074 6f20 6765     f'Tried to ge
+0000b160: 7420 616e 2069 6e76 616c 6964 2064 7279  t an invalid dry
+0000b170: 2d72 756e 2d6f 7264 6572 2028 6964 3a20  -run-order (id: 
+0000b180: 7b6f 7264 6572 5f69 647d 292e 204d 6573  {order_id}). Mes
+0000b190: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
+0000b1a0: 2065 0a0a 2020 2020 2320 4f72 6465 7220   e..    # Order 
+0000b1b0: 6861 6e64 6c69 6e67 0a0a 2020 2020 6465  handling..    de
+0000b1c0: 6620 5f6c 6576 5f70 7265 7028 7365 6c66  f _lev_prep(self
+0000b1d0: 2c20 7061 6972 3a20 7374 722c 206c 6576  , pair: str, lev
+0000b1e0: 6572 6167 653a 2066 6c6f 6174 2c20 7369  erage: float, si
+0000b1f0: 6465 3a20 4275 7953 656c 6c2c 2061 6363  de: BuySell, acc
+0000b200: 6570 745f 6661 696c 3a20 626f 6f6c 203d  ept_fail: bool =
+0000b210: 2046 616c 7365 293a 0a20 2020 2020 2020   False):.       
+0000b220: 2069 6620 7365 6c66 2e74 7261 6469 6e67   if self.trading
+0000b230: 5f6d 6f64 6520 213d 2054 7261 6469 6e67  _mode != Trading
+0000b240: 4d6f 6465 2e53 504f 543a 0a20 2020 2020  Mode.SPOT:.     
+0000b250: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+0000b260: 6d61 7267 696e 5f6d 6f64 6528 7061 6972  margin_mode(pair
+0000b270: 2c20 7365 6c66 2e6d 6172 6769 6e5f 6d6f  , self.margin_mo
+0000b280: 6465 2c20 6163 6365 7074 5f66 6169 6c29  de, accept_fail)
+0000b290: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000b2a0: 662e 5f73 6574 5f6c 6576 6572 6167 6528  f._set_leverage(
+0000b2b0: 6c65 7665 7261 6765 2c20 7061 6972 2c20  leverage, pair, 
+0000b2c0: 6163 6365 7074 5f66 6169 6c29 0a0a 2020  accept_fail)..  
+0000b2d0: 2020 6465 6620 5f67 6574 5f70 6172 616d    def _get_param
+0000b2e0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+0000b2f0: 0a20 2020 2020 2020 2073 6964 653a 2042  .        side: B
+0000b300: 7579 5365 6c6c 2c0a 2020 2020 2020 2020  uySell,.        
+0000b310: 6f72 6465 7274 7970 653a 2073 7472 2c0a  ordertype: str,.
+0000b320: 2020 2020 2020 2020 6c65 7665 7261 6765          leverage
+0000b330: 3a20 666c 6f61 742c 0a20 2020 2020 2020  : float,.       
+0000b340: 2072 6564 7563 654f 6e6c 793a 2062 6f6f   reduceOnly: boo
+0000b350: 6c2c 0a20 2020 2020 2020 2074 696d 655f  l,.        time_
+0000b360: 696e 5f66 6f72 6365 3a20 7374 7220 3d20  in_force: str = 
+0000b370: 2747 5443 272c 0a20 2020 2029 202d 3e20  'GTC',.    ) -> 
+0000b380: 4469 6374 3a0a 2020 2020 2020 2020 7061  Dict:.        pa
+0000b390: 7261 6d73 203d 2073 656c 662e 5f70 6172  rams = self._par
+0000b3a0: 616d 732e 636f 7079 2829 0a20 2020 2020  ams.copy().     
+0000b3b0: 2020 2069 6620 7469 6d65 5f69 6e5f 666f     if time_in_fo
+0000b3c0: 7263 6520 213d 2027 4754 4327 2061 6e64  rce != 'GTC' and
+0000b3d0: 206f 7264 6572 7479 7065 2021 3d20 276d   ordertype != 'm
+0000b3e0: 6172 6b65 7427 3a0a 2020 2020 2020 2020  arket':.        
+0000b3f0: 2020 2020 7061 7261 6d73 2e75 7064 6174      params.updat
+0000b400: 6528 7b27 7469 6d65 496e 466f 7263 6527  e({'timeInForce'
+0000b410: 3a20 7469 6d65 5f69 6e5f 666f 7263 652e  : time_in_force.
+0000b420: 7570 7065 7228 297d 290a 2020 2020 2020  upper()}).      
+0000b430: 2020 6966 2072 6564 7563 654f 6e6c 793a    if reduceOnly:
+0000b440: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+0000b450: 616d 732e 7570 6461 7465 287b 2772 6564  ams.update({'red
+0000b460: 7563 654f 6e6c 7927 3a20 5472 7565 7d29  uceOnly': True})
+0000b470: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000b480: 7061 7261 6d73 0a0a 2020 2020 6465 6620  params..    def 
+0000b490: 5f6f 7264 6572 5f6e 6565 6473 5f70 7269  _order_needs_pri
+0000b4a0: 6365 2873 656c 662c 206f 7264 6572 7479  ce(self, orderty
+0000b4b0: 7065 3a20 7374 7229 202d 3e20 626f 6f6c  pe: str) -> bool
+0000b4c0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000b4d0: 2028 0a20 2020 2020 2020 2020 2020 206f   (.            o
+0000b4e0: 7264 6572 7479 7065 2021 3d20 276d 6172  rdertype != 'mar
+0000b4f0: 6b65 7427 0a20 2020 2020 2020 2020 2020  ket'.           
+0000b500: 206f 7220 7365 6c66 2e5f 6170 692e 6f70   or self._api.op
+0000b510: 7469 6f6e 732e 6765 7428 2263 7265 6174  tions.get("creat
+0000b520: 654d 6172 6b65 7442 7579 4f72 6465 7252  eMarketBuyOrderR
+0000b530: 6571 7569 7265 7350 7269 6365 222c 2046  equiresPrice", F
+0000b540: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+0000b550: 2020 6f72 2073 656c 662e 5f66 745f 6861    or self._ft_ha
+0000b560: 732e 6765 7428 276d 6172 6b65 744f 7264  s.get('marketOrd
+0000b570: 6572 5265 7175 6972 6573 5072 6963 6527  erRequiresPrice'
+0000b580: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
+0000b590: 2029 0a0a 2020 2020 6465 6620 6372 6561   )..    def crea
+0000b5a0: 7465 5f6f 7264 6572 280a 2020 2020 2020  te_order(.      
+0000b5b0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000b5c0: 2a2c 0a20 2020 2020 2020 2070 6169 723a  *,.        pair:
+0000b5d0: 2073 7472 2c0a 2020 2020 2020 2020 6f72   str,.        or
+0000b5e0: 6465 7274 7970 653a 2073 7472 2c0a 2020  dertype: str,.  
+0000b5f0: 2020 2020 2020 7369 6465 3a20 4275 7953        side: BuyS
+0000b600: 656c 6c2c 0a20 2020 2020 2020 2061 6d6f  ell,.        amo
+0000b610: 756e 743a 2066 6c6f 6174 2c0a 2020 2020  unt: float,.    
+0000b620: 2020 2020 7261 7465 3a20 666c 6f61 742c      rate: float,
+0000b630: 0a20 2020 2020 2020 206c 6576 6572 6167  .        leverag
+0000b640: 653a 2066 6c6f 6174 2c0a 2020 2020 2020  e: float,.      
+0000b650: 2020 7265 6475 6365 4f6e 6c79 3a20 626f    reduceOnly: bo
+0000b660: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+0000b670: 2020 2020 7469 6d65 5f69 6e5f 666f 7263      time_in_forc
+0000b680: 653a 2073 7472 203d 2027 4754 4327 2c0a  e: str = 'GTC',.
+0000b690: 2020 2020 2920 2d3e 2044 6963 743a 0a20      ) -> Dict:. 
+0000b6a0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+0000b6b0: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
+0000b6c0: 5d3a 0a20 2020 2020 2020 2020 2020 2064  ]:.            d
+0000b6d0: 7279 5f6f 7264 6572 203d 2073 656c 662e  ry_order = self.
+0000b6e0: 6372 6561 7465 5f64 7279 5f72 756e 5f6f  create_dry_run_o
+0000b6f0: 7264 6572 280a 2020 2020 2020 2020 2020  rder(.          
+0000b700: 2020 2020 2020 7061 6972 2c20 6f72 6465        pair, orde
+0000b710: 7274 7970 652c 2073 6964 652c 2061 6d6f  rtype, side, amo
+0000b720: 756e 742c 2073 656c 662e 7072 6963 655f  unt, self.price_
+0000b730: 746f 5f70 7265 6369 7369 6f6e 2870 6169  to_precision(pai
+0000b740: 722c 2072 6174 6529 2c20 6c65 7665 7261  r, rate), levera
+0000b750: 6765 290a 2020 2020 2020 2020 2020 2020  ge).            
+0000b760: 7265 7475 726e 2064 7279 5f6f 7264 6572  return dry_order
+0000b770: 0a0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
+0000b780: 203d 2073 656c 662e 5f67 6574 5f70 6172   = self._get_par
+0000b790: 616d 7328 7369 6465 2c20 6f72 6465 7274  ams(side, ordert
+0000b7a0: 7970 652c 206c 6576 6572 6167 652c 2072  ype, leverage, r
+0000b7b0: 6564 7563 654f 6e6c 792c 2074 696d 655f  educeOnly, time_
+0000b7c0: 696e 5f66 6f72 6365 290a 0a20 2020 2020  in_force)..     
+0000b7d0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000b7e0: 2020 2020 2320 5365 7420 7468 6520 7072      # Set the pr
+0000b7f0: 6563 6973 696f 6e20 666f 7220 616d 6f75  ecision for amou
+0000b800: 6e74 2061 6e64 2070 7269 6365 2872 6174  nt and price(rat
+0000b810: 6529 2061 7320 6163 6365 7074 6564 2062  e) as accepted b
+0000b820: 7920 7468 6520 6578 6368 616e 6765 0a20  y the exchange. 
+0000b830: 2020 2020 2020 2020 2020 2061 6d6f 756e             amoun
+0000b840: 7420 3d20 7365 6c66 2e61 6d6f 756e 745f  t = self.amount_
+0000b850: 746f 5f70 7265 6369 7369 6f6e 2870 6169  to_precision(pai
+0000b860: 722c 2073 656c 662e 5f61 6d6f 756e 745f  r, self._amount_
+0000b870: 746f 5f63 6f6e 7472 6163 7473 2870 6169  to_contracts(pai
+0000b880: 722c 2061 6d6f 756e 7429 290a 2020 2020  r, amount)).    
+0000b890: 2020 2020 2020 2020 6e65 6564 735f 7072          needs_pr
+0000b8a0: 6963 6520 3d20 7365 6c66 2e5f 6f72 6465  ice = self._orde
+0000b8b0: 725f 6e65 6564 735f 7072 6963 6528 6f72  r_needs_price(or
+0000b8c0: 6465 7274 7970 6529 0a20 2020 2020 2020  dertype).       
+0000b8d0: 2020 2020 2072 6174 655f 666f 725f 6f72       rate_for_or
+0000b8e0: 6465 7220 3d20 7365 6c66 2e70 7269 6365  der = self.price
+0000b8f0: 5f74 6f5f 7072 6563 6973 696f 6e28 7061  _to_precision(pa
+0000b900: 6972 2c20 7261 7465 2920 6966 206e 6565  ir, rate) if nee
+0000b910: 6473 5f70 7269 6365 2065 6c73 6520 4e6f  ds_price else No
+0000b920: 6e65 0a0a 2020 2020 2020 2020 2020 2020  ne..            
+0000b930: 6966 206e 6f74 2072 6564 7563 654f 6e6c  if not reduceOnl
+0000b940: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000b950: 2020 2073 656c 662e 5f6c 6576 5f70 7265     self._lev_pre
+0000b960: 7028 7061 6972 2c20 6c65 7665 7261 6765  p(pair, leverage
+0000b970: 2c20 7369 6465 290a 0a20 2020 2020 2020  , side)..       
+0000b980: 2020 2020 206f 7264 6572 203d 2073 656c       order = sel
+0000b990: 662e 5f61 7069 2e63 7265 6174 655f 6f72  f._api.create_or
+0000b9a0: 6465 7228 0a20 2020 2020 2020 2020 2020  der(.           
+0000b9b0: 2020 2020 2070 6169 722c 0a20 2020 2020       pair,.     
+0000b9c0: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000b9d0: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
+0000b9e0: 2020 2020 2020 7369 6465 2c0a 2020 2020        side,.    
+0000b9f0: 2020 2020 2020 2020 2020 2020 616d 6f75              amou
+0000ba00: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+0000ba10: 2020 2020 7261 7465 5f66 6f72 5f6f 7264      rate_for_ord
+0000ba20: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+0000ba30: 2020 2020 7061 7261 6d73 2c0a 2020 2020      params,.    
+0000ba40: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000ba50: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
+0000ba60: 6578 6368 616e 6765 5f72 6573 706f 6e73  exchange_respons
+0000ba70: 6528 2763 7265 6174 655f 6f72 6465 7227  e('create_order'
+0000ba80: 2c20 6f72 6465 7229 0a20 2020 2020 2020  , order).       
+0000ba90: 2020 2020 206f 7264 6572 203d 2073 656c       order = sel
+0000baa0: 662e 5f6f 7264 6572 5f63 6f6e 7472 6163  f._order_contrac
+0000bab0: 7473 5f74 6f5f 616d 6f75 6e74 286f 7264  ts_to_amount(ord
+0000bac0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0000bad0: 7265 7475 726e 206f 7264 6572 0a0a 2020  return order..  
+0000bae0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0000baf0: 742e 496e 7375 6666 6963 6965 6e74 4675  t.InsufficientFu
+0000bb00: 6e64 7320 6173 2065 3a0a 2020 2020 2020  nds as e:.      
+0000bb10: 2020 2020 2020 7261 6973 6520 496e 7375        raise Insu
+0000bb20: 6666 6963 6965 6e74 4675 6e64 7345 7272  fficientFundsErr
+0000bb30: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000bb40: 2020 2020 6627 496e 7375 6666 6963 6965      f'Insufficie
+0000bb50: 6e74 2066 756e 6473 2074 6f20 6372 6561  nt funds to crea
+0000bb60: 7465 207b 6f72 6465 7274 7970 657d 207b  te {ordertype} {
+0000bb70: 7369 6465 7d20 6f72 6465 7220 6f6e 206d  side} order on m
+0000bb80: 6172 6b65 7420 7b70 6169 727d 2e20 270a  arket {pair}. '.
+0000bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bba0: 6627 5472 6965 6420 746f 207b 7369 6465  f'Tried to {side
+0000bbb0: 7d20 616d 6f75 6e74 207b 616d 6f75 6e74  } amount {amount
+0000bbc0: 7d20 6174 2072 6174 6520 7b72 6174 657d  } at rate {rate}
+0000bbd0: 2e27 0a20 2020 2020 2020 2020 2020 2020  .'.             
+0000bbe0: 2020 2066 274d 6573 7361 6765 3a20 7b65     f'Message: {e
+0000bbf0: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+0000bc00: 2020 2065 7863 6570 7420 6363 7874 2e49     except ccxt.I
+0000bc10: 6e76 616c 6964 4f72 6465 7220 6173 2065  nvalidOrder as e
+0000bc20: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000bc30: 6973 6520 496e 7661 6c69 644f 7264 6572  ise InvalidOrder
+0000bc40: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
+0000bc50: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+0000bc60: 6c64 206e 6f74 2063 7265 6174 6520 7b6f  ld not create {o
+0000bc70: 7264 6572 7479 7065 7d20 7b73 6964 657d  rdertype} {side}
+0000bc80: 206f 7264 6572 206f 6e20 6d61 726b 6574   order on market
+0000bc90: 207b 7061 6972 7d2e 2027 0a20 2020 2020   {pair}. '.     
+0000bca0: 2020 2020 2020 2020 2020 2066 2754 7269             f'Tri
+0000bcb0: 6564 2074 6f20 7b73 6964 657d 2061 6d6f  ed to {side} amo
+0000bcc0: 756e 7420 7b61 6d6f 756e 747d 2061 7420  unt {amount} at 
+0000bcd0: 7261 7465 207b 7261 7465 7d2e 2027 0a20  rate {rate}. '. 
+0000bce0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000bcf0: 274d 6573 7361 6765 3a20 7b65 7d27 2920  'Message: {e}') 
+0000bd00: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+0000bd10: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
+0000bd20: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
+0000bd30: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000bd40: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
+0000bd50: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
+0000bd60: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
+0000bd70: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
+0000bd80: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
+0000bd90: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
+0000bda0: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
+0000bdb0: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
+0000bdc0: 2020 2020 2020 2020 2020 6627 436f 756c            f'Coul
+0000bdd0: 6420 6e6f 7420 706c 6163 6520 7b73 6964  d not place {sid
+0000bde0: 657d 206f 7264 6572 2064 7565 2074 6f20  e} order due to 
+0000bdf0: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+0000be00: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+0000be10: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+0000be20: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0000be30: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
+0000be40: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000be50: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0000be60: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
+0000be70: 2065 0a0a 2020 2020 6465 6620 7374 6f70   e..    def stop
+0000be80: 6c6f 7373 5f61 646a 7573 7428 7365 6c66  loss_adjust(self
+0000be90: 2c20 7374 6f70 5f6c 6f73 733a 2066 6c6f  , stop_loss: flo
+0000bea0: 6174 2c20 6f72 6465 723a 2044 6963 742c  at, order: Dict,
+0000beb0: 2073 6964 653a 2073 7472 2920 2d3e 2062   side: str) -> b
+0000bec0: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+0000bed0: 0a20 2020 2020 2020 2056 6572 6966 7920  .        Verify 
+0000bee0: 7374 6f70 5f6c 6f73 7320 6167 6169 6e73  stop_loss agains
+0000bef0: 7420 7374 6f70 6c6f 7373 2d6f 7264 6572  t stoploss-order
+0000bf00: 2076 616c 7565 2028 6c69 6d69 7420 6f72   value (limit or
+0000bf10: 2070 7269 6365 290a 2020 2020 2020 2020   price).        
+0000bf20: 5265 7475 726e 7320 5472 7565 2069 6620  Returns True if 
+0000bf30: 6164 6a75 7374 6d65 6e74 2069 7320 6e65  adjustment is ne
+0000bf40: 6365 7373 6172 792e 0a20 2020 2020 2020  cessary..       
+0000bf50: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0000bf60: 6e6f 7420 7365 6c66 2e5f 6674 5f68 6173  not self._ft_has
+0000bf70: 2e67 6574 2827 7374 6f70 6c6f 7373 5f6f  .get('stoploss_o
+0000bf80: 6e5f 6578 6368 616e 6765 2729 3a0a 2020  n_exchange'):.  
+0000bf90: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000bfa0: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
+0000bfb0: 7469 6f6e 2866 2273 746f 706c 6f73 7320  tion(f"stoploss 
+0000bfc0: 6973 206e 6f74 2069 6d70 6c65 6d65 6e74  is not implement
+0000bfd0: 6564 2066 6f72 207b 7365 6c66 2e6e 616d  ed for {self.nam
+0000bfe0: 657d 2e22 290a 2020 2020 2020 2020 7072  e}.").        pr
+0000bff0: 6963 655f 7061 7261 6d20 3d20 7365 6c66  ice_param = self
+0000c000: 2e5f 6674 5f68 6173 5b27 7374 6f70 5f70  ._ft_has['stop_p
+0000c010: 7269 6365 5f70 6172 616d 275d 0a20 2020  rice_param'].   
+0000c020: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
+0000c030: 2020 2020 2020 2020 2020 6f72 6465 722e            order.
+0000c040: 6765 7428 7072 6963 655f 7061 7261 6d2c  get(price_param,
+0000c050: 204e 6f6e 6529 2069 7320 4e6f 6e65 0a20   None) is None. 
+0000c060: 2020 2020 2020 2020 2020 206f 7220 2828             or ((
+0000c070: 7369 6465 203d 3d20 2273 656c 6c22 2061  side == "sell" a
+0000c080: 6e64 2073 746f 705f 6c6f 7373 203e 2066  nd stop_loss > f
+0000c090: 6c6f 6174 286f 7264 6572 5b70 7269 6365  loat(order[price
+0000c0a0: 5f70 6172 616d 5d29 2920 6f72 0a20 2020  _param])) or.   
+0000c0b0: 2020 2020 2020 2020 2020 2020 2028 7369               (si
+0000c0c0: 6465 203d 3d20 2262 7579 2220 616e 6420  de == "buy" and 
+0000c0d0: 7374 6f70 5f6c 6f73 7320 3c20 666c 6f61  stop_loss < floa
+0000c0e0: 7428 6f72 6465 725b 7072 6963 655f 7061  t(order[price_pa
+0000c0f0: 7261 6d5d 2929 290a 2020 2020 2020 2020  ram]))).        
+0000c100: 290a 0a20 2020 2064 6566 205f 6765 745f  )..    def _get_
+0000c110: 7374 6f70 5f6f 7264 6572 5f74 7970 6528  stop_order_type(
+0000c120: 7365 6c66 2c20 7573 6572 5f6f 7264 6572  self, user_order
+0000c130: 5f74 7970 6529 202d 3e20 5475 706c 655b  _type) -> Tuple[
+0000c140: 7374 722c 2073 7472 5d3a 0a0a 2020 2020  str, str]:..    
+0000c150: 2020 2020 6176 6169 6c61 626c 655f 6f72      available_or
+0000c160: 6465 725f 5479 7065 733a 2044 6963 745b  der_Types: Dict[
+0000c170: 7374 722c 2073 7472 5d20 3d20 7365 6c66  str, str] = self
+0000c180: 2e5f 6674 5f68 6173 5b22 7374 6f70 6c6f  ._ft_has["stoplo
+0000c190: 7373 5f6f 7264 6572 5f74 7970 6573 225d  ss_order_types"]
+0000c1a0: 0a0a 2020 2020 2020 2020 6966 2075 7365  ..        if use
+0000c1b0: 725f 6f72 6465 725f 7479 7065 2069 6e20  r_order_type in 
+0000c1c0: 6176 6169 6c61 626c 655f 6f72 6465 725f  available_order_
+0000c1d0: 5479 7065 732e 6b65 7973 2829 3a0a 2020  Types.keys():.  
+0000c1e0: 2020 2020 2020 2020 2020 6f72 6465 7274            ordert
+0000c1f0: 7970 6520 3d20 6176 6169 6c61 626c 655f  ype = available_
+0000c200: 6f72 6465 725f 5479 7065 735b 7573 6572  order_Types[user
+0000c210: 5f6f 7264 6572 5f74 7970 655d 0a20 2020  _order_type].   
+0000c220: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000c230: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
+0000c240: 7365 2070 6963 6b20 6f6e 6c79 206f 6e65  se pick only one
+0000c250: 2061 7661 696c 6162 6c65 0a20 2020 2020   available.     
+0000c260: 2020 2020 2020 206f 7264 6572 7479 7065         ordertype
+0000c270: 203d 206c 6973 7428 6176 6169 6c61 626c   = list(availabl
+0000c280: 655f 6f72 6465 725f 5479 7065 732e 7661  e_order_Types.va
+0000c290: 6c75 6573 2829 295b 305d 0a20 2020 2020  lues())[0].     
+0000c2a0: 2020 2020 2020 2075 7365 725f 6f72 6465         user_orde
+0000c2b0: 725f 7479 7065 203d 206c 6973 7428 6176  r_type = list(av
+0000c2c0: 6169 6c61 626c 655f 6f72 6465 725f 5479  ailable_order_Ty
+0000c2d0: 7065 732e 6b65 7973 2829 295b 305d 0a20  pes.keys())[0]. 
+0000c2e0: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
+0000c2f0: 6465 7274 7970 652c 2075 7365 725f 6f72  dertype, user_or
+0000c300: 6465 725f 7479 7065 0a0a 2020 2020 6465  der_type..    de
+0000c310: 6620 5f67 6574 5f73 746f 705f 6c69 6d69  f _get_stop_limi
+0000c320: 745f 7261 7465 2873 656c 662c 2073 746f  t_rate(self, sto
+0000c330: 705f 7072 6963 653a 2066 6c6f 6174 2c20  p_price: float, 
+0000c340: 6f72 6465 725f 7479 7065 733a 2044 6963  order_types: Dic
+0000c350: 742c 2073 6964 653a 2073 7472 2920 2d3e  t, side: str) ->
+0000c360: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
+0000c370: 2320 4c69 6d69 7420 7072 6963 6520 7468  # Limit price th
+0000c380: 7265 7368 6f6c 643a 2041 7320 6c69 6d69  reshold: As limi
+0000c390: 7420 7072 6963 6520 7368 6f75 6c64 2061  t price should a
+0000c3a0: 6c77 6179 7320 6265 2062 656c 6f77 2073  lways be below s
+0000c3b0: 746f 702d 7072 6963 650a 2020 2020 2020  top-price.      
+0000c3c0: 2020 6c69 6d69 745f 7072 6963 655f 7063    limit_price_pc
+0000c3d0: 7420 3d20 6f72 6465 725f 7479 7065 732e  t = order_types.
+0000c3e0: 6765 7428 2773 746f 706c 6f73 735f 6f6e  get('stoploss_on
+0000c3f0: 5f65 7863 6861 6e67 655f 6c69 6d69 745f  _exchange_limit_
+0000c400: 7261 7469 6f27 2c20 302e 3939 290a 2020  ratio', 0.99).  
+0000c410: 2020 2020 2020 6966 2073 6964 6520 3d3d        if side ==
+0000c420: 2022 7365 6c6c 223a 0a20 2020 2020 2020   "sell":.       
+0000c430: 2020 2020 206c 696d 6974 5f72 6174 6520       limit_rate 
+0000c440: 3d20 7374 6f70 5f70 7269 6365 202a 206c  = stop_price * l
+0000c450: 696d 6974 5f70 7269 6365 5f70 6374 0a20  imit_price_pct. 
+0000c460: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000c470: 2020 2020 2020 2020 206c 696d 6974 5f72           limit_r
+0000c480: 6174 6520 3d20 7374 6f70 5f70 7269 6365  ate = stop_price
+0000c490: 202a 2028 3220 2d20 6c69 6d69 745f 7072   * (2 - limit_pr
+0000c4a0: 6963 655f 7063 7429 0a0a 2020 2020 2020  ice_pct)..      
+0000c4b0: 2020 6261 645f 7374 6f70 5f70 7269 6365    bad_stop_price
+0000c4c0: 203d 2028 2873 746f 705f 7072 6963 6520   = ((stop_price 
+0000c4d0: 3c3d 206c 696d 6974 5f72 6174 6529 2069  <= limit_rate) i
+0000c4e0: 6620 7369 6465 203d 3d0a 2020 2020 2020  f side ==.      
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c500: 2020 2020 2273 656c 6c22 2065 6c73 6520      "sell" else 
+0000c510: 2873 746f 705f 7072 6963 6520 3e3d 206c  (stop_price >= l
+0000c520: 696d 6974 5f72 6174 6529 290a 2020 2020  imit_rate)).    
+0000c530: 2020 2020 2320 456e 7375 7265 2072 6174      # Ensure rat
+0000c540: 6520 6973 206c 6573 7320 7468 616e 2073  e is less than s
+0000c550: 746f 7020 7072 6963 650a 2020 2020 2020  top price.      
+0000c560: 2020 6966 2062 6164 5f73 746f 705f 7072    if bad_stop_pr
+0000c570: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
+0000c580: 2023 2054 6869 7320 6361 6e20 666f 7220   # This can for 
+0000c590: 6578 616d 706c 6520 6861 7070 656e 2069  example happen i
+0000c5a0: 6620 7468 6520 7374 6f70 202f 206c 6971  f the stop / liq
+0000c5b0: 7569 6461 7469 6f6e 2070 7269 6365 2069  uidation price i
+0000c5c0: 7320 7365 7420 746f 2030 0a20 2020 2020  s set to 0.     
+0000c5d0: 2020 2020 2020 2023 2057 6869 6368 2069         # Which i
+0000c5e0: 7320 706f 7373 6962 6c65 2069 6620 6120  s possible if a 
+0000c5f0: 6d61 726b 6574 2d6f 7264 6572 2063 6c6f  market-order clo
+0000c600: 7365 7320 7269 6768 7420 6177 6179 2e0a  ses right away..
+0000c610: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+0000c620: 6520 496e 7661 6c69 644f 7264 6572 4578  e InvalidOrderEx
+0000c630: 6365 7074 696f 6e20 7769 6c6c 2062 7562  ception will bub
+0000c640: 626c 6520 7570 2074 6f20 6578 6974 5f70  ble up to exit_p
+0000c650: 6f73 6974 696f 6e73 2c20 7768 6572 6520  ositions, where 
+0000c660: 6974 2077 696c 6c20 6265 0a20 2020 2020  it will be.     
+0000c670: 2020 2020 2020 2023 2068 616e 646c 6564         # handled
+0000c680: 2067 7261 6365 6675 6c6c 792e 0a20 2020   gracefully..   
+0000c690: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
+0000c6a0: 6e76 616c 6964 4f72 6465 7245 7863 6570  nvalidOrderExcep
+0000c6b0: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
+0000c6c0: 2020 2020 2020 2249 6e20 7374 6f70 6c6f        "In stoplo
+0000c6d0: 7373 206c 696d 6974 206f 7264 6572 2c20  ss limit order, 
+0000c6e0: 7374 6f70 2070 7269 6365 2073 686f 756c  stop price shoul
+0000c6f0: 6420 6265 206d 6f72 6520 7468 616e 206c  d be more than l
+0000c700: 696d 6974 2070 7269 6365 2e20 220a 2020  imit price. ".  
+0000c710: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0000c720: 5374 6f70 2070 7269 6365 3a20 7b73 746f  Stop price: {sto
+0000c730: 705f 7072 6963 657d 2c20 4c69 6d69 7420  p_price}, Limit 
+0000c740: 7072 6963 653a 207b 6c69 6d69 745f 7261  price: {limit_ra
+0000c750: 7465 7d2c 2022 0a20 2020 2020 2020 2020  te}, ".         
+0000c760: 2020 2020 2020 2066 224c 696d 6974 2050         f"Limit P
+0000c770: 7269 6365 2070 6374 3a20 7b6c 696d 6974  rice pct: {limit
+0000c780: 5f70 7269 6365 5f70 6374 7d22 0a20 2020  _price_pct}".   
+0000c790: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000c7a0: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
+0000c7b0: 6d69 745f 7261 7465 0a0a 2020 2020 6465  mit_rate..    de
+0000c7c0: 6620 5f67 6574 5f73 746f 705f 7061 7261  f _get_stop_para
+0000c7d0: 6d73 2873 656c 662c 2073 6964 653a 2042  ms(self, side: B
+0000c7e0: 7579 5365 6c6c 2c20 6f72 6465 7274 7970  uySell, ordertyp
+0000c7f0: 653a 2073 7472 2c20 7374 6f70 5f70 7269  e: str, stop_pri
+0000c800: 6365 3a20 666c 6f61 7429 202d 3e20 4469  ce: float) -> Di
+0000c810: 6374 3a0a 2020 2020 2020 2020 7061 7261  ct:.        para
+0000c820: 6d73 203d 2073 656c 662e 5f70 6172 616d  ms = self._param
+0000c830: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
+0000c840: 2023 2056 6572 6966 7920 6966 2073 746f   # Verify if sto
+0000c850: 7050 7269 6365 2077 6f72 6b73 2066 6f72  pPrice works for
+0000c860: 2079 6f75 7220 6578 6368 616e 6765 2c20   your exchange, 
+0000c870: 656c 7365 2063 6f6e 6669 6775 7265 2073  else configure s
+0000c880: 746f 705f 7072 6963 655f 7061 7261 6d0a  top_price_param.
+0000c890: 2020 2020 2020 2020 7061 7261 6d73 2e75          params.u
+0000c8a0: 7064 6174 6528 7b73 656c 662e 5f66 745f  pdate({self._ft_
+0000c8b0: 6861 735b 2773 746f 705f 7072 6963 655f  has['stop_price_
+0000c8c0: 7061 7261 6d27 5d3a 2073 746f 705f 7072  param']: stop_pr
+0000c8d0: 6963 657d 290a 2020 2020 2020 2020 7265  ice}).        re
+0000c8e0: 7475 726e 2070 6172 616d 730a 0a20 2020  turn params..   
+0000c8f0: 2040 7265 7472 6965 7228 7265 7472 6965   @retrier(retrie
+0000c900: 733d 3029 0a20 2020 2064 6566 2063 7265  s=0).    def cre
+0000c910: 6174 655f 7374 6f70 6c6f 7373 2873 656c  ate_stoploss(sel
+0000c920: 662c 2070 6169 723a 2073 7472 2c20 616d  f, pair: str, am
+0000c930: 6f75 6e74 3a20 666c 6f61 742c 2073 746f  ount: float, sto
+0000c940: 705f 7072 6963 653a 2066 6c6f 6174 2c20  p_price: float, 
+0000c950: 6f72 6465 725f 7479 7065 733a 2044 6963  order_types: Dic
+0000c960: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0000c970: 2020 2020 2020 2020 2020 2073 6964 653a             side:
+0000c980: 2042 7579 5365 6c6c 2c20 6c65 7665 7261   BuySell, levera
+0000c990: 6765 3a20 666c 6f61 7429 202d 3e20 4469  ge: float) -> Di
+0000c9a0: 6374 3a0a 2020 2020 2020 2020 2222 220a  ct:.        """.
+0000c9b0: 2020 2020 2020 2020 6372 6561 7465 7320          creates 
+0000c9c0: 6120 7374 6f70 6c6f 7373 206f 7264 6572  a stoploss order
+0000c9d0: 2e0a 2020 2020 2020 2020 7265 7175 6972  ..        requir
+0000c9e0: 6573 2060 5f66 745f 6861 735b 2773 746f  es `_ft_has['sto
+0000c9f0: 706c 6f73 735f 6f72 6465 725f 7479 7065  ploss_order_type
+0000ca00: 7327 5d60 2074 6f20 6265 2073 6574 2061  s']` to be set a
+0000ca10: 7320 6120 6469 6374 206d 6170 7069 6e67  s a dict mapping
+0000ca20: 206c 696d 6974 2061 6e64 206d 6172 6b65   limit and marke
+0000ca30: 740a 2020 2020 2020 2020 2020 2020 746f  t.            to
+0000ca40: 2074 6865 2063 6f72 7265 7370 6f6e 6469   the correspondi
+0000ca50: 6e67 2065 7863 6861 6e67 6520 7479 7065  ng exchange type
+0000ca60: 2e0a 0a20 2020 2020 2020 2054 6865 2070  ...        The p
+0000ca70: 7265 6369 7365 206f 7264 6572 7479 7065  recise ordertype
+0000ca80: 2069 7320 6465 7465 726d 696e 6564 2062   is determined b
+0000ca90: 7920 7468 6520 6f72 6465 725f 7479 7065  y the order_type
+0000caa0: 7320 6469 6374 206f 7220 6578 6368 616e  s dict or exchan
+0000cab0: 6765 2064 6566 6175 6c74 2e0a 0a20 2020  ge default...   
+0000cac0: 2020 2020 2054 6865 2065 7863 6570 7469       The excepti
+0000cad0: 6f6e 2062 656c 6f77 2073 686f 756c 6420  on below should 
+0000cae0: 6e65 7665 7220 7261 6973 652c 2073 696e  never raise, sin
+0000caf0: 6365 2077 6520 6469 7361 6c6c 6f77 0a20  ce we disallow. 
+0000cb00: 2020 2020 2020 2073 7461 7274 696e 6720         starting 
+0000cb10: 7468 6520 626f 7420 696e 2076 616c 6964  the bot in valid
+0000cb20: 6174 655f 6f72 6465 7274 7970 6573 2829  ate_ordertypes()
+0000cb30: 0a0a 2020 2020 2020 2020 5468 6973 206d  ..        This m
+0000cb40: 6179 2077 6f72 6b20 7769 7468 2061 206c  ay work with a l
+0000cb50: 696d 6974 6564 206e 756d 6265 7220 6f66  imited number of
+0000cb60: 206f 7468 6572 2065 7863 6861 6e67 6573   other exchanges
+0000cb70: 2c20 6275 7420 636f 7272 6563 7420 776f  , but correct wo
+0000cb80: 726b 696e 670a 2020 2020 2020 2020 2020  rking.          
+0000cb90: 2020 6e65 6564 7320 746f 2062 6520 7465    needs to be te
+0000cba0: 7374 6564 2069 6e64 6976 6964 7561 6c6c  sted individuall
+0000cbb0: 792e 0a20 2020 2020 2020 2057 4152 4e49  y..        WARNI
+0000cbc0: 4e47 3a20 7365 7474 696e 6720 6073 746f  NG: setting `sto
+0000cbd0: 706c 6f73 735f 6f6e 5f65 7863 6861 6e67  ploss_on_exchang
+0000cbe0: 6560 2074 6f20 5472 7565 2077 696c 6c20  e` to True will 
+0000cbf0: 4e4f 5420 6175 746f 2d65 6e61 626c 6520  NOT auto-enable 
+0000cc00: 7374 6f70 6c6f 7373 206f 6e20 6578 6368  stoploss on exch
+0000cc10: 616e 6765 2e0a 2020 2020 2020 2020 2020  ange..          
+0000cc20: 2020 6073 746f 706c 6f73 735f 6164 6a75    `stoploss_adju
+0000cc30: 7374 6020 6d75 7374 2073 7469 6c6c 2062  st` must still b
+0000cc40: 6520 696d 706c 656d 656e 7465 6420 666f  e implemented fo
+0000cc50: 7220 7468 6973 2074 6f20 776f 726b 2e0a  r this to work..
+0000cc60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000cc70: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0000cc80: 5f66 745f 6861 735b 2773 746f 706c 6f73  _ft_has['stoplos
+0000cc90: 735f 6f6e 5f65 7863 6861 6e67 6527 5d3a  s_on_exchange']:
+0000cca0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000ccb0: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+0000ccc0: 6365 7074 696f 6e28 6622 7374 6f70 6c6f  ception(f"stoplo
+0000ccd0: 7373 2069 7320 6e6f 7420 696d 706c 656d  ss is not implem
+0000cce0: 656e 7465 6420 666f 7220 7b73 656c 662e  ented for {self.
+0000ccf0: 6e61 6d65 7d2e 2229 0a0a 2020 2020 2020  name}.")..      
+0000cd00: 2020 7573 6572 5f6f 7264 6572 5f74 7970    user_order_typ
+0000cd10: 6520 3d20 6f72 6465 725f 7479 7065 732e  e = order_types.
+0000cd20: 6765 7428 2773 746f 706c 6f73 7327 2c20  get('stoploss', 
+0000cd30: 276d 6172 6b65 7427 290a 2020 2020 2020  'market').      
+0000cd40: 2020 6f72 6465 7274 7970 652c 2075 7365    ordertype, use
+0000cd50: 725f 6f72 6465 725f 7479 7065 203d 2073  r_order_type = s
+0000cd60: 656c 662e 5f67 6574 5f73 746f 705f 6f72  elf._get_stop_or
+0000cd70: 6465 725f 7479 7065 2875 7365 725f 6f72  der_type(user_or
+0000cd80: 6465 725f 7479 7065 290a 2020 2020 2020  der_type).      
+0000cd90: 2020 726f 756e 645f 6d6f 6465 203d 2052    round_mode = R
+0000cda0: 4f55 4e44 5f44 4f57 4e20 6966 2073 6964  OUND_DOWN if sid
+0000cdb0: 6520 3d3d 2027 6275 7927 2065 6c73 6520  e == 'buy' else 
+0000cdc0: 524f 554e 445f 5550 0a20 2020 2020 2020  ROUND_UP.       
+0000cdd0: 2073 746f 705f 7072 6963 655f 6e6f 726d   stop_price_norm
+0000cde0: 203d 2073 656c 662e 7072 6963 655f 746f   = self.price_to
+0000cdf0: 5f70 7265 6369 7369 6f6e 2870 6169 722c  _precision(pair,
+0000ce00: 2073 746f 705f 7072 6963 652c 2072 6f75   stop_price, rou
+0000ce10: 6e64 696e 675f 6d6f 6465 3d72 6f75 6e64  nding_mode=round
+0000ce20: 5f6d 6f64 6529 0a20 2020 2020 2020 206c  _mode).        l
+0000ce30: 696d 6974 5f72 6174 6520 3d20 4e6f 6e65  imit_rate = None
+0000ce40: 0a20 2020 2020 2020 2069 6620 7573 6572  .        if user
+0000ce50: 5f6f 7264 6572 5f74 7970 6520 3d3d 2027  _order_type == '
+0000ce60: 6c69 6d69 7427 3a0a 2020 2020 2020 2020  limit':.        
+0000ce70: 2020 2020 6c69 6d69 745f 7261 7465 203d      limit_rate =
+0000ce80: 2073 656c 662e 5f67 6574 5f73 746f 705f   self._get_stop_
+0000ce90: 6c69 6d69 745f 7261 7465 2873 746f 705f  limit_rate(stop_
+0000cea0: 7072 6963 652c 206f 7264 6572 5f74 7970  price, order_typ
+0000ceb0: 6573 2c20 7369 6465 290a 2020 2020 2020  es, side).      
+0000cec0: 2020 2020 2020 6c69 6d69 745f 7261 7465        limit_rate
+0000ced0: 203d 2073 656c 662e 7072 6963 655f 746f   = self.price_to
+0000cee0: 5f70 7265 6369 7369 6f6e 2870 6169 722c  _precision(pair,
+0000cef0: 206c 696d 6974 5f72 6174 652c 2072 6f75   limit_rate, rou
+0000cf00: 6e64 696e 675f 6d6f 6465 3d72 6f75 6e64  nding_mode=round
+0000cf10: 5f6d 6f64 6529 0a0a 2020 2020 2020 2020  _mode)..        
+0000cf20: 6966 2073 656c 662e 5f63 6f6e 6669 675b  if self._config[
+0000cf30: 2764 7279 5f72 756e 275d 3a0a 2020 2020  'dry_run']:.    
+0000cf40: 2020 2020 2020 2020 6472 795f 6f72 6465          dry_orde
+0000cf50: 7220 3d20 7365 6c66 2e63 7265 6174 655f  r = self.create_
+0000cf60: 6472 795f 7275 6e5f 6f72 6465 7228 0a20  dry_run_order(. 
+0000cf70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000cf80: 6169 722c 0a20 2020 2020 2020 2020 2020  air,.           
+0000cf90: 2020 2020 206f 7264 6572 7479 7065 2c0a       ordertype,.
+0000cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfb0: 7369 6465 2c0a 2020 2020 2020 2020 2020  side,.          
+0000cfc0: 2020 2020 2020 616d 6f75 6e74 2c0a 2020        amount,.  
+0000cfd0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0000cfe0: 6f70 5f70 7269 6365 5f6e 6f72 6d2c 0a20  op_price_norm,. 
+0000cff0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d000: 746f 705f 6c6f 7373 3d54 7275 652c 0a20  top_loss=True,. 
+0000d010: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0000d020: 6576 6572 6167 653d 6c65 7665 7261 6765  everage=leverage
+0000d030: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000d040: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000d050: 726e 2064 7279 5f6f 7264 6572 0a0a 2020  rn dry_order..  
+0000d060: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000d070: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+0000d080: 7365 6c66 2e5f 6765 745f 7374 6f70 5f70  self._get_stop_p
+0000d090: 6172 616d 7328 7369 6465 3d73 6964 652c  arams(side=side,
+0000d0a0: 206f 7264 6572 7479 7065 3d6f 7264 6572   ordertype=order
+0000d0b0: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
+0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0e0: 2073 746f 705f 7072 6963 653d 7374 6f70   stop_price=stop
+0000d0f0: 5f70 7269 6365 5f6e 6f72 6d29 0a20 2020  _price_norm).   
+0000d100: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000d110: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
+0000d120: 2054 7261 6469 6e67 4d6f 6465 2e46 5554   TradingMode.FUT
+0000d130: 5552 4553 3a0a 2020 2020 2020 2020 2020  URES:.          
+0000d140: 2020 2020 2020 7061 7261 6d73 5b27 7265        params['re
+0000d150: 6475 6365 4f6e 6c79 275d 203d 2054 7275  duceOnly'] = Tru
+0000d160: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000d170: 2020 6966 2027 7374 6f70 6c6f 7373 5f70    if 'stoploss_p
+0000d180: 7269 6365 5f74 7970 6527 2069 6e20 6f72  rice_type' in or
+0000d190: 6465 725f 7479 7065 7320 616e 6420 2773  der_types and 's
+0000d1a0: 746f 705f 7072 6963 655f 7479 7065 5f66  top_price_type_f
+0000d1b0: 6965 6c64 2720 696e 2073 656c 662e 5f66  ield' in self._f
+0000d1c0: 745f 6861 733a 0a20 2020 2020 2020 2020  t_has:.         
+0000d1d0: 2020 2020 2020 2020 2020 2070 7269 6365             price
+0000d1e0: 5f74 7970 6520 3d20 7365 6c66 2e5f 6674  _type = self._ft
+0000d1f0: 5f68 6173 5b27 7374 6f70 5f70 7269 6365  _has['stop_price
+0000d200: 5f74 7970 655f 7661 6c75 655f 6d61 7070  _type_value_mapp
+0000d210: 696e 6727 5d5b 0a20 2020 2020 2020 2020  ing'][.         
+0000d220: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000d230: 7264 6572 5f74 7970 6573 2e67 6574 2827  rder_types.get('
+0000d240: 7374 6f70 6c6f 7373 5f70 7269 6365 5f74  stoploss_price_t
+0000d250: 7970 6527 2c20 5072 6963 6554 7970 652e  ype', PriceType.
+0000d260: 4c41 5354 295d 0a20 2020 2020 2020 2020  LAST)].         
+0000d270: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0000d280: 735b 7365 6c66 2e5f 6674 5f68 6173 5b27  s[self._ft_has['
+0000d290: 7374 6f70 5f70 7269 6365 5f74 7970 655f  stop_price_type_
+0000d2a0: 6669 656c 6427 5d5d 203d 2070 7269 6365  field']] = price
+0000d2b0: 5f74 7970 650a 0a20 2020 2020 2020 2020  _type..         
+0000d2c0: 2020 2061 6d6f 756e 7420 3d20 7365 6c66     amount = self
+0000d2d0: 2e61 6d6f 756e 745f 746f 5f70 7265 6369  .amount_to_preci
+0000d2e0: 7369 6f6e 2870 6169 722c 2073 656c 662e  sion(pair, self.
+0000d2f0: 5f61 6d6f 756e 745f 746f 5f63 6f6e 7472  _amount_to_contr
+0000d300: 6163 7473 2870 6169 722c 2061 6d6f 756e  acts(pair, amoun
+0000d310: 7429 290a 0a20 2020 2020 2020 2020 2020  t))..           
+0000d320: 2073 656c 662e 5f6c 6576 5f70 7265 7028   self._lev_prep(
+0000d330: 7061 6972 2c20 6c65 7665 7261 6765 2c20  pair, leverage, 
+0000d340: 7369 6465 2c20 6163 6365 7074 5f66 6169  side, accept_fai
+0000d350: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
+0000d360: 2020 2020 6f72 6465 7220 3d20 7365 6c66      order = self
+0000d370: 2e5f 6170 692e 6372 6561 7465 5f6f 7264  ._api.create_ord
+0000d380: 6572 2873 796d 626f 6c3d 7061 6972 2c20  er(symbol=pair, 
+0000d390: 7479 7065 3d6f 7264 6572 7479 7065 2c20  type=ordertype, 
+0000d3a0: 7369 6465 3d73 6964 652c 0a20 2020 2020  side=side,.     
+0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3d0: 2020 2020 2020 616d 6f75 6e74 3d61 6d6f        amount=amo
+0000d3e0: 756e 742c 2070 7269 6365 3d6c 696d 6974  unt, price=limit
+0000d3f0: 5f72 6174 652c 2070 6172 616d 733d 7061  _rate, params=pa
+0000d400: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
+0000d410: 2020 7365 6c66 2e5f 6c6f 675f 6578 6368    self._log_exch
+0000d420: 616e 6765 5f72 6573 706f 6e73 6528 2763  ange_response('c
+0000d430: 7265 6174 655f 7374 6f70 6c6f 7373 5f6f  reate_stoploss_o
+0000d440: 7264 6572 272c 206f 7264 6572 290a 2020  rder', order).  
+0000d450: 2020 2020 2020 2020 2020 6f72 6465 7220            order 
+0000d460: 3d20 7365 6c66 2e5f 6f72 6465 725f 636f  = self._order_co
+0000d470: 6e74 7261 6374 735f 746f 5f61 6d6f 756e  ntracts_to_amoun
+0000d480: 7428 6f72 6465 7229 0a20 2020 2020 2020  t(order).       
+0000d490: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+0000d4a0: 2866 2273 746f 706c 6f73 7320 7b75 7365  (f"stoploss {use
+0000d4b0: 725f 6f72 6465 725f 7479 7065 7d20 6f72  r_order_type} or
+0000d4c0: 6465 7220 6164 6465 6420 666f 7220 7b70  der added for {p
+0000d4d0: 6169 727d 2e20 220a 2020 2020 2020 2020  air}. ".        
+0000d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4f0: 6622 7374 6f70 2070 7269 6365 3a20 7b73  f"stop price: {s
+0000d500: 746f 705f 7072 6963 657d 2e20 6c69 6d69  top_price}. limi
+0000d510: 743a 207b 6c69 6d69 745f 7261 7465 7d22  t: {limit_rate}"
+0000d520: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000d530: 7475 726e 206f 7264 6572 0a20 2020 2020  turn order.     
+0000d540: 2020 2065 7863 6570 7420 6363 7874 2e49     except ccxt.I
+0000d550: 6e73 7566 6669 6369 656e 7446 756e 6473  nsufficientFunds
+0000d560: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000d570: 2020 2072 6169 7365 2049 6e73 7566 6669     raise Insuffi
+0000d580: 6369 656e 7446 756e 6473 4572 726f 7228  cientFundsError(
+0000d590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d5a0: 2066 2749 6e73 7566 6669 6369 656e 7420   f'Insufficient 
+0000d5b0: 6675 6e64 7320 746f 2063 7265 6174 6520  funds to create 
+0000d5c0: 7b6f 7264 6572 7479 7065 7d20 7365 6c6c  {ordertype} sell
+0000d5d0: 206f 7264 6572 206f 6e20 6d61 726b 6574   order on market
+0000d5e0: 207b 7061 6972 7d2e 2027 0a20 2020 2020   {pair}. '.     
+0000d5f0: 2020 2020 2020 2020 2020 2066 2754 7269             f'Tri
+0000d600: 6564 2074 6f20 7365 6c6c 2061 6d6f 756e  ed to sell amoun
+0000d610: 7420 7b61 6d6f 756e 747d 2061 7420 7261  t {amount} at ra
+0000d620: 7465 207b 6c69 6d69 745f 7261 7465 7d2e  te {limit_rate}.
+0000d630: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+0000d640: 2020 2066 274d 6573 7361 6765 3a20 7b65     f'Message: {e
+0000d650: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+0000d660: 2020 2065 7863 6570 7420 6363 7874 2e49     except ccxt.I
+0000d670: 6e76 616c 6964 4f72 6465 7220 6173 2065  nvalidOrder as e
+0000d680: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000d690: 4572 726f 7273 3a0a 2020 2020 2020 2020  Errors:.        
+0000d6a0: 2020 2020 2320 604f 7264 6572 2077 6f75      # `Order wou
+0000d6b0: 6c64 2074 7269 6767 6572 2069 6d6d 6564  ld trigger immed
+0000d6c0: 6961 7465 6c79 2e60 0a20 2020 2020 2020  iately.`.       
+0000d6d0: 2020 2020 2072 6169 7365 2049 6e76 616c       raise Inval
+0000d6e0: 6964 4f72 6465 7245 7863 6570 7469 6f6e  idOrderException
+0000d6f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d700: 2020 6627 436f 756c 6420 6e6f 7420 6372    f'Could not cr
+0000d710: 6561 7465 207b 6f72 6465 7274 7970 657d  eate {ordertype}
+0000d720: 2073 656c 6c20 6f72 6465 7220 6f6e 206d   sell order on m
+0000d730: 6172 6b65 7420 7b70 6169 727d 2e20 270a  arket {pair}. '.
+0000d740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d750: 6627 5472 6965 6420 746f 2073 656c 6c20  f'Tried to sell 
+0000d760: 616d 6f75 6e74 207b 616d 6f75 6e74 7d20  amount {amount} 
+0000d770: 6174 2072 6174 6520 7b6c 696d 6974 5f72  at rate {limit_r
+0000d780: 6174 657d 2e20 270a 2020 2020 2020 2020  ate}. '.        
+0000d790: 2020 2020 2020 2020 6627 4d65 7373 6167          f'Messag
+0000d7a0: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
+0000d7b0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+0000d7c0: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
+0000d7d0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+0000d7e0: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
+0000d7f0: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
+0000d800: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+0000d810: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
+0000d820: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
+0000d830: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
+0000d840: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000d850: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
+0000d860: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000d870: 2020 2066 2243 6f75 6c64 206e 6f74 2070     f"Could not p
+0000d880: 6c61 6365 2073 746f 706c 6f73 7320 6f72  lace stoploss or
+0000d890: 6465 7220 6475 6520 746f 207b 652e 5f5f  der due to {e.__
+0000d8a0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0000d8b0: 7d2e 2022 0a20 2020 2020 2020 2020 2020  }. ".           
+0000d8c0: 2020 2020 2066 224d 6573 7361 6765 3a20       f"Message: 
+0000d8d0: 7b65 7d22 2920 6672 6f6d 2065 0a20 2020  {e}") from e.   
+0000d8e0: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+0000d8f0: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
+0000d900: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000d910: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+0000d920: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
+0000d930: 650a 0a20 2020 2040 7265 7472 6965 7228  e..    @retrier(
+0000d940: 7265 7472 6965 733d 4150 495f 4645 5443  retries=API_FETC
+0000d950: 485f 4f52 4445 525f 5245 5452 595f 434f  H_ORDER_RETRY_CO
+0000d960: 554e 5429 0a20 2020 2064 6566 2066 6574  UNT).    def fet
+0000d970: 6368 5f6f 7264 6572 2873 656c 662c 206f  ch_order(self, o
+0000d980: 7264 6572 5f69 643a 2073 7472 2c20 7061  rder_id: str, pa
+0000d990: 6972 3a20 7374 722c 2070 6172 616d 733a  ir: str, params:
+0000d9a0: 2044 6963 7420 3d20 7b7d 2920 2d3e 2044   Dict = {}) -> D
+0000d9b0: 6963 743a 0a20 2020 2020 2020 2069 6620  ict:.        if 
+0000d9c0: 7365 6c66 2e5f 636f 6e66 6967 5b27 6472  self._config['dr
+0000d9d0: 795f 7275 6e27 5d3a 0a20 2020 2020 2020  y_run']:.       
+0000d9e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000d9f0: 2e66 6574 6368 5f64 7279 5f72 756e 5f6f  .fetch_dry_run_o
+0000da00: 7264 6572 286f 7264 6572 5f69 6429 0a20  rder(order_id). 
+0000da10: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000da20: 2020 2020 2020 2020 6f72 6465 7220 3d20          order = 
+0000da30: 7365 6c66 2e5f 6170 692e 6665 7463 685f  self._api.fetch_
+0000da40: 6f72 6465 7228 6f72 6465 725f 6964 2c20  order(order_id, 
+0000da50: 7061 6972 2c20 7061 7261 6d73 3d70 6172  pair, params=par
+0000da60: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
+0000da70: 2073 656c 662e 5f6c 6f67 5f65 7863 6861   self._log_excha
+0000da80: 6e67 655f 7265 7370 6f6e 7365 2827 6665  nge_response('fe
+0000da90: 7463 685f 6f72 6465 7227 2c20 6f72 6465  tch_order', orde
+0000daa0: 7229 0a20 2020 2020 2020 2020 2020 206f  r).            o
+0000dab0: 7264 6572 203d 2073 656c 662e 5f6f 7264  rder = self._ord
+0000dac0: 6572 5f63 6f6e 7472 6163 7473 5f74 6f5f  er_contracts_to_
+0000dad0: 616d 6f75 6e74 286f 7264 6572 290a 2020  amount(order).  
+0000dae0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000daf0: 206f 7264 6572 0a20 2020 2020 2020 2065   order.        e
+0000db00: 7863 6570 7420 6363 7874 2e4f 7264 6572  xcept ccxt.Order
+0000db10: 4e6f 7446 6f75 6e64 2061 7320 653a 0a20  NotFound as e:. 
+0000db20: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000db30: 2052 6574 7279 6162 6c65 4f72 6465 7245   RetryableOrderE
+0000db40: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0000db50: 2020 2020 2020 6627 4f72 6465 7220 6e6f        f'Order no
+0000db60: 7420 666f 756e 6420 2870 6169 723a 207b  t found (pair: {
+0000db70: 7061 6972 7d20 6964 3a20 7b6f 7264 6572  pair} id: {order
+0000db80: 5f69 647d 292e 204d 6573 7361 6765 3a20  _id}). Message: 
+0000db90: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+0000dba0: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+0000dbb0: 2e49 6e76 616c 6964 4f72 6465 7220 6173  .InvalidOrder as
+0000dbc0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000dbd0: 7261 6973 6520 496e 7661 6c69 644f 7264  raise InvalidOrd
+0000dbe0: 6572 4578 6365 7074 696f 6e28 0a20 2020  erException(.   
+0000dbf0: 2020 2020 2020 2020 2020 2020 2066 2754               f'T
+0000dc00: 7269 6564 2074 6f20 6765 7420 616e 2069  ried to get an i
+0000dc10: 6e76 616c 6964 206f 7264 6572 2028 7061  nvalid order (pa
+0000dc20: 6972 3a20 7b70 6169 727d 2069 643a 207b  ir: {pair} id: {
+0000dc30: 6f72 6465 725f 6964 7d29 2e20 4d65 7373  order_id}). Mess
+0000dc40: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+0000dc50: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0000dc60: 2063 6378 742e 4444 6f53 5072 6f74 6563   ccxt.DDoSProtec
+0000dc70: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+0000dc80: 2020 2020 2020 2072 6169 7365 2044 446f         raise DDo
+0000dc90: 7350 726f 7465 6374 696f 6e28 6529 2066  sProtection(e) f
+0000dca0: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
+0000dcb0: 6365 7074 2028 6363 7874 2e4e 6574 776f  cept (ccxt.Netwo
+0000dcc0: 726b 4572 726f 722c 2063 6378 742e 4578  rkError, ccxt.Ex
+0000dcd0: 6368 616e 6765 4572 726f 7229 2061 7320  changeError) as 
+0000dce0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000dcf0: 6169 7365 2054 656d 706f 7261 7279 4572  aise TemporaryEr
+0000dd00: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000dd10: 2020 2020 2066 2743 6f75 6c64 206e 6f74       f'Could not
+0000dd20: 2067 6574 206f 7264 6572 2064 7565 2074   get order due t
+0000dd30: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
+0000dd40: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
+0000dd50: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
+0000dd60: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+0000dd70: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
+0000dd80: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000dd90: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+0000dda0: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
+0000ddb0: 6f6d 2065 0a0a 2020 2020 6465 6620 6665  om e..    def fe
+0000ddc0: 7463 685f 7374 6f70 6c6f 7373 5f6f 7264  tch_stoploss_ord
+0000ddd0: 6572 2873 656c 662c 206f 7264 6572 5f69  er(self, order_i
+0000dde0: 643a 2073 7472 2c20 7061 6972 3a20 7374  d: str, pair: st
+0000ddf0: 722c 2070 6172 616d 733a 2044 6963 7420  r, params: Dict 
+0000de00: 3d20 7b7d 2920 2d3e 2044 6963 743a 0a20  = {}) -> Dict:. 
+0000de10: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000de20: 6c66 2e66 6574 6368 5f6f 7264 6572 286f  lf.fetch_order(o
+0000de30: 7264 6572 5f69 642c 2070 6169 722c 2070  rder_id, pair, p
+0000de40: 6172 616d 7329 0a0a 2020 2020 6465 6620  arams)..    def 
+0000de50: 6665 7463 685f 6f72 6465 725f 6f72 5f73  fetch_order_or_s
+0000de60: 746f 706c 6f73 735f 6f72 6465 7228 7365  toploss_order(se
+0000de70: 6c66 2c20 6f72 6465 725f 6964 3a20 7374  lf, order_id: st
+0000de80: 722c 2070 6169 723a 2073 7472 2c0a 2020  r, pair: str,.  
+0000de90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000deb0: 2020 2020 7374 6f70 6c6f 7373 5f6f 7264      stoploss_ord
+0000dec0: 6572 3a20 626f 6f6c 203d 2046 616c 7365  er: bool = False
+0000ded0: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
+0000dee0: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
+0000def0: 696d 706c 6520 7772 6170 7065 7220 6361  imple wrapper ca
+0000df00: 6c6c 696e 6720 6569 7468 6572 2066 6574  lling either fet
+0000df10: 6368 5f6f 7264 6572 206f 7220 6665 7463  ch_order or fetc
+0000df20: 685f 7374 6f70 6c6f 7373 5f6f 7264 6572  h_stoploss_order
+0000df30: 2064 6570 656e 6469 6e67 206f 6e0a 2020   depending on.  
+0000df40: 2020 2020 2020 7468 6520 7374 6f70 6c6f        the stoplo
+0000df50: 7373 5f6f 7264 6572 2070 6172 616d 6574  ss_order paramet
+0000df60: 6572 0a20 2020 2020 2020 203a 7061 7261  er.        :para
+0000df70: 6d20 6f72 6465 725f 6964 3a20 4f72 6465  m order_id: Orde
+0000df80: 7249 6420 746f 2066 6574 6368 206f 7264  rId to fetch ord
+0000df90: 6572 0a20 2020 2020 2020 203a 7061 7261  er.        :para
+0000dfa0: 6d20 7061 6972 3a20 5061 6972 2063 6f72  m pair: Pair cor
+0000dfb0: 7265 7370 6f6e 6469 6e67 2074 6f20 6f72  responding to or
+0000dfc0: 6465 725f 6964 0a20 2020 2020 2020 203a  der_id.        :
+0000dfd0: 7061 7261 6d20 7374 6f70 6c6f 7373 5f6f  param stoploss_o
+0000dfe0: 7264 6572 3a20 4966 2074 7275 652c 2075  rder: If true, u
+0000dff0: 7365 7320 6665 7463 685f 7374 6f70 6c6f  ses fetch_stoplo
+0000e000: 7373 5f6f 7264 6572 2c20 6f74 6865 7277  ss_order, otherw
+0000e010: 6973 6520 6665 7463 685f 6f72 6465 722e  ise fetch_order.
+0000e020: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000e030: 2020 2020 2069 6620 7374 6f70 6c6f 7373       if stoploss
+0000e040: 5f6f 7264 6572 3a0a 2020 2020 2020 2020  _order:.        
+0000e050: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000e060: 6665 7463 685f 7374 6f70 6c6f 7373 5f6f  fetch_stoploss_o
+0000e070: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
+0000e080: 6169 7229 0a20 2020 2020 2020 2072 6574  air).        ret
+0000e090: 7572 6e20 7365 6c66 2e66 6574 6368 5f6f  urn self.fetch_o
+0000e0a0: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
+0000e0b0: 6169 7229 0a0a 2020 2020 6465 6620 6368  air)..    def ch
+0000e0c0: 6563 6b5f 6f72 6465 725f 6361 6e63 656c  eck_order_cancel
+0000e0d0: 6564 5f65 6d70 7479 2873 656c 662c 206f  ed_empty(self, o
+0000e0e0: 7264 6572 3a20 4469 6374 2920 2d3e 2062  rder: Dict) -> b
+0000e0f0: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+0000e100: 0a20 2020 2020 2020 2056 6572 6966 7920  .        Verify 
+0000e110: 6966 2061 6e20 6f72 6465 7220 6861 7320  if an order has 
+0000e120: 6265 656e 2063 616e 6365 6c6c 6564 2077  been cancelled w
+0000e130: 6974 686f 7574 2062 6569 6e67 2070 6172  ithout being par
+0000e140: 7469 616c 6c79 2066 696c 6c65 640a 2020  tially filled.  
+0000e150: 2020 2020 2020 3a70 6172 616d 206f 7264        :param ord
+0000e160: 6572 3a20 4f72 6465 7220 6469 6374 2061  er: Order dict a
+0000e170: 7320 7265 7475 726e 6564 2066 726f 6d20  s returned from 
+0000e180: 6665 7463 685f 6f72 6465 7228 290a 2020  fetch_order().  
+0000e190: 2020 2020 2020 3a72 6574 7572 6e3a 2054        :return: T
+0000e1a0: 7275 6520 6966 206f 7264 6572 2068 6173  rue if order has
+0000e1b0: 2062 6565 6e20 6361 6e63 656c 6c65 6420   been cancelled 
+0000e1c0: 7769 7468 6f75 7420 6265 696e 6720 6669  without being fi
+0000e1d0: 6c6c 6564 2c20 4661 6c73 6520 6f74 6865  lled, False othe
+0000e1e0: 7277 6973 652e 0a20 2020 2020 2020 2022  rwise..        "
+0000e1f0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000e200: 6e20 286f 7264 6572 2e67 6574 2827 7374  n (order.get('st
+0000e210: 6174 7573 2729 2069 6e20 4e4f 4e5f 4f50  atus') in NON_OP
+0000e220: 454e 5f45 5843 4841 4e47 455f 5354 4154  EN_EXCHANGE_STAT
+0000e230: 4553 0a20 2020 2020 2020 2020 2020 2020  ES.             
+0000e240: 2020 2061 6e64 206f 7264 6572 2e67 6574     and order.get
+0000e250: 2827 6669 6c6c 6564 2729 203d 3d20 302e  ('filled') == 0.
+0000e260: 3029 0a0a 2020 2020 4072 6574 7269 6572  0)..    @retrier
+0000e270: 0a20 2020 2064 6566 2063 616e 6365 6c5f  .    def cancel_
+0000e280: 6f72 6465 7228 7365 6c66 2c20 6f72 6465  order(self, orde
+0000e290: 725f 6964 3a20 7374 722c 2070 6169 723a  r_id: str, pair:
+0000e2a0: 2073 7472 2c20 7061 7261 6d73 3a20 4469   str, params: Di
+0000e2b0: 6374 203d 207b 7d29 202d 3e20 4469 6374  ct = {}) -> Dict
+0000e2c0: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
+0000e2d0: 662e 5f63 6f6e 6669 675b 2764 7279 5f72  f._config['dry_r
+0000e2e0: 756e 275d 3a0a 2020 2020 2020 2020 2020  un']:.          
+0000e2f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000e300: 2020 2020 2020 206f 7264 6572 203d 2073         order = s
+0000e310: 656c 662e 6665 7463 685f 6472 795f 7275  elf.fetch_dry_ru
+0000e320: 6e5f 6f72 6465 7228 6f72 6465 725f 6964  n_order(order_id
+0000e330: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000e340: 2020 206f 7264 6572 2e75 7064 6174 6528     order.update(
+0000e350: 7b27 7374 6174 7573 273a 2027 6361 6e63  {'status': 'canc
+0000e360: 656c 6564 272c 2027 6669 6c6c 6564 273a  eled', 'filled':
+0000e370: 2030 2e30 2c20 2772 656d 6169 6e69 6e67   0.0, 'remaining
+0000e380: 273a 206f 7264 6572 5b27 616d 6f75 6e74  ': order['amount
+0000e390: 275d 7d29 0a20 2020 2020 2020 2020 2020  ']}).           
+0000e3a0: 2020 2020 2072 6574 7572 6e20 6f72 6465       return orde
+0000e3b0: 720a 2020 2020 2020 2020 2020 2020 6578  r.            ex
+0000e3c0: 6365 7074 2049 6e76 616c 6964 4f72 6465  cept InvalidOrde
+0000e3d0: 7245 7863 6570 7469 6f6e 3a0a 2020 2020  rException:.    
+0000e3e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000e3f0: 726e 207b 7d0a 0a20 2020 2020 2020 2074  rn {}..        t
+0000e400: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000e410: 6f72 6465 7220 3d20 7365 6c66 2e5f 6170  order = self._ap
+0000e420: 692e 6361 6e63 656c 5f6f 7264 6572 286f  i.cancel_order(o
+0000e430: 7264 6572 5f69 642c 2070 6169 722c 2070  rder_id, pair, p
+0000e440: 6172 616d 733d 7061 7261 6d73 290a 2020  arams=params).  
+0000e450: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000e460: 6c6f 675f 6578 6368 616e 6765 5f72 6573  log_exchange_res
+0000e470: 706f 6e73 6528 2763 616e 6365 6c5f 6f72  ponse('cancel_or
+0000e480: 6465 7227 2c20 6f72 6465 7229 0a20 2020  der', order).   
+0000e490: 2020 2020 2020 2020 206f 7264 6572 203d           order =
+0000e4a0: 2073 656c 662e 5f6f 7264 6572 5f63 6f6e   self._order_con
+0000e4b0: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
+0000e4c0: 286f 7264 6572 290a 2020 2020 2020 2020  (order).        
+0000e4d0: 2020 2020 7265 7475 726e 206f 7264 6572      return order
+0000e4e0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000e4f0: 6363 7874 2e49 6e76 616c 6964 4f72 6465  ccxt.InvalidOrde
+0000e500: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+0000e510: 2020 2020 7261 6973 6520 496e 7661 6c69      raise Invali
+0000e520: 644f 7264 6572 4578 6365 7074 696f 6e28  dOrderException(
+0000e530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e540: 2066 2743 6f75 6c64 206e 6f74 2063 616e   f'Could not can
+0000e550: 6365 6c20 6f72 6465 722e 204d 6573 7361  cel order. Messa
+0000e560: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+0000e570: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000e580: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
+0000e590: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+0000e5a0: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
+0000e5b0: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
+0000e5c0: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+0000e5d0: 6570 7420 2863 6378 742e 4e65 7477 6f72  ept (ccxt.Networ
+0000e5e0: 6b45 7272 6f72 2c20 6363 7874 2e45 7863  kError, ccxt.Exc
+0000e5f0: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
+0000e600: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000e610: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
+0000e620: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000e630: 2020 2020 6627 436f 756c 6420 6e6f 7420      f'Could not 
+0000e640: 6361 6e63 656c 206f 7264 6572 2064 7565  cancel order due
+0000e650: 2074 6f20 7b65 2e5f 5f63 6c61 7373 5f5f   to {e.__class__
+0000e660: 2e5f 5f6e 616d 655f 5f7d 2e20 4d65 7373  .__name__}. Mess
+0000e670: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+0000e680: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0000e690: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
+0000e6a0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0000e6b0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+0000e6c0: 6e61 6c45 7863 6570 7469 6f6e 2865 2920  nalException(e) 
+0000e6d0: 6672 6f6d 2065 0a0a 2020 2020 6465 6620  from e..    def 
+0000e6e0: 6361 6e63 656c 5f73 746f 706c 6f73 735f  cancel_stoploss_
+0000e6f0: 6f72 6465 7228 7365 6c66 2c20 6f72 6465  order(self, orde
+0000e700: 725f 6964 3a20 7374 722c 2070 6169 723a  r_id: str, pair:
+0000e710: 2073 7472 2c20 7061 7261 6d73 3a20 4469   str, params: Di
+0000e720: 6374 203d 207b 7d29 202d 3e20 4469 6374  ct = {}) -> Dict
+0000e730: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000e740: 2073 656c 662e 6361 6e63 656c 5f6f 7264   self.cancel_ord
+0000e750: 6572 286f 7264 6572 5f69 642c 2070 6169  er(order_id, pai
+0000e760: 722c 2070 6172 616d 7329 0a0a 2020 2020  r, params)..    
+0000e770: 6465 6620 6973 5f63 616e 6365 6c5f 6f72  def is_cancel_or
+0000e780: 6465 725f 7265 7375 6c74 5f73 7569 7461  der_result_suita
+0000e790: 626c 6528 7365 6c66 2c20 636f 7264 6572  ble(self, corder
+0000e7a0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
+0000e7b0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+0000e7c0: 616e 6365 2863 6f72 6465 722c 2064 6963  ance(corder, dic
+0000e7d0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0000e7e0: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
+0000e7f0: 2020 2020 2020 7265 7175 6972 6564 203d        required =
+0000e800: 2028 2766 6565 272c 2027 7374 6174 7573   ('fee', 'status
+0000e810: 272c 2027 616d 6f75 6e74 2729 0a20 2020  ', 'amount').   
+0000e820: 2020 2020 2072 6574 7572 6e20 616c 6c28       return all(
+0000e830: 636f 7264 6572 2e67 6574 286b 2c20 4e6f  corder.get(k, No
+0000e840: 6e65 2920 6973 206e 6f74 204e 6f6e 6520  ne) is not None 
+0000e850: 666f 7220 6b20 696e 2072 6571 7569 7265  for k in require
+0000e860: 6429 0a0a 2020 2020 6465 6620 6361 6e63  d)..    def canc
+0000e870: 656c 5f6f 7264 6572 5f77 6974 685f 7265  el_order_with_re
+0000e880: 7375 6c74 2873 656c 662c 206f 7264 6572  sult(self, order
+0000e890: 5f69 643a 2073 7472 2c20 7061 6972 3a20  _id: str, pair: 
+0000e8a0: 7374 722c 2061 6d6f 756e 743a 2066 6c6f  str, amount: flo
+0000e8b0: 6174 2920 2d3e 2044 6963 743a 0a20 2020  at) -> Dict:.   
+0000e8c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000e8d0: 2043 616e 6365 6c20 6f72 6465 7220 7265   Cancel order re
+0000e8e0: 7475 726e 696e 6720 6120 7265 7375 6c74  turning a result
+0000e8f0: 2e0a 2020 2020 2020 2020 4372 6561 7465  ..        Create
+0000e900: 7320 6120 6661 6b65 2072 6573 756c 7420  s a fake result 
+0000e910: 6966 2063 616e 6365 6c20 6f72 6465 7220  if cancel order 
+0000e920: 7265 7475 726e 7320 6120 6e6f 6e2d 7573  returns a non-us
+0000e930: 6162 6c65 2072 6573 756c 740a 2020 2020  able result.    
+0000e940: 2020 2020 616e 6420 6665 7463 685f 6f72      and fetch_or
+0000e950: 6465 7220 646f 6573 206e 6f74 2077 6f72  der does not wor
+0000e960: 6b20 2863 6572 7461 696e 2065 7863 6861  k (certain excha
+0000e970: 6e67 6573 2064 6f6e 2774 2072 6574 7572  nges don't retur
+0000e980: 6e20 6361 6e63 656c 6c65 6420 6f72 6465  n cancelled orde
+0000e990: 7273 290a 2020 2020 2020 2020 3a70 6172  rs).        :par
+0000e9a0: 616d 206f 7264 6572 5f69 643a 204f 7264  am order_id: Ord
+0000e9b0: 6572 6964 2074 6f20 6361 6e63 656c 0a20  erid to cancel. 
+0000e9c0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+0000e9d0: 6972 3a20 5061 6972 2063 6f72 7265 7370  ir: Pair corresp
+0000e9e0: 6f6e 6469 6e67 2074 6f20 6f72 6465 725f  onding to order_
+0000e9f0: 6964 0a20 2020 2020 2020 203a 7061 7261  id.        :para
+0000ea00: 6d20 616d 6f75 6e74 3a20 416d 6f75 6e74  m amount: Amount
+0000ea10: 2074 6f20 7573 6520 666f 7220 6661 6b65   to use for fake
+0000ea20: 2072 6573 706f 6e73 650a 2020 2020 2020   response.      
+0000ea30: 2020 3a72 6574 7572 6e3a 2052 6573 756c    :return: Resul
+0000ea40: 7420 6672 6f6d 2065 6974 6865 7220 6361  t from either ca
+0000ea50: 6e63 656c 5f6f 7264 6572 2069 6620 7573  ncel_order if us
+0000ea60: 6162 6c65 2c20 6f72 2066 6574 6368 5f6f  able, or fetch_o
+0000ea70: 7264 6572 0a20 2020 2020 2020 2022 2222  rder.        """
+0000ea80: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0000ea90: 2020 2020 2020 2020 2020 636f 7264 6572            corder
+0000eaa0: 203d 2073 656c 662e 6361 6e63 656c 5f6f   = self.cancel_o
+0000eab0: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
+0000eac0: 6169 7229 0a20 2020 2020 2020 2020 2020  air).           
+0000ead0: 2069 6620 7365 6c66 2e69 735f 6361 6e63   if self.is_canc
+0000eae0: 656c 5f6f 7264 6572 5f72 6573 756c 745f  el_order_result_
+0000eaf0: 7375 6974 6162 6c65 2863 6f72 6465 7229  suitable(corder)
+0000eb00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000eb10: 2020 7265 7475 726e 2063 6f72 6465 720a    return corder.
+0000eb20: 2020 2020 2020 2020 6578 6365 7074 2049          except I
+0000eb30: 6e76 616c 6964 4f72 6465 7245 7863 6570  nvalidOrderExcep
+0000eb40: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+0000eb50: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+0000eb60: 2866 2243 6f75 6c64 206e 6f74 2063 616e  (f"Could not can
+0000eb70: 6365 6c20 6f72 6465 7220 7b6f 7264 6572  cel order {order
+0000eb80: 5f69 647d 2066 6f72 207b 7061 6972 7d2e  _id} for {pair}.
+0000eb90: 2229 0a20 2020 2020 2020 2074 7279 3a0a  ").        try:.
+0000eba0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000ebb0: 7220 3d20 7365 6c66 2e66 6574 6368 5f6f  r = self.fetch_o
+0000ebc0: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
+0000ebd0: 6169 7229 0a20 2020 2020 2020 2065 7863  air).        exc
+0000ebe0: 6570 7420 496e 7661 6c69 644f 7264 6572  ept InvalidOrder
+0000ebf0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+0000ec00: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
+0000ec10: 726e 696e 6728 6622 436f 756c 6420 6e6f  rning(f"Could no
+0000ec20: 7420 6665 7463 6820 6361 6e63 656c 6c65  t fetch cancelle
+0000ec30: 6420 6f72 6465 7220 7b6f 7264 6572 5f69  d order {order_i
+0000ec40: 647d 2e22 290a 2020 2020 2020 2020 2020  d}.").          
+0000ec50: 2020 6f72 6465 7220 3d20 7b0a 2020 2020    order = {.    
+0000ec60: 2020 2020 2020 2020 2020 2020 2769 6427              'id'
+0000ec70: 3a20 6f72 6465 725f 6964 2c0a 2020 2020  : order_id,.    
+0000ec80: 2020 2020 2020 2020 2020 2020 2773 7461              'sta
+0000ec90: 7475 7327 3a20 2763 616e 6365 6c65 6427  tus': 'canceled'
+0000eca0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ecb0: 2020 2761 6d6f 756e 7427 3a20 616d 6f75    'amount': amou
+0000ecc0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+0000ecd0: 2020 2020 2766 696c 6c65 6427 3a20 302e      'filled': 0.
+0000ece0: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0000ecf0: 2020 2027 6665 6527 3a20 7b7d 2c0a 2020     'fee': {},.  
+0000ed00: 2020 2020 2020 2020 2020 2020 2020 2769                'i
+0000ed10: 6e66 6f27 3a20 7b7d 0a20 2020 2020 2020  nfo': {}.       
+0000ed20: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+0000ed30: 7265 7475 726e 206f 7264 6572 0a0a 2020  return order..  
+0000ed40: 2020 6465 6620 6361 6e63 656c 5f73 746f    def cancel_sto
+0000ed50: 706c 6f73 735f 6f72 6465 725f 7769 7468  ploss_order_with
+0000ed60: 5f72 6573 756c 7428 7365 6c66 2c20 6f72  _result(self, or
+0000ed70: 6465 725f 6964 3a20 7374 722c 2070 6169  der_id: str, pai
+0000ed80: 723a 2073 7472 2c20 616d 6f75 6e74 3a20  r: str, amount: 
+0000ed90: 666c 6f61 7429 202d 3e20 4469 6374 3a0a  float) -> Dict:.
+0000eda0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000edb0: 2020 2020 4361 6e63 656c 2073 746f 706c      Cancel stopl
+0000edc0: 6f73 7320 6f72 6465 7220 7265 7475 726e  oss order return
+0000edd0: 696e 6720 6120 7265 7375 6c74 2e0a 2020  ing a result..  
+0000ede0: 2020 2020 2020 4372 6561 7465 7320 6120        Creates a 
+0000edf0: 6661 6b65 2072 6573 756c 7420 6966 2063  fake result if c
+0000ee00: 616e 6365 6c20 6f72 6465 7220 7265 7475  ancel order retu
+0000ee10: 726e 7320 6120 6e6f 6e2d 7573 6162 6c65  rns a non-usable
+0000ee20: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
+0000ee30: 616e 6420 6665 7463 685f 6f72 6465 7220  and fetch_order 
+0000ee40: 646f 6573 206e 6f74 2077 6f72 6b20 2863  does not work (c
+0000ee50: 6572 7461 696e 2065 7863 6861 6e67 6573  ertain exchanges
+0000ee60: 2064 6f6e 2774 2072 6574 7572 6e20 6361   don't return ca
+0000ee70: 6e63 656c 6c65 6420 6f72 6465 7273 290a  ncelled orders).
+0000ee80: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+0000ee90: 7264 6572 5f69 643a 2073 746f 706c 6f73  rder_id: stoplos
+0000eea0: 732d 6f72 6465 722d 6964 2074 6f20 6361  s-order-id to ca
+0000eeb0: 6e63 656c 0a20 2020 2020 2020 203a 7061  ncel.        :pa
+0000eec0: 7261 6d20 7061 6972 3a20 5061 6972 2063  ram pair: Pair c
+0000eed0: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
+0000eee0: 6f72 6465 725f 6964 0a20 2020 2020 2020  order_id.       
+0000eef0: 203a 7061 7261 6d20 616d 6f75 6e74 3a20   :param amount: 
+0000ef00: 416d 6f75 6e74 2074 6f20 7573 6520 666f  Amount to use fo
+0000ef10: 7220 6661 6b65 2072 6573 706f 6e73 650a  r fake response.
+0000ef20: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+0000ef30: 2052 6573 756c 7420 6672 6f6d 2065 6974   Result from eit
+0000ef40: 6865 7220 6361 6e63 656c 5f6f 7264 6572  her cancel_order
+0000ef50: 2069 6620 7573 6162 6c65 2c20 6f72 2066   if usable, or f
+0000ef60: 6574 6368 5f6f 7264 6572 0a20 2020 2020  etch_order.     
+0000ef70: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
+0000ef80: 6f72 6465 7220 3d20 7365 6c66 2e63 616e  order = self.can
+0000ef90: 6365 6c5f 7374 6f70 6c6f 7373 5f6f 7264  cel_stoploss_ord
+0000efa0: 6572 286f 7264 6572 5f69 642c 2070 6169  er(order_id, pai
+0000efb0: 7229 0a20 2020 2020 2020 2069 6620 7365  r).        if se
+0000efc0: 6c66 2e69 735f 6361 6e63 656c 5f6f 7264  lf.is_cancel_ord
+0000efd0: 6572 5f72 6573 756c 745f 7375 6974 6162  er_result_suitab
+0000efe0: 6c65 2863 6f72 6465 7229 3a0a 2020 2020  le(corder):.    
+0000eff0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+0000f000: 6f72 6465 720a 2020 2020 2020 2020 7472  order.        tr
+0000f010: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
+0000f020: 7264 6572 203d 2073 656c 662e 6665 7463  rder = self.fetc
+0000f030: 685f 7374 6f70 6c6f 7373 5f6f 7264 6572  h_stoploss_order
+0000f040: 286f 7264 6572 5f69 642c 2070 6169 7229  (order_id, pair)
+0000f050: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000f060: 496e 7661 6c69 644f 7264 6572 4578 6365  InvalidOrderExce
+0000f070: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+0000f080: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
+0000f090: 6728 6622 436f 756c 6420 6e6f 7420 6665  g(f"Could not fe
+0000f0a0: 7463 6820 6361 6e63 656c 6c65 6420 7374  tch cancelled st
+0000f0b0: 6f70 6c6f 7373 206f 7264 6572 207b 6f72  oploss order {or
+0000f0c0: 6465 725f 6964 7d2e 2229 0a20 2020 2020  der_id}.").     
+0000f0d0: 2020 2020 2020 206f 7264 6572 203d 207b         order = {
+0000f0e0: 2766 6565 273a 207b 7d2c 2027 7374 6174  'fee': {}, 'stat
+0000f0f0: 7573 273a 2027 6361 6e63 656c 6564 272c  us': 'canceled',
+0000f100: 2027 616d 6f75 6e74 273a 2061 6d6f 756e   'amount': amoun
+0000f110: 742c 2027 696e 666f 273a 207b 7d7d 0a0a  t, 'info': {}}..
+0000f120: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0000f130: 7264 6572 0a0a 2020 2020 4072 6574 7269  rder..    @retri
+0000f140: 6572 0a20 2020 2064 6566 2067 6574 5f62  er.    def get_b
+0000f150: 616c 616e 6365 7328 7365 6c66 2920 2d3e  alances(self) ->
+0000f160: 2064 6963 743a 0a0a 2020 2020 2020 2020   dict:..        
+0000f170: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000f180: 2062 616c 616e 6365 7320 3d20 7365 6c66   balances = self
+0000f190: 2e5f 6170 692e 6665 7463 685f 6261 6c61  ._api.fetch_bala
+0000f1a0: 6e63 6528 290a 2020 2020 2020 2020 2020  nce().          
+0000f1b0: 2020 2320 5265 6d6f 7665 2061 6464 6974    # Remove addit
+0000f1c0: 696f 6e61 6c20 696e 666f 2066 726f 6d20  ional info from 
+0000f1d0: 6363 7874 2072 6573 756c 7473 0a20 2020  ccxt results.   
+0000f1e0: 2020 2020 2020 2020 2062 616c 616e 6365           balance
+0000f1f0: 732e 706f 7028 2269 6e66 6f22 2c20 4e6f  s.pop("info", No
+0000f200: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
+0000f210: 6261 6c61 6e63 6573 2e70 6f70 2822 6672  balances.pop("fr
+0000f220: 6565 222c 204e 6f6e 6529 0a20 2020 2020  ee", None).     
+0000f230: 2020 2020 2020 2062 616c 616e 6365 732e         balances.
+0000f240: 706f 7028 2274 6f74 616c 222c 204e 6f6e  pop("total", Non
+0000f250: 6529 0a20 2020 2020 2020 2020 2020 2062  e).            b
+0000f260: 616c 616e 6365 732e 706f 7028 2275 7365  alances.pop("use
+0000f270: 6422 2c20 4e6f 6e65 290a 0a20 2020 2020  d", None)..     
+0000f280: 2020 2020 2020 2072 6574 7572 6e20 6261         return ba
+0000f290: 6c61 6e63 6573 0a20 2020 2020 2020 2065  lances.        e
+0000f2a0: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
+0000f2b0: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
+0000f2c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000f2d0: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
+0000f2e0: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
+0000f2f0: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
+0000f300: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
+0000f310: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
+0000f320: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
+0000f330: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
+0000f340: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
+0000f350: 2020 2020 2020 2020 2020 6627 436f 756c            f'Coul
+0000f360: 6420 6e6f 7420 6765 7420 6261 6c61 6e63  d not get balanc
+0000f370: 6520 6475 6520 746f 207b 652e 5f5f 636c  e due to {e.__cl
+0000f380: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
+0000f390: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
+0000f3a0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+0000f3b0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
+0000f3c0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
+0000f3d0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+0000f3e0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+0000f3f0: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
+0000f400: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
+0000f410: 6620 6665 7463 685f 706f 7369 7469 6f6e  f fetch_position
+0000f420: 7328 7365 6c66 2c20 7061 6972 3a20 4f70  s(self, pair: Op
+0000f430: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+0000f440: 6e65 2920 2d3e 204c 6973 745b 4469 6374  ne) -> List[Dict
+0000f450: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+0000f460: 2020 2020 2020 2046 6574 6368 2070 6f73         Fetch pos
+0000f470: 6974 696f 6e73 2066 726f 6d20 7468 6520  itions from the 
+0000f480: 6578 6368 616e 6765 2e0a 2020 2020 2020  exchange..      
+0000f490: 2020 4966 206e 6f20 7061 6972 2069 7320    If no pair is 
+0000f4a0: 6769 7665 6e2c 2061 6c6c 2070 6f73 6974  given, all posit
+0000f4b0: 696f 6e73 2061 7265 2072 6574 7572 6e65  ions are returne
+0000f4c0: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
+0000f4d0: 6d20 7061 6972 3a20 5061 6972 2066 6f72  m pair: Pair for
+0000f4e0: 2074 6865 2071 7565 7279 0a20 2020 2020   the query.     
+0000f4f0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0000f500: 6620 7365 6c66 2e5f 636f 6e66 6967 5b27  f self._config['
+0000f510: 6472 795f 7275 6e27 5d20 6f72 2073 656c  dry_run'] or sel
+0000f520: 662e 7472 6164 696e 675f 6d6f 6465 2021  f.trading_mode !
+0000f530: 3d20 5472 6164 696e 674d 6f64 652e 4655  = TradingMode.FU
+0000f540: 5455 5245 533a 0a20 2020 2020 2020 2020  TURES:.         
+0000f550: 2020 2072 6574 7572 6e20 5b5d 0a20 2020     return [].   
+0000f560: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000f570: 2020 2020 2020 7379 6d62 6f6c 7320 3d20        symbols = 
+0000f580: 5b5d 0a20 2020 2020 2020 2020 2020 2069  [].            i
+0000f590: 6620 7061 6972 3a0a 2020 2020 2020 2020  f pair:.        
+0000f5a0: 2020 2020 2020 2020 7379 6d62 6f6c 732e          symbols.
+0000f5b0: 6170 7065 6e64 2870 6169 7229 0a20 2020  append(pair).   
+0000f5c0: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
+0000f5d0: 6e73 3a20 4c69 7374 5b44 6963 745d 203d  ns: List[Dict] =
+0000f5e0: 2073 656c 662e 5f61 7069 2e66 6574 6368   self._api.fetch
+0000f5f0: 5f70 6f73 6974 696f 6e73 2873 796d 626f  _positions(symbo
+0000f600: 6c73 290a 2020 2020 2020 2020 2020 2020  ls).            
+0000f610: 7365 6c66 2e5f 6c6f 675f 6578 6368 616e  self._log_exchan
+0000f620: 6765 5f72 6573 706f 6e73 6528 2766 6574  ge_response('fet
+0000f630: 6368 5f70 6f73 6974 696f 6e73 272c 2070  ch_positions', p
+0000f640: 6f73 6974 696f 6e73 290a 2020 2020 2020  ositions).      
+0000f650: 2020 2020 2020 7265 7475 726e 2070 6f73        return pos
+0000f660: 6974 696f 6e73 0a20 2020 2020 2020 2065  itions.        e
+0000f670: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
+0000f680: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
+0000f690: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000f6a0: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
+0000f6b0: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
+0000f6c0: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
+0000f6d0: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
+0000f6e0: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
+0000f6f0: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
+0000f700: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
+0000f710: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
+0000f720: 2020 2020 2020 2020 2020 6627 436f 756c            f'Coul
+0000f730: 6420 6e6f 7420 6765 7420 706f 7369 7469  d not get positi
+0000f740: 6f6e 7320 6475 6520 746f 207b 652e 5f5f  ons due to {e.__
+0000f750: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0000f760: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
+0000f770: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0000f780: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
+0000f790: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
+0000f7a0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+0000f7b0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+0000f7c0: 696f 6e28 6529 2066 726f 6d20 650a 0a20  ion(e) from e.. 
+0000f7d0: 2020 2040 7265 7472 6965 720a 2020 2020     @retrier.    
+0000f7e0: 6465 6620 6665 7463 685f 7472 6164 696e  def fetch_tradin
+0000f7f0: 675f 6665 6573 2873 656c 6629 202d 3e20  g_fees(self) -> 
+0000f800: 4469 6374 5b73 7472 2c20 416e 795d 3a0a  Dict[str, Any]:.
+0000f810: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000f820: 2020 2020 4665 7463 6820 7573 6572 2061      Fetch user a
+0000f830: 6363 6f75 6e74 2074 7261 6469 6e67 2066  ccount trading f
+0000f840: 6565 730a 2020 2020 2020 2020 4361 6e20  ees.        Can 
+0000f850: 6265 2063 6163 6865 642c 2073 686f 756c  be cached, shoul
+0000f860: 6420 6e6f 7420 7570 6461 7465 206f 6674  d not update oft
+0000f870: 656e 2e0a 2020 2020 2020 2020 2222 220a  en..        """.
+0000f880: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
+0000f890: 2e5f 636f 6e66 6967 5b27 6472 795f 7275  ._config['dry_ru
+0000f8a0: 6e27 5d20 6f72 2073 656c 662e 7472 6164  n'] or self.trad
+0000f8b0: 696e 675f 6d6f 6465 2021 3d20 5472 6164  ing_mode != Trad
+0000f8c0: 696e 674d 6f64 652e 4655 5455 5245 530a  ingMode.FUTURES.
+0000f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8e0: 6f72 206e 6f74 2073 656c 662e 6578 6368  or not self.exch
+0000f8f0: 616e 6765 5f68 6173 2827 6665 7463 6854  ange_has('fetchT
+0000f900: 7261 6469 6e67 4665 6573 2729 293a 0a20  radingFees')):. 
+0000f910: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000f920: 6e20 7b7d 0a20 2020 2020 2020 2074 7279  n {}.        try
+0000f930: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+0000f940: 6164 696e 675f 6665 6573 3a20 4469 6374  ading_fees: Dict
+0000f950: 5b73 7472 2c20 416e 795d 203d 2073 656c  [str, Any] = sel
+0000f960: 662e 5f61 7069 2e66 6574 6368 5f74 7261  f._api.fetch_tra
+0000f970: 6469 6e67 5f66 6565 7328 290a 2020 2020  ding_fees().    
+0000f980: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
+0000f990: 675f 6578 6368 616e 6765 5f72 6573 706f  g_exchange_respo
+0000f9a0: 6e73 6528 2766 6574 6368 5f74 7261 6469  nse('fetch_tradi
+0000f9b0: 6e67 5f66 6565 7327 2c20 7472 6164 696e  ng_fees', tradin
+0000f9c0: 675f 6665 6573 290a 2020 2020 2020 2020  g_fees).        
+0000f9d0: 2020 2020 7265 7475 726e 2074 7261 6469      return tradi
+0000f9e0: 6e67 5f66 6565 730a 2020 2020 2020 2020  ng_fees.        
+0000f9f0: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+0000fa00: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+0000fa10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000fa20: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+0000fa30: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+0000fa40: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+0000fa50: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
+0000fa60: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
+0000fa70: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
+0000fa80: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
+0000fa90: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
+0000faa0: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+0000fab0: 6c64 206e 6f74 2066 6574 6368 2074 7261  ld not fetch tra
+0000fac0: 6469 6e67 2066 6565 7320 6475 6520 746f  ding fees due to
+0000fad0: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
+0000fae0: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
+0000faf0: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
+0000fb00: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0000fb10: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
+0000fb20: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000fb30: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+0000fb40: 4578 6365 7074 696f 6e28 6529 2066 726f  Exception(e) fro
+0000fb50: 6d20 650a 0a20 2020 2040 7265 7472 6965  m e..    @retrie
+0000fb60: 720a 2020 2020 6465 6620 6665 7463 685f  r.    def fetch_
+0000fb70: 6269 6473 5f61 736b 7328 7365 6c66 2c20  bids_asks(self, 
+0000fb80: 7379 6d62 6f6c 733a 204f 7074 696f 6e61  symbols: Optiona
+0000fb90: 6c5b 4c69 7374 5b73 7472 5d5d 203d 204e  l[List[str]] = N
+0000fba0: 6f6e 652c 2063 6163 6865 643a 2062 6f6f  one, cached: boo
+0000fbb0: 6c20 3d20 4661 6c73 6529 202d 3e20 4469  l = False) -> Di
+0000fbc0: 6374 3a0a 2020 2020 2020 2020 2222 220a  ct:.        """.
+0000fbd0: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
+0000fbe0: 6163 6865 643a 2041 6c6c 6f77 2063 6163  ached: Allow cac
+0000fbf0: 6865 6420 7265 7375 6c74 0a20 2020 2020  hed result.     
+0000fc00: 2020 203a 7265 7475 726e 3a20 6665 7463     :return: fetc
+0000fc10: 685f 7469 636b 6572 7320 7265 7375 6c74  h_tickers result
+0000fc20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000fc30: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0000fc40: 2e65 7863 6861 6e67 655f 6861 7328 2766  .exchange_has('f
+0000fc50: 6574 6368 4269 6473 4173 6b73 2729 3a0a  etchBidsAsks'):.
+0000fc60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000fc70: 726e 207b 7d0a 2020 2020 2020 2020 6966  rn {}.        if
+0000fc80: 2063 6163 6865 643a 0a20 2020 2020 2020   cached:.       
+0000fc90: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
+0000fca0: 6361 6368 655f 6c6f 636b 3a0a 2020 2020  cache_lock:.    
+0000fcb0: 2020 2020 2020 2020 2020 2020 7469 636b              tick
+0000fcc0: 6572 7320 3d20 7365 6c66 2e5f 6665 7463  ers = self._fetc
+0000fcd0: 685f 7469 636b 6572 735f 6361 6368 652e  h_tickers_cache.
+0000fce0: 6765 7428 2766 6574 6368 5f62 6964 735f  get('fetch_bids_
+0000fcf0: 6173 6b73 2729 0a20 2020 2020 2020 2020  asks').         
+0000fd00: 2020 2069 6620 7469 636b 6572 733a 0a20     if tickers:. 
+0000fd10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000fd20: 6574 7572 6e20 7469 636b 6572 730a 2020  eturn tickers.  
+0000fd30: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000fd40: 2020 2020 2020 2074 6963 6b65 7273 203d         tickers =
+0000fd50: 2073 656c 662e 5f61 7069 2e66 6574 6368   self._api.fetch
+0000fd60: 5f62 6964 735f 6173 6b73 2873 796d 626f  _bids_asks(symbo
+0000fd70: 6c73 290a 2020 2020 2020 2020 2020 2020  ls).            
+0000fd80: 7769 7468 2073 656c 662e 5f63 6163 6865  with self._cache
+0000fd90: 5f6c 6f63 6b3a 0a20 2020 2020 2020 2020  _lock:.         
+0000fda0: 2020 2020 2020 2073 656c 662e 5f66 6574         self._fet
+0000fdb0: 6368 5f74 6963 6b65 7273 5f63 6163 6865  ch_tickers_cache
+0000fdc0: 5b27 6665 7463 685f 6269 6473 5f61 736b  ['fetch_bids_ask
+0000fdd0: 7327 5d20 3d20 7469 636b 6572 730a 2020  s'] = tickers.  
+0000fde0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000fdf0: 2074 6963 6b65 7273 0a20 2020 2020 2020   tickers.       
+0000fe00: 2065 7863 6570 7420 6363 7874 2e4e 6f74   except ccxt.Not
+0000fe10: 5375 7070 6f72 7465 6420 6173 2065 3a0a  Supported as e:.
+0000fe20: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000fe30: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+0000fe40: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+0000fe50: 2020 2020 2020 2020 6627 4578 6368 616e          f'Exchan
+0000fe60: 6765 207b 7365 6c66 2e5f 6170 692e 6e61  ge {self._api.na
+0000fe70: 6d65 7d20 646f 6573 206e 6f74 2073 7570  me} does not sup
+0000fe80: 706f 7274 2066 6574 6368 696e 6720 6269  port fetching bi
+0000fe90: 6473 2f61 736b 7320 696e 2062 6174 6368  ds/asks in batch
+0000fea0: 2e20 270a 2020 2020 2020 2020 2020 2020  . '.            
+0000feb0: 2020 2020 6627 4d65 7373 6167 653a 207b      f'Message: {
+0000fec0: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+0000fed0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+0000fee0: 4444 6f53 5072 6f74 6563 7469 6f6e 2061  DDoSProtection a
+0000fef0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000ff00: 2072 6169 7365 2044 446f 7350 726f 7465   raise DDosProte
+0000ff10: 6374 696f 6e28 6529 2066 726f 6d20 650a  ction(e) from e.
+0000ff20: 2020 2020 2020 2020 6578 6365 7074 2028          except (
+0000ff30: 6363 7874 2e4e 6574 776f 726b 4572 726f  ccxt.NetworkErro
+0000ff40: 722c 2063 6378 742e 4578 6368 616e 6765  r, ccxt.Exchange
+0000ff50: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
+0000ff60: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0000ff70: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
+0000ff80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000ff90: 2743 6f75 6c64 206e 6f74 206c 6f61 6420  'Could not load 
+0000ffa0: 6269 6473 2f61 736b 7320 6475 6520 746f  bids/asks due to
+0000ffb0: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
+0000ffc0: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
+0000ffd0: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
+0000ffe0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0000fff0: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
+00010000: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00010010: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+00010020: 4578 6365 7074 696f 6e28 6529 2066 726f  Exception(e) fro
+00010030: 6d20 650a 0a20 2020 2040 7265 7472 6965  m e..    @retrie
+00010040: 720a 2020 2020 6465 6620 6765 745f 7469  r.    def get_ti
+00010050: 636b 6572 7328 7365 6c66 2c20 7379 6d62  ckers(self, symb
+00010060: 6f6c 733a 204f 7074 696f 6e61 6c5b 4c69  ols: Optional[Li
+00010070: 7374 5b73 7472 5d5d 203d 204e 6f6e 652c  st[str]] = None,
+00010080: 2063 6163 6865 643a 2062 6f6f 6c20 3d20   cached: bool = 
+00010090: 4661 6c73 6529 202d 3e20 5469 636b 6572  False) -> Ticker
+000100a0: 733a 0a20 2020 2020 2020 2022 2222 0a20  s:.        """. 
+000100b0: 2020 2020 2020 203a 7061 7261 6d20 6361         :param ca
+000100c0: 6368 6564 3a20 416c 6c6f 7720 6361 6368  ched: Allow cach
+000100d0: 6564 2072 6573 756c 740a 2020 2020 2020  ed result.      
+000100e0: 2020 3a72 6574 7572 6e3a 2066 6574 6368    :return: fetch
+000100f0: 5f74 6963 6b65 7273 2072 6573 756c 740a  _tickers result.
+00010100: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010110: 2020 2020 7469 636b 6572 733a 2054 6963      tickers: Tic
+00010120: 6b65 7273 0a20 2020 2020 2020 2069 6620  kers.        if 
+00010130: 6e6f 7420 7365 6c66 2e65 7863 6861 6e67  not self.exchang
+00010140: 655f 6861 7328 2766 6574 6368 5469 636b  e_has('fetchTick
+00010150: 6572 7327 293a 0a20 2020 2020 2020 2020  ers'):.         
+00010160: 2020 2072 6574 7572 6e20 7b7d 0a20 2020     return {}.   
+00010170: 2020 2020 2069 6620 6361 6368 6564 3a0a       if cached:.
+00010180: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00010190: 2073 656c 662e 5f63 6163 6865 5f6c 6f63   self._cache_loc
+000101a0: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
+000101b0: 2020 2074 6963 6b65 7273 203d 2073 656c     tickers = sel
+000101c0: 662e 5f66 6574 6368 5f74 6963 6b65 7273  f._fetch_tickers
+000101d0: 5f63 6163 6865 2e67 6574 2827 6665 7463  _cache.get('fetc
+000101e0: 685f 7469 636b 6572 7327 2920 2023 2074  h_tickers')  # t
+000101f0: 7970 653a 2069 676e 6f72 650a 2020 2020  ype: ignore.    
+00010200: 2020 2020 2020 2020 6966 2074 6963 6b65          if ticke
+00010210: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00010220: 2020 2020 7265 7475 726e 2074 6963 6b65      return ticke
+00010230: 7273 0a20 2020 2020 2020 2074 7279 3a0a  rs.        try:.
+00010240: 2020 2020 2020 2020 2020 2020 7469 636b              tick
+00010250: 6572 7320 3d20 7365 6c66 2e5f 6170 692e  ers = self._api.
+00010260: 6665 7463 685f 7469 636b 6572 7328 7379  fetch_tickers(sy
+00010270: 6d62 6f6c 7329 0a20 2020 2020 2020 2020  mbols).         
+00010280: 2020 2077 6974 6820 7365 6c66 2e5f 6361     with self._ca
+00010290: 6368 655f 6c6f 636b 3a0a 2020 2020 2020  che_lock:.      
+000102a0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000102b0: 6665 7463 685f 7469 636b 6572 735f 6361  fetch_tickers_ca
+000102c0: 6368 655b 2766 6574 6368 5f74 6963 6b65  che['fetch_ticke
+000102d0: 7273 275d 203d 2074 6963 6b65 7273 0a20  rs'] = tickers. 
+000102e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000102f0: 6e20 7469 636b 6572 730a 2020 2020 2020  n tickers.      
+00010300: 2020 6578 6365 7074 2063 6378 742e 4e6f    except ccxt.No
+00010310: 7453 7570 706f 7274 6564 2061 7320 653a  tSupported as e:
+00010320: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00010330: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+00010340: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
+00010350: 2020 2020 2020 2020 2066 2745 7863 6861           f'Excha
+00010360: 6e67 6520 7b73 656c 662e 5f61 7069 2e6e  nge {self._api.n
+00010370: 616d 657d 2064 6f65 7320 6e6f 7420 7375  ame} does not su
+00010380: 7070 6f72 7420 6665 7463 6869 6e67 2074  pport fetching t
+00010390: 6963 6b65 7273 2069 6e20 6261 7463 682e  ickers in batch.
+000103a0: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+000103b0: 2020 2066 274d 6573 7361 6765 3a20 7b65     f'Message: {e
+000103c0: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+000103d0: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
+000103e0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
+000103f0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00010400: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
+00010410: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
+00010420: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
+00010430: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
+00010440: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+00010450: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+00010460: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+00010470: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
+00010480: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+00010490: 436f 756c 6420 6e6f 7420 6c6f 6164 2074  Could not load t
+000104a0: 6963 6b65 7273 2064 7565 2074 6f20 7b65  ickers due to {e
+000104b0: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+000104c0: 655f 5f7d 2e20 4d65 7373 6167 653a 207b  e__}. Message: {
+000104d0: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+000104e0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+000104f0: 4261 7365 4572 726f 7220 6173 2065 3a0a  BaseError as e:.
+00010500: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00010510: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+00010520: 6570 7469 6f6e 2865 2920 6672 6f6d 2065  eption(e) from e
+00010530: 0a0a 2020 2020 2320 5072 6963 696e 6720  ..    # Pricing 
+00010540: 696e 666f 0a0a 2020 2020 4072 6574 7269  info..    @retri
+00010550: 6572 0a20 2020 2064 6566 2066 6574 6368  er.    def fetch
+00010560: 5f74 6963 6b65 7228 7365 6c66 2c20 7061  _ticker(self, pa
+00010570: 6972 3a20 7374 7229 202d 3e20 5469 636b  ir: str) -> Tick
+00010580: 6572 3a0a 2020 2020 2020 2020 7472 793a  er:.        try:
+00010590: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000105a0: 2870 6169 7220 6e6f 7420 696e 2073 656c  (pair not in sel
+000105b0: 662e 6d61 726b 6574 7320 6f72 0a20 2020  f.markets or.   
+000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105d0: 2073 656c 662e 6d61 726b 6574 735b 7061   self.markets[pa
+000105e0: 6972 5d2e 6765 7428 2761 6374 6976 6527  ir].get('active'
+000105f0: 2c20 4661 6c73 6529 2069 7320 4661 6c73  , False) is Fals
+00010600: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00010610: 2020 2020 7261 6973 6520 4578 6368 616e      raise Exchan
+00010620: 6765 4572 726f 7228 6622 5061 6972 207b  geError(f"Pair {
+00010630: 7061 6972 7d20 6e6f 7420 6176 6169 6c61  pair} not availa
+00010640: 626c 6522 290a 2020 2020 2020 2020 2020  ble").          
+00010650: 2020 6461 7461 3a20 5469 636b 6572 203d    data: Ticker =
+00010660: 2073 656c 662e 5f61 7069 2e66 6574 6368   self._api.fetch
+00010670: 5f74 6963 6b65 7228 7061 6972 290a 2020  _ticker(pair).  
+00010680: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00010690: 2064 6174 610a 2020 2020 2020 2020 6578   data.        ex
+000106a0: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
+000106b0: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
+000106c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000106d0: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
+000106e0: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
+000106f0: 2020 6578 6365 7074 2028 6363 7874 2e4e    except (ccxt.N
+00010700: 6574 776f 726b 4572 726f 722c 2063 6378  etworkError, ccx
+00010710: 742e 4578 6368 616e 6765 4572 726f 7229  t.ExchangeError)
+00010720: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00010730: 2020 2072 6169 7365 2054 656d 706f 7261     raise Tempora
+00010740: 7279 4572 726f 7228 0a20 2020 2020 2020  ryError(.       
+00010750: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
+00010760: 206e 6f74 206c 6f61 6420 7469 636b 6572   not load ticker
+00010770: 2064 7565 2074 6f20 7b65 2e5f 5f63 6c61   due to {e.__cla
+00010780: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20  ss__.__name__}. 
+00010790: 4d65 7373 6167 653a 207b 657d 2729 2066  Message: {e}') f
+000107a0: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
+000107b0: 6365 7074 2063 6378 742e 4261 7365 4572  cept ccxt.BaseEr
+000107c0: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+000107d0: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+000107e0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+000107f0: 2865 2920 6672 6f6d 2065 0a0a 2020 2020  (e) from e..    
+00010800: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+00010810: 2020 6465 6620 6765 745f 6e65 7874 5f6c    def get_next_l
+00010820: 696d 6974 5f69 6e5f 6c69 7374 286c 696d  imit_in_list(lim
+00010830: 6974 3a20 696e 742c 206c 696d 6974 5f72  it: int, limit_r
+00010840: 616e 6765 3a20 4f70 7469 6f6e 616c 5b4c  ange: Optional[L
+00010850: 6973 745b 696e 745d 5d2c 0a20 2020 2020  ist[int]],.     
+00010860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010870: 2020 2020 2020 2020 2020 7261 6e67 655f            range_
+00010880: 7265 7175 6972 6564 3a20 626f 6f6c 203d  required: bool =
+00010890: 2054 7275 6529 3a0a 2020 2020 2020 2020   True):.        
+000108a0: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+000108b0: 6e65 7874 2067 7265 6174 6572 2076 616c  next greater val
+000108c0: 7565 2069 6e20 7468 6520 6c69 7374 2e0a  ue in the list..
+000108d0: 2020 2020 2020 2020 5573 6564 2062 7920          Used by 
+000108e0: 6665 7463 685f 6c32 5f6f 7264 6572 5f62  fetch_l2_order_b
+000108f0: 6f6f 6b20 6966 2074 6865 2061 7069 206f  ook if the api o
+00010900: 6e6c 7920 7375 7070 6f72 7473 2061 206c  nly supports a l
+00010910: 696d 6974 6564 2072 616e 6765 0a20 2020  imited range.   
+00010920: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00010930: 2069 6620 6e6f 7420 6c69 6d69 745f 7261   if not limit_ra
+00010940: 6e67 653a 0a20 2020 2020 2020 2020 2020  nge:.           
+00010950: 2072 6574 7572 6e20 6c69 6d69 740a 0a20   return limit.. 
+00010960: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00010970: 6d69 6e28 5b78 2066 6f72 2078 2069 6e20  min([x for x in 
+00010980: 6c69 6d69 745f 7261 6e67 6520 6966 206c  limit_range if l
+00010990: 696d 6974 203c 3d20 785d 202b 205b 6d61  imit <= x] + [ma
+000109a0: 7828 6c69 6d69 745f 7261 6e67 6529 5d29  x(limit_range)])
+000109b0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000109c0: 7261 6e67 655f 7265 7175 6972 6564 2061  range_required a
+000109d0: 6e64 206c 696d 6974 203e 2072 6573 756c  nd limit > resul
+000109e0: 743a 0a20 2020 2020 2020 2020 2020 2023  t:.            #
+000109f0: 2052 616e 6765 2069 7320 6e6f 7420 7265   Range is not re
+00010a00: 7175 6972 6564 202d 2077 6520 6361 6e20  quired - we can 
+00010a10: 7573 6520 4e6f 6e65 2061 7320 7061 7261  use None as para
+00010a20: 6d65 7465 722e 0a20 2020 2020 2020 2020  meter..         
+00010a30: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
+00010a40: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00010a50: 7375 6c74 0a0a 2020 2020 4072 6574 7269  sult..    @retri
+00010a60: 6572 0a20 2020 2064 6566 2066 6574 6368  er.    def fetch
+00010a70: 5f6c 325f 6f72 6465 725f 626f 6f6b 2873  _l2_order_book(s
+00010a80: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
+00010a90: 6c69 6d69 743a 2069 6e74 203d 2031 3030  limit: int = 100
+00010aa0: 2920 2d3e 204f 7264 6572 426f 6f6b 3a0a  ) -> OrderBook:.
+00010ab0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010ac0: 2020 2020 4765 7420 4c32 206f 7264 6572      Get L2 order
+00010ad0: 2062 6f6f 6b20 6672 6f6d 2065 7863 6861   book from excha
+00010ae0: 6e67 652e 0a20 2020 2020 2020 2043 616e  nge..        Can
+00010af0: 2062 6520 6c69 6d69 7465 6420 746f 2061   be limited to a
+00010b00: 2063 6572 7461 696e 2061 6d6f 756e 7420   certain amount 
+00010b10: 2869 6620 7375 7070 6f72 7465 6429 2e0a  (if supported)..
+00010b20: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+00010b30: 6120 6469 6374 2069 6e20 7468 6520 666f  a dict in the fo
+00010b40: 726d 6174 0a20 2020 2020 2020 207b 2761  rmat.        {'a
+00010b50: 736b 7327 3a20 5b70 7269 6365 2c20 766f  sks': [price, vo
+00010b60: 6c75 6d65 5d2c 2027 6269 6473 273a 205b  lume], 'bids': [
+00010b70: 7072 6963 652c 2076 6f6c 756d 655d 7d0a  price, volume]}.
+00010b80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010b90: 2020 2020 6c69 6d69 7431 203d 2073 656c      limit1 = sel
+00010ba0: 662e 6765 745f 6e65 7874 5f6c 696d 6974  f.get_next_limit
+00010bb0: 5f69 6e5f 6c69 7374 286c 696d 6974 2c20  _in_list(limit, 
+00010bc0: 7365 6c66 2e5f 6674 5f68 6173 5b27 6c32  self._ft_has['l2
+00010bd0: 5f6c 696d 6974 5f72 616e 6765 275d 2c0a  _limit_range'],.
+00010be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c00: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00010c10: 662e 5f66 745f 6861 735b 276c 325f 6c69  f._ft_has['l2_li
+00010c20: 6d69 745f 7261 6e67 655f 7265 7175 6972  mit_range_requir
+00010c30: 6564 275d 290a 2020 2020 2020 2020 7472  ed']).        tr
+00010c40: 793a 0a0a 2020 2020 2020 2020 2020 2020  y:..            
+00010c50: 7265 7475 726e 2073 656c 662e 5f61 7069  return self._api
+00010c60: 2e66 6574 6368 5f6c 325f 6f72 6465 725f  .fetch_l2_order_
+00010c70: 626f 6f6b 2870 6169 722c 206c 696d 6974  book(pair, limit
+00010c80: 3129 0a20 2020 2020 2020 2065 7863 6570  1).        excep
+00010c90: 7420 6363 7874 2e4e 6f74 5375 7070 6f72  t ccxt.NotSuppor
+00010ca0: 7465 6420 6173 2065 3a0a 2020 2020 2020  ted as e:.      
+00010cb0: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+00010cc0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+00010cd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010ce0: 2020 6627 4578 6368 616e 6765 207b 7365    f'Exchange {se
+00010cf0: 6c66 2e5f 6170 692e 6e61 6d65 7d20 646f  lf._api.name} do
+00010d00: 6573 206e 6f74 2073 7570 706f 7274 2066  es not support f
+00010d10: 6574 6368 696e 6720 6f72 6465 7220 626f  etching order bo
+00010d20: 6f6b 2e27 0a20 2020 2020 2020 2020 2020  ok.'.           
+00010d30: 2020 2020 2066 274d 6573 7361 6765 3a20       f'Message: 
+00010d40: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+00010d50: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+00010d60: 2e44 446f 5350 726f 7465 6374 696f 6e20  .DDoSProtection 
+00010d70: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00010d80: 2020 7261 6973 6520 4444 6f73 5072 6f74    raise DDosProt
+00010d90: 6563 7469 6f6e 2865 2920 6672 6f6d 2065  ection(e) from e
+00010da0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00010db0: 2863 6378 742e 4e65 7477 6f72 6b45 7272  (ccxt.NetworkErr
+00010dc0: 6f72 2c20 6363 7874 2e45 7863 6861 6e67  or, ccxt.Exchang
+00010dd0: 6545 7272 6f72 2920 6173 2065 3a0a 2020  eError) as e:.  
+00010de0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00010df0: 5465 6d70 6f72 6172 7945 7272 6f72 280a  TemporaryError(.
+00010e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e10: 6627 436f 756c 6420 6e6f 7420 6765 7420  f'Could not get 
+00010e20: 6f72 6465 7220 626f 6f6b 2064 7565 2074  order book due t
+00010e30: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
+00010e40: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
+00010e50: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
+00010e60: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+00010e70: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
+00010e80: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00010e90: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00010ea0: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
+00010eb0: 6f6d 2065 0a0a 2020 2020 6465 6620 5f67  om e..    def _g
+00010ec0: 6574 5f70 7269 6365 5f73 6964 6528 7365  et_price_side(se
+00010ed0: 6c66 2c20 7369 6465 3a20 7374 722c 2069  lf, side: str, i
+00010ee0: 735f 7368 6f72 743a 2062 6f6f 6c2c 2063  s_short: bool, c
+00010ef0: 6f6e 665f 7374 7261 7465 6779 3a20 4469  onf_strategy: Di
+00010f00: 6374 2920 2d3e 2042 6964 4173 6b3a 0a20  ct) -> BidAsk:. 
+00010f10: 2020 2020 2020 2070 7269 6365 5f73 6964         price_sid
+00010f20: 6520 3d20 636f 6e66 5f73 7472 6174 6567  e = conf_strateg
+00010f30: 795b 2770 7269 6365 5f73 6964 6527 5d0a  y['price_side'].
+00010f40: 0a20 2020 2020 2020 2069 6620 7072 6963  .        if pric
+00010f50: 655f 7369 6465 2069 6e20 2827 7361 6d65  e_side in ('same
+00010f60: 272c 2027 6f74 6865 7227 293a 0a20 2020  ', 'other'):.   
+00010f70: 2020 2020 2020 2020 2070 7269 6365 5f6d           price_m
+00010f80: 6170 203d 207b 0a20 2020 2020 2020 2020  ap = {.         
+00010f90: 2020 2020 2020 2028 2765 6e74 7279 272c         ('entry',
+00010fa0: 2027 6c6f 6e67 272c 2027 7361 6d65 2729   'long', 'same')
+00010fb0: 3a20 2762 6964 272c 0a20 2020 2020 2020  : 'bid',.       
+00010fc0: 2020 2020 2020 2020 2028 2765 6e74 7279           ('entry
+00010fd0: 272c 2027 6c6f 6e67 272c 2027 6f74 6865  ', 'long', 'othe
+00010fe0: 7227 293a 2027 6173 6b27 2c0a 2020 2020  r'): 'ask',.    
+00010ff0: 2020 2020 2020 2020 2020 2020 2827 656e              ('en
+00011000: 7472 7927 2c20 2773 686f 7274 272c 2027  try', 'short', '
+00011010: 7361 6d65 2729 3a20 2761 736b 272c 0a20  same'): 'ask',. 
+00011020: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00011030: 2765 6e74 7279 272c 2027 7368 6f72 7427  'entry', 'short'
+00011040: 2c20 276f 7468 6572 2729 3a20 2762 6964  , 'other'): 'bid
+00011050: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00011060: 2020 2028 2765 7869 7427 2c20 276c 6f6e     ('exit', 'lon
+00011070: 6727 2c20 2773 616d 6527 293a 2027 6173  g', 'same'): 'as
+00011080: 6b27 2c0a 2020 2020 2020 2020 2020 2020  k',.            
+00011090: 2020 2020 2827 6578 6974 272c 2027 6c6f      ('exit', 'lo
+000110a0: 6e67 272c 2027 6f74 6865 7227 293a 2027  ng', 'other'): '
+000110b0: 6269 6427 2c0a 2020 2020 2020 2020 2020  bid',.          
+000110c0: 2020 2020 2020 2827 6578 6974 272c 2027        ('exit', '
+000110d0: 7368 6f72 7427 2c20 2773 616d 6527 293a  short', 'same'):
+000110e0: 2027 6269 6427 2c0a 2020 2020 2020 2020   'bid',.        
+000110f0: 2020 2020 2020 2020 2827 6578 6974 272c          ('exit',
+00011100: 2027 7368 6f72 7427 2c20 276f 7468 6572   'short', 'other
+00011110: 2729 3a20 2761 736b 272c 0a20 2020 2020  '): 'ask',.     
+00011120: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00011130: 2020 2020 2070 7269 6365 5f73 6964 6520       price_side 
+00011140: 3d20 7072 6963 655f 6d61 705b 2873 6964  = price_map[(sid
+00011150: 652c 2027 7368 6f72 7427 2069 6620 6973  e, 'short' if is
+00011160: 5f73 686f 7274 2065 6c73 6520 276c 6f6e  _short else 'lon
+00011170: 6727 2c20 7072 6963 655f 7369 6465 295d  g', price_side)]
+00011180: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011190: 7072 6963 655f 7369 6465 0a0a 2020 2020  price_side..    
+000111a0: 6465 6620 6765 745f 7261 7465 2873 656c  def get_rate(sel
+000111b0: 662c 2070 6169 723a 2073 7472 2c20 7265  f, pair: str, re
+000111c0: 6672 6573 683a 2062 6f6f 6c2c 0a20 2020  fresh: bool,.   
+000111d0: 2020 2020 2020 2020 2020 2020 2020 7369                si
+000111e0: 6465 3a20 456e 7472 7945 7869 742c 2069  de: EntryExit, i
+000111f0: 735f 7368 6f72 743a 2062 6f6f 6c2c 0a20  s_short: bool,. 
+00011200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011210: 6f72 6465 725f 626f 6f6b 3a20 4f70 7469  order_book: Opti
+00011220: 6f6e 616c 5b4f 7264 6572 426f 6f6b 5d20  onal[OrderBook] 
+00011230: 3d20 4e6f 6e65 2c20 7469 636b 6572 3a20  = None, ticker: 
+00011240: 4f70 7469 6f6e 616c 5b54 6963 6b65 725d  Optional[Ticker]
+00011250: 203d 204e 6f6e 6529 202d 3e20 666c 6f61   = None) -> floa
+00011260: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+00011270: 2020 2020 2020 2043 616c 6375 6c61 7465         Calculate
+00011280: 7320 6269 642f 6173 6b20 7461 7267 6574  s bid/ask target
+00011290: 0a20 2020 2020 2020 2062 6964 2072 6174  .        bid rat
+000112a0: 6520 2d20 6265 7477 6565 6e20 6375 7272  e - between curr
+000112b0: 656e 7420 6173 6b20 7072 6963 6520 616e  ent ask price an
+000112c0: 6420 6c61 7374 2070 7269 6365 0a20 2020  d last price.   
+000112d0: 2020 2020 2061 736b 2072 6174 6520 2d20       ask rate - 
+000112e0: 6569 7468 6572 2075 7369 6e67 2074 6963  either using tic
+000112f0: 6b65 7220 6269 6420 6f72 2066 6972 7374  ker bid or first
+00011300: 2062 6964 2062 6173 6564 206f 6e20 6f72   bid based on or
+00011310: 6465 7262 6f6f 6b0a 2020 2020 2020 2020  derbook.        
+00011320: 6f72 2072 656d 6169 6e20 7374 6174 6963  or remain static
+00011330: 2069 6e20 616e 7920 6f74 6865 7220 6361   in any other ca
+00011340: 7365 2073 696e 6365 2069 7427 7320 6e6f  se since it's no
+00011350: 7420 7570 6461 7469 6e67 2e0a 2020 2020  t updating..    
+00011360: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
+00011370: 2050 6169 7220 746f 2067 6574 2072 6174   Pair to get rat
+00011380: 6520 666f 720a 2020 2020 2020 2020 3a70  e for.        :p
+00011390: 6172 616d 2072 6566 7265 7368 3a20 616c  aram refresh: al
+000113a0: 6c6f 7720 6361 6368 6564 2064 6174 610a  low cached data.
+000113b0: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+000113c0: 6964 653a 2022 6275 7922 206f 7220 2273  ide: "buy" or "s
+000113d0: 656c 6c22 0a20 2020 2020 2020 203a 7265  ell".        :re
+000113e0: 7475 726e 3a20 666c 6f61 743a 2050 7269  turn: float: Pri
+000113f0: 6365 0a20 2020 2020 2020 203a 7261 6973  ce.        :rais
+00011400: 6573 2050 7269 6369 6e67 4572 726f 7220  es PricingError 
+00011410: 6966 206f 7264 6572 626f 6f6b 2070 7269  if orderbook pri
+00011420: 6365 2063 6f75 6c64 206e 6f74 2062 6520  ce could not be 
+00011430: 6465 7465 726d 696e 6564 2e0a 2020 2020  determined..    
+00011440: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00011450: 6e61 6d65 203d 2073 6964 652e 6361 7069  name = side.capi
+00011460: 7461 6c69 7a65 2829 0a20 2020 2020 2020  talize().       
+00011470: 2073 7472 6174 5f6e 616d 6520 3d20 2765   strat_name = 'e
+00011480: 6e74 7279 5f70 7269 6369 6e67 2720 6966  ntry_pricing' if
+00011490: 2073 6964 6520 3d3d 2022 656e 7472 7922   side == "entry"
+000114a0: 2065 6c73 6520 2765 7869 745f 7072 6963   else 'exit_pric
+000114b0: 696e 6727 0a0a 2020 2020 2020 2020 6361  ing'..        ca
+000114c0: 6368 655f 7261 7465 3a20 5454 4c43 6163  che_rate: TTLCac
+000114d0: 6865 203d 2073 656c 662e 5f65 6e74 7279  he = self._entry
+000114e0: 5f72 6174 655f 6361 6368 6520 6966 2073  _rate_cache if s
+000114f0: 6964 6520 3d3d 2022 656e 7472 7922 2065  ide == "entry" e
+00011500: 6c73 6520 7365 6c66 2e5f 6578 6974 5f72  lse self._exit_r
+00011510: 6174 655f 6361 6368 650a 2020 2020 2020  ate_cache.      
+00011520: 2020 6966 206e 6f74 2072 6566 7265 7368    if not refresh
+00011530: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+00011540: 7468 2073 656c 662e 5f63 6163 6865 5f6c  th self._cache_l
+00011550: 6f63 6b3a 0a20 2020 2020 2020 2020 2020  ock:.           
+00011560: 2020 2020 2072 6174 6520 3d20 6361 6368       rate = cach
+00011570: 655f 7261 7465 2e67 6574 2870 6169 7229  e_rate.get(pair)
+00011580: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00011590: 6865 636b 2069 6620 6361 6368 6520 6861  heck if cache ha
+000115a0: 7320 6265 656e 2069 6e76 616c 6964 6174  s been invalidat
+000115b0: 6564 0a20 2020 2020 2020 2020 2020 2069  ed.            i
+000115c0: 6620 7261 7465 3a0a 2020 2020 2020 2020  f rate:.        
+000115d0: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
+000115e0: 6562 7567 2866 2255 7369 6e67 2063 6163  ebug(f"Using cac
+000115f0: 6865 6420 7b73 6964 657d 2072 6174 6520  hed {side} rate 
+00011600: 666f 7220 7b70 6169 727d 2e22 290a 2020  for {pair}.").  
+00011610: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00011620: 7475 726e 2072 6174 650a 0a20 2020 2020  turn rate..     
+00011630: 2020 2063 6f6e 665f 7374 7261 7465 6779     conf_strategy
+00011640: 203d 2073 656c 662e 5f63 6f6e 6669 672e   = self._config.
+00011650: 6765 7428 7374 7261 745f 6e61 6d65 2c20  get(strat_name, 
+00011660: 7b7d 290a 0a20 2020 2020 2020 2070 7269  {})..        pri
+00011670: 6365 5f73 6964 6520 3d20 7365 6c66 2e5f  ce_side = self._
+00011680: 6765 745f 7072 6963 655f 7369 6465 2873  get_price_side(s
+00011690: 6964 652c 2069 735f 7368 6f72 742c 2063  ide, is_short, c
+000116a0: 6f6e 665f 7374 7261 7465 6779 290a 0a20  onf_strategy).. 
+000116b0: 2020 2020 2020 2070 7269 6365 5f73 6964         price_sid
+000116c0: 655f 776f 7264 203d 2070 7269 6365 5f73  e_word = price_s
+000116d0: 6964 652e 6361 7069 7461 6c69 7a65 2829  ide.capitalize()
+000116e0: 0a0a 2020 2020 2020 2020 6966 2063 6f6e  ..        if con
+000116f0: 665f 7374 7261 7465 6779 2e67 6574 2827  f_strategy.get('
+00011700: 7573 655f 6f72 6465 725f 626f 6f6b 272c  use_order_book',
+00011710: 2046 616c 7365 293a 0a0a 2020 2020 2020   False):..      
+00011720: 2020 2020 2020 6f72 6465 725f 626f 6f6b        order_book
+00011730: 5f74 6f70 203d 2063 6f6e 665f 7374 7261  _top = conf_stra
+00011740: 7465 6779 2e67 6574 2827 6f72 6465 725f  tegy.get('order_
+00011750: 626f 6f6b 5f74 6f70 272c 2031 290a 2020  book_top', 1).  
+00011760: 2020 2020 2020 2020 2020 6966 206f 7264            if ord
+00011770: 6572 5f62 6f6f 6b20 6973 204e 6f6e 653a  er_book is None:
+00011780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011790: 206f 7264 6572 5f62 6f6f 6b20 3d20 7365   order_book = se
+000117a0: 6c66 2e66 6574 6368 5f6c 325f 6f72 6465  lf.fetch_l2_orde
+000117b0: 725f 626f 6f6b 2870 6169 722c 206f 7264  r_book(pair, ord
+000117c0: 6572 5f62 6f6f 6b5f 746f 7029 0a20 2020  er_book_top).   
+000117d0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+000117e0: 6465 6275 6728 276f 7264 6572 5f62 6f6f  debug('order_boo
+000117f0: 6b20 2573 272c 206f 7264 6572 5f62 6f6f  k %s', order_boo
+00011800: 6b29 0a20 2020 2020 2020 2020 2020 2023  k).            #
+00011810: 2074 6f70 2031 203d 2069 6e64 6578 2030   top 1 = index 0
+00011820: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00011830: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011840: 2020 6f62 7369 6465 3a20 4f42 4c69 7465    obside: OBLite
+00011850: 7261 6c20 3d20 2762 6964 7327 2069 6620  ral = 'bids' if 
+00011860: 7072 6963 655f 7369 6465 203d 3d20 2762  price_side == 'b
+00011870: 6964 2720 656c 7365 2027 6173 6b73 270a  id' else 'asks'.
+00011880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011890: 7261 7465 203d 206f 7264 6572 5f62 6f6f  rate = order_boo
+000118a0: 6b5b 6f62 7369 6465 5d5b 6f72 6465 725f  k[obside][order_
+000118b0: 626f 6f6b 5f74 6f70 202d 2031 5d5b 305d  book_top - 1][0]
+000118c0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+000118d0: 6570 7420 2849 6e64 6578 4572 726f 722c  ept (IndexError,
+000118e0: 204b 6579 4572 726f 7229 2061 7320 653a   KeyError) as e:
+000118f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011900: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
+00011910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011920: 2020 2020 2066 227b 7061 6972 7d20 2d20       f"{pair} - 
+00011930: 7b6e 616d 657d 2050 7269 6365 2061 7420  {name} Price at 
+00011940: 6c6f 6361 7469 6f6e 207b 6f72 6465 725f  location {order_
+00011950: 626f 6f6b 5f74 6f70 7d20 6672 6f6d 206f  book_top} from o
+00011960: 7264 6572 626f 6f6b 2022 0a20 2020 2020  rderbook ".     
+00011970: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00011980: 2263 6f75 6c64 206e 6f74 2062 6520 6465  "could not be de
+00011990: 7465 726d 696e 6564 2e20 4f72 6465 7262  termined. Orderb
+000119a0: 6f6f 6b3a 207b 6f72 6465 725f 626f 6f6b  ook: {order_book
+000119b0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+000119c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000119d0: 2020 2020 2072 6169 7365 2050 7269 6369       raise Prici
+000119e0: 6e67 4572 726f 7220 6672 6f6d 2065 0a20  ngError from e. 
+000119f0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00011a00: 722e 6465 6275 6728 6622 7b70 6169 727d  r.debug(f"{pair}
+00011a10: 202d 207b 6e61 6d65 7d20 7072 6963 6520   - {name} price 
+00011a20: 6672 6f6d 206f 7264 6572 626f 6f6b 207b  from orderbook {
+00011a30: 7072 6963 655f 7369 6465 5f77 6f72 647d  price_side_word}
+00011a40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00011a50: 2020 2020 2020 2020 2020 2066 2273 6964             f"sid
+00011a60: 6520 2d20 746f 7020 7b6f 7264 6572 5f62  e - top {order_b
+00011a70: 6f6f 6b5f 746f 707d 206f 7264 6572 2062  ook_top} order b
+00011a80: 6f6f 6b20 7b73 6964 657d 2072 6174 6520  ook {side} rate 
+00011a90: 7b72 6174 653a 2e38 667d 2229 0a20 2020  {rate:.8f}").   
+00011aa0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00011ab0: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+00011ac0: 6275 6728 6622 5573 696e 6720 4c61 7374  bug(f"Using Last
+00011ad0: 207b 7072 6963 655f 7369 6465 5f77 6f72   {price_side_wor
+00011ae0: 647d 202f 204c 6173 7420 5072 6963 6522  d} / Last Price"
+00011af0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00011b00: 2074 6963 6b65 7220 6973 204e 6f6e 653a   ticker is None:
+00011b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011b20: 2074 6963 6b65 7220 3d20 7365 6c66 2e66   ticker = self.f
+00011b30: 6574 6368 5f74 6963 6b65 7228 7061 6972  etch_ticker(pair
+00011b40: 290a 2020 2020 2020 2020 2020 2020 7469  ).            ti
+00011b50: 636b 6572 5f72 6174 6520 3d20 7469 636b  cker_rate = tick
+00011b60: 6572 5b70 7269 6365 5f73 6964 655d 0a20  er[price_side]. 
+00011b70: 2020 2020 2020 2020 2020 2069 6620 7469             if ti
+00011b80: 636b 6572 5b27 6c61 7374 275d 2061 6e64  cker['last'] and
+00011b90: 2074 6963 6b65 725f 7261 7465 3a0a 2020   ticker_rate:.  
+00011ba0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00011bb0: 2073 6964 6520 3d3d 2027 656e 7472 7927   side == 'entry'
+00011bc0: 2061 6e64 2074 6963 6b65 725f 7261 7465   and ticker_rate
+00011bd0: 203e 2074 6963 6b65 725b 276c 6173 7427   > ticker['last'
+00011be0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00011bf0: 2020 2020 2020 2062 616c 616e 6365 203d         balance =
+00011c00: 2063 6f6e 665f 7374 7261 7465 6779 2e67   conf_strategy.g
+00011c10: 6574 2827 7072 6963 655f 6c61 7374 5f62  et('price_last_b
+00011c20: 616c 616e 6365 272c 2030 2e30 290a 2020  alance', 0.0).  
+00011c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c40: 2020 7469 636b 6572 5f72 6174 6520 3d20    ticker_rate = 
+00011c50: 7469 636b 6572 5f72 6174 6520 2b20 6261  ticker_rate + ba
+00011c60: 6c61 6e63 6520 2a20 2874 6963 6b65 725b  lance * (ticker[
+00011c70: 276c 6173 7427 5d20 2d20 7469 636b 6572  'last'] - ticker
+00011c80: 5f72 6174 6529 0a20 2020 2020 2020 2020  _rate).         
+00011c90: 2020 2020 2020 2065 6c69 6620 7369 6465         elif side
+00011ca0: 203d 3d20 2765 7869 7427 2061 6e64 2074   == 'exit' and t
+00011cb0: 6963 6b65 725f 7261 7465 203c 2074 6963  icker_rate < tic
+00011cc0: 6b65 725b 276c 6173 7427 5d3a 0a20 2020  ker['last']:.   
+00011cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ce0: 2062 616c 616e 6365 203d 2063 6f6e 665f   balance = conf_
+00011cf0: 7374 7261 7465 6779 2e67 6574 2827 7072  strategy.get('pr
+00011d00: 6963 655f 6c61 7374 5f62 616c 616e 6365  ice_last_balance
+00011d10: 272c 2030 2e30 290a 2020 2020 2020 2020  ', 0.0).        
+00011d20: 2020 2020 2020 2020 2020 2020 7469 636b              tick
+00011d30: 6572 5f72 6174 6520 3d20 7469 636b 6572  er_rate = ticker
+00011d40: 5f72 6174 6520 2d20 6261 6c61 6e63 6520  _rate - balance 
+00011d50: 2a20 2874 6963 6b65 725f 7261 7465 202d  * (ticker_rate -
+00011d60: 2074 6963 6b65 725b 276c 6173 7427 5d29   ticker['last'])
+00011d70: 0a20 2020 2020 2020 2020 2020 2072 6174  .            rat
+00011d80: 6520 3d20 7469 636b 6572 5f72 6174 650a  e = ticker_rate.
+00011d90: 0a20 2020 2020 2020 2069 6620 7261 7465  .        if rate
+00011da0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00011db0: 2020 2020 2020 7261 6973 6520 5072 6963        raise Pric
+00011dc0: 696e 6745 7272 6f72 2866 227b 6e61 6d65  ingError(f"{name
+00011dd0: 7d2d 5261 7465 2066 6f72 207b 7061 6972  }-Rate for {pair
+00011de0: 7d20 7761 7320 656d 7074 792e 2229 0a20  } was empty."). 
+00011df0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+00011e00: 2e5f 6361 6368 655f 6c6f 636b 3a0a 2020  ._cache_lock:.  
+00011e10: 2020 2020 2020 2020 2020 6361 6368 655f            cache_
+00011e20: 7261 7465 5b70 6169 725d 203d 2072 6174  rate[pair] = rat
+00011e30: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
+00011e40: 6e20 7261 7465 0a0a 2020 2020 6465 6620  n rate..    def 
+00011e50: 6765 745f 7261 7465 7328 7365 6c66 2c20  get_rates(self, 
+00011e60: 7061 6972 3a20 7374 722c 2072 6566 7265  pair: str, refre
+00011e70: 7368 3a20 626f 6f6c 2c20 6973 5f73 686f  sh: bool, is_sho
+00011e80: 7274 3a20 626f 6f6c 2920 2d3e 2054 7570  rt: bool) -> Tup
+00011e90: 6c65 5b66 6c6f 6174 2c20 666c 6f61 745d  le[float, float]
+00011ea0: 3a0a 2020 2020 2020 2020 656e 7472 795f  :.        entry_
+00011eb0: 7261 7465 203d 204e 6f6e 650a 2020 2020  rate = None.    
+00011ec0: 2020 2020 6578 6974 5f72 6174 6520 3d20      exit_rate = 
+00011ed0: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
+00011ee0: 6e6f 7420 7265 6672 6573 683a 0a20 2020  not refresh:.   
+00011ef0: 2020 2020 2020 2020 2077 6974 6820 7365           with se
+00011f00: 6c66 2e5f 6361 6368 655f 6c6f 636b 3a0a  lf._cache_lock:.
+00011f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f20: 656e 7472 795f 7261 7465 203d 2073 656c  entry_rate = sel
+00011f30: 662e 5f65 6e74 7279 5f72 6174 655f 6361  f._entry_rate_ca
+00011f40: 6368 652e 6765 7428 7061 6972 290a 2020  che.get(pair).  
+00011f50: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00011f60: 6974 5f72 6174 6520 3d20 7365 6c66 2e5f  it_rate = self._
+00011f70: 6578 6974 5f72 6174 655f 6361 6368 652e  exit_rate_cache.
+00011f80: 6765 7428 7061 6972 290a 2020 2020 2020  get(pair).      
+00011f90: 2020 2020 2020 6966 2065 6e74 7279 5f72        if entry_r
+00011fa0: 6174 653a 0a20 2020 2020 2020 2020 2020  ate:.           
+00011fb0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00011fc0: 6728 6622 5573 696e 6720 6361 6368 6564  g(f"Using cached
+00011fd0: 2062 7579 2072 6174 6520 666f 7220 7b70   buy rate for {p
+00011fe0: 6169 727d 2e22 290a 2020 2020 2020 2020  air}.").        
+00011ff0: 2020 2020 6966 2065 7869 745f 7261 7465      if exit_rate
+00012000: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012010: 2020 6c6f 6767 6572 2e64 6562 7567 2866    logger.debug(f
+00012020: 2255 7369 6e67 2063 6163 6865 6420 7365  "Using cached se
+00012030: 6c6c 2072 6174 6520 666f 7220 7b70 6169  ll rate for {pai
+00012040: 727d 2e22 290a 0a20 2020 2020 2020 2065  r}.")..        e
+00012050: 6e74 7279 5f70 7269 6369 6e67 203d 2073  ntry_pricing = s
+00012060: 656c 662e 5f63 6f6e 6669 672e 6765 7428  elf._config.get(
+00012070: 2765 6e74 7279 5f70 7269 6369 6e67 272c  'entry_pricing',
+00012080: 207b 7d29 0a20 2020 2020 2020 2065 7869   {}).        exi
+00012090: 745f 7072 6963 696e 6720 3d20 7365 6c66  t_pricing = self
+000120a0: 2e5f 636f 6e66 6967 2e67 6574 2827 6578  ._config.get('ex
+000120b0: 6974 5f70 7269 6369 6e67 272c 207b 7d29  it_pricing', {})
+000120c0: 0a20 2020 2020 2020 206f 7264 6572 5f62  .        order_b
+000120d0: 6f6f 6b20 3d20 7469 636b 6572 203d 204e  ook = ticker = N
+000120e0: 6f6e 650a 2020 2020 2020 2020 6966 206e  one.        if n
+000120f0: 6f74 2065 6e74 7279 5f72 6174 6520 616e  ot entry_rate an
+00012100: 6420 656e 7472 795f 7072 6963 696e 672e  d entry_pricing.
+00012110: 6765 7428 2775 7365 5f6f 7264 6572 5f62  get('use_order_b
+00012120: 6f6f 6b27 2c20 4661 6c73 6529 3a0a 2020  ook', False):.  
+00012130: 2020 2020 2020 2020 2020 6f72 6465 725f            order_
+00012140: 626f 6f6b 5f74 6f70 203d 206d 6178 2865  book_top = max(e
+00012150: 6e74 7279 5f70 7269 6369 6e67 2e67 6574  ntry_pricing.get
+00012160: 2827 6f72 6465 725f 626f 6f6b 5f74 6f70  ('order_book_top
+00012170: 272c 2031 292c 0a20 2020 2020 2020 2020  ', 1),.         
+00012180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012190: 2020 2020 2020 2020 6578 6974 5f70 7269          exit_pri
+000121a0: 6369 6e67 2e67 6574 2827 6f72 6465 725f  cing.get('order_
+000121b0: 626f 6f6b 5f74 6f70 272c 2031 2929 0a20  book_top', 1)). 
+000121c0: 2020 2020 2020 2020 2020 206f 7264 6572             order
+000121d0: 5f62 6f6f 6b20 3d20 7365 6c66 2e66 6574  _book = self.fet
+000121e0: 6368 5f6c 325f 6f72 6465 725f 626f 6f6b  ch_l2_order_book
+000121f0: 2870 6169 722c 206f 7264 6572 5f62 6f6f  (pair, order_boo
+00012200: 6b5f 746f 7029 0a20 2020 2020 2020 2020  k_top).         
+00012210: 2020 2065 6e74 7279 5f72 6174 6520 3d20     entry_rate = 
+00012220: 7365 6c66 2e67 6574 5f72 6174 6528 7061  self.get_rate(pa
+00012230: 6972 2c20 7265 6672 6573 682c 2027 656e  ir, refresh, 'en
+00012240: 7472 7927 2c20 6973 5f73 686f 7274 2c20  try', is_short, 
+00012250: 6f72 6465 725f 626f 6f6b 3d6f 7264 6572  order_book=order
+00012260: 5f62 6f6f 6b29 0a20 2020 2020 2020 2065  _book).        e
+00012270: 6c69 6620 6e6f 7420 656e 7472 795f 7261  lif not entry_ra
+00012280: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
+00012290: 7469 636b 6572 203d 2073 656c 662e 6665  ticker = self.fe
+000122a0: 7463 685f 7469 636b 6572 2870 6169 7229  tch_ticker(pair)
+000122b0: 0a20 2020 2020 2020 2020 2020 2065 6e74  .            ent
+000122c0: 7279 5f72 6174 6520 3d20 7365 6c66 2e67  ry_rate = self.g
+000122d0: 6574 5f72 6174 6528 7061 6972 2c20 7265  et_rate(pair, re
+000122e0: 6672 6573 682c 2027 656e 7472 7927 2c20  fresh, 'entry', 
+000122f0: 6973 5f73 686f 7274 2c20 7469 636b 6572  is_short, ticker
+00012300: 3d74 6963 6b65 7229 0a20 2020 2020 2020  =ticker).       
+00012310: 2069 6620 6e6f 7420 6578 6974 5f72 6174   if not exit_rat
+00012320: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
+00012330: 7869 745f 7261 7465 203d 2073 656c 662e  xit_rate = self.
+00012340: 6765 745f 7261 7465 2870 6169 722c 2072  get_rate(pair, r
+00012350: 6566 7265 7368 2c20 2765 7869 7427 2c0a  efresh, 'exit',.
+00012360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012380: 2020 2020 2020 6973 5f73 686f 7274 2c20        is_short, 
+00012390: 6f72 6465 725f 626f 6f6b 3d6f 7264 6572  order_book=order
+000123a0: 5f62 6f6f 6b2c 2074 6963 6b65 723d 7469  _book, ticker=ti
+000123b0: 636b 6572 290a 2020 2020 2020 2020 7265  cker).        re
+000123c0: 7475 726e 2065 6e74 7279 5f72 6174 652c  turn entry_rate,
+000123d0: 2065 7869 745f 7261 7465 0a0a 2020 2020   exit_rate..    
+000123e0: 2320 4665 6520 6861 6e64 6c69 6e67 0a0a  # Fee handling..
+000123f0: 2020 2020 4072 6574 7269 6572 0a20 2020      @retrier.   
+00012400: 2064 6566 2067 6574 5f74 7261 6465 735f   def get_trades_
+00012410: 666f 725f 6f72 6465 7228 7365 6c66 2c20  for_order(self, 
+00012420: 6f72 6465 725f 6964 3a20 7374 722c 2070  order_id: str, p
+00012430: 6169 723a 2073 7472 2c20 7369 6e63 653a  air: str, since:
+00012440: 2064 6174 6574 696d 652c 0a20 2020 2020   datetime,.     
+00012450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012460: 2020 2020 2020 2020 7061 7261 6d73 3a20          params: 
+00012470: 4f70 7469 6f6e 616c 5b44 6963 745d 203d  Optional[Dict] =
+00012480: 204e 6f6e 6529 202d 3e20 4c69 7374 3a0a   None) -> List:.
+00012490: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000124a0: 2020 2020 4665 7463 6820 4f72 6465 7273      Fetch Orders
+000124b0: 2075 7369 6e67 2074 6865 2022 6665 7463   using the "fetc
+000124c0: 685f 6d79 5f74 7261 6465 7322 2065 6e64  h_my_trades" end
+000124d0: 706f 696e 7420 616e 6420 6669 6c74 6572  point and filter
+000124e0: 2074 6865 6d20 6279 206f 7264 6572 2d69   them by order-i
+000124f0: 642e 0a20 2020 2020 2020 2054 6865 2022  d..        The "
+00012500: 7369 6e63 6522 2061 7267 756d 656e 7420  since" argument 
+00012510: 7061 7373 6564 2069 6e20 6973 2063 6f6d  passed in is com
+00012520: 696e 6720 6672 6f6d 2074 6865 2064 6174  ing from the dat
+00012530: 6162 6173 6520 616e 6420 6973 2069 6e20  abase and is in 
+00012540: 5554 432c 0a20 2020 2020 2020 2061 7320  UTC,.        as 
+00012550: 7469 6d65 7a6f 6e65 2d6e 6174 6976 6520  timezone-native 
+00012560: 6461 7465 7469 6d65 206f 626a 6563 742e  datetime object.
+00012570: 0a20 2020 2020 2020 2046 726f 6d20 7468  .        From th
+00012580: 6520 7079 7468 6f6e 2064 6f63 756d 656e  e python documen
+00012590: 7461 7469 6f6e 3a0a 2020 2020 2020 2020  tation:.        
+000125a0: 2020 2020 3e20 4e61 6976 6520 6461 7465      > Naive date
+000125b0: 7469 6d65 2069 6e73 7461 6e63 6573 2061  time instances a
+000125c0: 7265 2061 7373 756d 6564 2074 6f20 7265  re assumed to re
+000125d0: 7072 6573 656e 7420 6c6f 6361 6c20 7469  present local ti
+000125e0: 6d65 0a20 2020 2020 2020 2054 6865 7265  me.        There
+000125f0: 666f 7265 2c20 6361 6c6c 696e 6720 2273  fore, calling "s
+00012600: 696e 6365 2e74 696d 6573 7461 6d70 2829  ince.timestamp()
+00012610: 2220 7769 6c6c 2067 6574 2074 6865 2055  " will get the U
+00012620: 5443 2074 696d 6573 7461 6d70 2c20 6166  TC timestamp, af
+00012630: 7465 7220 6170 706c 7969 6e67 2074 6865  ter applying the
+00012640: 0a20 2020 2020 2020 2074 7261 6e73 666f  .        transfo
+00012650: 726d 6174 696f 6e20 6672 6f6d 206c 6f63  rmation from loc
+00012660: 616c 2074 696d 657a 6f6e 6520 746f 2055  al timezone to U
+00012670: 5443 2e0a 2020 2020 2020 2020 5468 6973  TC..        This
+00012680: 2077 6f72 6b73 2066 6f72 2074 696d 657a   works for timez
+00012690: 6f6e 6573 2055 5443 2b20 7369 6e63 6520  ones UTC+ since 
+000126a0: 7468 656e 2074 6865 2072 6573 756c 7420  then the result 
+000126b0: 7769 6c6c 2063 6f6e 7461 696e 2074 7261  will contain tra
+000126c0: 6465 7320 6672 6f6d 2061 2066 6577 2068  des from a few h
+000126d0: 6f75 7273 0a20 2020 2020 2020 2069 6e73  ours.        ins
+000126e0: 7465 6164 206f 6620 6672 6f6d 2074 6865  tead of from the
+000126f0: 206c 6173 7420 3520 7365 636f 6e64 732c   last 5 seconds,
+00012700: 2068 6f77 6576 6572 2066 6169 6c73 2066   however fails f
+00012710: 6f72 2055 5443 2d20 7469 6d65 7a6f 6e65  or UTC- timezone
+00012720: 732c 0a20 2020 2020 2020 2073 696e 6365  s,.        since
+00012730: 2077 6527 7265 2074 6865 6e20 6173 6b69   we're then aski
+00012740: 6e67 2066 6f72 2074 7261 6465 7320 7769  ng for trades wi
+00012750: 7468 2061 2022 7369 6e63 6522 2061 7267  th a "since" arg
+00012760: 756d 656e 7420 696e 2074 6865 2066 7574  ument in the fut
+00012770: 7572 652e 0a0a 2020 2020 2020 2020 3a70  ure...        :p
+00012780: 6172 616d 206f 7264 6572 5f69 6420 6f72  aram order_id or
+00012790: 6465 725f 6964 3a20 4f72 6465 722d 6964  der_id: Order-id
+000127a0: 2061 7320 6769 7665 6e20 7768 656e 2063   as given when c
+000127b0: 7265 6174 696e 6720 7468 6520 6f72 6465  reating the orde
+000127c0: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
+000127d0: 2070 6169 723a 2050 6169 7220 7468 6520   pair: Pair the 
+000127e0: 6f72 6465 7220 6973 2066 6f72 0a20 2020  order is for.   
+000127f0: 2020 2020 203a 7061 7261 6d20 7369 6e63       :param sinc
+00012800: 653a 2064 6174 6574 696d 6520 6f62 6a65  e: datetime obje
+00012810: 6374 206f 6620 7468 6520 6f72 6465 7220  ct of the order 
+00012820: 6372 6561 7469 6f6e 2074 696d 652e 2041  creation time. A
+00012830: 7373 756d 6573 206f 626a 6563 7420 6973  ssumes object is
+00012840: 2069 6e20 5554 432e 0a20 2020 2020 2020   in UTC..       
+00012850: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00012860: 7365 6c66 2e5f 636f 6e66 6967 5b27 6472  self._config['dr
+00012870: 795f 7275 6e27 5d3a 0a20 2020 2020 2020  y_run']:.       
+00012880: 2020 2020 2072 6574 7572 6e20 5b5d 0a20       return []. 
+00012890: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+000128a0: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
+000128b0: 2766 6574 6368 4d79 5472 6164 6573 2729  'fetchMyTrades')
+000128c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000128d0: 7475 726e 205b 5d0a 2020 2020 2020 2020  turn [].        
+000128e0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000128f0: 2023 2041 6c6c 6f77 2035 7320 6f66 6673   # Allow 5s offs
+00012900: 6574 2074 6f20 6361 7463 6820 736c 6967  et to catch slig
+00012910: 6874 2074 696d 6520 6f66 6673 6574 7320  ht time offsets 
+00012920: 2864 6973 636f 7665 7265 6420 696e 2023  (discovered in #
+00012930: 3131 3835 290a 2020 2020 2020 2020 2020  1185).          
+00012940: 2020 2320 7369 6e63 6520 6e65 6564 7320    # since needs 
+00012950: 746f 2062 6520 696e 7420 696e 206d 696c  to be int in mil
+00012960: 6c69 7365 636f 6e64 730a 2020 2020 2020  liseconds.      
+00012970: 2020 2020 2020 5f70 6172 616d 7320 3d20        _params = 
+00012980: 7061 7261 6d73 2069 6620 7061 7261 6d73  params if params
+00012990: 2065 6c73 6520 7b7d 0a20 2020 2020 2020   else {}.       
+000129a0: 2020 2020 206d 795f 7472 6164 6573 203d       my_trades =
+000129b0: 2073 656c 662e 5f61 7069 2e66 6574 6368   self._api.fetch
+000129c0: 5f6d 795f 7472 6164 6573 280a 2020 2020  _my_trades(.    
+000129d0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+000129e0: 2c20 696e 7428 2873 696e 6365 2e72 6570  , int((since.rep
+000129f0: 6c61 6365 2874 7a69 6e66 6f3d 7469 6d65  lace(tzinfo=time
+00012a00: 7a6f 6e65 2e75 7463 292e 7469 6d65 7374  zone.utc).timest
+00012a10: 616d 7028 2920 2d20 3529 202a 2031 3030  amp() - 5) * 100
+00012a20: 3029 2c0a 2020 2020 2020 2020 2020 2020  0),.            
+00012a30: 2020 2020 7061 7261 6d73 3d5f 7061 7261      params=_para
+00012a40: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
+00012a50: 6d61 7463 6865 645f 7472 6164 6573 203d  matched_trades =
+00012a60: 205b 7472 6164 6520 666f 7220 7472 6164   [trade for trad
+00012a70: 6520 696e 206d 795f 7472 6164 6573 2069  e in my_trades i
+00012a80: 6620 7472 6164 655b 276f 7264 6572 275d  f trade['order']
+00012a90: 203d 3d20 6f72 6465 725f 6964 5d0a 0a20   == order_id].. 
+00012aa0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00012ab0: 5f6c 6f67 5f65 7863 6861 6e67 655f 7265  _log_exchange_re
+00012ac0: 7370 6f6e 7365 2827 6765 745f 7472 6164  sponse('get_trad
+00012ad0: 6573 5f66 6f72 5f6f 7264 6572 272c 206d  es_for_order', m
+00012ae0: 6174 6368 6564 5f74 7261 6465 7329 0a0a  atched_trades)..
+00012af0: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
+00012b00: 6865 645f 7472 6164 6573 203d 2073 656c  hed_trades = sel
+00012b10: 662e 5f74 7261 6465 735f 636f 6e74 7261  f._trades_contra
+00012b20: 6374 735f 746f 5f61 6d6f 756e 7428 6d61  cts_to_amount(ma
+00012b30: 7463 6865 645f 7472 6164 6573 290a 0a20  tched_trades).. 
+00012b40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00012b50: 6e20 6d61 7463 6865 645f 7472 6164 6573  n matched_trades
+00012b60: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00012b70: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
+00012b80: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00012b90: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
+00012ba0: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
+00012bb0: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+00012bc0: 6570 7420 2863 6378 742e 4e65 7477 6f72  ept (ccxt.Networ
+00012bd0: 6b45 7272 6f72 2c20 6363 7874 2e45 7863  kError, ccxt.Exc
+00012be0: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
+00012bf0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00012c00: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
+00012c10: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00012c20: 2020 2020 6627 436f 756c 6420 6e6f 7420      f'Could not 
+00012c30: 6765 7420 7472 6164 6573 2064 7565 2074  get trades due t
+00012c40: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
+00012c50: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
+00012c60: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
+00012c70: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+00012c80: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
+00012c90: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00012ca0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00012cb0: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
+00012cc0: 6f6d 2065 0a0a 2020 2020 6465 6620 6765  om e..    def ge
+00012cd0: 745f 6f72 6465 725f 6964 5f63 6f6e 6469  t_order_id_condi
+00012ce0: 7469 6f6e 616c 2873 656c 662c 206f 7264  tional(self, ord
+00012cf0: 6572 3a20 4469 6374 5b73 7472 2c20 416e  er: Dict[str, An
+00012d00: 795d 2920 2d3e 2073 7472 3a0a 2020 2020  y]) -> str:.    
+00012d10: 2020 2020 7265 7475 726e 206f 7264 6572      return order
+00012d20: 5b27 6964 275d 0a0a 2020 2020 4072 6574  ['id']..    @ret
+00012d30: 7269 6572 0a20 2020 2064 6566 2067 6574  rier.    def get
+00012d40: 5f66 6565 2873 656c 662c 2073 796d 626f  _fee(self, symbo
+00012d50: 6c3a 2073 7472 2c20 7479 7065 3a20 7374  l: str, type: st
+00012d60: 7220 3d20 2727 2c20 7369 6465 3a20 7374  r = '', side: st
+00012d70: 7220 3d20 2727 2c20 616d 6f75 6e74 3a20  r = '', amount: 
+00012d80: 666c 6f61 7420 3d20 312c 0a20 2020 2020  float = 1,.     
+00012d90: 2020 2020 2020 2020 2020 2070 7269 6365             price
+00012da0: 3a20 666c 6f61 7420 3d20 312c 2074 616b  : float = 1, tak
+00012db0: 6572 5f6f 725f 6d61 6b65 723a 204d 616b  er_or_maker: Mak
+00012dc0: 6572 5461 6b65 7220 3d20 276d 616b 6572  erTaker = 'maker
+00012dd0: 2729 202d 3e20 666c 6f61 743a 0a20 2020  ') -> float:.   
+00012de0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012df0: 2052 6574 7269 6576 6520 6665 6520 6672   Retrieve fee fr
+00012e00: 6f6d 2065 7863 6861 6e67 650a 2020 2020  om exchange.    
+00012e10: 2020 2020 3a70 6172 616d 2073 796d 626f      :param symbo
+00012e20: 6c3a 2050 6169 720a 2020 2020 2020 2020  l: Pair.        
+00012e30: 3a70 6172 616d 2074 7970 653a 2054 7970  :param type: Typ
+00012e40: 6520 6f66 206f 7264 6572 2028 6d61 726b  e of order (mark
+00012e50: 6574 2c20 6c69 6d69 742c 202e 2e2e 290a  et, limit, ...).
+00012e60: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+00012e70: 6964 653a 2053 6964 6520 6f66 206f 7264  ide: Side of ord
+00012e80: 6572 2028 6275 792c 2073 656c 6c29 0a20  er (buy, sell). 
+00012e90: 2020 2020 2020 203a 7061 7261 6d20 616d         :param am
+00012ea0: 6f75 6e74 3a20 416d 6f75 6e74 206f 6620  ount: Amount of 
+00012eb0: 6f72 6465 720a 2020 2020 2020 2020 3a70  order.        :p
+00012ec0: 6172 616d 2070 7269 6365 3a20 5072 6963  aram price: Pric
+00012ed0: 6520 6f66 206f 7264 6572 0a20 2020 2020  e of order.     
+00012ee0: 2020 203a 7061 7261 6d20 7461 6b65 725f     :param taker_
+00012ef0: 6f72 5f6d 616b 6572 3a20 276d 616b 6572  or_maker: 'maker
+00012f00: 2720 6f72 2027 7461 6b65 7227 2028 6967  ' or 'taker' (ig
+00012f10: 6e6f 7265 6420 6966 2022 7479 7065 2220  nored if "type" 
+00012f20: 6973 2070 726f 7669 6465 6429 0a20 2020  is provided).   
+00012f30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012f40: 2069 6620 7479 7065 2061 6e64 2074 7970   if type and typ
+00012f50: 6520 3d3d 2027 6d61 726b 6574 273a 0a20  e == 'market':. 
+00012f60: 2020 2020 2020 2020 2020 2074 616b 6572             taker
+00012f70: 5f6f 725f 6d61 6b65 7220 3d20 2774 616b  _or_maker = 'tak
+00012f80: 6572 270a 2020 2020 2020 2020 7472 793a  er'.        try:
+00012f90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012fa0: 7365 6c66 2e5f 636f 6e66 6967 5b27 6472  self._config['dr
+00012fb0: 795f 7275 6e27 5d20 616e 6420 7365 6c66  y_run'] and self
+00012fc0: 2e5f 636f 6e66 6967 2e67 6574 2827 6665  ._config.get('fe
+00012fd0: 6527 2c20 4e6f 6e65 2920 6973 206e 6f74  e', None) is not
+00012fe0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00012ff0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00013000: 6c66 2e5f 636f 6e66 6967 5b27 6665 6527  lf._config['fee'
+00013010: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
+00013020: 7661 6c69 6461 7465 2074 6861 7420 6d61  validate that ma
+00013030: 726b 6574 7320 6172 6520 6c6f 6164 6564  rkets are loaded
+00013040: 2062 6566 6f72 6520 7472 7969 6e67 2074   before trying t
+00013050: 6f20 6765 7420 6665 650a 2020 2020 2020  o get fee.      
+00013060: 2020 2020 2020 6966 2073 656c 662e 5f61        if self._a
+00013070: 7069 2e6d 6172 6b65 7473 2069 7320 4e6f  pi.markets is No
+00013080: 6e65 206f 7220 6c65 6e28 7365 6c66 2e5f  ne or len(self._
+00013090: 6170 692e 6d61 726b 6574 7329 203d 3d20  api.markets) == 
+000130a0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+000130b0: 2020 2073 656c 662e 5f61 7069 2e6c 6f61     self._api.loa
+000130c0: 645f 6d61 726b 6574 7328 7061 7261 6d73  d_markets(params
+000130d0: 3d7b 7d29 0a0a 2020 2020 2020 2020 2020  ={})..          
+000130e0: 2020 7265 7475 726e 2073 656c 662e 5f61    return self._a
+000130f0: 7069 2e63 616c 6375 6c61 7465 5f66 6565  pi.calculate_fee
+00013100: 2873 796d 626f 6c3d 7379 6d62 6f6c 2c20  (symbol=symbol, 
+00013110: 7479 7065 3d74 7970 652c 2073 6964 653d  type=type, side=
+00013120: 7369 6465 2c20 616d 6f75 6e74 3d61 6d6f  side, amount=amo
+00013130: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
+00013140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013160: 7072 6963 653d 7072 6963 652c 2074 616b  price=price, tak
+00013170: 6572 4f72 4d61 6b65 723d 7461 6b65 725f  erOrMaker=taker_
+00013180: 6f72 5f6d 616b 6572 295b 2772 6174 6527  or_maker)['rate'
+00013190: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
+000131a0: 2063 6378 742e 4444 6f53 5072 6f74 6563   ccxt.DDoSProtec
+000131b0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+000131c0: 2020 2020 2020 2072 6169 7365 2044 446f         raise DDo
+000131d0: 7350 726f 7465 6374 696f 6e28 6529 2066  sProtection(e) f
+000131e0: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
+000131f0: 6365 7074 2028 6363 7874 2e4e 6574 776f  cept (ccxt.Netwo
+00013200: 726b 4572 726f 722c 2063 6378 742e 4578  rkError, ccxt.Ex
+00013210: 6368 616e 6765 4572 726f 7229 2061 7320  changeError) as 
+00013220: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00013230: 6169 7365 2054 656d 706f 7261 7279 4572  aise TemporaryEr
+00013240: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00013250: 2020 2020 2066 2743 6f75 6c64 206e 6f74       f'Could not
+00013260: 2067 6574 2066 6565 2069 6e66 6f20 6475   get fee info du
+00013270: 6520 746f 207b 652e 5f5f 636c 6173 735f  e to {e.__class_
+00013280: 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d 6573  _.__name__}. Mes
+00013290: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
+000132a0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
+000132b0: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
+000132c0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+000132d0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+000132e0: 6f6e 616c 4578 6365 7074 696f 6e28 6529  onalException(e)
+000132f0: 2066 726f 6d20 650a 0a20 2020 2040 7374   from e..    @st
+00013300: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00013310: 6566 206f 7264 6572 5f68 6173 5f66 6565  ef order_has_fee
+00013320: 286f 7264 6572 3a20 4469 6374 2920 2d3e  (order: Dict) ->
+00013330: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
+00013340: 2222 0a20 2020 2020 2020 2056 6572 6966  "".        Verif
+00013350: 6965 7320 6966 2074 6865 2070 6173 7365  ies if the passe
+00013360: 6420 696e 206f 7264 6572 2064 6963 7420  d in order dict 
+00013370: 6861 7320 7468 6520 6e65 6564 6564 206b  has the needed k
+00013380: 6579 7320 746f 2065 7874 7261 6374 2066  eys to extract f
+00013390: 6565 732c 0a20 2020 2020 2020 2061 6e64  ees,.        and
+000133a0: 2074 6861 7420 7468 6573 6520 6b65 7973   that these keys
+000133b0: 2028 6375 7272 656e 6379 2c20 636f 7374   (currency, cost
+000133c0: 2920 6172 6520 6e6f 7420 656d 7074 792e  ) are not empty.
+000133d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000133e0: 6f72 6465 723a 204f 7264 6572 206f 7220  order: Order or 
+000133f0: 7472 6164 6520 286f 6e65 2074 7261 6465  trade (one trade
+00013400: 2920 6469 6374 0a20 2020 2020 2020 203a  ) dict.        :
+00013410: 7265 7475 726e 3a20 5472 7565 2069 6620  return: True if 
+00013420: 7468 6520 6665 6520 7375 6273 7472 7563  the fee substruc
+00013430: 7475 7265 2063 6f6e 7461 696e 7320 6375  ture contains cu
+00013440: 7272 656e 6379 2061 6e64 2063 6f73 742c  rrency and cost,
+00013450: 2066 616c 7365 206f 7468 6572 7769 7365   false otherwise
+00013460: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013470: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00013480: 7374 616e 6365 286f 7264 6572 2c20 6469  stance(order, di
+00013490: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+000134a0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+000134b0: 2020 2020 2020 7265 7475 726e 2028 2766        return ('f
+000134c0: 6565 2720 696e 206f 7264 6572 2061 6e64  ee' in order and
+000134d0: 206f 7264 6572 5b27 6665 6527 5d20 6973   order['fee'] is
+000134e0: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
+000134f0: 2020 2020 2020 2020 2020 616e 6420 286f            and (o
+00013500: 7264 6572 5b27 6665 6527 5d2e 6b65 7973  rder['fee'].keys
+00013510: 2829 203e 3d20 7b27 6375 7272 656e 6379  () >= {'currency
+00013520: 272c 2027 636f 7374 277d 290a 2020 2020  ', 'cost'}).    
+00013530: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00013540: 6f72 6465 725b 2766 6565 275d 5b27 6375  order['fee']['cu
+00013550: 7272 656e 6379 275d 2069 7320 6e6f 7420  rrency'] is not 
+00013560: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00013570: 2020 2020 2061 6e64 206f 7264 6572 5b27       and order['
+00013580: 6665 6527 5d5b 2763 6f73 7427 5d20 6973  fee']['cost'] is
+00013590: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
+000135a0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+000135b0: 2064 6566 2063 616c 6375 6c61 7465 5f66   def calculate_f
+000135c0: 6565 5f72 6174 6528 0a20 2020 2020 2020  ee_rate(.       
+000135d0: 2020 2020 2073 656c 662c 2066 6565 3a20       self, fee: 
+000135e0: 4469 6374 2c20 7379 6d62 6f6c 3a20 7374  Dict, symbol: st
+000135f0: 722c 2063 6f73 743a 2066 6c6f 6174 2c20  r, cost: float, 
+00013600: 616d 6f75 6e74 3a20 666c 6f61 7429 202d  amount: float) -
+00013610: 3e20 4f70 7469 6f6e 616c 5b66 6c6f 6174  > Optional[float
+00013620: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+00013630: 2020 2020 2020 2043 616c 6375 6c61 7465         Calculate
+00013640: 2066 6565 2072 6174 6520 6966 2069 7427   fee rate if it'
+00013650: 7320 6e6f 7420 6769 7665 6e20 6279 2074  s not given by t
+00013660: 6865 2065 7863 6861 6e67 652e 0a20 2020  he exchange..   
+00013670: 2020 2020 203a 7061 7261 6d20 6665 653a       :param fee:
+00013680: 2063 6378 7420 4665 6520 6469 6374 202d   ccxt Fee dict -
+00013690: 206d 7573 7420 636f 6e74 6169 6e20 636f   must contain co
+000136a0: 7374 202f 2063 7572 7265 6e63 7920 2f20  st / currency / 
+000136b0: 7261 7465 0a20 2020 2020 2020 203a 7061  rate.        :pa
+000136c0: 7261 6d20 7379 6d62 6f6c 3a20 5379 6d62  ram symbol: Symb
+000136d0: 6f6c 206f 6620 7468 6520 6f72 6465 720a  ol of the order.
+000136e0: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
+000136f0: 6f73 743a 2054 6f74 616c 2063 6f73 7420  ost: Total cost 
+00013700: 6f66 2074 6865 206f 7264 6572 0a20 2020  of the order.   
+00013710: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
+00013720: 6e74 3a20 416d 6f75 6e74 206f 6620 7468  nt: Amount of th
+00013730: 6520 6f72 6465 720a 2020 2020 2020 2020  e order.        
+00013740: 2222 220a 2020 2020 2020 2020 6966 2066  """.        if f
+00013750: 6565 2e67 6574 2827 7261 7465 2729 2069  ee.get('rate') i
+00013760: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00013770: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00013780: 6565 2e67 6574 2827 7261 7465 2729 0a20  ee.get('rate'). 
+00013790: 2020 2020 2020 2066 6565 5f63 7572 7220         fee_curr 
+000137a0: 3d20 6665 652e 6765 7428 2763 7572 7265  = fee.get('curre
+000137b0: 6e63 7927 290a 2020 2020 2020 2020 6966  ncy').        if
+000137c0: 2066 6565 5f63 7572 7220 6973 204e 6f6e   fee_curr is Non
+000137d0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+000137e0: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+000137f0: 2020 2066 6565 5f63 6f73 7420 3d20 666c     fee_cost = fl
+00013800: 6f61 7428 6665 655b 2763 6f73 7427 5d29  oat(fee['cost'])
+00013810: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00013820: 2e5f 6674 5f68 6173 5b27 6665 655f 636f  ._ft_has['fee_co
+00013830: 7374 5f69 6e5f 636f 6e74 7261 6374 7327  st_in_contracts'
+00013840: 5d3a 0a20 2020 2020 2020 2020 2020 2023  ]:.            #
+00013850: 2043 6f6e 7665 7274 2063 6f73 7420 7669   Convert cost vi
+00013860: 6120 2263 6f6e 7472 6163 7473 2220 636f  a "contracts" co
+00013870: 6e76 6572 7369 6f6e 0a20 2020 2020 2020  nversion.       
+00013880: 2020 2020 2066 6565 5f63 6f73 7420 3d20       fee_cost = 
+00013890: 7365 6c66 2e5f 636f 6e74 7261 6374 735f  self._contracts_
+000138a0: 746f 5f61 6d6f 756e 7428 7379 6d62 6f6c  to_amount(symbol
+000138b0: 2c20 6665 655b 2763 6f73 7427 5d29 0a0a  , fee['cost'])..
+000138c0: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+000138d0: 6174 6520 6665 6520 6261 7365 6420 6f6e  ate fee based on
+000138e0: 206f 7264 6572 2064 6574 6169 6c73 0a20   order details. 
+000138f0: 2020 2020 2020 2069 6620 6665 655f 6375         if fee_cu
+00013900: 7272 203d 3d20 7365 6c66 2e67 6574 5f70  rr == self.get_p
+00013910: 6169 725f 6261 7365 5f63 7572 7265 6e63  air_base_currenc
+00013920: 7928 7379 6d62 6f6c 293a 0a20 2020 2020  y(symbol):.     
+00013930: 2020 2020 2020 2023 2042 6173 6520 6375         # Base cu
+00013940: 7272 656e 6379 202d 2064 6976 6964 6520  rrency - divide 
+00013950: 6279 2061 6d6f 756e 740a 2020 2020 2020  by amount.      
+00013960: 2020 2020 2020 7265 7475 726e 2072 6f75        return rou
+00013970: 6e64 2866 6565 5f63 6f73 7420 2f20 616d  nd(fee_cost / am
+00013980: 6f75 6e74 2c20 3829 0a20 2020 2020 2020  ount, 8).       
+00013990: 2065 6c69 6620 6665 655f 6375 7272 203d   elif fee_curr =
+000139a0: 3d20 7365 6c66 2e67 6574 5f70 6169 725f  = self.get_pair_
+000139b0: 7175 6f74 655f 6375 7272 656e 6379 2873  quote_currency(s
+000139c0: 796d 626f 6c29 3a0a 2020 2020 2020 2020  ymbol):.        
+000139d0: 2020 2020 2320 5175 6f74 6520 6375 7272      # Quote curr
+000139e0: 656e 6379 202d 2064 6976 6964 6520 6279  ency - divide by
+000139f0: 2063 6f73 740a 2020 2020 2020 2020 2020   cost.          
+00013a00: 2020 7265 7475 726e 2072 6f75 6e64 2866    return round(f
+00013a10: 6565 5f63 6f73 7420 2f20 636f 7374 2c20  ee_cost / cost, 
+00013a20: 3829 2069 6620 636f 7374 2065 6c73 6520  8) if cost else 
+00013a30: 4e6f 6e65 0a20 2020 2020 2020 2065 6c73  None.        els
+00013a40: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+00013a50: 2049 6620 4665 6520 6375 7272 656e 6379   If Fee currency
+00013a60: 2069 7320 6120 6469 6666 6572 656e 7420   is a different 
+00013a70: 6375 7272 656e 6379 0a20 2020 2020 2020  currency.       
+00013a80: 2020 2020 2069 6620 6e6f 7420 636f 7374       if not cost
+00013a90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013aa0: 2020 2320 4966 2063 6f73 7420 6973 204e    # If cost is N
+00013ab0: 6f6e 6520 6f72 2030 2e30 202d 3e20 6661  one or 0.0 -> fa
+00013ac0: 6c73 792c 2072 6574 7572 6e20 4e6f 6e65  lsy, return None
+00013ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013ae0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+00013af0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00013b00: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00013b10: 6d62 203d 2073 656c 662e 6765 745f 7661  mb = self.get_va
+00013b20: 6c69 645f 7061 6972 5f63 6f6d 6269 6e61  lid_pair_combina
+00013b30: 7469 6f6e 2866 6565 5f63 7572 722c 2073  tion(fee_curr, s
+00013b40: 656c 662e 5f63 6f6e 6669 675b 2773 7461  elf._config['sta
+00013b50: 6b65 5f63 7572 7265 6e63 7927 5d29 0a20  ke_currency']). 
+00013b60: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00013b70: 6963 6b20 3d20 7365 6c66 2e66 6574 6368  ick = self.fetch
+00013b80: 5f74 6963 6b65 7228 636f 6d62 290a 0a20  _ticker(comb).. 
+00013b90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00013ba0: 6565 5f74 6f5f 7175 6f74 655f 7261 7465  ee_to_quote_rate
+00013bb0: 203d 2073 6166 655f 7661 6c75 655f 6661   = safe_value_fa
+00013bc0: 6c6c 6261 636b 3228 7469 636b 2c20 7469  llback2(tick, ti
+00013bd0: 636b 2c20 276c 6173 7427 2c20 2761 736b  ck, 'last', 'ask
+00013be0: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
+00013bf0: 7863 6570 7420 4578 6368 616e 6765 4572  xcept ExchangeEr
+00013c00: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00013c10: 2020 2020 2066 6565 5f74 6f5f 7175 6f74       fee_to_quot
+00013c20: 655f 7261 7465 203d 2073 656c 662e 5f63  e_rate = self._c
+00013c30: 6f6e 6669 675b 2765 7863 6861 6e67 6527  onfig['exchange'
+00013c40: 5d2e 6765 7428 2775 6e6b 6e6f 776e 5f66  ].get('unknown_f
+00013c50: 6565 5f72 6174 6527 2c20 4e6f 6e65 290a  ee_rate', None).
+00013c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c70: 6966 206e 6f74 2066 6565 5f74 6f5f 7175  if not fee_to_qu
+00013c80: 6f74 655f 7261 7465 3a0a 2020 2020 2020  ote_rate:.      
+00013c90: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00013ca0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+00013cb0: 2020 2020 2020 7265 7475 726e 2072 6f75        return rou
+00013cc0: 6e64 2828 6665 655f 636f 7374 202a 2066  nd((fee_cost * f
+00013cd0: 6565 5f74 6f5f 7175 6f74 655f 7261 7465  ee_to_quote_rate
+00013ce0: 2920 2f20 636f 7374 2c20 3829 0a0a 2020  ) / cost, 8)..  
+00013cf0: 2020 6465 6620 6578 7472 6163 745f 636f    def extract_co
+00013d00: 7374 5f63 7572 725f 7261 7465 2873 656c  st_curr_rate(sel
+00013d10: 662c 2066 6565 3a20 4469 6374 2c20 7379  f, fee: Dict, sy
+00013d20: 6d62 6f6c 3a20 7374 722c 2063 6f73 743a  mbol: str, cost:
+00013d30: 2066 6c6f 6174 2c0a 2020 2020 2020 2020   float,.        
+00013d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d50: 2020 2020 2020 2061 6d6f 756e 743a 2066         amount: f
+00013d60: 6c6f 6174 2920 2d3e 2054 7570 6c65 5b66  loat) -> Tuple[f
+00013d70: 6c6f 6174 2c20 7374 722c 204f 7074 696f  loat, str, Optio
+00013d80: 6e61 6c5b 666c 6f61 745d 5d3a 0a20 2020  nal[float]]:.   
+00013d90: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013da0: 2045 7874 7261 6374 2074 7570 6c65 206f   Extract tuple o
+00013db0: 6620 636f 7374 2c20 6375 7272 656e 6379  f cost, currency
+00013dc0: 2c20 7261 7465 2e0a 2020 2020 2020 2020  , rate..        
+00013dd0: 5265 7175 6972 6573 206f 7264 6572 5f68  Requires order_h
+00013de0: 6173 5f66 6565 2074 6f20 7275 6e20 6669  as_fee to run fi
+00013df0: 7273 7421 0a20 2020 2020 2020 203a 7061  rst!.        :pa
+00013e00: 7261 6d20 6665 653a 2063 6378 7420 4665  ram fee: ccxt Fe
+00013e10: 6520 6469 6374 202d 206d 7573 7420 636f  e dict - must co
+00013e20: 6e74 6169 6e20 636f 7374 202f 2063 7572  ntain cost / cur
+00013e30: 7265 6e63 7920 2f20 7261 7465 0a20 2020  rency / rate.   
+00013e40: 2020 2020 203a 7061 7261 6d20 7379 6d62       :param symb
+00013e50: 6f6c 3a20 5379 6d62 6f6c 206f 6620 7468  ol: Symbol of th
+00013e60: 6520 6f72 6465 720a 2020 2020 2020 2020  e order.        
+00013e70: 3a70 6172 616d 2063 6f73 743a 2054 6f74  :param cost: Tot
+00013e80: 616c 2063 6f73 7420 6f66 2074 6865 206f  al cost of the o
+00013e90: 7264 6572 0a20 2020 2020 2020 203a 7061  rder.        :pa
+00013ea0: 7261 6d20 616d 6f75 6e74 3a20 416d 6f75  ram amount: Amou
+00013eb0: 6e74 206f 6620 7468 6520 6f72 6465 720a  nt of the order.
+00013ec0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00013ed0: 2054 7570 6c65 2077 6974 6820 636f 7374   Tuple with cost
+00013ee0: 2c20 6375 7272 656e 6379 2c20 7261 7465  , currency, rate
+00013ef0: 206f 6620 7468 6520 6769 7665 6e20 6665   of the given fe
+00013f00: 6520 6469 6374 0a20 2020 2020 2020 2022  e dict.        "
+00013f10: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00013f20: 6e20 2866 6c6f 6174 2866 6565 5b27 636f  n (float(fee['co
+00013f30: 7374 275d 292c 0a20 2020 2020 2020 2020  st']),.         
+00013f40: 2020 2020 2020 2066 6565 5b27 6375 7272         fee['curr
+00013f50: 656e 6379 275d 2c0a 2020 2020 2020 2020  ency'],.        
+00013f60: 2020 2020 2020 2020 7365 6c66 2e63 616c          self.cal
+00013f70: 6375 6c61 7465 5f66 6565 5f72 6174 6528  culate_fee_rate(
+00013f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013f90: 2020 2020 2066 6565 2c0a 2020 2020 2020       fee,.      
+00013fa0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00013fb0: 6d62 6f6c 2c0a 2020 2020 2020 2020 2020  mbol,.          
+00013fc0: 2020 2020 2020 2020 2020 636f 7374 2c0a            cost,.
+00013fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fe0: 2020 2020 616d 6f75 6e74 0a20 2020 2020      amount.     
+00013ff0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00014000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014010: 2029 0a0a 2020 2020 2320 4869 7374 6f72   )..    # Histor
+00014020: 6963 2064 6174 610a 0a20 2020 2064 6566  ic data..    def
+00014030: 2067 6574 5f68 6973 746f 7269 635f 6f68   get_historic_oh
+00014040: 6c63 7628 7365 6c66 2c20 7061 6972 3a20  lcv(self, pair: 
+00014050: 7374 722c 2074 696d 6566 7261 6d65 3a20  str, timeframe: 
+00014060: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
+00014070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014080: 7369 6e63 655f 6d73 3a20 696e 742c 2063  since_ms: int, c
+00014090: 616e 646c 655f 7479 7065 3a20 4361 6e64  andle_type: Cand
+000140a0: 6c65 5479 7065 2c0a 2020 2020 2020 2020  leType,.        
+000140b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140c0: 2020 2069 735f 6e65 775f 7061 6972 3a20     is_new_pair: 
+000140d0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+000140e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140f0: 2020 2020 2020 2020 2075 6e74 696c 5f6d           until_m
+00014100: 733a 204f 7074 696f 6e61 6c5b 696e 745d  s: Optional[int]
+00014110: 203d 204e 6f6e 6529 202d 3e20 4c69 7374   = None) -> List
+00014120: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00014130: 2020 2020 2020 4765 7420 6361 6e64 6c65        Get candle
+00014140: 2068 6973 746f 7279 2075 7369 6e67 2061   history using a
+00014150: 7379 6e63 696f 2061 6e64 2072 6574 7572  syncio and retur
+00014160: 6e73 2074 6865 206c 6973 7420 6f66 2063  ns the list of c
+00014170: 616e 646c 6573 2e0a 2020 2020 2020 2020  andles..        
+00014180: 4861 6e64 6c65 7320 616c 6c20 6173 796e  Handles all asyn
+00014190: 6320 776f 726b 2066 6f72 2074 6869 732e  c work for this.
+000141a0: 0a20 2020 2020 2020 2041 7379 6e63 206f  .        Async o
+000141b0: 7665 7220 6f6e 6520 7061 6972 2c20 6173  ver one pair, as
+000141c0: 7375 6d69 6e67 2077 6520 6765 7420 6073  suming we get `s
+000141d0: 656c 662e 6f68 6c63 765f 6361 6e64 6c65  elf.ohlcv_candle
+000141e0: 5f6c 696d 6974 2829 6020 6361 6e64 6c65  _limit()` candle
+000141f0: 7320 7065 7220 6361 6c6c 2e0a 2020 2020  s per call..    
+00014200: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
+00014210: 2050 6169 7220 746f 2064 6f77 6e6c 6f61   Pair to downloa
+00014220: 640a 2020 2020 2020 2020 3a70 6172 616d  d.        :param
+00014230: 2074 696d 6566 7261 6d65 3a20 5469 6d65   timeframe: Time
+00014240: 6672 616d 6520 746f 2067 6574 2064 6174  frame to get dat
+00014250: 6120 666f 720a 2020 2020 2020 2020 3a70  a for.        :p
+00014260: 6172 616d 2073 696e 6365 5f6d 733a 2054  aram since_ms: T
+00014270: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
+00014280: 6973 6563 6f6e 6473 2074 6f20 6765 7420  iseconds to get 
+00014290: 6869 7374 6f72 7920 6672 6f6d 0a20 2020  history from.   
+000142a0: 2020 2020 203a 7061 7261 6d20 756e 7469       :param unti
+000142b0: 6c5f 6d73 3a20 5469 6d65 7374 616d 7020  l_ms: Timestamp 
+000142c0: 696e 206d 696c 6c69 7365 636f 6e64 7320  in milliseconds 
+000142d0: 746f 2067 6574 2068 6973 746f 7279 2075  to get history u
+000142e0: 7020 746f 0a20 2020 2020 2020 203a 7061  p to.        :pa
+000142f0: 7261 6d20 6361 6e64 6c65 5f74 7970 653a  ram candle_type:
+00014300: 2027 272c 206d 6172 6b2c 2069 6e64 6578   '', mark, index
+00014310: 2c20 7072 656d 6975 6d49 6e64 6578 2c20  , premiumIndex, 
+00014320: 6f72 2066 756e 6469 6e67 5f72 6174 650a  or funding_rate.
+00014330: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00014340: 204c 6973 7420 7769 7468 2063 616e 646c   List with candl
+00014350: 6520 284f 484c 4356 2920 6461 7461 0a20  e (OHLCV) data. 
+00014360: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014370: 2020 2070 6169 722c 205f 2c20 5f2c 2064     pair, _, _, d
+00014380: 6174 612c 205f 203d 2073 656c 662e 6c6f  ata, _ = self.lo
+00014390: 6f70 2e72 756e 5f75 6e74 696c 5f63 6f6d  op.run_until_com
+000143a0: 706c 6574 6528 0a20 2020 2020 2020 2020  plete(.         
+000143b0: 2020 2073 656c 662e 5f61 7379 6e63 5f67     self._async_g
+000143c0: 6574 5f68 6973 746f 7269 635f 6f68 6c63  et_historic_ohlc
+000143d0: 7628 7061 6972 3d70 6169 722c 2074 696d  v(pair=pair, tim
+000143e0: 6566 7261 6d65 3d74 696d 6566 7261 6d65  eframe=timeframe
+000143f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014410: 2020 2020 2020 2020 2020 2020 2073 696e               sin
+00014420: 6365 5f6d 733d 7369 6e63 655f 6d73 2c20  ce_ms=since_ms, 
+00014430: 756e 7469 6c5f 6d73 3d75 6e74 696c 5f6d  until_ms=until_m
+00014440: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014460: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00014470: 5f6e 6577 5f70 6169 723d 6973 5f6e 6577  _new_pair=is_new
+00014480: 5f70 6169 722c 2063 616e 646c 655f 7479  _pair, candle_ty
+00014490: 7065 3d63 616e 646c 655f 7479 7065 2929  pe=candle_type))
+000144a0: 0a20 2020 2020 2020 206c 6f67 6765 722e  .        logger.
+000144b0: 696e 666f 2866 2244 6f77 6e6c 6f61 6465  info(f"Downloade
+000144c0: 6420 6461 7461 2066 6f72 207b 7061 6972  d data for {pair
+000144d0: 7d20 7769 7468 206c 656e 6774 6820 7b6c  } with length {l
+000144e0: 656e 2864 6174 6129 7d2e 2229 0a20 2020  en(data)}.").   
+000144f0: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
+00014500: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
+00014510: 5f61 7379 6e63 5f67 6574 5f68 6973 746f  _async_get_histo
+00014520: 7269 635f 6f68 6c63 7628 7365 6c66 2c20  ric_ohlcv(self, 
+00014530: 7061 6972 3a20 7374 722c 2074 696d 6566  pair: str, timef
+00014540: 7261 6d65 3a20 7374 722c 0a20 2020 2020  rame: str,.     
+00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014570: 2020 2073 696e 6365 5f6d 733a 2069 6e74     since_ms: int
+00014580: 2c20 6361 6e64 6c65 5f74 7970 653a 2043  , candle_type: C
+00014590: 616e 646c 6554 7970 652c 0a20 2020 2020  andleType,.     
+000145a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145c0: 2020 2069 735f 6e65 775f 7061 6972 3a20     is_new_pair: 
+000145d0: 626f 6f6c 203d 2046 616c 7365 2c20 7261  bool = False, ra
+000145e0: 6973 655f 3a20 626f 6f6c 203d 2046 616c  ise_: bool = Fal
+000145f0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00014600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014610: 2020 2020 2020 2020 2020 2020 756e 7469              unti
+00014620: 6c5f 6d73 3a20 4f70 7469 6f6e 616c 5b69  l_ms: Optional[i
+00014630: 6e74 5d20 3d20 4e6f 6e65 0a20 2020 2020  nt] = None.     
+00014640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014660: 2020 2029 202d 3e20 4f48 4c43 5652 6573     ) -> OHLCVRes
+00014670: 706f 6e73 653a 0a20 2020 2020 2020 2022  ponse:.        "
+00014680: 2222 0a20 2020 2020 2020 2044 6f77 6e6c  "".        Downl
+00014690: 6f61 6420 6869 7374 6f72 6963 206f 686c  oad historic ohl
+000146a0: 6376 0a20 2020 2020 2020 203a 7061 7261  cv.        :para
+000146b0: 6d20 6973 5f6e 6577 5f70 6169 723a 2075  m is_new_pair: u
+000146c0: 7365 6420 6279 2062 696e 616e 6365 2073  sed by binance s
+000146d0: 7562 636c 6173 7320 746f 2061 6c6c 6f77  ubclass to allow
+000146e0: 2022 6661 7374 2220 6e65 7720 7061 6972   "fast" new pair
+000146f0: 2064 6f77 6e6c 6f61 6469 6e67 0a20 2020   downloading.   
+00014700: 2020 2020 203a 7061 7261 6d20 6361 6e64       :param cand
+00014710: 6c65 5f74 7970 653a 2041 6e79 206f 6620  le_type: Any of 
+00014720: 7468 6520 656e 756d 2043 616e 646c 6554  the enum CandleT
+00014730: 7970 6520 286d 7573 7420 6d61 7463 6820  ype (must match 
+00014740: 7472 6164 696e 6720 6d6f 6465 2129 0a20  trading mode!). 
+00014750: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00014760: 2020 2020 6f6e 655f 6361 6c6c 203d 2074      one_call = t
+00014770: 696d 6566 7261 6d65 5f74 6f5f 6d73 6563  imeframe_to_msec
+00014780: 7328 7469 6d65 6672 616d 6529 202a 2073  s(timeframe) * s
+00014790: 656c 662e 6f68 6c63 765f 6361 6e64 6c65  elf.ohlcv_candle
+000147a0: 5f6c 696d 6974 280a 2020 2020 2020 2020  _limit(.        
+000147b0: 2020 2020 7469 6d65 6672 616d 652c 2063      timeframe, c
+000147c0: 616e 646c 655f 7479 7065 2c20 7369 6e63  andle_type, sinc
+000147d0: 655f 6d73 290a 2020 2020 2020 2020 6c6f  e_ms).        lo
+000147e0: 6767 6572 2e64 6562 7567 280a 2020 2020  gger.debug(.    
+000147f0: 2020 2020 2020 2020 226f 6e65 5f63 616c          "one_cal
+00014800: 6c3a 2025 7320 6d73 6563 7320 2825 7329  l: %s msecs (%s)
+00014810: 222c 0a20 2020 2020 2020 2020 2020 206f  ",.            o
+00014820: 6e65 5f63 616c 6c2c 0a20 2020 2020 2020  ne_call,.       
+00014830: 2020 2020 2061 7272 6f77 2e75 7463 6e6f       arrow.utcno
+00014840: 7728 292e 7368 6966 7428 7365 636f 6e64  w().shift(second
+00014850: 733d 6f6e 655f 6361 6c6c 202f 2f20 3130  s=one_call // 10
+00014860: 3030 292e 6875 6d61 6e69 7a65 286f 6e6c  00).humanize(onl
+00014870: 795f 6469 7374 616e 6365 3d54 7275 6529  y_distance=True)
+00014880: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00014890: 2020 2069 6e70 7574 5f63 6f72 6f75 7469     input_corouti
+000148a0: 6e65 7320 3d20 5b73 656c 662e 5f61 7379  nes = [self._asy
+000148b0: 6e63 5f67 6574 5f63 616e 646c 655f 6869  nc_get_candle_hi
+000148c0: 7374 6f72 7928 0a20 2020 2020 2020 2020  story(.         
+000148d0: 2020 2070 6169 722c 2074 696d 6566 7261     pair, timefra
+000148e0: 6d65 2c20 6361 6e64 6c65 5f74 7970 652c  me, candle_type,
+000148f0: 2073 696e 6365 2920 666f 7220 7369 6e63   since) for sinc
+00014900: 6520 696e 0a20 2020 2020 2020 2020 2020  e in.           
+00014910: 2072 616e 6765 2873 696e 6365 5f6d 732c   range(since_ms,
+00014920: 2075 6e74 696c 5f6d 7320 6f72 2028 6172   until_ms or (ar
+00014930: 726f 772e 7574 636e 6f77 2829 2e69 6e74  row.utcnow().int
+00014940: 5f74 696d 6573 7461 6d70 202a 2031 3030  _timestamp * 100
+00014950: 3029 2c20 6f6e 655f 6361 6c6c 295d 0a0a  0), one_call)]..
+00014960: 2020 2020 2020 2020 6461 7461 3a20 4c69          data: Li
+00014970: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+00014980: 2320 4368 756e 6b20 7265 7175 6573 7473  # Chunk requests
+00014990: 2069 6e74 6f20 6261 7463 6865 7320 6f66   into batches of
+000149a0: 2031 3030 2074 6f20 6176 6f69 6420 6f76   100 to avoid ov
+000149b0: 6572 7765 6c6d 696e 6720 6363 7874 2054  erwelming ccxt T
+000149c0: 6872 6f74 746c 696e 670a 2020 2020 2020  hrottling.      
+000149d0: 2020 666f 7220 696e 7075 745f 636f 726f    for input_coro
+000149e0: 2069 6e20 6368 756e 6b73 2869 6e70 7574   in chunks(input
+000149f0: 5f63 6f72 6f75 7469 6e65 732c 2031 3030  _coroutines, 100
+00014a00: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
+00014a10: 7265 7375 6c74 7320 3d20 6177 6169 7420  results = await 
+00014a20: 6173 796e 6369 6f2e 6761 7468 6572 282a  asyncio.gather(*
+00014a30: 696e 7075 745f 636f 726f 2c20 7265 7475  input_coro, retu
+00014a40: 726e 5f65 7863 6570 7469 6f6e 733d 5472  rn_exceptions=Tr
+00014a50: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00014a60: 666f 7220 7265 7320 696e 2072 6573 756c  for res in resul
+00014a70: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00014a80: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00014a90: 6528 7265 732c 2045 7863 6570 7469 6f6e  e(res, Exception
+00014aa0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00014ab0: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
+00014ac0: 726e 696e 6728 6622 4173 796e 6320 636f  rning(f"Async co
+00014ad0: 6465 2072 6169 7365 6420 616e 2065 7863  de raised an exc
+00014ae0: 6570 7469 6f6e 3a20 7b72 6570 7228 7265  eption: {repr(re
+00014af0: 7329 7d22 290a 2020 2020 2020 2020 2020  s)}").          
+00014b00: 2020 2020 2020 2020 2020 6966 2072 6169            if rai
+00014b10: 7365 5f3a 0a20 2020 2020 2020 2020 2020  se_:.           
+00014b20: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00014b30: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+00014b40: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00014b70: 2020 2020 2020 2020 2020 2320 4465 636f            # Deco
+00014b80: 6e73 7472 7563 7420 7475 706c 6520 6966  nstruct tuple if
+00014b90: 2069 7427 7320 6e6f 7420 616e 2065 7863   it's not an exc
+00014ba0: 6570 7469 6f6e 0a20 2020 2020 2020 2020  eption.         
+00014bb0: 2020 2020 2020 2020 2020 2070 2c20 5f2c             p, _,
+00014bc0: 2063 2c20 6e65 775f 6461 7461 2c20 5f20   c, new_data, _ 
+00014bd0: 3d20 7265 730a 2020 2020 2020 2020 2020  = res.          
+00014be0: 2020 2020 2020 2020 2020 6966 2070 203d            if p =
+00014bf0: 3d20 7061 6972 2061 6e64 2063 203d 3d20  = pair and c == 
+00014c00: 6361 6e64 6c65 5f74 7970 653a 0a20 2020  candle_type:.   
+00014c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c20: 2020 2020 2064 6174 612e 6578 7465 6e64       data.extend
+00014c30: 286e 6577 5f64 6174 6129 0a20 2020 2020  (new_data).     
+00014c40: 2020 2023 2053 6f72 7420 6461 7461 2061     # Sort data a
+00014c50: 6761 696e 2061 6674 6572 2065 7874 656e  gain after exten
+00014c60: 6469 6e67 2074 6865 2072 6573 756c 7420  ding the result 
+00014c70: 2d20 6162 6f76 6520 6361 6c6c 7320 7265  - above calls re
+00014c80: 7475 726e 2069 6e20 2261 7379 6e63 206f  turn in "async o
+00014c90: 7264 6572 220a 2020 2020 2020 2020 6461  rder".        da
+00014ca0: 7461 203d 2073 6f72 7465 6428 6461 7461  ta = sorted(data
+00014cb0: 2c20 6b65 793d 6c61 6d62 6461 2078 3a20  , key=lambda x: 
+00014cc0: 785b 305d 290a 2020 2020 2020 2020 7265  x[0]).        re
+00014cd0: 7475 726e 2070 6169 722c 2074 696d 6566  turn pair, timef
+00014ce0: 7261 6d65 2c20 6361 6e64 6c65 5f74 7970  rame, candle_typ
+00014cf0: 652c 2064 6174 612c 2073 656c 662e 5f6f  e, data, self._o
+00014d00: 686c 6376 5f70 6172 7469 616c 5f63 616e  hlcv_partial_can
+00014d10: 646c 650a 0a20 2020 2064 6566 205f 6275  dle..    def _bu
+00014d20: 696c 645f 636f 726f 7574 696e 6528 0a20  ild_coroutine(. 
+00014d30: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00014d40: 2070 6169 723a 2073 7472 2c20 7469 6d65   pair: str, time
+00014d50: 6672 616d 653a 2073 7472 2c20 6361 6e64  frame: str, cand
+00014d60: 6c65 5f74 7970 653a 2043 616e 646c 6554  le_type: CandleT
+00014d70: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+00014d80: 2073 696e 6365 5f6d 733a 204f 7074 696f   since_ms: Optio
+00014d90: 6e61 6c5b 696e 745d 2c20 6361 6368 653a  nal[int], cache:
+00014da0: 2062 6f6f 6c29 202d 3e20 436f 726f 7574   bool) -> Corout
+00014db0: 696e 655b 416e 792c 2041 6e79 2c20 4f48  ine[Any, Any, OH
+00014dc0: 4c43 5652 6573 706f 6e73 655d 3a0a 2020  LCVResponse]:.  
+00014dd0: 2020 2020 2020 6e6f 745f 616c 6c5f 6461        not_all_da
+00014de0: 7461 203d 2063 6163 6865 2061 6e64 2073  ta = cache and s
+00014df0: 656c 662e 7265 7175 6972 6564 5f63 616e  elf.required_can
+00014e00: 646c 655f 6361 6c6c 5f63 6f75 6e74 203e  dle_call_count >
+00014e10: 2031 0a20 2020 2020 2020 2069 6620 6361   1.        if ca
+00014e20: 6368 6520 616e 6420 2870 6169 722c 2074  che and (pair, t
+00014e30: 696d 6566 7261 6d65 2c20 6361 6e64 6c65  imeframe, candle
+00014e40: 5f74 7970 6529 2069 6e20 7365 6c66 2e5f  _type) in self._
+00014e50: 6b6c 696e 6573 3a0a 2020 2020 2020 2020  klines:.        
+00014e60: 2020 2020 6361 6e64 6c65 5f6c 696d 6974      candle_limit
+00014e70: 203d 2073 656c 662e 6f68 6c63 765f 6361   = self.ohlcv_ca
+00014e80: 6e64 6c65 5f6c 696d 6974 2874 696d 6566  ndle_limit(timef
+00014e90: 7261 6d65 2c20 6361 6e64 6c65 5f74 7970  rame, candle_typ
+00014ea0: 6529 0a20 2020 2020 2020 2020 2020 206d  e).            m
+00014eb0: 696e 5f64 6174 6520 3d20 6461 7465 5f6d  in_date = date_m
+00014ec0: 696e 7573 5f63 616e 646c 6573 2874 696d  inus_candles(tim
+00014ed0: 6566 7261 6d65 2c20 6361 6e64 6c65 5f6c  eframe, candle_l
+00014ee0: 696d 6974 202d 2035 292e 7469 6d65 7374  imit - 5).timest
+00014ef0: 616d 7028 290a 2020 2020 2020 2020 2020  amp().          
+00014f00: 2020 2320 4368 6563 6b20 6966 2031 2063    # Check if 1 c
+00014f10: 616c 6c20 6361 6e20 6765 7420 7573 2075  all can get us u
+00014f20: 7064 6174 6564 2063 616e 646c 6573 2077  pdated candles w
+00014f30: 6974 686f 7574 2068 6f6c 6520 696e 2074  ithout hole in t
+00014f40: 6865 2064 6174 612e 0a20 2020 2020 2020  he data..       
+00014f50: 2020 2020 2069 6620 6d69 6e5f 6461 7465       if min_date
+00014f60: 203c 2073 656c 662e 5f70 6169 7273 5f6c   < self._pairs_l
+00014f70: 6173 745f 7265 6672 6573 685f 7469 6d65  ast_refresh_time
+00014f80: 2e67 6574 2828 7061 6972 2c20 7469 6d65  .get((pair, time
+00014f90: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
+00014fa0: 7065 292c 2030 293a 0a20 2020 2020 2020  pe), 0):.       
+00014fb0: 2020 2020 2020 2020 2023 2043 6163 6865           # Cache
+00014fc0: 2063 616e 2062 6520 7573 6564 202d 2064   can be used - d
+00014fd0: 6f20 6f6e 652d 6f66 6620 6361 6c6c 2e0a  o one-off call..
+00014fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ff0: 6e6f 745f 616c 6c5f 6461 7461 203d 2046  not_all_data = F
+00015000: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00015010: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00015020: 2020 2020 2020 2023 2054 696d 6520 6a75         # Time ju
+00015030: 6d70 2064 6574 6563 7465 642c 2065 7669  mp detected, evi
+00015040: 6374 2063 6163 6865 0a20 2020 2020 2020  ct cache.       
+00015050: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00015060: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
+00015070: 2020 2020 2020 2020 2020 6622 5469 6d65            f"Time
+00015080: 206a 756d 7020 6465 7465 6374 6564 2e20   jump detected. 
+00015090: 4576 6963 7469 6e67 2063 6163 6865 2066  Evicting cache f
+000150a0: 6f72 207b 7061 6972 7d2c 207b 7469 6d65  or {pair}, {time
+000150b0: 6672 616d 657d 2c20 7b63 616e 646c 655f  frame}, {candle_
+000150c0: 7479 7065 7d22 290a 2020 2020 2020 2020  type}").        
+000150d0: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+000150e0: 2e5f 6b6c 696e 6573 5b28 7061 6972 2c20  ._klines[(pair, 
+000150f0: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
+00015100: 655f 7479 7065 295d 0a0a 2020 2020 2020  e_type)]..      
+00015110: 2020 6966 2028 6e6f 7420 7369 6e63 655f    if (not since_
+00015120: 6d73 2061 6e64 2028 7365 6c66 2e5f 6674  ms and (self._ft
+00015130: 5f68 6173 5b22 6f68 6c63 765f 7265 7175  _has["ohlcv_requ
+00015140: 6972 655f 7369 6e63 6522 5d20 6f72 206e  ire_since"] or n
+00015150: 6f74 5f61 6c6c 5f64 6174 6129 293a 0a20  ot_all_data)):. 
+00015160: 2020 2020 2020 2020 2020 2023 204d 756c             # Mul
+00015170: 7469 706c 6520 6361 6c6c 7320 666f 7220  tiple calls for 
+00015180: 6f6e 6520 7061 6972 202d 2074 6f20 6765  one pair - to ge
+00015190: 7420 6d6f 7265 2068 6973 746f 7279 0a20  t more history. 
+000151a0: 2020 2020 2020 2020 2020 206f 6e65 5f63             one_c
+000151b0: 616c 6c20 3d20 7469 6d65 6672 616d 655f  all = timeframe_
+000151c0: 746f 5f6d 7365 6373 2874 696d 6566 7261  to_msecs(timefra
+000151d0: 6d65 2920 2a20 7365 6c66 2e6f 686c 6376  me) * self.ohlcv
+000151e0: 5f63 616e 646c 655f 6c69 6d69 7428 0a20  _candle_limit(. 
+000151f0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00015200: 696d 6566 7261 6d65 2c20 6361 6e64 6c65  imeframe, candle
+00015210: 5f74 7970 652c 2073 696e 6365 5f6d 7329  _type, since_ms)
+00015220: 0a20 2020 2020 2020 2020 2020 206d 6f76  .            mov
+00015230: 655f 746f 203d 206f 6e65 5f63 616c 6c20  e_to = one_call 
+00015240: 2a20 7365 6c66 2e72 6571 7569 7265 645f  * self.required_
+00015250: 6361 6e64 6c65 5f63 616c 6c5f 636f 756e  candle_call_coun
+00015260: 740a 2020 2020 2020 2020 2020 2020 6e6f  t.            no
+00015270: 7720 3d20 7469 6d65 6672 616d 655f 746f  w = timeframe_to
+00015280: 5f6e 6578 745f 6461 7465 2874 696d 6566  _next_date(timef
+00015290: 7261 6d65 290a 2020 2020 2020 2020 2020  rame).          
+000152a0: 2020 7369 6e63 655f 6d73 203d 2069 6e74    since_ms = int
+000152b0: 2828 6e6f 7720 2d20 7469 6d65 6465 6c74  ((now - timedelt
+000152c0: 6128 7365 636f 6e64 733d 6d6f 7665 5f74  a(seconds=move_t
+000152d0: 6f20 2f2f 2031 3030 3029 292e 7469 6d65  o // 1000)).time
+000152e0: 7374 616d 7028 2920 2a20 3130 3030 290a  stamp() * 1000).
+000152f0: 0a20 2020 2020 2020 2069 6620 7369 6e63  .        if sinc
+00015300: 655f 6d73 3a0a 2020 2020 2020 2020 2020  e_ms:.          
+00015310: 2020 7265 7475 726e 2073 656c 662e 5f61    return self._a
+00015320: 7379 6e63 5f67 6574 5f68 6973 746f 7269  sync_get_histori
+00015330: 635f 6f68 6c63 7628 0a20 2020 2020 2020  c_ohlcv(.       
+00015340: 2020 2020 2020 2020 2070 6169 722c 2074           pair, t
+00015350: 696d 6566 7261 6d65 2c20 7369 6e63 655f  imeframe, since_
+00015360: 6d73 3d73 696e 6365 5f6d 732c 2072 6169  ms=since_ms, rai
+00015370: 7365 5f3d 5472 7565 2c20 6361 6e64 6c65  se_=True, candle
+00015380: 5f74 7970 653d 6361 6e64 6c65 5f74 7970  _type=candle_typ
+00015390: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
+000153a0: 0a20 2020 2020 2020 2020 2020 2023 204f  .            # O
+000153b0: 6e65 2063 616c 6c20 2e2e 2e20 2272 6567  ne call ... "reg
+000153c0: 756c 6172 2220 7265 6672 6573 680a 2020  ular" refresh.  
+000153d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000153e0: 2073 656c 662e 5f61 7379 6e63 5f67 6574   self._async_get
+000153f0: 5f63 616e 646c 655f 6869 7374 6f72 7928  _candle_history(
+00015400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015410: 2070 6169 722c 2074 696d 6566 7261 6d65   pair, timeframe
+00015420: 2c20 7369 6e63 655f 6d73 3d73 696e 6365  , since_ms=since
+00015430: 5f6d 732c 2063 616e 646c 655f 7479 7065  _ms, candle_type
+00015440: 3d63 616e 646c 655f 7479 7065 290a 0a20  =candle_type).. 
+00015450: 2020 2064 6566 205f 6275 696c 645f 6f68     def _build_oh
+00015460: 6c63 765f 646c 5f6a 6f62 7328 0a20 2020  lcv_dl_jobs(.   
+00015470: 2020 2020 2020 2020 2073 656c 662c 2070           self, p
+00015480: 6169 725f 6c69 7374 3a20 4c69 7374 5061  air_list: ListPa
+00015490: 6972 7357 6974 6854 696d 6566 7261 6d65  irsWithTimeframe
+000154a0: 732c 2073 696e 6365 5f6d 733a 204f 7074  s, since_ms: Opt
+000154b0: 696f 6e61 6c5b 696e 745d 2c0a 2020 2020  ional[int],.    
+000154c0: 2020 2020 2020 2020 6361 6368 653a 2062          cache: b
+000154d0: 6f6f 6c29 202d 3e20 5475 706c 655b 4c69  ool) -> Tuple[Li
+000154e0: 7374 5b43 6f72 6f75 7469 6e65 5d2c 204c  st[Coroutine], L
+000154f0: 6973 745b 5475 706c 655b 7374 722c 2073  ist[Tuple[str, s
+00015500: 7472 2c20 4361 6e64 6c65 5479 7065 5d5d  tr, CandleType]]
+00015510: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+00015520: 2020 2020 2020 2042 7569 6c64 2043 6f72         Build Cor
+00015530: 6f75 7469 6e65 7320 746f 2065 7865 6375  outines to execu
+00015540: 7465 2061 7320 7061 7274 206f 6620 7265  te as part of re
+00015550: 6672 6573 685f 6c61 7465 7374 5f6f 686c  fresh_latest_ohl
+00015560: 6376 0a20 2020 2020 2020 2022 2222 0a20  cv.        """. 
+00015570: 2020 2020 2020 2069 6e70 7574 5f63 6f72         input_cor
+00015580: 6f75 7469 6e65 733a 204c 6973 745b 436f  outines: List[Co
+00015590: 726f 7574 696e 655b 416e 792c 2041 6e79  routine[Any, Any
+000155a0: 2c20 4f48 4c43 5652 6573 706f 6e73 655d  , OHLCVResponse]
+000155b0: 5d20 3d20 5b5d 0a20 2020 2020 2020 2063  ] = [].        c
+000155c0: 6163 6865 645f 7061 6972 7320 3d20 5b5d  ached_pairs = []
+000155d0: 0a20 2020 2020 2020 2066 6f72 2070 6169  .        for pai
+000155e0: 722c 2074 696d 6566 7261 6d65 2c20 6361  r, timeframe, ca
+000155f0: 6e64 6c65 5f74 7970 6520 696e 2073 6574  ndle_type in set
+00015600: 2870 6169 725f 6c69 7374 293a 0a20 2020  (pair_list):.   
+00015610: 2020 2020 2020 2020 2069 6620 2874 696d           if (tim
+00015620: 6566 7261 6d65 206e 6f74 2069 6e20 7365  eframe not in se
+00015630: 6c66 2e74 696d 6566 7261 6d65 730a 2020  lf.timeframes.  
+00015640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015650: 2020 616e 6420 6361 6e64 6c65 5f74 7970    and candle_typ
+00015660: 6520 696e 2028 4361 6e64 6c65 5479 7065  e in (CandleType
+00015670: 2e53 504f 542c 2043 616e 646c 6554 7970  .SPOT, CandleTyp
+00015680: 652e 4655 5455 5245 5329 293a 0a20 2020  e.FUTURES)):.   
+00015690: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+000156a0: 6765 722e 7761 726e 696e 6728 0a20 2020  ger.warning(.   
+000156b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000156c0: 2066 2243 616e 6e6f 7420 646f 776e 6c6f   f"Cannot downlo
+000156d0: 6164 2028 7b70 6169 727d 2c20 7b74 696d  ad ({pair}, {tim
+000156e0: 6566 7261 6d65 7d29 2063 6f6d 6269 6e61  eframe}) combina
+000156f0: 7469 6f6e 2061 7320 7468 6973 2074 696d  tion as this tim
+00015700: 6566 7261 6d65 2069 7320 220a 2020 2020  eframe is ".    
+00015710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015720: 6622 6e6f 7420 6176 6169 6c61 626c 6520  f"not available 
+00015730: 6f6e 207b 7365 6c66 2e6e 616d 657d 2e20  on {self.name}. 
+00015740: 4176 6169 6c61 626c 6520 7469 6d65 6672  Available timefr
+00015750: 616d 6573 2061 7265 2022 0a20 2020 2020  ames are ".     
+00015760: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015770: 227b 272c 2027 2e6a 6f69 6e28 7365 6c66  "{', '.join(self
+00015780: 2e74 696d 6566 7261 6d65 7329 7d2e 2229  .timeframes)}.")
+00015790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000157a0: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+000157b0: 2020 2020 2020 2069 6620 2828 7061 6972         if ((pair
+000157c0: 2c20 7469 6d65 6672 616d 652c 2063 616e  , timeframe, can
+000157d0: 646c 655f 7479 7065 2920 6e6f 7420 696e  dle_type) not in
+000157e0: 2073 656c 662e 5f6b 6c69 6e65 7320 6f72   self._klines or
+000157f0: 206e 6f74 2063 6163 6865 0a20 2020 2020   not cache.     
+00015800: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00015810: 7220 7365 6c66 2e5f 6e6f 775f 6973 5f74  r self._now_is_t
+00015820: 696d 655f 746f 5f72 6566 7265 7368 2870  ime_to_refresh(p
+00015830: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
+00015840: 6361 6e64 6c65 5f74 7970 6529 293a 0a0a  candle_type)):..
+00015850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015860: 696e 7075 745f 636f 726f 7574 696e 6573  input_coroutines
+00015870: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
+00015880: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00015890: 662e 5f62 7569 6c64 5f63 6f72 6f75 7469  f._build_corouti
+000158a0: 6e65 2870 6169 722c 2074 696d 6566 7261  ne(pair, timefra
+000158b0: 6d65 2c20 6361 6e64 6c65 5f74 7970 652c  me, candle_type,
+000158c0: 2073 696e 6365 5f6d 732c 2063 6163 6865   since_ms, cache
+000158d0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+000158e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000158f0: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
+00015900: 7567 280a 2020 2020 2020 2020 2020 2020  ug(.            
+00015910: 2020 2020 2020 2020 6622 5573 696e 6720          f"Using 
+00015920: 6361 6368 6564 2063 616e 646c 6520 284f  cached candle (O
+00015930: 484c 4356 2920 6461 7461 2066 6f72 207b  HLCV) data for {
+00015940: 7061 6972 7d2c 207b 7469 6d65 6672 616d  pair}, {timefram
+00015950: 657d 2c20 7b63 616e 646c 655f 7479 7065  e}, {candle_type
+00015960: 7d20 2e2e 2e22 0a20 2020 2020 2020 2020  } ...".         
+00015970: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00015980: 2020 2020 2020 2020 2063 6163 6865 645f           cached_
+00015990: 7061 6972 732e 6170 7065 6e64 2828 7061  pairs.append((pa
+000159a0: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
+000159b0: 616e 646c 655f 7479 7065 2929 0a0a 2020  andle_type))..  
+000159c0: 2020 2020 2020 7265 7475 726e 2069 6e70        return inp
+000159d0: 7574 5f63 6f72 6f75 7469 6e65 732c 2063  ut_coroutines, c
+000159e0: 6163 6865 645f 7061 6972 730a 0a20 2020  ached_pairs..   
+000159f0: 2064 6566 205f 7072 6f63 6573 735f 6f68   def _process_oh
+00015a00: 6c63 765f 6466 2873 656c 662c 2070 6169  lcv_df(self, pai
+00015a10: 723a 2073 7472 2c20 7469 6d65 6672 616d  r: str, timefram
+00015a20: 653a 2073 7472 2c20 635f 7479 7065 3a20  e: str, c_type: 
+00015a30: 4361 6e64 6c65 5479 7065 2c20 7469 636b  CandleType, tick
+00015a40: 733a 204c 6973 745b 4c69 7374 5d2c 0a20  s: List[List],. 
+00015a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a60: 2020 2020 2020 2020 2063 6163 6865 3a20           cache: 
+00015a70: 626f 6f6c 2c20 6472 6f70 5f69 6e63 6f6d  bool, drop_incom
+00015a80: 706c 6574 653a 2062 6f6f 6c29 202d 3e20  plete: bool) -> 
+00015a90: 4461 7461 4672 616d 653a 0a20 2020 2020  DataFrame:.     
+00015aa0: 2020 2023 206b 6565 7069 6e67 206c 6173     # keeping las
+00015ab0: 7420 6361 6e64 6c65 2074 696d 6520 6173  t candle time as
+00015ac0: 206c 6173 7420 7265 6672 6573 6865 6420   last refreshed 
+00015ad0: 7469 6d65 206f 6620 7468 6520 7061 6972  time of the pair
+00015ae0: 0a20 2020 2020 2020 2069 6620 7469 636b  .        if tick
+00015af0: 7320 616e 6420 6361 6368 653a 0a20 2020  s and cache:.   
+00015b00: 2020 2020 2020 2020 2069 6478 203d 202d           idx = -
+00015b10: 3220 6966 2064 726f 705f 696e 636f 6d70  2 if drop_incomp
+00015b20: 6c65 7465 2061 6e64 206c 656e 2874 6963  lete and len(tic
+00015b30: 6b73 2920 3e20 3120 656c 7365 202d 310a  ks) > 1 else -1.
+00015b40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00015b50: 2e5f 7061 6972 735f 6c61 7374 5f72 6566  ._pairs_last_ref
+00015b60: 7265 7368 5f74 696d 655b 2870 6169 722c  resh_time[(pair,
+00015b70: 2074 696d 6566 7261 6d65 2c20 635f 7479   timeframe, c_ty
+00015b80: 7065 295d 203d 2074 6963 6b73 5b69 6478  pe)] = ticks[idx
+00015b90: 5d5b 305d 202f 2f20 3130 3030 0a20 2020  ][0] // 1000.   
+00015ba0: 2020 2020 2023 206b 6565 7069 6e67 2070       # keeping p
+00015bb0: 6172 7365 6420 6461 7461 6672 616d 6520  arsed dataframe 
+00015bc0: 696e 2063 6163 6865 0a20 2020 2020 2020  in cache.       
+00015bd0: 206f 686c 6376 5f64 6620 3d20 6f68 6c63   ohlcv_df = ohlc
+00015be0: 765f 746f 5f64 6174 6166 7261 6d65 2874  v_to_dataframe(t
+00015bf0: 6963 6b73 2c20 7469 6d65 6672 616d 652c  icks, timeframe,
+00015c00: 2070 6169 723d 7061 6972 2c20 6669 6c6c   pair=pair, fill
+00015c10: 5f6d 6973 7369 6e67 3d54 7275 652c 0a20  _missing=True,. 
+00015c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c40: 2020 2020 2064 726f 705f 696e 636f 6d70       drop_incomp
+00015c50: 6c65 7465 3d64 726f 705f 696e 636f 6d70  lete=drop_incomp
+00015c60: 6c65 7465 290a 2020 2020 2020 2020 6966  lete).        if
+00015c70: 2063 6163 6865 3a0a 2020 2020 2020 2020   cache:.        
+00015c80: 2020 2020 6966 2028 7061 6972 2c20 7469      if (pair, ti
+00015c90: 6d65 6672 616d 652c 2063 5f74 7970 6529  meframe, c_type)
+00015ca0: 2069 6e20 7365 6c66 2e5f 6b6c 696e 6573   in self._klines
+00015cb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015cc0: 2020 6f6c 6420 3d20 7365 6c66 2e5f 6b6c    old = self._kl
+00015cd0: 696e 6573 5b28 7061 6972 2c20 7469 6d65  ines[(pair, time
+00015ce0: 6672 616d 652c 2063 5f74 7970 6529 5d0a  frame, c_type)].
+00015cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d00: 2320 5265 6173 7369 676e 2073 6f20 7765  # Reassign so we
+00015d10: 2072 6574 7572 6e20 7468 6520 7570 6461   return the upda
+00015d20: 7465 642c 2063 6f6d 6269 6e65 6420 6466  ted, combined df
+00015d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015d40: 206f 686c 6376 5f64 6620 3d20 636c 6561   ohlcv_df = clea
+00015d50: 6e5f 6f68 6c63 765f 6461 7461 6672 616d  n_ohlcv_datafram
+00015d60: 6528 636f 6e63 6174 285b 6f6c 642c 206f  e(concat([old, o
+00015d70: 686c 6376 5f64 665d 2c20 6178 6973 3d30  hlcv_df], axis=0
+00015d80: 292c 2074 696d 6566 7261 6d65 2c20 7061  ), timeframe, pa
+00015d90: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+00015da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015dc0: 2020 2020 2066 696c 6c5f 6d69 7373 696e       fill_missin
+00015dd0: 673d 5472 7565 2c20 6472 6f70 5f69 6e63  g=True, drop_inc
+00015de0: 6f6d 706c 6574 653d 4661 6c73 6529 0a20  omplete=False). 
+00015df0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00015e00: 616e 646c 655f 6c69 6d69 7420 3d20 7365  andle_limit = se
+00015e10: 6c66 2e6f 686c 6376 5f63 616e 646c 655f  lf.ohlcv_candle_
+00015e20: 6c69 6d69 7428 7469 6d65 6672 616d 652c  limit(timeframe,
+00015e30: 2073 656c 662e 5f63 6f6e 6669 675b 2763   self._config['c
+00015e40: 616e 646c 655f 7479 7065 5f64 6566 275d  andle_type_def']
+00015e50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015e60: 2020 2320 4167 6520 6f75 7420 6f6c 6420    # Age out old 
+00015e70: 6361 6e64 6c65 730a 2020 2020 2020 2020  candles.        
+00015e80: 2020 2020 2020 2020 6f68 6c63 765f 6466          ohlcv_df
+00015e90: 203d 206f 686c 6376 5f64 662e 7461 696c   = ohlcv_df.tail
+00015ea0: 2863 616e 646c 655f 6c69 6d69 7420 2b20  (candle_limit + 
+00015eb0: 7365 6c66 2e5f 7374 6172 7475 705f 6361  self._startup_ca
+00015ec0: 6e64 6c65 5f63 6f75 6e74 290a 2020 2020  ndle_count).    
+00015ed0: 2020 2020 2020 2020 2020 2020 6f68 6c63              ohlc
+00015ee0: 765f 6466 203d 206f 686c 6376 5f64 662e  v_df = ohlcv_df.
+00015ef0: 7265 7365 745f 696e 6465 7828 6472 6f70  reset_index(drop
+00015f00: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00015f10: 2020 2020 2020 2073 656c 662e 5f6b 6c69         self._kli
+00015f20: 6e65 735b 2870 6169 722c 2074 696d 6566  nes[(pair, timef
+00015f30: 7261 6d65 2c20 635f 7479 7065 295d 203d  rame, c_type)] =
+00015f40: 206f 686c 6376 5f64 660a 2020 2020 2020   ohlcv_df.      
+00015f50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00015f60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00015f70: 2e5f 6b6c 696e 6573 5b28 7061 6972 2c20  ._klines[(pair, 
+00015f80: 7469 6d65 6672 616d 652c 2063 5f74 7970  timeframe, c_typ
+00015f90: 6529 5d20 3d20 6f68 6c63 765f 6466 0a20  e)] = ohlcv_df. 
+00015fa0: 2020 2020 2020 2072 6574 7572 6e20 6f68         return oh
+00015fb0: 6c63 765f 6466 0a0a 2020 2020 6465 6620  lcv_df..    def 
+00015fc0: 7265 6672 6573 685f 6c61 7465 7374 5f6f  refresh_latest_o
+00015fd0: 686c 6376 2873 656c 662c 2070 6169 725f  hlcv(self, pair_
+00015fe0: 6c69 7374 3a20 4c69 7374 5061 6972 7357  list: ListPairsW
+00015ff0: 6974 6854 696d 6566 7261 6d65 732c 202a  ithTimeframes, *
+00016000: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016010: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00016020: 696e 6365 5f6d 733a 204f 7074 696f 6e61  ince_ms: Optiona
+00016030: 6c5b 696e 745d 203d 204e 6f6e 652c 2063  l[int] = None, c
+00016040: 6163 6865 3a20 626f 6f6c 203d 2054 7275  ache: bool = Tru
+00016050: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00016060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016070: 6472 6f70 5f69 6e63 6f6d 706c 6574 653a  drop_incomplete:
+00016080: 204f 7074 696f 6e61 6c5b 626f 6f6c 5d20   Optional[bool] 
+00016090: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+000160a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000160b0: 2020 2020 2920 2d3e 2044 6963 745b 5061      ) -> Dict[Pa
+000160c0: 6972 5769 7468 5469 6d65 6672 616d 652c  irWithTimeframe,
+000160d0: 2044 6174 6146 7261 6d65 5d3a 0a20 2020   DataFrame]:.   
+000160e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000160f0: 2052 6566 7265 7368 2069 6e2d 6d65 6d6f   Refresh in-memo
+00016100: 7279 204f 484c 4356 2061 7379 6e63 6872  ry OHLCV asynchr
+00016110: 6f6e 6f75 736c 7920 616e 6420 7365 7420  onously and set 
+00016120: 605f 6b6c 696e 6573 6020 7769 7468 2074  `_klines` with t
+00016130: 6865 2072 6573 756c 740a 2020 2020 2020  he result.      
+00016140: 2020 4c6f 6f70 7320 6173 796e 6368 726f    Loops asynchro
+00016150: 6e6f 7573 6c79 206f 7665 7220 7061 6972  nously over pair
+00016160: 5f6c 6973 7420 616e 6420 646f 776e 6c6f  _list and downlo
+00016170: 6164 7320 616c 6c20 7061 6972 7320 6173  ads all pairs as
+00016180: 796e 6320 2873 656d 692d 7061 7261 6c6c  ync (semi-parall
+00016190: 656c 292e 0a20 2020 2020 2020 204f 6e6c  el)..        Onl
+000161a0: 7920 7573 6564 2069 6e20 7468 6520 6461  y used in the da
+000161b0: 7461 7072 6f76 6964 6572 2e72 6566 7265  taprovider.refre
+000161c0: 7368 2829 206d 6574 686f 642e 0a20 2020  sh() method..   
+000161d0: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
+000161e0: 5f6c 6973 743a 204c 6973 7420 6f66 2032  _list: List of 2
+000161f0: 2065 6c65 6d65 6e74 2074 7570 6c65 7320   element tuples 
+00016200: 636f 6e74 6169 6e69 6e67 2070 6169 722c  containing pair,
+00016210: 2069 6e74 6572 7661 6c20 746f 2072 6566   interval to ref
+00016220: 7265 7368 0a20 2020 2020 2020 203a 7061  resh.        :pa
+00016230: 7261 6d20 7369 6e63 655f 6d73 3a20 7469  ram since_ms: ti
+00016240: 6d65 2073 696e 6365 2077 6865 6e20 746f  me since when to
+00016250: 2064 6f77 6e6c 6f61 642c 2069 6e20 6d69   download, in mi
+00016260: 6c6c 6973 6563 6f6e 6473 0a20 2020 2020  lliseconds.     
+00016270: 2020 203a 7061 7261 6d20 6361 6368 653a     :param cache:
+00016280: 2041 7373 6967 6e20 7265 7375 6c74 2074   Assign result t
+00016290: 6f20 5f6b 6c69 6e65 732e 2055 7365 6675  o _klines. Usefu
+000162a0: 6c6c 2066 6f72 206f 6e65 2d6f 6666 2064  ll for one-off d
+000162b0: 6f77 6e6c 6f61 6473 206c 696b 6520 666f  ownloads like fo
+000162c0: 7220 7061 6972 6c69 7374 730a 2020 2020  r pairlists.    
+000162d0: 2020 2020 3a70 6172 616d 2064 726f 705f      :param drop_
+000162e0: 696e 636f 6d70 6c65 7465 3a20 436f 6e74  incomplete: Cont
+000162f0: 726f 6c20 6361 6e64 6c65 2064 726f 7070  rol candle dropp
+00016300: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
+00016310: 2053 7065 6369 6679 696e 6720 4e6f 6e65   Specifying None
+00016320: 2064 6566 6175 6c74 7320 746f 205f 6f68   defaults to _oh
+00016330: 6c63 765f 7061 7274 6961 6c5f 6361 6e64  lcv_partial_cand
+00016340: 6c65 0a20 2020 2020 2020 203a 7265 7475  le.        :retu
+00016350: 726e 3a20 4469 6374 206f 6620 5b7b 2870  rn: Dict of [{(p
+00016360: 6169 722c 2074 696d 6566 7261 6d65 293a  air, timeframe):
+00016370: 2044 6174 6166 7261 6d65 7d5d 0a20 2020   Dataframe}].   
+00016380: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00016390: 206c 6f67 6765 722e 6465 6275 6728 2252   logger.debug("R
+000163a0: 6566 7265 7368 696e 6720 6361 6e64 6c65  efreshing candle
+000163b0: 2028 4f48 4c43 5629 2064 6174 6120 666f   (OHLCV) data fo
+000163c0: 7220 2564 2070 6169 7273 222c 206c 656e  r %d pairs", len
+000163d0: 2870 6169 725f 6c69 7374 2929 0a0a 2020  (pair_list))..  
+000163e0: 2020 2020 2020 2320 4761 7468 6572 2063        # Gather c
+000163f0: 6f72 6f75 7469 6e65 7320 746f 2072 756e  oroutines to run
+00016400: 0a20 2020 2020 2020 2069 6e70 7574 5f63  .        input_c
+00016410: 6f72 6f75 7469 6e65 732c 2063 6163 6865  oroutines, cache
+00016420: 645f 7061 6972 7320 3d20 7365 6c66 2e5f  d_pairs = self._
+00016430: 6275 696c 645f 6f68 6c63 765f 646c 5f6a  build_ohlcv_dl_j
+00016440: 6f62 7328 7061 6972 5f6c 6973 742c 2073  obs(pair_list, s
+00016450: 696e 6365 5f6d 732c 2063 6163 6865 290a  ince_ms, cache).
+00016460: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
+00016470: 5f64 6620 3d20 7b7d 0a20 2020 2020 2020  _df = {}.       
+00016480: 2023 2043 6875 6e6b 2072 6571 7565 7374   # Chunk request
+00016490: 7320 696e 746f 2062 6174 6368 6573 206f  s into batches o
+000164a0: 6620 3130 3020 746f 2061 766f 6964 206f  f 100 to avoid o
+000164b0: 7665 7277 656c 6d69 6e67 2063 6378 7420  verwelming ccxt 
+000164c0: 5468 726f 7474 6c69 6e67 0a20 2020 2020  Throttling.     
+000164d0: 2020 2066 6f72 2069 6e70 7574 5f63 6f72     for input_cor
+000164e0: 6f20 696e 2063 6875 6e6b 7328 696e 7075  o in chunks(inpu
+000164f0: 745f 636f 726f 7574 696e 6573 2c20 3130  t_coroutines, 10
+00016500: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
+00016510: 6173 796e 6320 6465 6620 6761 7468 6572  async def gather
+00016520: 5f73 7475 6666 2829 3a0a 2020 2020 2020  _stuff():.      
+00016530: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00016540: 2061 7761 6974 2061 7379 6e63 696f 2e67   await asyncio.g
+00016550: 6174 6865 7228 2a69 6e70 7574 5f63 6f72  ather(*input_cor
+00016560: 6f2c 2072 6574 7572 6e5f 6578 6365 7074  o, return_except
+00016570: 696f 6e73 3d54 7275 6529 0a0a 2020 2020  ions=True)..    
+00016580: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+00016590: 662e 5f6c 6f6f 705f 6c6f 636b 3a0a 2020  f._loop_lock:.  
+000165a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000165b0: 7375 6c74 7320 3d20 7365 6c66 2e6c 6f6f  sults = self.loo
+000165c0: 702e 7275 6e5f 756e 7469 6c5f 636f 6d70  p.run_until_comp
+000165d0: 6c65 7465 2867 6174 6865 725f 7374 7566  lete(gather_stuf
+000165e0: 6628 2929 0a0a 2020 2020 2020 2020 2020  f())..          
+000165f0: 2020 666f 7220 7265 7320 696e 2072 6573    for res in res
+00016600: 756c 7473 3a0a 2020 2020 2020 2020 2020  ults:.          
+00016610: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00016620: 6e63 6528 7265 732c 2045 7863 6570 7469  nce(res, Excepti
+00016630: 6f6e 293a 0a20 2020 2020 2020 2020 2020  on):.           
+00016640: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00016650: 7761 726e 696e 6728 6622 4173 796e 6320  warning(f"Async 
+00016660: 636f 6465 2072 6169 7365 6420 616e 2065  code raised an e
+00016670: 7863 6570 7469 6f6e 3a20 7b72 6570 7228  xception: {repr(
+00016680: 7265 7329 7d22 290a 2020 2020 2020 2020  res)}").        
+00016690: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000166a0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+000166b0: 2020 2020 2023 2044 6563 6f6e 7374 7275       # Deconstru
+000166c0: 6374 2074 7570 6c65 2028 6861 7320 3520  ct tuple (has 5 
+000166d0: 656c 656d 656e 7473 290a 2020 2020 2020  elements).      
+000166e0: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
+000166f0: 7469 6d65 6672 616d 652c 2063 5f74 7970  timeframe, c_typ
+00016700: 652c 2074 6963 6b73 2c20 6472 6f70 5f68  e, ticks, drop_h
+00016710: 696e 7420 3d20 7265 730a 2020 2020 2020  int = res.      
+00016720: 2020 2020 2020 2020 2020 6472 6f70 5f69            drop_i
+00016730: 6e63 6f6d 706c 6574 655f 203d 2064 726f  ncomplete_ = dro
+00016740: 705f 6869 6e74 2069 6620 6472 6f70 5f69  p_hint if drop_i
+00016750: 6e63 6f6d 706c 6574 6520 6973 204e 6f6e  ncomplete is Non
+00016760: 6520 656c 7365 2064 726f 705f 696e 636f  e else drop_inco
+00016770: 6d70 6c65 7465 0a20 2020 2020 2020 2020  mplete.         
+00016780: 2020 2020 2020 206f 686c 6376 5f64 6620         ohlcv_df 
+00016790: 3d20 7365 6c66 2e5f 7072 6f63 6573 735f  = self._process_
+000167a0: 6f68 6c63 765f 6466 280a 2020 2020 2020  ohlcv_df(.      
+000167b0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000167c0: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
+000167d0: 5f74 7970 652c 2074 6963 6b73 2c20 6361  _type, ticks, ca
+000167e0: 6368 652c 2064 726f 705f 696e 636f 6d70  che, drop_incomp
+000167f0: 6c65 7465 5f29 0a0a 2020 2020 2020 2020  lete_)..        
+00016800: 2020 2020 2020 2020 7265 7375 6c74 735f          results_
+00016810: 6466 5b28 7061 6972 2c20 7469 6d65 6672  df[(pair, timefr
+00016820: 616d 652c 2063 5f74 7970 6529 5d20 3d20  ame, c_type)] = 
+00016830: 6f68 6c63 765f 6466 0a0a 2020 2020 2020  ohlcv_df..      
+00016840: 2020 2320 5265 7475 726e 2063 6163 6865    # Return cache
+00016850: 6420 6b6c 696e 6573 0a20 2020 2020 2020  d klines.       
+00016860: 2066 6f72 2070 6169 722c 2074 696d 6566   for pair, timef
+00016870: 7261 6d65 2c20 635f 7479 7065 2069 6e20  rame, c_type in 
+00016880: 6361 6368 6564 5f70 6169 7273 3a0a 2020  cached_pairs:.  
+00016890: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+000168a0: 735f 6466 5b28 7061 6972 2c20 7469 6d65  s_df[(pair, time
+000168b0: 6672 616d 652c 2063 5f74 7970 6529 5d20  frame, c_type)] 
+000168c0: 3d20 7365 6c66 2e6b 6c69 6e65 7328 0a20  = self.klines(. 
+000168d0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000168e0: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
+000168f0: 2063 5f74 7970 6529 2c0a 2020 2020 2020   c_type),.      
+00016900: 2020 2020 2020 2020 2020 636f 7079 3d46            copy=F
+00016910: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00016920: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
+00016930: 726e 2072 6573 756c 7473 5f64 660a 0a20  rn results_df.. 
+00016940: 2020 2064 6566 205f 6e6f 775f 6973 5f74     def _now_is_t
+00016950: 696d 655f 746f 5f72 6566 7265 7368 2873  ime_to_refresh(s
+00016960: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
+00016970: 7469 6d65 6672 616d 653a 2073 7472 2c20  timeframe: str, 
+00016980: 6361 6e64 6c65 5f74 7970 653a 2043 616e  candle_type: Can
+00016990: 646c 6554 7970 6529 202d 3e20 626f 6f6c  dleType) -> bool
+000169a0: 3a0a 2020 2020 2020 2020 2320 5469 6d65  :.        # Time
+000169b0: 6672 616d 6520 696e 2073 6563 6f6e 6473  frame in seconds
+000169c0: 0a20 2020 2020 2020 2069 6e74 6572 7661  .        interva
+000169d0: 6c5f 696e 5f73 6563 203d 2074 696d 6566  l_in_sec = timef
+000169e0: 7261 6d65 5f74 6f5f 7365 636f 6e64 7328  rame_to_seconds(
+000169f0: 7469 6d65 6672 616d 6529 0a20 2020 2020  timeframe).     
+00016a00: 2020 2070 6c72 203d 2073 656c 662e 5f70     plr = self._p
+00016a10: 6169 7273 5f6c 6173 745f 7265 6672 6573  airs_last_refres
+00016a20: 685f 7469 6d65 2e67 6574 2828 7061 6972  h_time.get((pair
+00016a30: 2c20 7469 6d65 6672 616d 652c 2063 616e  , timeframe, can
+00016a40: 646c 655f 7479 7065 292c 2030 2920 2b20  dle_type), 0) + 
+00016a50: 696e 7465 7276 616c 5f69 6e5f 7365 630a  interval_in_sec.
+00016a60: 2020 2020 2020 2020 2320 6375 7272 656e          # curren
+00016a70: 742c 6163 7469 7665 2063 616e 646c 6520  t,active candle 
+00016a80: 6f70 656e 2064 6174 650a 2020 2020 2020  open date.      
+00016a90: 2020 6e6f 7720 3d20 696e 7428 7469 6d65    now = int(time
+00016aa0: 6672 616d 655f 746f 5f70 7265 765f 6461  frame_to_prev_da
+00016ab0: 7465 2874 696d 6566 7261 6d65 292e 7469  te(timeframe).ti
+00016ac0: 6d65 7374 616d 7028 2929 0a20 2020 2020  mestamp()).     
+00016ad0: 2020 2072 6574 7572 6e20 706c 7220 3c20     return plr < 
+00016ae0: 6e6f 770a 0a20 2020 2040 7265 7472 6965  now..    @retrie
+00016af0: 725f 6173 796e 630a 2020 2020 6173 796e  r_async.    asyn
+00016b00: 6320 6465 6620 5f61 7379 6e63 5f67 6574  c def _async_get
+00016b10: 5f63 616e 646c 655f 6869 7374 6f72 7928  _candle_history(
+00016b20: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00016b30: 2020 2020 2020 2070 6169 723a 2073 7472         pair: str
+00016b40: 2c0a 2020 2020 2020 2020 7469 6d65 6672  ,.        timefr
+00016b50: 616d 653a 2073 7472 2c0a 2020 2020 2020  ame: str,.      
+00016b60: 2020 6361 6e64 6c65 5f74 7970 653a 2043    candle_type: C
+00016b70: 616e 646c 6554 7970 652c 0a20 2020 2020  andleType,.     
+00016b80: 2020 2073 696e 6365 5f6d 733a 204f 7074     since_ms: Opt
+00016b90: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
+00016ba0: 652c 0a20 2020 2029 202d 3e20 4f48 4c43  e,.    ) -> OHLC
+00016bb0: 5652 6573 706f 6e73 653a 0a20 2020 2020  VResponse:.     
+00016bc0: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
+00016bd0: 7379 6e63 6872 6f6e 6f75 736c 7920 6765  synchronously ge
+00016be0: 7420 6361 6e64 6c65 2068 6973 746f 7279  t candle history
+00016bf0: 2064 6174 6120 7573 696e 6720 6665 7463   data using fetc
+00016c00: 685f 6f68 6c63 760a 2020 2020 2020 2020  h_ohlcv.        
+00016c10: 3a70 6172 616d 2063 616e 646c 655f 7479  :param candle_ty
+00016c20: 7065 3a20 2727 2c20 6d61 726b 2c20 696e  pe: '', mark, in
+00016c30: 6465 782c 2070 7265 6d69 756d 496e 6465  dex, premiumInde
+00016c40: 782c 206f 7220 6675 6e64 696e 675f 7261  x, or funding_ra
+00016c50: 7465 0a20 2020 2020 2020 2072 6574 7572  te.        retur
+00016c60: 6e73 2074 7570 6c65 3a20 2870 6169 722c  ns tuple: (pair,
+00016c70: 2074 696d 6566 7261 6d65 2c20 6f68 6c63   timeframe, ohlc
+00016c80: 765f 6c69 7374 290a 2020 2020 2020 2020  v_list).        
+00016c90: 2222 220a 2020 2020 2020 2020 7472 793a  """.        try:
+00016ca0: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
+00016cb0: 6574 6368 204f 484c 4356 2061 7379 6e63  etch OHLCV async
+00016cc0: 6872 6f6e 6f75 736c 790a 2020 2020 2020  hronously.      
+00016cd0: 2020 2020 2020 7320 3d20 2728 2720 2b20        s = '(' + 
+00016ce0: 6172 726f 772e 6765 7428 7369 6e63 655f  arrow.get(since_
+00016cf0: 6d73 202f 2f20 3130 3030 292e 6973 6f66  ms // 1000).isof
+00016d00: 6f72 6d61 7428 2920 2b20 2729 2027 2069  ormat() + ') ' i
+00016d10: 6620 7369 6e63 655f 6d73 2069 7320 6e6f  f since_ms is no
+00016d20: 7420 4e6f 6e65 2065 6c73 6520 2727 0a20  t None else ''. 
+00016d30: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00016d40: 722e 6465 6275 6728 0a20 2020 2020 2020  r.debug(.       
+00016d50: 2020 2020 2020 2020 2022 4665 7463 6869           "Fetchi
+00016d60: 6e67 2070 6169 7220 2573 2c20 2573 2c20  ng pair %s, %s, 
+00016d70: 696e 7465 7276 616c 2025 732c 2073 696e  interval %s, sin
+00016d80: 6365 2025 7320 2573 2e2e 2e22 2c0a 2020  ce %s %s...",.  
+00016d90: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00016da0: 6972 2c20 6361 6e64 6c65 5f74 7970 652c  ir, candle_type,
+00016db0: 2074 696d 6566 7261 6d65 2c20 7369 6e63   timeframe, sinc
+00016dc0: 655f 6d73 2c20 730a 2020 2020 2020 2020  e_ms, s.        
+00016dd0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00016de0: 2020 7061 7261 6d73 203d 2064 6565 7063    params = deepc
+00016df0: 6f70 7928 7365 6c66 2e5f 6674 5f68 6173  opy(self._ft_has
+00016e00: 2e67 6574 2827 6f68 6c63 765f 7061 7261  .get('ohlcv_para
+00016e10: 6d73 272c 207b 7d29 290a 2020 2020 2020  ms', {})).      
+00016e20: 2020 2020 2020 6361 6e64 6c65 5f6c 696d        candle_lim
+00016e30: 6974 203d 2073 656c 662e 6f68 6c63 765f  it = self.ohlcv_
+00016e40: 6361 6e64 6c65 5f6c 696d 6974 280a 2020  candle_limit(.  
+00016e50: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00016e60: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
+00016e70: 7479 7065 3d63 616e 646c 655f 7479 7065  type=candle_type
+00016e80: 2c20 7369 6e63 655f 6d73 3d73 696e 6365  , since_ms=since
+00016e90: 5f6d 7329 0a0a 2020 2020 2020 2020 2020  _ms)..          
+00016ea0: 2020 6966 2063 616e 646c 655f 7479 7065    if candle_type
+00016eb0: 2061 6e64 2063 616e 646c 655f 7479 7065   and candle_type
+00016ec0: 2021 3d20 4361 6e64 6c65 5479 7065 2e53   != CandleType.S
+00016ed0: 504f 543a 0a20 2020 2020 2020 2020 2020  POT:.           
+00016ee0: 2020 2020 2070 6172 616d 732e 7570 6461       params.upda
+00016ef0: 7465 287b 2770 7269 6365 273a 2063 616e  te({'price': can
+00016f00: 646c 655f 7479 7065 2e76 616c 7565 7d29  dle_type.value})
+00016f10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016f20: 6361 6e64 6c65 5f74 7970 6520 213d 2043  candle_type != C
+00016f30: 616e 646c 6554 7970 652e 4655 4e44 494e  andleType.FUNDIN
+00016f40: 475f 5241 5445 3a0a 2020 2020 2020 2020  G_RATE:.        
+00016f50: 2020 2020 2020 2020 6461 7461 203d 2061          data = a
+00016f60: 7761 6974 2073 656c 662e 5f61 7069 5f61  wait self._api_a
+00016f70: 7379 6e63 2e66 6574 6368 5f6f 686c 6376  sync.fetch_ohlcv
+00016f80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00016f90: 2020 2020 2020 7061 6972 2c20 7469 6d65        pair, time
+00016fa0: 6672 616d 653d 7469 6d65 6672 616d 652c  frame=timeframe,
+00016fb0: 2073 696e 6365 3d73 696e 6365 5f6d 732c   since=since_ms,
+00016fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016fd0: 2020 2020 206c 696d 6974 3d63 616e 646c       limit=candl
+00016fe0: 655f 6c69 6d69 742c 2070 6172 616d 733d  e_limit, params=
+00016ff0: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00017000: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00017010: 2020 2020 2020 2020 2020 2320 4675 6e64            # Fund
+00017020: 696e 6720 7261 7465 0a20 2020 2020 2020  ing rate.       
+00017030: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
+00017040: 6177 6169 7420 7365 6c66 2e5f 6665 7463  await self._fetc
+00017050: 685f 6675 6e64 696e 675f 7261 7465 5f68  h_funding_rate_h
+00017060: 6973 746f 7279 280a 2020 2020 2020 2020  istory(.        
+00017070: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+00017080: 3d70 6169 722c 0a20 2020 2020 2020 2020  =pair,.         
+00017090: 2020 2020 2020 2020 2020 2074 696d 6566             timef
+000170a0: 7261 6d65 3d74 696d 6566 7261 6d65 2c0a  rame=timeframe,.
+000170b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170c0: 2020 2020 6c69 6d69 743d 6361 6e64 6c65      limit=candle
+000170d0: 5f6c 696d 6974 2c0a 2020 2020 2020 2020  _limit,.        
+000170e0: 2020 2020 2020 2020 2020 2020 7369 6e63              sinc
+000170f0: 655f 6d73 3d73 696e 6365 5f6d 732c 0a20  e_ms=since_ms,. 
+00017100: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00017110: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+00017120: 6f6d 6520 6578 6368 616e 6765 7320 736f  ome exchanges so
+00017130: 7274 204f 484c 4356 2069 6e20 4153 4320  rt OHLCV in ASC 
+00017140: 6f72 6465 7220 616e 6420 6f74 6865 7273  order and others
+00017150: 2069 6e20 4445 5343 2e0a 2020 2020 2020   in DESC..      
+00017160: 2020 2020 2020 2320 4578 3a20 4269 7474        # Ex: Bitt
+00017170: 7265 7820 7265 7475 726e 7320 7468 6520  rex returns the 
+00017180: 6c69 7374 206f 6620 4f48 4c43 5620 696e  list of OHLCV in
+00017190: 2041 5343 206f 7264 6572 2028 6f6c 6465   ASC order (olde
+000171a0: 7374 2066 6972 7374 2c20 6e65 7765 7374  st first, newest
+000171b0: 206c 6173 7429 0a20 2020 2020 2020 2020   last).         
+000171c0: 2020 2023 2077 6869 6c65 2047 4441 5820     # while GDAX 
+000171d0: 7265 7475 726e 7320 7468 6520 6c69 7374  returns the list
+000171e0: 206f 6620 4f48 4c43 5620 696e 2044 4553   of OHLCV in DES
+000171f0: 4320 6f72 6465 7220 286e 6577 6573 7420  C order (newest 
+00017200: 6669 7273 742c 206f 6c64 6573 7420 6c61  first, oldest la
+00017210: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
+00017220: 2320 4f6e 6c79 2073 6f72 7420 6966 206e  # Only sort if n
+00017230: 6563 6573 7361 7279 2074 6f20 7361 7665  ecessary to save
+00017240: 2063 6f6d 7075 7469 6e67 2074 696d 650a   computing time.
+00017250: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00017260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017270: 2069 6620 6461 7461 2061 6e64 2064 6174   if data and dat
+00017280: 615b 305d 5b30 5d20 3e20 6461 7461 5b2d  a[0][0] > data[-
+00017290: 315d 5b30 5d3a 0a20 2020 2020 2020 2020  1][0]:.         
+000172a0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+000172b0: 3d20 736f 7274 6564 2864 6174 612c 206b  = sorted(data, k
+000172c0: 6579 3d6c 616d 6264 6120 783a 2078 5b30  ey=lambda x: x[0
+000172d0: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
+000172e0: 7863 6570 7420 496e 6465 7845 7272 6f72  xcept IndexError
+000172f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017300: 2020 6c6f 6767 6572 2e65 7863 6570 7469    logger.excepti
+00017310: 6f6e 2822 4572 726f 7220 6c6f 6164 696e  on("Error loadin
+00017320: 6720 2573 2e20 5265 7375 6c74 2077 6173  g %s. Result was
+00017330: 2025 732e 222c 2070 6169 722c 2064 6174   %s.", pair, dat
+00017340: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
+00017350: 2020 2072 6574 7572 6e20 7061 6972 2c20     return pair, 
+00017360: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
+00017370: 655f 7479 7065 2c20 5b5d 2c20 7365 6c66  e_type, [], self
+00017380: 2e5f 6f68 6c63 765f 7061 7274 6961 6c5f  ._ohlcv_partial_
+00017390: 6361 6e64 6c65 0a20 2020 2020 2020 2020  candle.         
+000173a0: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+000173b0: 2244 6f6e 6520 6665 7463 6869 6e67 2070  "Done fetching p
+000173c0: 6169 7220 2573 2c20 696e 7465 7276 616c  air %s, interval
+000173d0: 2025 7320 2e2e 2e22 2c20 7061 6972 2c20   %s ...", pair, 
+000173e0: 7469 6d65 6672 616d 6529 0a20 2020 2020  timeframe).     
+000173f0: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
+00017400: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
+00017410: 616e 646c 655f 7479 7065 2c20 6461 7461  andle_type, data
+00017420: 2c20 7365 6c66 2e5f 6f68 6c63 765f 7061  , self._ohlcv_pa
+00017430: 7274 6961 6c5f 6361 6e64 6c65 0a0a 2020  rtial_candle..  
+00017440: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+00017450: 742e 4e6f 7453 7570 706f 7274 6564 2061  t.NotSupported a
+00017460: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00017470: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00017480: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
+00017490: 2020 2020 2020 2020 2020 2020 2066 2745               f'E
+000174a0: 7863 6861 6e67 6520 7b73 656c 662e 5f61  xchange {self._a
+000174b0: 7069 2e6e 616d 657d 2064 6f65 7320 6e6f  pi.name} does no
+000174c0: 7420 7375 7070 6f72 7420 6665 7463 6869  t support fetchi
+000174d0: 6e67 2068 6973 746f 7269 6361 6c20 270a  ng historical '.
+000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174f0: 6627 6361 6e64 6c65 2028 4f48 4c43 5629  f'candle (OHLCV)
+00017500: 2064 6174 612e 204d 6573 7361 6765 3a20   data. Message: 
+00017510: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+00017520: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+00017530: 2e44 446f 5350 726f 7465 6374 696f 6e20  .DDoSProtection 
+00017540: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00017550: 2020 7261 6973 6520 4444 6f73 5072 6f74    raise DDosProt
+00017560: 6563 7469 6f6e 2865 2920 6672 6f6d 2065  ection(e) from e
+00017570: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00017580: 2863 6378 742e 4e65 7477 6f72 6b45 7272  (ccxt.NetworkErr
+00017590: 6f72 2c20 6363 7874 2e45 7863 6861 6e67  or, ccxt.Exchang
+000175a0: 6545 7272 6f72 2920 6173 2065 3a0a 2020  eError) as e:.  
+000175b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000175c0: 5465 6d70 6f72 6172 7945 7272 6f72 2866  TemporaryError(f
+000175d0: 2743 6f75 6c64 206e 6f74 2066 6574 6368  'Could not fetch
+000175e0: 2068 6973 746f 7269 6361 6c20 6361 6e64   historical cand
+000175f0: 6c65 2028 4f48 4c43 5629 2064 6174 6120  le (OHLCV) data 
+00017600: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00017610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017620: 2020 2066 2766 6f72 2070 6169 7220 7b70     f'for pair {p
+00017630: 6169 727d 2064 7565 2074 6f20 7b65 2e5f  air} due to {e._
+00017640: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00017650: 5f7d 2e20 270a 2020 2020 2020 2020 2020  _}. '.          
+00017660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017670: 2020 2020 2020 2066 274d 6573 7361 6765         f'Message
+00017680: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
+00017690: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+000176a0: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
+000176b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+000176c0: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+000176d0: 4578 6365 7074 696f 6e28 6627 436f 756c  Exception(f'Coul
+000176e0: 6420 6e6f 7420 6665 7463 6820 6869 7374  d not fetch hist
+000176f0: 6f72 6963 616c 2063 616e 646c 6520 284f  orical candle (O
+00017700: 484c 4356 2920 6461 7461 2027 0a20 2020  HLCV) data '.   
+00017710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017730: 2020 2020 6627 666f 7220 7061 6972 207b      f'for pair {
+00017740: 7061 6972 7d2e 204d 6573 7361 6765 3a20  pair}. Message: 
+00017750: 7b65 7d27 2920 6672 6f6d 2065 0a0a 2020  {e}') from e..  
+00017760: 2020 6173 796e 6320 6465 6620 5f66 6574    async def _fet
+00017770: 6368 5f66 756e 6469 6e67 5f72 6174 655f  ch_funding_rate_
+00017780: 6869 7374 6f72 7928 0a20 2020 2020 2020  history(.       
+00017790: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
+000177a0: 6169 723a 2073 7472 2c0a 2020 2020 2020  air: str,.      
+000177b0: 2020 7469 6d65 6672 616d 653a 2073 7472    timeframe: str
+000177c0: 2c0a 2020 2020 2020 2020 6c69 6d69 743a  ,.        limit:
+000177d0: 2069 6e74 2c0a 2020 2020 2020 2020 7369   int,.        si
+000177e0: 6e63 655f 6d73 3a20 4f70 7469 6f6e 616c  nce_ms: Optional
+000177f0: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
+00017800: 2020 2920 2d3e 204c 6973 745b 4c69 7374    ) -> List[List
+00017810: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+00017820: 2020 2020 2020 2046 6574 6368 2066 756e         Fetch fun
+00017830: 6469 6e67 2072 6174 6520 6869 7374 6f72  ding rate histor
+00017840: 7920 2d20 7573 6564 2074 6f20 7365 6c65  y - used to sele
+00017850: 6374 6976 656c 7920 6f76 6572 7269 6465  ctively override
+00017860: 2074 6869 7320 6279 2073 7562 636c 6173   this by subclas
+00017870: 7365 732e 0a20 2020 2020 2020 2022 2222  ses..        """
+00017880: 0a20 2020 2020 2020 2023 2046 756e 6469  .        # Fundi
+00017890: 6e67 2072 6174 650a 2020 2020 2020 2020  ng rate.        
+000178a0: 6461 7461 203d 2061 7761 6974 2073 656c  data = await sel
+000178b0: 662e 5f61 7069 5f61 7379 6e63 2e66 6574  f._api_async.fet
+000178c0: 6368 5f66 756e 6469 6e67 5f72 6174 655f  ch_funding_rate_
+000178d0: 6869 7374 6f72 7928 0a20 2020 2020 2020  history(.       
+000178e0: 2020 2020 2070 6169 722c 2073 696e 6365       pair, since
+000178f0: 3d73 696e 6365 5f6d 732c 0a20 2020 2020  =since_ms,.     
+00017900: 2020 2020 2020 206c 696d 6974 3d6c 696d         limit=lim
+00017910: 6974 290a 2020 2020 2020 2020 2320 436f  it).        # Co
+00017920: 6e76 6572 7420 6675 6e64 696e 6720 7261  nvert funding ra
+00017930: 7465 2074 6f20 6361 6e64 6c65 2070 6174  te to candle pat
+00017940: 7465 726e 0a20 2020 2020 2020 2064 6174  tern.        dat
+00017950: 6120 3d20 5b5b 785b 2774 696d 6573 7461  a = [[x['timesta
+00017960: 6d70 275d 2c20 785b 2766 756e 6469 6e67  mp'], x['funding
+00017970: 5261 7465 275d 2c20 302c 2030 2c20 302c  Rate'], 0, 0, 0,
+00017980: 2030 5d20 666f 7220 7820 696e 2064 6174   0] for x in dat
+00017990: 615d 0a20 2020 2020 2020 2072 6574 7572  a].        retur
+000179a0: 6e20 6461 7461 0a0a 2020 2020 2320 4665  n data..    # Fe
+000179b0: 7463 6820 6869 7374 6f72 6963 2074 7261  tch historic tra
+000179c0: 6465 730a 0a20 2020 2040 7265 7472 6965  des..    @retrie
+000179d0: 725f 6173 796e 630a 2020 2020 6173 796e  r_async.    asyn
+000179e0: 6320 6465 6620 5f61 7379 6e63 5f66 6574  c def _async_fet
+000179f0: 6368 5f74 7261 6465 7328 7365 6c66 2c20  ch_trades(self, 
+00017a00: 7061 6972 3a20 7374 722c 0a20 2020 2020  pair: str,.     
+00017a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a20: 2020 2020 2020 2020 2020 2020 2073 696e               sin
+00017a30: 6365 3a20 4f70 7469 6f6e 616c 5b69 6e74  ce: Optional[int
+00017a40: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a60: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00017a70: 6d73 3a20 4f70 7469 6f6e 616c 5b64 6963  ms: Optional[dic
+00017a80: 745d 203d 204e 6f6e 6529 202d 3e20 4c69  t] = None) -> Li
+00017a90: 7374 5b4c 6973 745d 3a0a 2020 2020 2020  st[List]:.      
+00017aa0: 2020 2222 220a 2020 2020 2020 2020 4173    """.        As
+00017ab0: 796e 6372 6f6e 6f75 736c 7920 6765 7473  yncronously gets
+00017ac0: 2074 7261 6465 2068 6973 746f 7279 2075   trade history u
+00017ad0: 7369 6e67 2066 6574 6368 5f74 7261 6465  sing fetch_trade
+00017ae0: 732e 0a20 2020 2020 2020 2048 616e 646c  s..        Handl
+00017af0: 6573 2065 7863 6861 6e67 6520 6572 726f  es exchange erro
+00017b00: 7273 2c20 646f 6573 206f 6e65 2063 616c  rs, does one cal
+00017b10: 6c20 746f 2074 6865 2065 7863 6861 6e67  l to the exchang
+00017b20: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+00017b30: 6d20 7061 6972 3a20 5061 6972 2074 6f20  m pair: Pair to 
+00017b40: 6665 7463 6820 7472 6164 6520 6461 7461  fetch trade data
+00017b50: 2066 6f72 0a20 2020 2020 2020 203a 7061   for.        :pa
+00017b60: 7261 6d20 7369 6e63 653a 2053 696e 6365  ram since: Since
+00017b70: 2061 7320 696e 7465 6765 7220 7469 6d65   as integer time
+00017b80: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
+00017b90: 636f 6e64 730a 2020 2020 2020 2020 7265  conds.        re
+00017ba0: 7475 726e 733a 204c 6973 7420 6f66 2064  turns: List of d
+00017bb0: 6963 7473 2063 6f6e 7461 696e 696e 6720  icts containing 
+00017bc0: 7472 6164 6573 0a20 2020 2020 2020 2022  trades.        "
+00017bd0: 2222 0a20 2020 2020 2020 2074 7279 3a0a  "".        try:.
+00017be0: 2020 2020 2020 2020 2020 2020 2320 6665              # fe
+00017bf0: 7463 6820 7472 6164 6573 2061 7379 6e63  tch trades async
+00017c00: 6872 6f6e 6f75 736c 790a 2020 2020 2020  hronously.      
+00017c10: 2020 2020 2020 6966 2070 6172 616d 733a        if params:
+00017c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017c30: 206c 6f67 6765 722e 6465 6275 6728 2246   logger.debug("F
+00017c40: 6574 6368 696e 6720 7472 6164 6573 2066  etching trades f
+00017c50: 6f72 2070 6169 7220 2573 2c20 7061 7261  or pair %s, para
+00017c60: 6d73 3a20 2573 2022 2c20 7061 6972 2c20  ms: %s ", pair, 
+00017c70: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00017c80: 2020 2020 2020 2020 7472 6164 6573 203d          trades =
+00017c90: 2061 7761 6974 2073 656c 662e 5f61 7069   await self._api
+00017ca0: 5f61 7379 6e63 2e66 6574 6368 5f74 7261  _async.fetch_tra
+00017cb0: 6465 7328 7061 6972 2c20 7061 7261 6d73  des(pair, params
+00017cc0: 3d70 6172 616d 732c 206c 696d 6974 3d31  =params, limit=1
+00017cd0: 3030 3029 0a20 2020 2020 2020 2020 2020  000).           
+00017ce0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00017cf0: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+00017d00: 6275 6728 0a20 2020 2020 2020 2020 2020  bug(.           
+00017d10: 2020 2020 2020 2020 2022 4665 7463 6869           "Fetchi
+00017d20: 6e67 2074 7261 6465 7320 666f 7220 7061  ng trades for pa
+00017d30: 6972 2025 732c 2073 696e 6365 2025 7320  ir %s, since %s 
+00017d40: 2573 2e2e 2e22 2c0a 2020 2020 2020 2020  %s...",.        
+00017d50: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+00017d60: 2c20 7369 6e63 652c 0a20 2020 2020 2020  , since,.       
+00017d70: 2020 2020 2020 2020 2020 2020 2027 2827               '('
+00017d80: 202b 2061 7272 6f77 2e67 6574 2873 696e   + arrow.get(sin
+00017d90: 6365 202f 2f20 3130 3030 292e 6973 6f66  ce // 1000).isof
+00017da0: 6f72 6d61 7428 2920 2b20 2729 2027 2069  ormat() + ') ' i
+00017db0: 6620 7369 6e63 6520 6973 206e 6f74 204e  f since is not N
+00017dc0: 6f6e 6520 656c 7365 2027 270a 2020 2020  one else ''.    
+00017dd0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00017de0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00017df0: 6164 6573 203d 2061 7761 6974 2073 656c  ades = await sel
+00017e00: 662e 5f61 7069 5f61 7379 6e63 2e66 6574  f._api_async.fet
+00017e10: 6368 5f74 7261 6465 7328 7061 6972 2c20  ch_trades(pair, 
+00017e20: 7369 6e63 653d 7369 6e63 652c 206c 696d  since=since, lim
+00017e30: 6974 3d31 3030 3029 0a20 2020 2020 2020  it=1000).       
+00017e40: 2020 2020 2074 7261 6465 7320 3d20 7365       trades = se
+00017e50: 6c66 2e5f 7472 6164 6573 5f63 6f6e 7472  lf._trades_contr
+00017e60: 6163 7473 5f74 6f5f 616d 6f75 6e74 2874  acts_to_amount(t
+00017e70: 7261 6465 7329 0a20 2020 2020 2020 2020  rades).         
+00017e80: 2020 2072 6574 7572 6e20 7472 6164 6573     return trades
+00017e90: 5f64 6963 745f 746f 5f6c 6973 7428 7472  _dict_to_list(tr
+00017ea0: 6164 6573 290a 2020 2020 2020 2020 6578  ades).        ex
+00017eb0: 6365 7074 2063 6378 742e 4e6f 7453 7570  cept ccxt.NotSup
+00017ec0: 706f 7274 6564 2061 7320 653a 0a20 2020  ported as e:.   
+00017ed0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+00017ee0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00017ef0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+00017f00: 2020 2020 2066 2745 7863 6861 6e67 6520       f'Exchange 
+00017f10: 7b73 656c 662e 5f61 7069 2e6e 616d 657d  {self._api.name}
+00017f20: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
+00017f30: 7420 6665 7463 6869 6e67 2068 6973 746f  t fetching histo
+00017f40: 7269 6361 6c20 7472 6164 6520 6461 7461  rical trade data
+00017f50: 2e27 0a20 2020 2020 2020 2020 2020 2020  .'.             
+00017f60: 2020 2066 274d 6573 7361 6765 3a20 7b65     f'Message: {e
+00017f70: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+00017f80: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
+00017f90: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
+00017fa0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00017fb0: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
+00017fc0: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
+00017fd0: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
+00017fe0: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
+00017ff0: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+00018000: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+00018010: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+00018020: 6d70 6f72 6172 7945 7272 6f72 2866 2743  mporaryError(f'C
+00018030: 6f75 6c64 206e 6f74 206c 6f61 6420 7472  ould not load tr
+00018040: 6164 6520 6869 7374 6f72 7920 6475 6520  ade history due 
+00018050: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
+00018060: 5f5f 6e61 6d65 5f5f 7d2e 2027 0a20 2020  __name__}. '.   
+00018070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018080: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+00018090: 4d65 7373 6167 653a 207b 657d 2729 2066  Message: {e}') f
+000180a0: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
+000180b0: 6365 7074 2063 6378 742e 4261 7365 4572  cept ccxt.BaseEr
+000180c0: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+000180d0: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+000180e0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+000180f0: 2866 2743 6f75 6c64 206e 6f74 2066 6574  (f'Could not fet
+00018100: 6368 2074 7261 6465 2064 6174 612e 204d  ch trade data. M
+00018110: 7367 3a20 7b65 7d27 2920 6672 6f6d 2065  sg: {e}') from e
+00018120: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
+00018130: 5f61 7379 6e63 5f67 6574 5f74 7261 6465  _async_get_trade
+00018140: 5f68 6973 746f 7279 5f69 6428 7365 6c66  _history_id(self
+00018150: 2c20 7061 6972 3a20 7374 722c 0a20 2020  , pair: str,.   
+00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018180: 2020 2020 2020 2075 6e74 696c 3a20 696e         until: in
+00018190: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+000181a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181b0: 2020 2020 2020 2020 2020 2020 2073 696e               sin
+000181c0: 6365 3a20 4f70 7469 6f6e 616c 5b69 6e74  ce: Optional[int
+000181d0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018200: 2020 2020 6672 6f6d 5f69 643a 204f 7074      from_id: Opt
+00018210: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+00018220: 6529 202d 3e20 5475 706c 655b 7374 722c  e) -> Tuple[str,
+00018230: 204c 6973 745b 4c69 7374 5d5d 3a0a 2020   List[List]]:.  
+00018240: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00018250: 2020 4173 796e 6372 6f6e 6f75 736c 7920    Asyncronously 
+00018260: 6765 7473 2074 7261 6465 2068 6973 746f  gets trade histo
+00018270: 7279 2075 7369 6e67 2066 6574 6368 5f74  ry using fetch_t
+00018280: 7261 6465 730a 2020 2020 2020 2020 7573  rades.        us
+00018290: 6520 7468 6973 2077 6865 6e20 6578 6368  e this when exch
+000182a0: 616e 6765 2075 7365 7320 6964 2d62 6173  ange uses id-bas
+000182b0: 6564 2069 7465 7261 7469 6f6e 2028 6368  ed iteration (ch
+000182c0: 6563 6b20 6073 656c 662e 5f74 7261 6465  eck `self._trade
+000182d0: 735f 7061 6769 6e61 7469 6f6e 6029 0a20  s_pagination`). 
+000182e0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+000182f0: 6972 3a20 5061 6972 2074 6f20 6665 7463  ir: Pair to fetc
+00018300: 6820 7472 6164 6520 6461 7461 2066 6f72  h trade data for
+00018310: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00018320: 7369 6e63 653a 2053 696e 6365 2061 7320  since: Since as 
+00018330: 696e 7465 6765 7220 7469 6d65 7374 616d  integer timestam
+00018340: 7020 696e 206d 696c 6c69 7365 636f 6e64  p in millisecond
+00018350: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
+00018360: 2075 6e74 696c 3a20 556e 7469 6c20 6173   until: Until as
+00018370: 2069 6e74 6567 6572 2074 696d 6573 7461   integer timesta
+00018380: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
+00018390: 6473 0a20 2020 2020 2020 203a 7061 7261  ds.        :para
+000183a0: 6d20 6672 6f6d 5f69 643a 2044 6f77 6e6c  m from_id: Downl
+000183b0: 6f61 6420 6461 7461 2073 7461 7274 696e  oad data startin
+000183c0: 6720 7769 7468 2049 4420 2869 6620 6964  g with ID (if id
+000183d0: 2069 7320 6b6e 6f77 6e29 2e20 4967 6e6f   is known). Igno
+000183e0: 7265 7320 2273 696e 6365 2220 6966 2073  res "since" if s
+000183f0: 6574 2e0a 2020 2020 2020 2020 7265 7475  et..        retu
+00018400: 726e 7320 7475 706c 653a 2028 7061 6972  rns tuple: (pair
+00018410: 2c20 7472 6164 6573 2d6c 6973 7429 0a20  , trades-list). 
+00018420: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00018430: 2020 2020 7472 6164 6573 3a20 4c69 7374      trades: List
+00018440: 5b4c 6973 745d 203d 205b 5d0a 0a20 2020  [List] = []..   
+00018450: 2020 2020 2069 6620 6e6f 7420 6672 6f6d       if not from
+00018460: 5f69 643a 0a20 2020 2020 2020 2020 2020  _id:.           
+00018470: 2023 2046 6574 6368 2066 6972 7374 2065   # Fetch first e
+00018480: 6c65 6d65 6e74 7320 7573 696e 6720 7469  lements using ti
+00018490: 6d65 6261 7365 6420 6d65 7468 6f64 2074  mebased method t
+000184a0: 6f20 6765 7420 616e 2049 4420 746f 2070  o get an ID to p
+000184b0: 6167 696e 6174 6520 6f6e 0a20 2020 2020  aginate on.     
+000184c0: 2020 2020 2020 2023 2044 6570 656e 6469         # Dependi
+000184d0: 6e67 206f 6e20 7468 6520 4578 6368 616e  ng on the Exchan
+000184e0: 6765 2c20 7468 6973 2063 616e 2069 6e74  ge, this can int
+000184f0: 726f 6475 6365 2061 2064 7269 6674 2061  roduce a drift a
+00018500: 7420 7468 6520 7374 6172 7420 6f66 2074  t the start of t
+00018510: 6865 2069 6e74 6572 7661 6c0a 2020 2020  he interval.    
+00018520: 2020 2020 2020 2020 2320 6f66 2075 7020          # of up 
+00018530: 746f 2061 6e20 686f 7572 2e0a 2020 2020  to an hour..    
+00018540: 2020 2020 2020 2020 2320 652e 672e 2042          # e.g. B
+00018550: 696e 616e 6365 2072 6574 7572 6e73 2074  inance returns t
+00018560: 6865 2022 6c61 7374 2031 3030 3022 2063  he "last 1000" c
+00018570: 616e 646c 6573 2077 6974 6869 6e20 6120  andles within a 
+00018580: 3168 2074 696d 6520 696e 7465 7276 616c  1h time interval
+00018590: 0a20 2020 2020 2020 2020 2020 2023 202d  .            # -
+000185a0: 2073 6f20 7765 2077 696c 6c20 6d69 7373   so we will miss
+000185b0: 2074 6865 2066 6972 7374 2074 7261 6465   the first trade
+000185c0: 732e 0a20 2020 2020 2020 2020 2020 2074  s..            t
+000185d0: 203d 2061 7761 6974 2073 656c 662e 5f61   = await self._a
+000185e0: 7379 6e63 5f66 6574 6368 5f74 7261 6465  sync_fetch_trade
+000185f0: 7328 7061 6972 2c20 7369 6e63 653d 7369  s(pair, since=si
+00018600: 6e63 6529 0a20 2020 2020 2020 2020 2020  nce).           
+00018610: 2023 2044 4546 4155 4c54 5f54 5241 4445   # DEFAULT_TRADE
+00018620: 535f 434f 4c55 4d4e 533a 2030 202d 3e20  S_COLUMNS: 0 -> 
+00018630: 7469 6d65 7374 616d 700a 2020 2020 2020  timestamp.      
+00018640: 2020 2020 2020 2320 4445 4641 554c 545f        # DEFAULT_
+00018650: 5452 4144 4553 5f43 4f4c 554d 4e53 3a20  TRADES_COLUMNS: 
+00018660: 3120 2d3e 2069 640a 2020 2020 2020 2020  1 -> id.        
+00018670: 2020 2020 6672 6f6d 5f69 6420 3d20 745b      from_id = t[
+00018680: 2d31 5d5b 315d 0a20 2020 2020 2020 2020  -1][1].         
+00018690: 2020 2074 7261 6465 732e 6578 7465 6e64     trades.extend
+000186a0: 2874 5b3a 2d31 5d29 0a20 2020 2020 2020  (t[:-1]).       
+000186b0: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
+000186c0: 2020 2020 2020 2020 2074 203d 2061 7761           t = awa
+000186d0: 6974 2073 656c 662e 5f61 7379 6e63 5f66  it self._async_f
+000186e0: 6574 6368 5f74 7261 6465 7328 7061 6972  etch_trades(pair
+000186f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00018700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018710: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
-00018720: 2020 2020 2020 2020 6672 6f6d 5f69 6420          from_id 
-00018730: 3d20 745b 2d31 5d5b 315d 0a20 2020 2020  = t[-1][1].     
-00018740: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00018750: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00018760: 616b 0a0a 2020 2020 2020 2020 7265 7475  ak..        retu
-00018770: 726e 2028 7061 6972 2c20 7472 6164 6573  rn (pair, trades
-00018780: 290a 0a20 2020 2061 7379 6e63 2064 6566  )..    async def
-00018790: 205f 6173 796e 635f 6765 745f 7472 6164   _async_get_trad
-000187a0: 655f 6869 7374 6f72 795f 7469 6d65 2873  e_history_time(s
-000187b0: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
-000187c0: 756e 7469 6c3a 2069 6e74 2c0a 2020 2020  until: int,.    
-000187d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187f0: 2020 2020 2020 2020 7369 6e63 653a 204f          since: O
-00018800: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-00018810: 6f6e 6529 202d 3e20 5475 706c 655b 7374  one) -> Tuple[st
-00018820: 722c 204c 6973 745b 4c69 7374 5d5d 3a0a  r, List[List]]:.
-00018830: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00018840: 2020 2020 4173 796e 6372 6f6e 6f75 736c      Asyncronousl
-00018850: 7920 6765 7473 2074 7261 6465 2068 6973  y gets trade his
-00018860: 746f 7279 2075 7369 6e67 2066 6574 6368  tory using fetch
-00018870: 5f74 7261 6465 732c 0a20 2020 2020 2020  _trades,.       
-00018880: 2077 6865 6e20 7468 6520 6578 6368 616e   when the exchan
-00018890: 6765 2075 7365 7320 7469 6d65 2d62 6173  ge uses time-bas
-000188a0: 6564 2069 7465 7261 7469 6f6e 2028 6368  ed iteration (ch
-000188b0: 6563 6b20 6073 656c 662e 5f74 7261 6465  eck `self._trade
-000188c0: 735f 7061 6769 6e61 7469 6f6e 6029 0a20  s_pagination`). 
-000188d0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-000188e0: 6972 3a20 5061 6972 2074 6f20 6665 7463  ir: Pair to fetc
-000188f0: 6820 7472 6164 6520 6461 7461 2066 6f72  h trade data for
-00018900: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00018910: 7369 6e63 653a 2053 696e 6365 2061 7320  since: Since as 
-00018920: 696e 7465 6765 7220 7469 6d65 7374 616d  integer timestam
-00018930: 7020 696e 206d 696c 6c69 7365 636f 6e64  p in millisecond
-00018940: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
-00018950: 2075 6e74 696c 3a20 556e 7469 6c20 6173   until: Until as
-00018960: 2069 6e74 6567 6572 2074 696d 6573 7461   integer timesta
-00018970: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
-00018980: 6473 0a20 2020 2020 2020 2072 6574 7572  ds.        retur
-00018990: 6e73 2074 7570 6c65 3a20 2870 6169 722c  ns tuple: (pair,
-000189a0: 2074 7261 6465 732d 6c69 7374 290a 2020   trades-list).  
-000189b0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-000189c0: 2020 2074 7261 6465 733a 204c 6973 745b     trades: List[
-000189d0: 4c69 7374 5d20 3d20 5b5d 0a20 2020 2020  List] = [].     
-000189e0: 2020 2023 2044 4546 4155 4c54 5f54 5241     # DEFAULT_TRA
-000189f0: 4445 535f 434f 4c55 4d4e 533a 2030 202d  DES_COLUMNS: 0 -
-00018a00: 3e20 7469 6d65 7374 616d 700a 2020 2020  > timestamp.    
-00018a10: 2020 2020 2320 4445 4641 554c 545f 5452      # DEFAULT_TR
-00018a20: 4144 4553 5f43 4f4c 554d 4e53 3a20 3120  ADES_COLUMNS: 1 
-00018a30: 2d3e 2069 640a 2020 2020 2020 2020 7768  -> id.        wh
-00018a40: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
-00018a50: 2020 2020 2020 7420 3d20 6177 6169 7420        t = await 
-00018a60: 7365 6c66 2e5f 6173 796e 635f 6665 7463  self._async_fetc
-00018a70: 685f 7472 6164 6573 2870 6169 722c 2073  h_trades(pair, s
-00018a80: 696e 6365 3d73 696e 6365 290a 2020 2020  ince=since).    
-00018a90: 2020 2020 2020 2020 6966 2074 3a0a 2020          if t:.  
-00018aa0: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00018ab0: 6e63 6520 3d20 745b 2d31 5d5b 305d 0a20  nce = t[-1][0]. 
-00018ac0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00018ad0: 7261 6465 732e 6578 7465 6e64 2874 290a  rades.extend(t).
-00018ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018af0: 2320 5265 6163 6865 6420 7468 6520 656e  # Reached the en
-00018b00: 6420 6f66 2074 6865 2064 6566 696e 6564  d of the defined
-00018b10: 2d64 6f77 6e6c 6f61 6420 7065 7269 6f64  -download period
-00018b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018b30: 2069 6620 756e 7469 6c20 616e 6420 745b   if until and t[
-00018b40: 2d31 5d5b 305d 203e 2075 6e74 696c 3a0a  -1][0] > until:.
-00018b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b60: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-00018b70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00018b80: 2020 2020 2020 2020 2020 6622 5374 6f70            f"Stop
-00018b90: 7069 6e67 2062 6563 6175 7365 2075 6e74  ping because unt
-00018ba0: 696c 2077 6173 2072 6561 6368 6564 2e20  il was reached. 
-00018bb0: 7b74 5b2d 315d 5b30 5d7d 203e 207b 756e  {t[-1][0]} > {un
-00018bc0: 7469 6c7d 2229 0a20 2020 2020 2020 2020  til}").         
-00018bd0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00018be0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00018bf0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00018c00: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
-00018c10: 2020 7265 7475 726e 2028 7061 6972 2c20    return (pair, 
-00018c20: 7472 6164 6573 290a 0a20 2020 2061 7379  trades)..    asy
-00018c30: 6e63 2064 6566 205f 6173 796e 635f 6765  nc def _async_ge
-00018c40: 745f 7472 6164 655f 6869 7374 6f72 7928  t_trade_history(
-00018c50: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
-00018c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c80: 2020 2020 2020 2020 7369 6e63 653a 204f          since: O
-00018c90: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-00018ca0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00018cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cc0: 2020 2020 2020 2020 2020 2020 756e 7469              unti
-00018cd0: 6c3a 204f 7074 696f 6e61 6c5b 696e 745d  l: Optional[int]
-00018ce0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00018cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d10: 6672 6f6d 5f69 643a 204f 7074 696f 6e61  from_id: Optiona
-00018d20: 6c5b 7374 725d 203d 204e 6f6e 6529 202d  l[str] = None) -
-00018d30: 3e20 5475 706c 655b 7374 722c 204c 6973  > Tuple[str, Lis
-00018d40: 745b 4c69 7374 5d5d 3a0a 2020 2020 2020  t[List]]:.      
-00018d50: 2020 2222 220a 2020 2020 2020 2020 4173    """.        As
-00018d60: 796e 6320 7772 6170 7065 7220 6861 6e64  ync wrapper hand
-00018d70: 6c69 6e67 2064 6f77 6e6c 6f61 6469 6e67  ling downloading
-00018d80: 2074 7261 6465 7320 7573 696e 6720 6569   trades using ei
-00018d90: 7468 6572 2074 696d 6520 6f72 2069 6420  ther time or id 
-00018da0: 6261 7365 6420 6d65 7468 6f64 732e 0a20  based methods.. 
-00018db0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00018dc0: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-00018dd0: 2866 225f 6173 796e 635f 6765 745f 7472  (f"_async_get_tr
-00018de0: 6164 655f 6869 7374 6f72 7928 292c 2070  ade_history(), p
-00018df0: 6169 723a 207b 7061 6972 7d2c 2022 0a20  air: {pair}, ". 
-00018e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e10: 2020 2020 6622 7369 6e63 653a 207b 7369      f"since: {si
-00018e20: 6e63 657d 2c20 756e 7469 6c3a 207b 756e  nce}, until: {un
-00018e30: 7469 6c7d 2c20 6672 6f6d 5f69 643a 207b  til}, from_id: {
-00018e40: 6672 6f6d 5f69 647d 2229 0a0a 2020 2020  from_id}")..    
-00018e50: 2020 2020 6966 2075 6e74 696c 2069 7320      if until is 
-00018e60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00018e70: 2020 756e 7469 6c20 3d20 6363 7874 2e45    until = ccxt.E
-00018e80: 7863 6861 6e67 652e 6d69 6c6c 6973 6563  xchange.millisec
-00018e90: 6f6e 6473 2829 0a20 2020 2020 2020 2020  onds().         
-00018ea0: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
-00018eb0: 6622 4578 6368 616e 6765 206d 696c 6c69  f"Exchange milli
-00018ec0: 7365 636f 6e64 733a 207b 756e 7469 6c7d  seconds: {until}
-00018ed0: 2229 0a0a 2020 2020 2020 2020 6966 2073  ")..        if s
-00018ee0: 656c 662e 5f74 7261 6465 735f 7061 6769  elf._trades_pagi
-00018ef0: 6e61 7469 6f6e 203d 3d20 2774 696d 6527  nation == 'time'
-00018f00: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00018f10: 7475 726e 2061 7761 6974 2073 656c 662e  turn await self.
-00018f20: 5f61 7379 6e63 5f67 6574 5f74 7261 6465  _async_get_trade
-00018f30: 5f68 6973 746f 7279 5f74 696d 6528 0a20  _history_time(. 
-00018f40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00018f50: 6169 723d 7061 6972 2c20 7369 6e63 653d  air=pair, since=
-00018f60: 7369 6e63 652c 2075 6e74 696c 3d75 6e74  since, until=unt
-00018f70: 696c 290a 2020 2020 2020 2020 656c 6966  il).        elif
-00018f80: 2073 656c 662e 5f74 7261 6465 735f 7061   self._trades_pa
-00018f90: 6769 6e61 7469 6f6e 203d 3d20 2769 6427  gination == 'id'
-00018fa0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00018fb0: 7475 726e 2061 7761 6974 2073 656c 662e  turn await self.
-00018fc0: 5f61 7379 6e63 5f67 6574 5f74 7261 6465  _async_get_trade
-00018fd0: 5f68 6973 746f 7279 5f69 6428 0a20 2020  _history_id(.   
-00018fe0: 2020 2020 2020 2020 2020 2020 2070 6169               pai
-00018ff0: 723d 7061 6972 2c20 7369 6e63 653d 7369  r=pair, since=si
-00019000: 6e63 652c 2075 6e74 696c 3d75 6e74 696c  nce, until=until
-00019010: 2c20 6672 6f6d 5f69 643d 6672 6f6d 5f69  , from_id=from_i
-00019020: 640a 2020 2020 2020 2020 2020 2020 290a  d.            ).
-00019030: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00019040: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00019050: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00019060: 7469 6f6e 2866 2245 7863 6861 6e67 6520  tion(f"Exchange 
-00019070: 7b73 656c 662e 6e61 6d65 7d20 646f 6573  {self.name} does
-00019080: 2075 7365 206e 6569 7468 6572 2074 696d   use neither tim
-00019090: 652c 2022 0a20 2020 2020 2020 2020 2020  e, ".           
-000190a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190b0: 2020 2020 2020 2020 2020 2020 6622 6e6f              f"no
-000190c0: 7220 6964 2062 6173 6564 2070 6167 696e  r id based pagin
-000190d0: 6174 696f 6e22 290a 0a20 2020 2064 6566  ation")..    def
-000190e0: 2067 6574 5f68 6973 746f 7269 635f 7472   get_historic_tr
-000190f0: 6164 6573 2873 656c 662c 2070 6169 723a  ades(self, pair:
-00019100: 2073 7472 2c0a 2020 2020 2020 2020 2020   str,.          
-00019110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019120: 2020 7369 6e63 653a 204f 7074 696f 6e61    since: Optiona
-00019130: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
-00019140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019150: 2020 2020 2020 2020 2020 2075 6e74 696c             until
-00019160: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
-00019170: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00019180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019190: 2020 2020 6672 6f6d 5f69 643a 204f 7074      from_id: Opt
-000191a0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-000191b0: 6529 202d 3e20 5475 706c 655b 7374 722c  e) -> Tuple[str,
-000191c0: 204c 6973 745d 3a0a 2020 2020 2020 2020   List]:.        
-000191d0: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-000191e0: 7472 6164 6520 6869 7374 6f72 7920 6461  trade history da
-000191f0: 7461 2075 7369 6e67 2061 7379 6e63 696f  ta using asyncio
-00019200: 2e0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
-00019210: 7320 616c 6c20 6173 796e 6320 776f 726b  s all async work
-00019220: 2061 6e64 2072 6574 7572 6e73 2074 6865   and returns the
-00019230: 206c 6973 7420 6f66 2063 616e 646c 6573   list of candles
-00019240: 2e0a 2020 2020 2020 2020 4173 796e 6320  ..        Async 
-00019250: 6f76 6572 206f 6e65 2070 6169 722c 2061  over one pair, a
-00019260: 7373 756d 696e 6720 7765 2067 6574 2060  ssuming we get `
-00019270: 7365 6c66 2e6f 686c 6376 5f63 616e 646c  self.ohlcv_candl
-00019280: 655f 6c69 6d69 7428 2960 2063 616e 646c  e_limit()` candl
-00019290: 6573 2070 6572 2063 616c 6c2e 0a20 2020  es per call..   
-000192a0: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
-000192b0: 3a20 5061 6972 2074 6f20 646f 776e 6c6f  : Pair to downlo
-000192c0: 6164 0a20 2020 2020 2020 203a 7061 7261  ad.        :para
-000192d0: 6d20 7369 6e63 653a 2054 696d 6573 7461  m since: Timesta
-000192e0: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
-000192f0: 6473 2074 6f20 6765 7420 6869 7374 6f72  ds to get histor
-00019300: 7920 6672 6f6d 0a20 2020 2020 2020 203a  y from.        :
-00019310: 7061 7261 6d20 756e 7469 6c3a 2054 696d  param until: Tim
-00019320: 6573 7461 6d70 2069 6e20 6d69 6c6c 6973  estamp in millis
-00019330: 6563 6f6e 6473 2e20 4465 6661 756c 7473  econds. Defaults
-00019340: 2074 6f20 6375 7272 656e 7420 7469 6d65   to current time
-00019350: 7374 616d 7020 6966 206e 6f74 2064 6566  stamp if not def
-00019360: 696e 6564 2e0a 2020 2020 2020 2020 3a70  ined..        :p
-00019370: 6172 616d 2066 726f 6d5f 6964 3a20 446f  aram from_id: Do
-00019380: 776e 6c6f 6164 2064 6174 6120 7374 6172  wnload data star
-00019390: 7469 6e67 2077 6974 6820 4944 2028 6966  ting with ID (if
-000193a0: 2069 6420 6973 206b 6e6f 776e 290a 2020   id is known).  
-000193b0: 2020 2020 2020 3a72 6574 7572 6e73 204c        :returns L
-000193c0: 6973 7420 6f66 2074 7261 6465 2064 6174  ist of trade dat
-000193d0: 610a 2020 2020 2020 2020 2222 220a 2020  a.        """.  
-000193e0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-000193f0: 662e 6578 6368 616e 6765 5f68 6173 2822  f.exchange_has("
-00019400: 6665 7463 6854 7261 6465 7322 293a 0a20  fetchTrades"):. 
-00019410: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00019420: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-00019430: 7074 696f 6e28 2254 6869 7320 6578 6368  ption("This exch
-00019440: 616e 6765 2064 6f65 7320 6e6f 7420 7375  ange does not su
-00019450: 7070 6f72 7420 646f 776e 6c6f 6164 696e  pport downloadin
-00019460: 6720 5472 6164 6573 2e22 290a 0a20 2020  g Trades.")..   
-00019470: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
-00019480: 6c6f 6f70 5f6c 6f63 6b3a 0a20 2020 2020  loop_lock:.     
-00019490: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000194a0: 6c66 2e6c 6f6f 702e 7275 6e5f 756e 7469  lf.loop.run_unti
-000194b0: 6c5f 636f 6d70 6c65 7465 280a 2020 2020  l_complete(.    
-000194c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000194d0: 2e5f 6173 796e 635f 6765 745f 7472 6164  ._async_get_trad
-000194e0: 655f 6869 7374 6f72 7928 7061 6972 3d70  e_history(pair=p
-000194f0: 6169 722c 2073 696e 6365 3d73 696e 6365  air, since=since
-00019500: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019530: 756e 7469 6c3d 756e 7469 6c2c 2066 726f  until=until, fro
-00019540: 6d5f 6964 3d66 726f 6d5f 6964 2929 0a0a  m_id=from_id))..
-00019550: 2020 2020 4072 6574 7269 6572 0a20 2020      @retrier.   
-00019560: 2064 6566 205f 6765 745f 6675 6e64 696e   def _get_fundin
-00019570: 675f 6665 6573 5f66 726f 6d5f 6578 6368  g_fees_from_exch
-00019580: 616e 6765 2873 656c 662c 2070 6169 723a  ange(self, pair:
-00019590: 2073 7472 2c20 7369 6e63 653a 2055 6e69   str, since: Uni
-000195a0: 6f6e 5b64 6174 6574 696d 652c 2069 6e74  on[datetime, int
-000195b0: 5d29 202d 3e20 666c 6f61 743a 0a20 2020  ]) -> float:.   
-000195c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000195d0: 2052 6574 7572 6e73 2074 6865 2073 756d   Returns the sum
-000195e0: 206f 6620 616c 6c20 6675 6e64 696e 6720   of all funding 
-000195f0: 6665 6573 2074 6861 7420 7765 7265 2065  fees that were e
-00019600: 7863 6861 6e67 6564 2066 6f72 2061 2070  xchanged for a p
-00019610: 6169 7220 7769 7468 696e 2061 2074 696d  air within a tim
-00019620: 6566 7261 6d65 0a20 2020 2020 2020 2044  eframe.        D
-00019630: 7279 2d72 756e 2068 616e 646c 696e 6720  ry-run handling 
-00019640: 6861 7070 656e 7320 6173 2070 6172 7420  happens as part 
-00019650: 6f66 205f 6361 6c63 756c 6174 655f 6675  of _calculate_fu
-00019660: 6e64 696e 675f 6665 6573 2e0a 2020 2020  nding_fees..    
-00019670: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-00019680: 2028 652e 672e 2041 4441 2f55 5344 5429   (e.g. ADA/USDT)
-00019690: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000196a0: 7369 6e63 653a 2054 6865 2065 6172 6c69  since: The earli
-000196b0: 6573 7420 7469 6d65 206f 6620 636f 6e73  est time of cons
-000196c0: 6964 6572 6174 696f 6e20 666f 7220 6361  ideration for ca
-000196d0: 6c63 756c 6174 696e 6720 6675 6e64 696e  lculating fundin
-000196e0: 6720 6665 6573 2c0a 2020 2020 2020 2020  g fees,.        
-000196f0: 2020 2020 696e 2075 6e69 7820 7469 6d65      in unix time
-00019700: 206f 7220 6173 2061 2064 6174 6574 696d   or as a datetim
-00019710: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-00019720: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00019730: 662e 6578 6368 616e 6765 5f68 6173 2822  f.exchange_has("
-00019740: 6665 7463 6846 756e 6469 6e67 4869 7374  fetchFundingHist
-00019750: 6f72 7922 293a 0a20 2020 2020 2020 2020  ory"):.         
-00019760: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00019770: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
-00019780: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00019790: 2266 6574 6368 5f66 756e 6469 6e67 5f68  "fetch_funding_h
-000197a0: 6973 746f 7279 2829 2069 7320 6e6f 7420  istory() is not 
-000197b0: 6176 6169 6c61 626c 6520 7573 696e 6720  available using 
-000197c0: 7b73 656c 662e 6e61 6d65 7d22 0a20 2020  {self.name}".   
-000197d0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-000197e0: 2020 2020 6966 2074 7970 6528 7369 6e63      if type(sinc
-000197f0: 6529 2069 7320 6461 7465 7469 6d65 3a0a  e) is datetime:.
-00019800: 2020 2020 2020 2020 2020 2020 7369 6e63              sinc
-00019810: 6520 3d20 696e 7428 7369 6e63 652e 7469  e = int(since.ti
-00019820: 6d65 7374 616d 7028 2929 202a 2031 3030  mestamp()) * 100
-00019830: 3020 2020 2320 2a20 3130 3030 2066 6f72  0   # * 1000 for
-00019840: 206d 730a 0a20 2020 2020 2020 2074 7279   ms..        try
-00019850: 3a0a 2020 2020 2020 2020 2020 2020 6675  :.            fu
-00019860: 6e64 696e 675f 6869 7374 6f72 7920 3d20  nding_history = 
-00019870: 7365 6c66 2e5f 6170 692e 6665 7463 685f  self._api.fetch_
-00019880: 6675 6e64 696e 675f 6869 7374 6f72 7928  funding_history(
-00019890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000198a0: 2073 796d 626f 6c3d 7061 6972 2c0a 2020   symbol=pair,.  
-000198b0: 2020 2020 2020 2020 2020 2020 2020 7369                si
-000198c0: 6e63 653d 7369 6e63 650a 2020 2020 2020  nce=since.      
-000198d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000198e0: 2020 2020 7265 7475 726e 2073 756d 2866      return sum(f
-000198f0: 6565 5b27 616d 6f75 6e74 275d 2066 6f72  ee['amount'] for
-00019900: 2066 6565 2069 6e20 6675 6e64 696e 675f   fee in funding_
-00019910: 6869 7374 6f72 7929 0a20 2020 2020 2020  history).       
-00019920: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
-00019930: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
-00019940: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00019950: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
-00019960: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
-00019970: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
-00019980: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
-00019990: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
-000199a0: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
-000199b0: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
-000199c0: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
-000199d0: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
-000199e0: 756c 6420 6e6f 7420 6765 7420 6675 6e64  uld not get fund
-000199f0: 696e 6720 6665 6573 2064 7565 2074 6f20  ing fees due to 
-00019a00: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-00019a10: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-00019a20: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-00019a30: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-00019a40: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-00019a50: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00019a60: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-00019a70: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-00019a80: 2065 0a0a 2020 2020 4072 6574 7269 6572   e..    @retrier
-00019a90: 0a20 2020 2064 6566 2067 6574 5f6c 6576  .    def get_lev
-00019aa0: 6572 6167 655f 7469 6572 7328 7365 6c66  erage_tiers(self
-00019ab0: 2920 2d3e 2044 6963 745b 7374 722c 204c  ) -> Dict[str, L
-00019ac0: 6973 745b 4469 6374 5d5d 3a0a 2020 2020  ist[Dict]]:.    
-00019ad0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00019ae0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00019af0: 2e5f 6170 692e 6665 7463 685f 6c65 7665  ._api.fetch_leve
-00019b00: 7261 6765 5f74 6965 7273 2829 0a20 2020  rage_tiers().   
-00019b10: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-00019b20: 2e44 446f 5350 726f 7465 6374 696f 6e20  .DDoSProtection 
-00019b30: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00019b40: 2020 7261 6973 6520 4444 6f73 5072 6f74    raise DDosProt
-00019b50: 6563 7469 6f6e 2865 2920 6672 6f6d 2065  ection(e) from e
-00019b60: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00019b70: 2863 6378 742e 4e65 7477 6f72 6b45 7272  (ccxt.NetworkErr
-00019b80: 6f72 2c20 6363 7874 2e45 7863 6861 6e67  or, ccxt.Exchang
-00019b90: 6545 7272 6f72 2920 6173 2065 3a0a 2020  eError) as e:.  
-00019ba0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00019bb0: 5465 6d70 6f72 6172 7945 7272 6f72 280a  TemporaryError(.
-00019bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019bd0: 6627 436f 756c 6420 6e6f 7420 6c6f 6164  f'Could not load
-00019be0: 206c 6576 6572 6167 6520 7469 6572 7320   leverage tiers 
-00019bf0: 6475 6520 746f 207b 652e 5f5f 636c 6173  due to {e.__clas
-00019c00: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d  s__.__name__}. M
-00019c10: 6573 7361 6765 3a20 7b65 7d27 0a20 2020  essage: {e}'.   
-00019c20: 2020 2020 2020 2020 2029 2066 726f 6d20           ) from 
-00019c30: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00019c40: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
-00019c50: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00019c60: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00019c70: 6e61 6c45 7863 6570 7469 6f6e 2865 2920  nalException(e) 
-00019c80: 6672 6f6d 2065 0a0a 2020 2020 4072 6574  from e..    @ret
-00019c90: 7269 6572 5f61 7379 6e63 0a20 2020 2061  rier_async.    a
-00019ca0: 7379 6e63 2064 6566 2067 6574 5f6d 6172  sync def get_mar
-00019cb0: 6b65 745f 6c65 7665 7261 6765 5f74 6965  ket_leverage_tie
-00019cc0: 7273 2873 656c 662c 2073 796d 626f 6c3a  rs(self, symbol:
-00019cd0: 2073 7472 2920 2d3e 2054 7570 6c65 5b73   str) -> Tuple[s
-00019ce0: 7472 2c20 4c69 7374 5b44 6963 745d 5d3a  tr, List[Dict]]:
-00019cf0: 0a20 2020 2020 2020 2022 2222 204c 6576  .        """ Lev
-00019d00: 6572 6167 6520 7469 6572 7320 7065 7220  erage tiers per 
-00019d10: 7379 6d62 6f6c 2022 2222 0a20 2020 2020  symbol """.     
-00019d20: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00019d30: 2020 2020 7469 6572 203d 2061 7761 6974      tier = await
-00019d40: 2073 656c 662e 5f61 7069 5f61 7379 6e63   self._api_async
-00019d50: 2e66 6574 6368 5f6d 6172 6b65 745f 6c65  .fetch_market_le
-00019d60: 7665 7261 6765 5f74 6965 7273 2873 796d  verage_tiers(sym
-00019d70: 626f 6c29 0a20 2020 2020 2020 2020 2020  bol).           
-00019d80: 2072 6574 7572 6e20 7379 6d62 6f6c 2c20   return symbol, 
-00019d90: 7469 6572 0a20 2020 2020 2020 2065 7863  tier.        exc
-00019da0: 6570 7420 6363 7874 2e44 446f 5350 726f  ept ccxt.DDoSPro
-00019db0: 7465 6374 696f 6e20 6173 2065 3a0a 2020  tection as e:.  
-00019dc0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00019dd0: 4444 6f73 5072 6f74 6563 7469 6f6e 2865  DDosProtection(e
-00019de0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-00019df0: 2065 7863 6570 7420 2863 6378 742e 4e65   except (ccxt.Ne
-00019e00: 7477 6f72 6b45 7272 6f72 2c20 6363 7874  tworkError, ccxt
-00019e10: 2e45 7863 6861 6e67 6545 7272 6f72 2920  .ExchangeError) 
-00019e20: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00019e30: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
-00019e40: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
-00019e50: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
-00019e60: 6e6f 7420 6c6f 6164 206c 6576 6572 6167  not load leverag
-00019e70: 6520 7469 6572 7320 666f 7220 7b73 796d  e tiers for {sym
-00019e80: 626f 6c7d 270a 2020 2020 2020 2020 2020  bol}'.          
-00019e90: 2020 2020 2020 6627 2064 7565 2074 6f20        f' due to 
-00019ea0: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-00019eb0: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-00019ec0: 207b 657d 270a 2020 2020 2020 2020 2020   {e}'.          
-00019ed0: 2020 2920 6672 6f6d 2065 0a20 2020 2020    ) from e.     
-00019ee0: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
-00019ef0: 6173 6545 7272 6f72 2061 7320 653a 0a20  aseError as e:. 
-00019f00: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00019f10: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-00019f20: 7074 696f 6e28 6529 2066 726f 6d20 650a  ption(e) from e.
-00019f30: 0a20 2020 2064 6566 206c 6f61 645f 6c65  .    def load_le
-00019f40: 7665 7261 6765 5f74 6965 7273 2873 656c  verage_tiers(sel
-00019f50: 6629 202d 3e20 4469 6374 5b73 7472 2c20  f) -> Dict[str, 
-00019f60: 4c69 7374 5b44 6963 745d 5d3a 0a20 2020  List[Dict]]:.   
-00019f70: 2020 2020 2069 6620 7365 6c66 2e74 7261       if self.tra
-00019f80: 6469 6e67 5f6d 6f64 6520 3d3d 2054 7261  ding_mode == Tra
-00019f90: 6469 6e67 4d6f 6465 2e46 5554 5552 4553  dingMode.FUTURES
-00019fa0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00019fb0: 2073 656c 662e 6578 6368 616e 6765 5f68   self.exchange_h
-00019fc0: 6173 2827 6665 7463 684c 6576 6572 6167  as('fetchLeverag
-00019fd0: 6554 6965 7273 2729 3a0a 2020 2020 2020  eTiers'):.      
-00019fe0: 2020 2020 2020 2020 2020 2320 4665 7463            # Fetc
-00019ff0: 6820 616c 6c20 6c65 7665 7261 6765 2074  h all leverage t
-0001a000: 6965 7273 2061 7420 6f6e 6365 0a20 2020  iers at once.   
-0001a010: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001a020: 7572 6e20 7365 6c66 2e67 6574 5f6c 6576  urn self.get_lev
-0001a030: 6572 6167 655f 7469 6572 7328 290a 2020  erage_tiers().  
-0001a040: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-0001a050: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
-0001a060: 2827 6665 7463 684d 6172 6b65 744c 6576  ('fetchMarketLev
-0001a070: 6572 6167 6554 6965 7273 2729 3a0a 2020  erageTiers'):.  
-0001a080: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001a090: 4d75 7374 2066 6574 6368 2074 6865 206c  Must fetch the l
-0001a0a0: 6576 6572 6167 6520 7469 6572 7320 666f  everage tiers fo
-0001a0b0: 7220 6561 6368 206d 6172 6b65 7420 7365  r each market se
-0001a0c0: 7061 7261 7465 6c79 0a20 2020 2020 2020  parately.       
-0001a0d0: 2020 2020 2020 2020 2023 202a 2054 6869           # * Thi
-0001a0e0: 7320 6973 2073 6c6f 7728 7e34 3573 2920  s is slow(~45s) 
-0001a0f0: 6f6e 204f 6b78 2c20 6d61 6b65 7320 7e39  on Okx, makes ~9
-0001a100: 3020 6170 6920 6361 6c6c 7320 746f 206c  0 api calls to l
-0001a110: 6f61 6420 616c 6c20 6c69 6e65 6172 2073  oad all linear s
-0001a120: 7761 7020 6d61 726b 6574 730a 2020 2020  wap markets.    
-0001a130: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
-0001a140: 6574 7320 3d20 7365 6c66 2e6d 6172 6b65  ets = self.marke
-0001a150: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
-0001a160: 2020 2073 796d 626f 6c73 203d 205b 5d0a     symbols = [].
-0001a170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a180: 2066 6f72 2073 796d 626f 6c2c 206d 6172   for symbol, mar
-0001a190: 6b65 7420 696e 206d 6172 6b65 7473 2e69  ket in markets.i
-0001a1a0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0001a1b0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0001a1c0: 7365 6c66 2e6d 6172 6b65 745f 6973 5f66  self.market_is_f
-0001a1d0: 7574 7572 6528 6d61 726b 6574 290a 2020  uture(market).  
-0001a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1f0: 2020 2020 2020 2020 2020 616e 6420 6d61            and ma
-0001a200: 726b 6574 5b27 7175 6f74 6527 5d20 3d3d  rket['quote'] ==
-0001a210: 2073 656c 662e 5f63 6f6e 6669 675b 2773   self._config['s
-0001a220: 7461 6b65 5f63 7572 7265 6e63 7927 5d29  take_currency'])
-0001a230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a240: 2020 2020 2020 2020 2020 7379 6d62 6f6c            symbol
-0001a250: 732e 6170 7065 6e64 2873 796d 626f 6c29  s.append(symbol)
-0001a260: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a270: 2020 7469 6572 733a 2044 6963 745b 7374    tiers: Dict[st
-0001a280: 722c 204c 6973 745b 4469 6374 5d5d 203d  r, List[Dict]] =
-0001a290: 207b 7d0a 0a20 2020 2020 2020 2020 2020   {}..           
-0001a2a0: 2020 2020 2074 6965 7273 5f63 6163 6865       tiers_cache
-0001a2b0: 6420 3d20 7365 6c66 2e6c 6f61 645f 6361  d = self.load_ca
-0001a2c0: 6368 6564 5f6c 6576 6572 6167 655f 7469  ched_leverage_ti
-0001a2d0: 6572 7328 7365 6c66 2e5f 636f 6e66 6967  ers(self._config
-0001a2e0: 5b27 7374 616b 655f 6375 7272 656e 6379  ['stake_currency
-0001a2f0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-0001a300: 2020 2020 6966 2074 6965 7273 5f63 6163      if tiers_cac
-0001a310: 6865 643a 0a20 2020 2020 2020 2020 2020  hed:.           
-0001a320: 2020 2020 2020 2020 2074 6965 7273 203d           tiers =
-0001a330: 2074 6965 7273 5f63 6163 6865 640a 0a20   tiers_cached.. 
-0001a340: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001a350: 6f72 6f73 203d 205b 0a20 2020 2020 2020  oros = [.       
-0001a360: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001a370: 662e 6765 745f 6d61 726b 6574 5f6c 6576  f.get_market_lev
-0001a380: 6572 6167 655f 7469 6572 7328 7379 6d62  erage_tiers(symb
-0001a390: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
-0001a3a0: 2020 2020 2020 2020 666f 7220 7379 6d62          for symb
-0001a3b0: 6f6c 2069 6e20 736f 7274 6564 2873 796d  ol in sorted(sym
-0001a3c0: 626f 6c73 2920 6966 2073 796d 626f 6c20  bols) if symbol 
-0001a3d0: 6e6f 7420 696e 2074 6965 7273 5d0a 0a20  not in tiers].. 
-0001a3e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a3f0: 2042 6520 7665 7262 6f73 6520 6865 7265   Be verbose here
-0001a400: 2c20 6173 2074 6869 7320 6465 6c61 7973  , as this delays
-0001a410: 2073 7461 7274 7570 2062 7920 7e31 206d   startup by ~1 m
-0001a420: 696e 7574 652e 0a20 2020 2020 2020 2020  inute..         
-0001a430: 2020 2020 2020 2069 6620 636f 726f 733a         if coros:
-0001a440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a450: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-0001a460: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001a470: 2020 2020 2020 2020 2020 6622 496e 6974            f"Init
-0001a480: 6961 6c69 7a69 6e67 206c 6576 6572 6167  ializing leverag
-0001a490: 655f 7469 6572 7320 666f 7220 7b6c 656e  e_tiers for {len
-0001a4a0: 2873 796d 626f 6c73 297d 206d 6172 6b65  (symbols)} marke
-0001a4b0: 7473 2e20 220a 2020 2020 2020 2020 2020  ts. ".          
-0001a4c0: 2020 2020 2020 2020 2020 2020 2020 2254                "T
-0001a4d0: 6869 7320 7769 6c6c 2074 616b 6520 6162  his will take ab
-0001a4e0: 6f75 7420 6120 6d69 6e75 7465 2e22 290a  out a minute.").
-0001a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a500: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001a510: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-0001a520: 2e69 6e66 6f28 2255 7369 6e67 2063 6163  .info("Using cac
-0001a530: 6865 6420 6c65 7665 7261 6765 5f74 6965  hed leverage_tie
-0001a540: 7273 2e22 290a 0a20 2020 2020 2020 2020  rs.")..         
-0001a550: 2020 2020 2020 2061 7379 6e63 2064 6566         async def
-0001a560: 2067 6174 6865 725f 7265 7375 6c74 7328   gather_results(
-0001a570: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001a580: 2020 2020 2020 2072 6574 7572 6e20 6177         return aw
-0001a590: 6169 7420 6173 796e 6369 6f2e 6761 7468  ait asyncio.gath
-0001a5a0: 6572 282a 696e 7075 745f 636f 726f 2c20  er(*input_coro, 
-0001a5b0: 7265 7475 726e 5f65 7863 6570 7469 6f6e  return_exception
-0001a5c0: 733d 5472 7565 290a 0a20 2020 2020 2020  s=True)..       
-0001a5d0: 2020 2020 2020 2020 2066 6f72 2069 6e70           for inp
-0001a5e0: 7574 5f63 6f72 6f20 696e 2063 6875 6e6b  ut_coro in chunk
-0001a5f0: 7328 636f 726f 732c 2031 3030 293a 0a0a  s(coros, 100):..
-0001a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a610: 2020 2020 7769 7468 2073 656c 662e 5f6c      with self._l
-0001a620: 6f6f 705f 6c6f 636b 3a0a 2020 2020 2020  oop_lock:.      
-0001a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a640: 2020 7265 7375 6c74 7320 3d20 7365 6c66    results = self
-0001a650: 2e6c 6f6f 702e 7275 6e5f 756e 7469 6c5f  .loop.run_until_
-0001a660: 636f 6d70 6c65 7465 2867 6174 6865 725f  complete(gather_
-0001a670: 7265 7375 6c74 7328 2929 0a0a 2020 2020  results())..    
-0001a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a690: 666f 7220 7379 6d62 6f6c 2c20 7265 7320  for symbol, res 
-0001a6a0: 696e 2072 6573 756c 7473 3a0a 2020 2020  in results:.    
-0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6c0: 2020 2020 7469 6572 735b 7379 6d62 6f6c      tiers[symbol
-0001a6d0: 5d20 3d20 7265 730a 2020 2020 2020 2020  ] = res.        
-0001a6e0: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
-0001a6f0: 6f72 6f73 2920 3e20 303a 0a20 2020 2020  oros) > 0:.     
-0001a700: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001a710: 656c 662e 6361 6368 655f 6c65 7665 7261  elf.cache_levera
-0001a720: 6765 5f74 6965 7273 2874 6965 7273 2c20  ge_tiers(tiers, 
-0001a730: 7365 6c66 2e5f 636f 6e66 6967 5b27 7374  self._config['st
-0001a740: 616b 655f 6375 7272 656e 6379 275d 290a  ake_currency']).
-0001a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a760: 6c6f 6767 6572 2e69 6e66 6f28 6622 446f  logger.info(f"Do
-0001a770: 6e65 2069 6e69 7469 616c 697a 696e 6720  ne initializing 
-0001a780: 7b6c 656e 2873 796d 626f 6c73 297d 206d  {len(symbols)} m
-0001a790: 6172 6b65 7473 2e22 290a 0a20 2020 2020  arkets.")..     
-0001a7a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001a7b0: 6e20 7469 6572 730a 2020 2020 2020 2020  n tiers.        
-0001a7c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001a7d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001a7e0: 207b 7d0a 2020 2020 2020 2020 656c 7365   {}.        else
-0001a7f0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001a800: 7475 726e 207b 7d0a 0a20 2020 2064 6566  turn {}..    def
-0001a810: 2063 6163 6865 5f6c 6576 6572 6167 655f   cache_leverage_
-0001a820: 7469 6572 7328 7365 6c66 2c20 7469 6572  tiers(self, tier
-0001a830: 733a 2044 6963 745b 7374 722c 204c 6973  s: Dict[str, Lis
-0001a840: 745b 4469 6374 5d5d 2c20 7374 616b 655f  t[Dict]], stake_
-0001a850: 6375 7272 656e 6379 3a20 7374 7229 202d  currency: str) -
-0001a860: 3e20 4e6f 6e65 3a0a 0a20 2020 2020 2020  > None:..       
-0001a870: 2066 696c 656e 616d 6520 3d20 7365 6c66   filename = self
-0001a880: 2e5f 636f 6e66 6967 5b27 6461 7461 6469  ._config['datadi
-0001a890: 7227 5d20 2f20 2266 7574 7572 6573 2220  r'] / "futures" 
-0001a8a0: 2f20 6622 6c65 7665 7261 6765 5f74 6965  / f"leverage_tie
-0001a8b0: 7273 5f7b 7374 616b 655f 6375 7272 656e  rs_{stake_curren
-0001a8c0: 6379 7d2e 6a73 6f6e 220a 2020 2020 2020  cy}.json".      
-0001a8d0: 2020 6966 206e 6f74 2066 696c 656e 616d    if not filenam
-0001a8e0: 652e 7061 7265 6e74 2e69 735f 6469 7228  e.parent.is_dir(
-0001a8f0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-0001a900: 696c 656e 616d 652e 7061 7265 6e74 2e6d  ilename.parent.m
-0001a910: 6b64 6972 2870 6172 656e 7473 3d54 7275  kdir(parents=Tru
-0001a920: 6529 0a20 2020 2020 2020 2064 6174 6120  e).        data 
-0001a930: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-0001a940: 2275 7064 6174 6564 223a 2064 6174 6574  "updated": datet
-0001a950: 696d 652e 6e6f 7728 7469 6d65 7a6f 6e65  ime.now(timezone
-0001a960: 2e75 7463 292c 0a20 2020 2020 2020 2020  .utc),.         
-0001a970: 2020 2022 6461 7461 223a 2074 6965 7273     "data": tiers
-0001a980: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
-0001a990: 2020 2020 6669 6c65 5f64 756d 705f 6a73      file_dump_js
-0001a9a0: 6f6e 2866 696c 656e 616d 652c 2064 6174  on(filename, dat
-0001a9b0: 6129 0a0a 2020 2020 6465 6620 6c6f 6164  a)..    def load
-0001a9c0: 5f63 6163 6865 645f 6c65 7665 7261 6765  _cached_leverage
-0001a9d0: 5f74 6965 7273 2873 656c 662c 2073 7461  _tiers(self, sta
-0001a9e0: 6b65 5f63 7572 7265 6e63 793a 2073 7472  ke_currency: str
-0001a9f0: 2920 2d3e 204f 7074 696f 6e61 6c5b 4469  ) -> Optional[Di
-0001aa00: 6374 5b73 7472 2c20 4c69 7374 5b44 6963  ct[str, List[Dic
-0001aa10: 745d 5d5d 3a0a 2020 2020 2020 2020 6669  t]]]:.        fi
-0001aa20: 6c65 6e61 6d65 203d 2073 656c 662e 5f63  lename = self._c
-0001aa30: 6f6e 6669 675b 2764 6174 6164 6972 275d  onfig['datadir']
-0001aa40: 202f 2022 6675 7475 7265 7322 202f 2066   / "futures" / f
-0001aa50: 226c 6576 6572 6167 655f 7469 6572 735f  "leverage_tiers_
-0001aa60: 7b73 7461 6b65 5f63 7572 7265 6e63 797d  {stake_currency}
-0001aa70: 2e6a 736f 6e22 0a20 2020 2020 2020 2069  .json".        i
-0001aa80: 6620 6669 6c65 6e61 6d65 2e69 735f 6669  f filename.is_fi
-0001aa90: 6c65 2829 3a0a 2020 2020 2020 2020 2020  le():.          
-0001aaa0: 2020 7469 6572 7320 3d20 6669 6c65 5f6c    tiers = file_l
-0001aab0: 6f61 645f 6a73 6f6e 2866 696c 656e 616d  oad_json(filenam
-0001aac0: 6529 0a20 2020 2020 2020 2020 2020 2075  e).            u
-0001aad0: 7064 6174 6564 203d 2074 6965 7273 2e67  pdated = tiers.g
-0001aae0: 6574 2827 7570 6461 7465 6427 290a 2020  et('updated').  
-0001aaf0: 2020 2020 2020 2020 2020 6966 2075 7064            if upd
-0001ab00: 6174 6564 3a0a 2020 2020 2020 2020 2020  ated:.          
-0001ab10: 2020 2020 2020 7570 6461 7465 645f 6474        updated_dt
-0001ab20: 203d 2070 6172 7365 722e 7061 7273 6528   = parser.parse(
-0001ab30: 7570 6461 7465 6429 0a20 2020 2020 2020  updated).       
-0001ab40: 2020 2020 2020 2020 2069 6620 7570 6461           if upda
-0001ab50: 7465 645f 6474 203c 2064 6174 6574 696d  ted_dt < datetim
-0001ab60: 652e 6e6f 7728 7469 6d65 7a6f 6e65 2e75  e.now(timezone.u
-0001ab70: 7463 2920 2d20 7469 6d65 6465 6c74 6128  tc) - timedelta(
-0001ab80: 7765 656b 733d 3429 3a0a 2020 2020 2020  weeks=4):.      
-0001ab90: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001aba0: 6767 6572 2e69 6e66 6f28 2243 6163 6865  gger.info("Cache
-0001abb0: 6420 6c65 7665 7261 6765 2074 6965 7273  d leverage tiers
-0001abc0: 2061 7265 206f 7574 6461 7465 642e 2057   are outdated. W
-0001abd0: 696c 6c20 7570 6461 7465 2e22 290a 2020  ill update.").  
-0001abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abf0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
-0001ac00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001ac10: 2074 6965 7273 5b27 6461 7461 275d 0a20   tiers['data']. 
-0001ac20: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0001ac30: 6e65 0a0a 2020 2020 6465 6620 6669 6c6c  ne..    def fill
-0001ac40: 5f6c 6576 6572 6167 655f 7469 6572 7328  _leverage_tiers(
-0001ac50: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0001ac60: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001ac70: 2020 2041 7373 6967 6e73 2070 726f 7065     Assigns prope
-0001ac80: 7274 7920 5f6c 6576 6572 6167 655f 7469  rty _leverage_ti
-0001ac90: 6572 7320 746f 2061 2064 6963 7469 6f6e  ers to a diction
-0001aca0: 6172 7920 6f66 2069 6e66 6f72 6d61 7469  ary of informati
-0001acb0: 6f6e 2061 626f 7574 2074 6865 206c 6576  on about the lev
-0001acc0: 6572 6167 650a 2020 2020 2020 2020 616c  erage.        al
-0001acd0: 6c6f 7765 6420 6f6e 2065 6163 6820 7061  lowed on each pa
-0001ace0: 6972 0a20 2020 2020 2020 2022 2222 0a20  ir.        """. 
-0001acf0: 2020 2020 2020 206c 6576 6572 6167 655f         leverage_
-0001ad00: 7469 6572 7320 3d20 7365 6c66 2e6c 6f61  tiers = self.loa
-0001ad10: 645f 6c65 7665 7261 6765 5f74 6965 7273  d_leverage_tiers
-0001ad20: 2829 0a20 2020 2020 2020 2066 6f72 2070  ().        for p
-0001ad30: 6169 722c 2074 6965 7273 2069 6e20 6c65  air, tiers in le
-0001ad40: 7665 7261 6765 5f74 6965 7273 2e69 7465  verage_tiers.ite
-0001ad50: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0001ad60: 2020 7061 6972 5f74 6965 7273 203d 205b    pair_tiers = [
-0001ad70: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
-0001ad80: 7220 7469 6572 2069 6e20 7469 6572 733a  r tier in tiers:
-0001ad90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ada0: 2070 6169 725f 7469 6572 732e 6170 7065   pair_tiers.appe
-0001adb0: 6e64 2873 656c 662e 7061 7273 655f 6c65  nd(self.parse_le
-0001adc0: 7665 7261 6765 5f74 6965 7228 7469 6572  verage_tier(tier
-0001add0: 2929 0a20 2020 2020 2020 2020 2020 2073  )).            s
-0001ade0: 656c 662e 5f6c 6576 6572 6167 655f 7469  elf._leverage_ti
-0001adf0: 6572 735b 7061 6972 5d20 3d20 7061 6972  ers[pair] = pair
-0001ae00: 5f74 6965 7273 0a0a 2020 2020 6465 6620  _tiers..    def 
-0001ae10: 7061 7273 655f 6c65 7665 7261 6765 5f74  parse_leverage_t
-0001ae20: 6965 7228 7365 6c66 2c20 7469 6572 2920  ier(self, tier) 
-0001ae30: 2d3e 2044 6963 743a 0a20 2020 2020 2020  -> Dict:.       
-0001ae40: 2069 6e66 6f20 3d20 7469 6572 2e67 6574   info = tier.get
-0001ae50: 2827 696e 666f 272c 207b 7d29 0a20 2020  ('info', {}).   
-0001ae60: 2020 2020 2072 6574 7572 6e20 7b0a 2020       return {.  
-0001ae70: 2020 2020 2020 2020 2020 276d 696e 4e6f            'minNo
-0001ae80: 7469 6f6e 616c 273a 2074 6965 725b 276d  tional': tier['m
-0001ae90: 696e 4e6f 7469 6f6e 616c 275d 2c0a 2020  inNotional'],.  
-0001aea0: 2020 2020 2020 2020 2020 276d 6178 4e6f            'maxNo
-0001aeb0: 7469 6f6e 616c 273a 2074 6965 725b 276d  tional': tier['m
-0001aec0: 6178 4e6f 7469 6f6e 616c 275d 2c0a 2020  axNotional'],.  
-0001aed0: 2020 2020 2020 2020 2020 276d 6169 6e74            'maint
-0001aee0: 656e 616e 6365 4d61 7267 696e 5261 7465  enanceMarginRate
-0001aef0: 273a 2074 6965 725b 276d 6169 6e74 656e  ': tier['mainten
-0001af00: 616e 6365 4d61 7267 696e 5261 7465 275d  anceMarginRate']
-0001af10: 2c0a 2020 2020 2020 2020 2020 2020 276d  ,.            'm
-0001af20: 6178 4c65 7665 7261 6765 273a 2074 6965  axLeverage': tie
-0001af30: 725b 276d 6178 4c65 7665 7261 6765 275d  r['maxLeverage']
-0001af40: 2c0a 2020 2020 2020 2020 2020 2020 276d  ,.            'm
-0001af50: 6169 6e74 416d 7427 3a20 666c 6f61 7428  aintAmt': float(
-0001af60: 696e 666f 5b27 6375 6d27 5d29 2069 6620  info['cum']) if 
-0001af70: 2763 756d 2720 696e 2069 6e66 6f20 656c  'cum' in info el
-0001af80: 7365 204e 6f6e 652c 0a20 2020 2020 2020  se None,.       
-0001af90: 207d 0a0a 2020 2020 6465 6620 6765 745f   }..    def get_
-0001afa0: 6d61 785f 6c65 7665 7261 6765 2873 656c  max_leverage(sel
-0001afb0: 662c 2070 6169 723a 2073 7472 2c20 7374  f, pair: str, st
-0001afc0: 616b 655f 616d 6f75 6e74 3a20 4f70 7469  ake_amount: Opti
-0001afd0: 6f6e 616c 5b66 6c6f 6174 5d29 202d 3e20  onal[float]) -> 
-0001afe0: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
-0001aff0: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
-0001b000: 6e73 2074 6865 206d 6178 696d 756d 206c  ns the maximum l
-0001b010: 6576 6572 6167 6520 7468 6174 2061 2070  everage that a p
-0001b020: 6169 7220 6361 6e20 6265 2074 7261 6465  air can be trade
-0001b030: 6420 6174 0a20 2020 2020 2020 203a 7061  d at.        :pa
-0001b040: 7261 6d20 7061 6972 3a20 5468 6520 6261  ram pair: The ba
-0001b050: 7365 2f71 756f 7465 2063 7572 7265 6e63  se/quote currenc
-0001b060: 7920 7061 6972 2062 6569 6e67 2074 7261  y pair being tra
-0001b070: 6465 640a 2020 2020 2020 2020 3a73 7461  ded.        :sta
-0001b080: 6b65 5f61 6d6f 756e 743a 2054 6865 2074  ke_amount: The t
-0001b090: 6f74 616c 2076 616c 7565 206f 6620 7468  otal value of th
-0001b0a0: 6520 7472 6164 6572 7320 6d61 7267 696e  e traders margin
-0001b0b0: 5f6d 6f64 6520 696e 2071 756f 7465 2063  _mode in quote c
-0001b0c0: 7572 7265 6e63 790a 2020 2020 2020 2020  urrency.        
-0001b0d0: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-0001b0e0: 7365 6c66 2e74 7261 6469 6e67 5f6d 6f64  self.trading_mod
-0001b0f0: 6520 3d3d 2054 7261 6469 6e67 4d6f 6465  e == TradingMode
-0001b100: 2e53 504f 543a 0a20 2020 2020 2020 2020  .SPOT:.         
-0001b110: 2020 2072 6574 7572 6e20 312e 300a 0a20     return 1.0.. 
-0001b120: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-0001b130: 7261 6469 6e67 5f6d 6f64 6520 3d3d 2054  rading_mode == T
-0001b140: 7261 6469 6e67 4d6f 6465 2e46 5554 5552  radingMode.FUTUR
-0001b150: 4553 3a0a 0a20 2020 2020 2020 2020 2020  ES:..           
-0001b160: 2023 2043 6865 636b 7320 616e 6420 6564   # Checks and ed
-0001b170: 6765 2063 6173 6573 0a20 2020 2020 2020  ge cases.       
-0001b180: 2020 2020 2069 6620 7374 616b 655f 616d       if stake_am
-0001b190: 6f75 6e74 2069 7320 4e6f 6e65 3a0a 2020  ount is None:.  
-0001b1a0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0001b1b0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-0001b1c0: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-0001b1d0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-0001b1e0: 7b73 656c 662e 6e61 6d65 7d2e 6765 745f  {self.name}.get_
-0001b1f0: 6d61 785f 6c65 7665 7261 6765 2072 6571  max_leverage req
-0001b200: 7569 7265 7320 6172 6775 6d65 6e74 2073  uires argument s
-0001b210: 7461 6b65 5f61 6d6f 756e 7427 0a20 2020  take_amount'.   
-0001b220: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-0001b230: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0001b240: 6169 7220 6e6f 7420 696e 2073 656c 662e  air not in self.
-0001b250: 5f6c 6576 6572 6167 655f 7469 6572 733a  _leverage_tiers:
-0001b260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b270: 2023 204d 6179 6265 2072 6169 7365 2065   # Maybe raise e
-0001b280: 7863 6570 7469 6f6e 2062 6563 6175 7365  xception because
-0001b290: 2069 7420 6361 6e27 7420 6265 2074 7261   it can't be tra
-0001b2a0: 6465 6420 6f6e 2066 7574 7572 6573 3f0a  ded on futures?.
-0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2c0: 7265 7475 726e 2031 2e30 0a0a 2020 2020  return 1.0..    
-0001b2d0: 2020 2020 2020 2020 7061 6972 5f74 6965          pair_tie
-0001b2e0: 7273 203d 2073 656c 662e 5f6c 6576 6572  rs = self._lever
-0001b2f0: 6167 655f 7469 6572 735b 7061 6972 5d0a  age_tiers[pair].
-0001b300: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001b310: 7374 616b 655f 616d 6f75 6e74 203d 3d20  stake_amount == 
-0001b320: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0001b330: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001b340: 6c65 7665 7261 6765 5f74 6965 7273 5b70  leverage_tiers[p
-0001b350: 6169 725d 5b30 5d5b 276d 6178 4c65 7665  air][0]['maxLeve
-0001b360: 7261 6765 275d 2020 2320 4d61 7820 6c65  rage']  # Max le
-0001b370: 7620 666f 7220 6c6f 7765 7374 2061 6d6f  v for lowest amo
-0001b380: 756e 740a 0a20 2020 2020 2020 2020 2020  unt..           
-0001b390: 2066 6f72 2074 6965 725f 696e 6465 7820   for tier_index 
-0001b3a0: 696e 2072 616e 6765 286c 656e 2870 6169  in range(len(pai
-0001b3b0: 725f 7469 6572 7329 293a 0a0a 2020 2020  r_tiers)):..    
-0001b3c0: 2020 2020 2020 2020 2020 2020 7469 6572              tier
-0001b3d0: 203d 2070 6169 725f 7469 6572 735b 7469   = pair_tiers[ti
-0001b3e0: 6572 5f69 6e64 6578 5d0a 2020 2020 2020  er_index].      
-0001b3f0: 2020 2020 2020 2020 2020 6c65 7620 3d20            lev = 
-0001b400: 7469 6572 5b27 6d61 784c 6576 6572 6167  tier['maxLeverag
-0001b410: 6527 5d0a 0a20 2020 2020 2020 2020 2020  e']..           
-0001b420: 2020 2020 2069 6620 7469 6572 5f69 6e64       if tier_ind
-0001b430: 6578 203c 206c 656e 2870 6169 725f 7469  ex < len(pair_ti
-0001b440: 6572 7329 202d 2031 3a0a 2020 2020 2020  ers) - 1:.      
-0001b450: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0001b460: 7874 5f74 6965 7220 3d20 7061 6972 5f74  xt_tier = pair_t
-0001b470: 6965 7273 5b74 6965 725f 696e 6465 7820  iers[tier_index 
-0001b480: 2b20 315d 0a20 2020 2020 2020 2020 2020  + 1].           
-0001b490: 2020 2020 2020 2020 206e 6578 745f 666c           next_fl
-0001b4a0: 6f6f 7220 3d20 6e65 7874 5f74 6965 725b  oor = next_tier[
-0001b4b0: 276d 696e 4e6f 7469 6f6e 616c 275d 202f  'minNotional'] /
-0001b4c0: 206e 6578 745f 7469 6572 5b27 6d61 784c   next_tier['maxL
-0001b4d0: 6576 6572 6167 6527 5d0a 2020 2020 2020  everage'].      
-0001b4e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b4f0: 206e 6578 745f 666c 6f6f 7220 3e20 7374   next_floor > st
-0001b500: 616b 655f 616d 6f75 6e74 3a20 2023 204e  ake_amount:  # N
-0001b510: 6578 7420 7469 6572 206d 696e 2074 6f6f  ext tier min too
-0001b520: 2068 6967 6820 666f 7220 7374 616b 6520   high for stake 
-0001b530: 616d 6f75 6e74 0a20 2020 2020 2020 2020  amount.         
-0001b540: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001b550: 6574 7572 6e20 6d69 6e28 2874 6965 725b  eturn min((tier[
-0001b560: 276d 6178 4e6f 7469 6f6e 616c 275d 202f  'maxNotional'] /
-0001b570: 2073 7461 6b65 5f61 6d6f 756e 7429 2c20   stake_amount), 
-0001b580: 6c65 7629 0a20 2020 2020 2020 2020 2020  lev).           
-0001b590: 2020 2020 2020 2020 2020 2020 2023 0a20               #. 
-0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5b0: 2020 2020 2020 2023 2057 6974 6820 7468         # With th
-0001b5c0: 6520 7477 6f20 6c65 7665 7261 6765 2074  e two leverage t
-0001b5d0: 6965 7273 2062 656c 6f77 2c0a 2020 2020  iers below,.    
-0001b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5f0: 2020 2020 2320 2d20 6120 7374 616b 6520      # - a stake 
-0001b600: 616d 6f75 6e74 206f 6620 3135 3020 776f  amount of 150 wo
-0001b610: 756c 6420 6d65 616e 2061 206d 6178 206c  uld mean a max l
-0001b620: 6576 6572 6167 6520 6f66 2028 3130 3030  everage of (1000
-0001b630: 3020 2f20 3135 3029 203d 2036 362e 3636  0 / 150) = 66.66
-0001b640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b650: 2020 2020 2020 2020 2023 202d 2073 7461           # - sta
-0001b660: 6b65 7320 6265 6c6f 7720 3133 332e 3333  kes below 133.33
-0001b670: 203d 206d 6178 5f6c 6576 206f 6620 3735   = max_lev of 75
-0001b680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b690: 2020 2020 2020 2020 2023 202d 2073 7461           # - sta
-0001b6a0: 6b65 7320 6265 7477 6565 6e20 3133 332e  kes between 133.
-0001b6b0: 3333 2d32 3030 203d 206d 6178 5f6c 6576  33-200 = max_lev
-0001b6c0: 206f 6620 3130 3030 302f 7374 616b 6520   of 10000/stake 
-0001b6d0: 3d20 3530 2e30 312d 3734 2e39 390a 2020  = 50.01-74.99.  
-0001b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b6f0: 2020 2020 2020 2320 2d20 7374 616b 6573        # - stakes
-0001b700: 2066 726f 6d20 3230 3020 2b20 3130 3030   from 200 + 1000
-0001b710: 203d 206d 6178 5f6c 6576 206f 6620 3530   = max_lev of 50
-0001b720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b730: 2020 2020 2020 2020 2023 0a20 2020 2020           #.     
-0001b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b750: 2020 2023 207b 0a20 2020 2020 2020 2020     # {.         
-0001b760: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001b770: 2020 2020 2022 6d69 6e22 3a20 302c 2020       "min": 0,  
-0001b780: 2020 2020 2320 7374 616b 6520 3d20 302e      # stake = 0.
-0001b790: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-0001b7a0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0001b7b0: 226d 6178 223a 2031 3030 3030 2c20 2023  "max": 10000,  #
-0001b7c0: 206d 6178 5f73 7461 6b65 4037 3520 3d20   max_stake@75 = 
-0001b7d0: 3130 3030 302f 3735 203d 2031 3333 2e33  10000/75 = 133.3
-0001b7e0: 3333 3333 3333 3333 3333 3333 340a 2020  3333333333334.  
-0001b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b800: 2020 2020 2020 2320 2020 2020 226c 6576        #     "lev
-0001b810: 223a 2037 352c 0a20 2020 2020 2020 2020  ": 75,.         
-0001b820: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001b830: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-0001b840: 2020 2020 2020 2020 2020 2020 2320 7b0a              # {.
-0001b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b860: 2020 2020 2020 2020 2320 2020 2020 226d          #     "m
-0001b870: 696e 223a 2031 3030 3030 2c20 2023 2073  in": 10000,  # s
-0001b880: 7461 6b65 203d 2032 3030 2e30 0a20 2020  take = 200.0.   
+00018710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018720: 2070 6172 616d 733d 7b73 656c 662e 5f74   params={self._t
+00018730: 7261 6465 735f 7061 6769 6e61 7469 6f6e  rades_pagination
+00018740: 5f61 7267 3a20 6672 6f6d 5f69 647d 290a  _arg: from_id}).
+00018750: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+00018760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018770: 2020 2320 536b 6970 206c 6173 7420 6964    # Skip last id
+00018780: 2073 696e 6365 2069 7473 2074 6865 206b   since its the k
+00018790: 6579 2066 6f72 2074 6865 206e 6578 7420  ey for the next 
+000187a0: 6361 6c6c 0a20 2020 2020 2020 2020 2020  call.           
+000187b0: 2020 2020 2074 7261 6465 732e 6578 7465       trades.exte
+000187c0: 6e64 2874 5b3a 2d31 5d29 0a20 2020 2020  nd(t[:-1]).     
+000187d0: 2020 2020 2020 2020 2020 2069 6620 6672             if fr
+000187e0: 6f6d 5f69 6420 3d3d 2074 5b2d 315d 5b31  om_id == t[-1][1
+000187f0: 5d20 6f72 2074 5b2d 315d 5b30 5d20 3e20  ] or t[-1][0] > 
+00018800: 756e 7469 6c3a 0a20 2020 2020 2020 2020  until:.         
+00018810: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00018820: 722e 6465 6275 6728 6622 5374 6f70 7069  r.debug(f"Stoppi
+00018830: 6e67 2062 6563 6175 7365 2066 726f 6d5f  ng because from_
+00018840: 6964 2064 6964 206e 6f74 2063 6861 6e67  id did not chang
+00018850: 652e 2022 0a20 2020 2020 2020 2020 2020  e. ".           
+00018860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018870: 2020 2020 2020 6622 5265 6163 6865 6420        f"Reached 
+00018880: 7b74 5b2d 315d 5b30 5d7d 203e 207b 756e  {t[-1][0]} > {un
+00018890: 7469 6c7d 2229 0a20 2020 2020 2020 2020  til}").         
+000188a0: 2020 2020 2020 2020 2020 2023 2052 6561             # Rea
+000188b0: 6368 6564 2074 6865 2065 6e64 206f 6620  ched the end of 
+000188c0: 7468 6520 6465 6669 6e65 642d 646f 776e  the defined-down
+000188d0: 6c6f 6164 2070 6572 696f 6420 2d20 6164  load period - ad
+000188e0: 6420 6c61 7374 2074 7261 6465 2061 7320  d last trade as 
+000188f0: 7765 6c6c 2e0a 2020 2020 2020 2020 2020  well..          
+00018900: 2020 2020 2020 2020 2020 7472 6164 6573            trades
+00018910: 2e65 7874 656e 6428 745b 2d31 3a5d 290a  .extend(t[-1:]).
+00018920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018930: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
+00018940: 2020 2020 2020 2020 2020 2066 726f 6d5f             from_
+00018950: 6964 203d 2074 5b2d 315d 5b31 5d0a 2020  id = t[-1][1].  
+00018960: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018980: 6272 6561 6b0a 0a20 2020 2020 2020 2072  break..        r
+00018990: 6574 7572 6e20 2870 6169 722c 2074 7261  eturn (pair, tra
+000189a0: 6465 7329 0a0a 2020 2020 6173 796e 6320  des)..    async 
+000189b0: 6465 6620 5f61 7379 6e63 5f67 6574 5f74  def _async_get_t
+000189c0: 7261 6465 5f68 6973 746f 7279 5f74 696d  rade_history_tim
+000189d0: 6528 7365 6c66 2c20 7061 6972 3a20 7374  e(self, pair: st
+000189e0: 722c 2075 6e74 696c 3a20 696e 742c 0a20  r, until: int,. 
+000189f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a10: 2020 2020 2020 2020 2020 2073 696e 6365             since
+00018a20: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+00018a30: 3d20 4e6f 6e65 2920 2d3e 2054 7570 6c65  = None) -> Tuple
+00018a40: 5b73 7472 2c20 4c69 7374 5b4c 6973 745d  [str, List[List]
+00018a50: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+00018a60: 2020 2020 2020 2041 7379 6e63 726f 6e6f         Asyncrono
+00018a70: 7573 6c79 2067 6574 7320 7472 6164 6520  usly gets trade 
+00018a80: 6869 7374 6f72 7920 7573 696e 6720 6665  history using fe
+00018a90: 7463 685f 7472 6164 6573 2c0a 2020 2020  tch_trades,.    
+00018aa0: 2020 2020 7768 656e 2074 6865 2065 7863      when the exc
+00018ab0: 6861 6e67 6520 7573 6573 2074 696d 652d  hange uses time-
+00018ac0: 6261 7365 6420 6974 6572 6174 696f 6e20  based iteration 
+00018ad0: 2863 6865 636b 2060 7365 6c66 2e5f 7472  (check `self._tr
+00018ae0: 6164 6573 5f70 6167 696e 6174 696f 6e60  ades_pagination`
+00018af0: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+00018b00: 2070 6169 723a 2050 6169 7220 746f 2066   pair: Pair to f
+00018b10: 6574 6368 2074 7261 6465 2064 6174 6120  etch trade data 
+00018b20: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
+00018b30: 616d 2073 696e 6365 3a20 5369 6e63 6520  am since: Since 
+00018b40: 6173 2069 6e74 6567 6572 2074 696d 6573  as integer times
+00018b50: 7461 6d70 2069 6e20 6d69 6c6c 6973 6563  tamp in millisec
+00018b60: 6f6e 6473 0a20 2020 2020 2020 203a 7061  onds.        :pa
+00018b70: 7261 6d20 756e 7469 6c3a 2055 6e74 696c  ram until: Until
+00018b80: 2061 7320 696e 7465 6765 7220 7469 6d65   as integer time
+00018b90: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
+00018ba0: 636f 6e64 730a 2020 2020 2020 2020 7265  conds.        re
+00018bb0: 7475 726e 7320 7475 706c 653a 2028 7061  turns tuple: (pa
+00018bc0: 6972 2c20 7472 6164 6573 2d6c 6973 7429  ir, trades-list)
+00018bd0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00018be0: 2020 2020 2020 7472 6164 6573 3a20 4c69        trades: Li
+00018bf0: 7374 5b4c 6973 745d 203d 205b 5d0a 2020  st[List] = [].  
+00018c00: 2020 2020 2020 2320 4445 4641 554c 545f        # DEFAULT_
+00018c10: 5452 4144 4553 5f43 4f4c 554d 4e53 3a20  TRADES_COLUMNS: 
+00018c20: 3020 2d3e 2074 696d 6573 7461 6d70 0a20  0 -> timestamp. 
+00018c30: 2020 2020 2020 2023 2044 4546 4155 4c54         # DEFAULT
+00018c40: 5f54 5241 4445 535f 434f 4c55 4d4e 533a  _TRADES_COLUMNS:
+00018c50: 2031 202d 3e20 6964 0a20 2020 2020 2020   1 -> id.       
+00018c60: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
+00018c70: 2020 2020 2020 2020 2074 203d 2061 7761           t = awa
+00018c80: 6974 2073 656c 662e 5f61 7379 6e63 5f66  it self._async_f
+00018c90: 6574 6368 5f74 7261 6465 7328 7061 6972  etch_trades(pair
+00018ca0: 2c20 7369 6e63 653d 7369 6e63 6529 0a20  , since=since). 
+00018cb0: 2020 2020 2020 2020 2020 2069 6620 743a             if t:
+00018cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018cd0: 2073 696e 6365 203d 2074 5b2d 315d 5b30   since = t[-1][0
+00018ce0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00018cf0: 2020 7472 6164 6573 2e65 7874 656e 6428    trades.extend(
+00018d00: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00018d10: 2020 2023 2052 6561 6368 6564 2074 6865     # Reached the
+00018d20: 2065 6e64 206f 6620 7468 6520 6465 6669   end of the defi
+00018d30: 6e65 642d 646f 776e 6c6f 6164 2070 6572  ned-download per
+00018d40: 696f 640a 2020 2020 2020 2020 2020 2020  iod.            
+00018d50: 2020 2020 6966 2075 6e74 696c 2061 6e64      if until and
+00018d60: 2074 5b2d 315d 5b30 5d20 3e20 756e 7469   t[-1][0] > unti
+00018d70: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
+00018d80: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+00018d90: 6275 6728 0a20 2020 2020 2020 2020 2020  bug(.           
+00018da0: 2020 2020 2020 2020 2020 2020 2066 2253               f"S
+00018db0: 746f 7070 696e 6720 6265 6361 7573 6520  topping because 
+00018dc0: 756e 7469 6c20 7761 7320 7265 6163 6865  until was reache
+00018dd0: 642e 207b 745b 2d31 5d5b 305d 7d20 3e20  d. {t[-1][0]} > 
+00018de0: 7b75 6e74 696c 7d22 290a 2020 2020 2020  {until}").      
+00018df0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00018e00: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+00018e10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018e20: 2020 2020 2020 6272 6561 6b0a 0a20 2020        break..   
+00018e30: 2020 2020 2072 6574 7572 6e20 2870 6169       return (pai
+00018e40: 722c 2074 7261 6465 7329 0a0a 2020 2020  r, trades)..    
+00018e50: 6173 796e 6320 6465 6620 5f61 7379 6e63  async def _async
+00018e60: 5f67 6574 5f74 7261 6465 5f68 6973 746f  _get_trade_histo
+00018e70: 7279 2873 656c 662c 2070 6169 723a 2073  ry(self, pair: s
+00018e80: 7472 2c0a 2020 2020 2020 2020 2020 2020  tr,.            
+00018e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ea0: 2020 2020 2020 2020 2020 2073 696e 6365             since
+00018eb0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+00018ec0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00018ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ee0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00018ef0: 6e74 696c 3a20 4f70 7469 6f6e 616c 5b69  ntil: Optional[i
+00018f00: 6e74 5d20 3d20 4e6f 6e65 2c0a 2020 2020  nt] = None,.    
+00018f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f30: 2020 2066 726f 6d5f 6964 3a20 4f70 7469     from_id: Opti
+00018f40: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+00018f50: 2920 2d3e 2054 7570 6c65 5b73 7472 2c20  ) -> Tuple[str, 
+00018f60: 4c69 7374 5b4c 6973 745d 5d3a 0a20 2020  List[List]]:.   
+00018f70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00018f80: 2041 7379 6e63 2077 7261 7070 6572 2068   Async wrapper h
+00018f90: 616e 646c 696e 6720 646f 776e 6c6f 6164  andling download
+00018fa0: 696e 6720 7472 6164 6573 2075 7369 6e67  ing trades using
+00018fb0: 2065 6974 6865 7220 7469 6d65 206f 7220   either time or 
+00018fc0: 6964 2062 6173 6564 206d 6574 686f 6473  id based methods
+00018fd0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00018fe0: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+00018ff0: 6275 6728 6622 5f61 7379 6e63 5f67 6574  bug(f"_async_get
+00019000: 5f74 7261 6465 5f68 6973 746f 7279 2829  _trade_history()
+00019010: 2c20 7061 6972 3a20 7b70 6169 727d 2c20  , pair: {pair}, 
+00019020: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00019030: 2020 2020 2020 2066 2273 696e 6365 3a20         f"since: 
+00019040: 7b73 696e 6365 7d2c 2075 6e74 696c 3a20  {since}, until: 
+00019050: 7b75 6e74 696c 7d2c 2066 726f 6d5f 6964  {until}, from_id
+00019060: 3a20 7b66 726f 6d5f 6964 7d22 290a 0a20  : {from_id}").. 
+00019070: 2020 2020 2020 2069 6620 756e 7469 6c20         if until 
+00019080: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00019090: 2020 2020 2075 6e74 696c 203d 2063 6378       until = ccx
+000190a0: 742e 4578 6368 616e 6765 2e6d 696c 6c69  t.Exchange.milli
+000190b0: 7365 636f 6e64 7328 290a 2020 2020 2020  seconds().      
+000190c0: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
+000190d0: 7567 2866 2245 7863 6861 6e67 6520 6d69  ug(f"Exchange mi
+000190e0: 6c6c 6973 6563 6f6e 6473 3a20 7b75 6e74  lliseconds: {unt
+000190f0: 696c 7d22 290a 0a20 2020 2020 2020 2069  il}")..        i
+00019100: 6620 7365 6c66 2e5f 7472 6164 6573 5f70  f self._trades_p
+00019110: 6167 696e 6174 696f 6e20 3d3d 2027 7469  agination == 'ti
+00019120: 6d65 273a 0a20 2020 2020 2020 2020 2020  me':.           
+00019130: 2072 6574 7572 6e20 6177 6169 7420 7365   return await se
+00019140: 6c66 2e5f 6173 796e 635f 6765 745f 7472  lf._async_get_tr
+00019150: 6164 655f 6869 7374 6f72 795f 7469 6d65  ade_history_time
+00019160: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00019170: 2020 7061 6972 3d70 6169 722c 2073 696e    pair=pair, sin
+00019180: 6365 3d73 696e 6365 2c20 756e 7469 6c3d  ce=since, until=
+00019190: 756e 7469 6c29 0a20 2020 2020 2020 2065  until).        e
+000191a0: 6c69 6620 7365 6c66 2e5f 7472 6164 6573  lif self._trades
+000191b0: 5f70 6167 696e 6174 696f 6e20 3d3d 2027  _pagination == '
+000191c0: 6964 273a 0a20 2020 2020 2020 2020 2020  id':.           
+000191d0: 2072 6574 7572 6e20 6177 6169 7420 7365   return await se
+000191e0: 6c66 2e5f 6173 796e 635f 6765 745f 7472  lf._async_get_tr
+000191f0: 6164 655f 6869 7374 6f72 795f 6964 280a  ade_history_id(.
+00019200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019210: 7061 6972 3d70 6169 722c 2073 696e 6365  pair=pair, since
+00019220: 3d73 696e 6365 2c20 756e 7469 6c3d 756e  =since, until=un
+00019230: 7469 6c2c 2066 726f 6d5f 6964 3d66 726f  til, from_id=fro
+00019240: 6d5f 6964 0a20 2020 2020 2020 2020 2020  m_id.           
+00019250: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+00019260: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00019270: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+00019280: 6365 7074 696f 6e28 6622 4578 6368 616e  ception(f"Exchan
+00019290: 6765 207b 7365 6c66 2e6e 616d 657d 2064  ge {self.name} d
+000192a0: 6f65 7320 7573 6520 6e65 6974 6865 7220  oes use neither 
+000192b0: 7469 6d65 2c20 220a 2020 2020 2020 2020  time, ".        
+000192c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000192e0: 226e 6f72 2069 6420 6261 7365 6420 7061  "nor id based pa
+000192f0: 6769 6e61 7469 6f6e 2229 0a0a 2020 2020  gination")..    
+00019300: 6465 6620 6765 745f 6869 7374 6f72 6963  def get_historic
+00019310: 5f74 7261 6465 7328 7365 6c66 2c20 7061  _trades(self, pa
+00019320: 6972 3a20 7374 722c 0a20 2020 2020 2020  ir: str,.       
+00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019340: 2020 2020 2073 696e 6365 3a20 4f70 7469       since: Opti
+00019350: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
+00019360: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019370: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00019380: 7469 6c3a 204f 7074 696f 6e61 6c5b 696e  til: Optional[in
+00019390: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
+000193a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193b0: 2020 2020 2020 2066 726f 6d5f 6964 3a20         from_id: 
+000193c0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+000193d0: 4e6f 6e65 2920 2d3e 2054 7570 6c65 5b73  None) -> Tuple[s
+000193e0: 7472 2c20 4c69 7374 5d3a 0a20 2020 2020  tr, List]:.     
+000193f0: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
+00019400: 6574 2074 7261 6465 2068 6973 746f 7279  et trade history
+00019410: 2064 6174 6120 7573 696e 6720 6173 796e   data using asyn
+00019420: 6369 6f2e 0a20 2020 2020 2020 2048 616e  cio..        Han
+00019430: 646c 6573 2061 6c6c 2061 7379 6e63 2077  dles all async w
+00019440: 6f72 6b20 616e 6420 7265 7475 726e 7320  ork and returns 
+00019450: 7468 6520 6c69 7374 206f 6620 6361 6e64  the list of cand
+00019460: 6c65 732e 0a20 2020 2020 2020 2041 7379  les..        Asy
+00019470: 6e63 206f 7665 7220 6f6e 6520 7061 6972  nc over one pair
+00019480: 2c20 6173 7375 6d69 6e67 2077 6520 6765  , assuming we ge
+00019490: 7420 6073 656c 662e 6f68 6c63 765f 6361  t `self.ohlcv_ca
+000194a0: 6e64 6c65 5f6c 696d 6974 2829 6020 6361  ndle_limit()` ca
+000194b0: 6e64 6c65 7320 7065 7220 6361 6c6c 2e0a  ndles per call..
+000194c0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+000194d0: 6169 723a 2050 6169 7220 746f 2064 6f77  air: Pair to dow
+000194e0: 6e6c 6f61 640a 2020 2020 2020 2020 3a70  nload.        :p
+000194f0: 6172 616d 2073 696e 6365 3a20 5469 6d65  aram since: Time
+00019500: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
+00019510: 636f 6e64 7320 746f 2067 6574 2068 6973  conds to get his
+00019520: 746f 7279 2066 726f 6d0a 2020 2020 2020  tory from.      
+00019530: 2020 3a70 6172 616d 2075 6e74 696c 3a20    :param until: 
+00019540: 5469 6d65 7374 616d 7020 696e 206d 696c  Timestamp in mil
+00019550: 6c69 7365 636f 6e64 732e 2044 6566 6175  liseconds. Defau
+00019560: 6c74 7320 746f 2063 7572 7265 6e74 2074  lts to current t
+00019570: 696d 6573 7461 6d70 2069 6620 6e6f 7420  imestamp if not 
+00019580: 6465 6669 6e65 642e 0a20 2020 2020 2020  defined..       
+00019590: 203a 7061 7261 6d20 6672 6f6d 5f69 643a   :param from_id:
+000195a0: 2044 6f77 6e6c 6f61 6420 6461 7461 2073   Download data s
+000195b0: 7461 7274 696e 6720 7769 7468 2049 4420  tarting with ID 
+000195c0: 2869 6620 6964 2069 7320 6b6e 6f77 6e29  (if id is known)
+000195d0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+000195e0: 7320 4c69 7374 206f 6620 7472 6164 6520  s List of trade 
+000195f0: 6461 7461 0a20 2020 2020 2020 2022 2222  data.        """
+00019600: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00019610: 7365 6c66 2e65 7863 6861 6e67 655f 6861  self.exchange_ha
+00019620: 7328 2266 6574 6368 5472 6164 6573 2229  s("fetchTrades")
+00019630: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00019640: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+00019650: 7863 6570 7469 6f6e 2822 5468 6973 2065  xception("This e
+00019660: 7863 6861 6e67 6520 646f 6573 206e 6f74  xchange does not
+00019670: 2073 7570 706f 7274 2064 6f77 6e6c 6f61   support downloa
+00019680: 6469 6e67 2054 7261 6465 732e 2229 0a0a  ding Trades.")..
+00019690: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+000196a0: 662e 5f6c 6f6f 705f 6c6f 636b 3a0a 2020  f._loop_lock:.  
+000196b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000196c0: 2073 656c 662e 6c6f 6f70 2e72 756e 5f75   self.loop.run_u
+000196d0: 6e74 696c 5f63 6f6d 706c 6574 6528 0a20  ntil_complete(. 
+000196e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000196f0: 656c 662e 5f61 7379 6e63 5f67 6574 5f74  elf._async_get_t
+00019700: 7261 6465 5f68 6973 746f 7279 2870 6169  rade_history(pai
+00019710: 723d 7061 6972 2c20 7369 6e63 653d 7369  r=pair, since=si
+00019720: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
+00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019750: 2020 2075 6e74 696c 3d75 6e74 696c 2c20     until=until, 
+00019760: 6672 6f6d 5f69 643d 6672 6f6d 5f69 6429  from_id=from_id)
+00019770: 290a 0a20 2020 2040 7265 7472 6965 720a  )..    @retrier.
+00019780: 2020 2020 6465 6620 5f67 6574 5f66 756e      def _get_fun
+00019790: 6469 6e67 5f66 6565 735f 6672 6f6d 5f65  ding_fees_from_e
+000197a0: 7863 6861 6e67 6528 7365 6c66 2c20 7061  xchange(self, pa
+000197b0: 6972 3a20 7374 722c 2073 696e 6365 3a20  ir: str, since: 
+000197c0: 556e 696f 6e5b 6461 7465 7469 6d65 2c20  Union[datetime, 
+000197d0: 696e 745d 2920 2d3e 2066 6c6f 6174 3a0a  int]) -> float:.
+000197e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000197f0: 2020 2020 5265 7475 726e 7320 7468 6520      Returns the 
+00019800: 7375 6d20 6f66 2061 6c6c 2066 756e 6469  sum of all fundi
+00019810: 6e67 2066 6565 7320 7468 6174 2077 6572  ng fees that wer
+00019820: 6520 6578 6368 616e 6765 6420 666f 7220  e exchanged for 
+00019830: 6120 7061 6972 2077 6974 6869 6e20 6120  a pair within a 
+00019840: 7469 6d65 6672 616d 650a 2020 2020 2020  timeframe.      
+00019850: 2020 4472 792d 7275 6e20 6861 6e64 6c69    Dry-run handli
+00019860: 6e67 2068 6170 7065 6e73 2061 7320 7061  ng happens as pa
+00019870: 7274 206f 6620 5f63 616c 6375 6c61 7465  rt of _calculate
+00019880: 5f66 756e 6469 6e67 5f66 6565 732e 0a20  _funding_fees.. 
+00019890: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+000198a0: 6972 3a20 2865 2e67 2e20 4144 412f 5553  ir: (e.g. ADA/US
+000198b0: 4454 290a 2020 2020 2020 2020 3a70 6172  DT).        :par
+000198c0: 616d 2073 696e 6365 3a20 5468 6520 6561  am since: The ea
+000198d0: 726c 6965 7374 2074 696d 6520 6f66 2063  rliest time of c
+000198e0: 6f6e 7369 6465 7261 7469 6f6e 2066 6f72  onsideration for
+000198f0: 2063 616c 6375 6c61 7469 6e67 2066 756e   calculating fun
+00019900: 6469 6e67 2066 6565 732c 0a20 2020 2020  ding fees,.     
+00019910: 2020 2020 2020 2069 6e20 756e 6978 2074         in unix t
+00019920: 696d 6520 6f72 2061 7320 6120 6461 7465  ime or as a date
+00019930: 7469 6d65 0a20 2020 2020 2020 2022 2222  time.        """
+00019940: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00019950: 7365 6c66 2e65 7863 6861 6e67 655f 6861  self.exchange_ha
+00019960: 7328 2266 6574 6368 4675 6e64 696e 6748  s("fetchFundingH
+00019970: 6973 746f 7279 2229 3a0a 2020 2020 2020  istory"):.      
+00019980: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+00019990: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+000199a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000199b0: 2020 6622 6665 7463 685f 6675 6e64 696e    f"fetch_fundin
+000199c0: 675f 6869 7374 6f72 7928 2920 6973 206e  g_history() is n
+000199d0: 6f74 2061 7661 696c 6162 6c65 2075 7369  ot available usi
+000199e0: 6e67 207b 7365 6c66 2e6e 616d 657d 220a  ng {self.name}".
+000199f0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00019a00: 2020 2020 2020 2069 6620 7479 7065 2873         if type(s
+00019a10: 696e 6365 2920 6973 2064 6174 6574 696d  ince) is datetim
+00019a20: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00019a30: 696e 6365 203d 2069 6e74 2873 696e 6365  ince = int(since
+00019a40: 2e74 696d 6573 7461 6d70 2829 2920 2a20  .timestamp()) * 
+00019a50: 3130 3030 2020 2023 202a 2031 3030 3020  1000   # * 1000 
+00019a60: 666f 7220 6d73 0a0a 2020 2020 2020 2020  for ms..        
+00019a70: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00019a80: 2066 756e 6469 6e67 5f68 6973 746f 7279   funding_history
+00019a90: 203d 2073 656c 662e 5f61 7069 2e66 6574   = self._api.fet
+00019aa0: 6368 5f66 756e 6469 6e67 5f68 6973 746f  ch_funding_histo
+00019ab0: 7279 280a 2020 2020 2020 2020 2020 2020  ry(.            
+00019ac0: 2020 2020 7379 6d62 6f6c 3d70 6169 722c      symbol=pair,
+00019ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019ae0: 2073 696e 6365 3d73 696e 6365 0a20 2020   since=since.   
+00019af0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00019b00: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
+00019b10: 6d28 6665 655b 2761 6d6f 756e 7427 5d20  m(fee['amount'] 
+00019b20: 666f 7220 6665 6520 696e 2066 756e 6469  for fee in fundi
+00019b30: 6e67 5f68 6973 746f 7279 290a 2020 2020  ng_history).    
+00019b40: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+00019b50: 4444 6f53 5072 6f74 6563 7469 6f6e 2061  DDoSProtection a
+00019b60: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00019b70: 2072 6169 7365 2044 446f 7350 726f 7465   raise DDosProte
+00019b80: 6374 696f 6e28 6529 2066 726f 6d20 650a  ction(e) from e.
+00019b90: 2020 2020 2020 2020 6578 6365 7074 2028          except (
+00019ba0: 6363 7874 2e4e 6574 776f 726b 4572 726f  ccxt.NetworkErro
+00019bb0: 722c 2063 6378 742e 4578 6368 616e 6765  r, ccxt.Exchange
+00019bc0: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
+00019bd0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+00019be0: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
+00019bf0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00019c00: 2743 6f75 6c64 206e 6f74 2067 6574 2066  'Could not get f
+00019c10: 756e 6469 6e67 2066 6565 7320 6475 6520  unding fees due 
+00019c20: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
+00019c30: 5f5f 6e61 6d65 5f5f 7d2e 204d 6573 7361  __name__}. Messa
+00019c40: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+00019c50: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00019c60: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
+00019c70: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00019c80: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00019c90: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
+00019ca0: 726f 6d20 650a 0a20 2020 2040 7265 7472  rom e..    @retr
+00019cb0: 6965 720a 2020 2020 6465 6620 6765 745f  ier.    def get_
+00019cc0: 6c65 7665 7261 6765 5f74 6965 7273 2873  leverage_tiers(s
+00019cd0: 656c 6629 202d 3e20 4469 6374 5b73 7472  elf) -> Dict[str
+00019ce0: 2c20 4c69 7374 5b44 6963 745d 5d3a 0a20  , List[Dict]]:. 
+00019cf0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00019d00: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00019d10: 656c 662e 5f61 7069 2e66 6574 6368 5f6c  elf._api.fetch_l
+00019d20: 6576 6572 6167 655f 7469 6572 7328 290a  everage_tiers().
+00019d30: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+00019d40: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
+00019d50: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00019d60: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
+00019d70: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
+00019d80: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+00019d90: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
+00019da0: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
+00019db0: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
+00019dc0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00019dd0: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
+00019de0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00019df0: 2020 2066 2743 6f75 6c64 206e 6f74 206c     f'Could not l
+00019e00: 6f61 6420 6c65 7665 7261 6765 2074 6965  oad leverage tie
+00019e10: 7273 2064 7565 2074 6f20 7b65 2e5f 5f63  rs due to {e.__c
+00019e20: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00019e30: 2e20 4d65 7373 6167 653a 207b 657d 270a  . Message: {e}'.
+00019e40: 2020 2020 2020 2020 2020 2020 2920 6672              ) fr
+00019e50: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+00019e60: 6570 7420 6363 7874 2e42 6173 6545 7272  ept ccxt.BaseErr
+00019e70: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+00019e80: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+00019e90: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+00019ea0: 6529 2066 726f 6d20 650a 0a20 2020 2040  e) from e..    @
+00019eb0: 7265 7472 6965 725f 6173 796e 630a 2020  retrier_async.  
+00019ec0: 2020 6173 796e 6320 6465 6620 6765 745f    async def get_
+00019ed0: 6d61 726b 6574 5f6c 6576 6572 6167 655f  market_leverage_
+00019ee0: 7469 6572 7328 7365 6c66 2c20 7379 6d62  tiers(self, symb
+00019ef0: 6f6c 3a20 7374 7229 202d 3e20 5475 706c  ol: str) -> Tupl
+00019f00: 655b 7374 722c 204c 6973 745b 4469 6374  e[str, List[Dict
+00019f10: 5d5d 3a0a 2020 2020 2020 2020 2222 2220  ]]:.        """ 
+00019f20: 4c65 7665 7261 6765 2074 6965 7273 2070  Leverage tiers p
+00019f30: 6572 2073 796d 626f 6c20 2222 220a 2020  er symbol """.  
+00019f40: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00019f50: 2020 2020 2020 2074 6965 7220 3d20 6177         tier = aw
+00019f60: 6169 7420 7365 6c66 2e5f 6170 695f 6173  ait self._api_as
+00019f70: 796e 632e 6665 7463 685f 6d61 726b 6574  ync.fetch_market
+00019f80: 5f6c 6576 6572 6167 655f 7469 6572 7328  _leverage_tiers(
+00019f90: 7379 6d62 6f6c 290a 2020 2020 2020 2020  symbol).        
+00019fa0: 2020 2020 7265 7475 726e 2073 796d 626f      return symbo
+00019fb0: 6c2c 2074 6965 720a 2020 2020 2020 2020  l, tier.        
+00019fc0: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+00019fd0: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+00019fe0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00019ff0: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+0001a000: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+0001a010: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+0001a020: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
+0001a030: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
+0001a040: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
+0001a050: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
+0001a060: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
+0001a070: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+0001a080: 6c64 206e 6f74 206c 6f61 6420 6c65 7665  ld not load leve
+0001a090: 7261 6765 2074 6965 7273 2066 6f72 207b  rage tiers for {
+0001a0a0: 7379 6d62 6f6c 7d27 0a20 2020 2020 2020  symbol}'.       
+0001a0b0: 2020 2020 2020 2020 2066 2720 6475 6520           f' due 
+0001a0c0: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
+0001a0d0: 5f5f 6e61 6d65 5f5f 7d2e 204d 6573 7361  __name__}. Messa
+0001a0e0: 6765 3a20 7b65 7d27 0a20 2020 2020 2020  ge: {e}'.       
+0001a0f0: 2020 2020 2029 2066 726f 6d20 650a 2020       ) from e.  
+0001a100: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0001a110: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
+0001a120: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001a130: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0001a140: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
+0001a150: 2065 0a0a 2020 2020 6465 6620 6c6f 6164   e..    def load
+0001a160: 5f6c 6576 6572 6167 655f 7469 6572 7328  _leverage_tiers(
+0001a170: 7365 6c66 2920 2d3e 2044 6963 745b 7374  self) -> Dict[st
+0001a180: 722c 204c 6973 745b 4469 6374 5d5d 3a0a  r, List[Dict]]:.
+0001a190: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001a1a0: 7472 6164 696e 675f 6d6f 6465 203d 3d20  trading_mode == 
+0001a1b0: 5472 6164 696e 674d 6f64 652e 4655 5455  TradingMode.FUTU
+0001a1c0: 5245 533a 0a20 2020 2020 2020 2020 2020  RES:.           
+0001a1d0: 2069 6620 7365 6c66 2e65 7863 6861 6e67   if self.exchang
+0001a1e0: 655f 6861 7328 2766 6574 6368 4c65 7665  e_has('fetchLeve
+0001a1f0: 7261 6765 5469 6572 7327 293a 0a20 2020  rageTiers'):.   
+0001a200: 2020 2020 2020 2020 2020 2020 2023 2046               # F
+0001a210: 6574 6368 2061 6c6c 206c 6576 6572 6167  etch all leverag
+0001a220: 6520 7469 6572 7320 6174 206f 6e63 650a  e tiers at once.
+0001a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a240: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
+0001a250: 6c65 7665 7261 6765 5f74 6965 7273 2829  leverage_tiers()
+0001a260: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0001a270: 6620 7365 6c66 2e65 7863 6861 6e67 655f  f self.exchange_
+0001a280: 6861 7328 2766 6574 6368 4d61 726b 6574  has('fetchMarket
+0001a290: 4c65 7665 7261 6765 5469 6572 7327 293a  LeverageTiers'):
+0001a2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a2b0: 2023 204d 7573 7420 6665 7463 6820 7468   # Must fetch th
+0001a2c0: 6520 6c65 7665 7261 6765 2074 6965 7273  e leverage tiers
+0001a2d0: 2066 6f72 2065 6163 6820 6d61 726b 6574   for each market
+0001a2e0: 2073 6570 6172 6174 656c 790a 2020 2020   separately.    
+0001a2f0: 2020 2020 2020 2020 2020 2020 2320 2a20              # * 
+0001a300: 5468 6973 2069 7320 736c 6f77 287e 3435  This is slow(~45
+0001a310: 7329 206f 6e20 4f6b 782c 206d 616b 6573  s) on Okx, makes
+0001a320: 207e 3930 2061 7069 2063 616c 6c73 2074   ~90 api calls t
+0001a330: 6f20 6c6f 6164 2061 6c6c 206c 696e 6561  o load all linea
+0001a340: 7220 7377 6170 206d 6172 6b65 7473 0a20  r swap markets. 
+0001a350: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001a360: 6172 6b65 7473 203d 2073 656c 662e 6d61  arkets = self.ma
+0001a370: 726b 6574 730a 0a20 2020 2020 2020 2020  rkets..         
+0001a380: 2020 2020 2020 2073 796d 626f 6c73 203d         symbols =
+0001a390: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0001a3a0: 2020 2020 2020 2073 796d 626f 6c20 666f         symbol fo
+0001a3b0: 7220 7379 6d62 6f6c 2c20 6d61 726b 6574  r symbol, market
+0001a3c0: 2069 6e20 6d61 726b 6574 732e 6974 656d   in markets.item
+0001a3d0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0001a3e0: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
+0001a3f0: 2e6d 6172 6b65 745f 6973 5f66 7574 7572  .market_is_futur
+0001a400: 6528 6d61 726b 6574 290a 2020 2020 2020  e(market).      
+0001a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a420: 2020 616e 6420 6d61 726b 6574 5b27 7175    and market['qu
+0001a430: 6f74 6527 5d20 3d3d 2073 656c 662e 5f63  ote'] == self._c
+0001a440: 6f6e 6669 675b 2773 7461 6b65 5f63 7572  onfig['stake_cur
+0001a450: 7265 6e63 7927 5d29 0a20 2020 2020 2020  rency']).       
+0001a460: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
+0001a470: 2020 2020 2020 2020 2020 2020 7469 6572              tier
+0001a480: 733a 2044 6963 745b 7374 722c 204c 6973  s: Dict[str, Lis
+0001a490: 745b 4469 6374 5d5d 203d 207b 7d0a 0a20  t[Dict]] = {}.. 
+0001a4a0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001a4b0: 6965 7273 5f63 6163 6865 6420 3d20 7365  iers_cached = se
+0001a4c0: 6c66 2e6c 6f61 645f 6361 6368 6564 5f6c  lf.load_cached_l
+0001a4d0: 6576 6572 6167 655f 7469 6572 7328 7365  everage_tiers(se
+0001a4e0: 6c66 2e5f 636f 6e66 6967 5b27 7374 616b  lf._config['stak
+0001a4f0: 655f 6375 7272 656e 6379 275d 290a 2020  e_currency']).  
+0001a500: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001a510: 2074 6965 7273 5f63 6163 6865 643a 0a20   tiers_cached:. 
+0001a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a530: 2020 2074 6965 7273 203d 2074 6965 7273     tiers = tiers
+0001a540: 5f63 6163 6865 640a 0a20 2020 2020 2020  _cached..       
+0001a550: 2020 2020 2020 2020 2063 6f72 6f73 203d           coros =
+0001a560: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0001a570: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+0001a580: 6d61 726b 6574 5f6c 6576 6572 6167 655f  market_leverage_
+0001a590: 7469 6572 7328 7379 6d62 6f6c 290a 2020  tiers(symbol).  
+0001a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a5b0: 2020 666f 7220 7379 6d62 6f6c 2069 6e20    for symbol in 
+0001a5c0: 736f 7274 6564 2873 796d 626f 6c73 2920  sorted(symbols) 
+0001a5d0: 6966 2073 796d 626f 6c20 6e6f 7420 696e  if symbol not in
+0001a5e0: 2074 6965 7273 5d0a 0a20 2020 2020 2020   tiers]..       
+0001a5f0: 2020 2020 2020 2020 2023 2042 6520 7665           # Be ve
+0001a600: 7262 6f73 6520 6865 7265 2c20 6173 2074  rbose here, as t
+0001a610: 6869 7320 6465 6c61 7973 2073 7461 7274  his delays start
+0001a620: 7570 2062 7920 7e31 206d 696e 7574 652e  up by ~1 minute.
+0001a630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a640: 2069 6620 636f 726f 733a 0a20 2020 2020   if coros:.     
+0001a650: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001a660: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
+0001a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a680: 2020 2020 6622 496e 6974 6961 6c69 7a69      f"Initializi
+0001a690: 6e67 206c 6576 6572 6167 655f 7469 6572  ng leverage_tier
+0001a6a0: 7320 666f 7220 7b6c 656e 2873 796d 626f  s for {len(symbo
+0001a6b0: 6c73 297d 206d 6172 6b65 7473 2e20 220a  ls)} markets. ".
+0001a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a6d0: 2020 2020 2020 2020 2254 6869 7320 7769          "This wi
+0001a6e0: 6c6c 2074 616b 6520 6162 6f75 7420 6120  ll take about a 
+0001a6f0: 6d69 6e75 7465 2e22 290a 2020 2020 2020  minute.").      
+0001a700: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a720: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+0001a730: 2255 7369 6e67 2063 6163 6865 6420 6c65  "Using cached le
+0001a740: 7665 7261 6765 5f74 6965 7273 2e22 290a  verage_tiers.").
+0001a750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a760: 2061 7379 6e63 2064 6566 2067 6174 6865   async def gathe
+0001a770: 725f 7265 7375 6c74 7328 696e 7075 745f  r_results(input_
+0001a780: 636f 726f 293a 0a20 2020 2020 2020 2020  coro):.         
+0001a790: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001a7a0: 6e20 6177 6169 7420 6173 796e 6369 6f2e  n await asyncio.
+0001a7b0: 6761 7468 6572 282a 696e 7075 745f 636f  gather(*input_co
+0001a7c0: 726f 2c20 7265 7475 726e 5f65 7863 6570  ro, return_excep
+0001a7d0: 7469 6f6e 733d 5472 7565 290a 0a20 2020  tions=True)..   
+0001a7e0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001a7f0: 2069 6e70 7574 5f63 6f72 6f20 696e 2063   input_coro in c
+0001a800: 6875 6e6b 7328 636f 726f 732c 2031 3030  hunks(coros, 100
+0001a810: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
+0001a820: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+0001a830: 662e 5f6c 6f6f 705f 6c6f 636b 3a0a 2020  f._loop_lock:.  
+0001a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a850: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
+0001a860: 7365 6c66 2e6c 6f6f 702e 7275 6e5f 756e  self.loop.run_un
+0001a870: 7469 6c5f 636f 6d70 6c65 7465 2867 6174  til_complete(gat
+0001a880: 6865 725f 7265 7375 6c74 7328 696e 7075  her_results(inpu
+0001a890: 745f 636f 726f 2929 0a0a 2020 2020 2020  t_coro))..      
+0001a8a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001a8b0: 7220 7265 7320 696e 2072 6573 756c 7473  r res in results
+0001a8c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a8d0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0001a8e0: 6e73 7461 6e63 6528 7265 732c 2045 7863  nstance(res, Exc
+0001a8f0: 6570 7469 6f6e 293a 0a20 2020 2020 2020  eption):.       
+0001a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a910: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
+0001a920: 696e 6728 6622 4c65 7665 7261 6765 2074  ing(f"Leverage t
+0001a930: 6965 7220 6578 6365 7074 696f 6e3a 207b  ier exception: {
+0001a940: 7265 7072 2872 6573 297d 2229 0a20 2020  repr(res)}").   
+0001a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a960: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0001a970: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001a980: 2020 2020 2020 2020 2020 7379 6d62 6f6c            symbol
+0001a990: 2c20 7469 6572 203d 2072 6573 0a20 2020  , tier = res.   
+0001a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9b0: 2020 2020 2074 6965 7273 5b73 796d 626f       tiers[symbo
+0001a9c0: 6c5d 203d 2074 6965 720a 2020 2020 2020  l] = tier.      
+0001a9d0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0001a9e0: 2863 6f72 6f73 2920 3e20 303a 0a20 2020  (coros) > 0:.   
+0001a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa00: 2073 656c 662e 6361 6368 655f 6c65 7665   self.cache_leve
+0001aa10: 7261 6765 5f74 6965 7273 2874 6965 7273  rage_tiers(tiers
+0001aa20: 2c20 7365 6c66 2e5f 636f 6e66 6967 5b27  , self._config['
+0001aa30: 7374 616b 655f 6375 7272 656e 6379 275d  stake_currency']
+0001aa40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001aa50: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
+0001aa60: 446f 6e65 2069 6e69 7469 616c 697a 696e  Done initializin
+0001aa70: 6720 7b6c 656e 2873 796d 626f 6c73 297d  g {len(symbols)}
+0001aa80: 206d 6172 6b65 7473 2e22 290a 0a20 2020   markets.")..   
+0001aa90: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001aaa0: 7572 6e20 7469 6572 730a 2020 2020 2020  urn tiers.      
+0001aab0: 2020 7265 7475 726e 207b 7d0a 0a20 2020    return {}..   
+0001aac0: 2064 6566 2063 6163 6865 5f6c 6576 6572   def cache_lever
+0001aad0: 6167 655f 7469 6572 7328 7365 6c66 2c20  age_tiers(self, 
+0001aae0: 7469 6572 733a 2044 6963 745b 7374 722c  tiers: Dict[str,
+0001aaf0: 204c 6973 745b 4469 6374 5d5d 2c20 7374   List[Dict]], st
+0001ab00: 616b 655f 6375 7272 656e 6379 3a20 7374  ake_currency: st
+0001ab10: 7229 202d 3e20 4e6f 6e65 3a0a 0a20 2020  r) -> None:..   
+0001ab20: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
+0001ab30: 7365 6c66 2e5f 636f 6e66 6967 5b27 6461  self._config['da
+0001ab40: 7461 6469 7227 5d20 2f20 2266 7574 7572  tadir'] / "futur
+0001ab50: 6573 2220 2f20 6622 6c65 7665 7261 6765  es" / f"leverage
+0001ab60: 5f74 6965 7273 5f7b 7374 616b 655f 6375  _tiers_{stake_cu
+0001ab70: 7272 656e 6379 7d2e 6a73 6f6e 220a 2020  rrency}.json".  
+0001ab80: 2020 2020 2020 6966 206e 6f74 2066 696c        if not fil
+0001ab90: 656e 616d 652e 7061 7265 6e74 2e69 735f  ename.parent.is_
+0001aba0: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
+0001abb0: 2020 2066 696c 656e 616d 652e 7061 7265     filename.pare
+0001abc0: 6e74 2e6d 6b64 6972 2870 6172 656e 7473  nt.mkdir(parents
+0001abd0: 3d54 7275 6529 0a20 2020 2020 2020 2064  =True).        d
+0001abe0: 6174 6120 3d20 7b0a 2020 2020 2020 2020  ata = {.        
+0001abf0: 2020 2020 2275 7064 6174 6564 223a 2064      "updated": d
+0001ac00: 6174 6574 696d 652e 6e6f 7728 7469 6d65  atetime.now(time
+0001ac10: 7a6f 6e65 2e75 7463 292c 0a20 2020 2020  zone.utc),.     
+0001ac20: 2020 2020 2020 2022 6461 7461 223a 2074         "data": t
+0001ac30: 6965 7273 2c0a 2020 2020 2020 2020 7d0a  iers,.        }.
+0001ac40: 2020 2020 2020 2020 6669 6c65 5f64 756d          file_dum
+0001ac50: 705f 6a73 6f6e 2866 696c 656e 616d 652c  p_json(filename,
+0001ac60: 2064 6174 6129 0a0a 2020 2020 6465 6620   data)..    def 
+0001ac70: 6c6f 6164 5f63 6163 6865 645f 6c65 7665  load_cached_leve
+0001ac80: 7261 6765 5f74 6965 7273 2873 656c 662c  rage_tiers(self,
+0001ac90: 2073 7461 6b65 5f63 7572 7265 6e63 793a   stake_currency:
+0001aca0: 2073 7472 2920 2d3e 204f 7074 696f 6e61   str) -> Optiona
+0001acb0: 6c5b 4469 6374 5b73 7472 2c20 4c69 7374  l[Dict[str, List
+0001acc0: 5b44 6963 745d 5d5d 3a0a 2020 2020 2020  [Dict]]]:.      
+0001acd0: 2020 6669 6c65 6e61 6d65 203d 2073 656c    filename = sel
+0001ace0: 662e 5f63 6f6e 6669 675b 2764 6174 6164  f._config['datad
+0001acf0: 6972 275d 202f 2022 6675 7475 7265 7322  ir'] / "futures"
+0001ad00: 202f 2066 226c 6576 6572 6167 655f 7469   / f"leverage_ti
+0001ad10: 6572 735f 7b73 7461 6b65 5f63 7572 7265  ers_{stake_curre
+0001ad20: 6e63 797d 2e6a 736f 6e22 0a20 2020 2020  ncy}.json".     
+0001ad30: 2020 2069 6620 6669 6c65 6e61 6d65 2e69     if filename.i
+0001ad40: 735f 6669 6c65 2829 3a0a 2020 2020 2020  s_file():.      
+0001ad50: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001ad60: 2020 2020 2020 2020 2020 2074 6965 7273             tiers
+0001ad70: 203d 2066 696c 655f 6c6f 6164 5f6a 736f   = file_load_jso
+0001ad80: 6e28 6669 6c65 6e61 6d65 290a 2020 2020  n(filename).    
+0001ad90: 2020 2020 2020 2020 2020 2020 7570 6461              upda
+0001ada0: 7465 6420 3d20 7469 6572 732e 6765 7428  ted = tiers.get(
+0001adb0: 2775 7064 6174 6564 2729 0a20 2020 2020  'updated').     
+0001adc0: 2020 2020 2020 2020 2020 2069 6620 7570             if up
+0001add0: 6461 7465 643a 0a20 2020 2020 2020 2020  dated:.         
+0001ade0: 2020 2020 2020 2020 2020 2075 7064 6174             updat
+0001adf0: 6564 5f64 7420 3d20 7061 7273 6572 2e70  ed_dt = parser.p
+0001ae00: 6172 7365 2875 7064 6174 6564 290a 2020  arse(updated).  
+0001ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae20: 2020 6966 2075 7064 6174 6564 5f64 7420    if updated_dt 
+0001ae30: 3c20 6461 7465 7469 6d65 2e6e 6f77 2874  < datetime.now(t
+0001ae40: 696d 657a 6f6e 652e 7574 6329 202d 2074  imezone.utc) - t
+0001ae50: 696d 6564 656c 7461 2877 6565 6b73 3d34  imedelta(weeks=4
+0001ae60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001ae70: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0001ae80: 722e 696e 666f 2822 4361 6368 6564 206c  r.info("Cached l
+0001ae90: 6576 6572 6167 6520 7469 6572 7320 6172  everage tiers ar
+0001aea0: 6520 6f75 7464 6174 6564 2e20 5769 6c6c  e outdated. Will
+0001aeb0: 2075 7064 6174 652e 2229 0a20 2020 2020   update.").     
+0001aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aed0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
+0001aee0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001aef0: 6574 7572 6e20 7469 6572 735b 2764 6174  eturn tiers['dat
+0001af00: 6127 5d0a 2020 2020 2020 2020 2020 2020  a'].            
+0001af10: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0001af20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001af30: 2020 6c6f 6767 6572 2e65 7863 6570 7469    logger.excepti
+0001af40: 6f6e 2822 4572 726f 7220 6c6f 6164 696e  on("Error loadin
+0001af50: 6720 6361 6368 6564 206c 6576 6572 6167  g cached leverag
+0001af60: 6520 7469 6572 732e 2052 6566 7265 7368  e tiers. Refresh
+0001af70: 696e 672e 2229 0a20 2020 2020 2020 2072  ing.").        r
+0001af80: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
+0001af90: 6465 6620 6669 6c6c 5f6c 6576 6572 6167  def fill_leverag
+0001afa0: 655f 7469 6572 7328 7365 6c66 2920 2d3e  e_tiers(self) ->
+0001afb0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0001afc0: 2222 0a20 2020 2020 2020 2041 7373 6967  "".        Assig
+0001afd0: 6e73 2070 726f 7065 7274 7920 5f6c 6576  ns property _lev
+0001afe0: 6572 6167 655f 7469 6572 7320 746f 2061  erage_tiers to a
+0001aff0: 2064 6963 7469 6f6e 6172 7920 6f66 2069   dictionary of i
+0001b000: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
+0001b010: 2074 6865 206c 6576 6572 6167 650a 2020   the leverage.  
+0001b020: 2020 2020 2020 616c 6c6f 7765 6420 6f6e        allowed on
+0001b030: 2065 6163 6820 7061 6972 0a20 2020 2020   each pair.     
+0001b040: 2020 2022 2222 0a20 2020 2020 2020 206c     """.        l
+0001b050: 6576 6572 6167 655f 7469 6572 7320 3d20  everage_tiers = 
+0001b060: 7365 6c66 2e6c 6f61 645f 6c65 7665 7261  self.load_levera
+0001b070: 6765 5f74 6965 7273 2829 0a20 2020 2020  ge_tiers().     
+0001b080: 2020 2066 6f72 2070 6169 722c 2074 6965     for pair, tie
+0001b090: 7273 2069 6e20 6c65 7665 7261 6765 5f74  rs in leverage_t
+0001b0a0: 6965 7273 2e69 7465 6d73 2829 3a0a 2020  iers.items():.  
+0001b0b0: 2020 2020 2020 2020 2020 7061 6972 5f74            pair_t
+0001b0c0: 6965 7273 203d 205b 5d0a 2020 2020 2020  iers = [].      
+0001b0d0: 2020 2020 2020 666f 7220 7469 6572 2069        for tier i
+0001b0e0: 6e20 7469 6572 733a 0a20 2020 2020 2020  n tiers:.       
+0001b0f0: 2020 2020 2020 2020 2070 6169 725f 7469           pair_ti
+0001b100: 6572 732e 6170 7065 6e64 2873 656c 662e  ers.append(self.
+0001b110: 7061 7273 655f 6c65 7665 7261 6765 5f74  parse_leverage_t
+0001b120: 6965 7228 7469 6572 2929 0a20 2020 2020  ier(tier)).     
+0001b130: 2020 2020 2020 2073 656c 662e 5f6c 6576         self._lev
+0001b140: 6572 6167 655f 7469 6572 735b 7061 6972  erage_tiers[pair
+0001b150: 5d20 3d20 7061 6972 5f74 6965 7273 0a0a  ] = pair_tiers..
+0001b160: 2020 2020 6465 6620 7061 7273 655f 6c65      def parse_le
+0001b170: 7665 7261 6765 5f74 6965 7228 7365 6c66  verage_tier(self
+0001b180: 2c20 7469 6572 2920 2d3e 2044 6963 743a  , tier) -> Dict:
+0001b190: 0a20 2020 2020 2020 2069 6e66 6f20 3d20  .        info = 
+0001b1a0: 7469 6572 2e67 6574 2827 696e 666f 272c  tier.get('info',
+0001b1b0: 207b 7d29 0a20 2020 2020 2020 2072 6574   {}).        ret
+0001b1c0: 7572 6e20 7b0a 2020 2020 2020 2020 2020  urn {.          
+0001b1d0: 2020 276d 696e 4e6f 7469 6f6e 616c 273a    'minNotional':
+0001b1e0: 2074 6965 725b 276d 696e 4e6f 7469 6f6e   tier['minNotion
+0001b1f0: 616c 275d 2c0a 2020 2020 2020 2020 2020  al'],.          
+0001b200: 2020 276d 6178 4e6f 7469 6f6e 616c 273a    'maxNotional':
+0001b210: 2074 6965 725b 276d 6178 4e6f 7469 6f6e   tier['maxNotion
+0001b220: 616c 275d 2c0a 2020 2020 2020 2020 2020  al'],.          
+0001b230: 2020 276d 6169 6e74 656e 616e 6365 4d61    'maintenanceMa
+0001b240: 7267 696e 5261 7465 273a 2074 6965 725b  rginRate': tier[
+0001b250: 276d 6169 6e74 656e 616e 6365 4d61 7267  'maintenanceMarg
+0001b260: 696e 5261 7465 275d 2c0a 2020 2020 2020  inRate'],.      
+0001b270: 2020 2020 2020 276d 6178 4c65 7665 7261        'maxLevera
+0001b280: 6765 273a 2074 6965 725b 276d 6178 4c65  ge': tier['maxLe
+0001b290: 7665 7261 6765 275d 2c0a 2020 2020 2020  verage'],.      
+0001b2a0: 2020 2020 2020 276d 6169 6e74 416d 7427        'maintAmt'
+0001b2b0: 3a20 666c 6f61 7428 696e 666f 5b27 6375  : float(info['cu
+0001b2c0: 6d27 5d29 2069 6620 2763 756d 2720 696e  m']) if 'cum' in
+0001b2d0: 2069 6e66 6f20 656c 7365 204e 6f6e 652c   info else None,
+0001b2e0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+0001b2f0: 6465 6620 6765 745f 6d61 785f 6c65 7665  def get_max_leve
+0001b300: 7261 6765 2873 656c 662c 2070 6169 723a  rage(self, pair:
+0001b310: 2073 7472 2c20 7374 616b 655f 616d 6f75   str, stake_amou
+0001b320: 6e74 3a20 4f70 7469 6f6e 616c 5b66 6c6f  nt: Optional[flo
+0001b330: 6174 5d29 202d 3e20 666c 6f61 743a 0a20  at]) -> float:. 
+0001b340: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001b350: 2020 2052 6574 7572 6e73 2074 6865 206d     Returns the m
+0001b360: 6178 696d 756d 206c 6576 6572 6167 6520  aximum leverage 
+0001b370: 7468 6174 2061 2070 6169 7220 6361 6e20  that a pair can 
+0001b380: 6265 2074 7261 6465 6420 6174 0a20 2020  be traded at.   
+0001b390: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
+0001b3a0: 3a20 5468 6520 6261 7365 2f71 756f 7465  : The base/quote
+0001b3b0: 2063 7572 7265 6e63 7920 7061 6972 2062   currency pair b
+0001b3c0: 6569 6e67 2074 7261 6465 640a 2020 2020  eing traded.    
+0001b3d0: 2020 2020 3a73 7461 6b65 5f61 6d6f 756e      :stake_amoun
+0001b3e0: 743a 2054 6865 2074 6f74 616c 2076 616c  t: The total val
+0001b3f0: 7565 206f 6620 7468 6520 7472 6164 6572  ue of the trader
+0001b400: 7320 6d61 7267 696e 5f6d 6f64 6520 696e  s margin_mode in
+0001b410: 2071 756f 7465 2063 7572 7265 6e63 790a   quote currency.
+0001b420: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0001b430: 2020 2020 2069 6620 7365 6c66 2e74 7261       if self.tra
+0001b440: 6469 6e67 5f6d 6f64 6520 3d3d 2054 7261  ding_mode == Tra
+0001b450: 6469 6e67 4d6f 6465 2e53 504f 543a 0a20  dingMode.SPOT:. 
+0001b460: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001b470: 6e20 312e 300a 0a20 2020 2020 2020 2069  n 1.0..        i
+0001b480: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
+0001b490: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
+0001b4a0: 6465 2e46 5554 5552 4553 3a0a 0a20 2020  de.FUTURES:..   
+0001b4b0: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+0001b4c0: 7320 616e 6420 6564 6765 2063 6173 6573  s and edge cases
+0001b4d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001b4e0: 7374 616b 655f 616d 6f75 6e74 2069 7320  stake_amount is 
+0001b4f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0001b500: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+0001b510: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+0001b520: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001b530: 2020 2020 2020 6627 7b73 656c 662e 6e61        f'{self.na
+0001b540: 6d65 7d2e 6765 745f 6d61 785f 6c65 7665  me}.get_max_leve
+0001b550: 7261 6765 2072 6571 7569 7265 7320 6172  rage requires ar
+0001b560: 6775 6d65 6e74 2073 7461 6b65 5f61 6d6f  gument stake_amo
+0001b570: 756e 7427 0a20 2020 2020 2020 2020 2020  unt'.           
+0001b580: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0001b590: 2020 2020 6966 2070 6169 7220 6e6f 7420      if pair not 
+0001b5a0: 696e 2073 656c 662e 5f6c 6576 6572 6167  in self._leverag
+0001b5b0: 655f 7469 6572 733a 0a20 2020 2020 2020  e_tiers:.       
+0001b5c0: 2020 2020 2020 2020 2023 204d 6179 6265           # Maybe
+0001b5d0: 2072 6169 7365 2065 7863 6570 7469 6f6e   raise exception
+0001b5e0: 2062 6563 6175 7365 2069 7420 6361 6e27   because it can'
+0001b5f0: 7420 6265 2074 7261 6465 6420 6f6e 2066  t be traded on f
+0001b600: 7574 7572 6573 3f0a 2020 2020 2020 2020  utures?.        
+0001b610: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
+0001b620: 2e30 0a0a 2020 2020 2020 2020 2020 2020  .0..            
+0001b630: 7061 6972 5f74 6965 7273 203d 2073 656c  pair_tiers = sel
+0001b640: 662e 5f6c 6576 6572 6167 655f 7469 6572  f._leverage_tier
+0001b650: 735b 7061 6972 5d0a 0a20 2020 2020 2020  s[pair]..       
+0001b660: 2020 2020 2069 6620 7374 616b 655f 616d       if stake_am
+0001b670: 6f75 6e74 203d 3d20 303a 0a20 2020 2020  ount == 0:.     
+0001b680: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001b690: 6e20 7365 6c66 2e5f 6c65 7665 7261 6765  n self._leverage
+0001b6a0: 5f74 6965 7273 5b70 6169 725d 5b30 5d5b  _tiers[pair][0][
+0001b6b0: 276d 6178 4c65 7665 7261 6765 275d 2020  'maxLeverage']  
+0001b6c0: 2320 4d61 7820 6c65 7620 666f 7220 6c6f  # Max lev for lo
+0001b6d0: 7765 7374 2061 6d6f 756e 740a 0a20 2020  west amount..   
+0001b6e0: 2020 2020 2020 2020 2066 6f72 2074 6965           for tie
+0001b6f0: 725f 696e 6465 7820 696e 2072 616e 6765  r_index in range
+0001b700: 286c 656e 2870 6169 725f 7469 6572 7329  (len(pair_tiers)
+0001b710: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
+0001b720: 2020 2020 7469 6572 203d 2070 6169 725f      tier = pair_
+0001b730: 7469 6572 735b 7469 6572 5f69 6e64 6578  tiers[tier_index
+0001b740: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001b750: 2020 6c65 7620 3d20 7469 6572 5b27 6d61    lev = tier['ma
+0001b760: 784c 6576 6572 6167 6527 5d0a 0a20 2020  xLeverage']..   
+0001b770: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b780: 7469 6572 5f69 6e64 6578 203c 206c 656e  tier_index < len
+0001b790: 2870 6169 725f 7469 6572 7329 202d 2031  (pair_tiers) - 1
+0001b7a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001b7b0: 2020 2020 2020 6e65 7874 5f74 6965 7220        next_tier 
+0001b7c0: 3d20 7061 6972 5f74 6965 7273 5b74 6965  = pair_tiers[tie
+0001b7d0: 725f 696e 6465 7820 2b20 315d 0a20 2020  r_index + 1].   
+0001b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7f0: 206e 6578 745f 666c 6f6f 7220 3d20 6e65   next_floor = ne
+0001b800: 7874 5f74 6965 725b 276d 696e 4e6f 7469  xt_tier['minNoti
+0001b810: 6f6e 616c 275d 202f 206e 6578 745f 7469  onal'] / next_ti
+0001b820: 6572 5b27 6d61 784c 6576 6572 6167 6527  er['maxLeverage'
+0001b830: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001b840: 2020 2020 2020 6966 206e 6578 745f 666c        if next_fl
+0001b850: 6f6f 7220 3e20 7374 616b 655f 616d 6f75  oor > stake_amou
+0001b860: 6e74 3a20 2023 204e 6578 7420 7469 6572  nt:  # Next tier
+0001b870: 206d 696e 2074 6f6f 2068 6967 6820 666f   min too high fo
+0001b880: 7220 7374 616b 6520 616d 6f75 6e74 0a20  r stake amount. 
 0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8a0: 2020 2020 2023 2020 2020 2022 6d61 7822       #     "max"
-0001b8b0: 3a20 3530 3030 302c 2020 2320 6d61 785f  : 50000,  # max_
-0001b8c0: 7374 616b 6540 3530 203d 2035 3030 3030  stake@50 = 50000
-0001b8d0: 2f35 3020 3d20 3130 3030 2e30 0a20 2020  /50 = 1000.0.   
+0001b8a0: 2020 2020 2020 2072 6574 7572 6e20 6d69         return mi
+0001b8b0: 6e28 2874 6965 725b 276d 6178 4e6f 7469  n((tier['maxNoti
+0001b8c0: 6f6e 616c 275d 202f 2073 7461 6b65 5f61  onal'] / stake_a
+0001b8d0: 6d6f 756e 7429 2c20 6c65 7629 0a20 2020  mount), lev).   
 0001b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8f0: 2020 2020 2023 2020 2020 2022 6c65 7622       #     "lev"
-0001b900: 3a20 3530 2c0a 2020 2020 2020 2020 2020  : 50,.          
-0001b910: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001b920: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0001b930: 2020 2020 2020 2020 2020 230a 0a20 2020            #..   
-0001b940: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001b950: 653a 2020 2320 6966 206f 6e20 7468 6520  e:  # if on the 
-0001b960: 6c61 7374 2074 6965 720a 2020 2020 2020  last tier.      
-0001b970: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b980: 2073 7461 6b65 5f61 6d6f 756e 7420 3e20   stake_amount > 
-0001b990: 7469 6572 5b27 6d61 784e 6f74 696f 6e61  tier['maxNotiona
-0001b9a0: 6c27 5d3a 0a20 2020 2020 2020 2020 2020  l']:.           
-0001b9b0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-0001b9c0: 6620 7374 616b 6520 6973 203e 2074 6861  f stake is > tha
-0001b9d0: 6e20 6d61 7820 7472 6164 6561 626c 6520  n max tradeable 
-0001b9e0: 616d 6f75 6e74 0a20 2020 2020 2020 2020  amount.         
-0001b9f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001ba00: 6169 7365 2049 6e76 616c 6964 4f72 6465  aise InvalidOrde
-0001ba10: 7245 7863 6570 7469 6f6e 2866 2741 6d6f  rException(f'Amo
-0001ba20: 756e 7420 7b73 7461 6b65 5f61 6d6f 756e  unt {stake_amoun
-0001ba30: 747d 2074 6f6f 2068 6967 6820 666f 7220  t} too high for 
-0001ba40: 7b70 6169 727d 2729 0a20 2020 2020 2020  {pair}').       
-0001ba50: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001ba60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001ba70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001ba80: 6e20 7469 6572 5b27 6d61 784c 6576 6572  n tier['maxLever
-0001ba90: 6167 6527 5d0a 0a20 2020 2020 2020 2020  age']..         
-0001baa0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-0001bab0: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
-0001bac0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001bad0: 4c6f 6f70 6564 2074 6872 6f75 6768 2061  Looped through a
-0001bae0: 6c6c 2074 6965 7273 2077 6974 686f 7574  ll tiers without
-0001baf0: 2066 696e 6469 6e67 2061 206d 6178 206c   finding a max l
-0001bb00: 6576 6572 6167 652e 2053 686f 756c 6420  everage. Should 
-0001bb10: 6e65 7665 7220 6265 2072 6561 6368 6564  never be reached
-0001bb20: 270a 2020 2020 2020 2020 2020 2020 290a  '.            ).
-0001bb30: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
-0001bb40: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
-0001bb50: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e4d  == TradingMode.M
-0001bb60: 4152 4749 4e3a 2020 2320 5365 6172 6368  ARGIN:  # Search
-0001bb70: 206d 6172 6b65 7473 2e6c 696d 6974 7320   markets.limits 
-0001bb80: 666f 7220 6d61 7820 6c65 760a 2020 2020  for max lev.    
-0001bb90: 2020 2020 2020 2020 6d61 726b 6574 203d          market =
-0001bba0: 2073 656c 662e 6d61 726b 6574 735b 7061   self.markets[pa
-0001bbb0: 6972 5d0a 2020 2020 2020 2020 2020 2020  ir].            
-0001bbc0: 6966 206d 6172 6b65 745b 276c 696d 6974  if market['limit
-0001bbd0: 7327 5d5b 276c 6576 6572 6167 6527 5d5b  s']['leverage'][
-0001bbe0: 276d 6178 275d 2069 7320 6e6f 7420 4e6f  'max'] is not No
-0001bbf0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001bc00: 2020 2020 7265 7475 726e 206d 6172 6b65      return marke
-0001bc10: 745b 276c 696d 6974 7327 5d5b 276c 6576  t['limits']['lev
-0001bc20: 6572 6167 6527 5d5b 276d 6178 275d 0a20  erage']['max']. 
-0001bc30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001bc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bc50: 2072 6574 7572 6e20 312e 3020 2023 2044   return 1.0  # D
-0001bc60: 6566 6175 6c74 2069 6620 6d61 7820 6c65  efault if max le
-0001bc70: 7665 7261 6765 2063 616e 6e6f 7420 6265  verage cannot be
-0001bc80: 2066 6f75 6e64 0a20 2020 2020 2020 2065   found.        e
-0001bc90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001bca0: 2072 6574 7572 6e20 312e 300a 0a20 2020   return 1.0..   
-0001bcb0: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
-0001bcc0: 6620 5f73 6574 5f6c 6576 6572 6167 6528  f _set_leverage(
-0001bcd0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0001bce0: 2020 2020 2020 206c 6576 6572 6167 653a         leverage:
-0001bcf0: 2066 6c6f 6174 2c0a 2020 2020 2020 2020   float,.        
-0001bd00: 7061 6972 3a20 4f70 7469 6f6e 616c 5b73  pair: Optional[s
-0001bd10: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-0001bd20: 2020 2020 6163 6365 7074 5f66 6169 6c3a      accept_fail:
-0001bd30: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-0001bd40: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-0001bd50: 220a 2020 2020 2020 2020 5365 7427 7320  ".        Set's 
-0001bd60: 7468 6520 6c65 7665 7261 6765 2062 6566  the leverage bef
-0001bd70: 6f72 6520 6d61 6b69 6e67 2061 2074 7261  ore making a tra
-0001bd80: 6465 2c20 696e 206f 7264 6572 2074 6f20  de, in order to 
-0001bd90: 6e6f 740a 2020 2020 2020 2020 6861 7665  not.        have
-0001bda0: 2074 6865 2073 616d 6520 6c65 7665 7261   the same levera
-0001bdb0: 6765 206f 6e20 6576 6572 7920 7472 6164  ge on every trad
-0001bdc0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-0001bdd0: 2020 2020 2020 6966 2073 656c 662e 5f63        if self._c
-0001bde0: 6f6e 6669 675b 2764 7279 5f72 756e 275d  onfig['dry_run']
-0001bdf0: 206f 7220 6e6f 7420 7365 6c66 2e65 7863   or not self.exc
-0001be00: 6861 6e67 655f 6861 7328 2273 6574 4c65  hange_has("setLe
-0001be10: 7665 7261 6765 2229 3a0a 2020 2020 2020  verage"):.      
-0001be20: 2020 2020 2020 2320 536f 6d65 2065 7863        # Some exc
-0001be30: 6861 6e67 6573 206f 6e6c 7920 7375 7070  hanges only supp
-0001be40: 6f72 7420 6f6e 6520 6d61 7267 696e 5f6d  ort one margin_m
-0001be50: 6f64 6520 7479 7065 0a20 2020 2020 2020  ode type.       
-0001be60: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-0001be70: 2020 2020 6966 2073 656c 662e 5f66 745f      if self._ft_
-0001be80: 6861 732e 6765 7428 2766 6c6f 6f72 5f6c  has.get('floor_l
-0001be90: 6576 6572 6167 6527 2c20 4661 6c73 6529  everage', False)
-0001bea0: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
-0001beb0: 2020 2020 2020 2320 526f 756e 6469 6e67        # Rounding
-0001bec0: 2066 6f72 2062 696e 616e 6365 202e 2e2e   for binance ...
-0001bed0: 0a20 2020 2020 2020 2020 2020 206c 6576  .            lev
-0001bee0: 6572 6167 6520 3d20 666c 6f6f 7228 6c65  erage = floor(le
-0001bef0: 7665 7261 6765 290a 2020 2020 2020 2020  verage).        
-0001bf00: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001bf10: 2072 6573 203d 2073 656c 662e 5f61 7069   res = self._api
-0001bf20: 2e73 6574 5f6c 6576 6572 6167 6528 7379  .set_leverage(sy
-0001bf30: 6d62 6f6c 3d70 6169 722c 206c 6576 6572  mbol=pair, lever
-0001bf40: 6167 653d 6c65 7665 7261 6765 290a 2020  age=leverage).  
-0001bf50: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0001bf60: 6c6f 675f 6578 6368 616e 6765 5f72 6573  log_exchange_res
-0001bf70: 706f 6e73 6528 2773 6574 5f6c 6576 6572  ponse('set_lever
-0001bf80: 6167 6527 2c20 7265 7329 0a20 2020 2020  age', res).     
-0001bf90: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
-0001bfa0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
-0001bfb0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0001bfc0: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
-0001bfd0: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
-0001bfe0: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
-0001bff0: 6378 742e 4261 6452 6571 7565 7374 2c20  cxt.BadRequest, 
-0001c000: 6363 7874 2e49 6e73 7566 6669 6369 656e  ccxt.Insufficien
-0001c010: 7446 756e 6473 2920 6173 2065 3a0a 2020  tFunds) as e:.  
-0001c020: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0001c030: 2061 6363 6570 745f 6661 696c 3a0a 2020   accept_fail:.  
-0001c040: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0001c050: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
-0001c060: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0001c070: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
-0001c080: 6e6f 7420 7365 7420 6c65 7665 7261 6765  not set leverage
-0001c090: 2064 7565 2074 6f20 7b65 2e5f 5f63 6c61   due to {e.__cla
-0001c0a0: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20  ss__.__name__}. 
-0001c0b0: 4d65 7373 6167 653a 207b 657d 2729 2066  Message: {e}') f
-0001c0c0: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
-0001c0d0: 6365 7074 2028 6363 7874 2e4e 6574 776f  cept (ccxt.Netwo
-0001c0e0: 726b 4572 726f 722c 2063 6378 742e 4578  rkError, ccxt.Ex
-0001c0f0: 6368 616e 6765 4572 726f 7229 2061 7320  changeError) as 
-0001c100: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001c110: 6169 7365 2054 656d 706f 7261 7279 4572  aise TemporaryEr
-0001c120: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0001c130: 2020 2020 2066 2743 6f75 6c64 206e 6f74       f'Could not
-0001c140: 2073 6574 206c 6576 6572 6167 6520 6475   set leverage du
-0001c150: 6520 746f 207b 652e 5f5f 636c 6173 735f  e to {e.__class_
-0001c160: 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d 6573  _.__name__}. Mes
-0001c170: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
-0001c180: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-0001c190: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
-0001c1a0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001c1b0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-0001c1c0: 6f6e 616c 4578 6365 7074 696f 6e28 6529  onalException(e)
-0001c1d0: 2066 726f 6d20 650a 0a20 2020 2064 6566   from e..    def
-0001c1e0: 2067 6574 5f69 6e74 6572 6573 745f 7261   get_interest_ra
-0001c1f0: 7465 2873 656c 6629 202d 3e20 666c 6f61  te(self) -> floa
-0001c200: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-0001c210: 2020 2020 2020 2052 6574 7269 6576 6520         Retrieve 
-0001c220: 696e 7465 7265 7374 2072 6174 6520 2d20  interest rate - 
-0001c230: 6e65 6365 7373 6172 7920 666f 7220 4d61  necessary for Ma
-0001c240: 7267 696e 2074 7261 6469 6e67 2e0a 2020  rgin trading..  
-0001c250: 2020 2020 2020 5368 6f75 6c64 206e 6f74        Should not
-0001c260: 2063 616c 6c20 7468 6520 6578 6368 616e   call the exchan
-0001c270: 6765 2064 6972 6563 746c 7920 7768 656e  ge directly when
-0001c280: 2075 7365 6420 6672 6f6d 2062 6163 6b74   used from backt
-0001c290: 6573 7469 6e67 2e0a 2020 2020 2020 2020  esting..        
-0001c2a0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0001c2b0: 726e 2030 2e30 0a0a 2020 2020 6465 6620  rn 0.0..    def 
-0001c2c0: 6675 6e64 696e 675f 6665 655f 6375 746f  funding_fee_cuto
-0001c2d0: 6666 2873 656c 662c 206f 7065 6e5f 6461  ff(self, open_da
-0001c2e0: 7465 3a20 6461 7465 7469 6d65 293a 0a20  te: datetime):. 
-0001c2f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001c300: 2020 203a 7061 7261 6d20 6f70 656e 5f64     :param open_d
-0001c310: 6174 653a 2054 6865 206f 7065 6e20 6461  ate: The open da
-0001c320: 7465 2066 6f72 2061 2074 7261 6465 0a20  te for a trade. 
-0001c330: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0001c340: 5468 6520 6375 746f 6666 206f 7065 6e20  The cutoff open 
-0001c350: 7469 6d65 2066 6f72 2077 6865 6e20 6120  time for when a 
-0001c360: 6675 6e64 696e 6720 6665 6520 6973 2063  funding fee is c
-0001c370: 6861 7267 6564 0a20 2020 2020 2020 2022  harged.        "
-0001c380: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0001c390: 6e20 6f70 656e 5f64 6174 652e 6d69 6e75  n open_date.minu
-0001c3a0: 7465 203e 2030 206f 7220 6f70 656e 5f64  te > 0 or open_d
-0001c3b0: 6174 652e 7365 636f 6e64 203e 2030 0a0a  ate.second > 0..
-0001c3c0: 2020 2020 4072 6574 7269 6572 0a20 2020      @retrier.   
-0001c3d0: 2064 6566 2073 6574 5f6d 6172 6769 6e5f   def set_margin_
-0001c3e0: 6d6f 6465 2873 656c 662c 2070 6169 723a  mode(self, pair:
-0001c3f0: 2073 7472 2c20 6d61 7267 696e 5f6d 6f64   str, margin_mod
-0001c400: 653a 204d 6172 6769 6e4d 6f64 652c 2061  e: MarginMode, a
-0001c410: 6363 6570 745f 6661 696c 3a20 626f 6f6c  ccept_fail: bool
-0001c420: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-0001c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c440: 2020 7061 7261 6d73 3a20 6469 6374 203d    params: dict =
-0001c450: 207b 7d29 3a0a 2020 2020 2020 2020 2222   {}):.        ""
-0001c460: 220a 2020 2020 2020 2020 5365 7427 7320  ".        Set's 
-0001c470: 7468 6520 6d61 7267 696e 206d 6f64 6520  the margin mode 
-0001c480: 6f6e 2074 6865 2065 7863 6861 6e67 6520  on the exchange 
-0001c490: 746f 2063 726f 7373 206f 7220 6973 6f6c  to cross or isol
-0001c4a0: 6174 6564 2066 6f72 2061 2073 7065 6369  ated for a speci
-0001c4b0: 6669 6320 7061 6972 0a20 2020 2020 2020  fic pair.       
-0001c4c0: 203a 7061 7261 6d20 7061 6972 3a20 6261   :param pair: ba
-0001c4d0: 7365 2f71 756f 7465 2063 7572 7265 6e63  se/quote currenc
-0001c4e0: 7920 7061 6972 2028 652e 672e 2022 4144  y pair (e.g. "AD
-0001c4f0: 412f 5553 4454 2229 0a20 2020 2020 2020  A/USDT").       
-0001c500: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0001c510: 7365 6c66 2e5f 636f 6e66 6967 5b27 6472  self._config['dr
-0001c520: 795f 7275 6e27 5d20 6f72 206e 6f74 2073  y_run'] or not s
-0001c530: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
-0001c540: 2822 7365 744d 6172 6769 6e4d 6f64 6522  ("setMarginMode"
-0001c550: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-0001c560: 2053 6f6d 6520 6578 6368 616e 6765 7320   Some exchanges 
-0001c570: 6f6e 6c79 2073 7570 706f 7274 206f 6e65  only support one
-0001c580: 206d 6172 6769 6e5f 6d6f 6465 2074 7970   margin_mode typ
-0001c590: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
-0001c5a0: 7475 726e 0a0a 2020 2020 2020 2020 7472  turn..        tr
-0001c5b0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-0001c5c0: 6573 203d 2073 656c 662e 5f61 7069 2e73  es = self._api.s
-0001c5d0: 6574 5f6d 6172 6769 6e5f 6d6f 6465 286d  et_margin_mode(m
-0001c5e0: 6172 6769 6e5f 6d6f 6465 2e76 616c 7565  argin_mode.value
-0001c5f0: 2c20 7061 6972 2c20 7061 7261 6d73 290a  , pair, params).
-0001c600: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001c610: 2e5f 6c6f 675f 6578 6368 616e 6765 5f72  ._log_exchange_r
-0001c620: 6573 706f 6e73 6528 2773 6574 5f6d 6172  esponse('set_mar
-0001c630: 6769 6e5f 6d6f 6465 272c 2072 6573 290a  gin_mode', res).
-0001c640: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-0001c650: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
-0001c660: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-0001c670: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
-0001c680: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
-0001c690: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0001c6a0: 7074 2063 6378 742e 4261 6452 6571 7565  pt ccxt.BadReque
-0001c6b0: 7374 2061 7320 653a 0a20 2020 2020 2020  st as e:.       
-0001c6c0: 2020 2020 2069 6620 6e6f 7420 6163 6365       if not acce
-0001c6d0: 7074 5f66 6169 6c3a 0a20 2020 2020 2020  pt_fail:.       
-0001c6e0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-0001c6f0: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
-0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c710: 2020 2066 2743 6f75 6c64 206e 6f74 2073     f'Could not s
-0001c720: 6574 206d 6172 6769 6e20 6d6f 6465 2064  et margin mode d
-0001c730: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-0001c740: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
-0001c750: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
-0001c760: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0001c770: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
-0001c780: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
-0001c790: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
-0001c7a0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001c7b0: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
-0001c7c0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0001c7d0: 2020 2066 2743 6f75 6c64 206e 6f74 2073     f'Could not s
-0001c7e0: 6574 206d 6172 6769 6e20 6d6f 6465 2064  et margin mode d
-0001c7f0: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-0001c800: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
-0001c810: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
-0001c820: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0001c830: 7074 2063 6378 742e 4261 7365 4572 726f  pt ccxt.BaseErro
-0001c840: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0001c850: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-0001c860: 696f 6e61 6c45 7863 6570 7469 6f6e 2865  ionalException(e
-0001c870: 2920 6672 6f6d 2065 0a0a 2020 2020 6465  ) from e..    de
-0001c880: 6620 5f66 6574 6368 5f61 6e64 5f63 616c  f _fetch_and_cal
-0001c890: 6375 6c61 7465 5f66 756e 6469 6e67 5f66  culate_funding_f
-0001c8a0: 6565 7328 0a20 2020 2020 2020 2073 656c  ees(.        sel
-0001c8b0: 662c 0a20 2020 2020 2020 2070 6169 723a  f,.        pair:
-0001c8c0: 2073 7472 2c0a 2020 2020 2020 2020 616d   str,.        am
-0001c8d0: 6f75 6e74 3a20 666c 6f61 742c 0a20 2020  ount: float,.   
-0001c8e0: 2020 2020 2069 735f 7368 6f72 743a 2062       is_short: b
-0001c8f0: 6f6f 6c2c 0a20 2020 2020 2020 206f 7065  ool,.        ope
-0001c900: 6e5f 6461 7465 3a20 6461 7465 7469 6d65  n_date: datetime
-0001c910: 2c0a 2020 2020 2020 2020 636c 6f73 655f  ,.        close_
-0001c920: 6461 7465 3a20 4f70 7469 6f6e 616c 5b64  date: Optional[d
-0001c930: 6174 6574 696d 655d 203d 204e 6f6e 650a  atetime] = None.
-0001c940: 2020 2020 2920 2d3e 2066 6c6f 6174 3a0a      ) -> float:.
-0001c950: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001c960: 2020 2020 4665 7463 6865 7320 616e 6420      Fetches and 
-0001c970: 6361 6c63 756c 6174 6573 2074 6865 2073  calculates the s
-0001c980: 756d 206f 6620 616c 6c20 6675 6e64 696e  um of all fundin
-0001c990: 6720 6665 6573 2074 6861 7420 6f63 6375  g fees that occu
-0001c9a0: 7272 6564 2066 6f72 2061 2070 6169 720a  rred for a pair.
-0001c9b0: 2020 2020 2020 2020 6475 7269 6e67 2061          during a
-0001c9c0: 2066 7574 7572 6573 2074 7261 6465 2e0a   futures trade..
-0001c9d0: 2020 2020 2020 2020 4f6e 6c79 2075 7365          Only use
-0001c9e0: 6420 6475 7269 6e67 2064 7279 2d72 756e  d during dry-run
-0001c9f0: 206f 7220 6966 2074 6865 2065 7863 6861   or if the excha
-0001ca00: 6e67 6520 646f 6573 206e 6f74 2070 726f  nge does not pro
-0001ca10: 7669 6465 2061 2066 756e 6469 6e67 5f72  vide a funding_r
-0001ca20: 6174 6573 2065 6e64 706f 696e 742e 0a20  ates endpoint.. 
-0001ca30: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-0001ca40: 6972 3a20 5468 6520 7175 6f74 652f 6261  ir: The quote/ba
-0001ca50: 7365 2070 6169 7220 6f66 2074 6865 2074  se pair of the t
-0001ca60: 7261 6465 0a20 2020 2020 2020 203a 7061  rade.        :pa
-0001ca70: 7261 6d20 616d 6f75 6e74 3a20 5468 6520  ram amount: The 
-0001ca80: 7175 616e 7469 7479 206f 6620 7468 6520  quantity of the 
-0001ca90: 7472 6164 650a 2020 2020 2020 2020 3a70  trade.        :p
-0001caa0: 6172 616d 2069 735f 7368 6f72 743a 2074  aram is_short: t
-0001cab0: 7261 6465 2064 6972 6563 7469 6f6e 0a20  rade direction. 
-0001cac0: 2020 2020 2020 203a 7061 7261 6d20 6f70         :param op
-0001cad0: 656e 5f64 6174 653a 2054 6865 2064 6174  en_date: The dat
-0001cae0: 6520 616e 6420 7469 6d65 2074 6861 7420  e and time that 
-0001caf0: 7468 6520 7472 6164 6520 7374 6172 7465  the trade starte
-0001cb00: 640a 2020 2020 2020 2020 3a70 6172 616d  d.        :param
-0001cb10: 2063 6c6f 7365 5f64 6174 653a 2054 6865   close_date: The
-0001cb20: 2064 6174 6520 616e 6420 7469 6d65 2074   date and time t
-0001cb30: 6861 7420 7468 6520 7472 6164 6520 656e  hat the trade en
-0001cb40: 6465 640a 2020 2020 2020 2020 2222 220a  ded.        """.
-0001cb50: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0001cb60: 2e66 756e 6469 6e67 5f66 6565 5f63 7574  .funding_fee_cut
-0001cb70: 6f66 6628 6f70 656e 5f64 6174 6529 3a0a  off(open_date):.
-0001cb80: 2020 2020 2020 2020 2020 2020 6f70 656e              open
-0001cb90: 5f64 6174 6520 2b3d 2074 696d 6564 656c  _date += timedel
-0001cba0: 7461 2868 6f75 7273 3d31 290a 2020 2020  ta(hours=1).    
-0001cbb0: 2020 2020 7469 6d65 6672 616d 6520 3d20      timeframe = 
-0001cbc0: 7365 6c66 2e5f 6674 5f68 6173 5b27 6d61  self._ft_has['ma
-0001cbd0: 726b 5f6f 686c 6376 5f74 696d 6566 7261  rk_ohlcv_timefra
-0001cbe0: 6d65 275d 0a20 2020 2020 2020 2074 696d  me'].        tim
-0001cbf0: 6566 7261 6d65 5f66 6620 3d20 7365 6c66  eframe_ff = self
-0001cc00: 2e5f 6674 5f68 6173 2e67 6574 2827 6675  ._ft_has.get('fu
-0001cc10: 6e64 696e 675f 6665 655f 7469 6d65 6672  nding_fee_timefr
-0001cc20: 616d 6527 2c0a 2020 2020 2020 2020 2020  ame',.          
-0001cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001cc50: 6c66 2e5f 6674 5f68 6173 5b27 6d61 726b  lf._ft_has['mark
-0001cc60: 5f6f 686c 6376 5f74 696d 6566 7261 6d65  _ohlcv_timeframe
-0001cc70: 275d 290a 0a20 2020 2020 2020 2069 6620  '])..        if 
-0001cc80: 6e6f 7420 636c 6f73 655f 6461 7465 3a0a  not close_date:.
-0001cc90: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
-0001cca0: 655f 6461 7465 203d 2064 6174 6574 696d  e_date = datetim
-0001ccb0: 652e 6e6f 7728 7469 6d65 7a6f 6e65 2e75  e.now(timezone.u
-0001ccc0: 7463 290a 2020 2020 2020 2020 6f70 656e  tc).        open
-0001ccd0: 5f74 696d 6573 7461 6d70 203d 2069 6e74  _timestamp = int
-0001cce0: 2874 696d 6566 7261 6d65 5f74 6f5f 7072  (timeframe_to_pr
-0001ccf0: 6576 5f64 6174 6528 7469 6d65 6672 616d  ev_date(timefram
-0001cd00: 652c 206f 7065 6e5f 6461 7465 292e 7469  e, open_date).ti
-0001cd10: 6d65 7374 616d 7028 2929 202a 2031 3030  mestamp()) * 100
-0001cd20: 300a 2020 2020 2020 2020 2320 636c 6f73  0.        # clos
-0001cd30: 655f 7469 6d65 7374 616d 7020 3d20 696e  e_timestamp = in
-0001cd40: 7428 636c 6f73 655f 6461 7465 2e74 696d  t(close_date.tim
-0001cd50: 6573 7461 6d70 2829 2920 2a20 3130 3030  estamp()) * 1000
-0001cd60: 0a0a 2020 2020 2020 2020 6d61 726b 5f63  ..        mark_c
-0001cd70: 6f6d 623a 2050 6169 7257 6974 6854 696d  omb: PairWithTim
-0001cd80: 6566 7261 6d65 203d 2028 0a20 2020 2020  eframe = (.     
-0001cd90: 2020 2020 2020 2070 6169 722c 2074 696d         pair, tim
-0001cda0: 6566 7261 6d65 2c20 4361 6e64 6c65 5479  eframe, CandleTy
-0001cdb0: 7065 2e66 726f 6d5f 7374 7269 6e67 2873  pe.from_string(s
-0001cdc0: 656c 662e 5f66 745f 6861 735b 226d 6172  elf._ft_has["mar
-0001cdd0: 6b5f 6f68 6c63 765f 7072 6963 6522 5d29  k_ohlcv_price"])
-0001cde0: 290a 0a20 2020 2020 2020 2066 756e 6469  )..        fundi
-0001cdf0: 6e67 5f63 6f6d 623a 2050 6169 7257 6974  ng_comb: PairWit
-0001ce00: 6854 696d 6566 7261 6d65 203d 2028 7061  hTimeframe = (pa
-0001ce10: 6972 2c20 7469 6d65 6672 616d 655f 6666  ir, timeframe_ff
-0001ce20: 2c20 4361 6e64 6c65 5479 7065 2e46 554e  , CandleType.FUN
-0001ce30: 4449 4e47 5f52 4154 4529 0a20 2020 2020  DING_RATE).     
-0001ce40: 2020 2063 616e 646c 655f 6869 7374 6f72     candle_histor
-0001ce50: 6965 7320 3d20 7365 6c66 2e72 6566 7265  ies = self.refre
-0001ce60: 7368 5f6c 6174 6573 745f 6f68 6c63 7628  sh_latest_ohlcv(
-0001ce70: 0a20 2020 2020 2020 2020 2020 205b 6d61  .            [ma
-0001ce80: 726b 5f63 6f6d 622c 2066 756e 6469 6e67  rk_comb, funding
-0001ce90: 5f63 6f6d 625d 2c0a 2020 2020 2020 2020  _comb],.        
-0001cea0: 2020 2020 7369 6e63 655f 6d73 3d6f 7065      since_ms=ope
-0001ceb0: 6e5f 7469 6d65 7374 616d 702c 0a20 2020  n_timestamp,.   
-0001cec0: 2020 2020 2020 2020 2063 6163 6865 3d46           cache=F
-0001ced0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-0001cee0: 2020 6472 6f70 5f69 6e63 6f6d 706c 6574    drop_incomplet
-0001cef0: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
-0001cf00: 2029 0a20 2020 2020 2020 2074 7279 3a0a   ).        try:.
-0001cf10: 2020 2020 2020 2020 2020 2020 2320 7765              # we
-0001cf20: 2063 616e 2774 2061 7373 756d 6520 7765   can't assume we
-0001cf30: 2061 6c77 6179 7320 6765 7420 6869 7374   always get hist
-0001cf40: 6f72 6965 7320 2d20 666f 7220 6578 616d  ories - for exam
-0001cf50: 706c 6520 6475 7269 6e67 2065 7863 6861  ple during excha
-0001cf60: 6e67 6520 646f 776e 7469 6d65 730a 2020  nge downtimes.  
-0001cf70: 2020 2020 2020 2020 2020 6675 6e64 696e            fundin
-0001cf80: 675f 7261 7465 7320 3d20 6361 6e64 6c65  g_rates = candle
-0001cf90: 5f68 6973 746f 7269 6573 5b66 756e 6469  _histories[fundi
-0001cfa0: 6e67 5f63 6f6d 625d 0a20 2020 2020 2020  ng_comb].       
-0001cfb0: 2020 2020 206d 6172 6b5f 7261 7465 7320       mark_rates 
-0001cfc0: 3d20 6361 6e64 6c65 5f68 6973 746f 7269  = candle_histori
-0001cfd0: 6573 5b6d 6172 6b5f 636f 6d62 5d0a 2020  es[mark_comb].  
-0001cfe0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-0001cff0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-0001d000: 2020 2072 6169 7365 2045 7863 6861 6e67     raise Exchang
-0001d010: 6545 7272 6f72 2822 436f 756c 6420 6e6f  eError("Could no
-0001d020: 7420 6669 6e64 2066 756e 6469 6e67 2072  t find funding r
-0001d030: 6174 6573 2e22 2920 6672 6f6d 204e 6f6e  ates.") from Non
-0001d040: 650a 0a20 2020 2020 2020 2066 756e 6469  e..        fundi
-0001d050: 6e67 5f6d 6172 6b5f 7261 7465 7320 3d20  ng_mark_rates = 
-0001d060: 7365 6c66 2e63 6f6d 6269 6e65 5f66 756e  self.combine_fun
-0001d070: 6469 6e67 5f61 6e64 5f6d 6172 6b28 0a20  ding_and_mark(. 
-0001d080: 2020 2020 2020 2020 2020 2066 756e 6469             fundi
-0001d090: 6e67 5f72 6174 6573 3d66 756e 6469 6e67  ng_rates=funding
-0001d0a0: 5f72 6174 6573 2c20 6d61 726b 5f72 6174  _rates, mark_rat
-0001d0b0: 6573 3d6d 6172 6b5f 7261 7465 7329 0a0a  es=mark_rates)..
-0001d0c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001d0d0: 656c 662e 6361 6c63 756c 6174 655f 6675  elf.calculate_fu
-0001d0e0: 6e64 696e 675f 6665 6573 280a 2020 2020  nding_fees(.    
-0001d0f0: 2020 2020 2020 2020 6675 6e64 696e 675f          funding_
-0001d100: 6d61 726b 5f72 6174 6573 2c0a 2020 2020  mark_rates,.    
-0001d110: 2020 2020 2020 2020 616d 6f75 6e74 3d61          amount=a
-0001d120: 6d6f 756e 742c 0a20 2020 2020 2020 2020  mount,.         
-0001d130: 2020 2069 735f 7368 6f72 743d 6973 5f73     is_short=is_s
-0001d140: 686f 7274 2c0a 2020 2020 2020 2020 2020  hort,.          
-0001d150: 2020 6f70 656e 5f64 6174 653d 6f70 656e    open_date=open
-0001d160: 5f64 6174 652c 0a20 2020 2020 2020 2020  _date,.         
-0001d170: 2020 2063 6c6f 7365 5f64 6174 653d 636c     close_date=cl
-0001d180: 6f73 655f 6461 7465 0a20 2020 2020 2020  ose_date.       
-0001d190: 2029 0a0a 2020 2020 4073 7461 7469 636d   )..    @staticm
-0001d1a0: 6574 686f 640a 2020 2020 6465 6620 636f  ethod.    def co
-0001d1b0: 6d62 696e 655f 6675 6e64 696e 675f 616e  mbine_funding_an
-0001d1c0: 645f 6d61 726b 2866 756e 6469 6e67 5f72  d_mark(funding_r
-0001d1d0: 6174 6573 3a20 4461 7461 4672 616d 652c  ates: DataFrame,
-0001d1e0: 206d 6172 6b5f 7261 7465 733a 2044 6174   mark_rates: Dat
-0001d1f0: 6146 7261 6d65 2c0a 2020 2020 2020 2020  aFrame,.        
-0001d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d210: 2020 2020 2020 2020 2066 7574 7572 6573           futures
-0001d220: 5f66 756e 6469 6e67 5f72 6174 653a 204f  _funding_rate: O
-0001d230: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-0001d240: 6f6e 6529 202d 3e20 4461 7461 4672 616d  one) -> DataFram
-0001d250: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-0001d260: 2020 2020 2020 2043 6f6d 6269 6e65 2066         Combine f
-0001d270: 756e 6469 6e67 2d72 6174 6573 2061 6e64  unding-rates and
-0001d280: 206d 6172 6b2d 7261 7465 7320 6461 7461   mark-rates data
-0001d290: 6672 616d 6573 0a20 2020 2020 2020 203a  frames.        :
-0001d2a0: 7061 7261 6d20 6675 6e64 696e 675f 7261  param funding_ra
-0001d2b0: 7465 733a 2044 6174 6166 7261 6d65 2063  tes: Dataframe c
-0001d2c0: 6f6e 7461 696e 696e 6720 4675 6e64 696e  ontaining Fundin
-0001d2d0: 6720 7261 7465 7320 2854 7970 6520 4655  g rates (Type FU
-0001d2e0: 4e44 494e 475f 5241 5445 290a 2020 2020  NDING_RATE).    
-0001d2f0: 2020 2020 3a70 6172 616d 206d 6172 6b5f      :param mark_
-0001d300: 7261 7465 733a 2044 6174 6166 7261 6d65  rates: Dataframe
-0001d310: 2063 6f6e 7461 696e 696e 6720 4d61 726b   containing Mark
-0001d320: 2072 6174 6573 2028 5479 7065 206d 6172   rates (Type mar
-0001d330: 6b5f 6f68 6c63 765f 7072 6963 6529 0a20  k_ohlcv_price). 
-0001d340: 2020 2020 2020 203a 7061 7261 6d20 6675         :param fu
-0001d350: 7475 7265 735f 6675 6e64 696e 675f 7261  tures_funding_ra
-0001d360: 7465 3a20 4661 6b65 2066 756e 6469 6e67  te: Fake funding
-0001d370: 2072 6174 6520 746f 2075 7365 2069 6620   rate to use if 
-0001d380: 6675 6e64 696e 675f 7261 7465 7320 6172  funding_rates ar
-0001d390: 6520 6e6f 7420 6176 6169 6c61 626c 650a  e not available.
-0001d3a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001d3b0: 2020 2020 6966 2066 7574 7572 6573 5f66      if futures_f
-0001d3c0: 756e 6469 6e67 5f72 6174 6520 6973 204e  unding_rate is N
-0001d3d0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001d3e0: 2072 6574 7572 6e20 6d61 726b 5f72 6174   return mark_rat
-0001d3f0: 6573 2e6d 6572 6765 280a 2020 2020 2020  es.merge(.      
-0001d400: 2020 2020 2020 2020 2020 6675 6e64 696e            fundin
-0001d410: 675f 7261 7465 732c 206f 6e3d 2764 6174  g_rates, on='dat
-0001d420: 6527 2c20 686f 773d 2269 6e6e 6572 222c  e', how="inner",
-0001d430: 2073 7566 6669 7865 733d 5b22 5f6d 6172   suffixes=["_mar
-0001d440: 6b22 2c20 225f 6675 6e64 225d 290a 2020  k", "_fund"]).  
-0001d450: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001d460: 2020 2020 2020 2020 6966 206c 656e 2866          if len(f
-0001d470: 756e 6469 6e67 5f72 6174 6573 2920 3d3d  unding_rates) ==
-0001d480: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0001d490: 2020 2020 2320 4e6f 2066 756e 6469 6e67      # No funding
-0001d4a0: 2072 6174 6520 6361 6e64 6c65 7320 2d20   rate candles - 
-0001d4b0: 6675 6c6c 2066 696c 6c75 7020 7769 7468  full fillup with
-0001d4c0: 2066 616c 6c62 6163 6b20 7661 7269 6162   fallback variab
-0001d4d0: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
-0001d4e0: 2020 206d 6172 6b5f 7261 7465 735b 276f     mark_rates['o
-0001d4f0: 7065 6e5f 6675 6e64 275d 203d 2066 7574  pen_fund'] = fut
-0001d500: 7572 6573 5f66 756e 6469 6e67 5f72 6174  ures_funding_rat
-0001d510: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001d520: 2020 7265 7475 726e 206d 6172 6b5f 7261    return mark_ra
-0001d530: 7465 732e 7265 6e61 6d65 280a 2020 2020  tes.rename(.    
-0001d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d550: 2020 2020 636f 6c75 6d6e 733d 7b27 6f70      columns={'op
-0001d560: 656e 273a 2027 6f70 656e 5f6d 6172 6b27  en': 'open_mark'
-0001d570: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d590: 2020 2027 636c 6f73 6527 3a20 2763 6c6f     'close': 'clo
-0001d5a0: 7365 5f6d 6172 6b27 2c0a 2020 2020 2020  se_mark',.      
-0001d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5c0: 2020 2020 2020 2020 2020 2027 6869 6768             'high
-0001d5d0: 273a 2027 6869 6768 5f6d 6172 6b27 2c0a  ': 'high_mark',.
-0001d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d600: 2027 6c6f 7727 3a20 276c 6f77 5f6d 6172   'low': 'low_mar
-0001d610: 6b27 2c0a 2020 2020 2020 2020 2020 2020  k',.            
-0001d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d630: 2020 2020 2027 766f 6c75 6d65 273a 2027       'volume': '
-0001d640: 766f 6c75 6d65 5f6d 6172 6b27 7d29 0a0a  volume_mark'})..
-0001d650: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001d660: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d670: 2020 2320 4669 6c6c 2075 7020 6d69 7373    # Fill up miss
-0001d680: 696e 6720 6675 6e64 696e 675f 7261 7465  ing funding_rate
-0001d690: 2063 616e 646c 6573 2077 6974 6820 6661   candles with fa
-0001d6a0: 6c6c 6261 636b 2076 616c 7565 0a20 2020  llback value.   
-0001d6b0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-0001d6c0: 6269 6e65 6420 3d20 6d61 726b 5f72 6174  bined = mark_rat
-0001d6d0: 6573 2e6d 6572 6765 280a 2020 2020 2020  es.merge(.      
-0001d6e0: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-0001d6f0: 6e64 696e 675f 7261 7465 732c 206f 6e3d  nding_rates, on=
-0001d700: 2764 6174 6527 2c20 686f 773d 226f 7574  'date', how="out
-0001d710: 6572 222c 2073 7566 6669 7865 733d 5b22  er", suffixes=["
-0001d720: 5f6d 6172 6b22 2c20 225f 6675 6e64 225d  _mark", "_fund"]
-0001d730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d740: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001d750: 2020 2020 2020 2063 6f6d 6269 6e65 645b         combined[
-0001d760: 276f 7065 6e5f 6675 6e64 275d 203d 2063  'open_fund'] = c
-0001d770: 6f6d 6269 6e65 645b 276f 7065 6e5f 6675  ombined['open_fu
-0001d780: 6e64 275d 2e66 696c 6c6e 6128 6675 7475  nd'].fillna(futu
-0001d790: 7265 735f 6675 6e64 696e 675f 7261 7465  res_funding_rate
-0001d7a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d7b0: 2020 7265 7475 726e 2063 6f6d 6269 6e65    return combine
-0001d7c0: 640a 0a20 2020 2064 6566 2063 616c 6375  d..    def calcu
-0001d7d0: 6c61 7465 5f66 756e 6469 6e67 5f66 6565  late_funding_fee
-0001d7e0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-0001d7f0: 0a20 2020 2020 2020 2064 663a 2044 6174  .        df: Dat
-0001d800: 6146 7261 6d65 2c0a 2020 2020 2020 2020  aFrame,.        
-0001d810: 616d 6f75 6e74 3a20 666c 6f61 742c 0a20  amount: float,. 
-0001d820: 2020 2020 2020 2069 735f 7368 6f72 743a         is_short:
-0001d830: 2062 6f6f 6c2c 0a20 2020 2020 2020 206f   bool,.        o
-0001d840: 7065 6e5f 6461 7465 3a20 6461 7465 7469  pen_date: dateti
-0001d850: 6d65 2c0a 2020 2020 2020 2020 636c 6f73  me,.        clos
-0001d860: 655f 6461 7465 3a20 4f70 7469 6f6e 616c  e_date: Optional
-0001d870: 5b64 6174 6574 696d 655d 203d 204e 6f6e  [datetime] = Non
-0001d880: 652c 0a20 2020 2020 2020 2074 696d 655f  e,.        time_
-0001d890: 696e 5f72 6174 696f 3a20 4f70 7469 6f6e  in_ratio: Option
-0001d8a0: 616c 5b66 6c6f 6174 5d20 3d20 4e6f 6e65  al[float] = None
-0001d8b0: 0a20 2020 2029 202d 3e20 666c 6f61 743a  .    ) -> float:
-0001d8c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001d8d0: 2020 2020 2063 616c 6375 6c61 7465 7320       calculates 
-0001d8e0: 7468 6520 7375 6d20 6f66 2061 6c6c 2066  the sum of all f
-0001d8f0: 756e 6469 6e67 2066 6565 7320 7468 6174  unding fees that
-0001d900: 206f 6363 7572 7265 6420 666f 7220 6120   occurred for a 
-0001d910: 7061 6972 2064 7572 696e 6720 6120 6675  pair during a fu
-0001d920: 7475 7265 7320 7472 6164 650a 2020 2020  tures trade.    
-0001d930: 2020 2020 3a70 6172 616d 2064 663a 2044      :param df: D
-0001d940: 6174 6166 7261 6d65 2063 6f6e 7461 696e  ataframe contain
-0001d950: 696e 6720 636f 6d62 696e 6564 2066 756e  ing combined fun
-0001d960: 6469 6e67 2061 6e64 206d 6172 6b20 7261  ding and mark ra
-0001d970: 7465 730a 2020 2020 2020 2020 2020 2020  tes.            
-0001d980: 2020 2020 2020 2061 7320 606f 7065 6e5f         as `open_
-0001d990: 6675 6e64 6020 616e 6420 606f 7065 6e5f  fund` and `open_
-0001d9a0: 6d61 726b 602e 0a20 2020 2020 2020 203a  mark`..        :
-0001d9b0: 7061 7261 6d20 616d 6f75 6e74 3a20 5468  param amount: Th
-0001d9c0: 6520 7175 616e 7469 7479 206f 6620 7468  e quantity of th
-0001d9d0: 6520 7472 6164 650a 2020 2020 2020 2020  e trade.        
-0001d9e0: 3a70 6172 616d 2069 735f 7368 6f72 743a  :param is_short:
-0001d9f0: 2074 7261 6465 2064 6972 6563 7469 6f6e   trade direction
-0001da00: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001da10: 6f70 656e 5f64 6174 653a 2054 6865 2064  open_date: The d
-0001da20: 6174 6520 616e 6420 7469 6d65 2074 6861  ate and time tha
-0001da30: 7420 7468 6520 7472 6164 6520 7374 6172  t the trade star
-0001da40: 7465 640a 2020 2020 2020 2020 3a70 6172  ted.        :par
-0001da50: 616d 2063 6c6f 7365 5f64 6174 653a 2054  am close_date: T
-0001da60: 6865 2064 6174 6520 616e 6420 7469 6d65  he date and time
-0001da70: 2074 6861 7420 7468 6520 7472 6164 6520   that the trade 
-0001da80: 656e 6465 640a 2020 2020 2020 2020 3a70  ended.        :p
-0001da90: 6172 616d 2074 696d 655f 696e 5f72 6174  aram time_in_rat
-0001daa0: 696f 3a20 4e6f 7420 7573 6564 2062 7920  io: Not used by 
-0001dab0: 6d6f 7374 2065 7863 6861 6e67 6520 636c  most exchange cl
-0001dac0: 6173 7365 730a 2020 2020 2020 2020 2222  asses.        ""
-0001dad0: 220a 2020 2020 2020 2020 6665 6573 3a20  ".        fees: 
-0001dae0: 666c 6f61 7420 3d20 300a 0a20 2020 2020  float = 0..     
-0001daf0: 2020 2069 6620 6e6f 7420 6466 2e65 6d70     if not df.emp
-0001db00: 7479 3a0a 2020 2020 2020 2020 2020 2020  ty:.            
-0001db10: 6466 203d 2064 665b 2864 665b 2764 6174  df = df[(df['dat
-0001db20: 6527 5d20 3e3d 206f 7065 6e5f 6461 7465  e'] >= open_date
-0001db30: 2920 2620 2864 665b 2764 6174 6527 5d20  ) & (df['date'] 
-0001db40: 3c3d 2063 6c6f 7365 5f64 6174 6529 5d0a  <= close_date)].
-0001db50: 2020 2020 2020 2020 2020 2020 6665 6573              fees
-0001db60: 203d 2073 756d 2864 665b 276f 7065 6e5f   = sum(df['open_
-0001db70: 6675 6e64 275d 202a 2064 665b 276f 7065  fund'] * df['ope
-0001db80: 6e5f 6d61 726b 275d 202a 2061 6d6f 756e  n_mark'] * amoun
-0001db90: 7429 0a0a 2020 2020 2020 2020 2320 4e65  t)..        # Ne
-0001dba0: 6761 7465 2066 6565 7320 666f 7220 6c6f  gate fees for lo
-0001dbb0: 6e67 7320 6173 2066 756e 6469 6e67 5f66  ngs as funding_f
-0001dbc0: 6565 7320 6578 7065 6374 7320 6974 2074  ees expects it t
-0001dbd0: 6869 7320 7761 7920 6261 7365 6420 6f6e  his way based on
-0001dbe0: 206c 6976 6520 656e 6470 6f69 6e74 732e   live endpoints.
-0001dbf0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001dc00: 6665 6573 2069 6620 6973 5f73 686f 7274  fees if is_short
-0001dc10: 2065 6c73 6520 2d66 6565 730a 0a20 2020   else -fees..   
-0001dc20: 2064 6566 2067 6574 5f66 756e 6469 6e67   def get_funding
-0001dc30: 5f66 6565 7328 0a20 2020 2020 2020 2020  _fees(.         
-0001dc40: 2020 2073 656c 662c 2070 6169 723a 2073     self, pair: s
-0001dc50: 7472 2c20 616d 6f75 6e74 3a20 666c 6f61  tr, amount: floa
-0001dc60: 742c 2069 735f 7368 6f72 743a 2062 6f6f  t, is_short: boo
-0001dc70: 6c2c 206f 7065 6e5f 6461 7465 3a20 6461  l, open_date: da
-0001dc80: 7465 7469 6d65 2920 2d3e 2066 6c6f 6174  tetime) -> float
-0001dc90: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001dca0: 2020 2020 2020 4665 7463 6820 6675 6e64        Fetch fund
-0001dcb0: 696e 6720 6665 6573 2c20 6569 7468 6572  ing fees, either
-0001dcc0: 2066 726f 6d20 7468 6520 6578 6368 616e   from the exchan
-0001dcd0: 6765 2028 6c69 7665 2920 6f72 2063 616c  ge (live) or cal
-0001dce0: 6375 6c61 7465 7320 7468 656d 0a20 2020  culates them.   
-0001dcf0: 2020 2020 2062 6173 6564 206f 6e20 6675       based on fu
-0001dd00: 6e64 696e 6720 7261 7465 2f6d 6172 6b20  nding rate/mark 
-0001dd10: 7072 6963 6520 6869 7374 6f72 790a 2020  price history.  
-0001dd20: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
-0001dd30: 723a 2054 6865 2071 756f 7465 2f62 6173  r: The quote/bas
-0001dd40: 6520 7061 6972 206f 6620 7468 6520 7472  e pair of the tr
-0001dd50: 6164 650a 2020 2020 2020 2020 3a70 6172  ade.        :par
-0001dd60: 616d 2069 735f 7368 6f72 743a 2074 7261  am is_short: tra
-0001dd70: 6465 2064 6972 6563 7469 6f6e 0a20 2020  de direction.   
-0001dd80: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
-0001dd90: 6e74 3a20 5472 6164 6520 616d 6f75 6e74  nt: Trade amount
-0001dda0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001ddb0: 6f70 656e 5f64 6174 653a 204f 7065 6e20  open_date: Open 
-0001ddc0: 6461 7465 206f 6620 7468 6520 7472 6164  date of the trad
-0001ddd0: 650a 2020 2020 2020 2020 3a72 6574 7572  e.        :retur
-0001dde0: 6e3a 2066 756e 6469 6e67 2066 6565 2073  n: funding fee s
-0001ddf0: 696e 6365 206f 7065 6e5f 6461 7465 0a20  ince open_date. 
-0001de00: 2020 2020 2020 203a 7261 6973 6573 3a20         :raises: 
-0001de10: 4578 6368 616e 6765 4572 726f 7220 6966  ExchangeError if
-0001de20: 2073 6f6d 6574 6869 6e67 2067 6f65 7320   something goes 
-0001de30: 7772 6f6e 672e 0a20 2020 2020 2020 2022  wrong..        "
-0001de40: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
-0001de50: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
-0001de60: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e46  == TradingMode.F
-0001de70: 5554 5552 4553 3a0a 2020 2020 2020 2020  UTURES:.        
-0001de80: 2020 2020 6966 2073 656c 662e 5f63 6f6e      if self._con
-0001de90: 6669 675b 2764 7279 5f72 756e 275d 3a0a  fig['dry_run']:.
-0001dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001deb0: 6675 6e64 696e 675f 6665 6573 203d 2073  funding_fees = s
-0001dec0: 656c 662e 5f66 6574 6368 5f61 6e64 5f63  elf._fetch_and_c
-0001ded0: 616c 6375 6c61 7465 5f66 756e 6469 6e67  alculate_funding
-0001dee0: 5f66 6565 7328 0a20 2020 2020 2020 2020  _fees(.         
-0001def0: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-0001df00: 2061 6d6f 756e 742c 2069 735f 7368 6f72   amount, is_shor
-0001df10: 742c 206f 7065 6e5f 6461 7465 290a 2020  t, open_date).  
-0001df20: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0001df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df40: 6675 6e64 696e 675f 6665 6573 203d 2073  funding_fees = s
-0001df50: 656c 662e 5f67 6574 5f66 756e 6469 6e67  elf._get_funding
-0001df60: 5f66 6565 735f 6672 6f6d 5f65 7863 6861  _fees_from_excha
-0001df70: 6e67 6528 7061 6972 2c20 6f70 656e 5f64  nge(pair, open_d
-0001df80: 6174 6529 0a20 2020 2020 2020 2020 2020  ate).           
-0001df90: 2072 6574 7572 6e20 6675 6e64 696e 675f   return funding_
-0001dfa0: 6665 6573 0a20 2020 2020 2020 2065 6c73  fees.        els
-0001dfb0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001dfc0: 6574 7572 6e20 302e 300a 0a20 2020 2064  eturn 0.0..    d
-0001dfd0: 6566 2067 6574 5f6c 6971 7569 6461 7469  ef get_liquidati
-0001dfe0: 6f6e 5f70 7269 6365 280a 2020 2020 2020  on_price(.      
-0001dff0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0001e000: 7061 6972 3a20 7374 722c 0a20 2020 2020  pair: str,.     
-0001e010: 2020 2023 2044 7279 2d72 756e 0a20 2020     # Dry-run.   
-0001e020: 2020 2020 206f 7065 6e5f 7261 7465 3a20       open_rate: 
-0001e030: 666c 6f61 742c 2020 2023 2045 6e74 7279  float,   # Entry
-0001e040: 2070 7269 6365 206f 6620 706f 7369 7469   price of positi
-0001e050: 6f6e 0a20 2020 2020 2020 2069 735f 7368  on.        is_sh
-0001e060: 6f72 743a 2062 6f6f 6c2c 0a20 2020 2020  ort: bool,.     
-0001e070: 2020 2061 6d6f 756e 743a 2066 6c6f 6174     amount: float
-0001e080: 2c20 2023 2041 6273 6f6c 7574 6520 7661  ,  # Absolute va
-0001e090: 6c75 6520 6f66 2070 6f73 6974 696f 6e20  lue of position 
-0001e0a0: 7369 7a65 0a20 2020 2020 2020 2073 7461  size.        sta
-0001e0b0: 6b65 5f61 6d6f 756e 743a 2066 6c6f 6174  ke_amount: float
-0001e0c0: 2c0a 2020 2020 2020 2020 6c65 7665 7261  ,.        levera
-0001e0d0: 6765 3a20 666c 6f61 742c 0a20 2020 2020  ge: float,.     
-0001e0e0: 2020 2077 616c 6c65 745f 6261 6c61 6e63     wallet_balanc
-0001e0f0: 653a 2066 6c6f 6174 2c0a 2020 2020 2020  e: float,.      
-0001e100: 2020 6d6d 5f65 785f 313a 2066 6c6f 6174    mm_ex_1: float
-0001e110: 203d 2030 2e30 2c20 2023 2028 4269 6e61   = 0.0,  # (Bina
-0001e120: 6e63 6529 2043 726f 7373 206f 6e6c 790a  nce) Cross only.
-0001e130: 2020 2020 2020 2020 7570 6e6c 5f65 785f          upnl_ex_
-0001e140: 313a 2066 6c6f 6174 203d 2030 2e30 2c20  1: float = 0.0, 
-0001e150: 2023 2028 4269 6e61 6e63 6529 2043 726f   # (Binance) Cro
-0001e160: 7373 206f 6e6c 790a 2020 2020 2920 2d3e  ss only.    ) ->
-0001e170: 204f 7074 696f 6e61 6c5b 666c 6f61 745d   Optional[float]
-0001e180: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001e190: 2020 2020 2020 5365 7427 7320 7468 6520        Set's the 
-0001e1a0: 6d61 7267 696e 206d 6f64 6520 6f6e 2074  margin mode on t
-0001e1b0: 6865 2065 7863 6861 6e67 6520 746f 2063  he exchange to c
-0001e1c0: 726f 7373 206f 7220 6973 6f6c 6174 6564  ross or isolated
-0001e1d0: 2066 6f72 2061 2073 7065 6369 6669 6320   for a specific 
-0001e1e0: 7061 6972 0a20 2020 2020 2020 2022 2222  pair.        """
-0001e1f0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0001e200: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
-0001e210: 2054 7261 6469 6e67 4d6f 6465 2e53 504f   TradingMode.SPO
-0001e220: 543a 0a20 2020 2020 2020 2020 2020 2072  T:.            r
-0001e230: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-0001e240: 2020 2065 6c69 6620 2873 656c 662e 7472     elif (self.tr
-0001e250: 6164 696e 675f 6d6f 6465 2021 3d20 5472  ading_mode != Tr
-0001e260: 6164 696e 674d 6f64 652e 4655 5455 5245  adingMode.FUTURE
-0001e270: 5329 3a0a 2020 2020 2020 2020 2020 2020  S):.            
-0001e280: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-0001e290: 6c45 7863 6570 7469 6f6e 280a 2020 2020  lException(.    
-0001e2a0: 2020 2020 2020 2020 2020 2020 6622 7b73              f"{s
-0001e2b0: 656c 662e 6e61 6d65 7d20 646f 6573 206e  elf.name} does n
-0001e2c0: 6f74 2073 7570 706f 7274 207b 7365 6c66  ot support {self
-0001e2d0: 2e6d 6172 6769 6e5f 6d6f 6465 7d20 7b73  .margin_mode} {s
-0001e2e0: 656c 662e 7472 6164 696e 675f 6d6f 6465  elf.trading_mode
-0001e2f0: 7d22 290a 0a20 2020 2020 2020 206c 6971  }")..        liq
-0001e300: 7569 6461 7469 6f6e 5f70 7269 6365 203d  uidation_price =
-0001e310: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-0001e320: 2073 656c 662e 5f63 6f6e 6669 675b 2764   self._config['d
-0001e330: 7279 5f72 756e 275d 206f 7220 6e6f 7420  ry_run'] or not 
-0001e340: 7365 6c66 2e65 7863 6861 6e67 655f 6861  self.exchange_ha
-0001e350: 7328 2266 6574 6368 506f 7369 7469 6f6e  s("fetchPosition
-0001e360: 7322 293a 0a0a 2020 2020 2020 2020 2020  s"):..          
-0001e370: 2020 6c69 7175 6964 6174 696f 6e5f 7072    liquidation_pr
-0001e380: 6963 6520 3d20 7365 6c66 2e64 7279 5f72  ice = self.dry_r
-0001e390: 756e 5f6c 6971 7569 6461 7469 6f6e 5f70  un_liquidation_p
-0001e3a0: 7269 6365 280a 2020 2020 2020 2020 2020  rice(.          
-0001e3b0: 2020 2020 2020 7061 6972 3d70 6169 722c        pair=pair,
-0001e3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e3d0: 206f 7065 6e5f 7261 7465 3d6f 7065 6e5f   open_rate=open_
-0001e3e0: 7261 7465 2c0a 2020 2020 2020 2020 2020  rate,.          
-0001e3f0: 2020 2020 2020 6973 5f73 686f 7274 3d69        is_short=i
-0001e400: 735f 7368 6f72 742c 0a20 2020 2020 2020  s_short,.       
-0001e410: 2020 2020 2020 2020 2061 6d6f 756e 743d           amount=
-0001e420: 616d 6f75 6e74 2c0a 2020 2020 2020 2020  amount,.        
-0001e430: 2020 2020 2020 2020 6c65 7665 7261 6765          leverage
-0001e440: 3d6c 6576 6572 6167 652c 0a20 2020 2020  =leverage,.     
-0001e450: 2020 2020 2020 2020 2020 2073 7461 6b65             stake
-0001e460: 5f61 6d6f 756e 743d 7374 616b 655f 616d  _amount=stake_am
-0001e470: 6f75 6e74 2c0a 2020 2020 2020 2020 2020  ount,.          
-0001e480: 2020 2020 2020 7761 6c6c 6574 5f62 616c        wallet_bal
-0001e490: 616e 6365 3d77 616c 6c65 745f 6261 6c61  ance=wallet_bala
-0001e4a0: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
-0001e4b0: 2020 2020 206d 6d5f 6578 5f31 3d6d 6d5f       mm_ex_1=mm_
-0001e4c0: 6578 5f31 2c0a 2020 2020 2020 2020 2020  ex_1,.          
-0001e4d0: 2020 2020 2020 7570 6e6c 5f65 785f 313d        upnl_ex_1=
-0001e4e0: 7570 6e6c 5f65 785f 310a 2020 2020 2020  upnl_ex_1.      
-0001e4f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001e500: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001e510: 2020 706f 7369 7469 6f6e 7320 3d20 7365    positions = se
-0001e520: 6c66 2e66 6574 6368 5f70 6f73 6974 696f  lf.fetch_positio
-0001e530: 6e73 2870 6169 7229 0a20 2020 2020 2020  ns(pair).       
-0001e540: 2020 2020 2069 6620 6c65 6e28 706f 7369       if len(posi
-0001e550: 7469 6f6e 7329 203e 2030 3a0a 2020 2020  tions) > 0:.    
-0001e560: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
-0001e570: 3d20 706f 7369 7469 6f6e 735b 305d 0a20  = positions[0]. 
-0001e580: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001e590: 6971 7569 6461 7469 6f6e 5f70 7269 6365  iquidation_price
-0001e5a0: 203d 2070 6f73 5b27 6c69 7175 6964 6174   = pos['liquidat
-0001e5b0: 696f 6e50 7269 6365 275d 0a0a 2020 2020  ionPrice']..    
-0001e5c0: 2020 2020 6966 206c 6971 7569 6461 7469      if liquidati
-0001e5d0: 6f6e 5f70 7269 6365 2069 7320 6e6f 7420  on_price is not 
-0001e5e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001e5f0: 2020 6275 6666 6572 5f61 6d6f 756e 7420    buffer_amount 
-0001e600: 3d20 6162 7328 6f70 656e 5f72 6174 6520  = abs(open_rate 
-0001e610: 2d20 6c69 7175 6964 6174 696f 6e5f 7072  - liquidation_pr
-0001e620: 6963 6529 202a 2073 656c 662e 6c69 7175  ice) * self.liqu
-0001e630: 6964 6174 696f 6e5f 6275 6666 6572 0a20  idation_buffer. 
-0001e640: 2020 2020 2020 2020 2020 206c 6971 7569             liqui
-0001e650: 6461 7469 6f6e 5f70 7269 6365 5f62 7566  dation_price_buf
-0001e660: 6665 7220 3d20 280a 2020 2020 2020 2020  fer = (.        
-0001e670: 2020 2020 2020 2020 6c69 7175 6964 6174          liquidat
-0001e680: 696f 6e5f 7072 6963 6520 2d20 6275 6666  ion_price - buff
-0001e690: 6572 5f61 6d6f 756e 740a 2020 2020 2020  er_amount.      
-0001e6a0: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
-0001e6b0: 7368 6f72 7420 656c 7365 0a20 2020 2020  short else.     
-0001e6c0: 2020 2020 2020 2020 2020 206c 6971 7569             liqui
-0001e6d0: 6461 7469 6f6e 5f70 7269 6365 202b 2062  dation_price + b
-0001e6e0: 7566 6665 725f 616d 6f75 6e74 0a20 2020  uffer_amount.   
-0001e6f0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001e700: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
-0001e710: 7828 6c69 7175 6964 6174 696f 6e5f 7072  x(liquidation_pr
-0001e720: 6963 655f 6275 6666 6572 2c20 302e 3029  ice_buffer, 0.0)
-0001e730: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0001e740: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001e750: 6e20 4e6f 6e65 0a0a 2020 2020 6465 6620  n None..    def 
-0001e760: 6472 795f 7275 6e5f 6c69 7175 6964 6174  dry_run_liquidat
-0001e770: 696f 6e5f 7072 6963 6528 0a20 2020 2020  ion_price(.     
-0001e780: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0001e790: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
-0001e7a0: 2020 2020 6f70 656e 5f72 6174 653a 2066      open_rate: f
-0001e7b0: 6c6f 6174 2c20 2020 2320 456e 7472 7920  loat,   # Entry 
-0001e7c0: 7072 6963 6520 6f66 2070 6f73 6974 696f  price of positio
-0001e7d0: 6e0a 2020 2020 2020 2020 6973 5f73 686f  n.        is_sho
-0001e7e0: 7274 3a20 626f 6f6c 2c0a 2020 2020 2020  rt: bool,.      
-0001e7f0: 2020 616d 6f75 6e74 3a20 666c 6f61 742c    amount: float,
-0001e800: 0a20 2020 2020 2020 2073 7461 6b65 5f61  .        stake_a
-0001e810: 6d6f 756e 743a 2066 6c6f 6174 2c0a 2020  mount: float,.  
-0001e820: 2020 2020 2020 6c65 7665 7261 6765 3a20        leverage: 
-0001e830: 666c 6f61 742c 0a20 2020 2020 2020 2077  float,.        w
-0001e840: 616c 6c65 745f 6261 6c61 6e63 653a 2066  allet_balance: f
-0001e850: 6c6f 6174 2c20 2023 204f 7220 6d61 7267  loat,  # Or marg
-0001e860: 696e 2062 616c 616e 6365 0a20 2020 2020  in balance.     
-0001e870: 2020 206d 6d5f 6578 5f31 3a20 666c 6f61     mm_ex_1: floa
-0001e880: 7420 3d20 302e 302c 2020 2320 2842 696e  t = 0.0,  # (Bin
-0001e890: 616e 6365 2920 4372 6f73 7320 6f6e 6c79  ance) Cross only
-0001e8a0: 0a20 2020 2020 2020 2075 706e 6c5f 6578  .        upnl_ex
-0001e8b0: 5f31 3a20 666c 6f61 7420 3d20 302e 302c  _1: float = 0.0,
-0001e8c0: 2020 2320 2842 696e 616e 6365 2920 4372    # (Binance) Cr
-0001e8d0: 6f73 7320 6f6e 6c79 0a20 2020 2029 202d  oss only.    ) -
-0001e8e0: 3e20 4f70 7469 6f6e 616c 5b66 6c6f 6174  > Optional[float
-0001e8f0: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
-0001e900: 2020 2020 2020 2049 6d70 6f72 7461 6e74         Important
-0001e910: 3a20 4d75 7374 2062 6520 6665 7463 6869  : Must be fetchi
-0001e920: 6e67 2064 6174 6120 6672 6f6d 2063 6163  ng data from cac
-0001e930: 6865 6420 7661 6c75 6573 2061 7320 7468  hed values as th
-0001e940: 6973 2069 7320 7573 6564 2062 7920 6261  is is used by ba
-0001e950: 636b 7465 7374 696e 6721 0a20 2020 2020  cktesting!.     
-0001e960: 2020 2050 4552 5045 5455 414c 3a0a 2020     PERPETUAL:.  
-0001e970: 2020 2020 2020 2067 6174 653a 2068 7474         gate: htt
-0001e980: 7073 3a2f 2f77 7777 2e67 6174 652e 696f  ps://www.gate.io
-0001e990: 2f68 656c 702f 6675 7475 7265 732f 6675  /help/futures/fu
-0001e9a0: 7475 7265 732f 3237 3732 342f 6c69 7175  tures/27724/liqu
-0001e9b0: 6964 6174 696f 6e2d 7072 6963 652d 6261  idation-price-ba
-0001e9c0: 6e6b 7275 7074 6379 2d70 7269 6365 0a20  nkruptcy-price. 
-0001e9d0: 2020 2020 2020 2020 3e20 4c69 7175 6964          > Liquid
-0001e9e0: 6174 696f 6e20 5072 6963 6520 3d20 2845  ation Price = (E
-0001e9f0: 6e74 7279 2050 7269 6365 20c2 b120 4d61  ntry Price .. Ma
-0001ea00: 7267 696e 202f 2043 6f6e 7472 6163 7420  rgin / Contract 
-0001ea10: 4d75 6c74 6970 6c69 6572 202f 2053 697a  Multiplier / Siz
-0001ea20: 6529 202f 0a20 2020 2020 2020 2020 2020  e) /.           
-0001ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea40: 2020 2020 205b 2031 20c2 b120 284d 6169       [ 1 .. (Mai
-0001ea50: 6e74 656e 616e 6365 204d 6172 6769 6e20  ntenance Margin 
-0001ea60: 5261 7469 6f20 2b20 5461 6b65 7220 5261  Ratio + Taker Ra
-0001ea70: 7465 295d 0a20 2020 2020 2020 2020 2020  te)].           
-0001ea80: 2057 6865 7265 696e 2c20 222b 2220 6f72   Wherein, "+" or
-0001ea90: 2022 2d22 2064 6570 656e 6473 206f 6e20   "-" depends on 
-0001eaa0: 7768 6574 6865 7220 7468 6520 636f 6e74  whether the cont
-0001eab0: 7261 6374 2067 6f65 7320 6c6f 6e67 206f  ract goes long o
-0001eac0: 7220 7368 6f72 743a 0a20 2020 2020 2020  r short:.       
-0001ead0: 2020 2020 2022 2d22 2066 6f72 206c 6f6e       "-" for lon
-0001eae0: 672c 2061 6e64 2022 2b22 2066 6f72 2073  g, and "+" for s
-0001eaf0: 686f 7274 2e0a 0a20 2020 2020 2020 2020  hort...         
-0001eb00: 6f6b 6578 3a20 6874 7470 733a 2f2f 7777  okex: https://ww
-0001eb10: 772e 6f6b 6578 2e63 6f6d 2f73 7570 706f  w.okex.com/suppo
-0001eb20: 7274 2f68 632f 656e 2d75 732f 6172 7469  rt/hc/en-us/arti
-0001eb30: 636c 6573 2f0a 2020 2020 2020 2020 2020  cles/.          
-0001eb40: 2020 3336 3030 3533 3930 3935 3932 2d56    360053909592-V
-0001eb50: 492d 496e 7472 6f64 7563 7469 6f6e 2d74  I-Introduction-t
-0001eb60: 6f2d 7468 652d 6973 6f6c 6174 6564 2d6d  o-the-isolated-m
-0001eb70: 6f64 652d 6f66 2d53 696e 676c 652d 4d75  ode-of-Single-Mu
-0001eb80: 6c74 692d 6375 7272 656e 6379 2d50 6f72  lti-currency-Por
-0001eb90: 7466 6f6c 696f 2d6d 6172 6769 6e0a 0a20  tfolio-margin.. 
-0001eba0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-0001ebb0: 6972 3a20 5061 6972 2074 6f20 6361 6c63  ir: Pair to calc
-0001ebc0: 756c 6174 6520 6c69 7175 6964 6174 696f  ulate liquidatio
-0001ebd0: 6e20 7072 6963 6520 666f 720a 2020 2020  n price for.    
-0001ebe0: 2020 2020 3a70 6172 616d 206f 7065 6e5f      :param open_
-0001ebf0: 7261 7465 3a20 456e 7472 7920 7072 6963  rate: Entry pric
-0001ec00: 6520 6f66 2070 6f73 6974 696f 6e0a 2020  e of position.  
-0001ec10: 2020 2020 2020 3a70 6172 616d 2069 735f        :param is_
-0001ec20: 7368 6f72 743a 2054 7275 6520 6966 2074  short: True if t
-0001ec30: 6865 2074 7261 6465 2069 7320 6120 7368  he trade is a sh
-0001ec40: 6f72 742c 2066 616c 7365 206f 7468 6572  ort, false other
-0001ec50: 7769 7365 0a20 2020 2020 2020 203a 7061  wise.        :pa
-0001ec60: 7261 6d20 616d 6f75 6e74 3a20 4162 736f  ram amount: Abso
-0001ec70: 6c75 7465 2076 616c 7565 206f 6620 706f  lute value of po
-0001ec80: 7369 7469 6f6e 2073 697a 6520 696e 636c  sition size incl
-0001ec90: 2e20 6c65 7665 7261 6765 2028 696e 2062  . leverage (in b
-0001eca0: 6173 6520 6375 7272 656e 6379 290a 2020  ase currency).  
-0001ecb0: 2020 2020 2020 3a70 6172 616d 2073 7461        :param sta
-0001ecc0: 6b65 5f61 6d6f 756e 743a 2053 7461 6b65  ke_amount: Stake
-0001ecd0: 2061 6d6f 756e 7420 2d20 436f 6c6c 6174   amount - Collat
-0001ece0: 6572 616c 2069 6e20 7365 7474 6c65 2063  eral in settle c
-0001ecf0: 7572 7265 6e63 792e 0a20 2020 2020 2020  urrency..       
-0001ed00: 203a 7061 7261 6d20 6c65 7665 7261 6765   :param leverage
-0001ed10: 3a20 4c65 7665 7261 6765 2075 7365 6420  : Leverage used 
-0001ed20: 666f 7220 7468 6973 2070 6f73 6974 696f  for this positio
-0001ed30: 6e2e 0a20 2020 2020 2020 203a 7061 7261  n..        :para
-0001ed40: 6d20 7472 6164 696e 675f 6d6f 6465 3a20  m trading_mode: 
-0001ed50: 5350 4f54 2c20 4d41 5247 494e 2c20 4655  SPOT, MARGIN, FU
-0001ed60: 5455 5245 532c 2065 7463 2e0a 2020 2020  TURES, etc..    
-0001ed70: 2020 2020 3a70 6172 616d 206d 6172 6769      :param margi
-0001ed80: 6e5f 6d6f 6465 3a20 4569 7468 6572 2049  n_mode: Either I
-0001ed90: 534f 4c41 5445 4420 6f72 2043 524f 5353  SOLATED or CROSS
-0001eda0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001edb0: 7761 6c6c 6574 5f62 616c 616e 6365 3a20  wallet_balance: 
-0001edc0: 416d 6f75 6e74 206f 6620 6d61 7267 696e  Amount of margin
-0001edd0: 5f6d 6f64 6520 696e 2074 6865 2077 616c  _mode in the wal
-0001ede0: 6c65 7420 6265 696e 6720 7573 6564 2074  let being used t
-0001edf0: 6f20 7472 6164 650a 2020 2020 2020 2020  o trade.        
-0001ee00: 2020 2020 4372 6f73 732d 4d61 7267 696e      Cross-Margin
-0001ee10: 204d 6f64 653a 2063 726f 7373 5761 6c6c   Mode: crossWall
-0001ee20: 6574 4261 6c61 6e63 650a 2020 2020 2020  etBalance.      
-0001ee30: 2020 2020 2020 4973 6f6c 6174 6564 2d4d        Isolated-M
-0001ee40: 6172 6769 6e20 4d6f 6465 3a20 6973 6f6c  argin Mode: isol
-0001ee50: 6174 6564 5761 6c6c 6574 4261 6c61 6e63  atedWalletBalanc
-0001ee60: 650a 0a20 2020 2020 2020 2023 202a 204e  e..        # * N
-0001ee70: 6f74 2072 6571 7569 7265 6420 6279 2047  ot required by G
-0001ee80: 6174 6520 6f72 204f 4b58 0a20 2020 2020  ate or OKX.     
-0001ee90: 2020 203a 7061 7261 6d20 6d6d 5f65 785f     :param mm_ex_
-0001eea0: 313a 0a20 2020 2020 2020 203a 7061 7261  1:.        :para
-0001eeb0: 6d20 7570 6e6c 5f65 785f 313a 0a20 2020  m upnl_ex_1:.   
-0001eec0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0001eed0: 2020 6d61 726b 6574 203d 2073 656c 662e    market = self.
-0001eee0: 6d61 726b 6574 735b 7061 6972 5d0a 2020  markets[pair].  
-0001eef0: 2020 2020 2020 7461 6b65 725f 6665 655f        taker_fee_
-0001ef00: 7261 7465 203d 206d 6172 6b65 745b 2774  rate = market['t
-0001ef10: 616b 6572 275d 0a20 2020 2020 2020 206d  aker'].        m
-0001ef20: 6d5f 7261 7469 6f2c 205f 203d 2073 656c  m_ratio, _ = sel
-0001ef30: 662e 6765 745f 6d61 696e 7465 6e61 6e63  f.get_maintenanc
-0001ef40: 655f 7261 7469 6f5f 616e 645f 616d 7428  e_ratio_and_amt(
-0001ef50: 7061 6972 2c20 7374 616b 655f 616d 6f75  pair, stake_amou
-0001ef60: 6e74 290a 0a20 2020 2020 2020 2069 6620  nt)..        if 
-0001ef70: 7365 6c66 2e74 7261 6469 6e67 5f6d 6f64  self.trading_mod
-0001ef80: 6520 3d3d 2054 7261 6469 6e67 4d6f 6465  e == TradingMode
-0001ef90: 2e46 5554 5552 4553 2061 6e64 2073 656c  .FUTURES and sel
-0001efa0: 662e 6d61 7267 696e 5f6d 6f64 6520 3d3d  f.margin_mode ==
-0001efb0: 204d 6172 6769 6e4d 6f64 652e 4953 4f4c   MarginMode.ISOL
-0001efc0: 4154 4544 3a0a 0a20 2020 2020 2020 2020  ATED:..         
-0001efd0: 2020 2069 6620 6d61 726b 6574 5b27 696e     if market['in
-0001efe0: 7665 7273 6527 5d3a 0a20 2020 2020 2020  verse']:.       
-0001eff0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-0001f000: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-0001f010: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0001f020: 2020 2020 2020 2020 2022 4672 6571 7472           "Freqtr
-0001f030: 6164 6520 646f 6573 206e 6f74 2079 6574  ade does not yet
-0001f040: 2073 7570 706f 7274 2069 6e76 6572 7365   support inverse
-0001f050: 2063 6f6e 7472 6163 7473 2229 0a0a 2020   contracts")..  
-0001f060: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-0001f070: 3d20 7761 6c6c 6574 5f62 616c 616e 6365  = wallet_balance
-0001f080: 202f 2061 6d6f 756e 740a 0a20 2020 2020   / amount..     
-0001f090: 2020 2020 2020 206d 6d5f 7261 7469 6f5f         mm_ratio_
-0001f0a0: 7461 6b65 7220 3d20 286d 6d5f 7261 7469  taker = (mm_rati
-0001f0b0: 6f20 2b20 7461 6b65 725f 6665 655f 7261  o + taker_fee_ra
-0001f0c0: 7465 290a 2020 2020 2020 2020 2020 2020  te).            
-0001f0d0: 6966 2069 735f 7368 6f72 743a 0a20 2020  if is_short:.   
-0001f0e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001f0f0: 7572 6e20 286f 7065 6e5f 7261 7465 202b  urn (open_rate +
-0001f100: 2076 616c 7565 2920 2f20 2831 202b 206d   value) / (1 + m
-0001f110: 6d5f 7261 7469 6f5f 7461 6b65 7229 0a20  m_ratio_taker). 
-0001f120: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001f130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f140: 2072 6574 7572 6e20 286f 7065 6e5f 7261   return (open_ra
-0001f150: 7465 202d 2076 616c 7565 2920 2f20 2831  te - value) / (1
-0001f160: 202d 206d 6d5f 7261 7469 6f5f 7461 6b65   - mm_ratio_take
-0001f170: 7229 0a20 2020 2020 2020 2065 6c73 653a  r).        else:
-0001f180: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001f190: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-0001f1a0: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
-0001f1b0: 2020 2020 2020 2020 2022 4672 6571 7472           "Freqtr
-0001f1c0: 6164 6520 6f6e 6c79 2073 7570 706f 7274  ade only support
-0001f1d0: 7320 6973 6f6c 6174 6564 2066 7574 7572  s isolated futur
-0001f1e0: 6573 2066 6f72 206c 6576 6572 6167 6520  es for leverage 
-0001f1f0: 7472 6164 696e 6722 290a 0a20 2020 2064  trading")..    d
-0001f200: 6566 2067 6574 5f6d 6169 6e74 656e 616e  ef get_maintenan
-0001f210: 6365 5f72 6174 696f 5f61 6e64 5f61 6d74  ce_ratio_and_amt
-0001f220: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0001f230: 2020 2020 2020 2020 7061 6972 3a20 7374          pair: st
-0001f240: 722c 0a20 2020 2020 2020 206e 6f6d 696e  r,.        nomin
-0001f250: 616c 5f76 616c 7565 3a20 666c 6f61 742c  al_value: float,
-0001f260: 0a20 2020 2029 202d 3e20 5475 706c 655b  .    ) -> Tuple[
-0001f270: 666c 6f61 742c 204f 7074 696f 6e61 6c5b  float, Optional[
-0001f280: 666c 6f61 745d 5d3a 0a20 2020 2020 2020  float]]:.       
-0001f290: 2022 2222 0a20 2020 2020 2020 2049 6d70   """.        Imp
-0001f2a0: 6f72 7461 6e74 3a20 4d75 7374 2062 6520  ortant: Must be 
-0001f2b0: 6665 7463 6869 6e67 2064 6174 6120 6672  fetching data fr
-0001f2c0: 6f6d 2063 6163 6865 6420 7661 6c75 6573  om cached values
-0001f2d0: 2061 7320 7468 6973 2069 7320 7573 6564   as this is used
-0001f2e0: 2062 7920 6261 636b 7465 7374 696e 6721   by backtesting!
-0001f2f0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001f300: 7061 6972 3a20 4d61 726b 6574 2073 796d  pair: Market sym
-0001f310: 626f 6c0a 2020 2020 2020 2020 3a70 6172  bol.        :par
-0001f320: 616d 206e 6f6d 696e 616c 5f76 616c 7565  am nominal_value
-0001f330: 3a20 5468 6520 746f 7461 6c20 7472 6164  : The total trad
-0001f340: 6520 616d 6f75 6e74 2069 6e20 7175 6f74  e amount in quot
-0001f350: 6520 6375 7272 656e 6379 2069 6e63 6c75  e currency inclu
-0001f360: 6469 6e67 206c 6576 6572 6167 650a 2020  ding leverage.  
-0001f370: 2020 2020 2020 6d61 696e 7465 6e61 6e63        maintenanc
-0001f380: 6520 616d 6f75 6e74 206f 6e6c 7920 6f6e  e amount only on
-0001f390: 2042 696e 616e 6365 0a20 2020 2020 2020   Binance.       
-0001f3a0: 203a 7265 7475 726e 3a20 286d 6169 6e74   :return: (maint
-0001f3b0: 656e 616e 6365 206d 6172 6769 6e20 7261  enance margin ra
-0001f3c0: 7469 6f2c 206d 6169 6e74 656e 616e 6365  tio, maintenance
-0001f3d0: 2061 6d6f 756e 7429 0a20 2020 2020 2020   amount).       
-0001f3e0: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
-0001f3f0: 2028 7365 6c66 2e5f 636f 6e66 6967 2e67   (self._config.g
-0001f400: 6574 2827 7275 6e6d 6f64 6527 2920 696e  et('runmode') in
-0001f410: 204f 5054 494d 495a 455f 4d4f 4445 530a   OPTIMIZE_MODES.
-0001f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f430: 6f72 2073 656c 662e 6578 6368 616e 6765  or self.exchange
-0001f440: 5f68 6173 2827 6665 7463 684c 6576 6572  _has('fetchLever
-0001f450: 6167 6554 6965 7273 2729 0a20 2020 2020  ageTiers').     
-0001f460: 2020 2020 2020 2020 2020 206f 7220 7365             or se
-0001f470: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
-0001f480: 2766 6574 6368 4d61 726b 6574 4c65 7665  'fetchMarketLeve
-0001f490: 7261 6765 5469 6572 7327 2929 3a0a 0a20  rageTiers')):.. 
-0001f4a0: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
-0001f4b0: 6972 206e 6f74 2069 6e20 7365 6c66 2e5f  ir not in self._
-0001f4c0: 6c65 7665 7261 6765 5f74 6965 7273 3a0a  leverage_tiers:.
-0001f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4e0: 7261 6973 6520 496e 7661 6c69 644f 7264  raise InvalidOrd
-0001f4f0: 6572 4578 6365 7074 696f 6e28 0a20 2020  erException(.   
-0001f500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f510: 2066 224d 6169 6e74 656e 616e 6365 206d   f"Maintenance m
-0001f520: 6172 6769 6e20 7261 7465 2066 6f72 207b  argin rate for {
-0001f530: 7061 6972 7d20 6973 2075 6e61 7661 696c  pair} is unavail
-0001f540: 6162 6c65 2066 6f72 207b 7365 6c66 2e6e  able for {self.n
-0001f550: 616d 657d 220a 2020 2020 2020 2020 2020  ame}".          
-0001f560: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0001f570: 2020 2020 2070 6169 725f 7469 6572 7320       pair_tiers 
-0001f580: 3d20 7365 6c66 2e5f 6c65 7665 7261 6765  = self._leverage
-0001f590: 5f74 6965 7273 5b70 6169 725d 0a0a 2020  _tiers[pair]..  
-0001f5a0: 2020 2020 2020 2020 2020 666f 7220 7469            for ti
-0001f5b0: 6572 2069 6e20 7265 7665 7273 6564 2870  er in reversed(p
-0001f5c0: 6169 725f 7469 6572 7329 3a0a 2020 2020  air_tiers):.    
-0001f5d0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001f5e0: 6f6d 696e 616c 5f76 616c 7565 203e 3d20  ominal_value >= 
-0001f5f0: 7469 6572 5b27 6d69 6e4e 6f74 696f 6e61  tier['minNotiona
-0001f600: 6c27 5d3a 0a20 2020 2020 2020 2020 2020  l']:.           
-0001f610: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001f620: 2874 6965 725b 276d 6169 6e74 656e 616e  (tier['maintenan
-0001f630: 6365 4d61 7267 696e 5261 7465 275d 2c20  ceMarginRate'], 
-0001f640: 7469 6572 5b27 6d61 696e 7441 6d74 275d  tier['maintAmt']
-0001f650: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
-0001f660: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
-0001f670: 4578 6365 7074 696f 6e28 226e 6f6d 696e  Exception("nomin
-0001f680: 616c 2076 616c 7565 2063 616e 206e 6f74  al value can not
-0001f690: 2062 6520 6c6f 7765 7220 7468 616e 2030   be lower than 0
-0001f6a0: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-0001f6b0: 2054 6865 206c 6f77 6573 7420 6e6f 7469   The lowest noti
-0001f6c0: 6f6e 616c 5f66 6c6f 6f72 2066 6f72 2061  onal_floor for a
-0001f6d0: 6e79 2070 6169 7220 696e 2066 6574 6368  ny pair in fetch
-0001f6e0: 5f6c 6576 6572 6167 655f 7469 6572 7320  _leverage_tiers 
-0001f6f0: 6973 2061 6c77 6179 7320 3020 6265 6361  is always 0 beca
-0001f700: 7573 6520 6974 0a20 2020 2020 2020 2020  use it.         
-0001f710: 2020 2023 2064 6573 6372 6962 6573 2074     # describes t
-0001f720: 6865 206d 696e 2061 6d74 2066 6f72 2061  he min amt for a
-0001f730: 2074 6965 722c 2061 6e64 2074 6865 206c   tier, and the l
-0001f740: 6f77 6573 7420 7469 6572 2077 696c 6c20  owest tier will 
-0001f750: 616c 7761 7973 2067 6f20 646f 776e 2074  always go down t
-0001f760: 6f20 300a 2020 2020 2020 2020 656c 7365  o 0.        else
-0001f770: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0001f780: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-0001f790: 7863 6570 7469 6f6e 2866 2243 616e 6e6f  xception(f"Canno
-0001f7a0: 7420 6765 7420 6d61 696e 7465 6e61 6e63  t get maintenanc
-0001f7b0: 6520 7261 7469 6f20 7573 696e 6720 7b73  e ratio using {s
-0001f7c0: 656c 662e 6e61 6d65 7d22 290a            elf.name}").
+0001b8f0: 2020 2020 2023 0a20 2020 2020 2020 2020       #.         
+0001b900: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001b910: 2057 6974 6820 7468 6520 7477 6f20 6c65   With the two le
+0001b920: 7665 7261 6765 2074 6965 7273 2062 656c  verage tiers bel
+0001b930: 6f77 2c0a 2020 2020 2020 2020 2020 2020  ow,.            
+0001b940: 2020 2020 2020 2020 2020 2020 2320 2d20              # - 
+0001b950: 6120 7374 616b 6520 616d 6f75 6e74 206f  a stake amount o
+0001b960: 6620 3135 3020 776f 756c 6420 6d65 616e  f 150 would mean
+0001b970: 2061 206d 6178 206c 6576 6572 6167 6520   a max leverage 
+0001b980: 6f66 2028 3130 3030 3020 2f20 3135 3029  of (10000 / 150)
+0001b990: 203d 2036 362e 3636 0a20 2020 2020 2020   = 66.66.       
+0001b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9b0: 2023 202d 2073 7461 6b65 7320 6265 6c6f   # - stakes belo
+0001b9c0: 7720 3133 332e 3333 203d 206d 6178 5f6c  w 133.33 = max_l
+0001b9d0: 6576 206f 6620 3735 0a20 2020 2020 2020  ev of 75.       
+0001b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9f0: 2023 202d 2073 7461 6b65 7320 6265 7477   # - stakes betw
+0001ba00: 6565 6e20 3133 332e 3333 2d32 3030 203d  een 133.33-200 =
+0001ba10: 206d 6178 5f6c 6576 206f 6620 3130 3030   max_lev of 1000
+0001ba20: 302f 7374 616b 6520 3d20 3530 2e30 312d  0/stake = 50.01-
+0001ba30: 3734 2e39 390a 2020 2020 2020 2020 2020  74.99.          
+0001ba40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001ba50: 2d20 7374 616b 6573 2066 726f 6d20 3230  - stakes from 20
+0001ba60: 3020 2b20 3130 3030 203d 206d 6178 5f6c  0 + 1000 = max_l
+0001ba70: 6576 206f 6620 3530 0a20 2020 2020 2020  ev of 50.       
+0001ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba90: 2023 0a20 2020 2020 2020 2020 2020 2020   #.             
+0001baa0: 2020 2020 2020 2020 2020 2023 207b 0a20             # {. 
+0001bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bac0: 2020 2020 2020 2023 2020 2020 2022 6d69         #     "mi
+0001bad0: 6e22 3a20 302c 2020 2020 2020 2320 7374  n": 0,      # st
+0001bae0: 616b 6520 3d20 302e 300a 2020 2020 2020  ake = 0.0.      
+0001baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb00: 2020 2320 2020 2020 226d 6178 223a 2031    #     "max": 1
+0001bb10: 3030 3030 2c20 2023 206d 6178 5f73 7461  0000,  # max_sta
+0001bb20: 6b65 4037 3520 3d20 3130 3030 302f 3735  ke@75 = 10000/75
+0001bb30: 203d 2031 3333 2e33 3333 3333 3333 3333   = 133.333333333
+0001bb40: 3333 3333 340a 2020 2020 2020 2020 2020  33334.          
+0001bb50: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001bb60: 2020 2020 226c 6576 223a 2037 352c 0a20      "lev": 75,. 
+0001bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb80: 2020 2020 2020 2023 207d 2c0a 2020 2020         # },.    
+0001bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bba0: 2020 2020 2320 7b0a 2020 2020 2020 2020      # {.        
+0001bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbc0: 2320 2020 2020 226d 696e 223a 2031 3030  #     "min": 100
+0001bbd0: 3030 2c20 2023 2073 7461 6b65 203d 2032  00,  # stake = 2
+0001bbe0: 3030 2e30 0a20 2020 2020 2020 2020 2020  00.0.           
+0001bbf0: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+0001bc00: 2020 2022 6d61 7822 3a20 3530 3030 302c     "max": 50000,
+0001bc10: 2020 2320 6d61 785f 7374 616b 6540 3530    # max_stake@50
+0001bc20: 203d 2035 3030 3030 2f35 3020 3d20 3130   = 50000/50 = 10
+0001bc30: 3030 2e30 0a20 2020 2020 2020 2020 2020  00.0.           
+0001bc40: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+0001bc50: 2020 2022 6c65 7622 3a20 3530 2c0a 2020     "lev": 50,.  
+0001bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc70: 2020 2020 2020 2320 7d0a 2020 2020 2020        # }.      
+0001bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc90: 2020 230a 0a20 2020 2020 2020 2020 2020    #..           
+0001bca0: 2020 2020 2065 6c73 653a 2020 2320 6966       else:  # if
+0001bcb0: 206f 6e20 7468 6520 6c61 7374 2074 6965   on the last tie
+0001bcc0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+0001bcd0: 2020 2020 2020 6966 2073 7461 6b65 5f61        if stake_a
+0001bce0: 6d6f 756e 7420 3e20 7469 6572 5b27 6d61  mount > tier['ma
+0001bcf0: 784e 6f74 696f 6e61 6c27 5d3a 0a20 2020  xNotional']:.   
+0001bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd10: 2020 2020 2023 2049 6620 7374 616b 6520       # If stake 
+0001bd20: 6973 203e 2074 6861 6e20 6d61 7820 7472  is > than max tr
+0001bd30: 6164 6561 626c 6520 616d 6f75 6e74 0a20  adeable amount. 
+0001bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd50: 2020 2020 2020 2072 6169 7365 2049 6e76         raise Inv
+0001bd60: 616c 6964 4f72 6465 7245 7863 6570 7469  alidOrderExcepti
+0001bd70: 6f6e 2866 2741 6d6f 756e 7420 7b73 7461  on(f'Amount {sta
+0001bd80: 6b65 5f61 6d6f 756e 747d 2074 6f6f 2068  ke_amount} too h
+0001bd90: 6967 6820 666f 7220 7b70 6169 727d 2729  igh for {pair}')
+0001bda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bdb0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bdd0: 2020 2072 6574 7572 6e20 7469 6572 5b27     return tier['
+0001bde0: 6d61 784c 6576 6572 6167 6527 5d0a 0a20  maxLeverage'].. 
+0001bdf0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001be00: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+0001be10: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+0001be20: 2020 2020 2020 2027 4c6f 6f70 6564 2074         'Looped t
+0001be30: 6872 6f75 6768 2061 6c6c 2074 6965 7273  hrough all tiers
+0001be40: 2077 6974 686f 7574 2066 696e 6469 6e67   without finding
+0001be50: 2061 206d 6178 206c 6576 6572 6167 652e   a max leverage.
+0001be60: 2053 686f 756c 6420 6e65 7665 7220 6265   Should never be
+0001be70: 2072 6561 6368 6564 270a 2020 2020 2020   reached'.      
+0001be80: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0001be90: 2065 6c69 6620 7365 6c66 2e74 7261 6469   elif self.tradi
+0001bea0: 6e67 5f6d 6f64 6520 3d3d 2054 7261 6469  ng_mode == Tradi
+0001beb0: 6e67 4d6f 6465 2e4d 4152 4749 4e3a 2020  ngMode.MARGIN:  
+0001bec0: 2320 5365 6172 6368 206d 6172 6b65 7473  # Search markets
+0001bed0: 2e6c 696d 6974 7320 666f 7220 6d61 7820  .limits for max 
+0001bee0: 6c65 760a 2020 2020 2020 2020 2020 2020  lev.            
+0001bef0: 6d61 726b 6574 203d 2073 656c 662e 6d61  market = self.ma
+0001bf00: 726b 6574 735b 7061 6972 5d0a 2020 2020  rkets[pair].    
+0001bf10: 2020 2020 2020 2020 6966 206d 6172 6b65          if marke
+0001bf20: 745b 276c 696d 6974 7327 5d5b 276c 6576  t['limits']['lev
+0001bf30: 6572 6167 6527 5d5b 276d 6178 275d 2069  erage']['max'] i
+0001bf40: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0001bf50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001bf60: 726e 206d 6172 6b65 745b 276c 696d 6974  rn market['limit
+0001bf70: 7327 5d5b 276c 6576 6572 6167 6527 5d5b  s']['leverage'][
+0001bf80: 276d 6178 275d 0a20 2020 2020 2020 2020  'max'].         
+0001bf90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001bfa0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001bfb0: 312e 3020 2023 2044 6566 6175 6c74 2069  1.0  # Default i
+0001bfc0: 6620 6d61 7820 6c65 7665 7261 6765 2063  f max leverage c
+0001bfd0: 616e 6e6f 7420 6265 2066 6f75 6e64 0a20  annot be found. 
+0001bfe0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001bff0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001c000: 312e 300a 0a20 2020 2040 7265 7472 6965  1.0..    @retrie
+0001c010: 720a 2020 2020 6465 6620 5f73 6574 5f6c  r.    def _set_l
+0001c020: 6576 6572 6167 6528 0a20 2020 2020 2020  everage(.       
+0001c030: 2073 656c 662c 0a20 2020 2020 2020 206c   self,.        l
+0001c040: 6576 6572 6167 653a 2066 6c6f 6174 2c0a  everage: float,.
+0001c050: 2020 2020 2020 2020 7061 6972 3a20 4f70          pair: Op
+0001c060: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+0001c070: 6e65 2c0a 2020 2020 2020 2020 6163 6365  ne,.        acce
+0001c080: 7074 5f66 6169 6c3a 2062 6f6f 6c20 3d20  pt_fail: bool = 
+0001c090: 4661 6c73 652c 0a20 2020 2029 3a0a 2020  False,.    ):.  
+0001c0a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001c0b0: 2020 5365 7427 7320 7468 6520 6c65 7665    Set's the leve
+0001c0c0: 7261 6765 2062 6566 6f72 6520 6d61 6b69  rage before maki
+0001c0d0: 6e67 2061 2074 7261 6465 2c20 696e 206f  ng a trade, in o
+0001c0e0: 7264 6572 2074 6f20 6e6f 740a 2020 2020  rder to not.    
+0001c0f0: 2020 2020 6861 7665 2074 6865 2073 616d      have the sam
+0001c100: 6520 6c65 7665 7261 6765 206f 6e20 6576  e leverage on ev
+0001c110: 6572 7920 7472 6164 650a 2020 2020 2020  ery trade.      
+0001c120: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0001c130: 2073 656c 662e 5f63 6f6e 6669 675b 2764   self._config['d
+0001c140: 7279 5f72 756e 275d 206f 7220 6e6f 7420  ry_run'] or not 
+0001c150: 7365 6c66 2e65 7863 6861 6e67 655f 6861  self.exchange_ha
+0001c160: 7328 2273 6574 4c65 7665 7261 6765 2229  s("setLeverage")
+0001c170: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001c180: 536f 6d65 2065 7863 6861 6e67 6573 206f  Some exchanges o
+0001c190: 6e6c 7920 7375 7070 6f72 7420 6f6e 6520  nly support one 
+0001c1a0: 6d61 7267 696e 5f6d 6f64 6520 7479 7065  margin_mode type
+0001c1b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001c1c0: 7572 6e0a 2020 2020 2020 2020 6966 2073  urn.        if s
+0001c1d0: 656c 662e 5f66 745f 6861 732e 6765 7428  elf._ft_has.get(
+0001c1e0: 2766 6c6f 6f72 5f6c 6576 6572 6167 6527  'floor_leverage'
+0001c1f0: 2c20 4661 6c73 6529 2069 7320 5472 7565  , False) is True
+0001c200: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001c210: 526f 756e 6469 6e67 2066 6f72 2062 696e  Rounding for bin
+0001c220: 616e 6365 202e 2e2e 0a20 2020 2020 2020  ance ....       
+0001c230: 2020 2020 206c 6576 6572 6167 6520 3d20       leverage = 
+0001c240: 666c 6f6f 7228 6c65 7665 7261 6765 290a  floor(leverage).
+0001c250: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001c260: 2020 2020 2020 2020 2072 6573 203d 2073           res = s
+0001c270: 656c 662e 5f61 7069 2e73 6574 5f6c 6576  elf._api.set_lev
+0001c280: 6572 6167 6528 7379 6d62 6f6c 3d70 6169  erage(symbol=pai
+0001c290: 722c 206c 6576 6572 6167 653d 6c65 7665  r, leverage=leve
+0001c2a0: 7261 6765 290a 2020 2020 2020 2020 2020  rage).          
+0001c2b0: 2020 7365 6c66 2e5f 6c6f 675f 6578 6368    self._log_exch
+0001c2c0: 616e 6765 5f72 6573 706f 6e73 6528 2773  ange_response('s
+0001c2d0: 6574 5f6c 6576 6572 6167 6527 2c20 7265  et_leverage', re
+0001c2e0: 7329 0a20 2020 2020 2020 2065 7863 6570  s).        excep
+0001c2f0: 7420 6363 7874 2e44 446f 5350 726f 7465  t ccxt.DDoSProte
+0001c300: 6374 696f 6e20 6173 2065 3a0a 2020 2020  ction as e:.    
+0001c310: 2020 2020 2020 2020 7261 6973 6520 4444          raise DD
+0001c320: 6f73 5072 6f74 6563 7469 6f6e 2865 2920  osProtection(e) 
+0001c330: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+0001c340: 7863 6570 7420 2863 6378 742e 4261 6452  xcept (ccxt.BadR
+0001c350: 6571 7565 7374 2c20 6363 7874 2e49 6e73  equest, ccxt.Ins
+0001c360: 7566 6669 6369 656e 7446 756e 6473 2920  ufficientFunds) 
+0001c370: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001c380: 2020 6966 206e 6f74 2061 6363 6570 745f    if not accept_
+0001c390: 6661 696c 3a0a 2020 2020 2020 2020 2020  fail:.          
+0001c3a0: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
+0001c3b0: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
+0001c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3d0: 6627 436f 756c 6420 6e6f 7420 7365 7420  f'Could not set 
+0001c3e0: 6c65 7665 7261 6765 2064 7565 2074 6f20  leverage due to 
+0001c3f0: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+0001c400: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+0001c410: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+0001c420: 2020 2020 2020 6578 6365 7074 2028 6363        except (cc
+0001c430: 7874 2e4e 6574 776f 726b 4572 726f 722c  xt.NetworkError,
+0001c440: 2063 6378 742e 4578 6368 616e 6765 4572   ccxt.ExchangeEr
+0001c450: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
+0001c460: 2020 2020 2020 2072 6169 7365 2054 656d         raise Tem
+0001c470: 706f 7261 7279 4572 726f 7228 0a20 2020  poraryError(.   
+0001c480: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
+0001c490: 6f75 6c64 206e 6f74 2073 6574 206c 6576  ould not set lev
+0001c4a0: 6572 6167 6520 6475 6520 746f 207b 652e  erage due to {e.
+0001c4b0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0001c4c0: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
+0001c4d0: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+0001c4e0: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
+0001c4f0: 6173 6545 7272 6f72 2061 7320 653a 0a20  aseError as e:. 
+0001c500: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001c510: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+0001c520: 7074 696f 6e28 6529 2066 726f 6d20 650a  ption(e) from e.
+0001c530: 0a20 2020 2064 6566 2067 6574 5f69 6e74  .    def get_int
+0001c540: 6572 6573 745f 7261 7465 2873 656c 6629  erest_rate(self)
+0001c550: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
+0001c560: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+0001c570: 6574 7269 6576 6520 696e 7465 7265 7374  etrieve interest
+0001c580: 2072 6174 6520 2d20 6e65 6365 7373 6172   rate - necessar
+0001c590: 7920 666f 7220 4d61 7267 696e 2074 7261  y for Margin tra
+0001c5a0: 6469 6e67 2e0a 2020 2020 2020 2020 5368  ding..        Sh
+0001c5b0: 6f75 6c64 206e 6f74 2063 616c 6c20 7468  ould not call th
+0001c5c0: 6520 6578 6368 616e 6765 2064 6972 6563  e exchange direc
+0001c5d0: 746c 7920 7768 656e 2075 7365 6420 6672  tly when used fr
+0001c5e0: 6f6d 2062 6163 6b74 6573 7469 6e67 2e0a  om backtesting..
+0001c5f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001c600: 2020 2020 7265 7475 726e 2030 2e30 0a0a      return 0.0..
+0001c610: 2020 2020 6465 6620 6675 6e64 696e 675f      def funding_
+0001c620: 6665 655f 6375 746f 6666 2873 656c 662c  fee_cutoff(self,
+0001c630: 206f 7065 6e5f 6461 7465 3a20 6461 7465   open_date: date
+0001c640: 7469 6d65 293a 0a20 2020 2020 2020 2022  time):.        "
+0001c650: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
+0001c660: 6d20 6f70 656e 5f64 6174 653a 2054 6865  m open_date: The
+0001c670: 206f 7065 6e20 6461 7465 2066 6f72 2061   open date for a
+0001c680: 2074 7261 6465 0a20 2020 2020 2020 203a   trade.        :
+0001c690: 7265 7475 726e 3a20 5468 6520 6375 746f  return: The cuto
+0001c6a0: 6666 206f 7065 6e20 7469 6d65 2066 6f72  ff open time for
+0001c6b0: 2077 6865 6e20 6120 6675 6e64 696e 6720   when a funding 
+0001c6c0: 6665 6520 6973 2063 6861 7267 6564 0a20  fee is charged. 
+0001c6d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001c6e0: 2020 2072 6574 7572 6e20 6f70 656e 5f64     return open_d
+0001c6f0: 6174 652e 6d69 6e75 7465 203e 2030 206f  ate.minute > 0 o
+0001c700: 7220 6f70 656e 5f64 6174 652e 7365 636f  r open_date.seco
+0001c710: 6e64 203e 2030 0a0a 2020 2020 4072 6574  nd > 0..    @ret
+0001c720: 7269 6572 0a20 2020 2064 6566 2073 6574  rier.    def set
+0001c730: 5f6d 6172 6769 6e5f 6d6f 6465 2873 656c  _margin_mode(sel
+0001c740: 662c 2070 6169 723a 2073 7472 2c20 6d61  f, pair: str, ma
+0001c750: 7267 696e 5f6d 6f64 653a 204d 6172 6769  rgin_mode: Margi
+0001c760: 6e4d 6f64 652c 2061 6363 6570 745f 6661  nMode, accept_fa
+0001c770: 696c 3a20 626f 6f6c 203d 2046 616c 7365  il: bool = False
+0001c780: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c790: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+0001c7a0: 3a20 6469 6374 203d 207b 7d29 3a0a 2020  : dict = {}):.  
+0001c7b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001c7c0: 2020 5365 7427 7320 7468 6520 6d61 7267    Set's the marg
+0001c7d0: 696e 206d 6f64 6520 6f6e 2074 6865 2065  in mode on the e
+0001c7e0: 7863 6861 6e67 6520 746f 2063 726f 7373  xchange to cross
+0001c7f0: 206f 7220 6973 6f6c 6174 6564 2066 6f72   or isolated for
+0001c800: 2061 2073 7065 6369 6669 6320 7061 6972   a specific pair
+0001c810: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001c820: 7061 6972 3a20 6261 7365 2f71 756f 7465  pair: base/quote
+0001c830: 2063 7572 7265 6e63 7920 7061 6972 2028   currency pair (
+0001c840: 652e 672e 2022 4144 412f 5553 4454 2229  e.g. "ADA/USDT")
+0001c850: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001c860: 2020 2020 2069 6620 7365 6c66 2e5f 636f       if self._co
+0001c870: 6e66 6967 5b27 6472 795f 7275 6e27 5d20  nfig['dry_run'] 
+0001c880: 6f72 206e 6f74 2073 656c 662e 6578 6368  or not self.exch
+0001c890: 616e 6765 5f68 6173 2822 7365 744d 6172  ange_has("setMar
+0001c8a0: 6769 6e4d 6f64 6522 293a 0a20 2020 2020  ginMode"):.     
+0001c8b0: 2020 2020 2020 2023 2053 6f6d 6520 6578         # Some ex
+0001c8c0: 6368 616e 6765 7320 6f6e 6c79 2073 7570  changes only sup
+0001c8d0: 706f 7274 206f 6e65 206d 6172 6769 6e5f  port one margin_
+0001c8e0: 6d6f 6465 2074 7970 650a 2020 2020 2020  mode type.      
+0001c8f0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+0001c900: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001c910: 2020 2020 2020 2072 6573 203d 2073 656c         res = sel
+0001c920: 662e 5f61 7069 2e73 6574 5f6d 6172 6769  f._api.set_margi
+0001c930: 6e5f 6d6f 6465 286d 6172 6769 6e5f 6d6f  n_mode(margin_mo
+0001c940: 6465 2e76 616c 7565 2c20 7061 6972 2c20  de.value, pair, 
+0001c950: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+0001c960: 2020 2020 7365 6c66 2e5f 6c6f 675f 6578      self._log_ex
+0001c970: 6368 616e 6765 5f72 6573 706f 6e73 6528  change_response(
+0001c980: 2773 6574 5f6d 6172 6769 6e5f 6d6f 6465  'set_margin_mode
+0001c990: 272c 2072 6573 290a 2020 2020 2020 2020  ', res).        
+0001c9a0: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+0001c9b0: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+0001c9c0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001c9d0: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+0001c9e0: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+0001c9f0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+0001ca00: 4261 6452 6571 7565 7374 2061 7320 653a  BadRequest as e:
+0001ca10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001ca20: 6e6f 7420 6163 6365 7074 5f66 6169 6c3a  not accept_fail:
+0001ca30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ca40: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
+0001ca50: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0001ca60: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+0001ca70: 6c64 206e 6f74 2073 6574 206d 6172 6769  ld not set margi
+0001ca80: 6e20 6d6f 6465 2064 7565 2074 6f20 7b65  n mode due to {e
+0001ca90: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+0001caa0: 655f 5f7d 2e20 4d65 7373 6167 653a 207b  e__}. Message: {
+0001cab0: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+0001cac0: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+0001cad0: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
+0001cae0: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
+0001caf0: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
+0001cb00: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
+0001cb10: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
+0001cb20: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+0001cb30: 6c64 206e 6f74 2073 6574 206d 6172 6769  ld not set margi
+0001cb40: 6e20 6d6f 6465 2064 7565 2074 6f20 7b65  n mode due to {e
+0001cb50: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+0001cb60: 655f 5f7d 2e20 4d65 7373 6167 653a 207b  e__}. Message: {
+0001cb70: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+0001cb80: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+0001cb90: 4261 7365 4572 726f 7220 6173 2065 3a0a  BaseError as e:.
+0001cba0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001cbb0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+0001cbc0: 6570 7469 6f6e 2865 2920 6672 6f6d 2065  eption(e) from e
+0001cbd0: 0a0a 2020 2020 6465 6620 5f66 6574 6368  ..    def _fetch
+0001cbe0: 5f61 6e64 5f63 616c 6375 6c61 7465 5f66  _and_calculate_f
+0001cbf0: 756e 6469 6e67 5f66 6565 7328 0a20 2020  unding_fees(.   
+0001cc00: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0001cc10: 2020 2070 6169 723a 2073 7472 2c0a 2020     pair: str,.  
+0001cc20: 2020 2020 2020 616d 6f75 6e74 3a20 666c        amount: fl
+0001cc30: 6f61 742c 0a20 2020 2020 2020 2069 735f  oat,.        is_
+0001cc40: 7368 6f72 743a 2062 6f6f 6c2c 0a20 2020  short: bool,.   
+0001cc50: 2020 2020 206f 7065 6e5f 6461 7465 3a20       open_date: 
+0001cc60: 6461 7465 7469 6d65 2c0a 2020 2020 2020  datetime,.      
+0001cc70: 2020 636c 6f73 655f 6461 7465 3a20 4f70    close_date: Op
+0001cc80: 7469 6f6e 616c 5b64 6174 6574 696d 655d  tional[datetime]
+0001cc90: 203d 204e 6f6e 650a 2020 2020 2920 2d3e   = None.    ) ->
+0001cca0: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
+0001ccb0: 2222 220a 2020 2020 2020 2020 4665 7463  """.        Fetc
+0001ccc0: 6865 7320 616e 6420 6361 6c63 756c 6174  hes and calculat
+0001ccd0: 6573 2074 6865 2073 756d 206f 6620 616c  es the sum of al
+0001cce0: 6c20 6675 6e64 696e 6720 6665 6573 2074  l funding fees t
+0001ccf0: 6861 7420 6f63 6375 7272 6564 2066 6f72  hat occurred for
+0001cd00: 2061 2070 6169 720a 2020 2020 2020 2020   a pair.        
+0001cd10: 6475 7269 6e67 2061 2066 7574 7572 6573  during a futures
+0001cd20: 2074 7261 6465 2e0a 2020 2020 2020 2020   trade..        
+0001cd30: 4f6e 6c79 2075 7365 6420 6475 7269 6e67  Only used during
+0001cd40: 2064 7279 2d72 756e 206f 7220 6966 2074   dry-run or if t
+0001cd50: 6865 2065 7863 6861 6e67 6520 646f 6573  he exchange does
+0001cd60: 206e 6f74 2070 726f 7669 6465 2061 2066   not provide a f
+0001cd70: 756e 6469 6e67 5f72 6174 6573 2065 6e64  unding_rates end
+0001cd80: 706f 696e 742e 0a20 2020 2020 2020 203a  point..        :
+0001cd90: 7061 7261 6d20 7061 6972 3a20 5468 6520  param pair: The 
+0001cda0: 7175 6f74 652f 6261 7365 2070 6169 7220  quote/base pair 
+0001cdb0: 6f66 2074 6865 2074 7261 6465 0a20 2020  of the trade.   
+0001cdc0: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
+0001cdd0: 6e74 3a20 5468 6520 7175 616e 7469 7479  nt: The quantity
+0001cde0: 206f 6620 7468 6520 7472 6164 650a 2020   of the trade.  
+0001cdf0: 2020 2020 2020 3a70 6172 616d 2069 735f        :param is_
+0001ce00: 7368 6f72 743a 2074 7261 6465 2064 6972  short: trade dir
+0001ce10: 6563 7469 6f6e 0a20 2020 2020 2020 203a  ection.        :
+0001ce20: 7061 7261 6d20 6f70 656e 5f64 6174 653a  param open_date:
+0001ce30: 2054 6865 2064 6174 6520 616e 6420 7469   The date and ti
+0001ce40: 6d65 2074 6861 7420 7468 6520 7472 6164  me that the trad
+0001ce50: 6520 7374 6172 7465 640a 2020 2020 2020  e started.      
+0001ce60: 2020 3a70 6172 616d 2063 6c6f 7365 5f64    :param close_d
+0001ce70: 6174 653a 2054 6865 2064 6174 6520 616e  ate: The date an
+0001ce80: 6420 7469 6d65 2074 6861 7420 7468 6520  d time that the 
+0001ce90: 7472 6164 6520 656e 6465 640a 2020 2020  trade ended.    
+0001cea0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0001ceb0: 2069 6620 7365 6c66 2e66 756e 6469 6e67   if self.funding
+0001cec0: 5f66 6565 5f63 7574 6f66 6628 6f70 656e  _fee_cutoff(open
+0001ced0: 5f64 6174 6529 3a0a 2020 2020 2020 2020  _date):.        
+0001cee0: 2020 2020 6f70 656e 5f64 6174 6520 2b3d      open_date +=
+0001cef0: 2074 696d 6564 656c 7461 2868 6f75 7273   timedelta(hours
+0001cf00: 3d31 290a 2020 2020 2020 2020 7469 6d65  =1).        time
+0001cf10: 6672 616d 6520 3d20 7365 6c66 2e5f 6674  frame = self._ft
+0001cf20: 5f68 6173 5b27 6d61 726b 5f6f 686c 6376  _has['mark_ohlcv
+0001cf30: 5f74 696d 6566 7261 6d65 275d 0a20 2020  _timeframe'].   
+0001cf40: 2020 2020 2074 696d 6566 7261 6d65 5f66       timeframe_f
+0001cf50: 6620 3d20 7365 6c66 2e5f 6674 5f68 6173  f = self._ft_has
+0001cf60: 2e67 6574 2827 6675 6e64 696e 675f 6665  .get('funding_fe
+0001cf70: 655f 7469 6d65 6672 616d 6527 2c0a 2020  e_timeframe',.  
+0001cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfa0: 2020 2020 2020 7365 6c66 2e5f 6674 5f68        self._ft_h
+0001cfb0: 6173 5b27 6d61 726b 5f6f 686c 6376 5f74  as['mark_ohlcv_t
+0001cfc0: 696d 6566 7261 6d65 275d 290a 0a20 2020  imeframe'])..   
+0001cfd0: 2020 2020 2069 6620 6e6f 7420 636c 6f73       if not clos
+0001cfe0: 655f 6461 7465 3a0a 2020 2020 2020 2020  e_date:.        
+0001cff0: 2020 2020 636c 6f73 655f 6461 7465 203d      close_date =
+0001d000: 2064 6174 6574 696d 652e 6e6f 7728 7469   datetime.now(ti
+0001d010: 6d65 7a6f 6e65 2e75 7463 290a 2020 2020  mezone.utc).    
+0001d020: 2020 2020 6f70 656e 5f74 696d 6573 7461      open_timesta
+0001d030: 6d70 203d 2069 6e74 2874 696d 6566 7261  mp = int(timefra
+0001d040: 6d65 5f74 6f5f 7072 6576 5f64 6174 6528  me_to_prev_date(
+0001d050: 7469 6d65 6672 616d 652c 206f 7065 6e5f  timeframe, open_
+0001d060: 6461 7465 292e 7469 6d65 7374 616d 7028  date).timestamp(
+0001d070: 2929 202a 2031 3030 300a 2020 2020 2020  )) * 1000.      
+0001d080: 2020 2320 636c 6f73 655f 7469 6d65 7374    # close_timest
+0001d090: 616d 7020 3d20 696e 7428 636c 6f73 655f  amp = int(close_
+0001d0a0: 6461 7465 2e74 696d 6573 7461 6d70 2829  date.timestamp()
+0001d0b0: 2920 2a20 3130 3030 0a0a 2020 2020 2020  ) * 1000..      
+0001d0c0: 2020 6d61 726b 5f63 6f6d 623a 2050 6169    mark_comb: Pai
+0001d0d0: 7257 6974 6854 696d 6566 7261 6d65 203d  rWithTimeframe =
+0001d0e0: 2028 0a20 2020 2020 2020 2020 2020 2070   (.            p
+0001d0f0: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
+0001d100: 4361 6e64 6c65 5479 7065 2e66 726f 6d5f  CandleType.from_
+0001d110: 7374 7269 6e67 2873 656c 662e 5f66 745f  string(self._ft_
+0001d120: 6861 735b 226d 6172 6b5f 6f68 6c63 765f  has["mark_ohlcv_
+0001d130: 7072 6963 6522 5d29 290a 0a20 2020 2020  price"]))..     
+0001d140: 2020 2066 756e 6469 6e67 5f63 6f6d 623a     funding_comb:
+0001d150: 2050 6169 7257 6974 6854 696d 6566 7261   PairWithTimefra
+0001d160: 6d65 203d 2028 7061 6972 2c20 7469 6d65  me = (pair, time
+0001d170: 6672 616d 655f 6666 2c20 4361 6e64 6c65  frame_ff, Candle
+0001d180: 5479 7065 2e46 554e 4449 4e47 5f52 4154  Type.FUNDING_RAT
+0001d190: 4529 0a20 2020 2020 2020 2063 616e 646c  E).        candl
+0001d1a0: 655f 6869 7374 6f72 6965 7320 3d20 7365  e_histories = se
+0001d1b0: 6c66 2e72 6566 7265 7368 5f6c 6174 6573  lf.refresh_lates
+0001d1c0: 745f 6f68 6c63 7628 0a20 2020 2020 2020  t_ohlcv(.       
+0001d1d0: 2020 2020 205b 6d61 726b 5f63 6f6d 622c       [mark_comb,
+0001d1e0: 2066 756e 6469 6e67 5f63 6f6d 625d 2c0a   funding_comb],.
+0001d1f0: 2020 2020 2020 2020 2020 2020 7369 6e63              sinc
+0001d200: 655f 6d73 3d6f 7065 6e5f 7469 6d65 7374  e_ms=open_timest
+0001d210: 616d 702c 0a20 2020 2020 2020 2020 2020  amp,.           
+0001d220: 2063 6163 6865 3d46 616c 7365 2c0a 2020   cache=False,.  
+0001d230: 2020 2020 2020 2020 2020 6472 6f70 5f69            drop_i
+0001d240: 6e63 6f6d 706c 6574 653d 4661 6c73 652c  ncomplete=False,
+0001d250: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0001d260: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001d270: 2020 2020 2320 7765 2063 616e 2774 2061      # we can't a
+0001d280: 7373 756d 6520 7765 2061 6c77 6179 7320  ssume we always 
+0001d290: 6765 7420 6869 7374 6f72 6965 7320 2d20  get histories - 
+0001d2a0: 666f 7220 6578 616d 706c 6520 6475 7269  for example duri
+0001d2b0: 6e67 2065 7863 6861 6e67 6520 646f 776e  ng exchange down
+0001d2c0: 7469 6d65 730a 2020 2020 2020 2020 2020  times.          
+0001d2d0: 2020 6675 6e64 696e 675f 7261 7465 7320    funding_rates 
+0001d2e0: 3d20 6361 6e64 6c65 5f68 6973 746f 7269  = candle_histori
+0001d2f0: 6573 5b66 756e 6469 6e67 5f63 6f6d 625d  es[funding_comb]
+0001d300: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
+0001d310: 6b5f 7261 7465 7320 3d20 6361 6e64 6c65  k_rates = candle
+0001d320: 5f68 6973 746f 7269 6573 5b6d 6172 6b5f  _histories[mark_
+0001d330: 636f 6d62 5d0a 2020 2020 2020 2020 6578  comb].        ex
+0001d340: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
+0001d350: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001d360: 2045 7863 6861 6e67 6545 7272 6f72 2822   ExchangeError("
+0001d370: 436f 756c 6420 6e6f 7420 6669 6e64 2066  Could not find f
+0001d380: 756e 6469 6e67 2072 6174 6573 2e22 2920  unding rates.") 
+0001d390: 6672 6f6d 204e 6f6e 650a 0a20 2020 2020  from None..     
+0001d3a0: 2020 2066 756e 6469 6e67 5f6d 6172 6b5f     funding_mark_
+0001d3b0: 7261 7465 7320 3d20 7365 6c66 2e63 6f6d  rates = self.com
+0001d3c0: 6269 6e65 5f66 756e 6469 6e67 5f61 6e64  bine_funding_and
+0001d3d0: 5f6d 6172 6b28 0a20 2020 2020 2020 2020  _mark(.         
+0001d3e0: 2020 2066 756e 6469 6e67 5f72 6174 6573     funding_rates
+0001d3f0: 3d66 756e 6469 6e67 5f72 6174 6573 2c20  =funding_rates, 
+0001d400: 6d61 726b 5f72 6174 6573 3d6d 6172 6b5f  mark_rates=mark_
+0001d410: 7261 7465 7329 0a0a 2020 2020 2020 2020  rates)..        
+0001d420: 7265 7475 726e 2073 656c 662e 6361 6c63  return self.calc
+0001d430: 756c 6174 655f 6675 6e64 696e 675f 6665  ulate_funding_fe
+0001d440: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+0001d450: 6675 6e64 696e 675f 6d61 726b 5f72 6174  funding_mark_rat
+0001d460: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0001d470: 616d 6f75 6e74 3d61 6d6f 756e 742c 0a20  amount=amount,. 
+0001d480: 2020 2020 2020 2020 2020 2069 735f 7368             is_sh
+0001d490: 6f72 743d 6973 5f73 686f 7274 2c0a 2020  ort=is_short,.  
+0001d4a0: 2020 2020 2020 2020 2020 6f70 656e 5f64            open_d
+0001d4b0: 6174 653d 6f70 656e 5f64 6174 652c 0a20  ate=open_date,. 
+0001d4c0: 2020 2020 2020 2020 2020 2063 6c6f 7365             close
+0001d4d0: 5f64 6174 653d 636c 6f73 655f 6461 7465  _date=close_date
+0001d4e0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0001d4f0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+0001d500: 2020 6465 6620 636f 6d62 696e 655f 6675    def combine_fu
+0001d510: 6e64 696e 675f 616e 645f 6d61 726b 2866  nding_and_mark(f
+0001d520: 756e 6469 6e67 5f72 6174 6573 3a20 4461  unding_rates: Da
+0001d530: 7461 4672 616d 652c 206d 6172 6b5f 7261  taFrame, mark_ra
+0001d540: 7465 733a 2044 6174 6146 7261 6d65 2c0a  tes: DataFrame,.
+0001d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d570: 2066 7574 7572 6573 5f66 756e 6469 6e67   futures_funding
+0001d580: 5f72 6174 653a 204f 7074 696f 6e61 6c5b  _rate: Optional[
+0001d590: 696e 745d 203d 204e 6f6e 6529 202d 3e20  int] = None) -> 
+0001d5a0: 4461 7461 4672 616d 653a 0a20 2020 2020  DataFrame:.     
+0001d5b0: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
+0001d5c0: 6f6d 6269 6e65 2066 756e 6469 6e67 2d72  ombine funding-r
+0001d5d0: 6174 6573 2061 6e64 206d 6172 6b2d 7261  ates and mark-ra
+0001d5e0: 7465 7320 6461 7461 6672 616d 6573 0a20  tes dataframes. 
+0001d5f0: 2020 2020 2020 203a 7061 7261 6d20 6675         :param fu
+0001d600: 6e64 696e 675f 7261 7465 733a 2044 6174  nding_rates: Dat
+0001d610: 6166 7261 6d65 2063 6f6e 7461 696e 696e  aframe containin
+0001d620: 6720 4675 6e64 696e 6720 7261 7465 7320  g Funding rates 
+0001d630: 2854 7970 6520 4655 4e44 494e 475f 5241  (Type FUNDING_RA
+0001d640: 5445 290a 2020 2020 2020 2020 3a70 6172  TE).        :par
+0001d650: 616d 206d 6172 6b5f 7261 7465 733a 2044  am mark_rates: D
+0001d660: 6174 6166 7261 6d65 2063 6f6e 7461 696e  ataframe contain
+0001d670: 696e 6720 4d61 726b 2072 6174 6573 2028  ing Mark rates (
+0001d680: 5479 7065 206d 6172 6b5f 6f68 6c63 765f  Type mark_ohlcv_
+0001d690: 7072 6963 6529 0a20 2020 2020 2020 203a  price).        :
+0001d6a0: 7061 7261 6d20 6675 7475 7265 735f 6675  param futures_fu
+0001d6b0: 6e64 696e 675f 7261 7465 3a20 4661 6b65  nding_rate: Fake
+0001d6c0: 2066 756e 6469 6e67 2072 6174 6520 746f   funding rate to
+0001d6d0: 2075 7365 2069 6620 6675 6e64 696e 675f   use if funding_
+0001d6e0: 7261 7465 7320 6172 6520 6e6f 7420 6176  rates are not av
+0001d6f0: 6169 6c61 626c 650a 2020 2020 2020 2020  ailable.        
+0001d700: 2222 220a 2020 2020 2020 2020 6966 2066  """.        if f
+0001d710: 7574 7572 6573 5f66 756e 6469 6e67 5f72  utures_funding_r
+0001d720: 6174 6520 6973 204e 6f6e 653a 0a20 2020  ate is None:.   
+0001d730: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001d740: 6d61 726b 5f72 6174 6573 2e6d 6572 6765  mark_rates.merge
+0001d750: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001d760: 2020 6675 6e64 696e 675f 7261 7465 732c    funding_rates,
+0001d770: 206f 6e3d 2764 6174 6527 2c20 686f 773d   on='date', how=
+0001d780: 2269 6e6e 6572 222c 2073 7566 6669 7865  "inner", suffixe
+0001d790: 733d 5b22 5f6d 6172 6b22 2c20 225f 6675  s=["_mark", "_fu
+0001d7a0: 6e64 225d 290a 2020 2020 2020 2020 656c  nd"]).        el
+0001d7b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001d7c0: 6966 206c 656e 2866 756e 6469 6e67 5f72  if len(funding_r
+0001d7d0: 6174 6573 2920 3d3d 2030 3a0a 2020 2020  ates) == 0:.    
+0001d7e0: 2020 2020 2020 2020 2020 2020 2320 4e6f              # No
+0001d7f0: 2066 756e 6469 6e67 2072 6174 6520 6361   funding rate ca
+0001d800: 6e64 6c65 7320 2d20 6675 6c6c 2066 696c  ndles - full fil
+0001d810: 6c75 7020 7769 7468 2066 616c 6c62 6163  lup with fallbac
+0001d820: 6b20 7661 7269 6162 6c65 0a20 2020 2020  k variable.     
+0001d830: 2020 2020 2020 2020 2020 206d 6172 6b5f             mark_
+0001d840: 7261 7465 735b 276f 7065 6e5f 6675 6e64  rates['open_fund
+0001d850: 275d 203d 2066 7574 7572 6573 5f66 756e  '] = futures_fun
+0001d860: 6469 6e67 5f72 6174 650a 2020 2020 2020  ding_rate.      
+0001d870: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001d880: 206d 6172 6b5f 7261 7465 732e 7265 6e61   mark_rates.rena
+0001d890: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
+0001d8a0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+0001d8b0: 6d6e 733d 7b27 6f70 656e 273a 2027 6f70  mns={'open': 'op
+0001d8c0: 656e 5f6d 6172 6b27 2c0a 2020 2020 2020  en_mark',.      
+0001d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8e0: 2020 2020 2020 2020 2020 2027 636c 6f73             'clos
+0001d8f0: 6527 3a20 2763 6c6f 7365 5f6d 6172 6b27  e': 'close_mark'
+0001d900: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d920: 2020 2027 6869 6768 273a 2027 6869 6768     'high': 'high
+0001d930: 5f6d 6172 6b27 2c0a 2020 2020 2020 2020  _mark',.        
+0001d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d950: 2020 2020 2020 2020 2027 6c6f 7727 3a20           'low': 
+0001d960: 276c 6f77 5f6d 6172 6b27 2c0a 2020 2020  'low_mark',.    
+0001d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d980: 2020 2020 2020 2020 2020 2020 2027 766f               'vo
+0001d990: 6c75 6d65 273a 2027 766f 6c75 6d65 5f6d  lume': 'volume_m
+0001d9a0: 6172 6b27 7d29 0a0a 2020 2020 2020 2020  ark'})..        
+0001d9b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001d9c0: 2020 2020 2020 2020 2020 2320 4669 6c6c            # Fill
+0001d9d0: 2075 7020 6d69 7373 696e 6720 6675 6e64   up missing fund
+0001d9e0: 696e 675f 7261 7465 2063 616e 646c 6573  ing_rate candles
+0001d9f0: 2077 6974 6820 6661 6c6c 6261 636b 2076   with fallback v
+0001da00: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
+0001da10: 2020 2020 2063 6f6d 6269 6e65 6420 3d20       combined = 
+0001da20: 6d61 726b 5f72 6174 6573 2e6d 6572 6765  mark_rates.merge
+0001da30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001da40: 2020 2020 2020 6675 6e64 696e 675f 7261        funding_ra
+0001da50: 7465 732c 206f 6e3d 2764 6174 6527 2c20  tes, on='date', 
+0001da60: 686f 773d 226f 7574 6572 222c 2073 7566  how="outer", suf
+0001da70: 6669 7865 733d 5b22 5f6d 6172 6b22 2c20  fixes=["_mark", 
+0001da80: 225f 6675 6e64 225d 0a20 2020 2020 2020  "_fund"].       
+0001da90: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001daa0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001dab0: 6f6d 6269 6e65 645b 276f 7065 6e5f 6675  ombined['open_fu
+0001dac0: 6e64 275d 203d 2063 6f6d 6269 6e65 645b  nd'] = combined[
+0001dad0: 276f 7065 6e5f 6675 6e64 275d 2e66 696c  'open_fund'].fil
+0001dae0: 6c6e 6128 6675 7475 7265 735f 6675 6e64  lna(futures_fund
+0001daf0: 696e 675f 7261 7465 290a 2020 2020 2020  ing_rate).      
+0001db00: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001db10: 2063 6f6d 6269 6e65 640a 0a20 2020 2064   combined..    d
+0001db20: 6566 2063 616c 6375 6c61 7465 5f66 756e  ef calculate_fun
+0001db30: 6469 6e67 5f66 6565 7328 0a20 2020 2020  ding_fees(.     
+0001db40: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0001db50: 2064 663a 2044 6174 6146 7261 6d65 2c0a   df: DataFrame,.
+0001db60: 2020 2020 2020 2020 616d 6f75 6e74 3a20          amount: 
+0001db70: 666c 6f61 742c 0a20 2020 2020 2020 2069  float,.        i
+0001db80: 735f 7368 6f72 743a 2062 6f6f 6c2c 0a20  s_short: bool,. 
+0001db90: 2020 2020 2020 206f 7065 6e5f 6461 7465         open_date
+0001dba0: 3a20 6461 7465 7469 6d65 2c0a 2020 2020  : datetime,.    
+0001dbb0: 2020 2020 636c 6f73 655f 6461 7465 3a20      close_date: 
+0001dbc0: 4f70 7469 6f6e 616c 5b64 6174 6574 696d  Optional[datetim
+0001dbd0: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
+0001dbe0: 2020 2074 696d 655f 696e 5f72 6174 696f     time_in_ratio
+0001dbf0: 3a20 4f70 7469 6f6e 616c 5b66 6c6f 6174  : Optional[float
+0001dc00: 5d20 3d20 4e6f 6e65 0a20 2020 2029 202d  ] = None.    ) -
+0001dc10: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
+0001dc20: 2022 2222 0a20 2020 2020 2020 2063 616c   """.        cal
+0001dc30: 6375 6c61 7465 7320 7468 6520 7375 6d20  culates the sum 
+0001dc40: 6f66 2061 6c6c 2066 756e 6469 6e67 2066  of all funding f
+0001dc50: 6565 7320 7468 6174 206f 6363 7572 7265  ees that occurre
+0001dc60: 6420 666f 7220 6120 7061 6972 2064 7572  d for a pair dur
+0001dc70: 696e 6720 6120 6675 7475 7265 7320 7472  ing a futures tr
+0001dc80: 6164 650a 2020 2020 2020 2020 3a70 6172  ade.        :par
+0001dc90: 616d 2064 663a 2044 6174 6166 7261 6d65  am df: Dataframe
+0001dca0: 2063 6f6e 7461 696e 696e 6720 636f 6d62   containing comb
+0001dcb0: 696e 6564 2066 756e 6469 6e67 2061 6e64  ined funding and
+0001dcc0: 206d 6172 6b20 7261 7465 730a 2020 2020   mark rates.    
+0001dcd0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001dce0: 7320 606f 7065 6e5f 6675 6e64 6020 616e  s `open_fund` an
+0001dcf0: 6420 606f 7065 6e5f 6d61 726b 602e 0a20  d `open_mark`.. 
+0001dd00: 2020 2020 2020 203a 7061 7261 6d20 616d         :param am
+0001dd10: 6f75 6e74 3a20 5468 6520 7175 616e 7469  ount: The quanti
+0001dd20: 7479 206f 6620 7468 6520 7472 6164 650a  ty of the trade.
+0001dd30: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
+0001dd40: 735f 7368 6f72 743a 2074 7261 6465 2064  s_short: trade d
+0001dd50: 6972 6563 7469 6f6e 0a20 2020 2020 2020  irection.       
+0001dd60: 203a 7061 7261 6d20 6f70 656e 5f64 6174   :param open_dat
+0001dd70: 653a 2054 6865 2064 6174 6520 616e 6420  e: The date and 
+0001dd80: 7469 6d65 2074 6861 7420 7468 6520 7472  time that the tr
+0001dd90: 6164 6520 7374 6172 7465 640a 2020 2020  ade started.    
+0001dda0: 2020 2020 3a70 6172 616d 2063 6c6f 7365      :param close
+0001ddb0: 5f64 6174 653a 2054 6865 2064 6174 6520  _date: The date 
+0001ddc0: 616e 6420 7469 6d65 2074 6861 7420 7468  and time that th
+0001ddd0: 6520 7472 6164 6520 656e 6465 640a 2020  e trade ended.  
+0001dde0: 2020 2020 2020 3a70 6172 616d 2074 696d        :param tim
+0001ddf0: 655f 696e 5f72 6174 696f 3a20 4e6f 7420  e_in_ratio: Not 
+0001de00: 7573 6564 2062 7920 6d6f 7374 2065 7863  used by most exc
+0001de10: 6861 6e67 6520 636c 6173 7365 730a 2020  hange classes.  
+0001de20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001de30: 2020 6665 6573 3a20 666c 6f61 7420 3d20    fees: float = 
+0001de40: 300a 0a20 2020 2020 2020 2069 6620 6e6f  0..        if no
+0001de50: 7420 6466 2e65 6d70 7479 3a0a 2020 2020  t df.empty:.    
+0001de60: 2020 2020 2020 2020 6466 203d 2064 665b          df = df[
+0001de70: 2864 665b 2764 6174 6527 5d20 3e3d 206f  (df['date'] >= o
+0001de80: 7065 6e5f 6461 7465 2920 2620 2864 665b  pen_date) & (df[
+0001de90: 2764 6174 6527 5d20 3c3d 2063 6c6f 7365  'date'] <= close
+0001dea0: 5f64 6174 6529 5d0a 2020 2020 2020 2020  _date)].        
+0001deb0: 2020 2020 6665 6573 203d 2073 756d 2864      fees = sum(d
+0001dec0: 665b 276f 7065 6e5f 6675 6e64 275d 202a  f['open_fund'] *
+0001ded0: 2064 665b 276f 7065 6e5f 6d61 726b 275d   df['open_mark']
+0001dee0: 202a 2061 6d6f 756e 7429 0a0a 2020 2020   * amount)..    
+0001def0: 2020 2020 2320 4e65 6761 7465 2066 6565      # Negate fee
+0001df00: 7320 666f 7220 6c6f 6e67 7320 6173 2066  s for longs as f
+0001df10: 756e 6469 6e67 5f66 6565 7320 6578 7065  unding_fees expe
+0001df20: 6374 7320 6974 2074 6869 7320 7761 7920  cts it this way 
+0001df30: 6261 7365 6420 6f6e 206c 6976 6520 656e  based on live en
+0001df40: 6470 6f69 6e74 732e 0a20 2020 2020 2020  dpoints..       
+0001df50: 2072 6574 7572 6e20 6665 6573 2069 6620   return fees if 
+0001df60: 6973 5f73 686f 7274 2065 6c73 6520 2d66  is_short else -f
+0001df70: 6565 730a 0a20 2020 2064 6566 2067 6574  ees..    def get
+0001df80: 5f66 756e 6469 6e67 5f66 6565 7328 0a20  _funding_fees(. 
+0001df90: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+0001dfa0: 2070 6169 723a 2073 7472 2c20 616d 6f75   pair: str, amou
+0001dfb0: 6e74 3a20 666c 6f61 742c 2069 735f 7368  nt: float, is_sh
+0001dfc0: 6f72 743a 2062 6f6f 6c2c 206f 7065 6e5f  ort: bool, open_
+0001dfd0: 6461 7465 3a20 6461 7465 7469 6d65 2920  date: datetime) 
+0001dfe0: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
+0001dff0: 2020 2222 220a 2020 2020 2020 2020 4665    """.        Fe
+0001e000: 7463 6820 6675 6e64 696e 6720 6665 6573  tch funding fees
+0001e010: 2c20 6569 7468 6572 2066 726f 6d20 7468  , either from th
+0001e020: 6520 6578 6368 616e 6765 2028 6c69 7665  e exchange (live
+0001e030: 2920 6f72 2063 616c 6375 6c61 7465 7320  ) or calculates 
+0001e040: 7468 656d 0a20 2020 2020 2020 2062 6173  them.        bas
+0001e050: 6564 206f 6e20 6675 6e64 696e 6720 7261  ed on funding ra
+0001e060: 7465 2f6d 6172 6b20 7072 6963 6520 6869  te/mark price hi
+0001e070: 7374 6f72 790a 2020 2020 2020 2020 3a70  story.        :p
+0001e080: 6172 616d 2070 6169 723a 2054 6865 2071  aram pair: The q
+0001e090: 756f 7465 2f62 6173 6520 7061 6972 206f  uote/base pair o
+0001e0a0: 6620 7468 6520 7472 6164 650a 2020 2020  f the trade.    
+0001e0b0: 2020 2020 3a70 6172 616d 2069 735f 7368      :param is_sh
+0001e0c0: 6f72 743a 2074 7261 6465 2064 6972 6563  ort: trade direc
+0001e0d0: 7469 6f6e 0a20 2020 2020 2020 203a 7061  tion.        :pa
+0001e0e0: 7261 6d20 616d 6f75 6e74 3a20 5472 6164  ram amount: Trad
+0001e0f0: 6520 616d 6f75 6e74 0a20 2020 2020 2020  e amount.       
+0001e100: 203a 7061 7261 6d20 6f70 656e 5f64 6174   :param open_dat
+0001e110: 653a 204f 7065 6e20 6461 7465 206f 6620  e: Open date of 
+0001e120: 7468 6520 7472 6164 650a 2020 2020 2020  the trade.      
+0001e130: 2020 3a72 6574 7572 6e3a 2066 756e 6469    :return: fundi
+0001e140: 6e67 2066 6565 2073 696e 6365 206f 7065  ng fee since ope
+0001e150: 6e5f 6461 7465 0a20 2020 2020 2020 203a  n_date.        :
+0001e160: 7261 6973 6573 3a20 4578 6368 616e 6765  raises: Exchange
+0001e170: 4572 726f 7220 6966 2073 6f6d 6574 6869  Error if somethi
+0001e180: 6e67 2067 6f65 7320 7772 6f6e 672e 0a20  ng goes wrong.. 
+0001e190: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001e1a0: 2020 2069 6620 7365 6c66 2e74 7261 6469     if self.tradi
+0001e1b0: 6e67 5f6d 6f64 6520 3d3d 2054 7261 6469  ng_mode == Tradi
+0001e1c0: 6e67 4d6f 6465 2e46 5554 5552 4553 3a0a  ngMode.FUTURES:.
+0001e1d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001e1e0: 656c 662e 5f63 6f6e 6669 675b 2764 7279  elf._config['dry
+0001e1f0: 5f72 756e 275d 3a0a 2020 2020 2020 2020  _run']:.        
+0001e200: 2020 2020 2020 2020 6675 6e64 696e 675f          funding_
+0001e210: 6665 6573 203d 2073 656c 662e 5f66 6574  fees = self._fet
+0001e220: 6368 5f61 6e64 5f63 616c 6375 6c61 7465  ch_and_calculate
+0001e230: 5f66 756e 6469 6e67 5f66 6565 7328 0a20  _funding_fees(. 
+0001e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e250: 2020 2070 6169 722c 2061 6d6f 756e 742c     pair, amount,
+0001e260: 2069 735f 7368 6f72 742c 206f 7065 6e5f   is_short, open_
+0001e270: 6461 7465 290a 2020 2020 2020 2020 2020  date).          
+0001e280: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001e290: 2020 2020 2020 2020 6675 6e64 696e 675f          funding_
+0001e2a0: 6665 6573 203d 2073 656c 662e 5f67 6574  fees = self._get
+0001e2b0: 5f66 756e 6469 6e67 5f66 6565 735f 6672  _funding_fees_fr
+0001e2c0: 6f6d 5f65 7863 6861 6e67 6528 7061 6972  om_exchange(pair
+0001e2d0: 2c20 6f70 656e 5f64 6174 6529 0a20 2020  , open_date).   
+0001e2e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001e2f0: 6675 6e64 696e 675f 6665 6573 0a20 2020  funding_fees.   
+0001e300: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001e310: 2020 2020 2020 2072 6574 7572 6e20 302e         return 0.
+0001e320: 300a 0a20 2020 2064 6566 2067 6574 5f6c  0..    def get_l
+0001e330: 6971 7569 6461 7469 6f6e 5f70 7269 6365  iquidation_price
+0001e340: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0001e350: 2020 2020 2020 2020 7061 6972 3a20 7374          pair: st
+0001e360: 722c 0a20 2020 2020 2020 2023 2044 7279  r,.        # Dry
+0001e370: 2d72 756e 0a20 2020 2020 2020 206f 7065  -run.        ope
+0001e380: 6e5f 7261 7465 3a20 666c 6f61 742c 2020  n_rate: float,  
+0001e390: 2023 2045 6e74 7279 2070 7269 6365 206f   # Entry price o
+0001e3a0: 6620 706f 7369 7469 6f6e 0a20 2020 2020  f position.     
+0001e3b0: 2020 2069 735f 7368 6f72 743a 2062 6f6f     is_short: boo
+0001e3c0: 6c2c 0a20 2020 2020 2020 2061 6d6f 756e  l,.        amoun
+0001e3d0: 743a 2066 6c6f 6174 2c20 2023 2041 6273  t: float,  # Abs
+0001e3e0: 6f6c 7574 6520 7661 6c75 6520 6f66 2070  olute value of p
+0001e3f0: 6f73 6974 696f 6e20 7369 7a65 0a20 2020  osition size.   
+0001e400: 2020 2020 2073 7461 6b65 5f61 6d6f 756e       stake_amoun
+0001e410: 743a 2066 6c6f 6174 2c0a 2020 2020 2020  t: float,.      
+0001e420: 2020 6c65 7665 7261 6765 3a20 666c 6f61    leverage: floa
+0001e430: 742c 0a20 2020 2020 2020 2077 616c 6c65  t,.        walle
+0001e440: 745f 6261 6c61 6e63 653a 2066 6c6f 6174  t_balance: float
+0001e450: 2c0a 2020 2020 2020 2020 6d6d 5f65 785f  ,.        mm_ex_
+0001e460: 313a 2066 6c6f 6174 203d 2030 2e30 2c20  1: float = 0.0, 
+0001e470: 2023 2028 4269 6e61 6e63 6529 2043 726f   # (Binance) Cro
+0001e480: 7373 206f 6e6c 790a 2020 2020 2020 2020  ss only.        
+0001e490: 7570 6e6c 5f65 785f 313a 2066 6c6f 6174  upnl_ex_1: float
+0001e4a0: 203d 2030 2e30 2c20 2023 2028 4269 6e61   = 0.0,  # (Bina
+0001e4b0: 6e63 6529 2043 726f 7373 206f 6e6c 790a  nce) Cross only.
+0001e4c0: 2020 2020 2920 2d3e 204f 7074 696f 6e61      ) -> Optiona
+0001e4d0: 6c5b 666c 6f61 745d 3a0a 2020 2020 2020  l[float]:.      
+0001e4e0: 2020 2222 220a 2020 2020 2020 2020 5365    """.        Se
+0001e4f0: 7427 7320 7468 6520 6d61 7267 696e 206d  t's the margin m
+0001e500: 6f64 6520 6f6e 2074 6865 2065 7863 6861  ode on the excha
+0001e510: 6e67 6520 746f 2063 726f 7373 206f 7220  nge to cross or 
+0001e520: 6973 6f6c 6174 6564 2066 6f72 2061 2073  isolated for a s
+0001e530: 7065 6369 6669 6320 7061 6972 0a20 2020  pecific pair.   
+0001e540: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001e550: 2069 6620 7365 6c66 2e74 7261 6469 6e67   if self.trading
+0001e560: 5f6d 6f64 6520 3d3d 2054 7261 6469 6e67  _mode == Trading
+0001e570: 4d6f 6465 2e53 504f 543a 0a20 2020 2020  Mode.SPOT:.     
+0001e580: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+0001e590: 6e65 0a20 2020 2020 2020 2065 6c69 6620  ne.        elif 
+0001e5a0: 2873 656c 662e 7472 6164 696e 675f 6d6f  (self.trading_mo
+0001e5b0: 6465 2021 3d20 5472 6164 696e 674d 6f64  de != TradingMod
+0001e5c0: 652e 4655 5455 5245 5329 3a0a 2020 2020  e.FUTURES):.    
+0001e5d0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+0001e5e0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+0001e5f0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0001e600: 2020 2020 6622 7b73 656c 662e 6e61 6d65      f"{self.name
+0001e610: 7d20 646f 6573 206e 6f74 2073 7570 706f  } does not suppo
+0001e620: 7274 207b 7365 6c66 2e6d 6172 6769 6e5f  rt {self.margin_
+0001e630: 6d6f 6465 7d20 7b73 656c 662e 7472 6164  mode} {self.trad
+0001e640: 696e 675f 6d6f 6465 7d22 290a 0a20 2020  ing_mode}")..   
+0001e650: 2020 2020 206c 6971 7569 6461 7469 6f6e       liquidation
+0001e660: 5f70 7269 6365 203d 204e 6f6e 650a 2020  _price = None.  
+0001e670: 2020 2020 2020 6966 2073 656c 662e 5f63        if self._c
+0001e680: 6f6e 6669 675b 2764 7279 5f72 756e 275d  onfig['dry_run']
+0001e690: 206f 7220 6e6f 7420 7365 6c66 2e65 7863   or not self.exc
+0001e6a0: 6861 6e67 655f 6861 7328 2266 6574 6368  hange_has("fetch
+0001e6b0: 506f 7369 7469 6f6e 7322 293a 0a0a 2020  Positions"):..  
+0001e6c0: 2020 2020 2020 2020 2020 6c69 7175 6964            liquid
+0001e6d0: 6174 696f 6e5f 7072 6963 6520 3d20 7365  ation_price = se
+0001e6e0: 6c66 2e64 7279 5f72 756e 5f6c 6971 7569  lf.dry_run_liqui
+0001e6f0: 6461 7469 6f6e 5f70 7269 6365 280a 2020  dation_price(.  
+0001e700: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0001e710: 6972 3d70 6169 722c 0a20 2020 2020 2020  ir=pair,.       
+0001e720: 2020 2020 2020 2020 206f 7065 6e5f 7261           open_ra
+0001e730: 7465 3d6f 7065 6e5f 7261 7465 2c0a 2020  te=open_rate,.  
+0001e740: 2020 2020 2020 2020 2020 2020 2020 6973                is
+0001e750: 5f73 686f 7274 3d69 735f 7368 6f72 742c  _short=is_short,
+0001e760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e770: 2061 6d6f 756e 743d 616d 6f75 6e74 2c0a   amount=amount,.
+0001e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e790: 6c65 7665 7261 6765 3d6c 6576 6572 6167  leverage=leverag
+0001e7a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001e7b0: 2020 2073 7461 6b65 5f61 6d6f 756e 743d     stake_amount=
+0001e7c0: 7374 616b 655f 616d 6f75 6e74 2c0a 2020  stake_amount,.  
+0001e7d0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0001e7e0: 6c6c 6574 5f62 616c 616e 6365 3d77 616c  llet_balance=wal
+0001e7f0: 6c65 745f 6261 6c61 6e63 652c 0a20 2020  let_balance,.   
+0001e800: 2020 2020 2020 2020 2020 2020 206d 6d5f               mm_
+0001e810: 6578 5f31 3d6d 6d5f 6578 5f31 2c0a 2020  ex_1=mm_ex_1,.  
+0001e820: 2020 2020 2020 2020 2020 2020 2020 7570                up
+0001e830: 6e6c 5f65 785f 313d 7570 6e6c 5f65 785f  nl_ex_1=upnl_ex_
+0001e840: 310a 2020 2020 2020 2020 2020 2020 290a  1.            ).
+0001e850: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001e860: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+0001e870: 6f6e 7320 3d20 7365 6c66 2e66 6574 6368  ons = self.fetch
+0001e880: 5f70 6f73 6974 696f 6e73 2870 6169 7229  _positions(pair)
+0001e890: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001e8a0: 6c65 6e28 706f 7369 7469 6f6e 7329 203e  len(positions) >
+0001e8b0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0001e8c0: 2020 2020 706f 7320 3d20 706f 7369 7469      pos = positi
+0001e8d0: 6f6e 735b 305d 0a20 2020 2020 2020 2020  ons[0].         
+0001e8e0: 2020 2020 2020 206c 6971 7569 6461 7469         liquidati
+0001e8f0: 6f6e 5f70 7269 6365 203d 2070 6f73 5b27  on_price = pos['
+0001e900: 6c69 7175 6964 6174 696f 6e50 7269 6365  liquidationPrice
+0001e910: 275d 0a0a 2020 2020 2020 2020 6966 206c  ']..        if l
+0001e920: 6971 7569 6461 7469 6f6e 5f70 7269 6365  iquidation_price
+0001e930: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0001e940: 2020 2020 2020 2020 2020 6275 6666 6572            buffer
+0001e950: 5f61 6d6f 756e 7420 3d20 6162 7328 6f70  _amount = abs(op
+0001e960: 656e 5f72 6174 6520 2d20 6c69 7175 6964  en_rate - liquid
+0001e970: 6174 696f 6e5f 7072 6963 6529 202a 2073  ation_price) * s
+0001e980: 656c 662e 6c69 7175 6964 6174 696f 6e5f  elf.liquidation_
+0001e990: 6275 6666 6572 0a20 2020 2020 2020 2020  buffer.         
+0001e9a0: 2020 206c 6971 7569 6461 7469 6f6e 5f70     liquidation_p
+0001e9b0: 7269 6365 5f62 7566 6665 7220 3d20 280a  rice_buffer = (.
+0001e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9d0: 6c69 7175 6964 6174 696f 6e5f 7072 6963  liquidation_pric
+0001e9e0: 6520 2d20 6275 6666 6572 5f61 6d6f 756e  e - buffer_amoun
+0001e9f0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001ea00: 2020 6966 2069 735f 7368 6f72 7420 656c    if is_short el
+0001ea10: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0001ea20: 2020 206c 6971 7569 6461 7469 6f6e 5f70     liquidation_p
+0001ea30: 7269 6365 202b 2062 7566 6665 725f 616d  rice + buffer_am
+0001ea40: 6f75 6e74 0a20 2020 2020 2020 2020 2020  ount.           
+0001ea50: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+0001ea60: 6574 7572 6e20 6d61 7828 6c69 7175 6964  eturn max(liquid
+0001ea70: 6174 696f 6e5f 7072 6963 655f 6275 6666  ation_price_buff
+0001ea80: 6572 2c20 302e 3029 0a20 2020 2020 2020  er, 0.0).       
+0001ea90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001eaa0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+0001eab0: 2020 2020 6465 6620 6472 795f 7275 6e5f      def dry_run_
+0001eac0: 6c69 7175 6964 6174 696f 6e5f 7072 6963  liquidation_pric
+0001ead0: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+0001eae0: 0a20 2020 2020 2020 2070 6169 723a 2073  .        pair: s
+0001eaf0: 7472 2c0a 2020 2020 2020 2020 6f70 656e  tr,.        open
+0001eb00: 5f72 6174 653a 2066 6c6f 6174 2c20 2020  _rate: float,   
+0001eb10: 2320 456e 7472 7920 7072 6963 6520 6f66  # Entry price of
+0001eb20: 2070 6f73 6974 696f 6e0a 2020 2020 2020   position.      
+0001eb30: 2020 6973 5f73 686f 7274 3a20 626f 6f6c    is_short: bool
+0001eb40: 2c0a 2020 2020 2020 2020 616d 6f75 6e74  ,.        amount
+0001eb50: 3a20 666c 6f61 742c 0a20 2020 2020 2020  : float,.       
+0001eb60: 2073 7461 6b65 5f61 6d6f 756e 743a 2066   stake_amount: f
+0001eb70: 6c6f 6174 2c0a 2020 2020 2020 2020 6c65  loat,.        le
+0001eb80: 7665 7261 6765 3a20 666c 6f61 742c 0a20  verage: float,. 
+0001eb90: 2020 2020 2020 2077 616c 6c65 745f 6261         wallet_ba
+0001eba0: 6c61 6e63 653a 2066 6c6f 6174 2c20 2023  lance: float,  #
+0001ebb0: 204f 7220 6d61 7267 696e 2062 616c 616e   Or margin balan
+0001ebc0: 6365 0a20 2020 2020 2020 206d 6d5f 6578  ce.        mm_ex
+0001ebd0: 5f31 3a20 666c 6f61 7420 3d20 302e 302c  _1: float = 0.0,
+0001ebe0: 2020 2320 2842 696e 616e 6365 2920 4372    # (Binance) Cr
+0001ebf0: 6f73 7320 6f6e 6c79 0a20 2020 2020 2020  oss only.       
+0001ec00: 2075 706e 6c5f 6578 5f31 3a20 666c 6f61   upnl_ex_1: floa
+0001ec10: 7420 3d20 302e 302c 2020 2320 2842 696e  t = 0.0,  # (Bin
+0001ec20: 616e 6365 2920 4372 6f73 7320 6f6e 6c79  ance) Cross only
+0001ec30: 0a20 2020 2029 202d 3e20 4f70 7469 6f6e  .    ) -> Option
+0001ec40: 616c 5b66 6c6f 6174 5d3a 0a20 2020 2020  al[float]:.     
+0001ec50: 2020 2022 2222 0a20 2020 2020 2020 2049     """.        I
+0001ec60: 6d70 6f72 7461 6e74 3a20 4d75 7374 2062  mportant: Must b
+0001ec70: 6520 6665 7463 6869 6e67 2064 6174 6120  e fetching data 
+0001ec80: 6672 6f6d 2063 6163 6865 6420 7661 6c75  from cached valu
+0001ec90: 6573 2061 7320 7468 6973 2069 7320 7573  es as this is us
+0001eca0: 6564 2062 7920 6261 636b 7465 7374 696e  ed by backtestin
+0001ecb0: 6721 0a20 2020 2020 2020 2050 4552 5045  g!.        PERPE
+0001ecc0: 5455 414c 3a0a 2020 2020 2020 2020 2067  TUAL:.         g
+0001ecd0: 6174 653a 2068 7474 7073 3a2f 2f77 7777  ate: https://www
+0001ece0: 2e67 6174 652e 696f 2f68 656c 702f 6675  .gate.io/help/fu
+0001ecf0: 7475 7265 732f 6675 7475 7265 732f 3237  tures/futures/27
+0001ed00: 3732 342f 6c69 7175 6964 6174 696f 6e2d  724/liquidation-
+0001ed10: 7072 6963 652d 6261 6e6b 7275 7074 6379  price-bankruptcy
+0001ed20: 2d70 7269 6365 0a20 2020 2020 2020 2020  -price.         
+0001ed30: 3e20 4c69 7175 6964 6174 696f 6e20 5072  > Liquidation Pr
+0001ed40: 6963 6520 3d20 2845 6e74 7279 2050 7269  ice = (Entry Pri
+0001ed50: 6365 20c2 b120 4d61 7267 696e 202f 2043  ce .. Margin / C
+0001ed60: 6f6e 7472 6163 7420 4d75 6c74 6970 6c69  ontract Multipli
+0001ed70: 6572 202f 2053 697a 6529 202f 0a20 2020  er / Size) /.   
+0001ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed90: 2020 2020 2020 2020 2020 2020 205b 2031               [ 1
+0001eda0: 20c2 b120 284d 6169 6e74 656e 616e 6365   .. (Maintenance
+0001edb0: 204d 6172 6769 6e20 5261 7469 6f20 2b20   Margin Ratio + 
+0001edc0: 5461 6b65 7220 5261 7465 295d 0a20 2020  Taker Rate)].   
+0001edd0: 2020 2020 2020 2020 2057 6865 7265 696e           Wherein
+0001ede0: 2c20 222b 2220 6f72 2022 2d22 2064 6570  , "+" or "-" dep
+0001edf0: 656e 6473 206f 6e20 7768 6574 6865 7220  ends on whether 
+0001ee00: 7468 6520 636f 6e74 7261 6374 2067 6f65  the contract goe
+0001ee10: 7320 6c6f 6e67 206f 7220 7368 6f72 743a  s long or short:
+0001ee20: 0a20 2020 2020 2020 2020 2020 2022 2d22  .            "-"
+0001ee30: 2066 6f72 206c 6f6e 672c 2061 6e64 2022   for long, and "
+0001ee40: 2b22 2066 6f72 2073 686f 7274 2e0a 0a20  +" for short... 
+0001ee50: 2020 2020 2020 2020 6f6b 6578 3a20 6874          okex: ht
+0001ee60: 7470 733a 2f2f 7777 772e 6f6b 6578 2e63  tps://www.okex.c
+0001ee70: 6f6d 2f73 7570 706f 7274 2f68 632f 656e  om/support/hc/en
+0001ee80: 2d75 732f 6172 7469 636c 6573 2f0a 2020  -us/articles/.  
+0001ee90: 2020 2020 2020 2020 2020 3336 3030 3533            360053
+0001eea0: 3930 3935 3932 2d56 492d 496e 7472 6f64  909592-VI-Introd
+0001eeb0: 7563 7469 6f6e 2d74 6f2d 7468 652d 6973  uction-to-the-is
+0001eec0: 6f6c 6174 6564 2d6d 6f64 652d 6f66 2d53  olated-mode-of-S
+0001eed0: 696e 676c 652d 4d75 6c74 692d 6375 7272  ingle-Multi-curr
+0001eee0: 656e 6379 2d50 6f72 7466 6f6c 696f 2d6d  ency-Portfolio-m
+0001eef0: 6172 6769 6e0a 0a20 2020 2020 2020 203a  argin..        :
+0001ef00: 7061 7261 6d20 7061 6972 3a20 5061 6972  param pair: Pair
+0001ef10: 2074 6f20 6361 6c63 756c 6174 6520 6c69   to calculate li
+0001ef20: 7175 6964 6174 696f 6e20 7072 6963 6520  quidation price 
+0001ef30: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
+0001ef40: 616d 206f 7065 6e5f 7261 7465 3a20 456e  am open_rate: En
+0001ef50: 7472 7920 7072 6963 6520 6f66 2070 6f73  try price of pos
+0001ef60: 6974 696f 6e0a 2020 2020 2020 2020 3a70  ition.        :p
+0001ef70: 6172 616d 2069 735f 7368 6f72 743a 2054  aram is_short: T
+0001ef80: 7275 6520 6966 2074 6865 2074 7261 6465  rue if the trade
+0001ef90: 2069 7320 6120 7368 6f72 742c 2066 616c   is a short, fal
+0001efa0: 7365 206f 7468 6572 7769 7365 0a20 2020  se otherwise.   
+0001efb0: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
+0001efc0: 6e74 3a20 4162 736f 6c75 7465 2076 616c  nt: Absolute val
+0001efd0: 7565 206f 6620 706f 7369 7469 6f6e 2073  ue of position s
+0001efe0: 697a 6520 696e 636c 2e20 6c65 7665 7261  ize incl. levera
+0001eff0: 6765 2028 696e 2062 6173 6520 6375 7272  ge (in base curr
+0001f000: 656e 6379 290a 2020 2020 2020 2020 3a70  ency).        :p
+0001f010: 6172 616d 2073 7461 6b65 5f61 6d6f 756e  aram stake_amoun
+0001f020: 743a 2053 7461 6b65 2061 6d6f 756e 7420  t: Stake amount 
+0001f030: 2d20 436f 6c6c 6174 6572 616c 2069 6e20  - Collateral in 
+0001f040: 7365 7474 6c65 2063 7572 7265 6e63 792e  settle currency.
+0001f050: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001f060: 6c65 7665 7261 6765 3a20 4c65 7665 7261  leverage: Levera
+0001f070: 6765 2075 7365 6420 666f 7220 7468 6973  ge used for this
+0001f080: 2070 6f73 6974 696f 6e2e 0a20 2020 2020   position..     
+0001f090: 2020 203a 7061 7261 6d20 7472 6164 696e     :param tradin
+0001f0a0: 675f 6d6f 6465 3a20 5350 4f54 2c20 4d41  g_mode: SPOT, MA
+0001f0b0: 5247 494e 2c20 4655 5455 5245 532c 2065  RGIN, FUTURES, e
+0001f0c0: 7463 2e0a 2020 2020 2020 2020 3a70 6172  tc..        :par
+0001f0d0: 616d 206d 6172 6769 6e5f 6d6f 6465 3a20  am margin_mode: 
+0001f0e0: 4569 7468 6572 2049 534f 4c41 5445 4420  Either ISOLATED 
+0001f0f0: 6f72 2043 524f 5353 0a20 2020 2020 2020  or CROSS.       
+0001f100: 203a 7061 7261 6d20 7761 6c6c 6574 5f62   :param wallet_b
+0001f110: 616c 616e 6365 3a20 416d 6f75 6e74 206f  alance: Amount o
+0001f120: 6620 6d61 7267 696e 5f6d 6f64 6520 696e  f margin_mode in
+0001f130: 2074 6865 2077 616c 6c65 7420 6265 696e   the wallet bein
+0001f140: 6720 7573 6564 2074 6f20 7472 6164 650a  g used to trade.
+0001f150: 2020 2020 2020 2020 2020 2020 4372 6f73              Cros
+0001f160: 732d 4d61 7267 696e 204d 6f64 653a 2063  s-Margin Mode: c
+0001f170: 726f 7373 5761 6c6c 6574 4261 6c61 6e63  rossWalletBalanc
+0001f180: 650a 2020 2020 2020 2020 2020 2020 4973  e.            Is
+0001f190: 6f6c 6174 6564 2d4d 6172 6769 6e20 4d6f  olated-Margin Mo
+0001f1a0: 6465 3a20 6973 6f6c 6174 6564 5761 6c6c  de: isolatedWall
+0001f1b0: 6574 4261 6c61 6e63 650a 0a20 2020 2020  etBalance..     
+0001f1c0: 2020 2023 202a 204e 6f74 2072 6571 7569     # * Not requi
+0001f1d0: 7265 6420 6279 2047 6174 6520 6f72 204f  red by Gate or O
+0001f1e0: 4b58 0a20 2020 2020 2020 203a 7061 7261  KX.        :para
+0001f1f0: 6d20 6d6d 5f65 785f 313a 0a20 2020 2020  m mm_ex_1:.     
+0001f200: 2020 203a 7061 7261 6d20 7570 6e6c 5f65     :param upnl_e
+0001f210: 785f 313a 0a20 2020 2020 2020 2022 2222  x_1:.        """
+0001f220: 0a0a 2020 2020 2020 2020 6d61 726b 6574  ..        market
+0001f230: 203d 2073 656c 662e 6d61 726b 6574 735b   = self.markets[
+0001f240: 7061 6972 5d0a 2020 2020 2020 2020 7461  pair].        ta
+0001f250: 6b65 725f 6665 655f 7261 7465 203d 206d  ker_fee_rate = m
+0001f260: 6172 6b65 745b 2774 616b 6572 275d 0a20  arket['taker']. 
+0001f270: 2020 2020 2020 206d 6d5f 7261 7469 6f2c         mm_ratio,
+0001f280: 205f 203d 2073 656c 662e 6765 745f 6d61   _ = self.get_ma
+0001f290: 696e 7465 6e61 6e63 655f 7261 7469 6f5f  intenance_ratio_
+0001f2a0: 616e 645f 616d 7428 7061 6972 2c20 7374  and_amt(pair, st
+0001f2b0: 616b 655f 616d 6f75 6e74 290a 0a20 2020  ake_amount)..   
+0001f2c0: 2020 2020 2069 6620 7365 6c66 2e74 7261       if self.tra
+0001f2d0: 6469 6e67 5f6d 6f64 6520 3d3d 2054 7261  ding_mode == Tra
+0001f2e0: 6469 6e67 4d6f 6465 2e46 5554 5552 4553  dingMode.FUTURES
+0001f2f0: 2061 6e64 2073 656c 662e 6d61 7267 696e   and self.margin
+0001f300: 5f6d 6f64 6520 3d3d 204d 6172 6769 6e4d  _mode == MarginM
+0001f310: 6f64 652e 4953 4f4c 4154 4544 3a0a 0a20  ode.ISOLATED:.. 
+0001f320: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
+0001f330: 726b 6574 5b27 696e 7665 7273 6527 5d3a  rket['inverse']:
+0001f340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f350: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+0001f360: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
+0001f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f380: 2022 4672 6571 7472 6164 6520 646f 6573   "Freqtrade does
+0001f390: 206e 6f74 2079 6574 2073 7570 706f 7274   not yet support
+0001f3a0: 2069 6e76 6572 7365 2063 6f6e 7472 6163   inverse contrac
+0001f3b0: 7473 2229 0a0a 2020 2020 2020 2020 2020  ts")..          
+0001f3c0: 2020 7661 6c75 6520 3d20 7761 6c6c 6574    value = wallet
+0001f3d0: 5f62 616c 616e 6365 202f 2061 6d6f 756e  _balance / amoun
+0001f3e0: 740a 0a20 2020 2020 2020 2020 2020 206d  t..            m
+0001f3f0: 6d5f 7261 7469 6f5f 7461 6b65 7220 3d20  m_ratio_taker = 
+0001f400: 286d 6d5f 7261 7469 6f20 2b20 7461 6b65  (mm_ratio + take
+0001f410: 725f 6665 655f 7261 7465 290a 2020 2020  r_fee_rate).    
+0001f420: 2020 2020 2020 2020 6966 2069 735f 7368          if is_sh
+0001f430: 6f72 743a 0a20 2020 2020 2020 2020 2020  ort:.           
+0001f440: 2020 2020 2072 6574 7572 6e20 286f 7065       return (ope
+0001f450: 6e5f 7261 7465 202b 2076 616c 7565 2920  n_rate + value) 
+0001f460: 2f20 2831 202b 206d 6d5f 7261 7469 6f5f  / (1 + mm_ratio_
+0001f470: 7461 6b65 7229 0a20 2020 2020 2020 2020  taker).         
+0001f480: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001f490: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001f4a0: 286f 7065 6e5f 7261 7465 202d 2076 616c  (open_rate - val
+0001f4b0: 7565 2920 2f20 2831 202d 206d 6d5f 7261  ue) / (1 - mm_ra
+0001f4c0: 7469 6f5f 7461 6b65 7229 0a20 2020 2020  tio_taker).     
+0001f4d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001f4e0: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+0001f4f0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+0001f500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f510: 2022 4672 6571 7472 6164 6520 6f6e 6c79   "Freqtrade only
+0001f520: 2073 7570 706f 7274 7320 6973 6f6c 6174   supports isolat
+0001f530: 6564 2066 7574 7572 6573 2066 6f72 206c  ed futures for l
+0001f540: 6576 6572 6167 6520 7472 6164 696e 6722  everage trading"
+0001f550: 290a 0a20 2020 2064 6566 2067 6574 5f6d  )..    def get_m
+0001f560: 6169 6e74 656e 616e 6365 5f72 6174 696f  aintenance_ratio
+0001f570: 5f61 6e64 5f61 6d74 280a 2020 2020 2020  _and_amt(.      
+0001f580: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0001f590: 7061 6972 3a20 7374 722c 0a20 2020 2020  pair: str,.     
+0001f5a0: 2020 206e 6f6d 696e 616c 5f76 616c 7565     nominal_value
+0001f5b0: 3a20 666c 6f61 742c 0a20 2020 2029 202d  : float,.    ) -
+0001f5c0: 3e20 5475 706c 655b 666c 6f61 742c 204f  > Tuple[float, O
+0001f5d0: 7074 696f 6e61 6c5b 666c 6f61 745d 5d3a  ptional[float]]:
+0001f5e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001f5f0: 2020 2020 2049 6d70 6f72 7461 6e74 3a20       Important: 
+0001f600: 4d75 7374 2062 6520 6665 7463 6869 6e67  Must be fetching
+0001f610: 2064 6174 6120 6672 6f6d 2063 6163 6865   data from cache
+0001f620: 6420 7661 6c75 6573 2061 7320 7468 6973  d values as this
+0001f630: 2069 7320 7573 6564 2062 7920 6261 636b   is used by back
+0001f640: 7465 7374 696e 6721 0a20 2020 2020 2020  testing!.       
+0001f650: 203a 7061 7261 6d20 7061 6972 3a20 4d61   :param pair: Ma
+0001f660: 726b 6574 2073 796d 626f 6c0a 2020 2020  rket symbol.    
+0001f670: 2020 2020 3a70 6172 616d 206e 6f6d 696e      :param nomin
+0001f680: 616c 5f76 616c 7565 3a20 5468 6520 746f  al_value: The to
+0001f690: 7461 6c20 7472 6164 6520 616d 6f75 6e74  tal trade amount
+0001f6a0: 2069 6e20 7175 6f74 6520 6375 7272 656e   in quote curren
+0001f6b0: 6379 2069 6e63 6c75 6469 6e67 206c 6576  cy including lev
+0001f6c0: 6572 6167 650a 2020 2020 2020 2020 6d61  erage.        ma
+0001f6d0: 696e 7465 6e61 6e63 6520 616d 6f75 6e74  intenance amount
+0001f6e0: 206f 6e6c 7920 6f6e 2042 696e 616e 6365   only on Binance
+0001f6f0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0001f700: 3a20 286d 6169 6e74 656e 616e 6365 206d  : (maintenance m
+0001f710: 6172 6769 6e20 7261 7469 6f2c 206d 6169  argin ratio, mai
+0001f720: 6e74 656e 616e 6365 2061 6d6f 756e 7429  ntenance amount)
+0001f730: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0001f740: 2020 2020 2020 6966 2028 7365 6c66 2e5f        if (self._
+0001f750: 636f 6e66 6967 2e67 6574 2827 7275 6e6d  config.get('runm
+0001f760: 6f64 6527 2920 696e 204f 5054 494d 495a  ode') in OPTIMIZ
+0001f770: 455f 4d4f 4445 530a 2020 2020 2020 2020  E_MODES.        
+0001f780: 2020 2020 2020 2020 6f72 2073 656c 662e          or self.
+0001f790: 6578 6368 616e 6765 5f68 6173 2827 6665  exchange_has('fe
+0001f7a0: 7463 684c 6576 6572 6167 6554 6965 7273  tchLeverageTiers
+0001f7b0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0001f7c0: 2020 206f 7220 7365 6c66 2e65 7863 6861     or self.excha
+0001f7d0: 6e67 655f 6861 7328 2766 6574 6368 4d61  nge_has('fetchMa
+0001f7e0: 726b 6574 4c65 7665 7261 6765 5469 6572  rketLeverageTier
+0001f7f0: 7327 2929 3a0a 0a20 2020 2020 2020 2020  s')):..         
+0001f800: 2020 2069 6620 7061 6972 206e 6f74 2069     if pair not i
+0001f810: 6e20 7365 6c66 2e5f 6c65 7665 7261 6765  n self._leverage
+0001f820: 5f74 6965 7273 3a0a 2020 2020 2020 2020  _tiers:.        
+0001f830: 2020 2020 2020 2020 7261 6973 6520 496e          raise In
+0001f840: 7661 6c69 644f 7264 6572 4578 6365 7074  validOrderExcept
+0001f850: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+0001f860: 2020 2020 2020 2020 2066 224d 6169 6e74           f"Maint
+0001f870: 656e 616e 6365 206d 6172 6769 6e20 7261  enance margin ra
+0001f880: 7465 2066 6f72 207b 7061 6972 7d20 6973  te for {pair} is
+0001f890: 2075 6e61 7661 696c 6162 6c65 2066 6f72   unavailable for
+0001f8a0: 207b 7365 6c66 2e6e 616d 657d 220a 2020   {self.name}".  
+0001f8b0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001f8c0: 0a20 2020 2020 2020 2020 2020 2070 6169  .            pai
+0001f8d0: 725f 7469 6572 7320 3d20 7365 6c66 2e5f  r_tiers = self._
+0001f8e0: 6c65 7665 7261 6765 5f74 6965 7273 5b70  leverage_tiers[p
+0001f8f0: 6169 725d 0a0a 2020 2020 2020 2020 2020  air]..          
+0001f900: 2020 666f 7220 7469 6572 2069 6e20 7265    for tier in re
+0001f910: 7665 7273 6564 2870 6169 725f 7469 6572  versed(pair_tier
+0001f920: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0001f930: 2020 2020 6966 206e 6f6d 696e 616c 5f76      if nominal_v
+0001f940: 616c 7565 203e 3d20 7469 6572 5b27 6d69  alue >= tier['mi
+0001f950: 6e4e 6f74 696f 6e61 6c27 5d3a 0a20 2020  nNotional']:.   
+0001f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f970: 2072 6574 7572 6e20 2874 6965 725b 276d   return (tier['m
+0001f980: 6169 6e74 656e 616e 6365 4d61 7267 696e  aintenanceMargin
+0001f990: 5261 7465 275d 2c20 7469 6572 5b27 6d61  Rate'], tier['ma
+0001f9a0: 696e 7441 6d74 275d 290a 0a20 2020 2020  intAmt'])..     
+0001f9b0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+0001f9c0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+0001f9d0: 6e28 226e 6f6d 696e 616c 2076 616c 7565  n("nominal value
+0001f9e0: 2063 616e 206e 6f74 2062 6520 6c6f 7765   can not be lowe
+0001f9f0: 7220 7468 616e 2030 2229 0a20 2020 2020  r than 0").     
+0001fa00: 2020 2020 2020 2023 2054 6865 206c 6f77         # The low
+0001fa10: 6573 7420 6e6f 7469 6f6e 616c 5f66 6c6f  est notional_flo
+0001fa20: 6f72 2066 6f72 2061 6e79 2070 6169 7220  or for any pair 
+0001fa30: 696e 2066 6574 6368 5f6c 6576 6572 6167  in fetch_leverag
+0001fa40: 655f 7469 6572 7320 6973 2061 6c77 6179  e_tiers is alway
+0001fa50: 7320 3020 6265 6361 7573 6520 6974 0a20  s 0 because it. 
+0001fa60: 2020 2020 2020 2020 2020 2023 2064 6573             # des
+0001fa70: 6372 6962 6573 2074 6865 206d 696e 2061  cribes the min a
+0001fa80: 6d74 2066 6f72 2061 2074 6965 722c 2061  mt for a tier, a
+0001fa90: 6e64 2074 6865 206c 6f77 6573 7420 7469  nd the lowest ti
+0001faa0: 6572 2077 696c 6c20 616c 7761 7973 2067  er will always g
+0001fab0: 6f20 646f 776e 2074 6f20 300a 2020 2020  o down to 0.    
+0001fac0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001fad0: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+0001fae0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+0001faf0: 2866 2243 616e 6e6f 7420 6765 7420 6d61  (f"Cannot get ma
+0001fb00: 696e 7465 6e61 6e63 6520 7261 7469 6f20  intenance ratio 
+0001fb10: 7573 696e 6720 7b73 656c 662e 6e61 6d65  using {self.name
+0001fb20: 7d22 290a                                }").
```

### Comparing `freqtrade-2023.3/freqtrade/exchange/exchange_utils.py` & `freqtrade-2023.4/freqtrade/exchange/exchange_utils.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,16 +1,17 @@
 """
 Exchange support utils
 """
 from datetime import datetime, timedelta, timezone
-from math import ceil
+from math import ceil, floor
 from typing import Any, Dict, List, Optional, Tuple
 
 import ccxt
-from ccxt import ROUND_DOWN, ROUND_UP, TICK_SIZE, TRUNCATE, decimal_to_precision
+from ccxt import (DECIMAL_PLACES, ROUND, ROUND_DOWN, ROUND_UP, SIGNIFICANT_DIGITS, TICK_SIZE,
+                  TRUNCATE, decimal_to_precision)
 
 from freqtrade.exchange.common import BAD_EXCHANGES, EXCHANGE_HAS_OPTIONAL, EXCHANGE_HAS_REQUIRED
 from freqtrade.util import FtPrecise
 
 
 CcxtModuleType = Any
 
@@ -215,39 +216,55 @@
     if amount_precision is not None and precisionMode is not None:
         contracts = amount_to_contracts(amount, contract_size)
         amount_p = amount_to_precision(contracts, amount_precision, precisionMode)
         return contracts_to_amount(amount_p, contract_size)
     return amount
 
 
-def price_to_precision(price: float, price_precision: Optional[float],
-                       precisionMode: Optional[int]) -> float:
+def price_to_precision(
+    price: float,
+    price_precision: Optional[float],
+    precisionMode: Optional[int],
+    *,
+    rounding_mode: int = ROUND,
+) -> float:
     """
-    Returns the price rounded up to the precision the Exchange accepts.
+    Returns the price rounded to the precision the Exchange accepts.
     Partial Re-implementation of ccxt internal method decimal_to_precision(),
-    which does not support rounding up
+    which does not support rounding up.
+    For stoploss calculations, must use ROUND_UP for longs, and ROUND_DOWN for shorts.
+
     TODO: If ccxt supports ROUND_UP for decimal_to_precision(), we could remove this and
     align with amount_to_precision().
-    !!! Rounds up
     :param price: price to convert
     :param price_precision: price precision to use. Used from markets[pair]['precision']['price']
     :param precisionMode: precision mode to use. Should be used from precisionMode
                           one of ccxt's DECIMAL_PLACES, SIGNIFICANT_DIGITS, or TICK_SIZE
+    :param rounding_mode: rounding mode to use. Defaults to ROUND
     :return: price rounded up to the precision the Exchange accepts
-
     """
     if price_precision is not None and precisionMode is not None:
-        # price = float(decimal_to_precision(price, rounding_mode=ROUND,
-        #                                    precision=price_precision,
-        #                                    counting_mode=self.precisionMode,
-        #                                    ))
         if precisionMode == TICK_SIZE:
+            if rounding_mode == ROUND:
+                ticks = price / price_precision
+                rounded_ticks = round(ticks)
+                return rounded_ticks * price_precision
             precision = FtPrecise(price_precision)
             price_str = FtPrecise(price)
             missing = price_str % precision
             if not missing == FtPrecise("0"):
-                price = round(float(str(price_str - missing + precision)), 14)
-        else:
-            symbol_prec = price_precision
-            big_price = price * pow(10, symbol_prec)
-            price = ceil(big_price) / pow(10, symbol_prec)
+                return round(float(str(price_str - missing + precision)), 14)
+            return price
+        elif precisionMode in (SIGNIFICANT_DIGITS, DECIMAL_PLACES):
+            ndigits = round(price_precision)
+            if rounding_mode == ROUND:
+                return round(price, ndigits)
+            ticks = price * (10**ndigits)
+            if rounding_mode == ROUND_UP:
+                return ceil(ticks) / (10**ndigits)
+            if rounding_mode == TRUNCATE:
+                return int(ticks) / (10**ndigits)
+            if rounding_mode == ROUND_DOWN:
+                return floor(ticks) / (10**ndigits)
+            raise ValueError(f"Unknown rounding_mode {rounding_mode}")
+        raise ValueError(f"Unknown precisionMode {precisionMode}")
     return price
```

### Comparing `freqtrade-2023.3/freqtrade/exchange/gate.py` & `freqtrade-2023.4/freqtrade/exchange/gate.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/hitbtc.py` & `freqtrade-2023.4/freqtrade/exchange/hitbtc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/huobi.py` & `freqtrade-2023.4/freqtrade/exchange/huobi.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/kraken.py` & `freqtrade-2023.4/freqtrade/exchange/kraken.py`

 * *Files 2% similar despite different names*

```diff
@@ -8,14 +8,15 @@
 
 from freqtrade.constants import BuySell
 from freqtrade.enums import MarginMode, TradingMode
 from freqtrade.exceptions import (DDosProtection, InsufficientFundsError, InvalidOrderException,
                                   OperationalException, TemporaryError)
 from freqtrade.exchange import Exchange
 from freqtrade.exchange.common import retrier
+from freqtrade.exchange.exchange_utils import ROUND_DOWN, ROUND_UP
 from freqtrade.exchange.types import Tickers
 
 
 logger = logging.getLogger(__name__)
 
 
 class Kraken(Exchange):
@@ -105,26 +106,27 @@
         TODO: investigate if this can be combined with generic implementation
               (careful, prices are reversed)
         """
         params = self._params.copy()
         if self.trading_mode == TradingMode.FUTURES:
             params.update({'reduceOnly': True})
 
+        round_mode = ROUND_DOWN if side == 'buy' else ROUND_UP
         if order_types.get('stoploss', 'market') == 'limit':
             ordertype = "stop-loss-limit"
             limit_price_pct = order_types.get('stoploss_on_exchange_limit_ratio', 0.99)
             if side == "sell":
                 limit_rate = stop_price * limit_price_pct
             else:
                 limit_rate = stop_price * (2 - limit_price_pct)
-            params['price2'] = self.price_to_precision(pair, limit_rate)
+            params['price2'] = self.price_to_precision(pair, limit_rate, rounding_mode=round_mode)
         else:
             ordertype = "stop-loss"
 
-        stop_price = self.price_to_precision(pair, stop_price)
+        stop_price = self.price_to_precision(pair, stop_price, rounding_mode=round_mode)
 
         if self._config['dry_run']:
             dry_order = self.create_dry_run_order(
                 pair, ordertype, side, amount, stop_price, leverage, stop_loss=True)
             return dry_order
 
         try:
```

### Comparing `freqtrade-2023.3/freqtrade/exchange/kucoin.py` & `freqtrade-2023.4/freqtrade/exchange/kucoin.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/exchange/okx.py` & `freqtrade-2023.4/freqtrade/exchange/okx.py`

 * *Files 7% similar despite different names*

```diff
@@ -24,14 +24,15 @@
 
     _ft_has: Dict = {
         "ohlcv_candle_limit": 100,  # Warning, special case with data prior to X months
         "mark_ohlcv_timeframe": "4h",
         "funding_fee_timeframe": "8h",
         "stoploss_order_types": {"limit": "limit"},
         "stoploss_on_exchange": True,
+        "stop_price_param": "stopLossPrice",
     }
     _ft_has_futures: Dict = {
         "tickers_have_quoteVolume": False,
         "fee_cost_in_contracts": True,
         "stop_price_type_field": "slTriggerPxType",
         "stop_price_type_value_mapping": {
             PriceType.LAST: "last",
@@ -158,37 +159,20 @@
         if pair not in self._leverage_tiers:
             return float('inf')
 
         pair_tiers = self._leverage_tiers[pair]
         return pair_tiers[-1]['maxNotional'] / leverage
 
     def _get_stop_params(self, side: BuySell, ordertype: str, stop_price: float) -> Dict:
-
-        params = self._params.copy()
-        # Verify if stopPrice works for your exchange!
-        params.update({'stopLossPrice': stop_price})
-
+        params = super()._get_stop_params(side, ordertype, stop_price)
         if self.trading_mode == TradingMode.FUTURES and self.margin_mode:
             params['tdMode'] = self.margin_mode.value
             params['posSide'] = self._get_posSide(side, True)
         return params
 
-    def stoploss_adjust(self, stop_loss: float, order: Dict, side: str) -> bool:
-        """
-        OKX uses non-default stoploss price naming.
-        """
-        if not self._ft_has.get('stoploss_on_exchange'):
-            raise OperationalException(f"stoploss is not implemented for {self.name}.")
-
-        return (
-            order.get('stopLossPrice', None) is None
-            or ((side == "sell" and stop_loss > float(order['stopLossPrice'])) or
-                (side == "buy" and stop_loss < float(order['stopLossPrice'])))
-        )
-
     def fetch_stoploss_order(self, order_id: str, pair: str, params: Dict = {}) -> Dict:
         if self._config['dry_run']:
             return self.fetch_dry_run_order(order_id)
 
         try:
             params1 = {'stop': True}
             order_reg = self._api.fetch_order(order_id, pair, params=params1)
```

### Comparing `freqtrade-2023.3/freqtrade/exchange/types.py` & `freqtrade-2023.4/freqtrade/exchange/types.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/RL/Base3ActionRLEnv.py` & `freqtrade-2023.4/freqtrade/freqai/RL/Base3ActionRLEnv.py`

 * *Files 2% similar despite different names*

```diff
@@ -62,23 +62,23 @@
                     self._update_total_profit()
                 self._position = Positions.Short
                 trade_type = "short"
                 self._last_trade_tick = self._current_tick
             elif action == Actions.Sell.value and not self.can_short:
                 self._update_total_profit()
                 self._position = Positions.Neutral
-                trade_type = "neutral"
+                trade_type = "exit"
                 self._last_trade_tick = None
             else:
                 print("case not defined")
 
             if trade_type is not None:
                 self.trade_history.append(
                     {'price': self.current_price(), 'index': self._current_tick,
-                     'type': trade_type})
+                     'type': trade_type, 'profit': self.get_unrealized_profit()})
 
         if (self._total_profit < self.max_drawdown or
                 self._total_unrealized_profit < self.max_drawdown):
             self._done = True
 
         self._position_history.append(self._position)
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/RL/Base4ActionRLEnv.py` & `freqtrade-2023.4/freqtrade/freqai/RL/Base4ActionRLEnv.py`

 * *Files 14% similar despite different names*

```diff
@@ -48,49 +48,39 @@
         self._update_unrealized_total_profit()
         step_reward = self.calculate_reward(action)
         self.total_reward += step_reward
         self.tensorboard_log(self.actions._member_names_[action], category="actions")
 
         trade_type = None
         if self.is_tradesignal(action):
-            """
-            Action: Neutral, position: Long ->  Close Long
-            Action: Neutral, position: Short -> Close Short
-
-            Action: Long, position: Neutral -> Open Long
-            Action: Long, position: Short -> Close Short and Open Long
-
-            Action: Short, position: Neutral -> Open Short
-            Action: Short, position: Long -> Close Long and Open Short
-            """
 
             if action == Actions.Neutral.value:
                 self._position = Positions.Neutral
                 trade_type = "neutral"
                 self._last_trade_tick = None
             elif action == Actions.Long_enter.value:
                 self._position = Positions.Long
-                trade_type = "long"
+                trade_type = "enter_long"
                 self._last_trade_tick = self._current_tick
             elif action == Actions.Short_enter.value:
                 self._position = Positions.Short
-                trade_type = "short"
+                trade_type = "enter_short"
                 self._last_trade_tick = self._current_tick
             elif action == Actions.Exit.value:
                 self._update_total_profit()
                 self._position = Positions.Neutral
-                trade_type = "neutral"
+                trade_type = "exit"
                 self._last_trade_tick = None
             else:
                 print("case not defined")
 
             if trade_type is not None:
                 self.trade_history.append(
                     {'price': self.current_price(), 'index': self._current_tick,
-                     'type': trade_type})
+                     'type': trade_type, 'profit': self.get_unrealized_profit()})
 
         if (self._total_profit < self.max_drawdown or
                 self._total_unrealized_profit < self.max_drawdown):
             self._done = True
 
         self._position_history.append(self._position)
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/RL/Base5ActionRLEnv.py` & `freqtrade-2023.4/freqtrade/freqai/RL/Base5ActionRLEnv.py`

 * *Files 16% similar despite different names*

```diff
@@ -49,54 +49,44 @@
         self._update_unrealized_total_profit()
         step_reward = self.calculate_reward(action)
         self.total_reward += step_reward
         self.tensorboard_log(self.actions._member_names_[action], category="actions")
 
         trade_type = None
         if self.is_tradesignal(action):
-            """
-            Action: Neutral, position: Long ->  Close Long
-            Action: Neutral, position: Short -> Close Short
-
-            Action: Long, position: Neutral -> Open Long
-            Action: Long, position: Short -> Close Short and Open Long
-
-            Action: Short, position: Neutral -> Open Short
-            Action: Short, position: Long -> Close Long and Open Short
-            """
 
             if action == Actions.Neutral.value:
                 self._position = Positions.Neutral
                 trade_type = "neutral"
                 self._last_trade_tick = None
             elif action == Actions.Long_enter.value:
                 self._position = Positions.Long
-                trade_type = "long"
+                trade_type = "enter_long"
                 self._last_trade_tick = self._current_tick
             elif action == Actions.Short_enter.value:
                 self._position = Positions.Short
-                trade_type = "short"
+                trade_type = "enter_short"
                 self._last_trade_tick = self._current_tick
             elif action == Actions.Long_exit.value:
                 self._update_total_profit()
                 self._position = Positions.Neutral
-                trade_type = "neutral"
+                trade_type = "exit_long"
                 self._last_trade_tick = None
             elif action == Actions.Short_exit.value:
                 self._update_total_profit()
                 self._position = Positions.Neutral
-                trade_type = "neutral"
+                trade_type = "exit_short"
                 self._last_trade_tick = None
             else:
                 print("case not defined")
 
             if trade_type is not None:
                 self.trade_history.append(
                     {'price': self.current_price(), 'index': self._current_tick,
-                     'type': trade_type})
+                     'type': trade_type, 'profit': self.get_unrealized_profit()})
 
         if (self._total_profit < self.max_drawdown or
                 self._total_unrealized_profit < self.max_drawdown):
             self._done = True
 
         self._position_history.append(self._position)
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/RL/BaseEnvironment.py` & `freqtrade-2023.4/freqtrade/freqai/RL/BaseEnvironment.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/RL/BaseReinforcementLearningModel.py` & `freqtrade-2023.4/freqtrade/freqai/RL/BaseReinforcementLearningModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/RL/TensorboardCallback.py` & `freqtrade-2023.4/freqtrade/freqai/RL/TensorboardCallback.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/base_models/BaseClassifierModel.py` & `freqtrade-2023.4/freqtrade/freqai/base_models/BaseClassifierModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/base_models/BaseRegressionModel.py` & `freqtrade-2023.4/freqtrade/freqai/base_models/BaseRegressionModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/base_models/BaseTensorFlowModel.py` & `freqtrade-2023.4/freqtrade/freqai/base_models/BaseTensorFlowModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py` & `freqtrade-2023.4/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py` & `freqtrade-2023.4/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/data_drawer.py` & `freqtrade-2023.4/freqtrade/freqai/data_drawer.py`

 * *Files 2% similar despite different names*

```diff
@@ -442,15 +442,15 @@
         save_path = Path(dk.data_path)
 
         # Save the trained model
         if self.model_type == 'joblib':
             dump(model, save_path / f"{dk.model_filename}_model.joblib")
         elif self.model_type == 'keras':
             model.save(save_path / f"{dk.model_filename}_model.h5")
-        elif 'stable_baselines' in self.model_type or 'sb3_contrib' == self.model_type:
+        elif self.model_type in ["stable_baselines3", "sb3_contrib", "pytorch"]:
             model.save(save_path / f"{dk.model_filename}_model.zip")
 
         if dk.svm_model is not None:
             dump(dk.svm_model, save_path / f"{dk.model_filename}_svm_model.joblib")
 
         dk.data["data_path"] = str(dk.data_path)
         dk.data["model_filename"] = str(dk.model_filename)
@@ -492,15 +492,15 @@
         presaved backtesting (prediction file loading).
         """
         with (dk.data_path / f"{dk.model_filename}_metadata.json").open("r") as fp:
             dk.data = rapidjson.load(fp, number_mode=rapidjson.NM_NATIVE)
             dk.training_features_list = dk.data["training_features_list"]
             dk.label_list = dk.data["label_list"]
 
-    def load_data(self, coin: str, dk: FreqaiDataKitchen) -> Any:
+    def load_data(self, coin: str, dk: FreqaiDataKitchen) -> Any:  # noqa: C901
         """
         loads all data required to make a prediction on a sub-train time range
         :returns:
         :model: User trained model which can be inferenced for new predictions
         """
 
         if not self.pair_dict[coin]["model_filename"]:
@@ -533,14 +533,19 @@
             from tensorflow import keras
             model = keras.models.load_model(dk.data_path / f"{dk.model_filename}_model.h5")
         elif 'stable_baselines' in self.model_type or 'sb3_contrib' == self.model_type:
             mod = importlib.import_module(
                 self.model_type, self.freqai_info['rl_config']['model_type'])
             MODELCLASS = getattr(mod, self.freqai_info['rl_config']['model_type'])
             model = MODELCLASS.load(dk.data_path / f"{dk.model_filename}_model")
+        elif self.model_type == 'pytorch':
+            import torch
+            zip = torch.load(dk.data_path / f"{dk.model_filename}_model.zip")
+            model = zip["pytrainer"]
+            model = model.load_from_checkpoint(zip)
 
         if Path(dk.data_path / f"{dk.model_filename}_svm_model.joblib").is_file():
             dk.svm_model = load(dk.data_path / f"{dk.model_filename}_svm_model.joblib")
 
         if not model:
             raise OperationalException(
                 f"Unable to load model, ensure model exists at " f"{dk.data_path} "
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/data_kitchen.py` & `freqtrade-2023.4/freqtrade/freqai/data_kitchen.py`

 * *Files 0% similar despite different names*

```diff
@@ -1287,15 +1287,15 @@
                 informative_df = pd.concat((informative_df, df_shift), axis=1)
 
             dataframe = self.merge_features(dataframe.copy(), informative_df,
                                             self.config["timeframe"], tf, f'{pair}_{tf}')
 
         return dataframe
 
-    def use_strategy_to_populate_indicators(
+    def use_strategy_to_populate_indicators(  # noqa: C901
         self,
         strategy: IStrategy,
         corr_dataframes: dict = {},
         base_dataframes: dict = {},
         pair: str = "",
         prediction_dataframe: DataFrame = pd.DataFrame(),
         do_corr_pairs: bool = True,
@@ -1358,20 +1358,20 @@
         for corr_pair in corr_pairs:
             if pair == corr_pair:
                 continue  # dont repeat anything from whitelist
             if corr_pairs and do_corr_pairs:
                 dataframe = self.populate_features(dataframe.copy(), corr_pair, strategy,
                                                    corr_dataframes, base_dataframes, True)
 
-        dataframe = strategy.set_freqai_targets(dataframe.copy(), metadata=metadata)
+        if self.live:
+            dataframe = strategy.set_freqai_targets(dataframe.copy(), metadata=metadata)
+            dataframe = self.remove_special_chars_from_feature_names(dataframe)
 
         self.get_unique_classes_from_labels(dataframe)
 
-        dataframe = self.remove_special_chars_from_feature_names(dataframe)
-
         if self.config.get('reduce_df_footprint', False):
             dataframe = reduce_dataframe_footprint(dataframe)
 
         return dataframe
 
     def fit_labels(self) -> None:
         """
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/freqai_interface.py` & `freqtrade-2023.4/freqtrade/freqai/freqai_interface.py`

 * *Files 1% similar despite different names*

```diff
@@ -79,14 +79,15 @@
         self.keras: bool = self.freqai_info.get("keras", False)
         if self.keras and self.ft_params.get("DI_threshold", 0):
             self.ft_params["DI_threshold"] = 0
             logger.warning("DI threshold is not configured for Keras models yet. Deactivating.")
         self.CONV_WIDTH = self.freqai_info.get('conv_width', 1)
         if self.ft_params.get("inlier_metric_window", 0):
             self.CONV_WIDTH = self.ft_params.get("inlier_metric_window", 0) * 2
+        self.class_names: List[str] = []  # used in classification subclasses
         self.pair_it = 0
         self.pair_it_train = 0
         self.total_pairs = len(self.config.get("exchange", {}).get("pair_whitelist"))
         self.train_queue = self._set_train_queue()
         self.inference_time: float = 0
         self.train_time: float = 0
         self.begin_time: float = 0
@@ -302,25 +303,25 @@
 
             dk.set_new_model_names(pair, timestamp_model_id)
 
             if dk.check_if_backtest_prediction_is_valid(len_backtest_df):
                 if check_features:
                     self.dd.load_metadata(dk)
                     dataframe_dummy_features = self.dk.use_strategy_to_populate_indicators(
-                        strategy, prediction_dataframe=dataframe.tail(1), pair=metadata["pair"]
+                        strategy, prediction_dataframe=dataframe.tail(1), pair=pair
                     )
                     dk.find_features(dataframe_dummy_features)
                     self.check_if_feature_list_matches_strategy(dk)
                     check_features = False
                 append_df = dk.get_backtesting_prediction()
                 dk.append_predictions(append_df)
             else:
                 if populate_indicators:
                     dataframe = self.dk.use_strategy_to_populate_indicators(
-                        strategy, prediction_dataframe=dataframe, pair=metadata["pair"]
+                        strategy, prediction_dataframe=dataframe, pair=pair
                     )
                     populate_indicators = False
 
                 dataframe_base_train = dataframe.loc[dataframe["date"] < tr_train.stopdt, :]
                 dataframe_base_train = strategy.set_freqai_targets(
                     dataframe_base_train, metadata=metadata)
                 dataframe_base_backtest = dataframe.loc[dataframe["date"] < tr_backtest.stopdt, :]
@@ -328,14 +329,18 @@
                     dataframe_base_backtest, metadata=metadata)
 
                 tr_train = dk.buffer_timerange(tr_train)
 
                 dataframe_train = dk.slice_dataframe(tr_train, dataframe_base_train)
                 dataframe_backtest = dk.slice_dataframe(tr_backtest, dataframe_base_backtest)
 
+                dataframe_train = dk.remove_special_chars_from_feature_names(dataframe_train)
+                dataframe_backtest = dk.remove_special_chars_from_feature_names(dataframe_backtest)
+                dk.get_unique_classes_from_labels(dataframe_train)
+
                 if not self.model_exists(dk):
                     dk.find_features(dataframe_train)
                     dk.find_labels(dataframe_train)
 
                     try:
                         self.model = self.train(dataframe_train, pair, dk)
                     except Exception as msg:
@@ -563,16 +568,17 @@
         :return:
         :boolean: whether the model file exists or not.
         """
         if self.dd.model_type == 'joblib':
             file_type = ".joblib"
         elif self.dd.model_type == 'keras':
             file_type = ".h5"
-        elif 'stable_baselines' in self.dd.model_type or 'sb3_contrib' == self.dd.model_type:
+        elif self.dd.model_type in ["stable_baselines3", "sb3_contrib", "pytorch"]:
             file_type = ".zip"
+
         path_to_modelfile = Path(dk.data_path / f"{dk.model_filename}_model{file_type}")
         file_exists = path_to_modelfile.is_file()
         if file_exists:
             logger.info("Found model at %s", dk.data_path / dk.model_filename)
         else:
             logger.info("Could not find model at %s", dk.data_path / dk.model_filename)
         return file_exists
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/CatboostClassifier.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/CatboostClassifier.py`

 * *Files 9% similar despite different names*

```diff
@@ -10,24 +10,28 @@
 
 
 logger = logging.getLogger(__name__)
 
 
 class CatboostClassifier(BaseClassifierModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
         train_data = Pool(
             data=data_dictionary["train_features"],
             label=data_dictionary["train_labels"],
             weight=data_dictionary["train_weights"],
         )
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py`

 * *Files 9% similar despite different names*

```diff
@@ -11,24 +11,28 @@
 
 
 logger = logging.getLogger(__name__)
 
 
 class CatboostClassifierMultiTarget(BaseClassifierModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
         cbc = CatBoostClassifier(
             allow_writing_files=True,
             loss_function='MultiClass',
             train_dir=Path(dk.data_path),
             **self.model_training_parameters,
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/CatboostRegressor.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/CatboostRegressor.py`

 * *Files 14% similar despite different names*

```diff
@@ -10,24 +10,28 @@
 
 
 logger = logging.getLogger(__name__)
 
 
 class CatboostRegressor(BaseRegressionModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
         train_data = Pool(
             data=data_dictionary["train_features"],
             label=data_dictionary["train_labels"],
             weight=data_dictionary["train_weights"],
         )
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py`

 * *Files 9% similar despite different names*

```diff
@@ -11,24 +11,28 @@
 
 
 logger = logging.getLogger(__name__)
 
 
 class CatboostRegressorMultiTarget(BaseRegressionModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
         cbr = CatBoostRegressor(
             allow_writing_files=True,
             train_dir=Path(dk.data_path),
             **self.model_training_parameters,
         )
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py`

 * *Files 6% similar despite different names*

```diff
@@ -9,24 +9,28 @@
 
 
 logger = logging.getLogger(__name__)
 
 
 class LightGBMClassifierMultiTarget(BaseClassifierModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
         lgb = LGBMClassifier(**self.model_training_parameters)
 
         X = data_dictionary["train_features"]
         y = data_dictionary["train_labels"]
         sample_weight = data_dictionary["train_weights"]
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/LightGBMRegressor.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,46 +1,68 @@
 import logging
 from typing import Any, Dict
 
 from lightgbm import LGBMRegressor
 
 from freqtrade.freqai.base_models.BaseRegressionModel import BaseRegressionModel
+from freqtrade.freqai.base_models.FreqaiMultiOutputRegressor import FreqaiMultiOutputRegressor
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 
 
 logger = logging.getLogger(__name__)
 
 
-class LightGBMRegressor(BaseRegressionModel):
+class LightGBMRegressorMultiTarget(BaseRegressionModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
-        Most regressors use the same function names and arguments e.g. user
-        can drop in LGBMRegressor in place of CatBoostRegressor and all data
-        management will be properly handled by Freqai.
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        User sets up the training and test data to fit their desired model here
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
-        if self.freqai_info.get('data_split_parameters', {}).get('test_size', 0.1) == 0:
-            eval_set = None
-            eval_weights = None
-        else:
-            eval_set = (data_dictionary["test_features"], data_dictionary["test_labels"])
-            eval_weights = data_dictionary["test_weights"]
+        lgb = LGBMRegressor(**self.model_training_parameters)
+
         X = data_dictionary["train_features"]
         y = data_dictionary["train_labels"]
-        train_weights = data_dictionary["train_weights"]
+        sample_weight = data_dictionary["train_weights"]
 
-        init_model = self.get_init_model(dk.pair)
+        eval_weights = None
+        eval_sets = [None] * y.shape[1]
 
-        model = LGBMRegressor(**self.model_training_parameters)
+        if self.freqai_info.get('data_split_parameters', {}).get('test_size', 0.1) != 0:
+            eval_weights = [data_dictionary["test_weights"]]
+            eval_sets = [(None, None)] * data_dictionary['test_labels'].shape[1]  # type: ignore
+            for i in range(data_dictionary['test_labels'].shape[1]):
+                eval_sets[i] = (  # type: ignore
+                    data_dictionary["test_features"],
+                    data_dictionary["test_labels"].iloc[:, i]
+                )
+
+        init_model = self.get_init_model(dk.pair)
+        if init_model:
+            init_models = init_model.estimators_
+        else:
+            init_models = [None] * y.shape[1]
 
-        model.fit(X=X, y=y, eval_set=eval_set, sample_weight=train_weights,
-                  eval_sample_weight=[eval_weights], init_model=init_model)
+        fit_params = []
+        for i in range(len(eval_sets)):
+            fit_params.append(
+                {'eval_set': eval_sets[i], 'eval_sample_weight': eval_weights,
+                 'init_model': init_models[i]})
+
+        model = FreqaiMultiOutputRegressor(estimator=lgb)
+        thread_training = self.freqai_info.get('multitarget_parallel_training', False)
+        if thread_training:
+            model.n_jobs = y.shape[1]
+        model.fit(X=X, y=y, sample_weight=sample_weight, fit_params=fit_params)
 
         return model
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,64 +1,67 @@
 import logging
 from typing import Any, Dict
 
-from lightgbm import LGBMRegressor
+from xgboost import XGBRegressor
 
 from freqtrade.freqai.base_models.BaseRegressionModel import BaseRegressionModel
 from freqtrade.freqai.base_models.FreqaiMultiOutputRegressor import FreqaiMultiOutputRegressor
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 
 
 logger = logging.getLogger(__name__)
 
 
-class LightGBMRegressorMultiTarget(BaseRegressionModel):
+class XGBoostRegressorMultiTarget(BaseRegressionModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
-        lgb = LGBMRegressor(**self.model_training_parameters)
+        xgb = XGBRegressor(**self.model_training_parameters)
 
         X = data_dictionary["train_features"]
         y = data_dictionary["train_labels"]
         sample_weight = data_dictionary["train_weights"]
 
         eval_weights = None
         eval_sets = [None] * y.shape[1]
 
         if self.freqai_info.get('data_split_parameters', {}).get('test_size', 0.1) != 0:
             eval_weights = [data_dictionary["test_weights"]]
-            eval_sets = [(None, None)] * data_dictionary['test_labels'].shape[1]  # type: ignore
             for i in range(data_dictionary['test_labels'].shape[1]):
-                eval_sets[i] = (  # type: ignore
+                eval_sets[i] = [(  # type: ignore
                     data_dictionary["test_features"],
                     data_dictionary["test_labels"].iloc[:, i]
-                )
+                )]
 
         init_model = self.get_init_model(dk.pair)
         if init_model:
             init_models = init_model.estimators_
         else:
             init_models = [None] * y.shape[1]
 
         fit_params = []
         for i in range(len(eval_sets)):
             fit_params.append(
-                {'eval_set': eval_sets[i], 'eval_sample_weight': eval_weights,
-                 'init_model': init_models[i]})
+                {'eval_set': eval_sets[i], 'sample_weight_eval_set': eval_weights,
+                 'xgb_model': init_models[i]})
 
-        model = FreqaiMultiOutputRegressor(estimator=lgb)
+        model = FreqaiMultiOutputRegressor(estimator=xgb)
         thread_training = self.freqai_info.get('multitarget_parallel_training', False)
         if thread_training:
             model.n_jobs = y.shape[1]
         model.fit(X=X, y=y, sample_weight=sample_weight, fit_params=fit_params)
 
         return model
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/ReinforcementLearner.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/ReinforcementLearner.py`

 * *Files 2% similar despite different names*

```diff
@@ -67,15 +67,16 @@
             logger.info('Continual training activated - starting training from previously '
                         'trained agent.')
             model = self.dd.model_dictionary[dk.pair]
             model.set_env(self.train_env)
 
         model.learn(
             total_timesteps=int(total_timesteps),
-            callback=[self.eval_callback, self.tensorboard_callback]
+            callback=[self.eval_callback, self.tensorboard_callback],
+            progress_bar=self.rl_config.get('progress_bar', False)
         )
 
         if Path(dk.data_path / "best_model.zip").is_file():
             logger.info('Callback found a best model.')
             best_model = self.MODELCLASS.load(dk.data_path / "best_model")
             return best_model
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostClassifier.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py`

 * *Files 15% similar despite different names*

```diff
@@ -3,35 +3,39 @@
 
 import numpy as np
 import numpy.typing as npt
 import pandas as pd
 from pandas import DataFrame
 from pandas.api.types import is_integer_dtype
 from sklearn.preprocessing import LabelEncoder
-from xgboost import XGBClassifier
+from xgboost import XGBRFClassifier
 
 from freqtrade.freqai.base_models.BaseClassifierModel import BaseClassifierModel
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 
 
 logger = logging.getLogger(__name__)
 
 
-class XGBoostClassifier(BaseClassifierModel):
+class XGBoostRFClassifier(BaseClassifierModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
         X = data_dictionary["train_features"].to_numpy()
         y = data_dictionary["train_labels"].to_numpy()[:, 0]
 
         le = LabelEncoder()
         if not is_integer_dtype(y):
@@ -48,27 +52,27 @@
 
             eval_set = [(test_features, test_labels)]
 
         train_weights = data_dictionary["train_weights"]
 
         init_model = self.get_init_model(dk.pair)
 
-        model = XGBClassifier(**self.model_training_parameters)
+        model = XGBRFClassifier(**self.model_training_parameters)
 
         model.fit(X=X, y=y, eval_set=eval_set, sample_weight=train_weights,
                   xgb_model=init_model)
 
         return model
 
     def predict(
         self, unfiltered_df: DataFrame, dk: FreqaiDataKitchen, **kwargs
     ) -> Tuple[DataFrame, npt.NDArray[np.int_]]:
         """
         Filter the prediction features data and predict with it.
-        :param unfiltered_df: Full dataframe for the current backtest period.
+        :param  unfiltered_df: Full dataframe for the current backtest period.
         :return:
         :pred_df: dataframe containing the predictions
         :do_predict: np.array of 1s and 0s to indicate places where freqai needed to remove
         data (NaNs) or felt uncertain about data (PCA and DI index)
         """
 
         (pred_df, dk.do_predict) = super().predict(unfiltered_df, dk, **kwargs)
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/XGBoostClassifier.py`

 * *Files 21% similar despite different names*

```diff
@@ -3,35 +3,39 @@
 
 import numpy as np
 import numpy.typing as npt
 import pandas as pd
 from pandas import DataFrame
 from pandas.api.types import is_integer_dtype
 from sklearn.preprocessing import LabelEncoder
-from xgboost import XGBRFClassifier
+from xgboost import XGBClassifier
 
 from freqtrade.freqai.base_models.BaseClassifierModel import BaseClassifierModel
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 
 
 logger = logging.getLogger(__name__)
 
 
-class XGBoostRFClassifier(BaseClassifierModel):
+class XGBoostClassifier(BaseClassifierModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-            all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
         X = data_dictionary["train_features"].to_numpy()
         y = data_dictionary["train_labels"].to_numpy()[:, 0]
 
         le = LabelEncoder()
         if not is_integer_dtype(y):
@@ -48,27 +52,27 @@
 
             eval_set = [(test_features, test_labels)]
 
         train_weights = data_dictionary["train_weights"]
 
         init_model = self.get_init_model(dk.pair)
 
-        model = XGBRFClassifier(**self.model_training_parameters)
+        model = XGBClassifier(**self.model_training_parameters)
 
         model.fit(X=X, y=y, eval_set=eval_set, sample_weight=train_weights,
                   xgb_model=init_model)
 
         return model
 
     def predict(
         self, unfiltered_df: DataFrame, dk: FreqaiDataKitchen, **kwargs
     ) -> Tuple[DataFrame, npt.NDArray[np.int_]]:
         """
         Filter the prediction features data and predict with it.
-        :param  unfiltered_df: Full dataframe for the current backtest period.
+        :param unfiltered_df: Full dataframe for the current backtest period.
         :return:
         :pred_df: dataframe containing the predictions
         :do_predict: np.array of 1s and 0s to indicate places where freqai needed to remove
         data (NaNs) or felt uncertain about data (PCA and DI index)
         """
 
         (pred_df, dk.do_predict) = super().predict(unfiltered_df, dk, **kwargs)
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/LightGBMClassifier.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,46 +1,49 @@
 import logging
 from typing import Any, Dict
 
-from xgboost import XGBRFRegressor
+from lightgbm import LGBMClassifier
 
-from freqtrade.freqai.base_models.BaseRegressionModel import BaseRegressionModel
+from freqtrade.freqai.base_models.BaseClassifierModel import BaseClassifierModel
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 
 
 logger = logging.getLogger(__name__)
 
 
-class XGBoostRFRegressor(BaseRegressionModel):
+class LightGBMClassifier(BaseClassifierModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
-        X = data_dictionary["train_features"]
-        y = data_dictionary["train_labels"]
-
-        if self.freqai_info.get("data_split_parameters", {}).get("test_size", 0.1) == 0:
+        if self.freqai_info.get('data_split_parameters', {}).get('test_size', 0.1) == 0:
             eval_set = None
-            eval_weights = None
+            test_weights = None
         else:
-            eval_set = [(data_dictionary["test_features"], data_dictionary["test_labels"])]
-            eval_weights = [data_dictionary['test_weights']]
-
-        sample_weight = data_dictionary["train_weights"]
+            eval_set = (data_dictionary["test_features"].to_numpy(),
+                        data_dictionary["test_labels"].to_numpy()[:, 0])
+            test_weights = data_dictionary["test_weights"]
+        X = data_dictionary["train_features"].to_numpy()
+        y = data_dictionary["train_labels"].to_numpy()[:, 0]
+        train_weights = data_dictionary["train_weights"]
 
-        xgb_model = self.get_init_model(dk.pair)
+        init_model = self.get_init_model(dk.pair)
 
-        model = XGBRFRegressor(**self.model_training_parameters)
+        model = LGBMClassifier(**self.model_training_parameters)
 
-        model.fit(X=X, y=y, sample_weight=sample_weight, eval_set=eval_set,
-                  sample_weight_eval_set=eval_weights, xgb_model=xgb_model)
+        model.fit(X=X, y=y, eval_set=eval_set, sample_weight=train_weights,
+                  eval_sample_weight=[test_weights], init_model=init_model)
 
         return model
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostRegressor.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/LightGBMRegressor.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,46 +1,48 @@
 import logging
 from typing import Any, Dict
 
-from xgboost import XGBRegressor
+from lightgbm import LGBMRegressor
 
 from freqtrade.freqai.base_models.BaseRegressionModel import BaseRegressionModel
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 
 
 logger = logging.getLogger(__name__)
 
 
-class XGBoostRegressor(BaseRegressionModel):
+class LightGBMRegressor(BaseRegressionModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
-        X = data_dictionary["train_features"]
-        y = data_dictionary["train_labels"]
-
-        if self.freqai_info.get("data_split_parameters", {}).get("test_size", 0.1) == 0:
+        if self.freqai_info.get('data_split_parameters', {}).get('test_size', 0.1) == 0:
             eval_set = None
             eval_weights = None
         else:
-            eval_set = [(data_dictionary["test_features"], data_dictionary["test_labels"])]
-            eval_weights = [data_dictionary['test_weights']]
-
-        sample_weight = data_dictionary["train_weights"]
+            eval_set = (data_dictionary["test_features"], data_dictionary["test_labels"])
+            eval_weights = data_dictionary["test_weights"]
+        X = data_dictionary["train_features"]
+        y = data_dictionary["train_labels"]
+        train_weights = data_dictionary["train_weights"]
 
-        xgb_model = self.get_init_model(dk.pair)
+        init_model = self.get_init_model(dk.pair)
 
-        model = XGBRegressor(**self.model_training_parameters)
+        model = LGBMRegressor(**self.model_training_parameters)
 
-        model.fit(X=X, y=y, sample_weight=sample_weight, eval_set=eval_set,
-                  sample_weight_eval_set=eval_weights, xgb_model=xgb_model)
+        model.fit(X=X, y=y, eval_set=eval_set, sample_weight=train_weights,
+                  eval_sample_weight=[eval_weights], init_model=init_model)
 
         return model
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py` & `freqtrade-2023.4/freqtrade/freqai/prediction_models/XGBoostRegressor.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,63 +1,50 @@
 import logging
 from typing import Any, Dict
 
 from xgboost import XGBRegressor
 
 from freqtrade.freqai.base_models.BaseRegressionModel import BaseRegressionModel
-from freqtrade.freqai.base_models.FreqaiMultiOutputRegressor import FreqaiMultiOutputRegressor
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 
 
 logger = logging.getLogger(__name__)
 
 
-class XGBoostRegressorMultiTarget(BaseRegressionModel):
+class XGBoostRegressor(BaseRegressionModel):
     """
-    User created prediction model. The class needs to override three necessary
-    functions, predict(), train(), fit(). The class inherits ModelHandler which
-    has its own DataHandler where data is held, saved, loaded, and managed.
+    User created prediction model. The class inherits IFreqaiModel, which
+    means it has full access to all Frequency AI functionality. Typically,
+    users would use this to override the common `fit()`, `train()`, or
+    `predict()` methods to add their custom data handling tools or change
+    various aspects of the training that cannot be configured via the
+    top level config.json file.
     """
 
     def fit(self, data_dictionary: Dict, dk: FreqaiDataKitchen, **kwargs) -> Any:
         """
         User sets up the training and test data to fit their desired model here
-        :param data_dictionary: the dictionary constructed by DataHandler to hold
-                                all the training and test data/labels.
+        :param data_dictionary: the dictionary holding all data for train, test,
+            labels, weights
+        :param dk: The datakitchen object for the current coin/model
         """
 
-        xgb = XGBRegressor(**self.model_training_parameters)
-
         X = data_dictionary["train_features"]
         y = data_dictionary["train_labels"]
+
+        if self.freqai_info.get("data_split_parameters", {}).get("test_size", 0.1) == 0:
+            eval_set = None
+            eval_weights = None
+        else:
+            eval_set = [(data_dictionary["test_features"], data_dictionary["test_labels"])]
+            eval_weights = [data_dictionary['test_weights']]
+
         sample_weight = data_dictionary["train_weights"]
 
-        eval_weights = None
-        eval_sets = [None] * y.shape[1]
+        xgb_model = self.get_init_model(dk.pair)
 
-        if self.freqai_info.get('data_split_parameters', {}).get('test_size', 0.1) != 0:
-            eval_weights = [data_dictionary["test_weights"]]
-            for i in range(data_dictionary['test_labels'].shape[1]):
-                eval_sets[i] = [(  # type: ignore
-                    data_dictionary["test_features"],
-                    data_dictionary["test_labels"].iloc[:, i]
-                )]
-
-        init_model = self.get_init_model(dk.pair)
-        if init_model:
-            init_models = init_model.estimators_
-        else:
-            init_models = [None] * y.shape[1]
+        model = XGBRegressor(**self.model_training_parameters)
 
-        fit_params = []
-        for i in range(len(eval_sets)):
-            fit_params.append(
-                {'eval_set': eval_sets[i], 'sample_weight_eval_set': eval_weights,
-                 'xgb_model': init_models[i]})
-
-        model = FreqaiMultiOutputRegressor(estimator=xgb)
-        thread_training = self.freqai_info.get('multitarget_parallel_training', False)
-        if thread_training:
-            model.n_jobs = y.shape[1]
-        model.fit(X=X, y=y, sample_weight=sample_weight, fit_params=fit_params)
+        model.fit(X=X, y=y, sample_weight=sample_weight, eval_set=eval_set,
+                  sample_weight_eval_set=eval_weights, xgb_model=xgb_model)
 
         return model
```

### Comparing `freqtrade-2023.3/freqtrade/freqai/utils.py` & `freqtrade-2023.4/freqtrade/freqai/utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/freqtradebot.py` & `freqtrade-2023.4/freqtrade/freqtradebot.py`

 * *Files 0% similar despite different names*

```diff
@@ -17,18 +17,20 @@
 from freqtrade.data.converter import order_book_to_dataframe
 from freqtrade.data.dataprovider import DataProvider
 from freqtrade.edge import Edge
 from freqtrade.enums import (ExitCheckTuple, ExitType, RPCMessageType, RunMode, SignalDirection,
                              State, TradingMode)
 from freqtrade.exceptions import (DependencyException, ExchangeError, InsufficientFundsError,
                                   InvalidOrderException, PricingError)
-from freqtrade.exchange import timeframe_to_minutes, timeframe_to_next_date, timeframe_to_seconds
+from freqtrade.exchange import (ROUND_DOWN, ROUND_UP, timeframe_to_minutes, timeframe_to_next_date,
+                                timeframe_to_seconds)
 from freqtrade.misc import safe_value_fallback, safe_value_fallback2
 from freqtrade.mixins import LoggingMixin
 from freqtrade.persistence import Order, PairLocks, Trade, init_db
+from freqtrade.persistence.key_value_store import set_startup_time
 from freqtrade.plugins.pairlistmanager import PairListManager
 from freqtrade.plugins.protectionmanager import ProtectionManager
 from freqtrade.resolvers import ExchangeResolver, StrategyResolver
 from freqtrade.rpc import RPCManager
 from freqtrade.rpc.external_message_consumer import ExternalMessageConsumer
 from freqtrade.rpc.rpc_types import (RPCBuyMsg, RPCCancelMsg, RPCProtectionMsg, RPCSellCancelMsg,
                                      RPCSellMsg)
@@ -177,14 +179,15 @@
 
     def startup(self) -> None:
         """
         Called on startup and after reloading the bot - triggers notifications and
         performs startup tasks
         """
         migrate_binance_futures_names(self.config)
+        set_startup_time()
 
         self.rpc.startup_messages(self.config, self.pairlists, self.protections)
         # Update older trades with precision and precision mode
         self.startup_backpopulate_precision()
         if not self.edge:
             # Adjust stoploss if it was changed
             Trade.stoploss_reinitialization(self.strategy.stoploss)
@@ -849,15 +852,16 @@
     def cancel_stoploss_on_exchange(self, trade: Trade) -> Trade:
         # First cancelling stoploss on exchange ...
         if trade.stoploss_order_id:
             try:
                 logger.info(f"Canceling stoploss on exchange for {trade}")
                 co = self.exchange.cancel_stoploss_order_with_result(
                     trade.stoploss_order_id, trade.pair, trade.amount)
-                trade.update_order(co)
+                self.update_trade_state(trade, trade.stoploss_order_id, co, stoploss_order=True)
+
                 # Reset stoploss order id.
                 trade.stoploss_order_id = None
             except InvalidOrderException:
                 logger.exception(f"Could not cancel stoploss order {trade.stoploss_order_id} "
                                  f"for pair {trade.pair}")
         return trade
 
@@ -941,15 +945,15 @@
             min_stake_amount=min_stake_amount,
             max_stake_amount=max_stake_amount,
             trade_amount=trade.stake_amount if trade else None,
         )
 
         return enter_limit_requested, stake_amount, leverage
 
-    def _notify_enter(self, trade: Trade, order: Order, order_type: Optional[str] = None,
+    def _notify_enter(self, trade: Trade, order: Order, order_type: str,
                       fill: bool = False, sub_trade: bool = False) -> None:
         """
         Sends rpc notification when a entry order occurred.
         """
         open_rate = order.safe_price
 
         if open_rate is None:
@@ -1167,15 +1171,16 @@
             # First we check if there is already a stoploss on exchange
             stoploss_order = self.exchange.fetch_stoploss_order(
                 trade.stoploss_order_id, trade.pair) if trade.stoploss_order_id else None
         except InvalidOrderException as exception:
             logger.warning('Unable to fetch stoploss order: %s', exception)
 
         if stoploss_order:
-            trade.update_order(stoploss_order)
+            self.update_trade_state(trade, trade.stoploss_order_id, stoploss_order,
+                                    stoploss_order=True)
 
         # We check if stoploss order is fulfilled
         if stoploss_order and stoploss_order['status'] in ('closed', 'triggered'):
             trade.exit_reason = ExitType.STOPLOSS_ON_EXCHANGE.value
             self.update_trade_state(trade, trade.stoploss_order_id, stoploss_order,
                                     stoploss_order=True)
             self._notify_exit(trade, "stoploss", True)
@@ -1231,15 +1236,17 @@
         """
         Check to see if stoploss on exchange should be updated
         in case of trailing stoploss on exchange
         :param trade: Corresponding Trade
         :param order: Current on exchange stoploss order
         :return: None
         """
-        stoploss_norm = self.exchange.price_to_precision(trade.pair, trade.stoploss_or_liquidation)
+        stoploss_norm = self.exchange.price_to_precision(
+            trade.pair, trade.stoploss_or_liquidation,
+            rounding_mode=ROUND_DOWN if trade.is_short else ROUND_UP)
 
         if self.exchange.stoploss_adjust(stoploss_norm, order, side=trade.exit_side):
             # we check if the update is necessary
             update_beat = self.strategy.order_types.get('stoploss_on_exchange_interval', 60)
             upd_req = datetime.now(timezone.utc) - timedelta(seconds=update_beat)
             if trade.stoploss_last_update_utc and upd_req >= trade.stoploss_last_update_utc:
                 # cancelling the current stoploss on exchange first
@@ -1414,15 +1421,15 @@
                 logger.warning(f"Order {trade.open_order_id} for {trade.pair} not cancelled.")
                 return False
         else:
             # Order was cancelled already, so we can reuse the existing dict
             corder = order
             reason = constants.CANCEL_REASON['CANCELLED_ON_EXCHANGE']
 
-        logger.info('%s order %s for %s.', side, reason, trade)
+        logger.info(f'{side} order {reason} for {trade}.')
 
         # Using filled to determine the filled amount
         filled_amount = safe_value_fallback2(corder, order, 'filled', 'filled')
         if isclose(filled_amount, 0.0, abs_tol=constants.MATH_CLOSE_PREC):
             # if trade is not partially completed and it's the only order, just delete the trade
             open_order_count = len([order for order in trade.orders if order.status == 'open'])
             if open_order_count <= 1 and trade.nr_of_successful_entries == 0 and not replacing:
@@ -1474,38 +1481,39 @@
                         order_type=self.strategy.order_types['exit'],
                         reason=reason, order_id=order['id'],
                         sub_trade=trade.amount != order['amount']
                     )
                     return False
 
             try:
-                order = self.exchange.cancel_order_with_result(order['id'], trade.pair,
-                                                               trade.amount)
+                order = self.exchange.cancel_order_with_result(
+                    order['id'], trade.pair, trade.amount)
             except InvalidOrderException:
                 logger.exception(
                     f"Could not cancel {trade.exit_side} order {trade.open_order_id}")
                 return False
 
             # Set exit_reason for fill message
             exit_reason_prev = trade.exit_reason
             trade.exit_reason = trade.exit_reason + f", {reason}" if trade.exit_reason else reason
             # Order might be filled above in odd timing issues.
             if order.get('status') in ('canceled', 'cancelled'):
                 trade.exit_reason = None
+                trade.open_order_id = None
             else:
                 trade.exit_reason = exit_reason_prev
             cancelled = True
         else:
             reason = constants.CANCEL_REASON['CANCELLED_ON_EXCHANGE']
             trade.exit_reason = None
+            trade.open_order_id = None
 
-        self.update_trade_state(trade, trade.open_order_id, order)
+        self.update_trade_state(trade, order['id'], order)
 
         logger.info(f'{trade.exit_side.capitalize()} order {reason} for {trade}.')
-        trade.open_order_id = None
         trade.close_rate = None
         trade.close_rate_requested = None
 
         self._notify_exit_cancel(
             trade,
             order_type=self.strategy.order_types['exit'],
             reason=reason, order_id=order['id'], sub_trade=trade.amount != order['amount']
@@ -1774,19 +1782,19 @@
         :return: True if order has been cancelled without being filled partially, False otherwise
         """
         if not order_id:
             logger.warning(f'Orderid for trade {trade} is empty.')
             return False
 
         # Update trade with order values
-        logger.info(f'Found open order for {trade}')
+        if not stoploss_order:
+            logger.info(f'Found open order for {trade}')
         try:
-            order = action_order or self.exchange.fetch_order_or_stoploss_order(order_id,
-                                                                                trade.pair,
-                                                                                stoploss_order)
+            order = action_order or self.exchange.fetch_order_or_stoploss_order(
+                order_id, trade.pair, stoploss_order)
         except InvalidOrderException as exception:
             logger.warning('Unable to fetch order %s: %s', order_id, exception)
             return False
 
         trade.update_order(order)
 
         if self.exchange.check_order_canceled_empty(order):
@@ -1843,15 +1851,15 @@
             # Exit notification
             if send_msg and not stoploss_order and not trade.open_order_id:
                 self._notify_exit(trade, '', fill=True, sub_trade=sub_trade, order=order)
             if not trade.is_open:
                 self.handle_protections(trade.pair, trade.trade_direction)
         elif send_msg and not trade.open_order_id and not stoploss_order:
             # Enter fill
-            self._notify_enter(trade, order, fill=True, sub_trade=sub_trade)
+            self._notify_enter(trade, order, order.order_type, fill=True, sub_trade=sub_trade)
 
     def handle_protections(self, pair: str, side: LongShort) -> None:
         # Lock pair for one candle to prevent immediate rebuys
         self.strategy.lock_pair(pair, datetime.now(timezone.utc), reason='Auto lock')
         prot_trig = self.protections.stop_per_pair(pair, side=side)
         if prot_trig:
             msg: RPCProtectionMsg = {
```

### Comparing `freqtrade-2023.3/freqtrade/leverage/interest.py` & `freqtrade-2023.4/freqtrade/leverage/interest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/loggers.py` & `freqtrade-2023.4/freqtrade/loggers/__init__.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,28 +1,15 @@
 import logging
-import sys
 from logging import Formatter
-from logging.handlers import BufferingHandler, RotatingFileHandler, SysLogHandler
+from logging.handlers import RotatingFileHandler, SysLogHandler
 
 from freqtrade.constants import Config
 from freqtrade.exceptions import OperationalException
-
-
-class FTBufferingHandler(BufferingHandler):
-    def flush(self):
-        """
-        Override Flush behaviour - we keep half of the configured capacity
-        otherwise, we have moments with "empty" logs.
-        """
-        self.acquire()
-        try:
-            # Keep half of the records in buffer.
-            self.buffer = self.buffer[-int(self.capacity / 2):]
-        finally:
-            self.release()
+from freqtrade.loggers.buffering_handler import FTBufferingHandler
+from freqtrade.loggers.std_err_stream_handler import FTStdErrStreamHandler
 
 
 logger = logging.getLogger(__name__)
 LOGFORMAT = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
 
 # Initialize bufferhandler - will be used for /log endpoints
 bufferHandler = FTBufferingHandler(1000)
@@ -65,15 +52,15 @@
     Early messages (before proper logging setup) will therefore only be sent to additional
     logging handlers after the real initialization, because we don't know which
     ones the user desires beforehand.
     """
     logging.basicConfig(
         level=logging.INFO,
         format=LOGFORMAT,
-        handlers=[logging.StreamHandler(sys.stderr), bufferHandler]
+        handlers=[FTStdErrStreamHandler(), bufferHandler]
     )
 
 
 def setup_logging(config: Config) -> None:
     """
     Process -v/--verbose, --logfile options
     """
```

### Comparing `freqtrade-2023.3/freqtrade/main.py` & `freqtrade-2023.4/freqtrade/main.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/misc.py` & `freqtrade-2023.4/freqtrade/misc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/mixins/logging_mixin.py` & `freqtrade-2023.4/freqtrade/mixins/logging_mixin.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/backtest_caching.py` & `freqtrade-2023.4/freqtrade/optimize/backtest_caching.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/backtesting.py` & `freqtrade-2023.4/freqtrade/optimize/backtesting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/bt_progress.py` & `freqtrade-2023.4/freqtrade/optimize/bt_progress.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/edge_cli.py` & `freqtrade-2023.4/freqtrade/optimize/edge_cli.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt.py`

 * *Files 4% similar despite different names*

```diff
@@ -9,21 +9,21 @@
 import sys
 import warnings
 from datetime import datetime, timezone
 from math import ceil
 from pathlib import Path
 from typing import Any, Dict, List, Optional, Tuple
 
-import progressbar
 import rapidjson
-from colorama import Fore, Style
 from colorama import init as colorama_init
 from joblib import Parallel, cpu_count, delayed, dump, load, wrap_non_picklable_objects
 from joblib.externals import cloudpickle
 from pandas import DataFrame
+from rich.progress import (BarColumn, MofNCompleteColumn, Progress, TaskProgressColumn, TextColumn,
+                           TimeElapsedColumn, TimeRemainingColumn)
 
 from freqtrade.constants import DATETIME_PRINT_FORMAT, FTHYPT_FILEVERSION, LAST_BT_RESULT_FN, Config
 from freqtrade.data.converter import trim_dataframes
 from freqtrade.data.history import get_timerange
 from freqtrade.data.metrics import calculate_market_change
 from freqtrade.enums import HyperoptState
 from freqtrade.exceptions import OperationalException
@@ -40,16 +40,14 @@
 
 # Suppress scikit-learn FutureWarnings from skopt
 with warnings.catch_warnings():
     warnings.filterwarnings("ignore", category=FutureWarning)
     from skopt import Optimizer
     from skopt.space import Dimension
 
-progressbar.streams.wrap_stderr()
-progressbar.streams.wrap_stdout()
 logger = logging.getLogger(__name__)
 
 
 INITIAL_POINTS = 30
 
 # Keep no more than SKOPT_MODEL_QUEUE_SIZE models
 # in the skopt model queue, to optimize memory consumption
@@ -377,15 +375,16 @@
     def _get_results_dict(self, backtesting_results, min_date, max_date,
                           params_dict, processed: Dict[str, DataFrame]
                           ) -> Dict[str, Any]:
         params_details = self._get_params_details(params_dict)
 
         strat_stats = generate_strategy_stats(
             self.pairlist, self.backtesting.strategy.get_strategy_name(),
-            backtesting_results, min_date, max_date, market_change=self.market_change
+            backtesting_results, min_date, max_date, market_change=self.market_change,
+            is_hyperopt=True,
         )
         results_explanation = HyperoptTools.format_results_explanation_string(
             strat_stats, self.config['stake_currency'])
 
         not_optimized = self.backtesting.strategy.get_no_optimize_params()
         not_optimized = deep_merge_dicts(not_optimized, self._get_no_optimize_details())
 
@@ -516,37 +515,14 @@
             return (
                 asked_non_tried[:min(len(asked_non_tried), n_points)],
                 is_random_non_tried[:min(len(asked_non_tried), n_points)]
             )
         else:
             return self.opt.ask(n_points=n_points), [False for _ in range(n_points)]
 
-    def get_progressbar_widgets(self):
-        if self.print_colorized:
-            widgets = [
-                ' [Epoch ', progressbar.Counter(), ' of ', str(self.total_epochs),
-                ' (', progressbar.Percentage(), ')] ',
-                progressbar.Bar(marker=progressbar.AnimatedMarker(
-                    fill='\N{FULL BLOCK}',
-                    fill_wrap=Fore.GREEN + '{}' + Fore.RESET,
-                    marker_wrap=Style.BRIGHT + '{}' + Style.RESET_ALL,
-                )),
-                ' [', progressbar.ETA(), ', ', progressbar.Timer(), ']',
-            ]
-        else:
-            widgets = [
-                ' [Epoch ', progressbar.Counter(), ' of ', str(self.total_epochs),
-                ' (', progressbar.Percentage(), ')] ',
-                progressbar.Bar(marker=progressbar.AnimatedMarker(
-                    fill='\N{FULL BLOCK}',
-                )),
-                ' [', progressbar.ETA(), ', ', progressbar.Timer(), ']',
-            ]
-        return widgets
-
     def evaluate_result(self, val: Dict[str, Any], current: int, is_random: bool):
         """
         Evaluate results returned from generate_optimizer
         """
         val['current_epoch'] = current
         val['is_initial_point'] = current <= INITIAL_POINTS
 
@@ -598,50 +574,56 @@
 
         try:
             with Parallel(n_jobs=config_jobs) as parallel:
                 jobs = parallel._effective_n_jobs()
                 logger.info(f'Effective number of parallel workers used: {jobs}')
 
                 # Define progressbar
-                widgets = self.get_progressbar_widgets()
-                with progressbar.ProgressBar(
-                    max_value=self.total_epochs, redirect_stdout=False, redirect_stderr=False,
-                    widgets=widgets
+                with Progress(
+                    TextColumn("[progress.description]{task.description}"),
+                    BarColumn(bar_width=None),
+                    MofNCompleteColumn(),
+                    TaskProgressColumn(),
+                    "•",
+                    TimeElapsedColumn(),
+                    "•",
+                    TimeRemainingColumn(),
+                    expand=True,
                 ) as pbar:
+                    task = pbar.add_task("Epochs", total=self.total_epochs)
+
                     start = 0
 
                     if self.analyze_per_epoch:
                         # First analysis not in parallel mode when using --analyze-per-epoch.
                         # This allows dataprovider to load it's informative cache.
                         asked, is_random = self.get_asked_points(n_points=1)
                         f_val0 = self.generate_optimizer(asked[0])
                         self.opt.tell(asked, [f_val0['loss']])
                         self.evaluate_result(f_val0, 1, is_random[0])
-                        pbar.update(1)
+                        pbar.update(task, advance=1)
                         start += 1
 
                     evals = ceil((self.total_epochs - start) / jobs)
                     for i in range(evals):
                         # Correct the number of epochs to be processed for the last
                         # iteration (should not exceed self.total_epochs in total)
                         n_rest = (i + 1) * jobs - (self.total_epochs - start)
                         current_jobs = jobs - n_rest if n_rest > 0 else jobs
 
                         asked, is_random = self.get_asked_points(n_points=current_jobs)
                         f_val = self.run_optimizer_parallel(parallel, asked)
                         self.opt.tell(asked, [v['loss'] for v in f_val])
 
-                        # Calculate progressbar outputs
                         for j, val in enumerate(f_val):
                             # Use human-friendly indexes here (starting from 1)
                             current = i * jobs + j + 1 + start
 
                             self.evaluate_result(val, current, is_random[j])
-
-                            pbar.update(current)
+                            pbar.update(task, advance=1)
 
         except KeyboardInterrupt:
             print('User interrupted..')
 
         logger.info(f"{self.num_epochs_saved} {plural(self.num_epochs_saved, 'epoch')} "
                     f"saved to '{self.results_file}'.")
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_auto.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_auto.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_epoch_filters.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_epoch_filters.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_interface.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_loss_interface.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_loss_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/optimize/hyperopt_tools.py` & `freqtrade-2023.4/freqtrade/optimize/hyperopt_tools.py`

 * *Files 2% similar despite different names*

```diff
@@ -19,14 +19,16 @@
 from freqtrade.optimize.optimize_reports import generate_wins_draws_losses
 
 
 logger = logging.getLogger(__name__)
 
 NON_OPT_PARAM_APPENDIX = "  # value loaded from strategy"
 
+HYPER_PARAMS_FILE_FORMAT = rapidjson.NM_NATIVE | rapidjson.NM_NAN
+
 
 def hyperopt_serializer(x):
     if isinstance(x, np.integer):
         return int(x)
     if isinstance(x, np.bool_):
         return bool(x)
 
@@ -72,18 +74,27 @@
             'ft_stratparam_v': 1,
             'export_time': datetime.now(timezone.utc),
         }
         logger.info(f"Dumping parameters to {filename}")
         with filename.open('w') as f:
             rapidjson.dump(final_params, f, indent=2,
                            default=hyperopt_serializer,
-                           number_mode=rapidjson.NM_NATIVE | rapidjson.NM_NAN
+                           number_mode=HYPER_PARAMS_FILE_FORMAT
                            )
 
     @staticmethod
+    def load_params(filename: Path) -> Dict:
+        """
+        Load parameters from file
+        """
+        with filename.open('r') as f:
+            params = rapidjson.load(f, number_mode=HYPER_PARAMS_FILE_FORMAT)
+        return params
+
+    @staticmethod
     def try_export_params(config: Config, strategy_name: str, params: Dict):
         if params.get(FTHYPT_FILEVERSION, 1) >= 2 and not config.get('disableparamexport', False):
             # Export parameters ...
             fn = HyperoptTools.get_strategy_filename(config, strategy_name)
             if fn:
                 HyperoptTools.export_params(params, strategy_name, fn.with_suffix('.json'))
             else:
@@ -185,15 +196,15 @@
             print(f"\n{header_str}:\n\n{explanation_str}\n")
 
         if print_json:
             result_dict: Dict = {}
             for s in ['buy', 'sell', 'protection',
                       'roi', 'stoploss', 'trailing', 'max_open_trades']:
                 HyperoptTools._params_update_for_json(result_dict, params, non_optimized, s)
-            print(rapidjson.dumps(result_dict, default=str, number_mode=rapidjson.NM_NATIVE))
+            print(rapidjson.dumps(result_dict, default=str, number_mode=HYPER_PARAMS_FILE_FORMAT))
 
         else:
             HyperoptTools._params_pretty_print(params, 'buy', "Buy hyperspace params:",
                                                non_optimized)
             HyperoptTools._params_pretty_print(params, 'sell', "Sell hyperspace params:",
                                                non_optimized)
             HyperoptTools._params_pretty_print(params, 'protection',
```

### Comparing `freqtrade-2023.3/freqtrade/optimize/optimize_reports.py` & `freqtrade-2023.4/freqtrade/optimize/optimize_reports.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,16 +3,16 @@
 from datetime import datetime, timedelta, timezone
 from pathlib import Path
 from typing import Any, Dict, List, Union
 
 from pandas import DataFrame, to_datetime
 from tabulate import tabulate
 
-from freqtrade.constants import (DATETIME_PRINT_FORMAT, LAST_BT_RESULT_FN, UNLIMITED_STAKE_AMOUNT,
-                                 Config, IntOrInf)
+from freqtrade.constants import (BACKTEST_BREAKDOWNS, DATETIME_PRINT_FORMAT, LAST_BT_RESULT_FN,
+                                 UNLIMITED_STAKE_AMOUNT, Config, IntOrInf)
 from freqtrade.data.metrics import (calculate_cagr, calculate_calmar, calculate_csum,
                                     calculate_expectancy, calculate_market_change,
                                     calculate_max_drawdown, calculate_sharpe, calculate_sortino)
 from freqtrade.misc import decimals_per_coin, file_dump_joblib, file_dump_json, round_coin_value
 from freqtrade.optimize.backtest_caching import get_backtest_metadata_filename
 
 
@@ -269,15 +269,16 @@
                     floatfmt=floatfmt, tablefmt="orgtbl", stralign="right")
 
 
 def _get_resample_from_period(period: str) -> str:
     if period == 'day':
         return '1d'
     if period == 'week':
-        return '1w'
+        # Weekly defaulting to Monday.
+        return '1W-MON'
     if period == 'month':
         return '1M'
     raise ValueError(f"Period {period} is not supported.")
 
 
 def generate_periodic_breakdown_stats(trade_list: List, period: str) -> List[Dict[str, Any]]:
     results = DataFrame.from_records(trade_list)
@@ -291,23 +292,31 @@
         profit_abs = day['profit_abs'].sum().round(10)
         wins = sum(day['profit_abs'] > 0)
         draws = sum(day['profit_abs'] == 0)
         loses = sum(day['profit_abs'] < 0)
         stats.append(
             {
                 'date': name.strftime('%d/%m/%Y'),
+                'date_ts': int(name.to_pydatetime().timestamp() * 1000),
                 'profit_abs': profit_abs,
                 'wins': wins,
                 'draws': draws,
                 'loses': loses
             }
         )
     return stats
 
 
+def generate_all_periodic_breakdown_stats(trade_list: List) -> Dict[str, List]:
+    result = {}
+    for period in BACKTEST_BREAKDOWNS:
+        result[period] = generate_periodic_breakdown_stats(trade_list, period)
+    return result
+
+
 def generate_trading_stats(results: DataFrame) -> Dict[str, Any]:
     """ Generate overall trade statistics """
     if len(results) == 0:
         return {
             'wins': 0,
             'losses': 0,
             'draws': 0,
@@ -376,15 +385,16 @@
     }
 
 
 def generate_strategy_stats(pairlist: List[str],
                             strategy: str,
                             content: Dict[str, Any],
                             min_date: datetime, max_date: datetime,
-                            market_change: float
+                            market_change: float,
+                            is_hyperopt: bool = False,
                             ) -> Dict[str, Any]:
     """
     :param pairlist: List of pairs to backtest
     :param strategy: Strategy name
     :param content: Backtest result data in the format:
                     {'results: results, 'config: config}}.
     :param min_date: Backtest start date
@@ -411,14 +421,19 @@
                                                    results=results)
     left_open_results = generate_pair_metrics(
         pairlist, stake_currency=stake_currency, starting_balance=start_balance,
         results=results.loc[results['exit_reason'] == 'force_exit'], skip_nan=True)
 
     daily_stats = generate_daily_stats(results)
     trade_stats = generate_trading_stats(results)
+
+    periodic_breakdown = {}
+    if not is_hyperopt:
+        periodic_breakdown = {'periodic_breakdown': generate_all_periodic_breakdown_stats(results)}
+
     best_pair = max([pair for pair in pair_results if pair['key'] != 'TOTAL'],
                     key=lambda x: x['profit_sum']) if len(pair_results) > 1 else None
     worst_pair = min([pair for pair in pair_results if pair['key'] != 'TOTAL'],
                      key=lambda x: x['profit_sum']) if len(pair_results) > 1 else None
     winning_profit = results.loc[results['profit_abs'] > 0, 'profit_abs'].sum()
     losing_profit = results.loc[results['profit_abs'] < 0, 'profit_abs'].sum()
     profit_factor = winning_profit / abs(losing_profit) if losing_profit else 0.0
@@ -429,15 +444,14 @@
         'locks': [lock.to_json() for lock in content['locks']],
         'best_pair': best_pair,
         'worst_pair': worst_pair,
         'results_per_pair': pair_results,
         'results_per_enter_tag': enter_tag_results,
         'exit_reason_summary': exit_reason_stats,
         'left_open_trades': left_open_results,
-        # 'days_breakdown_stats': days_breakdown_stats,
 
         'total_trades': len(results),
         'trade_count_long': len(results.loc[~results['is_short']]),
         'trade_count_short': len(results.loc[results['is_short']]),
         'total_volume': float(results['stake_amount'].sum()),
         'avg_stake_amount': results['stake_amount'].mean() if len(results) > 0 else 0,
         'profit_mean': results['profit_ratio'].mean() if len(results) > 0 else 0,
@@ -494,14 +508,15 @@
         'trailing_only_offset_is_reached': config.get('trailing_only_offset_is_reached', False),
         'use_custom_stoploss': config.get('use_custom_stoploss', False),
         'minimal_roi': config['minimal_roi'],
         'use_exit_signal': config['use_exit_signal'],
         'exit_profit_only': config['exit_profit_only'],
         'exit_profit_offset': config['exit_profit_offset'],
         'ignore_roi_if_entry_signal': config['ignore_roi_if_entry_signal'],
+        **periodic_breakdown,
         **daily_stats,
         **trade_stats
     }
 
     try:
         max_drawdown_legacy, _, _, _, _, _ = calculate_max_drawdown(
             results, value_col='profit_ratio')
@@ -861,14 +876,19 @@
     # Print results
     print(f"Result for strategy {strategy}")
     table = text_table_bt_results(results['results_per_pair'], stake_currency=stake_currency)
     if isinstance(table, str):
         print(' BACKTESTING REPORT '.center(len(table.splitlines()[0]), '='))
     print(table)
 
+    table = text_table_bt_results(results['left_open_trades'], stake_currency=stake_currency)
+    if isinstance(table, str) and len(table) > 0:
+        print(' LEFT OPEN TRADES REPORT '.center(len(table.splitlines()[0]), '='))
+    print(table)
+
     if (results.get('results_per_enter_tag') is not None
             or results.get('results_per_buy_tag') is not None):
         # results_per_buy_tag is deprecated and should be removed 2 versions after short golive.
         table = text_table_tags(
             "enter_tag",
             results.get('results_per_enter_tag', results.get('results_per_buy_tag')),
             stake_currency=stake_currency)
@@ -880,22 +900,20 @@
     exit_reasons = results.get('exit_reason_summary', results.get('sell_reason_summary'))
     table = text_table_exit_reason(exit_reason_stats=exit_reasons,
                                    stake_currency=stake_currency)
     if isinstance(table, str) and len(table) > 0:
         print(' EXIT REASON STATS '.center(len(table.splitlines()[0]), '='))
     print(table)
 
-    table = text_table_bt_results(results['left_open_trades'], stake_currency=stake_currency)
-    if isinstance(table, str) and len(table) > 0:
-        print(' LEFT OPEN TRADES REPORT '.center(len(table.splitlines()[0]), '='))
-    print(table)
-
     for period in backtest_breakdown:
-        days_breakdown_stats = generate_periodic_breakdown_stats(
-            trade_list=results['trades'], period=period)
+        if period in results.get('periodic_breakdown', {}):
+            days_breakdown_stats = results['periodic_breakdown'][period]
+        else:
+            days_breakdown_stats = generate_periodic_breakdown_stats(
+                trade_list=results['trades'], period=period)
         table = text_table_periodic_breakdown(days_breakdown_stats=days_breakdown_stats,
                                               stake_currency=stake_currency, period=period)
         if isinstance(table, str) and len(table) > 0:
             print(f' {period.upper()} BREAKDOWN '.center(len(table.splitlines()[0]), '='))
         print(table)
 
     table = text_table_add_metrics(results)
@@ -913,19 +931,19 @@
     stake_currency = config['stake_currency']
 
     for strategy, results in backtest_stats['strategy'].items():
         show_backtest_result(
             strategy, results, stake_currency,
             config.get('backtest_breakdown', []))
 
-    if len(backtest_stats['strategy']) > 1:
+    if len(backtest_stats['strategy']) > 0:
         # Print Strategy summary table
 
         table = text_table_strategy(backtest_stats['strategy_comparison'], stake_currency)
-        print(f"{results['backtest_start']} -> {results['backtest_end']} |"
+        print(f"Backtested {results['backtest_start']} -> {results['backtest_end']} |"
               f" Max open trades : {results['max_open_trades']}")
         print(' STRATEGY SUMMARY '.center(len(table.splitlines()[0]), '='))
         print(table)
         print('=' * len(table.splitlines()[0]))
         print('\nFor more details, please look at the detail tables above')
```

### Comparing `freqtrade-2023.3/freqtrade/optimize/space/decimalspace.py` & `freqtrade-2023.4/freqtrade/optimize/space/decimalspace.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/persistence/migrations.py` & `freqtrade-2023.4/freqtrade/persistence/migrations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/persistence/models.py` & `freqtrade-2023.4/freqtrade/persistence/models.py`

 * *Files 4% similar despite different names*

```diff
@@ -9,14 +9,15 @@
 from sqlalchemy import create_engine, inspect
 from sqlalchemy.exc import NoSuchModuleError
 from sqlalchemy.orm import scoped_session, sessionmaker
 from sqlalchemy.pool import StaticPool
 
 from freqtrade.exceptions import OperationalException
 from freqtrade.persistence.base import ModelBase
+from freqtrade.persistence.key_value_store import _KeyValueStoreModel
 from freqtrade.persistence.migrations import check_migrate
 from freqtrade.persistence.pairlock import PairLock
 from freqtrade.persistence.trade_model import Order, Trade
 
 
 logger = logging.getLogger(__name__)
 
@@ -72,11 +73,12 @@
     # https://docs.sqlalchemy.org/en/13/orm/contextual.html#thread-local-scope
     # Scoped sessions proxy requests to the appropriate thread-local session.
     # Since we also use fastAPI, we need to make it aware of the request id, too
     Trade.session = scoped_session(sessionmaker(
         bind=engine, autoflush=False), scopefunc=get_request_or_thread_id)
     Order.session = Trade.session
     PairLock.session = Trade.session
+    _KeyValueStoreModel.session = Trade.session
 
     previous_tables = inspect(engine).get_table_names()
     ModelBase.metadata.create_all(engine)
     check_migrate(engine, decl_base=ModelBase, previous_tables=previous_tables)
```

### Comparing `freqtrade-2023.3/freqtrade/persistence/pairlock.py` & `freqtrade-2023.4/freqtrade/persistence/pairlock.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/persistence/pairlock_middleware.py` & `freqtrade-2023.4/freqtrade/persistence/pairlock_middleware.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/persistence/trade_model.py` & `freqtrade-2023.4/freqtrade/persistence/trade_model.py`

 * *Files 1% similar despite different names*

```diff
@@ -5,21 +5,22 @@
 from collections import defaultdict
 from datetime import datetime, timedelta, timezone
 from math import isclose
 from typing import Any, ClassVar, Dict, List, Optional, Sequence, cast
 
 from sqlalchemy import (Enum, Float, ForeignKey, Integer, ScalarResult, Select, String,
                         UniqueConstraint, desc, func, select)
-from sqlalchemy.orm import Mapped, lazyload, mapped_column, relationship
+from sqlalchemy.orm import Mapped, lazyload, mapped_column, relationship, validates
 
-from freqtrade.constants import (DATETIME_PRINT_FORMAT, MATH_CLOSE_PREC, NON_OPEN_EXCHANGE_STATES,
-                                 BuySell, LongShort)
+from freqtrade.constants import (CUSTOM_TAG_MAX_LENGTH, DATETIME_PRINT_FORMAT, MATH_CLOSE_PREC,
+                                 NON_OPEN_EXCHANGE_STATES, BuySell, LongShort)
 from freqtrade.enums import ExitType, TradingMode
 from freqtrade.exceptions import DependencyException, OperationalException
-from freqtrade.exchange import amount_to_contract_precision, price_to_precision
+from freqtrade.exchange import (ROUND_DOWN, ROUND_UP, amount_to_contract_precision,
+                                price_to_precision)
 from freqtrade.leverage import interest
 from freqtrade.persistence.base import ModelBase, SessionType
 from freqtrade.util import FtPrecise
 
 
 logger = logging.getLogger(__name__)
 
@@ -593,15 +594,16 @@
             return
         self.liquidation_price = liquidation_price
 
     def __set_stop_loss(self, stop_loss: float, percent: float):
         """
         Method used internally to set self.stop_loss.
         """
-        stop_loss_norm = price_to_precision(stop_loss, self.price_precision, self.precision_mode)
+        stop_loss_norm = price_to_precision(stop_loss, self.price_precision, self.precision_mode,
+                                            rounding_mode=ROUND_DOWN if self.is_short else ROUND_UP)
         if not self.stop_loss:
             self.initial_stop_loss = stop_loss_norm
         self.stop_loss = stop_loss_norm
 
         self.stop_loss_pct = -1 * abs(percent)
 
     def adjust_stop_loss(self, current_price: float, stoploss: Optional[float],
@@ -624,15 +626,16 @@
         else:
             new_loss = float(current_price * (1 - abs(stoploss / leverage)))
 
         # no stop loss assigned yet
         if self.initial_stop_loss_pct is None or refresh:
             self.__set_stop_loss(new_loss, stoploss)
             self.initial_stop_loss = price_to_precision(
-                new_loss, self.price_precision, self.precision_mode)
+                new_loss, self.price_precision, self.precision_mode,
+                rounding_mode=ROUND_DOWN if self.is_short else ROUND_UP)
             self.initial_stop_loss_pct = -1 * abs(stoploss)
 
         # evaluate if the stop loss needs to be updated
         else:
 
             higher_stop = new_loss > self.stop_loss
             lower_stop = new_loss < self.stop_loss
@@ -688,29 +691,32 @@
                 logger.info(f'{order.order_type.upper()}_{payment} has been fulfilled for {self}.')
             # condition to avoid reset value when updating fees
             if self.open_order_id == order.order_id:
                 self.open_order_id = None
             else:
                 logger.warning(
                     f'Got different open_order_id {self.open_order_id} != {order.order_id}')
-            amount_tr = amount_to_contract_precision(self.amount, self.amount_precision,
-                                                     self.precision_mode, self.contract_size)
-            if isclose(order.safe_amount_after_fee, amount_tr, abs_tol=MATH_CLOSE_PREC):
-                self.close(order.safe_price)
-            else:
-                self.recalc_trade_from_orders()
-        elif order.ft_order_side == 'stoploss' and order.status not in ('canceled', 'open'):
+
+        elif order.ft_order_side == 'stoploss' and order.status not in ('open', ):
             self.stoploss_order_id = None
             self.close_rate_requested = self.stop_loss
             self.exit_reason = ExitType.STOPLOSS_ON_EXCHANGE.value
             if self.is_open:
                 logger.info(f'{order.order_type.upper()} is hit for {self}.')
-            self.close(order.safe_price)
         else:
             raise ValueError(f'Unknown order type: {order.order_type}')
+
+        if order.ft_order_side != self.entry_side:
+            amount_tr = amount_to_contract_precision(self.amount, self.amount_precision,
+                                                     self.precision_mode, self.contract_size)
+            if isclose(order.safe_amount_after_fee, amount_tr, abs_tol=MATH_CLOSE_PREC):
+                self.close(order.safe_price)
+            else:
+                self.recalc_trade_from_orders()
+
         Trade.commit()
 
     def close(self, rate: float, *, show_msg: bool = True) -> None:
         """
         Sets close_rate to the given rate, calculates total profit
         and marks trade as closed
         """
@@ -1249,19 +1255,21 @@
     # last update time of the stoploss order on exchange
     stoploss_last_update: Mapped[Optional[datetime]] = mapped_column(nullable=True)  # type: ignore
     # absolute value of the highest reached price
     max_rate: Mapped[Optional[float]] = mapped_column(
         Float(), nullable=True, default=0.0)  # type: ignore
     # Lowest price reached
     min_rate: Mapped[Optional[float]] = mapped_column(Float(), nullable=True)  # type: ignore
-    exit_reason: Mapped[Optional[str]] = mapped_column(String(100), nullable=True)  # type: ignore
+    exit_reason: Mapped[Optional[str]] = mapped_column(
+        String(CUSTOM_TAG_MAX_LENGTH), nullable=True)  # type: ignore
     exit_order_status: Mapped[Optional[str]] = mapped_column(
         String(100), nullable=True)  # type: ignore
     strategy: Mapped[Optional[str]] = mapped_column(String(100), nullable=True)  # type: ignore
-    enter_tag: Mapped[Optional[str]] = mapped_column(String(100), nullable=True)  # type: ignore
+    enter_tag: Mapped[Optional[str]] = mapped_column(
+        String(CUSTOM_TAG_MAX_LENGTH), nullable=True)  # type: ignore
     timeframe: Mapped[Optional[int]] = mapped_column(Integer, nullable=True)  # type: ignore
 
     trading_mode: Mapped[TradingMode] = mapped_column(
         Enum(TradingMode), nullable=True)  # type: ignore
     amount_precision: Mapped[Optional[float]] = mapped_column(
         Float(), nullable=True)  # type: ignore
     price_precision: Mapped[Optional[float]] = mapped_column(Float(), nullable=True)  # type: ignore
@@ -1283,14 +1291,21 @@
         Float(), nullable=True, default=None)  # type: ignore
 
     def __init__(self, **kwargs):
         super().__init__(**kwargs)
         self.realized_profit = 0
         self.recalc_open_trade_value()
 
+    @validates('enter_tag', 'exit_reason')
+    def validate_string_len(self, key, value):
+        max_len = getattr(self.__class__, key).prop.columns[0].type.length
+        if value and len(value) > max_len:
+            return value[:max_len]
+        return value
+
     def delete(self) -> None:
 
         for order in self.orders:
             Order.session.delete(order)
 
         Trade.session.delete(self)
         Trade.commit()
```

### Comparing `freqtrade-2023.3/freqtrade/plot/plotting.py` & `freqtrade-2023.4/freqtrade/plot/plotting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/AgeFilter.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/AgeFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/IPairList.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/IPairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/OffsetFilter.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/OffsetFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/PerformanceFilter.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/PerformanceFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/PrecisionFilter.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/PrecisionFilter.py`

 * *Files 4% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 Precision pair list filter
 """
 import logging
 from typing import Any, Dict, Optional
 
 from freqtrade.constants import Config
 from freqtrade.exceptions import OperationalException
+from freqtrade.exchange import ROUND_UP
 from freqtrade.exchange.types import Ticker
 from freqtrade.plugins.pairlist.IPairList import IPairList
 
 
 logger = logging.getLogger(__name__)
 
 
@@ -57,17 +58,18 @@
             self.log_once(f"Removed {pair} from whitelist, because "
                           "ticker['last'] is empty (Usually no trade in the last 24h).",
                           logger.info)
             return False
         stop_price = ticker['last'] * self._stoploss
 
         # Adjust stop-prices to precision
-        sp = self._exchange.price_to_precision(pair, stop_price)
+        sp = self._exchange.price_to_precision(pair, stop_price, rounding_mode=ROUND_UP)
 
-        stop_gap_price = self._exchange.price_to_precision(pair, stop_price * 0.99)
+        stop_gap_price = self._exchange.price_to_precision(pair, stop_price * 0.99,
+                                                           rounding_mode=ROUND_UP)
         logger.debug(f"{pair} - {sp} : {stop_gap_price}")
 
         if sp <= stop_gap_price:
             self.log_once(f"Removed {pair} from whitelist, because "
                           f"stop price {sp} would be <= stop limit {stop_gap_price}", logger.info)
             return False
```

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/PriceFilter.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/PriceFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/ProducerPairList.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/ProducerPairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/RemotePairList.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/RemotePairList.py`

 * *Files 2% similar despite different names*

```diff
@@ -139,14 +139,17 @@
         Generate the pairlist
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: List of pairs
         """
 
         if self._init_done:
             pairlist = self._pair_cache.get('pairlist')
+            if pairlist == [None]:
+                # Valid but empty pairlist.
+                return []
         else:
             pairlist = []
 
         time_elapsed = 0.0
 
         if pairlist:
             # Item found - no refresh necessary
@@ -177,15 +180,19 @@
                 pairlist, time_elapsed = self.fetch_pairlist()
 
         self.log_once(f"Fetched pairs: {pairlist}", logger.debug)
 
         pairlist = self._whitelist_for_active_markets(pairlist)
         pairlist = pairlist[:self._number_pairs]
 
-        self._pair_cache['pairlist'] = pairlist.copy()
+        if pairlist:
+            self._pair_cache['pairlist'] = pairlist.copy()
+        else:
+            # If pairlist is empty, set a dummy value to avoid fetching again
+            self._pair_cache['pairlist'] = [None]
 
         if time_elapsed != 0.0:
             self.log_once(f'Pairlist Fetched in {time_elapsed} seconds.', logger.info)
         else:
             self.log_once('Fetched Pairlist.', logger.info)
 
         self._last_pairlist = list(pairlist)
```

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/ShuffleFilter.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/ShuffleFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/SpreadFilter.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/SpreadFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/StaticPairList.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/StaticPairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/VolatilityFilter.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/VolatilityFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/VolumePairList.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/VolumePairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/pairlist_helpers.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/pairlist_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlist/rangestabilityfilter.py` & `freqtrade-2023.4/freqtrade/plugins/pairlist/rangestabilityfilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/pairlistmanager.py` & `freqtrade-2023.4/freqtrade/plugins/pairlistmanager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/protectionmanager.py` & `freqtrade-2023.4/freqtrade/plugins/protectionmanager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/protections/cooldown_period.py` & `freqtrade-2023.4/freqtrade/plugins/protections/cooldown_period.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/protections/iprotection.py` & `freqtrade-2023.4/freqtrade/plugins/protections/iprotection.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/protections/low_profit_pairs.py` & `freqtrade-2023.4/freqtrade/plugins/protections/low_profit_pairs.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/protections/max_drawdown_protection.py` & `freqtrade-2023.4/freqtrade/plugins/protections/max_drawdown_protection.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/plugins/protections/stoploss_guard.py` & `freqtrade-2023.4/freqtrade/plugins/protections/stoploss_guard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/resolvers/__init__.py` & `freqtrade-2023.4/freqtrade/resolvers/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/resolvers/exchange_resolver.py` & `freqtrade-2023.4/freqtrade/resolvers/exchange_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/resolvers/freqaimodel_resolver.py` & `freqtrade-2023.4/freqtrade/resolvers/freqaimodel_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/resolvers/hyperopt_resolver.py` & `freqtrade-2023.4/freqtrade/resolvers/hyperopt_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/resolvers/iresolver.py` & `freqtrade-2023.4/freqtrade/resolvers/iresolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/resolvers/pairlist_resolver.py` & `freqtrade-2023.4/freqtrade/resolvers/pairlist_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/resolvers/protection_resolver.py` & `freqtrade-2023.4/freqtrade/resolvers/protection_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/resolvers/strategy_resolver.py` & `freqtrade-2023.4/freqtrade/resolvers/strategy_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/api_auth.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/api_auth.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/api_backtest.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/api_backtest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/api_schemas.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/api_schemas.py`

 * *Files 1% similar despite different names*

```diff
@@ -104,14 +104,16 @@
     best_pair_profit_ratio: float
     winning_trades: int
     losing_trades: int
     profit_factor: float
     max_drawdown: float
     max_drawdown_abs: float
     trading_volume: Optional[float]
+    bot_start_timestamp: int
+    bot_start_date: str
 
 
 class SellReason(BaseModel):
     wins: int
     losses: int
     draws: int
```

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/api_v1.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/api_v1.py`

 * *Files 2% similar despite different names*

```diff
@@ -299,19 +299,19 @@
         'code': strategy_obj.__source__,
     }
 
 
 @router.get('/freqaimodels', response_model=FreqAIModelListResponse, tags=['freqai'])
 def list_freqaimodels(config=Depends(get_config)):
     from freqtrade.resolvers.freqaimodel_resolver import FreqaiModelResolver
-    strategies = FreqaiModelResolver.search_all_objects(
+    models = FreqaiModelResolver.search_all_objects(
         config, False)
-    strategies = sorted(strategies, key=lambda x: x['name'])
+    models = sorted(models, key=lambda x: x['name'])
 
-    return {'freqaimodels': [x['name'] for x in strategies]}
+    return {'freqaimodels': [x['name'] for x in models]}
 
 
 @router.get('/available_pairs', response_model=AvailablePairs, tags=['candle data'])
 def list_available_pairs(timeframe: Optional[str] = None, stake_currency: Optional[str] = None,
                          candletype: Optional[CandleType] = None, config=Depends(get_config)):
 
     dh = get_datahandler(config['datadir'], config.get('dataformat_ohlcv'))
```

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/api_ws.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/api_ws.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/deps.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/deps.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/ui/fallback_file.html` & `freqtrade-2023.4/freqtrade/rpc/api_server/ui/fallback_file.html`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/ui/favicon.ico` & `freqtrade-2023.4/freqtrade/rpc/api_server/ui/favicon.ico`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/uvicorn_threaded.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/uvicorn_threaded.py`

 * *Files 3% similar despite different names*

```diff
@@ -51,15 +51,15 @@
         except RuntimeError:
             # When running in a thread, we'll not have an eventloop yet.
             loop = asyncio.new_event_loop()
         loop.run_until_complete(self.serve(sockets=sockets))
 
     @contextlib.contextmanager
     def run_in_thread(self):
-        self.thread = threading.Thread(target=self.run)
+        self.thread = threading.Thread(target=self.run, name='FTUvicorn')
         self.thread.start()
         while not self.started:
             time.sleep(1e-3)
 
     def cleanup(self):
         self.should_exit = True
         self.thread.join()
```

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/web_ui.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/web_ui.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/webserver.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/webserver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/ws/channel.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/ws/channel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/ws/message_stream.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/ws/message_stream.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/ws/proxy.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/ws/proxy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/ws/serializer.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/ws/serializer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/api_server/ws_schemas.py` & `freqtrade-2023.4/freqtrade/rpc/api_server/ws_schemas.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/discord.py` & `freqtrade-2023.4/freqtrade/rpc/discord.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/external_message_consumer.py` & `freqtrade-2023.4/freqtrade/rpc/external_message_consumer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/fiat_convert.py` & `freqtrade-2023.4/freqtrade/rpc/fiat_convert.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/rpc.py` & `freqtrade-2023.4/freqtrade/rpc/rpc.py`

 * *Files 2% similar despite different names*

```diff
@@ -20,17 +20,18 @@
 from freqtrade.constants import CANCEL_REASON, DATETIME_PRINT_FORMAT, Config
 from freqtrade.data.history import load_data
 from freqtrade.data.metrics import calculate_max_drawdown
 from freqtrade.enums import (CandleType, ExitCheckTuple, ExitType, MarketDirection, SignalDirection,
                              State, TradingMode)
 from freqtrade.exceptions import ExchangeError, PricingError
 from freqtrade.exchange import timeframe_to_minutes, timeframe_to_msecs
+from freqtrade.exchange.types import Tickers
 from freqtrade.loggers import bufferHandler
 from freqtrade.misc import decimals_per_coin, shorten_date
-from freqtrade.persistence import Order, PairLocks, Trade
+from freqtrade.persistence import KeyStoreKeys, KeyValueStore, Order, PairLocks, Trade
 from freqtrade.persistence.models import PairLock
 from freqtrade.plugins.pairlist.pairlist_helpers import expand_pairlist
 from freqtrade.rpc.fiat_convert import CryptoToFiatConverter
 from freqtrade.rpc.rpc_types import RPCSendMsg
 from freqtrade.wallets import PositionWallet, Wallet
 
 
@@ -539,14 +540,15 @@
             stake_currency,
             fiat_display_currency
         ) if self._fiat_converter else 0
 
         first_date = trades[0].open_date if trades else None
         last_date = trades[-1].open_date if trades else None
         num = float(len(durations) or 1)
+        bot_start = KeyValueStore.get_datetime_value(KeyStoreKeys.BOT_START_TIME)
         return {
             'profit_closed_coin': profit_closed_coin_sum,
             'profit_closed_percent_mean': round(profit_closed_ratio_mean * 100, 2),
             'profit_closed_ratio_mean': profit_closed_ratio_mean,
             'profit_closed_percent_sum': round(profit_closed_ratio_sum * 100, 2),
             'profit_closed_ratio_sum': profit_closed_ratio_sum,
             'profit_closed_ratio': profit_closed_ratio_fromstart,
@@ -572,54 +574,69 @@
             'best_pair_profit_ratio': best_pair[1] if best_pair else 0,
             'winning_trades': winning_trades,
             'losing_trades': losing_trades,
             'profit_factor': profit_factor,
             'max_drawdown': max_drawdown,
             'max_drawdown_abs': max_drawdown_abs,
             'trading_volume': trading_volume,
+            'bot_start_timestamp': int(bot_start.timestamp() * 1000) if bot_start else 0,
+            'bot_start_date': bot_start.strftime(DATETIME_PRINT_FORMAT) if bot_start else '',
         }
 
+    def __balance_get_est_stake(
+            self, coin: str, stake_currency: str, balance: Wallet, tickers) -> float:
+        est_stake = 0.0
+        if coin == stake_currency:
+            est_stake = balance.total
+            if self._config.get('trading_mode', TradingMode.SPOT) != TradingMode.SPOT:
+                # in Futures, "total" includes the locked stake, and therefore all positions
+                est_stake = balance.free
+        else:
+            try:
+                pair = self._freqtrade.exchange.get_valid_pair_combination(coin, stake_currency)
+                rate: Optional[float] = tickers.get(pair, {}).get('last', None)
+                if rate:
+                    if pair.startswith(stake_currency) and not pair.endswith(stake_currency):
+                        rate = 1.0 / rate
+                    est_stake = rate * balance.total
+            except (ExchangeError):
+                logger.warning(f"Could not get rate for pair {coin}.")
+                raise ValueError()
+
+        return est_stake
+
     def _rpc_balance(self, stake_currency: str, fiat_display_currency: str) -> Dict:
         """ Returns current account balance per crypto """
         currencies: List[Dict] = []
         total = 0.0
+        total_bot = 0.0
         try:
-            tickers = self._freqtrade.exchange.get_tickers(cached=True)
+            tickers: Tickers = self._freqtrade.exchange.get_tickers(cached=True)
         except (ExchangeError):
             raise RPCException('Error getting current tickers.')
 
+        open_trades: List[Trade] = Trade.get_open_trades()
+        open_assets = [t.base_currency for t in open_trades]
         self._freqtrade.wallets.update(require_update=False)
         starting_capital = self._freqtrade.wallets.get_starting_balance()
         starting_cap_fiat = self._fiat_converter.convert_amount(
             starting_capital, stake_currency, fiat_display_currency) if self._fiat_converter else 0
         coin: str
         balance: Wallet
         for coin, balance in self._freqtrade.wallets.get_all_balances().items():
             if not balance.total:
                 continue
+            try:
+                est_stake = self.__balance_get_est_stake(coin, stake_currency, balance, tickers)
+            except ValueError:
+                continue
 
-            est_stake: float = 0
-            if coin == stake_currency:
-                rate = 1.0
-                est_stake = balance.total
-                if self._config.get('trading_mode', TradingMode.SPOT) != TradingMode.SPOT:
-                    # in Futures, "total" includes the locked stake, and therefore all positions
-                    est_stake = balance.free
-            else:
-                try:
-                    pair = self._freqtrade.exchange.get_valid_pair_combination(coin, stake_currency)
-                    rate = tickers.get(pair, {}).get('last')
-                    if rate:
-                        if pair.startswith(stake_currency) and not pair.endswith(stake_currency):
-                            rate = 1.0 / rate
-                        est_stake = rate * balance.total
-                except (ExchangeError):
-                    logger.warning(f" Could not get rate for pair {coin}.")
-                    continue
-            total = total + est_stake
+            total += est_stake
+            if coin == stake_currency or coin in open_assets:
+                total_bot += est_stake
             currencies.append({
                 'currency': coin,
                 'free': balance.free,
                 'balance': balance.total,
                 'used': balance.used,
                 'est_stake': est_stake or 0,
                 'stake': stake_currency,
@@ -644,18 +661,20 @@
                 'leverage': position.leverage,
                 'side': position.side,
                 'is_position': True
             })
 
         value = self._fiat_converter.convert_amount(
             total, stake_currency, fiat_display_currency) if self._fiat_converter else 0
+        value_bot = self._fiat_converter.convert_amount(
+            total_bot, stake_currency, fiat_display_currency) if self._fiat_converter else 0
 
         trade_count = len(Trade.get_trades_proxy())
-        starting_capital_ratio = (total / starting_capital) - 1 if starting_capital else 0.0
-        starting_cap_fiat_ratio = (value / starting_cap_fiat) - 1 if starting_cap_fiat else 0.0
+        starting_capital_ratio = (total_bot / starting_capital) - 1 if starting_capital else 0.0
+        starting_cap_fiat_ratio = (value_bot / starting_cap_fiat) - 1 if starting_cap_fiat else 0.0
 
         return {
             'currencies': currencies,
             'total': total,
             'symbol': fiat_display_currency,
             'value': value,
             'stake': stake_currency,
@@ -1189,14 +1208,15 @@
         )
         if pair not in _data:
             raise RPCException(f"No data for {pair}, {timeframe} in {timerange} found.")
         from freqtrade.data.dataprovider import DataProvider
         from freqtrade.resolvers.strategy_resolver import StrategyResolver
         strategy = StrategyResolver.load_strategy(config)
         strategy.dp = DataProvider(config, exchange=exchange, pairlists=None)
+        strategy.ft_bot_start()
 
         df_analyzed = strategy.analyze_ticker(_data[pair], {'pair': pair})
 
         return RPC._convert_dataframe_to_dict(strategy.get_strategy_name(), pair, timeframe,
                                               df_analyzed, arrow.Arrow.utcnow().datetime)
 
     def _rpc_plot_config(self) -> Dict[str, Any]:
```

### Comparing `freqtrade-2023.3/freqtrade/rpc/rpc_manager.py` & `freqtrade-2023.4/freqtrade/rpc/rpc_manager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/rpc/rpc_types.py` & `freqtrade-2023.4/freqtrade/rpc/rpc_types.py`

 * *Files 2% similar despite different names*

```diff
@@ -48,15 +48,15 @@
     exchange: str
     pair: str
     base_currency: str
     leverage: Optional[float]
     direction: str
     limit: float
     open_rate: float
-    order_type: Optional[str]  # TODO: why optional??
+    order_type: str
     stake_amount: float
     stake_currency: str
     fiat_currency: Optional[str]
     amount: float
     open_date: datetime
     current_rate: Optional[float]
     sub_trade: bool
```

### Comparing `freqtrade-2023.3/freqtrade/rpc/telegram.py` & `freqtrade-2023.4/freqtrade/rpc/telegram.py`

 * *Files 0% similar despite different names*

```diff
@@ -62,18 +62,15 @@
         if update.callback_query:
             cchat_id = int(update.callback_query.message.chat.id)
         else:
             cchat_id = int(update.message.chat_id)
 
         chat_id = int(self._config['telegram']['chat_id'])
         if cchat_id != chat_id:
-            logger.info(
-                'Rejected unauthorized message from: %s',
-                update.message.chat_id
-            )
+            logger.info(f'Rejected unauthorized message from: {update.message.chat_id}')
             return wrapper
         # Rollback session to avoid getting data stored in a transaction.
         Trade.rollback()
         logger.debug(
             'Executing handler: %s for chat_id: %s',
             command_handler.__name__,
             chat_id
@@ -815,15 +812,15 @@
         trade_count = stats['trade_count']
         first_trade_date = stats['first_trade_date']
         latest_trade_date = stats['latest_trade_date']
         avg_duration = stats['avg_duration']
         best_pair = stats['best_pair']
         best_pair_profit_ratio = stats['best_pair_profit_ratio']
         if stats['trade_count'] == 0:
-            markdown_msg = 'No trades yet.'
+            markdown_msg = f"No trades yet.\n*Bot started:* `{stats['bot_start_date']}`"
         else:
             # Message to display
             if stats['closed_trade_count'] > 0:
                 markdown_msg = ("*ROI:* Closed trades\n"
                                 f"∙ `{round_coin_value(profit_closed_coin, stake_cur)} "
                                 f"({profit_closed_ratio_mean:.2%}) "
                                 f"({profit_closed_percent} \N{GREEK CAPITAL LETTER SIGMA}%)`\n"
@@ -834,14 +831,15 @@
             markdown_msg += (
                 f"*ROI:* All trades\n"
                 f"∙ `{round_coin_value(profit_all_coin, stake_cur)} "
                 f"({profit_all_ratio_mean:.2%}) "
                 f"({profit_all_percent} \N{GREEK CAPITAL LETTER SIGMA}%)`\n"
                 f"∙ `{round_coin_value(profit_all_fiat, fiat_disp_cur)}`\n"
                 f"*Total Trade Count:* `{trade_count}`\n"
+                f"*Bot started:* `{stats['bot_start_date']}`\n"
                 f"*{'First Trade opened' if not timescale else 'Showing Profit since'}:* "
                 f"`{first_trade_date}`\n"
                 f"*Latest Trade opened:* `{latest_trade_date}`\n"
                 f"*Win / Loss:* `{stats['winning_trades']} / {stats['losing_trades']}`"
             )
             if stats['closed_trade_count'] > 0:
                 markdown_msg += (
@@ -1416,15 +1414,15 @@
         Shows the currently active blacklist
         """
         self.send_blacklist_msg(self._rpc._rpc_blacklist(context.args))
 
     def send_blacklist_msg(self, blacklist: Dict):
         errmsgs = []
         for pair, error in blacklist['errors'].items():
-            errmsgs.append(f"Error adding `{pair}` to blacklist: `{error['error_msg']}`")
+            errmsgs.append(f"Error: {error['error_msg']}")
         if errmsgs:
             self._send_msg('\n'.join(errmsgs))
 
         message = f"Blacklist contains {blacklist['length']} pairs\n"
         message += f"`{', '.join(blacklist['blacklist'])}`"
 
         logger.debug(message)
```

### Comparing `freqtrade-2023.3/freqtrade/rpc/webhook.py` & `freqtrade-2023.4/freqtrade/rpc/webhook.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/strategy/__init__.py` & `freqtrade-2023.4/freqtrade/strategy/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/strategy/hyper.py` & `freqtrade-2023.4/freqtrade/strategy/hyper.py`

 * *Files 2% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 """
 import logging
 from pathlib import Path
 from typing import Any, Dict, Iterator, List, Optional, Tuple, Type, Union
 
 from freqtrade.constants import Config
 from freqtrade.exceptions import OperationalException
-from freqtrade.misc import deep_merge_dicts, json_load
+from freqtrade.misc import deep_merge_dicts
 from freqtrade.optimize.hyperopt_tools import HyperoptTools
 from freqtrade.strategy.parameters import BaseParameter
 
 
 logger = logging.getLogger(__name__)
 
 
@@ -120,16 +120,15 @@
         if not filename_str:
             return {}
         filename = Path(filename_str).with_suffix('.json')
 
         if filename.is_file():
             logger.info(f"Loading parameters from file {filename}")
             try:
-                with filename.open('r') as f:
-                    params = json_load(f)
+                params = HyperoptTools.load_params(filename)
                 if params.get('strategy_name') != self.__class__.__name__:
                     raise OperationalException('Invalid parameter file provided.')
                 return params
             except ValueError:
                 logger.warning("Invalid parameter file format.")
                 return {}
         logger.info("Found no parameter file.")
```

### Comparing `freqtrade-2023.3/freqtrade/strategy/informative_decorator.py` & `freqtrade-2023.4/freqtrade/strategy/informative_decorator.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/strategy/interface.py` & `freqtrade-2023.4/freqtrade/strategy/interface.py`

 * *Files 0% similar despite different names*

```diff
@@ -6,15 +6,15 @@
 from abc import ABC, abstractmethod
 from datetime import datetime, timedelta, timezone
 from typing import Dict, List, Optional, Tuple, Union
 
 import arrow
 from pandas import DataFrame
 
-from freqtrade.constants import Config, IntOrInf, ListPairsWithTimeframes
+from freqtrade.constants import CUSTOM_TAG_MAX_LENGTH, Config, IntOrInf, ListPairsWithTimeframes
 from freqtrade.data.dataprovider import DataProvider
 from freqtrade.enums import (CandleType, ExitCheckTuple, ExitType, MarketDirection, RunMode,
                              SignalDirection, SignalTagType, SignalType, TradingMode)
 from freqtrade.exceptions import OperationalException, StrategyError
 from freqtrade.exchange import timeframe_to_minutes, timeframe_to_next_date, timeframe_to_seconds
 from freqtrade.misc import remove_entry_exit_signals
 from freqtrade.persistence import Order, PairLocks, Trade
@@ -23,15 +23,14 @@
                                                       _create_and_merge_informative_pair,
                                                       _format_pair_name)
 from freqtrade.strategy.strategy_wrapper import strategy_safe_wrapper
 from freqtrade.wallets import Wallets
 
 
 logger = logging.getLogger(__name__)
-CUSTOM_EXIT_MAX_LENGTH = 64
 
 
 class IStrategy(ABC, HyperStrategyMixin):
     """
     Interface for freqtrade strategies
     Defines the mandatory structure must follow any custom strategies
 
@@ -615,15 +614,15 @@
         :param df: strategy dataframe which will receive merges from informatives
         :param tf: timeframe of the dataframe which will modify the feature names
         :param informative: the dataframe associated with the informative pair
         """
         return df
 
     def feature_engineering_expand_all(self, dataframe: DataFrame, period: int,
-                                       metadata: Dict, **kwargs):
+                                       metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         This function will automatically expand the defined features on the config defined
         `indicator_periods_candles`, `include_timeframes`, `include_shifted_candles`, and
         `include_corr_pairs`. In other words, a single feature defined in this function
         will automatically expand to a total of
         `indicator_periods_candles` * `include_timeframes` * `include_shifted_candles` *
@@ -641,15 +640,16 @@
         :param dataframe: strategy dataframe which will receive the features
         :param period: period of the indicator - usage example:
         :param metadata: metadata of current pair
         dataframe["%-ema-period"] = ta.EMA(dataframe, timeperiod=period)
         """
         return dataframe
 
-    def feature_engineering_expand_basic(self, dataframe: DataFrame, metadata: Dict, **kwargs):
+    def feature_engineering_expand_basic(
+            self, dataframe: DataFrame, metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         This function will automatically expand the defined features on the config defined
         `include_timeframes`, `include_shifted_candles`, and `include_corr_pairs`.
         In other words, a single feature defined in this function
         will automatically expand to a total of
         `include_timeframes` * `include_shifted_candles` * `include_corr_pairs`
@@ -670,15 +670,16 @@
         :param dataframe: strategy dataframe which will receive the features
         :param metadata: metadata of current pair
         dataframe["%-pct-change"] = dataframe["close"].pct_change()
         dataframe["%-ema-200"] = ta.EMA(dataframe, timeperiod=200)
         """
         return dataframe
 
-    def feature_engineering_standard(self, dataframe: DataFrame, metadata: Dict, **kwargs):
+    def feature_engineering_standard(
+            self, dataframe: DataFrame, metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         This optional function will be called once with the dataframe of the base timeframe.
         This is the final function to be called, which means that the dataframe entering this
         function will contain all the features and columns created by all other
         freqai_feature_engineering_* functions.
 
@@ -694,15 +695,15 @@
 
         :param dataframe: strategy dataframe which will receive the features
         :param metadata: metadata of current pair
         usage example: dataframe["%-day_of_week"] = (dataframe["date"].dt.dayofweek + 1) / 7
         """
         return dataframe
 
-    def set_freqai_targets(self, dataframe: DataFrame, metadata: Dict, **kwargs):
+    def set_freqai_targets(self, dataframe: DataFrame, metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         Required function to set the targets for the model.
         All targets must be prepended with `&` to be recognized by the FreqAI internals.
 
         More details about feature engineering available:
 
@@ -1114,19 +1115,19 @@
                 reason_cust = strategy_safe_wrapper(self.custom_exit, default_retval=False)(
                     pair=trade.pair, trade=trade, current_time=current_time,
                     current_rate=current_rate, current_profit=current_profit)
                 if reason_cust:
                     exit_signal = ExitType.CUSTOM_EXIT
                     if isinstance(reason_cust, str):
                         custom_reason = reason_cust
-                        if len(reason_cust) > CUSTOM_EXIT_MAX_LENGTH:
+                        if len(reason_cust) > CUSTOM_TAG_MAX_LENGTH:
                             logger.warning(f'Custom exit reason returned from '
                                            f'custom_exit is too long and was trimmed'
-                                           f'to {CUSTOM_EXIT_MAX_LENGTH} characters.')
-                            custom_reason = reason_cust[:CUSTOM_EXIT_MAX_LENGTH]
+                                           f'to {CUSTOM_TAG_MAX_LENGTH} characters.')
+                            custom_reason = reason_cust[:CUSTOM_TAG_MAX_LENGTH]
                     else:
                         custom_reason = ''
             if (
                 exit_signal == ExitType.CUSTOM_EXIT
                 or (exit_signal == ExitType.EXIT_SIGNAL
                     and (not self.exit_profit_only or current_profit > self.exit_profit_offset))
             ):
```

### Comparing `freqtrade-2023.3/freqtrade/strategy/parameters.py` & `freqtrade-2023.4/freqtrade/strategy/parameters.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/strategy/strategy_helper.py` & `freqtrade-2023.4/freqtrade/strategy/strategy_helper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/strategy/strategy_wrapper.py` & `freqtrade-2023.4/freqtrade/strategy/strategy_wrapper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/strategy/strategyupdater.py` & `freqtrade-2023.4/freqtrade/strategy/strategyupdater.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/templates/FreqaiExampleHybridStrategy.py` & `freqtrade-2023.4/freqtrade/templates/FreqaiExampleHybridStrategy.py`

 * *Files 2% similar despite different names*

```diff
@@ -93,15 +93,15 @@
     # Hyperoptable parameters
     buy_rsi = IntParameter(low=1, high=50, default=30, space='buy', optimize=True, load=True)
     sell_rsi = IntParameter(low=50, high=100, default=70, space='sell', optimize=True, load=True)
     short_rsi = IntParameter(low=51, high=100, default=70, space='sell', optimize=True, load=True)
     exit_short_rsi = IntParameter(low=1, high=50, default=30, space='buy', optimize=True, load=True)
 
     def feature_engineering_expand_all(self, dataframe: DataFrame, period: int,
-                                       metadata: Dict, **kwargs):
+                                       metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         This function will automatically expand the defined features on the config defined
         `indicator_periods_candles`, `include_timeframes`, `include_shifted_candles`, and
         `include_corr_pairs`. In other words, a single feature defined in this function
         will automatically expand to a total of
         `indicator_periods_candles` * `include_timeframes` * `include_shifted_candles` *
@@ -147,15 +147,16 @@
 
         dataframe["%-relative_volume-period"] = (
             dataframe["volume"] / dataframe["volume"].rolling(period).mean()
         )
 
         return dataframe
 
-    def feature_engineering_expand_basic(self, dataframe: DataFrame, metadata: Dict, **kwargs):
+    def feature_engineering_expand_basic(
+            self, dataframe: DataFrame, metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         This function will automatically expand the defined features on the config defined
         `include_timeframes`, `include_shifted_candles`, and `include_corr_pairs`.
         In other words, a single feature defined in this function
         will automatically expand to a total of
         `include_timeframes` * `include_shifted_candles` * `include_corr_pairs`
@@ -179,15 +180,16 @@
         dataframe["%-ema-200"] = ta.EMA(dataframe, timeperiod=200)
         """
         dataframe["%-pct-change"] = dataframe["close"].pct_change()
         dataframe["%-raw_volume"] = dataframe["volume"]
         dataframe["%-raw_price"] = dataframe["close"]
         return dataframe
 
-    def feature_engineering_standard(self, dataframe: DataFrame, metadata: Dict, **kwargs):
+    def feature_engineering_standard(
+            self, dataframe: DataFrame, metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         This optional function will be called once with the dataframe of the base timeframe.
         This is the final function to be called, which means that the dataframe entering this
         function will contain all the features and columns created by all other
         freqai_feature_engineering_* functions.
 
@@ -205,28 +207,29 @@
         :param metadata: metadata of current pair
         usage example: dataframe["%-day_of_week"] = (dataframe["date"].dt.dayofweek + 1) / 7
         """
         dataframe["%-day_of_week"] = dataframe["date"].dt.dayofweek
         dataframe["%-hour_of_day"] = dataframe["date"].dt.hour
         return dataframe
 
-    def set_freqai_targets(self, dataframe: DataFrame, metadata: Dict, **kwargs):
+    def set_freqai_targets(self, dataframe: DataFrame, metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         Required function to set the targets for the model.
         All targets must be prepended with `&` to be recognized by the FreqAI internals.
 
         More details about feature engineering available:
 
         https://www.freqtrade.io/en/latest/freqai-feature-engineering
 
         :param dataframe: strategy dataframe which will receive the targets
         :param metadata: metadata of current pair
         usage example: dataframe["&-target"] = dataframe["close"].shift(-1) / dataframe["close"]
         """
+        self.freqai.class_names = ["down", "up"]
         dataframe['&s-up_or_down'] = np.where(dataframe["close"].shift(-50) >
                                               dataframe["close"], 'up', 'down')
 
         return dataframe
 
     def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:  # noqa: C901
```

### Comparing `freqtrade-2023.3/freqtrade/templates/FreqaiExampleStrategy.py` & `freqtrade-2023.4/freqtrade/templates/FreqaiExampleStrategy.py`

 * *Files 5% similar despite different names*

```diff
@@ -44,15 +44,15 @@
 
     std_dev_multiplier_buy = CategoricalParameter(
         [0.75, 1, 1.25, 1.5, 1.75], default=1.25, space="buy", optimize=True)
     std_dev_multiplier_sell = CategoricalParameter(
         [0.75, 1, 1.25, 1.5, 1.75], space="sell", default=1.25, optimize=True)
 
     def feature_engineering_expand_all(self, dataframe: DataFrame, period: int,
-                                       metadata: Dict, **kwargs):
+                                       metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         This function will automatically expand the defined features on the config defined
         `indicator_periods_candles`, `include_timeframes`, `include_shifted_candles`, and
         `include_corr_pairs`. In other words, a single feature defined in this function
         will automatically expand to a total of
         `indicator_periods_candles` * `include_timeframes` * `include_shifted_candles` *
@@ -102,15 +102,16 @@
 
         dataframe["%-relative_volume-period"] = (
             dataframe["volume"] / dataframe["volume"].rolling(period).mean()
         )
 
         return dataframe
 
-    def feature_engineering_expand_basic(self, dataframe: DataFrame, metadata: Dict, **kwargs):
+    def feature_engineering_expand_basic(
+            self, dataframe: DataFrame, metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         This function will automatically expand the defined features on the config defined
         `include_timeframes`, `include_shifted_candles`, and `include_corr_pairs`.
         In other words, a single feature defined in this function
         will automatically expand to a total of
         `include_timeframes` * `include_shifted_candles` * `include_corr_pairs`
@@ -138,15 +139,16 @@
         dataframe["%-ema-200"] = ta.EMA(dataframe, timeperiod=200)
         """
         dataframe["%-pct-change"] = dataframe["close"].pct_change()
         dataframe["%-raw_volume"] = dataframe["volume"]
         dataframe["%-raw_price"] = dataframe["close"]
         return dataframe
 
-    def feature_engineering_standard(self, dataframe: DataFrame, metadata: Dict, **kwargs):
+    def feature_engineering_standard(
+            self, dataframe: DataFrame, metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         This optional function will be called once with the dataframe of the base timeframe.
         This is the final function to be called, which means that the dataframe entering this
         function will contain all the features and columns created by all other
         freqai_feature_engineering_* functions.
 
@@ -168,15 +170,15 @@
         :param metadata: metadata of current pair
         usage example: dataframe["%-day_of_week"] = (dataframe["date"].dt.dayofweek + 1) / 7
         """
         dataframe["%-day_of_week"] = dataframe["date"].dt.dayofweek
         dataframe["%-hour_of_day"] = dataframe["date"].dt.hour
         return dataframe
 
-    def set_freqai_targets(self, dataframe: DataFrame, metadata: Dict, **kwargs):
+    def set_freqai_targets(self, dataframe: DataFrame, metadata: Dict, **kwargs) -> DataFrame:
         """
         *Only functional with FreqAI enabled strategies*
         Required function to set the targets for the model.
         All targets must be prepended with `&` to be recognized by the FreqAI internals.
 
         Access metadata such as the current pair with:
```

### Comparing `freqtrade-2023.3/freqtrade/templates/base_config.json.j2` & `freqtrade-2023.4/freqtrade/templates/base_config.json.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/templates/base_strategy.py.j2` & `freqtrade-2023.4/freqtrade/templates/base_strategy.py.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/templates/sample_hyperopt_loss.py` & `freqtrade-2023.4/freqtrade/templates/sample_hyperopt_loss.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/templates/sample_strategy.py` & `freqtrade-2023.4/freqtrade/templates/sample_strategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/templates/strategy_analysis_example.ipynb` & `freqtrade-2023.4/freqtrade/templates/strategy_analysis_example.ipynb`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/indicators_full.j2` & `freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/indicators_full.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2` & `freqtrade-2023.4/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/util/binance_mig.py` & `freqtrade-2023.4/freqtrade/util/binance_mig.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/util/periodic_cache.py` & `freqtrade-2023.4/freqtrade/util/periodic_cache.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/vendor/qtpylib/indicators.py` & `freqtrade-2023.4/freqtrade/vendor/qtpylib/indicators.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade/wallets.py` & `freqtrade-2023.4/freqtrade/wallets.py`

 * *Files 1% similar despite different names*

```diff
@@ -7,14 +7,15 @@
 
 import arrow
 
 from freqtrade.constants import UNLIMITED_STAKE_AMOUNT, Config
 from freqtrade.enums import RunMode, TradingMode
 from freqtrade.exceptions import DependencyException
 from freqtrade.exchange import Exchange
+from freqtrade.misc import safe_value_fallback
 from freqtrade.persistence import LocalTrade, Trade
 
 
 logger = logging.getLogger(__name__)
 
 
 # wallet data structure
@@ -144,15 +145,15 @@
         self._positions = {}
         for position in positions:
             symbol = position['symbol']
             if position['side'] is None or position['collateral'] == 0.0:
                 # Position is not open ...
                 continue
             size = self._exchange._contracts_to_amount(symbol, position['contracts'])
-            collateral = position['collateral'] or 0.0
+            collateral = safe_value_fallback(position, 'collateral', 'initialMargin', 0.0)
             leverage = position['leverage']
             self._positions[symbol] = PositionWallet(
                 symbol, position=size,
                 leverage=leverage,
                 collateral=collateral,
                 side=position['side']
             )
```

### Comparing `freqtrade-2023.3/freqtrade/worker.py` & `freqtrade-2023.4/freqtrade/worker.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/freqtrade.egg-info/PKG-INFO` & `freqtrade-2023.4/freqtrade.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: freqtrade
-Version: 2023.3
+Version: 2023.4
 Summary: Freqtrade - Crypto Trading Bot
 Home-page: https://github.com/freqtrade/freqtrade
 Author: Freqtrade Team
 Author-email: freqtrade@protonmail.com
 License: GPLv3
 Project-URL: Bug Tracker, https://github.com/freqtrade/freqtrade/issues
 Classifier: Environment :: Console
@@ -237,10 +237,10 @@
 - Minimal (advised) system requirements: 2GB RAM, 1GB disk space, 2vCPU
 
 ### Software requirements
 
 - [Python >= 3.8](http://docs.python-guide.org/en/latest/starting/installation/)
 - [pip](https://pip.pypa.io/en/stable/installing/)
 - [git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git)
-- [TA-Lib](https://mrjbq7.github.io/ta-lib/install.html)
+- [TA-Lib](https://ta-lib.github.io/ta-lib-python/)
 - [virtualenv](https://virtualenv.pypa.io/en/stable/installation.html) (Recommended)
 - [Docker](https://www.docker.com/products/docker) (Recommended)
```

### Comparing `freqtrade-2023.3/freqtrade.egg-info/SOURCES.txt` & `freqtrade-2023.4/freqtrade.egg-info/SOURCES.txt`

 * *Files 6% similar despite different names*

```diff
@@ -5,15 +5,14 @@
 setup.cfg
 setup.py
 freqtrade/__init__.py
 freqtrade/__main__.py
 freqtrade/constants.py
 freqtrade/exceptions.py
 freqtrade/freqtradebot.py
-freqtrade/loggers.py
 freqtrade/main.py
 freqtrade/misc.py
 freqtrade/wallets.py
 freqtrade/worker.py
 freqtrade.egg-info/PKG-INFO
 freqtrade.egg-info/SOURCES.txt
 freqtrade.egg-info/dependency_links.txt
@@ -77,14 +76,15 @@
 freqtrade/enums/state.py
 freqtrade/enums/tradingmode.py
 freqtrade/exchange/__init__.py
 freqtrade/exchange/binance.py
 freqtrade/exchange/binance_leverage_tiers.json
 freqtrade/exchange/bitpanda.py
 freqtrade/exchange/bittrex.py
+freqtrade/exchange/bitvavo.py
 freqtrade/exchange/bybit.py
 freqtrade/exchange/check_exchange.py
 freqtrade/exchange/coinbasepro.py
 freqtrade/exchange/common.py
 freqtrade/exchange/exchange.py
 freqtrade/exchange/exchange_utils.py
 freqtrade/exchange/gate.py
@@ -103,36 +103,49 @@
 freqtrade/freqai/RL/Base4ActionRLEnv.py
 freqtrade/freqai/RL/Base5ActionRLEnv.py
 freqtrade/freqai/RL/BaseEnvironment.py
 freqtrade/freqai/RL/BaseReinforcementLearningModel.py
 freqtrade/freqai/RL/TensorboardCallback.py
 freqtrade/freqai/RL/__init__.py
 freqtrade/freqai/base_models/BaseClassifierModel.py
+freqtrade/freqai/base_models/BasePyTorchClassifier.py
+freqtrade/freqai/base_models/BasePyTorchModel.py
+freqtrade/freqai/base_models/BasePyTorchRegressor.py
 freqtrade/freqai/base_models/BaseRegressionModel.py
 freqtrade/freqai/base_models/BaseTensorFlowModel.py
 freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
 freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
 freqtrade/freqai/prediction_models/CatboostClassifier.py
 freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
 freqtrade/freqai/prediction_models/CatboostRegressor.py
 freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
 freqtrade/freqai/prediction_models/LightGBMClassifier.py
 freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py
 freqtrade/freqai/prediction_models/LightGBMRegressor.py
 freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py
+freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py
+freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py
 freqtrade/freqai/prediction_models/ReinforcementLearner.py
 freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py
 freqtrade/freqai/prediction_models/XGBoostClassifier.py
 freqtrade/freqai/prediction_models/XGBoostRFClassifier.py
 freqtrade/freqai/prediction_models/XGBoostRFRegressor.py
 freqtrade/freqai/prediction_models/XGBoostRegressor.py
 freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py
 freqtrade/freqai/prediction_models/__init__.py
+freqtrade/freqai/torch/PyTorchDataConvertor.py
+freqtrade/freqai/torch/PyTorchMLPModel.py
+freqtrade/freqai/torch/PyTorchModelTrainer.py
+freqtrade/freqai/torch/PyTorchTrainerInterface.py
+freqtrade/freqai/torch/__init__.py
 freqtrade/leverage/__init__.py
 freqtrade/leverage/interest.py
+freqtrade/loggers/__init__.py
+freqtrade/loggers/buffering_handler.py
+freqtrade/loggers/std_err_stream_handler.py
 freqtrade/mixins/__init__.py
 freqtrade/mixins/logging_mixin.py
 freqtrade/optimize/__init__.py
 freqtrade/optimize/backtest_caching.py
 freqtrade/optimize/backtesting.py
 freqtrade/optimize/bt_progress.py
 freqtrade/optimize/edge_cli.py
@@ -153,14 +166,15 @@
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
 freqtrade/optimize/space/__init__.py
 freqtrade/optimize/space/decimalspace.py
 freqtrade/persistence/__init__.py
 freqtrade/persistence/base.py
+freqtrade/persistence/key_value_store.py
 freqtrade/persistence/migrations.py
 freqtrade/persistence/models.py
 freqtrade/persistence/pairlock.py
 freqtrade/persistence/pairlock_middleware.py
 freqtrade/persistence/trade_model.py
 freqtrade/plot/__init__.py
 freqtrade/plot/plotting.py
@@ -318,14 +332,15 @@
 tests/optimize/test_backtesting_adjust_position.py
 tests/optimize/test_edge_cli.py
 tests/optimize/test_hyperopt.py
 tests/optimize/test_hyperopt_tools.py
 tests/optimize/test_hyperoptloss.py
 tests/optimize/test_optimize_reports.py
 tests/persistence/__init__.py
+tests/persistence/test_key_value_store.py
 tests/persistence/test_migrations.py
 tests/persistence/test_persistence.py
 tests/persistence/test_trade_fromjson.py
 tests/plugins/__init__.py
 tests/plugins/test_pairlist.py
 tests/plugins/test_pairlocks.py
 tests/plugins/test_protections.py
```

### Comparing `freqtrade-2023.3/freqtrade.egg-info/requires.txt` & `freqtrade-2023.4/freqtrade.egg-info/requires.txt`

 * *Files 6% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 ccxt>=2.6.26
-SQLAlchemy
+SQLAlchemy>=2.0.6
 python-telegram-bot>=13.4
 arrow>=0.17.0
 cachetools
 requests
 urllib3
 jsonschema
 TA-Lib
@@ -18,14 +18,15 @@
 colorama
 jinja2
 questionary
 prompt-toolkit
 numpy
 pandas
 joblib>=1.2.0
+rich
 fastapi
 pydantic>=1.8.0
 uvicorn
 psutil
 pyjwt
 aiofiles
 schedule
@@ -48,15 +49,14 @@
 nbstripout
 ipykernel
 nbconvert
 scipy
 scikit-learn
 scikit-optimize>=0.7.0
 filelock
-progressbar2
 tables
 blosc
 lightgbm
 xgboost
 torch
 stable-baselines3
 gym==0.21
@@ -78,15 +78,14 @@
 nbstripout
 ipykernel
 nbconvert
 scipy
 scikit-learn
 scikit-optimize>=0.7.0
 filelock
-progressbar2
 tables
 blosc
 lightgbm
 xgboost
 torch
 stable-baselines3
 gym==0.21
@@ -114,15 +113,14 @@
 blosc
 
 [hyperopt]
 scipy
 scikit-learn
 scikit-optimize>=0.7.0
 filelock
-progressbar2
 
 [jupyter]
 jupyter
 nbstripout
 ipykernel
 nbconvert
```

### Comparing `freqtrade-2023.3/pyproject.toml` & `freqtrade-2023.4/pyproject.toml`

 * *Files 4% similar despite different names*

```diff
@@ -64,14 +64,17 @@
 [tool.ruff]
 line-length = 100
 extend-exclude = [".env"]
 target-version = "py38"
 extend-select = [
   "C90",    # mccabe
   # "N",    # pep8-naming
+  "F",      # pyflakes
+  "E",      # pycodestyle
+  "W",      # pycodestyle
   "UP",     # pyupgrade
   "TID",    # flake8-tidy-imports
   # "EXE",  # flake8-executable
   "YTT",    # flake8-2020
   # "S",    # flake8-bandit
   # "DTZ",  # flake8-datetimez
   # "RSE",  # flake8-raise
```

### Comparing `freqtrade-2023.3/setup.cfg` & `freqtrade-2023.4/setup.cfg`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/setup.py` & `freqtrade-2023.4/setup.py`

 * *Files 5% similar despite different names*

```diff
@@ -4,15 +4,14 @@
 # Requirements used for submodules
 plot = ['plotly>=4.0']
 hyperopt = [
     'scipy',
     'scikit-learn',
     'scikit-optimize>=0.7.0',
     'filelock',
-    'progressbar2',
 ]
 
 freqai = [
     'scikit-learn',
     'catboost; platform_machine != "aarch64"',
     'lightgbm',
     'xgboost'
@@ -55,15 +54,15 @@
         'pytest-asyncio',
         'pytest-cov',
         'pytest-mock',
     ],
     install_requires=[
         # from requirements.txt
         'ccxt>=2.6.26',
-        'SQLAlchemy',
+        'SQLAlchemy>=2.0.6',
         'python-telegram-bot>=13.4',
         'arrow>=0.17.0',
         'cachetools',
         'requests',
         'urllib3',
         'jsonschema',
         'TA-Lib',
@@ -78,14 +77,15 @@
         'colorama',
         'jinja2',
         'questionary',
         'prompt-toolkit',
         'numpy',
         'pandas',
         'joblib>=1.2.0',
+        'rich',
         'pyarrow; platform_machine != "armv7l"',
         'fastapi',
         'pydantic>=1.8.0',
         'uvicorn',
         'psutil',
         'pyjwt',
         'aiofiles',
```

### Comparing `freqtrade-2023.3/tests/commands/test_build_config.py` & `freqtrade-2023.4/tests/commands/test_build_config.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/commands/test_commands.py` & `freqtrade-2023.4/tests/commands/test_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/conftest.py` & `freqtrade-2023.4/tests/conftest.py`

 * *Files 0% similar despite different names*

```diff
@@ -500,15 +500,15 @@
                 "HOT/BTC",
             ]
         },
         "pairlists": [
             {"method": "StaticPairList"}
         ],
         "telegram": {
-            "enabled": True,
+            "enabled": False,
             "token": "token",
             "chat_id": "0",
             "notification_settings": {},
         },
         "datadir": Path(testdatadir),
         "initial_state": "running",
         "db_url": "sqlite://",
```

### Comparing `freqtrade-2023.3/tests/conftest_trades.py` & `freqtrade-2023.4/tests/conftest_trades.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/conftest_trades_usdt.py` & `freqtrade-2023.4/tests/conftest_trades_usdt.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/data/test_btanalysis.py` & `freqtrade-2023.4/tests/data/test_btanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/data/test_converter.py` & `freqtrade-2023.4/tests/data/test_converter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/data/test_datahandler.py` & `freqtrade-2023.4/tests/data/test_datahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/data/test_dataprovider.py` & `freqtrade-2023.4/tests/data/test_dataprovider.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/data/test_entryexitanalysis.py` & `freqtrade-2023.4/tests/data/test_entryexitanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/data/test_history.py` & `freqtrade-2023.4/tests/data/test_history.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/edge/test_edge.py` & `freqtrade-2023.4/tests/edge/test_edge.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/exchange/test_binance.py` & `freqtrade-2023.4/tests/exchange/test_binance.py`

 * *Files 0% similar despite different names*

```diff
@@ -44,15 +44,15 @@
             'foo': 'bar'
         }
     })
     default_conf['dry_run'] = False
     default_conf['margin_mode'] = MarginMode.ISOLATED
     default_conf['trading_mode'] = trademode
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
 
     exchange = get_patched_exchange(mocker, default_conf, api_mock, 'binance')
 
     with pytest.raises(InvalidOrderException):
         order = exchange.create_stoploss(
             pair='ETH/BTC',
             amount=1,
@@ -123,15 +123,15 @@
 
 
 def test_create_stoploss_order_dry_run_binance(default_conf, mocker):
     api_mock = MagicMock()
     order_type = 'stop_loss_limit'
     default_conf['dry_run'] = True
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
 
     exchange = get_patched_exchange(mocker, default_conf, api_mock, 'binance')
 
     with pytest.raises(InvalidOrderException):
         order = exchange.create_stoploss(
             pair='ETH/BTC',
             amount=1,
```

### Comparing `freqtrade-2023.3/tests/exchange/test_bitpanda.py` & `freqtrade-2023.4/tests/exchange/test_bitpanda.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/exchange/test_bybit.py` & `freqtrade-2023.4/tests/exchange/test_bybit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/exchange/test_ccxt_compat.py` & `freqtrade-2023.4/tests/exchange/test_ccxt_compat.py`

 * *Files 1% similar despite different names*

```diff
@@ -524,17 +524,19 @@
             )
             )
             assert res
             assert res[0] == pair
             assert res[1] == timeframe
             assert res[2] == candle_type
             candles = res[3]
-            candle_count = exchange.ohlcv_candle_limit(timeframe, candle_type, since_ms) * 0.9
-            candle_count1 = (now.timestamp() * 1000 - since_ms) // timeframe_ms
-            assert len(candles) >= min(candle_count, candle_count1)
+            factor = 0.9
+            candle_count = exchange.ohlcv_candle_limit(timeframe, candle_type, since_ms) * factor
+            candle_count1 = (now.timestamp() * 1000 - since_ms) // timeframe_ms * factor
+            assert len(candles) >= min(candle_count, candle_count1), \
+                f"{len(candles)} < {candle_count} in {timeframe}, Offset: {offset} {factor}"
             assert candles[0][0] == since_ms or (since_ms + timeframe_ms)
 
     def test_ccxt__async_get_candle_history(self, exchange: EXCHANGE_FIXTURE_TYPE):
         exc, exchangename = exchange
         if exchangename in ('bittrex'):
             # For some weired reason, this test returns random lengths for bittrex.
             pytest.skip("Exchange doesn't provide stable ohlcv history")
```

### Comparing `freqtrade-2023.3/tests/exchange/test_ccxt_precise.py` & `freqtrade-2023.4/tests/exchange/test_ccxt_precise.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/exchange/test_exchange.py` & `freqtrade-2023.4/tests/exchange/test_exchange.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,14 +4,15 @@
 from datetime import datetime, timedelta, timezone
 from random import randint
 from unittest.mock import MagicMock, Mock, PropertyMock, patch
 
 import arrow
 import ccxt
 import pytest
+from ccxt import DECIMAL_PLACES, ROUND, ROUND_UP, TICK_SIZE, TRUNCATE
 from pandas import DataFrame
 
 from freqtrade.enums import CandleType, MarginMode, TradingMode
 from freqtrade.exceptions import (DDosProtection, DependencyException, ExchangeError,
                                   InsufficientFundsError, InvalidOrderException,
                                   OperationalException, PricingError, TemporaryError)
 from freqtrade.exchange import (Binance, Bittrex, Exchange, Kraken, amount_to_precision,
@@ -311,43 +312,62 @@
     # DECIMAL_PLACES = 2
     # SIGNIFICANT_DIGITS = 3
     # TICK_SIZE = 4
 
     assert amount_to_precision(amount, precision, precision_mode) == expected
 
 
-@pytest.mark.parametrize("price,precision_mode,precision,expected", [
-    (2.34559, 2, 4, 2.3456),
-    (2.34559, 2, 5, 2.34559),
-    (2.34559, 2, 3, 2.346),
-    (2.9999, 2, 3, 3.000),
-    (2.9909, 2, 3, 2.991),
-    # Tests for Tick_size
-    (2.34559, 4, 0.0001, 2.3456),
-    (2.34559, 4, 0.00001, 2.34559),
-    (2.34559, 4, 0.001, 2.346),
-    (2.9999, 4, 0.001, 3.000),
-    (2.9909, 4, 0.001, 2.991),
-    (2.9909, 4, 0.005, 2.995),
-    (2.9973, 4, 0.005, 3.0),
-    (2.9977, 4, 0.005, 3.0),
-    (234.43, 4, 0.5, 234.5),
-    (234.53, 4, 0.5, 235.0),
-    (0.891534, 4, 0.0001, 0.8916),
-    (64968.89, 4, 0.01, 64968.89),
-    (0.000000003483, 4, 1e-12, 0.000000003483),
-
+@pytest.mark.parametrize("price,precision_mode,precision,expected,rounding_mode", [
+    # Tests for DECIMAL_PLACES, ROUND_UP
+    (2.34559, 2, 4, 2.3456, ROUND_UP),
+    (2.34559, 2, 5, 2.34559, ROUND_UP),
+    (2.34559, 2, 3, 2.346, ROUND_UP),
+    (2.9999, 2, 3, 3.000, ROUND_UP),
+    (2.9909, 2, 3, 2.991, ROUND_UP),
+    # Tests for DECIMAL_PLACES, ROUND
+    (2.345600000000001, DECIMAL_PLACES, 4, 2.3456, ROUND),
+    (2.345551, DECIMAL_PLACES, 4, 2.3456, ROUND),
+    (2.49, DECIMAL_PLACES, 0, 2., ROUND),
+    (2.51, DECIMAL_PLACES, 0, 3., ROUND),
+    (5.1, DECIMAL_PLACES, -1, 10., ROUND),
+    (4.9, DECIMAL_PLACES, -1, 0., ROUND),
+    # Tests for TICK_SIZE, ROUND_UP
+    (2.34559, TICK_SIZE, 0.0001, 2.3456, ROUND_UP),
+    (2.34559, TICK_SIZE, 0.00001, 2.34559, ROUND_UP),
+    (2.34559, TICK_SIZE, 0.001, 2.346, ROUND_UP),
+    (2.9999, TICK_SIZE, 0.001, 3.000, ROUND_UP),
+    (2.9909, TICK_SIZE, 0.001, 2.991, ROUND_UP),
+    (2.9909, TICK_SIZE, 0.005, 2.995, ROUND_UP),
+    (2.9973, TICK_SIZE, 0.005, 3.0, ROUND_UP),
+    (2.9977, TICK_SIZE, 0.005, 3.0, ROUND_UP),
+    (234.43, TICK_SIZE, 0.5, 234.5, ROUND_UP),
+    (234.53, TICK_SIZE, 0.5, 235.0, ROUND_UP),
+    (0.891534, TICK_SIZE, 0.0001, 0.8916, ROUND_UP),
+    (64968.89, TICK_SIZE, 0.01, 64968.89, ROUND_UP),
+    (0.000000003483, TICK_SIZE, 1e-12, 0.000000003483, ROUND_UP),
+    # Tests for TICK_SIZE, ROUND
+    (2.49, TICK_SIZE, 1., 2., ROUND),
+    (2.51, TICK_SIZE, 1., 3., ROUND),
+    (2.000000051, TICK_SIZE, 0.0000001, 2.0000001, ROUND),
+    (2.000000049, TICK_SIZE, 0.0000001, 2., ROUND),
+    (2.9909, TICK_SIZE, 0.005, 2.990, ROUND),
+    (2.9973, TICK_SIZE, 0.005, 2.995, ROUND),
+    (2.9977, TICK_SIZE, 0.005, 3.0, ROUND),
+    (234.24, TICK_SIZE, 0.5, 234., ROUND),
+    (234.26, TICK_SIZE, 0.5, 234.5, ROUND),
+    # Tests for TRUNCATTE
+    (2.34559, 2, 4, 2.3455, TRUNCATE),
+    (2.34559, 2, 5, 2.34559, TRUNCATE),
+    (2.34559, 2, 3, 2.345, TRUNCATE),
+    (2.9999, 2, 3, 2.999, TRUNCATE),
+    (2.9909, 2, 3, 2.990, TRUNCATE),
 ])
-def test_price_to_precision(price, precision_mode, precision, expected):
-    # digits counting mode
-    # DECIMAL_PLACES = 2
-    # SIGNIFICANT_DIGITS = 3
-    # TICK_SIZE = 4
-
-    assert price_to_precision(price, precision, precision_mode) == expected
+def test_price_to_precision(price, precision_mode, precision, expected, rounding_mode):
+    assert price_to_precision(
+        price, precision, precision_mode, rounding_mode=rounding_mode) == expected
 
 
 @pytest.mark.parametrize("price,precision_mode,precision,expected", [
     (2.34559, 2, 4, 0.0001),
     (2.34559, 2, 5, 0.00001),
     (2.34559, 2, 3, 0.001),
     (2.9999, 2, 3, 0.001),
@@ -413,31 +433,31 @@
     # min amount is set
     markets["ETH/BTC"]["limits"] = {
         'cost': {'min': None, 'max': None},
         'amount': {'min': 2, 'max': 10000},
     }
     mocker.patch(f'{EXMS}.markets', PropertyMock(return_value=markets))
     result = exchange.get_min_pair_stake_amount('ETH/BTC', 2, stoploss)
-    expected_result = 2 * 2 * (1 + 0.05) / (1 - abs(stoploss))
+    expected_result = 2 * 2 * (1 + 0.05)
     assert pytest.approx(result) == expected_result
     # With Leverage
     result = exchange.get_min_pair_stake_amount('ETH/BTC', 2, stoploss, 5.0)
     assert pytest.approx(result) == expected_result / 5
     # max
     result = exchange.get_max_pair_stake_amount('ETH/BTC', 2)
     assert result == 20000
 
-    # min amount and cost are set (cost is minimal)
+    # min amount and cost are set (cost is minimal and therefore ignored)
     markets["ETH/BTC"]["limits"] = {
         'cost': {'min': 2, 'max': None},
         'amount': {'min': 2, 'max': None},
     }
     mocker.patch(f'{EXMS}.markets', PropertyMock(return_value=markets))
     result = exchange.get_min_pair_stake_amount('ETH/BTC', 2, stoploss)
-    expected_result = max(2, 2 * 2) * (1 + 0.05) / (1 - abs(stoploss))
+    expected_result = max(2, 2 * 2) * (1 + 0.05)
     assert pytest.approx(result) == expected_result
     # With Leverage
     result = exchange.get_min_pair_stake_amount('ETH/BTC', 2, stoploss, 10)
     assert pytest.approx(result) == expected_result / 10
 
     # min amount and cost are set (amount is minial)
     markets["ETH/BTC"]["limits"] = {
@@ -472,14 +492,17 @@
     # With Leverage
     result = exchange.get_min_pair_stake_amount('ETH/BTC', 2, -1, 12.0)
     assert pytest.approx(result) == expected_result / 12
     # Max
     result = exchange.get_max_pair_stake_amount('ETH/BTC', 2)
     assert result == 1000
 
+    result = exchange.get_max_pair_stake_amount('ETH/BTC', 2, 12.0)
+    assert result == 1000 / 12
+
     markets["ETH/BTC"]["contractSize"] = '0.01'
     default_conf['trading_mode'] = 'futures'
     default_conf['margin_mode'] = 'isolated'
     exchange = get_patched_exchange(mocker, default_conf, id="binance")
     mocker.patch(f'{EXMS}.markets', PropertyMock(return_value=markets))
 
     # Contract size 0.01
@@ -1228,31 +1251,32 @@
     ("buy", 25.563, False, False),
     ("buy", 25.566, True, False),
     ("sell", 25.566, False, False),
     ("sell", 25.563, True, False),
     ("buy", 29.563, True, True),
     ("sell", 21.563, True, True),
 ])
+@pytest.mark.parametrize("leverage", [1, 2, 5])
 @pytest.mark.parametrize("exchange_name", EXCHANGES)
 def test_create_dry_run_order_limit_fill(default_conf, mocker, side, price, filled, caplog,
-                                         exchange_name, order_book_l2_usd, converted):
+                                         exchange_name, order_book_l2_usd, converted, leverage):
     default_conf['dry_run'] = True
     exchange = get_patched_exchange(mocker, default_conf, id=exchange_name)
     mocker.patch.multiple(EXMS,
                           exchange_has=MagicMock(return_value=True),
                           fetch_l2_order_book=order_book_l2_usd,
                           )
 
     order = exchange.create_order(
         pair='LTC/USDT',
         ordertype='limit',
         side=side,
         amount=1,
         rate=price,
-        leverage=1.0
+        leverage=leverage,
     )
     assert order_book_l2_usd.call_count == 1
     assert 'id' in order
     assert f'dry_run_{side}_' in order["id"]
     assert order["side"] == side
     if not converted:
         assert order["average"] == price
@@ -1268,14 +1292,15 @@
     order_book_l2_usd.reset_mock()
 
     # fetch order again...
     order_closed = exchange.fetch_dry_run_order(order['id'])
     assert order_book_l2_usd.call_count == (1 if not filled else 0)
     assert order_closed['status'] == ('open' if not filled else 'closed')
     assert order_closed['filled'] == (0 if not filled else 1)
+    assert order_closed['cost'] == 1 * order_closed['average']
 
     order_book_l2_usd.reset_mock()
 
     # Empty orderbook test
     mocker.patch(f'{EXMS}.fetch_l2_order_book', return_value={'asks': [], 'bids': []})
     exchange._dry_run_open_orders[order['id']]['status'] = 'open'
     order_closed = exchange.fetch_dry_run_order(order['id'])
@@ -1290,39 +1315,42 @@
     ("buy", 24.000, 100000, 25.200),  # Run into max_slippage of 5%
     ("sell", 25.564, 1, 25.563),
     ("sell", 25.564, 100, 25.5625),  # Requires interpolation
     ("sell", 25.510, 100, 25.5625),  # price below spread - average is higher
     ("sell", 25.564, 1000, 25.5555),  # More than orderbook return
     ("sell", 27, 10000, 25.65),  # max-slippage 5%
 ])
+@pytest.mark.parametrize("leverage", [1, 2, 5])
 @pytest.mark.parametrize("exchange_name", EXCHANGES)
 def test_create_dry_run_order_market_fill(default_conf, mocker, side, rate, amount, endprice,
-                                          exchange_name, order_book_l2_usd):
+                                          exchange_name, order_book_l2_usd, leverage):
     default_conf['dry_run'] = True
     exchange = get_patched_exchange(mocker, default_conf, id=exchange_name)
     mocker.patch.multiple(EXMS,
                           exchange_has=MagicMock(return_value=True),
                           fetch_l2_order_book=order_book_l2_usd,
                           )
 
     order = exchange.create_order(
         pair='LTC/USDT',
         ordertype='market',
         side=side,
         amount=amount,
         rate=rate,
-        leverage=1.0
+        leverage=leverage,
     )
     assert 'id' in order
     assert f'dry_run_{side}_' in order["id"]
     assert order["side"] == side
     assert order["type"] == "market"
     assert order["symbol"] == "LTC/USDT"
     assert order['status'] == 'closed'
     assert order['filled'] == amount
+    assert order['amount'] == amount
+    assert pytest.approx(order['cost']) == amount * order['average']
     assert round(order["average"], 4) == round(endprice, 4)
 
 
 @pytest.mark.parametrize("side", ["buy", "sell"])
 @pytest.mark.parametrize("ordertype,rate,marketprice", [
     ("market", None, None),
     ("market", 200, True),
@@ -5277,15 +5305,15 @@
         'cost': order_amount,
         'filled': order_amount,
         'remaining': order_amount,
         'symbol': 'ETH/BTC',
     })
     default_conf['dry_run'] = False
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
 
     exchange = get_patched_exchange(mocker, default_conf, api_mock)
     exchange.get_contract_size = MagicMock(return_value=contract_size)
 
     api_mock.create_order.reset_mock()
     order = exchange.create_stoploss(
         pair='ETH/BTC',
@@ -5297,7 +5325,14 @@
     )
 
     assert api_mock.create_order.call_args_list[0][1]['amount'] == order_amount
     assert order['amount'] == 100
     assert order['cost'] == 100
     assert order['filled'] == 100
     assert order['remaining'] == 100
+
+
+def test_price_to_precision_with_default_conf(default_conf, mocker):
+    conf = copy.deepcopy(default_conf)
+    patched_ex = get_patched_exchange(mocker, conf)
+    prec_price = patched_ex.price_to_precision("XRP/USDT", 1.0000000101)
+    assert prec_price == 1.00000001
```

### Comparing `freqtrade-2023.3/tests/exchange/test_exchange_utils.py` & `freqtrade-2023.4/tests/exchange/test_exchange_utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/exchange/test_gate.py` & `freqtrade-2023.4/tests/exchange/test_gate.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/exchange/test_huobi.py` & `freqtrade-2023.4/tests/exchange/test_huobi.py`

 * *Files 1% similar despite different names*

```diff
@@ -23,15 +23,15 @@
         'id': order_id,
         'info': {
             'foo': 'bar'
         }
     })
     default_conf['dry_run'] = False
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
 
     exchange = get_patched_exchange(mocker, default_conf, api_mock, 'huobi')
 
     with pytest.raises(InvalidOrderException):
         order = exchange.create_stoploss(pair='ETH/BTC', amount=1, stop_price=190,
                                          order_types={'stoploss_on_exchange_limit_ratio': 1.05},
                                          side=side,
@@ -76,15 +76,15 @@
 
 
 def test_create_stoploss_order_dry_run_huobi(default_conf, mocker):
     api_mock = MagicMock()
     order_type = 'stop-limit'
     default_conf['dry_run'] = True
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
 
     exchange = get_patched_exchange(mocker, default_conf, api_mock, 'huobi')
 
     with pytest.raises(InvalidOrderException):
         order = exchange.create_stoploss(pair='ETH/BTC', amount=1, stop_price=190,
                                          order_types={'stoploss_on_exchange_limit_ratio': 1.05},
                                          side='sell', leverage=1.0)
```

### Comparing `freqtrade-2023.3/tests/exchange/test_kraken.py` & `freqtrade-2023.4/tests/exchange/test_kraken.py`

 * *Files 2% similar despite different names*

```diff
@@ -25,15 +25,15 @@
         'info': {
             'foo': 'bar'
         }
     })
     default_conf['dry_run'] = False
 
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
     exchange = get_patched_exchange(mocker, default_conf, api_mock, id="kraken")
 
     order = exchange.create_order(
         pair='ETH/BTC',
         ordertype=order_type,
         side="buy",
         amount=1,
@@ -188,15 +188,15 @@
         'info': {
             'foo': 'bar'
         }
     })
 
     default_conf['dry_run'] = False
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
 
     exchange = get_patched_exchange(mocker, default_conf, api_mock, 'kraken')
 
     order = exchange.create_stoploss(
         pair='ETH/BTC',
         amount=1,
         stop_price=220,
@@ -259,15 +259,15 @@
 
 
 @pytest.mark.parametrize('side', ['buy', 'sell'])
 def test_create_stoploss_order_dry_run_kraken(default_conf, mocker, side):
     api_mock = MagicMock()
     default_conf['dry_run'] = True
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
 
     exchange = get_patched_exchange(mocker, default_conf, api_mock, 'kraken')
 
     api_mock.create_order.reset_mock()
 
     order = exchange.create_stoploss(
         pair='ETH/BTC',
```

### Comparing `freqtrade-2023.3/tests/exchange/test_kucoin.py` & `freqtrade-2023.4/tests/exchange/test_kucoin.py`

 * *Files 1% similar despite different names*

```diff
@@ -23,15 +23,15 @@
         'id': order_id,
         'info': {
             'foo': 'bar'
         }
     })
     default_conf['dry_run'] = False
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
 
     exchange = get_patched_exchange(mocker, default_conf, api_mock, 'kucoin')
     if order_type == 'limit':
         with pytest.raises(InvalidOrderException):
             order = exchange.create_stoploss(pair='ETH/BTC', amount=1, stop_price=190,
                                              order_types={
                                                  'stoploss': order_type,
@@ -84,15 +84,15 @@
 
 
 def test_stoploss_order_dry_run_kucoin(default_conf, mocker):
     api_mock = MagicMock()
     order_type = 'market'
     default_conf['dry_run'] = True
     mocker.patch(f'{EXMS}.amount_to_precision', lambda s, x, y: y)
-    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y: y)
+    mocker.patch(f'{EXMS}.price_to_precision', lambda s, x, y, **kwargs: y)
 
     exchange = get_patched_exchange(mocker, default_conf, api_mock, 'kucoin')
 
     with pytest.raises(InvalidOrderException):
         order = exchange.create_stoploss(pair='ETH/BTC', amount=1, stop_price=190,
                                          order_types={'stoploss': 'limit',
                                                       'stoploss_on_exchange_limit_ratio': 1.05},
```

### Comparing `freqtrade-2023.3/tests/exchange/test_okx.py` & `freqtrade-2023.4/tests/exchange/test_okx.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,18 +1,18 @@
 from datetime import datetime, timedelta, timezone
 from pathlib import Path
-from unittest.mock import MagicMock, PropertyMock
+from unittest.mock import AsyncMock, MagicMock, PropertyMock
 
 import ccxt
 import pytest
 
 from freqtrade.enums import CandleType, MarginMode, TradingMode
-from freqtrade.exceptions import RetryableOrderError
+from freqtrade.exceptions import RetryableOrderError, TemporaryError
 from freqtrade.exchange.exchange import timeframe_to_minutes
-from tests.conftest import EXMS, get_mock_coro, get_patched_exchange, log_has
+from tests.conftest import EXMS, get_patched_exchange, log_has
 from tests.exchange.test_exchange import ccxt_exceptionhandlers
 
 
 def test_okx_ohlcv_candle_limit(default_conf, mocker):
     exchange = get_patched_exchange(mocker, default_conf, id='okx')
     timeframes = ('1m', '5m', '1h')
     start_time = int(datetime(2021, 1, 1, tzinfo=timezone.utc).timestamp() * 1000)
@@ -274,15 +274,15 @@
     default_conf['datadir'] = Path(tmpdir)
     # fd_mock = mocker.patch('freqtrade.exchange.exchange.file_dump_json')
     api_mock = MagicMock()
     type(api_mock).has = PropertyMock(return_value={
         'fetchLeverageTiers': False,
         'fetchMarketLeverageTiers': True,
     })
-    api_mock.fetch_market_leverage_tiers = get_mock_coro(side_effect=[
+    api_mock.fetch_market_leverage_tiers = AsyncMock(side_effect=[
         [
             {
                 'tier': 1,
                 'minNotional': 0,
                 'maxNotional': 500,
                 'maintenanceMarginRate': 0.02,
                 'maxLeverage': 75,
@@ -337,14 +337,15 @@
                     'optMgnFactor': '0',
                     'quoteMaxLoan': '',
                     'tier': '3',
                     'uly': 'ADA-USDT'
                 }
             },
         ],
+        TemporaryError("this Failed"),
         [
             {
                 'tier': 1,
                 'minNotional': 0,
                 'maxNotional': 2000,
                 'maintenanceMarginRate': 0.01,
                 'maxLeverage': 75,
```

### Comparing `freqtrade-2023.3/tests/optimize/__init__.py` & `freqtrade-2023.4/tests/optimize/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/optimize/conftest.py` & `freqtrade-2023.4/tests/optimize/conftest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/optimize/test_backtest_detail.py` & `freqtrade-2023.4/tests/optimize/test_backtest_detail.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/optimize/test_backtesting.py` & `freqtrade-2023.4/tests/optimize/test_backtesting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/optimize/test_backtesting_adjust_position.py` & `freqtrade-2023.4/tests/optimize/test_backtesting_adjust_position.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/optimize/test_edge_cli.py` & `freqtrade-2023.4/tests/optimize/test_edge_cli.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/optimize/test_hyperopt.py` & `freqtrade-2023.4/tests/optimize/test_hyperopt.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/optimize/test_hyperopt_tools.py` & `freqtrade-2023.4/tests/optimize/test_hyperopt_tools.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/optimize/test_hyperoptloss.py` & `freqtrade-2023.4/tests/optimize/test_hyperoptloss.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/optimize/test_optimize_reports.py` & `freqtrade-2023.4/tests/optimize/test_optimize_reports.py`

 * *Files 1% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 
 import joblib
 import pandas as pd
 import pytest
 from arrow import Arrow
 
 from freqtrade.configuration import TimeRange
-from freqtrade.constants import DATETIME_PRINT_FORMAT, LAST_BT_RESULT_FN
+from freqtrade.constants import BACKTEST_BREAKDOWNS, DATETIME_PRINT_FORMAT, LAST_BT_RESULT_FN
 from freqtrade.data import history
 from freqtrade.data.btanalysis import (get_latest_backtest_filename, load_backtest_data,
                                        load_backtest_stats)
 from freqtrade.edge import PairInfo
 from freqtrade.enums import ExitType
 from freqtrade.optimize.optimize_reports import (_get_resample_from_period, generate_backtest_stats,
                                                  generate_daily_stats, generate_edge_table,
@@ -461,19 +461,22 @@
     res = generate_periodic_breakdown_stats([], 'day')
     assert res == []
 
 
 def test__get_resample_from_period():
 
     assert _get_resample_from_period('day') == '1d'
-    assert _get_resample_from_period('week') == '1w'
+    assert _get_resample_from_period('week') == '1W-MON'
     assert _get_resample_from_period('month') == '1M'
     with pytest.raises(ValueError, match=r"Period noooo is not supported."):
         _get_resample_from_period('noooo')
 
+    for period in BACKTEST_BREAKDOWNS:
+        assert isinstance(_get_resample_from_period(period), str)
+
 
 def test_show_sorted_pairlist(testdatadir, default_conf, capsys):
     filename = testdatadir / "backtest_results/backtest-result.json"
     bt_data = load_backtest_stats(filename)
     default_conf['backtest_show_pair_list'] = True
 
     show_sorted_pairlist(default_conf, bt_data)
```

### Comparing `freqtrade-2023.3/tests/persistence/test_migrations.py` & `freqtrade-2023.4/tests/persistence/test_migrations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/persistence/test_persistence.py` & `freqtrade-2023.4/tests/persistence/test_persistence.py`

 * *Files 0% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 from datetime import datetime, timedelta, timezone
 from types import FunctionType
 
 import arrow
 import pytest
 from sqlalchemy import select
 
-from freqtrade.constants import DATETIME_PRINT_FORMAT
+from freqtrade.constants import CUSTOM_TAG_MAX_LENGTH, DATETIME_PRINT_FORMAT
 from freqtrade.enums import TradingMode
 from freqtrade.exceptions import DependencyException
 from freqtrade.persistence import LocalTrade, Order, Trade, init_db
 from tests.conftest import create_mock_trades, create_mock_trades_with_leverage, log_has, log_has_re
 
 
 spot, margin, futures = TradingMode.SPOT, TradingMode.MARGIN, TradingMode.FUTURES
@@ -2033,14 +2033,15 @@
         'get_trades',
         'get_trades_query',
         'get_exit_reason_performance',
         'get_enter_tag_performance',
         'get_mix_tag_performance',
         'get_trading_volume',
         'from_json',
+        'validate_string_len',
     )
     EXCLUDES2 = ('trades', 'trades_open', 'bt_trades_open_pp', 'bt_open_open_trade_count',
                  'total_profit')
 
     # Parent (LocalTrade) should have the same attributes
     for item in trade:
         # Exclude private attributes and open_date (as it's not assigned a default)
@@ -2051,14 +2052,39 @@
     for item in localtrade:
         if (not item.startswith('__')
                 and item not in EXCLUDES2
                 and type(getattr(LocalTrade, item)) not in (property, FunctionType)):
             assert item in trade
 
 
+@pytest.mark.usefixtures("init_persistence")
+def test_trade_truncates_string_fields():
+    trade = Trade(
+        pair='ADA/USDT',
+        stake_amount=20.0,
+        amount=30.0,
+        open_rate=2.0,
+        open_date=datetime.utcnow() - timedelta(minutes=20),
+        fee_open=0.001,
+        fee_close=0.001,
+        exchange='binance',
+        leverage=1.0,
+        trading_mode='futures',
+        enter_tag='a' * CUSTOM_TAG_MAX_LENGTH * 2,
+        exit_reason='b' * CUSTOM_TAG_MAX_LENGTH * 2,
+    )
+    Trade.session.add(trade)
+    Trade.commit()
+
+    trade1 = Trade.session.scalars(select(Trade)).first()
+
+    assert trade1.enter_tag == 'a' * CUSTOM_TAG_MAX_LENGTH
+    assert trade1.exit_reason == 'b' * CUSTOM_TAG_MAX_LENGTH
+
+
 def test_recalc_trade_from_orders(fee):
 
     o1_amount = 100
     o1_rate = 1
     o1_cost = o1_amount * o1_rate
     o1_fee_cost = o1_cost * fee.return_value
     o1_trade_val = o1_cost + o1_fee_cost
```

### Comparing `freqtrade-2023.3/tests/persistence/test_trade_fromjson.py` & `freqtrade-2023.4/tests/persistence/test_trade_fromjson.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/plugins/test_pairlist.py` & `freqtrade-2023.4/tests/plugins/test_pairlist.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/plugins/test_pairlocks.py` & `freqtrade-2023.4/tests/plugins/test_pairlocks.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/plugins/test_protections.py` & `freqtrade-2023.4/tests/plugins/test_protections.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/plugins/test_remotepairlist.py` & `freqtrade-2023.4/tests/plugins/test_remotepairlist.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/rpc/test_fiat_convert.py` & `freqtrade-2023.4/tests/rpc/test_fiat_convert.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/rpc/test_rpc.py` & `freqtrade-2023.4/tests/rpc/test_rpc.py`

 * *Files 0% similar despite different names*

```diff
@@ -587,14 +587,16 @@
             'stake': 'BTC',
             'is_position': True,
             'leverage': 5.0,
             'position': 1000.0,
             'side': 'short',
         }
     ]
+    assert result['starting_capital'] == 10
+    assert result['starting_capital_ratio'] == 0.0
 
 
 def test_rpc_start(mocker, default_conf) -> None:
     mocker.patch('freqtrade.rpc.telegram.Telegram', MagicMock())
     mocker.patch.multiple(
         EXMS,
         fetch_ticker=MagicMock()
```

### Comparing `freqtrade-2023.3/tests/rpc/test_rpc_apiserver.py` & `freqtrade-2023.4/tests/rpc/test_rpc_apiserver.py`

 * *Files 0% similar despite different names*

```diff
@@ -879,14 +879,16 @@
         'closed_trade_count': 2,
         'winning_trades': expected['winning_trades'],
         'losing_trades': expected['losing_trades'],
         'profit_factor': expected['profit_factor'],
         'max_drawdown': ANY,
         'max_drawdown_abs': ANY,
         'trading_volume': expected['trading_volume'],
+        'bot_start_timestamp': 0,
+        'bot_start_date': '',
     }
 
 
 @pytest.mark.parametrize('is_short', [True, False])
 def test_api_stats(botclient, mocker, ticker, fee, markets, is_short):
     ftbot, client = botclient
     patch_get_signal(ftbot, enter_long=not is_short, enter_short=is_short)
@@ -1399,18 +1401,18 @@
                  1511686500000, 8.893e-05, None, None, None],
              ['2017-11-26 09:00:00', 8.891e-05, 8.893e-05, 8.875e-05, 8.877e-05,
                  0.7039405, 8.885e-05, 0, 0.0, 0, 0, '2017-11-26 09:00:00', 1511686800000,
                  None, None, None, None]
              ])
 
 
-def test_api_pair_history(botclient, ohlcv_history):
+def test_api_pair_history(botclient, mocker):
     ftbot, client = botclient
     timeframe = '5m'
-
+    lfm = mocker.patch('freqtrade.strategy.interface.IStrategy.load_freqAI_model')
     # No pair
     rc = client_get(client,
                     f"{BASE_URI}/pair_history?timeframe={timeframe}"
                     f"&timerange=20180111-20180112&strategy={CURRENT_TEST_STRATEGY}")
     assert_response(rc, 422)
 
     # No Timeframe
@@ -1436,14 +1438,15 @@
                     f"{BASE_URI}/pair_history?pair=UNITTEST%2FBTC&timeframe={timeframe}"
                     f"&timerange=20180111-20180112&strategy={CURRENT_TEST_STRATEGY}")
     assert_response(rc, 200)
     assert rc.json()['length'] == 289
     assert len(rc.json()['data']) == rc.json()['length']
     assert 'columns' in rc.json()
     assert 'data' in rc.json()
+    assert lfm.call_count == 1
     assert rc.json()['pair'] == 'UNITTEST/BTC'
     assert rc.json()['strategy'] == CURRENT_TEST_STRATEGY
     assert rc.json()['data_start'] == '2018-01-11 00:00:00+00:00'
     assert rc.json()['data_start_ts'] == 1515628800000
     assert rc.json()['data_stop'] == '2018-01-12 00:00:00+00:00'
     assert rc.json()['data_stop_ts'] == 1515715200000
```

### Comparing `freqtrade-2023.3/tests/rpc/test_rpc_emc.py` & `freqtrade-2023.4/tests/rpc/test_rpc_emc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/rpc/test_rpc_manager.py` & `freqtrade-2023.4/tests/rpc/test_rpc_manager.py`

 * *Files 6% similar despite different names*

```diff
@@ -24,14 +24,15 @@
 
     assert not log_has('Enabling rpc.telegram ...', caplog)
     assert rpc_manager.registered_modules == []
 
 
 def test_init_telegram_enabled(mocker, default_conf, caplog) -> None:
     caplog.set_level(logging.DEBUG)
+    default_conf['telegram']['enabled'] = True
     mocker.patch('freqtrade.rpc.telegram.Telegram._init', MagicMock())
     rpc_manager = RPCManager(get_patched_freqtradebot(mocker, default_conf))
 
     assert log_has('Enabling rpc.telegram ...', caplog)
     len_modules = len(rpc_manager.registered_modules)
     assert len_modules == 1
     assert 'telegram' in [mod.name for mod in rpc_manager.registered_modules]
@@ -48,14 +49,15 @@
 
     assert not log_has('Cleaning up rpc.telegram ...', caplog)
     assert telegram_mock.call_count == 0
 
 
 def test_cleanup_telegram_enabled(mocker, default_conf, caplog) -> None:
     caplog.set_level(logging.DEBUG)
+    default_conf['telegram']['enabled'] = True
     mocker.patch('freqtrade.rpc.telegram.Telegram._init', MagicMock())
     telegram_mock = mocker.patch('freqtrade.rpc.telegram.Telegram.cleanup', MagicMock())
 
     freqtradebot = get_patched_freqtradebot(mocker, default_conf)
     rpc_manager = RPCManager(freqtradebot)
 
     # Check we have Telegram as a registered modules
@@ -81,28 +83,29 @@
     assert log_has("Sending rpc message: {'type': status, 'status': 'test'}", caplog)
     assert telegram_mock.call_count == 0
 
 
 def test_send_msg_telegram_error(mocker, default_conf, caplog) -> None:
     mocker.patch('freqtrade.rpc.telegram.Telegram._init', MagicMock())
     mocker.patch('freqtrade.rpc.telegram.Telegram.send_msg', side_effect=ValueError())
-
+    default_conf['telegram']['enabled'] = True
     freqtradebot = get_patched_freqtradebot(mocker, default_conf)
     rpc_manager = RPCManager(freqtradebot)
     rpc_manager.send_msg({
         'type': RPCMessageType.STATUS,
         'status': 'test'
     })
 
     assert log_has("Sending rpc message: {'type': status, 'status': 'test'}", caplog)
     assert log_has("Exception occurred within RPC module telegram", caplog)
 
 
 def test_process_msg_queue(mocker, default_conf, caplog) -> None:
     telegram_mock = mocker.patch('freqtrade.rpc.telegram.Telegram.send_msg')
+    default_conf['telegram']['enabled'] = True
     default_conf['telegram']['allow_custom_messages'] = True
     mocker.patch('freqtrade.rpc.telegram.Telegram._init')
 
     freqtradebot = get_patched_freqtradebot(mocker, default_conf)
     rpc_manager = RPCManager(freqtradebot)
     queue = deque()
     queue.append('Test message')
@@ -111,17 +114,17 @@
 
     assert log_has("Sending rpc strategy_msg: Test message", caplog)
     assert log_has("Sending rpc strategy_msg: Test message 2", caplog)
     assert telegram_mock.call_count == 2
 
 
 def test_send_msg_telegram_enabled(mocker, default_conf, caplog) -> None:
+    default_conf['telegram']['enabled'] = True
     telegram_mock = mocker.patch('freqtrade.rpc.telegram.Telegram.send_msg')
     mocker.patch('freqtrade.rpc.telegram.Telegram._init')
-
     freqtradebot = get_patched_freqtradebot(mocker, default_conf)
     rpc_manager = RPCManager(freqtradebot)
     rpc_manager.send_msg({
         'type': RPCMessageType.STATUS,
         'status': 'test'
     })
 
@@ -162,15 +165,16 @@
     rpc_manager.send_msg({'type': RPCMessageType.STARTUP,
                           'status': 'TestMessage'})
     assert log_has(
         "Message type 'startup' not implemented by handler webhook.",
         caplog)
 
 
-def test_startupmessages_telegram_enabled(mocker, default_conf, caplog) -> None:
+def test_startupmessages_telegram_enabled(mocker, default_conf) -> None:
+    default_conf['telegram']['enabled'] = True
     telegram_mock = mocker.patch('freqtrade.rpc.telegram.Telegram.send_msg', MagicMock())
     mocker.patch('freqtrade.rpc.telegram.Telegram._init', MagicMock())
 
     freqtradebot = get_patched_freqtradebot(mocker, default_conf)
     rpc_manager = RPCManager(freqtradebot)
     rpc_manager.startup_messages(default_conf, freqtradebot.pairlists, freqtradebot.protections)
```

### Comparing `freqtrade-2023.3/tests/rpc/test_rpc_telegram.py` & `freqtrade-2023.4/tests/rpc/test_rpc_telegram.py`

 * *Files 0% similar despite different names*

```diff
@@ -32,14 +32,21 @@
 from freqtrade.rpc.rpc import RPCException
 from freqtrade.rpc.telegram import Telegram, authorized_only
 from tests.conftest import (CURRENT_TEST_STRATEGY, EXMS, create_mock_trades,
                             create_mock_trades_usdt, get_patched_freqtradebot, log_has, log_has_re,
                             patch_exchange, patch_get_signal, patch_whitelist)
 
 
+@pytest.fixture
+def default_conf(default_conf) -> dict:
+    # Telegram is enabled by default
+    default_conf['telegram']['enabled'] = True
+    return default_conf
+
+
 class DummyCls(Telegram):
     """
     Dummy class for testing the Telegram @authorized_only decorator
     """
 
     def __init__(self, rpc: RPC, config) -> None:
         super().__init__(rpc, config)
@@ -2237,16 +2244,17 @@
 @pytest.mark.parametrize('direction,enter_signal,leverage', [
     ('Long', 'long_signal_01', None),
     ('Long', 'long_signal_01', 1.0),
     ('Long', 'long_signal_01', 5.0),
     ('Short', 'short_signal_01', 2.0),
 ])
 def test_send_msg_sell_notification_no_fiat(
-        default_conf, mocker, direction, enter_signal, leverage) -> None:
+        default_conf, mocker, direction, enter_signal, leverage, time_machine) -> None:
     del default_conf['fiat_display_currency']
+    time_machine.move_to('2022-05-02 00:00:00 +00:00', tick=False)
     telegram, _, msg_mock = get_telegram_testobject(mocker, default_conf)
 
     telegram.send_msg({
         'type': RPCMessageType.EXIT,
         'trade_id': 1,
         'exchange': 'Binance',
         'pair': 'KEY/ETH',
```

### Comparing `freqtrade-2023.3/tests/rpc/test_rpc_webhook.py` & `freqtrade-2023.4/tests/rpc/test_rpc_webhook.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/strategy/test_default_strategy.py` & `freqtrade-2023.4/tests/strategy/test_default_strategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/strategy/test_interface.py` & `freqtrade-2023.4/tests/strategy/test_interface.py`

 * *Files 1% similar despite different names*

```diff
@@ -5,14 +5,15 @@
 from unittest.mock import MagicMock
 
 import arrow
 import pytest
 from pandas import DataFrame
 
 from freqtrade.configuration import TimeRange
+from freqtrade.constants import CUSTOM_TAG_MAX_LENGTH
 from freqtrade.data.dataprovider import DataProvider
 from freqtrade.data.history import load_data
 from freqtrade.enums import ExitCheckTuple, ExitType, HyperoptState, SignalDirection
 from freqtrade.exceptions import OperationalException, StrategyError
 from freqtrade.optimize.hyperopt_tools import HyperoptStateContainer
 from freqtrade.optimize.space import SKDecimal
 from freqtrade.persistence import PairLocks, Trade
@@ -525,21 +526,21 @@
                                enter=False, exit_=False,
                                low=None, high=None)
     assert res[0].exit_type == ExitType.CUSTOM_EXIT
     assert res[0].exit_flag is True
     assert res[0].exit_reason == 'hello world'
 
     caplog.clear()
-    strategy.custom_exit = MagicMock(return_value='h' * 100)
+    strategy.custom_exit = MagicMock(return_value='h' * CUSTOM_TAG_MAX_LENGTH * 2)
     res = strategy.should_exit(trade, 1, now,
                                enter=False, exit_=False,
                                low=None, high=None)
     assert res[0].exit_type == ExitType.CUSTOM_EXIT
     assert res[0].exit_flag is True
-    assert res[0].exit_reason == 'h' * 64
+    assert res[0].exit_reason == 'h' * (CUSTOM_TAG_MAX_LENGTH)
     assert log_has_re('Custom exit reason returned from custom_exit is too long.*', caplog)
 
 
 def test_should_sell(default_conf, fee) -> None:
 
     strategy = StrategyResolver.load_strategy(default_conf)
     trade = Trade(
@@ -982,15 +983,16 @@
             },
             "roi": {
                 "0": 0.2,
                 "1200": 0.01
             }
         }
     }
-    mocker.patch('freqtrade.strategy.hyper.json_load', return_value=expected_result)
+    mocker.patch('freqtrade.strategy.hyper.HyperoptTools.load_params',
+                 return_value=expected_result)
     PairLocks.timeframe = default_conf['timeframe']
     strategy = StrategyResolver.load_strategy(default_conf)
     assert strategy.stoploss == -0.05
     assert strategy.minimal_roi == {0: 0.2, 1200: 0.01}
 
     expected_result = {
         "strategy_name": "HyperoptableStrategy_No",
@@ -1001,15 +1003,17 @@
             "roi": {
                 "0": 0.2,
                 "1200": 0.01
             }
         }
     }
 
-    mocker.patch('freqtrade.strategy.hyper.json_load', return_value=expected_result)
+    mocker.patch('freqtrade.strategy.hyper.HyperoptTools.load_params',
+                 return_value=expected_result)
     with pytest.raises(OperationalException, match="Invalid parameter file provided."):
         StrategyResolver.load_strategy(default_conf)
 
-    mocker.patch('freqtrade.strategy.hyper.json_load', MagicMock(side_effect=ValueError()))
+    mocker.patch('freqtrade.strategy.hyper.HyperoptTools.load_params',
+                 MagicMock(side_effect=ValueError()))
 
     StrategyResolver.load_strategy(default_conf)
     assert log_has("Invalid parameter file format.", caplog)
```

### Comparing `freqtrade-2023.3/tests/strategy/test_strategy_helpers.py` & `freqtrade-2023.4/tests/strategy/test_strategy_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/strategy/test_strategy_loading.py` & `freqtrade-2023.4/tests/strategy/test_strategy_loading.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_arguments.py` & `freqtrade-2023.4/tests/test_arguments.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_binance_mig.py` & `freqtrade-2023.4/tests/test_binance_mig.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_configuration.py` & `freqtrade-2023.4/tests/test_configuration.py`

 * *Files 1% similar despite different names*

```diff
@@ -19,15 +19,16 @@
                                                          process_temporary_deprecated_settings)
 from freqtrade.configuration.environment_vars import flat_vars_to_nested_dict
 from freqtrade.configuration.load_config import (load_config_file, load_file, load_from_files,
                                                  log_config_error_range)
 from freqtrade.constants import DEFAULT_DB_DRYRUN_URL, DEFAULT_DB_PROD_URL, ENV_VAR_PREFIX
 from freqtrade.enums import RunMode
 from freqtrade.exceptions import OperationalException
-from freqtrade.loggers import FTBufferingHandler, _set_loggers, setup_logging, setup_logging_pre
+from freqtrade.loggers import (FTBufferingHandler, FTStdErrStreamHandler, _set_loggers,
+                               setup_logging, setup_logging_pre)
 from tests.conftest import (CURRENT_TEST_STRATEGY, log_has, log_has_re,
                             patched_configuration_load_config_file)
 
 
 @pytest.fixture(scope="function")
 def all_conf():
     config_file = Path(__file__).parents[1] / "config_examples/config_full.example.json"
@@ -654,15 +655,15 @@
               'logfile': 'syslog:/dev/log',
               }
 
     setup_logging_pre()
     setup_logging(config)
     assert len(logger.handlers) == 3
     assert [x for x in logger.handlers if type(x) == logging.handlers.SysLogHandler]
-    assert [x for x in logger.handlers if type(x) == logging.StreamHandler]
+    assert [x for x in logger.handlers if type(x) == FTStdErrStreamHandler]
     assert [x for x in logger.handlers if type(x) == FTBufferingHandler]
     # setting up logging again should NOT cause the loggers to be added a second time.
     setup_logging(config)
     assert len(logger.handlers) == 3
     # reset handlers to not break pytest
     logger.handlers = orig_handlers
 
@@ -677,15 +678,15 @@
               'logfile': str(logfile),
               }
 
     setup_logging_pre()
     setup_logging(config)
     assert len(logger.handlers) == 3
     assert [x for x in logger.handlers if type(x) == logging.handlers.RotatingFileHandler]
-    assert [x for x in logger.handlers if type(x) == logging.StreamHandler]
+    assert [x for x in logger.handlers if type(x) == FTStdErrStreamHandler]
     assert [x for x in logger.handlers if type(x) == FTBufferingHandler]
     # setting up logging again should NOT cause the loggers to be added a second time.
     setup_logging(config)
     assert len(logger.handlers) == 3
     # reset handlers to not break pytest
     if logfile.exists:
         logfile.unlink()
@@ -702,15 +703,15 @@
               'logfile': 'journald',
               }
 
     setup_logging_pre()
     setup_logging(config)
     assert len(logger.handlers) == 3
     assert [x for x in logger.handlers if type(x).__name__ == "JournaldLogHandler"]
-    assert [x for x in logger.handlers if type(x) == logging.StreamHandler]
+    assert [x for x in logger.handlers if type(x) == FTStdErrStreamHandler]
     # reset handlers to not break pytest
     logger.handlers = orig_handlers
 
 
 def test_set_loggers_journald_importerror(import_fails):
     logger = logging.getLogger()
     orig_handlers = logger.handlers
```

### Comparing `freqtrade-2023.3/tests/test_directory_operations.py` & `freqtrade-2023.4/tests/test_directory_operations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_freqtradebot.py` & `freqtrade-2023.4/tests/test_freqtradebot.py`

 * *Files 2% similar despite different names*

```diff
@@ -352,15 +352,15 @@
     with pytest.raises(DependencyException, match=r'.*stake amount.*'):
         freqtrade.create_trade('ETH/USDT')
 
 
 @pytest.mark.parametrize("is_short", [False, True])
 @pytest.mark.parametrize('stake_amount,create,amount_enough,max_open_trades', [
     (5.0, True, True, 99),
-    (0.049, True, False, 99),  # Amount will be adjusted to min - which is 0.051
+    (0.042, True, False, 99),  # Amount will be adjusted to min - which is 0.051
     (0, False, True, 99),
     (UNLIMITED_STAKE_AMOUNT, False, True, 0),
 ])
 def test_create_trade_minimal_amount(
     default_conf_usdt, ticker_usdt, limit_order_open, fee, mocker,
     stake_amount, create, amount_enough, max_open_trades, caplog, is_short
 ) -> None:
@@ -1287,14 +1287,145 @@
     assert freqtrade.handle_stoploss_on_exchange(trade) is False
     assert trade.stoploss_order_id is None
     assert trade.is_open is False
     assert trade.exit_reason == str(ExitType.EMERGENCY_EXIT)
 
 
 @pytest.mark.parametrize("is_short", [False, True])
+def test_handle_stoploss_on_exchange_partial(
+        mocker, default_conf_usdt, fee, is_short, limit_order) -> None:
+    stop_order_dict = {'id': "101", "status": "open"}
+    stoploss = MagicMock(return_value=stop_order_dict)
+    enter_order = limit_order[entry_side(is_short)]
+    exit_order = limit_order[exit_side(is_short)]
+    patch_RPCManager(mocker)
+    patch_exchange(mocker)
+    mocker.patch.multiple(
+        EXMS,
+        fetch_ticker=MagicMock(return_value={
+            'bid': 1.9,
+            'ask': 2.2,
+            'last': 1.9
+        }),
+        create_order=MagicMock(side_effect=[
+            enter_order,
+            exit_order,
+        ]),
+        get_fee=fee,
+        create_stoploss=stoploss
+    )
+    freqtrade = FreqtradeBot(default_conf_usdt)
+    patch_get_signal(freqtrade, enter_short=is_short, enter_long=not is_short)
+
+    freqtrade.enter_positions()
+    trade = Trade.session.scalars(select(Trade)).first()
+    trade.is_short = is_short
+    trade.is_open = True
+    trade.open_order_id = None
+    trade.stoploss_order_id = None
+
+    assert freqtrade.handle_stoploss_on_exchange(trade) is False
+    assert stoploss.call_count == 1
+    assert trade.stoploss_order_id == "101"
+    assert trade.amount == 30
+    stop_order_dict.update({'id': "102"})
+    # Stoploss on exchange is cancelled on exchange, but filled partially.
+    # Must update trade amount to guarantee successful exit.
+    stoploss_order_hit = MagicMock(return_value={
+        'id': "101",
+        'status': 'canceled',
+        'type': 'stop_loss_limit',
+        'price': 3,
+        'average': 2,
+        'filled': trade.amount / 2,
+        'remaining': trade.amount / 2,
+        'amount': enter_order['amount'],
+    })
+    mocker.patch(f'{EXMS}.fetch_stoploss_order', stoploss_order_hit)
+    assert freqtrade.handle_stoploss_on_exchange(trade) is False
+    # Stoploss filled partially ...
+    assert trade.amount == 15
+
+    assert trade.stoploss_order_id == "102"
+
+
+@pytest.mark.parametrize("is_short", [False, True])
+def test_handle_stoploss_on_exchange_partial_cancel_here(
+        mocker, default_conf_usdt, fee, is_short, limit_order, caplog) -> None:
+    stop_order_dict = {'id': "101", "status": "open"}
+    default_conf_usdt['trailing_stop'] = True
+    stoploss = MagicMock(return_value=stop_order_dict)
+    enter_order = limit_order[entry_side(is_short)]
+    exit_order = limit_order[exit_side(is_short)]
+    patch_RPCManager(mocker)
+    patch_exchange(mocker)
+    mocker.patch.multiple(
+        EXMS,
+        fetch_ticker=MagicMock(return_value={
+            'bid': 1.9,
+            'ask': 2.2,
+            'last': 1.9
+        }),
+        create_order=MagicMock(side_effect=[
+            enter_order,
+            exit_order,
+        ]),
+        get_fee=fee,
+        create_stoploss=stoploss
+    )
+    freqtrade = FreqtradeBot(default_conf_usdt)
+    patch_get_signal(freqtrade, enter_short=is_short, enter_long=not is_short)
+
+    freqtrade.enter_positions()
+    trade = Trade.session.scalars(select(Trade)).first()
+    trade.is_short = is_short
+    trade.is_open = True
+    trade.open_order_id = None
+    trade.stoploss_order_id = None
+
+    assert freqtrade.handle_stoploss_on_exchange(trade) is False
+    assert stoploss.call_count == 1
+    assert trade.stoploss_order_id == "101"
+    assert trade.amount == 30
+    stop_order_dict.update({'id': "102"})
+    # Stoploss on exchange is open.
+    # Freqtrade cancels the stop - but cancel returns a partial filled order.
+    stoploss_order_hit = MagicMock(return_value={
+        'id': "101",
+        'status': 'open',
+        'type': 'stop_loss_limit',
+        'price': 3,
+        'average': 2,
+        'filled': 0,
+        'remaining': trade.amount,
+        'amount': enter_order['amount'],
+    })
+    stoploss_order_cancel = MagicMock(return_value={
+        'id': "101",
+        'status': 'canceled',
+        'type': 'stop_loss_limit',
+        'price': 3,
+        'average': 2,
+        'filled': trade.amount / 2,
+        'remaining': trade.amount / 2,
+        'amount': enter_order['amount'],
+    })
+    mocker.patch(f'{EXMS}.fetch_stoploss_order', stoploss_order_hit)
+    mocker.patch(f'{EXMS}.cancel_stoploss_order_with_result', stoploss_order_cancel)
+    trade.stoploss_last_update = arrow.utcnow().shift(minutes=-10).datetime
+
+    assert freqtrade.handle_stoploss_on_exchange(trade) is False
+    # Canceled Stoploss filled partially ...
+    assert log_has_re('Cancelling current stoploss on exchange.*', caplog)
+
+    assert trade.stoploss_order_id == "102"
+    assert trade.amount == 15
+
+
+@pytest.mark.parametrize("is_short", [False, True])
 def test_handle_sle_cancel_cant_recreate(mocker, default_conf_usdt, fee, caplog, is_short,
                                          limit_order) -> None:
     # Sixth case: stoploss order was cancelled but couldn't create new one
     enter_order = limit_order[entry_side(is_short)]
     exit_order = limit_order[exit_side(is_short)]
     patch_RPCManager(mocker)
     patch_exchange(mocker)
@@ -1667,15 +1798,15 @@
 def test_stoploss_on_exchange_price_rounding(
         mocker, default_conf_usdt, fee, open_trade_usdt) -> None:
     patch_RPCManager(mocker)
     mocker.patch.multiple(
         EXMS,
         get_fee=fee,
     )
-    price_mock = MagicMock(side_effect=lambda p, s: int(s))
+    price_mock = MagicMock(side_effect=lambda p, s, **kwargs: int(s))
     stoploss_mock = MagicMock(return_value={'id': '13434334'})
     adjust_mock = MagicMock(return_value=False)
     mocker.patch.multiple(
         EXMS,
         create_stoploss=stoploss_mock,
         stoploss_adjust=adjust_mock,
         price_to_precision=price_mock,
@@ -2820,14 +2951,17 @@
     freqtrade.strategy.check_exit_timeout = MagicMock(return_value=True)
     freqtrade.strategy.check_entry_timeout = MagicMock(return_value=True)
     freqtrade.manage_open_orders()
     assert cancel_order_mock.call_count == 1
     assert rpc_mock.call_count == 2
     assert freqtrade.strategy.check_exit_timeout.call_count == 1
     assert freqtrade.strategy.check_entry_timeout.call_count == 0
+    trade = Trade.session.scalars(select(Trade)).first()
+    # cancelling didn't succeed - order-id remains open.
+    assert trade.open_order_id is not None
 
     # 2nd canceled trade - Fail execute exit
     caplog.clear()
     open_trade_usdt.open_order_id = limit_sell_order_old['id']
     mocker.patch('freqtrade.persistence.Trade.get_exit_order_count', return_value=1)
     mocker.patch('freqtrade.freqtradebot.FreqtradeBot.execute_trade_exit',
                  side_effect=DependencyException)
@@ -3330,21 +3464,26 @@
     mocker.patch(f'{EXMS}.get_min_pair_stake_amount', return_value=0.0)
     mocker.patch(f'{EXMS}.cancel_order_with_result', side_effect=InvalidOrderException())
 
     freqtrade = FreqtradeBot(default_conf_usdt)
 
     # TODO: should not be magicmock
     trade = MagicMock()
+    trade.open_order_id = '125'
     reason = CANCEL_REASON['TIMEOUT']
     order = {'remaining': 1,
              'id': '125',
              'amount': 1,
              'status': "open"}
     assert not freqtrade.handle_cancel_exit(trade, order, reason)
 
+    # mocker.patch(f'{EXMS}.cancel_order_with_result', return_value=order)
+    # assert not freqtrade.handle_cancel_exit(trade, order, reason)
+    # assert trade.open_order_id == '125'
+
 
 @pytest.mark.parametrize("is_short, open_rate, amt", [
     (False, 2.0, 30.0),
     (True, 2.02, 29.70297029),
 ])
 def test_execute_trade_exit_up(default_conf_usdt, ticker_usdt, fee, ticker_usdt_sell_up, mocker,
                                ticker_usdt_sell_down, is_short, open_rate, amt) -> None:
```

### Comparing `freqtrade-2023.3/tests/test_indicators.py` & `freqtrade-2023.4/tests/test_indicators.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_integration.py` & `freqtrade-2023.4/tests/test_integration.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_main.py` & `freqtrade-2023.4/tests/test_main.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_misc.py` & `freqtrade-2023.4/tests/test_misc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_periodiccache.py` & `freqtrade-2023.4/tests/test_periodiccache.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_plotting.py` & `freqtrade-2023.4/tests/test_plotting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_strategy_updater.py` & `freqtrade-2023.4/tests/test_strategy_updater.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_timerange.py` & `freqtrade-2023.4/tests/test_timerange.py`

 * *Files 5% similar despite different names*

```diff
@@ -6,14 +6,16 @@
 
 from freqtrade.configuration import TimeRange
 from freqtrade.exceptions import OperationalException
 
 
 def test_parse_timerange_incorrect():
 
+    timerange = TimeRange.parse_timerange('')
+    assert timerange == TimeRange(None, None, 0, 0)
     timerange = TimeRange.parse_timerange('20100522-')
     assert TimeRange('date', None, 1274486400, 0) == timerange
     assert timerange.timerange_str == '20100522-'
     timerange = TimeRange.parse_timerange('-20100522')
     assert TimeRange(None, 'date', 0, 1274486400) == timerange
     assert timerange.timerange_str == '-20100522'
     timerange = TimeRange.parse_timerange('20100522-20150730')
```

### Comparing `freqtrade-2023.3/tests/test_wallets.py` & `freqtrade-2023.4/tests/test_wallets.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.3/tests/test_worker.py` & `freqtrade-2023.4/tests/test_worker.py`

 * *Files identical despite different names*

